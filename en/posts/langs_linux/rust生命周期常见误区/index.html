<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Rustç”Ÿå‘½å‘¨æœŸå¸¸è§è¯¯åŒº | Reid's Blog</title>
<meta name=keywords content="Rust"><meta name=description content="Rustç”Ÿå‘½å‘¨æœŸå¸¸è§è¯¯åŒº"><meta name=author content="Reid"><link rel=canonical href=https://reid00.github.io/en/posts/langs_linux/rust%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%B8%B8%E8%A7%81%E8%AF%AF%E5%8C%BA/><link crossorigin=anonymous href=/assets/css/stylesheet.d7fb4cbf980fe688a21621b06a795933c4e6bb2d4070ec940667af1715d84af2.css integrity="sha256-1/tMv5gP5oiiFiGwanlZM8Tmuy1AcOyUBmevFxXYSvI=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://reid00.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://reid00.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://reid00.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://reid00.github.io/apple-touch-icon.png><link rel=mask-icon href=https://reid00.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><head><meta name=referrer content="no-referrer"></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-QRR6GRNQGK"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QRR6GRNQGK",{anonymize_ip:!1})}</script><meta property="og:title" content="Rustç”Ÿå‘½å‘¨æœŸå¸¸è§è¯¯åŒº"><meta property="og:description" content="Rustç”Ÿå‘½å‘¨æœŸå¸¸è§è¯¯åŒº"><meta property="og:type" content="article"><meta property="og:url" content="https://reid00.github.io/en/posts/langs_linux/rust%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%B8%B8%E8%A7%81%E8%AF%AF%E5%8C%BA/"><meta property="og:image" content="https://i.loli.net/2021/09/26/3OMGXylm8HUYJ6p.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-05T17:35:54+08:00"><meta property="article:modified_time" content="2023-09-05T17:35:54+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://i.loli.net/2021/09/26/3OMGXylm8HUYJ6p.png"><meta name=twitter:title content="Rustç”Ÿå‘½å‘¨æœŸå¸¸è§è¯¯åŒº"><meta name=twitter:description content="Rustç”Ÿå‘½å‘¨æœŸå¸¸è§è¯¯åŒº"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://reid00.github.io/en/posts/"},{"@type":"ListItem","position":2,"name":"å­¦ä¹ çš„ç¼–ç¨‹è¯­è¨€Golangï¼ŒPythonï¼ŒRust å’ŒLinux ç›¸å…³çš„è®°å½• ","item":"https://reid00.github.io/en/posts/langs_linux/"},{"@type":"ListItem","position":3,"name":"Rustç”Ÿå‘½å‘¨æœŸå¸¸è§è¯¯åŒº","item":"https://reid00.github.io/en/posts/langs_linux/rust%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%B8%B8%E8%A7%81%E8%AF%AF%E5%8C%BA/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Rustç”Ÿå‘½å‘¨æœŸå¸¸è§è¯¯åŒº","name":"Rustç”Ÿå‘½å‘¨æœŸå¸¸è§è¯¯åŒº","description":"Rustç”Ÿå‘½å‘¨æœŸå¸¸è§è¯¯åŒº","keywords":["Rust"],"articleBody":"ä»‹ç» æˆ‘æ›¾ç»æœ‰è¿‡çš„æ‰€æœ‰è¿™äº›å¯¹ç”Ÿå‘½å‘¨æœŸçš„è¯¯è§£ï¼Œç°åœ¨æœ‰å¾ˆå¤šåˆå­¦è€…ä¹Ÿæ·±é™·äºæ­¤ã€‚ æˆ‘ç”¨åˆ°çš„æœ¯è¯­å¯èƒ½ä¸æ˜¯æ ‡å‡†çš„ï¼Œæ‰€ä»¥ä¸‹é¢åˆ—äº†ä¸€ä¸ªè¡¨æ ¼æ¥è§£é‡Šå®ƒä»¬çš„ç”¨æ„ã€‚\nçŸ­è¯­ æ„ä¸º T åŒ…å«äº†æ‰€æœ‰å¯èƒ½ç±»å‹çš„é›†åˆ æˆ– è¿™ä¸ªé›†åˆä¸­çš„ç±»å‹ æ‰€æœ‰æƒç±»å‹ ä¸å«å¼•ç”¨çš„ç±»å‹, ä¾‹å¦‚ i32, String, Vec, ç­‰ å€Ÿç”¨ç±»å‹ æˆ– å¼•ç”¨ç±»å‹ ä¸è€ƒè™‘å¯å˜æ€§çš„å¼•ç”¨ç±»å‹, ä¾‹å¦‚ \u0026i32, \u0026mut i32 ç­‰ å¯å˜å¼•ç”¨ æˆ– ç‹¬å å¼•ç”¨ ç‹¬å çš„å¯å˜å¼•ç”¨, å³ \u0026mut T ä¸å¯å˜å¼•ç”¨ æˆ– å…±äº«å¼•ç”¨ å…±äº«çš„ä¸å¯å˜å¼•ç”¨, å³ \u0026T è¯¯è§£é¡¹ ç®€è€Œè¨€ä¹‹ï¼šå˜é‡çš„ç”Ÿå‘½å‘¨æœŸæŒ‡çš„æ˜¯è¿™ä¸ªå˜é‡æ‰€æŒ‡çš„æ•°æ®å¯ä»¥è¢«ç¼–è¯‘å™¨é™æ€éªŒè¯çš„ã€åœ¨å½“å‰å†…å­˜åœ°å€æœ‰æ•ˆæœŸçš„é•¿åº¦ã€‚\nè¯¯è§£1: T åªåŒ…å«æ‰€æœ‰æƒç±»å‹ è¿™ä¸ªè¯¯è§£æ¯”èµ·è¯´ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒå’Œæ³›å‹æ›´ç›¸å…³ï¼Œä½†åœ¨Rustä¸­æ³›å‹å’Œç”Ÿå‘½å‘¨æœŸæ˜¯ç´§å¯†è”ç³»åœ¨ä¸€èµ·çš„ï¼Œä¸å¯åªè°ˆå…¶ä¸€ã€‚\nå½“æˆ‘åˆšå¼€å§‹å­¦ä¹ Rustçš„æ—¶å€™ï¼Œæˆ‘ç†è§£i32ï¼Œ\u0026i32ï¼Œå’Œ\u0026mut i32æ˜¯ä¸åŒçš„ç±»å‹ï¼Œä¹Ÿæ˜ç™½æ³›å‹å˜é‡Tä»£è¡¨ç€æ‰€æœ‰å¯èƒ½ç±»å‹çš„é›†åˆã€‚ ä½†å°½ç®¡è¿™äºŒè€…åˆ†å¼€éƒ½æ‡‚ï¼Œå½“å®ƒä»¬ç»“åˆåœ¨ä¸€èµ·çš„æ—¶å€™æˆ‘å´é™·å…¥å›°æƒ‘ã€‚åœ¨æˆ‘è¿™ä¸ªRuståˆå­¦è€…çš„çœ¼ä¸­ï¼Œæ³›å‹æ˜¯è¿™æ ·çš„è¿ä½œçš„ï¼š\nç±»å‹å˜é‡ T \u0026T \u0026mut T ä¾‹å­ i32 \u0026i32 \u0026mut i32 T åŒ…å«ä¸€åˆ‡æ‰€æœ‰æƒç±»å‹ï¼› \u0026T åŒ…å«ä¸€åˆ‡ä¸å¯å˜å€Ÿç”¨ç±»å‹ï¼› \u0026mut T åŒ…å«ä¸€åˆ‡å¯å˜å€Ÿç”¨ç±»å‹ã€‚ Tï¼Œ \u0026Tï¼Œ å’Œ \u0026mut T æ˜¯ä¸ç›¸äº¤çš„æœ‰é™é›†ã€‚ ç®€æ´æ˜äº†ï¼Œç¬¦åˆç›´è§‰ï¼Œä½†å´å®Œå…¨é”™è¯¯ã€‚ ä¸‹é¢è¿™æ‰æ˜¯æ³›å‹çœŸæ­£çš„è¿ä½œæ–¹å¼ï¼š ç±»å‹å˜é‡ T \u0026T \u0026mut T ä¾‹å­ i32, \u0026i32, \u0026mut i32, \u0026\u0026i32, \u0026mut \u0026mut i32, â€¦ \u0026i32, \u0026\u0026i32, \u0026\u0026mut i32, â€¦ \u0026mut i32, \u0026mut \u0026mut i32, \u0026mut \u0026i32, â€¦ T, \u0026T, å’Œ \u0026mut T éƒ½æ˜¯æ— é™é›†, å› ä¸ºä½ å¯ä»¥æ— é™å€Ÿç”¨ä¸€ä¸ªç±»å‹ã€‚ T æ˜¯ \u0026T å’Œ \u0026mut Tçš„è¶…é›†. \u0026T å’Œ \u0026mut T æ˜¯ä¸ç›¸äº¤çš„é›†åˆã€‚ è®©æˆ‘ä»¬ç”¨å‡ ä¸ªä¾‹å­æ¥æ£€éªŒä¸€ä¸‹è¿™äº›æ¦‚å¿µ:\n1 2 3 4 5 6 7 trait Trait {} impl\u003cT\u003e Trait for T {} impl\u003cT\u003e Trait for \u0026T {} // ç¼–è¯‘é”™è¯¯ impl\u003cT\u003e Trait for \u0026mut T {} // ç¼–è¯‘é”™è¯¯ ä¸Šé¢çš„ä»£ç å¹¶ä¸èƒ½å¦‚æ„¿ç¼–è¯‘:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 error[E0119]: conflicting implementations of trait `Trait` for type `\u0026_`: --\u003e src/lib.rs:5:1 | 3 | impl\u003cT\u003e Trait for T {} | ------------------- first implementation here 4 | 5 | impl\u003cT\u003e Trait for \u0026T {} | ^^^^^^^^^^^^^^^^^^^^ conflicting implementation for `\u0026_` error[E0119]: conflicting implementations of trait `Trait` for type `\u0026mut _`: --\u003e src/lib.rs:7:1 | 3 | impl\u003cT\u003e Trait for T {} | ------------------- first implementation here ... 7 | impl\u003cT\u003e Trait for \u0026mut T {} | ^^^^^^^^^^^^^^^^^^^^^^^^ conflicting implementation for `\u0026mut _ ç¼–è¯‘å™¨ä¸å…è®¸æˆ‘ä»¬ä¸º\u0026Tå’Œ\u0026mut Tå®ç°Traitï¼Œå› ä¸ºè¿™æ ·ä¼šä¸ä¸ºTå®ç°çš„Traitå†²çªï¼Œ Tæœ¬èº«å·²ç»åŒ…å«äº†æ‰€æœ‰\u0026Tå’Œ\u0026mut Tã€‚ä¸‹é¢çš„ä»£ç èƒ½å¤Ÿå¦‚æ„¿ç¼–è¯‘ï¼Œå› ä¸º\u0026Tå’Œ\u0026mut Tæ˜¯ä¸ç›¸äº¤çš„ï¼š\n1 2 3 4 5 trait Trait {} impl\u003cT\u003e Trait for \u0026T {} // ç¼–è¯‘é€šè¿‡ impl\u003cT\u003e Trait for \u0026mut T {} // ç¼–è¯‘é€šè¿‡ è¦ç‚¹:\nT æ˜¯ \u0026T å’Œ \u0026mut Tçš„è¶…é›† \u0026T å’Œ \u0026mut T æ˜¯ä¸ç›¸äº¤çš„é›†åˆ è¯¯è§£2: å¦‚æœ T: â€˜static é‚£ä¹ˆ T å¿…é¡»åœ¨æ•´ä¸ªç¨‹åºè¿è¡Œä¸­éƒ½æ˜¯æœ‰æ•ˆçš„ è¯¯è§£æ¨è®º\nT: â€˜static åº”è¯¥è¢«çœ‹ä½œ \" T æ‹¥æœ‰ â€˜static ç”Ÿå‘½å‘¨æœŸ \" \u0026â€˜static T å’Œ T: â€˜static æ²¡æœ‰åŒºåˆ« å¦‚æœ T: â€˜static é‚£ä¹ˆ T å¿…é¡»ä¸ºä¸å¯å˜çš„ å¦‚æœ T: â€˜static é‚£ä¹ˆ T åªèƒ½åœ¨ç¼–è¯‘æœŸåˆ›å»º å¤§éƒ¨åˆ†Ruståˆå­¦è€…æ˜¯ä»ç±»ä¼¼ä¸‹é¢è¿™ä¸ªä»£ç ç¤ºä¾‹ä¸­æ¥è§¦åˆ° â€˜static ç”Ÿå‘½å‘¨æœŸçš„ï¼š\n1 2 3 fn main() { let str_literal: \u0026'static str = \"str literal\"; } ä»–ä»¬è¢«å‘ŠçŸ¥ â€œstr literalâ€ æ˜¯ç¡¬ç¼–ç åœ¨ç¼–è¯‘å‡ºæ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„ï¼Œ å¹¶ä¼šåœ¨è¿è¡Œæ—¶è¢«åŠ è½½åˆ°åªè¯»å†…å­˜ï¼Œæ‰€ä»¥å¿…é¡»æ˜¯ä¸å¯å˜çš„ä¸”åœ¨æ•´ä¸ªç¨‹åºçš„è¿è¡Œä¸­éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œ è¿™å°±æ˜¯å®ƒæˆä¸º â€˜static çš„åŸå› ã€‚ è€Œè¿™äº›è§‚å¿µåˆè¿›ä¸€æ­¥è¢«ç”¨ static å…³é”®å­—æ¥å®šä¹‰é™æ€å˜é‡çš„è§„åˆ™æ‰€åŠ å¼ºã€‚\n1 2 3 4 5 6 7 8 9 10 11 static BYTES: [u8; 3] = [1, 2, 3]; static mut MUT_BYTES: [u8; 3] = [1, 2, 3]; fn main() { MUT_BYTES[0] = 99; // ç¼–è¯‘é”™è¯¯ï¼Œä¿®æ”¹é™æ€å˜é‡æ˜¯unsafeçš„ unsafe { MUT_BYTES[0] = 99; assert_eq!(99, MUT_BYTES[0]); } } è®¤ä¸ºé™æ€å˜é‡\nåªå¯ä»¥åœ¨ç¼–è¯‘æœŸåˆ›å»º å¿…é¡»æ˜¯ä¸å¯å˜çš„ï¼Œä¿®æ”¹å®ƒä»¬æ˜¯unsafeçš„ åœ¨æ•´ä¸ªç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­éƒ½æ˜¯æœ‰æ•ˆçš„ â€˜static ç”Ÿå‘½å‘¨æœŸå¤§æ¦‚æ˜¯ä»¥é™æ€å˜é‡çš„é»˜è®¤ç”Ÿå‘½å‘¨æœŸå‘½åçš„ï¼Œå¯¹å§ï¼Ÿ é‚£ä¹ˆæœ‰ç†ç”±è®¤ä¸ºâ€™staticç”Ÿå‘½å‘¨æœŸä¹Ÿåº”è¯¥éµå®ˆç›¸åŒçš„è§„åˆ™ï¼Œä¸æ˜¯å—ï¼Ÿ\næ˜¯çš„ï¼Œä½†æ‹¥æœ‰'staticç”Ÿå‘½å‘¨æœŸçš„ç±»å‹ä¸'staticçº¦æŸçš„ç±»å‹æ˜¯ä¸åŒçš„ã€‚ åè€…èƒ½åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ†é…ï¼Œå¯ä»¥å®‰å…¨åœ°ã€è‡ªç”±åœ°ä¿®æ”¹ï¼Œå¯ä»¥è¢«dropï¼Œ è¿˜å¯ä»¥æœ‰ä»»æ„é•¿åº¦çš„ç”Ÿå‘½å‘¨æœŸã€‚\nåœ¨è¿™ä¸ªç‚¹ï¼Œå¾ˆé‡è¦çš„æ˜¯è¦åŒºåˆ† \u0026'static T å’Œ T: 'staticã€‚\n\u0026'static T æ˜¯å¯¹æŸä¸ªTçš„ä¸å¯å˜å¼•ç”¨ï¼Œè¿™ä¸ªå¼•ç”¨å¯ä»¥è¢«æ— é™æœŸåœ°æŒæœ‰ç›´åˆ°ç¨‹åºç»“æŸã€‚ è¿™åªå¯èƒ½å‘ç”Ÿåœ¨Tæœ¬èº«ä¸å¯å˜ä¸”ä¸ä¼šåœ¨å¼•ç”¨è¢«åˆ›å»ºåç§»åŠ¨çš„æƒ…å†µä¸‹ã€‚ Tå¹¶ä¸éœ€è¦åœ¨ç¼–è¯‘æœŸå°±è¢«åˆ›å»ºï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆéšæœºæ•°æ®ï¼Œ ç„¶åä»¥å†…å­˜æ³„æ¼ä¸ºä»£ä»·è¿”å›â€™staticå¼•ç”¨ï¼Œä¾‹å¦‚ï¼š\n1 2 3 4 5 6 7 use rand; // åœ¨è¿è¡Œæ—¶ç”Ÿæˆéšæœº\u0026'static str fn rand_str_generator() -\u003e \u0026'static str { let rand_string = rand::random::\u003cu64\u003e().to_string(); Box::leak(rand_string.into_boxed_str()) } T: 'static æ˜¯æŒ‡Tå¯ä»¥è¢«æ— é™æœŸå®‰å…¨åœ°æŒæœ‰ç›´åˆ°ç¨‹åºç»“æŸã€‚ T: â€˜staticåŒ…æ‹¬æ‰€æœ‰\u0026â€˜static Tï¼Œæ­¤å¤–è¿˜åŒ…æ‹¬æ‰€æœ‰çš„æ‰€æœ‰æƒç±»å‹ï¼Œæ¯”å¦‚String, Vecç­‰ã€‚ æ•°æ®çš„æ‰€æœ‰è€…èƒ½å¤Ÿä¿è¯æ•°æ®åªè¦è¿˜è¢«æŒæœ‰å°±ä¸ä¼šå¤±æ•ˆï¼Œå› æ­¤æ‰€æœ‰è€…å¯ä»¥æ— é™æœŸå®‰å…¨åœ°æŒæœ‰è¯¥æ•°æ®ç›´åˆ°ç¨‹åºç»“æŸã€‚ T: 'staticåº”è¯¥è¢«çœ‹ä½œTå—'staticç”Ÿå‘½å‘¨æœŸ \"çº¦æŸ\" è€Œé Tæœ‰ç€'staticç”Ÿå‘½å‘¨æœŸã€‚ è¿™æ®µä»£ç èƒ½å¸®æˆ‘ä»¬é˜é‡Šè¿™äº›æ¦‚å¿µï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 use rand; fn drop_static\u003cT: 'static\u003e(t: T) { std::mem::drop(t); } fn main() { let mut strings: Vec\u003cString\u003e = Vec::new(); for _ in 0..10 { if rand::random() { // æ‰€æœ‰å­—ç¬¦ä¸²éƒ½æ˜¯éšæœºç”Ÿæˆçš„ // å¹¶ä¸”æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”³è¯·çš„ let string = rand::random::\u003cu64\u003e().to_string(); strings.push(string); } } // è¿™äº›å­—ç¬¦ä¸²éƒ½æ˜¯æ‰€æœ‰æƒç±»å‹ï¼Œæ‰€ä»¥å®ƒä»¬æ»¡è¶³'staticçº¦æŸ for mut string in strings { // è¿™äº›å­—ç¬¦ä¸²éƒ½æ˜¯å¯ä»¥ä¿®æ”¹çš„ string.push_str(\"a mutation\"); // è¿™äº›å­—ç¬¦ä¸²éƒ½æ˜¯å¯ä»¥è¢«dropçš„ drop_static(string); // ç¼–è¯‘é€šè¿‡ } // è¿™äº›å­—ç¬¦ä¸²éƒ½åœ¨ç¨‹åºç»“æŸä¹‹å‰å¤±æ•ˆ println!(\"i am the end of the program\"); } è¦ç‚¹:\nT: â€˜static åº”è¯¥è¢«çœ‹ä½œ â€œTå—â€™staticç”Ÿå‘½å‘¨æœŸçº¦æŸâ€ å¦‚æœ T: â€˜static é‚£ä¹ˆTå¯ä»¥æ˜¯æœ‰ç€â€™staticç”Ÿå‘½å‘¨æœŸçš„å€Ÿç”¨ç±»å‹ ç”±äº T: â€˜static åŒ…æ‹¬äº†æ‰€æœ‰æƒç±»å‹ï¼Œè¿™æ„å‘³ç€T å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ†é… ä¸ä¸€å®šè¦åœ¨æ•´ä¸ªç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­éƒ½æœ‰æ•ˆ å¯ä»¥è¢«å®‰å…¨åœ°ã€è‡ªç”±åœ°ä¿®æ”¹ å¯ä»¥åœ¨è¿è¡Œæ—¶è¢«åŠ¨æ€dropæ‰ å¯ä»¥æœ‰ä¸åŒé•¿åº¦çš„ç”Ÿå‘½å‘¨æœŸ è¯¯è§£3: \u0026â€˜a T å’Œ T: â€˜a æ˜¯ç›¸åŒçš„ è¿™ä¸ªè¯¯è§£æ˜¯ä¸Šä¸€ä¸ªçš„æ³›åŒ–ç‰ˆæœ¬ã€‚\n\u0026â€˜a T ä¸å…‰è¦æ±‚ï¼ŒåŒæ—¶ä¹Ÿéšå«ç€ T: â€˜aï¼Œ å› ä¸ºå¦‚æœTæœ¬èº«éƒ½ä¸èƒ½åœ¨'aå†…æœ‰æ•ˆï¼Œ é‚£å¯¹Tçš„æœ‰'aç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨ä¹Ÿä¸å¯èƒ½æ˜¯æœ‰æ•ˆçš„ã€‚ ä¾‹å¦‚ï¼ŒRustç¼–è¯‘å™¨ä»æ¥ä¸ä¼šå…è®¸åˆ›å»º\u0026â€˜static Ref\u003câ€˜a, T\u003eè¿™ä¸ªç±»å‹ï¼Œå› ä¸ºå¦‚æœRefåªåœ¨â€™aå†…æœ‰æ•ˆï¼Œæˆ‘ä»¬ä¸å¯èƒ½å¼„å‡ºä¸€ä¸ªå¯¹å®ƒçš„â€™staticçš„å¼•ç”¨ã€‚\nT: 'aåŒ…æ‹¬äº†æ‰€æœ‰\u0026'a Tï¼Œä½†åè¿‡æ¥ä¸å¯¹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // åªæ¥å—ä»¥'açº¦æŸçš„å¼•ç”¨ç±»å‹ fn t_ref\u003c'a, T: 'a\u003e(t: \u0026'a T) {} // æ¥å—æ‰€æœ‰ä»¥'açº¦æŸçš„ç±»å‹ fn t_bound\u003c'a, T: 'a\u003e(t: T) {} // åŒ…å«å¼•ç”¨çš„æ‰€æœ‰æƒç±»å‹ struct Ref\u003c'a, T: 'a\u003e(\u0026'a T); fn main() { let string = String::from(\"string\"); t_bound(\u0026string); // ç¼–è¯‘é€šè¿‡ t_bound(Ref(\u0026string)); // ç¼–è¯‘é€šè¿‡ t_bound(\u0026Ref(\u0026string)); // ç¼–è¯‘é€šè¿‡ t_ref(\u0026string); // ç¼–è¯‘é€šè¿‡ t_ref(Ref(\u0026string)); // ç¼–è¯‘é”™è¯¯, æœŸå¾…æ¥æ”¶ä¸€ä¸ªå¼•ç”¨ï¼Œä½†æ”¶åˆ°ä¸€ä¸ªç»“æ„ä½“ t_ref(\u0026Ref(\u0026string)); // ç¼–è¯‘é€šè¿‡ // stringå˜é‡æ˜¯ä»¥'staticçº¦æŸçš„ï¼Œä¹Ÿæ»¡è¶³'açº¦æŸ t_bound(string); // ç¼–è¯‘é€šè¿‡ } è¦ç‚¹:\nT: â€˜a æ¯”èµ· \u0026â€˜a Tæ›´æ³›åŒ–ä¹Ÿæ›´çµæ´» T: â€˜a æ¥å—æ‰€æœ‰æƒç±»å‹ã€åŒ…å«å¼•ç”¨çš„æ‰€æœ‰æƒç±»å‹ä»¥åŠå¼•ç”¨ \u0026â€˜a T åªæ¥å—å¼•ç”¨ å¦‚æœ T: â€˜static é‚£ä¹ˆ T: â€˜a, å› ä¸ºå¯¹äºæ‰€æœ‰â€™aéƒ½æœ‰â€™static \u003e= â€˜a è¯¯è§£4: æˆ‘çš„ä»£ç æ²¡ç”¨åˆ°æ³›å‹ï¼Œä¹Ÿä¸å«ç”Ÿå‘½å‘¨æœŸ è¯¯è§£æ¨è®º:\né¿å…ä½¿ç”¨æ³›å‹å’Œç”Ÿå‘½å‘¨æœŸæ˜¯å¯èƒ½çš„ è¿™ç§å®‰æ…°æ€§çš„è¯¯è§£çš„å­˜åœ¨æ˜¯ç”±äºRustçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ï¼Œ è¿™äº›è§„åˆ™è®©ä½ èƒ½å¤Ÿåœ¨å‡½æ•°ä¸­çœç•¥æ‰ç”Ÿå‘½å‘¨æœŸè®°å·ï¼Œ å› ä¸ºRustçš„å€Ÿç”¨æ£€æŸ¥å™¨èƒ½æ ¹æ®ä»¥ä¸‹è§„åˆ™å°†å®ƒä»¬æ¨å¯¼å‡ºæ¥ï¼š\næ¯ä¸ªä¼ å…¥çš„å¼•ç”¨éƒ½ä¼šæœ‰ä¸€ä¸ªå•ç‹¬çš„ç”Ÿå‘½å‘¨æœŸ å¦‚æœåªæœ‰ä¸€ä¸ªä¼ å…¥çš„ç”Ÿå‘½å‘¨æœŸï¼Œé‚£ä¹ˆå®ƒå°†è¢«åº”ç”¨åˆ°æ‰€æœ‰è¾“å‡ºçš„å¼•ç”¨ä¸Š å¦‚æœæœ‰å¤šä¸ªä¼ å…¥çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½†å…¶ä¸­ä¸€ä¸ªæ˜¯\u0026selfæˆ–è€…\u0026mut selfï¼Œé‚£ä¹ˆè¿™ä¸ªç”Ÿå‘½å‘¨æœŸå°†ä¼šè¢«åº”ç”¨åˆ°æ‰€æœ‰è¾“å‡ºçš„å¼•ç”¨ä¸Š é™¤æ­¤ä¹‹å¤–çš„è¾“å‡ºçš„ç”Ÿå‘½å‘¨æœŸéƒ½å¿…é¡»æ˜¾ç¤ºæ ‡æ³¨å‡ºæ¥ å¦‚æœä¸€æ—¶é—´éš¾ä»¥æƒ³æ˜ç™½è¿™ä¹ˆå¤šä¸œè¥¿ï¼Œé‚£è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›ä¾‹å­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 // çœç•¥ fn print(s: \u0026str); // å±•å¼€ fn print\u003c'a\u003e(s: \u0026'a str); // çœç•¥ fn trim(s: \u0026str) -\u003e \u0026str; // å±•å¼€ fn trim\u003c'a\u003e(s: \u0026'a str) -\u003e \u0026'a str; // ä¸åˆæ³•ï¼Œæ— æ³•ç¡®å®šè¾“å‡ºçš„ç”Ÿå‘½å‘¨æœŸï¼Œå› ä¸ºæ²¡æœ‰è¾“å…¥çš„ fn get_str() -\u003e \u0026str; // æ˜¾å¼çš„å†™æ³•åŒ…æ‹¬ fn get_str\u003c'a\u003e() -\u003e \u0026'a str; // æ³›å‹ç‰ˆæœ¬ fn get_str() -\u003e \u0026'static str; // 'static ç‰ˆæœ¬ // ä¸åˆæ³•ï¼Œæ— æ³•ç¡®å®šè¾“å‡ºçš„ç”Ÿå‘½å‘¨æœŸï¼Œå› ä¸ºæœ‰å¤šä¸ªè¾“å…¥ fn overlap(s: \u0026str, t: \u0026str) -\u003e \u0026str; // æ˜¾å¼(ä½†ä»æœ‰éƒ¨åˆ†çœç•¥)çš„å†™æ³•åŒ…æ‹¬ fn overlap\u003c'a\u003e(s: \u0026'a str, t: \u0026str) -\u003e \u0026'a str; // è¾“å‡ºç”Ÿå‘½å‘¨æœŸä¸èƒ½é•¿äºs fn overlap\u003c'a\u003e(s: \u0026str, t: \u0026'a str) -\u003e \u0026'a str; // è¾“å‡ºç”Ÿå‘½å‘¨æœŸä¸èƒ½é•¿äºt fn overlap\u003c'a\u003e(s: \u0026'a str, t: \u0026'a str) -\u003e \u0026'a str; // è¾“å‡ºç”Ÿå‘½å‘¨æœŸä¸èƒ½é•¿äºså’Œt fn overlap(s: \u0026str, t: \u0026str) -\u003e \u0026'static str; // è¾“å‡ºç”Ÿå‘½å‘¨æœŸå¯ä»¥é•¿äºså’Œt fn overlap\u003c'a\u003e(s: \u0026str, t: \u0026str) -\u003e \u0026'a str; // è¾“å…¥å’Œè¾“å‡ºçš„ç”Ÿå‘½å‘¨æœŸæ— å…³ // å±•å¼€ fn overlap\u003c'a, 'b\u003e(s: \u0026'a str, t: \u0026'b str) -\u003e \u0026'a str; fn overlap\u003c'a, 'b\u003e(s: \u0026'a str, t: \u0026'b str) -\u003e \u0026'b str; fn overlap\u003c'a\u003e(s: \u0026'a str, t: \u0026'a str) -\u003e \u0026'a str; fn overlap\u003c'a, 'b\u003e(s: \u0026'a str, t: \u0026'b str) -\u003e \u0026'static str; fn overlap\u003c'a, 'b, 'c\u003e(s: \u0026'a str, t: \u0026'b str) -\u003e \u0026'c str; // çœç•¥ fn compare(\u0026self, s: \u0026str) -\u003e \u0026str; // å±•å¼€ fn compare\u003c'a, 'b\u003e(\u0026'a self, \u0026'b str) -\u003e \u0026'a str; å¦‚æœä½ æ›¾å†™è¿‡\nç»“æ„ä½“æ–¹æ³• æ¥æ”¶å¼•ç”¨çš„å‡½æ•° è¿”å›å¼•ç”¨çš„å‡½æ•° æ³›å‹å‡½æ•° trait object(åé¢ä¼šæœ‰æ›´è¯¦ç»†çš„è®¨è®º) é—­åŒ…(åé¢ä¼šæœ‰æ›´è¯¦ç»†çš„è®¨è®º) é‚£ä¹ˆä½ çš„ä»£ç å°±æœ‰è¢«çœç•¥çš„æ³›å‹ç”Ÿå‘½å‘¨æœŸè®°å·ã€‚ è¦ç‚¹:\nå‡ ä¹æ‰€æœ‰Rustä»£ç éƒ½æ˜¯æ³›å‹ä»£ç ï¼Œåˆ°å¤„éƒ½æœ‰è¢«çœç•¥çš„ç”Ÿå‘½å‘¨æœŸè®°å· è¯¯è§£5: å¦‚æœç¼–è¯‘èƒ½é€šè¿‡ï¼Œé‚£ä¹ˆæˆ‘çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨å°±æ˜¯æ­£ç¡®çš„ è¯¯è§£æ¨è®º\nRustå¯¹å‡½æ•°çš„çš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™æ€»æ˜¯æ­£ç¡®çš„ Rustçš„å€Ÿç”¨æ£€æŸ¥å™¨åœ¨æŠ€æœ¯ä¸Šå’Œè¯­ä¹‰ä¸Šæ€»æ˜¯æ­£ç¡®çš„ Rustæ¯”æˆ‘æ›´äº†è§£æˆ‘çš„ç¨‹åºçš„è¯­ä¹‰ Rustç¨‹åºæ˜¯æœ‰å¯èƒ½åœ¨æŠ€æœ¯ä¸Šèƒ½é€šè¿‡ç¼–è¯‘ï¼Œä½†è¯­ä¹‰ä¸Šä»ç„¶æ˜¯é”™çš„ã€‚æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªä¾‹å­ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 struct ByteIter\u003c'a\u003e { remainder: \u0026'a [u8] } impl\u003c'a\u003e ByteIter\u003c'a\u003e { fn next(\u0026mut self) -\u003e Option\u003c\u0026u8\u003e { if self.remainder.is_empty() { None } else { let byte = \u0026self.remainder[0]; self.remainder = \u0026self.remainder[1..]; Some(byte) } } } fn main() { let mut bytes = ByteIter { remainder: b\"1\" }; assert_eq!(Some(\u0026b'1'), bytes.next()); assert_eq!(None, bytes.next()); } ByteIter æ˜¯åœ¨å­—èŠ‚åˆ‡ç‰‡ä¸Šè¿­ä»£çš„è¿­ä»£å™¨ï¼Œä¸ºäº†ç®€æ´æˆ‘ä»¬è·³è¿‡å¯¹ Iterator traitçš„å®ç°ã€‚ è¿™çœ‹èµ·æ¥æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³åŒæ—¶æ£€æŸ¥å¤šä¸ªå­—èŠ‚å‘¢ï¼Ÿ\n1 2 3 4 5 6 7 8 fn main() { let mut bytes = ByteIter { remainder: b\"1123\" }; let byte_1 = bytes.next(); let byte_2 = bytes.next(); if byte_1 == byte_2 { // åšç‚¹ä»€ä¹ˆ } } å•Šå“¦ï¼ç¼–è¯‘é”™è¯¯ï¼š\n1 2 3 4 5 6 7 8 9 10 error[E0499]: cannot borrow `bytes` as mutable more than once at a time --\u003e src/main.rs:20:18 | 19 | let byte_1 = bytes.next(); | ----- first mutable borrow occurs here 20 | let byte_2 = bytes.next(); | ^^^^^ second mutable borrow occurs here 21 | if byte_1 == byte_2 { | ------ first borrow later used here æˆ‘è§‰å¾—æˆ‘ä»¬å¯ä»¥æ‹·è´æ¯ä¸€ä¸ªå­—èŠ‚ã€‚æ‹·è´åœ¨æˆ‘ä»¬å¤„ç†å­—èŠ‚çš„æ—¶å€™æ˜¯å¯è¡Œçš„ï¼Œ ä½†å½“æˆ‘ä»¬ä» ByteIter è½¬å‘æ³›å‹åˆ‡ç‰‡è¿­ä»£å™¨ç”¨æ¥è¿­ä»£ä»»æ„ \u0026'a [T] çš„æ—¶å€™ æˆ‘ä»¬ä¹Ÿä¼šæƒ³åˆ°å°†æ¥å¯èƒ½å®ƒä¼šè¢«åº”ç”¨åˆ°é‚£äº›æ‹·è´/å…‹éš†çš„ä»£ä»·å¾ˆæ˜‚è´µæˆ–æ ¹æœ¬ä¸å¯èƒ½çš„ç±»å‹ä¸Šã€‚ å™¢ï¼Œæˆ‘æƒ³æˆ‘ä»¬å¯¹è¿™æ²¡ä»€ä¹ˆåŠæ³•ï¼Œä»£ç èƒ½è¿‡ç¼–è¯‘ï¼Œé‚£ä¹ˆç”Ÿå‘½å‘¨æœŸæ ‡è®°å¿…ç„¶æ˜¯å¯¹çš„ä¸æ˜¯å—ï¼Ÿ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 struct ByteIter\u003c'a\u003e { remainder: \u0026'a [u8] } impl\u003c'a\u003e ByteIter\u003c'a\u003e { fn next\u003c'b\u003e(\u0026'b mut self) -\u003e Option\u003c\u0026'b u8\u003e { if self.remainder.is_empty() { None } else { let byte = \u0026self.remainder[0]; self.remainder = \u0026self.remainder[1..]; Some(byte) } } } è¿™ä¸€ç‚¹å¸®åŠ©éƒ½æ²¡æœ‰ï¼Œæˆ‘ä»ç„¶æä¸æ˜ç™½ã€‚è¿™é‡Œæœ‰ä¸ªåªæœ‰Rustä¸“å®¶æ‰çŸ¥é“çš„å°çªé—¨ï¼š ç»™ä½ çš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°å–ä¸ªæœ‰æè¿°æ€§çš„åå­—ã€‚æˆ‘ä»¬å†è¯•ä¸€æ¬¡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 struct ByteIter\u003c'remainder\u003e { remainder: \u0026'remainder [u8] } impl\u003c'remainder\u003e ByteIter\u003c'remainder\u003e { fn next\u003c'mut_self\u003e(\u0026'mut_self mut self) -\u003e Option\u003c\u0026'mut_self u8\u003e { if self.remainder.is_empty() { None } else { let byte = \u0026self.remainder[0]; self.remainder = \u0026self.remainder[1..]; Some(byte) } } } æ¯ä¸ªè¿”å›çš„å­—èŠ‚éƒ½è¢«ç”¨'mut_selfæ ‡è®°äº†ï¼Œä½†è¿™äº›å­—èŠ‚æ˜¾ç„¶æ˜¯æ¥è‡ªäº'remainderçš„ï¼Œ è®©æˆ‘ä»¬æ¥æ”¹ä¸€ä¸‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 struct ByteIter\u003c'remainder\u003e { remainder: \u0026'remainder [u8] } impl\u003c'remainder\u003e ByteIter\u003c'remainder\u003e { fn next(\u0026mut self) -\u003e Option\u003c\u0026'remainder u8\u003e { if self.remainder.is_empty() { None } else { let byte = \u0026self.remainder[0]; self.remainder = \u0026self.remainder[1..]; Some(byte) } } } fn main() { let mut bytes = ByteIter { remainder: b\"1123\" }; let byte_1 = bytes.next(); let byte_2 = bytes.next(); std::mem::drop(bytes); // æˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨è¿™é‡ŒæŠŠè¿­ä»£å™¨dropæ‰ï¼ if byte_1 == byte_2 { // ç¼–è¯‘é€šè¿‡ // åšç‚¹ä»€ä¹ˆ } } ç°åœ¨è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ï¼Œæˆ‘ä»¬å‰ä¸€ç‰ˆçš„ç¨‹åºæ˜¾ç„¶æ˜¯é”™è¯¯çš„ï¼Œä½†ä¸ºä»€ä¹ˆRustä»ç„¶å…è®¸å®ƒé€šè¿‡ç¼–è¯‘å‘¢ï¼Ÿ ç­”æ¡ˆå¾ˆç®€å•ï¼šè¿™ä¹ˆåšæ˜¯å†…å­˜å®‰å…¨çš„ã€‚\nRustçš„å€Ÿç”¨æ£€æŸ¥å™¨å¯¹ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°åªè¦æ±‚åˆ°èƒ½å¤Ÿä»¥é™æ€çš„æ–¹å¼éªŒè¯ç¨‹åºçš„å†…å­˜å®‰å…¨ã€‚ Rustä¼šçˆ½å¿«åœ°ç¼–è¯‘ä¸€ä¸ªç¨‹åºï¼Œå³ä½¿å®ƒçš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°æœ‰è¯­ä¹‰ä¸Šçš„é”™è¯¯ï¼Œ è¿™å¸¦æ¥çš„ç»“æœå°±æ˜¯ç¨‹åºä¼šå˜å¾—è¿‡äºå—é™ã€‚\næ¥çœ‹ä¸€ä¸ªä¸å‰ä¸€ä¸ªç›¸åçš„ä¾‹å­ï¼šRustçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™æ°å¥½åœ¨è¿™ä¸ªä¾‹å­ä¸Šè¯­ä¹‰æ˜¯æ­£ç¡®çš„ï¼Œ ä½†æˆ‘ä»¬å´æ— æ„ä¸­ç”¨äº†ä¸€äº›å¤šä½™çš„æ˜¾å¼ç”Ÿå‘½å‘¨æœŸæ ‡è®°å†™äº†ä¸ªéå¸¸å—é™çš„æ–¹æ³•ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 #[derive(Debug)] struct NumRef\u003c'a\u003e(\u0026'a i32); impl\u003c'a\u003e NumRef\u003c'a\u003e { // æˆ‘çš„ç»“æ„ä½“æ˜¯åœ¨'aä¸Šæ³›å‹çš„ï¼Œæ‰€ä»¥æˆ‘åŒæ ·ä¹Ÿè¦ // æ ‡è®°ä¸€ä¸‹æˆ‘çš„selfå‚æ•°ï¼Œå¯¹å—ï¼Ÿï¼ˆç­”æ¡ˆæ˜¯ï¼šä¸ï¼Œä¸å¯¹ï¼‰ fn some_method(\u0026'a mut self) {} } fn main() { let mut num_ref = NumRef(\u00265); num_ref.some_method(); // å¯å˜å€Ÿç”¨num_refç›´åˆ°å®ƒå‰©ä½™çš„ç”Ÿå‘½å‘¨æœŸç»“æŸ num_ref.some_method(); // ç¼–è¯‘é”™è¯¯ println!(\"{:?}\", num_ref); // åŒæ ·ç¼–è¯‘é”™è¯¯ } å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªåœ¨ â€˜a ä¸Šçš„æ³›å‹ï¼Œæˆ‘ä»¬å‡ ä¹æ°¸è¿œä¸ä¼šæƒ³è¦å†™ä¸€ä¸ªæ¥æ”¶\u0026'a mut selfçš„æ–¹æ³•ã€‚ å› ä¸ºè¿™æ„å‘³ç€æˆ‘ä»¬å‘Šè¯‰Rustï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå¯å˜å€Ÿç”¨è¿™ä¸ªç»“æ„ä½“ç›´åˆ°æ•´ä¸ªç»“æ„ä½“ç”Ÿå‘½å‘¨æœŸç»“æŸã€‚ è¿™ä¹Ÿå°±å‘Šè¯‰Rustçš„å€Ÿç”¨æ£€æŸ¥å™¨æœ€å¤šåªå…è®¸ some_method è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œ åœ¨è¿™ä¹‹åè¿™ä¸ªç»“æ„ä½“å°†ä¼šè¢«æ°¸ä¹…æ€§åœ°å¯å˜å€Ÿç”¨èµ°ï¼Œä¹Ÿå°±å˜å¾—ä¸å¯ç”¨äº†ã€‚ è¿™æ ·çš„ç”¨ä¾‹éå¸¸éå¸¸å°‘ï¼Œä½†å¤„äºå›°æƒ‘ä¸­çš„åˆå­¦è€…éå¸¸å®¹æ˜“å†™å‡ºè¿™ç§ä»£ç ï¼Œå¹¶èƒ½é€šè¿‡ç¼–è¯‘ã€‚ æ­£ç¡®çš„åšæ³•æ˜¯ä¸è¦æ·»åŠ è¿™äº›å¤šä½™çš„æ˜¾å¼ç”Ÿå‘½å‘¨æœŸæ ‡è®°ï¼Œè®©Rustçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™æ¥å¤„ç†å®ƒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 #[derive(Debug)] struct NumRef\u003c'a\u003e(\u0026'a i32); impl\u003c'a\u003e NumRef\u003c'a\u003e { // å»æ‰mut selfå‰é¢çš„'a fn some_method(\u0026mut self) {} // ä¸Šä¸€æ®µä»£ç è„±æ‰è¯­æ³•ç³–åå˜ä¸º fn some_method_desugared\u003c'b\u003e(\u0026'b mut self){} } fn main() { let mut num_ref = NumRef(\u00265); num_ref.some_method(); num_ref.some_method(); // ç¼–è¯‘é€šè¿‡ println!(\"{:?}\", num_ref); // ç¼–è¯‘é€šè¿‡ } è¦ç‚¹:\nRustçš„å‡½æ•°ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™å¹¶ä¸æ€»æ˜¯å¯¹æ‰€æœ‰æƒ…å†µéƒ½æ­£ç¡®çš„ Rustå¯¹ä½ çš„ç¨‹åºçš„è¯­ä¹‰äº†è§£å¹¶ä¸æ¯”ä½ å¤š ç»™ä½ çš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°èµ·ä¸€ä¸ªæ›´æœ‰æè¿°æ€§çš„åå­— åœ¨ä½ ä½¿ç”¨æ˜¾å¼ç”Ÿå‘½å‘¨æœŸæ ‡è®°çš„æ—¶å€™è¦æƒ³æ¸…æ¥šå®ƒä»¬åº”è¯¥è¢«ç”¨åœ¨å“ªä»¥åŠä¸ºä»€ä¹ˆè¦è¿™ä¹ˆç”¨ è¯¯è§£6: è£…ç®±çš„traitå¯¹è±¡æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸ æ—©å‰æˆ‘ä»¬è®¨è®ºäº†Rustå¯¹å‡½æ•°çš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ã€‚RuståŒæ ·æœ‰ç€å¯¹äºtraitå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ï¼Œå®ƒä»¬æ˜¯ï¼š\nå¦‚æœä¸€ä¸ªtraitå¯¹è±¡ä½œä¸ºä¸€ä¸ªç±»å‹å‚æ•°ä¼ é€’åˆ°æ³›å‹ä¸­ï¼Œé‚£ä¹ˆå®ƒçš„ç”Ÿå‘½çº¦æŸä¼šä»å®ƒåŒ…å«çš„ç±»å‹ä¸­æ¨æ–­ å¦‚æœåŒ…å«çš„ç±»å‹ä¸­æœ‰å”¯ä¸€çš„çº¦æŸï¼Œé‚£ä¹ˆå°±ä½¿ç”¨è¿™ä¸ªçº¦æŸã€‚ å¦‚æœåŒ…å«çš„ç±»å‹ä¸­æœ‰è¶…è¿‡ä¸€ä¸ªçº¦æŸï¼Œé‚£ä¹ˆå¿…é¡»æ˜¾å¼æŒ‡å®šçº¦æŸã€‚ å¦‚æœä»¥ä¸Šéƒ½ä¸é€‚ç”¨ï¼Œé‚£ä¹ˆï¼š\nå¦‚æœtraitæ˜¯ä»¥å•ä¸ªç”Ÿå‘½å‘¨æœŸçº¦æŸå®šä¹‰çš„ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨è¿™ä¸ªçº¦æŸ å¦‚æœæ‰€æœ‰ç”Ÿå‘½å‘¨æœŸçº¦æŸéƒ½æ˜¯ â€˜static çš„ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ â€˜static ä½œä¸ºçº¦æŸ å¦‚æœtraitæ²¡æœ‰ç”Ÿå‘½å‘¨æœŸçº¦æŸï¼Œé‚£ä¹ˆå®ƒçš„ç”Ÿå‘½å‘¨æœŸå°†ä¼šä»è¡¨è¾¾å¼ä¸­æ¨æ–­ï¼Œå¦‚æœä¸åœ¨è¡¨è¾¾å¼ä¸­ï¼Œé‚£ä¹ˆå°±æ˜¯ â€˜static çš„ è¿™ä¹ˆå¤šä¸œè¥¿å¬èµ·æ¥è¶…çº§å¤æ‚ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç®€å•åœ°æ€»ç»“ä¸º â€œtraitå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸçº¦æŸæ˜¯ä»ä¸Šä¸‹æ–‡ä¸­æ¨æ–­å‡ºæ¥çš„ã€‚â€ åœ¨æˆ‘ä»¬çœ‹è¿‡å‡ ä¸ªä¾‹å­åï¼Œæˆ‘ä»¬ä¼šå‘ç°ç”Ÿå‘½å‘¨æœŸçº¦æŸæ¨æ–­å…¶å®æ˜¯å¾ˆç¬¦åˆç›´è§‰çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å»è®°è¿™äº›å¾ˆæ­£å¼çš„è§„åˆ™ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 use std::cell::Ref; trait Trait {} // çœç•¥ type T1 = Box\u003cdyn Trait\u003e; // å±•å¼€ï¼ŒBoxå¯¹Tæ²¡æœ‰ç”Ÿå‘½å‘¨æœŸçº¦æŸï¼Œæ‰€ä»¥è¢«æ¨æ–­ä¸º'static type T2 = Box\u003cdyn Trait + 'static\u003e; // çœç•¥ impl dyn Trait {} // å±•å¼€ impl dyn Trait + 'static {} // çœç•¥ type T3\u003c'a\u003e = \u0026'a dyn Trait; // å±•å¼€, å› ä¸º\u0026'a T è¦æ±‚ T: 'a, æ‰€ä»¥æ¨æ–­ä¸º 'a type T4\u003c'a\u003e = \u0026'a (dyn Trait + 'a); // çœç•¥ type T5\u003c'a\u003e = Ref\u003c'a, dyn Trait\u003e; // å±•å¼€, å› ä¸ºRef\u003c'a, T\u003e è¦æ±‚ T: 'a, æ‰€ä»¥æ¨æ–­ä¸º 'a type T6\u003c'a\u003e = Ref\u003c'a, dyn Trait + 'a\u003e; trait GenericTrait\u003c'a\u003e: 'a {} // çœç•¥ type T7\u003c'a\u003e = Box\u003cdyn GenericTrait\u003c'a\u003e\u003e; // å±•å¼€ type T8\u003c'a\u003e = Box\u003cdyn GenericTrait\u003c'a\u003e + 'a\u003e; // çœç•¥ impl\u003c'a\u003e dyn GenericTrait\u003c'a\u003e {} // å±•å¼€ impl\u003c'a\u003e dyn GenericTrait\u003c'a\u003e + 'a {} å®ç°äº†æŸä¸ªtraitçš„å…·ä½“çš„ç±»å‹å¯ä»¥åŒ…å«å¼•ç”¨ï¼Œå› æ­¤å®ƒä»¬åŒæ ·æ‹¥æœ‰ç”Ÿå‘½å‘¨æœŸçº¦æŸï¼Œä¸”å¯¹åº”çš„traitå¯¹è±¡ä¹Ÿæœ‰ç”Ÿå‘½å‘¨æœŸçº¦æŸã€‚ ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä¸ºå¼•ç”¨å®ç°traitï¼Œè€Œå¼•ç”¨æ˜¾ç„¶æœ‰ç”Ÿå‘½å‘¨æœŸçº¦æŸã€‚\n1 2 3 4 5 6 7 8 trait Trait {} struct Struct {} struct Ref\u003c'a, T\u003e(\u0026'a T); impl Trait for Struct {} impl Trait for \u0026Struct {} // ç›´æ¥åœ¨å¼•ç”¨ç±»å‹ä¸Šå®ç°Trait impl\u003c'a, T\u003e Trait for Ref\u003c'a, T\u003e {} // åœ¨åŒ…å«å¼•ç”¨çš„ç±»å‹ä¸Šå®ç°Trait ä¸ç®¡æ€æ ·ï¼Œè¿™éƒ½å€¼å¾—æˆ‘ä»¬ä»”ç»†ç ”ç©¶ï¼Œå› ä¸ºæ–°æ‰‹ä»¬ç»å¸¸åœ¨å°†ä¸€ä¸ªä½¿ç”¨traitå¯¹è±¡çš„å‡½æ•°é‡æ„æˆä½¿ç”¨æ³›å‹çš„å‡½æ•°ï¼ˆæˆ–è€…åè¿‡æ¥ï¼‰çš„æ—¶å€™æ„Ÿåˆ°å›°æƒ‘ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªä¾‹å­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 use std::fmt::Display; fn dynamic_thread_print(t: Box\u003cdyn Display + Send\u003e) { std::thread::spawn(move || { println!(\"{}\", t); }).join(); } fn static_thread_print\u003cT: Display + Send\u003e(t: T) { std::thread::spawn(move || { println!(\"{}\", t); }).join(); } è¿™ä¼šæŠ›å‡ºä¸‹é¢çš„ç¼–è¯‘é”™è¯¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 error[E0310]: the parameter type `T` may not live long enough --\u003e src/lib.rs:10:5 | 9 | fn static_thread_print\u003cT: Display + Send\u003e(t: T) { | -- help: consider adding an explicit lifetime bound...: `T: 'static +` 10 | std::thread::spawn(move || { | ^^^^^^^^^^^^^^^^^^ | note: ...so that the type `[closure@src/lib.rs:10:24: 12:6 t:T]` will meet its required lifetime bounds --\u003e src/lib.rs:10:5 | 10 | std::thread::spawn(move || { | ^^^^^^^^^^^^^^^^^^ å¾ˆå¥½ï¼Œç¼–è¯‘å™¨å‘Šè¯‰äº†æˆ‘ä»¬æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¥è¯•è¯•ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 use std::fmt::Display; fn dynamic_thread_print(t: Box\u003cdyn Display + Send\u003e) { std::thread::spawn(move || { println!(\"{}\", t); }).join(); } fn static_thread_print\u003cT: Display + Send + 'static\u003e(t: T) { std::thread::spawn(move || { println!(\"{}\", t); }).join(); } ç¼–è¯‘é€šè¿‡ï¼Œä½†è¿™ä¸¤ä¸ªå‡½æ•°æ”¾åœ¨ä¸€å—å„¿çœ‹èµ·æ¥æœ‰ç‚¹æ€ªï¼Œä¸ºä»€ä¹ˆç¬¬äºŒä¸ªå‡½æ•°å¯¹ T æœ‰ â€˜static çº¦æŸï¼Œè€Œç¬¬ä¸€ä¸ªæ²¡æœ‰ï¼Ÿ è¿™ä¸ªé—®é¢˜å¾ˆåˆé’»ã€‚æ ¹æ®ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ï¼ŒRustè‡ªåŠ¨ä¸ºç¬¬ä¸€ä¸ªå‡½æ•°æ¨æ–­å‡º â€˜static çº¦æŸï¼Œæ‰€ä»¥ä¸¤ä¸ªå‡½æ•°å®é™…ä¸Šéƒ½æœ‰ â€˜static çº¦æŸã€‚ åœ¨Rustç¼–è¯‘å™¨çš„çœ¼ä¸­æ˜¯è¿™æ ·çš„ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 use std::fmt::Display; fn dynamic_thread_print(t: Box\u003cdyn Display + Send + 'static\u003e) { std::thread::spawn(move || { println!(\"{}\", t); }).join(); } fn static_thread_print\u003cT: Display + Send + 'static\u003e(t: T) { std::thread::spawn(move || { println!(\"{}\", t); }).join(); } è¦ç‚¹:\næ‰€æœ‰traitå¯¹è±¡éƒ½æœ‰ç€é»˜è®¤æ¨æ–­çš„ç”Ÿå‘½å‘¨æœŸçº¦æŸ è¯¯è§£7: ç¼–è¯‘å™¨æŠ¥é”™ä¿¡æ¯ä¼šå‘Šè¯‰æˆ‘æ€ä¹ˆä¿®æ”¹æˆ‘çš„ä»£ç  è¯¯è§£æ¨è®º\nRustç¼–è¯‘å™¨å¯¹äºtrait objectsçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™æ€»æ˜¯å¯¹çš„ Rustç¼–è¯‘å™¨æ¯”æˆ‘æ›´æ‡‚æˆ‘ä»£ç çš„è¯­ä¹‰ è¿™ä¸ªè¯¯è§£æ˜¯å‰ä¸¤ä¸ªè¯¯è§£çš„åˆäºŒä¸ºä¸€çš„ä¾‹å­ï¼š\n1 2 3 4 5 use std::fmt::Display; fn box_displayable\u003cT: Display\u003e(t: T) -\u003e Box\u003cdyn Display\u003e { Box::new(t) } æŠ›å‡ºå¦‚ä¸‹é”™è¯¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 error[E0310]: the parameter type `T` may not live long enough --\u003e src/lib.rs:4:5 | 3 | fn box_displayable\u003cT: Display\u003e(t: T) -\u003e Box\u003cdyn Display\u003e { | -- help: consider adding an explicit lifetime bound...: `T: 'static +` 4 | Box::new(t) | ^^^^^^^^^^^ | note: ...so that the type `T` will meet its required lifetime bounds --\u003e src/lib.rs:4:5 | 4 | Box::new(t) | ^^^^^^^^^^^ å¥½å§ï¼Œè®©æˆ‘ä»¬ç…§ç€ç¼–è¯‘å™¨å‘Šè¯‰æˆ‘ä»¬çš„æ–¹å¼ä¿®æ”¹å®ƒï¼Œåˆ«åœ¨æ„è¿™ç§æ”¹æ³•åŸºäºäº†ä¸€ä¸ªæ²¡æœ‰å‘ŠçŸ¥çš„äº‹å®ï¼š ç¼–è¯‘å™¨è‡ªåŠ¨ä¸ºæˆ‘ä»¬çš„boxed trait objectæ¨æ–­äº†ä¸€ä¸ªâ€™staticçš„ç”Ÿå‘½å‘¨æœŸçº¦æŸã€‚\n1 2 3 4 5 use std::fmt::Display; fn box_displayable\u003cT: Display + 'static\u003e(t: T) -\u003e Box\u003cdyn Display\u003e { Box::new(t) } ç°åœ¨ç¼–è¯‘é€šè¿‡äº†ï¼Œä½†è¿™çœŸçš„æ˜¯æˆ‘ä»¬æƒ³è¦çš„å—ï¼Ÿå¯èƒ½æ˜¯ï¼Œä¹Ÿå¯èƒ½ä¸æ˜¯ï¼Œç¼–è¯‘å»å¹¶æ²¡æœ‰å‘Šè¯‰æˆ‘ä»¬å…¶å®ƒè§£å†³æ–¹æ³• ä½†è¿™ä¸ªä¹Ÿè®¸åˆé€‚ã€‚\n1 2 3 4 5 use std::fmt::Display; fn box_displayable\u003c'a, T: Display + 'a\u003e(t: T) -\u003e Box\u003cdyn Display + 'a\u003e { Box::new(t) } è¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°å’Œå‰ä¸€ä¸ªç‰ˆæœ¬ä¸€æ ·ï¼Œä½†å¤šäº†ä¸å°‘ä¸œè¥¿ã€‚è¿™æ ·å†™èƒ½è®©å®ƒæ›´å¥½å—ï¼Ÿä¸ä¸€å®šï¼Œ è¿™å–å†³äºæˆ‘ä»¬çš„ç¨‹åºçš„è¦æ±‚å’Œçº¦æŸã€‚è¿™ä¸ªä¾‹å­æœ‰äº›æŠ½è±¡ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æ›´ç®€å•æ˜äº†çš„æƒ…å†µã€‚\n1 2 3 fn return_first(a: \u0026str, b: \u0026str) -\u003e \u0026str { a } æŠ¥é”™:\n1 2 3 4 5 6 7 8 9 10 11 error[E0106]: missing lifetime specifier --\u003e src/lib.rs:1:38 | 1 | fn return_first(a: \u0026str, b: \u0026str) -\u003e \u0026str { | ---- ---- ^ expected named lifetime parameter | = help: this function's return type contains a borrowed value, but the signature does not say whether it is borrowed from `a` or `b` help: consider introducing a named lifetime parameter | 1 | fn return_first\u003c'a\u003e(a: \u0026'a str, b: \u0026'a str) -\u003e \u0026'a str { | ^^^^ ^^^^^^^ ^^^^^^^ ^^^ è¿™ä¸ªé”™è¯¯ä¿¡æ¯å»ºè®®æˆ‘ä»¬ç»™è¾“å…¥å’Œè¾“å‡ºæ‰“ä¸Šç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°ã€‚ è¿™ä¹ˆåšè™½ç„¶èƒ½ä½¿å¾—ç¼–è¯‘é€šè¿‡ï¼Œä½†å´è¿‡åº¦é™åˆ¶äº†è¿”å›ç±»å‹ã€‚ æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„æ˜¯è¿™ä¸ªï¼š\n1 2 3 fn return_first\u003c'a\u003e(a: \u0026'a str, b: \u0026str) -\u003e \u0026'a str { a } è¦ç‚¹:\nRustå¯¹trait objectçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™å¹¶ä¸æ˜¯åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½æ­£ç¡®ã€‚ Rustä¸è§å¾—æ¯”ä½ æ›´æ‡‚ä½ ä»£ç çš„è¯­ä¹‰ã€‚ Rustç¼–è¯‘é”™è¯¯ä¿¡æ¯ç»™å‡ºçš„ä¿®æ”¹å»ºè®®å¯èƒ½èƒ½è®©ä½ çš„ä»£ç ç¼–è¯‘é€šè¿‡ï¼Œä½†è¿™ä¸ä¸€å®šæ˜¯æœ€ç¬¦åˆä½ çš„è¦æ±‚çš„ã€‚ è¯¯è§£8: ç”Ÿå‘½å‘¨æœŸå¯ä»¥åœ¨è¿è¡Œæ—¶å˜é•¿ç¼©çŸ­ è¯¯è§£æ¨è®º\nå®¹å™¨ç±»å‹å¯ä»¥é€šè¿‡æ›´æ¢å¼•ç”¨åœ¨è¿è¡Œæ—¶æ›´æ”¹è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ Rustçš„å€Ÿç”¨æ£€æŸ¥ä¼šè¿›è¡Œæ·±å…¥çš„æ§åˆ¶æµåˆ†æ è¿™è¿‡ä¸äº†ç¼–è¯‘ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 struct Has\u003c'lifetime\u003e { lifetime: \u0026'lifetime str, } fn main() { let long = String::from(\"long\"); let mut has = Has { lifetime: \u0026long }; assert_eq!(has.lifetime, \"long\"); { let short = String::from(\"short\"); // æ¢æˆçŸ­ç”Ÿå‘½å‘¨æœŸ has.lifetime = \u0026short; assert_eq!(has.lifetime, \"short\"); // æ¢å›é•¿ç”Ÿå‘½å‘¨æœŸï¼ˆå¹¶ä¸è¡Œï¼‰ has.lifetime = \u0026long; assert_eq!(has.lifetime, \"long\"); // `short`åœ¨è¿™é‡Œææ„ } // ç¼–è¯‘é”™è¯¯ï¼Œ`short`åœ¨ææ„åä»å¤„äºå€Ÿç”¨çŠ¶æ€ assert_eq!(has.lifetime, \"long\"); } æŠ¥é”™ï¼š\n1 2 3 4 5 6 7 8 9 10 error[E0597]: `short` does not live long enough --\u003e src/main.rs:11:24 | 11 | has.lifetime = \u0026short; | ^^^^^^ borrowed value does not live long enough ... 15 | } | - `short` dropped here while still borrowed 16 | assert_eq!(has.lifetime, \"long\"); | --------------------------------- borrow later used here ä¸‹é¢è¿™ä¸ªä»£ç åŒæ ·è¿‡ä¸äº†ç¼–è¯‘ï¼ŒæŠ¥çš„é”™å’Œä¸Šé¢ä¸€æ ·ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 struct Has\u003c'lifetime\u003e { lifetime: \u0026'lifetime str, } fn main() { let long = String::from(\"long\"); let mut has = Has { lifetime: \u0026long }; assert_eq!(has.lifetime, \"long\"); // è¿™ä¸ªä»£ç å—ä¸ä¼šè¢«æ‰§è¡Œ if false { let short = String::from(\"short\"); // æ¢æˆçŸ­ç”Ÿå‘½å‘¨æœŸ has.lifetime = \u0026short; assert_eq!(has.lifetime, \"short\"); // æ¢å›é•¿ç”Ÿå‘½å‘¨æœŸï¼ˆå¹¶ä¸è¡Œï¼‰ has.lifetime = \u0026long; assert_eq!(has.lifetime, \"long\"); // `short`åœ¨è¿™é‡Œææ„ } // ä»æ—§ç¼–è¯‘é”™è¯¯ï¼Œ`short`åœ¨ææ„åä»å¤„äºå€Ÿç”¨çŠ¶æ€ assert_eq!(has.lifetime, \"long\"); } ç”Ÿå‘½å‘¨æœŸåªä¼šåœ¨ç¼–è¯‘æœŸè¢«é™æ€éªŒè¯ï¼Œå¹¶ä¸”Rustçš„å€Ÿç”¨æ£€æŸ¥åªèƒ½åšåˆ°åŸºæœ¬çš„æ§åˆ¶æµåˆ†æï¼Œ å®ƒå‡è®¾æ¯ä¸ªif-elseä¸­çš„ä»£ç å—å’Œmatchçš„æ¯ä¸ªåˆ†æ”¯éƒ½ä¼šè¢«æ‰§è¡Œï¼Œ å¹¶ä¸”å…¶ä¸­çš„æ¯ä¸€ä¸ªå˜é‡éƒ½èƒ½è¢«æŒ‡å®šä¸€ä¸ªæœ€çŸ­çš„ç”Ÿå‘½å‘¨æœŸã€‚ ä¸€æ—¦å˜é‡è¢«æŒ‡å®šäº†ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œå®ƒå°±ä¸€ç›´å—åˆ°è¿™ä¸ªç”Ÿå‘½å‘¨æœŸçº¦æŸã€‚å˜é‡çš„ç”Ÿå‘½å‘¨æœŸåªèƒ½ç¼©çŸ­ï¼Œ å¹¶ä¸”æ‰€æœ‰ç¼©çŸ­éƒ½ä¼šåœ¨ç¼–è¯‘å™¨è¢«ç¡®å®šã€‚\nè¦ç‚¹:\nç”Ÿå‘½å‘¨æœŸæ˜¯åœ¨ç¼–è¯‘æœŸé™æ€éªŒè¯çš„ ç”Ÿå‘½å‘¨æœŸä¸èƒ½åœ¨è¿è¡Œæ—¶å˜é•¿ã€ç¼©çŸ­æˆ–è€…æ”¹å˜ Rustçš„å€Ÿç”¨æ£€æŸ¥æ€»æ˜¯ä¼šä¸ºæ‰€æœ‰å˜é‡æŒ‡å®šä¸€ä¸ªæœ€çŸ­å¯èƒ½çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”å‡å®šæ‰€æœ‰ä»£ç è·¯å¾„éƒ½ä¼šè¢«æ‰§è¡Œ è¯¯è§£9: å°†å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨æ˜¯å®‰å…¨çš„ è¯¯è§£æ¨è®º\né‡æ–°å€Ÿç”¨ä¸€ä¸ªå¼•ç”¨ä¼šç»ˆæ­¢å®ƒçš„ç”Ÿå‘½å‘¨æœŸå¹¶ä¸”å¼€å§‹ä¸€ä¸ªæ–°çš„ ä½ å¯ä»¥å‘ä¸€ä¸ªæ¥æ”¶å…±äº«å¼•ç”¨çš„å‡½æ•°ä¼ é€’ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œå› ä¸ºRustä¼šéšå¼å°†å¯å˜å¼•ç”¨é‡æ–°å€Ÿç”¨ä¸ºä¸å¯å˜å¼•ç”¨ï¼š\n1 2 3 4 5 6 7 fn takes_shared_ref(n: \u0026i32) {} fn main() { let mut a = 10; takes_shared_ref(\u0026mut a); // ç¼–è¯‘é€šè¿‡ takes_shared_ref(\u0026*(\u0026mut a)); // ä¸Šä¸€è¡Œçš„æ˜¾å¼å†™æ³• } ç›´è§‰ä¸Šè¿™æ²¡é—®é¢˜ï¼Œå°†ä¸€ä¸ªå¯å˜å¼•ç”¨é‡æ–°å€Ÿç”¨ä¸ºä¸å¯å˜å¼•ç”¨ï¼Œåº”è¯¥ä¸ä¼šæœ‰ä»€ä¹ˆå®³å¤„ä¸æ˜¯å—ï¼Ÿ ç„¶è€Œå¹¶éå¦‚æ­¤ï¼Œä¸‹é¢çš„ä»£ç è¿‡ä¸äº†ç¼–è¯‘ã€‚\n1 2 3 4 5 6 fn main() { let mut a = 10; let b: \u0026i32 = \u0026*(\u0026mut a); // é‡æ–°å€Ÿç”¨ä¸ºä¸å¯å˜ let c: \u0026i32 = \u0026a; dbg!(b, c); // ç¼–è¯‘é”™è¯¯ } æŠ¥é”™ï¼š\n1 2 3 4 5 6 7 8 9 error[E0502]: cannot borrow `a` as immutable because it is also borrowed as mutable --\u003e src/main.rs:4:19 | 3 | let b: \u0026i32 = \u0026*(\u0026mut a); | -------- mutable borrow occurs here 4 | let c: \u0026i32 = \u0026a; | ^^ immutable borrow occurs here 5 | dbg!(b, c); | - mutable borrow later used here å¯å˜å€Ÿç”¨å‡ºç°åç«‹å³é‡æ–°å€Ÿç”¨ä¸ºä¸å¯å˜å¼•ç”¨ï¼Œç„¶åå¯å˜å¼•ç”¨è‡ªèº«ææ„ã€‚ ä¸ºä»€ä¹ˆRustä¼šè®¤ä¸ºè¿™ä¸ªä¸å¯å˜çš„é‡æ–°å€Ÿç”¨ä»å…·æœ‰å¯å˜å¼•ç”¨çš„ç‹¬å ç”Ÿå‘½å‘¨æœŸï¼Ÿ è™½ç„¶ä¸Šé¢è¿™ä¸ªä¾‹å­æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å…è®¸å°†å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨å®é™…ä¸Šå¼•å…¥äº†æ½œåœ¨çš„å†…å­˜å®‰å…¨é—®é¢˜ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 use std::sync::Mutex; struct Struct { mutex: Mutex\u003cString\u003e } impl Struct { // å°†selfçš„å¯å˜å¼•ç”¨é™çº§ä¸ºstrçš„å…±äº«å¼•ç”¨ fn get_string(\u0026mut self) -\u003e \u0026str { self.mutex.get_mut().unwrap() } fn mutate_string(\u0026self) { // å¦‚æœRustå…è®¸å°†å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨ï¼Œ // é‚£ä¹ˆä¸‹é¢è¿™è¡Œä»£ç ä¼šä½¿å¾—æ‰€æœ‰ä»get_stringä¸­å¾—åˆ°çš„å…±äº«å¼•ç”¨å¤±æ•ˆ *self.mutex.lock().unwrap() = \"surprise!\".to_owned(); } } fn main() { let mut s = Struct { mutex: Mutex::new(\"string\".to_owned()) }; let str_ref = s.get_string(); // å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨ s.mutate_string(); // str_refå¤±æ•ˆï¼Œå˜ä¸ºæ‚¬ç©ºæŒ‡é’ˆ dbg!(str_ref); // ç¼–è¯‘é”™è¯¯ï¼Œå’Œæˆ‘ä»¬é¢„æœŸçš„ä¸€æ · } è¿™é‡Œçš„é—®é¢˜åœ¨äºï¼Œå½“ä½ å°†ä¸€ä¸ªå¯å˜å¼•ç”¨é‡æ–°å€Ÿç”¨ä¸ºå…±äº«å¼•ç”¨ï¼Œä½ ä¼šé‡åˆ°ä¸€ç‚¹éº»çƒ¦ï¼š å³ä½¿å¯å˜å¼•ç”¨å·²ç»ææ„ï¼Œé‡æ–°å€Ÿç”¨å‡ºæ¥çš„å…±äº«å¼•ç”¨è¿˜æ˜¯ä¼šå°†å¯å˜å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿åˆ°å’Œè‡ªå·±ä¸€æ ·é•¿ã€‚ è¿™ç§é‡æ–°å€Ÿç”¨å‡ºæ¥çš„å…±äº«å¼•ç”¨éå¸¸éš¾ç”¨ï¼Œå› ä¸ºå®ƒä¸èƒ½ä¸å…¶å®ƒå…±äº«å¼•ç”¨å…±å­˜ã€‚ å®ƒæœ‰ç€å¯å˜å¼•ç”¨å’Œä¸å¯å˜å¼•ç”¨çš„æ‰€æœ‰ç¼ºç‚¹ï¼Œå´æ²¡æœ‰å®ƒä»¬å„è‡ªçš„ä¼˜ç‚¹ã€‚ æˆ‘è®¤ä¸ºå°†å¯å˜å¼•ç”¨é‡æ–°å€Ÿç”¨ä¸ºå…±äº«å¼•ç”¨åº”è¯¥è¢«è®¤ä¸ºæ˜¯Rustçš„åæ¨¡å¼ï¼ˆanti-pattern)ã€‚ å¯¹è¿™ç§åæ¨¡å¼ä¿æŒè­¦æƒ•å¾ˆé‡è¦ï¼Œè¿™å¯ä»¥è®©ä½ åœ¨çœ‹åˆ°ä¸‹é¢è¿™æ ·çš„ä»£ç çš„æ—¶å€™æ›´å®¹æ˜“å‘ç°å®ƒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 // å°†Tçš„å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨ fn some_function\u003cT\u003e(some_arg: \u0026mut T) -\u003e \u0026T; struct Struct; impl Struct { // å°†selfçš„å¯å˜å¼•ç”¨é™çº§ä¸ºselfå…±äº«å¼•ç”¨ fn some_method(\u0026mut self) -\u003e \u0026self; // å°†selfçš„å¯å˜å¼•ç”¨é™çº§ä¸ºTçš„å…±äº«å¼•ç”¨ fn other_method(\u0026mut self) -\u003e \u0026T; } å³ä½¿ä½ é¿å…äº†å‡½æ•°å’Œæ–¹æ³•ç­¾åä¸­çš„é‡æ–°å€Ÿç”¨ï¼ŒRustä»ç„¶ä¼šè‡ªåŠ¨éšå¼é‡æ–°å€Ÿç”¨ï¼Œ æ‰€ä»¥å¾ˆå®¹æ˜“æ— æ„ä¸­é‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 use std::collections::HashMap; type PlayerID = i32; #[derive(Debug, Default)] struct Player { score: i32, } fn start_game(player_a: PlayerID, player_b: PlayerID, server: \u0026mut HashMap\u003cPlayerID, Player\u003e) { // ä»æœåŠ¡å™¨ä¸­è·å–playerï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºå¹¶æ’å…¥ä¸€ä¸ªæ–°çš„ let player_a: \u0026Player = server.entry(player_a).or_default(); let player_b: \u0026Player = server.entry(player_b).or_default(); // ç”¨playeråšç‚¹ä»€ä¹ˆ dbg!(player_a, player_b); // ç¼–è¯‘é”™è¯¯ } ä¸Šé¢çš„ä»£ç ç¼–è¯‘å¤±è´¥ã€‚å› ä¸º or_default() è¿”å›ä¸€ä¸ª \u0026mut Playerï¼Œ è€Œæˆ‘ä»¬çš„æ˜¾å¼ç±»å‹æ ‡æ³¨ \u0026Player ä½¿å¾—è¿™ä¸ª \u0026mut Player è¢«éšå¼é‡æ–°å€Ÿç”¨ä¸º \u0026Player ã€‚ ä¸ºäº†é€šè¿‡ç¼–è¯‘ï¼Œæˆ‘ä»¬ä¸å¾—ä¸è¿™æ ·å†™ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 use std::collections::HashMap; type PlayerID = i32; #[derive(Debug, Default)] struct Player { score: i32, } fn start_game(player_a: PlayerID, player_b: PlayerID, server: \u0026mut HashMap\u003cPlayerID, Player\u003e) { // å› ä¸ºæˆ‘ä»¬ä¸èƒ½æŠŠå®ƒä»¬æ”¾åœ¨ä¸€èµ·ç”¨ï¼Œæ‰€ä»¥è¿™é‡ŒæŠŠè¿”å›çš„Playerå¯å˜å¼•ç”¨ææ„æ‰ server.entry(player_a).or_default(); server.entry(player_b).or_default(); // å†æ¬¡è·å–è¿™äº›Playerï¼Œè¿™æ¬¡ä»¥ä¸å¯å˜çš„æ–¹å¼ï¼Œé¿å…å‡ºç°éšå¼é‡æ–°å€Ÿç”¨ let player_a = server.get(\u0026player_a); let player_b = server.get(\u0026player_b); // ç”¨Playeråšç‚¹ä»€ä¹ˆ dbg!(player_a, player_b); // ç¼–è¯‘é€šè¿‡ } è™½ç„¶æœ‰ç‚¹å°´å°¬å’Œç¬¨é‡ï¼Œä½†è¿™ä¹Ÿç®—æ˜¯ä¸ºå†…å­˜å®‰å…¨åšå‡ºçš„ç‰ºç‰²ã€‚\nè¦ç‚¹:\nå°½é‡ä¸è¦æŠŠå¯å˜å¼•ç”¨é‡æ–°å€Ÿç”¨ä¸ºå…±äº«å¼•ç”¨ï¼Œä¸ç„¶ä½ ä¼šé‡åˆ°ä¸å°‘éº»çƒ¦ é‡æ–°å€Ÿç”¨ä¸€ä¸ªå¯å˜å¼•ç”¨ä¸ä¼šä½¿å¾—å®ƒçš„ç”Ÿå‘½å‘¨æœŸç»ˆç»“ï¼Œå³ä½¿è¿™ä¸ªå¯å˜å¼•ç”¨å·²ç»ææ„ è¯¯è§£10: é—­åŒ…éµå¾ªå’Œå‡½æ•°ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ æ¯”èµ·è¯¯è§£ï¼Œè¿™æ›´åƒæ˜¯Rustçš„ä¸€ä¸ªå°é™·é˜±ã€‚\né—­åŒ…ï¼Œè™½ç„¶ä¹Ÿæ˜¯ä¸ªå‡½æ•°ï¼Œä½†æ˜¯å®ƒå¹¶ä¸éµå¾ªå’Œå‡½æ•°ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ã€‚\n1 2 3 4 5 6 7 fn function(x: \u0026i32) -\u003e \u0026i32 { x } fn main() { let closure = |x: \u0026i32| x; } æŠ¥é”™ï¼š\n1 2 3 4 5 6 7 8 error: lifetime may not live long enough --\u003e src/main.rs:6:29 | 6 | let closure = |x: \u0026i32| x; | - - ^ returning this value requires that `'1` must outlive `'2` | | | | | return type of closure is \u0026'2 i32 | let's call the lifetime of this reference `'1` å»æ‰è¯­æ³•ç³–åï¼š\n1 2 3 4 5 6 7 8 9 10 // è¾“å…¥çš„ç”Ÿå‘½å‘¨æœŸåº”ç”¨åˆ°è¾“å‡ºä¸Š fn function\u003c'a\u003e(x: \u0026'a i32) -\u003e \u0026'a i32 { x } fn main() { // è¾“å…¥å’Œè¾“å‡ºæœ‰å®ƒä»¬è‡ªå·±ç‹¬æœ‰çš„ç”Ÿå‘½å‘¨æœŸ let closure = for\u003c'a, 'b\u003e |x: \u0026'a i32| -\u003e \u0026'b i32 { x }; // æ³¨æ„ï¼šä¸Šé¢è¿™è¡Œä»£ç ä¸æ˜¯åˆæ³•çš„è¯­æ³•ï¼Œä½†å¯ä»¥è¡¨è¾¾å‡ºæˆ‘ä»¬çš„æ„æ€ } å‡ºç°è¿™ç§å·®å¼‚å¹¶æ²¡æœ‰ä¸€ä¸ªå¥½çš„ç†ç”±ã€‚é—­åŒ…æœ€æ—©çš„å®ç°ç”¨çš„ç±»å‹æ¨æ–­è¯­ä¹‰å’Œå‡½æ•°ä¸åŒï¼Œ ç°åœ¨å˜å¾—æ²¡æ³•æ”¹äº†ï¼Œå› ä¸ºå°†å®ƒä»¬ç»Ÿä¸€èµ·æ¥ä¼šé€ æˆä¸€ä¸ªä¸å…¼å®¹çš„æ”¹åŠ¨ã€‚ é‚£ä¹ˆæˆ‘ä»¬è¦æ€ä¹ˆæ ·æ˜¾å¼æ ‡æ³¨é—­åŒ…çš„ç±»å‹å‘¢ï¼Ÿæˆ‘ä»¬å¯é€‰çš„åŠæ³•æœ‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 fn main() { // è½¬æˆtrait objectï¼Œå˜æˆä¸å®šé•¿ç±»å‹ï¼Œç¼–è¯‘é”™è¯¯ let identity: dyn Fn(\u0026i32) -\u003e \u0026i32 = |x: \u0026i32| x; // å¯ä»¥é€šè¿‡å°†å®ƒåˆ†é…åœ¨å †ä¸Šæ¥ç»•è¿‡è¿™ä¸ªé”™è¯¯ï¼Œä½†è¿™æ ·å¾ˆç¬¨é‡ let identity: Box\u003cdyn Fn(\u0026i32) -\u003e \u0026i32\u003e = Box::new(|x: \u0026i32| x); // ä¹Ÿå¯ä»¥è·³è¿‡åˆ†é…ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªé™æ€çš„å¼•ç”¨ let identity: \u0026dyn Fn(\u0026i32) -\u003e \u0026i32 = \u0026|x: \u0026i32| x; // ä¸Šä¸€è¡Œå»æ‰è¯­æ³•ç³–ä¹‹å:) let identity: \u0026'static (dyn for\u003c'a\u003e Fn(\u0026'a i32) -\u003e \u0026'a i32 + 'static) = \u0026|x: \u0026i32| -\u003e \u0026i32 { x }; // ç†æƒ³ä¸­çš„å†™æ³•æ˜¯è¿™æ ·çš„ï¼Œä½†è¿™ä¸æ˜¯æœ‰æ•ˆçš„è¯­æ³• let identity: impl Fn(\u0026i32) -\u003e \u0026i32 = |x: \u0026i32| x; // è¿™æ ·ä¹Ÿä¸é”™ï¼Œä½†ä¹Ÿä¸æ˜¯æœ‰æ•ˆçš„è¯­æ³• let identity = for\u003c'a\u003e |x: \u0026'a i32| -\u003e \u0026'a i32 { x }; // \"impl trait\"å¯ä»¥å†™åœ¨å‡½æ•°è¿”å›çš„ä½ç½®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™æ ·å†™ fn return_identity() -\u003e impl Fn(\u0026i32) -\u003e \u0026i32 { |x| x } let identity = return_identity(); // å‰ä¸€ç§è§£å†³æ–¹æ¡ˆæ›´æ³›åŒ–çš„å†™æ³• fn annotate\u003cT, F\u003e(f: F) -\u003e F where F: Fn(\u0026T) -\u003e \u0026T { f } let identity = annotate(|x: \u0026i32| x); } ç›¸ä¿¡ä½ å·²ç»æ³¨æ„åˆ°ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå½“é—­åŒ…ç±»å‹ä½¿ç”¨traitçº¦æŸçš„æ—¶å€™ä¼šéµå¾ªä¸€èˆ¬å‡½æ•°çš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ã€‚\nè¿™é‡Œæ²¡æœ‰ä»€ä¹ˆçœŸæ­£çš„æ•™è®­å’Œæ´å¯Ÿï¼Œåªæ˜¯å®ƒå°±æ˜¯è¿™æ ·çš„è€Œå·²ã€‚\nè¦ç‚¹:\næ¯ä¸€é—¨è¯­è¨€éƒ½æœ‰è‡ªå·±çš„å°é™·é˜± ğŸ¤· è¯¯è§£11: â€˜static å¼•ç”¨æ€»èƒ½å¼ºåˆ¶è½¬æ¢ä¸º â€˜a å¼•ç”¨ æˆ‘å‰é¢ç»™å‡ºäº†è¿™ä¸ªä¾‹å­ï¼š\n1 2 fn get_str\u003c'a\u003e() -\u003e \u0026'a str; // æ³›å‹ç‰ˆæœ¬ fn get_str() -\u003e \u0026'static str; // 'staticç‰ˆæœ¬ æœ‰çš„è¯»è€…é—®æˆ‘è¿™ä¸¤ä¸ªåœ¨å®è·µä¸­æ˜¯å¦æœ‰åŒºåˆ«ã€‚ä¸€å¼€å§‹æˆ‘ä¹Ÿä¸å¤ªç¡®å®šï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œ åœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„ç ”ç©¶ä¹‹åæˆ‘å‘ç°å®ƒä»¬åœ¨å®è·µä¸­ç¡®å®å­˜åœ¨ç€åŒºåˆ«ã€‚\næ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨æ“ä½œå€¼å¾—æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ â€˜static å¼•ç”¨æ¥æ›¿æ¢ â€˜a å¼•ç”¨ï¼Œ å› ä¸ºRustä¼šè‡ªåŠ¨å°† â€˜static å¼•ç”¨å¼ºåˆ¶è½¬æ¢åˆ° â€˜a å¼•ç”¨ã€‚ ç›´è§‰ä¸Šæ¥è®²ï¼Œè¿™æ²¡æ¯›ç—…ï¼Œåœ¨ä¸€ä¸ªè¦æ±‚è¾ƒçŸ­ç”Ÿå‘½å‘¨æœŸå¼•ç”¨çš„åœ°æ–¹ä½¿ç”¨ä¸€ä¸ªæœ‰ç€æ›´é•¿çš„ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨ä¸ä¼šé€ æˆå†…å­˜å®‰å…¨é—®é¢˜ã€‚ ä¸‹é¢çš„ä»£ç å’Œæˆ‘ä»¬æƒ³çš„ä¸€æ ·ç¼–è¯‘é€šè¿‡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 use rand; fn generic_str_fn\u003c'a\u003e() -\u003e \u0026'a str { \"str\" } fn static_str_fn() -\u003e \u0026'static str { \"str\" } fn a_or_b\u003cT\u003e(a: T, b: T) -\u003e T { if rand::random() { a } else { b } } fn main() { let some_string = \"string\".to_owned(); let some_str = \u0026some_string[..]; let str_ref = a_or_b(some_str, generic_str_fn()); // ç¼–è¯‘é€šè¿‡ let str_ref = a_or_b(some_str, static_str_fn()); // ç¼–è¯‘é€šè¿‡ } ç„¶è€Œï¼Œè¿™ç§å¼ºåˆ¶è½¬æ¢å¹¶ä¸ä¼šåœ¨å¼•ç”¨ä½œä¸ºå‡½æ•°çš„ç±»å‹ç­¾åçš„ä¸€éƒ¨åˆ†çš„æ—¶å€™å‡ºç°ï¼Œæ‰€ä»¥ä¸‹é¢è¿™æ®µä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 use rand; fn generic_str_fn\u003c'a\u003e() -\u003e \u0026'a str { \"str\" } fn static_str_fn() -\u003e \u0026'static str { \"str\" } fn a_or_b_fn\u003cT, F\u003e(a: T, b_fn: F) -\u003e T where F: Fn() -\u003e T { if rand::random() { a } else { b_fn() } } fn main() { let some_string = \"string\".to_owned(); let some_str = \u0026some_string[..]; let str_ref = a_or_b_fn(some_str, generic_str_fn); // ç¼–è¯‘é€šè¿‡ let str_ref = a_or_b_fn(some_str, static_str_fn); // ç¼–è¯‘é”™è¯¯ } æŠ¥é”™ï¼š\n1 2 3 4 5 6 7 8 9 10 error[E0597]: `some_string` does not live long enough --\u003e src/main.rs:23:21 | 23 | let some_str = \u0026some_string[..]; | ^^^^^^^^^^^ borrowed value does not live long enough ... 25 | let str_ref = a_or_b_fn(some_str, static_str_fn); | ---------------------------------- argument requires that `some_string` is borrowed for `'static` 26 | } | - `some_string` dropped here while still borrowed è¿™ç®—ä¸ç®—Rustçš„å°é™·é˜±è¿˜æœ‰å¾…å•†æ¦·ï¼Œå› ä¸ºè¿™ä¸æ˜¯ \u0026â€˜static str åˆ° \u0026â€˜a str ç®€å•ç›´æ¥çš„å¼ºåˆ¶è½¬æ¢ï¼Œ è€Œæ˜¯ for Fn() -\u003e \u0026â€˜static T åˆ° for\u003câ€˜a, T\u003e Fn() -\u003e \u0026â€˜a T è¿™ç§æ›´å¤æ‚çš„æƒ…å†µã€‚ å‰è€…æ˜¯å€¼ä¹‹é—´çš„å¼ºåˆ¶è½¬æ¢ï¼Œåè€…æ˜¯ç±»å‹ä¹‹é—´çš„å¼ºåˆ¶è½¬æ¢ã€‚\nè¦ç‚¹:\nç­¾åä¸º for\u003câ€˜a, T\u003e Fn() -\u003e \u0026â€˜a T çš„å‡½æ•°è¦æ¯”ç­¾åä¸º for fn() -\u003e \u0026â€˜static T çš„å‡½æ•°æ›´ä¸ºçµæ´»ï¼Œå¹¶ä¸”èƒ½ç”¨åœ¨æ›´å¤šåœºæ™¯ä¸‹ æ€»ç»“: T æ˜¯ \u0026T å’Œ \u0026mut T çš„è¶…é›† \u0026T å’Œ \u0026mut T æ˜¯ä¸ç›¸äº¤çš„é›†åˆ T: â€˜static åº”è¯¥è¢«è¯»ä½œ â€œT å— â€˜static ç”Ÿå‘½å‘¨æœŸçº¦æŸâ€ å¦‚æœ T: â€˜static é‚£ä¹ˆ T å¯ä»¥æ˜¯ä¸€ä¸ªæœ‰ç€ â€˜static ç”Ÿå‘½å‘¨æœŸçš„å€Ÿç”¨ç±»å‹ï¼Œæˆ–æ˜¯ä¸€ä¸ªæ‰€æœ‰æƒç±»å‹ æ—¢ç„¶ T: â€˜static åŒ…å«äº†æ‰€æœ‰æƒç±»å‹ï¼Œé‚£ä¹ˆæ„å‘³ç€ T å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ†é… ä¸å¿…åœ¨æ•´ä¸ªç¨‹åºä¸­éƒ½æ˜¯æœ‰æ•ˆçš„ å¯ä»¥è¢«å®‰å…¨åœ°ä»»æ„ä¿®æ”¹ å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ææ„ å¯ä»¥æœ‰ä¸åŒé•¿åº¦çš„ç”Ÿå‘½å‘¨æœŸ T: â€˜a æ¯” \u0026â€˜a T æ›´æ³›åŒ–ã€çµæ´» T: â€˜a æ¥æ”¶æ‰€æœ‰æƒç±»å‹ã€å¸¦å¼•ç”¨çš„æ‰€æœ‰æƒç±»å‹ï¼Œä»¥åŠå¼•ç”¨ \u0026â€˜a T åªæ¥æ”¶å¼•ç”¨ å¦‚æœ T: â€˜static é‚£ä¹ˆ T: â€˜aï¼Œå› ä¸ºå¯¹äºæ‰€æœ‰ â€˜a éƒ½æœ‰ â€˜static \u003e= â€˜a å‡ ä¹æ‰€æœ‰Rustä»£ç éƒ½æ˜¯æ³›å‹çš„ï¼Œåˆ°å¤„éƒ½æœ‰çœç•¥çš„ç”Ÿå‘½å‘¨æœŸ Rustçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™å¹¶ä¸æ˜¯åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å¯¹ Rustå¹¶ä¸æ¯”ä½ æ›´äº†è§£ä½ ç¨‹åºçš„è¯­ä¹‰ ç»™ç”Ÿå‘½å‘¨æœŸæ ‡è®°èµ·ä¸€ä¸ªæœ‰æè¿°æ€§çš„åå­— è€ƒè™‘æ¸…æ¥šå“ªé‡Œéœ€è¦æ˜¾å¼å†™å‡ºç”Ÿå‘½å‘¨æœŸæ ‡è®°ï¼Œä»¥åŠä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå†™ æ‰€æœ‰trait objectéƒ½æœ‰é»˜è®¤æ¨æ–­çš„ç”Ÿå‘½å‘¨æœŸçº¦æŸ Rustçš„ç¼–è¯‘é”™è¯¯ä¿¡æ¯å¯ä»¥è®©ä½ çš„ä»£ç é€šè¿‡ç¼–è¯‘ï¼Œä½†ä¸ä¸€å®šæ˜¯æœ€ç¬¦åˆä½ ä»£ç è¦æ±‚çš„ ç”Ÿå‘½å‘¨æœŸæ˜¯åœ¨ç¼–è¯‘æœŸé™æ€éªŒè¯çš„ ç”Ÿå‘½å‘¨æœŸä¸ä¼šä»¥ä»»ä½•æ–¹å¼åœ¨è¿è¡Œæ—¶å˜é•¿ç¼©çŸ­ Rustçš„å€Ÿç”¨æ£€æŸ¥æ€»ä¼šä¸ºæ¯ä¸ªå˜é‡é€‰æ‹©ä¸€ä¸ªæœ€çŸ­å¯èƒ½çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”å‡å®šæ¯æ¡ä»£ç è·¯å¾„éƒ½ä¼šè¢«æ‰§è¡Œ å°½é‡é¿å…å°†å¯å˜å¼•ç”¨é‡æ–°å€Ÿç”¨ä¸ºä¸å¯å˜å¼•ç”¨ï¼Œä¸ç„¶ä½ ä¼šé‡åˆ°ä¸å°‘éº»çƒ¦ é‡æ–°å€Ÿç”¨ä¸€ä¸ªå¯å˜å¼•ç”¨ä¸ä¼šç»ˆæ­¢å®ƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œå³ä½¿è¿™ä¸ªå¯å˜å¼•ç”¨å·²ç»ææ„ æ¯ä¸ªè¯­è¨€éƒ½æœ‰è‡ªå·±çš„å°é™·é˜± ","wordCount":"11138","inLanguage":"en","datePublished":"2023-09-05T17:35:54+08:00","dateModified":"2023-09-05T17:35:54+08:00","author":[{"@type":"Person","name":"Reid"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://reid00.github.io/en/posts/langs_linux/rust%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%B8%B8%E8%A7%81%E8%AF%AF%E5%8C%BA/"},"publisher":{"@type":"Organization","name":"Reid's Blog","logo":{"@type":"ImageObject","url":"https://reid00.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://reid00.github.io/en/ accesskey=h title="Reid's Blog (Alt + H)">Reid's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://reid00.github.io/en/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://reid00.github.io/en/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://reid00.github.io/en/categories/ title=Categorys><span>Categorys</span></a></li><li><a href=https://reid00.github.io/en/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://reid00.github.io/en/>Home</a>&nbsp;Â»&nbsp;<a href=https://reid00.github.io/en/posts/>Posts</a>&nbsp;Â»&nbsp;<a href=https://reid00.github.io/en/posts/langs_linux/>å­¦ä¹ çš„ç¼–ç¨‹è¯­è¨€Golangï¼ŒPythonï¼ŒRust å’ŒLinux ç›¸å…³çš„è®°å½•</a></div><h1 class=post-title>Rustç”Ÿå‘½å‘¨æœŸå¸¸è§è¯¯åŒº</h1><div class=post-description>Rustç”Ÿå‘½å‘¨æœŸå¸¸è§è¯¯åŒº</div><div class=post-meta><span title='2023-09-05 17:35:54 +0800 +0800'>2023-09-05 17:35</span>&nbsp;Â·&nbsp;23 min&nbsp;Â·&nbsp;11138 words&nbsp;Â·&nbsp;Reid</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e4%bb%8b%e7%bb%8d aria-label=ä»‹ç»>ä»‹ç»</a><ul><li><a href=#%e8%af%af%e8%a7%a3%e9%a1%b9 aria-label=è¯¯è§£é¡¹>è¯¯è§£é¡¹</a><ul><li><a href=#%e8%af%af%e8%a7%a31-t-%e5%8f%aa%e5%8c%85%e5%90%ab%e6%89%80%e6%9c%89%e6%9d%83%e7%b1%bb%e5%9e%8b aria-label="è¯¯è§£1: T åªåŒ…å«æ‰€æœ‰æƒç±»å‹">è¯¯è§£1: T åªåŒ…å«æ‰€æœ‰æƒç±»å‹</a></li><li><a href=#%e8%af%af%e8%a7%a32-%e5%a6%82%e6%9e%9c-t-static-%e9%82%a3%e4%b9%88-t-%e5%bf%85%e9%a1%bb%e5%9c%a8%e6%95%b4%e4%b8%aa%e7%a8%8b%e5%ba%8f%e8%bf%90%e8%a1%8c%e4%b8%ad%e9%83%bd%e6%98%af%e6%9c%89%e6%95%88%e7%9a%84 aria-label="è¯¯è§£2: å¦‚æœ T: &amp;lsquo;static é‚£ä¹ˆ T å¿…é¡»åœ¨æ•´ä¸ªç¨‹åºè¿è¡Œä¸­éƒ½æ˜¯æœ‰æ•ˆçš„">è¯¯è§£2: å¦‚æœ T: &lsquo;static é‚£ä¹ˆ T å¿…é¡»åœ¨æ•´ä¸ªç¨‹åºè¿è¡Œä¸­éƒ½æ˜¯æœ‰æ•ˆçš„</a></li><li><a href=#%e8%af%af%e8%a7%a33-a-t-%e5%92%8c-t-a-%e6%98%af%e7%9b%b8%e5%90%8c%e7%9a%84 aria-label="è¯¯è§£3: &amp;amp;&amp;lsquo;a T å’Œ T: &amp;lsquo;a æ˜¯ç›¸åŒçš„">è¯¯è§£3: &&lsquo;a T å’Œ T: &lsquo;a æ˜¯ç›¸åŒçš„</a></li><li><a href=#%e8%af%af%e8%a7%a34-%e6%88%91%e7%9a%84%e4%bb%a3%e7%a0%81%e6%b2%a1%e7%94%a8%e5%88%b0%e6%b3%9b%e5%9e%8b%e4%b9%9f%e4%b8%8d%e5%90%ab%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f aria-label="è¯¯è§£4: æˆ‘çš„ä»£ç æ²¡ç”¨åˆ°æ³›å‹ï¼Œä¹Ÿä¸å«ç”Ÿå‘½å‘¨æœŸ">è¯¯è§£4: æˆ‘çš„ä»£ç æ²¡ç”¨åˆ°æ³›å‹ï¼Œä¹Ÿä¸å«ç”Ÿå‘½å‘¨æœŸ</a></li><li><a href=#%e8%af%af%e8%a7%a35-%e5%a6%82%e6%9e%9c%e7%bc%96%e8%af%91%e8%83%bd%e9%80%9a%e8%bf%87%e9%82%a3%e4%b9%88%e6%88%91%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e6%a0%87%e6%b3%a8%e5%b0%b1%e6%98%af%e6%ad%a3%e7%a1%ae%e7%9a%84 aria-label="è¯¯è§£5: å¦‚æœç¼–è¯‘èƒ½é€šè¿‡ï¼Œé‚£ä¹ˆæˆ‘çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨å°±æ˜¯æ­£ç¡®çš„">è¯¯è§£5: å¦‚æœç¼–è¯‘èƒ½é€šè¿‡ï¼Œé‚£ä¹ˆæˆ‘çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨å°±æ˜¯æ­£ç¡®çš„</a></li><li><a href=#%e8%af%af%e8%a7%a36-%e8%a3%85%e7%ae%b1%e7%9a%84trait%e5%af%b9%e8%b1%a1%e6%b2%a1%e6%9c%89%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f aria-label="è¯¯è§£6: è£…ç®±çš„traitå¯¹è±¡æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸ">è¯¯è§£6: è£…ç®±çš„traitå¯¹è±¡æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸ</a></li><li><a href=#%e8%af%af%e8%a7%a37-%e7%bc%96%e8%af%91%e5%99%a8%e6%8a%a5%e9%94%99%e4%bf%a1%e6%81%af%e4%bc%9a%e5%91%8a%e8%af%89%e6%88%91%e6%80%8e%e4%b9%88%e4%bf%ae%e6%94%b9%e6%88%91%e7%9a%84%e4%bb%a3%e7%a0%81 aria-label="è¯¯è§£7: ç¼–è¯‘å™¨æŠ¥é”™ä¿¡æ¯ä¼šå‘Šè¯‰æˆ‘æ€ä¹ˆä¿®æ”¹æˆ‘çš„ä»£ç ">è¯¯è§£7: ç¼–è¯‘å™¨æŠ¥é”™ä¿¡æ¯ä¼šå‘Šè¯‰æˆ‘æ€ä¹ˆä¿®æ”¹æˆ‘çš„ä»£ç </a></li><li><a href=#%e8%af%af%e8%a7%a38-%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e5%8f%af%e4%bb%a5%e5%9c%a8%e8%bf%90%e8%a1%8c%e6%97%b6%e5%8f%98%e9%95%bf%e7%bc%a9%e7%9f%ad aria-label="è¯¯è§£8: ç”Ÿå‘½å‘¨æœŸå¯ä»¥åœ¨è¿è¡Œæ—¶å˜é•¿ç¼©çŸ­">è¯¯è§£8: ç”Ÿå‘½å‘¨æœŸå¯ä»¥åœ¨è¿è¡Œæ—¶å˜é•¿ç¼©çŸ­</a></li><li><a href=#%e8%af%af%e8%a7%a39-%e5%b0%86%e5%8f%af%e5%8f%98%e5%bc%95%e7%94%a8%e9%99%8d%e7%ba%a7%e4%b8%ba%e5%85%b1%e4%ba%ab%e5%bc%95%e7%94%a8%e6%98%af%e5%ae%89%e5%85%a8%e7%9a%84 aria-label="è¯¯è§£9: å°†å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨æ˜¯å®‰å…¨çš„">è¯¯è§£9: å°†å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨æ˜¯å®‰å…¨çš„</a></li><li><a href=#%e8%af%af%e8%a7%a310-%e9%97%ad%e5%8c%85%e9%81%b5%e5%be%aa%e5%92%8c%e5%87%bd%e6%95%b0%e7%9b%b8%e5%90%8c%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e7%9c%81%e7%95%a5%e8%a7%84%e5%88%99 aria-label="è¯¯è§£10: é—­åŒ…éµå¾ªå’Œå‡½æ•°ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™">è¯¯è§£10: é—­åŒ…éµå¾ªå’Œå‡½æ•°ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™</a></li><li><a href=#%e8%af%af%e8%a7%a311-static-%e5%bc%95%e7%94%a8%e6%80%bb%e8%83%bd%e5%bc%ba%e5%88%b6%e8%bd%ac%e6%8d%a2%e4%b8%ba-a-%e5%bc%95%e7%94%a8 aria-label="è¯¯è§£11: &amp;lsquo;static å¼•ç”¨æ€»èƒ½å¼ºåˆ¶è½¬æ¢ä¸º &amp;lsquo;a å¼•ç”¨">è¯¯è§£11: &lsquo;static å¼•ç”¨æ€»èƒ½å¼ºåˆ¶è½¬æ¢ä¸º &lsquo;a å¼•ç”¨</a></li></ul></li></ul></li><li><a href=#%e6%80%bb%e7%bb%93 aria-label=æ€»ç»“:>æ€»ç»“:</a></li></ul></div></details></div><div class=post-content><h1 id=ä»‹ç»>ä»‹ç»<a hidden class=anchor aria-hidden=true href=#ä»‹ç»>#</a></h1><p>æˆ‘æ›¾ç»æœ‰è¿‡çš„æ‰€æœ‰è¿™äº›å¯¹ç”Ÿå‘½å‘¨æœŸçš„è¯¯è§£ï¼Œç°åœ¨æœ‰å¾ˆå¤šåˆå­¦è€…ä¹Ÿæ·±é™·äºæ­¤ã€‚ æˆ‘ç”¨åˆ°çš„æœ¯è¯­å¯èƒ½ä¸æ˜¯æ ‡å‡†çš„ï¼Œæ‰€ä»¥ä¸‹é¢åˆ—äº†ä¸€ä¸ªè¡¨æ ¼æ¥è§£é‡Šå®ƒä»¬çš„ç”¨æ„ã€‚</p><table><thead><tr><th style=text-align:left>çŸ­è¯­</th><th style=text-align:left>æ„ä¸º</th></tr></thead><tbody><tr><td style=text-align:left>T</td><td style=text-align:left>åŒ…å«äº†æ‰€æœ‰å¯èƒ½ç±»å‹çš„é›†åˆ æˆ– è¿™ä¸ªé›†åˆä¸­çš„ç±»å‹</td></tr><tr><td style=text-align:left>æ‰€æœ‰æƒç±»å‹</td><td style=text-align:left>ä¸å«å¼•ç”¨çš„ç±»å‹, ä¾‹å¦‚ i32, String, Vec, ç­‰</td></tr><tr><td style=text-align:left>å€Ÿç”¨ç±»å‹ æˆ– å¼•ç”¨ç±»å‹</td><td style=text-align:left>ä¸è€ƒè™‘å¯å˜æ€§çš„å¼•ç”¨ç±»å‹, ä¾‹å¦‚ &amp;i32, &amp;mut i32 ç­‰</td></tr><tr><td style=text-align:left>å¯å˜å¼•ç”¨ æˆ– ç‹¬å å¼•ç”¨</td><td style=text-align:left>ç‹¬å çš„å¯å˜å¼•ç”¨, å³ &amp;mut T</td></tr><tr><td style=text-align:left>ä¸å¯å˜å¼•ç”¨ æˆ– å…±äº«å¼•ç”¨</td><td style=text-align:left>å…±äº«çš„ä¸å¯å˜å¼•ç”¨, å³ &amp;T</td></tr></tbody></table><h2 id=è¯¯è§£é¡¹>è¯¯è§£é¡¹<a hidden class=anchor aria-hidden=true href=#è¯¯è§£é¡¹>#</a></h2><p>ç®€è€Œè¨€ä¹‹ï¼šå˜é‡çš„ç”Ÿå‘½å‘¨æœŸæŒ‡çš„æ˜¯è¿™ä¸ªå˜é‡æ‰€æŒ‡çš„æ•°æ®å¯ä»¥è¢«ç¼–è¯‘å™¨é™æ€éªŒè¯çš„ã€åœ¨å½“å‰å†…å­˜åœ°å€æœ‰æ•ˆæœŸçš„é•¿åº¦ã€‚</p><h3 id=è¯¯è§£1-t-åªåŒ…å«æ‰€æœ‰æƒç±»å‹>è¯¯è§£1: T åªåŒ…å«æ‰€æœ‰æƒç±»å‹<a hidden class=anchor aria-hidden=true href=#è¯¯è§£1-t-åªåŒ…å«æ‰€æœ‰æƒç±»å‹>#</a></h3><p>è¿™ä¸ªè¯¯è§£æ¯”èµ·è¯´ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒå’Œæ³›å‹æ›´ç›¸å…³ï¼Œä½†åœ¨Rustä¸­æ³›å‹å’Œç”Ÿå‘½å‘¨æœŸæ˜¯ç´§å¯†è”ç³»åœ¨ä¸€èµ·çš„ï¼Œä¸å¯åªè°ˆå…¶ä¸€ã€‚</p><p>å½“æˆ‘åˆšå¼€å§‹å­¦ä¹ Rustçš„æ—¶å€™ï¼Œæˆ‘ç†è§£i32ï¼Œ&amp;i32ï¼Œå’Œ&amp;mut i32æ˜¯ä¸åŒçš„ç±»å‹ï¼Œä¹Ÿæ˜ç™½æ³›å‹å˜é‡Tä»£è¡¨ç€æ‰€æœ‰å¯èƒ½ç±»å‹çš„é›†åˆã€‚ ä½†å°½ç®¡è¿™äºŒè€…åˆ†å¼€éƒ½æ‡‚ï¼Œå½“å®ƒä»¬ç»“åˆåœ¨ä¸€èµ·çš„æ—¶å€™æˆ‘å´é™·å…¥å›°æƒ‘ã€‚åœ¨æˆ‘è¿™ä¸ªRuståˆå­¦è€…çš„çœ¼ä¸­ï¼Œæ³›å‹æ˜¯è¿™æ ·çš„è¿ä½œçš„ï¼š</p><table><thead><tr><th style=text-align:left>ç±»å‹å˜é‡</th><th style=text-align:left>T</th><th style=text-align:left>&amp;T</th><th style=text-align:left>&amp;mut T</th></tr></thead><tbody><tr><td style=text-align:left>ä¾‹å­</td><td style=text-align:left>i32</td><td style=text-align:left>&amp;i32</td><td style=text-align:left>&amp;mut i32</td></tr></tbody></table><ul><li>T åŒ…å«ä¸€åˆ‡æ‰€æœ‰æƒç±»å‹ï¼›</li><li>&amp;T åŒ…å«ä¸€åˆ‡ä¸å¯å˜å€Ÿç”¨ç±»å‹ï¼›</li><li>&amp;mut T åŒ…å«ä¸€åˆ‡å¯å˜å€Ÿç”¨ç±»å‹ã€‚</li><li>Tï¼Œ &amp;Tï¼Œ å’Œ &amp;mut T æ˜¯ä¸ç›¸äº¤çš„æœ‰é™é›†ã€‚
ç®€æ´æ˜äº†ï¼Œç¬¦åˆç›´è§‰ï¼Œä½†å´å®Œå…¨é”™è¯¯ã€‚ ä¸‹é¢è¿™æ‰æ˜¯æ³›å‹çœŸæ­£çš„è¿ä½œæ–¹å¼ï¼š</li></ul><table><thead><tr><th style=text-align:left>ç±»å‹å˜é‡</th><th style=text-align:left>T</th><th style=text-align:left>&amp;T</th><th style=text-align:left>&amp;mut T</th></tr></thead><tbody><tr><td style=text-align:left>ä¾‹å­</td><td style=text-align:left>i32, &amp;i32, &amp;mut i32, &&amp;i32, &amp;mut &amp;mut i32, &mldr;</td><td style=text-align:left>&amp;i32, &&amp;i32, &&amp;mut i32, &mldr;</td><td style=text-align:left>&amp;mut i32, &amp;mut &amp;mut i32, &amp;mut &amp;i32, &mldr;</td></tr></tbody></table><ul><li>T, &amp;T, å’Œ &amp;mut T éƒ½æ˜¯æ— é™é›†, å› ä¸ºä½ å¯ä»¥æ— é™å€Ÿç”¨ä¸€ä¸ªç±»å‹ã€‚</li><li>T æ˜¯ &amp;T å’Œ &amp;mut Tçš„è¶…é›†.</li><li>&amp;T å’Œ &amp;mut T æ˜¯ä¸ç›¸äº¤çš„é›†åˆã€‚</li></ul><p>è®©æˆ‘ä»¬ç”¨å‡ ä¸ªä¾‹å­æ¥æ£€éªŒä¸€ä¸‹è¿™äº›æ¦‚å¿µ:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>trait</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=o>&amp;</span><span class=n>T</span><span class=w> </span><span class=p>{}</span><span class=w> </span><span class=c1>// ç¼–è¯‘é”™è¯¯
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=p>{}</span><span class=w> </span><span class=c1>// ç¼–è¯‘é”™è¯¯
</span></span></span></code></pre></td></tr></table></div></div><p>ä¸Šé¢çš„ä»£ç å¹¶ä¸èƒ½å¦‚æ„¿ç¼–è¯‘:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=n>error</span><span class=p>[</span><span class=n>E0119</span><span class=p>]</span>: <span class=nc>conflicting</span><span class=w> </span><span class=n>implementations</span><span class=w> </span><span class=n>of</span><span class=w> </span><span class=k>trait</span><span class=w> </span><span class=err>`</span><span class=n>Trait</span><span class=err>`</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=k>type</span> <span class=err>`</span><span class=o>&amp;</span><span class=n>_</span><span class=err>`</span>:
</span></span><span class=line><span class=cl> <span class=o>-</span>-&gt; <span class=nc>src</span><span class=o>/</span><span class=n>lib</span><span class=p>.</span><span class=n>rs</span>:<span class=mi>5</span>:<span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>impl</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=o>-------------------</span><span class=w> </span><span class=n>first</span><span class=w> </span><span class=n>implementation</span><span class=w> </span><span class=n>here</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>4</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>5</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>impl</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=o>&amp;</span><span class=n>T</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=o>^^^^^^^^^^^^^^^^^^^^</span><span class=w> </span><span class=n>conflicting</span><span class=w> </span><span class=n>implementation</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=err>`</span><span class=o>&amp;</span><span class=n>_</span><span class=err>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>error</span><span class=p>[</span><span class=n>E0119</span><span class=p>]</span>: <span class=nc>conflicting</span><span class=w> </span><span class=n>implementations</span><span class=w> </span><span class=n>of</span><span class=w> </span><span class=k>trait</span><span class=w> </span><span class=err>`</span><span class=n>Trait</span><span class=err>`</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=k>type</span> <span class=err>`</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>_</span><span class=err>`</span>:
</span></span><span class=line><span class=cl> <span class=o>-</span>-&gt; <span class=nc>src</span><span class=o>/</span><span class=n>lib</span><span class=p>.</span><span class=n>rs</span>:<span class=mi>7</span>:<span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>impl</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=o>-------------------</span><span class=w> </span><span class=n>first</span><span class=w> </span><span class=n>implementation</span><span class=w> </span><span class=n>here</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>..</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>7</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>impl</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=o>^^^^^^^^^^^^^^^^^^^^^^^^</span><span class=w> </span><span class=n>conflicting</span><span class=w> </span><span class=n>implementation</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=err>`</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>_</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ç¼–è¯‘å™¨ä¸å…è®¸æˆ‘ä»¬ä¸º&amp;Tå’Œ&amp;mut Tå®ç°Traitï¼Œå› ä¸ºè¿™æ ·ä¼šä¸ä¸ºTå®ç°çš„Traitå†²çªï¼Œ <code>Tæœ¬èº«å·²ç»åŒ…å«äº†æ‰€æœ‰&amp;Tå’Œ&amp;mut T</code>ã€‚ä¸‹é¢çš„ä»£ç èƒ½å¤Ÿå¦‚æ„¿ç¼–è¯‘ï¼Œå› ä¸º&amp;Tå’Œ&amp;mut Tæ˜¯ä¸ç›¸äº¤çš„ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>trait</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=o>&amp;</span><span class=n>T</span><span class=w> </span><span class=p>{}</span><span class=w> </span><span class=c1>// ç¼–è¯‘é€šè¿‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>T</span><span class=w> </span><span class=p>{}</span><span class=w> </span><span class=c1>// ç¼–è¯‘é€šè¿‡
</span></span></span></code></pre></td></tr></table></div></div><p><code>è¦ç‚¹:</code></p><ul><li>T æ˜¯ &amp;T å’Œ &amp;mut Tçš„è¶…é›†</li><li>&amp;T å’Œ &amp;mut T æ˜¯ä¸ç›¸äº¤çš„é›†åˆ</li></ul><h3 id=è¯¯è§£2-å¦‚æœ-t-static-é‚£ä¹ˆ-t-å¿…é¡»åœ¨æ•´ä¸ªç¨‹åºè¿è¡Œä¸­éƒ½æ˜¯æœ‰æ•ˆçš„>è¯¯è§£2: å¦‚æœ T: &lsquo;static é‚£ä¹ˆ T å¿…é¡»åœ¨æ•´ä¸ªç¨‹åºè¿è¡Œä¸­éƒ½æ˜¯æœ‰æ•ˆçš„<a hidden class=anchor aria-hidden=true href=#è¯¯è§£2-å¦‚æœ-t-static-é‚£ä¹ˆ-t-å¿…é¡»åœ¨æ•´ä¸ªç¨‹åºè¿è¡Œä¸­éƒ½æ˜¯æœ‰æ•ˆçš„>#</a></h3><p>è¯¯è§£æ¨è®º</p><ul><li>T: &lsquo;static åº”è¯¥è¢«çœ‹ä½œ " T æ‹¥æœ‰ &lsquo;static ç”Ÿå‘½å‘¨æœŸ "</li><li>&&lsquo;static T å’Œ T: &lsquo;static æ²¡æœ‰åŒºåˆ«</li><li>å¦‚æœ T: &lsquo;static é‚£ä¹ˆ T å¿…é¡»ä¸ºä¸å¯å˜çš„</li><li>å¦‚æœ T: &lsquo;static é‚£ä¹ˆ T åªèƒ½åœ¨ç¼–è¯‘æœŸåˆ›å»º</li></ul><p>å¤§éƒ¨åˆ†Ruståˆå­¦è€…æ˜¯ä»ç±»ä¼¼ä¸‹é¢è¿™ä¸ªä»£ç ç¤ºä¾‹ä¸­æ¥è§¦åˆ° &lsquo;static ç”Ÿå‘½å‘¨æœŸçš„ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>str_literal</span>: <span class=kp>&amp;</span><span class=nb>&#39;static</span> <span class=kt>str</span> <span class=o>=</span><span class=w> </span><span class=s>&#34;str literal&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ä»–ä»¬è¢«å‘ŠçŸ¥ &ldquo;str literal&rdquo; æ˜¯ç¡¬ç¼–ç åœ¨ç¼–è¯‘å‡ºæ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„ï¼Œ å¹¶ä¼šåœ¨è¿è¡Œæ—¶è¢«åŠ è½½åˆ°åªè¯»å†…å­˜ï¼Œæ‰€ä»¥å¿…é¡»æ˜¯ä¸å¯å˜çš„ä¸”åœ¨æ•´ä¸ªç¨‹åºçš„è¿è¡Œä¸­éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œ è¿™å°±æ˜¯å®ƒæˆä¸º &lsquo;static çš„åŸå› ã€‚ è€Œè¿™äº›è§‚å¿µåˆè¿›ä¸€æ­¥è¢«ç”¨ static å…³é”®å­—æ¥å®šä¹‰é™æ€å˜é‡çš„è§„åˆ™æ‰€åŠ å¼ºã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>static</span><span class=w> </span><span class=no>BYTES</span>: <span class=p>[</span><span class=kt>u8</span><span class=p>;</span><span class=w> </span><span class=mi>3</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>static</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=no>MUT_BYTES</span>: <span class=p>[</span><span class=kt>u8</span><span class=p>;</span><span class=w> </span><span class=mi>3</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=no>MUT_BYTES</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>99</span><span class=p>;</span><span class=w> </span><span class=c1>// ç¼–è¯‘é”™è¯¯ï¼Œä¿®æ”¹é™æ€å˜é‡æ˜¯unsafeçš„
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=no>MUT_BYTES</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>99</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>assert_eq!</span><span class=p>(</span><span class=mi>99</span><span class=p>,</span><span class=w> </span><span class=no>MUT_BYTES</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è®¤ä¸ºé™æ€å˜é‡</p><ul><li>åªå¯ä»¥åœ¨ç¼–è¯‘æœŸåˆ›å»º</li><li>å¿…é¡»æ˜¯ä¸å¯å˜çš„ï¼Œä¿®æ”¹å®ƒä»¬æ˜¯unsafeçš„</li><li>åœ¨æ•´ä¸ªç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­éƒ½æ˜¯æœ‰æ•ˆçš„</li></ul><p>&lsquo;static ç”Ÿå‘½å‘¨æœŸå¤§æ¦‚æ˜¯ä»¥é™æ€å˜é‡çš„é»˜è®¤ç”Ÿå‘½å‘¨æœŸå‘½åçš„ï¼Œå¯¹å§ï¼Ÿ é‚£ä¹ˆæœ‰ç†ç”±è®¤ä¸º&rsquo;staticç”Ÿå‘½å‘¨æœŸä¹Ÿåº”è¯¥éµå®ˆç›¸åŒçš„è§„åˆ™ï¼Œä¸æ˜¯å—ï¼Ÿ</p><p>æ˜¯çš„ï¼Œ<code>ä½†æ‹¥æœ‰'staticç”Ÿå‘½å‘¨æœŸçš„ç±»å‹ä¸'staticçº¦æŸçš„ç±»å‹æ˜¯ä¸åŒçš„</code>ã€‚ <code>åè€…èƒ½åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ†é…ï¼Œå¯ä»¥å®‰å…¨åœ°ã€è‡ªç”±åœ°ä¿®æ”¹ï¼Œå¯ä»¥è¢«dropï¼Œ è¿˜å¯ä»¥æœ‰ä»»æ„é•¿åº¦çš„ç”Ÿå‘½å‘¨æœŸ</code>ã€‚</p><p>åœ¨è¿™ä¸ªç‚¹ï¼Œå¾ˆé‡è¦çš„æ˜¯è¦åŒºåˆ† <code>&'static T å’Œ T: 'staticã€‚</code></p><p><code>&'static T æ˜¯å¯¹æŸä¸ªTçš„ä¸å¯å˜å¼•ç”¨ï¼Œè¿™ä¸ªå¼•ç”¨å¯ä»¥è¢«æ— é™æœŸåœ°æŒæœ‰ç›´åˆ°ç¨‹åºç»“æŸ</code>ã€‚ è¿™åªå¯èƒ½å‘ç”Ÿåœ¨<code>Tæœ¬èº«ä¸å¯å˜ä¸”ä¸ä¼šåœ¨å¼•ç”¨è¢«åˆ›å»ºåç§»åŠ¨çš„æƒ…å†µä¸‹</code>ã€‚ <strong>Tå¹¶ä¸éœ€è¦åœ¨ç¼–è¯‘æœŸå°±è¢«åˆ›å»º</strong>ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆéšæœºæ•°æ®ï¼Œ ç„¶åä»¥å†…å­˜æ³„æ¼ä¸ºä»£ä»·è¿”å›&rsquo;staticå¼•ç”¨ï¼Œä¾‹å¦‚ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>rand</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// åœ¨è¿è¡Œæ—¶ç”Ÿæˆéšæœº&amp;&#39;static str
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>rand_str_generator</span><span class=p>()</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=nb>&#39;static</span> <span class=kt>str</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>rand_string</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rand</span>::<span class=n>random</span>::<span class=o>&lt;</span><span class=kt>u64</span><span class=o>&gt;</span><span class=p>().</span><span class=n>to_string</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>Box</span>::<span class=n>leak</span><span class=p>(</span><span class=n>rand_string</span><span class=p>.</span><span class=n>into_boxed_str</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><code>T: 'static æ˜¯æŒ‡Tå¯ä»¥è¢«æ— é™æœŸå®‰å…¨åœ°æŒæœ‰ç›´åˆ°ç¨‹åºç»“æŸ</code>ã€‚ T: &lsquo;staticåŒ…æ‹¬æ‰€æœ‰&&lsquo;static Tï¼Œæ­¤å¤–è¿˜åŒ…æ‹¬æ‰€æœ‰çš„æ‰€æœ‰æƒç±»å‹ï¼Œæ¯”å¦‚String, Vecç­‰ã€‚ æ•°æ®çš„æ‰€æœ‰è€…èƒ½å¤Ÿä¿è¯æ•°æ®åªè¦è¿˜è¢«æŒæœ‰å°±ä¸ä¼šå¤±æ•ˆï¼Œå› æ­¤æ‰€æœ‰è€…å¯ä»¥æ— é™æœŸå®‰å…¨åœ°æŒæœ‰è¯¥æ•°æ®ç›´åˆ°ç¨‹åºç»“æŸã€‚ <code>T: 'staticåº”è¯¥è¢«çœ‹ä½œTå—'staticç”Ÿå‘½å‘¨æœŸ "çº¦æŸ" è€Œé Tæœ‰ç€'staticç”Ÿå‘½å‘¨æœŸã€‚</code> è¿™æ®µä»£ç èƒ½å¸®æˆ‘ä»¬é˜é‡Šè¿™äº›æ¦‚å¿µï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>rand</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>drop_static</span><span class=o>&lt;</span><span class=n>T</span>: <span class=nb>&#39;static</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span>: <span class=nc>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>std</span>::<span class=n>mem</span>::<span class=nb>drop</span><span class=p>(</span><span class=n>t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>strings</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Vec</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=n>_</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>0</span><span class=o>..</span><span class=mi>10</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>rand</span>::<span class=n>random</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// æ‰€æœ‰å­—ç¬¦ä¸²éƒ½æ˜¯éšæœºç”Ÿæˆçš„
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>            </span><span class=c1>// å¹¶ä¸”æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”³è¯·çš„
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>string</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rand</span>::<span class=n>random</span>::<span class=o>&lt;</span><span class=kt>u64</span><span class=o>&gt;</span><span class=p>().</span><span class=n>to_string</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>strings</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>string</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// è¿™äº›å­—ç¬¦ä¸²éƒ½æ˜¯æ‰€æœ‰æƒç±»å‹ï¼Œæ‰€ä»¥å®ƒä»¬æ»¡è¶³&#39;staticçº¦æŸ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>string</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>strings</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// è¿™äº›å­—ç¬¦ä¸²éƒ½æ˜¯å¯ä»¥ä¿®æ”¹çš„
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=n>string</span><span class=p>.</span><span class=n>push_str</span><span class=p>(</span><span class=s>&#34;a mutation&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// è¿™äº›å­—ç¬¦ä¸²éƒ½æ˜¯å¯ä»¥è¢«dropçš„
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=n>drop_static</span><span class=p>(</span><span class=n>string</span><span class=p>);</span><span class=w> </span><span class=c1>// ç¼–è¯‘é€šè¿‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// è¿™äº›å­—ç¬¦ä¸²éƒ½åœ¨ç¨‹åºç»“æŸä¹‹å‰å¤±æ•ˆ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;i am the end of the program&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><code>è¦ç‚¹:</code></p><ul><li>T: &lsquo;static åº”è¯¥è¢«çœ‹ä½œ â€œTå—&rsquo;staticç”Ÿå‘½å‘¨æœŸçº¦æŸâ€</li><li>å¦‚æœ T: &lsquo;static é‚£ä¹ˆTå¯ä»¥æ˜¯æœ‰ç€&rsquo;staticç”Ÿå‘½å‘¨æœŸçš„å€Ÿç”¨ç±»å‹</li><li>ç”±äº T: &lsquo;static åŒ…æ‹¬äº†æ‰€æœ‰æƒç±»å‹ï¼Œè¿™æ„å‘³ç€T<ul><li>å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ†é…</li><li>ä¸ä¸€å®šè¦åœ¨æ•´ä¸ªç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­éƒ½æœ‰æ•ˆ</li><li>å¯ä»¥è¢«å®‰å…¨åœ°ã€è‡ªç”±åœ°ä¿®æ”¹</li><li>å¯ä»¥åœ¨è¿è¡Œæ—¶è¢«åŠ¨æ€dropæ‰</li><li>å¯ä»¥æœ‰ä¸åŒé•¿åº¦çš„ç”Ÿå‘½å‘¨æœŸ</li></ul></li></ul><h3 id=è¯¯è§£3-a-t-å’Œ-t-a-æ˜¯ç›¸åŒçš„>è¯¯è§£3: &&lsquo;a T å’Œ T: &lsquo;a æ˜¯ç›¸åŒçš„<a hidden class=anchor aria-hidden=true href=#è¯¯è§£3-a-t-å’Œ-t-a-æ˜¯ç›¸åŒçš„>#</a></h3><p>è¿™ä¸ªè¯¯è§£æ˜¯ä¸Šä¸€ä¸ªçš„æ³›åŒ–ç‰ˆæœ¬ã€‚</p><p>&&lsquo;a T ä¸å…‰è¦æ±‚ï¼ŒåŒæ—¶ä¹Ÿéšå«ç€ T: &lsquo;aï¼Œ å› ä¸º<code>å¦‚æœTæœ¬èº«éƒ½ä¸èƒ½åœ¨'aå†…æœ‰æ•ˆï¼Œ é‚£å¯¹Tçš„æœ‰'aç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨ä¹Ÿä¸å¯èƒ½æ˜¯æœ‰æ•ˆ</code>çš„ã€‚ ä¾‹å¦‚ï¼ŒRustç¼–è¯‘å™¨ä»æ¥ä¸ä¼šå…è®¸åˆ›å»º&&lsquo;static Ref&lt;&lsquo;a, T>è¿™ä¸ªç±»å‹ï¼Œå› ä¸ºå¦‚æœRefåªåœ¨&rsquo;aå†…æœ‰æ•ˆï¼Œæˆ‘ä»¬ä¸å¯èƒ½å¼„å‡ºä¸€ä¸ªå¯¹å®ƒçš„&rsquo;staticçš„å¼•ç”¨ã€‚</p><p><code>T: 'aåŒ…æ‹¬äº†æ‰€æœ‰&'a Tï¼Œä½†åè¿‡æ¥ä¸å¯¹ã€‚</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=c1>// åªæ¥å—ä»¥&#39;açº¦æŸçš„å¼•ç”¨ç±»å‹
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>t_ref</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=p>,</span><span class=w> </span><span class=n>T</span>: <span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=nc>T</span><span class=p>)</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// æ¥å—æ‰€æœ‰ä»¥&#39;açº¦æŸçš„ç±»å‹
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>t_bound</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=p>,</span><span class=w> </span><span class=n>T</span>: <span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span>: <span class=nc>T</span><span class=p>)</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// åŒ…å«å¼•ç”¨çš„æ‰€æœ‰æƒç±»å‹
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>struct</span> <span class=nc>Ref</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=p>,</span><span class=w> </span><span class=n>T</span>: <span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=na>&#39;a</span><span class=w> </span><span class=n>T</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>string</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;string&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>t_bound</span><span class=p>(</span><span class=o>&amp;</span><span class=n>string</span><span class=p>);</span><span class=w> </span><span class=c1>// ç¼–è¯‘é€šè¿‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>t_bound</span><span class=p>(</span><span class=n>Ref</span><span class=p>(</span><span class=o>&amp;</span><span class=n>string</span><span class=p>));</span><span class=w> </span><span class=c1>// ç¼–è¯‘é€šè¿‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>t_bound</span><span class=p>(</span><span class=o>&amp;</span><span class=n>Ref</span><span class=p>(</span><span class=o>&amp;</span><span class=n>string</span><span class=p>));</span><span class=w> </span><span class=c1>// ç¼–è¯‘é€šè¿‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>t_ref</span><span class=p>(</span><span class=o>&amp;</span><span class=n>string</span><span class=p>);</span><span class=w> </span><span class=c1>// ç¼–è¯‘é€šè¿‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>t_ref</span><span class=p>(</span><span class=n>Ref</span><span class=p>(</span><span class=o>&amp;</span><span class=n>string</span><span class=p>));</span><span class=w> </span><span class=c1>// ç¼–è¯‘é”™è¯¯, æœŸå¾…æ¥æ”¶ä¸€ä¸ªå¼•ç”¨ï¼Œä½†æ”¶åˆ°ä¸€ä¸ªç»“æ„ä½“
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>t_ref</span><span class=p>(</span><span class=o>&amp;</span><span class=n>Ref</span><span class=p>(</span><span class=o>&amp;</span><span class=n>string</span><span class=p>));</span><span class=w> </span><span class=c1>// ç¼–è¯‘é€šè¿‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// stringå˜é‡æ˜¯ä»¥&#39;staticçº¦æŸçš„ï¼Œä¹Ÿæ»¡è¶³&#39;açº¦æŸ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>t_bound</span><span class=p>(</span><span class=n>string</span><span class=p>);</span><span class=w> </span><span class=c1>// ç¼–è¯‘é€šè¿‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><code>è¦ç‚¹:</code></p><ul><li>T: &lsquo;a æ¯”èµ· &&lsquo;a Tæ›´æ³›åŒ–ä¹Ÿæ›´çµæ´»</li><li>T: &lsquo;a æ¥å—æ‰€æœ‰æƒç±»å‹ã€åŒ…å«å¼•ç”¨çš„æ‰€æœ‰æƒç±»å‹ä»¥åŠå¼•ç”¨</li><li>&&lsquo;a T åªæ¥å—å¼•ç”¨</li><li>å¦‚æœ T: &lsquo;static é‚£ä¹ˆ T: &lsquo;a, å› ä¸ºå¯¹äºæ‰€æœ‰&rsquo;aéƒ½æœ‰&rsquo;static >= &lsquo;a</li></ul><h3 id=è¯¯è§£4-æˆ‘çš„ä»£ç æ²¡ç”¨åˆ°æ³›å‹ä¹Ÿä¸å«ç”Ÿå‘½å‘¨æœŸ>è¯¯è§£4: æˆ‘çš„ä»£ç æ²¡ç”¨åˆ°æ³›å‹ï¼Œä¹Ÿä¸å«ç”Ÿå‘½å‘¨æœŸ<a hidden class=anchor aria-hidden=true href=#è¯¯è§£4-æˆ‘çš„ä»£ç æ²¡ç”¨åˆ°æ³›å‹ä¹Ÿä¸å«ç”Ÿå‘½å‘¨æœŸ>#</a></h3><p>è¯¯è§£æ¨è®º:</p><ul><li>é¿å…ä½¿ç”¨æ³›å‹å’Œç”Ÿå‘½å‘¨æœŸæ˜¯å¯èƒ½çš„</li></ul><p>è¿™ç§å®‰æ…°æ€§çš„è¯¯è§£çš„å­˜åœ¨æ˜¯ç”±äº<code>Rustçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™</code>ï¼Œ è¿™äº›è§„åˆ™è®©ä½ èƒ½å¤Ÿåœ¨å‡½æ•°ä¸­çœç•¥æ‰ç”Ÿå‘½å‘¨æœŸè®°å·ï¼Œ å› ä¸ºRustçš„å€Ÿç”¨æ£€æŸ¥å™¨èƒ½æ ¹æ®ä»¥ä¸‹è§„åˆ™å°†å®ƒä»¬æ¨å¯¼å‡ºæ¥ï¼š</p><ul><li>æ¯ä¸ªä¼ å…¥çš„å¼•ç”¨éƒ½ä¼šæœ‰ä¸€ä¸ªå•ç‹¬çš„ç”Ÿå‘½å‘¨æœŸ</li><li>å¦‚æœåªæœ‰ä¸€ä¸ªä¼ å…¥çš„ç”Ÿå‘½å‘¨æœŸï¼Œé‚£ä¹ˆå®ƒå°†è¢«åº”ç”¨åˆ°æ‰€æœ‰è¾“å‡ºçš„å¼•ç”¨ä¸Š</li><li>å¦‚æœæœ‰å¤šä¸ªä¼ å…¥çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½†å…¶ä¸­ä¸€ä¸ªæ˜¯&amp;selfæˆ–è€…&amp;mut selfï¼Œé‚£ä¹ˆè¿™ä¸ªç”Ÿå‘½å‘¨æœŸå°†ä¼šè¢«åº”ç”¨åˆ°æ‰€æœ‰è¾“å‡ºçš„å¼•ç”¨ä¸Š</li><li>é™¤æ­¤ä¹‹å¤–çš„è¾“å‡ºçš„ç”Ÿå‘½å‘¨æœŸéƒ½å¿…é¡»æ˜¾ç¤ºæ ‡æ³¨å‡ºæ¥</li></ul><p>å¦‚æœä¸€æ—¶é—´éš¾ä»¥æƒ³æ˜ç™½è¿™ä¹ˆå¤šä¸œè¥¿ï¼Œé‚£è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›ä¾‹å­ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=c1>// çœç•¥
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>print</span><span class=p>(</span><span class=n>s</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// å±•å¼€
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>print</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>(</span><span class=n>s</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// çœç•¥
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>trim</span><span class=p>(</span><span class=n>s</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=kt>str</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// å±•å¼€
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>trim</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>(</span><span class=n>s</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// ä¸åˆæ³•ï¼Œæ— æ³•ç¡®å®šè¾“å‡ºçš„ç”Ÿå‘½å‘¨æœŸï¼Œå› ä¸ºæ²¡æœ‰è¾“å…¥çš„
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>get_str</span><span class=p>()</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=kt>str</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// æ˜¾å¼çš„å†™æ³•åŒ…æ‹¬
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>get_str</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>()</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>;</span><span class=w> </span><span class=c1>// æ³›å‹ç‰ˆæœ¬
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>get_str</span><span class=p>()</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=nb>&#39;static</span> <span class=kt>str</span><span class=p>;</span><span class=w> </span><span class=c1>// &#39;static ç‰ˆæœ¬
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// ä¸åˆæ³•ï¼Œæ— æ³•ç¡®å®šè¾“å‡ºçš„ç”Ÿå‘½å‘¨æœŸï¼Œå› ä¸ºæœ‰å¤šä¸ªè¾“å…¥
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>overlap</span><span class=p>(</span><span class=n>s</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>t</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=kt>str</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// æ˜¾å¼(ä½†ä»æœ‰éƒ¨åˆ†çœç•¥)çš„å†™æ³•åŒ…æ‹¬
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>overlap</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>(</span><span class=n>s</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>t</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>;</span><span class=w> </span><span class=c1>// è¾“å‡ºç”Ÿå‘½å‘¨æœŸä¸èƒ½é•¿äºs
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>overlap</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>(</span><span class=n>s</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>t</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>;</span><span class=w> </span><span class=c1>// è¾“å‡ºç”Ÿå‘½å‘¨æœŸä¸èƒ½é•¿äºt
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>overlap</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>(</span><span class=n>s</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>t</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>;</span><span class=w> </span><span class=c1>// è¾“å‡ºç”Ÿå‘½å‘¨æœŸä¸èƒ½é•¿äºså’Œt
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>overlap</span><span class=p>(</span><span class=n>s</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>t</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=nb>&#39;static</span> <span class=kt>str</span><span class=p>;</span><span class=w> </span><span class=c1>// è¾“å‡ºç”Ÿå‘½å‘¨æœŸå¯ä»¥é•¿äºså’Œt
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>overlap</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>(</span><span class=n>s</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>t</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>;</span><span class=w> </span><span class=c1>// è¾“å…¥å’Œè¾“å‡ºçš„ç”Ÿå‘½å‘¨æœŸæ— å…³
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// å±•å¼€
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>overlap</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=p>,</span><span class=w> </span><span class=na>&#39;b</span><span class=o>&gt;</span><span class=p>(</span><span class=n>s</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>t</span>: <span class=kp>&amp;</span><span class=na>&#39;b</span> <span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>overlap</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=p>,</span><span class=w> </span><span class=na>&#39;b</span><span class=o>&gt;</span><span class=p>(</span><span class=n>s</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>t</span>: <span class=kp>&amp;</span><span class=na>&#39;b</span> <span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;b</span> <span class=kt>str</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>overlap</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>(</span><span class=n>s</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>t</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>overlap</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=p>,</span><span class=w> </span><span class=na>&#39;b</span><span class=o>&gt;</span><span class=p>(</span><span class=n>s</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>t</span>: <span class=kp>&amp;</span><span class=na>&#39;b</span> <span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=nb>&#39;static</span> <span class=kt>str</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>overlap</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=p>,</span><span class=w> </span><span class=na>&#39;b</span><span class=p>,</span><span class=w> </span><span class=na>&#39;c</span><span class=o>&gt;</span><span class=p>(</span><span class=n>s</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>t</span>: <span class=kp>&amp;</span><span class=na>&#39;b</span> <span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;c</span> <span class=kt>str</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// çœç•¥
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>compare</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>s</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=kt>str</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// å±•å¼€
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>compare</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=p>,</span><span class=w> </span><span class=na>&#39;b</span><span class=o>&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=na>&#39;a</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=na>&#39;b</span><span class=w> </span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å¦‚æœä½ æ›¾å†™è¿‡</p><ul><li>ç»“æ„ä½“æ–¹æ³•</li><li>æ¥æ”¶å¼•ç”¨çš„å‡½æ•°</li><li>è¿”å›å¼•ç”¨çš„å‡½æ•°</li><li>æ³›å‹å‡½æ•°</li><li>trait object(åé¢ä¼šæœ‰æ›´è¯¦ç»†çš„è®¨è®º)</li><li>é—­åŒ…(åé¢ä¼šæœ‰æ›´è¯¦ç»†çš„è®¨è®º)</li></ul><p>é‚£ä¹ˆä½ çš„ä»£ç å°±æœ‰è¢«çœç•¥çš„æ³›å‹ç”Ÿå‘½å‘¨æœŸè®°å·ã€‚
<code>è¦ç‚¹:</code></p><ul><li>å‡ ä¹æ‰€æœ‰Rustä»£ç éƒ½æ˜¯æ³›å‹ä»£ç ï¼Œåˆ°å¤„éƒ½æœ‰è¢«çœç•¥çš„ç”Ÿå‘½å‘¨æœŸè®°å·</li></ul><h3 id=è¯¯è§£5-å¦‚æœç¼–è¯‘èƒ½é€šè¿‡é‚£ä¹ˆæˆ‘çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨å°±æ˜¯æ­£ç¡®çš„>è¯¯è§£5: å¦‚æœç¼–è¯‘èƒ½é€šè¿‡ï¼Œé‚£ä¹ˆæˆ‘çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨å°±æ˜¯æ­£ç¡®çš„<a hidden class=anchor aria-hidden=true href=#è¯¯è§£5-å¦‚æœç¼–è¯‘èƒ½é€šè¿‡é‚£ä¹ˆæˆ‘çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨å°±æ˜¯æ­£ç¡®çš„>#</a></h3><p>è¯¯è§£æ¨è®º</p><ul><li>Rustå¯¹å‡½æ•°çš„çš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™æ€»æ˜¯æ­£ç¡®çš„</li><li>Rustçš„å€Ÿç”¨æ£€æŸ¥å™¨åœ¨æŠ€æœ¯ä¸Šå’Œè¯­ä¹‰ä¸Šæ€»æ˜¯æ­£ç¡®çš„</li><li>Rustæ¯”æˆ‘æ›´äº†è§£æˆ‘çš„ç¨‹åºçš„è¯­ä¹‰</li><li>Rustç¨‹åºæ˜¯æœ‰å¯èƒ½åœ¨æŠ€æœ¯ä¸Šèƒ½é€šè¿‡ç¼–è¯‘ï¼Œä½†è¯­ä¹‰ä¸Šä»ç„¶æ˜¯é”™çš„ã€‚æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªä¾‹å­ï¼š</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>struct</span> <span class=nc>ByteIter</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>remainder</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=p>[</span><span class=kt>u8</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=n>ByteIter</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>next</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Option</span><span class=o>&lt;&amp;</span><span class=kt>u8</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>remainder</span><span class=p>.</span><span class=n>is_empty</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>None</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>byte</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=bp>self</span><span class=p>.</span><span class=n>remainder</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=bp>self</span><span class=p>.</span><span class=n>remainder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=bp>self</span><span class=p>.</span><span class=n>remainder</span><span class=p>[</span><span class=mi>1</span><span class=o>..</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>Some</span><span class=p>(</span><span class=n>byte</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>bytes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ByteIter</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>remainder</span>: <span class=nc>b</span><span class=s>&#34;1&#34;</span><span class=w> </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>assert_eq!</span><span class=p>(</span><span class=nb>Some</span><span class=p>(</span><span class=o>&amp;</span><span class=sa>b</span><span class=sc>&#39;1&#39;</span><span class=p>),</span><span class=w> </span><span class=n>bytes</span><span class=p>.</span><span class=n>next</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>assert_eq!</span><span class=p>(</span><span class=nb>None</span><span class=p>,</span><span class=w> </span><span class=n>bytes</span><span class=p>.</span><span class=n>next</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ByteIter æ˜¯åœ¨å­—èŠ‚åˆ‡ç‰‡ä¸Šè¿­ä»£çš„è¿­ä»£å™¨ï¼Œä¸ºäº†ç®€æ´æˆ‘ä»¬è·³è¿‡å¯¹ Iterator traitçš„å®ç°ã€‚ è¿™çœ‹èµ·æ¥æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³åŒæ—¶æ£€æŸ¥å¤šä¸ªå­—èŠ‚å‘¢ï¼Ÿ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>bytes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ByteIter</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>remainder</span>: <span class=nc>b</span><span class=s>&#34;1123&#34;</span><span class=w> </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>byte_1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bytes</span><span class=p>.</span><span class=n>next</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>byte_2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bytes</span><span class=p>.</span><span class=n>next</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>byte_1</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>byte_2</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// åšç‚¹ä»€ä¹ˆ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å•Šå“¦ï¼ç¼–è¯‘é”™è¯¯ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=n>error</span><span class=p>[</span><span class=n>E0499</span><span class=p>]</span>: <span class=nc>cannot</span><span class=w> </span><span class=n>borrow</span><span class=w> </span><span class=err>`</span><span class=n>bytes</span><span class=err>`</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>mutable</span><span class=w> </span><span class=n>more</span><span class=w> </span><span class=n>than</span><span class=w> </span><span class=n>once</span><span class=w> </span><span class=n>at</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>-</span>-&gt; <span class=nc>src</span><span class=o>/</span><span class=n>main</span><span class=p>.</span><span class=n>rs</span>:<span class=mi>20</span>:<span class=mi>18</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>19</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=kd>let</span><span class=w> </span><span class=n>byte_1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bytes</span><span class=p>.</span><span class=n>next</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>|</span><span class=w>                  </span><span class=o>-----</span><span class=w> </span><span class=n>first</span><span class=w> </span><span class=n>mutable</span><span class=w> </span><span class=n>borrow</span><span class=w> </span><span class=n>occurs</span><span class=w> </span><span class=n>here</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>20</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=kd>let</span><span class=w> </span><span class=n>byte_2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bytes</span><span class=p>.</span><span class=n>next</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>|</span><span class=w>                  </span><span class=o>^^^^^</span><span class=w> </span><span class=n>second</span><span class=w> </span><span class=n>mutable</span><span class=w> </span><span class=n>borrow</span><span class=w> </span><span class=n>occurs</span><span class=w> </span><span class=n>here</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>21</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=k>if</span><span class=w> </span><span class=n>byte_1</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>byte_2</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>|</span><span class=w>        </span><span class=o>------</span><span class=w> </span><span class=n>first</span><span class=w> </span><span class=n>borrow</span><span class=w> </span><span class=n>later</span><span class=w> </span><span class=n>used</span><span class=w> </span><span class=n>here</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   
</span></span></span></code></pre></td></tr></table></div></div><p>æˆ‘è§‰å¾—æˆ‘ä»¬å¯ä»¥æ‹·è´æ¯ä¸€ä¸ªå­—èŠ‚ã€‚æ‹·è´åœ¨æˆ‘ä»¬å¤„ç†å­—èŠ‚çš„æ—¶å€™æ˜¯å¯è¡Œçš„ï¼Œ ä½†å½“æˆ‘ä»¬ä» ByteIter è½¬å‘æ³›å‹åˆ‡ç‰‡è¿­ä»£å™¨ç”¨æ¥è¿­ä»£ä»»æ„ <code>&'a [T] </code>çš„æ—¶å€™ æˆ‘ä»¬ä¹Ÿä¼šæƒ³åˆ°å°†æ¥å¯èƒ½å®ƒä¼šè¢«åº”ç”¨åˆ°é‚£äº›æ‹·è´/å…‹éš†çš„ä»£ä»·å¾ˆæ˜‚è´µæˆ–æ ¹æœ¬ä¸å¯èƒ½çš„ç±»å‹ä¸Šã€‚ å™¢ï¼Œæˆ‘æƒ³æˆ‘ä»¬å¯¹è¿™æ²¡ä»€ä¹ˆåŠæ³•ï¼Œä»£ç èƒ½è¿‡ç¼–è¯‘ï¼Œé‚£ä¹ˆç”Ÿå‘½å‘¨æœŸæ ‡è®°å¿…ç„¶æ˜¯å¯¹çš„ä¸æ˜¯å—ï¼Ÿ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>struct</span> <span class=nc>ByteIter</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>remainder</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=p>[</span><span class=kt>u8</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=n>ByteIter</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>next</span><span class=o>&lt;</span><span class=na>&#39;b</span><span class=o>&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=na>&#39;b</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Option</span><span class=o>&lt;&amp;</span><span class=na>&#39;b</span><span class=w> </span><span class=kt>u8</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>remainder</span><span class=p>.</span><span class=n>is_empty</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>None</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>byte</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=bp>self</span><span class=p>.</span><span class=n>remainder</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=bp>self</span><span class=p>.</span><span class=n>remainder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=bp>self</span><span class=p>.</span><span class=n>remainder</span><span class=p>[</span><span class=mi>1</span><span class=o>..</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>Some</span><span class=p>(</span><span class=n>byte</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è¿™ä¸€ç‚¹å¸®åŠ©éƒ½æ²¡æœ‰ï¼Œæˆ‘ä»ç„¶æä¸æ˜ç™½ã€‚è¿™é‡Œæœ‰ä¸ªåªæœ‰Rustä¸“å®¶æ‰çŸ¥é“çš„å°çªé—¨ï¼š <code>ç»™ä½ çš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°å–ä¸ªæœ‰æè¿°æ€§çš„åå­—ã€‚æˆ‘ä»¬å†è¯•ä¸€æ¬¡</code>ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>struct</span> <span class=nc>ByteIter</span><span class=o>&lt;</span><span class=na>&#39;remainder</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>remainder</span>: <span class=kp>&amp;</span><span class=na>&#39;remainder</span> <span class=p>[</span><span class=kt>u8</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=o>&lt;</span><span class=na>&#39;remainder</span><span class=o>&gt;</span><span class=w> </span><span class=n>ByteIter</span><span class=o>&lt;</span><span class=na>&#39;remainder</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>next</span><span class=o>&lt;</span><span class=na>&#39;mut_self</span><span class=o>&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=na>&#39;mut_self</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Option</span><span class=o>&lt;&amp;</span><span class=na>&#39;mut_self</span><span class=w> </span><span class=kt>u8</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>remainder</span><span class=p>.</span><span class=n>is_empty</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>None</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>byte</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=bp>self</span><span class=p>.</span><span class=n>remainder</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=bp>self</span><span class=p>.</span><span class=n>remainder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=bp>self</span><span class=p>.</span><span class=n>remainder</span><span class=p>[</span><span class=mi>1</span><span class=o>..</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>Some</span><span class=p>(</span><span class=n>byte</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æ¯ä¸ªè¿”å›çš„å­—èŠ‚éƒ½è¢«ç”¨<code>'mut_self</code>æ ‡è®°äº†ï¼Œä½†è¿™äº›å­—èŠ‚æ˜¾ç„¶æ˜¯æ¥è‡ªäº<code>'remainder</code>çš„ï¼Œ è®©æˆ‘ä»¬æ¥æ”¹ä¸€ä¸‹ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>struct</span> <span class=nc>ByteIter</span><span class=o>&lt;</span><span class=na>&#39;remainder</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>remainder</span>: <span class=kp>&amp;</span><span class=na>&#39;remainder</span> <span class=p>[</span><span class=kt>u8</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=o>&lt;</span><span class=na>&#39;remainder</span><span class=o>&gt;</span><span class=w> </span><span class=n>ByteIter</span><span class=o>&lt;</span><span class=na>&#39;remainder</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>next</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Option</span><span class=o>&lt;&amp;</span><span class=na>&#39;remainder</span><span class=w> </span><span class=kt>u8</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>remainder</span><span class=p>.</span><span class=n>is_empty</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>None</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>byte</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=bp>self</span><span class=p>.</span><span class=n>remainder</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=bp>self</span><span class=p>.</span><span class=n>remainder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=bp>self</span><span class=p>.</span><span class=n>remainder</span><span class=p>[</span><span class=mi>1</span><span class=o>..</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nb>Some</span><span class=p>(</span><span class=n>byte</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>bytes</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ByteIter</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>remainder</span>: <span class=nc>b</span><span class=s>&#34;1123&#34;</span><span class=w> </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>byte_1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bytes</span><span class=p>.</span><span class=n>next</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>byte_2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bytes</span><span class=p>.</span><span class=n>next</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>std</span>::<span class=n>mem</span>::<span class=nb>drop</span><span class=p>(</span><span class=n>bytes</span><span class=p>);</span><span class=w> </span><span class=c1>// æˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨è¿™é‡ŒæŠŠè¿­ä»£å™¨dropæ‰ï¼
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>byte_1</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>byte_2</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=c1>// ç¼–è¯‘é€šè¿‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=c1>// åšç‚¹ä»€ä¹ˆ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ç°åœ¨è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ï¼Œæˆ‘ä»¬å‰ä¸€ç‰ˆçš„ç¨‹åºæ˜¾ç„¶æ˜¯é”™è¯¯çš„ï¼Œä½†ä¸ºä»€ä¹ˆRustä»ç„¶å…è®¸å®ƒé€šè¿‡ç¼–è¯‘å‘¢ï¼Ÿ ç­”æ¡ˆå¾ˆç®€å•ï¼šè¿™ä¹ˆåšæ˜¯å†…å­˜å®‰å…¨çš„ã€‚</p><p><code>Rustçš„å€Ÿç”¨æ£€æŸ¥å™¨å¯¹ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°åªè¦æ±‚åˆ°èƒ½å¤Ÿä»¥é™æ€çš„æ–¹å¼éªŒè¯ç¨‹åºçš„å†…å­˜å®‰å…¨</code>ã€‚ Rustä¼šçˆ½å¿«åœ°ç¼–è¯‘ä¸€ä¸ªç¨‹åºï¼Œå³ä½¿å®ƒçš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°æœ‰è¯­ä¹‰ä¸Šçš„é”™è¯¯ï¼Œ è¿™å¸¦æ¥çš„ç»“æœå°±æ˜¯ç¨‹åºä¼šå˜å¾—è¿‡äºå—é™ã€‚</p><p>æ¥çœ‹ä¸€ä¸ªä¸å‰ä¸€ä¸ªç›¸åçš„ä¾‹å­ï¼šRustçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™æ°å¥½åœ¨è¿™ä¸ªä¾‹å­ä¸Šè¯­ä¹‰æ˜¯æ­£ç¡®çš„ï¼Œ ä½†æˆ‘ä»¬å´æ— æ„ä¸­ç”¨äº†ä¸€äº›å¤šä½™çš„æ˜¾å¼ç”Ÿå‘½å‘¨æœŸæ ‡è®°å†™äº†ä¸ªéå¸¸å—é™çš„æ–¹æ³•ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[derive(Debug)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>NumRef</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=na>&#39;a</span><span class=w> </span><span class=kt>i32</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=n>NumRef</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// æˆ‘çš„ç»“æ„ä½“æ˜¯åœ¨&#39;aä¸Šæ³›å‹çš„ï¼Œæ‰€ä»¥æˆ‘åŒæ ·ä¹Ÿè¦
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=c1>// æ ‡è®°ä¸€ä¸‹æˆ‘çš„selfå‚æ•°ï¼Œå¯¹å—ï¼Ÿï¼ˆç­”æ¡ˆæ˜¯ï¼šä¸ï¼Œä¸å¯¹ï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>fn</span> <span class=nf>some_method</span><span class=p>(</span><span class=o>&amp;</span><span class=na>&#39;a</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>)</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>num_ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>NumRef</span><span class=p>(</span><span class=o>&amp;</span><span class=mi>5</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>num_ref</span><span class=p>.</span><span class=n>some_method</span><span class=p>();</span><span class=w> </span><span class=c1>// å¯å˜å€Ÿç”¨num_refç›´åˆ°å®ƒå‰©ä½™çš„ç”Ÿå‘½å‘¨æœŸç»“æŸ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>num_ref</span><span class=p>.</span><span class=n>some_method</span><span class=p>();</span><span class=w> </span><span class=c1>// ç¼–è¯‘é”™è¯¯
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{:?}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>num_ref</span><span class=p>);</span><span class=w> </span><span class=c1>// åŒæ ·ç¼–è¯‘é”™è¯¯
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªåœ¨ &lsquo;a ä¸Šçš„æ³›å‹ï¼Œæˆ‘ä»¬å‡ ä¹æ°¸è¿œä¸ä¼šæƒ³è¦å†™ä¸€ä¸ªæ¥æ”¶<code>&'a mut self</code>çš„æ–¹æ³•ã€‚ å› ä¸ºè¿™æ„å‘³ç€æˆ‘ä»¬å‘Šè¯‰Rustï¼Œ<code>è¿™ä¸ªæ–¹æ³•ä¼šå¯å˜å€Ÿç”¨è¿™ä¸ªç»“æ„ä½“ç›´åˆ°æ•´ä¸ªç»“æ„ä½“ç”Ÿå‘½å‘¨æœŸç»“æŸ</code>ã€‚ è¿™ä¹Ÿå°±å‘Šè¯‰Rustçš„å€Ÿç”¨æ£€æŸ¥å™¨æœ€<code>å¤šåªå…è®¸ some_method è¢«è°ƒç”¨ä¸€æ¬¡</code>ï¼Œ åœ¨è¿™ä¹‹åè¿™ä¸ªç»“æ„ä½“å°†ä¼šè¢«æ°¸ä¹…æ€§åœ°å¯å˜å€Ÿç”¨èµ°ï¼Œä¹Ÿå°±å˜å¾—ä¸å¯ç”¨äº†ã€‚ è¿™æ ·çš„ç”¨ä¾‹éå¸¸éå¸¸å°‘ï¼Œä½†å¤„äºå›°æƒ‘ä¸­çš„åˆå­¦è€…éå¸¸å®¹æ˜“å†™å‡ºè¿™ç§ä»£ç ï¼Œå¹¶èƒ½é€šè¿‡ç¼–è¯‘ã€‚ æ­£ç¡®çš„åšæ³•æ˜¯ä¸è¦æ·»åŠ è¿™äº›å¤šä½™çš„æ˜¾å¼ç”Ÿå‘½å‘¨æœŸæ ‡è®°ï¼Œè®©Rustçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™æ¥å¤„ç†å®ƒï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#[derive(Debug)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>NumRef</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=na>&#39;a</span><span class=w> </span><span class=kt>i32</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=n>NumRef</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// å»æ‰mut selfå‰é¢çš„&#39;a
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>fn</span> <span class=nf>some_method</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>)</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ä¸Šä¸€æ®µä»£ç è„±æ‰è¯­æ³•ç³–åå˜ä¸º
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>fn</span> <span class=nf>some_method_desugared</span><span class=o>&lt;</span><span class=na>&#39;b</span><span class=o>&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=na>&#39;b</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>){}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>num_ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>NumRef</span><span class=p>(</span><span class=o>&amp;</span><span class=mi>5</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>num_ref</span><span class=p>.</span><span class=n>some_method</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>num_ref</span><span class=p>.</span><span class=n>some_method</span><span class=p>();</span><span class=w> </span><span class=c1>// ç¼–è¯‘é€šè¿‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{:?}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>num_ref</span><span class=p>);</span><span class=w> </span><span class=c1>// ç¼–è¯‘é€šè¿‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><code>è¦ç‚¹:</code></p><ul><li>Rustçš„å‡½æ•°ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™å¹¶ä¸æ€»æ˜¯å¯¹æ‰€æœ‰æƒ…å†µéƒ½æ­£ç¡®çš„</li><li>Rustå¯¹ä½ çš„ç¨‹åºçš„è¯­ä¹‰äº†è§£å¹¶ä¸æ¯”ä½ å¤š</li><li>ç»™ä½ çš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°èµ·ä¸€ä¸ªæ›´æœ‰æè¿°æ€§çš„åå­—</li><li>åœ¨ä½ ä½¿ç”¨æ˜¾å¼ç”Ÿå‘½å‘¨æœŸæ ‡è®°çš„æ—¶å€™è¦æƒ³æ¸…æ¥šå®ƒä»¬åº”è¯¥è¢«ç”¨åœ¨å“ªä»¥åŠä¸ºä»€ä¹ˆè¦è¿™ä¹ˆç”¨</li></ul><h3 id=è¯¯è§£6-è£…ç®±çš„traitå¯¹è±¡æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸ>è¯¯è§£6: è£…ç®±çš„traitå¯¹è±¡æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸ<a hidden class=anchor aria-hidden=true href=#è¯¯è§£6-è£…ç®±çš„traitå¯¹è±¡æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸ>#</a></h3><p>æ—©å‰æˆ‘ä»¬è®¨è®ºäº†Rustå¯¹å‡½æ•°çš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ã€‚RuståŒæ ·æœ‰ç€å¯¹äºtraitå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ï¼Œå®ƒä»¬æ˜¯ï¼š</p><ul><li>å¦‚æœä¸€ä¸ªtraitå¯¹è±¡ä½œä¸ºä¸€ä¸ªç±»å‹å‚æ•°ä¼ é€’åˆ°æ³›å‹ä¸­ï¼Œé‚£ä¹ˆå®ƒçš„ç”Ÿå‘½çº¦æŸä¼šä»å®ƒåŒ…å«çš„ç±»å‹ä¸­æ¨æ–­</li><li>å¦‚æœåŒ…å«çš„ç±»å‹ä¸­æœ‰å”¯ä¸€çš„çº¦æŸï¼Œé‚£ä¹ˆå°±ä½¿ç”¨è¿™ä¸ªçº¦æŸã€‚</li><li>å¦‚æœåŒ…å«çš„ç±»å‹ä¸­æœ‰è¶…è¿‡ä¸€ä¸ªçº¦æŸï¼Œé‚£ä¹ˆå¿…é¡»æ˜¾å¼æŒ‡å®šçº¦æŸã€‚</li></ul><p>å¦‚æœä»¥ä¸Šéƒ½ä¸é€‚ç”¨ï¼Œé‚£ä¹ˆï¼š</p><ul><li>å¦‚æœtraitæ˜¯ä»¥å•ä¸ªç”Ÿå‘½å‘¨æœŸçº¦æŸå®šä¹‰çš„ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨è¿™ä¸ªçº¦æŸ</li><li>å¦‚æœæ‰€æœ‰ç”Ÿå‘½å‘¨æœŸçº¦æŸéƒ½æ˜¯ &lsquo;static çš„ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ &lsquo;static ä½œä¸ºçº¦æŸ</li><li>å¦‚æœtraitæ²¡æœ‰ç”Ÿå‘½å‘¨æœŸçº¦æŸï¼Œé‚£ä¹ˆå®ƒçš„ç”Ÿå‘½å‘¨æœŸå°†ä¼šä»è¡¨è¾¾å¼ä¸­æ¨æ–­ï¼Œå¦‚æœä¸åœ¨è¡¨è¾¾å¼ä¸­ï¼Œé‚£ä¹ˆå°±æ˜¯ &lsquo;static çš„</li></ul><p>è¿™ä¹ˆå¤šä¸œè¥¿å¬èµ·æ¥è¶…çº§å¤æ‚ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç®€å•åœ°æ€»ç»“ä¸º &ldquo;<code>traitå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸçº¦æŸæ˜¯ä»ä¸Šä¸‹æ–‡ä¸­æ¨æ–­å‡ºæ¥çš„ã€‚</code>&rdquo; åœ¨æˆ‘ä»¬çœ‹è¿‡å‡ ä¸ªä¾‹å­åï¼Œæˆ‘ä»¬ä¼šå‘ç°ç”Ÿå‘½å‘¨æœŸçº¦æŸæ¨æ–­å…¶å®æ˜¯å¾ˆç¬¦åˆç›´è§‰çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å»è®°è¿™äº›å¾ˆæ­£å¼çš„è§„åˆ™ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>cell</span>::<span class=n>Ref</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>trait</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// çœç•¥
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>type</span> <span class=nc>T1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Box</span><span class=o>&lt;</span><span class=k>dyn</span><span class=w> </span><span class=n>Trait</span><span class=o>&gt;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// å±•å¼€ï¼ŒBox&lt;T&gt;å¯¹Tæ²¡æœ‰ç”Ÿå‘½å‘¨æœŸçº¦æŸï¼Œæ‰€ä»¥è¢«æ¨æ–­ä¸º&#39;static
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>type</span> <span class=nc>T2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Box</span><span class=o>&lt;</span><span class=k>dyn</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>&#39;static</span><span class=o>&gt;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// çœç•¥
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>impl</span><span class=w> </span><span class=k>dyn</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// å±•å¼€
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>impl</span><span class=w> </span><span class=k>dyn</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>&#39;static</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// çœç•¥
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>type</span> <span class=nc>T3</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=na>&#39;a</span><span class=w> </span><span class=k>dyn</span><span class=w> </span><span class=n>Trait</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// å±•å¼€, å› ä¸º&amp;&#39;a T è¦æ±‚ T: &#39;a, æ‰€ä»¥æ¨æ–­ä¸º &#39;a
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>type</span> <span class=nc>T4</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=na>&#39;a</span><span class=w> </span><span class=p>(</span><span class=k>dyn</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=na>&#39;a</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// çœç•¥
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>type</span> <span class=nc>T5</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Ref</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=p>,</span><span class=w> </span><span class=k>dyn</span><span class=w> </span><span class=n>Trait</span><span class=o>&gt;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// å±•å¼€, å› ä¸ºRef&lt;&#39;a, T&gt; è¦æ±‚ T: &#39;a, æ‰€ä»¥æ¨æ–­ä¸º &#39;a
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>type</span> <span class=nc>T6</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Ref</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=p>,</span><span class=w> </span><span class=k>dyn</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>trait</span><span class=w> </span><span class=n>GenericTrait</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span>: <span class=na>&#39;a</span> <span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// çœç•¥
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>type</span> <span class=nc>T7</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Box</span><span class=o>&lt;</span><span class=k>dyn</span><span class=w> </span><span class=n>GenericTrait</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;&gt;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// å±•å¼€
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>type</span> <span class=nc>T8</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Box</span><span class=o>&lt;</span><span class=k>dyn</span><span class=w> </span><span class=n>GenericTrait</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// çœç•¥
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>impl</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=k>dyn</span><span class=w> </span><span class=n>GenericTrait</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// å±•å¼€
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>impl</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=k>dyn</span><span class=w> </span><span class=n>GenericTrait</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=na>&#39;a</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å®ç°äº†æŸä¸ªtraitçš„å…·ä½“çš„ç±»å‹å¯ä»¥åŒ…å«å¼•ç”¨ï¼Œå› æ­¤å®ƒä»¬åŒæ ·æ‹¥æœ‰ç”Ÿå‘½å‘¨æœŸçº¦æŸï¼Œä¸”å¯¹åº”çš„traitå¯¹è±¡ä¹Ÿæœ‰ç”Ÿå‘½å‘¨æœŸçº¦æŸã€‚ ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä¸ºå¼•ç”¨å®ç°traitï¼Œè€Œå¼•ç”¨æ˜¾ç„¶æœ‰ç”Ÿå‘½å‘¨æœŸçº¦æŸã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>trait</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>Struct</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>Ref</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=p>,</span><span class=w> </span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=o>&amp;</span><span class=na>&#39;a</span><span class=w> </span><span class=n>T</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>Struct</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=o>&amp;</span><span class=n>Struct</span><span class=w> </span><span class=p>{}</span><span class=w> </span><span class=c1>// ç›´æ¥åœ¨å¼•ç”¨ç±»å‹ä¸Šå®ç°Trait
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>impl</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=p>,</span><span class=w> </span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=n>Trait</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>Ref</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=p>,</span><span class=w> </span><span class=n>T</span><span class=o>&gt;</span><span class=w> </span><span class=p>{}</span><span class=w> </span><span class=c1>// åœ¨åŒ…å«å¼•ç”¨çš„ç±»å‹ä¸Šå®ç°Trait
</span></span></span></code></pre></td></tr></table></div></div><p>ä¸ç®¡æ€æ ·ï¼Œè¿™éƒ½å€¼å¾—æˆ‘ä»¬ä»”ç»†ç ”ç©¶ï¼Œå› ä¸ºæ–°æ‰‹ä»¬ç»å¸¸åœ¨å°†ä¸€ä¸ªä½¿ç”¨traitå¯¹è±¡çš„å‡½æ•°é‡æ„æˆä½¿ç”¨æ³›å‹çš„å‡½æ•°ï¼ˆæˆ–è€…åè¿‡æ¥ï¼‰çš„æ—¶å€™æ„Ÿåˆ°å›°æƒ‘ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªä¾‹å­ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>fmt</span>::<span class=n>Display</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>dynamic_thread_print</span><span class=p>(</span><span class=n>t</span>: <span class=nb>Box</span><span class=o>&lt;</span><span class=k>dyn</span><span class=w> </span><span class=n>Display</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>Send</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>std</span>::<span class=n>thread</span>::<span class=n>spawn</span><span class=p>(</span><span class=k>move</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}).</span><span class=n>join</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>static_thread_print</span><span class=o>&lt;</span><span class=n>T</span>: <span class=nc>Display</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>Send</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span>: <span class=nc>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>std</span>::<span class=n>thread</span>::<span class=n>spawn</span><span class=p>(</span><span class=k>move</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}).</span><span class=n>join</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è¿™ä¼šæŠ›å‡ºä¸‹é¢çš„ç¼–è¯‘é”™è¯¯ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=n>error</span><span class=p>[</span><span class=n>E0310</span><span class=p>]</span>: <span class=nc>the</span><span class=w> </span><span class=n>parameter</span><span class=w> </span><span class=k>type</span> <span class=err>`</span><span class=n>T</span><span class=err>`</span><span class=w> </span><span class=n>may</span><span class=w> </span><span class=n>not</span><span class=w> </span><span class=n>live</span><span class=w> </span><span class=n>long</span><span class=w> </span><span class=n>enough</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>-</span>-&gt; <span class=nc>src</span><span class=o>/</span><span class=n>lib</span><span class=p>.</span><span class=n>rs</span>:<span class=mi>10</span>:<span class=mi>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>9</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=k>fn</span> <span class=nf>static_thread_print</span><span class=o>&lt;</span><span class=n>T</span>: <span class=nc>Display</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>Send</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span>: <span class=nc>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>|</span><span class=w>                        </span><span class=o>--</span><span class=w> </span><span class=n>help</span>: <span class=nc>consider</span><span class=w> </span><span class=n>adding</span><span class=w> </span><span class=n>an</span><span class=w> </span><span class=n>explicit</span><span class=w> </span><span class=n>lifetime</span><span class=w> </span><span class=n>bound</span><span class=o>..</span><span class=p>.</span>: <span class=err>`</span><span class=n>T</span>: <span class=nb>&#39;static</span> <span class=o>+</span><span class=err>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>10</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=n>std</span>::<span class=n>thread</span>::<span class=n>spawn</span><span class=p>(</span><span class=k>move</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>|</span><span class=w>     </span><span class=o>^^^^^^^^^^^^^^^^^^</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>note</span>: <span class=o>..</span><span class=p>.</span><span class=n>so</span><span class=w> </span><span class=n>that</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=k>type</span> <span class=err>`</span><span class=p>[</span><span class=n>closure</span><span class=o>@</span><span class=n>src</span><span class=o>/</span><span class=n>lib</span><span class=p>.</span><span class=n>rs</span>:<span class=mi>10</span>:<span class=mi>24</span>: <span class=mi>12</span>:<span class=mi>6</span><span class=w> </span><span class=n>t</span>:<span class=nc>T</span><span class=p>]</span><span class=err>`</span><span class=w> </span><span class=n>will</span><span class=w> </span><span class=n>meet</span><span class=w> </span><span class=n>its</span><span class=w> </span><span class=n>required</span><span class=w> </span><span class=n>lifetime</span><span class=w> </span><span class=n>bounds</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>-</span>-&gt; <span class=nc>src</span><span class=o>/</span><span class=n>lib</span><span class=p>.</span><span class=n>rs</span>:<span class=mi>10</span>:<span class=mi>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>10</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=n>std</span>::<span class=n>thread</span>::<span class=n>spawn</span><span class=p>(</span><span class=k>move</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>|</span><span class=w>     </span><span class=o>^^^^^^^^^^^^^^^^^^</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å¾ˆå¥½ï¼Œç¼–è¯‘å™¨å‘Šè¯‰äº†æˆ‘ä»¬æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¥è¯•è¯•ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>fmt</span>::<span class=n>Display</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>dynamic_thread_print</span><span class=p>(</span><span class=n>t</span>: <span class=nb>Box</span><span class=o>&lt;</span><span class=k>dyn</span><span class=w> </span><span class=n>Display</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>Send</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>std</span>::<span class=n>thread</span>::<span class=n>spawn</span><span class=p>(</span><span class=k>move</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}).</span><span class=n>join</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>static_thread_print</span><span class=o>&lt;</span><span class=n>T</span>: <span class=nc>Display</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>Send</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>&#39;static</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span>: <span class=nc>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>std</span>::<span class=n>thread</span>::<span class=n>spawn</span><span class=p>(</span><span class=k>move</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}).</span><span class=n>join</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ç¼–è¯‘é€šè¿‡ï¼Œä½†è¿™ä¸¤ä¸ªå‡½æ•°æ”¾åœ¨ä¸€å—å„¿çœ‹èµ·æ¥æœ‰ç‚¹æ€ªï¼Œä¸ºä»€ä¹ˆç¬¬äºŒä¸ªå‡½æ•°å¯¹ T æœ‰ &lsquo;static çº¦æŸï¼Œè€Œç¬¬ä¸€ä¸ªæ²¡æœ‰ï¼Ÿ è¿™ä¸ªé—®é¢˜å¾ˆåˆé’»ã€‚æ ¹æ®ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ï¼ŒRustè‡ªåŠ¨ä¸ºç¬¬ä¸€ä¸ªå‡½æ•°æ¨æ–­å‡º &lsquo;static çº¦æŸï¼Œæ‰€ä»¥ä¸¤ä¸ªå‡½æ•°å®é™…ä¸Šéƒ½æœ‰ &lsquo;static çº¦æŸã€‚ åœ¨Rustç¼–è¯‘å™¨çš„çœ¼ä¸­æ˜¯è¿™æ ·çš„ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>fmt</span>::<span class=n>Display</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>dynamic_thread_print</span><span class=p>(</span><span class=n>t</span>: <span class=nb>Box</span><span class=o>&lt;</span><span class=k>dyn</span><span class=w> </span><span class=n>Display</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>Send</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>&#39;static</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>std</span>::<span class=n>thread</span>::<span class=n>spawn</span><span class=p>(</span><span class=k>move</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}).</span><span class=n>join</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>static_thread_print</span><span class=o>&lt;</span><span class=n>T</span>: <span class=nc>Display</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>Send</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>&#39;static</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span>: <span class=nc>T</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>std</span>::<span class=n>thread</span>::<span class=n>spawn</span><span class=p>(</span><span class=k>move</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>println!</span><span class=p>(</span><span class=s>&#34;</span><span class=si>{}</span><span class=s>&#34;</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}).</span><span class=n>join</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><code>è¦ç‚¹:</code></p><ul><li>æ‰€æœ‰traitå¯¹è±¡éƒ½æœ‰ç€é»˜è®¤æ¨æ–­çš„ç”Ÿå‘½å‘¨æœŸçº¦æŸ</li></ul><h3 id=è¯¯è§£7-ç¼–è¯‘å™¨æŠ¥é”™ä¿¡æ¯ä¼šå‘Šè¯‰æˆ‘æ€ä¹ˆä¿®æ”¹æˆ‘çš„ä»£ç >è¯¯è§£7: ç¼–è¯‘å™¨æŠ¥é”™ä¿¡æ¯ä¼šå‘Šè¯‰æˆ‘æ€ä¹ˆä¿®æ”¹æˆ‘çš„ä»£ç <a hidden class=anchor aria-hidden=true href=#è¯¯è§£7-ç¼–è¯‘å™¨æŠ¥é”™ä¿¡æ¯ä¼šå‘Šè¯‰æˆ‘æ€ä¹ˆä¿®æ”¹æˆ‘çš„ä»£ç >#</a></h3><p>è¯¯è§£æ¨è®º</p><ul><li>Rustç¼–è¯‘å™¨å¯¹äºtrait objectsçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™æ€»æ˜¯å¯¹çš„</li><li>Rustç¼–è¯‘å™¨æ¯”æˆ‘æ›´æ‡‚æˆ‘ä»£ç çš„è¯­ä¹‰</li></ul><p>è¿™ä¸ªè¯¯è§£æ˜¯å‰ä¸¤ä¸ªè¯¯è§£çš„åˆäºŒä¸ºä¸€çš„ä¾‹å­ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>fmt</span>::<span class=n>Display</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>box_displayable</span><span class=o>&lt;</span><span class=n>T</span>: <span class=nc>Display</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span>: <span class=nc>T</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Box</span><span class=o>&lt;</span><span class=k>dyn</span><span class=w> </span><span class=n>Display</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>Box</span>::<span class=n>new</span><span class=p>(</span><span class=n>t</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æŠ›å‡ºå¦‚ä¸‹é”™è¯¯ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=n>error</span><span class=p>[</span><span class=n>E0310</span><span class=p>]</span>: <span class=nc>the</span><span class=w> </span><span class=n>parameter</span><span class=w> </span><span class=k>type</span> <span class=err>`</span><span class=n>T</span><span class=err>`</span><span class=w> </span><span class=n>may</span><span class=w> </span><span class=n>not</span><span class=w> </span><span class=n>live</span><span class=w> </span><span class=n>long</span><span class=w> </span><span class=n>enough</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=o>-</span>-&gt; <span class=nc>src</span><span class=o>/</span><span class=n>lib</span><span class=p>.</span><span class=n>rs</span>:<span class=mi>4</span>:<span class=mi>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>fn</span> <span class=nf>box_displayable</span><span class=o>&lt;</span><span class=n>T</span>: <span class=nc>Display</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span>: <span class=nc>T</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Box</span><span class=o>&lt;</span><span class=k>dyn</span><span class=w> </span><span class=n>Display</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>                    </span><span class=o>--</span><span class=w> </span><span class=n>help</span>: <span class=nc>consider</span><span class=w> </span><span class=n>adding</span><span class=w> </span><span class=n>an</span><span class=w> </span><span class=n>explicit</span><span class=w> </span><span class=n>lifetime</span><span class=w> </span><span class=n>bound</span><span class=o>..</span><span class=p>.</span>: <span class=err>`</span><span class=n>T</span>: <span class=nb>&#39;static</span> <span class=o>+</span><span class=err>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>4</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=nb>Box</span>::<span class=n>new</span><span class=p>(</span><span class=n>t</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>     </span><span class=o>^^^^^^^^^^^</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>note</span>: <span class=o>..</span><span class=p>.</span><span class=n>so</span><span class=w> </span><span class=n>that</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=k>type</span> <span class=err>`</span><span class=n>T</span><span class=err>`</span><span class=w> </span><span class=n>will</span><span class=w> </span><span class=n>meet</span><span class=w> </span><span class=n>its</span><span class=w> </span><span class=n>required</span><span class=w> </span><span class=n>lifetime</span><span class=w> </span><span class=n>bounds</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=o>-</span>-&gt; <span class=nc>src</span><span class=o>/</span><span class=n>lib</span><span class=p>.</span><span class=n>rs</span>:<span class=mi>4</span>:<span class=mi>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>4</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=nb>Box</span>::<span class=n>new</span><span class=p>(</span><span class=n>t</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>     </span><span class=o>^^^^^^^^^^^</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å¥½å§ï¼Œè®©æˆ‘ä»¬ç…§ç€ç¼–è¯‘å™¨å‘Šè¯‰æˆ‘ä»¬çš„æ–¹å¼ä¿®æ”¹å®ƒï¼Œåˆ«åœ¨æ„è¿™ç§æ”¹æ³•åŸºäºäº†ä¸€ä¸ªæ²¡æœ‰å‘ŠçŸ¥çš„äº‹å®ï¼š ç¼–è¯‘å™¨è‡ªåŠ¨ä¸ºæˆ‘ä»¬çš„boxed trait objectæ¨æ–­äº†ä¸€ä¸ª&rsquo;staticçš„ç”Ÿå‘½å‘¨æœŸçº¦æŸã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>fmt</span>::<span class=n>Display</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>box_displayable</span><span class=o>&lt;</span><span class=n>T</span>: <span class=nc>Display</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nb>&#39;static</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span>: <span class=nc>T</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Box</span><span class=o>&lt;</span><span class=k>dyn</span><span class=w> </span><span class=n>Display</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>Box</span>::<span class=n>new</span><span class=p>(</span><span class=n>t</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ç°åœ¨ç¼–è¯‘é€šè¿‡äº†ï¼Œä½†è¿™çœŸçš„æ˜¯æˆ‘ä»¬æƒ³è¦çš„å—ï¼Ÿå¯èƒ½æ˜¯ï¼Œä¹Ÿå¯èƒ½ä¸æ˜¯ï¼Œç¼–è¯‘å»å¹¶æ²¡æœ‰å‘Šè¯‰æˆ‘ä»¬å…¶å®ƒè§£å†³æ–¹æ³• ä½†è¿™ä¸ªä¹Ÿè®¸åˆé€‚ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>fmt</span>::<span class=n>Display</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>box_displayable</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=p>,</span><span class=w> </span><span class=n>T</span>: <span class=nc>Display</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>(</span><span class=n>t</span>: <span class=nc>T</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Box</span><span class=o>&lt;</span><span class=k>dyn</span><span class=w> </span><span class=n>Display</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nb>Box</span>::<span class=n>new</span><span class=p>(</span><span class=n>t</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°å’Œå‰ä¸€ä¸ªç‰ˆæœ¬ä¸€æ ·ï¼Œä½†å¤šäº†ä¸å°‘ä¸œè¥¿ã€‚è¿™æ ·å†™èƒ½è®©å®ƒæ›´å¥½å—ï¼Ÿä¸ä¸€å®šï¼Œ è¿™å–å†³äºæˆ‘ä»¬çš„ç¨‹åºçš„è¦æ±‚å’Œçº¦æŸã€‚è¿™ä¸ªä¾‹å­æœ‰äº›æŠ½è±¡ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æ›´ç®€å•æ˜äº†çš„æƒ…å†µã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>return_first</span><span class=p>(</span><span class=n>a</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>b</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=kt>str</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æŠ¥é”™:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=n>error</span><span class=p>[</span><span class=n>E0106</span><span class=p>]</span>: <span class=nc>missing</span><span class=w> </span><span class=n>lifetime</span><span class=w> </span><span class=n>specifier</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=o>-</span>-&gt; <span class=nc>src</span><span class=o>/</span><span class=n>lib</span><span class=p>.</span><span class=n>rs</span>:<span class=mi>1</span>:<span class=mi>38</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>fn</span> <span class=nf>return_first</span><span class=p>(</span><span class=n>a</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>b</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=kt>str</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>                    </span><span class=o>----</span><span class=w>     </span><span class=o>----</span><span class=w>     </span><span class=o>^</span><span class=w> </span><span class=n>expected</span><span class=w> </span><span class=n>named</span><span class=w> </span><span class=n>lifetime</span><span class=w> </span><span class=n>parameter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>=</span><span class=w> </span><span class=n>help</span>: <span class=nc>this</span><span class=w> </span><span class=n>function</span><span class=na>&#39;s</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=k>type</span> <span class=nc>contains</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>borrowed</span><span class=w> </span><span class=n>value</span><span class=p>,</span><span class=w> </span><span class=n>but</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>signature</span><span class=w> </span><span class=n>does</span><span class=w> </span><span class=n>not</span><span class=w> </span><span class=n>say</span><span class=w> </span><span class=n>whether</span><span class=w> </span><span class=n>it</span><span class=w> </span><span class=n>is</span><span class=w> </span><span class=n>borrowed</span><span class=w> </span><span class=n>from</span><span class=w> </span><span class=err>`</span><span class=n>a</span><span class=err>`</span><span class=w> </span><span class=n>or</span><span class=w> </span><span class=err>`</span><span class=n>b</span><span class=err>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>help</span>: <span class=nc>consider</span><span class=w> </span><span class=n>introducing</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>named</span><span class=w> </span><span class=n>lifetime</span><span class=w> </span><span class=n>parameter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>fn</span> <span class=nf>return_first</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>(</span><span class=n>a</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>b</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>                </span><span class=o>^^^^</span><span class=w>    </span><span class=o>^^^^^^^</span><span class=w>     </span><span class=o>^^^^^^^</span><span class=w>     </span><span class=o>^^^</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è¿™ä¸ªé”™è¯¯ä¿¡æ¯å»ºè®®æˆ‘ä»¬ç»™è¾“å…¥å’Œè¾“å‡ºæ‰“ä¸Šç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°ã€‚ è¿™ä¹ˆåšè™½ç„¶èƒ½ä½¿å¾—ç¼–è¯‘é€šè¿‡ï¼Œä½†å´è¿‡åº¦é™åˆ¶äº†è¿”å›ç±»å‹ã€‚ æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„æ˜¯è¿™ä¸ªï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>return_first</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>(</span><span class=n>a</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>b</span>: <span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><code>è¦ç‚¹:</code></p><ul><li>Rustå¯¹trait objectçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™å¹¶ä¸æ˜¯åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½æ­£ç¡®ã€‚</li><li>Rustä¸è§å¾—æ¯”ä½ æ›´æ‡‚ä½ ä»£ç çš„è¯­ä¹‰ã€‚</li><li>Rustç¼–è¯‘é”™è¯¯ä¿¡æ¯ç»™å‡ºçš„ä¿®æ”¹å»ºè®®å¯èƒ½èƒ½è®©ä½ çš„ä»£ç ç¼–è¯‘é€šè¿‡ï¼Œä½†è¿™ä¸ä¸€å®šæ˜¯æœ€ç¬¦åˆä½ çš„è¦æ±‚çš„ã€‚</li></ul><h3 id=è¯¯è§£8-ç”Ÿå‘½å‘¨æœŸå¯ä»¥åœ¨è¿è¡Œæ—¶å˜é•¿ç¼©çŸ­>è¯¯è§£8: ç”Ÿå‘½å‘¨æœŸå¯ä»¥åœ¨è¿è¡Œæ—¶å˜é•¿ç¼©çŸ­<a hidden class=anchor aria-hidden=true href=#è¯¯è§£8-ç”Ÿå‘½å‘¨æœŸå¯ä»¥åœ¨è¿è¡Œæ—¶å˜é•¿ç¼©çŸ­>#</a></h3><p>è¯¯è§£æ¨è®º</p><ul><li>å®¹å™¨ç±»å‹å¯ä»¥é€šè¿‡æ›´æ¢å¼•ç”¨åœ¨è¿è¡Œæ—¶æ›´æ”¹è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ</li></ul><p>Rustçš„å€Ÿç”¨æ£€æŸ¥ä¼šè¿›è¡Œæ·±å…¥çš„æ§åˆ¶æµåˆ†æ
è¿™è¿‡ä¸äº†ç¼–è¯‘ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Has</span><span class=o>&lt;</span><span class=na>&#39;lifetime</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>lifetime</span>: <span class=kp>&amp;</span><span class=na>&#39;lifetime</span> <span class=kt>str</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>long</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;long&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>has</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Has</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>lifetime</span>: <span class=kp>&amp;</span><span class=nc>long</span><span class=w> </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>assert_eq!</span><span class=p>(</span><span class=n>has</span><span class=p>.</span><span class=n>lifetime</span><span class=p>,</span><span class=w> </span><span class=s>&#34;long&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>short</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;short&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// æ¢æˆçŸ­ç”Ÿå‘½å‘¨æœŸ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=n>has</span><span class=p>.</span><span class=n>lifetime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>short</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>assert_eq!</span><span class=p>(</span><span class=n>has</span><span class=p>.</span><span class=n>lifetime</span><span class=p>,</span><span class=w> </span><span class=s>&#34;short&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// æ¢å›é•¿ç”Ÿå‘½å‘¨æœŸï¼ˆå¹¶ä¸è¡Œï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=n>has</span><span class=p>.</span><span class=n>lifetime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>long</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>assert_eq!</span><span class=p>(</span><span class=n>has</span><span class=p>.</span><span class=n>lifetime</span><span class=p>,</span><span class=w> </span><span class=s>&#34;long&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// `short`åœ¨è¿™é‡Œææ„
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ç¼–è¯‘é”™è¯¯ï¼Œ`short`åœ¨ææ„åä»å¤„äºå€Ÿç”¨çŠ¶æ€
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=fm>assert_eq!</span><span class=p>(</span><span class=n>has</span><span class=p>.</span><span class=n>lifetime</span><span class=p>,</span><span class=w> </span><span class=s>&#34;long&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æŠ¥é”™ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=n>error</span><span class=p>[</span><span class=n>E0597</span><span class=p>]</span>: <span class=err>`</span><span class=n>short</span><span class=err>`</span><span class=w> </span><span class=n>does</span><span class=w> </span><span class=n>not</span><span class=w> </span><span class=n>live</span><span class=w> </span><span class=n>long</span><span class=w> </span><span class=n>enough</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>-</span>-&gt; <span class=nc>src</span><span class=o>/</span><span class=n>main</span><span class=p>.</span><span class=n>rs</span>:<span class=mi>11</span>:<span class=mi>24</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>11</span><span class=w> </span><span class=o>|</span><span class=w>         </span><span class=n>has</span><span class=p>.</span><span class=n>lifetime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>short</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>|</span><span class=w>                        </span><span class=o>^^^^^^</span><span class=w> </span><span class=n>borrowed</span><span class=w> </span><span class=n>value</span><span class=w> </span><span class=n>does</span><span class=w> </span><span class=n>not</span><span class=w> </span><span class=n>live</span><span class=w> </span><span class=n>long</span><span class=w> </span><span class=n>enough</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>..</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>15</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>|</span><span class=w>     </span><span class=o>-</span><span class=w> </span><span class=err>`</span><span class=n>short</span><span class=err>`</span><span class=w> </span><span class=n>dropped</span><span class=w> </span><span class=n>here</span><span class=w> </span><span class=k>while</span><span class=w> </span><span class=n>still</span><span class=w> </span><span class=n>borrowed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>16</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=fm>assert_eq!</span><span class=p>(</span><span class=n>has</span><span class=p>.</span><span class=n>lifetime</span><span class=p>,</span><span class=w> </span><span class=s>&#34;long&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>|</span><span class=w>     </span><span class=o>---------------------------------</span><span class=w> </span><span class=n>borrow</span><span class=w> </span><span class=n>later</span><span class=w> </span><span class=n>used</span><span class=w> </span><span class=n>here</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ä¸‹é¢è¿™ä¸ªä»£ç åŒæ ·è¿‡ä¸äº†ç¼–è¯‘ï¼ŒæŠ¥çš„é”™å’Œä¸Šé¢ä¸€æ ·ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Has</span><span class=o>&lt;</span><span class=na>&#39;lifetime</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>lifetime</span>: <span class=kp>&amp;</span><span class=na>&#39;lifetime</span> <span class=kt>str</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>long</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;long&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>has</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Has</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>lifetime</span>: <span class=kp>&amp;</span><span class=nc>long</span><span class=w> </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>assert_eq!</span><span class=p>(</span><span class=n>has</span><span class=p>.</span><span class=n>lifetime</span><span class=p>,</span><span class=w> </span><span class=s>&#34;long&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// è¿™ä¸ªä»£ç å—ä¸ä¼šè¢«æ‰§è¡Œ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=kc>false</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>short</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;short&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// æ¢æˆçŸ­ç”Ÿå‘½å‘¨æœŸ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=n>has</span><span class=p>.</span><span class=n>lifetime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>short</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>assert_eq!</span><span class=p>(</span><span class=n>has</span><span class=p>.</span><span class=n>lifetime</span><span class=p>,</span><span class=w> </span><span class=s>&#34;short&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// æ¢å›é•¿ç”Ÿå‘½å‘¨æœŸï¼ˆå¹¶ä¸è¡Œï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=n>has</span><span class=p>.</span><span class=n>lifetime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>long</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=fm>assert_eq!</span><span class=p>(</span><span class=n>has</span><span class=p>.</span><span class=n>lifetime</span><span class=p>,</span><span class=w> </span><span class=s>&#34;long&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// `short`åœ¨è¿™é‡Œææ„
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ä»æ—§ç¼–è¯‘é”™è¯¯ï¼Œ`short`åœ¨ææ„åä»å¤„äºå€Ÿç”¨çŠ¶æ€
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=fm>assert_eq!</span><span class=p>(</span><span class=n>has</span><span class=p>.</span><span class=n>lifetime</span><span class=p>,</span><span class=w> </span><span class=s>&#34;long&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ç”Ÿå‘½å‘¨æœŸåªä¼šåœ¨ç¼–è¯‘æœŸè¢«é™æ€éªŒè¯ï¼Œå¹¶ä¸”Rustçš„å€Ÿç”¨æ£€æŸ¥åªèƒ½åšåˆ°åŸºæœ¬çš„æ§åˆ¶æµåˆ†æï¼Œ å®ƒå‡è®¾æ¯ä¸ªif-elseä¸­çš„ä»£ç å—å’Œmatchçš„æ¯ä¸ªåˆ†æ”¯éƒ½ä¼šè¢«æ‰§è¡Œï¼Œ å¹¶ä¸”å…¶ä¸­çš„æ¯ä¸€ä¸ªå˜é‡éƒ½èƒ½è¢«æŒ‡å®šä¸€ä¸ªæœ€çŸ­çš„ç”Ÿå‘½å‘¨æœŸã€‚<code> ä¸€æ—¦å˜é‡è¢«æŒ‡å®šäº†ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œå®ƒå°±ä¸€ç›´å—åˆ°è¿™ä¸ªç”Ÿå‘½å‘¨æœŸçº¦æŸ</code>ã€‚å˜é‡çš„ç”Ÿå‘½å‘¨æœŸåªèƒ½ç¼©çŸ­ï¼Œ å¹¶ä¸”æ‰€æœ‰ç¼©çŸ­éƒ½ä¼šåœ¨ç¼–è¯‘å™¨è¢«ç¡®å®šã€‚</p><p><code>è¦ç‚¹:</code></p><ul><li>ç”Ÿå‘½å‘¨æœŸæ˜¯åœ¨ç¼–è¯‘æœŸé™æ€éªŒè¯çš„</li><li>ç”Ÿå‘½å‘¨æœŸä¸èƒ½åœ¨è¿è¡Œæ—¶å˜é•¿ã€ç¼©çŸ­æˆ–è€…æ”¹å˜</li><li>Rustçš„å€Ÿç”¨æ£€æŸ¥æ€»æ˜¯ä¼šä¸ºæ‰€æœ‰å˜é‡æŒ‡å®šä¸€ä¸ªæœ€çŸ­å¯èƒ½çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”å‡å®šæ‰€æœ‰ä»£ç è·¯å¾„éƒ½ä¼šè¢«æ‰§è¡Œ</li></ul><h3 id=è¯¯è§£9-å°†å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨æ˜¯å®‰å…¨çš„>è¯¯è§£9: å°†å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨æ˜¯å®‰å…¨çš„<a hidden class=anchor aria-hidden=true href=#è¯¯è§£9-å°†å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨æ˜¯å®‰å…¨çš„>#</a></h3><p>è¯¯è§£æ¨è®º</p><ul><li>é‡æ–°å€Ÿç”¨ä¸€ä¸ªå¼•ç”¨ä¼šç»ˆæ­¢å®ƒçš„ç”Ÿå‘½å‘¨æœŸå¹¶ä¸”å¼€å§‹ä¸€ä¸ªæ–°çš„</li></ul><p>ä½ å¯ä»¥å‘ä¸€ä¸ªæ¥æ”¶å…±äº«å¼•ç”¨çš„å‡½æ•°ä¼ é€’ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œå› ä¸º<code>Rustä¼šéšå¼å°†å¯å˜å¼•ç”¨é‡æ–°å€Ÿç”¨ä¸ºä¸å¯å˜å¼•ç”¨</code>ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>takes_shared_ref</span><span class=p>(</span><span class=n>n</span>: <span class=kp>&amp;</span><span class=kt>i32</span><span class=p>)</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>takes_shared_ref</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>a</span><span class=p>);</span><span class=w> </span><span class=c1>// ç¼–è¯‘é€šè¿‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>takes_shared_ref</span><span class=p>(</span><span class=o>&amp;*</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>a</span><span class=p>));</span><span class=w> </span><span class=c1>// ä¸Šä¸€è¡Œçš„æ˜¾å¼å†™æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ç›´è§‰ä¸Šè¿™æ²¡é—®é¢˜ï¼Œå°†ä¸€ä¸ªå¯å˜å¼•ç”¨é‡æ–°å€Ÿç”¨ä¸ºä¸å¯å˜å¼•ç”¨ï¼Œåº”è¯¥ä¸ä¼šæœ‰ä»€ä¹ˆå®³å¤„ä¸æ˜¯å—ï¼Ÿ ç„¶è€Œå¹¶éå¦‚æ­¤ï¼Œä¸‹é¢çš„ä»£ç è¿‡ä¸äº†ç¼–è¯‘ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>10</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>b</span>: <span class=kp>&amp;</span><span class=kt>i32</span> <span class=o>=</span><span class=w> </span><span class=o>&amp;*</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>a</span><span class=p>);</span><span class=w> </span><span class=c1>// é‡æ–°å€Ÿç”¨ä¸ºä¸å¯å˜
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>c</span>: <span class=kp>&amp;</span><span class=kt>i32</span> <span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>a</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=fm>dbg!</span><span class=p>(</span><span class=n>b</span><span class=p>,</span><span class=w> </span><span class=n>c</span><span class=p>);</span><span class=w> </span><span class=c1>// ç¼–è¯‘é”™è¯¯
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æŠ¥é”™ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=n>error</span><span class=p>[</span><span class=n>E0502</span><span class=p>]</span>: <span class=nc>cannot</span><span class=w> </span><span class=n>borrow</span><span class=w> </span><span class=err>`</span><span class=n>a</span><span class=err>`</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>immutable</span><span class=w> </span><span class=n>because</span><span class=w> </span><span class=n>it</span><span class=w> </span><span class=n>is</span><span class=w> </span><span class=n>also</span><span class=w> </span><span class=n>borrowed</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>mutable</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=o>-</span>-&gt; <span class=nc>src</span><span class=o>/</span><span class=n>main</span><span class=p>.</span><span class=n>rs</span>:<span class=mi>4</span>:<span class=mi>19</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=kd>let</span><span class=w> </span><span class=n>b</span>: <span class=kp>&amp;</span><span class=kt>i32</span> <span class=o>=</span><span class=w> </span><span class=o>&amp;*</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>a</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>                     </span><span class=o>--------</span><span class=w> </span><span class=n>mutable</span><span class=w> </span><span class=n>borrow</span><span class=w> </span><span class=n>occurs</span><span class=w> </span><span class=n>here</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>4</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=kd>let</span><span class=w> </span><span class=n>c</span>: <span class=kp>&amp;</span><span class=kt>i32</span> <span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>a</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>                   </span><span class=o>^^</span><span class=w> </span><span class=n>immutable</span><span class=w> </span><span class=n>borrow</span><span class=w> </span><span class=n>occurs</span><span class=w> </span><span class=n>here</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>5</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=fm>dbg!</span><span class=p>(</span><span class=n>b</span><span class=p>,</span><span class=w> </span><span class=n>c</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>          </span><span class=o>-</span><span class=w> </span><span class=n>mutable</span><span class=w> </span><span class=n>borrow</span><span class=w> </span><span class=n>later</span><span class=w> </span><span class=n>used</span><span class=w> </span><span class=n>here</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å¯å˜å€Ÿç”¨å‡ºç°åç«‹å³é‡æ–°å€Ÿç”¨ä¸ºä¸å¯å˜å¼•ç”¨ï¼Œç„¶åå¯å˜å¼•ç”¨è‡ªèº«ææ„ã€‚ ä¸ºä»€ä¹ˆRustä¼šè®¤ä¸ºè¿™ä¸ªä¸å¯å˜çš„é‡æ–°å€Ÿç”¨ä»å…·æœ‰å¯å˜å¼•ç”¨çš„ç‹¬å ç”Ÿå‘½å‘¨æœŸï¼Ÿ è™½ç„¶ä¸Šé¢è¿™ä¸ªä¾‹å­æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å…è®¸å°†å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨å®é™…ä¸Šå¼•å…¥äº†æ½œåœ¨çš„å†…å­˜å®‰å…¨é—®é¢˜ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>sync</span>::<span class=n>Mutex</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>Struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>mutex</span>: <span class=nc>Mutex</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>Struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// å°†selfçš„å¯å˜å¼•ç”¨é™çº§ä¸ºstrçš„å…±äº«å¼•ç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>fn</span> <span class=nf>get_string</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=kt>str</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=bp>self</span><span class=p>.</span><span class=n>mutex</span><span class=p>.</span><span class=n>get_mut</span><span class=p>().</span><span class=n>unwrap</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>fn</span> <span class=nf>mutate_string</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// å¦‚æœRustå…è®¸å°†å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨ï¼Œ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=c1>// é‚£ä¹ˆä¸‹é¢è¿™è¡Œä»£ç ä¼šä½¿å¾—æ‰€æœ‰ä»get_stringä¸­å¾—åˆ°çš„å…±äº«å¼•ç”¨å¤±æ•ˆ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>        </span><span class=o>*</span><span class=bp>self</span><span class=p>.</span><span class=n>mutex</span><span class=p>.</span><span class=n>lock</span><span class=p>().</span><span class=n>unwrap</span><span class=p>()</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;surprise!&#34;</span><span class=p>.</span><span class=n>to_owned</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>mutex</span>: <span class=nc>Mutex</span>::<span class=n>new</span><span class=p>(</span><span class=s>&#34;string&#34;</span><span class=p>.</span><span class=n>to_owned</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>str_ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>get_string</span><span class=p>();</span><span class=w> </span><span class=c1>// å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>s</span><span class=p>.</span><span class=n>mutate_string</span><span class=p>();</span><span class=w> </span><span class=c1>// str_refå¤±æ•ˆï¼Œå˜ä¸ºæ‚¬ç©ºæŒ‡é’ˆ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=fm>dbg!</span><span class=p>(</span><span class=n>str_ref</span><span class=p>);</span><span class=w> </span><span class=c1>// ç¼–è¯‘é”™è¯¯ï¼Œå’Œæˆ‘ä»¬é¢„æœŸçš„ä¸€æ ·
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è¿™é‡Œçš„é—®é¢˜åœ¨äºï¼Œå½“ä½ å°†ä¸€ä¸ªå¯å˜å¼•ç”¨é‡æ–°å€Ÿç”¨ä¸ºå…±äº«å¼•ç”¨ï¼Œä½ ä¼šé‡åˆ°ä¸€ç‚¹éº»çƒ¦ï¼š <code>å³ä½¿å¯å˜å¼•ç”¨å·²ç»ææ„ï¼Œé‡æ–°å€Ÿç”¨å‡ºæ¥çš„å…±äº«å¼•ç”¨è¿˜æ˜¯ä¼šå°†å¯å˜å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿åˆ°å’Œè‡ªå·±ä¸€æ ·é•¿</code>ã€‚ è¿™ç§é‡æ–°å€Ÿç”¨å‡ºæ¥çš„å…±äº«å¼•ç”¨éå¸¸éš¾ç”¨ï¼Œå› ä¸ºå®ƒä¸èƒ½ä¸å…¶å®ƒå…±äº«å¼•ç”¨å…±å­˜ã€‚ å®ƒæœ‰ç€å¯å˜å¼•ç”¨å’Œä¸å¯å˜å¼•ç”¨çš„æ‰€æœ‰ç¼ºç‚¹ï¼Œå´æ²¡æœ‰å®ƒä»¬å„è‡ªçš„ä¼˜ç‚¹ã€‚ æˆ‘è®¤ä¸ºå°†å¯å˜å¼•ç”¨é‡æ–°å€Ÿç”¨ä¸ºå…±äº«å¼•ç”¨åº”è¯¥è¢«è®¤ä¸ºæ˜¯Rustçš„åæ¨¡å¼ï¼ˆanti-pattern)ã€‚ å¯¹è¿™ç§åæ¨¡å¼ä¿æŒè­¦æƒ•å¾ˆé‡è¦ï¼Œè¿™å¯ä»¥è®©ä½ åœ¨çœ‹åˆ°ä¸‹é¢è¿™æ ·çš„ä»£ç çš„æ—¶å€™æ›´å®¹æ˜“å‘ç°å®ƒï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=c1>// å°†Tçš„å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>some_function</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>some_arg</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>T</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=nc>T</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>Struct</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>Struct</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// å°†selfçš„å¯å˜å¼•ç”¨é™çº§ä¸ºselfå…±äº«å¼•ç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>fn</span> <span class=nf>some_method</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=nc>self</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// å°†selfçš„å¯å˜å¼•ç”¨é™çº§ä¸ºTçš„å…±äº«å¼•ç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>fn</span> <span class=nf>other_method</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=nc>T</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å³ä½¿ä½ é¿å…äº†å‡½æ•°å’Œæ–¹æ³•ç­¾åä¸­çš„é‡æ–°å€Ÿç”¨ï¼ŒRustä»ç„¶ä¼šè‡ªåŠ¨éšå¼é‡æ–°å€Ÿç”¨ï¼Œ æ‰€ä»¥å¾ˆå®¹æ˜“æ— æ„ä¸­é‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>collections</span>::<span class=n>HashMap</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>type</span> <span class=nc>PlayerID</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kt>i32</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[derive(Debug, Default)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>Player</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>score</span>: <span class=kt>i32</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>start_game</span><span class=p>(</span><span class=n>player_a</span>: <span class=nc>PlayerID</span><span class=p>,</span><span class=w> </span><span class=n>player_b</span>: <span class=nc>PlayerID</span><span class=p>,</span><span class=w> </span><span class=n>server</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;</span><span class=n>PlayerID</span><span class=p>,</span><span class=w> </span><span class=n>Player</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ä»æœåŠ¡å™¨ä¸­è·å–playerï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºå¹¶æ’å…¥ä¸€ä¸ªæ–°çš„
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>player_a</span>: <span class=kp>&amp;</span><span class=nc>Player</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>server</span><span class=p>.</span><span class=n>entry</span><span class=p>(</span><span class=n>player_a</span><span class=p>).</span><span class=n>or_default</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>player_b</span>: <span class=kp>&amp;</span><span class=nc>Player</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>server</span><span class=p>.</span><span class=n>entry</span><span class=p>(</span><span class=n>player_b</span><span class=p>).</span><span class=n>or_default</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ç”¨playeråšç‚¹ä»€ä¹ˆ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=fm>dbg!</span><span class=p>(</span><span class=n>player_a</span><span class=p>,</span><span class=w> </span><span class=n>player_b</span><span class=p>);</span><span class=w> </span><span class=c1>// ç¼–è¯‘é”™è¯¯
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ä¸Šé¢çš„ä»£ç ç¼–è¯‘å¤±è´¥ã€‚å› ä¸º or_default() è¿”å›ä¸€ä¸ª &amp;mut Playerï¼Œ è€Œæˆ‘ä»¬çš„æ˜¾å¼ç±»å‹æ ‡æ³¨ &amp;Player ä½¿å¾—è¿™ä¸ª &amp;mut Player è¢«éšå¼é‡æ–°å€Ÿç”¨ä¸º &amp;Player ã€‚ ä¸ºäº†é€šè¿‡ç¼–è¯‘ï¼Œæˆ‘ä»¬ä¸å¾—ä¸è¿™æ ·å†™ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>collections</span>::<span class=n>HashMap</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>type</span> <span class=nc>PlayerID</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kt>i32</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cp>#[derive(Debug, Default)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>struct</span> <span class=nc>Player</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>score</span>: <span class=kt>i32</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>start_game</span><span class=p>(</span><span class=n>player_a</span>: <span class=nc>PlayerID</span><span class=p>,</span><span class=w> </span><span class=n>player_b</span>: <span class=nc>PlayerID</span><span class=p>,</span><span class=w> </span><span class=n>server</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;</span><span class=n>PlayerID</span><span class=p>,</span><span class=w> </span><span class=n>Player</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// å› ä¸ºæˆ‘ä»¬ä¸èƒ½æŠŠå®ƒä»¬æ”¾åœ¨ä¸€èµ·ç”¨ï¼Œæ‰€ä»¥è¿™é‡ŒæŠŠè¿”å›çš„Playerå¯å˜å¼•ç”¨ææ„æ‰
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=n>server</span><span class=p>.</span><span class=n>entry</span><span class=p>(</span><span class=n>player_a</span><span class=p>).</span><span class=n>or_default</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>server</span><span class=p>.</span><span class=n>entry</span><span class=p>(</span><span class=n>player_b</span><span class=p>).</span><span class=n>or_default</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// å†æ¬¡è·å–è¿™äº›Playerï¼Œè¿™æ¬¡ä»¥ä¸å¯å˜çš„æ–¹å¼ï¼Œé¿å…å‡ºç°éšå¼é‡æ–°å€Ÿç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>player_a</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>server</span><span class=p>.</span><span class=n>get</span><span class=p>(</span><span class=o>&amp;</span><span class=n>player_a</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>player_b</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>server</span><span class=p>.</span><span class=n>get</span><span class=p>(</span><span class=o>&amp;</span><span class=n>player_b</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ç”¨Playeråšç‚¹ä»€ä¹ˆ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=fm>dbg!</span><span class=p>(</span><span class=n>player_a</span><span class=p>,</span><span class=w> </span><span class=n>player_b</span><span class=p>);</span><span class=w> </span><span class=c1>// ç¼–è¯‘é€šè¿‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è™½ç„¶æœ‰ç‚¹å°´å°¬å’Œç¬¨é‡ï¼Œä½†è¿™ä¹Ÿç®—æ˜¯ä¸ºå†…å­˜å®‰å…¨åšå‡ºçš„ç‰ºç‰²ã€‚</p><p><code>è¦ç‚¹:</code></p><ul><li>å°½é‡ä¸è¦æŠŠå¯å˜å¼•ç”¨é‡æ–°å€Ÿç”¨ä¸ºå…±äº«å¼•ç”¨ï¼Œä¸ç„¶ä½ ä¼šé‡åˆ°ä¸å°‘éº»çƒ¦</li><li>é‡æ–°å€Ÿç”¨ä¸€ä¸ªå¯å˜å¼•ç”¨ä¸ä¼šä½¿å¾—å®ƒçš„ç”Ÿå‘½å‘¨æœŸç»ˆç»“ï¼Œå³ä½¿è¿™ä¸ªå¯å˜å¼•ç”¨å·²ç»ææ„</li></ul><h3 id=è¯¯è§£10-é—­åŒ…éµå¾ªå’Œå‡½æ•°ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™>è¯¯è§£10: é—­åŒ…éµå¾ªå’Œå‡½æ•°ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™<a hidden class=anchor aria-hidden=true href=#è¯¯è§£10-é—­åŒ…éµå¾ªå’Œå‡½æ•°ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™>#</a></h3><p>æ¯”èµ·è¯¯è§£ï¼Œè¿™æ›´åƒæ˜¯Rustçš„ä¸€ä¸ªå°é™·é˜±ã€‚</p><p>é—­åŒ…ï¼Œè™½ç„¶ä¹Ÿæ˜¯ä¸ªå‡½æ•°ï¼Œä½†æ˜¯å®ƒå¹¶ä¸éµå¾ªå’Œå‡½æ•°ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>function</span><span class=p>(</span><span class=n>x</span>: <span class=kp>&amp;</span><span class=kt>i32</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=kt>i32</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>x</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>closure</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>|</span><span class=n>x</span>: <span class=kp>&amp;</span><span class=kt>i32</span><span class=o>|</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æŠ¥é”™ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=n>error</span>: <span class=nc>lifetime</span><span class=w> </span><span class=n>may</span><span class=w> </span><span class=n>not</span><span class=w> </span><span class=n>live</span><span class=w> </span><span class=n>long</span><span class=w> </span><span class=n>enough</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=o>-</span>-&gt; <span class=nc>src</span><span class=o>/</span><span class=n>main</span><span class=p>.</span><span class=n>rs</span>:<span class=mi>6</span>:<span class=mi>29</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>6</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=kd>let</span><span class=w> </span><span class=n>closure</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>|</span><span class=n>x</span>: <span class=kp>&amp;</span><span class=kt>i32</span><span class=o>|</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>                       </span><span class=o>-</span><span class=w>   </span><span class=o>-</span><span class=w> </span><span class=o>^</span><span class=w> </span><span class=n>returning</span><span class=w> </span><span class=n>this</span><span class=w> </span><span class=n>value</span><span class=w> </span><span class=n>requires</span><span class=w> </span><span class=n>that</span><span class=w> </span><span class=err>`</span><span class=na>&#39;</span><span class=mi>1</span><span class=err>`</span><span class=w> </span><span class=n>must</span><span class=w> </span><span class=n>outlive</span><span class=w> </span><span class=err>`</span><span class=na>&#39;</span><span class=mi>2</span><span class=err>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>                       </span><span class=o>|</span><span class=w>   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>                       </span><span class=o>|</span><span class=w>   </span><span class=k>return</span><span class=w> </span><span class=k>type</span> <span class=nc>of</span><span class=w> </span><span class=n>closure</span><span class=w> </span><span class=n>is</span><span class=w> </span><span class=o>&amp;</span><span class=na>&#39;</span><span class=mi>2</span><span class=w> </span><span class=kt>i32</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>                       </span><span class=kd>let</span><span class=na>&#39;s</span><span class=w> </span><span class=n>call</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>lifetime</span><span class=w> </span><span class=n>of</span><span class=w> </span><span class=n>this</span><span class=w> </span><span class=n>reference</span><span class=w> </span><span class=err>`</span><span class=na>&#39;</span><span class=mi>1</span><span class=err>`</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å»æ‰è¯­æ³•ç³–åï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=c1>// è¾“å…¥çš„ç”Ÿå‘½å‘¨æœŸåº”ç”¨åˆ°è¾“å‡ºä¸Š
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>function</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>(</span><span class=n>x</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>i32</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>i32</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>x</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// è¾“å…¥å’Œè¾“å‡ºæœ‰å®ƒä»¬è‡ªå·±ç‹¬æœ‰çš„ç”Ÿå‘½å‘¨æœŸ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>closure</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>for</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=p>,</span><span class=w> </span><span class=na>&#39;b</span><span class=o>&gt;</span><span class=w> </span><span class=o>|</span><span class=n>x</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>i32</span><span class=o>|</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;b</span> <span class=kt>i32</span> <span class=p>{</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// æ³¨æ„ï¼šä¸Šé¢è¿™è¡Œä»£ç ä¸æ˜¯åˆæ³•çš„è¯­æ³•ï¼Œä½†å¯ä»¥è¡¨è¾¾å‡ºæˆ‘ä»¬çš„æ„æ€
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å‡ºç°è¿™ç§å·®å¼‚å¹¶æ²¡æœ‰ä¸€ä¸ªå¥½çš„ç†ç”±ã€‚é—­åŒ…æœ€æ—©çš„å®ç°ç”¨çš„ç±»å‹æ¨æ–­è¯­ä¹‰å’Œå‡½æ•°ä¸åŒï¼Œ ç°åœ¨å˜å¾—æ²¡æ³•æ”¹äº†ï¼Œå› ä¸ºå°†å®ƒä»¬ç»Ÿä¸€èµ·æ¥ä¼šé€ æˆä¸€ä¸ªä¸å…¼å®¹çš„æ”¹åŠ¨ã€‚ é‚£ä¹ˆæˆ‘ä»¬è¦æ€ä¹ˆæ ·æ˜¾å¼æ ‡æ³¨é—­åŒ…çš„ç±»å‹å‘¢ï¼Ÿæˆ‘ä»¬å¯é€‰çš„åŠæ³•æœ‰ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// è½¬æˆtrait objectï¼Œå˜æˆä¸å®šé•¿ç±»å‹ï¼Œç¼–è¯‘é”™è¯¯
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>identity</span>: <span class=nc>dyn</span><span class=w> </span><span class=nb>Fn</span><span class=p>(</span><span class=o>&amp;</span><span class=kt>i32</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=kt>i32</span> <span class=o>=</span><span class=w> </span><span class=o>|</span><span class=n>x</span>: <span class=kp>&amp;</span><span class=kt>i32</span><span class=o>|</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// å¯ä»¥é€šè¿‡å°†å®ƒåˆ†é…åœ¨å †ä¸Šæ¥ç»•è¿‡è¿™ä¸ªé”™è¯¯ï¼Œä½†è¿™æ ·å¾ˆç¬¨é‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>identity</span>: <span class=nb>Box</span><span class=o>&lt;</span><span class=k>dyn</span><span class=w> </span><span class=nb>Fn</span><span class=p>(</span><span class=o>&amp;</span><span class=kt>i32</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=kt>i32</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Box</span>::<span class=n>new</span><span class=p>(</span><span class=o>|</span><span class=n>x</span>: <span class=kp>&amp;</span><span class=kt>i32</span><span class=o>|</span><span class=w> </span><span class=n>x</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ä¹Ÿå¯ä»¥è·³è¿‡åˆ†é…ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªé™æ€çš„å¼•ç”¨
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>identity</span>: <span class=kp>&amp;</span><span class=nc>dyn</span><span class=w> </span><span class=nb>Fn</span><span class=p>(</span><span class=o>&amp;</span><span class=kt>i32</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=kt>i32</span> <span class=o>=</span><span class=w> </span><span class=o>&amp;|</span><span class=n>x</span>: <span class=kp>&amp;</span><span class=kt>i32</span><span class=o>|</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ä¸Šä¸€è¡Œå»æ‰è¯­æ³•ç³–ä¹‹å:)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>identity</span>: <span class=kp>&amp;</span><span class=nb>&#39;static</span> <span class=p>(</span><span class=k>dyn</span><span class=w> </span><span class=k>for</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=nb>Fn</span><span class=p>(</span><span class=o>&amp;</span><span class=na>&#39;a</span><span class=w> </span><span class=kt>i32</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>i32</span> <span class=o>+</span><span class=w> </span><span class=nb>&#39;static</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;|</span><span class=n>x</span>: <span class=kp>&amp;</span><span class=kt>i32</span><span class=o>|</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=kt>i32</span> <span class=p>{</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ç†æƒ³ä¸­çš„å†™æ³•æ˜¯è¿™æ ·çš„ï¼Œä½†è¿™ä¸æ˜¯æœ‰æ•ˆçš„è¯­æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>identity</span>: <span class=nc>impl</span><span class=w> </span><span class=nb>Fn</span><span class=p>(</span><span class=o>&amp;</span><span class=kt>i32</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=kt>i32</span> <span class=o>=</span><span class=w> </span><span class=o>|</span><span class=n>x</span>: <span class=kp>&amp;</span><span class=kt>i32</span><span class=o>|</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// è¿™æ ·ä¹Ÿä¸é”™ï¼Œä½†ä¹Ÿä¸æ˜¯æœ‰æ•ˆçš„è¯­æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>identity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>for</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=w> </span><span class=o>|</span><span class=n>x</span>: <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>i32</span><span class=o>|</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>i32</span> <span class=p>{</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// &#34;impl trait&#34;å¯ä»¥å†™åœ¨å‡½æ•°è¿”å›çš„ä½ç½®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™æ ·å†™
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>fn</span> <span class=nf>return_identity</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>impl</span><span class=w> </span><span class=nb>Fn</span><span class=p>(</span><span class=o>&amp;</span><span class=kt>i32</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=kt>i32</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=o>|</span><span class=n>x</span><span class=o>|</span><span class=w> </span><span class=n>x</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>identity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>return_identity</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// å‰ä¸€ç§è§£å†³æ–¹æ¡ˆæ›´æ³›åŒ–çš„å†™æ³•
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>fn</span> <span class=nf>annotate</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span><span class=w> </span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>f</span>: <span class=nc>F</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>F</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>F</span>: <span class=nb>Fn</span><span class=p>(</span><span class=o>&amp;</span><span class=n>T</span><span class=p>)</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=nc>T</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>f</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>identity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>annotate</span><span class=p>(</span><span class=o>|</span><span class=n>x</span>: <span class=kp>&amp;</span><span class=kt>i32</span><span class=o>|</span><span class=w> </span><span class=n>x</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ç›¸ä¿¡ä½ å·²ç»æ³¨æ„åˆ°ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>å½“é—­åŒ…ç±»å‹ä½¿ç”¨traitçº¦æŸçš„æ—¶å€™ä¼šéµå¾ªä¸€èˆ¬å‡½æ•°çš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™</code>ã€‚</p><p>è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆçœŸæ­£çš„æ•™è®­å’Œæ´å¯Ÿï¼Œåªæ˜¯å®ƒå°±æ˜¯è¿™æ ·çš„è€Œå·²ã€‚</p><p><code>è¦ç‚¹:</code></p><ul><li>æ¯ä¸€é—¨è¯­è¨€éƒ½æœ‰è‡ªå·±çš„å°é™·é˜± ğŸ¤·</li></ul><h3 id=è¯¯è§£11-static-å¼•ç”¨æ€»èƒ½å¼ºåˆ¶è½¬æ¢ä¸º-a-å¼•ç”¨>è¯¯è§£11: &lsquo;static å¼•ç”¨æ€»èƒ½å¼ºåˆ¶è½¬æ¢ä¸º &lsquo;a å¼•ç”¨<a hidden class=anchor aria-hidden=true href=#è¯¯è§£11-static-å¼•ç”¨æ€»èƒ½å¼ºåˆ¶è½¬æ¢ä¸º-a-å¼•ç”¨>#</a></h3><p>æˆ‘å‰é¢ç»™å‡ºäº†è¿™ä¸ªä¾‹å­ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>fn</span> <span class=nf>get_str</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>()</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span><span class=p>;</span><span class=w> </span><span class=c1>// æ³›å‹ç‰ˆæœ¬
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>fn</span> <span class=nf>get_str</span><span class=p>()</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=nb>&#39;static</span> <span class=kt>str</span><span class=p>;</span><span class=w> </span><span class=c1>// &#39;staticç‰ˆæœ¬
</span></span></span></code></pre></td></tr></table></div></div><p>æœ‰çš„è¯»è€…é—®æˆ‘è¿™ä¸¤ä¸ªåœ¨å®è·µä¸­æ˜¯å¦æœ‰åŒºåˆ«ã€‚ä¸€å¼€å§‹æˆ‘ä¹Ÿä¸å¤ªç¡®å®šï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œ åœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„ç ”ç©¶ä¹‹åæˆ‘å‘ç°å®ƒä»¬åœ¨å®è·µä¸­ç¡®å®å­˜åœ¨ç€åŒºåˆ«ã€‚</p><p>æ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨æ“ä½œå€¼å¾—æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lsquo;static å¼•ç”¨æ¥æ›¿æ¢ &lsquo;a å¼•ç”¨ï¼Œ å› ä¸ºRustä¼šè‡ªåŠ¨å°† &lsquo;static å¼•ç”¨å¼ºåˆ¶è½¬æ¢åˆ° &lsquo;a å¼•ç”¨ã€‚ ç›´è§‰ä¸Šæ¥è®²ï¼Œè¿™æ²¡æ¯›ç—…ï¼Œåœ¨ä¸€ä¸ªè¦æ±‚è¾ƒçŸ­ç”Ÿå‘½å‘¨æœŸå¼•ç”¨çš„åœ°æ–¹ä½¿ç”¨ä¸€ä¸ªæœ‰ç€æ›´é•¿çš„ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨ä¸ä¼šé€ æˆå†…å­˜å®‰å…¨é—®é¢˜ã€‚ ä¸‹é¢çš„ä»£ç å’Œæˆ‘ä»¬æƒ³çš„ä¸€æ ·ç¼–è¯‘é€šè¿‡ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>rand</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>generic_str_fn</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>()</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;str&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>static_str_fn</span><span class=p>()</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=nb>&#39;static</span> <span class=kt>str</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;str&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>a_or_b</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>a</span>: <span class=nc>T</span><span class=p>,</span><span class=w> </span><span class=n>b</span>: <span class=nc>T</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>T</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>rand</span>::<span class=n>random</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>b</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>some_string</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;string&#34;</span><span class=p>.</span><span class=n>to_owned</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>some_str</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>some_string</span><span class=p>[</span><span class=o>..</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>str_ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>a_or_b</span><span class=p>(</span><span class=n>some_str</span><span class=p>,</span><span class=w> </span><span class=n>generic_str_fn</span><span class=p>());</span><span class=w> </span><span class=c1>// ç¼–è¯‘é€šè¿‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>str_ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>a_or_b</span><span class=p>(</span><span class=n>some_str</span><span class=p>,</span><span class=w> </span><span class=n>static_str_fn</span><span class=p>());</span><span class=w> </span><span class=c1>// ç¼–è¯‘é€šè¿‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ç„¶è€Œï¼Œè¿™ç§å¼ºåˆ¶è½¬æ¢å¹¶ä¸ä¼šåœ¨å¼•ç”¨ä½œä¸ºå‡½æ•°çš„ç±»å‹ç­¾åçš„ä¸€éƒ¨åˆ†çš„æ—¶å€™å‡ºç°ï¼Œæ‰€ä»¥ä¸‹é¢è¿™æ®µä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>rand</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>generic_str_fn</span><span class=o>&lt;</span><span class=na>&#39;a</span><span class=o>&gt;</span><span class=p>()</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=na>&#39;a</span> <span class=kt>str</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;str&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>static_str_fn</span><span class=p>()</span><span class=w> </span>-&gt; <span class=kp>&amp;</span><span class=nb>&#39;static</span> <span class=kt>str</span> <span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=s>&#34;str&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>a_or_b_fn</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span><span class=w> </span><span class=n>F</span><span class=o>&gt;</span><span class=p>(</span><span class=n>a</span>: <span class=nc>T</span><span class=p>,</span><span class=w> </span><span class=n>b_fn</span>: <span class=nc>F</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>T</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>where</span><span class=w> </span><span class=n>F</span>: <span class=nb>Fn</span><span class=p>()</span><span class=w> </span>-&gt; <span class=nc>T</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>rand</span>::<span class=n>random</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>b_fn</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>some_string</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;string&#34;</span><span class=p>.</span><span class=n>to_owned</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>some_str</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>some_string</span><span class=p>[</span><span class=o>..</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>str_ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>a_or_b_fn</span><span class=p>(</span><span class=n>some_str</span><span class=p>,</span><span class=w> </span><span class=n>generic_str_fn</span><span class=p>);</span><span class=w> </span><span class=c1>// ç¼–è¯‘é€šè¿‡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>str_ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>a_or_b_fn</span><span class=p>(</span><span class=n>some_str</span><span class=p>,</span><span class=w> </span><span class=n>static_str_fn</span><span class=p>);</span><span class=w> </span><span class=c1>// ç¼–è¯‘é”™è¯¯
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>æŠ¥é”™ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=n>error</span><span class=p>[</span><span class=n>E0597</span><span class=p>]</span>: <span class=err>`</span><span class=n>some_string</span><span class=err>`</span><span class=w> </span><span class=n>does</span><span class=w> </span><span class=n>not</span><span class=w> </span><span class=n>live</span><span class=w> </span><span class=n>long</span><span class=w> </span><span class=n>enough</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>-</span>-&gt; <span class=nc>src</span><span class=o>/</span><span class=n>main</span><span class=p>.</span><span class=n>rs</span>:<span class=mi>23</span>:<span class=mi>21</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>23</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=kd>let</span><span class=w> </span><span class=n>some_str</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>some_string</span><span class=p>[</span><span class=o>..</span><span class=p>];</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>|</span><span class=w>                     </span><span class=o>^^^^^^^^^^^</span><span class=w> </span><span class=n>borrowed</span><span class=w> </span><span class=n>value</span><span class=w> </span><span class=n>does</span><span class=w> </span><span class=n>not</span><span class=w> </span><span class=n>live</span><span class=w> </span><span class=n>long</span><span class=w> </span><span class=n>enough</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>..</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>25</span><span class=w> </span><span class=o>|</span><span class=w>     </span><span class=kd>let</span><span class=w> </span><span class=n>str_ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>a_or_b_fn</span><span class=p>(</span><span class=n>some_str</span><span class=p>,</span><span class=w> </span><span class=n>static_str_fn</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>|</span><span class=w>                   </span><span class=o>----------------------------------</span><span class=w> </span><span class=n>argument</span><span class=w> </span><span class=n>requires</span><span class=w> </span><span class=n>that</span><span class=w> </span><span class=err>`</span><span class=n>some_string</span><span class=err>`</span><span class=w> </span><span class=n>is</span><span class=w> </span><span class=n>borrowed</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=err>`</span><span class=nb>&#39;static</span><span class=err>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>26</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=err>`</span><span class=n>some_string</span><span class=err>`</span><span class=w> </span><span class=n>dropped</span><span class=w> </span><span class=n>here</span><span class=w> </span><span class=k>while</span><span class=w> </span><span class=n>still</span><span class=w> </span><span class=n>borrowed</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è¿™ç®—ä¸ç®—Rustçš„å°é™·é˜±è¿˜æœ‰å¾…å•†æ¦·ï¼Œå› ä¸ºè¿™ä¸æ˜¯ &&lsquo;static str åˆ° &&lsquo;a str ç®€å•ç›´æ¥çš„å¼ºåˆ¶è½¬æ¢ï¼Œ è€Œæ˜¯ for<t> Fn() -> &&lsquo;static T åˆ° for&lt;&lsquo;a, T> Fn() -> &&lsquo;a T è¿™ç§æ›´å¤æ‚çš„æƒ…å†µã€‚ å‰è€…æ˜¯å€¼ä¹‹é—´çš„å¼ºåˆ¶è½¬æ¢ï¼Œåè€…æ˜¯ç±»å‹ä¹‹é—´çš„å¼ºåˆ¶è½¬æ¢ã€‚</p><p><code>è¦ç‚¹:</code></p><ul><li>ç­¾åä¸º for&lt;&lsquo;a, T> Fn() -> &&lsquo;a T çš„å‡½æ•°è¦æ¯”ç­¾åä¸º for<t> fn() -> &&lsquo;static T çš„å‡½æ•°æ›´ä¸ºçµæ´»ï¼Œå¹¶ä¸”èƒ½ç”¨åœ¨æ›´å¤šåœºæ™¯ä¸‹</li></ul><h1 id=æ€»ç»“>æ€»ç»“:<a hidden class=anchor aria-hidden=true href=#æ€»ç»“>#</a></h1><ul><li>T æ˜¯ &amp;T å’Œ &amp;mut T çš„è¶…é›†</li><li>&amp;T å’Œ &amp;mut T æ˜¯ä¸ç›¸äº¤çš„é›†åˆ</li><li>T: &lsquo;static åº”è¯¥è¢«è¯»ä½œ &ldquo;T å— &lsquo;static ç”Ÿå‘½å‘¨æœŸçº¦æŸ&rdquo;</li><li>å¦‚æœ T: &lsquo;static é‚£ä¹ˆ T å¯ä»¥æ˜¯ä¸€ä¸ªæœ‰ç€ &lsquo;static ç”Ÿå‘½å‘¨æœŸçš„å€Ÿç”¨ç±»å‹ï¼Œæˆ–æ˜¯ä¸€ä¸ªæ‰€æœ‰æƒç±»å‹</li><li>æ—¢ç„¶ T: &lsquo;static åŒ…å«äº†æ‰€æœ‰æƒç±»å‹ï¼Œé‚£ä¹ˆæ„å‘³ç€ T<ul><li>å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ†é…</li><li>ä¸å¿…åœ¨æ•´ä¸ªç¨‹åºä¸­éƒ½æ˜¯æœ‰æ•ˆçš„</li><li>å¯ä»¥è¢«å®‰å…¨åœ°ä»»æ„ä¿®æ”¹</li><li>å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ææ„</li><li>å¯ä»¥æœ‰ä¸åŒé•¿åº¦çš„ç”Ÿå‘½å‘¨æœŸ</li></ul></li><li>T: &lsquo;a æ¯” &&lsquo;a T æ›´æ³›åŒ–ã€çµæ´»</li><li>T: &lsquo;a æ¥æ”¶æ‰€æœ‰æƒç±»å‹ã€å¸¦å¼•ç”¨çš„æ‰€æœ‰æƒç±»å‹ï¼Œä»¥åŠå¼•ç”¨</li><li>&&lsquo;a T åªæ¥æ”¶å¼•ç”¨</li><li>å¦‚æœ T: &lsquo;static é‚£ä¹ˆ T: &lsquo;aï¼Œå› ä¸ºå¯¹äºæ‰€æœ‰ &lsquo;a éƒ½æœ‰ &lsquo;static >= &lsquo;a</li><li>å‡ ä¹æ‰€æœ‰Rustä»£ç éƒ½æ˜¯æ³›å‹çš„ï¼Œåˆ°å¤„éƒ½æœ‰çœç•¥çš„ç”Ÿå‘½å‘¨æœŸ</li><li>Rustçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™å¹¶ä¸æ˜¯åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å¯¹</li><li>Rustå¹¶ä¸æ¯”ä½ æ›´äº†è§£ä½ ç¨‹åºçš„è¯­ä¹‰</li><li>ç»™ç”Ÿå‘½å‘¨æœŸæ ‡è®°èµ·ä¸€ä¸ªæœ‰æè¿°æ€§çš„åå­—</li><li>è€ƒè™‘æ¸…æ¥šå“ªé‡Œéœ€è¦æ˜¾å¼å†™å‡ºç”Ÿå‘½å‘¨æœŸæ ‡è®°ï¼Œä»¥åŠä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå†™</li><li>æ‰€æœ‰trait objectéƒ½æœ‰é»˜è®¤æ¨æ–­çš„ç”Ÿå‘½å‘¨æœŸçº¦æŸ</li><li>Rustçš„ç¼–è¯‘é”™è¯¯ä¿¡æ¯å¯ä»¥è®©ä½ çš„ä»£ç é€šè¿‡ç¼–è¯‘ï¼Œä½†ä¸ä¸€å®šæ˜¯æœ€ç¬¦åˆä½ ä»£ç è¦æ±‚çš„</li><li>ç”Ÿå‘½å‘¨æœŸæ˜¯åœ¨ç¼–è¯‘æœŸé™æ€éªŒè¯çš„</li><li>ç”Ÿå‘½å‘¨æœŸä¸ä¼šä»¥ä»»ä½•æ–¹å¼åœ¨è¿è¡Œæ—¶å˜é•¿ç¼©çŸ­</li><li>Rustçš„å€Ÿç”¨æ£€æŸ¥æ€»ä¼šä¸ºæ¯ä¸ªå˜é‡é€‰æ‹©ä¸€ä¸ªæœ€çŸ­å¯èƒ½çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”å‡å®šæ¯æ¡ä»£ç è·¯å¾„éƒ½ä¼šè¢«æ‰§è¡Œ</li><li>å°½é‡é¿å…å°†å¯å˜å¼•ç”¨é‡æ–°å€Ÿç”¨ä¸ºä¸å¯å˜å¼•ç”¨ï¼Œä¸ç„¶ä½ ä¼šé‡åˆ°ä¸å°‘éº»çƒ¦</li><li>é‡æ–°å€Ÿç”¨ä¸€ä¸ªå¯å˜å¼•ç”¨ä¸ä¼šç»ˆæ­¢å®ƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œå³ä½¿è¿™ä¸ªå¯å˜å¼•ç”¨å·²ç»ææ„</li><li>æ¯ä¸ªè¯­è¨€éƒ½æœ‰è‡ªå·±çš„å°é™·é˜±</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://reid00.github.io/en/tags/rust/>Rust</a></li></ul><nav class=paginav><a class=prev href=https://reid00.github.io/en/posts/storage/zookeeper%E4%B8%80%E8%87%B4%E4%BF%9D%E8%AF%81/><span class=title>Â« Prev</span><br><span>Zookeeperä¸€è‡´ä¿è¯</span>
</a><a class=next href=https://reid00.github.io/en/posts/storage/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E5%AD%98%E5%82%A8%E6%8A%80%E6%9C%AF/><span class=title>Next Â»</span><br><span>çŸ¥è¯†å›¾è°±å­˜å‚¨æŠ€æœ¯</span></a></nav></footer><script src=https://utteranc.es/client.js repo=Reid00/hugo-blog-talks issue-term=pathname label=Comment theme=github-light crossorigin=anonymous async></script></article></main></body></html>