[{"content":"ä»‹ç» è¿™æ˜¯æˆ‘åšå®¢ Blog çš„åœ°å€ å’Œ Github Repositroyã€‚\næœ¬åšå®¢æ˜¯ç”¨Hugo æ¥ç”Ÿæˆé™æ€ç½‘ç«™ã€‚ Hugo GitHub\nå¹¶é€šè¿‡ GitHub Action æ¥è‡ªåŠ¨åŒ–éƒ¨ç½²åˆ° GitHub Pagesã€‚\næ­å»ºæ­¥éª¤ åˆ›å»ºä»£ç ä»“åº“ é¦–å…ˆæŒ‰ç…§æ–‡æ¡£åˆ›å»º GitHub Pages ç«™ç‚¹ã€‚è¯¥ä»“åº“å¯è§æ€§å¿…é¡»æ˜¯ Publicã€‚\nå¦å¤–åˆ›å»ºä¸€ä¸ªä»“åº“ç”¨æ¥å­˜æ”¾ Hugo çš„æºæ–‡ä»¶ï¼Œåç§°éšæ„ï¼Œè¿™é‡Œå‡è®¾ä»“åº“åå« .github.io.sourceã€‚å»ºè®®å°†ä»“åº“å¯è§æ€§è®¾ç½®æˆ Private ä»¥ä¿æŠ¤å¥½ä½ çš„æºä»£ç ã€‚\nåˆ›å»ºå®Œæ¯•åä½ çš„è´¦æˆ·ä¸‹å°†å­˜åœ¨ä»¥ä¸‹ä¸¤ä¸ªä»£ç ä»“åº“ï¼š\nhttps://github.com/\u0026lt;YourName\u0026gt;/\u0026lt;YourName\u0026gt;.github.io (å…¬å¼€çš„)\nhttps://github.com/\u0026lt;YourName\u0026gt;/\u0026lt;YourName\u0026gt;.github.io.source(ç§æœ‰çš„)\nç”ŸæˆHugo ç½‘ç«™ å®‰è£…Hugo For Windows\nåˆ°Github Release ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼Œç”¨hugo version æˆ–è€…extended version (éƒ¨åˆ†ä¸»é¢˜éœ€è¦extended version æ‰èƒ½ä½¿ç”¨)\nå®‰è£…æ­¥éª¤å‚è€ƒå®˜æ–¹æä¾›\nåœ¨Cç›˜æ–°å»ºHugo/sites ç›®å½•ç”¨äº ç”Ÿæˆhugo é¡¹ç›®\nåœ¨Cç›˜æ–°å»ºHugo/bin ç›®å½•ï¼Œç”¨æ¥å­˜æ”¾ä¸Šé¢è§£å‹åçš„hugo äºŒè¿›åˆ¶æ–‡ä»¶\næ·»åŠ C:\\Hugo\\bin åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­\næ·»åŠ å®Œæˆåï¼Œåœ¨cmd æˆ–è€…å…¶ä»–console ä¸­è¾“å…¥hugo versionæ£€æŸ¥ ç¯å¢ƒå˜é‡æ˜¯å¦æ·»åŠ æˆåŠŸã€‚\nå‡ºç°ä¸‹é¢çš„è¡¨ç¤ºæˆåŠŸã€‚æ³¨æ„ï¼šç¯å¢ƒå˜é‡æ·»åŠ æˆåŠŸåï¼Œè®°å¾—é‡å¯console\nFor mac/linux\nå¯ä»¥åªç”¨ç”¨å‘½ä»¤ä¸‹è½½ï¼Œæ­¤å¤„ä¸å¤šè®²äº†ã€‚\nHugo ç”Ÿæˆç½‘ç«™ åœ¨/c/Hugo/sites ç›®å½•ä¸‹ä½¿ç”¨å‘½ä»¤hugo new site siteNameç”Ÿæˆç½‘ç«™\n1 hugo new site hello-hugo æ‰§è¡ŒæˆåŠŸåï¼ŒHugo ä¼šç»™å‡ºæ¸©é¦¨çš„æç¤ºï¼š\nJust a few more steps and youâ€™re ready to go:\nDownload a theme into the same-named folder. Choose a theme from https://themes.gohugo.io/ or create your own with the â€œhugo new theme â€ command. Perhaps you want to add some content. You can add single files with â€œhugo new .â€. Start the built-in live server via â€œhugo serverâ€.\nå…ˆçœ‹çœ‹æ‰§è¡Œå®Œ hugo new site å‘½ä»¤åï¼ŒHugo ä¸ºæˆ‘ä»¬åšäº†ä»€ä¹ˆã€‚\nè¿›å…¥ hello-hugo ç›®å½•ï¼ŒHugo ç”Ÿæˆçš„å†…å®¹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nè¿™äº›å¤§è‡´ä½œç”¨å¦‚ä¸‹ï¼š\narchetypesï¼šå­˜æ”¾åšå®¢çš„æ¨¡æ¿ï¼Œé»˜è®¤æä¾›äº†ä¸€ä¸ª default.md ä½œä¸ºæ‰€æœ‰åšå®¢çš„æ¨¡æ¿ã€‚ dataï¼šå­˜æ”¾ä¸€äº›æ•°æ®ï¼Œå¦‚ xmlã€json ç­‰ã€‚ layoutsï¼šä¸åšå®¢é¡µé¢å¸ƒå±€ç›¸å…³çš„å†…å®¹ï¼Œå¦‚åšå®¢ç½‘é¡µä¸­çš„ headerã€footer ç­‰ã€‚ staticï¼šå­˜æ”¾é™æ€èµ„æºï¼Œå¦‚å›¾æ ‡ã€å›¾ç‰‡ç­‰ã€‚ themesï¼šä¸»é¢˜ç›¸å…³ã€‚ config.tomlï¼šç«™ç‚¹ã€ä¸»é¢˜ç­‰ç›¸å…³å†…å®¹çš„é…ç½®æ–‡ä»¶ï¼Œå®ƒæ”¯æŒ yamlã€toml å’Œ json æ ¼å¼ï¼Œåç»­å°†ä¼šä¸€ç›´å’Œè¿™ä¸ªæ–‡ä»¶æ‰“äº¤é“ã€‚ å»ºè®®config.toml æ”¹ä¸ºconfig.yaml è¯­æ³•çœ‹ç€æ›´èˆ’æœç‚¹ã€‚\nHugo ä¸»é¢˜ä½¿ç”¨ æ ¹æ®æç¤ºï¼Œè¦ä½¿ç”¨ Hugoï¼Œæˆ‘ä»¬å¿…é¡»å…ˆä¸‹è½½ ä¸»é¢˜ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©è‡ªå·±æ¯”è¾ƒå–œæ¬¢çš„ PaperModã€‚\næ ¹æ®æ–‡æ¡£å®‰è£… hugo ä¸»é¢˜ã€‚\næ–‡æ¡£æä¾›äº†ä¸‰ç§æ–¹å¼ï¼Œå»ºè®®ä½¿ç”¨ç¬¬ä¸€ç§æˆ–è€…ç¬¬äºŒç§ã€‚\nå®‰è£…ä¸»é¢˜ä¹‹åï¼Œåœ¨é¡¹ç›® theme æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆäº†ä¸»é¢˜åç§°çš„æ–‡ä»¶å¤¹ã€‚\n1 2 3 4 5 6 7 8 9 PS C:\\Hugo\\sites\\Reid00.github.io.source\\themes\u0026gt; ls ç›®å½•: C:\\Hugo\\sites\\Reid00.github.io.source\\themes Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 2022/6/6 19:39 PaperMod å»ºè®®ä¿®æ”¹archetypes/defeault.mdï¼Œ ä»¥åhugo new post/1.md æ–°å»ºæ–‡æ¡£çš„æ—¶å€™å°±ä¼šä½¿ç”¨æ”¹æ¨¡æ¿\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 --- title: \u0026#34;{{ replace .Name \u0026#34;-\u0026#34; \u0026#34; \u0026#34; | title }}\u0026#34; date: {{ .Date }} lastmod: {{ .Date }} author: [\u0026#34;Reid\u0026#34;] categories: - tags: - series: - description: \u0026#34;\u0026#34; weight: # è¾“å…¥1å¯ä»¥é¡¶ç½®æ–‡ç« ï¼Œç”¨æ¥ç»™æ–‡ç« å±•ç¤ºæ’åºï¼Œä¸å¡«å°±é»˜è®¤æŒ‰æ—¶é—´æ’åº slug: \u0026#34;\u0026#34; draft: false # æ˜¯å¦ä¸ºè‰ç¨¿ comments: true showToc: true # æ˜¾ç¤ºç›®å½• TocOpen: true # è‡ªåŠ¨å±•å¼€ç›®å½• hidemeta: false # æ˜¯å¦éšè—æ–‡ç« çš„å…ƒä¿¡æ¯ï¼Œå¦‚å‘å¸ƒæ—¥æœŸã€ä½œè€…ç­‰ disableShare: true # åº•éƒ¨ä¸æ˜¾ç¤ºåˆ†äº«æ  showbreadcrumbs: true #é¡¶éƒ¨æ˜¾ç¤ºå½“å‰è·¯å¾„ cover: image: \u0026#34;\u0026#34; caption: \u0026#34;\u0026#34; alt: \u0026#34;\u0026#34; relative: false --- ä¿®æ”¹é¡¹ç›®é…ç½®config.yaml æˆ‘çš„é…ç½®å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 baseURL: \u0026#34;https://reid00.github.io/\u0026#34; # ç»‘å®šçš„åŸŸå languageCode: zh-cn # en-us title: \u0026#34;Reid\u0026#39;s Blog\u0026#34; theme: PaperMod # ä¸»é¢˜åå­—ï¼Œå’Œthemesæ–‡ä»¶å¤¹ä¸‹çš„ä¸€è‡´ enableInlineShortcodes: true enableRobotsTXT: true # å…è®¸çˆ¬è™«æŠ“å–åˆ°æœç´¢å¼•æ“ï¼Œå»ºè®® true buildDrafts: false buildFuture: false buildExpired: false enableEmoji: true # å…è®¸ä½¿ç”¨ Emoji è¡¨æƒ…ï¼Œå»ºè®® true pygmentsUseClasses: true googleAnalytics: UA-123-45 # è°·æ­Œç»Ÿè®¡ Copyright: hasCJKLanguage: true # è‡ªåŠ¨æ£€æµ‹æ˜¯å¦åŒ…å« ä¸­æ–‡æ—¥æ–‡éŸ©æ–‡ å¦‚æœæ–‡ç« ä¸­ä½¿ç”¨äº†å¾ˆå¤šä¸­æ–‡å¼•å·çš„è¯å¯ä»¥å¼€å¯ paginate: 10 # é¦–é¡µæ¯é¡µæ˜¾ç¤ºçš„æ–‡ç« æ•° minify: disableXML: true # minifyOutput: true defaultContentLanguage: en # æœ€é¡¶éƒ¨é¦–å…ˆå±•ç¤ºçš„è¯­è¨€é¡µé¢ defaultContentLanguageInSubdir: true languages: en: languageName: \u0026#34;English\u0026#34; weight: 1 taxonomies: category: categories tag: tags series: series menu: main: - name: Archive url: archives weight: 5 - name: Search url: search/ weight: 7 - name: Categorys url: categories/ weight: 10 - name: Tags url: tags/ weight: 10 outputs: home: - HTML - RSS - JSON params: env: production # to enable google analytics, opengraph, twitter-cards and schema. description: \u0026#34;Reid\u0026#39;s Personal Notes -- https://github.com/Reid00\u0026#34; author: Reid # author: [\u0026#34;Me\u0026#34;, \u0026#34;You\u0026#34;] # multiple authors defaultTheme: auto # disableThemeToggle: true DateFormat: \u0026#34;2006-01-02\u0026#34; ShowShareButtons: false ShowReadingTime: true # disableSpecial1stPost: true displayFullLangName: true ShowPostNavLinks: true ShowBreadCrumbs: true ShowCodeCopyButtons: true ShowRssButtonInSectionTermList: true ShowLastMod: true # æ˜¾ç¤ºæ–‡ç« æ›´æ–°æ—¶é—´ ShowToc: true # æ˜¾ç¤ºç›®å½• TocOpen: true # è‡ªåŠ¨å±•å¼€ç›®å½• comments: true images: [\u0026#34;https://i.loli.net/2021/09/26/3OMGXylm8HUYJ6p.png\u0026#34;] # profileMode: # enabled: false # title: PaperMod # imageUrl: \u0026#34;#\u0026#34; # imageTitle: my image # # imageWidth: 120 # # imageHeight: 120 # buttons: # - name: Archives # url: archives # - name: Tags # url: tags homeInfoParams: Title: \u0026#34;Hi there \\U0001F44B\u0026#34; Content: \u0026gt; Welcome to My Blog. - **Blog** æ˜¯æˆ‘ä¸ªäººçš„ä¸€äº›ç¬”è®° - åŒ…å«Go, Python, æœºå™¨å­¦ä¹ , KV å­˜å‚¨å¼•æ“çš„ä¸€äº›ç›¸å…³ç¬”è®°, æ–¹ä¾¿ä»¥åå¤ä¹  - [GitHubä¸»é¡µ](https://github.com/Reid00) socialIcons: - name: github url: \u0026#34;https://github.com/Reid00\u0026#34; - name: twitter url: \u0026#34;https://twitter.com\u0026#34; - name: RsS url: \u0026#34;index.xml\u0026#34; # editPost: # URL: \u0026#34;https://github.com/adityatelange/hugo-PaperMod/tree/exampleSite/content\u0026#34; # Text: \u0026#34;Suggest Changes\u0026#34; # edit text # appendFilePath: true # to append file path to Edit link # label: # text: \u0026#34;Home\u0026#34; # icon: icon.png # iconHeight: 35 # analytics: # google: # SiteVerificationTag: \u0026#34;XYZabc\u0026#34; # assets: # favicon: \u0026#34;\u0026lt;link / abs url\u0026gt;\u0026#34; # favicon16x16: \u0026#34;\u0026lt;link / abs url\u0026gt;\u0026#34; # favicon32x32: \u0026#34;\u0026lt;link / abs url\u0026gt;\u0026#34; # apple_touch_icon: \u0026#34;\u0026lt;link / abs url\u0026gt;\u0026#34; # safari_pinned_tab: \u0026#34;\u0026lt;link / abs url\u0026gt;\u0026#34; cover: responsiveImages: false # ä»…ä»…ç”¨åœ¨Page Bundleæƒ…å†µä¸‹ï¼Œæ­¤å¤„ä¸è®¨è®º hidden: false # hide everywhere but not in structured data hiddenInList: false # hide on list pages and home hiddenInSingle: false # hide on single page # fuseOpts: # isCaseSensitive: false # shouldSort: true # location: 0 # distance: 1000 # threshold: 0.4 # minMatchCharLength: 0 # keys: [\u0026#34;title\u0026#34;, \u0026#34;permalink\u0026#34;, \u0026#34;summary\u0026#34;, \u0026#34;content\u0026#34;] markup: goldmark: renderer: unsafe: true highlight: # anchorLineNos: true codeFences: true guessSyntax: true lineNos: true noClasses: false style: monokai privacy: vimeo: disabled: false simple: true twitter: disabled: false enableDNT: true simple: true instagram: disabled: false simple: true youtube: disabled: false privacyEnhanced: true services: instagram: disableInlineCSS: true twitter: disableInlineCSS: true æ–°å»ºhugo ç½‘é¡µ è¿™æ—¶å€™ä¸»é¢˜å·²ç»æ¿€æ´»äº†ï¼Œæˆ‘ä»¬å…ˆå¾€åšå®¢ä¸­æ·»åŠ ä¸€ç¯‡æ–‡ç« ï¼Œhugo new post/first.mdï¼š\n1 2 hugo new post/first.md hugo new post/second.md æ­¤å¤„è§‚çœ‹content ç›®å½•ï¼Œä¼šç”Ÿæˆposts æ–‡ä»¶å¤¹\n1 2 3 4 5 6 7 8 9 10 11 12 13 PS C:\\Hugo\\sites\\Reid00.github.io.source\\content\u0026gt; tree /F æ–‡ä»¶å¤¹ PATH åˆ—è¡¨ å·åºåˆ—å·ä¸º E2D5-548C C:. â”‚ archives.md â”‚ search.md â”‚ â””â”€post 4th.md first.md second.md test.md third.md å¦å¤–è¦ä½¿ç”¨ Archive å’Œ Searchï¼Œéœ€è¦è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š\nåœ¨ content ä¸‹å¢åŠ  archives.md æ–‡ä»¶ï¼Œå…·ä½“ä½ç½®å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 . â”œâ”€â”€ content/ â”‚ â”œâ”€â”€ archives.md \u0026lt;--- Create archive.md here â”‚ â””â”€â”€ posts/ â”œâ”€â”€ static/ â””â”€â”€ themes/ â””â”€â”€ PaperMod/ archives.md å†…å®¹ä¸ºï¼š\n1 2 3 4 5 6 --- title: \u0026#34;Archive\u0026#34; layout: \u0026#34;archives\u0026#34; url: \u0026#34;/archives\u0026#34; summary: \u0026#34;archives\u0026#34; --- åŒæ ·åœ¨ content æ–°å¢ä¸€ä¸ª search.mdï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 --- title: \u0026#34;Search\u0026#34; # in any language you want layout: \u0026#34;search\u0026#34; # is necessary # url: \u0026#34;/archive\u0026#34; description: \u0026#34;Search part\u0026#34; summary: \u0026#34;search\u0026#34; --- æŸ¥çœ‹ç½‘ç«™æ•ˆæœ: åœ¨é¡¹ç›®ç›®å½•c/hugo/sites/projectName ç›®å½•ä¸‹è¾“å…¥hugo server -D\nçœ‹åˆ°ä¸€ä¸‹è¾“å‡º, è¡¨ç¤ºå¯ä»¥è®¿é—® http://localhost:1313/ æŸ¥çœ‹æ•ˆæœï¼Œå¦‚æœæœ‰å…¶ä»–ä¸æ»¡æ„çš„åœ°æ–¹ï¼Œå¯ä»¥è‡ªè¡ŒæŸ¥æ‰¾å…¶ä»–èµ„æ–™ä¿®æ”¹é…ç½®ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 Start building sites â€¦ hugo v0.100.0-27b077544d8efeb85867cb4cfb941747d104f765+extended windows/amd64 BuildDate=2022-05-31T08:37:12Z VendorInfo=gohugoio | EN -------------------+----- Pages | 20 Paginator pages | 0 Non-page files | 0 Static files | 0 Processed images | 0 Aliases | 2 Sitemaps | 1 Cleaned | 0 Built in 98 ms Watching for changes in C:\\Hugo\\sites\\Reid00.github.io.source\\{archetypes,content,data,layouts,static,themes} Watching for config changes in C:\\Hugo\\sites\\Reid00.github.io.source\\config.yaml Environment: \u0026#34;development\u0026#34; Serving pages from memory Running in Fast Render Mode. For full rebuilds on change: hugo server --disableFastRender Web Server is available at http://localhost:1313/ (bind address 127.0.0.1) Press Ctrl+C to stop æ•ˆæœå¦‚ä¸‹ï¼š\néƒ¨ç½²åˆ°GitHub pages ä¸¤ç§æ–¹å¼:\nhugo å‘½ä»¤åç”Ÿæˆpublic æ–‡ä»¶å¤¹ï¼Œå°†public å•ç‹¬push åˆ°.github.io ä»“åº“ æ˜¯å°†æ•´ä¸ªé¡¹ç›®éƒ¨ç½²åˆ°.github.io.source ä»“åº“ï¼Œé€šè¿‡github action è‡ªåŠ¨éƒ¨ç½² SSH è¿™é‡Œéœ€è¦é‡æ–°ç”Ÿæˆä¸€å¯¹å¯†é’¥ï¼Œä½¿ç”¨ä¹‹å‰ç”¨æ¥é…ç½®è¿‡ Github çš„å¯†é’¥ä¸èƒ½åœ¨è¿™é‡Œä½¿ç”¨å•¦ï¼Œä¼šæŠ¥é”™æç¤ºå·²ç»è¢«ä½¿ç”¨è¿‡å•¦ã€‚\n1 2 3 4 5 6 7 8 9 10 ssh-keygen -t rsa - -C \u0026#34;$(git config user.email)\u0026#34; # æ³¨æ„ï¼šè¿™æ¬¡ä¸è¦ç›´æ¥å›è½¦ï¼Œä»¥å…è¦†ç›–ä¹‹å‰ç”Ÿæˆçš„ # ç¡®è®¤ç§˜é’¥çš„ä¿å­˜è·¯å¾„ï¼ˆå¦‚æœä¸éœ€è¦æ”¹è·¯å¾„åˆ™ç›´æ¥å›è½¦ï¼‰ï¼›å¦‚æœå·²ç»æœ‰ç§˜é’¥æ–‡ä»¶ï¼Œåˆ™éœ€è¦æ¢ä¸€ä¸ªè·¯å¾„ï¼Œé¿å…è¦†ç›–æ‰ï¼Œå¦‚æˆ‘æ›´æ”¹ä¹‹åçš„è·¯å¾„ä¸º /home/kearney/.ssh_action/id_rsaï¼› # åˆ›å»ºå¯†ç ï¼ˆå¦‚æœä¸éœ€è¦å¯†ç åˆ™ç›´æ¥å›è½¦ï¼‰ï¼› # ç¡®è®¤å¯†ç ï¼ˆå¦‚æœä¸éœ€è¦å¯†ç åˆ™ç›´æ¥å›è½¦ï¼‰ï¼Œç”Ÿæˆç»“æŸï¼› # æŸ¥çœ‹å…¬é’¥ï¼Œè·¯å¾„éœ€è¦æ”¹ä¸ºä½ ä¸Šé¢çš„è®¾ç½® cat ~/.ssh_action/id_rsa.pub # æŸ¥çœ‹ç§é’¥ cat ~/.ssh_action/id_rsa Page ä»“åº“ Reid00/ Reid00.github.io ä¸­ï¼Œç‚¹å‡» Setting - Deploy keys - Add deploy keyï¼Œåç§°éšæ„ï¼Œç²˜è´´è¿›å»åˆšç”Ÿæˆçš„å…¬é’¥ï¼ŒåŠ¡å¿…å‹¾é€‰ Allow write access ã€‚ç‚¹å‡»ä¿å­˜ã€‚\næºç ä»“åº“ Reid00/ Reid00.github.io.source ã€‚ç‚¹å‡» Setting - Secrets - New repo secrets ï¼Œåç§°åŠ¡å¿…è®¾ç½®ä¸º ACTIONS_DEPLOY_KEYï¼Œ æ·»åŠ åˆšåˆšç”Ÿæˆçš„ç§é’¥(id_rsa)ï¼Œå˜é‡åç§°æ˜¯è¦åœ¨ action çš„é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨çš„ï¼Œå› æ­¤è¦ä¿æŒç»Ÿä¸€ï¼Œå¯ä¿®æ”¹ä¸ºåˆ«çš„åç§°ï¼Œä½†è¦ç›¸åŒå³å¯ã€‚\nå°†é¡¹ç›®hello-hugo æ¨é€åˆ° Reid00.github.io.source ä»“åº“ è®²åˆ°è¿™é‡Œçªç„¶å‘ç°è¿˜æ²¡æœ‰è®²ï¼ŒæŠŠé¡¹ç›®æ¨é€åˆ°githubï¼Œæ–¹å¼å¦‚ä¸‹:\næ­¤å¤„æœ¬è´¨å°±æ˜¯ç”¨git åˆ›å»ºé¡¹ç›®ï¼Œæ¨é€åˆ°Github å¦‚æœå‡ºç°é”™è¯¯ï¼Œè¯·è‡ªè¡Œæœç´¢æ’æŸ¥ã€‚\n1 2 3 4 5 6 git init git remote add origin git@github.com:Reid00/Reid00.github.io.source.git git add . git commit -m \u0026#39;init\u0026#39; git push -f --set-upstream origin master é…ç½® Github Action åœ¨æºç è·Ÿç›®å½•ä¸‹æ–°å»º /.github/workflows/github-actions-demo.ymlï¼Œå†…å®¹å¦‚ä¸‹ï¼Œéœ€è¦æ›´æ”¹çš„åœ°æ–¹ä¸º Page ä»“åº“ã€åˆ†æ”¯ã€‚\nyml push ä¸Šå»ä¹‹åï¼Œå†æ›´æ–°ä¸‹æ–‡ç« ï¼Œç›´æ¥ push æºç ï¼Œåå°å°±ä¼šè‡ªåŠ¨ç”Ÿæˆå¹¶å‘å¸ƒåˆ° Page ä»“åº“ã€‚\næµ‹è¯•è‰¯å¥½ï¼Œä½†ä¹Ÿå‘ç°äº†ä¸€äº›é—®é¢˜ï¼Œæœ¬äººå¯¹ Action äº†è§£ä¸å¤Ÿæ·±ï¼ŒçŒœæµ‹æ˜¯ yml æ²¡æŠ„å¥½ã€‚ä¸€ä¸ªé—®é¢˜æ˜¯æºç ä»“åº“ä¸­ public æŒ‡å‘çš„ç½‘é¡µä»“åº“çš„ commit æ ‡å¿—æœªæ›´æ–°ï¼Œä½†å®é™…ä¸Šå¯¹äºçš„ç½‘é¡µå·²ç»æ›´æ–°åˆ° Page ä¸­äº†ï¼Œä¸è¿‡è¿™ä¸å½±å“ç½‘é¡µå‘å¸ƒï¼Œæš‚ä¸è€ƒè™‘è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\nå…¶æ¬¡æ˜¯æˆ‘çš„ submodule ä¸»é¢˜ä¸­æœ‰ä¸ªåœ¨ gitee ä¸­ï¼Œéœ€è¦ç§»å›åˆ° github å¹¶è®¾ç½®ï¼Œè¿˜æœ‰ public ä¹Ÿæ˜¯ï¼Œé‚£ä¹ˆå¹²è„†å°±å°†è¿™äº› submodule å–æ¶ˆæ‰çš„äº†ï¼Œç›´æ¥å¹¶å…¥æºç ä»“åº“ï¼Œä¹Ÿä¸è¦è€ƒè™‘å•¥ commit æŒ‡é’ˆæ ‡è®°äº†ã€‚\né‡åˆ°é—®é¢˜ ç½‘ç«™css é”™ä¹±\nå‚è€ƒæ­¤å¤„ Fixing the CSS Integrity Digest Error in Hugo\nwindows git add çš„æ—¶å€™LF ä¼šç”¨CRLF æ›¿æ¢ï¼Œéœ€è¦å¯¹git è¿›è¡Œè®¾ç½®ã€‚\nå‚è€ƒæ–‡ç« ç¬¬äºŒç§æ–¹æ³•è§£å†³\nå•ç‹¬ å°†public push åˆ°github pages ä»“åº“å¯ä»¥ç”¨ï¼Œä½†æ˜¯Github Action æ¨é€åï¼ŒGithub pages ä¸»é¡µå˜æˆäº†index.xml ä¸æ˜¯index.htmlï¼Œä¸å¯ç”¨?\nåŸå› ï¼špublic é‡Œé¢åˆgithub pages çš„.git æ–‡ä»¶å¤¹ï¼Œä¼šå¯¼è‡´workflowé‚£è¾¹submodules å‡ºé”™ã€‚\nåˆ é™¤.git æ–‡ä»¶å¤¹ åœ¨ä¸config.yaml åŒçº§ç›®å½•ä¸‹æ·»åŠ .gitmodules 1 2 3 4 5 6 7 8 C:. â”‚ .gitmodules â”‚ config.yaml â”‚ README.md [submodule \u0026#34;themes/PaperMod\u0026#34;] path = themes/PaperMod url = https://github.com/adityatelange/hugo-PaperMod.git ","permalink":"https://reid00.github.io/en/posts/other/hugo%E6%90%AD%E5%BB%BA%E5%8D%9A%E5%AE%A2%E5%B9%B6%E7%94%A8githubaction%E9%83%A8%E7%BD%B2/","summary":"ä»‹ç» è¿™æ˜¯æˆ‘åšå®¢ Blog çš„åœ°å€ å’Œ Github Repositroyã€‚\næœ¬åšå®¢æ˜¯ç”¨Hugo æ¥ç”Ÿæˆé™æ€ç½‘ç«™ã€‚ Hugo GitHub\nå¹¶é€šè¿‡ GitHub Action æ¥è‡ªåŠ¨åŒ–éƒ¨ç½²åˆ° GitHub Pagesã€‚\næ­å»ºæ­¥éª¤ åˆ›å»ºä»£ç ä»“åº“ é¦–å…ˆæŒ‰ç…§æ–‡æ¡£åˆ›å»º GitHub Pages ç«™ç‚¹ã€‚è¯¥ä»“åº“å¯è§æ€§å¿…é¡»æ˜¯ Publicã€‚\nå¦å¤–åˆ›å»ºä¸€ä¸ªä»“åº“ç”¨æ¥å­˜æ”¾ Hugo çš„æºæ–‡ä»¶ï¼Œåç§°éšæ„ï¼Œè¿™é‡Œå‡è®¾ä»“åº“åå« .github.io.sourceã€‚å»ºè®®å°†ä»“åº“å¯è§æ€§è®¾ç½®æˆ Private ä»¥ä¿æŠ¤å¥½ä½ çš„æºä»£ç ã€‚\nåˆ›å»ºå®Œæ¯•åä½ çš„è´¦æˆ·ä¸‹å°†å­˜åœ¨ä»¥ä¸‹ä¸¤ä¸ªä»£ç ä»“åº“ï¼š\nhttps://github.com/\u0026lt;YourName\u0026gt;/\u0026lt;YourName\u0026gt;.github.io (å…¬å¼€çš„)\nhttps://github.com/\u0026lt;YourName\u0026gt;/\u0026lt;YourName\u0026gt;.github.io.source(ç§æœ‰çš„)\nç”ŸæˆHugo ç½‘ç«™ å®‰è£…Hugo For Windows\nåˆ°Github Release ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼Œç”¨hugo version æˆ–è€…extended version (éƒ¨åˆ†ä¸»é¢˜éœ€è¦extended version æ‰èƒ½ä½¿ç”¨)\nå®‰è£…æ­¥éª¤å‚è€ƒå®˜æ–¹æä¾›\nåœ¨Cç›˜æ–°å»ºHugo/sites ç›®å½•ç”¨äº ç”Ÿæˆhugo é¡¹ç›®\nåœ¨Cç›˜æ–°å»ºHugo/bin ç›®å½•ï¼Œç”¨æ¥å­˜æ”¾ä¸Šé¢è§£å‹åçš„hugo äºŒè¿›åˆ¶æ–‡ä»¶\næ·»åŠ C:\\Hugo\\bin åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­\næ·»åŠ å®Œæˆåï¼Œåœ¨cmd æˆ–è€…å…¶ä»–console ä¸­è¾“å…¥hugo versionæ£€æŸ¥ ç¯å¢ƒå˜é‡æ˜¯å¦æ·»åŠ æˆåŠŸã€‚\nå‡ºç°ä¸‹é¢çš„è¡¨ç¤ºæˆåŠŸã€‚æ³¨æ„ï¼šç¯å¢ƒå˜é‡æ·»åŠ æˆåŠŸåï¼Œè®°å¾—é‡å¯console\nFor mac/linux\nå¯ä»¥åªç”¨ç”¨å‘½ä»¤ä¸‹è½½ï¼Œæ­¤å¤„ä¸å¤šè®²äº†ã€‚\nHugo ç”Ÿæˆç½‘ç«™ åœ¨/c/Hugo/sites ç›®å½•ä¸‹ä½¿ç”¨å‘½ä»¤hugo new site siteNameç”Ÿæˆç½‘ç«™","title":"Hugoæ­å»ºåšå®¢å¹¶ç”¨GitHubActionéƒ¨ç½²"},{"content":"ä»‹ç» æˆ‘æ›¾ç»æœ‰è¿‡çš„æ‰€æœ‰è¿™äº›å¯¹ç”Ÿå‘½å‘¨æœŸçš„è¯¯è§£ï¼Œç°åœ¨æœ‰å¾ˆå¤šåˆå­¦è€…ä¹Ÿæ·±é™·äºæ­¤ã€‚ æˆ‘ç”¨åˆ°çš„æœ¯è¯­å¯èƒ½ä¸æ˜¯æ ‡å‡†çš„ï¼Œæ‰€ä»¥ä¸‹é¢åˆ—äº†ä¸€ä¸ªè¡¨æ ¼æ¥è§£é‡Šå®ƒä»¬çš„ç”¨æ„ã€‚\nçŸ­è¯­ æ„ä¸º T åŒ…å«äº†æ‰€æœ‰å¯èƒ½ç±»å‹çš„é›†åˆ æˆ– è¿™ä¸ªé›†åˆä¸­çš„ç±»å‹ æ‰€æœ‰æƒç±»å‹ ä¸å«å¼•ç”¨çš„ç±»å‹, ä¾‹å¦‚ i32, String, Vec, ç­‰ å€Ÿç”¨ç±»å‹ æˆ– å¼•ç”¨ç±»å‹ ä¸è€ƒè™‘å¯å˜æ€§çš„å¼•ç”¨ç±»å‹, ä¾‹å¦‚ \u0026amp;i32, \u0026amp;mut i32 ç­‰ å¯å˜å¼•ç”¨ æˆ– ç‹¬å å¼•ç”¨ ç‹¬å çš„å¯å˜å¼•ç”¨, å³ \u0026amp;mut T ä¸å¯å˜å¼•ç”¨ æˆ– å…±äº«å¼•ç”¨ å…±äº«çš„ä¸å¯å˜å¼•ç”¨, å³ \u0026amp;T è¯¯è§£é¡¹ ç®€è€Œè¨€ä¹‹ï¼šå˜é‡çš„ç”Ÿå‘½å‘¨æœŸæŒ‡çš„æ˜¯è¿™ä¸ªå˜é‡æ‰€æŒ‡çš„æ•°æ®å¯ä»¥è¢«ç¼–è¯‘å™¨é™æ€éªŒè¯çš„ã€åœ¨å½“å‰å†…å­˜åœ°å€æœ‰æ•ˆæœŸçš„é•¿åº¦ã€‚\nè¯¯è§£1: T åªåŒ…å«æ‰€æœ‰æƒç±»å‹ è¿™ä¸ªè¯¯è§£æ¯”èµ·è¯´ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒå’Œæ³›å‹æ›´ç›¸å…³ï¼Œä½†åœ¨Rustä¸­æ³›å‹å’Œç”Ÿå‘½å‘¨æœŸæ˜¯ç´§å¯†è”ç³»åœ¨ä¸€èµ·çš„ï¼Œä¸å¯åªè°ˆå…¶ä¸€ã€‚\nå½“æˆ‘åˆšå¼€å§‹å­¦ä¹ Rustçš„æ—¶å€™ï¼Œæˆ‘ç†è§£i32ï¼Œ\u0026amp;i32ï¼Œå’Œ\u0026amp;mut i32æ˜¯ä¸åŒçš„ç±»å‹ï¼Œä¹Ÿæ˜ç™½æ³›å‹å˜é‡Tä»£è¡¨ç€æ‰€æœ‰å¯èƒ½ç±»å‹çš„é›†åˆã€‚ ä½†å°½ç®¡è¿™äºŒè€…åˆ†å¼€éƒ½æ‡‚ï¼Œå½“å®ƒä»¬ç»“åˆåœ¨ä¸€èµ·çš„æ—¶å€™æˆ‘å´é™·å…¥å›°æƒ‘ã€‚åœ¨æˆ‘è¿™ä¸ªRuståˆå­¦è€…çš„çœ¼ä¸­ï¼Œæ³›å‹æ˜¯è¿™æ ·çš„è¿ä½œçš„ï¼š\nç±»å‹å˜é‡ T \u0026amp;T \u0026amp;mut T ä¾‹å­ i32 \u0026amp;i32 \u0026amp;mut i32 T åŒ…å«ä¸€åˆ‡æ‰€æœ‰æƒç±»å‹ï¼› \u0026amp;T åŒ…å«ä¸€åˆ‡ä¸å¯å˜å€Ÿç”¨ç±»å‹ï¼› \u0026amp;mut T åŒ…å«ä¸€åˆ‡å¯å˜å€Ÿç”¨ç±»å‹ã€‚ Tï¼Œ \u0026amp;Tï¼Œ å’Œ \u0026amp;mut T æ˜¯ä¸ç›¸äº¤çš„æœ‰é™é›†ã€‚ ç®€æ´æ˜äº†ï¼Œç¬¦åˆç›´è§‰ï¼Œä½†å´å®Œå…¨é”™è¯¯ã€‚ ä¸‹é¢è¿™æ‰æ˜¯æ³›å‹çœŸæ­£çš„è¿ä½œæ–¹å¼ï¼š ç±»å‹å˜é‡ T \u0026amp;T \u0026amp;mut T ä¾‹å­ i32, \u0026amp;i32, \u0026amp;mut i32, \u0026amp;\u0026amp;i32, \u0026amp;mut \u0026amp;mut i32, \u0026hellip; \u0026amp;i32, \u0026amp;\u0026amp;i32, \u0026amp;\u0026amp;mut i32, \u0026hellip; \u0026amp;mut i32, \u0026amp;mut \u0026amp;mut i32, \u0026amp;mut \u0026amp;i32, \u0026hellip; T, \u0026amp;T, å’Œ \u0026amp;mut T éƒ½æ˜¯æ— é™é›†, å› ä¸ºä½ å¯ä»¥æ— é™å€Ÿç”¨ä¸€ä¸ªç±»å‹ã€‚ T æ˜¯ \u0026amp;T å’Œ \u0026amp;mut Tçš„è¶…é›†. \u0026amp;T å’Œ \u0026amp;mut T æ˜¯ä¸ç›¸äº¤çš„é›†åˆã€‚ è®©æˆ‘ä»¬ç”¨å‡ ä¸ªä¾‹å­æ¥æ£€éªŒä¸€ä¸‹è¿™äº›æ¦‚å¿µ:\n1 2 3 4 5 6 7 trait Trait {} impl\u0026lt;T\u0026gt; Trait for T {} impl\u0026lt;T\u0026gt; Trait for \u0026amp;T {} // ç¼–è¯‘é”™è¯¯ impl\u0026lt;T\u0026gt; Trait for \u0026amp;mut T {} // ç¼–è¯‘é”™è¯¯ ä¸Šé¢çš„ä»£ç å¹¶ä¸èƒ½å¦‚æ„¿ç¼–è¯‘:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 error[E0119]: conflicting implementations of trait `Trait` for type `\u0026amp;_`: --\u0026gt; src/lib.rs:5:1 | 3 | impl\u0026lt;T\u0026gt; Trait for T {} | ------------------- first implementation here 4 | 5 | impl\u0026lt;T\u0026gt; Trait for \u0026amp;T {} | ^^^^^^^^^^^^^^^^^^^^ conflicting implementation for `\u0026amp;_` error[E0119]: conflicting implementations of trait `Trait` for type `\u0026amp;mut _`: --\u0026gt; src/lib.rs:7:1 | 3 | impl\u0026lt;T\u0026gt; Trait for T {} | ------------------- first implementation here ... 7 | impl\u0026lt;T\u0026gt; Trait for \u0026amp;mut T {} | ^^^^^^^^^^^^^^^^^^^^^^^^ conflicting implementation for `\u0026amp;mut _ ç¼–è¯‘å™¨ä¸å…è®¸æˆ‘ä»¬ä¸º\u0026amp;Tå’Œ\u0026amp;mut Tå®ç°Traitï¼Œå› ä¸ºè¿™æ ·ä¼šä¸ä¸ºTå®ç°çš„Traitå†²çªï¼Œ Tæœ¬èº«å·²ç»åŒ…å«äº†æ‰€æœ‰\u0026amp;Tå’Œ\u0026amp;mut Tã€‚ä¸‹é¢çš„ä»£ç èƒ½å¤Ÿå¦‚æ„¿ç¼–è¯‘ï¼Œå› ä¸º\u0026amp;Tå’Œ\u0026amp;mut Tæ˜¯ä¸ç›¸äº¤çš„ï¼š\n1 2 3 4 5 trait Trait {} impl\u0026lt;T\u0026gt; Trait for \u0026amp;T {} // ç¼–è¯‘é€šè¿‡ impl\u0026lt;T\u0026gt; Trait for \u0026amp;mut T {} // ç¼–è¯‘é€šè¿‡ è¦ç‚¹:\nT æ˜¯ \u0026amp;T å’Œ \u0026amp;mut Tçš„è¶…é›† \u0026amp;T å’Œ \u0026amp;mut T æ˜¯ä¸ç›¸äº¤çš„é›†åˆ è¯¯è§£2: å¦‚æœ T: \u0026lsquo;static é‚£ä¹ˆ T å¿…é¡»åœ¨æ•´ä¸ªç¨‹åºè¿è¡Œä¸­éƒ½æ˜¯æœ‰æ•ˆçš„ è¯¯è§£æ¨è®º\nT: \u0026lsquo;static åº”è¯¥è¢«çœ‹ä½œ \u0026quot; T æ‹¥æœ‰ \u0026lsquo;static ç”Ÿå‘½å‘¨æœŸ \u0026quot; \u0026amp;\u0026lsquo;static T å’Œ T: \u0026lsquo;static æ²¡æœ‰åŒºåˆ« å¦‚æœ T: \u0026lsquo;static é‚£ä¹ˆ T å¿…é¡»ä¸ºä¸å¯å˜çš„ å¦‚æœ T: \u0026lsquo;static é‚£ä¹ˆ T åªèƒ½åœ¨ç¼–è¯‘æœŸåˆ›å»º å¤§éƒ¨åˆ†Ruståˆå­¦è€…æ˜¯ä»ç±»ä¼¼ä¸‹é¢è¿™ä¸ªä»£ç ç¤ºä¾‹ä¸­æ¥è§¦åˆ° \u0026lsquo;static ç”Ÿå‘½å‘¨æœŸçš„ï¼š\n1 2 3 fn main() { let str_literal: \u0026amp;\u0026#39;static str = \u0026#34;str literal\u0026#34;; } ä»–ä»¬è¢«å‘ŠçŸ¥ \u0026ldquo;str literal\u0026rdquo; æ˜¯ç¡¬ç¼–ç åœ¨ç¼–è¯‘å‡ºæ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„ï¼Œ å¹¶ä¼šåœ¨è¿è¡Œæ—¶è¢«åŠ è½½åˆ°åªè¯»å†…å­˜ï¼Œæ‰€ä»¥å¿…é¡»æ˜¯ä¸å¯å˜çš„ä¸”åœ¨æ•´ä¸ªç¨‹åºçš„è¿è¡Œä¸­éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œ è¿™å°±æ˜¯å®ƒæˆä¸º \u0026lsquo;static çš„åŸå› ã€‚ è€Œè¿™äº›è§‚å¿µåˆè¿›ä¸€æ­¥è¢«ç”¨ static å…³é”®å­—æ¥å®šä¹‰é™æ€å˜é‡çš„è§„åˆ™æ‰€åŠ å¼ºã€‚\n1 2 3 4 5 6 7 8 9 10 11 static BYTES: [u8; 3] = [1, 2, 3]; static mut MUT_BYTES: [u8; 3] = [1, 2, 3]; fn main() { MUT_BYTES[0] = 99; // ç¼–è¯‘é”™è¯¯ï¼Œä¿®æ”¹é™æ€å˜é‡æ˜¯unsafeçš„ unsafe { MUT_BYTES[0] = 99; assert_eq!(99, MUT_BYTES[0]); } } è®¤ä¸ºé™æ€å˜é‡\nåªå¯ä»¥åœ¨ç¼–è¯‘æœŸåˆ›å»º å¿…é¡»æ˜¯ä¸å¯å˜çš„ï¼Œä¿®æ”¹å®ƒä»¬æ˜¯unsafeçš„ åœ¨æ•´ä¸ªç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­éƒ½æ˜¯æœ‰æ•ˆçš„ \u0026lsquo;static ç”Ÿå‘½å‘¨æœŸå¤§æ¦‚æ˜¯ä»¥é™æ€å˜é‡çš„é»˜è®¤ç”Ÿå‘½å‘¨æœŸå‘½åçš„ï¼Œå¯¹å§ï¼Ÿ é‚£ä¹ˆæœ‰ç†ç”±è®¤ä¸º\u0026rsquo;staticç”Ÿå‘½å‘¨æœŸä¹Ÿåº”è¯¥éµå®ˆç›¸åŒçš„è§„åˆ™ï¼Œä¸æ˜¯å—ï¼Ÿ\næ˜¯çš„ï¼Œä½†æ‹¥æœ‰'staticç”Ÿå‘½å‘¨æœŸçš„ç±»å‹ä¸'staticçº¦æŸçš„ç±»å‹æ˜¯ä¸åŒçš„ã€‚ åè€…èƒ½åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ†é…ï¼Œå¯ä»¥å®‰å…¨åœ°ã€è‡ªç”±åœ°ä¿®æ”¹ï¼Œå¯ä»¥è¢«dropï¼Œ è¿˜å¯ä»¥æœ‰ä»»æ„é•¿åº¦çš„ç”Ÿå‘½å‘¨æœŸã€‚\nåœ¨è¿™ä¸ªç‚¹ï¼Œå¾ˆé‡è¦çš„æ˜¯è¦åŒºåˆ† \u0026amp;'static T å’Œ T: 'staticã€‚\n\u0026amp;'static T æ˜¯å¯¹æŸä¸ªTçš„ä¸å¯å˜å¼•ç”¨ï¼Œè¿™ä¸ªå¼•ç”¨å¯ä»¥è¢«æ— é™æœŸåœ°æŒæœ‰ç›´åˆ°ç¨‹åºç»“æŸã€‚ è¿™åªå¯èƒ½å‘ç”Ÿåœ¨Tæœ¬èº«ä¸å¯å˜ä¸”ä¸ä¼šåœ¨å¼•ç”¨è¢«åˆ›å»ºåç§»åŠ¨çš„æƒ…å†µä¸‹ã€‚ Tå¹¶ä¸éœ€è¦åœ¨ç¼–è¯‘æœŸå°±è¢«åˆ›å»ºï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆéšæœºæ•°æ®ï¼Œ ç„¶åä»¥å†…å­˜æ³„æ¼ä¸ºä»£ä»·è¿”å›\u0026rsquo;staticå¼•ç”¨ï¼Œä¾‹å¦‚ï¼š\n1 2 3 4 5 6 7 use rand; // åœ¨è¿è¡Œæ—¶ç”Ÿæˆéšæœº\u0026amp;\u0026#39;static str fn rand_str_generator() -\u0026gt; \u0026amp;\u0026#39;static str { let rand_string = rand::random::\u0026lt;u64\u0026gt;().to_string(); Box::leak(rand_string.into_boxed_str()) } T: 'static æ˜¯æŒ‡Tå¯ä»¥è¢«æ— é™æœŸå®‰å…¨åœ°æŒæœ‰ç›´åˆ°ç¨‹åºç»“æŸã€‚ T: \u0026lsquo;staticåŒ…æ‹¬æ‰€æœ‰\u0026amp;\u0026lsquo;static Tï¼Œæ­¤å¤–è¿˜åŒ…æ‹¬æ‰€æœ‰çš„æ‰€æœ‰æƒç±»å‹ï¼Œæ¯”å¦‚String, Vecç­‰ã€‚ æ•°æ®çš„æ‰€æœ‰è€…èƒ½å¤Ÿä¿è¯æ•°æ®åªè¦è¿˜è¢«æŒæœ‰å°±ä¸ä¼šå¤±æ•ˆï¼Œå› æ­¤æ‰€æœ‰è€…å¯ä»¥æ— é™æœŸå®‰å…¨åœ°æŒæœ‰è¯¥æ•°æ®ç›´åˆ°ç¨‹åºç»“æŸã€‚ T: 'staticåº”è¯¥è¢«çœ‹ä½œTå—'staticç”Ÿå‘½å‘¨æœŸ \u0026quot;çº¦æŸ\u0026quot; è€Œé Tæœ‰ç€'staticç”Ÿå‘½å‘¨æœŸã€‚ è¿™æ®µä»£ç èƒ½å¸®æˆ‘ä»¬é˜é‡Šè¿™äº›æ¦‚å¿µï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 use rand; fn drop_static\u0026lt;T: \u0026#39;static\u0026gt;(t: T) { std::mem::drop(t); } fn main() { let mut strings: Vec\u0026lt;String\u0026gt; = Vec::new(); for _ in 0..10 { if rand::random() { // æ‰€æœ‰å­—ç¬¦ä¸²éƒ½æ˜¯éšæœºç”Ÿæˆçš„ // å¹¶ä¸”æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”³è¯·çš„ let string = rand::random::\u0026lt;u64\u0026gt;().to_string(); strings.push(string); } } // è¿™äº›å­—ç¬¦ä¸²éƒ½æ˜¯æ‰€æœ‰æƒç±»å‹ï¼Œæ‰€ä»¥å®ƒä»¬æ»¡è¶³\u0026#39;staticçº¦æŸ for mut string in strings { // è¿™äº›å­—ç¬¦ä¸²éƒ½æ˜¯å¯ä»¥ä¿®æ”¹çš„ string.push_str(\u0026#34;a mutation\u0026#34;); // è¿™äº›å­—ç¬¦ä¸²éƒ½æ˜¯å¯ä»¥è¢«dropçš„ drop_static(string); // ç¼–è¯‘é€šè¿‡ } // è¿™äº›å­—ç¬¦ä¸²éƒ½åœ¨ç¨‹åºç»“æŸä¹‹å‰å¤±æ•ˆ println!(\u0026#34;i am the end of the program\u0026#34;); } è¦ç‚¹:\nT: \u0026lsquo;static åº”è¯¥è¢«çœ‹ä½œ â€œTå—\u0026rsquo;staticç”Ÿå‘½å‘¨æœŸçº¦æŸâ€ å¦‚æœ T: \u0026lsquo;static é‚£ä¹ˆTå¯ä»¥æ˜¯æœ‰ç€\u0026rsquo;staticç”Ÿå‘½å‘¨æœŸçš„å€Ÿç”¨ç±»å‹ ç”±äº T: \u0026lsquo;static åŒ…æ‹¬äº†æ‰€æœ‰æƒç±»å‹ï¼Œè¿™æ„å‘³ç€T å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ†é… ä¸ä¸€å®šè¦åœ¨æ•´ä¸ªç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­éƒ½æœ‰æ•ˆ å¯ä»¥è¢«å®‰å…¨åœ°ã€è‡ªç”±åœ°ä¿®æ”¹ å¯ä»¥åœ¨è¿è¡Œæ—¶è¢«åŠ¨æ€dropæ‰ å¯ä»¥æœ‰ä¸åŒé•¿åº¦çš„ç”Ÿå‘½å‘¨æœŸ è¯¯è§£3: \u0026amp;\u0026lsquo;a T å’Œ T: \u0026lsquo;a æ˜¯ç›¸åŒçš„ è¿™ä¸ªè¯¯è§£æ˜¯ä¸Šä¸€ä¸ªçš„æ³›åŒ–ç‰ˆæœ¬ã€‚\n\u0026amp;\u0026lsquo;a T ä¸å…‰è¦æ±‚ï¼ŒåŒæ—¶ä¹Ÿéšå«ç€ T: \u0026lsquo;aï¼Œ å› ä¸ºå¦‚æœTæœ¬èº«éƒ½ä¸èƒ½åœ¨'aå†…æœ‰æ•ˆï¼Œ é‚£å¯¹Tçš„æœ‰'aç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨ä¹Ÿä¸å¯èƒ½æ˜¯æœ‰æ•ˆçš„ã€‚ ä¾‹å¦‚ï¼ŒRustç¼–è¯‘å™¨ä»æ¥ä¸ä¼šå…è®¸åˆ›å»º\u0026amp;\u0026lsquo;static Ref\u0026lt;\u0026lsquo;a, T\u0026gt;è¿™ä¸ªç±»å‹ï¼Œå› ä¸ºå¦‚æœRefåªåœ¨\u0026rsquo;aå†…æœ‰æ•ˆï¼Œæˆ‘ä»¬ä¸å¯èƒ½å¼„å‡ºä¸€ä¸ªå¯¹å®ƒçš„\u0026rsquo;staticçš„å¼•ç”¨ã€‚\nT: 'aåŒ…æ‹¬äº†æ‰€æœ‰\u0026amp;'a Tï¼Œä½†åè¿‡æ¥ä¸å¯¹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 // åªæ¥å—ä»¥\u0026#39;açº¦æŸçš„å¼•ç”¨ç±»å‹ fn t_ref\u0026lt;\u0026#39;a, T: \u0026#39;a\u0026gt;(t: \u0026amp;\u0026#39;a T) {} // æ¥å—æ‰€æœ‰ä»¥\u0026#39;açº¦æŸçš„ç±»å‹ fn t_bound\u0026lt;\u0026#39;a, T: \u0026#39;a\u0026gt;(t: T) {} // åŒ…å«å¼•ç”¨çš„æ‰€æœ‰æƒç±»å‹ struct Ref\u0026lt;\u0026#39;a, T: \u0026#39;a\u0026gt;(\u0026amp;\u0026#39;a T); fn main() { let string = String::from(\u0026#34;string\u0026#34;); t_bound(\u0026amp;string); // ç¼–è¯‘é€šè¿‡ t_bound(Ref(\u0026amp;string)); // ç¼–è¯‘é€šè¿‡ t_bound(\u0026amp;Ref(\u0026amp;string)); // ç¼–è¯‘é€šè¿‡ t_ref(\u0026amp;string); // ç¼–è¯‘é€šè¿‡ t_ref(Ref(\u0026amp;string)); // ç¼–è¯‘é”™è¯¯, æœŸå¾…æ¥æ”¶ä¸€ä¸ªå¼•ç”¨ï¼Œä½†æ”¶åˆ°ä¸€ä¸ªç»“æ„ä½“ t_ref(\u0026amp;Ref(\u0026amp;string)); // ç¼–è¯‘é€šè¿‡ // stringå˜é‡æ˜¯ä»¥\u0026#39;staticçº¦æŸçš„ï¼Œä¹Ÿæ»¡è¶³\u0026#39;açº¦æŸ t_bound(string); // ç¼–è¯‘é€šè¿‡ } è¦ç‚¹:\nT: \u0026lsquo;a æ¯”èµ· \u0026amp;\u0026lsquo;a Tæ›´æ³›åŒ–ä¹Ÿæ›´çµæ´» T: \u0026lsquo;a æ¥å—æ‰€æœ‰æƒç±»å‹ã€åŒ…å«å¼•ç”¨çš„æ‰€æœ‰æƒç±»å‹ä»¥åŠå¼•ç”¨ \u0026amp;\u0026lsquo;a T åªæ¥å—å¼•ç”¨ å¦‚æœ T: \u0026lsquo;static é‚£ä¹ˆ T: \u0026lsquo;a, å› ä¸ºå¯¹äºæ‰€æœ‰\u0026rsquo;aéƒ½æœ‰\u0026rsquo;static \u0026gt;= \u0026lsquo;a è¯¯è§£4: æˆ‘çš„ä»£ç æ²¡ç”¨åˆ°æ³›å‹ï¼Œä¹Ÿä¸å«ç”Ÿå‘½å‘¨æœŸ è¯¯è§£æ¨è®º:\né¿å…ä½¿ç”¨æ³›å‹å’Œç”Ÿå‘½å‘¨æœŸæ˜¯å¯èƒ½çš„ è¿™ç§å®‰æ…°æ€§çš„è¯¯è§£çš„å­˜åœ¨æ˜¯ç”±äºRustçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ï¼Œ è¿™äº›è§„åˆ™è®©ä½ èƒ½å¤Ÿåœ¨å‡½æ•°ä¸­çœç•¥æ‰ç”Ÿå‘½å‘¨æœŸè®°å·ï¼Œ å› ä¸ºRustçš„å€Ÿç”¨æ£€æŸ¥å™¨èƒ½æ ¹æ®ä»¥ä¸‹è§„åˆ™å°†å®ƒä»¬æ¨å¯¼å‡ºæ¥ï¼š\næ¯ä¸ªä¼ å…¥çš„å¼•ç”¨éƒ½ä¼šæœ‰ä¸€ä¸ªå•ç‹¬çš„ç”Ÿå‘½å‘¨æœŸ å¦‚æœåªæœ‰ä¸€ä¸ªä¼ å…¥çš„ç”Ÿå‘½å‘¨æœŸï¼Œé‚£ä¹ˆå®ƒå°†è¢«åº”ç”¨åˆ°æ‰€æœ‰è¾“å‡ºçš„å¼•ç”¨ä¸Š å¦‚æœæœ‰å¤šä¸ªä¼ å…¥çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½†å…¶ä¸­ä¸€ä¸ªæ˜¯\u0026amp;selfæˆ–è€…\u0026amp;mut selfï¼Œé‚£ä¹ˆè¿™ä¸ªç”Ÿå‘½å‘¨æœŸå°†ä¼šè¢«åº”ç”¨åˆ°æ‰€æœ‰è¾“å‡ºçš„å¼•ç”¨ä¸Š é™¤æ­¤ä¹‹å¤–çš„è¾“å‡ºçš„ç”Ÿå‘½å‘¨æœŸéƒ½å¿…é¡»æ˜¾ç¤ºæ ‡æ³¨å‡ºæ¥ å¦‚æœä¸€æ—¶é—´éš¾ä»¥æƒ³æ˜ç™½è¿™ä¹ˆå¤šä¸œè¥¿ï¼Œé‚£è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›ä¾‹å­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 // çœç•¥ fn print(s: \u0026amp;str); // å±•å¼€ fn print\u0026lt;\u0026#39;a\u0026gt;(s: \u0026amp;\u0026#39;a str); // çœç•¥ fn trim(s: \u0026amp;str) -\u0026gt; \u0026amp;str; // å±•å¼€ fn trim\u0026lt;\u0026#39;a\u0026gt;(s: \u0026amp;\u0026#39;a str) -\u0026gt; \u0026amp;\u0026#39;a str; // ä¸åˆæ³•ï¼Œæ— æ³•ç¡®å®šè¾“å‡ºçš„ç”Ÿå‘½å‘¨æœŸï¼Œå› ä¸ºæ²¡æœ‰è¾“å…¥çš„ fn get_str() -\u0026gt; \u0026amp;str; // æ˜¾å¼çš„å†™æ³•åŒ…æ‹¬ fn get_str\u0026lt;\u0026#39;a\u0026gt;() -\u0026gt; \u0026amp;\u0026#39;a str; // æ³›å‹ç‰ˆæœ¬ fn get_str() -\u0026gt; \u0026amp;\u0026#39;static str; // \u0026#39;static ç‰ˆæœ¬ // ä¸åˆæ³•ï¼Œæ— æ³•ç¡®å®šè¾“å‡ºçš„ç”Ÿå‘½å‘¨æœŸï¼Œå› ä¸ºæœ‰å¤šä¸ªè¾“å…¥ fn overlap(s: \u0026amp;str, t: \u0026amp;str) -\u0026gt; \u0026amp;str; // æ˜¾å¼(ä½†ä»æœ‰éƒ¨åˆ†çœç•¥)çš„å†™æ³•åŒ…æ‹¬ fn overlap\u0026lt;\u0026#39;a\u0026gt;(s: \u0026amp;\u0026#39;a str, t: \u0026amp;str) -\u0026gt; \u0026amp;\u0026#39;a str; // è¾“å‡ºç”Ÿå‘½å‘¨æœŸä¸èƒ½é•¿äºs fn overlap\u0026lt;\u0026#39;a\u0026gt;(s: \u0026amp;str, t: \u0026amp;\u0026#39;a str) -\u0026gt; \u0026amp;\u0026#39;a str; // è¾“å‡ºç”Ÿå‘½å‘¨æœŸä¸èƒ½é•¿äºt fn overlap\u0026lt;\u0026#39;a\u0026gt;(s: \u0026amp;\u0026#39;a str, t: \u0026amp;\u0026#39;a str) -\u0026gt; \u0026amp;\u0026#39;a str; // è¾“å‡ºç”Ÿå‘½å‘¨æœŸä¸èƒ½é•¿äºså’Œt fn overlap(s: \u0026amp;str, t: \u0026amp;str) -\u0026gt; \u0026amp;\u0026#39;static str; // è¾“å‡ºç”Ÿå‘½å‘¨æœŸå¯ä»¥é•¿äºså’Œt fn overlap\u0026lt;\u0026#39;a\u0026gt;(s: \u0026amp;str, t: \u0026amp;str) -\u0026gt; \u0026amp;\u0026#39;a str; // è¾“å…¥å’Œè¾“å‡ºçš„ç”Ÿå‘½å‘¨æœŸæ— å…³ // å±•å¼€ fn overlap\u0026lt;\u0026#39;a, \u0026#39;b\u0026gt;(s: \u0026amp;\u0026#39;a str, t: \u0026amp;\u0026#39;b str) -\u0026gt; \u0026amp;\u0026#39;a str; fn overlap\u0026lt;\u0026#39;a, \u0026#39;b\u0026gt;(s: \u0026amp;\u0026#39;a str, t: \u0026amp;\u0026#39;b str) -\u0026gt; \u0026amp;\u0026#39;b str; fn overlap\u0026lt;\u0026#39;a\u0026gt;(s: \u0026amp;\u0026#39;a str, t: \u0026amp;\u0026#39;a str) -\u0026gt; \u0026amp;\u0026#39;a str; fn overlap\u0026lt;\u0026#39;a, \u0026#39;b\u0026gt;(s: \u0026amp;\u0026#39;a str, t: \u0026amp;\u0026#39;b str) -\u0026gt; \u0026amp;\u0026#39;static str; fn overlap\u0026lt;\u0026#39;a, \u0026#39;b, \u0026#39;c\u0026gt;(s: \u0026amp;\u0026#39;a str, t: \u0026amp;\u0026#39;b str) -\u0026gt; \u0026amp;\u0026#39;c str; // çœç•¥ fn compare(\u0026amp;self, s: \u0026amp;str) -\u0026gt; \u0026amp;str; // å±•å¼€ fn compare\u0026lt;\u0026#39;a, \u0026#39;b\u0026gt;(\u0026amp;\u0026#39;a self, \u0026amp;\u0026#39;b str) -\u0026gt; \u0026amp;\u0026#39;a str; å¦‚æœä½ æ›¾å†™è¿‡\nç»“æ„ä½“æ–¹æ³• æ¥æ”¶å¼•ç”¨çš„å‡½æ•° è¿”å›å¼•ç”¨çš„å‡½æ•° æ³›å‹å‡½æ•° trait object(åé¢ä¼šæœ‰æ›´è¯¦ç»†çš„è®¨è®º) é—­åŒ…(åé¢ä¼šæœ‰æ›´è¯¦ç»†çš„è®¨è®º) é‚£ä¹ˆä½ çš„ä»£ç å°±æœ‰è¢«çœç•¥çš„æ³›å‹ç”Ÿå‘½å‘¨æœŸè®°å·ã€‚ è¦ç‚¹:\nå‡ ä¹æ‰€æœ‰Rustä»£ç éƒ½æ˜¯æ³›å‹ä»£ç ï¼Œåˆ°å¤„éƒ½æœ‰è¢«çœç•¥çš„ç”Ÿå‘½å‘¨æœŸè®°å· è¯¯è§£5: å¦‚æœç¼–è¯‘èƒ½é€šè¿‡ï¼Œé‚£ä¹ˆæˆ‘çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨å°±æ˜¯æ­£ç¡®çš„ è¯¯è§£æ¨è®º\nRustå¯¹å‡½æ•°çš„çš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™æ€»æ˜¯æ­£ç¡®çš„ Rustçš„å€Ÿç”¨æ£€æŸ¥å™¨åœ¨æŠ€æœ¯ä¸Šå’Œè¯­ä¹‰ä¸Šæ€»æ˜¯æ­£ç¡®çš„ Rustæ¯”æˆ‘æ›´äº†è§£æˆ‘çš„ç¨‹åºçš„è¯­ä¹‰ Rustç¨‹åºæ˜¯æœ‰å¯èƒ½åœ¨æŠ€æœ¯ä¸Šèƒ½é€šè¿‡ç¼–è¯‘ï¼Œä½†è¯­ä¹‰ä¸Šä»ç„¶æ˜¯é”™çš„ã€‚æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªä¾‹å­ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 struct ByteIter\u0026lt;\u0026#39;a\u0026gt; { remainder: \u0026amp;\u0026#39;a [u8] } impl\u0026lt;\u0026#39;a\u0026gt; ByteIter\u0026lt;\u0026#39;a\u0026gt; { fn next(\u0026amp;mut self) -\u0026gt; Option\u0026lt;\u0026amp;u8\u0026gt; { if self.remainder.is_empty() { None } else { let byte = \u0026amp;self.remainder[0]; self.remainder = \u0026amp;self.remainder[1..]; Some(byte) } } } fn main() { let mut bytes = ByteIter { remainder: b\u0026#34;1\u0026#34; }; assert_eq!(Some(\u0026amp;b\u0026#39;1\u0026#39;), bytes.next()); assert_eq!(None, bytes.next()); } ByteIter æ˜¯åœ¨å­—èŠ‚åˆ‡ç‰‡ä¸Šè¿­ä»£çš„è¿­ä»£å™¨ï¼Œä¸ºäº†ç®€æ´æˆ‘ä»¬è·³è¿‡å¯¹ Iterator traitçš„å®ç°ã€‚ è¿™çœ‹èµ·æ¥æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³åŒæ—¶æ£€æŸ¥å¤šä¸ªå­—èŠ‚å‘¢ï¼Ÿ\n1 2 3 4 5 6 7 8 fn main() { let mut bytes = ByteIter { remainder: b\u0026#34;1123\u0026#34; }; let byte_1 = bytes.next(); let byte_2 = bytes.next(); if byte_1 == byte_2 { // åšç‚¹ä»€ä¹ˆ } } å•Šå“¦ï¼ç¼–è¯‘é”™è¯¯ï¼š\n1 2 3 4 5 6 7 8 9 10 error[E0499]: cannot borrow `bytes` as mutable more than once at a time --\u0026gt; src/main.rs:20:18 | 19 | let byte_1 = bytes.next(); | ----- first mutable borrow occurs here 20 | let byte_2 = bytes.next(); | ^^^^^ second mutable borrow occurs here 21 | if byte_1 == byte_2 { | ------ first borrow later used here æˆ‘è§‰å¾—æˆ‘ä»¬å¯ä»¥æ‹·è´æ¯ä¸€ä¸ªå­—èŠ‚ã€‚æ‹·è´åœ¨æˆ‘ä»¬å¤„ç†å­—èŠ‚çš„æ—¶å€™æ˜¯å¯è¡Œçš„ï¼Œ ä½†å½“æˆ‘ä»¬ä» ByteIter è½¬å‘æ³›å‹åˆ‡ç‰‡è¿­ä»£å™¨ç”¨æ¥è¿­ä»£ä»»æ„ \u0026amp;'a [T] çš„æ—¶å€™ æˆ‘ä»¬ä¹Ÿä¼šæƒ³åˆ°å°†æ¥å¯èƒ½å®ƒä¼šè¢«åº”ç”¨åˆ°é‚£äº›æ‹·è´/å…‹éš†çš„ä»£ä»·å¾ˆæ˜‚è´µæˆ–æ ¹æœ¬ä¸å¯èƒ½çš„ç±»å‹ä¸Šã€‚ å™¢ï¼Œæˆ‘æƒ³æˆ‘ä»¬å¯¹è¿™æ²¡ä»€ä¹ˆåŠæ³•ï¼Œä»£ç èƒ½è¿‡ç¼–è¯‘ï¼Œé‚£ä¹ˆç”Ÿå‘½å‘¨æœŸæ ‡è®°å¿…ç„¶æ˜¯å¯¹çš„ä¸æ˜¯å—ï¼Ÿ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 struct ByteIter\u0026lt;\u0026#39;a\u0026gt; { remainder: \u0026amp;\u0026#39;a [u8] } impl\u0026lt;\u0026#39;a\u0026gt; ByteIter\u0026lt;\u0026#39;a\u0026gt; { fn next\u0026lt;\u0026#39;b\u0026gt;(\u0026amp;\u0026#39;b mut self) -\u0026gt; Option\u0026lt;\u0026amp;\u0026#39;b u8\u0026gt; { if self.remainder.is_empty() { None } else { let byte = \u0026amp;self.remainder[0]; self.remainder = \u0026amp;self.remainder[1..]; Some(byte) } } } è¿™ä¸€ç‚¹å¸®åŠ©éƒ½æ²¡æœ‰ï¼Œæˆ‘ä»ç„¶æä¸æ˜ç™½ã€‚è¿™é‡Œæœ‰ä¸ªåªæœ‰Rustä¸“å®¶æ‰çŸ¥é“çš„å°çªé—¨ï¼š ç»™ä½ çš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°å–ä¸ªæœ‰æè¿°æ€§çš„åå­—ã€‚æˆ‘ä»¬å†è¯•ä¸€æ¬¡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 struct ByteIter\u0026lt;\u0026#39;remainder\u0026gt; { remainder: \u0026amp;\u0026#39;remainder [u8] } impl\u0026lt;\u0026#39;remainder\u0026gt; ByteIter\u0026lt;\u0026#39;remainder\u0026gt; { fn next\u0026lt;\u0026#39;mut_self\u0026gt;(\u0026amp;\u0026#39;mut_self mut self) -\u0026gt; Option\u0026lt;\u0026amp;\u0026#39;mut_self u8\u0026gt; { if self.remainder.is_empty() { None } else { let byte = \u0026amp;self.remainder[0]; self.remainder = \u0026amp;self.remainder[1..]; Some(byte) } } } æ¯ä¸ªè¿”å›çš„å­—èŠ‚éƒ½è¢«ç”¨'mut_selfæ ‡è®°äº†ï¼Œä½†è¿™äº›å­—èŠ‚æ˜¾ç„¶æ˜¯æ¥è‡ªäº'remainderçš„ï¼Œ è®©æˆ‘ä»¬æ¥æ”¹ä¸€ä¸‹ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 struct ByteIter\u0026lt;\u0026#39;remainder\u0026gt; { remainder: \u0026amp;\u0026#39;remainder [u8] } impl\u0026lt;\u0026#39;remainder\u0026gt; ByteIter\u0026lt;\u0026#39;remainder\u0026gt; { fn next(\u0026amp;mut self) -\u0026gt; Option\u0026lt;\u0026amp;\u0026#39;remainder u8\u0026gt; { if self.remainder.is_empty() { None } else { let byte = \u0026amp;self.remainder[0]; self.remainder = \u0026amp;self.remainder[1..]; Some(byte) } } } fn main() { let mut bytes = ByteIter { remainder: b\u0026#34;1123\u0026#34; }; let byte_1 = bytes.next(); let byte_2 = bytes.next(); std::mem::drop(bytes); // æˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨è¿™é‡ŒæŠŠè¿­ä»£å™¨dropæ‰ï¼ if byte_1 == byte_2 { // ç¼–è¯‘é€šè¿‡ // åšç‚¹ä»€ä¹ˆ } } ç°åœ¨è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ï¼Œæˆ‘ä»¬å‰ä¸€ç‰ˆçš„ç¨‹åºæ˜¾ç„¶æ˜¯é”™è¯¯çš„ï¼Œä½†ä¸ºä»€ä¹ˆRustä»ç„¶å…è®¸å®ƒé€šè¿‡ç¼–è¯‘å‘¢ï¼Ÿ ç­”æ¡ˆå¾ˆç®€å•ï¼šè¿™ä¹ˆåšæ˜¯å†…å­˜å®‰å…¨çš„ã€‚\nRustçš„å€Ÿç”¨æ£€æŸ¥å™¨å¯¹ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°åªè¦æ±‚åˆ°èƒ½å¤Ÿä»¥é™æ€çš„æ–¹å¼éªŒè¯ç¨‹åºçš„å†…å­˜å®‰å…¨ã€‚ Rustä¼šçˆ½å¿«åœ°ç¼–è¯‘ä¸€ä¸ªç¨‹åºï¼Œå³ä½¿å®ƒçš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°æœ‰è¯­ä¹‰ä¸Šçš„é”™è¯¯ï¼Œ è¿™å¸¦æ¥çš„ç»“æœå°±æ˜¯ç¨‹åºä¼šå˜å¾—è¿‡äºå—é™ã€‚\næ¥çœ‹ä¸€ä¸ªä¸å‰ä¸€ä¸ªç›¸åçš„ä¾‹å­ï¼šRustçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™æ°å¥½åœ¨è¿™ä¸ªä¾‹å­ä¸Šè¯­ä¹‰æ˜¯æ­£ç¡®çš„ï¼Œ ä½†æˆ‘ä»¬å´æ— æ„ä¸­ç”¨äº†ä¸€äº›å¤šä½™çš„æ˜¾å¼ç”Ÿå‘½å‘¨æœŸæ ‡è®°å†™äº†ä¸ªéå¸¸å—é™çš„æ–¹æ³•ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 #[derive(Debug)] struct NumRef\u0026lt;\u0026#39;a\u0026gt;(\u0026amp;\u0026#39;a i32); impl\u0026lt;\u0026#39;a\u0026gt; NumRef\u0026lt;\u0026#39;a\u0026gt; { // æˆ‘çš„ç»“æ„ä½“æ˜¯åœ¨\u0026#39;aä¸Šæ³›å‹çš„ï¼Œæ‰€ä»¥æˆ‘åŒæ ·ä¹Ÿè¦ // æ ‡è®°ä¸€ä¸‹æˆ‘çš„selfå‚æ•°ï¼Œå¯¹å—ï¼Ÿï¼ˆç­”æ¡ˆæ˜¯ï¼šä¸ï¼Œä¸å¯¹ï¼‰ fn some_method(\u0026amp;\u0026#39;a mut self) {} } fn main() { let mut num_ref = NumRef(\u0026amp;5); num_ref.some_method(); // å¯å˜å€Ÿç”¨num_refç›´åˆ°å®ƒå‰©ä½™çš„ç”Ÿå‘½å‘¨æœŸç»“æŸ num_ref.some_method(); // ç¼–è¯‘é”™è¯¯ println!(\u0026#34;{:?}\u0026#34;, num_ref); // åŒæ ·ç¼–è¯‘é”™è¯¯ } å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªåœ¨ \u0026lsquo;a ä¸Šçš„æ³›å‹ï¼Œæˆ‘ä»¬å‡ ä¹æ°¸è¿œä¸ä¼šæƒ³è¦å†™ä¸€ä¸ªæ¥æ”¶\u0026amp;'a mut selfçš„æ–¹æ³•ã€‚ å› ä¸ºè¿™æ„å‘³ç€æˆ‘ä»¬å‘Šè¯‰Rustï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå¯å˜å€Ÿç”¨è¿™ä¸ªç»“æ„ä½“ç›´åˆ°æ•´ä¸ªç»“æ„ä½“ç”Ÿå‘½å‘¨æœŸç»“æŸã€‚ è¿™ä¹Ÿå°±å‘Šè¯‰Rustçš„å€Ÿç”¨æ£€æŸ¥å™¨æœ€å¤šåªå…è®¸ some_method è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œ åœ¨è¿™ä¹‹åè¿™ä¸ªç»“æ„ä½“å°†ä¼šè¢«æ°¸ä¹…æ€§åœ°å¯å˜å€Ÿç”¨èµ°ï¼Œä¹Ÿå°±å˜å¾—ä¸å¯ç”¨äº†ã€‚ è¿™æ ·çš„ç”¨ä¾‹éå¸¸éå¸¸å°‘ï¼Œä½†å¤„äºå›°æƒ‘ä¸­çš„åˆå­¦è€…éå¸¸å®¹æ˜“å†™å‡ºè¿™ç§ä»£ç ï¼Œå¹¶èƒ½é€šè¿‡ç¼–è¯‘ã€‚ æ­£ç¡®çš„åšæ³•æ˜¯ä¸è¦æ·»åŠ è¿™äº›å¤šä½™çš„æ˜¾å¼ç”Ÿå‘½å‘¨æœŸæ ‡è®°ï¼Œè®©Rustçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™æ¥å¤„ç†å®ƒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 #[derive(Debug)] struct NumRef\u0026lt;\u0026#39;a\u0026gt;(\u0026amp;\u0026#39;a i32); impl\u0026lt;\u0026#39;a\u0026gt; NumRef\u0026lt;\u0026#39;a\u0026gt; { // å»æ‰mut selfå‰é¢çš„\u0026#39;a fn some_method(\u0026amp;mut self) {} // ä¸Šä¸€æ®µä»£ç è„±æ‰è¯­æ³•ç³–åå˜ä¸º fn some_method_desugared\u0026lt;\u0026#39;b\u0026gt;(\u0026amp;\u0026#39;b mut self){} } fn main() { let mut num_ref = NumRef(\u0026amp;5); num_ref.some_method(); num_ref.some_method(); // ç¼–è¯‘é€šè¿‡ println!(\u0026#34;{:?}\u0026#34;, num_ref); // ç¼–è¯‘é€šè¿‡ } è¦ç‚¹:\nRustçš„å‡½æ•°ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™å¹¶ä¸æ€»æ˜¯å¯¹æ‰€æœ‰æƒ…å†µéƒ½æ­£ç¡®çš„ Rustå¯¹ä½ çš„ç¨‹åºçš„è¯­ä¹‰äº†è§£å¹¶ä¸æ¯”ä½ å¤š ç»™ä½ çš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°èµ·ä¸€ä¸ªæ›´æœ‰æè¿°æ€§çš„åå­— åœ¨ä½ ä½¿ç”¨æ˜¾å¼ç”Ÿå‘½å‘¨æœŸæ ‡è®°çš„æ—¶å€™è¦æƒ³æ¸…æ¥šå®ƒä»¬åº”è¯¥è¢«ç”¨åœ¨å“ªä»¥åŠä¸ºä»€ä¹ˆè¦è¿™ä¹ˆç”¨ è¯¯è§£6: è£…ç®±çš„traitå¯¹è±¡æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸ æ—©å‰æˆ‘ä»¬è®¨è®ºäº†Rustå¯¹å‡½æ•°çš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ã€‚RuståŒæ ·æœ‰ç€å¯¹äºtraitå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ï¼Œå®ƒä»¬æ˜¯ï¼š\nå¦‚æœä¸€ä¸ªtraitå¯¹è±¡ä½œä¸ºä¸€ä¸ªç±»å‹å‚æ•°ä¼ é€’åˆ°æ³›å‹ä¸­ï¼Œé‚£ä¹ˆå®ƒçš„ç”Ÿå‘½çº¦æŸä¼šä»å®ƒåŒ…å«çš„ç±»å‹ä¸­æ¨æ–­ å¦‚æœåŒ…å«çš„ç±»å‹ä¸­æœ‰å”¯ä¸€çš„çº¦æŸï¼Œé‚£ä¹ˆå°±ä½¿ç”¨è¿™ä¸ªçº¦æŸã€‚ å¦‚æœåŒ…å«çš„ç±»å‹ä¸­æœ‰è¶…è¿‡ä¸€ä¸ªçº¦æŸï¼Œé‚£ä¹ˆå¿…é¡»æ˜¾å¼æŒ‡å®šçº¦æŸã€‚ å¦‚æœä»¥ä¸Šéƒ½ä¸é€‚ç”¨ï¼Œé‚£ä¹ˆï¼š\nå¦‚æœtraitæ˜¯ä»¥å•ä¸ªç”Ÿå‘½å‘¨æœŸçº¦æŸå®šä¹‰çš„ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨è¿™ä¸ªçº¦æŸ å¦‚æœæ‰€æœ‰ç”Ÿå‘½å‘¨æœŸçº¦æŸéƒ½æ˜¯ \u0026lsquo;static çš„ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ \u0026lsquo;static ä½œä¸ºçº¦æŸ å¦‚æœtraitæ²¡æœ‰ç”Ÿå‘½å‘¨æœŸçº¦æŸï¼Œé‚£ä¹ˆå®ƒçš„ç”Ÿå‘½å‘¨æœŸå°†ä¼šä»è¡¨è¾¾å¼ä¸­æ¨æ–­ï¼Œå¦‚æœä¸åœ¨è¡¨è¾¾å¼ä¸­ï¼Œé‚£ä¹ˆå°±æ˜¯ \u0026lsquo;static çš„ è¿™ä¹ˆå¤šä¸œè¥¿å¬èµ·æ¥è¶…çº§å¤æ‚ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç®€å•åœ°æ€»ç»“ä¸º \u0026ldquo;traitå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸçº¦æŸæ˜¯ä»ä¸Šä¸‹æ–‡ä¸­æ¨æ–­å‡ºæ¥çš„ã€‚\u0026rdquo; åœ¨æˆ‘ä»¬çœ‹è¿‡å‡ ä¸ªä¾‹å­åï¼Œæˆ‘ä»¬ä¼šå‘ç°ç”Ÿå‘½å‘¨æœŸçº¦æŸæ¨æ–­å…¶å®æ˜¯å¾ˆç¬¦åˆç›´è§‰çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å»è®°è¿™äº›å¾ˆæ­£å¼çš„è§„åˆ™ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 use std::cell::Ref; trait Trait {} // çœç•¥ type T1 = Box\u0026lt;dyn Trait\u0026gt;; // å±•å¼€ï¼ŒBox\u0026lt;T\u0026gt;å¯¹Tæ²¡æœ‰ç”Ÿå‘½å‘¨æœŸçº¦æŸï¼Œæ‰€ä»¥è¢«æ¨æ–­ä¸º\u0026#39;static type T2 = Box\u0026lt;dyn Trait + \u0026#39;static\u0026gt;; // çœç•¥ impl dyn Trait {} // å±•å¼€ impl dyn Trait + \u0026#39;static {} // çœç•¥ type T3\u0026lt;\u0026#39;a\u0026gt; = \u0026amp;\u0026#39;a dyn Trait; // å±•å¼€, å› ä¸º\u0026amp;\u0026#39;a T è¦æ±‚ T: \u0026#39;a, æ‰€ä»¥æ¨æ–­ä¸º \u0026#39;a type T4\u0026lt;\u0026#39;a\u0026gt; = \u0026amp;\u0026#39;a (dyn Trait + \u0026#39;a); // çœç•¥ type T5\u0026lt;\u0026#39;a\u0026gt; = Ref\u0026lt;\u0026#39;a, dyn Trait\u0026gt;; // å±•å¼€, å› ä¸ºRef\u0026lt;\u0026#39;a, T\u0026gt; è¦æ±‚ T: \u0026#39;a, æ‰€ä»¥æ¨æ–­ä¸º \u0026#39;a type T6\u0026lt;\u0026#39;a\u0026gt; = Ref\u0026lt;\u0026#39;a, dyn Trait + \u0026#39;a\u0026gt;; trait GenericTrait\u0026lt;\u0026#39;a\u0026gt;: \u0026#39;a {} // çœç•¥ type T7\u0026lt;\u0026#39;a\u0026gt; = Box\u0026lt;dyn GenericTrait\u0026lt;\u0026#39;a\u0026gt;\u0026gt;; // å±•å¼€ type T8\u0026lt;\u0026#39;a\u0026gt; = Box\u0026lt;dyn GenericTrait\u0026lt;\u0026#39;a\u0026gt; + \u0026#39;a\u0026gt;; // çœç•¥ impl\u0026lt;\u0026#39;a\u0026gt; dyn GenericTrait\u0026lt;\u0026#39;a\u0026gt; {} // å±•å¼€ impl\u0026lt;\u0026#39;a\u0026gt; dyn GenericTrait\u0026lt;\u0026#39;a\u0026gt; + \u0026#39;a {} å®ç°äº†æŸä¸ªtraitçš„å…·ä½“çš„ç±»å‹å¯ä»¥åŒ…å«å¼•ç”¨ï¼Œå› æ­¤å®ƒä»¬åŒæ ·æ‹¥æœ‰ç”Ÿå‘½å‘¨æœŸçº¦æŸï¼Œä¸”å¯¹åº”çš„traitå¯¹è±¡ä¹Ÿæœ‰ç”Ÿå‘½å‘¨æœŸçº¦æŸã€‚ ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä¸ºå¼•ç”¨å®ç°traitï¼Œè€Œå¼•ç”¨æ˜¾ç„¶æœ‰ç”Ÿå‘½å‘¨æœŸçº¦æŸã€‚\n1 2 3 4 5 6 7 8 trait Trait {} struct Struct {} struct Ref\u0026lt;\u0026#39;a, T\u0026gt;(\u0026amp;\u0026#39;a T); impl Trait for Struct {} impl Trait for \u0026amp;Struct {} // ç›´æ¥åœ¨å¼•ç”¨ç±»å‹ä¸Šå®ç°Trait impl\u0026lt;\u0026#39;a, T\u0026gt; Trait for Ref\u0026lt;\u0026#39;a, T\u0026gt; {} // åœ¨åŒ…å«å¼•ç”¨çš„ç±»å‹ä¸Šå®ç°Trait ä¸ç®¡æ€æ ·ï¼Œè¿™éƒ½å€¼å¾—æˆ‘ä»¬ä»”ç»†ç ”ç©¶ï¼Œå› ä¸ºæ–°æ‰‹ä»¬ç»å¸¸åœ¨å°†ä¸€ä¸ªä½¿ç”¨traitå¯¹è±¡çš„å‡½æ•°é‡æ„æˆä½¿ç”¨æ³›å‹çš„å‡½æ•°ï¼ˆæˆ–è€…åè¿‡æ¥ï¼‰çš„æ—¶å€™æ„Ÿåˆ°å›°æƒ‘ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªä¾‹å­ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 use std::fmt::Display; fn dynamic_thread_print(t: Box\u0026lt;dyn Display + Send\u0026gt;) { std:ğŸ§µ:spawn(move || { println!(\u0026#34;{}\u0026#34;, t); }).join(); } fn static_thread_print\u0026lt;T: Display + Send\u0026gt;(t: T) { std:ğŸ§µ:spawn(move || { println!(\u0026#34;{}\u0026#34;, t); }).join(); } è¿™ä¼šæŠ›å‡ºä¸‹é¢çš„ç¼–è¯‘é”™è¯¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 error[E0310]: the parameter type `T` may not live long enough --\u0026gt; src/lib.rs:10:5 | 9 | fn static_thread_print\u0026lt;T: Display + Send\u0026gt;(t: T) { | -- help: consider adding an explicit lifetime bound...: `T: \u0026#39;static +` 10 | std:ğŸ§µ:spawn(move || { | ^^^^^^^^^^^^^^^^^^ | note: ...so that the type `[closure@src/lib.rs:10:24: 12:6 t:T]` will meet its required lifetime bounds --\u0026gt; src/lib.rs:10:5 | 10 | std:ğŸ§µ:spawn(move || { | ^^^^^^^^^^^^^^^^^^ å¾ˆå¥½ï¼Œç¼–è¯‘å™¨å‘Šè¯‰äº†æˆ‘ä»¬æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ¥è¯•è¯•ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 use std::fmt::Display; fn dynamic_thread_print(t: Box\u0026lt;dyn Display + Send\u0026gt;) { std:ğŸ§µ:spawn(move || { println!(\u0026#34;{}\u0026#34;, t); }).join(); } fn static_thread_print\u0026lt;T: Display + Send + \u0026#39;static\u0026gt;(t: T) { std:ğŸ§µ:spawn(move || { println!(\u0026#34;{}\u0026#34;, t); }).join(); } ç¼–è¯‘é€šè¿‡ï¼Œä½†è¿™ä¸¤ä¸ªå‡½æ•°æ”¾åœ¨ä¸€å—å„¿çœ‹èµ·æ¥æœ‰ç‚¹æ€ªï¼Œä¸ºä»€ä¹ˆç¬¬äºŒä¸ªå‡½æ•°å¯¹ T æœ‰ \u0026lsquo;static çº¦æŸï¼Œè€Œç¬¬ä¸€ä¸ªæ²¡æœ‰ï¼Ÿ è¿™ä¸ªé—®é¢˜å¾ˆåˆé’»ã€‚æ ¹æ®ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ï¼ŒRustè‡ªåŠ¨ä¸ºç¬¬ä¸€ä¸ªå‡½æ•°æ¨æ–­å‡º \u0026lsquo;static çº¦æŸï¼Œæ‰€ä»¥ä¸¤ä¸ªå‡½æ•°å®é™…ä¸Šéƒ½æœ‰ \u0026lsquo;static çº¦æŸã€‚ åœ¨Rustç¼–è¯‘å™¨çš„çœ¼ä¸­æ˜¯è¿™æ ·çš„ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 use std::fmt::Display; fn dynamic_thread_print(t: Box\u0026lt;dyn Display + Send + \u0026#39;static\u0026gt;) { std:ğŸ§µ:spawn(move || { println!(\u0026#34;{}\u0026#34;, t); }).join(); } fn static_thread_print\u0026lt;T: Display + Send + \u0026#39;static\u0026gt;(t: T) { std:ğŸ§µ:spawn(move || { println!(\u0026#34;{}\u0026#34;, t); }).join(); } è¦ç‚¹:\næ‰€æœ‰traitå¯¹è±¡éƒ½æœ‰ç€é»˜è®¤æ¨æ–­çš„ç”Ÿå‘½å‘¨æœŸçº¦æŸ è¯¯è§£7: ç¼–è¯‘å™¨æŠ¥é”™ä¿¡æ¯ä¼šå‘Šè¯‰æˆ‘æ€ä¹ˆä¿®æ”¹æˆ‘çš„ä»£ç  è¯¯è§£æ¨è®º\nRustç¼–è¯‘å™¨å¯¹äºtrait objectsçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™æ€»æ˜¯å¯¹çš„ Rustç¼–è¯‘å™¨æ¯”æˆ‘æ›´æ‡‚æˆ‘ä»£ç çš„è¯­ä¹‰ è¿™ä¸ªè¯¯è§£æ˜¯å‰ä¸¤ä¸ªè¯¯è§£çš„åˆäºŒä¸ºä¸€çš„ä¾‹å­ï¼š\n1 2 3 4 5 use std::fmt::Display; fn box_displayable\u0026lt;T: Display\u0026gt;(t: T) -\u0026gt; Box\u0026lt;dyn Display\u0026gt; { Box::new(t) } æŠ›å‡ºå¦‚ä¸‹é”™è¯¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 error[E0310]: the parameter type `T` may not live long enough --\u0026gt; src/lib.rs:4:5 | 3 | fn box_displayable\u0026lt;T: Display\u0026gt;(t: T) -\u0026gt; Box\u0026lt;dyn Display\u0026gt; { | -- help: consider adding an explicit lifetime bound...: `T: \u0026#39;static +` 4 | Box::new(t) | ^^^^^^^^^^^ | note: ...so that the type `T` will meet its required lifetime bounds --\u0026gt; src/lib.rs:4:5 | 4 | Box::new(t) | ^^^^^^^^^^^ å¥½å§ï¼Œè®©æˆ‘ä»¬ç…§ç€ç¼–è¯‘å™¨å‘Šè¯‰æˆ‘ä»¬çš„æ–¹å¼ä¿®æ”¹å®ƒï¼Œåˆ«åœ¨æ„è¿™ç§æ”¹æ³•åŸºäºäº†ä¸€ä¸ªæ²¡æœ‰å‘ŠçŸ¥çš„äº‹å®ï¼š ç¼–è¯‘å™¨è‡ªåŠ¨ä¸ºæˆ‘ä»¬çš„boxed trait objectæ¨æ–­äº†ä¸€ä¸ª\u0026rsquo;staticçš„ç”Ÿå‘½å‘¨æœŸçº¦æŸã€‚\n1 2 3 4 5 use std::fmt::Display; fn box_displayable\u0026lt;T: Display + \u0026#39;static\u0026gt;(t: T) -\u0026gt; Box\u0026lt;dyn Display\u0026gt; { Box::new(t) } ç°åœ¨ç¼–è¯‘é€šè¿‡äº†ï¼Œä½†è¿™çœŸçš„æ˜¯æˆ‘ä»¬æƒ³è¦çš„å—ï¼Ÿå¯èƒ½æ˜¯ï¼Œä¹Ÿå¯èƒ½ä¸æ˜¯ï¼Œç¼–è¯‘å»å¹¶æ²¡æœ‰å‘Šè¯‰æˆ‘ä»¬å…¶å®ƒè§£å†³æ–¹æ³• ä½†è¿™ä¸ªä¹Ÿè®¸åˆé€‚ã€‚\n1 2 3 4 5 use std::fmt::Display; fn box_displayable\u0026lt;\u0026#39;a, T: Display + \u0026#39;a\u0026gt;(t: T) -\u0026gt; Box\u0026lt;dyn Display + \u0026#39;a\u0026gt; { Box::new(t) } è¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°å’Œå‰ä¸€ä¸ªç‰ˆæœ¬ä¸€æ ·ï¼Œä½†å¤šäº†ä¸å°‘ä¸œè¥¿ã€‚è¿™æ ·å†™èƒ½è®©å®ƒæ›´å¥½å—ï¼Ÿä¸ä¸€å®šï¼Œ è¿™å–å†³äºæˆ‘ä»¬çš„ç¨‹åºçš„è¦æ±‚å’Œçº¦æŸã€‚è¿™ä¸ªä¾‹å­æœ‰äº›æŠ½è±¡ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æ›´ç®€å•æ˜äº†çš„æƒ…å†µã€‚\n1 2 3 fn return_first(a: \u0026amp;str, b: \u0026amp;str) -\u0026gt; \u0026amp;str { a } æŠ¥é”™:\n1 2 3 4 5 6 7 8 9 10 11 error[E0106]: missing lifetime specifier --\u0026gt; src/lib.rs:1:38 | 1 | fn return_first(a: \u0026amp;str, b: \u0026amp;str) -\u0026gt; \u0026amp;str { | ---- ---- ^ expected named lifetime parameter | = help: this function\u0026#39;s return type contains a borrowed value, but the signature does not say whether it is borrowed from `a` or `b` help: consider introducing a named lifetime parameter | 1 | fn return_first\u0026lt;\u0026#39;a\u0026gt;(a: \u0026amp;\u0026#39;a str, b: \u0026amp;\u0026#39;a str) -\u0026gt; \u0026amp;\u0026#39;a str { | ^^^^ ^^^^^^^ ^^^^^^^ ^^^ è¿™ä¸ªé”™è¯¯ä¿¡æ¯å»ºè®®æˆ‘ä»¬ç»™è¾“å…¥å’Œè¾“å‡ºæ‰“ä¸Šç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸæ ‡è®°ã€‚ è¿™ä¹ˆåšè™½ç„¶èƒ½ä½¿å¾—ç¼–è¯‘é€šè¿‡ï¼Œä½†å´è¿‡åº¦é™åˆ¶äº†è¿”å›ç±»å‹ã€‚ æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„æ˜¯è¿™ä¸ªï¼š\n1 2 3 fn return_first\u0026lt;\u0026#39;a\u0026gt;(a: \u0026amp;\u0026#39;a str, b: \u0026amp;str) -\u0026gt; \u0026amp;\u0026#39;a str { a } è¦ç‚¹:\nRustå¯¹trait objectçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™å¹¶ä¸æ˜¯åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½æ­£ç¡®ã€‚ Rustä¸è§å¾—æ¯”ä½ æ›´æ‡‚ä½ ä»£ç çš„è¯­ä¹‰ã€‚ Rustç¼–è¯‘é”™è¯¯ä¿¡æ¯ç»™å‡ºçš„ä¿®æ”¹å»ºè®®å¯èƒ½èƒ½è®©ä½ çš„ä»£ç ç¼–è¯‘é€šè¿‡ï¼Œä½†è¿™ä¸ä¸€å®šæ˜¯æœ€ç¬¦åˆä½ çš„è¦æ±‚çš„ã€‚ è¯¯è§£8: ç”Ÿå‘½å‘¨æœŸå¯ä»¥åœ¨è¿è¡Œæ—¶å˜é•¿ç¼©çŸ­ è¯¯è§£æ¨è®º\nå®¹å™¨ç±»å‹å¯ä»¥é€šè¿‡æ›´æ¢å¼•ç”¨åœ¨è¿è¡Œæ—¶æ›´æ”¹è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ Rustçš„å€Ÿç”¨æ£€æŸ¥ä¼šè¿›è¡Œæ·±å…¥çš„æ§åˆ¶æµåˆ†æ è¿™è¿‡ä¸äº†ç¼–è¯‘ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 struct Has\u0026lt;\u0026#39;lifetime\u0026gt; { lifetime: \u0026amp;\u0026#39;lifetime str, } fn main() { let long = String::from(\u0026#34;long\u0026#34;); let mut has = Has { lifetime: \u0026amp;long }; assert_eq!(has.lifetime, \u0026#34;long\u0026#34;); { let short = String::from(\u0026#34;short\u0026#34;); // æ¢æˆçŸ­ç”Ÿå‘½å‘¨æœŸ has.lifetime = \u0026amp;short; assert_eq!(has.lifetime, \u0026#34;short\u0026#34;); // æ¢å›é•¿ç”Ÿå‘½å‘¨æœŸï¼ˆå¹¶ä¸è¡Œï¼‰ has.lifetime = \u0026amp;long; assert_eq!(has.lifetime, \u0026#34;long\u0026#34;); // `short`åœ¨è¿™é‡Œææ„ } // ç¼–è¯‘é”™è¯¯ï¼Œ`short`åœ¨ææ„åä»å¤„äºå€Ÿç”¨çŠ¶æ€ assert_eq!(has.lifetime, \u0026#34;long\u0026#34;); } æŠ¥é”™ï¼š\n1 2 3 4 5 6 7 8 9 10 error[E0597]: `short` does not live long enough --\u0026gt; src/main.rs:11:24 | 11 | has.lifetime = \u0026amp;short; | ^^^^^^ borrowed value does not live long enough ... 15 | } | - `short` dropped here while still borrowed 16 | assert_eq!(has.lifetime, \u0026#34;long\u0026#34;); | --------------------------------- borrow later used here ä¸‹é¢è¿™ä¸ªä»£ç åŒæ ·è¿‡ä¸äº†ç¼–è¯‘ï¼ŒæŠ¥çš„é”™å’Œä¸Šé¢ä¸€æ ·ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 struct Has\u0026lt;\u0026#39;lifetime\u0026gt; { lifetime: \u0026amp;\u0026#39;lifetime str, } fn main() { let long = String::from(\u0026#34;long\u0026#34;); let mut has = Has { lifetime: \u0026amp;long }; assert_eq!(has.lifetime, \u0026#34;long\u0026#34;); // è¿™ä¸ªä»£ç å—ä¸ä¼šè¢«æ‰§è¡Œ if false { let short = String::from(\u0026#34;short\u0026#34;); // æ¢æˆçŸ­ç”Ÿå‘½å‘¨æœŸ has.lifetime = \u0026amp;short; assert_eq!(has.lifetime, \u0026#34;short\u0026#34;); // æ¢å›é•¿ç”Ÿå‘½å‘¨æœŸï¼ˆå¹¶ä¸è¡Œï¼‰ has.lifetime = \u0026amp;long; assert_eq!(has.lifetime, \u0026#34;long\u0026#34;); // `short`åœ¨è¿™é‡Œææ„ } // ä»æ—§ç¼–è¯‘é”™è¯¯ï¼Œ`short`åœ¨ææ„åä»å¤„äºå€Ÿç”¨çŠ¶æ€ assert_eq!(has.lifetime, \u0026#34;long\u0026#34;); } ç”Ÿå‘½å‘¨æœŸåªä¼šåœ¨ç¼–è¯‘æœŸè¢«é™æ€éªŒè¯ï¼Œå¹¶ä¸”Rustçš„å€Ÿç”¨æ£€æŸ¥åªèƒ½åšåˆ°åŸºæœ¬çš„æ§åˆ¶æµåˆ†æï¼Œ å®ƒå‡è®¾æ¯ä¸ªif-elseä¸­çš„ä»£ç å—å’Œmatchçš„æ¯ä¸ªåˆ†æ”¯éƒ½ä¼šè¢«æ‰§è¡Œï¼Œ å¹¶ä¸”å…¶ä¸­çš„æ¯ä¸€ä¸ªå˜é‡éƒ½èƒ½è¢«æŒ‡å®šä¸€ä¸ªæœ€çŸ­çš„ç”Ÿå‘½å‘¨æœŸã€‚ ä¸€æ—¦å˜é‡è¢«æŒ‡å®šäº†ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œå®ƒå°±ä¸€ç›´å—åˆ°è¿™ä¸ªç”Ÿå‘½å‘¨æœŸçº¦æŸã€‚å˜é‡çš„ç”Ÿå‘½å‘¨æœŸåªèƒ½ç¼©çŸ­ï¼Œ å¹¶ä¸”æ‰€æœ‰ç¼©çŸ­éƒ½ä¼šåœ¨ç¼–è¯‘å™¨è¢«ç¡®å®šã€‚\nè¦ç‚¹:\nç”Ÿå‘½å‘¨æœŸæ˜¯åœ¨ç¼–è¯‘æœŸé™æ€éªŒè¯çš„ ç”Ÿå‘½å‘¨æœŸä¸èƒ½åœ¨è¿è¡Œæ—¶å˜é•¿ã€ç¼©çŸ­æˆ–è€…æ”¹å˜ Rustçš„å€Ÿç”¨æ£€æŸ¥æ€»æ˜¯ä¼šä¸ºæ‰€æœ‰å˜é‡æŒ‡å®šä¸€ä¸ªæœ€çŸ­å¯èƒ½çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”å‡å®šæ‰€æœ‰ä»£ç è·¯å¾„éƒ½ä¼šè¢«æ‰§è¡Œ è¯¯è§£9: å°†å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨æ˜¯å®‰å…¨çš„ è¯¯è§£æ¨è®º\né‡æ–°å€Ÿç”¨ä¸€ä¸ªå¼•ç”¨ä¼šç»ˆæ­¢å®ƒçš„ç”Ÿå‘½å‘¨æœŸå¹¶ä¸”å¼€å§‹ä¸€ä¸ªæ–°çš„ ä½ å¯ä»¥å‘ä¸€ä¸ªæ¥æ”¶å…±äº«å¼•ç”¨çš„å‡½æ•°ä¼ é€’ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œå› ä¸ºRustä¼šéšå¼å°†å¯å˜å¼•ç”¨é‡æ–°å€Ÿç”¨ä¸ºä¸å¯å˜å¼•ç”¨ï¼š\n1 2 3 4 5 6 7 fn takes_shared_ref(n: \u0026amp;i32) {} fn main() { let mut a = 10; takes_shared_ref(\u0026amp;mut a); // ç¼–è¯‘é€šè¿‡ takes_shared_ref(\u0026amp;*(\u0026amp;mut a)); // ä¸Šä¸€è¡Œçš„æ˜¾å¼å†™æ³• } ç›´è§‰ä¸Šè¿™æ²¡é—®é¢˜ï¼Œå°†ä¸€ä¸ªå¯å˜å¼•ç”¨é‡æ–°å€Ÿç”¨ä¸ºä¸å¯å˜å¼•ç”¨ï¼Œåº”è¯¥ä¸ä¼šæœ‰ä»€ä¹ˆå®³å¤„ä¸æ˜¯å—ï¼Ÿ ç„¶è€Œå¹¶éå¦‚æ­¤ï¼Œä¸‹é¢çš„ä»£ç è¿‡ä¸äº†ç¼–è¯‘ã€‚\n1 2 3 4 5 6 fn main() { let mut a = 10; let b: \u0026amp;i32 = \u0026amp;*(\u0026amp;mut a); // é‡æ–°å€Ÿç”¨ä¸ºä¸å¯å˜ let c: \u0026amp;i32 = \u0026amp;a; dbg!(b, c); // ç¼–è¯‘é”™è¯¯ } æŠ¥é”™ï¼š\n1 2 3 4 5 6 7 8 9 error[E0502]: cannot borrow `a` as immutable because it is also borrowed as mutable --\u0026gt; src/main.rs:4:19 | 3 | let b: \u0026amp;i32 = \u0026amp;*(\u0026amp;mut a); | -------- mutable borrow occurs here 4 | let c: \u0026amp;i32 = \u0026amp;a; | ^^ immutable borrow occurs here 5 | dbg!(b, c); | - mutable borrow later used here å¯å˜å€Ÿç”¨å‡ºç°åç«‹å³é‡æ–°å€Ÿç”¨ä¸ºä¸å¯å˜å¼•ç”¨ï¼Œç„¶åå¯å˜å¼•ç”¨è‡ªèº«ææ„ã€‚ ä¸ºä»€ä¹ˆRustä¼šè®¤ä¸ºè¿™ä¸ªä¸å¯å˜çš„é‡æ–°å€Ÿç”¨ä»å…·æœ‰å¯å˜å¼•ç”¨çš„ç‹¬å ç”Ÿå‘½å‘¨æœŸï¼Ÿ è™½ç„¶ä¸Šé¢è¿™ä¸ªä¾‹å­æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å…è®¸å°†å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨å®é™…ä¸Šå¼•å…¥äº†æ½œåœ¨çš„å†…å­˜å®‰å…¨é—®é¢˜ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 use std::sync::Mutex; struct Struct { mutex: Mutex\u0026lt;String\u0026gt; } impl Struct { // å°†selfçš„å¯å˜å¼•ç”¨é™çº§ä¸ºstrçš„å…±äº«å¼•ç”¨ fn get_string(\u0026amp;mut self) -\u0026gt; \u0026amp;str { self.mutex.get_mut().unwrap() } fn mutate_string(\u0026amp;self) { // å¦‚æœRustå…è®¸å°†å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨ï¼Œ // é‚£ä¹ˆä¸‹é¢è¿™è¡Œä»£ç ä¼šä½¿å¾—æ‰€æœ‰ä»get_stringä¸­å¾—åˆ°çš„å…±äº«å¼•ç”¨å¤±æ•ˆ *self.mutex.lock().unwrap() = \u0026#34;surprise!\u0026#34;.to_owned(); } } fn main() { let mut s = Struct { mutex: Mutex::new(\u0026#34;string\u0026#34;.to_owned()) }; let str_ref = s.get_string(); // å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨ s.mutate_string(); // str_refå¤±æ•ˆï¼Œå˜ä¸ºæ‚¬ç©ºæŒ‡é’ˆ dbg!(str_ref); // ç¼–è¯‘é”™è¯¯ï¼Œå’Œæˆ‘ä»¬é¢„æœŸçš„ä¸€æ · } è¿™é‡Œçš„é—®é¢˜åœ¨äºï¼Œå½“ä½ å°†ä¸€ä¸ªå¯å˜å¼•ç”¨é‡æ–°å€Ÿç”¨ä¸ºå…±äº«å¼•ç”¨ï¼Œä½ ä¼šé‡åˆ°ä¸€ç‚¹éº»çƒ¦ï¼š å³ä½¿å¯å˜å¼•ç”¨å·²ç»ææ„ï¼Œé‡æ–°å€Ÿç”¨å‡ºæ¥çš„å…±äº«å¼•ç”¨è¿˜æ˜¯ä¼šå°†å¯å˜å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿åˆ°å’Œè‡ªå·±ä¸€æ ·é•¿ã€‚ è¿™ç§é‡æ–°å€Ÿç”¨å‡ºæ¥çš„å…±äº«å¼•ç”¨éå¸¸éš¾ç”¨ï¼Œå› ä¸ºå®ƒä¸èƒ½ä¸å…¶å®ƒå…±äº«å¼•ç”¨å…±å­˜ã€‚ å®ƒæœ‰ç€å¯å˜å¼•ç”¨å’Œä¸å¯å˜å¼•ç”¨çš„æ‰€æœ‰ç¼ºç‚¹ï¼Œå´æ²¡æœ‰å®ƒä»¬å„è‡ªçš„ä¼˜ç‚¹ã€‚ æˆ‘è®¤ä¸ºå°†å¯å˜å¼•ç”¨é‡æ–°å€Ÿç”¨ä¸ºå…±äº«å¼•ç”¨åº”è¯¥è¢«è®¤ä¸ºæ˜¯Rustçš„åæ¨¡å¼ï¼ˆanti-pattern)ã€‚ å¯¹è¿™ç§åæ¨¡å¼ä¿æŒè­¦æƒ•å¾ˆé‡è¦ï¼Œè¿™å¯ä»¥è®©ä½ åœ¨çœ‹åˆ°ä¸‹é¢è¿™æ ·çš„ä»£ç çš„æ—¶å€™æ›´å®¹æ˜“å‘ç°å®ƒï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 // å°†Tçš„å¯å˜å¼•ç”¨é™çº§ä¸ºå…±äº«å¼•ç”¨ fn some_function\u0026lt;T\u0026gt;(some_arg: \u0026amp;mut T) -\u0026gt; \u0026amp;T; struct Struct; impl Struct { // å°†selfçš„å¯å˜å¼•ç”¨é™çº§ä¸ºselfå…±äº«å¼•ç”¨ fn some_method(\u0026amp;mut self) -\u0026gt; \u0026amp;self; // å°†selfçš„å¯å˜å¼•ç”¨é™çº§ä¸ºTçš„å…±äº«å¼•ç”¨ fn other_method(\u0026amp;mut self) -\u0026gt; \u0026amp;T; } å³ä½¿ä½ é¿å…äº†å‡½æ•°å’Œæ–¹æ³•ç­¾åä¸­çš„é‡æ–°å€Ÿç”¨ï¼ŒRustä»ç„¶ä¼šè‡ªåŠ¨éšå¼é‡æ–°å€Ÿç”¨ï¼Œ æ‰€ä»¥å¾ˆå®¹æ˜“æ— æ„ä¸­é‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 use std::collections::HashMap; type PlayerID = i32; #[derive(Debug, Default)] struct Player { score: i32, } fn start_game(player_a: PlayerID, player_b: PlayerID, server: \u0026amp;mut HashMap\u0026lt;PlayerID, Player\u0026gt;) { // ä»æœåŠ¡å™¨ä¸­è·å–playerï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºå¹¶æ’å…¥ä¸€ä¸ªæ–°çš„ let player_a: \u0026amp;Player = server.entry(player_a).or_default(); let player_b: \u0026amp;Player = server.entry(player_b).or_default(); // ç”¨playeråšç‚¹ä»€ä¹ˆ dbg!(player_a, player_b); // ç¼–è¯‘é”™è¯¯ } ä¸Šé¢çš„ä»£ç ç¼–è¯‘å¤±è´¥ã€‚å› ä¸º or_default() è¿”å›ä¸€ä¸ª \u0026amp;mut Playerï¼Œ è€Œæˆ‘ä»¬çš„æ˜¾å¼ç±»å‹æ ‡æ³¨ \u0026amp;Player ä½¿å¾—è¿™ä¸ª \u0026amp;mut Player è¢«éšå¼é‡æ–°å€Ÿç”¨ä¸º \u0026amp;Player ã€‚ ä¸ºäº†é€šè¿‡ç¼–è¯‘ï¼Œæˆ‘ä»¬ä¸å¾—ä¸è¿™æ ·å†™ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 use std::collections::HashMap; type PlayerID = i32; #[derive(Debug, Default)] struct Player { score: i32, } fn start_game(player_a: PlayerID, player_b: PlayerID, server: \u0026amp;mut HashMap\u0026lt;PlayerID, Player\u0026gt;) { // å› ä¸ºæˆ‘ä»¬ä¸èƒ½æŠŠå®ƒä»¬æ”¾åœ¨ä¸€èµ·ç”¨ï¼Œæ‰€ä»¥è¿™é‡ŒæŠŠè¿”å›çš„Playerå¯å˜å¼•ç”¨ææ„æ‰ server.entry(player_a).or_default(); server.entry(player_b).or_default(); // å†æ¬¡è·å–è¿™äº›Playerï¼Œè¿™æ¬¡ä»¥ä¸å¯å˜çš„æ–¹å¼ï¼Œé¿å…å‡ºç°éšå¼é‡æ–°å€Ÿç”¨ let player_a = server.get(\u0026amp;player_a); let player_b = server.get(\u0026amp;player_b); // ç”¨Playeråšç‚¹ä»€ä¹ˆ dbg!(player_a, player_b); // ç¼–è¯‘é€šè¿‡ } è™½ç„¶æœ‰ç‚¹å°´å°¬å’Œç¬¨é‡ï¼Œä½†è¿™ä¹Ÿç®—æ˜¯ä¸ºå†…å­˜å®‰å…¨åšå‡ºçš„ç‰ºç‰²ã€‚\nè¦ç‚¹:\nå°½é‡ä¸è¦æŠŠå¯å˜å¼•ç”¨é‡æ–°å€Ÿç”¨ä¸ºå…±äº«å¼•ç”¨ï¼Œä¸ç„¶ä½ ä¼šé‡åˆ°ä¸å°‘éº»çƒ¦ é‡æ–°å€Ÿç”¨ä¸€ä¸ªå¯å˜å¼•ç”¨ä¸ä¼šä½¿å¾—å®ƒçš„ç”Ÿå‘½å‘¨æœŸç»ˆç»“ï¼Œå³ä½¿è¿™ä¸ªå¯å˜å¼•ç”¨å·²ç»ææ„ è¯¯è§£10: é—­åŒ…éµå¾ªå’Œå‡½æ•°ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ æ¯”èµ·è¯¯è§£ï¼Œè¿™æ›´åƒæ˜¯Rustçš„ä¸€ä¸ªå°é™·é˜±ã€‚\né—­åŒ…ï¼Œè™½ç„¶ä¹Ÿæ˜¯ä¸ªå‡½æ•°ï¼Œä½†æ˜¯å®ƒå¹¶ä¸éµå¾ªå’Œå‡½æ•°ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ã€‚\n1 2 3 4 5 6 7 fn function(x: \u0026amp;i32) -\u0026gt; \u0026amp;i32 { x } fn main() { let closure = |x: \u0026amp;i32| x; } æŠ¥é”™ï¼š\n1 2 3 4 5 6 7 8 error: lifetime may not live long enough --\u0026gt; src/main.rs:6:29 | 6 | let closure = |x: \u0026amp;i32| x; | - - ^ returning this value requires that `\u0026#39;1` must outlive `\u0026#39;2` | | | | | return type of closure is \u0026amp;\u0026#39;2 i32 | let\u0026#39;s call the lifetime of this reference `\u0026#39;1` å»æ‰è¯­æ³•ç³–åï¼š\n1 2 3 4 5 6 7 8 9 10 // è¾“å…¥çš„ç”Ÿå‘½å‘¨æœŸåº”ç”¨åˆ°è¾“å‡ºä¸Š fn function\u0026lt;\u0026#39;a\u0026gt;(x: \u0026amp;\u0026#39;a i32) -\u0026gt; \u0026amp;\u0026#39;a i32 { x } fn main() { // è¾“å…¥å’Œè¾“å‡ºæœ‰å®ƒä»¬è‡ªå·±ç‹¬æœ‰çš„ç”Ÿå‘½å‘¨æœŸ let closure = for\u0026lt;\u0026#39;a, \u0026#39;b\u0026gt; |x: \u0026amp;\u0026#39;a i32| -\u0026gt; \u0026amp;\u0026#39;b i32 { x }; // æ³¨æ„ï¼šä¸Šé¢è¿™è¡Œä»£ç ä¸æ˜¯åˆæ³•çš„è¯­æ³•ï¼Œä½†å¯ä»¥è¡¨è¾¾å‡ºæˆ‘ä»¬çš„æ„æ€ } å‡ºç°è¿™ç§å·®å¼‚å¹¶æ²¡æœ‰ä¸€ä¸ªå¥½çš„ç†ç”±ã€‚é—­åŒ…æœ€æ—©çš„å®ç°ç”¨çš„ç±»å‹æ¨æ–­è¯­ä¹‰å’Œå‡½æ•°ä¸åŒï¼Œ ç°åœ¨å˜å¾—æ²¡æ³•æ”¹äº†ï¼Œå› ä¸ºå°†å®ƒä»¬ç»Ÿä¸€èµ·æ¥ä¼šé€ æˆä¸€ä¸ªä¸å…¼å®¹çš„æ”¹åŠ¨ã€‚ é‚£ä¹ˆæˆ‘ä»¬è¦æ€ä¹ˆæ ·æ˜¾å¼æ ‡æ³¨é—­åŒ…çš„ç±»å‹å‘¢ï¼Ÿæˆ‘ä»¬å¯é€‰çš„åŠæ³•æœ‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 fn main() { // è½¬æˆtrait objectï¼Œå˜æˆä¸å®šé•¿ç±»å‹ï¼Œç¼–è¯‘é”™è¯¯ let identity: dyn Fn(\u0026amp;i32) -\u0026gt; \u0026amp;i32 = |x: \u0026amp;i32| x; // å¯ä»¥é€šè¿‡å°†å®ƒåˆ†é…åœ¨å †ä¸Šæ¥ç»•è¿‡è¿™ä¸ªé”™è¯¯ï¼Œä½†è¿™æ ·å¾ˆç¬¨é‡ let identity: Box\u0026lt;dyn Fn(\u0026amp;i32) -\u0026gt; \u0026amp;i32\u0026gt; = Box::new(|x: \u0026amp;i32| x); // ä¹Ÿå¯ä»¥è·³è¿‡åˆ†é…ï¼Œç›´æ¥åˆ›å»ºä¸€ä¸ªé™æ€çš„å¼•ç”¨ let identity: \u0026amp;dyn Fn(\u0026amp;i32) -\u0026gt; \u0026amp;i32 = \u0026amp;|x: \u0026amp;i32| x; // ä¸Šä¸€è¡Œå»æ‰è¯­æ³•ç³–ä¹‹å:) let identity: \u0026amp;\u0026#39;static (dyn for\u0026lt;\u0026#39;a\u0026gt; Fn(\u0026amp;\u0026#39;a i32) -\u0026gt; \u0026amp;\u0026#39;a i32 + \u0026#39;static) = \u0026amp;|x: \u0026amp;i32| -\u0026gt; \u0026amp;i32 { x }; // ç†æƒ³ä¸­çš„å†™æ³•æ˜¯è¿™æ ·çš„ï¼Œä½†è¿™ä¸æ˜¯æœ‰æ•ˆçš„è¯­æ³• let identity: impl Fn(\u0026amp;i32) -\u0026gt; \u0026amp;i32 = |x: \u0026amp;i32| x; // è¿™æ ·ä¹Ÿä¸é”™ï¼Œä½†ä¹Ÿä¸æ˜¯æœ‰æ•ˆçš„è¯­æ³• let identity = for\u0026lt;\u0026#39;a\u0026gt; |x: \u0026amp;\u0026#39;a i32| -\u0026gt; \u0026amp;\u0026#39;a i32 { x }; // \u0026#34;impl trait\u0026#34;å¯ä»¥å†™åœ¨å‡½æ•°è¿”å›çš„ä½ç½®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™æ ·å†™ fn return_identity() -\u0026gt; impl Fn(\u0026amp;i32) -\u0026gt; \u0026amp;i32 { |x| x } let identity = return_identity(); // å‰ä¸€ç§è§£å†³æ–¹æ¡ˆæ›´æ³›åŒ–çš„å†™æ³• fn annotate\u0026lt;T, F\u0026gt;(f: F) -\u0026gt; F where F: Fn(\u0026amp;T) -\u0026gt; \u0026amp;T { f } let identity = annotate(|x: \u0026amp;i32| x); } ç›¸ä¿¡ä½ å·²ç»æ³¨æ„åˆ°ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå½“é—­åŒ…ç±»å‹ä½¿ç”¨traitçº¦æŸçš„æ—¶å€™ä¼šéµå¾ªä¸€èˆ¬å‡½æ•°çš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ã€‚\nè¿™é‡Œæ²¡æœ‰ä»€ä¹ˆçœŸæ­£çš„æ•™è®­å’Œæ´å¯Ÿï¼Œåªæ˜¯å®ƒå°±æ˜¯è¿™æ ·çš„è€Œå·²ã€‚\nè¦ç‚¹:\næ¯ä¸€é—¨è¯­è¨€éƒ½æœ‰è‡ªå·±çš„å°é™·é˜± ğŸ¤· è¯¯è§£11: \u0026lsquo;static å¼•ç”¨æ€»èƒ½å¼ºåˆ¶è½¬æ¢ä¸º \u0026lsquo;a å¼•ç”¨ æˆ‘å‰é¢ç»™å‡ºäº†è¿™ä¸ªä¾‹å­ï¼š\n1 2 fn get_str\u0026lt;\u0026#39;a\u0026gt;() -\u0026gt; \u0026amp;\u0026#39;a str; // æ³›å‹ç‰ˆæœ¬ fn get_str() -\u0026gt; \u0026amp;\u0026#39;static str; // \u0026#39;staticç‰ˆæœ¬ æœ‰çš„è¯»è€…é—®æˆ‘è¿™ä¸¤ä¸ªåœ¨å®è·µä¸­æ˜¯å¦æœ‰åŒºåˆ«ã€‚ä¸€å¼€å§‹æˆ‘ä¹Ÿä¸å¤ªç¡®å®šï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œ åœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„ç ”ç©¶ä¹‹åæˆ‘å‘ç°å®ƒä»¬åœ¨å®è·µä¸­ç¡®å®å­˜åœ¨ç€åŒºåˆ«ã€‚\næ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨æ“ä½œå€¼å¾—æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ \u0026lsquo;static å¼•ç”¨æ¥æ›¿æ¢ \u0026lsquo;a å¼•ç”¨ï¼Œ å› ä¸ºRustä¼šè‡ªåŠ¨å°† \u0026lsquo;static å¼•ç”¨å¼ºåˆ¶è½¬æ¢åˆ° \u0026lsquo;a å¼•ç”¨ã€‚ ç›´è§‰ä¸Šæ¥è®²ï¼Œè¿™æ²¡æ¯›ç—…ï¼Œåœ¨ä¸€ä¸ªè¦æ±‚è¾ƒçŸ­ç”Ÿå‘½å‘¨æœŸå¼•ç”¨çš„åœ°æ–¹ä½¿ç”¨ä¸€ä¸ªæœ‰ç€æ›´é•¿çš„ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨ä¸ä¼šé€ æˆå†…å­˜å®‰å…¨é—®é¢˜ã€‚ ä¸‹é¢çš„ä»£ç å’Œæˆ‘ä»¬æƒ³çš„ä¸€æ ·ç¼–è¯‘é€šè¿‡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 use rand; fn generic_str_fn\u0026lt;\u0026#39;a\u0026gt;() -\u0026gt; \u0026amp;\u0026#39;a str { \u0026#34;str\u0026#34; } fn static_str_fn() -\u0026gt; \u0026amp;\u0026#39;static str { \u0026#34;str\u0026#34; } fn a_or_b\u0026lt;T\u0026gt;(a: T, b: T) -\u0026gt; T { if rand::random() { a } else { b } } fn main() { let some_string = \u0026#34;string\u0026#34;.to_owned(); let some_str = \u0026amp;some_string[..]; let str_ref = a_or_b(some_str, generic_str_fn()); // ç¼–è¯‘é€šè¿‡ let str_ref = a_or_b(some_str, static_str_fn()); // ç¼–è¯‘é€šè¿‡ } ç„¶è€Œï¼Œè¿™ç§å¼ºåˆ¶è½¬æ¢å¹¶ä¸ä¼šåœ¨å¼•ç”¨ä½œä¸ºå‡½æ•°çš„ç±»å‹ç­¾åçš„ä¸€éƒ¨åˆ†çš„æ—¶å€™å‡ºç°ï¼Œæ‰€ä»¥ä¸‹é¢è¿™æ®µä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 use rand; fn generic_str_fn\u0026lt;\u0026#39;a\u0026gt;() -\u0026gt; \u0026amp;\u0026#39;a str { \u0026#34;str\u0026#34; } fn static_str_fn() -\u0026gt; \u0026amp;\u0026#39;static str { \u0026#34;str\u0026#34; } fn a_or_b_fn\u0026lt;T, F\u0026gt;(a: T, b_fn: F) -\u0026gt; T where F: Fn() -\u0026gt; T { if rand::random() { a } else { b_fn() } } fn main() { let some_string = \u0026#34;string\u0026#34;.to_owned(); let some_str = \u0026amp;some_string[..]; let str_ref = a_or_b_fn(some_str, generic_str_fn); // ç¼–è¯‘é€šè¿‡ let str_ref = a_or_b_fn(some_str, static_str_fn); // ç¼–è¯‘é”™è¯¯ } æŠ¥é”™ï¼š\n1 2 3 4 5 6 7 8 9 10 error[E0597]: `some_string` does not live long enough --\u0026gt; src/main.rs:23:21 | 23 | let some_str = \u0026amp;some_string[..]; | ^^^^^^^^^^^ borrowed value does not live long enough ... 25 | let str_ref = a_or_b_fn(some_str, static_str_fn); | ---------------------------------- argument requires that `some_string` is borrowed for `\u0026#39;static` 26 | } | - `some_string` dropped here while still borrowed è¿™ç®—ä¸ç®—Rustçš„å°é™·é˜±è¿˜æœ‰å¾…å•†æ¦·ï¼Œå› ä¸ºè¿™ä¸æ˜¯ \u0026amp;\u0026lsquo;static str åˆ° \u0026amp;\u0026lsquo;a str ç®€å•ç›´æ¥çš„å¼ºåˆ¶è½¬æ¢ï¼Œ è€Œæ˜¯ for Fn() -\u0026gt; \u0026amp;\u0026lsquo;static T åˆ° for\u0026lt;\u0026lsquo;a, T\u0026gt; Fn() -\u0026gt; \u0026amp;\u0026lsquo;a T è¿™ç§æ›´å¤æ‚çš„æƒ…å†µã€‚ å‰è€…æ˜¯å€¼ä¹‹é—´çš„å¼ºåˆ¶è½¬æ¢ï¼Œåè€…æ˜¯ç±»å‹ä¹‹é—´çš„å¼ºåˆ¶è½¬æ¢ã€‚\nè¦ç‚¹:\nç­¾åä¸º for\u0026lt;\u0026lsquo;a, T\u0026gt; Fn() -\u0026gt; \u0026amp;\u0026lsquo;a T çš„å‡½æ•°è¦æ¯”ç­¾åä¸º for fn() -\u0026gt; \u0026amp;\u0026lsquo;static T çš„å‡½æ•°æ›´ä¸ºçµæ´»ï¼Œå¹¶ä¸”èƒ½ç”¨åœ¨æ›´å¤šåœºæ™¯ä¸‹ æ€»ç»“: T æ˜¯ \u0026amp;T å’Œ \u0026amp;mut T çš„è¶…é›† \u0026amp;T å’Œ \u0026amp;mut T æ˜¯ä¸ç›¸äº¤çš„é›†åˆ T: \u0026lsquo;static åº”è¯¥è¢«è¯»ä½œ \u0026ldquo;T å— \u0026lsquo;static ç”Ÿå‘½å‘¨æœŸçº¦æŸ\u0026rdquo; å¦‚æœ T: \u0026lsquo;static é‚£ä¹ˆ T å¯ä»¥æ˜¯ä¸€ä¸ªæœ‰ç€ \u0026lsquo;static ç”Ÿå‘½å‘¨æœŸçš„å€Ÿç”¨ç±»å‹ï¼Œæˆ–æ˜¯ä¸€ä¸ªæ‰€æœ‰æƒç±»å‹ æ—¢ç„¶ T: \u0026lsquo;static åŒ…å«äº†æ‰€æœ‰æƒç±»å‹ï¼Œé‚£ä¹ˆæ„å‘³ç€ T å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ†é… ä¸å¿…åœ¨æ•´ä¸ªç¨‹åºä¸­éƒ½æ˜¯æœ‰æ•ˆçš„ å¯ä»¥è¢«å®‰å…¨åœ°ä»»æ„ä¿®æ”¹ å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ææ„ å¯ä»¥æœ‰ä¸åŒé•¿åº¦çš„ç”Ÿå‘½å‘¨æœŸ T: \u0026lsquo;a æ¯” \u0026amp;\u0026lsquo;a T æ›´æ³›åŒ–ã€çµæ´» T: \u0026lsquo;a æ¥æ”¶æ‰€æœ‰æƒç±»å‹ã€å¸¦å¼•ç”¨çš„æ‰€æœ‰æƒç±»å‹ï¼Œä»¥åŠå¼•ç”¨ \u0026amp;\u0026lsquo;a T åªæ¥æ”¶å¼•ç”¨ å¦‚æœ T: \u0026lsquo;static é‚£ä¹ˆ T: \u0026lsquo;aï¼Œå› ä¸ºå¯¹äºæ‰€æœ‰ \u0026lsquo;a éƒ½æœ‰ \u0026lsquo;static \u0026gt;= \u0026lsquo;a å‡ ä¹æ‰€æœ‰Rustä»£ç éƒ½æ˜¯æ³›å‹çš„ï¼Œåˆ°å¤„éƒ½æœ‰çœç•¥çš„ç”Ÿå‘½å‘¨æœŸ Rustçš„ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™å¹¶ä¸æ˜¯åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å¯¹ Rustå¹¶ä¸æ¯”ä½ æ›´äº†è§£ä½ ç¨‹åºçš„è¯­ä¹‰ ç»™ç”Ÿå‘½å‘¨æœŸæ ‡è®°èµ·ä¸€ä¸ªæœ‰æè¿°æ€§çš„åå­— è€ƒè™‘æ¸…æ¥šå“ªé‡Œéœ€è¦æ˜¾å¼å†™å‡ºç”Ÿå‘½å‘¨æœŸæ ‡è®°ï¼Œä»¥åŠä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå†™ æ‰€æœ‰trait objectéƒ½æœ‰é»˜è®¤æ¨æ–­çš„ç”Ÿå‘½å‘¨æœŸçº¦æŸ Rustçš„ç¼–è¯‘é”™è¯¯ä¿¡æ¯å¯ä»¥è®©ä½ çš„ä»£ç é€šè¿‡ç¼–è¯‘ï¼Œä½†ä¸ä¸€å®šæ˜¯æœ€ç¬¦åˆä½ ä»£ç è¦æ±‚çš„ ç”Ÿå‘½å‘¨æœŸæ˜¯åœ¨ç¼–è¯‘æœŸé™æ€éªŒè¯çš„ ç”Ÿå‘½å‘¨æœŸä¸ä¼šä»¥ä»»ä½•æ–¹å¼åœ¨è¿è¡Œæ—¶å˜é•¿ç¼©çŸ­ Rustçš„å€Ÿç”¨æ£€æŸ¥æ€»ä¼šä¸ºæ¯ä¸ªå˜é‡é€‰æ‹©ä¸€ä¸ªæœ€çŸ­å¯èƒ½çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”å‡å®šæ¯æ¡ä»£ç è·¯å¾„éƒ½ä¼šè¢«æ‰§è¡Œ å°½é‡é¿å…å°†å¯å˜å¼•ç”¨é‡æ–°å€Ÿç”¨ä¸ºä¸å¯å˜å¼•ç”¨ï¼Œä¸ç„¶ä½ ä¼šé‡åˆ°ä¸å°‘éº»çƒ¦ é‡æ–°å€Ÿç”¨ä¸€ä¸ªå¯å˜å¼•ç”¨ä¸ä¼šç»ˆæ­¢å®ƒçš„ç”Ÿå‘½å‘¨æœŸï¼Œå³ä½¿è¿™ä¸ªå¯å˜å¼•ç”¨å·²ç»ææ„ æ¯ä¸ªè¯­è¨€éƒ½æœ‰è‡ªå·±çš„å°é™·é˜± ","permalink":"https://reid00.github.io/en/posts/langs_linux/rust%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%B8%B8%E8%A7%81%E8%AF%AF%E5%8C%BA/","summary":"ä»‹ç» æˆ‘æ›¾ç»æœ‰è¿‡çš„æ‰€æœ‰è¿™äº›å¯¹ç”Ÿå‘½å‘¨æœŸçš„è¯¯è§£ï¼Œç°åœ¨æœ‰å¾ˆå¤šåˆå­¦è€…ä¹Ÿæ·±é™·äºæ­¤ã€‚ æˆ‘ç”¨åˆ°çš„æœ¯è¯­å¯èƒ½ä¸æ˜¯æ ‡å‡†çš„ï¼Œæ‰€ä»¥ä¸‹é¢åˆ—äº†ä¸€ä¸ªè¡¨æ ¼æ¥è§£é‡Šå®ƒä»¬çš„ç”¨æ„ã€‚\nçŸ­è¯­ æ„ä¸º T åŒ…å«äº†æ‰€æœ‰å¯èƒ½ç±»å‹çš„é›†åˆ æˆ– è¿™ä¸ªé›†åˆä¸­çš„ç±»å‹ æ‰€æœ‰æƒç±»å‹ ä¸å«å¼•ç”¨çš„ç±»å‹, ä¾‹å¦‚ i32, String, Vec, ç­‰ å€Ÿç”¨ç±»å‹ æˆ– å¼•ç”¨ç±»å‹ ä¸è€ƒè™‘å¯å˜æ€§çš„å¼•ç”¨ç±»å‹, ä¾‹å¦‚ \u0026amp;i32, \u0026amp;mut i32 ç­‰ å¯å˜å¼•ç”¨ æˆ– ç‹¬å å¼•ç”¨ ç‹¬å çš„å¯å˜å¼•ç”¨, å³ \u0026amp;mut T ä¸å¯å˜å¼•ç”¨ æˆ– å…±äº«å¼•ç”¨ å…±äº«çš„ä¸å¯å˜å¼•ç”¨, å³ \u0026amp;T è¯¯è§£é¡¹ ç®€è€Œè¨€ä¹‹ï¼šå˜é‡çš„ç”Ÿå‘½å‘¨æœŸæŒ‡çš„æ˜¯è¿™ä¸ªå˜é‡æ‰€æŒ‡çš„æ•°æ®å¯ä»¥è¢«ç¼–è¯‘å™¨é™æ€éªŒè¯çš„ã€åœ¨å½“å‰å†…å­˜åœ°å€æœ‰æ•ˆæœŸçš„é•¿åº¦ã€‚\nè¯¯è§£1: T åªåŒ…å«æ‰€æœ‰æƒç±»å‹ è¿™ä¸ªè¯¯è§£æ¯”èµ·è¯´ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒå’Œæ³›å‹æ›´ç›¸å…³ï¼Œä½†åœ¨Rustä¸­æ³›å‹å’Œç”Ÿå‘½å‘¨æœŸæ˜¯ç´§å¯†è”ç³»åœ¨ä¸€èµ·çš„ï¼Œä¸å¯åªè°ˆå…¶ä¸€ã€‚\nå½“æˆ‘åˆšå¼€å§‹å­¦ä¹ Rustçš„æ—¶å€™ï¼Œæˆ‘ç†è§£i32ï¼Œ\u0026amp;i32ï¼Œå’Œ\u0026amp;mut i32æ˜¯ä¸åŒçš„ç±»å‹ï¼Œä¹Ÿæ˜ç™½æ³›å‹å˜é‡Tä»£è¡¨ç€æ‰€æœ‰å¯èƒ½ç±»å‹çš„é›†åˆã€‚ ä½†å°½ç®¡è¿™äºŒè€…åˆ†å¼€éƒ½æ‡‚ï¼Œå½“å®ƒä»¬ç»“åˆåœ¨ä¸€èµ·çš„æ—¶å€™æˆ‘å´é™·å…¥å›°æƒ‘ã€‚åœ¨æˆ‘è¿™ä¸ªRuståˆå­¦è€…çš„çœ¼ä¸­ï¼Œæ³›å‹æ˜¯è¿™æ ·çš„è¿ä½œçš„ï¼š\nç±»å‹å˜é‡ T \u0026amp;T \u0026amp;mut T ä¾‹å­ i32 \u0026amp;i32 \u0026amp;mut i32 T åŒ…å«ä¸€åˆ‡æ‰€æœ‰æƒç±»å‹ï¼› \u0026amp;T åŒ…å«ä¸€åˆ‡ä¸å¯å˜å€Ÿç”¨ç±»å‹ï¼› \u0026amp;mut T åŒ…å«ä¸€åˆ‡å¯å˜å€Ÿç”¨ç±»å‹ã€‚ Tï¼Œ \u0026amp;Tï¼Œ å’Œ \u0026amp;mut T æ˜¯ä¸ç›¸äº¤çš„æœ‰é™é›†ã€‚ ç®€æ´æ˜äº†ï¼Œç¬¦åˆç›´è§‰ï¼Œä½†å´å®Œå…¨é”™è¯¯ã€‚ ä¸‹é¢è¿™æ‰æ˜¯æ³›å‹çœŸæ­£çš„è¿ä½œæ–¹å¼ï¼š ç±»å‹å˜é‡ T \u0026amp;T \u0026amp;mut T ä¾‹å­ i32, \u0026amp;i32, \u0026amp;mut i32, \u0026amp;\u0026amp;i32, \u0026amp;mut \u0026amp;mut i32, \u0026hellip; \u0026amp;i32, \u0026amp;\u0026amp;i32, \u0026amp;\u0026amp;mut i32, \u0026hellip; \u0026amp;mut i32, \u0026amp;mut \u0026amp;mut i32, \u0026amp;mut \u0026amp;i32, \u0026hellip; T, \u0026amp;T, å’Œ \u0026amp;mut T éƒ½æ˜¯æ— é™é›†, å› ä¸ºä½ å¯ä»¥æ— é™å€Ÿç”¨ä¸€ä¸ªç±»å‹ã€‚ T æ˜¯ \u0026amp;T å’Œ \u0026amp;mut Tçš„è¶…é›†.","title":"Rustç”Ÿå‘½å‘¨æœŸå¸¸è§è¯¯åŒº"},{"content":"RDFå’Œå±æ€§å›¾ é¦–å…ˆæ¥ä»‹ç» RDF å’Œå±æ€§å›¾ã€‚å¤§å®¶çŸ¥é“ä¸–ç•Œä¸‡ç‰©æ˜¯æ™®éè”ç³»çš„ï¼ŒInternet å¸¦æ¥äº†ä¿¡æ¯çš„è¿é€šï¼ŒIoT å¸¦æ¥äº†è®¾å¤‡çš„è¿é€šï¼Œåƒå¾®ä¿¡ã€å¾®åšã€æŠ–éŸ³ã€å¿«æ‰‹è¿™äº› APP å¸¦æ¥äº†äººé™…å…³ç³»çš„è¿é€šã€‚éšç€ç¤¾äº¤ã€é›¶å”®ã€é‡‘èã€ç”µä¿¡ã€ç‰©æµç­‰è¡Œä¸šçš„å¿«é€Ÿå‘å±•ï¼Œå½“ä»Šç¤¾ä¼šæ”¯èµ·äº†ä¸€å¼ åºå¤§è€Œå¤æ‚çš„å…³ç³»ç½‘ï¼Œåœ¨äººä»¬çš„ç”Ÿäº§å’Œç”Ÿæ´»è¿‡ç¨‹ä¸­ï¼Œæ¯æ—¶æ¯åˆ»éƒ½äº§ç”Ÿç€å¤§é‡çš„æ•°æ®ã€‚éšç€æŠ€æœ¯çš„å‘å±•ï¼Œæˆ‘ä»¬å¯¹è¿™äº›æ•°æ®çš„åˆ†æå’Œä½¿ç”¨ä¹Ÿä¸å†å±€é™äºä»ç»Ÿè®¡çš„è§’åº¦è¿›è¡Œä¸€äº›ç›¸å…³æ€§çš„åˆ†æï¼Œè€Œæ˜¯å¸Œæœ›ä»å…³è”çš„è§’åº¦æ­ç¤ºæ•°æ®çš„ä¸€äº›å› æœè”ç³»ã€‚è¿™é‡Œçš„å…³è”ï¼ŒæŒ‡çš„æ˜¯ç›¸äº’è¿æ¥çš„ connectivityï¼Œè€Œä¸æ˜¯ç»Ÿè®¡æ„ä¹‰ä¸Šçš„ correlationã€‚\nå…³è”åˆ†æçš„åœºæ™¯ä¹Ÿéå¸¸å¤šï¼Œè¦†ç›–æˆ‘ä»¬ç”Ÿæ´»çš„æ–¹æ–¹é¢é¢ã€‚æ¯”å¦‚ä»ç¤¾äº¤ç½‘ç»œåˆ†æé‡Œï¼Œæˆ‘ä»¬å¯ä»¥åšç²¾å‡†è¥é”€ã€å¥½å‹æ¨èã€èˆ†æƒ…è¿½è¸ªç­‰ç­‰ï¼›é‡‘èé¢†åŸŸå¯ä»¥åšä¿¡ç”¨å¡åæ¬ºè¯ˆçš„åˆ†æï¼Œèµ„é‡‘æµå‘è¯†åˆ«ï¼›é›¶å”®é¢†åŸŸï¼Œæˆ‘ä»¬å¯ä»¥åšç”¨æˆ· 360 ç”»åƒåšå•†å“å®æ—¶æ¨èï¼Œè¿”è–…ç¾Šæ¯›ï¼›ç”µåŠ›é¢†åŸŸï¼Œå¯ä»¥åšç”µç½‘çš„è°ƒåº¦ä»¿çœŸã€æ•…éšœåˆ†æã€ç”µå°å› å­è®¡ç®—ï¼›ç”µä¿¡é¢†åŸŸï¼Œå¯ä»¥åšç”µä¿¡é˜²éªšæ‰°ï¼Œç”µä¿¡é˜²è¯ˆéª—ï¼›æ”¿ä¼é¢†åŸŸï¼Œå¯ä»¥åšé“è·¯è§„åˆ’ã€æ™ºèƒ½äº¤é€šï¼Œè¿˜æœ‰ç–«æƒ…ç²¾å‡†é˜²æ§ï¼›åœ¨åˆ¶é€ ä¸šï¼Œæˆ‘ä»¬å¯ä»¥åšä¾›åº”é“¾ç®¡ç†ã€ç‰©æµä¼˜åŒ–ã€äº§å“æº¯æºç­‰ï¼›ç½‘ç»œå®‰å…¨è¡Œä¸šï¼Œå¯ä»¥åšæ”»å‡»æº¯æºã€è°ƒç”¨é“¾åˆ†æç­‰ç­‰ã€‚\nåœ¨åšå…³è”åˆ†æçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦ä¸€ä¸ªå›¾æ¨¡å‹æ¥æè¿°ã€‚å¸¸è§çš„å›¾æ¨¡å‹åˆ†ä¸º RDF å’Œå±æ€§å›¾ä¸¤ç§ã€‚RDF å›¾ä¸­ç”¨ç‚¹æ¥è¡¨ç¤ºå”¯ä¸€æ ‡è¯†çš„èµ„æºæˆ–è€…æ˜¯å­—é¢é‡çš„å€¼ï¼Œè¾¹åˆ™ç”¨æ¥è¡¨ç¤ºè°“è¯ã€‚ç‚¹å’Œè¾¹ä¹‹é—´ç»„æˆä¸€ä¸ª SPO çš„ä¸‰å…ƒç»„ã€‚å±æ€§å›¾ä¸­ï¼Œç‚¹è¡¨ç¤ºå®ä½“ï¼Œè¾¹è¡¨ç¤ºå…³ç³»ï¼Œå±æ€§æ˜¯ç‚¹æˆ–è¾¹ä¸Šçš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚\nç›¸æ¯”ä¹‹ä¸‹ï¼ŒRDF çš„ä¼˜åŠ¿æ˜¯å¯ä»¥æ”¯æŒå¤šå€¼å±æ€§ï¼Œå› ä¸ºå®ƒçš„å±æ€§ä¹Ÿæ˜¯ä¸€ä¸ªç‚¹ï¼Œæ‰€ä»¥ä¸€ä¸ªç‚¹è¿å‡ºå»ï¼Œå¯ä»¥æœ‰å¤šå€¼çš„å±æ€§ã€‚ä¹Ÿå¯ä»¥é€šè¿‡å››å…ƒç»„çš„æ–¹å¼å‰é¢åŠ ä¸Šä¸€ä¸ªå›¾çš„æè¿°ï¼Œæ¥å®ç°åŠ¨æ€å›¾ã€‚å¹¶ä¸” RDF å¼€å§‹çš„æ¯”è¾ƒæ—©ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªæ¯”è¾ƒç»Ÿä¸€çš„æ ‡å‡†ã€‚\nå±æ€§å›¾çš„ä¼˜åŠ¿åœ¨äºå®ƒä¸¤ç‚¹ä¹‹é—´å¯ä»¥è¡¨ç¤ºåŒç±»å‹çš„å¤šæ¡è¾¹ï¼Œå› ä¸ºå®ƒåœ¨è¾¹ä¸Šæ˜¯å¯ä»¥æœ‰åŒºåˆ†å±æ€§çš„ï¼Œè¾¹ä¸Šçš„å±æ€§å€¼ä¹Ÿèƒ½è®©è¾¹ä¸Šçš„è¡¨è¾¾èƒ½åŠ›æ›´ä¸°å¯Œã€‚å¹¶ä¸”å®ƒæ”¯æŒå¤æ‚çš„å±æ€§ç±»å‹ï¼Œæ¯”å¦‚ listã€setã€map ç­‰ã€‚\néšç€è¡Œä¸šçš„å‘å±•ï¼Œæˆ‘ä»¬çœ‹åˆ°è¶Šæ¥è¶Šå¤šçš„å¯èƒ½ã€‚çŸ¥è¯†å›¾è°±çš„è¡¨ç¤ºåœ¨é€æ¸ç”¨å±æ€§å›¾æ¥å®Œæˆã€‚å½“ç„¶ä¹Ÿæœ‰å°‘é‡çš„å›¾æ•°æ®åº“æ˜¯ç”¨ RDF æ¨¡å‹æ¥åšçš„ï¼Œä½†æ˜¯æœªæ¥æ›´å¤šçš„æ–°å‹å›¾æ•°æ®åº“éƒ½ä¼šç”¨å±æ€§å›¾æ¨¡å‹ã€‚\nå›¾æ•°æ®åº“å­˜å‚¨çš„æ ¸å¿ƒç›®æ ‡ å®Œæˆä¸€ä¸ªå›¾æŸ¥è¯¢æˆ–è€…å›¾åˆ†æçš„æ ¸å¿ƒæ“ä½œï¼Œå°±æ˜¯é‚»å±…çš„è¿­ä»£éå†ã€‚\nå•ç‹¬çš„è®¿é—®ç‚¹æˆ–è€…è¾¹ï¼Œæˆ–è€…ä¸Šé¢çš„å±æ€§å¹¶ä¸æ˜¯è¿™é‡Œçš„å…³é”®ã€‚ä»…ä»…æ˜¯å•ç‹¬è®¿é—®ï¼Œä½¿ç”¨ä¼ ç»Ÿçš„æ•°æ®åº“ä¹Ÿå¯ä»¥æä¾›å¾ˆå¥½çš„æ€§èƒ½ã€‚åœ¨å…³è”åˆ†æå½“ä¸­ï¼Œä¸è®ºæ˜¯ä»ä¸€ä¸ªèµ·å§‹ç‚¹è‹¥å¹²è·³æ•°å†…çš„é‚»åŸŸç½‘ç»œè¿›è¡Œåˆ†æï¼Œè¿˜æ˜¯å¯¹å…¨å›¾è¿›è¡Œä¸€äº›å®Œæ•´çš„è®¡ç®—ï¼Œæœ€æ ¸å¿ƒçš„æ“ä½œéƒ½æ˜¯è¿­ä»£éå†æŸä¸ªç‚¹çš„æ‰€æœ‰è¾¹ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“é‚»å±…çš„è¿­ä»£éå†ã€‚åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­æ˜¯ä¾èµ–å¤–é”®ï¼Œé€šè¿‡å»ºç«‹ç´¢å¼•ç­‰æ–¹å¼æ¥å®Œæˆçš„ã€‚\nåœ¨å›¾æ•°æ®åº“ä¸­ï¼Œä¼šç›´æ¥å­˜å‚¨è¾¹æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„å®ç° index-free adjacencyã€‚å†™å…¥çš„æ—¶å€™ï¼Œä¿è¯ä¸€ä¸ªç‚¹å’Œå®ƒç›´æ¥ç›¸è¿çš„è¾¹æ€»æ˜¯å­˜å‚¨åœ¨ä¸€èµ·ã€‚æŸ¥è¯¢çš„æ—¶å€™ï¼Œè¿­ä»£éå†ä¸€ä¸ªç‚¹çš„æ‰€æœ‰é‚»å±…å¯ä»¥ç›´æ¥è¿›è¡Œï¼Œä¸éœ€è¦ä¾èµ–äºå…¶å®ƒæ•°æ®ç»“æ„ï¼Œä»è€Œå¯ä»¥å¤§å¹…æå‡é‚»å±…è¿­ä»£éå†çš„æ€§èƒ½ã€‚\nè¿™é‡Œæ˜¯è·Ÿå…³ç³»å‹æ•°æ®åº“åšçš„ä¸€ä¸ªæ·±ç‚¹æŸ¥è¯¢çš„æ€§èƒ½å¯¹æ¯”ï¼Œç”¨çš„æ˜¯ who-trust-whom çš„ä¸€ä¸ªå…¬å¼€æ•°æ®é›†ï¼Œè¿™ä¸ªæ•°æ®é›†ä¹Ÿä¸æ˜¯å¾ˆå¤§ï¼Œçº¦ 7.5 ä¸‡ç‚¹ï¼Œ50 ä¸‡è¾¹ã€‚æˆ‘ä»¬æƒ³çŸ¥é“ä¸€ä¸ªä¿¡ä»»çš„äººè¿™æ ·ä¸€ä¸ªå¤šè·³å…³è”çš„æŸ¥è¯¢ç»“æœã€‚ä½¿ç”¨å…³é”®æ€§æ•°æ®åº“çš„æ—¶å€™ï¼Œå¯¹æ¯”äº†åŠ ç´¢å¼•å’Œä¸åŠ ç´¢å¼•çš„æƒ…å†µã€‚å¯ä»¥çœ‹å‡º 2 è·³çš„æ—¶å€™åŠ ç´¢å¼•å¯ä»¥æ˜æ˜¾æå‡å…³ç³»å‹æ•°æ®åº“çš„æŸ¥è¯¢é€Ÿåº¦ï¼Œåˆ° 3 è·³çš„æ—¶å€™æå‡å°±ä¸å¤šäº†ï¼Œ 4 è·³ä»¥ä¸Šçš„æ—¶å€™åŠ ä¸åŠ ç´¢å¼•éƒ½ä¼šå˜å¾—å¾ˆæ…¢ã€‚è€Œä½¿ç”¨å›¾æ•°æ®åº“ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¸€ç›´ä¼šä¿æŒåœ¨ä¸€ä¸ªéå¸¸å¿«çš„æ°´å¹³ã€‚è¿™å°±æ˜¯å›¾æ•°æ®åº“çš„ index-free adjacency çš„ç‰¹æ€§ï¼Œèƒ½å¤Ÿå¤§å¹…æå‡é‚»å±…æŸ¥è¯¢çš„é€Ÿåº¦ã€‚\nå›¾æ•°æ®åº“çš„åˆ†ç±» æ ¹æ®å®ç°å…ç´¢å¼•è¿æ¥çš„æ–¹å¼ï¼Œå¯ä»¥æŠŠå›¾æ•°æ®åº“åˆ†æˆä¸‰ç±»ã€‚\nç¬¬ä¸€ç±»æ˜¯ä½¿ç”¨åŸç”Ÿå›¾å­˜å‚¨çš„æ–¹å¼ï¼Œå®ƒçš„æ•°æ®å­˜å‚¨å±‚å°±ç›´æ¥å®ç°äº†å…ç´¢å¼•è¿æ¥ã€‚ä¸Šé¢çš„å¤„ç†è®¡ç®—å±‚å’Œä¸šåŠ¡å±‚éƒ½æ˜¯ä»¥å®Œå…¨å›¾çš„ç»“æ„æ¥æè¿°ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¾èµ–äºç¬¬ä¸‰æ–¹å­˜å‚¨ç»„ä»¶ï¼Œæ‰€ä»¥è¿™ç§å®ç°å…ç´¢å¼•è¿æ¥çš„æ€§èƒ½æ˜¯æœ€é«˜æ•ˆçš„ã€‚ ç¬¬äºŒç§æ–¹å¼æ˜¯éåŸç”Ÿå­˜å‚¨ï¼Œæ•°æ®å­˜å‚¨å±‚ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„å¼€æºå­˜å‚¨ç»„ä»¶ï¼Œä½†æ˜¯å®ƒåœ¨å¤„ç†è¿‡ç¨‹ä¸­å®ç°äº†è¿‘ä¼¼å…ç´¢å¼•è¿æ¥ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¹Ÿèƒ½æä¾›ä¸é”™çš„æ€§èƒ½ã€‚å®ƒçš„é—®é¢˜æ˜¯ç”±äºä½¿ç”¨äº†ç¬¬ä¸‰æ–¹å­˜å‚¨ç»„ä»¶ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½åšå¾—ä¸æ˜¯æœ€ä¼˜åŒ–ã€‚ ç¬¬ä¸‰ç§æ–¹å¼å°±æ˜¯å®Œå…¨éåŸç”Ÿçš„å­˜å‚¨ï¼Œåº•ä¸‹å¯èƒ½æ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªæ–‡æ¡£å‹æˆ–è€…å…¶å®ƒç±»å‹çš„æ•°æ®åº“ï¼Œå®ƒçš„å­˜å‚¨å±‚å…¶å®å¹¶ä¸æ˜¯çœŸæ­£åœ°å®ç°äº†å…ç´¢å¼•è¿æ¥ï¼Œè€Œæ˜¯å¤„ç†æˆé€šè¿‡ç´¢å¼•æˆ–è€…ä¸€äº›å…¶å®ƒæŠ€æœ¯æ‰‹æ®µï¼Œå‘ä¸Šè¡¨è¾¾äº†ä¸€ä¸ªå›¾æ¨¡å‹çš„æŸ¥è¯¢æ¥å£ã€‚è¿™ç§å…¶å®åªæ˜¯åœ¨æ¥å£å±‚ä¸Šå®ç°äº†å›¾çš„ä¸€ä¸ªè¯­ä¹‰ï¼Œè€Œåº•ä¸‹çš„å­˜å‚¨å’Œè®¡ç®—å±‚éƒ½ä¸æ˜¯å®Œå…¨åœ°ä½¿ç”¨å…ç´¢å¼•è¿æ¥ï¼Œæ‰€ä»¥å®ƒçš„æ€§èƒ½ä¹Ÿä¼šç›¸å¯¹ä½ä¸€äº›ã€‚ å›¾æ•°æ®åº“å­˜å‚¨çš„ä¸»æµæŠ€æœ¯æ–¹æ¡ˆ å‰æ–‡ä¸­å·²ç»æ˜ç¡®äº†æ•°æ®åº“å­˜å‚¨çš„æ ¸å¿ƒç›®æ ‡å°±æ˜¯å®ç°å…ç´¢å¼•è¿æ¥ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ¥çœ‹ä¸€äº›å…·ä½“å®ç°å…ç´¢å¼•è¿æ¥çš„ä¸»æµæŠ€æœ¯æ–¹æ¡ˆã€‚\næ•°ç»„å­˜å‚¨ é¦–å…ˆæˆ‘ä»¬èƒ½æƒ³åˆ°çš„æœ€ç›´æ¥çš„ä¸€ä¸ªæ–¹æ¡ˆï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªæ•°ç»„æŠŠæ¯ä¸ªç‚¹ä¸Šçš„è¾¹æŒ‰ç…§é¡ºåºä¸€èµ·å­˜å‚¨ã€‚åœ¨è¿™ä¸€å­˜å‚¨æ–¹æ¡ˆä¸­ï¼Œç‚¹æ–‡ä»¶å°±æ˜¯ç”±ä¸€ç³»åˆ—çš„ç‚¹æ•°æ®ç»„æˆçš„ã€‚æ¯ä¸ªç‚¹çš„å­˜å‚¨å†…å®¹åŒ…æ‹¬ç‚¹çš„ IDã€ç‚¹çš„ Meta ä¿¡æ¯ï¼Œä»¥åŠè¿™ä¸ªç‚¹çš„ä¸€ç³»åˆ—å±æ€§ã€‚åœ¨è¾¹æ–‡ä»¶ä¸­ï¼Œæ˜¯æŒ‰ç…§èµ·å§‹ç‚¹çš„é¡ºåºå­˜å‚¨ç‚¹ä¸Šå¯¹åº”çš„è¾¹ï¼Œæ¯æ¡è¾¹å­˜å‚¨çš„å†…å®¹åŒ…æ‹¬ç»ˆæ­¢ç‚¹ IDã€è¾¹çš„ Meta ä¿¡æ¯ã€è¾¹çš„ä¸€ç³»åˆ—å±æ€§ã€‚è¿™é‡Œæ‰€è°“çš„ Meta ä¿¡æ¯åŒ…æ‹¬ç‚¹è¾¹çš„ç±»å‹ã€æ–¹å‘ï¼Œè¿˜æœ‰ä¸€äº›ä¸ºäº†å®ç°äº‹åŠ¡çš„é¢å¤–å­—æ®µï¼Œè¿™å¯¹äºæ•´ä½“çš„å­˜å‚¨æ¥è¯´ä¸æ˜¯ç‰¹åˆ«é‡è¦ï¼Œåœ¨è¿™é‡Œå°±ä¸è¯¦ç»†å±•å¼€äº†ã€‚åœ¨è¿™ä¸ªå­˜å‚¨æ–¹æ¡ˆä¸­ï¼Œå¯ä»¥ç›´æ¥ä»èµ·å§‹ç‚¹å¼€å§‹éå†ç›¸é‚»è¾¹çš„æ‰€æœ‰æ•°æ®ï¼Œè¯»å–æ€§èƒ½æ˜¯éå¸¸é«˜çš„ã€‚ æ•°ç»„å­˜å‚¨åŠ£åŠ¿ è¿™ç§å­˜å‚¨éœ€è¦å¤„ç†çš„ä¸€ä¸ªæ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜ï¼Œå°±æ˜¯æ•°ç»„å˜é•¿çš„æƒ…å†µã€‚è¿™é‡Œçš„å˜é•¿æ˜¯ç”±å¾ˆå¤šå› ç´ å¯¼è‡´ï¼Œæ¯”å¦‚ä¸¤ä¸ªç‚¹å¯èƒ½å±æ€§æ•°é‡ä¸ä¸€æ ·ï¼Œå±æ€§æœ¬èº«å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œé•¿åº¦ä¹Ÿä¼šä¸ä¸€æ ·ã€‚å±æ€§é•¿åº¦ä¸ä¸€æ ·ä¼šå¯¼è‡´æ¯æ¡è¾¹çš„å­˜å‚¨ç©ºé—´ä¹Ÿä¸ä¸€æ ·ï¼Œè¿™æ ·åœ¨è¾¹æ–‡ä»¶ä¸­å°±ä¸èƒ½ç”¨ä¸€ä¸ªç®€å•çš„æ•°ç»„æ¥è¿›è¡Œå¯»å€äº†ã€‚å¦‚æœä»…ä»…æ˜¯å±æ€§å¯¼è‡´çš„å˜é•¿ï¼Œè¿˜æ˜¯æœ‰æ¯”è¾ƒç®€å•çš„è§£å†³æ–¹æ¡ˆçš„ï¼Œæ¯”å¦‚å¯ä»¥æŠŠå±æ€§å•ç‹¬çš„å†æ”¾åˆ°å¦ä¸€ä¸ªå­˜å‚¨æ–‡ä»¶ä¸­ï¼Œè¿™æ ·ç‚¹æ–‡ä»¶å’Œè¾¹æ–‡ä»¶é‡Œé¢çš„å†…å®¹ï¼Œæ˜¯ä¸æ˜¯å®šé•¿çš„å‘¢ï¼Ÿå…¶å®ä¹Ÿä¸ä¸€å®šï¼Œå› ä¸ºæ¯ä¸ªç‚¹ä¸Šè¾¹çš„æ•°é‡ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥åœ¨è¾¹æ–‡ä»¶é‡Œé¢ï¼Œæ¯ä¸ªç‚¹è§¦å‘çš„è¾¹åºåˆ—çš„æ€»é•¿åº¦ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚æ‰€ä»¥è¿˜æ˜¯è¦å¤„ç†æ•°ç»„å˜é•¿çš„é—®é¢˜ã€‚\nè§£å†³æ€è·¯ä¸€èˆ¬æ˜¯ä¸¤ç§ï¼š\nä¸€ç§æ˜¯ä½¿ç”¨é¢å¤–çš„ä¸€ä¸ª offset çš„è®°å½•ï¼Œç›¸å½“äºæ˜¯ç”¨ä¸€ä¸ªåç§»é‡è®°å½•ï¼Œæ¥è®°å½•æ¯ä¸€ä¸ªç‚¹æˆ–è€…è¾¹çš„èµ·å§‹ä½ç½®ã€‚è¿™ä¸ªè®°å½•æœ¬èº«å°±å¯ä»¥æ˜¯å®šé•¿çš„äº†ï¼Œå› ä¸ºå®ƒæ˜¯ä¸ª offset å€¼ã€‚æˆ–è€…æ˜¯æå‰åˆ’åˆ†å¥½ä¸€äº›é¢å¤–çš„åŒºåŸŸï¼Œæ¥é¢„ç•™ç»™å®ƒå¢é•¿çš„ç©ºé—´ã€‚ ä¸ºäº†è§£å†³è¿™ç§æ•°ç»„å­˜å‚¨å˜é•¿çš„é—®é¢˜ï¼Œæˆ‘ä»¬è‡ªç„¶ä¹Ÿå¯ä»¥æƒ³åˆ°ç”¨ç±»ä¼¼é“¾è¡¨çš„æ–¹å¼æ¥å­˜å‚¨ã€‚åœ¨é“¾è¡¨æ–¹å¼çš„å­˜å‚¨æ¨¡å¼ä¸­ï¼Œç‚¹å’Œè¾¹å…¨éƒ¨å­˜çš„éƒ½æ˜¯ IDï¼ŒåŒ…æ‹¬ç‚¹ IDã€è¾¹ IDã€å±æ€§ ID ç­‰ç­‰ã€‚é€šè¿‡å±æ€§ ID ï¼Œå¯ä»¥åœ¨å¦å¤–ä¸€ä¸ªå±æ€§å­˜å‚¨é‡Œé¢æ‰¾åˆ°å®ƒçš„ä½ç½®ä»¥åŠå…·ä½“çš„å€¼ã€‚å› ä¸ºå­˜çš„éƒ½æ˜¯ IDï¼Œæ‰€ä»¥æ¯ä¸ªç‚¹å’Œæ¯æ¡è¾¹çš„æ•°æ®é•¿åº¦å°±æ˜¯å›ºå®šçš„äº†ã€‚é€šè¿‡ ID å¯ä»¥ç›´æ¥è®¡ç®—å‡ºåç§»é‡ï¼Œç„¶åç”¨åç§»é‡çš„ä½ç½®å»è¯»å–æ•°æ®ã€‚æ‰€ä»¥æ¯ä¸ªæ•°æ®æœ¬èº«ä¹Ÿä¸éœ€è¦ä¿å­˜è‡ªèº«çš„IDï¼Œå› ä¸ºåç§»é‡çš„ä½ç½®æ˜¯èƒ½å¤Ÿåæ¨å‡ºæ¥è‡ªèº« ID çš„ã€‚ é“¾è¡¨å­˜å‚¨ è¿™æ˜¯ä¸€ä¸ªé“¾è¡¨å­˜å‚¨ä¸‹è¿›è¡Œè¾¹è¿­ä»£çš„ä¾‹å­: å‡è®¾æœ‰ä¸€ä¸ªèµ·å§‹ç‚¹ Aï¼Œéœ€è¦è¿­ä»£å®ƒçš„æ‰€æœ‰è¾¹ã€‚é¦–å…ˆåœ¨ç‚¹æ–‡ä»¶ä¸­æ‰¾åˆ°ç‚¹ A çš„é¦–ä¸ªè¾¹ï¼ŒÎ±ã€‚ç„¶åå»è¾¹æ–‡ä»¶ä¸­æ‰¾åˆ° Î± å¯¹åº”åç§»é‡çš„ä½ç½®ï¼Œå°±å¯ä»¥è¯»å‡ºè¿™æ¡è¾¹çš„æ•°æ®ã€‚å¯ä»¥çœ‹åˆ°ï¼Œæ˜¯ä¸€ä¸ªä»ç‚¹ A åˆ°ç‚¹ B çš„è¾¹ï¼ŒA æ˜¯ä¸€ä¸ªèµ·å§‹ç‚¹ï¼Œæˆ‘ä»¬å°±å»æ‰¾èµ·å§‹ç‚¹ä¸‹ä¸€æ¡è¾¹çš„ IDï¼Œå°±æ‰¾åˆ°è¾¹ Î¸ã€‚ç„¶åå»è¾¹ Î¸ çš„ä½ç½®ï¼Œæ‰¾åˆ°åç§»é‡ï¼Œå°±æ‰¾åˆ°è¾¹ Î¸ã€‚è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°å®ƒæ˜¯ä¸€ä¸ª C åˆ° A çš„è¾¹ï¼ŒA æ˜¯ç»ˆæ­¢ç‚¹ã€‚æˆ‘ä»¬å°±å»æ‰¾ç»ˆæ­¢ç‚¹çš„ä¸‹ä¸€æ¡è¾¹ï¼Œæ˜¯ Ï‰ã€‚å†å»æ‰¾åˆ°è¾¹ Ï‰ çš„ä½ç½®ï¼Œçœ‹åˆ°æ˜¯èµ·å§‹ç‚¹ A ç»ˆæ­¢ç‚¹ Dï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼å°±å¯ä»¥ä¸æ–­åœ°å»è¿­ä»£è¾¹ã€‚ æˆ‘ä»¬çœ‹åˆ°ï¼Œç”¨é“¾è¡¨å­˜å‚¨çš„æ–¹å¼å¾ˆå¥½åœ°è§£å†³äº†æ•°ç»„å˜é•¿çš„é—®é¢˜ï¼Œå› ä¸ºæ–°å¢è¾¹çš„æ—¶å€™ï¼Œåªéœ€è¦æ–°å¢å›ºå®šé•¿åº¦çš„ç»“æ„ç»„æˆé“¾è¡¨å³å¯ã€‚æ¯ä¸€æ¬¡è¿­ä»£ä¹Ÿæ˜¯åœ¨ O(1) çš„æ—¶é—´å†…ç›´æ¥æ‰¾åˆ°äº†ä¸‹ä¸€æ¡è¾¹ï¼Œä¹Ÿä¸ä¾èµ–äºå¤–éƒ¨çš„ç´¢å¼•æˆ–è€…å…¶å®ƒç»“æ„ã€‚\né“¾è¡¨å­˜å‚¨çš„åŠ£åŠ¿ è¿™çœ‹ä¼¼æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ–¹æ¡ˆï¼Œä½†å®é™…çš„ä½¿ç”¨ä¸­ï¼Œä¹Ÿå­˜åœ¨ç€ä¸€äº›é—®é¢˜ã€‚ä¸è¦å¿˜è®°ï¼Œç°åœ¨è®¨è®ºçš„æ˜¯ä¸€ä¸ªå­˜å‚¨æ ¼å¼ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå†…å­˜ç»“æ„ã€‚å­˜å‚¨æ ¼å¼æ„å‘³ç€æœ€ç»ˆæ˜¯è¦åœ¨ç£ç›˜ IO ä¸Šè¿›è¡Œè¯»å†™çš„ã€‚åœ¨é“¾è¡¨å­˜å‚¨æ–¹æ¡ˆä¸‹ï¼Œæ¯ä¸€æ¬¡è¾¹è¿­ä»£çš„æ—¶å€™ï¼Œç”±äºè¾¹ offset çš„ä½ç½®æ˜¯éšæœºçš„ï¼Œæ‰€ä»¥ä¼šæœ‰å¤§é‡çš„éšæœºè¯»æ“ä½œã€‚è€Œç£ç›˜å¯¹äºéšæœºè¯»æ“ä½œå¹¶ä¸æ˜¯å¾ˆå‹å¥½ã€‚ æ‰€ä»¥è™½ç„¶è¿™é‡Œç†è®ºä¸Šçš„è¿­ä»£é‚»å±…æ‰¾åˆ°ä¸‹ä¸€æ¡è¾¹çš„å¤æ‚åº¦æ˜¯ O(1)ï¼Œä½† O(1) çš„å•ä½æ—¶é—´æ˜¯ç£ç›˜éšæœºè¯»çš„æ—¶é—´ï¼Œè€Œä¸æ˜¯é¡ºåºè¯»çš„æ—¶é—´ï¼Œè¿™ä¸¤è€…åœ¨æ€§èƒ½ä¸Šæ˜¯ä¼šæœ‰éå¸¸å¤§çš„å·®åˆ«çš„ã€‚æ‰€ä»¥ä½¿ç”¨è¿™ç§é“¾è¡¨çš„å­˜å‚¨æ–¹å¼ï¼Œé€šå¸¸æ¥è¯´ä¼šä¾èµ–ä¸€ä¸ªéå¸¸é«˜æ•ˆå®ç°çš„ç¼“å­˜æœºåˆ¶ï¼Œéœ€è¦æŠŠå¤§é‡çš„ç£ç›˜æ•°æ®æ”¾åˆ°å†…å­˜ç¼“å­˜ä¸­æ¥è¯»ï¼Œåœ¨å†…å­˜ä¸­è¿›è¡Œéšæœºè®¿é—®çš„æ€§èƒ½å°±ä¼šæå‡å¾ˆå¤šã€‚ é™¤äº†åŸºäºæ•°ç»„å’Œé“¾è¡¨çš„æ–¹æ³•ï¼Œè¿˜æœ‰å…¶å®ƒä¸€äº›æ ¼å¼å¯ä»¥å®ç° O(1) æ—¶é—´çš„è¾¹è¿­ä»£ã€‚æ¯”å¦‚ï¼Œä½¿ç”¨ LSM-Tree çš„å­˜å‚¨ç»“æ„ï¼Œè¿™ä¸ªç»“æ„æ˜¯ä¸€ç§é¡ºåºå†™ç›˜å¤šå±‚ç»“æ„çš„ KV å­˜å‚¨ã€‚è¿™é‡Œåªç®€å•ä»‹ç»ä¸€ä¸‹å®ƒçš„å·¥ä½œåŸç†ã€‚\nLSM å­˜å‚¨ è¿™ä¸ªå›¾å¿½ç•¥äº†åƒå†™ WAL è¿™æ ·çš„ç»†èŠ‚ï¼Œæ˜¯ LSM æ ‘è¯»å†™çš„æ ¸å¿ƒæ“ä½œæµç¨‹ã€‚ LSM æ ‘æ˜¯ä¸€ç§å¸¸ç”¨çš„é”®å€¼å­˜å‚¨ç»“æ„ï¼Œå¤„ç†å†™è¯·æ±‚çš„æ€§èƒ½å¾ˆé«˜ã€‚å®ƒçš„è¯»å†™æ“ä½œæµç¨‹å¦‚ä¸‹ï¼šå½“ä¸€ä¸ªè¯·æ±‚è¿›æ¥çš„æ—¶å€™ï¼Œç›´æ¥å†™å…¥å†…å­˜ä¸­çš„ä¸€ä¸ª MemTableï¼Œå¦‚æœ MemTable æ²¡å†™æ»¡ï¼Œå°±ç›´æ¥è¿”å›è¯·æ±‚ã€‚å› æ­¤å®ƒå¤„ç†å†™è¯·æ±‚çš„æ€§èƒ½æ˜¯å¾ˆé«˜çš„ã€‚å½“ MemTable æ»¡çš„æ—¶å€™ï¼Œä¼šç”Ÿæˆä¸€ä¸ªä¸å¯å†™çš„ã€åªè¯»çš„ Immutable MemTableï¼ŒåŒæ—¶ç”Ÿæˆæ–°çš„å¯å†™çš„ MemTableï¼Œä»¥ä¾›åç»­ä½¿ç”¨ã€‚ç„¶å Immutable MemTable å°±ä¼šå†™åˆ°ç£ç›˜ä¸Šï¼Œå½¢æˆä¸€ä¸ª SST æ–‡ä»¶ã€‚SST æ–‡ä»¶åœ¨å†™ç›˜çš„æ—¶å€™ï¼Œä¼šæ ¹æ® Key æ’åºï¼Œä»è€Œå®ç°é¡ºåºçš„è¾¹è¿­ä»£ã€‚å…¶è½ç›˜ç»“æ„çš„ SST æ–‡ä»¶ä¹Ÿæ˜¯åˆ†å±‚æ¥ç»„ç»‡çš„ã€‚ä»å†…å­˜ä¸­ç›´æ¥å†™å‡ºæ¥çš„ç¬¬ 0 å±‚è¾¾åˆ°ä¸€å®šæ•°æ®é‡å¤§å°çš„æ—¶å€™ï¼Œæˆ–è€…è§¦å‘æŸç§æ¡ä»¶çš„æ—¶å€™ï¼Œå°±ä¼šè¿›è¡Œä¸€ä¸ªå½’å¹¶æ’åºï¼Œå½’å¹¶æ’åºå°±æ˜¯ä¸€ä¸ª Compaction çš„è¿‡ç¨‹ã€‚åˆå¹¶å‡ºæ¥çš„ç¬¬ä¸€å±‚çš„ SST æ–‡ä»¶ï¼Œéƒ½æ˜¯æŒ‰ç…§ Key çš„é¡ºåºå†™æ’çš„ã€‚è¯»å–çš„æ—¶å€™æ˜¯å…ˆå»å†…å­˜ä¸­çš„ MemTable æŸ¥æ‰¾ï¼Œæ‰¾åˆ°äº†å°±è¿”å›ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å°±å»ç¬¬ 0 å±‚çš„ SST æ–‡ä»¶ä¸­æŸ¥æ‰¾ï¼Œæ‰¾ä¸åˆ°å†å»ç¬¬ 1 å±‚ï¼Œè¿™æ ·é€å±‚æŸ¥æ‰¾ï¼Œä¸€ç›´åˆ°æ‰¾åˆ°éœ€è¦è¯»å–çš„ Key ä¸ºæ­¢ã€‚\nä½¿ç”¨ SST æ–‡ä»¶è¿›è¡Œå­˜å‚¨çš„ä¸€ä¸ªå…³é”®å°±æ˜¯è®¾è®¡è¾¹çš„ Keyã€‚å› ä¸ºåœ¨ SST æ–‡ä»¶ä¸­ï¼ŒKey æ˜¯æœ‰åºæ’åˆ—çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡ LSMTree æ¥å®ç°å…ç´¢å¼•è¿æ¥çš„èƒ½åŠ›ã€‚å…³é”®ç‚¹å°±æ˜¯åˆç†åœ°è®¾è®¡è¾¹çš„ Keyï¼Œä½¿ä¸€ä¸ªç‚¹æ‰€æœ‰è¾¹åœ¨æ’åºåæ˜¯ç›¸é‚»çš„ã€‚è¯´èµ·æ¥æ¯”è¾ƒæ‹—å£ï¼Œå…¶å®å®ç°èµ·æ¥å¹¶ä¸éš¾ã€‚\næˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªä¾‹å­ã€‚åªè¦æŠŠè¾¹ Key çš„æœ€é«˜ä½æ”¾èµ·å§‹ç‚¹ IDï¼Œé‚£ä¹ˆåé¢æ— è®ºæ˜¯è¾¹çš„å…¶å®ƒä»€ä¹ˆä¿¡æ¯ï¼Œéƒ½å¯ä»¥è®©ä»èµ·å§‹ç‚¹ ID å‡ºå‘çš„è¾¹è‡ªç„¶åœ°æ’åºæ’åœ¨ä¸€èµ·ã€‚è¿™é‡Œä¹Ÿå¯ä»¥åŠ å…¥ä¸€ä¸ªç¼–å·çš„å­—æ®µï¼Œå› ä¸ºä¸¤ç‚¹ä¹‹é—´ï¼Œèµ·å§‹ç‚¹å’Œç»ˆæ­¢ç‚¹ Meta è¿™äº›æ˜¯å›ºå®šçš„ï¼Œç¼–å·å­—æ®µåŠ å…¥ä¹‹åï¼Œå°±å¯ä»¥æ”¯æŒåœ¨ä¸¤ç‚¹ä¹‹é—´åŒç±»å‹çš„å¤šæ¡è¾¹å…±å­˜ã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ª KV ç»“æ„ã€‚å¦‚æœåªæœ‰èµ·å§‹ç‚¹ã€ç»ˆæ­¢ç‚¹å’Œ Metaï¼Œä¸¤ç‚¹ä¹‹é—´åŒç±»å‹çš„è¾¹åªèƒ½å­˜åœ¨ä¸€æ¡ã€‚æ‰€ä»¥æ¯”å¦‚è½¬è´¦äº¤æ˜“æˆ–è€…æ˜¯è®¿é—®è®°å½•è¿™äº›å…·æœ‰äº‹ä»¶æ€§è´¨çš„è¾¹è¦å­˜å¤šæ¡ï¼Œå¯ä»¥åŠ ä¸€ä¸ªç¼–å·ã€‚å½“ç„¶ä¹Ÿä¸ä¸€å®šéƒ½æ˜¯å¿…é¡»ä»èµ·å§‹ç‚¹å¼€å§‹æ¥åšè¾¹çš„ Keyã€‚ æ¯”å¦‚åœ¨ä¾‹ 2 ä¸­ï¼ŒæŠŠ type è¾¹ç±»å‹æ”¾åœ¨é«˜ä½ã€‚å®ƒå°±å¯ä»¥å…ˆä»¥ type è¿›è¡Œåˆ’åˆ†ï¼Œåé¢æ‰æ˜¯èµ·å§‹ç‚¹ã€‚è¿™ç§æ–¹æ³•ä¹Ÿæ¯”è¾ƒé€‚åˆåœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹æŒ‰ç±»å‹åšåˆ†ç‰‡ï¼Œè¿™æ ·åŒä¸€ç±»å‹çš„è¾¹å°±ä¼šæ’åœ¨ç›¸é‚»çš„åˆ†ç‰‡ä¸­ï¼Œæœ‰åˆ©äºæé«˜åˆ†å¸ƒå¼æŸ¥è¯¢çš„æ€§èƒ½ã€‚ä½¿ç”¨è¿™ä¸ªæ–¹å¼ï¼Œæœ‰éå¸¸é«˜çš„å†™å…¥æ€§èƒ½ï¼Œå¹¶ä¸”è¯»å–çš„æ—¶å€™ä¹Ÿèƒ½æä¾›å…ç´¢å¼•è¿æ¥çš„èƒ½åŠ›ã€‚\nnebula ç‚¹ nebula è¾¹ nebula è§£è¯» ä¸Šå›¾ä»¥æœ€ç®€å•çš„ä¸¤ä¸ªç‚¹å’Œä¸€æ¡è¾¹ä¸ºä¾‹ï¼Œèµ·ç‚¹ SrcVertex é€šè¿‡è¾¹ EdgeA è¿æ¥ç›®çš„ç‚¹ DstVertexï¼Œå½¢æˆè·¯å¾„(SrcVertex)-[EdgeA]-\u0026gt;(DstVertex)ã€‚è¿™ä¸¤ä¸ªç‚¹å’Œä¸€æ¡è¾¹ä¼šä»¥ 6 ä¸ªé”®å€¼å¯¹çš„å½¢å¼ä¿å­˜åœ¨å­˜å‚¨å±‚çš„ä¸¤ä¸ªä¸åŒåˆ†ç‰‡ï¼Œå³ Partition x å’Œ Partition y ä¸­ï¼Œè¯¦ç»†è¯´æ˜å¦‚ä¸‹ï¼š\nç‚¹ SrcVertex çš„é”®å€¼ä¿å­˜åœ¨ Partition x ä¸­ã€‚ è¾¹ EdgeA çš„ç¬¬ä¸€ä»½é”®å€¼ï¼Œè¿™é‡Œç”¨ EdgeA_Out è¡¨ç¤ºï¼Œä¸ SrcVertex ä¸€åŒä¿å­˜åœ¨ Partition x ä¸­ã€‚key çš„å­—æ®µæœ‰ Typeã€PartIDï¼ˆxï¼‰ã€VIDï¼ˆSrcï¼Œå³ç‚¹ SrcVertex çš„ IDï¼‰ã€EdgeTypeï¼ˆç¬¦å·ä¸ºæ­£ï¼Œä»£è¡¨è¾¹æ–¹å‘ä¸ºå‡ºï¼‰ã€Rankï¼ˆ0ï¼‰ã€VIDï¼ˆDstï¼Œå³ç‚¹ DstVertex çš„ IDï¼‰å’Œ PlaceHolderã€‚SerializedValue å³ Valueï¼Œæ˜¯åºåˆ—åŒ–çš„è¾¹å±æ€§ã€‚ ç‚¹ DstVertex çš„é”®å€¼ä¿å­˜åœ¨ Partition y ä¸­ã€‚ è¾¹ EdgeA çš„ç¬¬äºŒä»½é”®å€¼ï¼Œè¿™é‡Œç”¨ EdgeA_In è¡¨ç¤ºï¼Œä¸ DstVertex ä¸€åŒä¿å­˜åœ¨ Partition y ä¸­ã€‚key çš„å­—æ®µæœ‰ Typeã€PartIDï¼ˆyï¼‰ã€VIDï¼ˆDstï¼Œå³ç‚¹ DstVertex çš„ IDï¼‰ã€EdgeTypeï¼ˆç¬¦å·ä¸ºè´Ÿï¼Œä»£è¡¨è¾¹æ–¹å‘ä¸ºå…¥ï¼‰ã€Rankï¼ˆ0ï¼‰ã€VIDï¼ˆSrcï¼Œå³ç‚¹ SrcVertex çš„ IDï¼‰å’Œ PlaceHolderã€‚SerializedValue å³ Valueï¼Œæ˜¯åºåˆ—åŒ–çš„è¾¹å±æ€§ï¼Œä¸ EdgeA_Out ä¸­è¯¥éƒ¨åˆ†çš„å®Œå…¨ç›¸åŒã€‚ EdgeA_Out å’Œ EdgeA_In ä»¥æ–¹å‘ç›¸åçš„ä¸¤æ¡è¾¹çš„å½¢å¼å­˜åœ¨äºå­˜å‚¨å±‚ï¼ŒäºŒè€…ç»„åˆæˆäº†é€»è¾‘ä¸Šçš„ä¸€æ¡è¾¹ EdgeAã€‚EdgeA_Out ç”¨äºä»èµ·ç‚¹å¼€å§‹çš„éå†è¯·æ±‚ï¼Œä¾‹å¦‚(a)-[]-\u0026gt;()ï¼›EdgeA_In ç”¨äºæŒ‡å‘ç›®çš„ç‚¹çš„éå†è¯·æ±‚ï¼Œæˆ–è€…è¯´ä»ç›®çš„ç‚¹å¼€å§‹ï¼Œæ²¿ç€è¾¹çš„æ–¹å‘é€†åºè¿›è¡Œçš„éå†è¯·æ±‚ï¼Œä¾‹å¦‚ä¾‹å¦‚()-[]-\u0026gt;(a)ã€‚\nå¦‚ EdgeA_Out å’Œ EdgeA_In ä¸€æ ·ï¼ŒNebulaGraphå†—ä½™äº†å­˜å‚¨æ¯æ¡è¾¹çš„ä¿¡æ¯ï¼Œå¯¼è‡´å­˜å‚¨è¾¹æ‰€éœ€çš„å®é™…ç©ºé—´ç¿»å€ã€‚å› ä¸ºè¾¹å¯¹åº”çš„ key å ç”¨çš„ç¡¬ç›˜ç©ºé—´è¾ƒå°ï¼Œä½† value å ç”¨çš„ç©ºé—´ä¸å±æ€§å€¼çš„é•¿åº¦å’Œæ•°é‡æˆæ­£æ¯”ï¼Œæ‰€ä»¥ï¼Œå½“è¾¹çš„å±æ€§å€¼è¾ƒå¤§æˆ–æ•°é‡è¾ƒå¤šæ—¶å€™ï¼Œç¡¬ç›˜ç©ºé—´å ç”¨é‡ä¼šæ¯”è¾ƒå¤§ã€‚\nnebula çš„å­˜å‚¨å¦‚ä½•è¿­ä»£è¾¹ NebulaGraph çš„ç‚¹å’Œè¾¹åœ¨åŒä¸€ä¸ª partitionï¼Œè™½ç„¶æ²¡æœ‰å­˜åœ¨åŒä¸€ä¸ª key-value ä¸­ï¼Œä½†æ˜¯æ°¸è¿œåœ¨åŒä¸€ä¸ªåœ°æ–¹ï¼Œæ‰€ä»¥ï¼š éå†1hopçš„å‡ºå…¥è¾¹ï¼ˆä¸éœ€è¦ç‚¹å±æ€§ä¿¡æ¯çš„æ—¶å€™ï¼‰ï¼Œå°±æ˜¯ä¸€ä¸ª prefix scanï¼ˆåªéœ€è¦ç»™è¾¹ä¸Šå·¦è¾¹çš„é‚£ä¸ª id ï¼Œä¸¤ä¸ªæ–¹å‘çš„è¾¹éƒ½èƒ½é«˜æ•ˆæ‰«å‡ºæ¥ï¼Œè¾¹å¤šå­˜äº†ä¸€æ¬¡æ¢æ¥è¿™é‡Œï¼‰ è·å–ç‚¹ä¸è¾¹çš„å±æ€§çš„æƒ…å†µä¸‹ï¼Œprefix scan ä¹‹åè·å–äº†ç‚¹è¾¹ä¿¡æ¯ï¼Œåœ¨ç”¨ç‚¹è¾¹çš„vertex id, get_value(key_of_id) LSM çš„åŠ£åŠ¿ é¦–å…ˆæ˜¯è¯»æ€§èƒ½ï¼Œåœ¨è¯»çš„æ—¶å€™ï¼Œå¦‚æœå†…å­˜æ²¡æœ‰å‘½ä¸­ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªé€å±‚çš„ SST æ–‡ä»¶ï¼Œå»æ‰¾ Key çš„æœ€åæƒ…å†µï¼Œå¯èƒ½è¦æŠŠæ‰€æœ‰å±‚çš„ SST æ–‡ä»¶å…¨éƒ¨æ‰¾å®Œï¼Œæ‰èƒ½æ‰¾åˆ°åˆé€‚çš„ Keyã€‚æ‰€ä»¥å®ƒçš„å…ç´¢å¼•è¿æ¥æ˜¯æ¯”è¾ƒä¾èµ–äºCompaction æ“ä½œçš„ã€‚åªæœ‰åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œæ¯”å¦‚åœ¨ä¸€ä¸ªå®Œæ•´çš„ Compaction å®Œæˆçš„æƒ…å†µä¸‹ï¼Œå®ƒæ‰èƒ½çœŸæ­£å®ç°å…ç´¢å¼•è¿æ¥ï¼Œå¦åˆ™ä¼šåœ¨å„ä¸ª SST æ–‡ä»¶å†…éƒ¨å»æŸ¥æ‰¾ã€‚åœ¨æ•´ä½“ä¸Šï¼Œå®ƒå¹¶æ²¡æœ‰å®Œæ•´åœ°è¾¾åˆ°ä¸å»åˆ©ç”¨å…¶å®ƒç»“æ„å°±èƒ½å¤Ÿè¿›è¡Œå¿«é€Ÿçš„é¢†åŸŸè¿­ä»£ã€‚\nè€Œåš Compaction åˆæ˜¯ä¸€ä¸ªæœ‰æ¯”è¾ƒå¤§çš„ç£ç›˜ IO çš„æ“ä½œï¼Œå¹¶ä¸”å¦‚æœä½¿ç”¨çš„æ˜¯ç¬¬ä¸‰æ–¹çš„å­˜å‚¨ç»“æ„ï¼Œé‚£ä¹ˆåš Compaction çš„æ“ä½œæ˜¯ä¸å—å›¾æ•°æ®åº“æœ¬èº«æ§åˆ¶çš„ï¼Œå¯èƒ½æ˜¯ç”±ä¸€äº›å…¶å®ƒçš„æœºåˆ¶è§¦å‘çš„ï¼Œæ¯”å¦‚æ˜¯åœ¨å‰å°è´Ÿè½½å‹åŠ›æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹è§¦å‘äº† Compactionï¼Œè¿™æ ·å®é™…åœ¨ä½¿ç”¨çš„æ—¶å€™ä¼šå‡ºç°ä¸€äº›ç“¶é¢ˆï¼Œæ‰€ä»¥å¿…é¡»è¦å¯¹ç¬¬ä¸‰æ–¹å­˜å‚¨è¿›è¡Œæ¯”è¾ƒæ·±åº¦çš„æ”¹åŠ¨ï¼Œæ‰èƒ½å¤Ÿæ›´å¥½åœ°ä¼˜åŒ–ã€‚\nå¯ä»¥çœ‹åˆ°ï¼Œå„ç§å®ç°å…ç´¢å¼•è¿æ¥çš„å­˜å‚¨æ–¹å¼éƒ½ä¸æ˜¯ä¸€åŠ³æ°¸é€¸çš„ï¼Œè€Œæ˜¯æœ‰å„è‡ªçš„ä¼˜åŠ¿å’ŒçŸ­æ¿ã€‚é€šè¿‡æ•°ç»„çš„æ–¹å¼è¯»å–é€Ÿåº¦å¿«ï¼Œä½†æ˜¯å†™å…¥å› ä¸ºæ¶‰åŠåˆ°å˜é•¿çš„é—®é¢˜ï¼Œå¯èƒ½ä¼šæ¯”è¾ƒæ…¢ã€‚é€šè¿‡ LSM æ ‘çš„æ–¹å¼å†™å…¥é€Ÿåº¦å¿«ï¼Œä½†æ˜¯è¯»çš„æ—¶å€™åˆä¾èµ–äº Compaction æ“ä½œï¼Œåœ¨ Compaction æ²¡æœ‰å®Œæˆçš„æƒ…å†µä¸‹ï¼Œå®ƒçš„è¯»å–é€Ÿåº¦ä¹Ÿæ¯”è¾ƒæ…¢ã€‚é€šè¿‡é“¾è¡¨çš„æ–¹å¼è¯»å–å’Œå†™å…¥é€Ÿåº¦éƒ½ä¸å ä¼˜ï¼Œä½†æ˜¯å®ƒçš„çµæ´»æ€§å´æœ€é«˜ï¼Œå› ä¸ºå®ƒæ˜¯ä»¥ offset å½¢å¼çš„æŒ‡é’ˆæ¥å®ç°çš„ã€‚\nåœ¨å®é™…å•†ä¸šå›¾æ•°æ®åº“çš„å®ç°è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ ¹æ®è®¾è®¡ç†å¿µå»åšå–èˆã€‚ä¹Ÿå¯ä»¥ç»“åˆä¸¤ç§æˆ–è€…å¤šç§æ–¹æ¡ˆçš„ä¼˜ç‚¹ï¼Œåœ¨ä¸åŒçš„æ•°æ®å½¢å¼ä¸‹ï¼Œçµæ´»åœ°å®ç°ä¸åŒç±»å‹çš„å­˜å‚¨ã€‚è¿˜æœ‰ä¸€äº›å…¶å®ƒçš„é—®é¢˜ï¼Œæ¯”å¦‚åˆ†åŒºåˆ†ç‰‡ã€åå‘è¾¹ä¸€è‡´æ€§ã€å¦‚ä½•æ”¯æŒäº‹åŠ¡ã€æ•°æ®ç´¢å¼•æ€ä¹ˆåšã€æ•°æ®è¿‡æœŸç­‰ç­‰ï¼Œéƒ½æ˜¯è¦è§£å†³çš„é—®é¢˜ï¼Œå®ç°èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ã€‚\n","permalink":"https://reid00.github.io/en/posts/storage/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1%E5%AD%98%E5%82%A8%E6%8A%80%E6%9C%AF/","summary":"RDFå’Œå±æ€§å›¾ é¦–å…ˆæ¥ä»‹ç» RDF å’Œå±æ€§å›¾ã€‚å¤§å®¶çŸ¥é“ä¸–ç•Œä¸‡ç‰©æ˜¯æ™®éè”ç³»çš„ï¼ŒInternet å¸¦æ¥äº†ä¿¡æ¯çš„è¿é€šï¼ŒIoT å¸¦æ¥äº†è®¾å¤‡çš„è¿é€šï¼Œåƒå¾®ä¿¡ã€å¾®åšã€æŠ–éŸ³ã€å¿«æ‰‹è¿™äº› APP å¸¦æ¥äº†äººé™…å…³ç³»çš„è¿é€šã€‚éšç€ç¤¾äº¤ã€é›¶å”®ã€é‡‘èã€ç”µä¿¡ã€ç‰©æµç­‰è¡Œä¸šçš„å¿«é€Ÿå‘å±•ï¼Œå½“ä»Šç¤¾ä¼šæ”¯èµ·äº†ä¸€å¼ åºå¤§è€Œå¤æ‚çš„å…³ç³»ç½‘ï¼Œåœ¨äººä»¬çš„ç”Ÿäº§å’Œç”Ÿæ´»è¿‡ç¨‹ä¸­ï¼Œæ¯æ—¶æ¯åˆ»éƒ½äº§ç”Ÿç€å¤§é‡çš„æ•°æ®ã€‚éšç€æŠ€æœ¯çš„å‘å±•ï¼Œæˆ‘ä»¬å¯¹è¿™äº›æ•°æ®çš„åˆ†æå’Œä½¿ç”¨ä¹Ÿä¸å†å±€é™äºä»ç»Ÿè®¡çš„è§’åº¦è¿›è¡Œä¸€äº›ç›¸å…³æ€§çš„åˆ†æï¼Œè€Œæ˜¯å¸Œæœ›ä»å…³è”çš„è§’åº¦æ­ç¤ºæ•°æ®çš„ä¸€äº›å› æœè”ç³»ã€‚è¿™é‡Œçš„å…³è”ï¼ŒæŒ‡çš„æ˜¯ç›¸äº’è¿æ¥çš„ connectivityï¼Œè€Œä¸æ˜¯ç»Ÿè®¡æ„ä¹‰ä¸Šçš„ correlationã€‚\nå…³è”åˆ†æçš„åœºæ™¯ä¹Ÿéå¸¸å¤šï¼Œè¦†ç›–æˆ‘ä»¬ç”Ÿæ´»çš„æ–¹æ–¹é¢é¢ã€‚æ¯”å¦‚ä»ç¤¾äº¤ç½‘ç»œåˆ†æé‡Œï¼Œæˆ‘ä»¬å¯ä»¥åšç²¾å‡†è¥é”€ã€å¥½å‹æ¨èã€èˆ†æƒ…è¿½è¸ªç­‰ç­‰ï¼›é‡‘èé¢†åŸŸå¯ä»¥åšä¿¡ç”¨å¡åæ¬ºè¯ˆçš„åˆ†æï¼Œèµ„é‡‘æµå‘è¯†åˆ«ï¼›é›¶å”®é¢†åŸŸï¼Œæˆ‘ä»¬å¯ä»¥åšç”¨æˆ· 360 ç”»åƒåšå•†å“å®æ—¶æ¨èï¼Œè¿”è–…ç¾Šæ¯›ï¼›ç”µåŠ›é¢†åŸŸï¼Œå¯ä»¥åšç”µç½‘çš„è°ƒåº¦ä»¿çœŸã€æ•…éšœåˆ†æã€ç”µå°å› å­è®¡ç®—ï¼›ç”µä¿¡é¢†åŸŸï¼Œå¯ä»¥åšç”µä¿¡é˜²éªšæ‰°ï¼Œç”µä¿¡é˜²è¯ˆéª—ï¼›æ”¿ä¼é¢†åŸŸï¼Œå¯ä»¥åšé“è·¯è§„åˆ’ã€æ™ºèƒ½äº¤é€šï¼Œè¿˜æœ‰ç–«æƒ…ç²¾å‡†é˜²æ§ï¼›åœ¨åˆ¶é€ ä¸šï¼Œæˆ‘ä»¬å¯ä»¥åšä¾›åº”é“¾ç®¡ç†ã€ç‰©æµä¼˜åŒ–ã€äº§å“æº¯æºç­‰ï¼›ç½‘ç»œå®‰å…¨è¡Œä¸šï¼Œå¯ä»¥åšæ”»å‡»æº¯æºã€è°ƒç”¨é“¾åˆ†æç­‰ç­‰ã€‚\nåœ¨åšå…³è”åˆ†æçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦ä¸€ä¸ªå›¾æ¨¡å‹æ¥æè¿°ã€‚å¸¸è§çš„å›¾æ¨¡å‹åˆ†ä¸º RDF å’Œå±æ€§å›¾ä¸¤ç§ã€‚RDF å›¾ä¸­ç”¨ç‚¹æ¥è¡¨ç¤ºå”¯ä¸€æ ‡è¯†çš„èµ„æºæˆ–è€…æ˜¯å­—é¢é‡çš„å€¼ï¼Œè¾¹åˆ™ç”¨æ¥è¡¨ç¤ºè°“è¯ã€‚ç‚¹å’Œè¾¹ä¹‹é—´ç»„æˆä¸€ä¸ª SPO çš„ä¸‰å…ƒç»„ã€‚å±æ€§å›¾ä¸­ï¼Œç‚¹è¡¨ç¤ºå®ä½“ï¼Œè¾¹è¡¨ç¤ºå…³ç³»ï¼Œå±æ€§æ˜¯ç‚¹æˆ–è¾¹ä¸Šçš„ä¸€ä¸ªé”®å€¼å¯¹ã€‚\nç›¸æ¯”ä¹‹ä¸‹ï¼ŒRDF çš„ä¼˜åŠ¿æ˜¯å¯ä»¥æ”¯æŒå¤šå€¼å±æ€§ï¼Œå› ä¸ºå®ƒçš„å±æ€§ä¹Ÿæ˜¯ä¸€ä¸ªç‚¹ï¼Œæ‰€ä»¥ä¸€ä¸ªç‚¹è¿å‡ºå»ï¼Œå¯ä»¥æœ‰å¤šå€¼çš„å±æ€§ã€‚ä¹Ÿå¯ä»¥é€šè¿‡å››å…ƒç»„çš„æ–¹å¼å‰é¢åŠ ä¸Šä¸€ä¸ªå›¾çš„æè¿°ï¼Œæ¥å®ç°åŠ¨æ€å›¾ã€‚å¹¶ä¸” RDF å¼€å§‹çš„æ¯”è¾ƒæ—©ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªæ¯”è¾ƒç»Ÿä¸€çš„æ ‡å‡†ã€‚\nå±æ€§å›¾çš„ä¼˜åŠ¿åœ¨äºå®ƒä¸¤ç‚¹ä¹‹é—´å¯ä»¥è¡¨ç¤ºåŒç±»å‹çš„å¤šæ¡è¾¹ï¼Œå› ä¸ºå®ƒåœ¨è¾¹ä¸Šæ˜¯å¯ä»¥æœ‰åŒºåˆ†å±æ€§çš„ï¼Œè¾¹ä¸Šçš„å±æ€§å€¼ä¹Ÿèƒ½è®©è¾¹ä¸Šçš„è¡¨è¾¾èƒ½åŠ›æ›´ä¸°å¯Œã€‚å¹¶ä¸”å®ƒæ”¯æŒå¤æ‚çš„å±æ€§ç±»å‹ï¼Œæ¯”å¦‚ listã€setã€map ç­‰ã€‚\néšç€è¡Œä¸šçš„å‘å±•ï¼Œæˆ‘ä»¬çœ‹åˆ°è¶Šæ¥è¶Šå¤šçš„å¯èƒ½ã€‚çŸ¥è¯†å›¾è°±çš„è¡¨ç¤ºåœ¨é€æ¸ç”¨å±æ€§å›¾æ¥å®Œæˆã€‚å½“ç„¶ä¹Ÿæœ‰å°‘é‡çš„å›¾æ•°æ®åº“æ˜¯ç”¨ RDF æ¨¡å‹æ¥åšçš„ï¼Œä½†æ˜¯æœªæ¥æ›´å¤šçš„æ–°å‹å›¾æ•°æ®åº“éƒ½ä¼šç”¨å±æ€§å›¾æ¨¡å‹ã€‚\nå›¾æ•°æ®åº“å­˜å‚¨çš„æ ¸å¿ƒç›®æ ‡ å®Œæˆä¸€ä¸ªå›¾æŸ¥è¯¢æˆ–è€…å›¾åˆ†æçš„æ ¸å¿ƒæ“ä½œï¼Œå°±æ˜¯é‚»å±…çš„è¿­ä»£éå†ã€‚\nå•ç‹¬çš„è®¿é—®ç‚¹æˆ–è€…è¾¹ï¼Œæˆ–è€…ä¸Šé¢çš„å±æ€§å¹¶ä¸æ˜¯è¿™é‡Œçš„å…³é”®ã€‚ä»…ä»…æ˜¯å•ç‹¬è®¿é—®ï¼Œä½¿ç”¨ä¼ ç»Ÿçš„æ•°æ®åº“ä¹Ÿå¯ä»¥æä¾›å¾ˆå¥½çš„æ€§èƒ½ã€‚åœ¨å…³è”åˆ†æå½“ä¸­ï¼Œä¸è®ºæ˜¯ä»ä¸€ä¸ªèµ·å§‹ç‚¹è‹¥å¹²è·³æ•°å†…çš„é‚»åŸŸç½‘ç»œè¿›è¡Œåˆ†æï¼Œè¿˜æ˜¯å¯¹å…¨å›¾è¿›è¡Œä¸€äº›å®Œæ•´çš„è®¡ç®—ï¼Œæœ€æ ¸å¿ƒçš„æ“ä½œéƒ½æ˜¯è¿­ä»£éå†æŸä¸ªç‚¹çš„æ‰€æœ‰è¾¹ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“é‚»å±…çš„è¿­ä»£éå†ã€‚åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­æ˜¯ä¾èµ–å¤–é”®ï¼Œé€šè¿‡å»ºç«‹ç´¢å¼•ç­‰æ–¹å¼æ¥å®Œæˆçš„ã€‚\nåœ¨å›¾æ•°æ®åº“ä¸­ï¼Œä¼šç›´æ¥å­˜å‚¨è¾¹æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„å®ç° index-free adjacencyã€‚å†™å…¥çš„æ—¶å€™ï¼Œä¿è¯ä¸€ä¸ªç‚¹å’Œå®ƒç›´æ¥ç›¸è¿çš„è¾¹æ€»æ˜¯å­˜å‚¨åœ¨ä¸€èµ·ã€‚æŸ¥è¯¢çš„æ—¶å€™ï¼Œè¿­ä»£éå†ä¸€ä¸ªç‚¹çš„æ‰€æœ‰é‚»å±…å¯ä»¥ç›´æ¥è¿›è¡Œï¼Œä¸éœ€è¦ä¾èµ–äºå…¶å®ƒæ•°æ®ç»“æ„ï¼Œä»è€Œå¯ä»¥å¤§å¹…æå‡é‚»å±…è¿­ä»£éå†çš„æ€§èƒ½ã€‚\nè¿™é‡Œæ˜¯è·Ÿå…³ç³»å‹æ•°æ®åº“åšçš„ä¸€ä¸ªæ·±ç‚¹æŸ¥è¯¢çš„æ€§èƒ½å¯¹æ¯”ï¼Œç”¨çš„æ˜¯ who-trust-whom çš„ä¸€ä¸ªå…¬å¼€æ•°æ®é›†ï¼Œè¿™ä¸ªæ•°æ®é›†ä¹Ÿä¸æ˜¯å¾ˆå¤§ï¼Œçº¦ 7.5 ä¸‡ç‚¹ï¼Œ50 ä¸‡è¾¹ã€‚æˆ‘ä»¬æƒ³çŸ¥é“ä¸€ä¸ªä¿¡ä»»çš„äººè¿™æ ·ä¸€ä¸ªå¤šè·³å…³è”çš„æŸ¥è¯¢ç»“æœã€‚ä½¿ç”¨å…³é”®æ€§æ•°æ®åº“çš„æ—¶å€™ï¼Œå¯¹æ¯”äº†åŠ ç´¢å¼•å’Œä¸åŠ ç´¢å¼•çš„æƒ…å†µã€‚å¯ä»¥çœ‹å‡º 2 è·³çš„æ—¶å€™åŠ ç´¢å¼•å¯ä»¥æ˜æ˜¾æå‡å…³ç³»å‹æ•°æ®åº“çš„æŸ¥è¯¢é€Ÿåº¦ï¼Œåˆ° 3 è·³çš„æ—¶å€™æå‡å°±ä¸å¤šäº†ï¼Œ 4 è·³ä»¥ä¸Šçš„æ—¶å€™åŠ ä¸åŠ ç´¢å¼•éƒ½ä¼šå˜å¾—å¾ˆæ…¢ã€‚è€Œä½¿ç”¨å›¾æ•°æ®åº“ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¸€ç›´ä¼šä¿æŒåœ¨ä¸€ä¸ªéå¸¸å¿«çš„æ°´å¹³ã€‚è¿™å°±æ˜¯å›¾æ•°æ®åº“çš„ index-free adjacency çš„ç‰¹æ€§ï¼Œèƒ½å¤Ÿå¤§å¹…æå‡é‚»å±…æŸ¥è¯¢çš„é€Ÿåº¦ã€‚\nå›¾æ•°æ®åº“çš„åˆ†ç±» æ ¹æ®å®ç°å…ç´¢å¼•è¿æ¥çš„æ–¹å¼ï¼Œå¯ä»¥æŠŠå›¾æ•°æ®åº“åˆ†æˆä¸‰ç±»ã€‚\nç¬¬ä¸€ç±»æ˜¯ä½¿ç”¨åŸç”Ÿå›¾å­˜å‚¨çš„æ–¹å¼ï¼Œå®ƒçš„æ•°æ®å­˜å‚¨å±‚å°±ç›´æ¥å®ç°äº†å…ç´¢å¼•è¿æ¥ã€‚ä¸Šé¢çš„å¤„ç†è®¡ç®—å±‚å’Œä¸šåŠ¡å±‚éƒ½æ˜¯ä»¥å®Œå…¨å›¾çš„ç»“æ„æ¥æè¿°ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¾èµ–äºç¬¬ä¸‰æ–¹å­˜å‚¨ç»„ä»¶ï¼Œæ‰€ä»¥è¿™ç§å®ç°å…ç´¢å¼•è¿æ¥çš„æ€§èƒ½æ˜¯æœ€é«˜æ•ˆçš„ã€‚ ç¬¬äºŒç§æ–¹å¼æ˜¯éåŸç”Ÿå­˜å‚¨ï¼Œæ•°æ®å­˜å‚¨å±‚ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„å¼€æºå­˜å‚¨ç»„ä»¶ï¼Œä½†æ˜¯å®ƒåœ¨å¤„ç†è¿‡ç¨‹ä¸­å®ç°äº†è¿‘ä¼¼å…ç´¢å¼•è¿æ¥ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¹Ÿèƒ½æä¾›ä¸é”™çš„æ€§èƒ½ã€‚å®ƒçš„é—®é¢˜æ˜¯ç”±äºä½¿ç”¨äº†ç¬¬ä¸‰æ–¹å­˜å‚¨ç»„ä»¶ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½åšå¾—ä¸æ˜¯æœ€ä¼˜åŒ–ã€‚ ç¬¬ä¸‰ç§æ–¹å¼å°±æ˜¯å®Œå…¨éåŸç”Ÿçš„å­˜å‚¨ï¼Œåº•ä¸‹å¯èƒ½æ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªæ–‡æ¡£å‹æˆ–è€…å…¶å®ƒç±»å‹çš„æ•°æ®åº“ï¼Œå®ƒçš„å­˜å‚¨å±‚å…¶å®å¹¶ä¸æ˜¯çœŸæ­£åœ°å®ç°äº†å…ç´¢å¼•è¿æ¥ï¼Œè€Œæ˜¯å¤„ç†æˆé€šè¿‡ç´¢å¼•æˆ–è€…ä¸€äº›å…¶å®ƒæŠ€æœ¯æ‰‹æ®µï¼Œå‘ä¸Šè¡¨è¾¾äº†ä¸€ä¸ªå›¾æ¨¡å‹çš„æŸ¥è¯¢æ¥å£ã€‚è¿™ç§å…¶å®åªæ˜¯åœ¨æ¥å£å±‚ä¸Šå®ç°äº†å›¾çš„ä¸€ä¸ªè¯­ä¹‰ï¼Œè€Œåº•ä¸‹çš„å­˜å‚¨å’Œè®¡ç®—å±‚éƒ½ä¸æ˜¯å®Œå…¨åœ°ä½¿ç”¨å…ç´¢å¼•è¿æ¥ï¼Œæ‰€ä»¥å®ƒçš„æ€§èƒ½ä¹Ÿä¼šç›¸å¯¹ä½ä¸€äº›ã€‚ å›¾æ•°æ®åº“å­˜å‚¨çš„ä¸»æµæŠ€æœ¯æ–¹æ¡ˆ å‰æ–‡ä¸­å·²ç»æ˜ç¡®äº†æ•°æ®åº“å­˜å‚¨çš„æ ¸å¿ƒç›®æ ‡å°±æ˜¯å®ç°å…ç´¢å¼•è¿æ¥ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ¥çœ‹ä¸€äº›å…·ä½“å®ç°å…ç´¢å¼•è¿æ¥çš„ä¸»æµæŠ€æœ¯æ–¹æ¡ˆã€‚\næ•°ç»„å­˜å‚¨ é¦–å…ˆæˆ‘ä»¬èƒ½æƒ³åˆ°çš„æœ€ç›´æ¥çš„ä¸€ä¸ªæ–¹æ¡ˆï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªæ•°ç»„æŠŠæ¯ä¸ªç‚¹ä¸Šçš„è¾¹æŒ‰ç…§é¡ºåºä¸€èµ·å­˜å‚¨ã€‚åœ¨è¿™ä¸€å­˜å‚¨æ–¹æ¡ˆä¸­ï¼Œç‚¹æ–‡ä»¶å°±æ˜¯ç”±ä¸€ç³»åˆ—çš„ç‚¹æ•°æ®ç»„æˆçš„ã€‚æ¯ä¸ªç‚¹çš„å­˜å‚¨å†…å®¹åŒ…æ‹¬ç‚¹çš„ IDã€ç‚¹çš„ Meta ä¿¡æ¯ï¼Œä»¥åŠè¿™ä¸ªç‚¹çš„ä¸€ç³»åˆ—å±æ€§ã€‚åœ¨è¾¹æ–‡ä»¶ä¸­ï¼Œæ˜¯æŒ‰ç…§èµ·å§‹ç‚¹çš„é¡ºåºå­˜å‚¨ç‚¹ä¸Šå¯¹åº”çš„è¾¹ï¼Œæ¯æ¡è¾¹å­˜å‚¨çš„å†…å®¹åŒ…æ‹¬ç»ˆæ­¢ç‚¹ IDã€è¾¹çš„ Meta ä¿¡æ¯ã€è¾¹çš„ä¸€ç³»åˆ—å±æ€§ã€‚è¿™é‡Œæ‰€è°“çš„ Meta ä¿¡æ¯åŒ…æ‹¬ç‚¹è¾¹çš„ç±»å‹ã€æ–¹å‘ï¼Œè¿˜æœ‰ä¸€äº›ä¸ºäº†å®ç°äº‹åŠ¡çš„é¢å¤–å­—æ®µï¼Œè¿™å¯¹äºæ•´ä½“çš„å­˜å‚¨æ¥è¯´ä¸æ˜¯ç‰¹åˆ«é‡è¦ï¼Œåœ¨è¿™é‡Œå°±ä¸è¯¦ç»†å±•å¼€äº†ã€‚åœ¨è¿™ä¸ªå­˜å‚¨æ–¹æ¡ˆä¸­ï¼Œå¯ä»¥ç›´æ¥ä»èµ·å§‹ç‚¹å¼€å§‹éå†ç›¸é‚»è¾¹çš„æ‰€æœ‰æ•°æ®ï¼Œè¯»å–æ€§èƒ½æ˜¯éå¸¸é«˜çš„ã€‚ æ•°ç»„å­˜å‚¨åŠ£åŠ¿ è¿™ç§å­˜å‚¨éœ€è¦å¤„ç†çš„ä¸€ä¸ªæ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜ï¼Œå°±æ˜¯æ•°ç»„å˜é•¿çš„æƒ…å†µã€‚è¿™é‡Œçš„å˜é•¿æ˜¯ç”±å¾ˆå¤šå› ç´ å¯¼è‡´ï¼Œæ¯”å¦‚ä¸¤ä¸ªç‚¹å¯èƒ½å±æ€§æ•°é‡ä¸ä¸€æ ·ï¼Œå±æ€§æœ¬èº«å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œé•¿åº¦ä¹Ÿä¼šä¸ä¸€æ ·ã€‚å±æ€§é•¿åº¦ä¸ä¸€æ ·ä¼šå¯¼è‡´æ¯æ¡è¾¹çš„å­˜å‚¨ç©ºé—´ä¹Ÿä¸ä¸€æ ·ï¼Œè¿™æ ·åœ¨è¾¹æ–‡ä»¶ä¸­å°±ä¸èƒ½ç”¨ä¸€ä¸ªç®€å•çš„æ•°ç»„æ¥è¿›è¡Œå¯»å€äº†ã€‚å¦‚æœä»…ä»…æ˜¯å±æ€§å¯¼è‡´çš„å˜é•¿ï¼Œè¿˜æ˜¯æœ‰æ¯”è¾ƒç®€å•çš„è§£å†³æ–¹æ¡ˆçš„ï¼Œæ¯”å¦‚å¯ä»¥æŠŠå±æ€§å•ç‹¬çš„å†æ”¾åˆ°å¦ä¸€ä¸ªå­˜å‚¨æ–‡ä»¶ä¸­ï¼Œè¿™æ ·ç‚¹æ–‡ä»¶å’Œè¾¹æ–‡ä»¶é‡Œé¢çš„å†…å®¹ï¼Œæ˜¯ä¸æ˜¯å®šé•¿çš„å‘¢ï¼Ÿå…¶å®ä¹Ÿä¸ä¸€å®šï¼Œå› ä¸ºæ¯ä¸ªç‚¹ä¸Šè¾¹çš„æ•°é‡ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥åœ¨è¾¹æ–‡ä»¶é‡Œé¢ï¼Œæ¯ä¸ªç‚¹è§¦å‘çš„è¾¹åºåˆ—çš„æ€»é•¿åº¦ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚æ‰€ä»¥è¿˜æ˜¯è¦å¤„ç†æ•°ç»„å˜é•¿çš„é—®é¢˜ã€‚\nè§£å†³æ€è·¯ä¸€èˆ¬æ˜¯ä¸¤ç§ï¼š","title":"çŸ¥è¯†å›¾è°±å­˜å‚¨æŠ€æœ¯"},{"content":"WebAssembly ç®€ä»‹ WebAssembly (æœ‰æ—¶ç¼©å†™ä¸º Wasm)ä¸ºå¯æ‰§è¡Œç¨‹åºå®šä¹‰äº†ä¸€ç§å¯ç§»æ¤çš„äºŒè¿›åˆ¶ä»£ç æ ¼å¼å’Œç›¸åº”çš„æ–‡æœ¬æ ¼å¼ä»¥åŠè½¯ä»¶æ¥å£ï¼Œç”¨äºä¿ƒè¿›è¿™äº›ç¨‹åºä¸å…¶å®¿ä¸»ç¯å¢ƒä¹‹é—´çš„äº¤äº’ã€‚ WebAssembly çš„ä¸»è¦ç›®æ ‡æ˜¯åœ¨ç½‘é¡µä¸Šå¯ç”¨é«˜æ€§èƒ½çš„åº”ç”¨ç¨‹åºï¼Œâ€œä½†æ˜¯å®ƒä¸ä¼šåšå‡ºä»»ä½•ç‰¹å®šäº Web çš„å‡è®¾æˆ–æä¾›ç‰¹å®šäº Web çš„ç‰¹æ€§ï¼Œå› æ­¤å®ƒä¹Ÿå¯ä»¥åœ¨å…¶ä»–ç¯å¢ƒä¸­ä½¿ç”¨ã€‚â€å®ƒæ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡† ï¼Œæ—¨åœ¨æ”¯æŒä»»ä½•æ“ä½œç³»ç»Ÿä¸Šçš„ä»»ä½•è¯­è¨€ï¼Œå®é™…ä¸Šï¼Œæ‰€æœ‰æœ€æµè¡Œçš„è¯­è¨€éƒ½è‡³å°‘æœ‰ä¸€å®šç¨‹åº¦çš„æ”¯æŒã€‚ from wasm\nWebAssembly (sometimes abbreviated Wasm) defines a portable binary-code format and a corresponding text format for executable programs as well as software interfaces for facilitating interactions between such programs and their host environment. The main goal of WebAssembly is to enable high-performance applications on web pages, \u0026ldquo;but it does not make any Web-specific assumptions or provide Web-specific features, so it can be employed in other environments as well.\u0026quot;[7] It is an open standard[8][9] and aims to support any language on any operating system,[10] and in practice all of the most popular languages already have at least some level of support.\nWebAssembly æ˜¯ä¸€ç§äºŒè¿›åˆ¶ç¼–ç æ ¼å¼ï¼Œè€Œä¸æ˜¯ä¸€é—¨æ–°çš„è¯­è¨€ã€‚ WebAssembly ä¸æ˜¯ä¸ºäº†å–ä»£ JavaScriptï¼Œè€Œæ˜¯ä¸€ç§è¡¥å……ï¼ˆè‡³å°‘ç°é˜¶æ®µæ˜¯è¿™æ ·ï¼‰ï¼Œç»“åˆ WebAssembly çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œå¾ˆå¤§å¯èƒ½é›†ä¸­åœ¨å¯¹æ€§èƒ½è¦æ±‚é«˜ï¼ˆä¾‹å¦‚æ¸¸æˆï¼ŒAIï¼‰ï¼Œæˆ–æ˜¯å¯¹äº¤äº’ä½“éªŒè¦æ±‚é«˜ï¼ˆä¾‹å¦‚ç§»åŠ¨ç«¯ï¼‰çš„åœºæ™¯ã€‚ C/C++ ç­‰è¯­è¨€å¯ä»¥ç¼–è¯‘ WebAssembly çš„ç›®æ ‡æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶ä»–è¯­è¨€å¯ä»¥é€šè¿‡ç¼–è¯‘å™¨æ”¯æŒï¼Œè€Œå†™å‡ºèƒ½å¤Ÿåœ¨æµè§ˆå™¨å‰ç«¯è¿è¡Œçš„ä»£ç ã€‚ Rust å¦‚ä½•ä½¿ç”¨WASM å®Œæ•´é¡¹ç›®çœ‹æ­¤å¤„\nå®‰è£… å®‰è£…Rust, å‚è€ƒå®˜ç½‘ install wasm-pack cargo install wasm-pack [å¯é€‰] install cargo-generate cargo install cargo-generate Python3 ç”¨äºå¯åŠ¨ä¸€ä¸ªç®€å•çš„ HTTP æœåŠ¡å™¨ æ¡ˆä¾‹ åˆ›å»ºä¸€ä¸ªrust lib é¡¹ç›® cargo new --lib hello-wasm æ‰“å¼€é¡¹ç›®,ç»“æ„å¦‚ä¸‹ 1 2 3 4 5 6 -rw-r--r-- 1 zhangbl 197121 3203 Aug 16 15:41 Cargo.lock -rw-r--r-- 1 zhangbl 197121 224 Aug 16 15:51 Cargo.toml -rw-r--r-- 1 zhangbl 197121 314 Aug 16 17:35 index.html # åé¢æ–°å»ºçš„ drwxr-xr-x 1 zhangbl 197121 0 Aug 16 18:13 pkg/ # åé¢ç”Ÿæˆçš„ drwxr-xr-x 1 zhangbl 197121 0 Aug 16 15:27 src/ drwxr-xr-x 1 zhangbl 197121 0 Aug 16 16:01 target/ æ‰“å¼€src/lib.rs, åˆ é™¤åŸå…ˆå†…å®¹ï¼Œç”¨ä»¥ä¸‹å†…å®¹å–ä»£:\n1 2 3 4 5 6 7 8 9 10 11 use wasm_bindgen::prelude::*; #[wasm_bindgen] extern { pub fn alert(s: \u0026amp;str); } #[wasm_bindgen] pub fn greet(name: \u0026amp;str) { alert(\u0026amp;format!(\u0026#34;Hello, {}!\u0026#34;, name)); } åŒæ—¶åœ¨cargo.toml æ–°å¢ä¸‹é¢å†…å®¹:\n1 2 3 4 5 [lib] crate-type = [\u0026#34;cdylib\u0026#34;] [dependencies] wasm-bindgen=\u0026#34;0.2\u0026#34; ä»£ç è§£æ use wasm_bindgen::prelude::*;ï¼šå¯¼å…¥äº† wasm_bindgen åº“çš„é¢„å¯¼å…¥ï¼ˆpreludeï¼‰æ¨¡å—ï¼Œå®ƒåŒ…å«äº†ä¸€äº›å¸¸ç”¨çš„å®å’Œç±»å‹ã€‚è¿™æ ·å¯ä»¥æ–¹ä¾¿åœ°åœ¨ä»£ç ä¸­ä½¿ç”¨ wasm_bindgen æä¾›çš„åŠŸèƒ½ã€‚ #[wasm_bindgen]ï¼šè¿™æ˜¯ä¸€ä¸ªå±æ€§å®ï¼Œç”¨äºæ ‡è®°ä¸‹é¢çš„å‡½æ•°å’Œå¤–éƒ¨æ¥å£éœ€è¦ä¸ JavaScript è¿›è¡Œç»‘å®š extern å—ï¼šåœ¨ extern å—å†…éƒ¨ä½¿ç”¨ pub fn alert(s: \u0026amp;str) å®šä¹‰äº†ä¸€ä¸ªå¤–éƒ¨å‡½æ•°æ¥å£ã€‚è¿™ä¸ªå‡½æ•°å£°æ˜äº†ä¸€ä¸ªå‚æ•° sï¼Œç±»å‹ä¸ºå­—ç¬¦ä¸²å¼•ç”¨ï¼ˆ\u0026amp;strï¼‰ã€‚ ä» Rust è°ƒç”¨ JavaScript ä¸­çš„å¤–éƒ¨å‡½æ•° pub fn greet(name: \u0026amp;str)ï¼šè¿™æ˜¯ä¸€ä¸ªå…¬å…±å‡½æ•° greet çš„å®šä¹‰ï¼Œå®ƒæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å¼•ç”¨å‚æ•° nameã€‚ç”Ÿæˆ JavaScript å¯ä»¥è°ƒç”¨çš„ Rust å‡½æ•° alert(\u0026amp;format!(\u0026quot;Hello, {}!\u0026quot;, name))ï¼šåœ¨ greet å‡½æ•°ä¸­è°ƒç”¨äº†å¤–éƒ¨æ¥å£å‡½æ•° alertã€‚å®ƒä½¿ç”¨ format! å®å°†ä¼ å…¥çš„ name å‚æ•°æ’å…¥åˆ°æ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ä¸­ï¼Œç„¶åè°ƒç”¨ alert å‡½æ•°æ˜¾ç¤ºè­¦å‘Šæ¡†ï¼Œå†…å®¹ä¸ºæ‹¼æ¥å¥½çš„é—®å€™ä¿¡æ¯ã€‚ toml è§£æ [lib] å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå°†è¦ç¼–è¯‘çš„ç±»å‹æ˜¯c è¯­è¨€çš„åŠ¨æ€ç±»å‹ åº“\nç¼–è¯‘ wasm-pack build --target web è¯·æ³¨æ„è¿™æ­¥å¾ˆæ…¢ï¼Œè€—æ—¶ä¼šå¾ˆä¹…ï¼Œè¯·å»å–èŒ¶ã€‚ ç¼–è¯‘å®Œæˆä¹‹åï¼Œå‡ºç°pkg åŒ…ï¼Œé‡Œé¢æä¾›äº†æˆ‘ä»¬é¡¹ç›®åçš„mywasm_bg.wasm\n1 2 3 4 5 6 7 total 38 -rw-r--r-- 1 zhangbl 197121 1116 Aug 16 17:39 mywasm.d.ts -rw-r--r-- 1 zhangbl 197121 4910 Aug 16 17:39 mywasm.js -rw-r--r-- 1 zhangbl 197121 2503 Aug 16 16:03 mywasm_bg.js -rw-r--r-- 1 zhangbl 197121 17307 Aug 16 18:13 mywasm_bg.wasm -rw-r--r-- 1 zhangbl 197121 287 Aug 16 17:39 mywasm_bg.wasm.d.ts -rw-r--r-- 1 zhangbl 197121 213 Aug 16 18:13 package.json åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼Œæ–°å»ºindex.html 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;hello-wasm example\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;script type=\u0026#34;module\u0026#34;\u0026gt; import init, { greet } from \u0026#34;./pkg/mywasm.js\u0026#34;; init().then(() =\u0026gt; { greet(\u0026#34;WebAssembly\u0026#34;) }); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; è¿è¡Œ python -m http.server å¯åŠ¨ä¸€ä¸ªç®€å•çš„web æœåŠ¡, è®©åè®¿é—® http://localhost:8000 Go å¦‚ä½•ä½¿ç”¨WASM (æœªå®Œå¾…ç»­) Hello world æ–°å»ºmain.go, ä½¿ç”¨ js.Global().get(â€˜alertâ€™) è·å–å…¨å±€çš„ alert å¯¹è±¡ï¼Œé€šè¿‡ Invoke æ–¹æ³•è°ƒç”¨ã€‚ç­‰ä»·äºåœ¨ js ä¸­è°ƒç”¨ window.alert(\u0026ldquo;Hello World\u0026rdquo;)ã€‚ 1 2 3 4 5 6 7 8 9 package main import \u0026#34;syscall/js\u0026#34; func main() { alert := js.Global().Get(\u0026#34;alert\u0026#34;) alert.Invoke(\u0026#34;Hello World!\u0026#34;) } å°† main.go ç¼–è¯‘ä¸º static/main.wasm GOOS=js GOARCH=wasm go build -o static/main.wasm\næ‹·è´ wasm_exec.js (JavaScript æ”¯æŒæ–‡ä»¶ï¼ŒåŠ è½½ wasm æ–‡ä»¶æ—¶éœ€è¦) åˆ° static æ–‡ä»¶å¤¹ cp \u0026quot;$(go env GOROOT)/misc/wasm/wasm_exec.js\u0026quot; static\nåˆ›å»º index.htmlï¼Œå¼•ç”¨ static/main.wasm å’Œ static/wasm_exec.jsã€‚\n1 2 3 4 5 6 7 8 9 \u0026lt;html\u0026gt; \u0026lt;script src=\u0026#34;static/wasm_exec.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; const go = new Go(); WebAssembly.instantiateStreaming(fetch(\u0026#34;static/main.wasm\u0026#34;), go.importObject) .then((result) =\u0026gt; go.run(result.instance)); \u0026lt;/script\u0026gt; \u0026lt;/html\u0026gt; ","permalink":"https://reid00.github.io/en/posts/langs_linux/webassemblywasm-%E6%95%99%E7%A8%8B/","summary":"WebAssembly ç®€ä»‹ WebAssembly (æœ‰æ—¶ç¼©å†™ä¸º Wasm)ä¸ºå¯æ‰§è¡Œç¨‹åºå®šä¹‰äº†ä¸€ç§å¯ç§»æ¤çš„äºŒè¿›åˆ¶ä»£ç æ ¼å¼å’Œç›¸åº”çš„æ–‡æœ¬æ ¼å¼ä»¥åŠè½¯ä»¶æ¥å£ï¼Œç”¨äºä¿ƒè¿›è¿™äº›ç¨‹åºä¸å…¶å®¿ä¸»ç¯å¢ƒä¹‹é—´çš„äº¤äº’ã€‚ WebAssembly çš„ä¸»è¦ç›®æ ‡æ˜¯åœ¨ç½‘é¡µä¸Šå¯ç”¨é«˜æ€§èƒ½çš„åº”ç”¨ç¨‹åºï¼Œâ€œä½†æ˜¯å®ƒä¸ä¼šåšå‡ºä»»ä½•ç‰¹å®šäº Web çš„å‡è®¾æˆ–æä¾›ç‰¹å®šäº Web çš„ç‰¹æ€§ï¼Œå› æ­¤å®ƒä¹Ÿå¯ä»¥åœ¨å…¶ä»–ç¯å¢ƒä¸­ä½¿ç”¨ã€‚â€å®ƒæ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡† ï¼Œæ—¨åœ¨æ”¯æŒä»»ä½•æ“ä½œç³»ç»Ÿä¸Šçš„ä»»ä½•è¯­è¨€ï¼Œå®é™…ä¸Šï¼Œæ‰€æœ‰æœ€æµè¡Œçš„è¯­è¨€éƒ½è‡³å°‘æœ‰ä¸€å®šç¨‹åº¦çš„æ”¯æŒã€‚ from wasm\nWebAssembly (sometimes abbreviated Wasm) defines a portable binary-code format and a corresponding text format for executable programs as well as software interfaces for facilitating interactions between such programs and their host environment. The main goal of WebAssembly is to enable high-performance applications on web pages, \u0026ldquo;but it does not make any Web-specific assumptions or provide Web-specific features, so it can be employed in other environments as well.","title":"WebAssembly(Wasm) æ•™ç¨‹"},{"content":"ç£ç›˜å¯ä»¥è¯´æ˜¯è®¡ç®—æœºç³»ç»Ÿæœ€æ…¢çš„ç¡¬ä»¶ä¹‹ä¸€ï¼Œè¯»å†™é€Ÿåº¦ç›¸å·®å†…å­˜ 10 å€ä»¥ä¸Šï¼Œæ‰€ä»¥é’ˆå¯¹ä¼˜åŒ–ç£ç›˜çš„æŠ€æœ¯éå¸¸çš„å¤šï¼Œæ¯”å¦‚é›¶æ‹·è´ã€ç›´æ¥ I/Oã€å¼‚æ­¥ I/O ç­‰ç­‰ï¼Œè¿™äº›ä¼˜åŒ–çš„ç›®çš„å°±æ˜¯ä¸ºäº†æé«˜ç³»ç»Ÿçš„ååé‡ï¼Œå¦å¤–æ“ä½œç³»ç»Ÿå†…æ ¸ä¸­çš„ç£ç›˜é«˜é€Ÿç¼“å­˜åŒºï¼Œå¯ä»¥æœ‰æ•ˆçš„å‡å°‘ç£ç›˜çš„è®¿é—®æ¬¡æ•°ã€‚\nè¿™æ¬¡ï¼Œæˆ‘ä»¬å°±ä»¥ã€Œæ–‡ä»¶ä¼ è¾“ã€ä½œä¸ºåˆ‡å…¥ç‚¹ï¼Œæ¥åˆ†æ I/O å·¥ä½œæ–¹å¼ï¼Œä»¥åŠå¦‚ä½•ä¼˜åŒ–ä¼ è¾“æ–‡ä»¶çš„æ€§èƒ½ã€‚\nä¸ºä»€ä¹ˆè¦æœ‰ DMA æŠ€æœ¯? åœ¨æ²¡æœ‰ DMA æŠ€æœ¯å‰ï¼ŒI/O çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š\nCPU å‘å‡ºå¯¹åº”çš„æŒ‡ä»¤ç»™ç£ç›˜æ§åˆ¶å™¨ï¼Œç„¶åè¿”å›ï¼› ç£ç›˜æ§åˆ¶å™¨æ”¶åˆ°æŒ‡ä»¤åï¼Œäºæ˜¯å°±å¼€å§‹å‡†å¤‡æ•°æ®ï¼Œä¼šæŠŠæ•°æ®æ”¾å…¥åˆ°ç£ç›˜æ§åˆ¶å™¨çš„å†…éƒ¨ç¼“å†²åŒºä¸­ï¼Œç„¶åäº§ç”Ÿä¸€ä¸ªä¸­æ–­ï¼› CPU æ”¶åˆ°ä¸­æ–­ä¿¡å·åï¼Œåœä¸‹æ‰‹å¤´çš„å·¥ä½œï¼Œæ¥ç€æŠŠç£ç›˜æ§åˆ¶å™¨çš„ç¼“å†²åŒºçš„æ•°æ®ä¸€æ¬¡ä¸€ä¸ªå­—èŠ‚åœ°è¯»è¿›è‡ªå·±çš„å¯„å­˜å™¨ï¼Œç„¶åå†æŠŠå¯„å­˜å™¨é‡Œçš„æ•°æ®å†™å…¥åˆ°å†…å­˜ï¼Œè€Œåœ¨æ•°æ®ä¼ è¾“çš„æœŸé—´ CPU æ˜¯æ— æ³•æ‰§è¡Œå…¶ä»–ä»»åŠ¡çš„ã€‚ ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘ç”»äº†ä¸€å‰¯å›¾ï¼š å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªæ•°æ®çš„ä¼ è¾“è¿‡ç¨‹ï¼Œéƒ½è¦éœ€è¦ CPU äº²è‡ªå‚ä¸æ¬è¿æ•°æ®çš„è¿‡ç¨‹ï¼Œè€Œä¸”è¿™ä¸ªè¿‡ç¨‹ï¼ŒCPU æ˜¯ä¸èƒ½åšå…¶ä»–äº‹æƒ…çš„ã€‚\nç®€å•çš„æ¬è¿å‡ ä¸ªå­—ç¬¦æ•°æ®é‚£æ²¡é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ç”¨åƒå…†ç½‘å¡æˆ–è€…ç¡¬ç›˜ä¼ è¾“å¤§é‡æ•°æ®çš„æ—¶å€™ï¼Œéƒ½ç”¨ CPU æ¥æ¬è¿çš„è¯ï¼Œè‚¯å®šå¿™ä¸è¿‡æ¥ã€‚\nè®¡ç®—æœºç§‘å­¦å®¶ä»¬å‘ç°äº†äº‹æƒ…çš„ä¸¥é‡æ€§åï¼Œäºæ˜¯å°±å‘æ˜äº† DMA æŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥å†…å­˜è®¿é—®ï¼ˆDirect Memory Accessï¼‰ æŠ€æœ¯ã€‚\nä»€ä¹ˆæ˜¯ DMA æŠ€æœ¯ï¼Ÿç®€å•ç†è§£å°±æ˜¯ï¼Œåœ¨è¿›è¡Œ I/O è®¾å¤‡å’Œå†…å­˜çš„æ•°æ®ä¼ è¾“çš„æ—¶å€™ï¼Œæ•°æ®æ¬è¿çš„å·¥ä½œå…¨éƒ¨äº¤ç»™ DMA æ§åˆ¶å™¨ï¼Œè€Œ CPU ä¸å†å‚ä¸ä»»ä½•ä¸æ•°æ®æ¬è¿ç›¸å…³çš„äº‹æƒ…ï¼Œè¿™æ · CPU å°±å¯ä»¥å»å¤„ç†åˆ«çš„äº‹åŠ¡ã€‚\né‚£ä½¿ç”¨ DMA æ§åˆ¶å™¨è¿›è¡Œæ•°æ®ä¼ è¾“çš„è¿‡ç¨‹ç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥å…·ä½“çœ‹çœ‹ã€‚ å…·ä½“è¿‡ç¨‹ï¼š\nç”¨æˆ·è¿›ç¨‹è°ƒç”¨ read æ–¹æ³•ï¼Œå‘æ“ä½œç³»ç»Ÿå‘å‡º I/O è¯·æ±‚ï¼Œè¯·æ±‚è¯»å–æ•°æ®åˆ°è‡ªå·±çš„å†…å­˜ç¼“å†²åŒºä¸­ï¼Œè¿›ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼› æ“ä½œç³»ç»Ÿæ”¶åˆ°è¯·æ±‚åï¼Œè¿›ä¸€æ­¥å°† I/O è¯·æ±‚å‘é€ DMAï¼Œç„¶åè®© CPU æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼› DMA è¿›ä¸€æ­¥å°† I/O è¯·æ±‚å‘é€ç»™ç£ç›˜ï¼› ç£ç›˜æ”¶åˆ° DMA çš„ I/O è¯·æ±‚ï¼ŒæŠŠæ•°æ®ä»ç£ç›˜è¯»å–åˆ°ç£ç›˜æ§åˆ¶å™¨çš„ç¼“å†²åŒºä¸­ï¼Œå½“ç£ç›˜æ§åˆ¶å™¨çš„ç¼“å†²åŒºè¢«è¯»æ»¡åï¼Œå‘ DMA å‘èµ·ä¸­æ–­ä¿¡å·ï¼Œå‘ŠçŸ¥è‡ªå·±ç¼“å†²åŒºå·²æ»¡ï¼› DMA æ”¶åˆ°ç£ç›˜çš„ä¿¡å·ï¼Œå°†ç£ç›˜æ§åˆ¶å™¨ç¼“å†²åŒºä¸­çš„æ•°æ®æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºä¸­ï¼Œæ­¤æ—¶ä¸å ç”¨ CPUï¼ŒCPU å¯ä»¥æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼› å½“ DMA è¯»å–äº†è¶³å¤Ÿå¤šçš„æ•°æ®ï¼Œå°±ä¼šå‘é€ä¸­æ–­ä¿¡å·ç»™ CPUï¼› CPU æ”¶åˆ° DMA çš„ä¿¡å·ï¼ŒçŸ¥é“æ•°æ®å·²ç»å‡†å¤‡å¥½ï¼Œäºæ˜¯å°†æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œç³»ç»Ÿè°ƒç”¨è¿”å›ï¼› å¯ä»¥çœ‹åˆ°ï¼Œ CPU ä¸å†å‚ä¸ã€Œå°†æ•°æ®ä»ç£ç›˜æ§åˆ¶å™¨ç¼“å†²åŒºæ¬è¿åˆ°å†…æ ¸ç©ºé—´ã€çš„å·¥ä½œï¼Œè¿™éƒ¨åˆ†å·¥ä½œå…¨ç¨‹ç”± DMA å®Œæˆã€‚ä½†æ˜¯ CPU åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå› ä¸ºä¼ è¾“ä»€ä¹ˆæ•°æ®ï¼Œä»å“ªé‡Œä¼ è¾“åˆ°å“ªé‡Œï¼Œéƒ½éœ€è¦ CPU æ¥å‘Šè¯‰ DMA æ§åˆ¶å™¨ã€‚\næ—©æœŸ DMA åªå­˜åœ¨åœ¨ä¸»æ¿ä¸Šï¼Œå¦‚ä»Šç”±äº I/O è®¾å¤‡è¶Šæ¥è¶Šå¤šï¼Œæ•°æ®ä¼ è¾“çš„éœ€æ±‚ä¹Ÿä¸å°½ç›¸åŒï¼Œæ‰€ä»¥æ¯ä¸ª I/O è®¾å¤‡é‡Œé¢éƒ½æœ‰è‡ªå·±çš„ DMA æ§åˆ¶å™¨ã€‚\nä¼ ç»Ÿçš„æ–‡ä»¶ä¼ è¾“æœ‰å¤šç³Ÿç³•ï¼Ÿ å¦‚æœæœåŠ¡ç«¯è¦æä¾›æ–‡ä»¶ä¼ è¾“çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬èƒ½æƒ³åˆ°çš„æœ€ç®€å•çš„æ–¹å¼æ˜¯ï¼šå°†ç£ç›˜ä¸Šçš„æ–‡ä»¶è¯»å–å‡ºæ¥ï¼Œç„¶åé€šè¿‡ç½‘ç»œåè®®å‘é€ç»™å®¢æˆ·ç«¯ã€‚\nä¼ ç»Ÿ I/O çš„å·¥ä½œæ–¹å¼æ˜¯ï¼Œæ•°æ®è¯»å–å’Œå†™å…¥æ˜¯ä»ç”¨æˆ·ç©ºé—´åˆ°å†…æ ¸ç©ºé—´æ¥å›å¤åˆ¶ï¼Œè€Œå†…æ ¸ç©ºé—´çš„æ•°æ®æ˜¯é€šè¿‡æ“ä½œç³»ç»Ÿå±‚é¢çš„ I/O æ¥å£ä»ç£ç›˜è¯»å–æˆ–å†™å…¥ã€‚\nä»£ç é€šå¸¸å¦‚ä¸‹ï¼Œä¸€èˆ¬ä¼šéœ€è¦ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼š\n1 2 read(file, tmp_buf, len); write(socket, tmp_buf, len); ä»£ç å¾ˆç®€å•ï¼Œè™½ç„¶å°±ä¸¤è¡Œä»£ç ï¼Œä½†æ˜¯è¿™é‡Œé¢å‘ç”Ÿäº†ä¸å°‘çš„äº‹æƒ…ã€‚ é¦–å…ˆï¼ŒæœŸé—´å…±å‘ç”Ÿäº† 4 æ¬¡ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå› ä¸ºå‘ç”Ÿäº†ä¸¤æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œä¸€æ¬¡æ˜¯ read() ï¼Œä¸€æ¬¡æ˜¯ write()ï¼Œæ¯æ¬¡ç³»ç»Ÿè°ƒç”¨éƒ½å¾—å…ˆä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œç­‰å†…æ ¸å®Œæˆä»»åŠ¡åï¼Œå†ä»å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€ã€‚\nä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°æˆæœ¬å¹¶ä¸å°ï¼Œä¸€æ¬¡åˆ‡æ¢éœ€è¦è€—æ—¶å‡ åçº³ç§’åˆ°å‡ å¾®ç§’ï¼Œè™½ç„¶æ—¶é—´çœ‹ä¸Šå»å¾ˆçŸ­ï¼Œä½†æ˜¯åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œè¿™ç±»æ—¶é—´å®¹æ˜“è¢«ç´¯ç§¯å’Œæ”¾å¤§ï¼Œä»è€Œå½±å“ç³»ç»Ÿçš„æ€§èƒ½ã€‚\nå…¶æ¬¡ï¼Œè¿˜å‘ç”Ÿäº† 4 æ¬¡æ•°æ®æ‹·è´ï¼Œå…¶ä¸­ä¸¤æ¬¡æ˜¯ DMA çš„æ‹·è´ï¼Œå¦å¤–ä¸¤æ¬¡åˆ™æ˜¯é€šè¿‡ CPU æ‹·è´çš„ï¼Œä¸‹é¢è¯´ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š\nç¬¬ä¸€æ¬¡æ‹·è´ï¼ŒæŠŠç£ç›˜ä¸Šçš„æ•°æ®æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºé‡Œï¼Œè¿™ä¸ªæ‹·è´çš„è¿‡ç¨‹æ˜¯é€šè¿‡ DMA æ¬è¿çš„ã€‚ ç¬¬äºŒæ¬¡æ‹·è´ï¼ŒæŠŠå†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ°ç”¨æˆ·çš„ç¼“å†²åŒºé‡Œï¼Œäºæ˜¯æˆ‘ä»¬åº”ç”¨ç¨‹åºå°±å¯ä»¥ä½¿ç”¨è¿™éƒ¨åˆ†æ•°æ®äº†ï¼Œè¿™ä¸ªæ‹·è´åˆ°è¿‡ç¨‹æ˜¯ç”± CPU å®Œæˆçš„ã€‚ ç¬¬ä¸‰æ¬¡æ‹·è´ï¼ŒæŠŠåˆšæ‰æ‹·è´åˆ°ç”¨æˆ·çš„ç¼“å†²åŒºé‡Œçš„æ•°æ®ï¼Œå†æ‹·è´åˆ°å†…æ ¸çš„ socket çš„ç¼“å†²åŒºé‡Œï¼Œè¿™ä¸ªè¿‡ç¨‹ä¾ç„¶è¿˜æ˜¯ç”± CPU æ¬è¿çš„ã€‚ ç¬¬å››æ¬¡æ‹·è´ï¼ŒæŠŠå†…æ ¸çš„ socket ç¼“å†²åŒºé‡Œçš„æ•°æ®ï¼Œæ‹·è´åˆ°ç½‘å¡çš„ç¼“å†²åŒºé‡Œï¼Œè¿™ä¸ªè¿‡ç¨‹åˆæ˜¯ç”± DMA æ¬è¿çš„ã€‚ æˆ‘ä»¬å›è¿‡å¤´çœ‹è¿™ä¸ªæ–‡ä»¶ä¼ è¾“çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬åªæ˜¯æ¬è¿ä¸€ä»½æ•°æ®ï¼Œç»“æœå´æ¬è¿äº† 4 æ¬¡ï¼Œè¿‡å¤šçš„æ•°æ®æ‹·è´æ— ç–‘ä¼šæ¶ˆè€— CPU èµ„æºï¼Œå¤§å¤§é™ä½äº†ç³»ç»Ÿæ€§èƒ½ã€‚\nè¿™ç§ç®€å•åˆä¼ ç»Ÿçš„æ–‡ä»¶ä¼ è¾“æ–¹å¼ï¼Œå­˜åœ¨å†—ä½™çš„ä¸Šæ–‡åˆ‡æ¢å’Œæ•°æ®æ‹·è´ï¼Œåœ¨é«˜å¹¶å‘ç³»ç»Ÿé‡Œæ˜¯éå¸¸ç³Ÿç³•çš„ï¼Œå¤šäº†å¾ˆå¤šä¸å¿…è¦çš„å¼€é”€ï¼Œä¼šä¸¥é‡å½±å“ç³»ç»Ÿæ€§èƒ½ã€‚\næ‰€ä»¥ï¼Œè¦æƒ³æé«˜æ–‡ä»¶ä¼ è¾“çš„æ€§èƒ½ï¼Œå°±éœ€è¦å‡å°‘ã€Œç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€å’Œã€Œå†…å­˜æ‹·è´ã€çš„æ¬¡æ•°ã€‚\nå¦‚ä½•ä¼˜åŒ–æ–‡ä»¶ä¼ è¾“çš„æ€§èƒ½ï¼Ÿ å¦‚ä½•å‡å°‘ã€Œç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€çš„æ¬¡æ•°å‘¢ï¼Ÿ è¯»å–ç£ç›˜æ•°æ®çš„æ—¶å€™ï¼Œä¹‹æ‰€ä»¥è¦å‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿™æ˜¯å› ä¸ºç”¨æˆ·ç©ºé—´æ²¡æœ‰æƒé™æ“ä½œç£ç›˜æˆ–ç½‘å¡ï¼Œå†…æ ¸çš„æƒé™æœ€é«˜ï¼Œè¿™äº›æ“ä½œè®¾å¤‡çš„è¿‡ç¨‹éƒ½éœ€è¦äº¤ç”±æ“ä½œç³»ç»Ÿå†…æ ¸æ¥å®Œæˆï¼Œæ‰€ä»¥ä¸€èˆ¬è¦é€šè¿‡å†…æ ¸å»å®ŒæˆæŸäº›ä»»åŠ¡çš„æ—¶å€™ï¼Œå°±éœ€è¦ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚\nè€Œä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨å¿…ç„¶ä¼šå‘ç”Ÿ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šé¦–å…ˆä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œå½“å†…æ ¸æ‰§è¡Œå®Œä»»åŠ¡åï¼Œå†åˆ‡æ¢å›ç”¨æˆ·æ€äº¤ç”±è¿›ç¨‹ä»£ç æ‰§è¡Œã€‚\næ‰€ä»¥ï¼Œè¦æƒ³å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°æ¬¡æ•°ï¼Œå°±è¦å‡å°‘ç³»ç»Ÿè°ƒç”¨çš„æ¬¡æ•°ã€‚\nå¦‚ä½•å‡å°‘ã€Œæ•°æ®æ‹·è´ã€çš„æ¬¡æ•° åœ¨å‰é¢æˆ‘ä»¬çŸ¥é“äº†ï¼Œä¼ ç»Ÿçš„æ–‡ä»¶ä¼ è¾“æ–¹å¼ä¼šå†ç» 4 æ¬¡æ•°æ®æ‹·è´ï¼Œè€Œä¸”è¿™é‡Œé¢ï¼Œã€Œä»å†…æ ¸çš„è¯»ç¼“å†²åŒºæ‹·è´åˆ°ç”¨æˆ·çš„ç¼“å†²åŒºé‡Œï¼Œå†ä»ç”¨æˆ·çš„ç¼“å†²åŒºé‡Œæ‹·è´åˆ° socket çš„ç¼“å†²åŒºé‡Œã€ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚\nå› ä¸ºæ–‡ä»¶ä¼ è¾“çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œåœ¨ç”¨æˆ·ç©ºé—´æˆ‘ä»¬å¹¶ä¸ä¼šå¯¹æ•°æ®ã€Œå†åŠ å·¥ã€ï¼Œæ‰€ä»¥æ•°æ®å®é™…ä¸Šå¯ä»¥ä¸ç”¨æ¬è¿åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå› æ­¤ç”¨æˆ·çš„ç¼“å†²åŒºæ˜¯æ²¡æœ‰å¿…è¦å­˜åœ¨çš„ã€‚\nå¦‚ä½•å®ç°é›¶æ‹·è´ï¼Ÿ é›¶æ‹·è´æŠ€æœ¯å®ç°çš„æ–¹å¼é€šå¸¸æœ‰ 2 ç§ï¼š\nmmap + write sendfile ä¸‹é¢å°±è°ˆä¸€è°ˆï¼Œå®ƒä»¬æ˜¯å¦‚ä½•å‡å°‘ã€Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€å’Œã€Œæ•°æ®æ‹·è´ã€çš„æ¬¡æ•°ã€‚ mmap + write åœ¨å‰é¢æˆ‘ä»¬çŸ¥é“ï¼Œread() ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹ä¸­ä¼šæŠŠå†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ°ç”¨æˆ·çš„ç¼“å†²åŒºé‡Œï¼Œäºæ˜¯ä¸ºäº†å‡å°‘è¿™ä¸€æ­¥å¼€é”€ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ mmap() æ›¿æ¢ read() ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚\n1 2 buf = mmap(file, len); write(sockfd, buf, len); mmap() ç³»ç»Ÿè°ƒç”¨å‡½æ•°ä¼šç›´æ¥æŠŠå†…æ ¸ç¼“å†²åŒºé‡Œçš„æ•°æ®ã€Œæ˜ å°„ã€åˆ°ç”¨æˆ·ç©ºé—´ï¼Œè¿™æ ·ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸ä¸ç”¨æˆ·ç©ºé—´å°±ä¸éœ€è¦å†è¿›è¡Œä»»ä½•çš„æ•°æ®æ‹·è´æ“ä½œã€‚ å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š\nåº”ç”¨è¿›ç¨‹è°ƒç”¨äº† mmap() åï¼ŒDMA ä¼šæŠŠç£ç›˜çš„æ•°æ®æ‹·è´åˆ°å†…æ ¸çš„ç¼“å†²åŒºé‡Œã€‚æ¥ç€ï¼Œåº”ç”¨è¿›ç¨‹è·Ÿæ“ä½œç³»ç»Ÿå†…æ ¸ã€Œå…±äº«ã€è¿™ä¸ªç¼“å†²åŒºï¼› åº”ç”¨è¿›ç¨‹å†è°ƒç”¨ write()ï¼Œæ“ä½œç³»ç»Ÿç›´æ¥å°†å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ° socket ç¼“å†²åŒºä¸­ï¼Œè¿™ä¸€åˆ‡éƒ½å‘ç”Ÿåœ¨å†…æ ¸æ€ï¼Œç”± CPU æ¥æ¬è¿æ•°æ®ï¼› æœ€åï¼ŒæŠŠå†…æ ¸çš„ socket ç¼“å†²åŒºé‡Œçš„æ•°æ®ï¼Œæ‹·è´åˆ°ç½‘å¡çš„ç¼“å†²åŒºé‡Œï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ç”± DMA æ¬è¿çš„ã€‚ æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œé€šè¿‡ä½¿ç”¨ mmap() æ¥ä»£æ›¿ read()ï¼Œ å¯ä»¥å‡å°‘ä¸€æ¬¡æ•°æ®æ‹·è´çš„è¿‡ç¨‹ã€‚\nä½†è¿™è¿˜ä¸æ˜¯æœ€ç†æƒ³çš„é›¶æ‹·è´ï¼Œå› ä¸ºä»ç„¶éœ€è¦é€šè¿‡ CPU æŠŠå†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ° socket ç¼“å†²åŒºé‡Œï¼Œè€Œä¸”ä»ç„¶éœ€è¦ 4 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå› ä¸ºç³»ç»Ÿè°ƒç”¨è¿˜æ˜¯ 2 æ¬¡ã€‚\nsendfile åœ¨ Linux å†…æ ¸ç‰ˆæœ¬ 2.1 ä¸­ï¼Œæä¾›äº†ä¸€ä¸ªä¸“é—¨å‘é€æ–‡ä»¶çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•° sendfile()ï¼Œå‡½æ•°å½¢å¼å¦‚ä¸‹ï¼š\n1 2 #include \u0026lt;sys/socket.h\u0026gt; ssize_t sendfile(int out_fd, int in_fd, off_t *offset, size_t count); å®ƒçš„å‰ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ç›®çš„ç«¯å’Œæºç«¯çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œåé¢ä¸¤ä¸ªå‚æ•°æ˜¯æºç«¯çš„åç§»é‡å’Œå¤åˆ¶æ•°æ®çš„é•¿åº¦ï¼Œè¿”å›å€¼æ˜¯å®é™…å¤åˆ¶æ•°æ®çš„é•¿åº¦ã€‚\né¦–å…ˆï¼Œå®ƒå¯ä»¥æ›¿ä»£å‰é¢çš„ read() å’Œ write() è¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œä¹Ÿå°±å‡å°‘äº† 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚\nå…¶æ¬¡ï¼Œè¯¥ç³»ç»Ÿè°ƒç”¨ï¼Œå¯ä»¥ç›´æ¥æŠŠå†…æ ¸ç¼“å†²åŒºé‡Œçš„æ•°æ®æ‹·è´åˆ° socket ç¼“å†²åŒºé‡Œï¼Œä¸å†æ‹·è´åˆ°ç”¨æˆ·æ€ï¼Œè¿™æ ·å°±åªæœ‰ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå’Œ 3 æ¬¡æ•°æ®æ‹·è´ã€‚å¦‚ä¸‹å›¾ï¼š ä½†æ˜¯è¿™è¿˜ä¸æ˜¯çœŸæ­£çš„é›¶æ‹·è´æŠ€æœ¯ï¼Œå¦‚æœç½‘å¡æ”¯æŒ SG-DMAï¼ˆThe Scatter-Gather Direct Memory Accessï¼‰æŠ€æœ¯ï¼ˆå’Œæ™®é€šçš„ DMA æœ‰æ‰€ä¸åŒï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥å‡å°‘é€šè¿‡ CPU æŠŠå†…æ ¸ç¼“å†²åŒºé‡Œçš„æ•°æ®æ‹·è´åˆ° socket ç¼“å†²åŒºçš„è¿‡ç¨‹ã€‚\nä½ å¯ä»¥åœ¨ä½ çš„ Linux ç³»ç»Ÿé€šè¿‡ä¸‹é¢è¿™ä¸ªå‘½ä»¤ï¼ŒæŸ¥çœ‹ç½‘å¡æ˜¯å¦æ”¯æŒ scatter-gather ç‰¹æ€§ï¼š\n1 2 $ ethtool -k eth0 | grep scatter-gather scatter-gather: on äºæ˜¯ï¼Œä» Linux å†…æ ¸ 2.4 ç‰ˆæœ¬å¼€å§‹èµ·ï¼Œå¯¹äºæ”¯æŒç½‘å¡æ”¯æŒ SG-DMA æŠ€æœ¯çš„æƒ…å†µä¸‹ï¼Œ sendfile() ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹å‘ç”Ÿäº†ç‚¹å˜åŒ–ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š\nç¬¬ä¸€æ­¥ï¼Œé€šè¿‡ DMA å°†ç£ç›˜ä¸Šçš„æ•°æ®æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºé‡Œï¼› ç¬¬äºŒæ­¥ï¼Œç¼“å†²åŒºæè¿°ç¬¦å’Œæ•°æ®é•¿åº¦ä¼ åˆ° socket ç¼“å†²åŒºï¼Œè¿™æ ·ç½‘å¡çš„ SG-DMA æ§åˆ¶å™¨å°±å¯ä»¥ç›´æ¥å°†å†…æ ¸ç¼“å­˜ä¸­çš„æ•°æ®æ‹·è´åˆ°ç½‘å¡çš„ç¼“å†²åŒºé‡Œï¼Œæ­¤è¿‡ç¨‹ä¸éœ€è¦å°†æ•°æ®ä»æ“ä½œç³»ç»Ÿå†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ° socket ç¼“å†²åŒºä¸­ï¼Œè¿™æ ·å°±å‡å°‘äº†ä¸€æ¬¡æ•°æ®æ‹·è´ï¼› æ‰€ä»¥ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹‹ä¸­ï¼Œåªè¿›è¡Œäº† 2 æ¬¡æ•°æ®æ‹·è´ï¼Œå¦‚ä¸‹å›¾ï¼š è¿™å°±æ˜¯æ‰€è°“çš„é›¶æ‹·è´ï¼ˆZero-copyï¼‰æŠ€æœ¯ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰åœ¨å†…å­˜å±‚é¢å»æ‹·è´æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´å…¨ç¨‹æ²¡æœ‰é€šè¿‡ CPU æ¥æ¬è¿æ•°æ®ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯é€šè¿‡ DMA æ¥è¿›è¡Œä¼ è¾“çš„ã€‚\né›¶æ‹·è´æŠ€æœ¯çš„æ–‡ä»¶ä¼ è¾“æ–¹å¼ç›¸æ¯”ä¼ ç»Ÿæ–‡ä»¶ä¼ è¾“çš„æ–¹å¼ï¼Œå‡å°‘äº† 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ•°æ®æ‹·è´æ¬¡æ•°ï¼Œåªéœ€è¦ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ•°æ®æ‹·è´æ¬¡æ•°ï¼Œå°±å¯ä»¥å®Œæˆæ–‡ä»¶çš„ä¼ è¾“ï¼Œè€Œä¸” 2 æ¬¡çš„æ•°æ®æ‹·è´è¿‡ç¨‹ï¼Œéƒ½ä¸éœ€è¦é€šè¿‡ CPUï¼Œ2 æ¬¡éƒ½æ˜¯ç”± DMA æ¥æ¬è¿ã€‚\næ‰€ä»¥ï¼Œæ€»ä½“æ¥çœ‹ï¼Œé›¶æ‹·è´æŠ€æœ¯å¯ä»¥æŠŠæ–‡ä»¶ä¼ è¾“çš„æ€§èƒ½æé«˜è‡³å°‘ä¸€å€ä»¥ä¸Šã€‚\nä½¿ç”¨é›¶æ‹·è´æŠ€æœ¯çš„é¡¹ç›® äº‹å®ä¸Šï¼ŒKafka è¿™ä¸ªå¼€æºé¡¹ç›®ï¼Œå°±åˆ©ç”¨äº†ã€Œé›¶æ‹·è´ã€æŠ€æœ¯ï¼Œä»è€Œå¤§å¹…æå‡äº† I/O çš„ååç‡ï¼Œè¿™ä¹Ÿæ˜¯ Kafka åœ¨å¤„ç†æµ·é‡æ•°æ®ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«çš„åŸå› ä¹‹ä¸€ã€‚\nå¦‚æœä½ è¿½æº¯ Kafka æ–‡ä»¶ä¼ è¾“çš„ä»£ç ï¼Œä½ ä¼šå‘ç°ï¼Œæœ€ç»ˆå®ƒè°ƒç”¨äº† Java NIO åº“é‡Œçš„ transferTo æ–¹æ³•ï¼š\n1 2 3 4 @Overridepublic long transferFrom(FileChannel fileChannel, long position, long count) throws IOException { return fileChannel.transferTo(position, count, socketChannel); } å¦‚æœ Linux ç³»ç»Ÿæ”¯æŒ sendfile() ç³»ç»Ÿè°ƒç”¨ï¼Œé‚£ä¹ˆ transferTo() å®é™…ä¸Šæœ€åå°±ä¼šä½¿ç”¨åˆ° sendfile() ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚\næ›¾ç»æœ‰å¤§ä½¬ä¸“é—¨å†™è¿‡ç¨‹åºæµ‹è¯•è¿‡ï¼Œåœ¨åŒæ ·çš„ç¡¬ä»¶æ¡ä»¶ä¸‹ï¼Œä¼ ç»Ÿæ–‡ä»¶ä¼ è¾“å’Œé›¶æ‹·æ‹·è´æ–‡ä»¶ä¼ è¾“çš„æ€§èƒ½å·®å¼‚ï¼Œä½ å¯ä»¥çœ‹åˆ°ä¸‹é¢è¿™å¼ æµ‹è¯•æ•°æ®å›¾ï¼Œä½¿ç”¨äº†é›¶æ‹·è´èƒ½å¤Ÿç¼©çŸ­ 65% çš„æ—¶é—´ï¼Œå¤§å¹…åº¦æå‡äº†æœºå™¨ä¼ è¾“æ•°æ®çš„ååé‡ã€‚\nå¦å¤–ï¼ŒNginx ä¹Ÿæ”¯æŒé›¶æ‹·è´æŠ€æœ¯ï¼Œä¸€èˆ¬é»˜è®¤æ˜¯å¼€å¯é›¶æ‹·è´æŠ€æœ¯ï¼Œè¿™æ ·æœ‰åˆ©äºæé«˜æ–‡ä»¶ä¼ è¾“çš„æ•ˆç‡ï¼Œæ˜¯å¦å¼€å¯é›¶æ‹·è´æŠ€æœ¯çš„é…ç½®å¦‚ä¸‹ï¼š\n1 2 3 4 5 http { ... sendfile on ... } sendfile é…ç½®çš„å…·ä½“æ„æ€:\nè®¾ç½®ä¸º on è¡¨ç¤ºï¼Œä½¿ç”¨é›¶æ‹·è´æŠ€æœ¯æ¥ä¼ è¾“æ–‡ä»¶ï¼šsendfile ï¼Œè¿™æ ·åªéœ€è¦ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå’Œ 2 æ¬¡æ•°æ®æ‹·è´ã€‚ è®¾ç½®ä¸º off è¡¨ç¤ºï¼Œä½¿ç”¨ä¼ ç»Ÿçš„æ–‡ä»¶ä¼ è¾“æŠ€æœ¯ï¼šread + writeï¼Œè¿™æ—¶å°±éœ€è¦ 4 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå’Œ 4 æ¬¡æ•°æ®æ‹·è´ã€‚ å½“ç„¶ï¼Œè¦ä½¿ç”¨ sendfileï¼ŒLinux å†…æ ¸ç‰ˆæœ¬å¿…é¡»è¦ 2.1 ä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚ PageCache æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ å›é¡¾å‰é¢è¯´é“æ–‡ä»¶ä¼ è¾“è¿‡ç¨‹ï¼Œå…¶ä¸­ç¬¬ä¸€æ­¥éƒ½æ˜¯å…ˆéœ€è¦å…ˆæŠŠç£ç›˜æ–‡ä»¶æ•°æ®æ‹·è´ã€Œå†…æ ¸ç¼“å†²åŒºã€é‡Œï¼Œè¿™ä¸ªã€Œå†…æ ¸ç¼“å†²åŒºã€å®é™…ä¸Šæ˜¯ç£ç›˜é«˜é€Ÿç¼“å­˜ï¼ˆPageCacheï¼‰ã€‚\nç”±äºé›¶æ‹·è´ä½¿ç”¨äº† PageCache æŠ€æœ¯ï¼Œå¯ä»¥ä½¿å¾—é›¶æ‹·è´è¿›ä¸€æ­¥æå‡äº†æ€§èƒ½ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹ PageCache æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹çš„ã€‚\nè¯»å†™ç£ç›˜ç›¸æ¯”è¯»å†™å†…å­˜çš„é€Ÿåº¦æ…¢å¤ªå¤šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥æƒ³åŠæ³•æŠŠã€Œè¯»å†™ç£ç›˜ã€æ›¿æ¢æˆã€Œè¯»å†™å†…å­˜ã€ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ DMA æŠŠç£ç›˜é‡Œçš„æ•°æ®æ¬è¿åˆ°å†…å­˜é‡Œï¼Œè¿™æ ·å°±å¯ä»¥ç”¨è¯»å†…å­˜æ›¿æ¢è¯»ç£ç›˜ã€‚\nä½†æ˜¯ï¼Œå†…å­˜ç©ºé—´è¿œæ¯”ç£ç›˜è¦å°ï¼Œå†…å­˜æ³¨å®šåªèƒ½æ‹·è´ç£ç›˜é‡Œçš„ä¸€å°éƒ¨åˆ†æ•°æ®ã€‚\né‚£é—®é¢˜æ¥äº†ï¼Œé€‰æ‹©å“ªäº›ç£ç›˜æ•°æ®æ‹·è´åˆ°å†…å­˜å‘¢ï¼Ÿ\næˆ‘ä»¬éƒ½çŸ¥é“ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œå…·æœ‰ã€Œå±€éƒ¨æ€§ã€ï¼Œæ‰€ä»¥é€šå¸¸ï¼Œåˆšè¢«è®¿é—®çš„æ•°æ®åœ¨çŸ­æ—¶é—´å†…å†æ¬¡è¢«è®¿é—®çš„æ¦‚ç‡å¾ˆé«˜ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥ç”¨ PageCache æ¥ç¼“å­˜æœ€è¿‘è¢«è®¿é—®çš„æ•°æ®ï¼Œå½“ç©ºé—´ä¸è¶³æ—¶æ·˜æ±°æœ€ä¹…æœªè¢«è®¿é—®çš„ç¼“å­˜ã€‚\næ‰€ä»¥ï¼Œè¯»ç£ç›˜æ•°æ®çš„æ—¶å€™ï¼Œä¼˜å…ˆåœ¨ PageCache æ‰¾ï¼Œå¦‚æœæ•°æ®å­˜åœ¨åˆ™å¯ä»¥ç›´æ¥è¿”å›ï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä»ç£ç›˜ä¸­è¯»å–ï¼Œç„¶åç¼“å­˜ PageCache ä¸­ã€‚\nè¿˜æœ‰ä¸€ç‚¹ï¼Œè¯»å–ç£ç›˜æ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦æ‰¾åˆ°æ•°æ®æ‰€åœ¨çš„ä½ç½®ï¼Œä½†æ˜¯å¯¹äºæœºæ¢°ç£ç›˜æ¥è¯´ï¼Œå°±æ˜¯é€šè¿‡ç£å¤´æ—‹è½¬åˆ°æ•°æ®æ‰€åœ¨çš„æ‰‡åŒºï¼Œå†å¼€å§‹ã€Œé¡ºåºã€è¯»å–æ•°æ®ï¼Œä½†æ˜¯æ—‹è½¬ç£å¤´è¿™ä¸ªç‰©ç†åŠ¨ä½œæ˜¯éå¸¸è€—æ—¶çš„ï¼Œä¸ºäº†é™ä½å®ƒçš„å½±å“ï¼ŒPageCache ä½¿ç”¨äº†ã€Œé¢„è¯»åŠŸèƒ½ã€ã€‚\næ¯”å¦‚ï¼Œå‡è®¾ read æ–¹æ³•æ¯æ¬¡åªä¼šè¯» 32 KB çš„å­—èŠ‚ï¼Œè™½ç„¶ read åˆšå¼€å§‹åªä¼šè¯» 0 ï½ 32 KB çš„å­—èŠ‚ï¼Œä½†å†…æ ¸ä¼šæŠŠå…¶åé¢çš„ 32ï½64 KB ä¹Ÿè¯»å–åˆ° PageCacheï¼Œè¿™æ ·åé¢è¯»å– 32ï½64 KB çš„æˆæœ¬å°±å¾ˆä½ï¼Œå¦‚æœåœ¨ 32ï½64 KB æ·˜æ±°å‡º PageCache å‰ï¼Œè¿›ç¨‹è¯»å–åˆ°å®ƒäº†ï¼Œæ”¶ç›Šå°±éå¸¸å¤§ã€‚\næ‰€ä»¥ï¼ŒPageCache çš„ä¼˜ç‚¹ä¸»è¦æ˜¯ä¸¤ä¸ªï¼š\nç¼“å­˜æœ€è¿‘è¢«è®¿é—®çš„æ•°æ®ï¼› é¢„è¯»åŠŸèƒ½ï¼› è¿™ä¸¤ä¸ªåšæ³•ï¼Œå°†å¤§å¤§æé«˜è¯»å†™ç£ç›˜çš„æ€§èƒ½ã€‚\nä½†æ˜¯ï¼Œåœ¨ä¼ è¾“å¤§æ–‡ä»¶ï¼ˆGB çº§åˆ«çš„æ–‡ä»¶ï¼‰çš„æ—¶å€™ï¼ŒPageCache ä¼šä¸èµ·ä½œç”¨ï¼Œé‚£å°±ç™½ç™½æµªè´¹ DMA å¤šåšçš„ä¸€æ¬¡æ•°æ®æ‹·è´ï¼Œé€ æˆæ€§èƒ½çš„é™ä½ï¼Œå³ä½¿ä½¿ç”¨äº† PageCache çš„é›¶æ‹·è´ä¹Ÿä¼šæŸå¤±æ€§èƒ½\nè¿™æ˜¯å› ä¸ºå¦‚æœä½ æœ‰å¾ˆå¤š GB çº§åˆ«æ–‡ä»¶éœ€è¦ä¼ è¾“ï¼Œæ¯å½“ç”¨æˆ·è®¿é—®è¿™äº›å¤§æ–‡ä»¶çš„æ—¶å€™ï¼Œå†…æ ¸å°±ä¼šæŠŠå®ƒä»¬è½½å…¥ PageCache ä¸­ï¼Œäºæ˜¯ PageCache ç©ºé—´å¾ˆå¿«è¢«è¿™äº›å¤§æ–‡ä»¶å æ»¡ã€‚\nå¦å¤–ï¼Œç”±äºæ–‡ä»¶å¤ªå¤§ï¼Œå¯èƒ½æŸäº›éƒ¨åˆ†çš„æ–‡ä»¶æ•°æ®è¢«å†æ¬¡è®¿é—®çš„æ¦‚ç‡æ¯”è¾ƒä½ï¼Œè¿™æ ·å°±ä¼šå¸¦æ¥ 2 ä¸ªé—®é¢˜ï¼š\nPageCache ç”±äºé•¿æ—¶é—´è¢«å¤§æ–‡ä»¶å æ®ï¼Œå…¶ä»–ã€Œçƒ­ç‚¹ã€çš„å°æ–‡ä»¶å¯èƒ½å°±æ— æ³•å……åˆ†ä½¿ç”¨åˆ° PageCacheï¼Œäºæ˜¯è¿™æ ·ç£ç›˜è¯»å†™çš„æ€§èƒ½å°±ä¼šä¸‹é™äº†ï¼› PageCache ä¸­çš„å¤§æ–‡ä»¶æ•°æ®ï¼Œç”±äºæ²¡æœ‰äº«å—åˆ°ç¼“å­˜å¸¦æ¥çš„å¥½å¤„ï¼Œä½†å´è€—è´¹ DMA å¤šæ‹·è´åˆ° PageCache ä¸€æ¬¡ï¼› æ‰€ä»¥ï¼Œé’ˆå¯¹å¤§æ–‡ä»¶çš„ä¼ è¾“ï¼Œä¸åº”è¯¥ä½¿ç”¨ PageCacheï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åº”è¯¥ä½¿ç”¨é›¶æ‹·è´æŠ€æœ¯ï¼Œå› ä¸ºå¯èƒ½ç”±äº PageCache è¢«å¤§æ–‡ä»¶å æ®ï¼Œè€Œå¯¼è‡´ã€Œçƒ­ç‚¹ã€å°æ–‡ä»¶æ— æ³•åˆ©ç”¨åˆ° PageCacheï¼Œè¿™æ ·åœ¨é«˜å¹¶å‘çš„ç¯å¢ƒä¸‹ï¼Œä¼šå¸¦æ¥ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚\nå¤§æ–‡ä»¶ä¼ è¾“ç”¨ä»€ä¹ˆæ–¹å¼å®ç°ï¼Ÿ é‚£é’ˆå¯¹å¤§æ–‡ä»¶çš„ä¼ è¾“ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ä»€ä¹ˆæ–¹å¼å‘¢ï¼Ÿ\næˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æœ€åˆçš„ä¾‹å­ï¼Œå½“è°ƒç”¨ read æ–¹æ³•è¯»å–æ–‡ä»¶æ—¶ï¼Œè¿›ç¨‹å®é™…ä¸Šä¼šé˜»å¡åœ¨ read æ–¹æ³•è°ƒç”¨ï¼Œå› ä¸ºè¦ç­‰å¾…ç£ç›˜æ•°æ®çš„è¿”å›ï¼Œå¦‚ä¸‹å›¾ï¼š å…·ä½“è¿‡ç¨‹ï¼š\nå½“è°ƒç”¨ read æ–¹æ³•æ—¶ï¼Œä¼šé˜»å¡ç€ï¼Œæ­¤æ—¶å†…æ ¸ä¼šå‘ç£ç›˜å‘èµ· I/O è¯·æ±‚ï¼Œç£ç›˜æ”¶åˆ°è¯·æ±‚åï¼Œä¾¿ä¼šå¯»å€ï¼Œå½“ç£ç›˜æ•°æ®å‡†å¤‡å¥½åï¼Œå°±ä¼šå‘å†…æ ¸å‘èµ· I/O ä¸­æ–­ï¼Œå‘ŠçŸ¥å†…æ ¸ç£ç›˜æ•°æ®å·²ç»å‡†å¤‡å¥½ï¼› å†…æ ¸æ”¶åˆ° I/O ä¸­æ–­åï¼Œå°±å°†æ•°æ®ä»ç£ç›˜æ§åˆ¶å™¨ç¼“å†²åŒºæ‹·è´åˆ° PageCache é‡Œï¼› æœ€åï¼Œå†…æ ¸å†æŠŠ PageCache ä¸­çš„æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒºï¼Œäºæ˜¯ read è°ƒç”¨å°±æ­£å¸¸è¿”å›äº†ã€‚\nå¯¹äºé˜»å¡çš„é—®é¢˜ï¼Œå¯ä»¥ç”¨å¼‚æ­¥ I/O æ¥è§£å†³ï¼Œå®ƒå·¥ä½œæ–¹å¼å¦‚ä¸‹å›¾ï¼š å®ƒæŠŠè¯»æ“ä½œåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š\nå‰åŠéƒ¨åˆ†ï¼Œå†…æ ¸å‘ç£ç›˜å‘èµ·è¯»è¯·æ±‚ï¼Œä½†æ˜¯å¯ä»¥ä¸ç­‰å¾…æ•°æ®å°±ä½å°±å¯ä»¥è¿”å›ï¼Œäºæ˜¯è¿›ç¨‹æ­¤æ—¶å¯ä»¥å¤„ç†å…¶ä»–ä»»åŠ¡ï¼› ååŠéƒ¨åˆ†ï¼Œå½“å†…æ ¸å°†ç£ç›˜ä¸­çš„æ•°æ®æ‹·è´åˆ°è¿›ç¨‹ç¼“å†²åŒºåï¼Œè¿›ç¨‹å°†æ¥æ”¶åˆ°å†…æ ¸çš„é€šçŸ¥ï¼Œå†å»å¤„ç†æ•°æ®ï¼› è€Œä¸”ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå¼‚æ­¥ I/O å¹¶æ²¡æœ‰æ¶‰åŠåˆ° PageCacheï¼Œæ‰€ä»¥ä½¿ç”¨å¼‚æ­¥ I/O å°±æ„å‘³ç€è¦ç»•å¼€ PageCacheã€‚ ç»•å¼€ PageCache çš„ I/O å«ç›´æ¥ I/Oï¼Œä½¿ç”¨ PageCache çš„ I/O åˆ™å«ç¼“å­˜ I/Oã€‚é€šå¸¸ï¼Œå¯¹äºç£ç›˜ï¼Œå¼‚æ­¥ I/O åªæ”¯æŒç›´æ¥ I/Oã€‚\nå‰é¢ä¹Ÿæåˆ°ï¼Œå¤§æ–‡ä»¶çš„ä¼ è¾“ä¸åº”è¯¥ä½¿ç”¨ PageCacheï¼Œå› ä¸ºå¯èƒ½ç”±äº PageCache è¢«å¤§æ–‡ä»¶å æ®ï¼Œè€Œå¯¼è‡´ã€Œçƒ­ç‚¹ã€å°æ–‡ä»¶æ— æ³•åˆ©ç”¨åˆ° PageCacheã€‚\näºæ˜¯ï¼Œåœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œé’ˆå¯¹å¤§æ–‡ä»¶çš„ä¼ è¾“çš„æ–¹å¼ï¼Œåº”è¯¥ä½¿ç”¨ã€Œå¼‚æ­¥ I/O + ç›´æ¥ I/Oã€æ¥æ›¿ä»£é›¶æ‹·è´æŠ€æœ¯ã€‚\nç›´æ¥ I/O åº”ç”¨åœºæ™¯å¸¸è§çš„ä¸¤ç§ï¼š\nåº”ç”¨ç¨‹åºå·²ç»å®ç°äº†ç£ç›˜æ•°æ®çš„ç¼“å­˜ï¼Œé‚£ä¹ˆå¯ä»¥ä¸éœ€è¦ PageCache å†æ¬¡ç¼“å­˜ï¼Œå‡å°‘é¢å¤–çš„æ€§èƒ½æŸè€—ã€‚åœ¨ MySQL æ•°æ®åº“ä¸­ï¼Œå¯ä»¥é€šè¿‡å‚æ•°è®¾ç½®å¼€å¯ç›´æ¥ I/Oï¼Œé»˜è®¤æ˜¯ä¸å¼€å¯ï¼› ä¼ è¾“å¤§æ–‡ä»¶çš„æ—¶å€™ï¼Œç”±äºå¤§æ–‡ä»¶éš¾ä»¥å‘½ä¸­ PageCache ç¼“å­˜ï¼Œè€Œä¸”ä¼šå æ»¡ PageCache å¯¼è‡´ã€Œçƒ­ç‚¹ã€æ–‡ä»¶æ— æ³•å……åˆ†åˆ©ç”¨ç¼“å­˜ï¼Œä»è€Œå¢å¤§äº†æ€§èƒ½å¼€é”€ï¼Œå› æ­¤ï¼Œè¿™æ—¶åº”è¯¥ä½¿ç”¨ç›´æ¥ I/Oã€‚ å¦å¤–ï¼Œç”±äºç›´æ¥ I/O ç»•è¿‡äº† PageCacheï¼Œå°±æ— æ³•äº«å—å†…æ ¸çš„è¿™ä¸¤ç‚¹çš„ä¼˜åŒ–ï¼š\nå†…æ ¸çš„ I/O è°ƒåº¦ç®—æ³•ä¼šç¼“å­˜å°½å¯èƒ½å¤šçš„ I/O è¯·æ±‚åœ¨ PageCache ä¸­ï¼Œæœ€åã€Œåˆå¹¶ã€æˆä¸€ä¸ªæ›´å¤§çš„ I/O è¯·æ±‚å†å‘ç»™ç£ç›˜ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†å‡å°‘ç£ç›˜çš„å¯»å€æ“ä½œï¼› å†…æ ¸ä¹Ÿä¼šã€Œé¢„è¯»ã€åç»­çš„ I/O è¯·æ±‚æ”¾åœ¨ PageCache ä¸­ï¼Œä¸€æ ·æ˜¯ä¸ºäº†å‡å°‘å¯¹ç£ç›˜çš„æ“ä½œï¼› äºæ˜¯ï¼Œä¼ è¾“å¤§æ–‡ä»¶çš„æ—¶å€™ï¼Œä½¿ç”¨ã€Œå¼‚æ­¥ I/O + ç›´æ¥ I/Oã€äº†ï¼Œå°±å¯ä»¥æ— é˜»å¡åœ°è¯»å–æ–‡ä»¶äº†ã€‚\næ‰€ä»¥ï¼Œä¼ è¾“æ–‡ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦æ ¹æ®æ–‡ä»¶çš„å¤§å°æ¥ä½¿ç”¨ä¸åŒçš„æ–¹å¼ï¼š\nä¼ è¾“å¤§æ–‡ä»¶çš„æ—¶å€™ï¼Œä½¿ç”¨ã€Œå¼‚æ­¥ I/O + ç›´æ¥ I/Oã€ï¼› ä¼ è¾“å°æ–‡ä»¶çš„æ—¶å€™ï¼Œåˆ™ä½¿ç”¨ã€Œé›¶æ‹·è´æŠ€æœ¯ã€ï¼› åœ¨ nginx ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹é…ç½®ï¼Œæ¥æ ¹æ®æ–‡ä»¶çš„å¤§å°æ¥ä½¿ç”¨ä¸åŒçš„æ–¹å¼ï¼š\n1 2 3 4 5 location /video/ { sendfile on; aio on; directio 1024m; } å½“æ–‡ä»¶å¤§å°å¤§äº directio å€¼åï¼Œä½¿ç”¨ã€Œå¼‚æ­¥ I/O + ç›´æ¥ I/Oã€ï¼Œå¦åˆ™ä½¿ç”¨ã€Œé›¶æ‹·è´æŠ€æœ¯ã€ã€‚\næ€»ç»“ æ—©æœŸ I/O æ“ä½œï¼Œå†…å­˜ä¸ç£ç›˜çš„æ•°æ®ä¼ è¾“çš„å·¥ä½œéƒ½æ˜¯ç”± CPU å®Œæˆçš„ï¼Œè€Œæ­¤æ—¶ CPU ä¸èƒ½æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œä¼šç‰¹åˆ«æµªè´¹ CPU èµ„æºã€‚\näºæ˜¯ï¼Œä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒDMA æŠ€æœ¯å°±å‡ºç°äº†ï¼Œæ¯ä¸ª I/O è®¾å¤‡éƒ½æœ‰è‡ªå·±çš„ DMA æ§åˆ¶å™¨ï¼Œé€šè¿‡è¿™ä¸ª DMA æ§åˆ¶å™¨ï¼ŒCPU åªéœ€è¦å‘Šè¯‰ DMA æ§åˆ¶å™¨ï¼Œæˆ‘ä»¬è¦ä¼ è¾“ä»€ä¹ˆæ•°æ®ï¼Œä»å“ªé‡Œæ¥ï¼Œåˆ°å“ªé‡Œå»ï¼Œå°±å¯ä»¥æ”¾å¿ƒç¦»å¼€äº†ã€‚åç»­çš„å®é™…æ•°æ®ä¼ è¾“å·¥ä½œï¼Œéƒ½ä¼šç”± DMA æ§åˆ¶å™¨æ¥å®Œæˆï¼ŒCPU ä¸éœ€è¦å‚ä¸æ•°æ®ä¼ è¾“çš„å·¥ä½œã€‚\nä¼ ç»Ÿ IO çš„å·¥ä½œæ–¹å¼ï¼Œä»ç¡¬ç›˜è¯»å–æ•°æ®ï¼Œç„¶åå†é€šè¿‡ç½‘å¡å‘å¤–å‘é€ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œ 4 ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå’Œ 4 æ¬¡æ•°æ®æ‹·è´ï¼Œå…¶ä¸­ 2 æ¬¡æ•°æ®æ‹·è´å‘ç”Ÿåœ¨å†…å­˜é‡Œçš„ç¼“å†²åŒºå’Œå¯¹åº”çš„ç¡¬ä»¶è®¾å¤‡ä¹‹é—´ï¼Œè¿™ä¸ªæ˜¯ç”± DMA å®Œæˆï¼Œå¦å¤– 2 æ¬¡åˆ™å‘ç”Ÿåœ¨å†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´ï¼Œè¿™ä¸ªæ•°æ®æ¬ç§»å·¥ä½œæ˜¯ç”± CPU å®Œæˆçš„ã€‚\nä¸ºäº†æé«˜æ–‡ä»¶ä¼ è¾“çš„æ€§èƒ½ï¼Œäºæ˜¯å°±å‡ºç°äº†é›¶æ‹·è´æŠ€æœ¯ï¼Œå®ƒé€šè¿‡ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼ˆsendfile æ–¹æ³•ï¼‰åˆå¹¶äº†ç£ç›˜è¯»å–ä¸ç½‘ç»œå‘é€ä¸¤ä¸ªæ“ä½œï¼Œé™ä½äº†ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ã€‚å¦å¤–ï¼Œæ‹·è´æ•°æ®éƒ½æ˜¯å‘ç”Ÿåœ¨å†…æ ¸ä¸­çš„ï¼Œå¤©ç„¶å°±é™ä½äº†æ•°æ®æ‹·è´çš„æ¬¡æ•°ã€‚\nKafka å’Œ Nginx éƒ½æœ‰å®ç°é›¶æ‹·è´æŠ€æœ¯ï¼Œè¿™å°†å¤§å¤§æé«˜æ–‡ä»¶ä¼ è¾“çš„æ€§èƒ½ã€‚\né›¶æ‹·è´æŠ€æœ¯æ˜¯åŸºäº PageCache çš„ï¼ŒPageCache ä¼šç¼“å­˜æœ€è¿‘è®¿é—®çš„æ•°æ®ï¼Œæå‡äº†è®¿é—®ç¼“å­˜æ•°æ®çš„æ€§èƒ½ï¼ŒåŒæ—¶ï¼Œä¸ºäº†è§£å†³æœºæ¢°ç¡¬ç›˜å¯»å€æ…¢çš„é—®é¢˜ï¼Œå®ƒè¿˜ååŠ© I/O è°ƒåº¦ç®—æ³•å®ç°äº† IO åˆå¹¶ä¸é¢„è¯»ï¼Œè¿™ä¹Ÿæ˜¯é¡ºåºè¯»æ¯”éšæœºè¯»æ€§èƒ½å¥½çš„åŸå› ã€‚è¿™äº›ä¼˜åŠ¿ï¼Œè¿›ä¸€æ­¥æå‡äº†é›¶æ‹·è´çš„æ€§èƒ½ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé›¶æ‹·è´æŠ€æœ¯æ˜¯ä¸å…è®¸è¿›ç¨‹å¯¹æ–‡ä»¶å†…å®¹ä½œè¿›ä¸€æ­¥çš„åŠ å·¥çš„ï¼Œæ¯”å¦‚å‹ç¼©æ•°æ®å†å‘é€ã€‚\nå¦å¤–ï¼Œå½“ä¼ è¾“å¤§æ–‡ä»¶æ—¶ï¼Œä¸èƒ½ä½¿ç”¨é›¶æ‹·è´ï¼Œå› ä¸ºå¯èƒ½ç”±äº PageCache è¢«å¤§æ–‡ä»¶å æ®ï¼Œè€Œå¯¼è‡´ã€Œçƒ­ç‚¹ã€å°æ–‡ä»¶æ— æ³•åˆ©ç”¨åˆ° PageCacheï¼Œå¹¶ä¸”å¤§æ–‡ä»¶çš„ç¼“å­˜å‘½ä¸­ç‡ä¸é«˜ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨ã€Œå¼‚æ­¥ IO + ç›´æ¥ IO ã€çš„æ–¹å¼ã€‚\nåœ¨ Nginx é‡Œï¼Œå¯ä»¥é€šè¿‡é…ç½®ï¼Œè®¾å®šä¸€ä¸ªæ–‡ä»¶å¤§å°é˜ˆå€¼ï¼Œé’ˆå¯¹å¤§æ–‡ä»¶ä½¿ç”¨å¼‚æ­¥ IO å’Œç›´æ¥ IOï¼Œè€Œå¯¹å°æ–‡ä»¶ä½¿ç”¨é›¶æ‹·è´ã€‚\n","permalink":"https://reid00.github.io/en/posts/os_network/%E9%9B%B6%E6%8B%B7%E8%B4%9D%E6%8A%80%E6%9C%AF/","summary":"ç£ç›˜å¯ä»¥è¯´æ˜¯è®¡ç®—æœºç³»ç»Ÿæœ€æ…¢çš„ç¡¬ä»¶ä¹‹ä¸€ï¼Œè¯»å†™é€Ÿåº¦ç›¸å·®å†…å­˜ 10 å€ä»¥ä¸Šï¼Œæ‰€ä»¥é’ˆå¯¹ä¼˜åŒ–ç£ç›˜çš„æŠ€æœ¯éå¸¸çš„å¤šï¼Œæ¯”å¦‚é›¶æ‹·è´ã€ç›´æ¥ I/Oã€å¼‚æ­¥ I/O ç­‰ç­‰ï¼Œè¿™äº›ä¼˜åŒ–çš„ç›®çš„å°±æ˜¯ä¸ºäº†æé«˜ç³»ç»Ÿçš„ååé‡ï¼Œå¦å¤–æ“ä½œç³»ç»Ÿå†…æ ¸ä¸­çš„ç£ç›˜é«˜é€Ÿç¼“å­˜åŒºï¼Œå¯ä»¥æœ‰æ•ˆçš„å‡å°‘ç£ç›˜çš„è®¿é—®æ¬¡æ•°ã€‚\nè¿™æ¬¡ï¼Œæˆ‘ä»¬å°±ä»¥ã€Œæ–‡ä»¶ä¼ è¾“ã€ä½œä¸ºåˆ‡å…¥ç‚¹ï¼Œæ¥åˆ†æ I/O å·¥ä½œæ–¹å¼ï¼Œä»¥åŠå¦‚ä½•ä¼˜åŒ–ä¼ è¾“æ–‡ä»¶çš„æ€§èƒ½ã€‚\nä¸ºä»€ä¹ˆè¦æœ‰ DMA æŠ€æœ¯? åœ¨æ²¡æœ‰ DMA æŠ€æœ¯å‰ï¼ŒI/O çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š\nCPU å‘å‡ºå¯¹åº”çš„æŒ‡ä»¤ç»™ç£ç›˜æ§åˆ¶å™¨ï¼Œç„¶åè¿”å›ï¼› ç£ç›˜æ§åˆ¶å™¨æ”¶åˆ°æŒ‡ä»¤åï¼Œäºæ˜¯å°±å¼€å§‹å‡†å¤‡æ•°æ®ï¼Œä¼šæŠŠæ•°æ®æ”¾å…¥åˆ°ç£ç›˜æ§åˆ¶å™¨çš„å†…éƒ¨ç¼“å†²åŒºä¸­ï¼Œç„¶åäº§ç”Ÿä¸€ä¸ªä¸­æ–­ï¼› CPU æ”¶åˆ°ä¸­æ–­ä¿¡å·åï¼Œåœä¸‹æ‰‹å¤´çš„å·¥ä½œï¼Œæ¥ç€æŠŠç£ç›˜æ§åˆ¶å™¨çš„ç¼“å†²åŒºçš„æ•°æ®ä¸€æ¬¡ä¸€ä¸ªå­—èŠ‚åœ°è¯»è¿›è‡ªå·±çš„å¯„å­˜å™¨ï¼Œç„¶åå†æŠŠå¯„å­˜å™¨é‡Œçš„æ•°æ®å†™å…¥åˆ°å†…å­˜ï¼Œè€Œåœ¨æ•°æ®ä¼ è¾“çš„æœŸé—´ CPU æ˜¯æ— æ³•æ‰§è¡Œå…¶ä»–ä»»åŠ¡çš„ã€‚ ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘ç”»äº†ä¸€å‰¯å›¾ï¼š å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªæ•°æ®çš„ä¼ è¾“è¿‡ç¨‹ï¼Œéƒ½è¦éœ€è¦ CPU äº²è‡ªå‚ä¸æ¬è¿æ•°æ®çš„è¿‡ç¨‹ï¼Œè€Œä¸”è¿™ä¸ªè¿‡ç¨‹ï¼ŒCPU æ˜¯ä¸èƒ½åšå…¶ä»–äº‹æƒ…çš„ã€‚\nç®€å•çš„æ¬è¿å‡ ä¸ªå­—ç¬¦æ•°æ®é‚£æ²¡é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ç”¨åƒå…†ç½‘å¡æˆ–è€…ç¡¬ç›˜ä¼ è¾“å¤§é‡æ•°æ®çš„æ—¶å€™ï¼Œéƒ½ç”¨ CPU æ¥æ¬è¿çš„è¯ï¼Œè‚¯å®šå¿™ä¸è¿‡æ¥ã€‚\nè®¡ç®—æœºç§‘å­¦å®¶ä»¬å‘ç°äº†äº‹æƒ…çš„ä¸¥é‡æ€§åï¼Œäºæ˜¯å°±å‘æ˜äº† DMA æŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥å†…å­˜è®¿é—®ï¼ˆDirect Memory Accessï¼‰ æŠ€æœ¯ã€‚\nä»€ä¹ˆæ˜¯ DMA æŠ€æœ¯ï¼Ÿç®€å•ç†è§£å°±æ˜¯ï¼Œåœ¨è¿›è¡Œ I/O è®¾å¤‡å’Œå†…å­˜çš„æ•°æ®ä¼ è¾“çš„æ—¶å€™ï¼Œæ•°æ®æ¬è¿çš„å·¥ä½œå…¨éƒ¨äº¤ç»™ DMA æ§åˆ¶å™¨ï¼Œè€Œ CPU ä¸å†å‚ä¸ä»»ä½•ä¸æ•°æ®æ¬è¿ç›¸å…³çš„äº‹æƒ…ï¼Œè¿™æ · CPU å°±å¯ä»¥å»å¤„ç†åˆ«çš„äº‹åŠ¡ã€‚\né‚£ä½¿ç”¨ DMA æ§åˆ¶å™¨è¿›è¡Œæ•°æ®ä¼ è¾“çš„è¿‡ç¨‹ç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥å…·ä½“çœ‹çœ‹ã€‚ å…·ä½“è¿‡ç¨‹ï¼š\nç”¨æˆ·è¿›ç¨‹è°ƒç”¨ read æ–¹æ³•ï¼Œå‘æ“ä½œç³»ç»Ÿå‘å‡º I/O è¯·æ±‚ï¼Œè¯·æ±‚è¯»å–æ•°æ®åˆ°è‡ªå·±çš„å†…å­˜ç¼“å†²åŒºä¸­ï¼Œè¿›ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼› æ“ä½œç³»ç»Ÿæ”¶åˆ°è¯·æ±‚åï¼Œè¿›ä¸€æ­¥å°† I/O è¯·æ±‚å‘é€ DMAï¼Œç„¶åè®© CPU æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼› DMA è¿›ä¸€æ­¥å°† I/O è¯·æ±‚å‘é€ç»™ç£ç›˜ï¼› ç£ç›˜æ”¶åˆ° DMA çš„ I/O è¯·æ±‚ï¼ŒæŠŠæ•°æ®ä»ç£ç›˜è¯»å–åˆ°ç£ç›˜æ§åˆ¶å™¨çš„ç¼“å†²åŒºä¸­ï¼Œå½“ç£ç›˜æ§åˆ¶å™¨çš„ç¼“å†²åŒºè¢«è¯»æ»¡åï¼Œå‘ DMA å‘èµ·ä¸­æ–­ä¿¡å·ï¼Œå‘ŠçŸ¥è‡ªå·±ç¼“å†²åŒºå·²æ»¡ï¼› DMA æ”¶åˆ°ç£ç›˜çš„ä¿¡å·ï¼Œå°†ç£ç›˜æ§åˆ¶å™¨ç¼“å†²åŒºä¸­çš„æ•°æ®æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºä¸­ï¼Œæ­¤æ—¶ä¸å ç”¨ CPUï¼ŒCPU å¯ä»¥æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼› å½“ DMA è¯»å–äº†è¶³å¤Ÿå¤šçš„æ•°æ®ï¼Œå°±ä¼šå‘é€ä¸­æ–­ä¿¡å·ç»™ CPUï¼› CPU æ”¶åˆ° DMA çš„ä¿¡å·ï¼ŒçŸ¥é“æ•°æ®å·²ç»å‡†å¤‡å¥½ï¼Œäºæ˜¯å°†æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œç³»ç»Ÿè°ƒç”¨è¿”å›ï¼› å¯ä»¥çœ‹åˆ°ï¼Œ CPU ä¸å†å‚ä¸ã€Œå°†æ•°æ®ä»ç£ç›˜æ§åˆ¶å™¨ç¼“å†²åŒºæ¬è¿åˆ°å†…æ ¸ç©ºé—´ã€çš„å·¥ä½œï¼Œè¿™éƒ¨åˆ†å·¥ä½œå…¨ç¨‹ç”± DMA å®Œæˆã€‚ä½†æ˜¯ CPU åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå› ä¸ºä¼ è¾“ä»€ä¹ˆæ•°æ®ï¼Œä»å“ªé‡Œä¼ è¾“åˆ°å“ªé‡Œï¼Œéƒ½éœ€è¦ CPU æ¥å‘Šè¯‰ DMA æ§åˆ¶å™¨ã€‚","title":"é›¶æ‹·è´æŠ€æœ¯"},{"content":"åˆ«å°çœ‹è¿™ä¸¤ä¸ªä¸œè¥¿ï¼Œç‰¹åˆ«æ˜¯ Reactor æ¨¡å¼ï¼Œå¸‚é¢ä¸Šå¸¸è§çš„å¼€æºè½¯ä»¶å¾ˆå¤šéƒ½é‡‡ç”¨äº†è¿™ä¸ªæ–¹æ¡ˆï¼Œæ¯”å¦‚ Redisã€Nginxã€Netty ç­‰ç­‰ï¼Œæ‰€ä»¥å­¦å¥½è¿™ä¸ªæ¨¡å¼è®¾è®¡çš„æ€æƒ³ï¼Œæœ‰åŠ©äºæˆ‘ä»¬ç†è§£å¾ˆå¤šå¼€æºè½¯ä»¶ã€‚\næ¼”è¿› å¦‚æœè¦è®©æœåŠ¡å™¨æœåŠ¡å¤šä¸ªå®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆæœ€ç›´æ¥çš„æ–¹å¼å°±æ˜¯ä¸ºæ¯ä¸€æ¡è¿æ¥åˆ›å»ºçº¿ç¨‹ã€‚\nå…¶å®åˆ›å»ºè¿›ç¨‹ä¹Ÿæ˜¯å¯ä»¥çš„ï¼ŒåŸç†æ˜¯ä¸€æ ·çš„ï¼Œè¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«åœ¨äºçº¿ç¨‹æ¯”è¾ƒè½»é‡çº§äº›ï¼Œçº¿ç¨‹çš„åˆ›å»ºå’Œçº¿ç¨‹é—´åˆ‡æ¢çš„æˆæœ¬è¦å°äº›ï¼Œä¸ºäº†æè¿°ç®€è¿°ï¼Œåé¢éƒ½ä»¥çº¿ç¨‹ä¸ºä¾‹ã€‚\nå¤„ç†å®Œä¸šåŠ¡é€»è¾‘åï¼Œéšç€è¿æ¥å…³é—­åçº¿ç¨‹ä¹ŸåŒæ ·è¦é”€æ¯äº†ï¼Œä½†æ˜¯è¿™æ ·ä¸åœåœ°åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ï¼Œä¸ä»…ä¼šå¸¦æ¥æ€§èƒ½å¼€é”€ï¼Œä¹Ÿä¼šé€ æˆæµªè´¹èµ„æºï¼Œè€Œä¸”å¦‚æœè¦è¿æ¥å‡ ä¸‡æ¡è¿æ¥ï¼Œåˆ›å»ºå‡ ä¸‡ä¸ªçº¿ç¨‹å»åº”å¯¹ä¹Ÿæ˜¯ä¸ç°å®çš„ã€‚\nè¦è¿™ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ã€Œèµ„æºå¤ç”¨ã€çš„æ–¹å¼ã€‚\nä¹Ÿå°±æ˜¯ä¸ç”¨å†ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºçº¿ç¨‹ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªã€Œçº¿ç¨‹æ± ã€ï¼Œå°†è¿æ¥åˆ†é…ç»™çº¿ç¨‹ï¼Œç„¶åä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†å¤šä¸ªè¿æ¥çš„ä¸šåŠ¡ã€‚\nä¸è¿‡ï¼Œè¿™æ ·åˆå¼•æ¥ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œçº¿ç¨‹æ€æ ·æ‰èƒ½é«˜æ•ˆåœ°å¤„ç†å¤šä¸ªè¿æ¥çš„ä¸šåŠ¡ï¼Ÿ\nå½“ä¸€ä¸ªè¿æ¥å¯¹åº”ä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œçº¿ç¨‹ä¸€èˆ¬é‡‡ç”¨ã€Œread -\u0026gt; ä¸šåŠ¡å¤„ç† -\u0026gt; sendã€çš„å¤„ç†æµç¨‹ï¼Œå¦‚æœå½“å‰è¿æ¥æ²¡æœ‰æ•°æ®å¯è¯»ï¼Œé‚£ä¹ˆçº¿ç¨‹ä¼šé˜»å¡åœ¨ read æ“ä½œä¸Šï¼ˆ socket é»˜è®¤æƒ…å†µæ˜¯é˜»å¡ I/Oï¼‰ï¼Œä¸è¿‡è¿™ç§é˜»å¡æ–¹å¼å¹¶ä¸å½±å“å…¶ä»–çº¿ç¨‹ã€‚\nä½†æ˜¯å¼•å…¥äº†çº¿ç¨‹æ± ï¼Œé‚£ä¹ˆä¸€ä¸ªçº¿ç¨‹è¦å¤„ç†å¤šä¸ªè¿æ¥çš„ä¸šåŠ¡ï¼Œçº¿ç¨‹åœ¨å¤„ç†æŸä¸ªè¿æ¥çš„ read æ“ä½œæ—¶ï¼Œå¦‚æœé‡åˆ°æ²¡æœ‰æ•°æ®å¯è¯»ï¼Œå°±ä¼šå‘ç”Ÿé˜»å¡ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±æ²¡åŠæ³•ç»§ç»­å¤„ç†å…¶ä»–è¿æ¥çš„ä¸šåŠ¡ã€‚\nè¦è§£å†³è¿™ä¸€ä¸ªé—®é¢˜ï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å°† socket æ”¹æˆéé˜»å¡ï¼Œç„¶åçº¿ç¨‹ä¸æ–­åœ°è½®è¯¢è°ƒç”¨ read æ“ä½œæ¥åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®ï¼Œè¿™ç§æ–¹å¼è™½ç„¶è¯¥èƒ½å¤Ÿè§£å†³é˜»å¡çš„é—®é¢˜ï¼Œä½†æ˜¯è§£å†³çš„æ–¹å¼æ¯”è¾ƒç²—æš´ï¼Œå› ä¸ºè½®è¯¢æ˜¯è¦æ¶ˆè€— CPU çš„ï¼Œè€Œä¸”éšç€ä¸€ä¸ª çº¿ç¨‹å¤„ç†çš„è¿æ¥è¶Šå¤šï¼Œè½®è¯¢çš„æ•ˆç‡å°±ä¼šè¶Šä½ã€‚\nä¸Šé¢çš„é—®é¢˜åœ¨äºï¼Œçº¿ç¨‹å¹¶ä¸çŸ¥é“å½“å‰è¿æ¥æ˜¯å¦æœ‰æ•°æ®å¯è¯»ï¼Œä»è€Œéœ€è¦æ¯æ¬¡é€šè¿‡ read å»è¯•æ¢ã€‚\né‚£æœ‰æ²¡æœ‰åŠæ³•åœ¨åªæœ‰å½“è¿æ¥ä¸Šæœ‰æ•°æ®çš„æ—¶å€™ï¼Œçº¿ç¨‹æ‰å»å‘èµ·è¯»è¯·æ±‚å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œå®ç°è¿™ä¸€æŠ€æœ¯çš„å°±æ˜¯ I/O å¤šè·¯å¤ç”¨ã€‚\nI/O å¤šè·¯å¤ç”¨æŠ€æœ¯ä¼šç”¨ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°æ¥ç›‘å¬æˆ‘ä»¬æ‰€æœ‰å…³å¿ƒçš„è¿æ¥ï¼Œä¹Ÿå°±è¯´å¯ä»¥åœ¨ä¸€ä¸ªç›‘æ§çº¿ç¨‹é‡Œé¢ç›‘æ§å¾ˆå¤šçš„è¿æ¥ã€‚\næˆ‘ä»¬ç†Ÿæ‚‰çš„ select/poll/epoll å°±æ˜¯å†…æ ¸æä¾›ç»™ç”¨æˆ·æ€çš„å¤šè·¯å¤ç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œçº¿ç¨‹å¯ä»¥é€šè¿‡ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°ä»å†…æ ¸ä¸­è·å–å¤šä¸ªäº‹ä»¶ã€‚\nselect/poll/epoll æ˜¯å¦‚ä½•è·å–ç½‘ç»œäº‹ä»¶çš„å‘¢ï¼Ÿ\nåœ¨è·å–äº‹ä»¶æ—¶ï¼Œå…ˆæŠŠæˆ‘ä»¬è¦å…³å¿ƒçš„è¿æ¥ä¼ ç»™å†…æ ¸ï¼Œå†ç”±å†…æ ¸æ£€æµ‹ï¼š\nå¦‚æœæ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œçº¿ç¨‹åªéœ€é˜»å¡åœ¨è¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œè€Œæ— éœ€åƒå‰é¢çš„çº¿ç¨‹æ± æ–¹æ¡ˆé‚£æ ·è½®è®­è°ƒç”¨ read æ“ä½œæ¥åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®ã€‚ å¦‚æœæœ‰äº‹ä»¶å‘ç”Ÿï¼Œå†…æ ¸ä¼šè¿”å›äº§ç”Ÿäº†äº‹ä»¶çš„è¿æ¥ï¼Œçº¿ç¨‹å°±ä¼šä»é˜»å¡çŠ¶æ€è¿”å›ï¼Œç„¶ååœ¨ç”¨æˆ·æ€ä¸­å†å¤„ç†è¿™äº›è¿æ¥å¯¹åº”çš„ä¸šåŠ¡å³å¯ã€‚ å½“ä¸‹å¼€æºè½¯ä»¶èƒ½åšåˆ°ç½‘ç»œé«˜æ€§èƒ½çš„åŸå› å°±æ˜¯ I/O å¤šè·¯å¤ç”¨å—ï¼Ÿ\næ˜¯çš„ï¼ŒåŸºæœ¬æ˜¯åŸºäº I/O å¤šè·¯å¤ç”¨ï¼Œç”¨è¿‡ I/O å¤šè·¯å¤ç”¨æ¥å£å†™ç½‘ç»œç¨‹åºçš„åŒå­¦ï¼Œè‚¯å®šçŸ¥é“æ˜¯é¢å‘è¿‡ç¨‹çš„æ–¹å¼å†™ä»£ç çš„ï¼Œè¿™æ ·çš„å¼€å‘çš„æ•ˆç‡ä¸é«˜ã€‚\näºæ˜¯ï¼Œå¤§ä½¬ä»¬åŸºäºé¢å‘å¯¹è±¡çš„æ€æƒ³ï¼Œå¯¹ I/O å¤šè·¯å¤ç”¨ä½œäº†ä¸€å±‚å°è£…ï¼Œè®©ä½¿ç”¨è€…ä¸ç”¨è€ƒè™‘åº•å±‚ç½‘ç»œ API çš„ç»†èŠ‚ï¼Œåªéœ€è¦å…³æ³¨åº”ç”¨ä»£ç çš„ç¼–å†™ã€‚\nå¤§ä½¬ä»¬è¿˜ä¸ºè¿™ç§æ¨¡å¼å–äº†ä¸ªè®©äººç¬¬ä¸€æ—¶é—´éš¾ä»¥ç†è§£çš„åå­—ï¼šReactor æ¨¡å¼ã€‚\nReactor ç¿»è¯‘è¿‡æ¥çš„æ„æ€æ˜¯ã€Œååº”å †ã€ï¼Œå¯èƒ½å¤§å®¶ä¼šè”æƒ³åˆ°ç‰©ç†å­¦é‡Œçš„æ ¸ååº”å †ï¼Œå®é™…ä¸Šå¹¶ä¸æ˜¯çš„è¿™ä¸ªæ„æ€ã€‚\nè¿™é‡Œçš„ååº”æŒ‡çš„æ˜¯ã€Œå¯¹äº‹ä»¶ååº”ã€ï¼Œä¹Ÿå°±æ˜¯æ¥äº†ä¸€ä¸ªäº‹ä»¶ï¼ŒReactor å°±æœ‰ç›¸å¯¹åº”çš„ååº”/å“åº”ã€‚\näº‹å®ä¸Šï¼ŒReactor æ¨¡å¼ä¹Ÿå« Dispatcher æ¨¡å¼ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªåå­—æ›´è´´åˆè¯¥æ¨¡å¼çš„å«ä¹‰ï¼Œå³ I/O å¤šè·¯å¤ç”¨ç›‘å¬äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åï¼Œæ ¹æ®äº‹ä»¶ç±»å‹åˆ†é…ï¼ˆDispatchï¼‰ç»™æŸä¸ªè¿›ç¨‹ / çº¿ç¨‹ã€‚\nReactor æ¨¡å¼ä¸»è¦ç”± Reactor å’Œå¤„ç†èµ„æºæ± è¿™ä¸¤ä¸ªæ ¸å¿ƒéƒ¨åˆ†ç»„æˆï¼Œå®ƒä¿©è´Ÿè´£çš„äº‹æƒ…å¦‚ä¸‹ï¼š\nReactor è´Ÿè´£ç›‘å¬å’Œåˆ†å‘äº‹ä»¶ï¼Œäº‹ä»¶ç±»å‹åŒ…å«è¿æ¥äº‹ä»¶ã€è¯»å†™äº‹ä»¶ï¼› å¤„ç†èµ„æºæ± è´Ÿè´£å¤„ç†äº‹ä»¶ï¼Œå¦‚ read -\u0026gt; ä¸šåŠ¡é€»è¾‘ -\u0026gt; sendï¼› Reactor æ¨¡å¼æ˜¯çµæ´»å¤šå˜çš„ï¼Œå¯ä»¥åº”å¯¹ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼Œçµæ´»åœ¨äºï¼š\nReactor çš„æ•°é‡å¯ä»¥åªæœ‰ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ªï¼› å¤„ç†èµ„æºæ± å¯ä»¥æ˜¯å•ä¸ªè¿›ç¨‹ / çº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªè¿›ç¨‹ /çº¿ç¨‹ï¼› å°†ä¸Šé¢çš„ä¸¤ä¸ªå› ç´ æ’åˆ—ç»„è®¾ä¸€ä¸‹ï¼Œç†è®ºä¸Šå°±å¯ä»¥æœ‰ 4 ç§æ–¹æ¡ˆé€‰æ‹©ï¼š\nå• Reactor å•è¿›ç¨‹ / çº¿ç¨‹ï¼› å• Reactor å¤šè¿›ç¨‹ / çº¿ç¨‹ï¼› å¤š Reactor å•è¿›ç¨‹ / çº¿ç¨‹ï¼› å¤š Reactor å¤šè¿›ç¨‹ / çº¿ç¨‹ï¼› å…¶ä¸­ï¼Œã€Œå¤š Reactor å•è¿›ç¨‹ / çº¿ç¨‹ã€å®ç°æ–¹æ¡ˆç›¸æ¯”ã€Œå• Reactor å•è¿›ç¨‹ / çº¿ç¨‹ã€æ–¹æ¡ˆï¼Œä¸ä»…å¤æ‚è€Œä¸”ä¹Ÿæ²¡æœ‰æ€§èƒ½ä¼˜åŠ¿ï¼Œå› æ­¤å®é™…ä¸­å¹¶æ²¡æœ‰åº”ç”¨ã€‚\nå‰©ä¸‹çš„ 3 ä¸ªæ–¹æ¡ˆéƒ½æ˜¯æ¯”è¾ƒç»å…¸çš„ï¼Œä¸”éƒ½æœ‰åº”ç”¨åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼š\nå• Reactor å•è¿›ç¨‹ / çº¿ç¨‹ï¼› å• Reactor å¤šçº¿ç¨‹ / è¿›ç¨‹ï¼› å¤š Reactor å¤šè¿›ç¨‹ / çº¿ç¨‹ï¼› æ–¹æ¡ˆå…·ä½“ä½¿ç”¨è¿›ç¨‹è¿˜æ˜¯çº¿ç¨‹ï¼Œè¦çœ‹ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ä»¥åŠå¹³å°æœ‰å…³ï¼š Java è¯­è¨€ä¸€èˆ¬ä½¿ç”¨çº¿ç¨‹ï¼Œæ¯”å¦‚ Netty; C è¯­è¨€ä½¿ç”¨è¿›ç¨‹å’Œçº¿ç¨‹éƒ½å¯ä»¥ï¼Œä¾‹å¦‚ Nginx ä½¿ç”¨çš„æ˜¯è¿›ç¨‹ï¼ŒMemcache ä½¿ç”¨çš„æ˜¯çº¿ç¨‹ã€‚ æ¥ä¸‹æ¥ï¼Œåˆ†åˆ«ä»‹ç»è¿™ä¸‰ä¸ªç»å…¸çš„ Reactor æ–¹æ¡ˆã€‚\nReactor å• Reactor å•è¿›ç¨‹ / çº¿ç¨‹ ä¸€èˆ¬æ¥è¯´ï¼ŒC è¯­è¨€å®ç°çš„æ˜¯ã€Œå• Reactor å•è¿›ç¨‹ã€çš„æ–¹æ¡ˆï¼Œå› ä¸º C è¯­ç¼–å†™å®Œçš„ç¨‹åºï¼Œè¿è¡Œåå°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä¸éœ€è¦åœ¨è¿›ç¨‹ä¸­å†åˆ›å»ºçº¿ç¨‹ã€‚\nè€Œ Java è¯­è¨€å®ç°çš„æ˜¯ã€Œå• Reactor å•çº¿ç¨‹ã€çš„æ–¹æ¡ˆï¼Œå› ä¸º Java ç¨‹åºæ˜¯è·‘åœ¨ Java è™šæ‹Ÿæœºè¿™ä¸ªè¿›ç¨‹ä¸Šé¢çš„ï¼Œè™šæ‹Ÿæœºä¸­æœ‰å¾ˆå¤šçº¿ç¨‹ï¼Œæˆ‘ä»¬å†™çš„ Java ç¨‹åºåªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªçº¿ç¨‹è€Œå·²ã€‚\næˆ‘ä»¬æ¥çœ‹çœ‹ã€Œå• Reactor å•è¿›ç¨‹ã€çš„æ–¹æ¡ˆç¤ºæ„å›¾ï¼š å¯ä»¥çœ‹åˆ°è¿›ç¨‹é‡Œæœ‰ Reactorã€Acceptorã€Handler è¿™ä¸‰ä¸ªå¯¹è±¡ï¼š\nReactor å¯¹è±¡çš„ä½œç”¨æ˜¯ç›‘å¬å’Œåˆ†å‘äº‹ä»¶ï¼› Acceptor å¯¹è±¡çš„ä½œç”¨æ˜¯è·å–è¿æ¥ï¼› Handler å¯¹è±¡çš„ä½œç”¨æ˜¯å¤„ç†ä¸šåŠ¡ï¼› å¯¹è±¡é‡Œçš„ selectã€acceptã€readã€send æ˜¯ç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼Œdispatch å’Œ ã€Œä¸šåŠ¡å¤„ç†ã€æ˜¯éœ€è¦å®Œæˆçš„æ“ä½œï¼Œå…¶ä¸­ dispatch æ˜¯åˆ†å‘äº‹ä»¶æ“ä½œã€‚\næ¥ä¸‹æ¥ï¼Œä»‹ç»ä¸‹ã€Œå• Reactor å•è¿›ç¨‹ã€è¿™ä¸ªæ–¹æ¡ˆï¼š\nReactor å¯¹è±¡é€šè¿‡ select ï¼ˆIO å¤šè·¯å¤ç”¨æ¥å£ï¼‰ ç›‘å¬äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åé€šè¿‡ dispatch è¿›è¡Œåˆ†å‘ï¼Œå…·ä½“åˆ†å‘ç»™ Acceptor å¯¹è±¡è¿˜æ˜¯ Handler å¯¹è±¡ï¼Œè¿˜è¦çœ‹æ”¶åˆ°çš„äº‹ä»¶ç±»å‹ï¼› å¦‚æœæ˜¯è¿æ¥å»ºç«‹çš„äº‹ä»¶ï¼Œåˆ™äº¤ç”± Acceptor å¯¹è±¡è¿›è¡Œå¤„ç†ï¼ŒAcceptor å¯¹è±¡ä¼šé€šè¿‡ accept æ–¹æ³• è·å–è¿æ¥ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª Handler å¯¹è±¡æ¥å¤„ç†åç»­çš„å“åº”äº‹ä»¶ï¼› å¦‚æœä¸æ˜¯è¿æ¥å»ºç«‹äº‹ä»¶ï¼Œ åˆ™äº¤ç”±å½“å‰è¿æ¥å¯¹åº”çš„ Handler å¯¹è±¡æ¥è¿›è¡Œå“åº”ï¼› Handler å¯¹è±¡é€šè¿‡ read -\u0026gt; ä¸šåŠ¡å¤„ç† -\u0026gt; send çš„æµç¨‹æ¥å®Œæˆå®Œæ•´çš„ä¸šåŠ¡æµç¨‹ã€‚ å• Reactor å•è¿›ç¨‹çš„æ–¹æ¡ˆå› ä¸ºå…¨éƒ¨å·¥ä½œéƒ½åœ¨åŒä¸€ä¸ªè¿›ç¨‹å†…å®Œæˆï¼Œæ‰€ä»¥å®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä¸éœ€è¦è€ƒè™‘è¿›ç¨‹é—´é€šä¿¡ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒå¤šè¿›ç¨‹ç«äº‰ã€‚\nä½†æ˜¯ï¼Œè¿™ç§æ–¹æ¡ˆå­˜åœ¨ 2 ä¸ªç¼ºç‚¹ï¼š\nç¬¬ä¸€ä¸ªç¼ºç‚¹ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œæ— æ³•å……åˆ†åˆ©ç”¨ å¤šæ ¸ CPU çš„æ€§èƒ½ï¼› ç¬¬äºŒä¸ªç¼ºç‚¹ï¼ŒHandler å¯¹è±¡åœ¨ä¸šåŠ¡å¤„ç†æ—¶ï¼Œæ•´ä¸ªè¿›ç¨‹æ˜¯æ— æ³•å¤„ç†å…¶ä»–è¿æ¥çš„äº‹ä»¶çš„ï¼Œå¦‚æœä¸šåŠ¡å¤„ç†è€—æ—¶æ¯”è¾ƒé•¿ï¼Œé‚£ä¹ˆå°±é€ æˆå“åº”çš„å»¶è¿Ÿï¼› ç¬¬ä¸€ä¸ªç¼ºç‚¹ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œæ— æ³•å……åˆ†åˆ©ç”¨ å¤šæ ¸ CPU çš„æ€§èƒ½ï¼› ç¬¬äºŒä¸ªç¼ºç‚¹ï¼ŒHandler å¯¹è±¡åœ¨ä¸šåŠ¡å¤„ç†æ—¶ï¼Œæ•´ä¸ªè¿›ç¨‹æ˜¯æ— æ³•å¤„ç†å…¶ä»–è¿æ¥çš„äº‹ä»¶çš„ï¼Œå¦‚æœä¸šåŠ¡å¤„ç†è€—æ—¶æ¯”è¾ƒé•¿ï¼Œé‚£ä¹ˆå°±é€ æˆå“åº”çš„å»¶è¿Ÿï¼› æ‰€ä»¥ï¼Œå• Reactor å•è¿›ç¨‹çš„æ–¹æ¡ˆä¸é€‚ç”¨è®¡ç®—æœºå¯†é›†å‹çš„åœºæ™¯ï¼Œåªé€‚ç”¨äºä¸šåŠ¡å¤„ç†éå¸¸å¿«é€Ÿçš„åœºæ™¯ã€‚\nRedis æ˜¯ç”± C è¯­è¨€å®ç°çš„ï¼Œåœ¨ Redis 6.0 ç‰ˆæœ¬ä¹‹å‰é‡‡ç”¨çš„æ­£æ˜¯ã€Œå• Reactor å•è¿›ç¨‹ã€çš„æ–¹æ¡ˆï¼Œå› ä¸º Redis ä¸šåŠ¡å¤„ç†ä¸»è¦æ˜¯åœ¨å†…å­˜ä¸­å®Œæˆï¼Œæ“ä½œçš„é€Ÿåº¦æ˜¯å¾ˆå¿«çš„ï¼Œæ€§èƒ½ç“¶é¢ˆä¸åœ¨ CPU ä¸Šï¼Œæ‰€ä»¥ Redis å¯¹äºå‘½ä»¤çš„å¤„ç†æ˜¯å•è¿›ç¨‹çš„æ–¹æ¡ˆã€‚\nå• Reactor å¤šçº¿ç¨‹ / å¤šè¿›ç¨‹ å¦‚æœè¦å…‹æœã€Œå• Reactor å•çº¿ç¨‹ / è¿›ç¨‹ã€æ–¹æ¡ˆçš„ç¼ºç‚¹ï¼Œé‚£ä¹ˆå°±éœ€è¦å¼•å…¥å¤šçº¿ç¨‹ / å¤šè¿›ç¨‹ï¼Œè¿™æ ·å°±äº§ç”Ÿäº†å• Reactor å¤šçº¿ç¨‹ / å¤šè¿›ç¨‹çš„æ–¹æ¡ˆã€‚\né—»å…¶åä¸å¦‚çœ‹å…¶å›¾ï¼Œå…ˆæ¥çœ‹çœ‹ã€Œå• Reactor å¤šçº¿ç¨‹ã€æ–¹æ¡ˆçš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š è¯¦ç»†è¯´ä¸€ä¸‹è¿™ä¸ªæ–¹æ¡ˆï¼š\nReactor å¯¹è±¡é€šè¿‡ select ï¼ˆIO å¤šè·¯å¤ç”¨æ¥å£ï¼‰ ç›‘å¬äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åé€šè¿‡ dispatch è¿›è¡Œåˆ†å‘ï¼Œå…·ä½“åˆ†å‘ç»™ Acceptor å¯¹è±¡è¿˜æ˜¯ Handler å¯¹è±¡ï¼Œè¿˜è¦çœ‹æ”¶åˆ°çš„äº‹ä»¶ç±»å‹ï¼› å¦‚æœæ˜¯è¿æ¥å»ºç«‹çš„äº‹ä»¶ï¼Œåˆ™äº¤ç”± Acceptor å¯¹è±¡è¿›è¡Œå¤„ç†ï¼ŒAcceptor å¯¹è±¡ä¼šé€šè¿‡ accept æ–¹æ³• è·å–è¿æ¥ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª Handler å¯¹è±¡æ¥å¤„ç†åç»­çš„å“åº”äº‹ä»¶ï¼› å¦‚æœä¸æ˜¯è¿æ¥å»ºç«‹äº‹ä»¶ï¼Œ åˆ™äº¤ç”±å½“å‰è¿æ¥å¯¹åº”çš„ Handler å¯¹è±¡æ¥è¿›è¡Œå“åº”ï¼› ä¸Šé¢çš„ä¸‰ä¸ªæ­¥éª¤å’Œå• Reactor å•çº¿ç¨‹æ–¹æ¡ˆæ˜¯ä¸€æ ·çš„ï¼Œæ¥ä¸‹æ¥çš„æ­¥éª¤å°±å¼€å§‹ä¸ä¸€æ ·äº†ï¼š\nHandler å¯¹è±¡ä¸å†è´Ÿè´£ä¸šåŠ¡å¤„ç†ï¼Œåªè´Ÿè´£æ•°æ®çš„æ¥æ”¶å’Œå‘é€ï¼ŒHandler å¯¹è±¡é€šè¿‡ read è¯»å–åˆ°æ•°æ®åï¼Œä¼šå°†æ•°æ®å‘ç»™å­çº¿ç¨‹é‡Œçš„ Processor å¯¹è±¡è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼› å­çº¿ç¨‹é‡Œçš„ Processor å¯¹è±¡å°±è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œå¤„ç†å®Œåï¼Œå°†ç»“æœå‘ç»™ä¸»çº¿ç¨‹ä¸­çš„ Handler å¯¹è±¡ï¼Œæ¥ç€ç”± Handler é€šè¿‡ send æ–¹æ³•å°†å“åº”ç»“æœå‘é€ç»™ clientï¼› å• Reator å¤šçº¿ç¨‹çš„æ–¹æ¡ˆä¼˜åŠ¿åœ¨äºèƒ½å¤Ÿå……åˆ†åˆ©ç”¨å¤šæ ¸ CPU çš„èƒ½åŠ›ï¼Œé‚£æ—¢ç„¶å¼•å…¥å¤šçº¿ç¨‹ï¼Œé‚£ä¹ˆè‡ªç„¶å°±å¸¦æ¥äº†å¤šçº¿ç¨‹ç«äº‰èµ„æºçš„é—®é¢˜ã€‚\nä¾‹å¦‚ï¼Œå­çº¿ç¨‹å®Œæˆä¸šåŠ¡å¤„ç†åï¼Œè¦æŠŠç»“æœä¼ é€’ç»™ä¸»çº¿ç¨‹çš„ Handler è¿›è¡Œå‘é€ï¼Œè¿™é‡Œæ¶‰åŠå…±äº«æ•°æ®çš„ç«äº‰ã€‚\nè¦é¿å…å¤šçº¿ç¨‹ç”±äºç«äº‰å…±äº«èµ„æºè€Œå¯¼è‡´æ•°æ®é”™ä¹±çš„é—®é¢˜ï¼Œå°±éœ€è¦åœ¨æ“ä½œå…±äº«èµ„æºå‰åŠ ä¸Šäº’æ–¥é”ï¼Œä»¥ä¿è¯ä»»æ„æ—¶é—´é‡Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ“ä½œå…±äº«èµ„æºï¼Œå¾…è¯¥çº¿ç¨‹æ“ä½œå®Œé‡Šæ”¾äº’æ–¥é”åï¼Œå…¶ä»–çº¿ç¨‹æ‰æœ‰æœºä¼šæ“ä½œå…±äº«æ•°æ®ã€‚\nèŠå®Œå• Reactor å¤šçº¿ç¨‹çš„æ–¹æ¡ˆï¼Œæ¥ç€æ¥çœ‹çœ‹å• Reactor å¤šè¿›ç¨‹çš„æ–¹æ¡ˆã€‚\näº‹å®ä¸Šï¼Œå• Reactor å¤šè¿›ç¨‹ç›¸æ¯”å• Reactor å¤šçº¿ç¨‹å®ç°èµ·æ¥å¾ˆéº»çƒ¦ï¼Œä¸»è¦å› ä¸ºè¦è€ƒè™‘å­è¿›ç¨‹ \u0026lt;-\u0026gt; çˆ¶è¿›ç¨‹çš„åŒå‘é€šä¿¡ï¼Œå¹¶ä¸”çˆ¶è¿›ç¨‹è¿˜å¾—çŸ¥é“å­è¿›ç¨‹è¦å°†æ•°æ®å‘é€ç»™å“ªä¸ªå®¢æˆ·ç«¯ã€‚\nè€Œå¤šçº¿ç¨‹é—´å¯ä»¥å…±äº«æ•°æ®ï¼Œè™½ç„¶è¦é¢å¤–è€ƒè™‘å¹¶å‘é—®é¢˜ï¼Œä½†æ˜¯è¿™è¿œæ¯”è¿›ç¨‹é—´é€šä¿¡çš„å¤æ‚åº¦ä½å¾—å¤šï¼Œå› æ­¤å®é™…åº”ç”¨ä¸­ä¹Ÿçœ‹ä¸åˆ°å• Reactor å¤šè¿›ç¨‹çš„æ¨¡å¼ã€‚\nå¦å¤–ï¼Œã€Œå• Reactorã€çš„æ¨¡å¼è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œå› ä¸ºä¸€ä¸ª Reactor å¯¹è±¡æ‰¿æ‹…æ‰€æœ‰äº‹ä»¶çš„ç›‘å¬å’Œå“åº”ï¼Œè€Œä¸”åªåœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œï¼Œåœ¨é¢å¯¹ç¬é—´é«˜å¹¶å‘çš„åœºæ™¯æ—¶ï¼Œå®¹æ˜“æˆä¸ºæ€§èƒ½çš„ç“¶é¢ˆçš„åœ°æ–¹ã€‚\nå¤š Reactor å¤šè¿›ç¨‹ / çº¿ç¨‹ è¦è§£å†³ã€Œå• Reactorã€çš„é—®é¢˜ï¼Œå°±æ˜¯å°†ã€Œå• Reactorã€å®ç°æˆã€Œå¤š Reactorã€ï¼Œè¿™æ ·å°±äº§ç”Ÿäº†ç¬¬ å¤š Reactor å¤šè¿›ç¨‹ / çº¿ç¨‹çš„æ–¹æ¡ˆã€‚\nè€è§„çŸ©ï¼Œé—»å…¶åä¸å¦‚çœ‹å…¶å›¾ã€‚å¤š Reactor å¤šè¿›ç¨‹ / çº¿ç¨‹æ–¹æ¡ˆçš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼ˆä»¥çº¿ç¨‹ä¸ºä¾‹ï¼‰ï¼š æ–¹æ¡ˆè¯¦ç»†è¯´æ˜å¦‚ä¸‹ï¼š\nä¸»çº¿ç¨‹ä¸­çš„ MainReactor å¯¹è±¡é€šè¿‡ select ç›‘æ§è¿æ¥å»ºç«‹äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åé€šè¿‡ Acceptor å¯¹è±¡ä¸­çš„ accept è·å–è¿æ¥ï¼Œå°†æ–°çš„è¿æ¥åˆ†é…ç»™æŸä¸ªå­çº¿ç¨‹ï¼› å­çº¿ç¨‹ä¸­çš„ SubReactor å¯¹è±¡å°† MainReactor å¯¹è±¡åˆ†é…çš„è¿æ¥åŠ å…¥ select ç»§ç»­è¿›è¡Œç›‘å¬ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª Handler ç”¨äºå¤„ç†è¿æ¥çš„å“åº”äº‹ä»¶ã€‚ å¦‚æœæœ‰æ–°çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒSubReactor å¯¹è±¡ä¼šè°ƒç”¨å½“å‰è¿æ¥å¯¹åº”çš„ Handler å¯¹è±¡æ¥è¿›è¡Œå“åº”ã€‚ Handler å¯¹è±¡é€šè¿‡ read -\u0026gt; ä¸šåŠ¡å¤„ç† -\u0026gt; send çš„æµç¨‹æ¥å®Œæˆå®Œæ•´çš„ä¸šåŠ¡æµç¨‹ã€‚ å¤š Reactor å¤šçº¿ç¨‹çš„æ–¹æ¡ˆè™½ç„¶çœ‹èµ·æ¥å¤æ‚çš„ï¼Œä½†æ˜¯å®é™…å®ç°æ—¶æ¯”å• Reactor å¤šçº¿ç¨‹çš„æ–¹æ¡ˆè¦ç®€å•çš„å¤šï¼ŒåŸå› å¦‚ä¸‹ï¼š\nä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹åˆ†å·¥æ˜ç¡®ï¼Œä¸»çº¿ç¨‹åªè´Ÿè´£æ¥æ”¶æ–°è¿æ¥ï¼Œå­çº¿ç¨‹è´Ÿè´£å®Œæˆåç»­çš„ä¸šåŠ¡å¤„ç†ã€‚ ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹çš„äº¤äº’å¾ˆç®€å•ï¼Œä¸»çº¿ç¨‹åªéœ€è¦æŠŠæ–°è¿æ¥ä¼ ç»™å­çº¿ç¨‹ï¼Œå­çº¿ç¨‹æ— é¡»è¿”å›æ•°æ®ï¼Œç›´æ¥å°±å¯ä»¥åœ¨å­çº¿ç¨‹å°†å¤„ç†ç»“æœå‘é€ç»™å®¢æˆ·ç«¯ã€‚ å¤§åé¼é¼çš„ä¸¤ä¸ªå¼€æºè½¯ä»¶ Netty å’Œ Memcache éƒ½é‡‡ç”¨äº†ã€Œå¤š Reactor å¤šçº¿ç¨‹ã€çš„æ–¹æ¡ˆã€‚\né‡‡ç”¨äº†ã€Œå¤š Reactor å¤šè¿›ç¨‹ã€æ–¹æ¡ˆçš„å¼€æºè½¯ä»¶æ˜¯ Nginxï¼Œä¸è¿‡æ–¹æ¡ˆä¸æ ‡å‡†çš„å¤š Reactor å¤šè¿›ç¨‹æœ‰äº›å·®å¼‚ã€‚\nå…·ä½“å·®å¼‚è¡¨ç°åœ¨ä¸»è¿›ç¨‹ä¸­ä»…ä»…ç”¨æ¥åˆå§‹åŒ– socketï¼Œå¹¶æ²¡æœ‰åˆ›å»º mainReactor æ¥ accept è¿æ¥ï¼Œè€Œæ˜¯ç”±å­è¿›ç¨‹çš„ Reactor æ¥ accept è¿æ¥ï¼Œé€šè¿‡é”æ¥æ§åˆ¶ä¸€æ¬¡åªæœ‰ä¸€ä¸ªå­è¿›ç¨‹è¿›è¡Œ acceptï¼ˆé˜²æ­¢å‡ºç°æƒŠç¾¤ç°è±¡ï¼‰ï¼Œå­è¿›ç¨‹ accept æ–°è¿æ¥åå°±æ”¾åˆ°è‡ªå·±çš„ Reactor è¿›è¡Œå¤„ç†ï¼Œä¸ä¼šå†åˆ†é…ç»™å…¶ä»–å­è¿›ç¨‹ã€‚\nProactor å‰é¢æåˆ°çš„ Reactor æ˜¯éé˜»å¡åŒæ­¥ç½‘ç»œæ¨¡å¼ï¼Œè€Œ Proactor æ˜¯å¼‚æ­¥ç½‘ç»œæ¨¡å¼ã€‚\nè¿™é‡Œå…ˆç»™å¤§å®¶å¤ä¹ ä¸‹é˜»å¡ã€éé˜»å¡ã€åŒæ­¥ã€å¼‚æ­¥ I/O çš„æ¦‚å¿µã€‚\nå…ˆæ¥çœ‹çœ‹é˜»å¡ I/Oï¼Œå½“ç”¨æˆ·ç¨‹åºæ‰§è¡Œ read ï¼Œçº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œä¸€ç›´ç­‰åˆ°å†…æ ¸æ•°æ®å‡†å¤‡å¥½ï¼Œå¹¶æŠŠæ•°æ®ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°åº”ç”¨ç¨‹åºçš„ç¼“å†²åŒºä¸­ï¼Œå½“æ‹·è´è¿‡ç¨‹å®Œæˆï¼Œread æ‰ä¼šè¿”å›ã€‚\næ³¨æ„ï¼Œé˜»å¡ç­‰å¾…çš„æ˜¯ã€Œå†…æ ¸æ•°æ®å‡†å¤‡å¥½ã€å’Œã€Œæ•°æ®ä»å†…æ ¸æ€æ‹·è´åˆ°ç”¨æˆ·æ€ã€è¿™ä¸¤ä¸ªè¿‡ç¨‹ã€‚è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š çŸ¥é“äº†é˜»å¡ I/O ï¼Œæ¥çœ‹çœ‹éé˜»å¡ I/Oï¼Œéé˜»å¡çš„ read è¯·æ±‚åœ¨æ•°æ®æœªå‡†å¤‡å¥½çš„æƒ…å†µä¸‹ç«‹å³è¿”å›ï¼Œå¯ä»¥ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ­¤æ—¶åº”ç”¨ç¨‹åºä¸æ–­è½®è¯¢å†…æ ¸ï¼Œç›´åˆ°æ•°æ®å‡†å¤‡å¥½ï¼Œå†…æ ¸å°†æ•°æ®æ‹·è´åˆ°åº”ç”¨ç¨‹åºç¼“å†²åŒºï¼Œread è°ƒç”¨æ‰å¯ä»¥è·å–åˆ°ç»“æœã€‚è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š æ³¨æ„ï¼Œè¿™é‡Œæœ€åä¸€æ¬¡ read è°ƒç”¨ï¼Œè·å–æ•°æ®çš„è¿‡ç¨‹ï¼Œæ˜¯ä¸€ä¸ªåŒæ­¥çš„è¿‡ç¨‹ï¼Œæ˜¯éœ€è¦ç­‰å¾…çš„è¿‡ç¨‹ã€‚è¿™é‡Œçš„åŒæ­¥æŒ‡çš„æ˜¯å†…æ ¸æ€çš„æ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç¨‹åºçš„ç¼“å­˜åŒºè¿™ä¸ªè¿‡ç¨‹ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœ socket è®¾ç½®äº† O_NONBLOCK æ ‡å¿—ï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºä½¿ç”¨çš„æ˜¯éé˜»å¡ I/O çš„æ–¹å¼è®¿é—®ï¼Œè€Œä¸åšä»»ä½•è®¾ç½®çš„è¯ï¼Œé»˜è®¤æ˜¯é˜»å¡ I/Oã€‚\nå› æ­¤ï¼Œæ— è®º read å’Œ send æ˜¯é˜»å¡ I/Oï¼Œè¿˜æ˜¯éé˜»å¡ I/O éƒ½æ˜¯åŒæ­¥è°ƒç”¨ã€‚å› ä¸ºåœ¨ read è°ƒç”¨æ—¶ï¼Œå†…æ ¸å°†æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´çš„è¿‡ç¨‹éƒ½æ˜¯éœ€è¦ç­‰å¾…çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¿‡ç¨‹æ˜¯åŒæ­¥çš„ï¼Œå¦‚æœå†…æ ¸å®ç°çš„æ‹·è´æ•ˆç‡ä¸é«˜ï¼Œread è°ƒç”¨å°±ä¼šåœ¨è¿™ä¸ªåŒæ­¥è¿‡ç¨‹ä¸­ç­‰å¾…æ¯”è¾ƒé•¿çš„æ—¶é—´ã€‚\nè€ŒçœŸæ­£çš„å¼‚æ­¥ I/O æ˜¯ã€Œå†…æ ¸æ•°æ®å‡†å¤‡å¥½ã€å’Œã€Œæ•°æ®ä»å†…æ ¸æ€æ‹·è´åˆ°ç”¨æˆ·æ€ã€è¿™ä¸¤ä¸ªè¿‡ç¨‹éƒ½ä¸ç”¨ç­‰å¾…ã€‚\nå½“æˆ‘ä»¬å‘èµ· aio_read ï¼ˆå¼‚æ­¥ I/Oï¼‰ ä¹‹åï¼Œå°±ç«‹å³è¿”å›ï¼Œå†…æ ¸è‡ªåŠ¨å°†æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œè¿™ä¸ªæ‹·è´è¿‡ç¨‹åŒæ ·æ˜¯å¼‚æ­¥çš„ï¼Œå†…æ ¸è‡ªåŠ¨å®Œæˆçš„ï¼Œå’Œå‰é¢çš„åŒæ­¥æ“ä½œä¸ä¸€æ ·ï¼Œåº”ç”¨ç¨‹åºå¹¶ä¸éœ€è¦ä¸»åŠ¨å‘èµ·æ‹·è´åŠ¨ä½œã€‚è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š ä¸¾ä¸ªä½ å»é¥­å ‚åƒé¥­çš„ä¾‹å­ï¼Œä½ å¥½æ¯”åº”ç”¨ç¨‹åºï¼Œé¥­å ‚å¥½æ¯”æ“ä½œç³»ç»Ÿã€‚ é˜»å¡ I/O å¥½æ¯”ï¼Œä½ å»é¥­å ‚åƒé¥­ï¼Œä½†æ˜¯é¥­å ‚çš„èœè¿˜æ²¡åšå¥½ï¼Œç„¶åä½ å°±ä¸€ç›´åœ¨é‚£é‡Œç­‰å•Šç­‰ï¼Œç­‰äº†å¥½é•¿ä¸€æ®µæ—¶é—´ç»ˆäºç­‰åˆ°é¥­å ‚é˜¿å§¨æŠŠèœç«¯äº†å‡ºæ¥ï¼ˆæ•°æ®å‡†å¤‡çš„è¿‡ç¨‹ï¼‰ï¼Œä½†æ˜¯ä½ è¿˜å¾—ç»§ç»­ç­‰é˜¿å§¨æŠŠèœï¼ˆå†…æ ¸ç©ºé—´ï¼‰æ‰“åˆ°ä½ çš„é¥­ç›’é‡Œï¼ˆç”¨æˆ·ç©ºé—´ï¼‰ï¼Œç»å†å®Œè¿™ä¸¤ä¸ªè¿‡ç¨‹ï¼Œä½ æ‰å¯ä»¥ç¦»å¼€ã€‚\néé˜»å¡ I/O å¥½æ¯”ï¼Œä½ å»äº†é¥­å ‚ï¼Œé—®é˜¿å§¨èœåšå¥½äº†æ²¡æœ‰ï¼Œé˜¿å§¨å‘Šè¯‰ä½ æ²¡ï¼Œä½ å°±ç¦»å¼€äº†ï¼Œè¿‡å‡ ååˆ†é’Ÿï¼Œä½ åˆæ¥é¥­å ‚é—®é˜¿å§¨ï¼Œé˜¿å§¨è¯´åšå¥½äº†ï¼Œäºæ˜¯é˜¿å§¨å¸®ä½ æŠŠèœæ‰“åˆ°ä½ çš„é¥­ç›’é‡Œï¼Œè¿™ä¸ªè¿‡ç¨‹ä½ æ˜¯å¾—ç­‰å¾…çš„ã€‚\nå¼‚æ­¥ I/O å¥½æ¯”ï¼Œä½ è®©é¥­å ‚é˜¿å§¨å°†èœåšå¥½å¹¶æŠŠèœæ‰“åˆ°é¥­ç›’é‡Œåï¼ŒæŠŠé¥­ç›’é€åˆ°ä½ é¢å‰ï¼Œæ•´ä¸ªè¿‡ç¨‹ä½ éƒ½ä¸éœ€è¦ä»»ä½•ç­‰å¾…ã€‚\nå¾ˆæ˜æ˜¾ï¼Œå¼‚æ­¥ I/O æ¯”åŒæ­¥ I/O æ€§èƒ½æ›´å¥½ï¼Œå› ä¸ºå¼‚æ­¥ I/O åœ¨ã€Œå†…æ ¸æ•°æ®å‡†å¤‡å¥½ã€å’Œã€Œæ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€è¿™ä¸¤ä¸ªè¿‡ç¨‹éƒ½ä¸ç”¨ç­‰å¾…ã€‚\nProactor æ­£æ˜¯é‡‡ç”¨äº†å¼‚æ­¥ I/O æŠ€æœ¯ï¼Œæ‰€ä»¥è¢«ç§°ä¸ºå¼‚æ­¥ç½‘ç»œæ¨¡å‹ã€‚\nç°åœ¨æˆ‘ä»¬å†æ¥ç†è§£ Reactor å’Œ Proactor çš„åŒºåˆ«ï¼Œå°±æ¯”è¾ƒæ¸…æ™°äº†ã€‚\nReactor æ˜¯éé˜»å¡åŒæ­¥ç½‘ç»œæ¨¡å¼ï¼Œæ„ŸçŸ¥çš„æ˜¯å°±ç»ªå¯è¯»å†™äº‹ä»¶ã€‚åœ¨æ¯æ¬¡æ„ŸçŸ¥åˆ°æœ‰äº‹ä»¶å‘ç”Ÿï¼ˆæ¯”å¦‚å¯è¯»å°±ç»ªäº‹ä»¶ï¼‰åï¼Œå°±éœ€è¦åº”ç”¨è¿›ç¨‹ä¸»åŠ¨è°ƒç”¨ read æ–¹æ³•æ¥å®Œæˆæ•°æ®çš„è¯»å–ï¼Œä¹Ÿå°±æ˜¯è¦åº”ç”¨è¿›ç¨‹ä¸»åŠ¨å°† socket æ¥æ”¶ç¼“å­˜ä¸­çš„æ•°æ®è¯»åˆ°åº”ç”¨è¿›ç¨‹å†…å­˜ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯åŒæ­¥çš„ï¼Œè¯»å–å®Œæ•°æ®ååº”ç”¨è¿›ç¨‹æ‰èƒ½å¤„ç†æ•°æ®ã€‚ Proactor æ˜¯å¼‚æ­¥ç½‘ç»œæ¨¡å¼ï¼Œ æ„ŸçŸ¥çš„æ˜¯å·²å®Œæˆçš„è¯»å†™äº‹ä»¶ã€‚åœ¨å‘èµ·å¼‚æ­¥è¯»å†™è¯·æ±‚æ—¶ï¼Œéœ€è¦ä¼ å…¥æ•°æ®ç¼“å†²åŒºçš„åœ°å€ï¼ˆç”¨æ¥å­˜æ”¾ç»“æœæ•°æ®ï¼‰ç­‰ä¿¡æ¯ï¼Œè¿™æ ·ç³»ç»Ÿå†…æ ¸æ‰å¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬æŠŠæ•°æ®çš„è¯»å†™å·¥ä½œå®Œæˆï¼Œè¿™é‡Œçš„è¯»å†™å·¥ä½œå…¨ç¨‹ç”±æ“ä½œç³»ç»Ÿæ¥åšï¼Œå¹¶ä¸éœ€è¦åƒ Reactor é‚£æ ·è¿˜éœ€è¦åº”ç”¨è¿›ç¨‹ä¸»åŠ¨å‘èµ· read/write æ¥è¯»å†™æ•°æ®ï¼Œæ“ä½œç³»ç»Ÿå®Œæˆè¯»å†™å·¥ä½œåï¼Œå°±ä¼šé€šçŸ¥åº”ç”¨è¿›ç¨‹ç›´æ¥å¤„ç†æ•°æ®ã€‚ å› æ­¤ï¼ŒReactor å¯ä»¥ç†è§£ä¸ºã€Œæ¥äº†äº‹ä»¶æ“ä½œç³»ç»Ÿé€šçŸ¥åº”ç”¨è¿›ç¨‹ï¼Œè®©åº”ç”¨è¿›ç¨‹æ¥å¤„ç†ã€ï¼Œè€Œ Proactor å¯ä»¥ç†è§£ä¸ºã€Œæ¥äº†äº‹ä»¶æ“ä½œç³»ç»Ÿæ¥å¤„ç†ï¼Œå¤„ç†å®Œå†é€šçŸ¥åº”ç”¨è¿›ç¨‹ã€ã€‚è¿™é‡Œçš„ã€Œäº‹ä»¶ã€å°±æ˜¯æœ‰æ–°è¿æ¥ã€æœ‰æ•°æ®å¯è¯»ã€æœ‰æ•°æ®å¯å†™çš„è¿™äº› I/O äº‹ä»¶è¿™é‡Œçš„ã€Œå¤„ç†ã€åŒ…å«ä»é©±åŠ¨è¯»å–åˆ°å†…æ ¸ä»¥åŠä»å†…æ ¸è¯»å–åˆ°ç”¨æˆ·ç©ºé—´ã€‚\nä¸¾ä¸ªå®é™…ç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼ŒReactor æ¨¡å¼å°±æ˜¯å¿«é€’å‘˜åœ¨æ¥¼ä¸‹ï¼Œç»™ä½ æ‰“ç”µè¯å‘Šè¯‰ä½ å¿«é€’åˆ°ä½ å®¶å°åŒºäº†ï¼Œä½ éœ€è¦è‡ªå·±ä¸‹æ¥¼æ¥æ‹¿å¿«é€’ã€‚è€Œåœ¨ Proactor æ¨¡å¼ä¸‹ï¼Œå¿«é€’å‘˜ç›´æ¥å°†å¿«é€’é€åˆ°ä½ å®¶é—¨å£ï¼Œç„¶åé€šçŸ¥ä½ ã€‚\næ— è®ºæ˜¯ Reactorï¼Œè¿˜æ˜¯ Proactorï¼Œéƒ½æ˜¯ä¸€ç§åŸºäºã€Œäº‹ä»¶åˆ†å‘ã€çš„ç½‘ç»œç¼–ç¨‹æ¨¡å¼ï¼ŒåŒºåˆ«åœ¨äº Reactor æ¨¡å¼æ˜¯åŸºäºã€Œå¾…å®Œæˆã€çš„ I/O äº‹ä»¶ï¼Œè€Œ Proactor æ¨¡å¼åˆ™æ˜¯åŸºäºã€Œå·²å®Œæˆã€çš„ I/O äº‹ä»¶ã€‚\næ¥ä¸‹æ¥ï¼Œä¸€èµ·çœ‹çœ‹ Proactor æ¨¡å¼çš„ç¤ºæ„å›¾ï¼š ä»‹ç»ä¸€ä¸‹ Proactor æ¨¡å¼çš„å·¥ä½œæµç¨‹ï¼š\nProactor Initiator è´Ÿè´£åˆ›å»º Proactor å’Œ Handler å¯¹è±¡ï¼Œå¹¶å°† Proactor å’Œ Handler éƒ½é€šè¿‡ Asynchronous Operation Processor æ³¨å†Œåˆ°å†…æ ¸ï¼› Asynchronous Operation Processor è´Ÿè´£å¤„ç†æ³¨å†Œè¯·æ±‚ï¼Œå¹¶å¤„ç† I/O æ“ä½œï¼› Asynchronous Operation Processor å®Œæˆ I/O æ“ä½œåé€šçŸ¥ Proactorï¼› Proactor æ ¹æ®ä¸åŒçš„äº‹ä»¶ç±»å‹å›è°ƒä¸åŒçš„ Handler è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼› Handler å®Œæˆä¸šåŠ¡å¤„ç†ï¼› å¯æƒœçš„æ˜¯ï¼Œåœ¨ Linux ä¸‹çš„å¼‚æ­¥ I/O æ˜¯ä¸å®Œå–„çš„ï¼Œ aio ç³»åˆ—å‡½æ•°æ˜¯ç”± POSIX å®šä¹‰çš„å¼‚æ­¥æ“ä½œæ¥å£ï¼Œä¸æ˜¯çœŸæ­£çš„æ“ä½œç³»ç»Ÿçº§åˆ«æ”¯æŒçš„ï¼Œè€Œæ˜¯åœ¨ç”¨æˆ·ç©ºé—´æ¨¡æ‹Ÿå‡ºæ¥çš„å¼‚æ­¥ï¼Œå¹¶ä¸”ä»…ä»…æ”¯æŒåŸºäºæœ¬åœ°æ–‡ä»¶çš„ aio å¼‚æ­¥æ“ä½œï¼Œç½‘ç»œç¼–ç¨‹ä¸­çš„ socket æ˜¯ä¸æ”¯æŒçš„ï¼Œè¿™ä¹Ÿä½¿å¾—åŸºäº Linux çš„é«˜æ€§èƒ½ç½‘ç»œç¨‹åºéƒ½æ˜¯ä½¿ç”¨ Reactor æ–¹æ¡ˆã€‚\nè€Œ Windows é‡Œå®ç°äº†ä¸€å¥—å®Œæ•´çš„æ”¯æŒ socket çš„å¼‚æ­¥ç¼–ç¨‹æ¥å£ï¼Œè¿™å¥—æ¥å£å°±æ˜¯ IOCPï¼Œæ˜¯ç”±æ“ä½œç³»ç»Ÿçº§åˆ«å®ç°çš„å¼‚æ­¥ I/Oï¼ŒçœŸæ­£æ„ä¹‰ä¸Šå¼‚æ­¥ I/Oï¼Œå› æ­¤åœ¨ Windows é‡Œå®ç°é«˜æ€§èƒ½ç½‘ç»œç¨‹åºå¯ä»¥ä½¿ç”¨æ•ˆç‡æ›´é«˜çš„ Proactor æ–¹æ¡ˆã€‚\næ€»ç»“ å¸¸è§çš„ Reactor å®ç°æ–¹æ¡ˆæœ‰ä¸‰ç§ã€‚\nç¬¬ä¸€ç§æ–¹æ¡ˆå• Reactor å•è¿›ç¨‹ / çº¿ç¨‹ï¼Œä¸ç”¨è€ƒè™‘è¿›ç¨‹é—´é€šä¿¡ä»¥åŠæ•°æ®åŒæ­¥çš„é—®é¢˜ï¼Œå› æ­¤å®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œè¿™ç§æ–¹æ¡ˆçš„ç¼ºé™·åœ¨äºæ— æ³•å……åˆ†åˆ©ç”¨å¤šæ ¸ CPUï¼Œè€Œä¸”å¤„ç†ä¸šåŠ¡é€»è¾‘çš„æ—¶é—´ä¸èƒ½å¤ªé•¿ï¼Œå¦åˆ™ä¼šå»¶è¿Ÿå“åº”ï¼Œæ‰€ä»¥ä¸é€‚ç”¨äºè®¡ç®—æœºå¯†é›†å‹çš„åœºæ™¯ï¼Œé€‚ç”¨äºä¸šåŠ¡å¤„ç†å¿«é€Ÿçš„åœºæ™¯ï¼Œæ¯”å¦‚ Redisï¼ˆ6.0ä¹‹å‰ ï¼‰ é‡‡ç”¨çš„æ˜¯å• Reactor å•è¿›ç¨‹çš„æ–¹æ¡ˆã€‚ ç¬¬äºŒç§æ–¹æ¡ˆå• Reactor å¤šçº¿ç¨‹ï¼Œé€šè¿‡å¤šçº¿ç¨‹çš„æ–¹å¼è§£å†³äº†æ–¹æ¡ˆä¸€çš„ç¼ºé™·ï¼Œä½†å®ƒç¦»é«˜å¹¶å‘è¿˜å·®ä¸€ç‚¹è·ç¦»ï¼Œå·®åœ¨åªæœ‰ä¸€ä¸ª Reactor å¯¹è±¡æ¥æ‰¿æ‹…æ‰€æœ‰äº‹ä»¶çš„ç›‘å¬å’Œå“åº”ï¼Œè€Œä¸”åªåœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œï¼Œåœ¨é¢å¯¹ç¬é—´é«˜å¹¶å‘çš„åœºæ™¯æ—¶ï¼Œå®¹æ˜“æˆä¸ºæ€§èƒ½çš„ç“¶é¢ˆçš„åœ°æ–¹ã€‚ ç¬¬ä¸‰ç§æ–¹æ¡ˆå¤š Reactor å¤šè¿›ç¨‹ / çº¿ç¨‹ï¼Œé€šè¿‡å¤šä¸ª Reactor æ¥è§£å†³äº†æ–¹æ¡ˆäºŒçš„ç¼ºé™·ï¼Œä¸» Reactor åªè´Ÿè´£ç›‘å¬äº‹ä»¶ï¼Œå“åº”äº‹ä»¶çš„å·¥ä½œäº¤ç»™äº†ä» Reactorï¼ŒNetty å’Œ Memcache éƒ½é‡‡ç”¨äº†ã€Œå¤š Reactor å¤šçº¿ç¨‹ã€çš„æ–¹æ¡ˆï¼ŒNginx åˆ™é‡‡ç”¨äº†ç±»ä¼¼äº ã€Œå¤š Reactor å¤šè¿›ç¨‹ã€çš„æ–¹æ¡ˆã€‚ Reactor å¯ä»¥ç†è§£ä¸ºã€Œæ¥äº†äº‹ä»¶æ“ä½œç³»ç»Ÿé€šçŸ¥åº”ç”¨è¿›ç¨‹ï¼Œè®©åº”ç”¨è¿›ç¨‹æ¥å¤„ç†ã€ï¼Œè€Œ Proactor å¯ä»¥ç†è§£ä¸ºã€Œæ¥äº†äº‹ä»¶æ“ä½œç³»ç»Ÿæ¥å¤„ç†ï¼Œå¤„ç†å®Œå†é€šçŸ¥åº”ç”¨è¿›ç¨‹ã€ã€‚\nå› æ­¤ï¼ŒçœŸæ­£çš„å¤§æ€å™¨è¿˜æ˜¯ Proactorï¼Œå®ƒæ˜¯é‡‡ç”¨å¼‚æ­¥ I/O å®ç°çš„å¼‚æ­¥ç½‘ç»œæ¨¡å‹ï¼Œæ„ŸçŸ¥çš„æ˜¯å·²å®Œæˆçš„è¯»å†™äº‹ä»¶ï¼Œè€Œä¸éœ€è¦åƒ Reactor æ„ŸçŸ¥åˆ°äº‹ä»¶åï¼Œè¿˜éœ€è¦è°ƒç”¨ read æ¥ä»å†…æ ¸ä¸­è·å–æ•°æ®ã€‚\nä¸è¿‡ï¼Œæ— è®ºæ˜¯ Reactorï¼Œè¿˜æ˜¯ Proactorï¼Œéƒ½æ˜¯ä¸€ç§åŸºäºã€Œäº‹ä»¶åˆ†å‘ã€çš„ç½‘ç»œç¼–ç¨‹æ¨¡å¼ï¼ŒåŒºåˆ«åœ¨äº Reactor æ¨¡å¼æ˜¯åŸºäºã€Œå¾…å®Œæˆã€çš„ I/O äº‹ä»¶ï¼Œè€Œ Proactor æ¨¡å¼åˆ™æ˜¯åŸºäºã€Œå·²å®Œæˆã€çš„ I/O äº‹ä»¶ã€‚\n","permalink":"https://reid00.github.io/en/posts/os_network/%E9%AB%98%E6%80%A7%E8%83%BD%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F-reactor-proactor/","summary":"åˆ«å°çœ‹è¿™ä¸¤ä¸ªä¸œè¥¿ï¼Œç‰¹åˆ«æ˜¯ Reactor æ¨¡å¼ï¼Œå¸‚é¢ä¸Šå¸¸è§çš„å¼€æºè½¯ä»¶å¾ˆå¤šéƒ½é‡‡ç”¨äº†è¿™ä¸ªæ–¹æ¡ˆï¼Œæ¯”å¦‚ Redisã€Nginxã€Netty ç­‰ç­‰ï¼Œæ‰€ä»¥å­¦å¥½è¿™ä¸ªæ¨¡å¼è®¾è®¡çš„æ€æƒ³ï¼Œæœ‰åŠ©äºæˆ‘ä»¬ç†è§£å¾ˆå¤šå¼€æºè½¯ä»¶ã€‚\næ¼”è¿› å¦‚æœè¦è®©æœåŠ¡å™¨æœåŠ¡å¤šä¸ªå®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆæœ€ç›´æ¥çš„æ–¹å¼å°±æ˜¯ä¸ºæ¯ä¸€æ¡è¿æ¥åˆ›å»ºçº¿ç¨‹ã€‚\nå…¶å®åˆ›å»ºè¿›ç¨‹ä¹Ÿæ˜¯å¯ä»¥çš„ï¼ŒåŸç†æ˜¯ä¸€æ ·çš„ï¼Œè¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«åœ¨äºçº¿ç¨‹æ¯”è¾ƒè½»é‡çº§äº›ï¼Œçº¿ç¨‹çš„åˆ›å»ºå’Œçº¿ç¨‹é—´åˆ‡æ¢çš„æˆæœ¬è¦å°äº›ï¼Œä¸ºäº†æè¿°ç®€è¿°ï¼Œåé¢éƒ½ä»¥çº¿ç¨‹ä¸ºä¾‹ã€‚\nå¤„ç†å®Œä¸šåŠ¡é€»è¾‘åï¼Œéšç€è¿æ¥å…³é—­åçº¿ç¨‹ä¹ŸåŒæ ·è¦é”€æ¯äº†ï¼Œä½†æ˜¯è¿™æ ·ä¸åœåœ°åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ï¼Œä¸ä»…ä¼šå¸¦æ¥æ€§èƒ½å¼€é”€ï¼Œä¹Ÿä¼šé€ æˆæµªè´¹èµ„æºï¼Œè€Œä¸”å¦‚æœè¦è¿æ¥å‡ ä¸‡æ¡è¿æ¥ï¼Œåˆ›å»ºå‡ ä¸‡ä¸ªçº¿ç¨‹å»åº”å¯¹ä¹Ÿæ˜¯ä¸ç°å®çš„ã€‚\nè¦è¿™ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ã€Œèµ„æºå¤ç”¨ã€çš„æ–¹å¼ã€‚\nä¹Ÿå°±æ˜¯ä¸ç”¨å†ä¸ºæ¯ä¸ªè¿æ¥åˆ›å»ºçº¿ç¨‹ï¼Œè€Œæ˜¯åˆ›å»ºä¸€ä¸ªã€Œçº¿ç¨‹æ± ã€ï¼Œå°†è¿æ¥åˆ†é…ç»™çº¿ç¨‹ï¼Œç„¶åä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†å¤šä¸ªè¿æ¥çš„ä¸šåŠ¡ã€‚\nä¸è¿‡ï¼Œè¿™æ ·åˆå¼•æ¥ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œçº¿ç¨‹æ€æ ·æ‰èƒ½é«˜æ•ˆåœ°å¤„ç†å¤šä¸ªè¿æ¥çš„ä¸šåŠ¡ï¼Ÿ\nå½“ä¸€ä¸ªè¿æ¥å¯¹åº”ä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œçº¿ç¨‹ä¸€èˆ¬é‡‡ç”¨ã€Œread -\u0026gt; ä¸šåŠ¡å¤„ç† -\u0026gt; sendã€çš„å¤„ç†æµç¨‹ï¼Œå¦‚æœå½“å‰è¿æ¥æ²¡æœ‰æ•°æ®å¯è¯»ï¼Œé‚£ä¹ˆçº¿ç¨‹ä¼šé˜»å¡åœ¨ read æ“ä½œä¸Šï¼ˆ socket é»˜è®¤æƒ…å†µæ˜¯é˜»å¡ I/Oï¼‰ï¼Œä¸è¿‡è¿™ç§é˜»å¡æ–¹å¼å¹¶ä¸å½±å“å…¶ä»–çº¿ç¨‹ã€‚\nä½†æ˜¯å¼•å…¥äº†çº¿ç¨‹æ± ï¼Œé‚£ä¹ˆä¸€ä¸ªçº¿ç¨‹è¦å¤„ç†å¤šä¸ªè¿æ¥çš„ä¸šåŠ¡ï¼Œçº¿ç¨‹åœ¨å¤„ç†æŸä¸ªè¿æ¥çš„ read æ“ä½œæ—¶ï¼Œå¦‚æœé‡åˆ°æ²¡æœ‰æ•°æ®å¯è¯»ï¼Œå°±ä¼šå‘ç”Ÿé˜»å¡ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±æ²¡åŠæ³•ç»§ç»­å¤„ç†å…¶ä»–è¿æ¥çš„ä¸šåŠ¡ã€‚\nè¦è§£å†³è¿™ä¸€ä¸ªé—®é¢˜ï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å°† socket æ”¹æˆéé˜»å¡ï¼Œç„¶åçº¿ç¨‹ä¸æ–­åœ°è½®è¯¢è°ƒç”¨ read æ“ä½œæ¥åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®ï¼Œè¿™ç§æ–¹å¼è™½ç„¶è¯¥èƒ½å¤Ÿè§£å†³é˜»å¡çš„é—®é¢˜ï¼Œä½†æ˜¯è§£å†³çš„æ–¹å¼æ¯”è¾ƒç²—æš´ï¼Œå› ä¸ºè½®è¯¢æ˜¯è¦æ¶ˆè€— CPU çš„ï¼Œè€Œä¸”éšç€ä¸€ä¸ª çº¿ç¨‹å¤„ç†çš„è¿æ¥è¶Šå¤šï¼Œè½®è¯¢çš„æ•ˆç‡å°±ä¼šè¶Šä½ã€‚\nä¸Šé¢çš„é—®é¢˜åœ¨äºï¼Œçº¿ç¨‹å¹¶ä¸çŸ¥é“å½“å‰è¿æ¥æ˜¯å¦æœ‰æ•°æ®å¯è¯»ï¼Œä»è€Œéœ€è¦æ¯æ¬¡é€šè¿‡ read å»è¯•æ¢ã€‚\né‚£æœ‰æ²¡æœ‰åŠæ³•åœ¨åªæœ‰å½“è¿æ¥ä¸Šæœ‰æ•°æ®çš„æ—¶å€™ï¼Œçº¿ç¨‹æ‰å»å‘èµ·è¯»è¯·æ±‚å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œå®ç°è¿™ä¸€æŠ€æœ¯çš„å°±æ˜¯ I/O å¤šè·¯å¤ç”¨ã€‚\nI/O å¤šè·¯å¤ç”¨æŠ€æœ¯ä¼šç”¨ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°æ¥ç›‘å¬æˆ‘ä»¬æ‰€æœ‰å…³å¿ƒçš„è¿æ¥ï¼Œä¹Ÿå°±è¯´å¯ä»¥åœ¨ä¸€ä¸ªç›‘æ§çº¿ç¨‹é‡Œé¢ç›‘æ§å¾ˆå¤šçš„è¿æ¥ã€‚\næˆ‘ä»¬ç†Ÿæ‚‰çš„ select/poll/epoll å°±æ˜¯å†…æ ¸æä¾›ç»™ç”¨æˆ·æ€çš„å¤šè·¯å¤ç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œçº¿ç¨‹å¯ä»¥é€šè¿‡ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°ä»å†…æ ¸ä¸­è·å–å¤šä¸ªäº‹ä»¶ã€‚\nselect/poll/epoll æ˜¯å¦‚ä½•è·å–ç½‘ç»œäº‹ä»¶çš„å‘¢ï¼Ÿ\nåœ¨è·å–äº‹ä»¶æ—¶ï¼Œå…ˆæŠŠæˆ‘ä»¬è¦å…³å¿ƒçš„è¿æ¥ä¼ ç»™å†…æ ¸ï¼Œå†ç”±å†…æ ¸æ£€æµ‹ï¼š\nå¦‚æœæ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼Œçº¿ç¨‹åªéœ€é˜»å¡åœ¨è¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œè€Œæ— éœ€åƒå‰é¢çš„çº¿ç¨‹æ± æ–¹æ¡ˆé‚£æ ·è½®è®­è°ƒç”¨ read æ“ä½œæ¥åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®ã€‚ å¦‚æœæœ‰äº‹ä»¶å‘ç”Ÿï¼Œå†…æ ¸ä¼šè¿”å›äº§ç”Ÿäº†äº‹ä»¶çš„è¿æ¥ï¼Œçº¿ç¨‹å°±ä¼šä»é˜»å¡çŠ¶æ€è¿”å›ï¼Œç„¶ååœ¨ç”¨æˆ·æ€ä¸­å†å¤„ç†è¿™äº›è¿æ¥å¯¹åº”çš„ä¸šåŠ¡å³å¯ã€‚ å½“ä¸‹å¼€æºè½¯ä»¶èƒ½åšåˆ°ç½‘ç»œé«˜æ€§èƒ½çš„åŸå› å°±æ˜¯ I/O å¤šè·¯å¤ç”¨å—ï¼Ÿ\næ˜¯çš„ï¼ŒåŸºæœ¬æ˜¯åŸºäº I/O å¤šè·¯å¤ç”¨ï¼Œç”¨è¿‡ I/O å¤šè·¯å¤ç”¨æ¥å£å†™ç½‘ç»œç¨‹åºçš„åŒå­¦ï¼Œè‚¯å®šçŸ¥é“æ˜¯é¢å‘è¿‡ç¨‹çš„æ–¹å¼å†™ä»£ç çš„ï¼Œè¿™æ ·çš„å¼€å‘çš„æ•ˆç‡ä¸é«˜ã€‚\näºæ˜¯ï¼Œå¤§ä½¬ä»¬åŸºäºé¢å‘å¯¹è±¡çš„æ€æƒ³ï¼Œå¯¹ I/O å¤šè·¯å¤ç”¨ä½œäº†ä¸€å±‚å°è£…ï¼Œè®©ä½¿ç”¨è€…ä¸ç”¨è€ƒè™‘åº•å±‚ç½‘ç»œ API çš„ç»†èŠ‚ï¼Œåªéœ€è¦å…³æ³¨åº”ç”¨ä»£ç çš„ç¼–å†™ã€‚\nå¤§ä½¬ä»¬è¿˜ä¸ºè¿™ç§æ¨¡å¼å–äº†ä¸ªè®©äººç¬¬ä¸€æ—¶é—´éš¾ä»¥ç†è§£çš„åå­—ï¼šReactor æ¨¡å¼ã€‚\nReactor ç¿»è¯‘è¿‡æ¥çš„æ„æ€æ˜¯ã€Œååº”å †ã€ï¼Œå¯èƒ½å¤§å®¶ä¼šè”æƒ³åˆ°ç‰©ç†å­¦é‡Œçš„æ ¸ååº”å †ï¼Œå®é™…ä¸Šå¹¶ä¸æ˜¯çš„è¿™ä¸ªæ„æ€ã€‚\nè¿™é‡Œçš„ååº”æŒ‡çš„æ˜¯ã€Œå¯¹äº‹ä»¶ååº”ã€ï¼Œä¹Ÿå°±æ˜¯æ¥äº†ä¸€ä¸ªäº‹ä»¶ï¼ŒReactor å°±æœ‰ç›¸å¯¹åº”çš„ååº”/å“åº”ã€‚","title":"é«˜æ€§èƒ½ç½‘ç»œæ¨¡å¼: Reactor Proactor"},{"content":"æœ€åŸºæœ¬çš„ Socket æ¨¡å‹ è¦æƒ³å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨èƒ½åœ¨ç½‘ç»œä¸­é€šä¿¡ï¼Œé‚£å¿…é¡»å¾—ä½¿ç”¨ Socket ç¼–ç¨‹ï¼Œå®ƒæ˜¯è¿›ç¨‹é—´é€šä¿¡é‡Œæ¯”è¾ƒç‰¹åˆ«çš„æ–¹å¼ï¼Œç‰¹åˆ«ä¹‹å¤„åœ¨äºå®ƒæ˜¯å¯ä»¥è·¨ä¸»æœºé—´é€šä¿¡ã€‚\nSocket çš„ä¸­æ–‡åå«ä½œæ’å£ï¼Œå’‹ä¸€çœ‹è¿˜æŒºè¿·æƒ‘çš„ã€‚äº‹å®ä¸Šï¼ŒåŒæ–¹è¦è¿›è¡Œç½‘ç»œé€šä¿¡å‰ï¼Œå„è‡ªå¾—åˆ›å»ºä¸€ä¸ª Socketï¼Œè¿™ç›¸å½“äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¼€äº†ä¸€ä¸ªâ€œå£å­â€ï¼ŒåŒæ–¹è¯»å–å’Œå‘é€æ•°æ®çš„æ—¶å€™ï¼Œéƒ½é€šè¿‡è¿™ä¸ªâ€œå£å­â€ã€‚è¿™æ ·ä¸€çœ‹ï¼Œæ˜¯ä¸æ˜¯è§‰å¾—å¾ˆåƒå¼„äº†ä¸€æ ¹ç½‘çº¿ï¼Œä¸€å¤´æ’åœ¨å®¢æˆ·ç«¯ï¼Œä¸€å¤´æ’åœ¨æœåŠ¡ç«¯ï¼Œç„¶åè¿›è¡Œé€šä¿¡ã€‚\nåˆ›å»º Socket çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šç½‘ç»œå±‚ä½¿ç”¨çš„æ˜¯ IPv4 è¿˜æ˜¯ IPv6ï¼Œä¼ è¾“å±‚ä½¿ç”¨çš„æ˜¯ TCP è¿˜æ˜¯ UDPã€‚\nUDP çš„ Socket ç¼–ç¨‹ç›¸å¯¹ç®€å•äº›ï¼Œè¿™é‡Œæˆ‘ä»¬åªä»‹ç»åŸºäº TCP çš„ Socket ç¼–ç¨‹ã€‚\næœåŠ¡å™¨çš„ç¨‹åºè¦å…ˆè·‘èµ·æ¥ï¼Œç„¶åç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥å’Œæ•°æ®ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æœåŠ¡ç«¯çš„ Socket ç¼–ç¨‹è¿‡ç¨‹æ˜¯æ€æ ·çš„ã€‚\næœåŠ¡ç«¯é¦–å…ˆè°ƒç”¨ socket() å‡½æ•°ï¼Œåˆ›å»ºç½‘ç»œåè®®ä¸º IPv4ï¼Œä»¥åŠä¼ è¾“åè®®ä¸º TCP çš„ Socket ï¼Œæ¥ç€è°ƒç”¨ bind() å‡½æ•°ï¼Œç»™è¿™ä¸ª Socket ç»‘å®šä¸€ä¸ª IP åœ°å€å’Œç«¯å£ï¼Œç»‘å®šè¿™ä¸¤ä¸ªçš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ\nç»‘å®šç«¯å£çš„ç›®çš„ï¼šå½“å†…æ ¸æ”¶åˆ° TCP æŠ¥æ–‡ï¼Œé€šè¿‡ TCP å¤´é‡Œé¢çš„ç«¯å£å·ï¼Œæ¥æ‰¾åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œç„¶åæŠŠæ•°æ®ä¼ é€’ç»™æˆ‘ä»¬ã€‚ ç»‘å®š IP åœ°å€çš„ç›®çš„ï¼šä¸€å°æœºå™¨æ˜¯å¯ä»¥æœ‰å¤šä¸ªç½‘å¡çš„ï¼Œæ¯ä¸ªç½‘å¡éƒ½æœ‰å¯¹åº”çš„ IP åœ°å€ï¼Œå½“ç»‘å®šä¸€ä¸ªç½‘å¡æ—¶ï¼Œå†…æ ¸åœ¨æ”¶åˆ°è¯¥ç½‘å¡ä¸Šçš„åŒ…ï¼Œæ‰ä¼šå‘ç»™æˆ‘ä»¬ï¼› ç»‘å®šå®Œ IP åœ°å€å’Œç«¯å£åï¼Œå°±å¯ä»¥è°ƒç”¨ listen() å‡½æ•°è¿›è¡Œç›‘å¬ï¼Œæ­¤æ—¶å¯¹åº” TCP çŠ¶æ€å›¾ä¸­çš„ listenï¼Œå¦‚æœæˆ‘ä»¬è¦åˆ¤å®šæœåŠ¡å™¨ä¸­ä¸€ä¸ªç½‘ç»œç¨‹åºæœ‰æ²¡æœ‰å¯åŠ¨ï¼Œå¯ä»¥é€šè¿‡ netstat å‘½ä»¤æŸ¥çœ‹å¯¹åº”çš„ç«¯å£å·æ˜¯å¦æœ‰è¢«ç›‘å¬ã€‚\næœåŠ¡ç«¯è¿›å…¥äº†ç›‘å¬çŠ¶æ€åï¼Œé€šè¿‡è°ƒç”¨ accept() å‡½æ•°ï¼Œæ¥ä»å†…æ ¸è·å–å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå¦‚æœæ²¡æœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œåˆ™ä¼šé˜»å¡ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥çš„åˆ°æ¥ã€‚\né‚£å®¢æˆ·ç«¯æ˜¯æ€ä¹ˆå‘èµ·è¿æ¥çš„å‘¢ï¼Ÿå®¢æˆ·ç«¯åœ¨åˆ›å»ºå¥½ Socket åï¼Œè°ƒç”¨ connect() å‡½æ•°å‘èµ·è¿æ¥ï¼Œè¯¥å‡½æ•°çš„å‚æ•°è¦æŒ‡æ˜æœåŠ¡ç«¯çš„ IP åœ°å€å’Œç«¯å£å·ï¼Œç„¶åä¸‡ä¼—æœŸå¾…çš„ TCP ä¸‰æ¬¡æ¡æ‰‹å°±å¼€å§‹äº†ã€‚\nåœ¨ TCP è¿æ¥çš„è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨çš„å†…æ ¸å®é™…ä¸Šä¸ºæ¯ä¸ª Socket ç»´æŠ¤äº†ä¸¤ä¸ªé˜Ÿåˆ—ï¼š\nä¸€ä¸ªæ˜¯ã€Œè¿˜æ²¡å®Œå…¨å»ºç«‹ã€è¿æ¥çš„é˜Ÿåˆ—ï¼Œç§°ä¸º TCP åŠè¿æ¥é˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—éƒ½æ˜¯æ²¡æœ‰å®Œæˆä¸‰æ¬¡æ¡æ‰‹çš„è¿æ¥ï¼Œæ­¤æ—¶æœåŠ¡ç«¯å¤„äº syn_rcvd çš„çŠ¶æ€ï¼› ä¸€ä¸ªæ˜¯ã€Œå·²ç»å»ºç«‹ã€è¿æ¥çš„é˜Ÿåˆ—ï¼Œç§°ä¸º TCP å…¨è¿æ¥é˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—éƒ½æ˜¯å®Œæˆäº†ä¸‰æ¬¡æ¡æ‰‹çš„è¿æ¥ï¼Œæ­¤æ—¶æœåŠ¡ç«¯å¤„äº established çŠ¶æ€ï¼› å½“ TCP å…¨è¿æ¥é˜Ÿåˆ—ä¸ä¸ºç©ºåï¼ŒæœåŠ¡ç«¯çš„ accept() å‡½æ•°ï¼Œå°±ä¼šä»å†…æ ¸ä¸­çš„ TCP å…¨è¿æ¥é˜Ÿåˆ—é‡Œæ‹¿å‡ºä¸€ä¸ªå·²ç»å®Œæˆè¿æ¥çš„ Socket è¿”å›åº”ç”¨ç¨‹åºï¼Œåç»­æ•°æ®ä¼ è¾“éƒ½ç”¨è¿™ä¸ª Socketã€‚\næ³¨æ„ï¼Œç›‘å¬çš„ Socket å’ŒçœŸæ­£ç”¨æ¥ä¼ æ•°æ®çš„ Socket æ˜¯ä¸¤ä¸ªï¼š\nä¸€ä¸ªå«ä½œç›‘å¬ Socketï¼› ä¸€ä¸ªå«ä½œå·²è¿æ¥ Socketï¼› è¿æ¥å»ºç«‹åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å°±å¼€å§‹ç›¸äº’ä¼ è¾“æ•°æ®äº†ï¼ŒåŒæ–¹éƒ½å¯ä»¥é€šè¿‡ read() å’Œ write() å‡½æ•°æ¥è¯»å†™æ•°æ®ã€‚ è‡³æ­¤ï¼Œ TCP åè®®çš„ Socket ç¨‹åºçš„è°ƒç”¨è¿‡ç¨‹å°±ç»“æŸäº†ï¼Œæ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š çœ‹åˆ°è¿™ï¼Œä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰è§‰å¾—è¯»å†™ Socket çš„æ–¹å¼ï¼Œå¥½åƒè¯»å†™æ–‡ä»¶ä¸€æ ·ã€‚\næ˜¯çš„ï¼ŒåŸºäº Linux ä¸€åˆ‡çš†æ–‡ä»¶çš„ç†å¿µï¼Œåœ¨å†…æ ¸ä¸­ Socket ä¹Ÿæ˜¯ä»¥ã€Œæ–‡ä»¶ã€çš„å½¢å¼å­˜åœ¨çš„ï¼Œä¹Ÿæ˜¯æœ‰å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ã€‚\nå†…æ ¸éƒ¨åˆ† - æ–‡ä»¶æè¿°ç¬¦ æ–‡ä»¶æè¿°ç¬¦çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªæ•°æ®ç»“æ„ task_structï¼Œè¯¥ç»“æ„ä½“é‡Œæœ‰ä¸€ä¸ªæŒ‡å‘ã€Œæ–‡ä»¶æè¿°ç¬¦æ•°ç»„ã€çš„æˆå‘˜æŒ‡é’ˆã€‚è¯¥æ•°ç»„é‡Œåˆ—å‡ºè¿™ä¸ªè¿›ç¨‹æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ•°ç»„çš„ä¸‹æ ‡æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè€Œæ•°ç»„çš„å†…å®¹æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å†…æ ¸ä¸­æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶çš„åˆ—è¡¨ï¼Œä¹Ÿå°±æ˜¯è¯´å†…æ ¸å¯ä»¥é€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ‰¾åˆ°å¯¹åº”æ‰“å¼€çš„æ–‡ä»¶ã€‚\nç„¶åæ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ª inodeï¼ŒSocket æ–‡ä»¶çš„ inode æŒ‡å‘äº†å†…æ ¸ä¸­çš„ Socket ç»“æ„ï¼Œåœ¨è¿™ä¸ªç»“æ„ä½“é‡Œæœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œåˆ†åˆ«æ˜¯å‘é€é˜Ÿåˆ—å’Œæ¥æ”¶é˜Ÿåˆ—ï¼Œè¿™ä¸ªä¸¤ä¸ªé˜Ÿåˆ—é‡Œé¢ä¿å­˜çš„æ˜¯ä¸€ä¸ªä¸ª struct sk_buffï¼Œç”¨é“¾è¡¨çš„ç»„ç»‡å½¢å¼ä¸²èµ·æ¥ã€‚\nsk_buff å¯ä»¥è¡¨ç¤ºå„ä¸ªå±‚çš„æ•°æ®åŒ…ï¼Œåœ¨åº”ç”¨å±‚æ•°æ®åŒ…å« dataï¼Œåœ¨ TCP å±‚æˆ‘ä»¬ç§°ä¸º segmentï¼Œåœ¨ IP å±‚æˆ‘ä»¬å« packetï¼Œåœ¨æ•°æ®é“¾è·¯å±‚ç§°ä¸º frameã€‚\nä½ å¯èƒ½ä¼šå¥½å¥‡ï¼Œä¸ºä»€ä¹ˆå…¨éƒ¨æ•°æ®åŒ…åªç”¨ä¸€ä¸ªç»“æ„ä½“æ¥æè¿°å‘¢ï¼Ÿåè®®æ ˆé‡‡ç”¨çš„æ˜¯åˆ†å±‚ç»“æ„ï¼Œä¸Šå±‚å‘ä¸‹å±‚ä¼ é€’æ•°æ®æ—¶éœ€è¦å¢åŠ åŒ…å¤´ï¼Œä¸‹å±‚å‘ä¸Šå±‚æ•°æ®æ—¶åˆéœ€è¦å»æ‰åŒ…å¤´ï¼Œå¦‚æœæ¯ä¸€å±‚éƒ½ç”¨ä¸€ä¸ªç»“æ„ä½“ï¼Œé‚£åœ¨å±‚ä¹‹é—´ä¼ é€’æ•°æ®çš„æ—¶å€™ï¼Œå°±è¦å‘ç”Ÿå¤šæ¬¡æ‹·è´ï¼Œè¿™å°†å¤§å¤§é™ä½ CPU æ•ˆç‡ã€‚\näºæ˜¯ï¼Œä¸ºäº†åœ¨å±‚çº§ä¹‹é—´ä¼ é€’æ•°æ®æ—¶ï¼Œä¸å‘ç”Ÿæ‹·è´ï¼Œåªç”¨ sk_buff ä¸€ä¸ªç»“æ„ä½“æ¥æè¿°æ‰€æœ‰çš„ç½‘ç»œåŒ…ï¼Œé‚£å®ƒæ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿæ˜¯é€šè¿‡è°ƒæ•´ sk_buff ä¸­ data çš„æŒ‡é’ˆï¼Œæ¯”å¦‚ï¼š\nå½“æ¥æ”¶æŠ¥æ–‡æ—¶ï¼Œä»ç½‘å¡é©±åŠ¨å¼€å§‹ï¼Œé€šè¿‡åè®®æ ˆå±‚å±‚å¾€ä¸Šä¼ é€æ•°æ®æŠ¥ï¼Œé€šè¿‡å¢åŠ  skb-\u0026gt;data çš„å€¼ï¼Œæ¥é€æ­¥å‰¥ç¦»åè®®é¦–éƒ¨ã€‚\nå½“è¦å‘é€æŠ¥æ–‡æ—¶ï¼Œåˆ›å»º sk_buff ç»“æ„ä½“ï¼Œæ•°æ®ç¼“å­˜åŒºçš„å¤´éƒ¨é¢„ç•™è¶³å¤Ÿçš„ç©ºé—´ï¼Œç”¨æ¥å¡«å……å„å±‚é¦–éƒ¨ï¼Œåœ¨ç»è¿‡å„ä¸‹å±‚åè®®æ—¶ï¼Œé€šè¿‡å‡å°‘ skb-\u0026gt;data çš„å€¼æ¥å¢åŠ åè®®é¦–éƒ¨ã€‚ ä½ å¯ä»¥ä»ä¸‹é¢è¿™å¼ å›¾çœ‹åˆ°ï¼Œå½“å‘é€æŠ¥æ–‡æ—¶ï¼Œdata æŒ‡é’ˆçš„ç§»åŠ¨è¿‡ç¨‹ã€‚ å¦‚ä½•æœåŠ¡æ›´å¤šçš„ç”¨æˆ·ï¼Ÿ å‰é¢æåˆ°çš„ TCP Socket è°ƒç”¨æµç¨‹æ˜¯æœ€ç®€å•ã€æœ€åŸºæœ¬çš„ï¼Œå®ƒåŸºæœ¬åªèƒ½ä¸€å¯¹ä¸€é€šä¿¡ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯åŒæ­¥é˜»å¡çš„æ–¹å¼ï¼Œå½“æœåŠ¡ç«¯åœ¨è¿˜æ²¡å¤„ç†å®Œä¸€ä¸ªå®¢æˆ·ç«¯çš„ç½‘ç»œ I/O æ—¶ï¼Œæˆ–è€… è¯»å†™æ“ä½œå‘ç”Ÿé˜»å¡æ—¶ï¼Œå…¶ä»–å®¢æˆ·ç«¯æ˜¯æ— æ³•ä¸æœåŠ¡ç«¯è¿æ¥çš„ã€‚\nå¯å¦‚æœæˆ‘ä»¬æœåŠ¡å™¨åªèƒ½æœåŠ¡ä¸€ä¸ªå®¢æˆ·ï¼Œé‚£è¿™æ ·å°±å¤ªæµªè´¹èµ„æºäº†ï¼Œäºæ˜¯æˆ‘ä»¬è¦æ”¹è¿›è¿™ä¸ªç½‘ç»œ I/O æ¨¡å‹ï¼Œä»¥æ”¯æŒæ›´å¤šçš„å®¢æˆ·ç«¯ã€‚\nåœ¨æ”¹è¿›ç½‘ç»œ I/O æ¨¡å‹å‰ï¼Œæˆ‘å…ˆæ¥æä¸€ä¸ªé—®é¢˜ï¼Œä½ çŸ¥é“æœåŠ¡å™¨å•æœºç†è®ºæœ€å¤§èƒ½è¿æ¥å¤šå°‘ä¸ªå®¢æˆ·ç«¯ï¼Ÿ\nç›¸ä¿¡ä½ çŸ¥é“ TCP è¿æ¥æ˜¯ç”±å››å…ƒç»„å”¯ä¸€ç¡®è®¤çš„ï¼Œè¿™ä¸ªå››å…ƒç»„å°±æ˜¯ï¼šæœ¬æœºIP, æœ¬æœºç«¯å£, å¯¹ç«¯IP, å¯¹ç«¯ç«¯å£ã€‚\næœåŠ¡å™¨ä½œä¸ºæœåŠ¡æ–¹ï¼Œé€šå¸¸ä¼šåœ¨æœ¬åœ°å›ºå®šç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ã€‚å› æ­¤æœåŠ¡å™¨çš„æœ¬åœ° IP å’Œç«¯å£æ˜¯å›ºå®šçš„ï¼Œäºæ˜¯å¯¹äºæœåŠ¡ç«¯ TCP è¿æ¥çš„å››å…ƒç»„åªæœ‰å¯¹ç«¯ IP å’Œç«¯å£æ˜¯ä¼šå˜åŒ–çš„ï¼Œæ‰€ä»¥æœ€å¤§ TCP è¿æ¥æ•° = å®¢æˆ·ç«¯ IP æ•°Ã—å®¢æˆ·ç«¯ç«¯å£æ•°ã€‚\nå¯¹äº IPv4ï¼Œå®¢æˆ·ç«¯çš„ IP æ•°æœ€å¤šä¸º 2 çš„ 32 æ¬¡æ–¹ï¼Œå®¢æˆ·ç«¯çš„ç«¯å£æ•°æœ€å¤šä¸º 2 çš„ 16 æ¬¡æ–¹ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å•æœºæœ€å¤§ TCP è¿æ¥æ•°çº¦ä¸º 2 çš„ 48 æ¬¡æ–¹ã€‚\nè¿™ä¸ªç†è®ºå€¼ç›¸å½“â€œä¸°æ»¡â€ï¼Œä½†æ˜¯æœåŠ¡å™¨è‚¯å®šæ‰¿è½½ä¸äº†é‚£ä¹ˆå¤§çš„è¿æ¥æ•°ï¼Œä¸»è¦ä¼šå—ä¸¤ä¸ªæ–¹é¢çš„é™åˆ¶ï¼š\næ–‡ä»¶æè¿°ç¬¦ï¼ŒSocket å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå°±ä¼šå¯¹åº”ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚åœ¨ Linux ä¸‹ï¼Œå•ä¸ªè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°æ˜¯æœ‰é™åˆ¶çš„ï¼Œæ²¡æœ‰ç»è¿‡ä¿®æ”¹çš„å€¼ä¸€èˆ¬éƒ½æ˜¯ 1024ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡ ulimit å¢å¤§æ–‡ä»¶æè¿°ç¬¦çš„æ•°ç›®ï¼› ç³»ç»Ÿå†…å­˜ï¼Œæ¯ä¸ª TCP è¿æ¥åœ¨å†…æ ¸ä¸­éƒ½æœ‰å¯¹åº”çš„æ•°æ®ç»“æ„ï¼Œæ„å‘³ç€æ¯ä¸ªè¿æ¥éƒ½æ˜¯ä¼šå ç”¨ä¸€å®šå†…å­˜çš„ï¼› é‚£å¦‚æœæœåŠ¡å™¨çš„å†…å­˜åªæœ‰ 2 GBï¼Œç½‘å¡æ˜¯åƒå…†çš„ï¼Œèƒ½æ”¯æŒå¹¶å‘ 1 ä¸‡è¯·æ±‚å—ï¼Ÿ å¹¶å‘ 1 ä¸‡è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯ç»å…¸çš„ C10K é—®é¢˜ ï¼ŒC æ˜¯ Client å•è¯é¦–å­—æ¯ç¼©å†™ï¼ŒC10K å°±æ˜¯å•æœºåŒæ—¶å¤„ç† 1 ä¸‡ä¸ªè¯·æ±‚çš„é—®é¢˜ã€‚\nä»ç¡¬ä»¶èµ„æºè§’åº¦çœ‹ï¼Œå¯¹äº 2GB å†…å­˜åƒå…†ç½‘å¡çš„æœåŠ¡å™¨ï¼Œå¦‚æœæ¯ä¸ªè¯·æ±‚å¤„ç†å ç”¨ä¸åˆ° 200KB çš„å†…å­˜å’Œ 100Kbit çš„ç½‘ç»œå¸¦å®½å°±å¯ä»¥æ»¡è¶³å¹¶å‘ 1 ä¸‡ä¸ªè¯·æ±‚ã€‚\nä¸è¿‡ï¼Œè¦æƒ³çœŸæ­£å®ç° C10K çš„æœåŠ¡å™¨ï¼Œè¦è€ƒè™‘çš„åœ°æ–¹åœ¨äºæœåŠ¡å™¨çš„ç½‘ç»œ I/O æ¨¡å‹ï¼Œæ•ˆç‡ä½çš„æ¨¡å‹ï¼Œä¼šåŠ é‡ç³»ç»Ÿå¼€é”€ï¼Œä»è€Œä¼šç¦» C10K çš„ç›®æ ‡è¶Šæ¥è¶Šè¿œã€‚\nå¤šè¿›ç¨‹æ¨¡å‹ åŸºäºæœ€åŸå§‹çš„é˜»å¡ç½‘ç»œ I/Oï¼Œ å¦‚æœæœåŠ¡å™¨è¦æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯ï¼Œå…¶ä¸­æ¯”è¾ƒä¼ ç»Ÿçš„æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨å¤šè¿›ç¨‹æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ†é…ä¸€ä¸ªè¿›ç¨‹æ¥å¤„ç†è¯·æ±‚ã€‚\næœåŠ¡å™¨çš„ä¸»è¿›ç¨‹è´Ÿè´£ç›‘å¬å®¢æˆ·çš„è¿æ¥ï¼Œä¸€æ—¦ä¸å®¢æˆ·ç«¯è¿æ¥å®Œæˆï¼Œaccept() å‡½æ•°å°±ä¼šè¿”å›ä¸€ä¸ªã€Œå·²è¿æ¥ Socketã€ï¼Œè¿™æ—¶å°±é€šè¿‡ fork() å‡½æ•°åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå®é™…ä¸Šå°±æŠŠçˆ¶è¿›ç¨‹æ‰€æœ‰ç›¸å…³çš„ä¸œè¥¿éƒ½å¤åˆ¶ä¸€ä»½ï¼ŒåŒ…æ‹¬æ–‡ä»¶æè¿°ç¬¦ã€å†…å­˜åœ°å€ç©ºé—´ã€ç¨‹åºè®¡æ•°å™¨ã€æ‰§è¡Œçš„ä»£ç ç­‰ã€‚\nè¿™ä¸¤ä¸ªè¿›ç¨‹åˆšå¤åˆ¶å®Œçš„æ—¶å€™ï¼Œå‡ ä¹ä¸€æ¨¡ä¸€æ ·ã€‚ä¸è¿‡ï¼Œä¼šæ ¹æ®è¿”å›å€¼æ¥åŒºåˆ†æ˜¯çˆ¶è¿›ç¨‹è¿˜æ˜¯å­è¿›ç¨‹ï¼Œå¦‚æœè¿”å›å€¼æ˜¯ 0ï¼Œåˆ™æ˜¯å­è¿›ç¨‹ï¼›å¦‚æœè¿”å›å€¼æ˜¯å…¶ä»–çš„æ•´æ•°ï¼Œå°±æ˜¯çˆ¶è¿›ç¨‹ã€‚\næ­£å› ä¸ºå­è¿›ç¨‹ä¼šå¤åˆ¶çˆ¶è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œäºæ˜¯å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ã€Œå·²è¿æ¥ Socket ã€å’Œå®¢æˆ·ç«¯é€šä¿¡äº†ï¼Œ\nå¯ä»¥å‘ç°ï¼Œå­è¿›ç¨‹ä¸éœ€è¦å…³å¿ƒã€Œç›‘å¬ Socketã€ï¼Œåªéœ€è¦å…³å¿ƒã€Œå·²è¿æ¥ Socketã€ï¼›çˆ¶è¿›ç¨‹åˆ™ç›¸åï¼Œå°†å®¢æˆ·æœåŠ¡äº¤ç»™å­è¿›ç¨‹æ¥å¤„ç†ï¼Œå› æ­¤çˆ¶è¿›ç¨‹ä¸éœ€è¦å…³å¿ƒã€Œå·²è¿æ¥ Socketã€ï¼Œåªéœ€è¦å…³å¿ƒã€Œç›‘å¬ Socketã€ã€‚\nä¸‹é¢è¿™å¼ å›¾æè¿°äº†ä»è¿æ¥è¯·æ±‚åˆ°è¿æ¥å»ºç«‹ï¼Œçˆ¶è¿›ç¨‹åˆ›å»ºç”Ÿå­è¿›ç¨‹ä¸ºå®¢æˆ·æœåŠ¡ã€‚ å¦å¤–ï¼Œå½“ã€Œå­è¿›ç¨‹ã€é€€å‡ºæ—¶ï¼Œå®é™…ä¸Šå†…æ ¸é‡Œè¿˜ä¼šä¿ç•™è¯¥è¿›ç¨‹çš„ä¸€äº›ä¿¡æ¯ï¼Œä¹Ÿæ˜¯ä¼šå ç”¨å†…å­˜çš„ï¼Œå¦‚æœä¸åšå¥½â€œå›æ”¶â€å·¥ä½œï¼Œå°±ä¼šå˜æˆåƒµå°¸è¿›ç¨‹ï¼Œéšç€åƒµå°¸è¿›ç¨‹è¶Šå¤šï¼Œä¼šæ…¢æ…¢è€—å°½æˆ‘ä»¬çš„ç³»ç»Ÿèµ„æºã€‚\nå› æ­¤ï¼Œçˆ¶è¿›ç¨‹è¦â€œå–„åâ€å¥½è‡ªå·±çš„å­©å­ï¼Œæ€ä¹ˆå–„åå‘¢ï¼Ÿé‚£ä¹ˆæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥åœ¨å­è¿›ç¨‹é€€å‡ºåå›æ”¶èµ„æºï¼Œåˆ†åˆ«æ˜¯è°ƒç”¨ wait() å’Œ waitpid() å‡½æ•°ã€‚\nè¿™ç§ç”¨å¤šä¸ªè¿›ç¨‹æ¥åº”ä»˜å¤šä¸ªå®¢æˆ·ç«¯çš„æ–¹å¼ï¼Œåœ¨åº”å¯¹ 100 ä¸ªå®¢æˆ·ç«¯è¿˜æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å½“å®¢æˆ·ç«¯æ•°é‡é«˜è¾¾ä¸€ä¸‡æ—¶ï¼Œè‚¯å®šæ‰›ä¸ä½çš„ï¼Œå› ä¸ºæ¯äº§ç”Ÿä¸€ä¸ªè¿›ç¨‹ï¼Œå¿…ä¼šå æ®ä¸€å®šçš„ç³»ç»Ÿèµ„æºï¼Œè€Œä¸”è¿›ç¨‹é—´ä¸Šä¸‹æ–‡åˆ‡æ¢çš„â€œåŒ…è¢±â€æ˜¯å¾ˆé‡çš„ï¼Œæ€§èƒ½ä¼šå¤§æ‰“æŠ˜æ‰£ã€‚\nè¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸ä»…åŒ…å«äº†è™šæ‹Ÿå†…å­˜ã€æ ˆã€å…¨å±€å˜é‡ç­‰ç”¨æˆ·ç©ºé—´çš„èµ„æºï¼Œè¿˜åŒ…æ‹¬äº†å†…æ ¸å †æ ˆã€å¯„å­˜å™¨ç­‰å†…æ ¸ç©ºé—´çš„èµ„æºã€‚\nå¤šçº¿ç¨‹æ¨¡å‹ æ—¢ç„¶è¿›ç¨‹é—´ä¸Šä¸‹æ–‡åˆ‡æ¢çš„â€œåŒ…è¢±â€å¾ˆé‡ï¼Œé‚£æˆ‘ä»¬å°±æä¸ªæ¯”è¾ƒè½»é‡çº§çš„æ¨¡å‹æ¥åº”å¯¹å¤šç”¨æˆ·çš„è¯·æ±‚ â€”â€” å¤šçº¿ç¨‹æ¨¡å‹ã€‚\nçº¿ç¨‹æ˜¯è¿è¡Œåœ¨è¿›ç¨‹ä¸­çš„ä¸€ä¸ªâ€œé€»è¾‘æµâ€ï¼Œå•è¿›ç¨‹ä¸­å¯ä»¥è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼ŒåŒè¿›ç¨‹é‡Œçš„çº¿ç¨‹å¯ä»¥å…±äº«è¿›ç¨‹çš„éƒ¨åˆ†èµ„æºï¼Œæ¯”å¦‚æ–‡ä»¶æè¿°ç¬¦åˆ—è¡¨ã€è¿›ç¨‹ç©ºé—´ã€ä»£ç ã€å…¨å±€æ•°æ®ã€å †ã€å…±äº«åº“ç­‰ï¼Œè¿™äº›å…±äº«äº›èµ„æºåœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ä¸éœ€è¦åˆ‡æ¢ï¼Œè€Œåªéœ€è¦åˆ‡æ¢çº¿ç¨‹çš„ç§æœ‰æ•°æ®ã€å¯„å­˜å™¨ç­‰ä¸å…±äº«çš„æ•°æ®ï¼Œå› æ­¤åŒä¸€ä¸ªè¿›ç¨‹ä¸‹çš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€è¦æ¯”è¿›ç¨‹å°å¾—å¤šã€‚\nå½“æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ TCP å®Œæˆè¿æ¥åï¼Œé€šè¿‡ pthread_create() å‡½æ•°åˆ›å»ºçº¿ç¨‹ï¼Œç„¶åå°†ã€Œå·²è¿æ¥ Socketã€çš„æ–‡ä»¶æè¿°ç¬¦ä¼ é€’ç»™çº¿ç¨‹å‡½æ•°ï¼Œæ¥ç€åœ¨çº¿ç¨‹é‡Œå’Œå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ï¼Œä»è€Œè¾¾åˆ°å¹¶å‘å¤„ç†çš„ç›®çš„ã€‚\nå¦‚æœæ¯æ¥ä¸€ä¸ªè¿æ¥å°±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹è¿è¡Œå®Œåï¼Œè¿˜å¾—æ“ä½œç³»ç»Ÿè¿˜å¾—é”€æ¯çº¿ç¨‹ï¼Œè™½è¯´çº¿ç¨‹åˆ‡æ¢çš„ä¸Šå†™æ–‡å¼€é”€ä¸å¤§ï¼Œä½†æ˜¯å¦‚æœé¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ï¼Œç³»ç»Ÿå¼€é”€ä¹Ÿæ˜¯ä¸å°çš„ã€‚\né‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± çš„æ–¹å¼æ¥é¿å…çº¿ç¨‹çš„é¢‘ç¹åˆ›å»ºå’Œé”€æ¯ï¼Œæ‰€è°“çš„çº¿ç¨‹æ± ï¼Œå°±æ˜¯æå‰åˆ›å»ºè‹¥å¹²ä¸ªçº¿ç¨‹ï¼Œè¿™æ ·å½“ç”±æ–°è¿æ¥å»ºç«‹æ—¶ï¼Œå°†è¿™ä¸ªå·²è¿æ¥çš„ Socket æ”¾å…¥åˆ°ä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼Œç„¶åçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹è´Ÿè´£ä»é˜Ÿåˆ—ä¸­å–å‡ºã€Œå·²è¿æ¥ Socket ã€è¿›è¡Œå¤„ç†ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªé˜Ÿåˆ—æ˜¯å…¨å±€çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæ“ä½œï¼Œä¸ºäº†é¿å…å¤šçº¿ç¨‹ç«äº‰ï¼Œçº¿ç¨‹åœ¨æ“ä½œè¿™ä¸ªé˜Ÿåˆ—å‰è¦åŠ é”ã€‚\nä¸Šé¢åŸºäºè¿›ç¨‹æˆ–è€…çº¿ç¨‹æ¨¡å‹çš„ï¼Œå…¶å®è¿˜æ˜¯æœ‰é—®é¢˜çš„ã€‚æ–°åˆ°æ¥ä¸€ä¸ª TCP è¿æ¥ï¼Œå°±éœ€è¦åˆ†é…ä¸€ä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹ï¼Œé‚£ä¹ˆå¦‚æœè¦è¾¾åˆ° C10Kï¼Œæ„å‘³ç€è¦ä¸€å°æœºå™¨ç»´æŠ¤ 1 ä¸‡ä¸ªè¿æ¥ï¼Œç›¸å½“äºè¦ç»´æŠ¤ 1 ä¸‡ä¸ªè¿›ç¨‹/çº¿ç¨‹ï¼Œæ“ä½œç³»ç»Ÿå°±ç®—æ­»æ‰›ä¹Ÿæ˜¯æ‰›ä¸ä½çš„ã€‚\nI/O å¤šè·¯å¤ç”¨ æ—¢ç„¶ä¸ºæ¯ä¸ªè¯·æ±‚åˆ†é…ä¸€ä¸ªè¿›ç¨‹/çº¿ç¨‹çš„æ–¹å¼ä¸åˆé€‚ï¼Œé‚£æœ‰æ²¡æœ‰å¯èƒ½åªä½¿ç”¨ä¸€ä¸ªè¿›ç¨‹æ¥ç»´æŠ¤å¤šä¸ª Socket å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œé‚£å°±æ˜¯ I/O å¤šè·¯å¤ç”¨æŠ€æœ¯ã€‚ ä¸€ä¸ªè¿›ç¨‹è™½ç„¶ä»»ä¸€æ—¶åˆ»åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯å¤„ç†æ¯ä¸ªè¯·æ±‚çš„äº‹ä»¶æ—¶ï¼Œè€—æ—¶æ§åˆ¶åœ¨ 1 æ¯«ç§’ä»¥å†…ï¼Œè¿™æ · 1 ç§’å†…å°±å¯ä»¥å¤„ç†ä¸Šåƒä¸ªè¯·æ±‚ï¼ŒæŠŠæ—¶é—´æ‹‰é•¿æ¥çœ‹ï¼Œå¤šä¸ªè¯·æ±‚å¤ç”¨äº†ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™å°±æ˜¯å¤šè·¯å¤ç”¨ï¼Œè¿™ç§æ€æƒ³å¾ˆç±»ä¼¼ä¸€ä¸ª CPU å¹¶å‘å¤šä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥ä¹Ÿå«åšæ—¶åˆ†å¤šè·¯å¤ç”¨ã€‚\næˆ‘ä»¬ç†Ÿæ‚‰çš„ select/poll/epoll å†…æ ¸æä¾›ç»™ç”¨æˆ·æ€çš„å¤šè·¯å¤ç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œè¿›ç¨‹å¯ä»¥é€šè¿‡ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å‡½æ•°ä»å†…æ ¸ä¸­è·å–å¤šä¸ªäº‹ä»¶ã€‚\nselect/poll/epoll æ˜¯å¦‚ä½•è·å–ç½‘ç»œäº‹ä»¶çš„å‘¢ï¼Ÿåœ¨è·å–äº‹ä»¶æ—¶ï¼Œå…ˆæŠŠæ‰€æœ‰è¿æ¥ï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰ä¼ ç»™å†…æ ¸ï¼Œå†ç”±å†…æ ¸è¿”å›äº§ç”Ÿäº†äº‹ä»¶çš„è¿æ¥ï¼Œç„¶ååœ¨ç”¨æˆ·æ€ä¸­å†å¤„ç†è¿™äº›è¿æ¥å¯¹åº”çš„è¯·æ±‚å³å¯ã€‚\nselect/poll/epoll è¿™æ˜¯ä¸‰ä¸ªå¤šè·¯å¤ç”¨æ¥å£ï¼Œéƒ½èƒ½å®ç° C10K å—ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ†åˆ«è¯´è¯´å®ƒä»¬ã€‚\nselect/poll select å®ç°å¤šè·¯å¤ç”¨çš„æ–¹å¼æ˜¯ï¼Œå°†å·²è¿æ¥çš„ Socket éƒ½æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œç„¶åè°ƒç”¨ select å‡½æ•°å°†æ–‡ä»¶æè¿°ç¬¦é›†åˆæ‹·è´åˆ°å†…æ ¸é‡Œï¼Œè®©å†…æ ¸æ¥æ£€æŸ¥æ˜¯å¦æœ‰ç½‘ç»œäº‹ä»¶äº§ç”Ÿï¼Œæ£€æŸ¥çš„æ–¹å¼å¾ˆç²—æš´ï¼Œå°±æ˜¯é€šè¿‡éå†æ–‡ä»¶æè¿°ç¬¦é›†åˆçš„æ–¹å¼ï¼Œå½“æ£€æŸ¥åˆ°æœ‰äº‹ä»¶äº§ç”Ÿåï¼Œå°†æ­¤ Socket æ ‡è®°ä¸ºå¯è¯»æˆ–å¯å†™ï¼Œ æ¥ç€å†æŠŠæ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆæ‹·è´å›ç”¨æˆ·æ€é‡Œï¼Œç„¶åç”¨æˆ·æ€è¿˜éœ€è¦å†é€šè¿‡éå†çš„æ–¹æ³•æ‰¾åˆ°å¯è¯»æˆ–å¯å†™çš„ Socketï¼Œç„¶åå†å¯¹å…¶å¤„ç†ã€‚\næ‰€ä»¥ï¼Œå¯¹äº select è¿™ç§æ–¹å¼ï¼Œéœ€è¦è¿›è¡Œ 2 æ¬¡ã€Œéå†ã€æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œä¸€æ¬¡æ˜¯åœ¨å†…æ ¸æ€é‡Œï¼Œä¸€ä¸ªæ¬¡æ˜¯åœ¨ç”¨æˆ·æ€é‡Œ ï¼Œè€Œä¸”è¿˜ä¼šå‘ç”Ÿ 2 æ¬¡ã€Œæ‹·è´ã€æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œå…ˆä»ç”¨æˆ·ç©ºé—´ä¼ å…¥å†…æ ¸ç©ºé—´ï¼Œç”±å†…æ ¸ä¿®æ”¹åï¼Œå†ä¼ å‡ºåˆ°ç”¨æˆ·ç©ºé—´ä¸­ã€‚\nselect ä½¿ç”¨å›ºå®šé•¿åº¦çš„ BitsMapï¼Œè¡¨ç¤ºæ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œè€Œä¸”æ‰€æ”¯æŒçš„æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°æ˜¯æœ‰é™åˆ¶çš„ï¼Œåœ¨ Linux ç³»ç»Ÿä¸­ï¼Œç”±å†…æ ¸ä¸­çš„ FD_SETSIZE é™åˆ¶ï¼Œ é»˜è®¤æœ€å¤§å€¼ä¸º 1024ï¼Œåªèƒ½ç›‘å¬ 0~1023 çš„æ–‡ä»¶æè¿°ç¬¦ã€‚\npoll ä¸å†ç”¨ BitsMap æ¥å­˜å‚¨æ‰€å…³æ³¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå–è€Œä»£ä¹‹ç”¨åŠ¨æ€æ•°ç»„ï¼Œä»¥é“¾è¡¨å½¢å¼æ¥ç»„ç»‡ï¼Œçªç ´äº† select çš„æ–‡ä»¶æè¿°ç¬¦ä¸ªæ•°é™åˆ¶ï¼Œå½“ç„¶è¿˜ä¼šå—åˆ°ç³»ç»Ÿæ–‡ä»¶æè¿°ç¬¦é™åˆ¶ã€‚\nä½†æ˜¯ poll å’Œ select å¹¶æ²¡æœ‰å¤ªå¤§çš„æœ¬è´¨åŒºåˆ«ï¼Œéƒ½æ˜¯ä½¿ç”¨ã€Œçº¿æ€§ç»“æ„ã€å­˜å‚¨è¿›ç¨‹å…³æ³¨çš„ Socket é›†åˆï¼Œå› æ­¤éƒ½éœ€è¦éå†æ–‡ä»¶æè¿°ç¬¦é›†åˆæ¥æ‰¾åˆ°å¯è¯»æˆ–å¯å†™çš„ Socketï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œè€Œä¸”ä¹Ÿéœ€è¦åœ¨ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´æ‹·è´æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œè¿™ç§æ–¹å¼éšç€å¹¶å‘æ•°ä¸Šæ¥ï¼Œæ€§èƒ½çš„æŸè€—ä¼šå‘ˆæŒ‡æ•°çº§å¢é•¿ã€‚\nepoll å…ˆå¤ä¹ ä¸‹ epoll çš„ç”¨æ³•ã€‚å¦‚ä¸‹çš„ä»£ç ä¸­ï¼Œå…ˆç”¨e poll_create åˆ›å»ºä¸€ä¸ª epoll å¯¹è±¡ epfdï¼Œå†é€šè¿‡ epoll_ctl å°†éœ€è¦ç›‘è§†çš„ socket æ·»åŠ åˆ°epfdä¸­ï¼Œæœ€åè°ƒç”¨ epoll_wait ç­‰å¾…æ•°æ®ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 int s = socket(AF_INET, SOCK_STREAM, 0); bind(s, ...); listen(s, ...) int epfd = epoll_create(...); epoll_ctl(epfd, ...); //å°†æ‰€æœ‰éœ€è¦ç›‘å¬çš„socketæ·»åŠ åˆ°epfdä¸­ while(1) { int n = epoll_wait(...); for(æ¥æ”¶åˆ°æ•°æ®çš„socket){ //å¤„ç† } } epoll é€šè¿‡ä¸¤ä¸ªæ–¹é¢ï¼Œå¾ˆå¥½è§£å†³äº† select/poll çš„é—®é¢˜ã€‚\nç¬¬ä¸€ç‚¹ï¼Œepoll åœ¨å†…æ ¸é‡Œä½¿ç”¨çº¢é»‘æ ‘æ¥è·Ÿè¸ªè¿›ç¨‹æ‰€æœ‰å¾…æ£€æµ‹çš„æ–‡ä»¶æè¿°å­—ï¼ŒæŠŠéœ€è¦ç›‘æ§çš„ socket é€šè¿‡ epoll_ctl() å‡½æ•°åŠ å…¥å†…æ ¸ä¸­çš„çº¢é»‘æ ‘é‡Œï¼Œçº¢é»‘æ ‘æ˜¯ä¸ªé«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå¢åˆ æ”¹ä¸€èˆ¬æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)ã€‚è€Œ select/poll å†…æ ¸é‡Œæ²¡æœ‰ç±»ä¼¼ epoll çº¢é»‘æ ‘è¿™ç§ä¿å­˜æ‰€æœ‰å¾…æ£€æµ‹çš„ socket çš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥ select/poll æ¯æ¬¡æ“ä½œæ—¶éƒ½ä¼ å…¥æ•´ä¸ª socket é›†åˆç»™å†…æ ¸ï¼Œè€Œ epoll å› ä¸ºåœ¨å†…æ ¸ç»´æŠ¤äº†çº¢é»‘æ ‘ï¼Œå¯ä»¥ä¿å­˜æ‰€æœ‰å¾…æ£€æµ‹çš„ socket ï¼Œæ‰€ä»¥åªéœ€è¦ä¼ å…¥ä¸€ä¸ªå¾…æ£€æµ‹çš„ socketï¼Œå‡å°‘äº†å†…æ ¸å’Œç”¨æˆ·ç©ºé—´å¤§é‡çš„æ•°æ®æ‹·è´å’Œå†…å­˜åˆ†é…ã€‚ ç¬¬äºŒç‚¹ï¼Œ epoll ä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„æœºåˆ¶ï¼Œå†…æ ¸é‡Œç»´æŠ¤äº†ä¸€ä¸ªé“¾è¡¨æ¥è®°å½•å°±ç»ªäº‹ä»¶ï¼Œå½“æŸä¸ª socket æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œé€šè¿‡å›è°ƒå‡½æ•°å†…æ ¸ä¼šå°†å…¶åŠ å…¥åˆ°è¿™ä¸ªå°±ç»ªäº‹ä»¶åˆ—è¡¨ä¸­ï¼Œå½“ç”¨æˆ·è°ƒç”¨ epoll_wait() å‡½æ•°æ—¶ï¼Œåªä¼šè¿”å›æœ‰äº‹ä»¶å‘ç”Ÿçš„æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°ï¼Œä¸éœ€è¦åƒ select/poll é‚£æ ·è½®è¯¢æ‰«ææ•´ä¸ª socket é›†åˆï¼Œå¤§å¤§æé«˜äº†æ£€æµ‹çš„æ•ˆç‡ã€‚ ä»ä¸‹å›¾ä½ å¯ä»¥çœ‹åˆ° epoll ç›¸å…³çš„æ¥å£ä½œç”¨ï¼š epoll çš„æ–¹å¼å³ä½¿ç›‘å¬çš„ Socket æ•°é‡è¶Šå¤šçš„æ—¶å€™ï¼Œæ•ˆç‡ä¸ä¼šå¤§å¹…åº¦é™ä½ï¼Œèƒ½å¤ŸåŒæ—¶ç›‘å¬çš„ Socket çš„æ•°ç›®ä¹Ÿéå¸¸çš„å¤šäº†ï¼Œä¸Šé™å°±ä¸ºç³»ç»Ÿå®šä¹‰çš„è¿›ç¨‹æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦ä¸ªæ•°ã€‚å› è€Œï¼Œepoll è¢«ç§°ä¸ºè§£å†³ C10K é—®é¢˜çš„åˆ©å™¨ã€‚\næ’ä¸ªé¢˜å¤–è¯ï¼Œç½‘ä¸Šæ–‡ç« ä¸å°‘è¯´ï¼Œepoll_wait è¿”å›æ—¶ï¼Œå¯¹äºå°±ç»ªçš„äº‹ä»¶ï¼Œepoll ä½¿ç”¨çš„æ˜¯å…±äº«å†…å­˜çš„æ–¹å¼ï¼Œå³ç”¨æˆ·æ€å’Œå†…æ ¸æ€éƒ½æŒ‡å‘äº†å°±ç»ªé“¾è¡¨ï¼Œæ‰€ä»¥å°±é¿å…äº†å†…å­˜æ‹·è´æ¶ˆè€—ã€‚\nè¿™æ˜¯é”™çš„ï¼çœ‹è¿‡ epoll å†…æ ¸æºç çš„éƒ½çŸ¥é“ï¼Œå‹æ ¹å°±æ²¡æœ‰ä½¿ç”¨å…±äº«å†…å­˜è¿™ä¸ªç©æ„ã€‚ä½ å¯ä»¥ä»ä¸‹é¢è¿™ä»½ä»£ç çœ‹åˆ°ï¼Œ epoll_wait å®ç°çš„å†…æ ¸ä»£ç ä¸­è°ƒç”¨äº† __put_user å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯å°†æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚ å¥½äº†ï¼Œè¿™ä¸ªé¢˜å¤–è¯å°±è¯´åˆ°è¿™äº†ï¼Œæˆ‘ä»¬ç»§ç»­ï¼\nè¾¹ç¼˜è§¦å‘å’Œæ°´å¹³è§¦å‘ epoll æ”¯æŒä¸¤ç§äº‹ä»¶è§¦å‘æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯è¾¹ç¼˜è§¦å‘ï¼ˆedge-triggeredï¼ŒETï¼‰å’Œæ°´å¹³è§¦å‘ï¼ˆlevel-triggeredï¼ŒLTï¼‰ã€‚\nè¿™ä¸¤ä¸ªæœ¯è¯­è¿˜æŒºæŠ½è±¡çš„ï¼Œå…¶å®å®ƒä»¬çš„åŒºåˆ«è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ã€‚\nä½¿ç”¨è¾¹ç¼˜è§¦å‘æ¨¡å¼æ—¶ï¼Œå½“è¢«ç›‘æ§çš„ Socket æè¿°ç¬¦ä¸Šæœ‰å¯è¯»äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒæœåŠ¡å™¨ç«¯åªä¼šä» epoll_wait ä¸­è‹é†’ä¸€æ¬¡ï¼Œå³ä½¿è¿›ç¨‹æ²¡æœ‰è°ƒç”¨ read å‡½æ•°ä»å†…æ ¸è¯»å–æ•°æ®ï¼Œä¹Ÿä¾ç„¶åªè‹é†’ä¸€æ¬¡ï¼Œå› æ­¤æˆ‘ä»¬ç¨‹åºè¦ä¿è¯ä¸€æ¬¡æ€§å°†å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®è¯»å–å®Œï¼› ä½¿ç”¨æ°´å¹³è§¦å‘æ¨¡å¼æ—¶ï¼Œå½“è¢«ç›‘æ§çš„ Socket ä¸Šæœ‰å¯è¯»äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒæœåŠ¡å™¨ç«¯ä¸æ–­åœ°ä» epoll_wait ä¸­è‹é†’ï¼Œç›´åˆ°å†…æ ¸ç¼“å†²åŒºæ•°æ®è¢« read å‡½æ•°è¯»å®Œæ‰ç»“æŸï¼Œç›®çš„æ˜¯å‘Šè¯‰æˆ‘ä»¬æœ‰æ•°æ®éœ€è¦è¯»å–ï¼› ä¸¾ä¸ªä¾‹å­ï¼Œä½ çš„å¿«é€’è¢«æ”¾åˆ°äº†ä¸€ä¸ªå¿«é€’ç®±é‡Œï¼Œå¦‚æœå¿«é€’ç®±åªä¼šé€šè¿‡çŸ­ä¿¡é€šçŸ¥ä½ ä¸€æ¬¡ï¼Œå³ä½¿ä½ ä¸€ç›´æ²¡æœ‰å»å–ï¼Œå®ƒä¹Ÿä¸ä¼šå†å‘é€ç¬¬äºŒæ¡çŸ­ä¿¡æé†’ä½ ï¼Œè¿™ä¸ªæ–¹å¼å°±æ˜¯è¾¹ç¼˜è§¦å‘ï¼›å¦‚æœå¿«é€’ç®±å‘ç°ä½ çš„å¿«é€’æ²¡æœ‰è¢«å–å‡ºï¼Œå®ƒå°±ä¼šä¸åœåœ°å‘çŸ­ä¿¡é€šçŸ¥ä½ ï¼Œç›´åˆ°ä½ å–å‡ºäº†å¿«é€’ï¼Œå®ƒæ‰æ¶ˆåœï¼Œè¿™ä¸ªå°±æ˜¯æ°´å¹³è§¦å‘çš„æ–¹å¼ã€‚\nè¿™å°±æ˜¯ä¸¤è€…çš„åŒºåˆ«: æ°´å¹³è§¦å‘çš„æ„æ€æ˜¯åªè¦æ»¡è¶³äº‹ä»¶çš„æ¡ä»¶ï¼Œæ¯”å¦‚å†…æ ¸ä¸­æœ‰æ•°æ®éœ€è¦è¯»ï¼Œå°±ä¸€ç›´ä¸æ–­åœ°æŠŠè¿™ä¸ªäº‹ä»¶ä¼ é€’ç»™ç”¨æˆ·ï¼›è€Œè¾¹ç¼˜è§¦å‘çš„æ„æ€æ˜¯åªæœ‰ç¬¬ä¸€æ¬¡æ»¡è¶³æ¡ä»¶çš„æ—¶å€™æ‰è§¦å‘ï¼Œä¹‹åå°±ä¸ä¼šå†ä¼ é€’åŒæ ·çš„äº‹ä»¶äº†ã€‚ å¦‚æœä½¿ç”¨æ°´å¹³è§¦å‘æ¨¡å¼ï¼Œå½“å†…æ ¸é€šçŸ¥æ–‡ä»¶æè¿°ç¬¦å¯è¯»å†™æ—¶ï¼Œæ¥ä¸‹æ¥è¿˜å¯ä»¥ç»§ç»­å»æ£€æµ‹å®ƒçš„çŠ¶æ€ï¼Œçœ‹å®ƒæ˜¯å¦ä¾ç„¶å¯è¯»æˆ–å¯å†™ã€‚æ‰€ä»¥åœ¨æ”¶åˆ°é€šçŸ¥åï¼Œæ²¡å¿…è¦ä¸€æ¬¡æ‰§è¡Œå°½å¯èƒ½å¤šçš„è¯»å†™æ“ä½œã€‚\nå¦‚æœä½¿ç”¨è¾¹ç¼˜è§¦å‘æ¨¡å¼ï¼ŒI/O äº‹ä»¶å‘ç”Ÿæ—¶åªä¼šé€šçŸ¥ä¸€æ¬¡ï¼Œè€Œä¸”æˆ‘ä»¬ä¸çŸ¥é“åˆ°åº•èƒ½è¯»å†™å¤šå°‘æ•°æ®ï¼Œæ‰€ä»¥åœ¨æ”¶åˆ°é€šçŸ¥ååº”å°½å¯èƒ½åœ°è¯»å†™æ•°æ®ï¼Œä»¥å…é”™å¤±è¯»å†™çš„æœºä¼šã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¼šå¾ªç¯ä»æ–‡ä»¶æè¿°ç¬¦è¯»å†™æ•°æ®ï¼Œé‚£ä¹ˆå¦‚æœæ–‡ä»¶æè¿°ç¬¦æ˜¯é˜»å¡çš„ï¼Œæ²¡æœ‰æ•°æ®å¯è¯»å†™æ—¶ï¼Œè¿›ç¨‹ä¼šé˜»å¡åœ¨è¯»å†™å‡½æ•°é‚£é‡Œï¼Œç¨‹åºå°±æ²¡åŠæ³•ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚æ‰€ä»¥ï¼Œè¾¹ç¼˜è§¦å‘æ¨¡å¼ä¸€èˆ¬å’Œéé˜»å¡ I/O æ­é…ä½¿ç”¨ï¼Œç¨‹åºä¼šä¸€ç›´æ‰§è¡Œ I/O æ“ä½œï¼Œç›´åˆ°ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚ read å’Œ writeï¼‰è¿”å›é”™è¯¯ï¼Œé”™è¯¯ç±»å‹ä¸º EAGAIN æˆ– EWOULDBLOCKã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œè¾¹ç¼˜è§¦å‘çš„æ•ˆç‡æ¯”æ°´å¹³è§¦å‘çš„æ•ˆç‡è¦é«˜`ï¼Œå› ä¸ºè¾¹ç¼˜è§¦å‘å¯ä»¥å‡å°‘ epoll_wait çš„ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼Œç³»ç»Ÿè°ƒç”¨ä¹Ÿæ˜¯æœ‰ä¸€å®šçš„å¼€é”€çš„çš„ï¼Œæ¯•ç«Ÿä¹Ÿå­˜åœ¨ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ã€‚\nselect/poll åªæœ‰æ°´å¹³è§¦å‘æ¨¡å¼ï¼Œepoll é»˜è®¤çš„è§¦å‘æ¨¡å¼æ˜¯æ°´å¹³è§¦å‘ï¼Œä½†æ˜¯å¯ä»¥æ ¹æ®åº”ç”¨åœºæ™¯è®¾ç½®ä¸ºè¾¹ç¼˜è§¦å‘æ¨¡å¼ã€‚\nå¦å¤–ï¼Œä½¿ç”¨ I/O å¤šè·¯å¤ç”¨æ—¶ï¼Œæœ€å¥½æ­é…éé˜»å¡ I/O ä¸€èµ·ä½¿ç”¨ï¼ŒLinux æ‰‹å†Œå…³äº select çš„å†…å®¹ä¸­æœ‰å¦‚ä¸‹è¯´æ˜ï¼š\nUnder Linux, select() may report a socket file descriptor as \u0026ldquo;ready for reading\u0026rdquo;, while nevertheless a subsequent read blocks. This could for example happen when data has arrived but upon examination has wrong checksum and is discarded. There may be other circumstances in which a file descriptor is spuriously reported as ready. Thus it may be safer to use O_NONBLOCK on sockets that should not block.\næˆ‘è°·æ­Œç¿»è¯‘çš„ç»“æœï¼š\nåœ¨Linuxä¸‹ï¼Œselect() å¯èƒ½ä¼šå°†ä¸€ä¸ª socket æ–‡ä»¶æè¿°ç¬¦æŠ¥å‘Šä¸º \u0026ldquo;å‡†å¤‡è¯»å–\u0026rdquo;ï¼Œè€Œåç»­çš„è¯»å–å—å´æ²¡æœ‰ã€‚ä¾‹å¦‚ï¼Œå½“æ•°æ®å·²ç»åˆ°è¾¾ï¼Œä½†ç»æ£€æŸ¥åå‘ç°æœ‰é”™è¯¯çš„æ ¡éªŒå’Œè€Œè¢«ä¸¢å¼ƒæ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚ä¹Ÿæœ‰å¯èƒ½åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæ–‡ä»¶æè¿°ç¬¦è¢«é”™è¯¯åœ°æŠ¥å‘Šä¸ºå°±ç»ªã€‚å› æ­¤ï¼Œåœ¨ä¸åº”è¯¥é˜»å¡çš„ socket ä¸Šä½¿ç”¨ O_NONBLOCK å¯èƒ½æ›´å®‰å…¨ã€‚\nç®€å•ç‚¹ç†è§£ï¼Œå°±æ˜¯å¤šè·¯å¤ç”¨ API è¿”å›çš„äº‹ä»¶å¹¶ä¸ä¸€å®šå¯è¯»å†™çš„ï¼Œå¦‚æœä½¿ç”¨é˜»å¡ I/Oï¼Œ é‚£ä¹ˆåœ¨è°ƒç”¨ read/write æ—¶åˆ™ä¼šå‘ç”Ÿç¨‹åºé˜»å¡ï¼Œå› æ­¤æœ€å¥½æ­é…éé˜»å¡ I/Oï¼Œä»¥ä¾¿åº”å¯¹æå°‘æ•°çš„ç‰¹æ®Šæƒ…å†µã€‚\næ€»ç»“ æœ€åŸºç¡€çš„ TCP çš„ Socket ç¼–ç¨‹ï¼Œå®ƒæ˜¯é˜»å¡ I/O æ¨¡å‹ï¼ŒåŸºæœ¬ä¸Šåªèƒ½ä¸€å¯¹ä¸€é€šä¿¡ï¼Œé‚£ä¸ºäº†æœåŠ¡æ›´å¤šçš„å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬éœ€è¦æ”¹è¿›ç½‘ç»œ I/O æ¨¡å‹ã€‚\næ¯”è¾ƒä¼ ç»Ÿçš„æ–¹å¼æ˜¯ä½¿ç”¨å¤šè¿›ç¨‹/çº¿ç¨‹æ¨¡å‹ï¼Œæ¯æ¥ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œå°±åˆ†é…ä¸€ä¸ªè¿›ç¨‹/çº¿ç¨‹ï¼Œç„¶ååç»­çš„è¯»å†™éƒ½åœ¨å¯¹åº”çš„è¿›ç¨‹/çº¿ç¨‹ï¼Œè¿™ç§æ–¹å¼å¤„ç† 100 ä¸ªå®¢æˆ·ç«¯æ²¡é—®é¢˜ï¼Œä½†æ˜¯å½“å®¢æˆ·ç«¯å¢å¤§åˆ° 10000 ä¸ªæ—¶ï¼Œ10000 ä¸ªè¿›ç¨‹/çº¿ç¨‹çš„è°ƒåº¦ã€ä¸Šä¸‹æ–‡åˆ‡æ¢ä»¥åŠå®ƒä»¬å ç”¨çš„å†…å­˜ï¼Œéƒ½ä¼šæˆä¸ºç“¶é¢ˆã€‚\nä¸ºäº†è§£å†³ä¸Šé¢è¿™ä¸ªé—®é¢˜ï¼Œå°±å‡ºç°äº† I/O çš„å¤šè·¯å¤ç”¨ï¼Œå¯ä»¥åªåœ¨ä¸€ä¸ªè¿›ç¨‹é‡Œå¤„ç†å¤šä¸ªæ–‡ä»¶çš„ I/Oï¼ŒLinux ä¸‹æœ‰ä¸‰ç§æä¾› I/O å¤šè·¯å¤ç”¨çš„ APIï¼Œåˆ†åˆ«æ˜¯ï¼šselectã€pollã€epollã€‚\nselect å’Œ poll å¹¶æ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼Œå®ƒä»¬å†…éƒ¨éƒ½æ˜¯ä½¿ç”¨ã€Œçº¿æ€§ç»“æ„ã€æ¥å­˜å‚¨è¿›ç¨‹å…³æ³¨çš„ Socket é›†åˆã€‚\nåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œé¦–å…ˆéœ€è¦æŠŠå…³æ³¨çš„ Socket é›†åˆé€šè¿‡ select/poll ç³»ç»Ÿè°ƒç”¨ä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€ï¼Œç„¶åç”±å†…æ ¸æ£€æµ‹äº‹ä»¶ï¼Œå½“æœ‰ç½‘ç»œäº‹ä»¶äº§ç”Ÿæ—¶ï¼Œå†…æ ¸éœ€è¦éå†è¿›ç¨‹å…³æ³¨ Socket é›†åˆï¼Œæ‰¾åˆ°å¯¹åº”çš„ Socketï¼Œå¹¶è®¾ç½®å…¶çŠ¶æ€ä¸ºå¯è¯»/å¯å†™ï¼Œç„¶åæŠŠæ•´ä¸ª Socket é›†åˆä»å†…æ ¸æ€æ‹·è´åˆ°ç”¨æˆ·æ€ï¼Œç”¨æˆ·æ€è¿˜è¦ç»§ç»­éå†æ•´ä¸ª Socket é›†åˆæ‰¾åˆ°å¯è¯»/å¯å†™çš„ Socketï¼Œç„¶åå¯¹å…¶å¤„ç†ã€‚\nå¾ˆæ˜æ˜¾å‘ç°ï¼Œselect å’Œ poll çš„ç¼ºé™·åœ¨äºï¼Œå½“å®¢æˆ·ç«¯è¶Šå¤šï¼Œä¹Ÿå°±æ˜¯ Socket é›†åˆè¶Šå¤§ï¼ŒSocket é›†åˆçš„éå†å’Œæ‹·è´ä¼šå¸¦æ¥å¾ˆå¤§çš„å¼€é”€ï¼Œå› æ­¤ä¹Ÿå¾ˆéš¾åº”å¯¹ C10Kã€‚\nepoll æ˜¯è§£å†³ C10K é—®é¢˜çš„åˆ©å™¨ï¼Œé€šè¿‡ä¸¤ä¸ªæ–¹é¢è§£å†³äº† select/poll çš„é—®é¢˜ã€‚\nepoll åœ¨å†…æ ¸é‡Œä½¿ç”¨ã€Œçº¢é»‘æ ‘ã€æ¥å…³æ³¨è¿›ç¨‹æ‰€æœ‰å¾…æ£€æµ‹çš„ Socketï¼Œçº¢é»‘æ ‘æ˜¯ä¸ªé«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå¢åˆ æ”¹ä¸€èˆ¬æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)ï¼Œé€šè¿‡å¯¹è¿™æ£µé»‘çº¢æ ‘çš„ç®¡ç†ï¼Œä¸éœ€è¦åƒ select/poll åœ¨æ¯æ¬¡æ“ä½œæ—¶éƒ½ä¼ å…¥æ•´ä¸ª Socket é›†åˆï¼Œå‡å°‘äº†å†…æ ¸å’Œç”¨æˆ·ç©ºé—´å¤§é‡çš„æ•°æ®æ‹·è´å’Œå†…å­˜åˆ†é…ã€‚ epoll ä½¿ç”¨äº‹ä»¶é©±åŠ¨çš„æœºåˆ¶ï¼Œå†…æ ¸é‡Œç»´æŠ¤äº†ä¸€ä¸ªã€Œé“¾è¡¨ã€æ¥è®°å½•å°±ç»ªäº‹ä»¶ï¼Œåªå°†æœ‰äº‹ä»¶å‘ç”Ÿçš„ Socket é›†åˆä¼ é€’ç»™åº”ç”¨ç¨‹åºï¼Œä¸éœ€è¦åƒ select/poll é‚£æ ·è½®è¯¢æ‰«ææ•´ä¸ªé›†åˆï¼ˆåŒ…å«æœ‰å’Œæ— äº‹ä»¶çš„ Socket ï¼‰ï¼Œå¤§å¤§æé«˜äº†æ£€æµ‹çš„æ•ˆç‡ã€‚ è€Œä¸”ï¼Œepoll æ”¯æŒè¾¹ç¼˜è§¦å‘å’Œæ°´å¹³è§¦å‘çš„æ–¹å¼ï¼Œè€Œ select/poll åªæ”¯æŒæ°´å¹³è§¦å‘ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œè¾¹ç¼˜è§¦å‘çš„æ–¹å¼ä¼šæ¯”æ°´å¹³è§¦å‘çš„æ•ˆç‡é«˜ã€‚\n","permalink":"https://reid00.github.io/en/posts/os_network/io-%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/","summary":"æœ€åŸºæœ¬çš„ Socket æ¨¡å‹ è¦æƒ³å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨èƒ½åœ¨ç½‘ç»œä¸­é€šä¿¡ï¼Œé‚£å¿…é¡»å¾—ä½¿ç”¨ Socket ç¼–ç¨‹ï¼Œå®ƒæ˜¯è¿›ç¨‹é—´é€šä¿¡é‡Œæ¯”è¾ƒç‰¹åˆ«çš„æ–¹å¼ï¼Œç‰¹åˆ«ä¹‹å¤„åœ¨äºå®ƒæ˜¯å¯ä»¥è·¨ä¸»æœºé—´é€šä¿¡ã€‚\nSocket çš„ä¸­æ–‡åå«ä½œæ’å£ï¼Œå’‹ä¸€çœ‹è¿˜æŒºè¿·æƒ‘çš„ã€‚äº‹å®ä¸Šï¼ŒåŒæ–¹è¦è¿›è¡Œç½‘ç»œé€šä¿¡å‰ï¼Œå„è‡ªå¾—åˆ›å»ºä¸€ä¸ª Socketï¼Œè¿™ç›¸å½“äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¼€äº†ä¸€ä¸ªâ€œå£å­â€ï¼ŒåŒæ–¹è¯»å–å’Œå‘é€æ•°æ®çš„æ—¶å€™ï¼Œéƒ½é€šè¿‡è¿™ä¸ªâ€œå£å­â€ã€‚è¿™æ ·ä¸€çœ‹ï¼Œæ˜¯ä¸æ˜¯è§‰å¾—å¾ˆåƒå¼„äº†ä¸€æ ¹ç½‘çº¿ï¼Œä¸€å¤´æ’åœ¨å®¢æˆ·ç«¯ï¼Œä¸€å¤´æ’åœ¨æœåŠ¡ç«¯ï¼Œç„¶åè¿›è¡Œé€šä¿¡ã€‚\nåˆ›å»º Socket çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šç½‘ç»œå±‚ä½¿ç”¨çš„æ˜¯ IPv4 è¿˜æ˜¯ IPv6ï¼Œä¼ è¾“å±‚ä½¿ç”¨çš„æ˜¯ TCP è¿˜æ˜¯ UDPã€‚\nUDP çš„ Socket ç¼–ç¨‹ç›¸å¯¹ç®€å•äº›ï¼Œè¿™é‡Œæˆ‘ä»¬åªä»‹ç»åŸºäº TCP çš„ Socket ç¼–ç¨‹ã€‚\næœåŠ¡å™¨çš„ç¨‹åºè¦å…ˆè·‘èµ·æ¥ï¼Œç„¶åç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥å’Œæ•°æ®ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æœåŠ¡ç«¯çš„ Socket ç¼–ç¨‹è¿‡ç¨‹æ˜¯æ€æ ·çš„ã€‚\næœåŠ¡ç«¯é¦–å…ˆè°ƒç”¨ socket() å‡½æ•°ï¼Œåˆ›å»ºç½‘ç»œåè®®ä¸º IPv4ï¼Œä»¥åŠä¼ è¾“åè®®ä¸º TCP çš„ Socket ï¼Œæ¥ç€è°ƒç”¨ bind() å‡½æ•°ï¼Œç»™è¿™ä¸ª Socket ç»‘å®šä¸€ä¸ª IP åœ°å€å’Œç«¯å£ï¼Œç»‘å®šè¿™ä¸¤ä¸ªçš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ\nç»‘å®šç«¯å£çš„ç›®çš„ï¼šå½“å†…æ ¸æ”¶åˆ° TCP æŠ¥æ–‡ï¼Œé€šè¿‡ TCP å¤´é‡Œé¢çš„ç«¯å£å·ï¼Œæ¥æ‰¾åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œç„¶åæŠŠæ•°æ®ä¼ é€’ç»™æˆ‘ä»¬ã€‚ ç»‘å®š IP åœ°å€çš„ç›®çš„ï¼šä¸€å°æœºå™¨æ˜¯å¯ä»¥æœ‰å¤šä¸ªç½‘å¡çš„ï¼Œæ¯ä¸ªç½‘å¡éƒ½æœ‰å¯¹åº”çš„ IP åœ°å€ï¼Œå½“ç»‘å®šä¸€ä¸ªç½‘å¡æ—¶ï¼Œå†…æ ¸åœ¨æ”¶åˆ°è¯¥ç½‘å¡ä¸Šçš„åŒ…ï¼Œæ‰ä¼šå‘ç»™æˆ‘ä»¬ï¼› ç»‘å®šå®Œ IP åœ°å€å’Œç«¯å£åï¼Œå°±å¯ä»¥è°ƒç”¨ listen() å‡½æ•°è¿›è¡Œç›‘å¬ï¼Œæ­¤æ—¶å¯¹åº” TCP çŠ¶æ€å›¾ä¸­çš„ listenï¼Œå¦‚æœæˆ‘ä»¬è¦åˆ¤å®šæœåŠ¡å™¨ä¸­ä¸€ä¸ªç½‘ç»œç¨‹åºæœ‰æ²¡æœ‰å¯åŠ¨ï¼Œå¯ä»¥é€šè¿‡ netstat å‘½ä»¤æŸ¥çœ‹å¯¹åº”çš„ç«¯å£å·æ˜¯å¦æœ‰è¢«ç›‘å¬ã€‚\næœåŠ¡ç«¯è¿›å…¥äº†ç›‘å¬çŠ¶æ€åï¼Œé€šè¿‡è°ƒç”¨ accept() å‡½æ•°ï¼Œæ¥ä»å†…æ ¸è·å–å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œå¦‚æœæ²¡æœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œåˆ™ä¼šé˜»å¡ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥çš„åˆ°æ¥ã€‚\né‚£å®¢æˆ·ç«¯æ˜¯æ€ä¹ˆå‘èµ·è¿æ¥çš„å‘¢ï¼Ÿå®¢æˆ·ç«¯åœ¨åˆ›å»ºå¥½ Socket åï¼Œè°ƒç”¨ connect() å‡½æ•°å‘èµ·è¿æ¥ï¼Œè¯¥å‡½æ•°çš„å‚æ•°è¦æŒ‡æ˜æœåŠ¡ç«¯çš„ IP åœ°å€å’Œç«¯å£å·ï¼Œç„¶åä¸‡ä¼—æœŸå¾…çš„ TCP ä¸‰æ¬¡æ¡æ‰‹å°±å¼€å§‹äº†ã€‚","title":"IO å¤šè·¯å¤ç”¨"},{"content":"æ–‡ä»¶ç³»ç»Ÿ æ–‡ä»¶ç³»ç»Ÿæ˜¯æ“ä½œç³»ç»Ÿä¸­è´Ÿè´£ç®¡ç†æŒä¹…æ•°æ®çš„å­ç³»ç»Ÿï¼Œè¯´ç®€å•ç‚¹ï¼Œå°±æ˜¯è´Ÿè´£æŠŠç”¨æˆ·çš„æ–‡ä»¶å­˜åˆ°ç£ç›˜ç¡¬ä»¶ä¸­ï¼Œå› ä¸ºå³ä½¿è®¡ç®—æœºæ–­ç”µäº†ï¼Œç£ç›˜é‡Œçš„æ•°æ®å¹¶ä¸ä¼šä¸¢å¤±ï¼Œæ‰€ä»¥å¯ä»¥æŒä¹…åŒ–çš„ä¿å­˜æ–‡ä»¶ã€‚\næ–‡ä»¶ç³»ç»Ÿçš„åŸºæœ¬æ•°æ®å•ä½æ˜¯æ–‡ä»¶ï¼Œå®ƒçš„ç›®çš„æ˜¯å¯¹ç£ç›˜ä¸Šçš„æ–‡ä»¶è¿›è¡Œç»„ç»‡ç®¡ç†ï¼Œé‚£ç»„ç»‡çš„æ–¹å¼ä¸åŒï¼Œå°±ä¼šå½¢æˆä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿã€‚\nLinux æœ€ç»å…¸çš„ä¸€å¥è¯æ˜¯ï¼šã€Œä¸€åˆ‡çš†æ–‡ä»¶ã€ï¼Œä¸ä»…æ™®é€šçš„æ–‡ä»¶å’Œç›®å½•ï¼Œå°±è¿å—è®¾å¤‡ã€ç®¡é“ã€socket ç­‰ï¼Œä¹Ÿéƒ½æ˜¯ç»Ÿä¸€äº¤ç»™æ–‡ä»¶ç³»ç»Ÿç®¡ç†çš„ã€‚\nLinux æ–‡ä»¶ç³»ç»Ÿä¼šä¸ºæ¯ä¸ªæ–‡ä»¶åˆ†é…ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼šInodeï¼ˆindex nodeï¼‰å’Œç›®å½•é¡¹ï¼ˆdirectory entryï¼‰ï¼Œå®ƒä»¬ä¸»è¦ç”¨æ¥è®°å½•æ–‡ä»¶çš„å…ƒä¿¡æ¯å’Œç›®å½•å±‚æ¬¡ç»“æ„ã€‚\nInodeï¼Œä¹Ÿå°±æ˜¯inodeï¼Œç”¨æ¥è®°å½•æ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼Œæ¯”å¦‚ inode ç¼–å·ã€æ–‡ä»¶å¤§å°ã€è®¿é—®æƒé™ã€åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€æ•°æ®åœ¨ç£ç›˜çš„ä½ç½®ç­‰ç­‰ã€‚Inodeæ˜¯æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ï¼Œå®ƒä»¬ä¹‹é—´ä¸€ä¸€å¯¹åº”ï¼Œä¹ŸåŒæ ·éƒ½ä¼šè¢«å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­ï¼Œæ‰€ä»¥InodeåŒæ ·å ç”¨ç£ç›˜ç©ºé—´ã€‚\nç›®å½•é¡¹ï¼Œä¹Ÿå°±æ˜¯dentryï¼Œç”¨æ¥è®°å½•æ–‡ä»¶çš„åå­—ã€InodeæŒ‡é’ˆä»¥åŠä¸å…¶ä»–ç›®å½•é¡¹çš„å±‚çº§å…³è”å…³ç³»ã€‚å¤šä¸ªç›®å½•é¡¹å…³è”èµ·æ¥ï¼Œå°±ä¼šå½¢æˆç›®å½•ç»“æ„ï¼Œä½†å®ƒä¸Inodeä¸åŒçš„æ˜¯ï¼Œç›®å½•é¡¹æ˜¯ç”±å†…æ ¸ç»´æŠ¤çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œä¸å­˜æ”¾äºç£ç›˜ï¼Œè€Œæ˜¯ç¼“å­˜åœ¨å†…å­˜ã€‚\nç”±äºInodeå”¯ä¸€æ ‡è¯†ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œç›®å½•é¡¹è®°å½•ç€æ–‡ä»¶çš„åï¼Œæ‰€ä»¥ç›®å½•é¡¹å’ŒInodeçš„å…³ç³»æ˜¯å¤šå¯¹ä¸€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ªç›®å½•ã€‚æ¯”å¦‚ï¼Œç¡¬é“¾æ¥çš„å®ç°å°±æ˜¯å¤šä¸ªç›®å½•é¡¹ä¸­çš„InodeæŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶ã€‚\næ³¨æ„ï¼Œç›®å½•ä¹Ÿæ˜¯æ–‡ä»¶ï¼Œä¹Ÿæ˜¯ç”¨Inodeå”¯ä¸€æ ‡è¯†ï¼Œå’Œæ™®é€šæ–‡ä»¶ä¸åŒçš„æ˜¯ï¼Œæ™®é€šæ–‡ä»¶åœ¨ç£ç›˜é‡Œé¢ä¿å­˜çš„æ˜¯æ–‡ä»¶æ•°æ®ï¼Œè€Œç›®å½•æ–‡ä»¶åœ¨ç£ç›˜é‡Œé¢ä¿å­˜å­ç›®å½•æˆ–æ–‡ä»¶ã€‚\nç›®å½•é¡¹å’Œç›®å½•æ˜¯ä¸€ä¸ªä¸œè¥¿å—ï¼Ÿ è™½ç„¶åå­—å¾ˆç›¸è¿‘ï¼Œä½†æ˜¯å®ƒä»¬ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œç›®å½•æ˜¯ä¸ªæ–‡ä»¶ï¼ŒæŒä¹…åŒ–å­˜å‚¨åœ¨ç£ç›˜ï¼Œè€Œç›®å½•é¡¹æ˜¯å†…æ ¸ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œç¼“å­˜åœ¨å†…å­˜ã€‚\nå¦‚æœæŸ¥è¯¢ç›®å½•é¢‘ç¹ä»ç£ç›˜è¯»ï¼Œæ•ˆç‡ä¼šå¾ˆä½ï¼Œæ‰€ä»¥å†…æ ¸ä¼šæŠŠå·²ç»è¯»è¿‡çš„ç›®å½•ç”¨ç›®å½•é¡¹è¿™ä¸ªæ•°æ®ç»“æ„ç¼“å­˜åœ¨å†…å­˜ï¼Œä¸‹æ¬¡å†æ¬¡è¯»åˆ°ç›¸åŒçš„ç›®å½•æ—¶ï¼Œåªéœ€ä»å†…å­˜è¯»å°±å¯ä»¥ï¼Œå¤§å¤§æé«˜äº†æ–‡ä»¶ç³»ç»Ÿçš„æ•ˆç‡ã€‚\næ³¨æ„ï¼Œç›®å½•é¡¹è¿™ä¸ªæ•°æ®ç»“æ„ä¸åªæ˜¯è¡¨ç¤ºç›®å½•ï¼Œä¹Ÿæ˜¯å¯ä»¥è¡¨ç¤ºæ–‡ä»¶çš„ã€‚\n##ã€€æ–‡ä»¶æ•°æ®æ˜¯å¦‚ä½•å­˜å‚¨åœ¨ç£ç›˜çš„å‘¢ï¼Ÿ ç£ç›˜è¯»å†™çš„æœ€å°å•ä½æ˜¯æ‰‡åŒºï¼Œæ‰‡åŒºçš„å¤§å°åªæœ‰ 512å­—èŠ‚ï¼Œé‚£ä¹ˆå¦‚æœæ•°æ®å¤§äº512å­—èŠ‚æ—¶å€™ï¼Œç£ç›˜éœ€è¦ä¸åœåœ°ç§»åŠ¨ç£å¤´æ¥æŸ¥æ‰¾æ•°æ®ï¼Œæˆ‘ä»¬çŸ¥é“ä¸€èˆ¬çš„æ–‡ä»¶å¾ˆå®¹æ˜“è¶…è¿‡512å­—èŠ‚é‚£ä¹ˆå¦‚æœæŠŠå¤šä¸ªæ‰‡åŒºåˆå¹¶ä¸ºä¸€ä¸ªå—ï¼Œé‚£ä¹ˆç£ç›˜å°±å¯ä»¥æé«˜æ•ˆç‡äº†ã€‚é‚£ä¹ˆç£å¤´ä¸€æ¬¡è¯»å–å¤šä¸ªæ‰‡åŒºå°±ä¸ºä¸€ä¸ªå—â€œblockâ€ï¼ˆLinuxä¸Šç§°ä¸ºå—ï¼ŒWindowsä¸Šç§°ä¸ºç°‡ï¼‰ã€‚æ‰€ä»¥ï¼Œæ–‡ä»¶ç³»ç»ŸæŠŠå¤šä¸ªæ‰‡åŒºç»„æˆäº†ä¸€ä¸ªé€»è¾‘å—ï¼Œæ¯æ¬¡è¯»å†™çš„æœ€å°å•ä½å°±æ˜¯é€»è¾‘å—ï¼ˆæ•°æ®å—ï¼‰ï¼ŒLinux ä¸­çš„é€»è¾‘å—å¤§å°ä¸º 4KBï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡æ€§è¯»å†™ 8 ä¸ªæ‰‡åŒºï¼Œè¿™å°†å¤§å¤§æé«˜äº†ç£ç›˜çš„è¯»å†™çš„æ•ˆç‡ã€‚ sector size \u0026lt;= block size \u0026lt;= memory page size\næ–‡ä»¶ç³»ç»Ÿè®°å½•çš„æ•°æ®ï¼Œé™¤äº†å…¶è‡ªèº«å¤–ï¼Œè¿˜æœ‰æ•°æ®çš„æƒé™ä¿¡æ¯ï¼Œæ‰€æœ‰è€…ç­‰å±æ€§ï¼Œè¿™äº›ä¿¡æ¯éƒ½ä¿å­˜åœ¨inodeä¸­ï¼Œé‚£ä¹ˆè°æ¥è®°å½•inodeä¿¡æ¯å’Œæ–‡ä»¶ç³»ç»Ÿæœ¬èº«çš„ä¿¡æ¯å‘¢ï¼Œæ¯”å¦‚è¯´æ–‡ä»¶ç³»ç»Ÿçš„æ ¼å¼ï¼Œinodeä¸dataçš„æ•°é‡å‘¢ï¼Ÿé‚£ä¹ˆå°±æœ‰ä¸€ä¸ªè¶…çº§åŒºå—ï¼ˆsupper blockï¼‰æ¥è®°å½•è¿™äº›ä¿¡æ¯äº†ã€‚\nsuperblockï¼šè®°å½•æ­¤ filesystem çš„æ•´ä½“ä¿¡æ¯ï¼ŒåŒ…æ‹¬inode/blockçš„æ€»é‡ã€ä½¿ç”¨é‡ã€å‰©ä½™é‡ï¼Œ ä»¥åŠæ–‡ä»¶ç³»ç»Ÿçš„æ ¼å¼ä¸ç›¸å…³ä¿¡æ¯ç­‰ inodeï¼šè®°å½•æ–‡ä»¶çš„å±æ€§ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨statå‘½ä»¤æŸ¥çœ‹inodeä¿¡æ¯ã€‚ blockï¼šå®é™…æ–‡ä»¶çš„å†…å®¹ï¼Œå¦‚æœä¸€ä¸ªæ–‡ä»¶å¤§äºä¸€ä¸ªå—æ—¶å€™ï¼Œé‚£ä¹ˆå°†å ç”¨å¤šä¸ªblockï¼Œä½†æ˜¯ä¸€ä¸ªå—åªèƒ½å­˜æ”¾ä¸€ä¸ªæ–‡ä»¶ã€‚ï¼ˆå› ä¸ºæ•°æ®æ˜¯ç”±inodeæŒ‡å‘çš„ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªæ–‡ä»¶çš„æ•°æ®å­˜æ”¾åœ¨åŒä¸€ä¸ªå—ä¸­ï¼Œå°±ä¼šä¹±å¥—äº†ï¼‰ Inodeç”¨æ¥æŒ‡å‘æ•°æ®blockï¼Œé‚£ä¹ˆåªè¦æ‰¾åˆ°inodeï¼Œå†ç”±inodeæ‰¾åˆ°blockç¼–å·ï¼Œé‚£ä¹ˆå®é™…æ•°æ®å°±èƒ½æ‰¾å‡ºæ¥äº†ã€‚\nInodeæ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šçš„æ•°æ®ï¼Œä¸ºäº†åŠ é€Ÿæ–‡ä»¶çš„è®¿é—®ï¼Œé€šå¸¸ä¼šæŠŠInodeåŠ è½½åˆ°å†…å­˜ä¸­ã€‚æˆ‘ä»¬ä¸å¯èƒ½æŠŠè¶…çº§å—å’ŒInodeåŒºå…¨éƒ¨åŠ è½½åˆ°å†…å­˜ï¼Œè¿™æ ·å†…å­˜è‚¯å®šæ’‘ä¸ä½ï¼Œæ‰€ä»¥åªæœ‰å½“éœ€è¦ä½¿ç”¨çš„æ—¶å€™ï¼Œæ‰å°†å…¶åŠ è½½è¿›å†…å­˜ï¼Œå®ƒä»¬åŠ è½½è¿›å†…å­˜çš„æ—¶æœºæ˜¯ä¸åŒçš„ï¼š\nè¶…çº§å—ï¼šå½“æ–‡ä»¶ç³»ç»ŸæŒ‚è½½æ—¶è¿›å…¥å†…å­˜ï¼› InodeåŒºï¼šå½“æ–‡ä»¶è¢«è®¿é—®æ—¶è¿›å…¥å†…å­˜ï¼› è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ æ–‡ä»¶ç³»ç»Ÿçš„ç§ç±»ä¼—å¤šï¼Œè€Œæ“ä½œç³»ç»Ÿå¸Œæœ›å¯¹ç”¨æˆ·æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œäºæ˜¯åœ¨ç”¨æˆ·å±‚ä¸æ–‡ä»¶ç³»ç»Ÿå±‚å¼•å…¥äº†ä¸­é—´å±‚ï¼Œè¿™ä¸ªä¸­é—´å±‚å°±ç§°ä¸ºè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆVirtual File Systemï¼ŒVFSï¼‰ã€‚VFS å®šä¹‰äº†ä¸€ç»„æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿéƒ½æ”¯æŒçš„æ•°æ®ç»“æ„å’Œæ ‡å‡†æ¥å£ï¼Œè¿™æ ·ç¨‹åºå‘˜ä¸éœ€è¦äº†è§£æ–‡ä»¶ç³»ç»Ÿçš„å·¥ä½œåŸç†ï¼Œåªéœ€è¦äº†è§£ VFS æä¾›çš„ç»Ÿä¸€æ¥å£å³å¯ã€‚åœ¨ Linux æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·ç©ºé—´ã€ç³»ç»Ÿè°ƒç”¨ã€è™šæ‹Ÿæœºæ–‡ä»¶ç³»ç»Ÿã€ç¼“å­˜ã€æ–‡ä»¶ç³»ç»Ÿä»¥åŠå­˜å‚¨ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾ï¼š Linux æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿä¹Ÿä¸å°‘ï¼Œæ ¹æ®å­˜å‚¨ä½ç½®çš„ä¸åŒï¼Œå¯ä»¥æŠŠæ–‡ä»¶ç³»ç»Ÿåˆ†ä¸ºä¸‰ç±»ï¼š\nç£ç›˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ˜¯ç›´æ¥æŠŠæ•°æ®å­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼Œæ¯”å¦‚ Ext 2/3/4ã€XFS ç­‰éƒ½æ˜¯è¿™ç±»æ–‡ä»¶ç³»ç»Ÿã€‚ å†…å­˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™ç±»æ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®ä¸æ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜çš„ï¼Œè€Œæ˜¯å ç”¨å†…å­˜ç©ºé—´ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„/proc å’Œ /sys æ–‡ä»¶ç³»ç»Ÿéƒ½å±äºè¿™ä¸€ç±»ï¼Œè¯»å†™è¿™ç±»æ–‡ä»¶ï¼Œå®é™…ä¸Šæ˜¯è¯»å†™å†…æ ¸ä¸­ç›¸å…³çš„æ•°æ®ã€‚ ç½‘ç»œçš„æ–‡ä»¶ç³»ç»Ÿï¼Œç”¨æ¥è®¿é—®å…¶ä»–è®¡ç®—æœºä¸»æœºæ•°æ®çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚ NFSã€SMB ç­‰ç­‰ã€‚ æ–‡ä»¶ç³»ç»Ÿé¦–å…ˆè¦å…ˆæŒ‚è½½åˆ°æŸä¸ªç›®å½•æ‰å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œæ¯”å¦‚ Linux ç³»ç»Ÿåœ¨å¯åŠ¨æ—¶ï¼Œä¼šæŠŠæ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°æ ¹ç›®å½•ã€‚\nLinux é‡‡ç”¨ä¸ºåˆ†å±‚çš„ä½“ç³»ç»“æ„ï¼Œå°†ç”¨æˆ·æ¥å£å±‚ã€æ–‡ä»¶ç³»ç»Ÿå®ç°å’Œå­˜å‚¨è®¾å¤‡çš„é©±åŠ¨ç¨‹åºåˆ†éš”å¼€ï¼Œè¿›è€Œå…¼å®¹ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿã€‚è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆVirtual File System, VFSï¼‰æ˜¯ Linux å†…æ ¸ä¸­çš„è½¯ä»¶å±‚ï¼Œå®ƒåœ¨å†…æ ¸ä¸­æä¾›äº†ä¸€ç»„æ ‡å‡†çš„ã€æŠ½è±¡çš„æ–‡ä»¶æ“ä½œï¼Œå…è®¸ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿå®ç°å…±å­˜ï¼Œå¹¶å‘ç”¨æˆ·ç©ºé—´ç¨‹åºæä¾›ç»Ÿä¸€çš„æ–‡ä»¶ç³»ç»Ÿæ¥å£ã€‚ä¸‹é¢è¿™å¼ å›¾å±•ç¤ºäº† Linux è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿçš„æ•´ä½“ç»“æ„ï¼š ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åºç›´æ¥ã€æˆ–æ˜¯é€šè¿‡ç¼–ç¨‹è¯­è¨€æä¾›çš„åº“å‡½æ•°é—´æ¥è°ƒç”¨å†…æ ¸æä¾›çš„ System Call æ¥å£ï¼ˆå¦‚open()ã€write()ç­‰ï¼‰æ‰§è¡Œæ–‡ä»¶æ“ä½œã€‚System Call æ¥å£å†å°†åº”ç”¨ç¨‹åºçš„å‚æ•°ä¼ é€’ç»™è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå¤„ç†ã€‚\næ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿéƒ½ä¸º VFS å®ç°äº†ä¸€ç»„é€šç”¨æ¥å£ï¼Œå…·ä½“çš„æ–‡ä»¶ç³»ç»Ÿæ ¹æ®è‡ªå·±å¯¹ç£ç›˜ä¸Šæ•°æ®çš„ç»„ç»‡æ–¹å¼æ“ä½œç›¸åº”çš„æ•°æ®ã€‚å½“åº”ç”¨ç¨‹åºæ“ä½œæŸä¸ªæ–‡ä»¶æ—¶ï¼ŒVFS ä¼šæ ¹æ®æ–‡ä»¶è·¯å¾„æ‰¾åˆ°ç›¸åº”çš„æŒ‚è½½ç‚¹ï¼Œå¾—åˆ°å…·ä½“çš„æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯ï¼Œç„¶åè°ƒç”¨è¯¥æ–‡ä»¶ç³»ç»Ÿçš„å¯¹åº”æ“ä½œå‡½æ•°ã€‚\nVFS æä¾›äº†ä¸¤ä¸ªé’ˆå¯¹æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡çš„ç¼“å­˜ INode Cache å’Œ DEntry Cacheï¼Œå®ƒä»¬ç¼“å­˜æœ€è¿‘ä½¿ç”¨è¿‡çš„æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡ï¼Œç”¨æ¥åŠ å¿«å¯¹ INode å’Œ DEntry çš„è®¿é—®ã€‚Linux å†…æ ¸è¿˜æä¾›äº† Buffer Cache ç¼“å†²åŒºï¼Œç”¨æ¥ç¼“å­˜æ–‡ä»¶ç³»ç»Ÿå’Œç›¸å…³å—è®¾å¤‡ä¹‹é—´çš„è¯·æ±‚ï¼Œå‡å°‘è®¿é—®ç‰©ç†è®¾å¤‡çš„æ¬¡æ•°ï¼ŒåŠ å¿«è®¿é—®é€Ÿåº¦ã€‚Buffer Cache ä»¥ LRU åˆ—è¡¨çš„å½¢å¼ç®¡ç†ç¼“å†²åŒºã€‚\nVFS çš„å¥½å¤„æ˜¯å®ç°äº†åº”ç”¨ç¨‹åºçš„æ–‡ä»¶æ“ä½œä¸å…·ä½“çš„æ–‡ä»¶ç³»ç»Ÿçš„è§£è€¦ï¼Œä½¿å¾—ç¼–ç¨‹æ›´åŠ å®¹æ˜“ï¼š\nåº”ç”¨å±‚ç¨‹åºåªè¦ä½¿ç”¨ VFS å¯¹å¤–æä¾›çš„read()ã€write()ç­‰æ¥å£å°±å¯ä»¥æ‰§è¡Œæ–‡ä»¶æ“ä½œï¼Œä¸éœ€è¦å…³å¿ƒåº•å±‚æ–‡ä»¶ç³»ç»Ÿçš„å®ç°ç»†èŠ‚ï¼› æ–‡ä»¶ç³»ç»Ÿåªéœ€è¦å®ç° VFS æ¥å£å°±å¯ä»¥å…¼å®¹ Linuxï¼Œæ–¹ä¾¿ç§»æ¤ä¸ç»´æŠ¤ï¼› æ— éœ€å…³æ³¨å…·ä½“çš„å®ç°ç»†èŠ‚ï¼Œå°±å®ç°è·¨æ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶æ“ä½œã€‚ äº†è§£ Linux æ–‡ä»¶ç³»ç»Ÿçš„æ•´ä½“ç»“æ„åï¼Œä¸‹é¢ä¸»è¦åˆ†æ Linux VFS çš„æŠ€æœ¯åŸç†ã€‚ç”±äºæ–‡ä»¶ç³»ç»Ÿä¸è®¾å¤‡é©±åŠ¨çš„å®ç°éå¸¸å¤æ‚ï¼Œç¬”è€…ä¹Ÿæœªæ¥è§¦è¿‡è¿™æ–¹é¢çš„å†…å®¹ï¼Œå› æ­¤æ–‡ä¸­ä¸ä¼šæ¶‰åŠå…·ä½“æ–‡ä»¶ç³»ç»Ÿçš„å®ç°ã€‚\nVFS æ¥å£ Linux ä»¥ä¸€ç»„é€šç”¨å¯¹è±¡çš„è§’åº¦çœ‹å¾…æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯ä¸€çº§å¯¹è±¡ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š fd å’Œ file æ¯ä¸ªè¿›ç¨‹éƒ½æŒæœ‰ä¸€ä¸ªfd[]æ•°ç»„ï¼Œæ•°ç»„é‡Œé¢å­˜æ”¾çš„æ˜¯æŒ‡å‘fileç»“æ„ä½“çš„æŒ‡é’ˆï¼ŒåŒä¸€è¿›ç¨‹çš„ä¸åŒfdå¯ä»¥æŒ‡å‘åŒä¸€ä¸ªfileå¯¹è±¡ï¼›\nfileæ˜¯å†…æ ¸ä¸­çš„æ•°æ®ç»“æ„ï¼Œè¡¨ç¤ºä¸€ä¸ªè¢«è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼Œå’Œè¿›ç¨‹ç›¸å…³è”ã€‚å½“åº”ç”¨ç¨‹åºè°ƒç”¨open()å‡½æ•°çš„æ—¶å€™ï¼ŒVFS å°±ä¼šåˆ›å»ºç›¸åº”çš„fileå¯¹è±¡ã€‚å®ƒä¼šä¿å­˜æ‰“å¼€æ–‡ä»¶çš„çŠ¶æ€ï¼Œä¾‹å¦‚æ–‡ä»¶æƒé™ã€è·¯å¾„ã€åç§»é‡ç­‰ç­‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // https://elixir.bootlin.com/linux/v5.4.93/source/include/linux/fs.h#L936 ç»“æ„ä½“å·²åˆ å‡ struct file { struct path f_path; struct inode *f_inode; const struct file_operations *f_op; unsigned int f_flags; fmode_t f_mode; loff_t f_pos; struct fown_struct f_owner; } // https://elixir.bootlin.com/linux/v5.4.93/source/include/linux/path.h#L8 struct path { struct vfsmount *mnt; struct dentry *dentry; } ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œæ–‡ä»¶çš„è·¯å¾„å®é™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡å‘ DEntry ç»“æ„ä½“çš„æŒ‡é’ˆï¼ŒVFS é€šè¿‡ DEntry ç´¢å¼•åˆ°æ–‡ä»¶çš„ä½ç½®ã€‚\né™¤äº†æ–‡ä»¶åç§»é‡f_posæ˜¯è¿›ç¨‹ç§æœ‰çš„æ•°æ®å¤–ï¼Œå…¶ä»–çš„æ•°æ®éƒ½æ¥è‡ªäº INode å’Œ DEntryï¼Œå’Œæ‰€æœ‰è¿›ç¨‹å…±äº«ã€‚ä¸åŒè¿›ç¨‹çš„fileå¯¹è±¡å¯ä»¥æŒ‡å‘åŒä¸€ä¸ª DEntry å’Œ Inodeï¼Œä»è€Œå®ç°æ–‡ä»¶çš„å…±äº«ã€‚\nDEntry Inode Linuxæ–‡ä»¶ç³»ç»Ÿä¼šä¸ºæ¯ä¸ªæ–‡ä»¶éƒ½åˆ†é…ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼Œç›®å½•é¡¹ï¼ˆDEntry, Directory Entryï¼‰å’Œç´¢å¼•èŠ‚ç‚¹ï¼ˆINode, Index Nodeï¼‰ã€‚\nDEntry ç”¨æ¥ä¿å­˜æ–‡ä»¶è·¯å¾„å’Œ INode ä¹‹é—´çš„æ˜ å°„ï¼Œä»è€Œæ”¯æŒåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ç§»åŠ¨ã€‚DEntry ç”± VFS ç»´æŠ¤ï¼Œæ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿå…±äº«ï¼Œä¸å’Œå…·ä½“çš„è¿›ç¨‹å…³è”ã€‚dentryå¯¹è±¡ä»æ ¹ç›®å½•â€œ/â€å¼€å§‹ï¼Œæ¯ä¸ªdentryå¯¹è±¡éƒ½ä¼šæŒæœ‰è‡ªå·±çš„å­ç›®å½•å’Œæ–‡ä»¶ï¼Œè¿™æ ·å°±å½¢æˆäº†æ–‡ä»¶æ ‘ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœè¦è®¿é—®â€/home/beihai/a.txtâ€æ–‡ä»¶å¹¶å¯¹ä»–æ“ä½œï¼Œç³»ç»Ÿä¼šè§£ææ–‡ä»¶è·¯å¾„ï¼Œé¦–å…ˆä»â€œ/â€æ ¹ç›®å½•çš„dentryå¯¹è±¡å¼€å§‹è®¿é—®ï¼Œç„¶åæ‰¾åˆ°â€home/â€œç›®å½•ï¼Œå…¶æ¬¡æ˜¯â€œbeihai/â€ï¼Œæœ€åæ‰¾åˆ°â€œa.txtâ€çš„dentryç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“é‡Œé¢d_inodeå­—æ®µå°±å¯¹åº”ç€è¯¥æ–‡ä»¶ã€‚\n1 2 3 4 5 6 7 8 // https://elixir.bootlin.com/linux/v5.4.93/source/include/linux/dcache.h#L89 ç»“æ„ä½“å·²åˆ å‡ struct dentry { struct dentry *d_parent; // çˆ¶ç›®å½• struct qstr d_name; // æ–‡ä»¶åç§° struct inode *d_inode; // å…³è”çš„ inode struct list_head d_child; // çˆ¶ç›®å½•ä¸­çš„å­ç›®å½•å’Œæ–‡ä»¶ struct list_head d_subdirs; // å½“å‰ç›®å½•ä¸­çš„å­ç›®å½•å’Œæ–‡ä»¶ } æ¯ä¸€ä¸ªdentryå¯¹è±¡éƒ½æŒæœ‰ä¸€ä¸ªå¯¹åº”çš„inodeå¯¹è±¡ï¼Œè¡¨ç¤º Linux ä¸­ä¸€ä¸ªå…·ä½“çš„ç›®å½•é¡¹æˆ–æ–‡ä»¶ã€‚INode åŒ…å«ç®¡ç†æ–‡ä»¶ç³»ç»Ÿä¸­çš„å¯¹è±¡æ‰€éœ€çš„æ‰€æœ‰å…ƒæ•°æ®ï¼Œä»¥åŠå¯ä»¥åœ¨è¯¥æ–‡ä»¶å¯¹è±¡ä¸Šæ‰§è¡Œçš„æ“ä½œã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // https://elixir.bootlin.com/linux/v5.4.93/source/include/linux/fs.h#L628 ç»“æ„ä½“å·²åˆ å‡ struct inode { umode_t i_mode; // æ–‡ä»¶æƒé™åŠç±»å‹ kuid_t i_uid; // user id kgid_t i_gid; // group id const struct inode_operations *i_op; // inode æ“ä½œå‡½æ•°ï¼Œå¦‚ createï¼Œmkdirï¼Œlookupï¼Œrename ç­‰ struct super_block *i_sb; // æ‰€å±çš„ SuperBlock loff_t i_size; // æ–‡ä»¶å¤§å° struct timespec i_atime; // æ–‡ä»¶æœ€åè®¿é—®æ—¶é—´ struct timespec i_mtime; // æ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´ struct timespec i_ctime; // æ–‡ä»¶å…ƒæ•°æ®æœ€åä¿®æ”¹æ—¶é—´ï¼ˆåŒ…æ‹¬æ–‡ä»¶åç§°ï¼‰ const struct file_operations *i_fop; // æ–‡ä»¶æ“ä½œå‡½æ•°ï¼Œopenã€write ç­‰ void *i_private; // æ–‡ä»¶ç³»ç»Ÿçš„ç§æœ‰æ•°æ® } è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿç»´æŠ¤äº†ä¸€ä¸ª DEntry Cache ç¼“å­˜ï¼Œç”¨æ¥ä¿å­˜æœ€è¿‘ä½¿ç”¨çš„ DEntryï¼ŒåŠ é€ŸæŸ¥è¯¢æ“ä½œã€‚å½“è°ƒç”¨open()å‡½æ•°æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå†…æ ¸ä¼šç¬¬ä¸€æ—¶é—´æ ¹æ®æ–‡ä»¶è·¯å¾„åˆ° DEntry Cache é‡Œé¢å¯»æ‰¾ç›¸åº”çš„ DEntryï¼Œæ‰¾åˆ°äº†å°±ç›´æ¥æ„é€ ä¸€ä¸ªfileå¯¹è±¡å¹¶è¿”å›ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸åœ¨ç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆ VFS ä¼šæ ¹æ®æ‰¾åˆ°çš„æœ€è¿‘ç›®å½•ä¸€çº§ä¸€çº§åœ°å‘ä¸‹åŠ è½½ï¼Œç›´åˆ°æ‰¾åˆ°ç›¸åº”çš„æ–‡ä»¶ã€‚æœŸé—´ VFS ä¼šç¼“å­˜æ‰€æœ‰è¢«åŠ è½½ç”Ÿæˆçš„dentryã€‚\nINode å­˜å‚¨çš„æ•°æ®å­˜æ”¾åœ¨ç£ç›˜ä¸Šï¼Œç”±å…·ä½“çš„æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œç»„ç»‡ï¼Œå½“éœ€è¦è®¿é—®ä¸€ä¸ª INode æ—¶ï¼Œä¼šç”±æ–‡ä»¶ç³»ç»Ÿä»ç£ç›˜ä¸ŠåŠ è½½ç›¸åº”çš„æ•°æ®å¹¶æ„é€  INodeã€‚ä¸€ä¸ª INode å¯èƒ½è¢«å¤šä¸ª DEntry æ‰€å…³è”ï¼Œå³ç›¸å½“äºä¸ºæŸä¸€æ–‡ä»¶åˆ›å»ºäº†å¤šä¸ªæ–‡ä»¶è·¯å¾„ï¼ˆé€šå¸¸æ˜¯ä¸ºæ–‡ä»¶å»ºç«‹ç¡¬é“¾æ¥ï¼‰ã€‚\nç›®å½•é¡¹ä»‹ç» Ext4æ–‡ä»¶ç³»ç»Ÿç›®å½•é¡¹æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š\nçº¿æ€§æ–¹å¼ è¯¥æ–¹å¼çš„ç›®å½•é¡¹ä»¥ext4_dir_entry_2çš„ç»“æ„ä¸€ä¸ªæ¥è¿ä¸€ä¸ªç›´æ¥å­˜å‚¨åœ¨ç›®å½•ç»“ç‚¹æ‰€æŒ‡å‘çš„blockå—ä¸­ã€‚ï¼ˆç¼ºçœé…ç½®ä½¿ç”¨ext4_dir_entry_2è¿™ä¸ªç»“æ„ï¼‰ Hashæ ‘çš„æ–¹å¼ è‹¥ç›®å½•ä¸‹çš„æ–‡ä»¶æ•°é‡å¾ˆå¤šï¼Œåˆ™è‹¥æŒ‰ç…§çº¿æ€§æ–¹å¼æŸ¥æ‰¾å¯¹åº”æ–‡ä»¶åçš„ä¿¡æ¯åˆ™ä¼šå¾ˆä½æ•ˆã€‚Hashæ ‘çš„æ–¹å¼ï¼Œåˆ™å¯ä»¥ç”¨æ–‡ä»¶åæ¥åšhashè®¡ç®—ï¼Œä»è€Œå®šä½åˆ°å¯¹åº”æ–‡ä»¶çš„ç›®å½•é¡¹ç»“æ„æ‰€åœ¨çš„blockï¼Œä»è€Œç¼©å°æŸ¥æ‰¾èŒƒå›´ã€åŠ å¿«æŸ¥æ‰¾æ•ˆç‡ã€‚ æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦å¼€å¯äº†æ–¹å¼äºŒçš„ç›®å½•ç®¡ç†æ–¹å¼ 1 2 âœ nebula-tool tune2fs -l /dev/vda1 | grep dir_index Filesystem features: has_journal ext_attr resize_inode dir_index filetype needs_recovery extent 64bit flex_bg sparse_super huge_file uninit_bg dir_nlink extra_isize hashæ ‘ç®¡ç†æ–¹å¼çš„æ‰“å¼€å’Œå…³é—­ 1 2 3 4 5 6 7 8 9 10 11 12 13 root@f303server:~# tune2fs -O ^dir_index /dev/sde3 tune2fs 1.42.11 (09-Jul-2014) root@f303server:~# tune2fs -l /dev/sde3 | grep dir_index # æŸ¥æ‰¾ä¸åˆ°äº† root@f303server:~# tune2fs -O dir_index /dev/sde3 tune2fs 1.42.11 (09-Jul-2014) root@f303server:~# tune2fs -l /dev/sde3 | grep dir_index Filesystem features: has_journal ext_attr resize_inode dir_index filetype needs_recovery extent flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize æ€ä¹ˆåˆ¤æ–­æŸç›®å½•æ˜¯å¦ä»¥hashæ ‘çš„æ–¹å¼ç®¡ç† æ–‡ä»¶ç³»ç»Ÿå¼€å¯äº†hashæ ‘ç®¡ç†ç›®å½•ç»“ç‚¹çš„æ–¹å¼å¹¶ä¸æ„å‘³ç€æ‰€æœ‰çš„ç›®å½•éƒ½æŒ‰æ ‘å½¢ç»“æ„ç»„ç»‡ç®¡ç†ã€‚åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿä¼šæ ¹æ®æŸä¸ªç›®å½•åº•ä¸‹æ–‡ä»¶çš„å¤šå°‘æ¥è‡ªåŠ¨è¿›è¡Œç›®å½•ç®¡ç†æ–¹å¼çš„é€‰æ‹©ï¼Œåªæœ‰å½“æ–‡ä»¶æ•°é‡å¤§äºæŸä¸ªæ•°æ—¶ï¼Œæ‰ä¼šé‡‡ç”¨hashæ ‘ç®¡ç†æ–¹å¼ã€‚\næ€ä¹ˆåˆ¤æ–­æŸç›®å½•çš„ç®¡ç†æ–¹å¼æ˜¯é‚£ç§ï¼Ÿ è‹¥ä¸æ˜¯hashæ ‘çš„ç®¡ç†æ–¹å¼ï¼Œåˆ™htreeä¸­debugfsä¸­åˆ™ä¼šæœ‰å¦‚ä¸‹æç¤º\n1 2 3 4 5 âœ nebula-tool debugfs debugfs 1.42.9 (28-Dec-2013) debugfs: htree htree: Filesystem not open debugfs: è‹¥æ˜¯hash æ ‘ï¼Œåˆ™å±•ç¤º:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 Root node dump: Reserved zero: 0 Hash Version: 1 Info length: 8 Indirect levels: 0 Flags: 0 Number of entries (count): 2 Number of entries (limit): 508 Entry #0: Hash 0x00000000, block 1 Entry #1: Hash 0x775173ee, block 2 Entry #0: Hash 0x00000000, block 1 Reading directory block 1, phys 3154297 791969 0x33788c78-7df72ede (20) rtmutex.c 791971 0x12e2688e-f00920c3 (28) .latencytop.o.cmd 791973 0x6d76fd8a-f7dad208 (16) futex.o 791974 0x1f1d389c-0beb6325 (20) ns_cgroup.c 791975 0x21f726a2-367f43fb (24) .built-in.o.cmd 791977 0x2a43c4ba-ae0695eb (16) itimer.o 791978 0x6139ce78-4032f3c2 (16) user.c ext4_dir_entry_2 struct å‚æ•° ä¸Šè¡¨æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥ç»“æ„ä¸­å…±5ä¸ªæ•°æ®é¡¹ï¼Œå‰å››é¡¹å 8byteï¼Œ é€šè¿‡æ ¹ç›®å½•ä¸ºä¾‹ï¼Œé€šè¿‡hexdumpæŸ¥çœ‹å…¶äºŒè¿›åˆ¶ä»£ç ï¼Œåˆ™â€œç›®å½•é¡¹çš„é•¿åº¦ï¼ˆrec_lenï¼‰= æ–‡ä»¶åé•¿åº¦(name_len) + 8 â€ã€‚ä½†æ˜¯åœ¨å¾ˆå¤šæƒ…å†µä¸‹rec_len \u0026gt; = name_len + 8ã€‚åŸå› æ˜¯å› ä¸ºç›®å½•é¡¹æ¯ä¸€é¡¹çš„èµ·å§‹ä½ç½®å¿…é¡»æŒ‰ç…§åä¸¤ä½ 00 å¯¹é½ã€‚æ•…æœ‰æ—¶å€™ä¼šæµªè´¹å‡ ä¸ªå­—èŠ‚ã€‚\nç”±å›¾å¯çŸ¥ï¼Œåœ¨ç›®å½•æ–‡ä»¶çš„æ•°æ®å—ä¸­å­˜å‚¨äº†å…¶ä¸‹çš„æ–‡ä»¶åã€ç›®å½•åã€ç›®å½•æœ¬èº«çš„ç›¸å¯¹åç§°\u0026quot;.\u0026quot;å’Œä¸Šçº§ç›®å½•çš„ç›¸å¯¹åç§°\u0026quot;..\u0026quot;ï¼Œè¿˜å­˜å‚¨äº†è¿™äº›æ–‡ä»¶åå¯¹åº”çš„inodeå·ã€ç›®å½•é¡¹é•¿åº¦rec_lenã€æ–‡ä»¶åé•¿åº¦name_lenå’Œæ–‡ä»¶ç±»å‹file_typeã€‚æ³¨æ„åˆ°é™¤äº†æ–‡ä»¶æœ¬èº«çš„inodeè®°å½•äº†æ–‡ä»¶ç±»å‹ï¼Œå…¶æ‰€åœ¨çš„ç›®å½•çš„æ•°æ®å—ä¹Ÿè®°å½•äº†æ–‡ä»¶ç±»å‹ã€‚ç”±äºrec_lenåªèƒ½æ˜¯4çš„å€æ•°ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨\u0026quot;\\0\u0026quot;æ¥å¡«å……name_lenä¸å¤Ÿå‡‘æ»¡4å€æ•°çš„éƒ¨åˆ†ã€‚è‡³äºrec_lenå…·ä½“æ˜¯ä»€ä¹ˆï¼Œåªéœ€çŸ¥é“å®ƒæ˜¯ä¸€ç§åç§»å³å¯ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œinode tableä¸­çš„inodeè‡ªèº«å¹¶æ²¡æœ‰å­˜å‚¨æ¯ä¸ªinodeçš„inodeå·ï¼Œå®ƒæ˜¯å­˜å‚¨åœ¨ç›®å½•çš„data blockä¸­çš„ï¼Œé€šè¿‡inodeå·å¯ä»¥è®¡ç®—å¹¶ç´¢å¼•åˆ°inode tableä¸­è¯¥inodeå·å¯¹åº”çš„inodeè®°å½•ï¼Œå¯ä»¥è®¤ä¸ºè¿™ä¸ªinodeå·æ˜¯ä¸€ä¸ªinodeæŒ‡é’ˆ (å½“ç„¶ï¼Œå¹¶éçœŸçš„æ˜¯æŒ‡é’ˆï¼Œä½†æœ‰åŠ©äºç†è§£é€šè¿‡inodeå·ç´¢å¼•æ‰¾åˆ°å¯¹åº”inodeçš„è¿™ä¸ªè¿‡ç¨‹ï¼Œåæ–‡å°†åœ¨éœ€è¦çš„æ—¶å€™ä½¿ç”¨inodeæŒ‡é’ˆè¿™ä¸ªè¯æ¥è¡¨ç¤ºinodeå·ã€‚è‡³æ­¤ï¼Œå·²ç»çŸ¥é“äº†ä¸¤ç§æŒ‡é’ˆï¼šä¸€ç§æ˜¯inode tableä¸­æ¯ä¸ªinodeè®°å½•æŒ‡å‘å…¶å¯¹åº”data blockçš„blockæŒ‡é’ˆï¼Œä¸€ä¸ªæ­¤å¤„çš„â€œinodeæŒ‡é’ˆâ€)ã€‚\né™¤äº†inodeå·ï¼Œç›®å½•çš„data blockä¸­è¿˜ä½¿ç”¨æ•°å­—æ ¼å¼è®°å½•äº†æ–‡ä»¶ç±»å‹ï¼Œæ•°å­—æ ¼å¼å’Œæ–‡ä»¶ç±»å‹çš„å¯¹åº”å…³ç³»å¦‚ä¸‹å›¾ã€‚ æ³¨æ„åˆ°ç›®å½•çš„data blockä¸­å‰ä¸¤è¡Œå­˜å‚¨çš„æ˜¯ç›®å½•æœ¬èº«çš„ç›¸å¯¹åç§°\u0026quot;.\u0026ldquo;å’Œä¸Šçº§ç›®å½•çš„ç›¸å¯¹åç§°\u0026rdquo;..\u0026quot;ï¼Œå®ƒä»¬å®é™…ä¸Šæ˜¯ç›®å½•æœ¬èº«çš„ç¡¬é“¾æ¥å’Œä¸Šçº§ç›®å½•çš„ç¡¬é“¾æ¥ã€‚ç¡¬é“¾æ¥çš„æœ¬è´¨åé¢è¯´æ˜ã€‚\nå‰é¢æåˆ°è¿‡ï¼Œinodeç»“æ„è‡ªèº«å¹¶æ²¡æœ‰ä¿å­˜inodeå·ï¼ˆåŒæ ·ï¼Œä¹Ÿæ²¡æœ‰ä¿å­˜æ–‡ä»¶åï¼‰ï¼Œé‚£ä¹ˆinodeå·ä¿å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿç›®å½•çš„data blockä¸­ä¿å­˜äº†è¯¥ç›®å½•ä¸­æ¯ä¸ªæ–‡ä»¶çš„inodeå·ã€‚\nå¦ä¸€ä¸ªé—®é¢˜ï¼Œæ—¢ç„¶inodeä¸­æ²¡æœ‰inodeå·ï¼Œé‚£ä¹ˆå¦‚ä½•æ ¹æ®ç›®å½•data blockä¸­çš„inodeå·æ‰¾åˆ°inode tableä¸­å¯¹åº”çš„inodeå‘¢ï¼Ÿ\nå®é™…ä¸Šï¼Œåªè¦æœ‰äº†inodeå·ï¼Œå°±å¯ä»¥è®¡ç®—å‡ºinodeè¡¨ä¸­å¯¹åº”è¯¥inodeå·çš„inodeç»“æ„ã€‚åœ¨åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿçš„æ—¶å€™ï¼Œæ¯ä¸ªå—ç»„ä¸­çš„èµ·å§‹inodeå·ä»¥åŠinode tableçš„èµ·å§‹åœ°å€éƒ½å·²ç»ç¡®å®šäº†ï¼Œæ‰€ä»¥åªè¦çŸ¥é“inodeå·ï¼Œå°±èƒ½çŸ¥é“è¿™ä¸ªinodeå·å’Œè¯¥å—ç»„èµ·å§‹inodeå·çš„åç§»æ•°é‡ï¼Œå†æ ¹æ®æ¯ä¸ªinodeç»“æ„çš„å¤§å°(256å­—èŠ‚æˆ–å…¶å®ƒå¤§å°)ï¼Œå°±èƒ½è®¡ç®—å‡ºæ¥å¯¹åº”çš„inodeç»“æ„ã€‚\næ‰€ä»¥ï¼Œç›®å½•çš„data blockä¸­çš„inode numberå’Œinode tableä¸­çš„inodeæ˜¯é€šè¿‡è®¡ç®—çš„æ–¹å¼ä¸€ä¸€æ˜ å°„èµ·æ¥çš„ã€‚ä»å¦ä¸€ä¸ªè§’åº¦ä¸Šçœ‹ï¼Œç›®å½•data blockä¸­çš„inode numberæ˜¯æ‰¾åˆ°inode tableä¸­å¯¹åº”inodeè®°å½•çš„å”¯ä¸€æ–¹å¼ã€‚\nè€ƒè™‘ä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„æƒ…å†µï¼šç›®å½•data blockçš„è®°å½•å·²ç»åˆ é™¤ï¼Œä½†æ˜¯è¯¥è®°å½•å¯¹åº”çš„inodeç»“æ„ä»ç„¶å­˜åœ¨äºinode tableä¸­ã€‚è¿™ç§inodeç§°ä¸ºå­¤å„¿inodeï¼ˆorphan inodeï¼‰ï¼šå­˜åœ¨äºinode tableä¸­ï¼Œä½†å´æ— æ³•å†ç´¢å¼•åˆ°å®ƒã€‚å› ä¸ºç›®å½•ä¸­å·²ç»æ²¡æœ‰è¯¥inodeå¯¹åº”çš„æ–‡ä»¶è®°å½•äº†ï¼Œæ‰€ä»¥å…¶å®ƒè¿›ç¨‹å°†æ— æ³•æ‰¾åˆ°è¯¥inodeï¼Œä¹Ÿå°±æ— æ³•æ ¹æ®è¯¥inodeæ‰¾åˆ°è¯¥æ–‡ä»¶ä¹‹å‰æ‰€å ç”¨çš„data blockï¼Œè¿™æ­£æ˜¯åˆ›å»ºä¾¿åˆ é™¤æ‰€å®ç°çš„çœŸæ­£ä¸´æ—¶æ–‡ä»¶ï¼Œè¯¥ä¸´æ—¶æ–‡ä»¶åªæœ‰å½“å‰è¿›ç¨‹å’Œå­è¿›ç¨‹æ‰èƒ½è®¿é—®ã€‚\nSuperBlock SuperBlock è¡¨ç¤ºç‰¹å®šåŠ è½½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºæè¿°å’Œç»´æŠ¤æ–‡ä»¶ç³»ç»Ÿçš„çŠ¶æ€ï¼Œç”± VFS å®šä¹‰ï¼Œä½†é‡Œé¢çš„æ•°æ®æ ¹æ®å…·ä½“çš„æ–‡ä»¶ç³»ç»Ÿå¡«å……ã€‚æ¯ä¸ª SuperBlock ä»£è¡¨äº†ä¸€ä¸ªå…·ä½“çš„ç£ç›˜åˆ†åŒºï¼Œé‡Œé¢åŒ…å«äº†å½“å‰ç£ç›˜åˆ†åŒºçš„ä¿¡æ¯ï¼Œå¦‚æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€å‰©ä½™ç©ºé—´ç­‰ã€‚SuperBlock çš„ä¸€ä¸ªé‡è¦æˆå‘˜æ˜¯é“¾è¡¨s_listï¼ŒåŒ…å«æ‰€æœ‰ä¿®æ”¹è¿‡çš„ INodeï¼Œä½¿ç”¨è¯¥é“¾è¡¨å¾ˆå®¹æ˜“åŒºåˆ†å‡ºæ¥å“ªä¸ªæ–‡ä»¶è¢«ä¿®æ”¹è¿‡ï¼Œå¹¶é…åˆå†…æ ¸çº¿ç¨‹å°†æ•°æ®å†™å›ç£ç›˜ã€‚SuperBlock çš„å¦ä¸€ä¸ªé‡è¦æˆå‘˜æ˜¯s_opï¼Œå®šä¹‰äº†é’ˆå¯¹å…¶ INode çš„æ‰€æœ‰æ“ä½œæ–¹æ³•ï¼Œä¾‹å¦‚æ ‡è®°ã€é‡Šæ”¾ç´¢å¼•èŠ‚ç‚¹ç­‰ä¸€ç³»åˆ—æ“ä½œã€‚\n1 2 3 4 5 6 7 8 9 10 11 // https://elixir.bootlin.com/linux/v5.4.93/source/include/linux/fs.h#L1425 ç»“æ„ä½“å·²åˆ å‡ struct super_block { struct list_head s_list; // æŒ‡å‘é“¾è¡¨çš„æŒ‡é’ˆ dev_t s_dev; // è®¾å¤‡æ ‡è¯†ç¬¦ unsigned long s_blocksize; // ä»¥å­—èŠ‚ä¸ºå•ä½çš„å—å¤§å° loff_t s_maxbytes; // æ–‡ä»¶å¤§å°ä¸Šé™ struct file_system_type *s_type; // æ–‡ä»¶ç³»ç»Ÿç±»å‹ const struct super_operations *s_op; // SuperBlock æ“ä½œå‡½æ•°ï¼Œwrite_inodeã€put_inode ç­‰ const struct dquot_operations *dq_op; // ç£ç›˜é™é¢å‡½æ•° struct dentry *s_root; // æ ¹ç›®å½• } SuperBlock æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„ç»“æ„ï¼Œé€šè¿‡ SuperBlock æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªå®ä½“æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ° Linux ä¸Šï¼Œæˆ–è€…å¯¹ INode è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œã€‚æ‰€ä»¥ä¸€èˆ¬æ–‡ä»¶ç³»ç»Ÿéƒ½ä¼šåœ¨ç£ç›˜ä¸Šå­˜å‚¨å¤šä»½ SuperBlockï¼Œé˜²æ­¢æ•°æ®æ„å¤–æŸåå¯¼è‡´æ•´ä¸ªåˆ†åŒºæ— æ³•è¯»å–ã€‚\nInode InodeåŒ…å«å¾ˆå¤šçš„æ–‡ä»¶å…ƒä¿¡æ¯ï¼Œä½†ä¸åŒ…å«æ–‡ä»¶åï¼Œä¾‹å¦‚ï¼šå­—èŠ‚æ•°ã€å±ä¸»UserIDã€å±ç»„GroupIDã€è¯»å†™æ‰§è¡Œæƒé™ã€æ—¶é—´æˆ³ç­‰ã€‚è€Œæ–‡ä»¶åå­˜æ”¾åœ¨ç›®å½•å½“ä¸­ï¼Œä½†Linuxç³»ç»Ÿå†…éƒ¨ä¸ä½¿ç”¨æ–‡ä»¶åï¼Œè€Œæ˜¯ä½¿ç”¨inodeå·ç è¯†åˆ«æ–‡ä»¶ã€‚å¯¹äºç³»ç»Ÿæ¥è¯´æ–‡ä»¶ååªæ˜¯inodeå·ç ä¾¿äºè¯†åˆ«çš„åˆ«ç§°ã€‚\nStat æŸ¥çœ‹Inode\n1 2 3 4 5 6 7 8 9 10 11 12 [root@localhost ~]# mkdir test [root@localhost ~]# echo \u0026#34;this is test file\u0026#34; \u0026gt; test.txt [root@localhost ~]# stat test.txt File: â€˜test.txtâ€™ Size: 18 Blocks: 8 IO Block: 4096 regular file Device: fd00h/64768d Inode: 33574994 Links: 1 Access: (0644/-rw-r--r--) Uid: ( 0/ root) Gid: ( 0/ root) Context: unconfined_u:object_r:admin_home_t:s0 Access: 2019-08-28 19:55:05.920240744 +0800 Modify: 2019-08-28 19:55:05.920240744 +0800 Change: 2019-08-28 19:55:05.920240744 +0800 Birth: - ä¸‰ä¸ªä¸»è¦çš„æ—¶é—´å±æ€§ï¼š\nctimeï¼šchange timeæ˜¯æœ€åä¸€æ¬¡æ”¹å˜æ–‡ä»¶æˆ–ç›®å½•ï¼ˆå±æ€§ï¼‰çš„æ—¶é—´ï¼Œä¾‹å¦‚æ‰§è¡Œchmodï¼Œchownç­‰å‘½ä»¤ã€‚ atimeï¼šaccess timeæ˜¯æœ€åä¸€æ¬¡è®¿é—®æ–‡ä»¶æˆ–ç›®å½•çš„æ—¶é—´ã€‚ mtimeï¼šmodify timeæ˜¯æœ€åä¸€æ¬¡ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•ï¼ˆå†…å®¹ï¼‰çš„æ—¶é—´ã€‚ file 1 2 3 4 [root@localhost ~]# file test test: directory [root@localhost ~]# file test.txt test.txt: ASCII text Inode Number è¡¨é¢ä¸Šï¼Œç”¨æˆ·é€šè¿‡æ–‡ä»¶åæ‰“å¼€æ–‡ä»¶ï¼Œå®é™…ä¸Šï¼Œç³»ç»Ÿå†…éƒ¨å°†è¿™ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸‰æ­¥ï¼š\nç³»ç»Ÿæ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶åå¯¹åº”çš„inodeå·ç ï¼› é€šè¿‡inodeå·ç ï¼Œè·å–inodeä¿¡æ¯ï¼› æ ¹æ®inodeä¿¡æ¯ï¼Œæ‰¾åˆ°æ–‡ä»¶æ•°æ®æ‰€åœ¨çš„blockï¼Œå¹¶è¯»å‡ºæ•°æ®ã€‚ å…¶å®ç³»ç»Ÿè¿˜è¦æ ¹æ®inodeä¿¡æ¯ï¼Œçœ‹ç”¨æˆ·æ˜¯å¦å…·æœ‰è®¿é—®çš„æƒé™ï¼Œæœ‰å°±æŒ‡å‘å¯¹åº”çš„æ•°æ®blockï¼Œæ²¡æœ‰å°±è¿”å›æƒé™æ‹’ç»ã€‚\nç›´æ¥æŸ¥çœ‹æ–‡ä»¶ièŠ‚ç‚¹å·ï¼Œä¹Ÿå¯ä»¥é€šè¿‡statæŸ¥çœ‹æ–‡ä»¶inodeä¿¡æ¯æŸ¥çœ‹ièŠ‚ç‚¹å·ã€‚\n1 2 [root@localhost ~]# ls -i 33574991 anaconda-ks.cfg 2086 test 33574994 test.txt Inode å¤§å° inodeä¹Ÿä¼šæ¶ˆè€—ç¡¬ç›˜ç©ºé—´ï¼Œæ‰€ä»¥æ ¼å¼åŒ–çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿè‡ªåŠ¨å°†ç¡¬ç›˜åˆ†æˆä¸¤ä¸ªåŒºåŸŸã€‚ä¸€ä¸ªæ˜¯æ•°æ®åŒºï¼Œå­˜æ”¾æ–‡ä»¶æ•°æ®ï¼›å¦ä¸€ä¸ªæ˜¯inodeåŒºï¼Œå­˜æ”¾inodeæ‰€åŒ…å«çš„ä¿¡æ¯ã€‚æ¯ä¸ªinodeçš„å¤§å°ï¼Œä¸€èˆ¬æ˜¯128å­—èŠ‚æˆ–256å­—èŠ‚ã€‚é€šå¸¸æƒ…å†µä¸‹ä¸éœ€è¦å…³æ³¨å•ä¸ªinodeçš„å¤§å°ï¼Œè€Œæ˜¯éœ€è¦é‡ç‚¹å…³æ³¨inodeæ€»æ•°ã€‚inodeæ€»æ•°åœ¨æ ¼å¼åŒ–çš„æ—¶å€™å°±ç¡®å®šäº†ã€‚\ndf -i æŸ¥çœ‹ç¡¬ç›˜åˆ†åŒºçš„inodeæ€»æ•°å’Œå·²ä½¿ç”¨æƒ…å†µ\n1 2 3 4 5 6 7 8 9 10 11 [root@***]# df -i Filesystem Inodes IUsed IFree IUse% Mounted on devtmpfs 16219999 413 16219586 1% /dev tmpfs 16222589 2 16222587 1% /dev/shm tmpfs 16222589 602 16221987 1% /run tmpfs 16222589 16 16222573 1% /sys/fs/cgroup /dev/vda1 2621440 122606 2498834 5% / /dev/vdb1 131072000 134633 130937367 1% /mnt tmpfs 16222589 22 16222567 1% /run/user/0 overlay 2621440 122606 2498834 5% /var/lib/docker/overlay2/2e836ead8a69c7413ec89faecf1357479a6df9ba1e515056d9c89bb121e6fba1/merged shm 16222589 1 16222588 1% /var/lib/docker/containers/1713b72ff979243ef1d36d0a5aaf6c79989a75b267531d341665a7e432fd5a09/shm æ–‡ä»¶çš„è¯»å†™ æ–‡ä»¶ç³»ç»Ÿåœ¨æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œè¦åšçš„æœ‰ï¼š\nç³»ç»Ÿæ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶åå¯¹åº”çš„inodeï¼šåœ¨ç›®å½•è¡¨ä¸­æŸ¥æ‰¾è¯¥æ–‡ä»¶åå¯¹åº”çš„é¡¹ï¼Œç”±æ­¤å¾—åˆ°è¯¥æ–‡ä»¶ç›¸å¯¹åº”çš„ inode å· é€šè¿‡inodeå·ï¼Œè·å–åˆ°ç£ç›˜ä¸­çš„inodeä¿¡æ¯ï¼Œå…¶ä¸­æœ€é‡è¦çš„å†…å®¹æ˜¯ç£ç›˜åœ°å€è¡¨ é€šè¿‡inodeä¿¡æ¯ä¸­çš„ç£ç›˜åœ°å€è¡¨ï¼Œæ–‡ä»¶ç³»ç»ŸæŠŠåˆ†æ•£å­˜æ”¾çš„æ–‡ä»¶ç‰©ç†å—é“¾æ¥æˆæ–‡ä»¶çš„é€»è¾‘ç»“æ„ã€‚åœ¨ç£ç›˜åœ°å€è¡¨ä¸­æœ‰ 13 ä¸ªå—å·ï¼Œæ–‡ä»¶å°†ä»¥å—å·åœ¨ç£ç›˜åœ°å€è¡¨ä¸­å‡ºç°çš„é¡ºåºä¾æ¬¡è¯»å–ç›¸åº”çš„å—ã€‚æ‰¾åˆ°æ–‡ä»¶æ•°æ®æ‰€åœ¨çš„blockï¼Œè¯»å‡ºæ•°æ®ã€‚ æ ¹æ®ä»¥ä¸Šæµç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œinodeåº”è¯¥æ˜¯æœ‰ä¸€ä¸ªä¸“é—¨çš„å­˜å‚¨åŒºåŸŸçš„ï¼Œä»¥æ–¹ä¾¿ç³»ç»Ÿå¿«é€ŸæŸ¥æ‰¾ã€‚äº‹å®ä¸Šï¼Œä¸€å—ç£ç›˜åˆ›å»ºçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿè‡ªåŠ¨å°†ç¡¬ç›˜åˆ†æˆä¸¤ä¸ªåŒºåŸŸï¼šå­˜æ”¾æ–‡ä»¶æ•°æ®çš„æ•°æ®åŒºï¼Œä¸å­˜æ”¾inodeä¿¡æ¯çš„inodeåŒºï¼ˆinode tableï¼‰ã€‚\næ¯ä¸ªinodeçš„å¤§å°ä¸€èˆ¬æ˜¯128Bæˆ–è€…256Bã€‚inodeèŠ‚ç‚¹çš„æ€»æ•°ï¼Œåœ¨æ ¼å¼åŒ–æ—¶å°±ç»™å®šï¼Œä¸€èˆ¬æ˜¯æ¯1KBæˆ–æ¯2KBå°±è®¾ç½®ä¸€ä¸ªinodeã€‚å‡å®šåœ¨ä¸€å—1GBçš„ç¡¬ç›˜ä¸­ï¼Œæ¯ä¸ªinodeèŠ‚ç‚¹çš„å¤§å°ä¸º128å­—èŠ‚ï¼Œæ¯1KBå°±è®¾ç½®ä¸€ä¸ªinodeï¼Œé‚£ä¹ˆinode tableçš„å¤§å°å°±ä¼šè¾¾åˆ°128MBï¼Œå æ•´å—ç¡¬ç›˜çš„12.8%ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªåˆ†åŒºçš„inodeæ€»æ•°ä»æ ¼å¼åŒ–ä¹‹åå°±å›ºå®šäº†ï¼Œå› æ­¤æœ‰å¯èƒ½ä¼šå‡ºç°å­˜å‚¨ç©ºé—´æ²¡æœ‰å æ»¡ï¼Œä½†å› ä¸ºå°æ–‡ä»¶å¤ªå¤šè€Œè€—å°½äº†inodeçš„æƒ…å†µã€‚è¿™ä¸ªæ—¶å€™å°±åªèƒ½æ¸…é™¤inodeå ç”¨é«˜çš„æ–‡ä»¶æˆ–è€…ç›®å½•æˆ–ä¿®æ”¹inodeæ•°é‡äº†ï¼Œå½“ç„¶ï¼Œinodeçš„è°ƒæ•´éœ€è¦é‡æ–°æ ¼å¼åŒ–ç£ç›˜ï¼Œéœ€è¦ç¡®ä¿æ•°æ®å·²ç»å¾—åˆ°æœ‰æ•ˆå¤‡ä»½åï¼Œå†è¿›è¡Œæ­¤æ“ä½œã€‚\nè¿™æ—¶å€™åˆäº§ç”Ÿäº†æ–°çš„é—®é¢˜ï¼šæ–‡ä»¶åˆ›å»ºæ—¶è¦ä¸ºæ–‡ä»¶åˆ†é…å“ªä¸€ä¸ªinodeå·å‘¢ï¼Ÿå³å¦‚ä½•ä¿è¯åˆ†é…çš„inodeå·æ²¡æœ‰è¢«å ç”¨ï¼Ÿ æ—¢ç„¶æ˜¯â€æ˜¯å¦è¢«å ç”¨â€çš„é—®é¢˜ï¼Œä½¿ç”¨ä½å›¾æ˜¯æœ€ä½³æ–¹æ¡ˆï¼Œåƒbmapè®°å½•blockçš„å ç”¨æƒ…å†µä¸€æ ·ã€‚æ ‡è¯†inodeå·æ˜¯å¦è¢«åˆ†é…çš„ä½å›¾ç§°ä¸ºinodemapç®€ç§°ä¸ºimapã€‚è¿™æ—¶è¦ä¸ºä¸€ä¸ªæ–‡ä»¶åˆ†é…inodeå·åªéœ€æ‰«æimapå³å¯çŸ¥é“å“ªä¸€ä¸ªinodeå·æ˜¯ç©ºé—²çš„ã€‚\n(ä½å›¾æ³•å°±æ˜¯bitmapçš„ç¼©å†™ã€‚æ‰€è°“bitmapï¼Œå°±æ˜¯ç”¨æ¯ä¸€ä½æ¥å­˜æ”¾æŸç§çŠ¶æ€ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡æ•°æ®ï¼Œä½†æ•°æ®çŠ¶æ€åˆä¸æ˜¯å¾ˆå¤šçš„æƒ…å†µã€‚) ç±»ä¼¼bmapå—ä½å›¾ä¸€æ ·ï¼Œinodeå·æ˜¯é¢„å…ˆè§„åˆ’å¥½çš„ã€‚inodeå·åˆ†é…åï¼Œæ–‡ä»¶åˆ é™¤ä¹Ÿä¼šé‡Šæ”¾inodeå·ã€‚åˆ†é…å’Œé‡Šæ”¾çš„inodeå·ï¼Œåƒæ˜¯åœ¨ä¸€ä¸ªåœ°å›¾ä¸ŠæŒ–æ‰ä¸€å—ï¼Œç”¨å®Œå†è¡¥å›æ¥ä¸€æ ·ã€‚ imapå­˜åœ¨ç€å’Œbmapå’Œinode tableä¸€æ ·éœ€è¦è§£å†³çš„é—®é¢˜ï¼šå¦‚æœæ–‡ä»¶ç³»ç»Ÿæ¯”è¾ƒå¤§ï¼Œimapæœ¬èº«å°±ä¼šå¾ˆå¤§ï¼Œæ¯æ¬¡å­˜å‚¨æ–‡ä»¶éƒ½è¦è¿›è¡Œæ‰«æï¼Œä¼šå¯¼è‡´æ•ˆç‡ä¸å¤Ÿé«˜ã€‚åŒæ ·ï¼Œä¼˜åŒ–çš„æ–¹å¼æ˜¯å°†æ–‡ä»¶ç³»ç»Ÿå ç”¨çš„blockåˆ’åˆ†æˆå—ç»„ï¼Œæ¯ä¸ªå—ç»„æœ‰è‡ªå·±çš„imapèŒƒå›´ï¼Œä»¥å‡å°‘æ£€ç´¢æ—¶é—´ã€‚\nBlock Group Ext4æ–‡ä»¶ç³»ç»Ÿå°†ç£ç›˜ç©ºé—´åˆ’åˆ†ä¸ºè‹¥å¹²ç»„ï¼Œä»¥è¿™ä¸€ç»„ä¸ºå•ä½ç®¡ç†ç£ç›˜ç©ºé—´ï¼Œè¿™ä¸ªç»„å«åšå—ç»„ï¼ˆBlock Groupï¼‰ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè¦åˆ’åˆ†ä¸ºå—ç»„å‘¢ï¼Ÿå…¶ä¸»è¦åŸå› æ˜¯æ–¹ä¾¿å¯¹ç£ç›˜çš„ç®¡ç†ï¼Œç”±äºç£ç›˜è¢«åˆ’åˆ†ä¸ºè‹¥å¹²ç»„ï¼Œå› æ­¤ä¸Šå±‚è®¿é—®æ•°æ®æ—¶ç¢°æ’çš„æ¦‚ç‡å°±ä¼šå¤§å¤§å‡å°ï¼Œä»è€Œæå‡æ–‡ä»¶ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚ç®€å•æ¥è¯´ï¼Œå—ç»„å°±æ˜¯ä¸€å—ç£ç›˜åŒºåŸŸï¼Œè€ŒåŒæ—¶å…¶å†…éƒ¨æœ‰å…ƒæ•°æ®æ¥ç®¡ç†è¿™éƒ¨åˆ†åŒºåŸŸçš„ç£ç›˜ã€‚\næ–‡ä»¶ç³»ç»Ÿä½¿ç”¨block groupæ¥ç»„ç»‡blockçš„åŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š\næŠŠæ¯ä¸ªåŒºè¿›ä¸€æ­¥åˆ†ä¸ºå¤šä¸ªå—ç»„ (block group)ï¼Œæ¯ä¸ªå—ç»„æœ‰ç‹¬ç«‹çš„inode/blockä½“ç³» å¦‚æœæ–‡ä»¶ç³»ç»Ÿé«˜è¾¾æ•°ç™¾ GB æ—¶ï¼ŒæŠŠæ‰€æœ‰çš„ inode å’Œblock é€šé€šæ”¾åœ¨ä¸€èµ·ä¼šå› ä¸º inode å’Œ blockçš„æ•°é‡å¤ªåºå¤§ï¼Œä¸å®¹æ˜“ç®¡ç† è¿™å…¶å®å¾ˆå¥½ç†è§£ï¼Œå› ä¸ºåˆ†åŒºæ˜¯ç”¨æˆ·çš„åˆ†åŒºï¼Œå®é™…è®¡ç®—æœºç®¡ç†æ—¶è¿˜æœ‰ä¸ªæœ€é€‚åˆçš„å¤§å°ï¼Œäºæ˜¯è®¡ç®—æœºä¼šè¿›ä¸€æ­¥çš„åœ¨åˆ†åŒºä¸­åˆ†å— ï¼ˆä½†è¿™æ ·å²‚ä¸æ˜¯å¯èƒ½å‡ºç°å¤§æ–‡ä»¶æ”¾ä¸äº†çš„é—®é¢˜ï¼Ÿæœ‰ä»€ä¹ˆæœºåˆ¶å–„åå—ï¼Ÿï¼‰ æ¯ä¸ªå—ç»„å®é™…è¿˜ä¼šåˆ†ä¸ºåˆ†ä¸º6ä¸ªéƒ¨åˆ†ï¼Œé™¤äº†inode table å’Œ data blockå¤–è¿˜æœ‰4ä¸ªé™„å±æ¨¡å—ï¼Œèµ·åˆ°ä¼˜åŒ–å’Œå®Œå–„ç³»ç»Ÿæ€§èƒ½çš„ä½œç”¨ åˆ©ç”¨df -iå‘½ä»¤å¯ä»¥æŸ¥çœ‹inodeæ•°é‡æ–¹é¢çš„ä¿¡æ¯\nEXT4 disk layout EXT4 æ˜¯ç”±å¤šä¸ªå—ç»„ï¼ˆblock groupï¼‰ç»„æˆçš„ï¼Œæ¯ä¸ªå—ç»„çš„layoutå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šEXT4 æ˜¯ç”±å¤šä¸ªå—ç»„ï¼ˆblock groupï¼‰ç»„æˆçš„ï¼Œæ¯ä¸ªå—ç»„çš„layoutå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š EXT4ä¸Šæ‰¿EXT3å’ŒEXT2ï¼Œå°†å¤§é‡çš„å­˜å‚¨ç©ºé—´åˆ†æˆå—ç»„ï¼ˆBlock Groupï¼‰ï¼Œä»ä¸Šå›¾çœ‹å‡ºï¼Œä¸€ä¸ªå—ç»„ç”¨1ä¸ªblockæ¥å­˜æ”¾inodeçš„ä½å›¾å’Œblockçš„ä½å›¾ï¼Œè¿™å°±å†³å®šäº†å—ç»„çš„æœ€å¤§å¤§å°ã€‚ä»¥é»˜è®¤çš„4Kä¸ºä¾‹ï¼Œ4KBï¼32K bitï¼Œå› æ­¤ï¼Œæœ€å¤šä¹Ÿå°±èƒ½è®°å½•32Kä¸ªå—çš„åˆ†é…æƒ…å†µã€‚å› æ­¤ä¸€ä¸ªå—ç»„æ˜¯32Kï¼Š4KBï¼128MBã€‚\nä¸€èˆ¬è€Œè¨€ï¼Œä¸€ä¸ªblockçš„sizeæ€»æ˜¯4KBï¼Œå¾ˆå°‘éœ€è¦è°ƒæ•´ï¼Œä½†æ˜¯å¦‚æœç¼ºå¤±éœ€è¦è°ƒæ•´blockçš„å¤§å°ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡mkfsçš„ -bé€‰é¡¹æ¥æŒ‡å®šblockçš„å¤§å°ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„åˆ°ï¼Œä¸€æ—¦block-izeå‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆå—ç»„çš„å¤§å°ä¹Ÿå°±å‘ç”Ÿäº†å˜åŒ–ã€‚è¿™ä¸ªå½±å“æ˜¯ä¸¤æ–¹é¢çš„ï¼Œä¸ä»…ä»…æ˜¯å—å¤§å°å˜åŒ–äº†ï¼Œè€Œä¸”å› ä¸ºä¸€ä¸ªå—çš„bitå‘ç”Ÿäº†å˜åŒ–ï¼Œç”±äºä½å›¾ï¼Œç›´æ¥å½±å“äº†å—ç»„å®¹çº³çš„å—çš„ä¸ªæ•°ã€‚åé¢æˆ‘ä»¬éƒ½ä»¥4096å­—èŠ‚ä½œä¸ºblock-size\nå¯¹äºEXT4æ–‡ä»¶ç³»ç»Ÿè€Œè¨€ï¼Œä¸Šå›¾ä¸­çš„è¶…çº§å¿«å¹¶éæ¯ä¸€ä¸ªå—ç»„éƒ½è¦å­˜åœ¨ï¼Œä½†ä¹Ÿä¸æ˜¯åªæœ‰ä¸€ä¸ªsuper blockå—ã€‚å¦‚æœåªæœ‰ä¸€ä¸ªsuperblock å—ç»„ï¼Œé‚£ä¹ˆä¸€æ—¦æŸåï¼Œæ–‡ä»¶ç³»ç»Ÿä¹Ÿå°±ä¸èƒ½ç”¨äº†ï¼Œå¦‚æœæ¯ä¸ªå—ç»„éƒ½è¦åˆ†é…ä¸€ä¸ªblockï¼Œç©ºé—´ä¸Šæœ‰ç‚¹æµªè´¹ã€‚å› æ­¤mkfsçš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªé»˜è®¤çš„é€‰é¡¹sparse_superã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 âœ nebula-tool cat /etc/mke2fs.conf [defaults] base_features = sparse_super,filetype,resize_inode,dir_index,ext_attr default_mntopts = acl,user_xattr enable_periodic_fsck = 0 blocksize = 4096 inode_size = 256 inode_ratio = 16384 [fs_types] ext3 = { features = has_journal } ext4 = { features = has_journal,extent,huge_file,flex_bg,uninit_bg,dir_nlink,extra_isize,64bit inode_size = 256 } ext4dev = { features = has_journal,extent,huge_file,flex_bg,uninit_bg,dir_nlink,extra_isize inode_size = 256 options = test_fs=1 } small = { blocksize = 1024 inode_size = 128 inode_ratio = 4096 } floppy = { blocksize = 1024 inode_size = 128 inode_ratio = 8192 } big = { inode_ratio = 32768 } huge = { inode_ratio = 65536 } news = { inode_ratio = 4096 } largefile = { inode_ratio = 1048576 blocksize = -1 } largefile4 = { inode_ratio = 4194304 blocksize = -1 } hurd = { blocksize = 4096 inode_size = 128 } è¯¥é€‰é¡¹çš„å«ä¹‰æ˜¯ï¼Œå°†superblock ç¨€ç–åœ°åˆ†æ•£åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼šæ—¢ä¸æ˜¯æ¯ä¸ªå—ç»„éƒ½æœ‰superblockï¼Œä¹Ÿä¸æ˜¯ä¸€å…±åªæœ‰ä¸€ä¸ªsuperblockã€‚é‚£ä¹ˆå“ªäº›å—ç»„ä¼šæœ‰superblockå‘¢ï¼Ÿå¦‚æœåœ¨ç”¨äº†sparse_superé€‰é¡¹ï¼ˆé»˜è®¤é€‰é¡¹ï¼‰ï¼Œè¶…çº§å¿«ä½äºæ»¡è¶³ä¸€ä¸‹æ¡ä»¶çš„å—ç»„ä¸Š\nå—ç»„0 å—ç»„idä¸º3 æˆ–5 æˆ–7çš„å¹‚(æ³¨æ„ï¼Œå—ç»„ï¼ƒ1æ˜¯3çš„0æ¬¡å¹‚ï¼Œå› æ­¤ä¹Ÿæœ‰backup superblock)ã€‚ ä»ä¸‹é¢è¾“å‡ºä¸­ä¸éš¾çœ‹å‡º:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 ï¼ƒ1 32768 = (32876) *3^0 ï¼ƒ3 98304 = (32768) *3^1 ï¼ƒ5 163840 = (32768) *5^1 ï¼ƒ7 229376 = (32768) *7^1 ï¼ƒ9 294912 = (32768) *3^2 #25 ... root@node-1:~# dumpe2fs /dev/sdb2|grep super dumpe2fs 1.42 (29-Nov-2011) Filesystem features: has_journal ext_attr resize_inode dir_index filetype needs_recovery extent flex_bg sparse_super large_file huge_file uninit_bg dir_nlink extra_isize Primary superblock at 0, Group descriptors at 1-464 Backup superblock at 32768, Group descriptors at 32769-33232 Backup superblock at 98304, Group descriptors at 98305-98768 Backup superblock at 163840, Group descriptors at 163841-164304 Backup superblock at 229376, Group descriptors at 229377-229840 Backup superblock at 294912, Group descriptors at 294913-295376 Backup superblock at 819200, Group descriptors at 819201-819664 Backup superblock at 884736, Group descriptors at 884737-885200 Backup superblock at 1605632, Group descriptors at 1605633-1606096 Backup superblock at 2654208, Group descriptors at 2654209-2654672 Backup superblock at 4096000, Group descriptors at 4096001-4096464 Backup superblock at 7962624, Group descriptors at 7962625-7963088 Backup superblock at 11239424, Group descriptors at 11239425-11239888 Backup superblock at 20480000, Group descriptors at 20480001-20480464 Backup superblock at 23887872, Group descriptors at 23887873-23888336 Backup superblock at 71663616, Group descriptors at 71663617-71664080 Backup superblock at 78675968, Group descriptors at 78675969-78676432 Backup superblock at 102400000, Group descriptors at 102400001-102400464 Backup superblock at 214990848, Group descriptors at 214990849-214991312 é™¤äº†sparse_superé€‰é¡¹ï¼ŒEXT4æ”¯æŒä¸€ç§æ–°çš„é€‰é¡¹ sparse_super2æ¥å¤‡ä»½super blockï¼Œè¿™ä¸ªcommentçš„å¤§æ„æ˜¯ï¼Œçºµç„¶Primary superblockæŸåäº†ï¼Œé‚£ä¹ˆä½äºblock group ï¼ƒ1å¤„çš„super block ä¹Ÿè¶³ä»¥æ¢å¤ï¼Œå¾ˆå°‘æœ‰æƒ…å†µéœ€è¦ç”¨åˆ°ä½äºå…¶å®ƒä½ç½®çš„å¤‡ç”¨super blockã€‚å› æ­¤ï¼Œåªæä¾›äº†2ä¸ªè¶…çº§å¿«çš„å¤‡ç”¨super blockï¼Œåˆ†åˆ«ä½äºblock group ï¼ƒ1å’Œæœ€åä¸€ä¸ªblock groupã€‚å¼•å…¥è¿™ç§æ–¹æ¡ˆï¼Œå¥½å¤„ä¸ä»…ä»…æ˜¯èŠ‚çœäº†ç£ç›˜ç©ºé—´ï¼Œæ›´é‡è¦çš„æ˜¯ä½¿å…ƒæ•°æ®åˆ†å¸ƒçš„æ›´çµæ´»ï¼Œæ¯”å¦‚æ”¯æŒåé¢æåˆ°çš„packed_meta_blocksæ‰©å±•é€‰é¡¹ï¼Œå°†æ‰€æœ‰å…ƒæ•°æ®å›ºå®šåœ¨å­˜å‚¨ç©ºé—´çš„å¼€å§‹ä½ç½®ã€‚\ninode table å¦å¤–ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„è¯é¢˜æ˜¯inode tableçš„é•¿åº¦ã€‚å¯¹äºEXT4çš„é»˜è®¤æƒ…å†µï¼Œä¸€ä¸ªinodeçš„å¤§å°æ˜¯256å­—èŠ‚,inodeæ˜¯EXT4æœ€é‡è¦çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚\nå°½ç®¡inode bitmapæ˜¯32Kä¸ªbitï¼Œä½†æ˜¯å¹¶ä¸æ„å‘³ç€æ¯ä¸ªå—ç»„ä¸€å®šè¦åˆ†é…32Kä¸ªinodeï¼Œå› ä¸º128Mçš„ç©ºé—´é‡Œï¼Œå­˜æ”¾32Kä¸ªinodeå¤ªæµªè´¹äº†ï¼Œåªæœ‰å‡ ä¹æ‰€æœ‰çš„æ–‡ä»¶çš„å¤§å°éƒ½å°äº4Kçš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šéœ€è¦è¿™ä¹ˆå¤šçš„inodeã€‚å› æ­¤ï¼Œä¸€ä¸ªå—ç»„é¢„å…ˆåˆ†é…å¤šå°‘ä¸ªinodeï¼Œååº”çš„æ˜¯æ–‡ä»¶ç³»ç»Ÿå¯¹ç³»ç»Ÿå†…æ–‡ä»¶å¹³å‡å¤§å°çš„é¢„æœŸã€‚å¦‚æœæ–‡ä»¶ç³»ç»Ÿå†…å­˜æ”¾çš„æ–‡ä»¶å‡ ä¹å…¨æ˜¯1Gä»¥ä¸Šçš„å¤§æ–‡ä»¶ï¼Œé‚£ä¹ˆåˆ†é…å¤ªå¤šçš„inodeï¼Œä¼šæµªè´¹å®è´µçš„å­˜å‚¨ç©ºé—´ã€‚\n1 2 3 4 5 âœ nebula-tool tune2fs -l /dev/vda1 | grep Inode Inode count: 128016 Inodes per group: 2032 Inode blocks per group: 254 Inode size: 128 ä»ä¸Šé¢çš„å†…å®¹ä¸éš¾çœ‹å‡ºï¼Œæ¯ä¸ªInodeçš„å¤§å°ä¸º256å­—èŠ‚ï¼Œä¸€ä¸ªå—ç»„æœ‰4096ä¸ªinodeï¼Œæ‰€æœ‰çš„inodeæ¶ˆè€—äº†256ä¸ªblockã€‚è¿™ä¸ªæƒ…å†µè¡¨æ˜ï¼Œè¯¥æ–‡ä»¶ç³»ç»Ÿä¸€ä¸ªå—ç»„128Mçš„ç©ºé—´ï¼Œé¢„æœŸæ–‡ä»¶ä¸ªæ•°ä¸ä¼šè¶…è¿‡4096ä¸ªï¼Œå³åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿçš„äººè®¤ä¸ºï¼Œæ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶çš„å¹³å‡å¤§å°ä¸ä½äº32Kã€‚å¦‚æœè¯¥æ–‡ä»¶ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ–‡ä»¶å‡æ˜¯1Kæˆ–è€…å‡ KBçš„å°æ–‡ä»¶ï¼Œå°±ä¼šå‡ºç°ï¼Œç£ç›˜ç©ºé—´è¿˜æœ‰å¤§é‡çš„å‰©ä½™ï¼Œä½†æ˜¯inodeå·²ç»åˆ†é…å…‰çš„æƒ…å†µã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå†æ¬¡åˆ›å»ºæ–‡ä»¶å°±ä¼šæœ‰No Spaceä¹‹ç±»çš„æŠ¥é”™ã€‚æœ¬å‘¨ï¼Œæˆ‘æ¥çœ‹åˆ°ä¸€ä¸ªè¿™ç§é”™è¯¯ï¼ŒåŒäº‹é—®æˆ‘df -hæ˜æ˜æœ‰å¤§é‡çš„ç©ºé—´ï¼Œä¸ºä½•æŠ¥è¿™ç§é”™è¯¯ã€‚å¦‚ä½•å‘ç°æ–‡ä»¶ç³»ç»ŸInodeçš„ä½¿ç”¨æƒ…å†µå‘¢ï¼š\n1 2 3 4 5 6 7 8 9 âœ nebula-tool df -ih Filesystem Inodes IUsed IFree IUse% Mounted on /dev/vda2 10M 641K 9.3M 7% / devtmpfs 2.0M 368 2.0M 1% /dev tmpfs 2.0M 1 2.0M 1% /dev/shm tmpfs 2.0M 549 2.0M 1% /run tmpfs 2.0M 16 2.0M 1% /sys/fs/cgroup /dev/vda1 126K 335 125K 1% /boot tmpfs 2.0M 61 2.0M 1% /run/user/0 EXT4æ–‡ä»¶ç³»ç»Ÿmkfsæä¾›äº†ä¸€ä¸ª -içš„é€‰é¡¹ï¼Œç”¨æ¥è°ƒèŠ‚æ¯ä¸ªå—ç»„inodeçš„ä¸ªæ•°ã€‚è¯¥å‚æ•°çš„å«ä¹‰æ˜¯ bytes-per-inodeï¼Œå³æ ¼å¼åŒ–çš„æ—¶å€™ï¼Œæé†’ä¸‹ç³»ç»Ÿï¼Œä½ è®¤ä¸ºä½ è¯¥æ–‡ä»¶ç³»ç»Ÿæ¯ä¸ªæ–‡ä»¶çš„å¹³å‡å¤§å°ã€‚ä½¿ç”¨è¯¥å€¼çš„æ—¶å€™ï¼Œæ³¨æ„è¯¥å€¼ä¸è¦æ¯”blockï¼sizeå°ï¼Œå¦‚æœæ¯”block-sizeè¿˜è¦å°ï¼Œæ„å‘³ç€å¾ˆå¤šinodeæ ¹æœ¬æ²¡æœ‰æœºä¼šåˆ†é…å‡ºå»ï¼Œçº¯å±æµªè´¹ã€‚\nflex_bg ä¸Šé¢è®²è¿°çš„æ˜¯ç»å…¸çš„EXT4å¸ƒå±€ã€‚ä»EXT4å¼€å§‹ï¼Œå†…æ ¸å¼•å…¥äº†flexible block groupsçš„æ¦‚å¿µã€‚è¿™ä¸ªå¼¹æ€§å—ç»„ç¾¤æ˜¯ä¸ªä»€ä¹ˆæ¦‚å¿µå‘¢ã€‚å°±æ˜¯æ‰“ç ´128MBä¸€ä¸ªå—ç»„ï¼Œå—ç»„ä¹‹é—´æ³¾æ¸­åˆ†æ˜çš„ç•Œé™ï¼Œè®©å¤šä¸ªå—ç»„å½¢æˆä¸€ä¸ªæˆ˜æ–—å°ç»„ã€‚\nç”¨æ›´ç¡®åˆ‡çš„è¯è¯´å°±æ˜¯å¤šä¸ªå—ç»„ï¼Œå°†block bitmapèšåˆåœ¨ä¸€èµ·ï¼Œinode bitmapèšåˆåœ¨ä¸€èµ·ï¼ŒåŒæ—¶inode table ä¹Ÿèšåˆåœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªé€»è¾‘å—ç»„ã€‚è¿™äº›ä¿¡æ¯è¿ç»­çš„å¥½å¤„æ˜¯ï¼Œå¦‚æœå®¢æˆ·è¿ç»­è¯»ï¼Œå°±å‡å°‘å› ä¸ºinodeæˆ–bitmapä¸è¿ç»­è€Œä¸å¾—ä¸å¯»é“å¸¦æ¥çš„é¢å¤–effortã€‚\nè¯¥æ ¼å¼åŒ–é€‰é¡¹ï¼Œé»˜è®¤æ˜¯å¼€ç€çš„ï¼Œæ‰§è¡Œdubugfs -R stats /dev/loop0å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„å‚æ•°ï¼š\n1 2 3 Inodes per group: 8192 Inode blocks per group: 512 Flex block group size: 16 ä¹Ÿå°±è¯´16ä¸ªå—ç»„ç»„æˆäº†ä¸€ä¸ªæˆ˜æ–—å°ç»„é€»è¾‘å—ç»„ï¼Œè¿™16ä¸ªå—ç»„çš„inodeä½å›¾ï¼Œblockä½å›¾ï¼Œä»¥åŠinode tableæ˜¯è¿ç»­çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 roup 0: block bitmap at 1025, inode bitmap at 1041, inode table at 1057 23513 free blocks, 8181 free inodes, 2 used directories, 8181 unused inodes [Checksum 0x8fd1] Group 1: block bitmap at 1026, inode bitmap at 1042, inode table at 1569 31743 free blocks, 8192 free inodes, 0 used directories, 8192 unused inodes [Inode not init, Checksum 0xff08] Group 2: block bitmap at 1027, inode bitmap at 1043, inode table at 2081 32768 free blocks, 8192 free inodes, 0 used directories, 8192 unused inodes [Inode not init, Block not init, Checksum 0xebd4] Group 3: block bitmap at 1028, inode bitmap at 1044, inode table at 2593 31743 free blocks, 8192 free inodes, 0 used directories, 8192 unused inodes [Inode not init, Checksum 0x89d6] Group 4: block bitmap at 1029, inode bitmap at 1045, inode table at 3105 32768 free blocks, 8192 free inodes, 0 used directories, 8192 unused inodes [Inode not init, Block not init, Checksum 0xa182] Group 5: block bitmap at 1030, inode bitmap at 1046, inode table at 3617 31743 free blocks, 8192 free inodes, 0 used directories, 8192 unused inodes [Inode not init, Checksum 0xfc62] Group 6: block bitmap at 1031, inode bitmap at 1047, inode table at 4129 32768 free blocks, 8192 free inodes, 0 used directories, 8192 unused inodes [Inode not init, Block not init, Checksum 0x79ac] Group 7: block bitmap at 1032, inode bitmap at 1048, inode table at 4641 31743 free blocks, 8192 free inodes, 0 used directories, 8192 unused inodes [Inode not init, Checksum 0x646a] Group 8: block bitmap at 1033, inode bitmap at 1049, inode table at 5153 32768 free blocks, 8192 free inodes, 0 used directories, 8192 unused inodes [Inode not init, Block not init, Checksum 0xa43c] Group 9: block bitmap at 1034, inode bitmap at 1050, inode table at 5665 31743 free blocks, 8192 free inodes, 0 used directories, 8192 unused inodes [Inode not init, Checksum 0xf9dc] Group 10: block bitmap at 1035, inode bitmap at 1051, inode table at 6177 32768 free blocks, 8192 free inodes, 0 used directories, 8192 unused inodes [Inode not init, Block not init, Checksum 0xed00] Group 11: block bitmap at 1036, inode bitmap at 1052, inode table at 6689 32768 free blocks, 8192 free inodes, 0 used directories, 8192 unused inodes [Inode not init, Block not init, Checksum 0x6dc8] Group 12: block bitmap at 1037, inode bitmap at 1053, inode table at 7201 32768 free blocks, 8192 free inodes, 0 used directories, 8192 unused inodes [Inode not init, Block not init, Checksum 0xa756] Group 13: block bitmap at 1038, inode bitmap at 1054, inode table at 7713 32768 free blocks, 8192 free inodes, 0 used directories, 8192 unused inodes [Inode not init, Block not init, Checksum 0x187c] Group 14: block bitmap at 1039, inode bitmap at 1055, inode table at 8225 32768 free blocks, 8192 free inodes, 0 used directories, 8192 unused inodes [Inode not init, Block not init, Checksum 0x1d5f] Group 15: block bitmap at 1040, inode bitmap at 1056, inode table at 8737 32768 free blocks, 8192 free inodes, 0 used directories, 8192 unused inodes 32768 blocks per group, 32768 fragments per group Group 16: block bitmap at 524288, inode bitmap at 524304, inode table at 524320 24544 free blocks, 8192 free inodes, 0 used directories, 8192 unused inodes [Inode not init, Checksum 0x2f61] Group 17: block bitmap at 524289, inode bitmap at 524305, inode table at 524832 32768 free blocks, 8192 free inodes, 0 used directories, 8192 unused inodes [Inode not init, Block not init, Checksum 0xb41c] Group 18: block bitmap at 524290, inode bitmap at 524306, inode table at 525344 32768 free blocks, 8192 free inodes, 0 used directories, 8192 unused inodes [Inode not init, Block not init, Checksum 0x1572] æˆ‘ä»¬ä¸éš¾çœ‹å‡º Group 0ï½Group 15ç»„æˆäº†æˆ˜æ–—å°ç»„ï¼Œè¿™ä¸ªæˆ˜æ–—å°ç»„metadataä¿¡æ¯æ˜¯è¿ç»­çš„ï¼Œåé¢çš„Group 16ï½Group 31ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¾æ¬¡ç±»æ¨ã€‚\n1025ï½1040 block bitmap 1041ï½1056 inode bitmap 1057ï½8737ï¼‹512 inode table EXT4æ–‡ä»¶ç³»ç»Ÿæœ‰ä¸€ä¸ªæ§åˆ¶é€‰é¡¹inode_readahead_blks,è¯¥å‚æ•°æ˜¯æŒ‡å®šäº†inode é¢„è¯»çš„å—æ•°ï¼Œå¦‚æœä¸å¯ç”¨flex_bg,çºµç„¶inode_readahead_blksè®¾ç½®çš„å¾ˆå¤§ï¼Œæ¯”å¦‚4096ï¼Œä½†æ˜¯å› ä¸ºå—ç»„ä¹‹é—´inodeä¸è¿ç»­ï¼ˆæ¯”å¦‚å•ä¸ªå—ç»„ inode tableåªå ç”¨äº†256ä¸ªå—ï¼‰ï¼Œè¿™ç§æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ root@node-1:/# cat /sys/fs/ext4/sdb2/inode_readahead_blks 32\nå¯¹äºè¿ç»­è¯»çš„åœºæ™¯ï¼Œflex_bgé…åˆè¾ƒå¤§çš„inode_readahead_blksï¼Œèƒ½æå‡è¿ç»­è¯»çš„æ€§èƒ½ã€‚ã€ŠLinuxå†…æ ¸ç²¾é«“ï¼šç²¾é€šLinuxå†…æ ¸å¿…ä¼šçš„75ä¸ªç»æŠ€ã€‹ä¸€ä¹¦ä¸­æåˆ°ï¼Œå½“inode_readahead_blks ç­‰äº1å’Œç­‰äº4096æ—¶å¯¹æ¯”ï¼Œè¯»å–å†…æ ¸æ‰€æœ‰æºç æ–‡ä»¶æœ‰6%å·¦å³çš„æå‡ã€‚\nExtent or indirect blocks åœ¨Ext4ä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯Ext2å’ŒExt3æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œéƒ½æ˜¯é€šè¿‡é—´æ¥å—çš„æ–¹å¼å­˜å‚¨å¤§æ–‡ä»¶çš„æ•°æ®çš„ã€‚å…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ–‡ä»¶æ•°æ®çš„ä½ç½®é€šè¿‡inodeä¸­i_blockæˆå‘˜ï¼ˆ15ä¸ª32ä¸ºæ•´æ•°æˆå‘˜çš„æ•°ç»„ï¼‰æŒ‡å‡ºï¼Œå…¶å‰é¢12ä¸ªæˆå‘˜ç›´æ¥æŒ‡å‘12ä¸ªæ•°æ®å—ï¼Œç¬¬13ä¸ªæˆå‘˜ï¼ˆblock12ï¼‰æŒ‡å‘çš„ç£ç›˜å—å­˜å‚¨çš„ä¸æ˜¯æ–‡ä»¶æ•°æ®ï¼Œè€Œæ˜¯ä¸€ä¸ªæŒ‡å‘æ•°æ®å—çš„æŒ‡é’ˆåˆ—è¡¨ï¼Œæˆ‘ä»¬ç§°ä¸ºä¸€çº§å—ï¼Œä¸€çº§é—´æ¥å—æœ€å¤šæœ‰block size / 4ä¸ªæŒ‡é’ˆï¼Œblock sizeå°±æ˜¯æ•°æ®å—çš„å¤§å°ï¼Œå› ä¸ºä¸€ä¸ªç´¢å¼•æ˜¯4ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥é™¤ä»¥4ã€‚ä»¥æ­¤ç±»æ¨ï¼Œblock13é€šè¿‡äºŒçº§é—´æ¥å—æŒ‡å‘å…·ä½“çš„æ•°æ®ï¼Œè€Œblock14åˆ™é€šè¿‡ä¸‰çº§é—´æ¥å—æŒ‡å‘å…·ä½“çš„æ•°æ®ã€‚é€šè¿‡è¿™ç§é—´æ¥æŒ‡å‘çš„æ–¹å¼å®ç°å¯¹å¤§æ–‡ä»¶çš„ç®¡ç†ã€‚\næ–‡ä»¶å¤§å°: æŒ‰ç…§ä¸Šè¿°æ–¹å¼è®¡ç®—ä¸‹æ¥ï¼Œæœ€å¤§çš„æ–‡ä»¶å¯ä»¥ä½¿ç”¨çš„æ€»å—æ•°ä¸º:12 + (block size/4) + (block size/4)^2 + (block size/4)^3ï¼Œå¦‚æœblock sizeå¤§å°ä¸º4Kï¼Œåˆ™ä¸º(12 + 2^10 + 2^20 + 2^30) * 2^12 çº¦ç­‰äº4Tã€‚ Ext4æ–‡ä»¶æ•°æ®ç®¡ç†æ–¹å¼ Ext4æ–‡ä»¶ç³»ç»Ÿæœ‰ä¸¤ç§æ•°æ®ç®¡ç†æ–¹å¼ï¼Œä¸€ç§æ˜¯inlineçš„æ–¹å¼ï¼Œå¯ä»¥å°†æ•°æ®å­˜å‚¨åœ¨inodeèŠ‚ç‚¹å†…éƒ¨ï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡extentçš„æ–¹å¼ï¼Œå°†æ–‡ä»¶æ•°æ®ç»„ç»‡æˆä¸ºä¸€ä¸ªBæ ‘ã€‚å½“ç„¶ï¼Œä¸ºäº†å…¼å®¹Ext3åŠä¹‹å‰çš„æ–‡ä»¶ç³»ç»Ÿï¼ŒExt4ä¹Ÿå®ç°äº†é—´æ¥å—çš„æ–¹å¼ã€‚\nExt4æ–‡ä»¶ç³»ç»Ÿæ–‡ä»¶æ•°æ®ç®¡ç†å‚è€ƒäº†ç°ä»£æ–‡ä»¶ç³»ç»Ÿçš„å®ç°æ–¹å¼ï¼Œä¹Ÿå³extentæ–¹å¼ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶æ•°æ®ç®¡ç†çš„å…¥å£ä»ç„¶æ˜¯inodeèŠ‚ç‚¹çš„i_blockæˆå‘˜ã€‚å·®å¼‚æ˜¯æ­¤æ—¶i_blockå¹¶éä¸€ä¸ª32ä½æ•´æ•°æ•°ç»„ï¼Œè€Œæ˜¯ä¸€ä¸ªæè¿°Bæ ‘ç»“æ„çš„æ•°æ®ç»“æ„ï¼ˆåŒ…å«ext4_extent_headerå’Œext4_extent_idxï¼‰ã€‚åœ¨è¯¥æ•°æ®ç»“æ„ä¸­ï¼Œåªæœ‰å¶å­èŠ‚ç‚¹ä¸­å­˜å‚¨çš„æ•°æ®åŒ…å«æ–‡ä»¶é€»è¾‘åœ°å€ä¸ç£ç›˜ç‰©ç†åœ°å€çš„æ˜ å°„å…³ç³»ã€‚åœ¨æ•°æ®ç®¡ç†ä¸­æœ‰3ä¸ªå…³é”®çš„æ•°æ®ç»“æ„ï¼Œåˆ†åˆ«æ˜¯ext4_extent_headerã€ext4_extent_idxå’Œext4_extentã€‚\next4_extent_header è¯¥æ•°æ®ç»“æ„åœ¨ä¸€ä¸ªç£ç›˜é€»è¾‘å—çš„æœ€å¼€å§‹çš„ä½ç½®ï¼Œæè¿°è¯¥ç£ç›˜é€»è¾‘å—çš„Bæ ‘å±æ€§ï¼Œä¹Ÿå³è¯¥é€»è¾‘å—ä¸­æ•°æ®çš„ç±»å‹ï¼ˆä¾‹å¦‚æ˜¯å¦ä¸ºå¶å­èŠ‚ç‚¹ï¼‰å’Œæ•°é‡ã€‚å¦‚æœeh_depthä¸º0ï¼Œåˆ™è¯¥é€»è¾‘å—ä¸­æ•°æ®é¡¹ä¸ºBæ ‘çš„å¶å­èŠ‚ç‚¹ï¼Œæ­¤æ—¶å…¶ä¸­å­˜å‚¨çš„æ˜¯ext4_extentæ•°æ®ç»“æ„å®ä¾‹ï¼Œå¦‚æœeh_depth\u0026gt;0ï¼Œåˆ™å…¶ä¸­å­˜å‚¨çš„æ˜¯éå¶å­èŠ‚ç‚¹ï¼Œä¹Ÿå³ext4_extent_idxï¼Œç”¨äºå­˜å‚¨æŒ‡å‘ä¸‹ä¸€çº§çš„ç´¢å¼•ã€‚\n1 2 3 4 5 6 7 struct ext4_extent_header { __le16 eh_magic; /* é­”æ•° */ __le16 eh_entries; /* å¯ç”¨çš„é¡¹ç›®çš„æ•°é‡ */ __le16 eh_max; /* æœ¬åŒºåŸŸå¯ä»¥å­˜å‚¨æœ€å¤§é¡¹ç›®æ•°é‡ */ __le16 eh_depth; /* å½“å‰å±‚æ ‘çš„æ·±åº¦ */ __le32 eh_generation; }; ext4_extent_idx è¯¥æ•°æ®ç»“æ„æ˜¯Bæ ‘ä¸­çš„ç´¢å¼•èŠ‚ç‚¹ï¼Œè¯¥æ•°æ®ç»“æ„ç”¨äºæŒ‡å‘ä¸‹ä¸€çº§ï¼Œä¸‹ä¸€çº§å¯ä»¥ä»ç„¶æ˜¯ç´¢å¼•èŠ‚ç‚¹ï¼Œæˆ–è€…å¶å­èŠ‚ç‚¹ã€‚\n1 2 3 4 5 6 struct ext4_extent_idx { __le32 ei_block; /* ç´¢å¼•è¦†ç›–çš„é€»è¾‘å—çš„æ•°é‡ï¼Œä»¥å—ä¸ºå•ä½ */ __le32 ei_leaf_lo; /* æŒ‡å‘ä¸‹ä¸€çº§ç‰©ç†å—çš„ä½ç½®ï¼Œ*/ __le16 ei_leaf_hi; /* ç‰©ç†å—ä½ç½®çš„é«˜16ä½ */ __u16 ei_unused; }; ext4_extent æè¿°äº†æ–‡ä»¶é€»è¾‘åœ°å€ä¸ç£ç›˜ç‰©ç†åœ°å€çš„å…³ç³»ã€‚é€šè¿‡è¯¥æ•°æ®ç»“æ„ï¼Œå¯ä»¥æ‰¾åˆ°æ–‡ä»¶æŸä¸ªåç§»çš„ä¸€æ®µæ•°æ®åœ¨ç£ç›˜çš„å…·ä½“ä½ç½®ã€‚\n1 2 3 4 5 6 struct ext4_extent { __le32 ee_block; /* è¯¥extentè¦†ç›–çš„ç¬¬ä¸€ä¸ªé€»è¾‘åœ°å€ï¼Œä»¥å—ä¸ºå•ä½ */ __le16 ee_len; /* è¯¥extentè¦†ç›–çš„é€»è¾‘å—çš„ä½ç½® */ __le16 ee_start_hi; /* ç‰©ç†å—çš„é«˜16ä½ */ __le32 ee_start_lo; /* ç‰©ç†å—çš„ä½16ä½ */ }; ä¸Šå›¾æ˜¯ä¸€ä¸ªç¤ºæ„å›¾ï¼Œè¡¨è¾¾äº†é€šè¿‡è‹¥å¹²çº§ç´¢å¼•æŒ‡å‘ç£ç›˜ç‰©ç†å—çš„å…³ç³»ã€‚å®é™…æƒ…å†µæ˜¯æœªå¿…æœ‰è¿™ä¹ˆå¤šçº§ï¼Œå¯èƒ½æ¯”è¿™ä¸ªå¤šï¼Œä¹Ÿå¯èƒ½æ¯”è¿™ä¸ªå°‘ã€‚å¦‚æœæ–‡ä»¶ç‰¹åˆ«å°ï¼Œå¯èƒ½æ²¡æœ‰ç´¢å¼•å±‚ï¼Œè€Œæ˜¯i_blockä¸­ç›´æ¥æ˜¯ext4_extent,ç›´æ¥æŒ‡å‘ç£ç›˜ç‰©ç†å—çš„ä½ç½®ã€‚\næ–‡ä»¶æ“ä½œ ç³»ç»Ÿå¯¹æ–‡ä»¶çš„æ“ä½œä¼šå¯èƒ½å½±å“inodeï¼š\nå¤åˆ¶ï¼šåˆ›å»ºä¸€ä¸ªåŒ…å«å…¨éƒ¨æ•°æ®ä¸æ–°inodeå·çš„æ–°æ–‡ä»¶ ç§»åŠ¨ï¼šåœ¨åŒä¸€ç£ç›˜ä¸‹ç§»åŠ¨æ—¶ï¼Œæ‰€åœ¨ç›®å½•æ”¹å˜ï¼Œinodeå·ä¸å®é™…æ•°æ®å­˜å‚¨çš„å—çš„ä½ç½®éƒ½ä¸ä¼šå˜åŒ–ã€‚è·¨ç£ç›˜ç§»åŠ¨å½“ç„¶ä¼šåˆ é™¤æœ¬ç£ç›˜çš„æ•°æ®å¹¶åˆ›å»ºä¸€æ¡æ–°çš„æ•°æ®åœ¨å¦ä¸€å—ç£ç›˜ä¸­ã€‚ ç¡¬é“¾æ¥ï¼š åŒä¸€ä¸ªinodeå·ä»£è¡¨çš„æ–‡ä»¶æœ‰å¤šä¸ªæ–‡ä»¶åï¼Œå³å¯ä»¥ç”¨ä¸åŒçš„æ–‡ä»¶åè®¿é—®åŒä¸€ä»½æ•°æ®ï¼Œä½†æ˜¯å®ƒä»¬æŒ‡å‘çš„inodeç¼–å·æ˜¯ç›¸åŒçš„ï¼Œå¹¶ä¸”æ–‡ä»¶å…ƒæ•°æ®ä¸­é“¾æ¥æ•°ä¼šå¢åŠ ã€‚ä¸å¯ä»¥å¯¹ç›®å½•åˆ›å»ºç¡¬é“¾æ¥ã€‚ è½¯é“¾æ¥ï¼š è½¯é“¾æ¥çš„æœ¬è´¨æ˜¯ä¸€ä¸ªé“¾æ¥æ–‡ä»¶ï¼Œå…¶ä¸­å­˜å‚¨çš„äº†å¯¹å¦ä¸€ä¸ªæ–‡ä»¶çš„æŒ‡é’ˆã€‚æ‰€ä»¥å¯¹ä¸€ä¸ªæ–‡ä»¶åˆ›å»ºè½¯é“¾æ¥ï¼Œinodeå·ä¸ç›¸åŒï¼Œåˆ›å»ºè½¯é“¾æ¥æ–‡ä»¶çš„é“¾æ¥æ•°ä¸ä¼šå¢åŠ ã€‚å¯ä»¥å¯¹ç›®å½•åˆ›å»ºè½¯é“¾æ¥ã€‚ åˆ é™¤ï¼šå½“åˆ é™¤æ–‡ä»¶æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥inodeä¸­çš„é“¾æ¥æ•°ã€‚å¦‚æœé“¾æ¥æ•°å¤§äº1ï¼Œå°±åªä¼šåˆ æ‰ä¸€ä¸ªç¡¬é“¾æ¥ï¼Œä¸å½±å“æ•°æ®ã€‚å¦‚æœé“¾æ¥æ•°ç­‰äº1ï¼Œé‚£ä¹ˆè¿™ä¸ªinodeå°±ä¼šè¢«é‡Šæ”¾æ‰ï¼Œå¯¹åº”çš„inodeæŒ‡å‘çš„å—ä¹Ÿä¼šè¢«æ ‡è®°ä¸ºç©ºé—²çš„ï¼ˆæ•°æ®ä¸ä¼šè¢«ç½®é›¶ï¼Œæ‰€ä»¥ç¡¬ç›˜æ•°æ®è¢«è¯¯åˆ é™¤åï¼Œè‹¥æ²¡æœ‰æ–°æ•°æ®å†™å…¥å¯æ¢å¤ï¼‰ã€‚å¦‚æœæ˜¯è½¯é“¾æ¥ï¼ŒåŸæ–‡ä»¶è¢«åˆ é™¤åé“¾æ¥æ–‡ä»¶å°±å˜æˆäº†æ‚¬æŒ‚é“¾æ¥ï¼ˆdangling linkï¼‰ï¼Œæ— æ³•æ­£å¸¸è®¿é—®äº†ã€‚ åˆ©ç”¨inodeè¿˜å¯ä»¥åˆ é™¤ä¸€äº›æ–‡ä»¶åä¸­æœ‰è½¬ä¹‰å­—ç¬¦æˆ–æ§åˆ¶å­—ç¬¦çš„æ–‡ä»¶ï¼Œæœ€å…¸å‹çš„å°±æ˜¯å¼€å¤´ä¸ºå‡å·-çš„æ–‡ä»¶ã€‚è¿™ç§æ— æ³•ç›´æ¥ç”¨rmå‘½ä»¤æ¥æï¼Œå°±å¯ä»¥å…ˆæŸ¥å‡ºå®ƒä»¬çš„inodeç¼–å·å†åˆ é™¤ï¼š find ./ -inum 10086 -exec rm {} \\\nç‰¹æœ‰ç°è±¡ ç”±äºinodeå·ç ä¸æ–‡ä»¶ååˆ†ç¦»ï¼Œå¯¼è‡´ä¸€äº›Unix/Linuxç³»ç»Ÿå…·å¤‡ä»¥ä¸‹å‡ ç§ç‰¹æœ‰çš„ç°è±¡ã€‚\næ–‡ä»¶ååŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œå¯èƒ½æ— æ³•æ­£å¸¸åˆ é™¤ã€‚è¿™æ—¶ç›´æ¥åˆ é™¤inodeï¼Œèƒ½å¤Ÿèµ·åˆ°åˆ é™¤æ–‡ä»¶çš„ä½œç”¨ï¼›find ./* -inum èŠ‚ç‚¹å· -delete ç§»åŠ¨æ–‡ä»¶æˆ–é‡å‘½åæ–‡ä»¶ï¼Œåªæ˜¯æ”¹å˜æ–‡ä»¶åï¼Œä¸å½±å“inodeå·ç ï¼› æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ä»¥åï¼Œç³»ç»Ÿå°±ä»¥inodeå·ç æ¥è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ï¼Œä¸å†è€ƒè™‘æ–‡ä»¶åã€‚ è¿™ç§æƒ…å†µä½¿å¾—è½¯ä»¶æ›´æ–°å˜å¾—ç®€å•ï¼Œå¯ä»¥åœ¨ä¸å…³é—­è½¯ä»¶çš„æƒ…å†µä¸‹è¿›è¡Œæ›´æ–°ï¼Œä¸éœ€è¦é‡å¯ã€‚å› ä¸ºç³»ç»Ÿé€šè¿‡inodeå·ç ï¼Œè¯†åˆ«è¿è¡Œä¸­çš„æ–‡ä»¶ï¼Œä¸é€šè¿‡æ–‡ä»¶åã€‚æ›´æ–°çš„æ—¶å€™ï¼Œæ–°ç‰ˆæ–‡ä»¶ä»¥åŒæ ·çš„æ–‡ä»¶åï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„inodeï¼Œä¸ä¼šå½±å“åˆ°è¿è¡Œä¸­çš„æ–‡ä»¶ã€‚ç­‰åˆ°ä¸‹ä¸€æ¬¡è¿è¡Œè¿™ä¸ªè½¯ä»¶çš„æ—¶å€™ï¼Œæ–‡ä»¶åå°±è‡ªåŠ¨æŒ‡å‘æ–°ç‰ˆæ–‡ä»¶ï¼Œæ—§ç‰ˆæ–‡ä»¶çš„inodeåˆ™è¢«å›æ”¶ã€‚\ninode è€—å°½æ•…éšœ ç”±äºç¡¬ç›˜åˆ†åŒºçš„inodeæ€»æ•°åœ¨æ ¼å¼åŒ–åå°±å·²ç»å›ºå®šï¼Œè€Œæ¯ä¸ªæ–‡ä»¶å¿…é¡»æœ‰ä¸€ä¸ªinodeï¼Œå› æ­¤å°±æœ‰å¯èƒ½å‘ç”ŸinodeèŠ‚ç‚¹ç”¨å…‰ï¼Œä½†ç¡¬ç›˜ç©ºé—´è¿˜å‰©ä¸å°‘ï¼Œå´æ— æ³•åˆ›å»ºæ–°æ–‡ä»¶ã€‚åŒæ—¶è¿™ä¹Ÿæ˜¯ä¸€ç§æ”»å‡»çš„æ–¹å¼ï¼Œæ‰€ä»¥ä¸€äº›å…¬ç”¨çš„æ–‡ä»¶ç³»ç»Ÿå°±è¦åšç£ç›˜é™é¢ï¼Œä»¥é˜²æ­¢å½±å“åˆ°ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚è‡³äºä¿®å¤ï¼Œå¾ˆç®€å•ï¼Œåªè¦æ‰¾å‡ºå“ªäº›å¤§é‡å ç”¨ièŠ‚ç‚¹çš„æ–‡ä»¶åˆ é™¤å°±å¯ä»¥äº†ã€‚\nç¡¬é“¾æ¥å’Œè½¯é“¾æ¥ Linuxç³»ç»Ÿä¸­æœ‰ä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„æ–‡ä»¶ç§°ä¹‹ä¸ºé“¾æ¥ï¼ˆlinkï¼‰ã€‚é€šä¿—åœ°è¯´ï¼Œé“¾æ¥å°±æ˜¯ä»ä¸€ä¸ªæ–‡ä»¶æŒ‡å‘å¦å¤–ä¸€ä¸ªæ–‡ä»¶çš„è·¯å¾„ã€‚linuxä¸­é“¾æ¥åˆ†ä¸ºä¿©ç§ï¼Œç¡¬é“¾æ¥å’Œè½¯é“¾æ¥ã€‚ç®€å•æ¥è¯´ï¼Œç¡¬é“¾æ¥ç›¸å½“äºæºæ–‡ä»¶å’Œé“¾æ¥æ–‡ä»¶åœ¨ç£ç›˜å’Œå†…å­˜ä¸­å…±äº«ä¸€ä¸ªinodeï¼Œå› æ­¤ï¼Œé“¾æ¥æ–‡ä»¶å’Œæºæ–‡ä»¶æœ‰ä¸åŒçš„dentryï¼Œå› æ­¤ï¼Œè¿™ä¸ªç‰¹æ€§å†³å®šäº†ç¡¬é“¾æ¥æ— æ³•è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿï¼Œè€Œä¸”æˆ‘ä»¬æ— æ³•ä¸ºç›®å½•åˆ›å»ºç¡¬é“¾æ¥ã€‚è½¯é“¾æ¥å’Œç¡¬é“¾æ¥ä¸åŒï¼Œé¦–å…ˆè½¯é“¾æ¥å¯ä»¥è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿï¼Œå…¶æ¬¡ï¼Œé“¾æ¥æ–‡ä»¶å’Œæºæ–‡ä»¶æœ‰ç€ä¸åŒçš„inodeå’Œdentryï¼Œå› æ­¤ï¼Œä¸¤ä¸ªæ–‡ä»¶çš„å±æ€§å’Œå†…å®¹ä¹Ÿæˆªç„¶ä¸åŒï¼Œè½¯é“¾æ¥æ–‡ä»¶çš„æ–‡ä»¶å†…å®¹æ˜¯æºæ–‡ä»¶çš„æ–‡ä»¶åã€‚ ç¡¬é“¾æ¥æ˜¯å¤šä¸ªç›®å½•é¡¹ä¸­çš„ã€Œç´¢å¼•èŠ‚ç‚¹ã€æŒ‡å‘ä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘åŒä¸€ä¸ª inodeï¼Œä½†æ˜¯ inode æ˜¯ä¸å¯èƒ½è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿçš„ï¼Œæ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿéƒ½æœ‰å„è‡ªçš„ inode æ•°æ®ç»“æ„å’Œåˆ—è¡¨ï¼Œæ‰€ä»¥ç¡¬é“¾æ¥æ˜¯ä¸å¯ç”¨äºè·¨æ–‡ä»¶ç³»ç»Ÿçš„ã€‚ç”±äºå¤šä¸ªç›®å½•é¡¹éƒ½æ˜¯æŒ‡å‘ä¸€ä¸ª inodeï¼Œé‚£ä¹ˆåªæœ‰åˆ é™¤æ–‡ä»¶çš„æ‰€æœ‰ç¡¬é“¾æ¥ä»¥åŠæºæ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šå½»åº•åˆ é™¤è¯¥æ–‡ä»¶ã€‚ è½¯é“¾æ¥ç›¸å½“äºé‡æ–°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æœ‰ç‹¬ç«‹çš„ inodeï¼Œä½†æ˜¯è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹æ˜¯å¦å¤–ä¸€ä¸ªæ–‡ä»¶çš„è·¯å¾„ï¼Œæ‰€ä»¥è®¿é—®è½¯é“¾æ¥çš„æ—¶å€™ï¼Œå®é™…ä¸Šç›¸å½“äºè®¿é—®åˆ°äº†å¦å¤–ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥è½¯é“¾æ¥æ˜¯å¯ä»¥è·¨æ–‡ä»¶ç³»ç»Ÿçš„ï¼Œç”šè‡³ç›®æ ‡æ–‡ä»¶è¢«åˆ é™¤äº†ï¼Œé“¾æ¥æ–‡ä»¶è¿˜æ˜¯åœ¨çš„ï¼Œåªä¸è¿‡æŒ‡å‘çš„æ–‡ä»¶æ‰¾ä¸åˆ°äº†è€Œå·²ã€‚ è½¯ç¡¬é“¾æ¥å®ç°çš„åŸç†ä¸åŒ\nç¡¬é“¾æ¥æ˜¯å»ºç«‹ä¸€ä¸ªç›®å½•é¡¹ï¼ŒåŒ…å«æ–‡ä»¶åå’Œæ–‡ä»¶çš„inodeï¼Œä½†inodeæ˜¯åŸæ¥æ–‡ä»¶çš„inodeå·ï¼Œå¹¶ä¸å»ºç«‹å…¶æ‰€å¯¹åº”å¾—æ•°æ®ã€‚æ‰€ä»¥ç¡¬é“¾æ¥å¹¶ä¸å ç”¨inodeã€‚ è½¯é“¾æ¥ä¹Ÿåˆ›å»ºä¸€ä¸ªç›®å½•é¡¹ï¼Œä¹ŸåŒ…å«æ–‡ä»¶åå’Œæ–‡ä»¶çš„inodeï¼Œä½†å®ƒçš„inodeæŒ‡å‘çš„å¹¶ä¸æ˜¯åŸæ¥æ–‡ä»¶åæ‰€æŒ‡å‘çš„æ•°æ®çš„inodeï¼Œè€Œæ˜¯æ–°å»ºä¸€ä¸ªinodeï¼Œå¹¶å»ºç«‹æ•°æ®ï¼Œæ•°æ®æŒ‡å‘çš„æ˜¯åŸæ¥æ–‡ä»¶åï¼Œæ‰€ä»¥åŸæ¥æ–‡ä»¶åçš„å­—ç¬¦æ•°ï¼Œå³ä¸ºè½¯é“¾æ¥æ‰€å å­—èŠ‚æ•° è½¯ç¡¬é“¾æ¥æ‰€èƒ½åˆ›å»ºçš„ç›®æ ‡æœ‰åŒºåˆ«\nå› ä¸ºæ¯ä¸ªåˆ†åŒºå„æœ‰ä¸€å¥—ä¸åŒçš„inodeè¡¨ï¼Œæ‰€ä»¥ç¡¬é“¾æ¥ä¸èƒ½è·¨åˆ†åŒºåˆ›å»ºè€Œè½¯é“¾æ¥å¯ä»¥,å› ä¸ºè½¯é“¾æ¥æŒ‡å‘çš„æ˜¯æ–‡ä»¶åã€‚ ç¡¬é“¾æ¥ä¸èƒ½æŒ‡å‘ç›®å½• å¦‚æœè¯´ç›®å½•æœ‰ç¡¬é“¾æ¥é‚£ä¹ˆå¯èƒ½å¼•å…¥æ­»å¾ªç¯ï¼Œä½†æ˜¯ä½ å¯èƒ½ä¼šç–‘é—®è½¯é“¾æ¥ä¹Ÿä¼šé™·å…¥å¾ªç¯å•Šï¼Œç­”æ¡ˆå½“ç„¶ä¸æ˜¯ï¼Œå› ä¸ºè½¯é“¾æ¥æ˜¯å­˜åœ¨è‡ªå·±çš„æ•°æ®çš„ï¼Œå¯ä»¥æŸ¥çœ‹è‡ªå·±çš„æ–‡ä»¶å±æ€§ï¼Œæ—¢ç„¶å¯ä»¥åˆ¤æ–­å‡ºæ¥è½¯é“¾æ¥ï¼Œé‚£ä¹ˆè‡ªç„¶ä¸ä¼šé™·å…¥å¾ªç¯ï¼Œå¹¶ä¸”ç³»ç»Ÿåœ¨è¿ç»­é‡åˆ°8ä¸ªç¬¦å·é“¾æ¥åå°±åœæ­¢éå†ã€‚ä½†æ˜¯ç¡¬é“¾æ¥å¯å°±ä¸è¡Œäº†ï¼Œå› ä¸ºä»–çš„inodeå·ä¸€è‡´ï¼Œæ‰€ä»¥å°±åˆ¤æ–­ä¸å‡ºæ˜¯ç¡¬é“¾æ¥ï¼Œæ‰€ä»¥å°±ä¼šé™·å…¥æ­»å¾ªç¯äº†ã€‚\nç›¸å…³æ¦‚å¿µåœ¨ç¡¬ç›˜ä¸Šçš„å›¾ç¤º Super Block, Group Descriptor Inode å±•ç¤ºçš„æ˜¯ext2 çš„inode ext4 block ç”¨çš„æ˜¯extent tree æ–¹å¼ï¼Œä¸æ˜¯ç°åœ¨å±•ç¤ºçš„indirect æ–¹å¼ Directory File Size Comparision of File System æ–‡ä»¶æè¿°ç¬¦å’ŒInode çš„å…³ç³» æ¦‚å¿µ Linux ç³»ç»Ÿä¸­ï¼ŒæŠŠä¸€åˆ‡éƒ½çœ‹åšæ˜¯æ–‡ä»¶ï¼Œå½“è¿›ç¨‹æ‰“å¼€ç°æœ‰æ–‡ä»¶æˆ–åˆ›å»ºæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæ–‡ä»¶æè¿°ç¬¦å°±æ˜¯å†…æ ¸ä¸ºäº†é«˜æ•ˆç®¡ç†å·²è¢«æ‰“å¼€çš„æ–‡ä»¶æ‰€åˆ›å»ºçš„ç´¢å¼•ï¼Œç”¨æ¥æŒ‡å‘è¢«æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ‰€æœ‰æ‰§è¡ŒI/Oæ“ä½œçš„ç³»ç»Ÿè°ƒç”¨éƒ½ä¼šé€šè¿‡æ–‡ä»¶æè¿°ç¬¦ã€‚\næ–‡ä»¶æè¿°ç¬¦ä¸æ–‡ä»¶ã€è¿›ç¨‹çš„å…³ç³» 1 2 3 4 5 6 fd = open(pathname, flags, mode) // è¿”å›äº†è¯¥æ–‡ä»¶çš„fd rlen = read(fd, buf, count) // IOæ“ä½œå‡éœ€è¦ä¼ å…¥è¯¥æ–‡ä»¶çš„fdå€¼ wlen = write(fd, buf, count) status = close(fd) æ¯å½“è¿›ç¨‹ç”¨openï¼ˆï¼‰å‡½æ•°æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå†…æ ¸ä¾¿ä¼šè¿”å›è¯¥æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆä¸€ä¸ªéè´Ÿçš„æ•´å½¢å€¼ï¼‰ï¼Œæ­¤åæ‰€æœ‰å¯¹è¯¥æ–‡ä»¶çš„æ“ä½œï¼Œéƒ½ä¼šä»¥è¿”å›çš„fdæ–‡ä»¶æè¿°ç¬¦ä¸ºå‚æ•°ã€‚\næ–‡ä»¶æè¿°ç¬¦å¯ä»¥ç†è§£ä¸ºè¿›ç¨‹æ–‡ä»¶æè¿°è¡¨è¿™ä¸ªè¡¨çš„ç´¢å¼•ï¼Œæˆ–è€…æŠŠæ–‡ä»¶æè¿°è¡¨çœ‹åšä¸€ä¸ªæ•°ç»„çš„è¯ï¼Œæ–‡ä»¶æè¿°ç¬¦å¯ä»¥çœ‹åšæ˜¯æ•°ç»„çš„ä¸‹æ ‡ã€‚å½“éœ€è¦è¿›è¡ŒI/Oæ“ä½œçš„æ—¶å€™ï¼Œä¼šä¼ å…¥fdä½œä¸ºå‚æ•°ï¼Œå…ˆä»è¿›ç¨‹æ–‡ä»¶æè¿°ç¬¦è¡¨æŸ¥æ‰¾è¯¥fdå¯¹åº”çš„é‚£ä¸ªæ¡ç›®ï¼Œå–å‡ºå¯¹åº”çš„é‚£ä¸ªå·²ç»æ‰“å¼€çš„æ–‡ä»¶çš„å¥æŸ„ï¼Œæ ¹æ®æ–‡ä»¶å¥æŸ„æŒ‡å‘ï¼Œå»ç³»ç»Ÿfdè¡¨ä¸­æŸ¥æ‰¾åˆ°è¯¥æ–‡ä»¶æŒ‡å‘çš„inodeï¼Œä»è€Œå®šä½åˆ°è¯¥æ–‡ä»¶çš„çœŸæ­£ä½ç½®ï¼Œä»è€Œè¿›è¡ŒI/Oæ“ä½œã€‚\næ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¼šä¸ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶ç›¸å¯¹åº” ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä¹Ÿå¯èƒ½æŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶ ç›¸åŒçš„æ–‡ä»¶å¯ä»¥è¢«ä¸åŒçš„è¿›ç¨‹æ‰“å¼€ï¼Œä¹Ÿå¯ä»¥åœ¨åŒä¸€ä¸ªè¿›ç¨‹è¢«å¤šæ¬¡æ‰“å¼€ æ–‡ä»¶æè¿°ç¬¦ç›¸å…³è¡¨ è¿›ç¨‹çº§çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ ç³»ç»Ÿçº§çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ æ–‡ä»¶ç³»ç»Ÿçš„i-nodeè¡¨ è¿›ç¨‹çº§åˆ«çš„æ–‡ä»¶æè¿°è¡¨ linuxå†…æ ¸ä¼šä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºä¸€ä¸ªtask_tructç»“æ„ä½“æ¥ç»´æŠ¤è¿›ç¨‹ä¿¡æ¯ï¼Œç§°ä¹‹ä¸º è¿›ç¨‹æè¿°ç¬¦ï¼Œè¯¥ç»“æ„ä½“ä¸­ æŒ‡é’ˆstruct files_struct *files æŒ‡å‘ä¸€ä¸ªåç§°ä¸ºfile_structçš„ç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“å³ è¿›ç¨‹çº§åˆ«çš„æ–‡ä»¶æè¿°è¡¨ã€‚ å®ƒçš„æ¯ä¸€ä¸ªæ¡ç›®è®°å½•çš„æ˜¯å•ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ç›¸å…³ä¿¡æ¯:\nfdæ§åˆ¶æ ‡å¿—ï¼Œå‰å†…æ ¸ä»…å®šä¹‰äº†ä¸€ä¸ªï¼Œå³close-on-exec æ–‡ä»¶æè¿°ç¬¦æ‰€æ‰“å¼€çš„æ–‡ä»¶å¥æŸ„çš„å¼•ç”¨ æ–‡ä»¶å¥æŸ„è¿™é‡Œå¯ä»¥ç†è§£ä¸ºæ–‡ä»¶åï¼Œæˆ–è€…æ–‡ä»¶çš„å…¨è·¯å¾„åï¼Œå› ä¸ºlinuxæ–‡ä»¶ç³»ç»Ÿæ–‡ä»¶åå’Œæ–‡ä»¶æ˜¯ç‹¬ç«‹çš„ï¼Œä»¥æ­¤ä¸inodeåŒºåˆ†\nç³»ç»Ÿçº§åˆ«çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ å†…æ ¸å¯¹ç³»ç»Ÿä¸­æ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶ç»´æŠ¤äº†ä¸€ä¸ªæè¿°ç¬¦è¡¨ï¼Œä¹Ÿè¢«ç§°ä¹‹ä¸º ã€æ‰“å¼€æ–‡ä»¶è¡¨ã€‘ï¼Œè¡¨æ ¼ä¸­çš„æ¯ä¸€é¡¹è¢«ç§°ä¹‹ä¸º ã€æ‰“å¼€æ–‡ä»¶å¥æŸ„ã€‘ï¼Œä¸€ä¸ªã€æ‰“å¼€æ–‡ä»¶å¥æŸ„ã€‘ æè¿°äº†ä¸€ä¸ªæ‰“å¼€æ–‡ä»¶çš„å…¨éƒ¨ä¿¡æ¯ã€‚ ä¸»è¦åŒ…æ‹¬ï¼š\nå½“å‰æ–‡ä»¶åç§»é‡ï¼ˆè°ƒç”¨read()å’Œwrite()æ—¶æ›´æ–°ï¼Œæˆ–ä½¿ç”¨lseek()ç›´æ¥ä¿®æ”¹ï¼‰ æ‰“å¼€æ–‡ä»¶æ—¶æ‰€ä½¿ç”¨çš„çŠ¶æ€æ ‡è¯†ï¼ˆå³ï¼Œopen()çš„flagså‚æ•°ï¼‰ æ–‡ä»¶è®¿é—®æ¨¡å¼ï¼ˆå¦‚è°ƒç”¨open()æ—¶æ‰€è®¾ç½®çš„åªè¯»æ¨¡å¼ã€åªå†™æ¨¡å¼æˆ–è¯»å†™æ¨¡å¼ï¼‰ ä¸ä¿¡å·é©±åŠ¨ç›¸å…³çš„è®¾ç½® å¯¹è¯¥æ–‡ä»¶i-nodeå¯¹è±¡çš„å¼•ç”¨ æ–‡ä»¶ç±»å‹ï¼ˆä¾‹å¦‚ï¼šå¸¸è§„æ–‡ä»¶ã€å¥—æ¥å­—æˆ–FIFOï¼‰å’Œè®¿é—®æƒé™ ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘è¯¥æ–‡ä»¶æ‰€æŒæœ‰çš„é”åˆ—è¡¨ æ–‡ä»¶çš„å„ç§å±æ€§ï¼ŒåŒ…æ‹¬æ–‡ä»¶å¤§å°ä»¥åŠä¸ä¸åŒç±»å‹æ“ä½œç›¸å…³çš„æ—¶é—´æˆ³ Inodeè¡¨ æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿä¼šä¸ºå­˜å‚¨äºå…¶ä¸Šçš„æ‰€æœ‰æ–‡ä»¶(åŒ…æ‹¬ç›®å½•)ç»´æŠ¤ä¸€ä¸ªi-nodeè¡¨ï¼Œå•ä¸ªi-nodeåŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š\næ–‡ä»¶ç±»å‹(file type)ï¼Œå¯ä»¥æ˜¯å¸¸è§„æ–‡ä»¶ã€ç›®å½•ã€å¥—æ¥å­—æˆ–FIFO è®¿é—®æƒé™ æ–‡ä»¶é”åˆ—è¡¨(file locks) æ–‡ä»¶å¤§å° ç­‰ç­‰ i-nodeå­˜å‚¨åœ¨ç£ç›˜è®¾å¤‡ä¸Šï¼Œå†…æ ¸åœ¨å†…å­˜ä¸­ç»´æŠ¤äº†ä¸€ä¸ªå‰¯æœ¬ï¼Œè¿™é‡Œçš„i-nodeè¡¨ä¸ºåè€…ã€‚å‰¯æœ¬é™¤äº†åŸæœ‰ä¿¡æ¯ï¼Œè¿˜åŒ…æ‹¬ï¼šå¼•ç”¨è®¡æ•°(ä»æ‰“å¼€æ–‡ä»¶æè¿°ä½“)ã€æ‰€åœ¨è®¾å¤‡å·ä»¥åŠä¸€äº›ä¸´æ—¶å±æ€§ï¼Œä¾‹å¦‚æ–‡ä»¶é”ã€‚ åœ¨è¿›ç¨‹Aä¸­ï¼Œæ–‡ä»¶æè¿°ç¬¦1å’Œ30éƒ½æŒ‡å‘äº†åŒä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ï¼ˆæ ‡å·23ï¼‰ã€‚è¿™å¯èƒ½æ˜¯é€šè¿‡è°ƒç”¨dup()ã€dup2()ã€fcntl()æˆ–è€…å¯¹åŒä¸€ä¸ªæ–‡ä»¶å¤šæ¬¡è°ƒç”¨äº†open()å‡½æ•°è€Œå½¢æˆçš„ã€‚ dupï¼ˆï¼‰ï¼Œä¹Ÿç§°ä¹‹ä¸ºæ–‡ä»¶æè¿°ç¬¦å¤åˆ¶å‡½æ•°ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚ï¼šæ ‡å‡†è¾“å…¥/è¾“å‡ºé‡å®šå‘ã€‚åœ¨shellä¸‹ï¼Œå®Œæˆè¿™ä¸ªæ“ä½œéå¸¸ç®€å•ï¼Œå¤§éƒ¨åˆ†äººéƒ½ä¼šï¼Œä½†æ˜¯æå°‘äººæ€è€ƒè¿‡èƒŒåçš„åŸç†ã€‚\nå¤§æ¦‚æè¿°ä¸€ä¸‹éœ€è¦çš„å‡ ä¸ªæ­¥éª¤ï¼Œä»¥æ ‡å‡†è¾“å‡º(æ–‡ä»¶æè¿°ç¬¦ä¸º1)é‡å®šå‘ä¸ºä¾‹ï¼š\næ‰“å¼€ç›®æ ‡æ–‡ä»¶ï¼Œè¿”å›æ–‡ä»¶æè¿°ç¬¦nï¼› å…³é—­æ–‡ä»¶æè¿°ç¬¦1ï¼› è°ƒç”¨dupå°†æ–‡ä»¶æè¿°ç¬¦nå¤åˆ¶åˆ°1ï¼› å…³é—­æ–‡ä»¶æè¿°ç¬¦nï¼› è¿›ç¨‹Açš„æ–‡ä»¶æè¿°ç¬¦2å’Œè¿›ç¨‹Bçš„æ–‡ä»¶æè¿°ç¬¦2éƒ½æŒ‡å‘äº†åŒä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ï¼ˆæ ‡å·73ï¼‰ã€‚è¿™ç§æƒ…å½¢å¯èƒ½æ˜¯åœ¨è°ƒç”¨fork()åå‡ºç°çš„ï¼ˆå³ï¼Œè¿›ç¨‹Aã€Bæ˜¯çˆ¶å­è¿›ç¨‹å…³ç³»ï¼‰ å­è¿›ç¨‹ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œä¹Ÿå°±æ˜¯å­è¿›ç¨‹ç»§æ‰¿çˆ¶è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ è¿™å¥è¯çš„ç”±æ¥ã€‚ æˆ–è€…å½“æŸè¿›ç¨‹é€šè¿‡UNIXåŸŸå¥—æ¥å­—å°†ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ä¼ é€’ç»™å¦ä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œä¹Ÿä¼šå‘ç”Ÿã€‚å†è€…æ˜¯ä¸åŒçš„è¿›ç¨‹ç‹¬è‡ªå»è°ƒç”¨openå‡½æ•°æ‰“å¼€äº†åŒä¸€ä¸ªæ–‡ä»¶ï¼Œæ­¤æ—¶è¿›ç¨‹å†…éƒ¨çš„æè¿°ç¬¦æ­£å¥½åˆ†é…åˆ°ä¸å…¶ä»–è¿›ç¨‹æ‰“å¼€è¯¥æ–‡ä»¶çš„æè¿°ç¬¦ä¸€æ ·ã€‚\næ­¤å¤–ï¼Œè¿›ç¨‹Açš„æè¿°ç¬¦0å’Œè¿›ç¨‹Bçš„æè¿°ç¬¦3åˆ†åˆ«æŒ‡å‘ä¸åŒçš„æ‰“å¼€æ–‡ä»¶å¥æŸ„ï¼Œä½†è¿™äº›å¥æŸ„å‡æŒ‡å‘i-nodeè¡¨çš„ç›¸åŒæ¡ç›®ï¼ˆ1976ï¼‰ï¼Œæ¢è¨€ä¹‹ï¼ŒæŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºæ¯ä¸ªè¿›ç¨‹å„è‡ªå¯¹åŒä¸€ä¸ªæ–‡ä»¶å‘èµ·äº†open()è°ƒç”¨ã€‚åŒä¸€ä¸ªè¿›ç¨‹ä¸¤æ¬¡æ‰“å¼€åŒä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿä¼šå‘ç”Ÿç±»ä¼¼æƒ…å†µã€‚\næ–‡ä»¶æè¿°ç¬¦é™åˆ¶ æœ‰èµ„æºçš„åœ°æ–¹å°±æœ‰æˆ˜äº‰ï¼Œâ€œæ–‡ä»¶æè¿°ç¬¦â€ä¹Ÿæ˜¯ä¸€ç§èµ„æºï¼Œç³»ç»Ÿä¸­çš„æ¯ä¸ªè¿›ç¨‹éƒ½éœ€è¦æœ‰â€œæ–‡ä»¶æè¿°ç¬¦â€æ‰èƒ½è¿›è¡Œæ”¹å˜ä¸–ç•Œçš„å®å›¾éœ¸ä¸šã€‚ä¸–ç•Œéœ€è¦ç§©åºï¼Œäºæ˜¯å°±æœ‰äº†â€œæ–‡ä»¶æè¿°ç¬¦é™åˆ¶â€çš„è§„å®šã€‚\nå¦‚ä¸‹è¡¨ï¼š æ°¸ä¹…ä¿®æ”¹ç”¨æˆ·çº§é™åˆ¶æ—¶æœ‰ä¸‰ç§è®¾ç½®ç±»å‹ï¼š\nsoft æŒ‡çš„æ˜¯å½“å‰ç³»ç»Ÿç”Ÿæ•ˆçš„è®¾ç½®å€¼ hard æŒ‡çš„æ˜¯ç³»ç»Ÿä¸­æ‰€èƒ½è®¾å®šçš„æœ€å¤§å€¼ â€œ-â€ æŒ‡çš„æ˜¯åŒæ—¶è®¾ç½®äº† soft å’Œ hard çš„å€¼ ","permalink":"https://reid00.github.io/en/posts/os_network/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B9%8B%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/","summary":"æ–‡ä»¶ç³»ç»Ÿ æ–‡ä»¶ç³»ç»Ÿæ˜¯æ“ä½œç³»ç»Ÿä¸­è´Ÿè´£ç®¡ç†æŒä¹…æ•°æ®çš„å­ç³»ç»Ÿï¼Œè¯´ç®€å•ç‚¹ï¼Œå°±æ˜¯è´Ÿè´£æŠŠç”¨æˆ·çš„æ–‡ä»¶å­˜åˆ°ç£ç›˜ç¡¬ä»¶ä¸­ï¼Œå› ä¸ºå³ä½¿è®¡ç®—æœºæ–­ç”µäº†ï¼Œç£ç›˜é‡Œçš„æ•°æ®å¹¶ä¸ä¼šä¸¢å¤±ï¼Œæ‰€ä»¥å¯ä»¥æŒä¹…åŒ–çš„ä¿å­˜æ–‡ä»¶ã€‚\næ–‡ä»¶ç³»ç»Ÿçš„åŸºæœ¬æ•°æ®å•ä½æ˜¯æ–‡ä»¶ï¼Œå®ƒçš„ç›®çš„æ˜¯å¯¹ç£ç›˜ä¸Šçš„æ–‡ä»¶è¿›è¡Œç»„ç»‡ç®¡ç†ï¼Œé‚£ç»„ç»‡çš„æ–¹å¼ä¸åŒï¼Œå°±ä¼šå½¢æˆä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿã€‚\nLinux æœ€ç»å…¸çš„ä¸€å¥è¯æ˜¯ï¼šã€Œä¸€åˆ‡çš†æ–‡ä»¶ã€ï¼Œä¸ä»…æ™®é€šçš„æ–‡ä»¶å’Œç›®å½•ï¼Œå°±è¿å—è®¾å¤‡ã€ç®¡é“ã€socket ç­‰ï¼Œä¹Ÿéƒ½æ˜¯ç»Ÿä¸€äº¤ç»™æ–‡ä»¶ç³»ç»Ÿç®¡ç†çš„ã€‚\nLinux æ–‡ä»¶ç³»ç»Ÿä¼šä¸ºæ¯ä¸ªæ–‡ä»¶åˆ†é…ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼šInodeï¼ˆindex nodeï¼‰å’Œç›®å½•é¡¹ï¼ˆdirectory entryï¼‰ï¼Œå®ƒä»¬ä¸»è¦ç”¨æ¥è®°å½•æ–‡ä»¶çš„å…ƒä¿¡æ¯å’Œç›®å½•å±‚æ¬¡ç»“æ„ã€‚\nInodeï¼Œä¹Ÿå°±æ˜¯inodeï¼Œç”¨æ¥è®°å½•æ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼Œæ¯”å¦‚ inode ç¼–å·ã€æ–‡ä»¶å¤§å°ã€è®¿é—®æƒé™ã€åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€æ•°æ®åœ¨ç£ç›˜çš„ä½ç½®ç­‰ç­‰ã€‚Inodeæ˜¯æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ï¼Œå®ƒä»¬ä¹‹é—´ä¸€ä¸€å¯¹åº”ï¼Œä¹ŸåŒæ ·éƒ½ä¼šè¢«å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­ï¼Œæ‰€ä»¥InodeåŒæ ·å ç”¨ç£ç›˜ç©ºé—´ã€‚\nç›®å½•é¡¹ï¼Œä¹Ÿå°±æ˜¯dentryï¼Œç”¨æ¥è®°å½•æ–‡ä»¶çš„åå­—ã€InodeæŒ‡é’ˆä»¥åŠä¸å…¶ä»–ç›®å½•é¡¹çš„å±‚çº§å…³è”å…³ç³»ã€‚å¤šä¸ªç›®å½•é¡¹å…³è”èµ·æ¥ï¼Œå°±ä¼šå½¢æˆç›®å½•ç»“æ„ï¼Œä½†å®ƒä¸Inodeä¸åŒçš„æ˜¯ï¼Œç›®å½•é¡¹æ˜¯ç”±å†…æ ¸ç»´æŠ¤çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œä¸å­˜æ”¾äºç£ç›˜ï¼Œè€Œæ˜¯ç¼“å­˜åœ¨å†…å­˜ã€‚\nç”±äºInodeå”¯ä¸€æ ‡è¯†ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œç›®å½•é¡¹è®°å½•ç€æ–‡ä»¶çš„åï¼Œæ‰€ä»¥ç›®å½•é¡¹å’ŒInodeçš„å…³ç³»æ˜¯å¤šå¯¹ä¸€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ªç›®å½•ã€‚æ¯”å¦‚ï¼Œç¡¬é“¾æ¥çš„å®ç°å°±æ˜¯å¤šä¸ªç›®å½•é¡¹ä¸­çš„InodeæŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶ã€‚\næ³¨æ„ï¼Œç›®å½•ä¹Ÿæ˜¯æ–‡ä»¶ï¼Œä¹Ÿæ˜¯ç”¨Inodeå”¯ä¸€æ ‡è¯†ï¼Œå’Œæ™®é€šæ–‡ä»¶ä¸åŒçš„æ˜¯ï¼Œæ™®é€šæ–‡ä»¶åœ¨ç£ç›˜é‡Œé¢ä¿å­˜çš„æ˜¯æ–‡ä»¶æ•°æ®ï¼Œè€Œç›®å½•æ–‡ä»¶åœ¨ç£ç›˜é‡Œé¢ä¿å­˜å­ç›®å½•æˆ–æ–‡ä»¶ã€‚\nç›®å½•é¡¹å’Œç›®å½•æ˜¯ä¸€ä¸ªä¸œè¥¿å—ï¼Ÿ è™½ç„¶åå­—å¾ˆç›¸è¿‘ï¼Œä½†æ˜¯å®ƒä»¬ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œç›®å½•æ˜¯ä¸ªæ–‡ä»¶ï¼ŒæŒä¹…åŒ–å­˜å‚¨åœ¨ç£ç›˜ï¼Œè€Œç›®å½•é¡¹æ˜¯å†…æ ¸ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œç¼“å­˜åœ¨å†…å­˜ã€‚\nå¦‚æœæŸ¥è¯¢ç›®å½•é¢‘ç¹ä»ç£ç›˜è¯»ï¼Œæ•ˆç‡ä¼šå¾ˆä½ï¼Œæ‰€ä»¥å†…æ ¸ä¼šæŠŠå·²ç»è¯»è¿‡çš„ç›®å½•ç”¨ç›®å½•é¡¹è¿™ä¸ªæ•°æ®ç»“æ„ç¼“å­˜åœ¨å†…å­˜ï¼Œä¸‹æ¬¡å†æ¬¡è¯»åˆ°ç›¸åŒçš„ç›®å½•æ—¶ï¼Œåªéœ€ä»å†…å­˜è¯»å°±å¯ä»¥ï¼Œå¤§å¤§æé«˜äº†æ–‡ä»¶ç³»ç»Ÿçš„æ•ˆç‡ã€‚\næ³¨æ„ï¼Œç›®å½•é¡¹è¿™ä¸ªæ•°æ®ç»“æ„ä¸åªæ˜¯è¡¨ç¤ºç›®å½•ï¼Œä¹Ÿæ˜¯å¯ä»¥è¡¨ç¤ºæ–‡ä»¶çš„ã€‚\n##ã€€æ–‡ä»¶æ•°æ®æ˜¯å¦‚ä½•å­˜å‚¨åœ¨ç£ç›˜çš„å‘¢ï¼Ÿ ç£ç›˜è¯»å†™çš„æœ€å°å•ä½æ˜¯æ‰‡åŒºï¼Œæ‰‡åŒºçš„å¤§å°åªæœ‰ 512å­—èŠ‚ï¼Œé‚£ä¹ˆå¦‚æœæ•°æ®å¤§äº512å­—èŠ‚æ—¶å€™ï¼Œç£ç›˜éœ€è¦ä¸åœåœ°ç§»åŠ¨ç£å¤´æ¥æŸ¥æ‰¾æ•°æ®ï¼Œæˆ‘ä»¬çŸ¥é“ä¸€èˆ¬çš„æ–‡ä»¶å¾ˆå®¹æ˜“è¶…è¿‡512å­—èŠ‚é‚£ä¹ˆå¦‚æœæŠŠå¤šä¸ªæ‰‡åŒºåˆå¹¶ä¸ºä¸€ä¸ªå—ï¼Œé‚£ä¹ˆç£ç›˜å°±å¯ä»¥æé«˜æ•ˆç‡äº†ã€‚é‚£ä¹ˆç£å¤´ä¸€æ¬¡è¯»å–å¤šä¸ªæ‰‡åŒºå°±ä¸ºä¸€ä¸ªå—â€œblockâ€ï¼ˆLinuxä¸Šç§°ä¸ºå—ï¼ŒWindowsä¸Šç§°ä¸ºç°‡ï¼‰ã€‚æ‰€ä»¥ï¼Œæ–‡ä»¶ç³»ç»ŸæŠŠå¤šä¸ªæ‰‡åŒºç»„æˆäº†ä¸€ä¸ªé€»è¾‘å—ï¼Œæ¯æ¬¡è¯»å†™çš„æœ€å°å•ä½å°±æ˜¯é€»è¾‘å—ï¼ˆæ•°æ®å—ï¼‰ï¼ŒLinux ä¸­çš„é€»è¾‘å—å¤§å°ä¸º 4KBï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡æ€§è¯»å†™ 8 ä¸ªæ‰‡åŒºï¼Œè¿™å°†å¤§å¤§æé«˜äº†ç£ç›˜çš„è¯»å†™çš„æ•ˆç‡ã€‚ sector size \u0026lt;= block size \u0026lt;= memory page size\næ–‡ä»¶ç³»ç»Ÿè®°å½•çš„æ•°æ®ï¼Œé™¤äº†å…¶è‡ªèº«å¤–ï¼Œè¿˜æœ‰æ•°æ®çš„æƒé™ä¿¡æ¯ï¼Œæ‰€æœ‰è€…ç­‰å±æ€§ï¼Œè¿™äº›ä¿¡æ¯éƒ½ä¿å­˜åœ¨inodeä¸­ï¼Œé‚£ä¹ˆè°æ¥è®°å½•inodeä¿¡æ¯å’Œæ–‡ä»¶ç³»ç»Ÿæœ¬èº«çš„ä¿¡æ¯å‘¢ï¼Œæ¯”å¦‚è¯´æ–‡ä»¶ç³»ç»Ÿçš„æ ¼å¼ï¼Œinodeä¸dataçš„æ•°é‡å‘¢ï¼Ÿé‚£ä¹ˆå°±æœ‰ä¸€ä¸ªè¶…çº§åŒºå—ï¼ˆsupper blockï¼‰æ¥è®°å½•è¿™äº›ä¿¡æ¯äº†ã€‚\nsuperblockï¼šè®°å½•æ­¤ filesystem çš„æ•´ä½“ä¿¡æ¯ï¼ŒåŒ…æ‹¬inode/blockçš„æ€»é‡ã€ä½¿ç”¨é‡ã€å‰©ä½™é‡ï¼Œ ä»¥åŠæ–‡ä»¶ç³»ç»Ÿçš„æ ¼å¼ä¸ç›¸å…³ä¿¡æ¯ç­‰ inodeï¼šè®°å½•æ–‡ä»¶çš„å±æ€§ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨statå‘½ä»¤æŸ¥çœ‹inodeä¿¡æ¯ã€‚ blockï¼šå®é™…æ–‡ä»¶çš„å†…å®¹ï¼Œå¦‚æœä¸€ä¸ªæ–‡ä»¶å¤§äºä¸€ä¸ªå—æ—¶å€™ï¼Œé‚£ä¹ˆå°†å ç”¨å¤šä¸ªblockï¼Œä½†æ˜¯ä¸€ä¸ªå—åªèƒ½å­˜æ”¾ä¸€ä¸ªæ–‡ä»¶ã€‚ï¼ˆå› ä¸ºæ•°æ®æ˜¯ç”±inodeæŒ‡å‘çš„ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªæ–‡ä»¶çš„æ•°æ®å­˜æ”¾åœ¨åŒä¸€ä¸ªå—ä¸­ï¼Œå°±ä¼šä¹±å¥—äº†ï¼‰ Inodeç”¨æ¥æŒ‡å‘æ•°æ®blockï¼Œé‚£ä¹ˆåªè¦æ‰¾åˆ°inodeï¼Œå†ç”±inodeæ‰¾åˆ°blockç¼–å·ï¼Œé‚£ä¹ˆå®é™…æ•°æ®å°±èƒ½æ‰¾å‡ºæ¥äº†ã€‚\nInodeæ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šçš„æ•°æ®ï¼Œä¸ºäº†åŠ é€Ÿæ–‡ä»¶çš„è®¿é—®ï¼Œé€šå¸¸ä¼šæŠŠInodeåŠ è½½åˆ°å†…å­˜ä¸­ã€‚æˆ‘ä»¬ä¸å¯èƒ½æŠŠè¶…çº§å—å’ŒInodeåŒºå…¨éƒ¨åŠ è½½åˆ°å†…å­˜ï¼Œè¿™æ ·å†…å­˜è‚¯å®šæ’‘ä¸ä½ï¼Œæ‰€ä»¥åªæœ‰å½“éœ€è¦ä½¿ç”¨çš„æ—¶å€™ï¼Œæ‰å°†å…¶åŠ è½½è¿›å†…å­˜ï¼Œå®ƒä»¬åŠ è½½è¿›å†…å­˜çš„æ—¶æœºæ˜¯ä¸åŒçš„ï¼š\nè¶…çº§å—ï¼šå½“æ–‡ä»¶ç³»ç»ŸæŒ‚è½½æ—¶è¿›å…¥å†…å­˜ï¼› InodeåŒºï¼šå½“æ–‡ä»¶è¢«è®¿é—®æ—¶è¿›å…¥å†…å­˜ï¼› è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ æ–‡ä»¶ç³»ç»Ÿçš„ç§ç±»ä¼—å¤šï¼Œè€Œæ“ä½œç³»ç»Ÿå¸Œæœ›å¯¹ç”¨æˆ·æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œäºæ˜¯åœ¨ç”¨æˆ·å±‚ä¸æ–‡ä»¶ç³»ç»Ÿå±‚å¼•å…¥äº†ä¸­é—´å±‚ï¼Œè¿™ä¸ªä¸­é—´å±‚å°±ç§°ä¸ºè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆVirtual File Systemï¼ŒVFSï¼‰ã€‚VFS å®šä¹‰äº†ä¸€ç»„æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿéƒ½æ”¯æŒçš„æ•°æ®ç»“æ„å’Œæ ‡å‡†æ¥å£ï¼Œè¿™æ ·ç¨‹åºå‘˜ä¸éœ€è¦äº†è§£æ–‡ä»¶ç³»ç»Ÿçš„å·¥ä½œåŸç†ï¼Œåªéœ€è¦äº†è§£ VFS æä¾›çš„ç»Ÿä¸€æ¥å£å³å¯ã€‚åœ¨ Linux æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·ç©ºé—´ã€ç³»ç»Ÿè°ƒç”¨ã€è™šæ‹Ÿæœºæ–‡ä»¶ç³»ç»Ÿã€ç¼“å­˜ã€æ–‡ä»¶ç³»ç»Ÿä»¥åŠå­˜å‚¨ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾ï¼š Linux æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿä¹Ÿä¸å°‘ï¼Œæ ¹æ®å­˜å‚¨ä½ç½®çš„ä¸åŒï¼Œå¯ä»¥æŠŠæ–‡ä»¶ç³»ç»Ÿåˆ†ä¸ºä¸‰ç±»ï¼š\nç£ç›˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ˜¯ç›´æ¥æŠŠæ•°æ®å­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼Œæ¯”å¦‚ Ext 2/3/4ã€XFS ç­‰éƒ½æ˜¯è¿™ç±»æ–‡ä»¶ç³»ç»Ÿã€‚ å†…å­˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™ç±»æ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®ä¸æ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜çš„ï¼Œè€Œæ˜¯å ç”¨å†…å­˜ç©ºé—´ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„/proc å’Œ /sys æ–‡ä»¶ç³»ç»Ÿéƒ½å±äºè¿™ä¸€ç±»ï¼Œè¯»å†™è¿™ç±»æ–‡ä»¶ï¼Œå®é™…ä¸Šæ˜¯è¯»å†™å†…æ ¸ä¸­ç›¸å…³çš„æ•°æ®ã€‚ ç½‘ç»œçš„æ–‡ä»¶ç³»ç»Ÿï¼Œç”¨æ¥è®¿é—®å…¶ä»–è®¡ç®—æœºä¸»æœºæ•°æ®çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚ NFSã€SMB ç­‰ç­‰ã€‚ æ–‡ä»¶ç³»ç»Ÿé¦–å…ˆè¦å…ˆæŒ‚è½½åˆ°æŸä¸ªç›®å½•æ‰å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œæ¯”å¦‚ Linux ç³»ç»Ÿåœ¨å¯åŠ¨æ—¶ï¼Œä¼šæŠŠæ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°æ ¹ç›®å½•ã€‚","title":"æ“ä½œç³»ç»Ÿä¹‹æ–‡ä»¶ç³»ç»Ÿ"},{"content":"ä»€ä¹ˆæ˜¯å†…å­˜ æœ€ç›´è§‚çš„ï¼Œæˆ‘ä»¬ä¹°æ‰‹æœºï¼Œç”µè„‘ï¼Œå†…å­˜æ¡ï¼Œéƒ½ä¼šæ ‡æ˜å†…å­˜æ˜¯å¤šå¤§ï¼Œä¾‹å¦‚é€”ä¸­çš„8Gï¼Œ16Gï¼Œ128Géƒ½æŒ‡çš„å†…å­˜å¤§å°ã€‚ æˆ‘ä»¬åº”è¯¥éƒ½å¬è¯´è¿‡ RAM å­˜å‚¨å™¨ï¼Œå®ƒæ˜¯ä¸€ç§åŠå¯¼ä½“å­˜å‚¨å™¨ä»¶ã€‚RAM æ˜¯è‹±æ–‡å•è¯ Random Access Memory çš„ç¼©å†™ï¼Œå³â€œéšæœºâ€çš„æ„æ€ã€‚æ‰€ä»¥ RAM å­˜å‚¨å™¨ä¹Ÿç§°ä¸ºâ€œéšæœºå­˜å‚¨å™¨â€ã€‚\né‚£ä¹ˆ RAM å­˜å‚¨å™¨å’Œå†…å­˜æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿå†…å­˜å°±æ˜¯è®¸å¤š RAM å­˜å‚¨å™¨çš„é›†åˆï¼Œå°±æ˜¯å°†è®¸å¤š RAM å­˜å‚¨å™¨é›†æˆåœ¨ä¸€èµ·çš„ç”µè·¯æ¿ã€‚RAM å­˜å‚¨å™¨çš„ä¼˜ç‚¹æ˜¯å­˜å–é€Ÿåº¦å¿«ã€è¯»å†™æ–¹ä¾¿ï¼Œæ‰€ä»¥å†…å­˜çš„é€Ÿåº¦å½“ç„¶ä¹Ÿå°±å¿«äº†ã€‚\næ“ä½œç³»ç»Ÿå‘å±•å†å² ç¨å¾®äº†è§£æ“ä½œç³»ç»Ÿå†å²çš„äººï¼Œéƒ½çŸ¥é“æ²¡æœ‰æ“ä½œç³»ç»Ÿçš„è£¸æœº-\u0026gt;ä¸€æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªç¨‹åºçš„å•é“æ‰¹å¤„ç†ç³»ç»Ÿ-\u0026gt;å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿ-\u0026gt;åˆ†æ—¶ç³»ç»Ÿè¿™ä¸ªå‘å±•å†ç¨‹ã€‚\nè£¸æœºæ—¶ä»£ ä¸»è¦æ˜¯äººå·¥æ“ä½œï¼Œç¨‹åºå‘˜å°†å¯¹åº”ç”¨ç¨‹åºå’Œæ•°æ®çš„å·²ç©¿å­”çš„çº¸å¸¦ï¼ˆæˆ–å¡ç‰‡ï¼‰è£…å…¥è¾“å…¥æœºï¼Œç„¶åå¯åŠ¨è¾“å…¥æœºæŠŠç¨‹åºå’Œæ•°æ®è¾“å…¥è®¡ç®—æœºå†…å­˜ï¼Œæ¥ç€é€šè¿‡æ§åˆ¶å°å¼€å…³å¯åŠ¨ç¨‹åºé’ˆå¯¹æ•°æ®è¿è¡Œï¼›è®¡ç®—å®Œæ¯•ï¼Œæ‰“å°æœºè¾“å‡ºè®¡ç®—ç»“æœï¼›ç”¨æˆ·å–èµ°ç»“æœå¹¶å¸ä¸‹çº¸å¸¦ï¼ˆæˆ–å¡ç‰‡ï¼‰åï¼Œæ‰è®©ä¸‹ä¸€ä¸ªç”¨æˆ·ä¸Šæœºã€‚\näººæœºçŸ›ç›¾ï¼šæ‰‹å·¥æ“ä½œçš„æ…¢é€Ÿåº¦å’Œè®¡ç®—æœºçš„é«˜é€Ÿåº¦ä¹‹é—´å½¢æˆäº†å°–é”çŸ›ç›¾ï¼Œæ‰‹å·¥æ“ä½œæ–¹å¼å·²ä¸¥é‡æŸå®³äº†ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡ï¼ˆä½¿èµ„æºåˆ©ç”¨ç‡é™ä¸ºç™¾åˆ†ä¹‹å‡ ï¼Œç”šè‡³æ›´ä½ï¼‰ï¼Œä¸èƒ½å®¹å¿ã€‚å”¯ä¸€çš„è§£å†³åŠæ³•ï¼šåªæœ‰æ‘†è„±äººçš„æ‰‹å·¥æ“ä½œï¼Œå®ç°ä½œä¸šçš„è‡ªåŠ¨è¿‡æ¸¡ã€‚è¿™æ ·å°±å‡ºç°äº†æˆæ‰¹å¤„ç†ã€‚\nå•é“æ‰¹å¤„ç†ç³»ç»Ÿ ç‰¹ç‚¹æ˜¯ä¸€æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œåªæœ‰è¿è¡Œå®Œæ¯•åæ‰èƒ½å°†ä¸‹ä¸€ä¸ªè¿›ç¨‹åŠ è½½åˆ°å†…å­˜é‡Œé¢ï¼Œæ‰€ä»¥è¿›ç¨‹çš„æ•°æ®éƒ½æ˜¯ç›´æ¥æ”¾åœ¨ç‰©ç†å†…å­˜ä¸Šçš„ï¼Œå› æ­¤CPUæ˜¯ç›´æ¥æ“ä½œå†…å­˜çš„ç‰©ç†åœ°å€ï¼Œè¿™ä¸ªæ—¶å€™ä¸å­˜åœ¨è™šæ‹Ÿé€»è¾‘åœ°å€ï¼Œå› ä¸ºä¸€æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªç¨‹åºã€‚\nçŸ›ç›¾ï¼šæ¯æ¬¡ä¸»æœºå†…å­˜ä¸­ä»…å­˜æ”¾ä¸€é“ä½œä¸šï¼Œæ¯å½“å®ƒè¿è¡ŒæœŸé—´å‘å‡ºè¾“å…¥/è¾“å‡ºï¼ˆI/Oï¼‰è¯·æ±‚åï¼Œé«˜é€Ÿçš„CPUä¾¿å¤„äºç­‰å¾…ä½é€Ÿçš„I/Oå®ŒæˆçŠ¶æ€ï¼Œè‡´ä½¿CPUç©ºé—²ã€‚\nå¤šé“æ‰¹å¤„ç†ç³»ç»Ÿ åˆ°åæ¥å‘å±•å‡ºäº†å¤šé“ç¨‹åºç³»ç»Ÿï¼Œå®ƒè¦æ±‚åœ¨è®¡ç®—æœºä¸­å­˜åœ¨ç€å¤šä¸ªè¿›ç¨‹ï¼Œå¤„ç†å™¨éœ€è¦åœ¨å¤šä¸ªè¿›ç¨‹é—´è¿›è¡Œåˆ‡æ¢ï¼Œå½“ä¸€é“ç¨‹åºå› I/Oè¯·æ±‚è€Œæš‚åœè¿è¡Œæ—¶ï¼ŒCPUä¾¿ç«‹å³è½¬å»è¿è¡Œå¦ä¸€é“ç¨‹åºã€‚\né—®é¢˜æ¥äº†ï¼Œè¿™ä¹ˆå¤šè¿›ç¨‹ï¼Œå†…å­˜ä¸å¤Ÿç”¨æ€ä¹ˆåŠï¼Œå„ä¸ªè¿›ç¨‹åŒæ—¶è¿è¡Œæ—¶å†…å­˜åœ°å€äº’ç›¸è¦†ç›–æ€ä¹ˆåŠï¼Ÿ\nè¿™æ—¶å€™å°±å‡ºç°é—®é¢˜äº†ï¼Œé“¾æ¥å™¨åœ¨é“¾æ¥ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™ï¼Œæ€»æ˜¯é»˜è®¤ç¨‹åºçš„èµ·å§‹åœ°å€ä¸º0x0ï¼Œä½†ç‰©ç†å†…å­˜ä¸Šåªæœ‰ä¸€ä¸ª0x0çš„åœ°å€å‘€ï¼Ÿä¹Ÿè®¸ä½ ä¼šè¯´:â€æ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¨‹åºè£…å…¥å†…å­˜çš„æ—¶å€™å†æ¬¡åŠ¨æ€æ”¹å˜å®ƒçš„åœ°å€.â€å¥½å§æˆ‘å¿äº†ã€‚ä½†å¦‚æœæˆ‘çš„ç‰©ç†å†…å­˜å¤§å°åªæœ‰1G,è€Œç°åœ¨æŸä¸€ä¸ªç¨‹åºéœ€è¦è¶…è¿‡1Gçš„ç©ºé—´æ€ä¹ˆåŠå‘¢ï¼Ÿä½ è¿˜èƒ½ç”¨åˆšæ‰é‚£å¥è¯è§£é‡Šå—ï¼Ÿ\næ“ä½œç³»ç»Ÿçš„å‘å±•ï¼ŒåŒ…æ‹¬åé¢çš„åˆ†æ—¶ç³»ç»Ÿï¼Œå…¶å®éƒ½æ˜¯åœ¨è§£å†³åè°ƒå„ä¸ªç¯èŠ‚é€Ÿåº¦ä¸åŒ¹é…çš„çŸ›ç›¾ã€‚\nCPUæ¯”ç£ç›˜é€Ÿåº¦å¿«å¤ªå¤š å­˜å‚¨å™¨å±‚æ¬¡ä¹‹é—´çš„ä½œç”¨å’Œå…³è”ä¸ºé‡‘å­—å¡”å½¢çŠ¶ï¼ŒCPUä¸å¯ä»¥ç›´æ¥æ“æ§ç£ç›˜ï¼Œæ˜¯é€šè¿‡æ“æ§å†…å­˜æ¥è¿›è¡Œå·¥ä½œçš„ï¼Œå› ä¸ºç£ç›˜çš„é€Ÿåº¦è¿œè¿œå°äºCPUçš„é€Ÿåº¦ï¼Œè·Ÿä¸ä¸Šï¼Œéœ€è¦ä¸­é—´çš„å†…å­˜å±‚è¿›è¡Œç¼“å†²ã€‚\nå†…å­˜é€Ÿåº¦æ¯”ç¡¬ç›˜é€Ÿåº¦å¿«çš„åŸç†: å†…å­˜çš„é€Ÿåº¦ä¹‹æ‰€ä»¥æ¯”ç¡¬ç›˜çš„é€Ÿåº¦å¿«ï¼ˆä¸æ˜¯å¿«ä¸€ç‚¹ï¼Œè€Œæ˜¯å¿«å¾ˆå¤šï¼‰ï¼Œæ˜¯å› ä¸ºå®ƒä»¬çš„å­˜å‚¨åŸç†å’Œè¯»å–æ–¹å¼ä¸ä¸€æ ·ã€‚\nç¡¬ç›˜æ˜¯æœºæ¢°ç»“æ„ï¼Œé€šè¿‡ç£å¤´çš„è½¬åŠ¨è¯»å–æ•°æ®ã€‚ä¸€èˆ¬æƒ…å†µä¸‹å°å¼æœºçš„ç¡¬ç›˜ä¸ºæ¯åˆ†é’Ÿ 7200 è½¬ï¼Œè€Œç¬”è®°æœ¬çš„ç¡¬ç›˜ä¸ºæ¯åˆ†é’Ÿ 5400 è½¬ã€‚ è€Œå†…å­˜æ˜¯æ²¡æœ‰æœºæ¢°ç»“æ„çš„ï¼Œå†…å­˜æ˜¯é€šè¿‡ç”µå­˜å–æ•°æ®çš„ã€‚\nå†…å­˜é€šè¿‡ç”µå­˜å–æ•°æ®ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å› ä¸º RAM å­˜å‚¨å™¨æ˜¯é€šè¿‡ç”µå­˜å‚¨æ•°æ®çš„ã€‚ä½†ä¹Ÿæ­£å› ä¸ºå®ƒä»¬æ˜¯é€šè¿‡ç”µå­˜å‚¨æ•°æ®çš„ï¼Œæ‰€ä»¥ä¸€æ—¦æ–­ç”µæ•°æ®å°±éƒ½ä¸¢å¤±äº†ã€‚å› æ­¤å†…å­˜åªæ˜¯ä¾›æ•°æ®æš‚æ—¶é€—ç•™çš„ç©ºé—´ï¼Œè€Œç¡¬ç›˜æ˜¯æ°¸ä¹…çš„ï¼Œæ–­ç”µåæ•°æ®ä¹Ÿä¸ä¼šæ¶ˆå¤±ã€‚\nå°ç»“ï¼šç¨‹åºæ‰§è¡Œå‰éœ€è¦å…ˆæ”¾åˆ°å†…å­˜ä¸­æ‰èƒ½è¢«CPUå¤„ç†ï¼Œå› æ­¤å†…å­˜çš„ä¸»è¦ä½œç”¨å°±æ˜¯ç¼“å’ŒCPUä¸ç¡¬ç›˜ä¹‹é—´çš„é€Ÿåº¦çŸ›ç›¾ã€‚\nç¨‹åºè¿è¡Œè¿‡ç¨‹ åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ï¼Œç³»ç»Ÿä¸­ä¼šæœ‰å¤šä¸ªç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šæœ‰å¤šä¸ªç¨‹åºçš„æ•°æ®éœ€è¦åŒæ—¶æ”¾åˆ°å†…å­˜ä¸­ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•åŒºåˆ†å„ä¸ªç¨‹åºçš„æ•°æ®æ˜¯æ”¾åœ¨ä»€ä¹ˆåœ°æ–¹çš„å‘¢?\næ–¹æ¡ˆ: ç»™å†…å­˜çš„å­˜å‚¨å•å…ƒç¼–åœ°å€ã€‚ ç¨‹åºè¿è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š ç¼–è¯‘: æŠŠé«˜çº§è¯­è¨€ç¿»è¯‘ä¸ºæœºå™¨è¯­è¨€ï¼›\né“¾æ¥: ç”±é“¾æ¥ç¨‹åºå°†ç¼–è¯‘åå½¢æˆçš„ä¸€ç»„ç›®æ ‡æ¨¡å—ï¼Œä»¥åŠæ‰€éœ€åº“å‡½æ•°é“¾æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„è£…å…¥æ¨¡å—ï¼›\nè£…å…¥(è£…è½½): ç”±è£…å…¥ç¨‹åºå°†è£…å…¥æ¨¡å—è£…å…¥å†…å­˜è¿è¡Œï¼› ä¸‰ç§é“¾æ¥æ–¹å¼ é™æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡Œä¹‹å‰ï¼Œå…ˆå°†å„ç›®æ ‡æ¨¡å—åŠå®ƒä»¬æ‰€éœ€çš„åº“å‡½æ•°é“¾æ¥æˆä¸€ä¸ªå®Œæ•´çš„å¯æ‰§è¡Œæ–‡ä»¶(è£…å…¥æ¨¡å—)ï¼Œå³å¾—åˆ°å®Œæ•´çš„é€»è¾‘åœ°å€ï¼Œä¹‹åä¸å†æ‹†å¼€ã€‚ è£…å…¥æ—¶åŠ¨æ€é“¾æ¥ è¿è¡Œå‰è¾¹è£…å…¥è¾¹é“¾æ¥çš„é“¾æ¥æ–¹å¼ã€‚ è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥ è¿è¡Œæ—¶è¯¥ç›®æ ‡æ¨¡å—æ—¶ï¼Œæ‰å¯¹å®ƒè¿›è¡Œé“¾æ¥ï¼Œç”¨ä¸åˆ°çš„æ¨¡å—ä¸éœ€è¦è£…å…¥å†…å­˜ã€‚å…¶ä¼˜ç‚¹æ˜¯ä¾¿äºä¿®æ”¹å’Œæ›´æ–°ï¼Œä¾¿äºå®ç°å¯¹ç›®æ ‡æ¨¡å—çš„å…±äº«ã€‚ å¯ä»¥çœ‹åˆ°è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥ï¼Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ¨¡å—å…¨éƒ¨è£…å…¥å†…å­˜ï¼Œå¯ä»¥ç­‰åˆ°è¿è¡Œæ—¶éœ€è¦çš„æ—¶å€™å†åŠ¨æ€çš„è¿æ¥è¿›å»ï¼Œè¿™æ ·ä¸€æ¥å°±å°±æä¾›äº†å†…å­˜ä¸å¤Ÿç”¨çš„é—®é¢˜çš„è§£å†³æ€è·¯ï¼Œè¿˜å¯ä»¥è¿™æ ·ï¼Œç”¨åˆ°äº†å†é“¾æ¥è¿›å»\nä¸‰ç§è£…å…¥æ–¹å¼ ç»å¯¹è£…å…¥ ç¼–è¯‘æˆ–æ±‡ç¼–æ—¶å¾—åˆ°ç»å¯¹åœ°å€ï¼Œå³å†…å­˜ç‰©ç†åœ°å€ï¼Œç›´æ¥å­˜åˆ°å¯¹åº”çš„ç‰©ç†åœ°å€ã€‚ å•é“å¤„ç†ç³»ç»Ÿå°±æ˜¯ç›´æ¥æ“ä½œç‰©ç†åœ°å€ï¼Œå› æ­¤ç»å¯¹è£…å…¥åªé€‚ç”¨äºå•é“ç¨‹åºç¯å¢ƒã€‚\né™æ€é‡å®šä½è£…å…¥ åˆç§°å¯é‡å®šä½è£…å…¥ï¼Œè¿™é‡Œå¼•å…¥é€»è¾‘åœ°å€ï¼Œè£…å…¥æ—¶å°†é€»è¾‘åœ°å€é‡å®šä½è½¬åŒ–ä¸ºç‰©ç†åœ°å€ï¼Œå¤šé“æ‰¹å¤„ç†ç³»ç»Ÿçš„ä½¿ç”¨æ–¹å¼ã€‚ é™æ€é‡å®šä½çš„ç‰¹ç‚¹æ˜¯åœ¨ä¸€ä¸ªä½œä¸šè£…å…¥å†…å­˜æ—¶ï¼Œå¿…é¡»åˆ†é…å…¶è¦æ±‚çš„å…¨éƒ¨å†…å­˜ç©ºé—´ï¼Œå¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œå°±ä¸èƒ½è£…å…¥è¯¥ä½œä¸šã€‚ä½œä¸šä¸€æ—¦è¿›å…¥å†…å­˜åï¼Œåœ¨è¿è¡ŒæœŸé—´å°±ä¸èƒ½å†ç§»åŠ¨ï¼Œä¹Ÿä¸èƒ½å†ç”³è¯·å†…å­˜ç©ºé—´ã€‚\nåŠ¨æ€é‡å®šä½è£…å…¥ åˆç§°åŠ¨æ€è¿è¡Œæ—¶è£…å…¥ï¼Œè¿è¡Œæ—¶å°†é€»è¾‘åœ°å€é‡å®šä½è½¬åŒ–ä¸ºç‰©ç†åœ°å€ï¼Œè¿™ç§æ–¹å¼éœ€è¦ä¸€ä¸ªé‡å®šä½å¯„å­˜å™¨çš„æ”¯æŒï¼Œå½“ç„¶ç°ä»£æ“ä½œç³»ç»Ÿä½¿ç”¨çš„éƒ½æ˜¯è¿™ç§ã€‚\né€»è¾‘åœ°å€éƒ½æ˜¯ä»0å¼€å§‹çš„ï¼Œå‡è®¾è£…å…¥çš„èµ·å§‹ç‰©ç†åœ°å€ä¸º100ï¼ŒåŠ¨æ€é‡å®šä½è£…å…¥å¦‚ä¸‹å›¾ï¼š å†…å­˜ç®¡ç†çš„èŒè´£ å†…å­˜ç®¡ç†çš„æ¦‚å¿µï¼ŒåŒ…å«ä¸‰éƒ¨åˆ†:\n1 å†…å­˜ç©ºé—´çš„åˆ†é…å’Œå›æ”¶ 2 å†…å­˜ç©ºé—´çš„æ‰©å…… 3 åœ°å€è½¬åŒ– 4 å­˜å‚¨ä¿æŠ¤ å†…å­˜ç©ºé—´çš„åˆ†é…å’Œå›æ”¶ - è¿ç»­å†…å­˜ç®¡ç†æ–¹å¼ å•ä¸€è¿ç»­åˆ†é…æ–¹å¼ å›ºå®šåˆ†åŒºåˆ†é… åŠ¨æ€åˆ†åŒºåˆ†é… å•ä¸€è¿ç»­åˆ†é…æ–¹å¼ åœ¨å•ä¸€è¿ç»­åˆ†é…æ–¹å¼ä¸­ï¼Œå†…å­˜è¢«åˆ†ä¸ºç³»ç»ŸåŒºå’Œç”¨æˆ·åŒºã€‚ç³»ç»ŸåŒºé€šå¸¸ä½äºå†…å­˜çš„ä½åœ°å€éƒ¨åˆ†ï¼Œç”¨äºå­˜æ”¾æ“ä½œç³»ç»Ÿç›¸å…³æ•°æ®;ç”¨æˆ·åŒºç”¨äºå­˜æ”¾ç”¨æˆ·è¿›ç¨‹ç›¸å…³æ•°æ®ã€‚å†…å­˜ä¸­åªèƒ½æœ‰ä¸€é“ç”¨æˆ·ç¨‹åºï¼Œç”¨æˆ·ç¨‹åºç‹¬å æ•´ä¸ªç”¨æˆ·åŒºç©ºé—´ã€‚\nä¼˜ç‚¹:å®ç°ç®€å•;æ— å¤–éƒ¨ç¢ç‰‡;\nç¼ºç‚¹:åªèƒ½ç”¨äºå•ç”¨æˆ·ã€å•ä»»åŠ¡çš„æ“ä½œç³»ç»Ÿä¸­;æœ‰å†…éƒ¨ç¢ç‰‡;å­˜å‚¨å™¨åˆ©ç”¨ç‡æä½ã€‚ å›ºå®šåˆ†åŒºåˆ†é… å°†æ•´ä¸ªç”¨æˆ·ç©ºé—´åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå›ºå®šå¤§å°çš„åˆ†åŒºï¼Œåœ¨æ¯ä¸ªåˆ†åŒºä¸­åªè£…å…¥ä¸€é“ä½œä¸šï¼Œè¿™æ ·å°±å½¢æˆäº†æœ€æ—©çš„ã€æœ€ç®€å•çš„ä¸€ç§å¯è¿è¡Œå¤šé“ç¨‹åºçš„å†…å­˜ç®¡ç†æ–¹å¼ã€‚\næ“ä½œç³»ç»Ÿéœ€è¦å»ºç«‹ä¸€ä¸ªæ•°æ®ç»“æ„â€”â€”åˆ†åŒºè¯´æ˜è¡¨ï¼Œæ¥å®ç°å„ä¸ªåˆ†åŒºçš„åˆ†é…ä¸å›æ”¶ã€‚æ¯ä¸ªè¡¨é¡¹å¯¹åº”ä¸€ä¸ªåˆ†åŒºï¼Œé€šå¸¸æŒ‰åˆ†åŒºå¤§å°æ’åˆ—ã€‚æ¯ä¸ªè¡¨é¡¹åŒ…æ‹¬å¯¹åº”åˆ†åŒºçš„ å¤§å°ã€èµ·å§‹åœ°å€ã€çŠ¶æ€(æ˜¯å¦å·²åˆ†é…)ï¼Œ\nå½“æŸç”¨æˆ·ç¨‹åºè¦è£…å…¥å†…å­˜æ—¶ï¼Œç”±æ“ä½œç³»ç»Ÿå†…æ ¸ç¨‹åºæ ¹æ®ç”¨æˆ·ç¨‹åºå¤§å°æ£€ç´¢è¯¥è¡¨ï¼Œä»ä¸­æ‰¾åˆ°ä¸€ä¸ªèƒ½æ»¡è¶³å¤§å°çš„ã€æœªåˆ†é…çš„åˆ†åŒºï¼Œå°†ä¹‹åˆ†é…ç»™è¯¥ç¨‹åºï¼Œç„¶åä¿®æ”¹çŠ¶æ€ä¸ºâ€œå·²åˆ†é…â€ã€‚\nä¼˜ç‚¹: å®ç°ç®€å•ï¼Œæ— å¤–éƒ¨ç¢ç‰‡ã€‚\nç¼ºç‚¹: ä¼šäº§ç”Ÿå†…éƒ¨ç¢ç‰‡ï¼Œå†…å­˜åˆ©ç”¨ç‡ä½ã€‚\nåŠ¨æ€åˆ†åŒºåˆ†é… åŠ¨æ€åˆ†åŒºåˆ†é…åˆç§°ä¸ºå¯å˜åˆ†åŒºåˆ†é…ã€‚è¿™ç§åˆ†é…æ–¹å¼ä¸ä¼šé¢„å…ˆåˆ’åˆ†å†…å­˜åˆ†åŒºï¼Œè€Œæ˜¯åœ¨è¿›ç¨‹è£…å…¥å†…å­˜æ—¶ï¼Œ æ ¹æ®è¿›ç¨‹çš„å¤§å°åŠ¨æ€åœ°å»ºç«‹åˆ†åŒºï¼Œå¹¶ä½¿åˆ†åŒºçš„å¤§å°æ­£å¥½é€‚åˆè¿›ç¨‹çš„éœ€è¦ã€‚å› æ­¤ç³»ç»Ÿåˆ†åŒºçš„å¤§å°å’Œæ•° ç›®æ˜¯å¯å˜çš„ã€‚(eg:å‡è®¾æŸè®¡ç®—æœºå†…å­˜å¤§å°ä¸º 64MBï¼Œç³»ç»ŸåŒº 8MBï¼Œç”¨æˆ·åŒºå…± 56 MB\u0026hellip;)\näº§ç”Ÿä¸‰ä¸ªé—®é¢˜ï¼š\nç³»ç»Ÿè¦ç”¨ä»€ä¹ˆæ ·çš„æ•°æ®ç»“æ„è®°å½•å†… å­˜çš„ä½¿ç”¨æƒ…å†µ? ï¼ˆå¸¸ç”¨çš„ ç©ºé—²åˆ†åŒºè¡¨å’Œç©ºé—²åˆ†åŒºé“¾ï¼‰ å½“å¾ˆå¤šä¸ªç©ºé—²åˆ†åŒºéƒ½èƒ½æ»¡è¶³éœ€æ±‚æ—¶ï¼Œ åº”è¯¥é€‰æ‹©å“ªä¸ªåˆ†åŒºè¿›è¡Œåˆ†é…? å¦‚ä½•è¿›è¡Œåˆ†åŒºçš„åˆ†é…ä¸å›æ”¶æ“ä½œ? åŠ¨æ€åˆ†åŒºåˆ†é…åˆç§°ä¸ºå¯å˜åˆ†åŒºåˆ†é…ã€‚è¿™ç§åˆ†é…æ–¹å¼ä¸ä¼šé¢„å…ˆåˆ’åˆ†å†…å­˜åˆ†åŒºï¼Œè€Œæ˜¯åœ¨è¿›ç¨‹è£…å…¥å†…å­˜æ—¶ï¼Œæ ¹æ®è¿›ç¨‹çš„å¤§å°åŠ¨æ€åœ°å»ºç«‹åˆ†åŒºï¼Œå¹¶ä½¿åˆ†åŒºçš„å¤§å°æ­£å¥½é€‚åˆè¿›ç¨‹çš„éœ€è¦ã€‚å› æ­¤ç³»ç»Ÿåˆ†åŒºçš„å¤§å°å’Œæ•°ç›®æ˜¯å¯å˜çš„ã€‚\nç¼ºç‚¹ï¼šåŠ¨æ€åˆ†åŒºåˆ†é…æ²¡æœ‰å†…éƒ¨ç¢ç‰‡ï¼Œä½†æ˜¯æœ‰å¤–éƒ¨ç¢ç‰‡ã€‚\nå†…éƒ¨ç¢ç‰‡:åˆ†é…ç»™æŸè¿›ç¨‹çš„å†…å­˜åŒºåŸŸä¸­ï¼Œæœ‰äº›éƒ¨åˆ†æ²¡æœ‰ç”¨ä¸Šã€‚ å¤–éƒ¨ç¢ç‰‡:æ˜¯æŒ‡å†…å­˜ä¸­çš„æŸäº›ç©ºé—²åˆ†åŒºç”±äºå¤ªå°è€Œéš¾ä»¥åˆ©ç”¨ã€‚\nå¦‚æœå†…å­˜ä¸­ç©ºé—²ç©ºé—´çš„æ€»å’Œæœ¬æ¥å¯ä»¥æ»¡è¶³æŸè¿›ç¨‹çš„è¦æ±‚ï¼Œ ä½†ç”±äºè¿›ç¨‹éœ€è¦çš„æ˜¯ä¸€æ•´å—è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤è¿™äº› â€œç¢ç‰‡â€ä¸èƒ½æ»¡è¶³è¿›ç¨‹çš„éœ€æ±‚ã€‚ å¯ä»¥é€šè¿‡ç´§å‡‘(æ‹¼å‡‘ï¼ŒCompaction)æŠ€æœ¯æ¥è§£å†³å¤–éƒ¨ç¢ç‰‡ã€‚ åŠ¨æ€åˆ†åŒºåˆ†é…ç®—æ³• é¦–æ¬¡é€‚åº”ç®—æ³•: æ¯æ¬¡éƒ½ä»ä½åœ°å€å¼€å§‹æŸ¥æ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªèƒ½æ»¡è¶³å¤§å°çš„ç©ºé—²åˆ†åŒº\næœ€ä½³é€‚åº”ç®—æ³•ï¼šç”±äºåŠ¨æ€åˆ†åŒºåˆ†é…æ˜¯ä¸€ç§è¿ç»­åˆ†é…æ–¹å¼ï¼Œä¸ºå„è¿›ç¨‹åˆ†é…çš„ç©ºé—´å¿…é¡»æ˜¯è¿ç»­çš„ä¸€æ•´ç‰‡åŒºåŸŸã€‚å› æ­¤ä¸ºäº†ä¿è¯å½“â€œå¤§è¿›ç¨‹â€åˆ°æ¥æ—¶èƒ½æœ‰è¿ç»­çš„å¤§ç‰‡ç©ºé—´ï¼Œå¯ä»¥å°½å¯èƒ½å¤šåœ°ç•™ä¸‹å¤§ç‰‡çš„ç©ºé—²åŒºï¼Œå³ï¼Œä¼˜å…ˆä½¿ç”¨æ›´å°çš„ç©ºé—²åŒº\næœ€åé€‚åº”ç®—æ³•ï¼šä¸ºäº†è§£å†³æœ€ä½³é€‚åº”ç®—æ³•çš„é—®é¢˜â€”â€”å³ç•™ä¸‹å¤ªå¤šéš¾ä»¥åˆ©ç”¨çš„å°ç¢ç‰‡ï¼Œå¯ä»¥åœ¨æ¯æ¬¡åˆ†é…æ—¶ ä¼˜å…ˆä½¿ç”¨æœ€å¤§çš„è¿ç»­ç©ºé—²åŒºï¼Œè¿™æ ·åˆ†é…åå‰©ä½™çš„ç©ºé—²åŒºå°±ä¸ä¼šå¤ªå°ï¼Œæ›´æ–¹ä¾¿ä½¿ç”¨\né‚»è¿‘é€‚åº”ç®—æ³•ï¼šé¦–æ¬¡é€‚åº”ç®—æ³•æ¯æ¬¡éƒ½ä»é“¾å¤´å¼€å§‹æŸ¥æ‰¾çš„ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ä½åœ°å€éƒ¨åˆ†å‡ºç°å¾ˆå¤šå°çš„ç©ºé—²åˆ†åŒºï¼Œè€Œæ¯æ¬¡åˆ†é…æŸ¥æ‰¾æ—¶ï¼Œéƒ½è¦ç»è¿‡è¿™äº›åˆ†åŒºï¼Œå› æ­¤ä¹Ÿå¢åŠ äº†æŸ¥æ‰¾çš„å¼€é”€ã€‚å¦‚æœæ¯æ¬¡éƒ½ä»ä¸Šæ¬¡æŸ¥æ‰¾ç»“æŸçš„ä½ç½®å¼€å§‹æ£€ç´¢ï¼Œå°±èƒ½è§£å†³ä¸Šè¿°é—®é¢˜ã€‚ å†…å­˜ç©ºé—´çš„åˆ†é…ä¸å›æ”¶ - éè¿ç»­åˆ†é…ç®¡ç†æ–¹å¼ è¿ç»­åˆ†é…:ä¸ºç”¨æˆ·è¿›ç¨‹åˆ†é…çš„å¿…é¡»æ˜¯ä¸€ä¸ªè¿ç»­çš„å†…å­˜ç©ºé—´ã€‚ éè¿ç»­åˆ†é…:ä¸ºç”¨æˆ·è¿›ç¨‹åˆ†é…çš„å¯ä»¥æ˜¯ä¸€äº›åˆ†æ•£çš„å†…å­˜ç©ºé—´ã€‚\nåŸºæœ¬åˆ†é¡µå­˜å‚¨ç®¡ç† åŸºæœ¬åˆ†æ®µå­˜å‚¨ç®¡ç† æ®µé¡µå¼å­˜å‚¨ç®¡ç† åˆ†é¡µ-ä»€ä¹ˆæ˜¯åŸºæœ¬åˆ†é¡µå­˜å‚¨ å°†å†…å­˜ç©ºé—´åˆ†ä¸ºä¸€ä¸ªä¸ªå¤§å°ç›¸ç­‰çš„åˆ†åŒº(æ¯”å¦‚:æ¯ä¸ªåˆ†åŒº 4KB)ï¼Œæ¯ä¸ªåˆ†åŒºå°±æ˜¯ä¸€ä¸ªâ€œé¡µæ¡†â€(é¡µæ¡†=é¡µå¸§=å†…å­˜å—=ç‰©ç†å—=ç‰©ç†é¡µé¢)ã€‚æ¯ä¸ªé¡µæ¡†æœ‰ä¸€ä¸ªç¼–å·ï¼Œå³â€œé¡µæ¡†å·â€(é¡µæ¡†å·=é¡µå¸§å·=å†…å­˜å—å·=ç‰©ç†å—å·=ç‰©ç†é¡µå·)ï¼Œé¡µæ¡†å·ä»0å¼€å§‹ã€‚ å°†è¿›ç¨‹çš„é€»è¾‘åœ°å€ç©ºé—´ä¹Ÿåˆ†ä¸ºä¸é¡µæ¡†å¤§å°ç›¸ç­‰çš„ä¸€ä¸ªä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†ç§°ä¸ºä¸€ä¸ªâ€œé¡µâ€æˆ–â€œé¡µé¢â€ ã€‚æ¯ä¸ªé¡µé¢ä¹Ÿæœ‰ä¸€ä¸ªç¼–å·ï¼Œå³â€œé¡µå·â€ï¼Œé¡µå·ä¹Ÿæ˜¯ä»0å¼€å§‹ã€‚\næ“ä½œç³»ç»Ÿä»¥é¡µæ¡†ä¸ºå•ä½ä¸ºå„ä¸ªè¿›ç¨‹åˆ†é…å†…å­˜ç©ºé—´ã€‚è¿›ç¨‹çš„æ¯ä¸ªé¡µé¢åˆ†åˆ«æ”¾å…¥ä¸€ä¸ªé¡µæ¡†ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿›ç¨‹çš„é¡µé¢ä¸å†…å­˜çš„é¡µæ¡†æœ‰ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚å„ä¸ªé¡µé¢ä¸å¿…è¿ç»­å­˜æ”¾ï¼Œå¯ä»¥æ”¾åˆ°ä¸ç›¸é‚»çš„å„ä¸ªé¡µæ¡†ä¸­ã€‚\næ³¨: è¿›ç¨‹çš„æœ€åä¸€ä¸ªé¡µé¢å¯èƒ½æ²¡æœ‰ä¸€ä¸ªé¡µæ¡†é‚£ä¹ˆå¤§ã€‚ä¹Ÿå°±æ˜¯ç¬¬ 16K-1 å†…å­˜ï¼Œåˆ†é¡µå­˜å‚¨æœ‰å¯èƒ½äº§ç”Ÿå†…éƒ¨ç¢ç‰‡ï¼Œå› æ­¤é¡µæ¡†ä¸èƒ½å¤ªå¤§ï¼Œå¦åˆ™å¯èƒ½äº§ç”Ÿè¿‡å¤§çš„å†…éƒ¨ç¢ç‰‡é€ æˆæµªè´¹ã€‚\nåˆ†é¡µ-é¡µè¡¨ ä¸ºäº†èƒ½çŸ¥é“è¿›ç¨‹çš„æ¯ä¸ªé¡µé¢åœ¨å†…å­˜ä¸­å­˜æ”¾çš„ä½ç½®ï¼Œæ“ä½œç³»ç»Ÿè¦ä¸ºæ¯ä¸ªè¿›ç¨‹å»ºç«‹ä¸€å¼ é¡µè¡¨ï¼Œé¡µè¡¨é€šå¸¸å­˜åœ¨PCB(è¿›ç¨‹æ§åˆ¶å—)ä¸­ã€‚ åˆ†é¡µ-åˆ†é¡µä¹‹åçš„åœ°å€è½¬æ¢ é¡µå· = é€»è¾‘åœ°å€ / é¡µé¢é•¿åº¦ (å–é™¤æ³•çš„æ•´æ•°éƒ¨åˆ†) é¡µå†…åç§»é‡ = é€»è¾‘åœ°å€ % é¡µé¢é•¿åº¦(å–é™¤æ³•çš„ä½™æ•°éƒ¨åˆ†)\nå¦‚ä½•å®ç°åœ°å€è½¬æ¢:\nè®¡ç®—å‡ºé€»è¾‘åœ°å€å¯¹åº”çš„ é€»è¾‘é¡µå·å’Œé€»è¾‘é¡µå†…åç§»é‡ æŸ¥é¡µè¡¨ï¼Œ æ‰¾åˆ°å¯¹åº”é¡µé¢åœ¨ç‰©ç†å†…å­˜çš„ä½ç½® - é¡µæ¡†(å†…å­˜å—) ç‰©ç†åœ°å€ = ç‰©ç†å†…å­˜å—åœ°å€ + ä¸šå†…åç§»é‡ åŸºæœ¬åœ°å€å˜æ¢ åŸºæœ¬åœ°å€å˜æ¢æœºæ„å¯ä»¥å€ŸåŠ©è¿›ç¨‹çš„é¡µè¡¨å°†é€»è¾‘åœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ã€‚ é€šå¸¸ä¼šåœ¨ç³»ç»Ÿä¸­è®¾ç½®ä¸€ä¸ªé¡µè¡¨å¯„å­˜å™¨(PTR)ï¼Œå­˜æ”¾é¡µè¡¨åœ¨å†…å­˜ä¸­çš„èµ·å§‹åœ°å€F å’Œé¡µè¡¨é•¿åº¦Mã€‚ è¿›ç¨‹æœªæ‰§è¡Œæ—¶ï¼Œé¡µè¡¨çš„å§‹å€ å’Œ é¡µè¡¨é•¿åº¦ æ”¾åœ¨è¿›ç¨‹æ§åˆ¶å—(PCB)ä¸­ï¼Œå½“è¿›ç¨‹è¢«è°ƒåº¦æ—¶ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸ä¼šæŠŠå®ƒä»¬æ”¾åˆ°é¡µè¡¨å¯„å­˜å™¨ä¸­ã€‚\nå¿«è¡¨åœ°å€å˜æ¢ å¿«è¡¨ï¼Œåˆç§°è”æƒ³å¯„å­˜å™¨(TLBï¼Œ translation lookaside buffer )ï¼Œæ˜¯ä¸€ç§è®¿é—®é€Ÿåº¦æ¯”å†…å­˜å¿«å¾ˆå¤šçš„é«˜é€Ÿç¼“å­˜(TLBä¸æ˜¯å†…å­˜!)ï¼Œç”¨æ¥å­˜æ”¾æœ€è¿‘è®¿é—®çš„é¡µè¡¨é¡¹çš„å‰¯æœ¬ï¼Œå¯ä»¥åŠ é€Ÿåœ°å€å˜æ¢çš„é€Ÿåº¦ã€‚ä¸æ­¤å¯¹åº”ï¼Œå†…å­˜ä¸­çš„é¡µè¡¨å¸¸ç§°ä¸ºæ…¢è¡¨ã€‚\næ³¨ï¼šTLB å’Œ æ™®é€š Cache çš„åŒºåˆ«â€”â€”TLB ä¸­åªæœ‰é¡µè¡¨é¡¹çš„å‰¯æœ¬ï¼Œè€Œæ™®é€š Cache ä¸­å¯èƒ½ä¼šæœ‰å…¶ä»–å„ç§æ•°æ®çš„å‰¯æœ¬ å¿«è¡¨å¿«å¤šå°‘ï¼Ÿ ä¾‹:æŸç³»ç»Ÿä½¿ç”¨åŸºæœ¬åˆ†é¡µå­˜å‚¨ç®¡ç†ï¼Œå¹¶é‡‡ç”¨äº†å…·æœ‰å¿«è¡¨çš„åœ°å€å˜æ¢æœºæ„ã€‚è®¿é—®ä¸€æ¬¡å¿«è¡¨è€—æ—¶ 1usï¼Œè®¿é—®ä¸€æ¬¡å†…å­˜è€—æ—¶ 100usã€‚è‹¥å¿«è¡¨çš„å‘½ä¸­ç‡ä¸º 90%ï¼Œé‚£ä¹ˆè®¿é—®ä¸€ä¸ªé€»è¾‘åœ°å€çš„å¹³å‡è€—æ—¶æ˜¯å¤šå°‘? (1+100) * 0.9 + (1+100+100) * 0.1 = 111 us\næœ‰çš„ç³»ç»Ÿæ”¯æŒå¿«è¡¨å’Œæ…¢è¡¨åŒæ—¶æŸ¥æ‰¾ï¼Œå¦‚æœæ˜¯è¿™æ ·ï¼Œå¹³å‡è€—æ—¶åº”è¯¥æ˜¯ (1+100) * 0.9 + (100+100) * 0.1 = 110.9 us\nè‹¥æœªé‡‡ç”¨å¿«è¡¨æœºåˆ¶ï¼Œåˆ™è®¿é—®ä¸€ä¸ªé€»è¾‘åœ°å€éœ€è¦ 100+100 = 200us æ˜¾ç„¶ï¼Œå¼•å…¥å¿«è¡¨æœºåˆ¶åï¼Œè®¿é—®ä¸€ä¸ªé€»è¾‘åœ°å€çš„é€Ÿåº¦å¿«å¤šäº†ã€‚\nåˆ†é¡µ-ä¸¤çº§é¡µè¡¨ å•çº§é¡µè¡¨çš„é—®é¢˜ï¼š é—®é¢˜ä¸€: æ ¹æ®é¡µå·æŸ¥è¯¢é¡µè¡¨çš„æ–¹æ³•:K å·é¡µå¯¹åº”çš„é¡µè¡¨é¡¹å­˜æ”¾ä½ç½® = é¡µè¡¨å§‹å€ + K * 4 ï¼Œé¡µè¡¨å¿…é¡»è¿ç»­å­˜æ”¾ï¼Œå› æ­¤å½“é¡µè¡¨å¾ˆå¤§æ—¶ï¼Œéœ€è¦å ç”¨å¾ˆå¤šä¸ªè¿ç»­çš„é¡µæ¡†ï¼›\né—®é¢˜äºŒ:æ²¡æœ‰å¿…è¦è®©æ•´ä¸ªé¡µè¡¨å¸¸é©»å†…å­˜ï¼Œå› ä¸ºè¿›ç¨‹åœ¨ä¸€æ®µæ—¶é—´å†…å¯èƒ½åªéœ€è¦è®¿é—®æŸå‡ ä¸ªç‰¹å®šçš„é¡µé¢ã€‚\nè§£å†³åŠæ³•ï¼šæŠŠé¡µè¡¨å†åˆ†é¡µå¹¶ç¦»æ•£å­˜å‚¨ï¼Œç„¶åå†å»ºç«‹ä¸€å¼ é¡µè¡¨è®°å½•é¡µè¡¨å„ä¸ªéƒ¨åˆ†çš„å­˜æ”¾ä½ç½®ï¼Œç§°ä¸ºé¡µç›®å½•è¡¨ï¼Œæˆ–ç§°å¤–å±‚é¡µè¡¨ï¼Œæˆ–ç§°é¡¶å±‚é¡µè¡¨ã€‚ åˆ†é¡µ-å¤šçº§é¡µè¡¨ åˆ†æ®µ-ä»€ä¹ˆæ˜¯åˆ†æ®µ è¿›ç¨‹çš„åœ°å€ç©ºé—´:æŒ‰ç…§ç¨‹åºè‡ªèº«çš„é€»è¾‘å…³ç³»åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæ®µï¼Œæ¯ä¸ªæ®µéƒ½æœ‰ä¸€ä¸ªæ®µå(åœ¨ä½çº§è¯­è¨€ ä¸­ï¼Œç¨‹åºå‘˜ä½¿ç”¨æ®µåæ¥ç¼–ç¨‹)ï¼Œæ¯æ®µä»0å¼€å§‹ç¼–å€ã€‚\nå†…å­˜åˆ†é…è§„åˆ™: ä»¥æ®µä¸ºå•ä½è¿›è¡Œåˆ†é…ï¼Œæ¯ä¸ªæ®µåœ¨å†…å­˜ä¸­å æ®è¿ç»­ç©ºé—´ï¼Œä½†å„æ®µä¹‹é—´å¯ä»¥ä¸ç›¸é‚»ã€‚ åˆ†æ®µ-æ®µè¡¨ åˆ†æ®µ-åœ°å€è½¬æ¢ åˆ†æ®µ VS åˆ†é¡µ 1.1 é¡µæ˜¯ä¿¡æ¯çš„ç‰©ç†å•ä½ã€‚åˆ†é¡µçš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å®ç°ç¦»æ•£åˆ†é…ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡ã€‚åˆ†é¡µä»…ä»…æ˜¯ç³»ç»Ÿç®¡ç†ä¸Šçš„éœ€è¦ï¼Œå®Œå…¨æ˜¯ç³»ç»Ÿè¡Œä¸ºï¼Œå¯¹ç”¨æˆ·æ˜¯ä¸å¯è§çš„ã€‚ 1.2 æ®µæ˜¯ä¿¡æ¯çš„é€»è¾‘å•ä½ã€‚åˆ†æ®µçš„ä¸»è¦ç›®çš„æ˜¯æ›´å¥½åœ°æ»¡è¶³ç”¨æˆ·éœ€æ±‚ã€‚ä¸€ä¸ªæ®µé€šå¸¸åŒ…å«ç€ä¸€ç»„å±äºä¸€ä¸ªé€»è¾‘æ¨¡å—çš„ä¿¡æ¯ã€‚\n2.1 åˆ†æ®µå¯¹ç”¨æˆ·æ˜¯å¯è§çš„ï¼Œç”¨æˆ·ç¼–ç¨‹æ—¶éœ€è¦æ˜¾å¼åœ°ç»™å‡ºæ®µåã€‚ 2.2 é¡µçš„å¤§å°å›ºå®šä¸”ç”±ç³»ç»Ÿå†³å®šã€‚æ®µçš„é•¿åº¦å´ä¸å›ºå®šï¼Œå†³å®šäºç”¨æˆ·ç¼–å†™çš„ç¨‹åºã€‚\n3.1 åˆ†é¡µçš„ç”¨æˆ·è¿›ç¨‹åœ°å€ç©ºé—´æ˜¯ä¸€ç»´çš„ï¼Œç¨‹åºå‘˜åªéœ€ç»™å‡ºä¸€ä¸ªè®°å¿†ç¬¦å³å¯è¡¨ç¤ºä¸€ä¸ªåœ°å€ã€‚ 3.2 åˆ†æ®µçš„ç”¨æˆ·è¿›ç¨‹åœ°å€ç©ºé—´æ˜¯äºŒç»´çš„ï¼Œç¨‹åºå‘˜åœ¨æ ‡è¯†ä¸€ä¸ªåœ°å€æ—¶ï¼Œæ—¢è¦ç»™å‡ºæ®µåï¼Œä¹Ÿè¦ç»™å‡ºæ®µå†…åœ°å€ã€‚ 4.1 åˆ†æ®µæ¯”åˆ†é¡µæ›´å®¹æ˜“å®ç°ä¿¡æ¯çš„å…±äº«å’Œä¿æŠ¤ã€‚ ä¸èƒ½è¢«ä¿®æ”¹çš„ä»£ç ç§°ä¸ºçº¯ä»£ç æˆ–å¯é‡å…¥ä»£ç (ä¸å±äºä¸´ç•Œèµ„æº)ï¼Œè¿™æ ·çš„ä»£ç æ˜¯å¯ä»¥å…±äº«çš„ã€‚å¯ä¿®æ”¹çš„ä»£ç æ˜¯ä¸èƒ½å…±äº«çš„(æ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ªä»£ç æ®µä¸­æœ‰å¾ˆå¤šå˜é‡ï¼Œå„è¿›ç¨‹å¹¶å‘åœ°åŒæ—¶è®¿é—®å¯èƒ½é€ æˆæ•°æ®ä¸ä¸€è‡´) åˆ†æ®µå°ç»“ æ®µé¡µå¼ åˆ†é¡µç®¡ç† ä¼˜ç‚¹: å†…å­˜ç©ºé—´åˆ©ç”¨ç‡é«˜ï¼Œä¸ä¼šäº§ç”Ÿå¤–éƒ¨ç¢ç‰‡ï¼Œåªä¼šæœ‰å°‘é‡çš„é¡µå†…ç¢ç‰‡ ç¼ºç‚¹: ä¸æ–¹ä¾¿æŒ‰ç…§é€»è¾‘æ¨¡å—å®ç°ä¿¡æ¯çš„å…±äº«å’Œä¿æŠ¤\nåˆ†æ®µç®¡ç† ä¼˜ç‚¹: å¾ˆæ–¹ä¾¿æŒ‰ç…§é€»è¾‘æ¨¡å—å®ç°ä¿¡æ¯çš„å…±äº«å’Œä¿æŠ¤ ç¼ºç‚¹ï¼š å¦‚æœæ®µé•¿è¿‡å¤§ï¼Œä¸ºå…¶åˆ†é…å¾ˆå¤§çš„è¿ç»­ç©ºé—´ä¼šå¾ˆä¸æ–¹ä¾¿ã€‚å¦å¤–ï¼Œæ®µå¼ç®¡ç†ä¼šäº§ç”Ÿå¤–éƒ¨ç¢ç‰‡\næ®µé¡µå¼-ä»€ä¹ˆæ˜¯æ®µé¡µå¼ æ¯ä¸ªæ®µå¯¹åº”ä¸€ä¸ªæ®µè¡¨é¡¹ï¼Œæ¯ä¸ªæ®µè¡¨é¡¹ç”±æ®µå·ã€é¡µè¡¨é•¿åº¦ã€é¡µè¡¨å­˜æ”¾å—å·(é¡µè¡¨èµ·å§‹ åœ°å€)ç»„æˆã€‚ æ¯ä¸ªæ®µè¡¨é¡¹é•¿åº¦ç›¸ç­‰ï¼Œæ®µå·æ˜¯éšå«çš„ã€‚ å†…å­˜æ¯ä¸ªé¡µé¢å¯¹åº”ä¸€ä¸ªé¡µè¡¨é¡¹ï¼Œæ¯ä¸ªé¡µè¡¨é¡¹ç”±é¡µå·ã€é¡µé¢å­˜æ”¾çš„å†…å­˜å—å·ç»„æˆã€‚æ¯ä¸ªé¡µè¡¨é¡¹é•¿åº¦ç›¸ç­‰ï¼Œé¡µå·æ˜¯éšå«çš„ã€‚\næ®µè¡¨å¼é¡µè¡¨ æ®µé¡µå¼åœ°å€è½¬æ¢ æ®µé¡µå¼å°ç»“ å†…å­˜ç©ºé—´çš„æ‰©å…… å¾ˆå¤šæ¸¸æˆçš„å¤§å°è¶…è¿‡ 60GBï¼ŒæŒ‰ç†æ¥è¯´è¿™ä¸ªæ¸¸æˆç¨‹åºè¿è¡Œä¹‹å‰éœ€è¦æŠŠ 60GB æ•°æ®å…¨éƒ¨æ”¾å…¥å†…å­˜ã€‚ç„¶è€Œï¼Œå®é™…æˆ‘çš„ç”µè„‘å†…å­˜æ‰ 8GBï¼Œæˆ‘è¿˜è¦å¼€ç€å¾®ä¿¡æµè§ˆå™¨ç­‰åˆ«çš„è¿›ç¨‹ï¼Œä½†ä¸ºä»€ä¹ˆè¿™ä¸ªæ¸¸æˆå¯ä»¥é¡ºåˆ©è¿è¡Œå‘¢?\nåˆ©ç”¨è™šæ‹ŸæŠ€æœ¯(æ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿæ€§) æ—¶é—´å±€éƒ¨æ€§: å¦‚æœæ‰§è¡Œäº†ç¨‹åºä¸­çš„æŸæ¡æŒ‡ä»¤ï¼Œé‚£ä¹ˆä¸ä¹…åè¿™æ¡æŒ‡ä»¤å¾ˆæœ‰å¯èƒ½å†æ¬¡æ‰§è¡Œ;å¦‚æœæŸä¸ªæ•°æ®è¢«è®¿é—®è¿‡ï¼Œä¸ä¹…ä¹‹åè¯¥æ•°æ®å¾ˆå¯èƒ½å†æ¬¡è¢«è®¿é—®ã€‚(å› ä¸ºç¨‹åºä¸­å­˜åœ¨å¤§é‡çš„å¾ªç¯);\nç©ºé—´å±€éƒ¨æ€§: ä¸€æ—¦ç¨‹åºè®¿é—®äº†æŸä¸ªå­˜å‚¨å•å…ƒï¼Œåœ¨ä¸ä¹…ä¹‹åï¼Œå…¶é™„è¿‘çš„å­˜å‚¨å•å…ƒä¹Ÿå¾ˆæœ‰å¯èƒ½è¢«è®¿é—®ã€‚ (å› ä¸ºå¾ˆå¤šæ•°æ®åœ¨å†…å­˜ä¸­éƒ½æ˜¯è¿ç»­å­˜æ”¾çš„ï¼Œå¹¶ä¸”ç¨‹åºçš„æŒ‡ä»¤ä¹Ÿæ˜¯é¡ºåºåœ°åœ¨å†…å­˜ä¸­å­˜æ”¾çš„)\nè¿™ä¸ªç¨‹åºæ‰§è¡Œæ—¶ï¼Œä¼šé¢‘ç¹è®¿é—®10å· å’Œ23å·é¡µé¢\n1 2 3 4 5 6 7 int i = 0; int a[100]; while (i \u0026lt; 100) { a[i] = i; i ++ ; } è™šæ‹Ÿå†…å­˜å¤§å°æ˜¯å¤šå°‘?\nè™šæ‹Ÿå†…å­˜çš„æœ€å¤§å®¹é‡æ˜¯ç”±è®¡ç®—æœºçš„åœ°å€ç»“æ„(CPUå¯»å€èŒƒå›´)ç¡®å®šçš„ï¼Œè™šæ‹Ÿå†…å­˜çš„å®é™…å®¹é‡ = min(å†…å­˜å’Œå¤–å­˜å®¹é‡ä¹‹å’Œï¼ŒCPUå¯»å€èŒƒå›´)\nå¦‚:æŸè®¡ç®—æœºåœ°å€ç»“æ„ä¸º32ä½ï¼ŒæŒ‰å­—èŠ‚ç¼–å€ï¼Œå†…å­˜å¤§å°ä¸º512MBï¼Œå¤–å­˜å¤§å°ä¸º2GBã€‚\nåˆ™è™šæ‹Ÿå†…å­˜çš„æœ€å¤§å®¹é‡ä¸º 2^32 B = 4GB;\nè™šæ‹Ÿå†…å­˜çš„å®é™…å®¹é‡ = min (2^32 B, 512MB+2GB) = 2GB+512MB;\nè™šæ‹Ÿå†…å­˜çš„å®ç° è¯·æ±‚åˆ†é¡µç®¡ç† è¯·æ±‚åˆ†é¡µå­˜å‚¨ç®¡ç†ä¸åŸºæœ¬åˆ†é¡µå­˜å‚¨ç®¡ç†çš„ä¸»è¦åŒºåˆ«: è¯·æ±‚è°ƒé¡µï¼šåœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“æ‰€è®¿é—®çš„ä¿¡æ¯ä¸åœ¨å†…å­˜æ—¶ï¼Œç”±æ“ä½œç³»ç»Ÿè´Ÿè´£å°†æ‰€éœ€ä¿¡æ¯ä»å¤–å­˜è°ƒå…¥å†…å­˜ï¼Œç„¶åç»§ç»­æ‰§è¡Œç¨‹åºã€‚\né¡µé¢ç½®æ¢ï¼šè‹¥å†…å­˜ç©ºé—´ä¸å¤Ÿï¼Œç”±æ“ä½œç³»ç»Ÿè´Ÿè´£å°†å†…å­˜ä¸­æš‚æ—¶ç”¨ä¸åˆ°çš„ä¿¡æ¯æ¢å‡ºåˆ°å¤–å­˜ã€‚\nè¯·æ±‚åˆ†é¡µ-ç¼ºé¡µä¸­æ–­ ç¼ºé¡µä¸­æ–­æ˜¯å› ä¸ºå½“å‰æ‰§è¡Œçš„æŒ‡ä»¤æƒ³è¦è®¿é—®çš„ç›®æ ‡é¡µé¢æœªè°ƒå…¥å†…å­˜è€Œäº§ç”Ÿçš„ï¼Œå› æ­¤å±äºå†…ä¸­æ–­ ä¸€æ¡æŒ‡ä»¤åœ¨æ‰§è¡ŒæœŸé—´ï¼Œå¯èƒ½äº§ç”Ÿå¤šæ¬¡ç¼ºé¡µä¸­æ–­ã€‚(å¦‚:copy A to Bï¼Œå³å°†é€»è¾‘åœ°å€Aä¸­çš„æ•°æ®å¤åˆ¶åˆ° é€»è¾‘åœ°å€Bï¼Œè€ŒAã€Bå±äºä¸åŒçš„é¡µé¢ï¼Œåˆ™æœ‰å¯èƒ½äº§ç”Ÿä¸¤æ¬¡ä¸­æ–­)\nåªæœ‰â€œå†™æŒ‡ä»¤â€æ‰éœ€è¦ä¿®æ”¹â€œä¿®æ”¹ä½â€ã€‚å¹¶ä¸”ï¼Œä¸€èˆ¬æ¥è¯´åªéœ€ä¿®æ”¹å¿«è¡¨ä¸­çš„æ•°æ®ï¼Œåªæœ‰è¦å°†å¿«è¡¨é¡¹åˆ é™¤æ—¶æ‰éœ€è¦å†™å›å†…å­˜ä¸­çš„æ…¢è¡¨ã€‚è¿™æ ·å¯ä»¥å‡å°‘è®¿å­˜æ¬¡æ•°ã€‚\nå’Œæ™®é€šçš„ä¸­æ–­å¤„ç†ä¸€æ ·ï¼Œç¼ºé¡µä¸­æ–­å¤„ç†ä¾ç„¶éœ€è¦ä¿ç•™CPUç°åœºã€‚\néœ€è¦ç”¨æŸç§â€œé¡µé¢ç½®æ¢ç®—æ³•â€æ¥å†³å®šä¸€ä¸ªæ¢å‡ºé¡µé¢(ä¸‹èŠ‚å†…å®¹)\næ¢å…¥/æ¢å‡ºé¡µé¢éƒ½éœ€è¦å¯åŠ¨æ…¢é€Ÿçš„I/Oæ“ä½œï¼Œå¯è§ï¼Œå¦‚æœæ¢å…¥/ æ¢å‡ºå¤ªé¢‘ç¹ï¼Œä¼šæœ‰å¾ˆå¤§çš„å¼€é”€ã€‚\né¡µé¢è°ƒå…¥å†…å­˜åï¼Œéœ€è¦ä¿®æ”¹æ…¢è¡¨ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦å°†è¡¨é¡¹å¤åˆ¶åˆ°å¿«è¡¨ä¸­\nå°ç»“: è¯·æ±‚åˆ†é¡µ-é¡µé¢ç½®æ¢ é¡µé¢çš„æ¢å…¥ã€æ¢å‡ºéœ€è¦ç£ç›˜ I/Oï¼Œä¼šæœ‰è¾ƒå¤§çš„å¼€é”€ï¼Œå› æ­¤å¥½çš„é¡µé¢ç½®æ¢ç®—æ³•åº”è¯¥è¿½æ±‚æ›´å°‘çš„ç¼ºé¡µç‡\næœ€ä½³ç½®æ¢ç®—æ³•(OPT) å…ˆè¿›å…ˆå‡ºç½®æ¢ç®—æ³•(FIFO) æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ç½®æ¢ç®—æ³•(LRU) æ—¶é’Ÿç½®æ¢ç®—æ³•(CLOCK) æ”¹è¿›å‹çš„æ—¶é’Ÿç½®æ¢ç®—æ³• å†…å­˜ç®¡ç†çš„èŒè´£-åœ°å€è½¬æ¢ ä¸ºäº†ä½¿ç¼–ç¨‹æ›´æ–¹ä¾¿ï¼Œç¨‹åºå‘˜å†™ç¨‹åºæ—¶åº”è¯¥åªéœ€è¦å…³æ³¨æŒ‡ä»¤ã€æ•°æ®çš„é€»è¾‘åœ°å€ã€‚è€Œé€»è¾‘åœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢(è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºåœ°å€é‡å®šä½)åº”è¯¥ç”±æ“ä½œç³»ç»Ÿè´Ÿè´£ï¼Œè¿™æ ·å°±ä¿è¯äº†ç¨‹åºå‘˜å†™ç¨‹åºæ—¶ä¸éœ€è¦å…³æ³¨ç‰©ç†å†…å­˜çš„å®é™…æƒ…å†µã€‚\nå…·ä½“çš„åœ°å€è½¬åŒ–æ–¹å¼å¦‚ä¸Šã€‚\nå†…å­˜ç®¡ç†çš„èŒè´£-å­˜å‚¨ä¿æŠ¤ ","permalink":"https://reid00.github.io/en/posts/os_network/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B9%8B%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/","summary":"ä»€ä¹ˆæ˜¯å†…å­˜ æœ€ç›´è§‚çš„ï¼Œæˆ‘ä»¬ä¹°æ‰‹æœºï¼Œç”µè„‘ï¼Œå†…å­˜æ¡ï¼Œéƒ½ä¼šæ ‡æ˜å†…å­˜æ˜¯å¤šå¤§ï¼Œä¾‹å¦‚é€”ä¸­çš„8Gï¼Œ16Gï¼Œ128Géƒ½æŒ‡çš„å†…å­˜å¤§å°ã€‚ æˆ‘ä»¬åº”è¯¥éƒ½å¬è¯´è¿‡ RAM å­˜å‚¨å™¨ï¼Œå®ƒæ˜¯ä¸€ç§åŠå¯¼ä½“å­˜å‚¨å™¨ä»¶ã€‚RAM æ˜¯è‹±æ–‡å•è¯ Random Access Memory çš„ç¼©å†™ï¼Œå³â€œéšæœºâ€çš„æ„æ€ã€‚æ‰€ä»¥ RAM å­˜å‚¨å™¨ä¹Ÿç§°ä¸ºâ€œéšæœºå­˜å‚¨å™¨â€ã€‚\né‚£ä¹ˆ RAM å­˜å‚¨å™¨å’Œå†…å­˜æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿå†…å­˜å°±æ˜¯è®¸å¤š RAM å­˜å‚¨å™¨çš„é›†åˆï¼Œå°±æ˜¯å°†è®¸å¤š RAM å­˜å‚¨å™¨é›†æˆåœ¨ä¸€èµ·çš„ç”µè·¯æ¿ã€‚RAM å­˜å‚¨å™¨çš„ä¼˜ç‚¹æ˜¯å­˜å–é€Ÿåº¦å¿«ã€è¯»å†™æ–¹ä¾¿ï¼Œæ‰€ä»¥å†…å­˜çš„é€Ÿåº¦å½“ç„¶ä¹Ÿå°±å¿«äº†ã€‚\næ“ä½œç³»ç»Ÿå‘å±•å†å² ç¨å¾®äº†è§£æ“ä½œç³»ç»Ÿå†å²çš„äººï¼Œéƒ½çŸ¥é“æ²¡æœ‰æ“ä½œç³»ç»Ÿçš„è£¸æœº-\u0026gt;ä¸€æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªç¨‹åºçš„å•é“æ‰¹å¤„ç†ç³»ç»Ÿ-\u0026gt;å¤šé“æ‰¹å¤„ç†ç³»ç»Ÿ-\u0026gt;åˆ†æ—¶ç³»ç»Ÿè¿™ä¸ªå‘å±•å†ç¨‹ã€‚\nè£¸æœºæ—¶ä»£ ä¸»è¦æ˜¯äººå·¥æ“ä½œï¼Œç¨‹åºå‘˜å°†å¯¹åº”ç”¨ç¨‹åºå’Œæ•°æ®çš„å·²ç©¿å­”çš„çº¸å¸¦ï¼ˆæˆ–å¡ç‰‡ï¼‰è£…å…¥è¾“å…¥æœºï¼Œç„¶åå¯åŠ¨è¾“å…¥æœºæŠŠç¨‹åºå’Œæ•°æ®è¾“å…¥è®¡ç®—æœºå†…å­˜ï¼Œæ¥ç€é€šè¿‡æ§åˆ¶å°å¼€å…³å¯åŠ¨ç¨‹åºé’ˆå¯¹æ•°æ®è¿è¡Œï¼›è®¡ç®—å®Œæ¯•ï¼Œæ‰“å°æœºè¾“å‡ºè®¡ç®—ç»“æœï¼›ç”¨æˆ·å–èµ°ç»“æœå¹¶å¸ä¸‹çº¸å¸¦ï¼ˆæˆ–å¡ç‰‡ï¼‰åï¼Œæ‰è®©ä¸‹ä¸€ä¸ªç”¨æˆ·ä¸Šæœºã€‚\näººæœºçŸ›ç›¾ï¼šæ‰‹å·¥æ“ä½œçš„æ…¢é€Ÿåº¦å’Œè®¡ç®—æœºçš„é«˜é€Ÿåº¦ä¹‹é—´å½¢æˆäº†å°–é”çŸ›ç›¾ï¼Œæ‰‹å·¥æ“ä½œæ–¹å¼å·²ä¸¥é‡æŸå®³äº†ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡ï¼ˆä½¿èµ„æºåˆ©ç”¨ç‡é™ä¸ºç™¾åˆ†ä¹‹å‡ ï¼Œç”šè‡³æ›´ä½ï¼‰ï¼Œä¸èƒ½å®¹å¿ã€‚å”¯ä¸€çš„è§£å†³åŠæ³•ï¼šåªæœ‰æ‘†è„±äººçš„æ‰‹å·¥æ“ä½œï¼Œå®ç°ä½œä¸šçš„è‡ªåŠ¨è¿‡æ¸¡ã€‚è¿™æ ·å°±å‡ºç°äº†æˆæ‰¹å¤„ç†ã€‚\nå•é“æ‰¹å¤„ç†ç³»ç»Ÿ ç‰¹ç‚¹æ˜¯ä¸€æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œåªæœ‰è¿è¡Œå®Œæ¯•åæ‰èƒ½å°†ä¸‹ä¸€ä¸ªè¿›ç¨‹åŠ è½½åˆ°å†…å­˜é‡Œé¢ï¼Œæ‰€ä»¥è¿›ç¨‹çš„æ•°æ®éƒ½æ˜¯ç›´æ¥æ”¾åœ¨ç‰©ç†å†…å­˜ä¸Šçš„ï¼Œå› æ­¤CPUæ˜¯ç›´æ¥æ“ä½œå†…å­˜çš„ç‰©ç†åœ°å€ï¼Œè¿™ä¸ªæ—¶å€™ä¸å­˜åœ¨è™šæ‹Ÿé€»è¾‘åœ°å€ï¼Œå› ä¸ºä¸€æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ªç¨‹åºã€‚\nçŸ›ç›¾ï¼šæ¯æ¬¡ä¸»æœºå†…å­˜ä¸­ä»…å­˜æ”¾ä¸€é“ä½œä¸šï¼Œæ¯å½“å®ƒè¿è¡ŒæœŸé—´å‘å‡ºè¾“å…¥/è¾“å‡ºï¼ˆI/Oï¼‰è¯·æ±‚åï¼Œé«˜é€Ÿçš„CPUä¾¿å¤„äºç­‰å¾…ä½é€Ÿçš„I/Oå®ŒæˆçŠ¶æ€ï¼Œè‡´ä½¿CPUç©ºé—²ã€‚\nå¤šé“æ‰¹å¤„ç†ç³»ç»Ÿ åˆ°åæ¥å‘å±•å‡ºäº†å¤šé“ç¨‹åºç³»ç»Ÿï¼Œå®ƒè¦æ±‚åœ¨è®¡ç®—æœºä¸­å­˜åœ¨ç€å¤šä¸ªè¿›ç¨‹ï¼Œå¤„ç†å™¨éœ€è¦åœ¨å¤šä¸ªè¿›ç¨‹é—´è¿›è¡Œåˆ‡æ¢ï¼Œå½“ä¸€é“ç¨‹åºå› I/Oè¯·æ±‚è€Œæš‚åœè¿è¡Œæ—¶ï¼ŒCPUä¾¿ç«‹å³è½¬å»è¿è¡Œå¦ä¸€é“ç¨‹åºã€‚\né—®é¢˜æ¥äº†ï¼Œè¿™ä¹ˆå¤šè¿›ç¨‹ï¼Œå†…å­˜ä¸å¤Ÿç”¨æ€ä¹ˆåŠï¼Œå„ä¸ªè¿›ç¨‹åŒæ—¶è¿è¡Œæ—¶å†…å­˜åœ°å€äº’ç›¸è¦†ç›–æ€ä¹ˆåŠï¼Ÿ\nè¿™æ—¶å€™å°±å‡ºç°é—®é¢˜äº†ï¼Œé“¾æ¥å™¨åœ¨é“¾æ¥ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™ï¼Œæ€»æ˜¯é»˜è®¤ç¨‹åºçš„èµ·å§‹åœ°å€ä¸º0x0ï¼Œä½†ç‰©ç†å†…å­˜ä¸Šåªæœ‰ä¸€ä¸ª0x0çš„åœ°å€å‘€ï¼Ÿä¹Ÿè®¸ä½ ä¼šè¯´:â€æ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¨‹åºè£…å…¥å†…å­˜çš„æ—¶å€™å†æ¬¡åŠ¨æ€æ”¹å˜å®ƒçš„åœ°å€.â€å¥½å§æˆ‘å¿äº†ã€‚ä½†å¦‚æœæˆ‘çš„ç‰©ç†å†…å­˜å¤§å°åªæœ‰1G,è€Œç°åœ¨æŸä¸€ä¸ªç¨‹åºéœ€è¦è¶…è¿‡1Gçš„ç©ºé—´æ€ä¹ˆåŠå‘¢ï¼Ÿä½ è¿˜èƒ½ç”¨åˆšæ‰é‚£å¥è¯è§£é‡Šå—ï¼Ÿ\næ“ä½œç³»ç»Ÿçš„å‘å±•ï¼ŒåŒ…æ‹¬åé¢çš„åˆ†æ—¶ç³»ç»Ÿï¼Œå…¶å®éƒ½æ˜¯åœ¨è§£å†³åè°ƒå„ä¸ªç¯èŠ‚é€Ÿåº¦ä¸åŒ¹é…çš„çŸ›ç›¾ã€‚\nCPUæ¯”ç£ç›˜é€Ÿåº¦å¿«å¤ªå¤š å­˜å‚¨å™¨å±‚æ¬¡ä¹‹é—´çš„ä½œç”¨å’Œå…³è”ä¸ºé‡‘å­—å¡”å½¢çŠ¶ï¼ŒCPUä¸å¯ä»¥ç›´æ¥æ“æ§ç£ç›˜ï¼Œæ˜¯é€šè¿‡æ“æ§å†…å­˜æ¥è¿›è¡Œå·¥ä½œçš„ï¼Œå› ä¸ºç£ç›˜çš„é€Ÿåº¦è¿œè¿œå°äºCPUçš„é€Ÿåº¦ï¼Œè·Ÿä¸ä¸Šï¼Œéœ€è¦ä¸­é—´çš„å†…å­˜å±‚è¿›è¡Œç¼“å†²ã€‚\nå†…å­˜é€Ÿåº¦æ¯”ç¡¬ç›˜é€Ÿåº¦å¿«çš„åŸç†: å†…å­˜çš„é€Ÿåº¦ä¹‹æ‰€ä»¥æ¯”ç¡¬ç›˜çš„é€Ÿåº¦å¿«ï¼ˆä¸æ˜¯å¿«ä¸€ç‚¹ï¼Œè€Œæ˜¯å¿«å¾ˆå¤šï¼‰ï¼Œæ˜¯å› ä¸ºå®ƒä»¬çš„å­˜å‚¨åŸç†å’Œè¯»å–æ–¹å¼ä¸ä¸€æ ·ã€‚\nç¡¬ç›˜æ˜¯æœºæ¢°ç»“æ„ï¼Œé€šè¿‡ç£å¤´çš„è½¬åŠ¨è¯»å–æ•°æ®ã€‚ä¸€èˆ¬æƒ…å†µä¸‹å°å¼æœºçš„ç¡¬ç›˜ä¸ºæ¯åˆ†é’Ÿ 7200 è½¬ï¼Œè€Œç¬”è®°æœ¬çš„ç¡¬ç›˜ä¸ºæ¯åˆ†é’Ÿ 5400 è½¬ã€‚ è€Œå†…å­˜æ˜¯æ²¡æœ‰æœºæ¢°ç»“æ„çš„ï¼Œå†…å­˜æ˜¯é€šè¿‡ç”µå­˜å–æ•°æ®çš„ã€‚\nå†…å­˜é€šè¿‡ç”µå­˜å–æ•°æ®ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å› ä¸º RAM å­˜å‚¨å™¨æ˜¯é€šè¿‡ç”µå­˜å‚¨æ•°æ®çš„ã€‚ä½†ä¹Ÿæ­£å› ä¸ºå®ƒä»¬æ˜¯é€šè¿‡ç”µå­˜å‚¨æ•°æ®çš„ï¼Œæ‰€ä»¥ä¸€æ—¦æ–­ç”µæ•°æ®å°±éƒ½ä¸¢å¤±äº†ã€‚å› æ­¤å†…å­˜åªæ˜¯ä¾›æ•°æ®æš‚æ—¶é€—ç•™çš„ç©ºé—´ï¼Œè€Œç¡¬ç›˜æ˜¯æ°¸ä¹…çš„ï¼Œæ–­ç”µåæ•°æ®ä¹Ÿä¸ä¼šæ¶ˆå¤±ã€‚\nå°ç»“ï¼šç¨‹åºæ‰§è¡Œå‰éœ€è¦å…ˆæ”¾åˆ°å†…å­˜ä¸­æ‰èƒ½è¢«CPUå¤„ç†ï¼Œå› æ­¤å†…å­˜çš„ä¸»è¦ä½œç”¨å°±æ˜¯ç¼“å’ŒCPUä¸ç¡¬ç›˜ä¹‹é—´çš„é€Ÿåº¦çŸ›ç›¾ã€‚\nç¨‹åºè¿è¡Œè¿‡ç¨‹ åœ¨å¤šé“ç¨‹åºç¯å¢ƒä¸‹ï¼Œç³»ç»Ÿä¸­ä¼šæœ‰å¤šä¸ªç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šæœ‰å¤šä¸ªç¨‹åºçš„æ•°æ®éœ€è¦åŒæ—¶æ”¾åˆ°å†…å­˜ä¸­ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•åŒºåˆ†å„ä¸ªç¨‹åºçš„æ•°æ®æ˜¯æ”¾åœ¨ä»€ä¹ˆåœ°æ–¹çš„å‘¢?\næ–¹æ¡ˆ: ç»™å†…å­˜çš„å­˜å‚¨å•å…ƒç¼–åœ°å€ã€‚ ç¨‹åºè¿è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š ç¼–è¯‘: æŠŠé«˜çº§è¯­è¨€ç¿»è¯‘ä¸ºæœºå™¨è¯­è¨€ï¼›\né“¾æ¥: ç”±é“¾æ¥ç¨‹åºå°†ç¼–è¯‘åå½¢æˆçš„ä¸€ç»„ç›®æ ‡æ¨¡å—ï¼Œä»¥åŠæ‰€éœ€åº“å‡½æ•°é“¾æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„è£…å…¥æ¨¡å—ï¼›\nè£…å…¥(è£…è½½): ç”±è£…å…¥ç¨‹åºå°†è£…å…¥æ¨¡å—è£…å…¥å†…å­˜è¿è¡Œï¼› ä¸‰ç§é“¾æ¥æ–¹å¼ é™æ€é“¾æ¥ åœ¨ç¨‹åºè¿è¡Œä¹‹å‰ï¼Œå…ˆå°†å„ç›®æ ‡æ¨¡å—åŠå®ƒä»¬æ‰€éœ€çš„åº“å‡½æ•°é“¾æ¥æˆä¸€ä¸ªå®Œæ•´çš„å¯æ‰§è¡Œæ–‡ä»¶(è£…å…¥æ¨¡å—)ï¼Œå³å¾—åˆ°å®Œæ•´çš„é€»è¾‘åœ°å€ï¼Œä¹‹åä¸å†æ‹†å¼€ã€‚ è£…å…¥æ—¶åŠ¨æ€é“¾æ¥ è¿è¡Œå‰è¾¹è£…å…¥è¾¹é“¾æ¥çš„é“¾æ¥æ–¹å¼ã€‚ è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥ è¿è¡Œæ—¶è¯¥ç›®æ ‡æ¨¡å—æ—¶ï¼Œæ‰å¯¹å®ƒè¿›è¡Œé“¾æ¥ï¼Œç”¨ä¸åˆ°çš„æ¨¡å—ä¸éœ€è¦è£…å…¥å†…å­˜ã€‚å…¶ä¼˜ç‚¹æ˜¯ä¾¿äºä¿®æ”¹å’Œæ›´æ–°ï¼Œä¾¿äºå®ç°å¯¹ç›®æ ‡æ¨¡å—çš„å…±äº«ã€‚ å¯ä»¥çœ‹åˆ°è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥ï¼Œä¸éœ€è¦ä¸€æ¬¡æ€§å°†æ¨¡å—å…¨éƒ¨è£…å…¥å†…å­˜ï¼Œå¯ä»¥ç­‰åˆ°è¿è¡Œæ—¶éœ€è¦çš„æ—¶å€™å†åŠ¨æ€çš„è¿æ¥è¿›å»ï¼Œè¿™æ ·ä¸€æ¥å°±å°±æä¾›äº†å†…å­˜ä¸å¤Ÿç”¨çš„é—®é¢˜çš„è§£å†³æ€è·¯ï¼Œè¿˜å¯ä»¥è¿™æ ·ï¼Œç”¨åˆ°äº†å†é“¾æ¥è¿›å»\nä¸‰ç§è£…å…¥æ–¹å¼ ç»å¯¹è£…å…¥ ç¼–è¯‘æˆ–æ±‡ç¼–æ—¶å¾—åˆ°ç»å¯¹åœ°å€ï¼Œå³å†…å­˜ç‰©ç†åœ°å€ï¼Œç›´æ¥å­˜åˆ°å¯¹åº”çš„ç‰©ç†åœ°å€ã€‚ å•é“å¤„ç†ç³»ç»Ÿå°±æ˜¯ç›´æ¥æ“ä½œç‰©ç†åœ°å€ï¼Œå› æ­¤ç»å¯¹è£…å…¥åªé€‚ç”¨äºå•é“ç¨‹åºç¯å¢ƒã€‚","title":"æ“ä½œç³»ç»Ÿä¹‹å†…å­˜ç®¡ç†"},{"content":"ä¸€ã€XGBoostå’ŒGBDT xgboostæ˜¯ä¸€ç§é›†æˆå­¦ä¹ ç®—æ³•ï¼Œå±äº3ç±»å¸¸ç”¨çš„é›†æˆæ–¹æ³•(bagging,boosting,stacking)ä¸­çš„boostingç®—æ³•ç±»åˆ«ã€‚å®ƒæ˜¯ä¸€ä¸ªåŠ æ³•æ¨¡å‹ï¼ŒåŸºæ¨¡å‹ä¸€èˆ¬é€‰æ‹©æ ‘æ¨¡å‹ï¼Œä½†ä¹Ÿå¯ä»¥é€‰æ‹©å…¶å®ƒç±»å‹çš„æ¨¡å‹å¦‚é€»è¾‘å›å½’ç­‰ã€‚\nxgboostå±äºæ¢¯åº¦æå‡æ ‘(GBDT)æ¨¡å‹è¿™ä¸ªèŒƒç•´ï¼ŒGBDTçš„åŸºæœ¬æƒ³æ³•æ˜¯è®©æ–°çš„åŸºæ¨¡å‹ï¼ˆGBDTä»¥CARTåˆ†ç±»å›å½’æ ‘ä¸ºåŸºæ¨¡å‹ï¼‰å»æ‹Ÿåˆå‰é¢æ¨¡å‹çš„åå·®ï¼Œä»è€Œä¸æ–­å°†åŠ æ³•æ¨¡å‹çš„åå·®é™ä½ã€‚\nç›¸æ¯”äºç»å…¸çš„GBDTï¼Œxgbooståšäº†ä¸€äº›æ”¹è¿›ï¼Œä»è€Œåœ¨æ•ˆæœå’Œæ€§èƒ½ä¸Šæœ‰æ˜æ˜¾çš„æå‡ï¼ˆåˆ’é‡ç‚¹é¢è¯•å¸¸è€ƒï¼‰ã€‚\nç¬¬ä¸€ï¼ŒGBDTå°†ç›®æ ‡å‡½æ•°æ³°å‹’å±•å¼€åˆ°ä¸€é˜¶ï¼Œè€Œxgboostå°†ç›®æ ‡å‡½æ•°æ³°å‹’å±•å¼€åˆ°äº†äºŒé˜¶ã€‚ä¿ç•™äº†æ›´å¤šæœ‰å…³ç›®æ ‡å‡½æ•°çš„ä¿¡æ¯ï¼Œå¯¹æå‡æ•ˆæœæœ‰å¸®åŠ©ã€‚\nç¬¬äºŒï¼ŒGBDTæ˜¯ç»™æ–°çš„åŸºæ¨¡å‹å¯»æ‰¾æ–°çš„æ‹Ÿåˆæ ‡ç­¾ï¼ˆå‰é¢åŠ æ³•æ¨¡å‹çš„è´Ÿæ¢¯åº¦ï¼‰ï¼Œè€Œxgboostæ˜¯ç»™æ–°çš„åŸºæ¨¡å‹å¯»æ‰¾æ–°çš„ç›®æ ‡å‡½æ•°ï¼ˆç›®æ ‡å‡½æ•°å…³äºæ–°çš„åŸºæ¨¡å‹çš„äºŒé˜¶æ³°å‹’å±•å¼€ï¼‰ã€‚\nç¬¬ä¸‰ï¼ŒxgbooståŠ å…¥äº†å’Œå¶å­æƒé‡çš„L2æ­£åˆ™åŒ–é¡¹ï¼Œå› è€Œæœ‰åˆ©äºæ¨¡å‹è·å¾—æ›´ä½çš„æ–¹å·®ã€‚\n**ç¬¬å››ï¼Œxgboostå¢åŠ äº†è‡ªåŠ¨å¤„ç†ç¼ºå¤±å€¼ç‰¹å¾çš„ç­–ç•¥ã€‚**é€šè¿‡æŠŠå¸¦ç¼ºå¤±å€¼æ ·æœ¬åˆ†åˆ«åˆ’åˆ†åˆ°å·¦å­æ ‘æˆ–è€…å³å­æ ‘ï¼Œæ¯”è¾ƒä¸¤ç§æ–¹æ¡ˆä¸‹ç›®æ ‡å‡½æ•°çš„ä¼˜åŠ£ï¼Œä»è€Œè‡ªåŠ¨å¯¹æœ‰ç¼ºå¤±å€¼çš„æ ·æœ¬è¿›è¡Œåˆ’åˆ†ï¼Œæ— éœ€å¯¹ç¼ºå¤±ç‰¹å¾è¿›è¡Œå¡«å……é¢„å¤„ç†ã€‚\næ­¤å¤–ï¼Œxgboostè¿˜æ”¯æŒå€™é€‰åˆ†ä½ç‚¹åˆ‡å‰²ï¼Œç‰¹å¾å¹¶è¡Œç­‰ï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚\näºŒã€XGBooståŸç†æ¦‚è¿° é¢ä»å‡è®¾ç©ºé—´ï¼Œç›®æ ‡å‡½æ•°ï¼Œä¼˜åŒ–ç®—æ³•3ä¸ªè§’åº¦å¯¹xgboostçš„åŸç†è¿›è¡Œæ¦‚æ‹¬æ€§çš„ä»‹ç»ã€‚\n1ï¼Œå‡è®¾ç©ºé—´\n2ï¼Œç›®æ ‡å‡½æ•°\n3ï¼Œä¼˜åŒ–ç®—æ³•\nåŸºæœ¬æ€æƒ³ï¼šè´ªå¿ƒæ³•ï¼Œé€æ£µæ ‘è¿›è¡Œå­¦ä¹ ï¼Œæ¯æ£µæ ‘æ‹Ÿåˆä¹‹å‰æ¨¡å‹çš„åå·®ã€‚\nä¸‰ã€ç¬¬tæ£µæ ‘å­¦ä»€ä¹ˆï¼Ÿ è¦å®Œæˆæ„å»ºxgboostæ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šä»¥ä¸‹ä¸€äº›äº‹æƒ…ã€‚\n1ï¼Œå¦‚ä½•boost? å¦‚æœå·²ç»å¾—åˆ°äº†å‰é¢t-1æ£µæ ‘æ„æˆçš„åŠ æ³•æ¨¡å‹ï¼Œå¦‚ä½•ç¡®å®šç¬¬tæ£µæ ‘çš„å­¦ä¹ ç›®æ ‡ï¼Ÿ\n2ï¼Œå¦‚ä½•ç”Ÿæˆæ ‘ï¼Ÿå·²çŸ¥ç¬¬tæ£µæ ‘çš„å­¦ä¹ ç›®æ ‡çš„å‰æä¸‹ï¼Œå¦‚ä½•å­¦ä¹ è¿™æ£µæ ‘ï¼Ÿå…·ä½“åˆåŒ…æ‹¬æ˜¯å¦è¿›è¡Œåˆ†è£‚ï¼Ÿé€‰æ‹©å“ªä¸ªç‰¹å¾è¿›è¡Œåˆ†è£‚ï¼Ÿé€‰æ‹©ä»€ä¹ˆåˆ†è£‚ç‚¹ä½ï¼Ÿåˆ†è£‚çš„å¶å­èŠ‚ç‚¹å¦‚ä½•å–å€¼ï¼Ÿ\næˆ‘ä»¬é¦–å…ˆè€ƒè™‘å¦‚ä½•boostçš„é—®é¢˜ï¼Œé¡ºä¾¿è§£å†³åˆ†è£‚çš„å¶å­èŠ‚ç‚¹å¦‚ä½•å–å€¼çš„é—®é¢˜ã€‚\nå››ã€å¦‚ä½•ç”Ÿæˆç¬¬tæ£µæ ‘ï¼Ÿ xgboosté‡‡ç”¨äºŒå‰æ ‘ï¼Œå¼€å§‹çš„æ—¶å€™ï¼Œå…¨éƒ¨æ ·æœ¬éƒ½åœ¨ä¸€ä¸ªå¶å­èŠ‚ç‚¹ä¸Šã€‚ç„¶åå¶å­èŠ‚ç‚¹ä¸æ–­é€šè¿‡äºŒåˆ†è£‚ï¼Œé€æ¸ç”Ÿæˆä¸€æ£µæ ‘ã€‚\nxgboostä½¿ç”¨levelwiseçš„ç”Ÿæˆç­–ç•¥ï¼Œå³æ¯æ¬¡å¯¹åŒä¸€å±‚çº§çš„å…¨éƒ¨å¶å­èŠ‚ç‚¹å°è¯•è¿›è¡Œåˆ†è£‚ã€‚\nå¯¹å¶å­èŠ‚ç‚¹åˆ†è£‚ç”Ÿæˆæ ‘çš„è¿‡ç¨‹æœ‰å‡ ä¸ªåŸºæœ¬çš„é—®é¢˜ï¼šæ˜¯å¦è¦è¿›è¡Œåˆ†è£‚ï¼Ÿé€‰æ‹©å“ªä¸ªç‰¹å¾è¿›è¡Œåˆ†è£‚ï¼Ÿåœ¨ç‰¹å¾çš„ä»€ä¹ˆç‚¹ä½è¿›è¡Œåˆ†è£‚ï¼Ÿä»¥åŠåˆ†è£‚åæ–°çš„å¶å­ä¸Šå–ä»€ä¹ˆå€¼ï¼Ÿ\nå¶å­èŠ‚ç‚¹çš„å–å€¼é—®é¢˜å‰é¢å·²ç»è§£å†³äº†ã€‚æˆ‘ä»¬é‡ç‚¹è®¨è®ºå‡ ä¸ªå‰©ä¸‹çš„é—®é¢˜ã€‚\n1ï¼Œæ˜¯å¦è¦è¿›è¡Œåˆ†è£‚ï¼Ÿ æ ¹æ®æ ‘çš„å‰ªæç­–ç•¥çš„ä¸åŒï¼Œè¿™ä¸ªé—®é¢˜æœ‰ä¸¤ç§ä¸åŒçš„å¤„ç†ã€‚å¦‚æœæ˜¯é¢„å‰ªæç­–ç•¥ï¼Œé‚£ä¹ˆåªæœ‰å½“å­˜åœ¨æŸç§åˆ†è£‚æ–¹å¼ä½¿å¾—åˆ†è£‚åç›®æ ‡å‡½æ•°å‘ç”Ÿä¸‹é™ï¼Œæ‰ä¼šè¿›è¡Œåˆ†è£‚ã€‚\nä½†å¦‚æœæ˜¯åå‰ªæç­–ç•¥ï¼Œåˆ™ä¼šæ— æ¡ä»¶è¿›è¡Œåˆ†è£‚ï¼Œç­‰æ ‘ç”Ÿæˆå®Œæˆåï¼Œå†ä»ä¸Šè€Œä¸‹æ£€æŸ¥æ ‘çš„å„ä¸ªåˆ†ææ˜¯å¦å¯¹ç›®æ ‡å‡½æ•°ä¸‹é™äº§ç”Ÿæ­£å‘è´¡çŒ®ä»è€Œè¿›è¡Œå‰ªæã€‚\nxgboosté‡‡ç”¨é¢„å‰ªæç­–ç•¥ï¼Œåªæœ‰åˆ†è£‚åçš„å¢ç›Šå¤§äº0æ‰ä¼šè¿›è¡Œåˆ†è£‚ã€‚\n2ï¼Œé€‰æ‹©ä»€ä¹ˆç‰¹å¾è¿›è¡Œåˆ†è£‚ï¼Ÿ\nxgboosté‡‡ç”¨ç‰¹å¾å¹¶è¡Œçš„æ–¹æ³•è¿›è¡Œè®¡ç®—é€‰æ‹©è¦åˆ†è£‚çš„ç‰¹å¾ï¼Œå³ç”¨å¤šä¸ªçº¿ç¨‹ï¼Œå°è¯•æŠŠå„ä¸ªç‰¹å¾éƒ½ä½œä¸ºåˆ†è£‚çš„ç‰¹å¾ï¼Œæ‰¾åˆ°å„ä¸ªç‰¹å¾çš„æœ€ä¼˜åˆ†å‰²ç‚¹ï¼Œè®¡ç®—æ ¹æ®å®ƒä»¬åˆ†è£‚åäº§ç”Ÿçš„å¢ç›Šï¼Œé€‰æ‹©å¢ç›Šæœ€å¤§çš„é‚£ä¸ªç‰¹å¾ä½œä¸ºåˆ†è£‚çš„ç‰¹å¾ã€‚\n3ï¼Œé€‰æ‹©ä»€ä¹ˆåˆ†è£‚ç‚¹ä½ï¼Ÿ\nxgboosté€‰æ‹©æŸä¸ªç‰¹å¾çš„åˆ†è£‚ç‚¹ä½çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å…¨å±€æ‰«ææ³•ï¼Œå¦ä¸€ç§æ˜¯å€™é€‰åˆ†ä½ç‚¹æ³•ã€‚ å…¨å±€æ‰«ææ³•å°†æ‰€æœ‰æ ·æœ¬è¯¥ç‰¹å¾çš„å–å€¼æŒ‰ä»å°åˆ°å¤§æ’åˆ—ï¼Œå°†æ‰€æœ‰å¯èƒ½çš„åˆ†è£‚ä½ç½®éƒ½è¯•ä¸€éï¼Œæ‰¾åˆ°å…¶ä¸­å¢ç›Šæœ€å¤§çš„é‚£ä¸ªåˆ†è£‚ç‚¹ï¼Œå…¶è®¡ç®—å¤æ‚åº¦å’Œå¶å­èŠ‚ç‚¹ä¸Šçš„æ ·æœ¬ç‰¹å¾ä¸åŒçš„å–å€¼ä¸ªæ•°æˆæ­£æ¯”ã€‚ è€Œå€™é€‰åˆ†ä½ç‚¹æ³•æ˜¯ä¸€ç§è¿‘ä¼¼ç®—æ³•ï¼Œä»…é€‰æ‹©å¸¸æ•°ä¸ªï¼ˆå¦‚256ä¸ªï¼‰å€™é€‰åˆ†è£‚ä½ç½®ï¼Œç„¶åä»å€™é€‰åˆ†è£‚ä½ç½®ä¸­æ‰¾å‡ºæœ€ä¼˜çš„é‚£ä¸ªã€‚\näº”ã€XGBoostç®—æ³•åŸç†å°ç»“ XGBoostï¼ˆeXtreme Gradient Boostingï¼‰å…¨åå«æç«¯æ¢¯åº¦æå‡ï¼ŒXGBoostæ˜¯é›†æˆå­¦ä¹ æ–¹æ³•çš„ç‹ç‰Œï¼Œåœ¨Kaggleæ•°æ®æŒ–æ˜æ¯”èµ›ä¸­ï¼Œå¤§éƒ¨åˆ†è·èƒœè€…ç”¨äº†XGBoostï¼ŒXGBooståœ¨ç»å¤§å¤šæ•°çš„å›å½’å’Œåˆ†ç±»é—®é¢˜ä¸Šè¡¨ç°çš„ååˆ†é¡¶å°–ï¼Œæœ¬æ–‡è¾ƒè¯¦ç»†çš„ä»‹ç»äº†XGBoostçš„ç®—æ³•åŸç†ã€‚\nç›®å½•\næœ€ä¼˜æ¨¡å‹çš„æ„å»ºæ–¹æ³•\nBoostingçš„å›å½’æ€æƒ³\nXGBoostçš„ç›®æ ‡å‡½æ•°æ¨å¯¼\nXGBoostçš„å›å½’æ ‘æ„å»ºæ–¹æ³•\nXGBoostä¸GDBTçš„åŒºåˆ«\næœ€ä¼˜æ¨¡å‹çš„æ„å»ºæ–¹æ³•\næ„å»ºæœ€ä¼˜æ¨¡å‹çš„ä¸€èˆ¬æ–¹æ³•æ˜¯æœ€å°åŒ–è®­ç»ƒæ•°æ®çš„æŸå¤±å‡½æ•°ï¼Œæˆ‘ä»¬ç”¨å­—æ¯ Lè¡¨ç¤ºï¼Œå¦‚ä¸‹å¼ï¼š\nå¼ï¼ˆ1ï¼‰ç§°ä¸ºç»éªŒé£é™©æœ€å°åŒ–ï¼Œè®­ç»ƒå¾—åˆ°çš„æ¨¡å‹å¤æ‚åº¦è¾ƒé«˜ã€‚å½“è®­ç»ƒæ•°æ®è¾ƒå°æ—¶ï¼Œæ¨¡å‹å¾ˆå®¹æ˜“å‡ºç°è¿‡æ‹Ÿåˆé—®é¢˜ã€‚\nå› æ­¤ï¼Œä¸ºäº†é™ä½æ¨¡å‹çš„å¤æ‚åº¦ï¼Œå¸¸é‡‡ç”¨ä¸‹å¼ï¼š\nå…¶ä¸­J(f)ä¸ºæ¨¡å‹çš„å¤æ‚åº¦ï¼Œå¼ï¼ˆ2ï¼‰ç§°ä¸ºç»“æ„é£é™©æœ€å°åŒ–ï¼Œç»“æ„é£é™©æœ€å°åŒ–çš„æ¨¡å‹å¾€å¾€å¯¹è®­ç»ƒæ•°æ®ä»¥åŠæœªçŸ¥çš„æµ‹è¯•æ•°æ®éƒ½æœ‰è¾ƒå¥½çš„é¢„æµ‹ ã€‚\nåº”ç”¨ï¼šå†³ç­–æ ‘çš„ç”Ÿæˆå’Œå‰ªæåˆ†åˆ«å¯¹åº”äº†ç»éªŒé£é™©æœ€å°åŒ–å’Œç»“æ„é£é™©æœ€å°åŒ–ï¼ŒXGBoostçš„å†³ç­–æ ‘ç”Ÿæˆæ˜¯ç»“æ„é£é™©æœ€å°åŒ–çš„ç»“æœï¼Œåç»­ä¼šè¯¦ç»†ä»‹ç»ã€‚\nBoostingæ–¹æ³•çš„å›å½’æ€æƒ³\nBoostingæ³•æ˜¯ç»“åˆå¤šä¸ªå¼±å­¦ä¹ å™¨ç»™å‡ºæœ€ç»ˆçš„å­¦ä¹ ç»“æœï¼Œä¸ç®¡ä»»åŠ¡æ˜¯åˆ†ç±»æˆ–å›å½’ï¼Œæˆ‘ä»¬éƒ½ç”¨å›å½’ä»»åŠ¡çš„æ€æƒ³æ¥æ„å»ºæœ€ä¼˜Boostingæ¨¡å‹ ã€‚\nå›å½’æ€æƒ³ï¼šæŠŠæ¯ä¸ªå¼±å­¦ä¹ å™¨çš„è¾“å‡ºç»“æœå½“æˆè¿ç»­å€¼ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯å¯ä»¥å¯¹æ¯ä¸ªå¼±å­¦ä¹ å™¨çš„ç»“æœè¿›è¡Œç´¯åŠ å¤„ç†ï¼Œä¸”èƒ½æ›´å¥½çš„åˆ©ç”¨æŸå¤±å‡½æ•°æ¥ä¼˜åŒ–æ¨¡å‹ã€‚\nå‡è®¾\næ˜¯ç¬¬ t è½®å¼±å­¦ä¹ å™¨çš„è¾“å‡ºç»“æœï¼Œ\næ˜¯æ¨¡å‹çš„è¾“å‡ºç»“æœï¼Œ\næ˜¯å®é™…è¾“å‡ºç»“æœï¼Œè¡¨è¾¾å¼å¦‚ä¸‹ï¼š\nä¸Šé¢ä¸¤å¼å°±æ˜¯åŠ æ³•æ¨¡å‹ï¼Œéƒ½é»˜è®¤å¼±å­¦ä¹ å™¨çš„è¾“å‡ºç»“æœæ˜¯è¿ç»­å€¼ã€‚å› ä¸ºå›å½’ä»»åŠ¡çš„å¼±å­¦ä¹ å™¨æœ¬èº«æ˜¯è¿ç»­å€¼ï¼Œæ‰€ä»¥ä¸åšè®¨è®ºï¼Œä¸‹é¢è¯¦ç»†ä»‹ç»åˆ†ç±»ä»»åŠ¡çš„å›å½’æ€æƒ³ã€‚\nåˆ†ç±»ä»»åŠ¡çš„å›å½’æ€æƒ³ï¼š\næ ¹æ®2.1å¼çš„ç»“æœï¼Œå¾—åˆ°æœ€ç»ˆçš„åˆ†ç±»å™¨ï¼š\nåˆ†ç±»çš„æŸå¤±å‡½æ•°ä¸€èˆ¬é€‰æ‹©æŒ‡æ•°å‡½æ•°æˆ–å¯¹æ•°å‡½æ•°ï¼Œè¿™é‡Œå‡è®¾æŸå¤±å‡½æ•°ä¸ºå¯¹æ•°å‡½æ•°ï¼Œå­¦ä¹ å™¨çš„æŸå¤±å‡½æ•°æ˜¯\nè‹¥å®é™…è¾“å‡ºç»“æœyi=1ï¼Œåˆ™ï¼š\næ±‚ï¼ˆ2.5ï¼‰å¼å¯¹\nçš„æ¢¯åº¦ï¼Œå¾—ï¼š\nè´Ÿæ¢¯åº¦æ–¹å‘æ˜¯æŸå¤±å‡½æ•°ä¸‹é™æœ€å¿«çš„æ–¹å‘ï¼Œï¼ˆ2.6ï¼‰å¼å–åçš„å€¼å¤§äº0ï¼Œå› æ­¤å¼±å­¦ä¹ å™¨æ˜¯å¾€å¢å¤§\nçš„æ–¹å‘è¿­ä»£çš„ï¼Œå›¾å½¢è¡¨ç¤ºä¸ºï¼š\nå¦‚ä¸Šå›¾ï¼Œå½“æ ·æœ¬çš„å®é™…æ ‡è®° yi æ˜¯ 1 æ—¶ï¼Œæ¨¡å‹è¾“å‡ºç»“æœ\néšç€è¿­ä»£æ¬¡æ•°çš„å¢åŠ è€Œå¢åŠ ï¼ˆçº¢çº¿ç®­å¤´ï¼‰ï¼Œæ¨¡å‹çš„æŸå¤±å‡½æ•°ç›¸åº”çš„å‡å°ï¼›å½“æ ·æœ¬çš„å®é™…æ ‡è®° yi æ˜¯ -1æ—¶ï¼Œæ¨¡å‹è¾“å‡ºç»“æœ\néšç€è¿­ä»£æ¬¡æ•°çš„å¢åŠ è€Œå‡å°ï¼ˆçº¢çº¿ç®­å¤´ï¼‰ï¼Œæ¨¡å‹çš„æŸå¤±å‡½æ•°ç›¸åº”çš„å‡å° ã€‚è¿™å°±æ˜¯åŠ æ³•æ¨¡å‹çš„åŸç†æ‰€åœ¨ï¼Œé€šè¿‡å¤šæ¬¡çš„è¿­ä»£è¾¾åˆ°å‡å°æŸå¤±å‡½æ•°çš„ç›®çš„ã€‚\nå°ç»“ï¼šBoostingæ–¹æ³•æŠŠæ¯ä¸ªå¼±å­¦ä¹ å™¨çš„è¾“å‡ºçœ‹æˆæ˜¯è¿ç»­å€¼ï¼Œä½¿å¾—æŸå¤±å‡½æ•°æ˜¯ä¸ªè¿ç»­å€¼ï¼Œå› æ­¤å¯ä»¥é€šè¿‡å¼±å­¦ä¹ å™¨çš„è¿­ä»£è¾¾åˆ°ä¼˜åŒ–æ¨¡å‹çš„ç›®çš„ï¼Œè¿™ä¹Ÿæ˜¯é›†æˆå­¦ä¹ æ³•åŠ æ³•æ¨¡å‹çš„åŸç†æ‰€åœ¨ ã€‚\nXGBoostç®—æ³•çš„ç›®æ ‡å‡½æ•°æ¨å¯¼\nç›®æ ‡å‡½æ•°ï¼Œå³æŸå¤±å‡½æ•°ï¼Œé€šè¿‡æœ€å°åŒ–æŸå¤±å‡½æ•°æ¥æ„å»ºæœ€ä¼˜æ¨¡å‹ï¼Œç”±ç¬¬ä¸€èŠ‚å¯çŸ¥ï¼Œ æŸå¤±å‡½æ•°åº”åŠ ä¸Šè¡¨ç¤ºæ¨¡å‹å¤æ‚åº¦çš„æ­£åˆ™é¡¹ï¼Œä¸”XGBoostå¯¹åº”çš„æ¨¡å‹åŒ…å«äº†å¤šä¸ªCARTæ ‘ï¼Œå› æ­¤ï¼Œæ¨¡å‹çš„ç›®æ ‡å‡½æ•°ä¸ºï¼š\nï¼ˆ3.1ï¼‰å¼æ˜¯æ­£åˆ™åŒ–çš„æŸå¤±å‡½æ•°ï¼Œç­‰å¼å³è¾¹ç¬¬ä¸€éƒ¨åˆ†æ˜¯æ¨¡å‹çš„è®­ç»ƒè¯¯å·®ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯æ­£åˆ™åŒ–é¡¹ï¼Œè¿™é‡Œçš„æ­£åˆ™åŒ–é¡¹æ˜¯Kæ£µæ ‘çš„æ­£åˆ™åŒ–é¡¹ç›¸åŠ è€Œæ¥çš„ã€‚\nCARTæ ‘çš„ä»‹ç»ï¼š\nä¸Šå›¾ä¸ºç¬¬Kæ£µCARTæ ‘ï¼Œç¡®å®šä¸€æ£µCARTæ ‘éœ€è¦ç¡®å®šä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†å°±æ˜¯æ ‘çš„ç»“æ„ï¼Œè¿™ä¸ªç»“æ„å°†è¾“å…¥æ ·æœ¬æ˜ å°„åˆ°ä¸€ä¸ªç¡®å®šçš„å¶å­èŠ‚ç‚¹ä¸Šï¼Œè®°ä¸º\nã€‚ç¬¬äºŒéƒ¨åˆ†å°±æ˜¯å„ä¸ªå¶å­èŠ‚ç‚¹çš„å€¼ï¼Œq(x)è¡¨ç¤ºè¾“å‡ºçš„å¶å­èŠ‚ç‚¹åºå·ï¼Œ\nè¡¨ç¤ºå¯¹åº”å¶å­èŠ‚ç‚¹åºå·çš„å€¼ã€‚ç”±å®šä¹‰å¾—ï¼š\næ ‘çš„å¤æ‚åº¦å®šä¹‰\nXGBoostæ³•å¯¹åº”çš„æ¨¡å‹åŒ…å«äº†å¤šæ£µcartæ ‘ï¼Œå®šä¹‰æ¯æ£µæ ‘çš„å¤æ‚åº¦ï¼š\nå…¶ä¸­Tä¸ºå¶å­èŠ‚ç‚¹çš„ä¸ªæ•°ï¼Œ||w||ä¸ºå¶å­èŠ‚ç‚¹å‘é‡çš„æ¨¡ ã€‚Î³è¡¨ç¤ºèŠ‚ç‚¹åˆ‡åˆ†çš„éš¾åº¦ï¼ŒÎ»è¡¨ç¤ºL2æ­£åˆ™åŒ–ç³»æ•°ã€‚\nå¦‚ä¸‹ä¾‹æ ‘çš„å¤æ‚åº¦è¡¨ç¤ºï¼š\nç›®æ ‡å‡½æ•°æ¨å¯¼\næ ¹æ®ï¼ˆ3.1ï¼‰å¼ï¼Œå…±è¿›è¡Œtæ¬¡è¿­ä»£çš„å­¦ä¹ æ¨¡å‹çš„ç›®æ ‡å‡½æ•°ä¸ºï¼š\næ³°å‹’å…¬å¼çš„äºŒé˜¶å¯¼è¿‘ä¼¼è¡¨ç¤ºï¼š\nä»¤\nä¸ºÎ”xï¼Œåˆ™ï¼ˆ3.5ï¼‰å¼çš„äºŒé˜¶è¿‘ä¼¼å±•å¼€ï¼š\nå…¶ä¸­ï¼š\nè¡¨ç¤ºå‰t-1æ£µæ ‘ç»„æˆçš„å­¦ä¹ æ¨¡å‹çš„é¢„æµ‹è¯¯å·®ï¼Œgiå’Œhiåˆ†åˆ«è¡¨ç¤ºé¢„æµ‹è¯¯å·®å¯¹å½“å‰æ¨¡å‹çš„ä¸€é˜¶å¯¼å’ŒäºŒé˜¶å¯¼ ï¼Œå½“å‰æ¨¡å‹å¾€é¢„æµ‹è¯¯å·®å‡å°çš„æ–¹å‘è¿›è¡Œè¿­ä»£ã€‚\nå¿½ç•¥ï¼ˆ3.8ï¼‰å¼å¸¸æ•°é¡¹ï¼Œå¹¶ç»“åˆï¼ˆ3.4ï¼‰å¼ï¼Œå¾—ï¼š\né€šè¿‡ï¼ˆ3.2ï¼‰å¼ç®€åŒ–ï¼ˆ3.9ï¼‰å¼ï¼š\nï¼ˆ3.10ï¼‰å¼ç¬¬ä¸€éƒ¨åˆ†æ˜¯å¯¹æ‰€æœ‰è®­ç»ƒæ ·æœ¬é›†è¿›è¡Œç´¯åŠ ï¼Œå› ä¸ºæ‰€æœ‰æ ·æœ¬éƒ½æ˜¯æ˜ å°„ä¸ºæ ‘çš„å¶å­èŠ‚ç‚¹ï¼Œæˆ‘ä»¬æ¢ç§æ€ç»´ï¼Œä»å¶å­èŠ‚ç‚¹å‡ºå‘ï¼Œå¯¹æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹è¿›è¡Œç´¯åŠ ï¼Œå¾—ï¼š\nä»¤\nGj è¡¨ç¤ºæ˜ å°„ä¸ºå¶å­èŠ‚ç‚¹ j çš„æ‰€æœ‰è¾“å…¥æ ·æœ¬çš„ä¸€é˜¶å¯¼ä¹‹å’Œï¼ŒåŒç†ï¼ŒHjè¡¨ç¤ºäºŒé˜¶å¯¼ä¹‹å’Œã€‚\nå¾—ï¼š\nå¯¹äºç¬¬ t æ£µCARTæ ‘çš„æŸä¸€ä¸ªç¡®å®šç»“æ„ï¼ˆå¯ç”¨q(x)è¡¨ç¤ºï¼‰ï¼Œå…¶å¶å­èŠ‚ç‚¹æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼ŒGjå’ŒHjæ˜¯ç¡®å®šé‡ï¼Œå› æ­¤ï¼Œï¼ˆ3.12ï¼‰å¯ä»¥çœ‹æˆæ˜¯å…³äºå¶å­èŠ‚ç‚¹çš„ä¸€å…ƒäºŒæ¬¡å‡½æ•° ã€‚æœ€å°åŒ–ï¼ˆ3.12ï¼‰å¼ï¼Œå¾—ï¼š\nå¾—åˆ°æœ€ç»ˆçš„ç›®æ ‡å‡½æ•°ï¼š\nï¼ˆ3.14ï¼‰ä¹Ÿç§°ä¸ºæ‰“åˆ†å‡½æ•°(scoring function)ï¼Œå®ƒæ˜¯è¡¡é‡æ ‘ç»“æ„å¥½åçš„æ ‡å‡†ï¼Œå€¼è¶Šå°ï¼Œä»£è¡¨è¿™æ ·çš„ç»“æ„è¶Šå¥½ ã€‚æˆ‘ä»¬ç”¨æ‰“åˆ†å‡½æ•°é€‰æ‹©æœ€ä½³åˆ‡åˆ†ç‚¹ï¼Œä»è€Œæ„å»ºCARTæ ‘ã€‚\nCARTå›å½’æ ‘çš„æ„å»ºæ–¹æ³•\nä¸ŠèŠ‚æ¨å¯¼å¾—åˆ°çš„æ‰“åˆ†å‡½æ•°æ˜¯è¡¡é‡æ ‘ç»“æ„å¥½åçš„æ ‡å‡†ï¼Œå› æ­¤ï¼Œå¯ç”¨æ‰“åˆ†å‡½æ•°æ¥é€‰æ‹©æœ€ä½³åˆ‡åˆ†ç‚¹ã€‚é¦–å…ˆç¡®å®šæ ·æœ¬ç‰¹å¾çš„æ‰€æœ‰åˆ‡åˆ†ç‚¹ï¼Œå¯¹æ¯ä¸€ä¸ªç¡®å®šçš„åˆ‡åˆ†ç‚¹è¿›è¡Œåˆ‡åˆ†ï¼Œåˆ‡åˆ†å¥½åçš„æ ‡å‡†å¦‚ä¸‹ï¼š\nGainè¡¨ç¤ºå•èŠ‚ç‚¹objä¸åˆ‡åˆ†åçš„ä¸¤ä¸ªèŠ‚ç‚¹çš„æ ‘objä¹‹å·®ï¼Œéå†æ‰€æœ‰ç‰¹å¾çš„åˆ‡åˆ†ç‚¹ï¼Œæ‰¾åˆ°æœ€å¤§Gainçš„åˆ‡åˆ†ç‚¹å³æ˜¯æœ€ä½³åˆ†è£‚ç‚¹ï¼Œæ ¹æ®è¿™ç§æ–¹æ³•ç»§ç»­åˆ‡åˆ†èŠ‚ç‚¹ï¼Œå¾—åˆ°CARTæ ‘ã€‚è‹¥ Î³ å€¼è®¾ç½®çš„è¿‡å¤§ï¼Œåˆ™Gainä¸ºè´Ÿï¼Œè¡¨ç¤ºä¸åˆ‡åˆ†è¯¥èŠ‚ç‚¹ï¼Œå› ä¸ºåˆ‡åˆ†åçš„æ ‘ç»“æ„å˜å·®äº†ã€‚Î³å€¼è¶Šå¤§ï¼Œè¡¨ç¤ºå¯¹åˆ‡åˆ†åobjä¸‹é™å¹…åº¦è¦æ±‚è¶Šä¸¥ï¼Œè¿™ä¸ªå€¼å¯ä»¥åœ¨XGBoostä¸­è®¾å®šã€‚\nXGBoostä¸GDBTçš„åŒºåˆ«\nXGBoostç”ŸæˆCARTæ ‘è€ƒè™‘äº†æ ‘çš„å¤æ‚åº¦ï¼ŒGDBTæœªè€ƒè™‘ï¼ŒGDBTåœ¨æ ‘çš„å‰ªææ­¥éª¤ä¸­è€ƒè™‘äº†æ ‘çš„å¤æ‚åº¦ã€‚\nXGBoostæ˜¯æ‹Ÿåˆä¸Šä¸€è½®æŸå¤±å‡½æ•°çš„äºŒé˜¶å¯¼å±•å¼€ï¼ŒGDBTæ˜¯æ‹Ÿåˆä¸Šä¸€è½®æŸå¤±å‡½æ•°çš„ä¸€é˜¶å¯¼å±•å¼€ï¼Œå› æ­¤ï¼ŒXGBoostçš„å‡†ç¡®æ€§æ›´é«˜ï¼Œä¸”æ»¡è¶³ç›¸åŒçš„è®­ç»ƒæ•ˆæœï¼Œéœ€è¦çš„è¿­ä»£æ¬¡æ•°æ›´å°‘ã€‚\nXGBoostä¸GDBTéƒ½æ˜¯é€æ¬¡è¿­ä»£æ¥æé«˜æ¨¡å‹æ€§èƒ½ï¼Œä½†æ˜¯XGBooståœ¨é€‰å–æœ€ä½³åˆ‡åˆ†ç‚¹æ—¶å¯ä»¥å¼€å¯å¤šçº¿ç¨‹è¿›è¡Œï¼Œå¤§å¤§æé«˜äº†è¿è¡Œé€Ÿåº¦ã€‚\nå‚è€ƒ: https://mp.weixin.qq.com/s/cMgd-wBlzjacL21FPK2y7Q https://www.cnblogs.com/pinard/p/10979808.html\n","permalink":"https://reid00.github.io/en/posts/ml/%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0%E4%B9%8Bxgboost/","summary":"ä¸€ã€XGBoostå’ŒGBDT xgboostæ˜¯ä¸€ç§é›†æˆå­¦ä¹ ç®—æ³•ï¼Œå±äº3ç±»å¸¸ç”¨çš„é›†æˆæ–¹æ³•(bagging,boosting,stacking)ä¸­çš„boostingç®—æ³•ç±»åˆ«ã€‚å®ƒæ˜¯ä¸€ä¸ªåŠ æ³•æ¨¡å‹ï¼ŒåŸºæ¨¡å‹ä¸€èˆ¬é€‰æ‹©æ ‘æ¨¡å‹ï¼Œä½†ä¹Ÿå¯ä»¥é€‰æ‹©å…¶å®ƒç±»å‹çš„æ¨¡å‹å¦‚é€»è¾‘å›å½’ç­‰ã€‚\nxgboostå±äºæ¢¯åº¦æå‡æ ‘(GBDT)æ¨¡å‹è¿™ä¸ªèŒƒç•´ï¼ŒGBDTçš„åŸºæœ¬æƒ³æ³•æ˜¯è®©æ–°çš„åŸºæ¨¡å‹ï¼ˆGBDTä»¥CARTåˆ†ç±»å›å½’æ ‘ä¸ºåŸºæ¨¡å‹ï¼‰å»æ‹Ÿåˆå‰é¢æ¨¡å‹çš„åå·®ï¼Œä»è€Œä¸æ–­å°†åŠ æ³•æ¨¡å‹çš„åå·®é™ä½ã€‚\nç›¸æ¯”äºç»å…¸çš„GBDTï¼Œxgbooståšäº†ä¸€äº›æ”¹è¿›ï¼Œä»è€Œåœ¨æ•ˆæœå’Œæ€§èƒ½ä¸Šæœ‰æ˜æ˜¾çš„æå‡ï¼ˆåˆ’é‡ç‚¹é¢è¯•å¸¸è€ƒï¼‰ã€‚\nç¬¬ä¸€ï¼ŒGBDTå°†ç›®æ ‡å‡½æ•°æ³°å‹’å±•å¼€åˆ°ä¸€é˜¶ï¼Œè€Œxgboostå°†ç›®æ ‡å‡½æ•°æ³°å‹’å±•å¼€åˆ°äº†äºŒé˜¶ã€‚ä¿ç•™äº†æ›´å¤šæœ‰å…³ç›®æ ‡å‡½æ•°çš„ä¿¡æ¯ï¼Œå¯¹æå‡æ•ˆæœæœ‰å¸®åŠ©ã€‚\nç¬¬äºŒï¼ŒGBDTæ˜¯ç»™æ–°çš„åŸºæ¨¡å‹å¯»æ‰¾æ–°çš„æ‹Ÿåˆæ ‡ç­¾ï¼ˆå‰é¢åŠ æ³•æ¨¡å‹çš„è´Ÿæ¢¯åº¦ï¼‰ï¼Œè€Œxgboostæ˜¯ç»™æ–°çš„åŸºæ¨¡å‹å¯»æ‰¾æ–°çš„ç›®æ ‡å‡½æ•°ï¼ˆç›®æ ‡å‡½æ•°å…³äºæ–°çš„åŸºæ¨¡å‹çš„äºŒé˜¶æ³°å‹’å±•å¼€ï¼‰ã€‚\nç¬¬ä¸‰ï¼ŒxgbooståŠ å…¥äº†å’Œå¶å­æƒé‡çš„L2æ­£åˆ™åŒ–é¡¹ï¼Œå› è€Œæœ‰åˆ©äºæ¨¡å‹è·å¾—æ›´ä½çš„æ–¹å·®ã€‚\n**ç¬¬å››ï¼Œxgboostå¢åŠ äº†è‡ªåŠ¨å¤„ç†ç¼ºå¤±å€¼ç‰¹å¾çš„ç­–ç•¥ã€‚**é€šè¿‡æŠŠå¸¦ç¼ºå¤±å€¼æ ·æœ¬åˆ†åˆ«åˆ’åˆ†åˆ°å·¦å­æ ‘æˆ–è€…å³å­æ ‘ï¼Œæ¯”è¾ƒä¸¤ç§æ–¹æ¡ˆä¸‹ç›®æ ‡å‡½æ•°çš„ä¼˜åŠ£ï¼Œä»è€Œè‡ªåŠ¨å¯¹æœ‰ç¼ºå¤±å€¼çš„æ ·æœ¬è¿›è¡Œåˆ’åˆ†ï¼Œæ— éœ€å¯¹ç¼ºå¤±ç‰¹å¾è¿›è¡Œå¡«å……é¢„å¤„ç†ã€‚\næ­¤å¤–ï¼Œxgboostè¿˜æ”¯æŒå€™é€‰åˆ†ä½ç‚¹åˆ‡å‰²ï¼Œç‰¹å¾å¹¶è¡Œç­‰ï¼Œå¯ä»¥æå‡æ€§èƒ½ã€‚\näºŒã€XGBooståŸç†æ¦‚è¿° é¢ä»å‡è®¾ç©ºé—´ï¼Œç›®æ ‡å‡½æ•°ï¼Œä¼˜åŒ–ç®—æ³•3ä¸ªè§’åº¦å¯¹xgboostçš„åŸç†è¿›è¡Œæ¦‚æ‹¬æ€§çš„ä»‹ç»ã€‚\n1ï¼Œå‡è®¾ç©ºé—´\n2ï¼Œç›®æ ‡å‡½æ•°\n3ï¼Œä¼˜åŒ–ç®—æ³•\nåŸºæœ¬æ€æƒ³ï¼šè´ªå¿ƒæ³•ï¼Œé€æ£µæ ‘è¿›è¡Œå­¦ä¹ ï¼Œæ¯æ£µæ ‘æ‹Ÿåˆä¹‹å‰æ¨¡å‹çš„åå·®ã€‚\nä¸‰ã€ç¬¬tæ£µæ ‘å­¦ä»€ä¹ˆï¼Ÿ è¦å®Œæˆæ„å»ºxgboostæ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šä»¥ä¸‹ä¸€äº›äº‹æƒ…ã€‚\n1ï¼Œå¦‚ä½•boost? å¦‚æœå·²ç»å¾—åˆ°äº†å‰é¢t-1æ£µæ ‘æ„æˆçš„åŠ æ³•æ¨¡å‹ï¼Œå¦‚ä½•ç¡®å®šç¬¬tæ£µæ ‘çš„å­¦ä¹ ç›®æ ‡ï¼Ÿ\n2ï¼Œå¦‚ä½•ç”Ÿæˆæ ‘ï¼Ÿå·²çŸ¥ç¬¬tæ£µæ ‘çš„å­¦ä¹ ç›®æ ‡çš„å‰æä¸‹ï¼Œå¦‚ä½•å­¦ä¹ è¿™æ£µæ ‘ï¼Ÿå…·ä½“åˆåŒ…æ‹¬æ˜¯å¦è¿›è¡Œåˆ†è£‚ï¼Ÿé€‰æ‹©å“ªä¸ªç‰¹å¾è¿›è¡Œåˆ†è£‚ï¼Ÿé€‰æ‹©ä»€ä¹ˆåˆ†è£‚ç‚¹ä½ï¼Ÿåˆ†è£‚çš„å¶å­èŠ‚ç‚¹å¦‚ä½•å–å€¼ï¼Ÿ\næˆ‘ä»¬é¦–å…ˆè€ƒè™‘å¦‚ä½•boostçš„é—®é¢˜ï¼Œé¡ºä¾¿è§£å†³åˆ†è£‚çš„å¶å­èŠ‚ç‚¹å¦‚ä½•å–å€¼çš„é—®é¢˜ã€‚\nå››ã€å¦‚ä½•ç”Ÿæˆç¬¬tæ£µæ ‘ï¼Ÿ xgboosté‡‡ç”¨äºŒå‰æ ‘ï¼Œå¼€å§‹çš„æ—¶å€™ï¼Œå…¨éƒ¨æ ·æœ¬éƒ½åœ¨ä¸€ä¸ªå¶å­èŠ‚ç‚¹ä¸Šã€‚ç„¶åå¶å­èŠ‚ç‚¹ä¸æ–­é€šè¿‡äºŒåˆ†è£‚ï¼Œé€æ¸ç”Ÿæˆä¸€æ£µæ ‘ã€‚\nxgboostä½¿ç”¨levelwiseçš„ç”Ÿæˆç­–ç•¥ï¼Œå³æ¯æ¬¡å¯¹åŒä¸€å±‚çº§çš„å…¨éƒ¨å¶å­èŠ‚ç‚¹å°è¯•è¿›è¡Œåˆ†è£‚ã€‚\nå¯¹å¶å­èŠ‚ç‚¹åˆ†è£‚ç”Ÿæˆæ ‘çš„è¿‡ç¨‹æœ‰å‡ ä¸ªåŸºæœ¬çš„é—®é¢˜ï¼šæ˜¯å¦è¦è¿›è¡Œåˆ†è£‚ï¼Ÿé€‰æ‹©å“ªä¸ªç‰¹å¾è¿›è¡Œåˆ†è£‚ï¼Ÿåœ¨ç‰¹å¾çš„ä»€ä¹ˆç‚¹ä½è¿›è¡Œåˆ†è£‚ï¼Ÿä»¥åŠåˆ†è£‚åæ–°çš„å¶å­ä¸Šå–ä»€ä¹ˆå€¼ï¼Ÿ\nå¶å­èŠ‚ç‚¹çš„å–å€¼é—®é¢˜å‰é¢å·²ç»è§£å†³äº†ã€‚æˆ‘ä»¬é‡ç‚¹è®¨è®ºå‡ ä¸ªå‰©ä¸‹çš„é—®é¢˜ã€‚\n1ï¼Œæ˜¯å¦è¦è¿›è¡Œåˆ†è£‚ï¼Ÿ æ ¹æ®æ ‘çš„å‰ªæç­–ç•¥çš„ä¸åŒï¼Œè¿™ä¸ªé—®é¢˜æœ‰ä¸¤ç§ä¸åŒçš„å¤„ç†ã€‚å¦‚æœæ˜¯é¢„å‰ªæç­–ç•¥ï¼Œé‚£ä¹ˆåªæœ‰å½“å­˜åœ¨æŸç§åˆ†è£‚æ–¹å¼ä½¿å¾—åˆ†è£‚åç›®æ ‡å‡½æ•°å‘ç”Ÿä¸‹é™ï¼Œæ‰ä¼šè¿›è¡Œåˆ†è£‚ã€‚\nä½†å¦‚æœæ˜¯åå‰ªæç­–ç•¥ï¼Œåˆ™ä¼šæ— æ¡ä»¶è¿›è¡Œåˆ†è£‚ï¼Œç­‰æ ‘ç”Ÿæˆå®Œæˆåï¼Œå†ä»ä¸Šè€Œä¸‹æ£€æŸ¥æ ‘çš„å„ä¸ªåˆ†ææ˜¯å¦å¯¹ç›®æ ‡å‡½æ•°ä¸‹é™äº§ç”Ÿæ­£å‘è´¡çŒ®ä»è€Œè¿›è¡Œå‰ªæã€‚\nxgboosté‡‡ç”¨é¢„å‰ªæç­–ç•¥ï¼Œåªæœ‰åˆ†è£‚åçš„å¢ç›Šå¤§äº0æ‰ä¼šè¿›è¡Œåˆ†è£‚ã€‚\n2ï¼Œé€‰æ‹©ä»€ä¹ˆç‰¹å¾è¿›è¡Œåˆ†è£‚ï¼Ÿ\nxgboosté‡‡ç”¨ç‰¹å¾å¹¶è¡Œçš„æ–¹æ³•è¿›è¡Œè®¡ç®—é€‰æ‹©è¦åˆ†è£‚çš„ç‰¹å¾ï¼Œå³ç”¨å¤šä¸ªçº¿ç¨‹ï¼Œå°è¯•æŠŠå„ä¸ªç‰¹å¾éƒ½ä½œä¸ºåˆ†è£‚çš„ç‰¹å¾ï¼Œæ‰¾åˆ°å„ä¸ªç‰¹å¾çš„æœ€ä¼˜åˆ†å‰²ç‚¹ï¼Œè®¡ç®—æ ¹æ®å®ƒä»¬åˆ†è£‚åäº§ç”Ÿçš„å¢ç›Šï¼Œé€‰æ‹©å¢ç›Šæœ€å¤§çš„é‚£ä¸ªç‰¹å¾ä½œä¸ºåˆ†è£‚çš„ç‰¹å¾ã€‚\n3ï¼Œé€‰æ‹©ä»€ä¹ˆåˆ†è£‚ç‚¹ä½ï¼Ÿ\nxgboosté€‰æ‹©æŸä¸ªç‰¹å¾çš„åˆ†è£‚ç‚¹ä½çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯å…¨å±€æ‰«ææ³•ï¼Œå¦ä¸€ç§æ˜¯å€™é€‰åˆ†ä½ç‚¹æ³•ã€‚ å…¨å±€æ‰«ææ³•å°†æ‰€æœ‰æ ·æœ¬è¯¥ç‰¹å¾çš„å–å€¼æŒ‰ä»å°åˆ°å¤§æ’åˆ—ï¼Œå°†æ‰€æœ‰å¯èƒ½çš„åˆ†è£‚ä½ç½®éƒ½è¯•ä¸€éï¼Œæ‰¾åˆ°å…¶ä¸­å¢ç›Šæœ€å¤§çš„é‚£ä¸ªåˆ†è£‚ç‚¹ï¼Œå…¶è®¡ç®—å¤æ‚åº¦å’Œå¶å­èŠ‚ç‚¹ä¸Šçš„æ ·æœ¬ç‰¹å¾ä¸åŒçš„å–å€¼ä¸ªæ•°æˆæ­£æ¯”ã€‚ è€Œå€™é€‰åˆ†ä½ç‚¹æ³•æ˜¯ä¸€ç§è¿‘ä¼¼ç®—æ³•ï¼Œä»…é€‰æ‹©å¸¸æ•°ä¸ªï¼ˆå¦‚256ä¸ªï¼‰å€™é€‰åˆ†è£‚ä½ç½®ï¼Œç„¶åä»å€™é€‰åˆ†è£‚ä½ç½®ä¸­æ‰¾å‡ºæœ€ä¼˜çš„é‚£ä¸ªã€‚\näº”ã€XGBoostç®—æ³•åŸç†å°ç»“ XGBoostï¼ˆeXtreme Gradient Boostingï¼‰å…¨åå«æç«¯æ¢¯åº¦æå‡ï¼ŒXGBoostæ˜¯é›†æˆå­¦ä¹ æ–¹æ³•çš„ç‹ç‰Œï¼Œåœ¨Kaggleæ•°æ®æŒ–æ˜æ¯”èµ›ä¸­ï¼Œå¤§éƒ¨åˆ†è·èƒœè€…ç”¨äº†XGBoostï¼ŒXGBooståœ¨ç»å¤§å¤šæ•°çš„å›å½’å’Œåˆ†ç±»é—®é¢˜ä¸Šè¡¨ç°çš„ååˆ†é¡¶å°–ï¼Œæœ¬æ–‡è¾ƒè¯¦ç»†çš„ä»‹ç»äº†XGBoostçš„ç®—æ³•åŸç†ã€‚\nç›®å½•\næœ€ä¼˜æ¨¡å‹çš„æ„å»ºæ–¹æ³•\nBoostingçš„å›å½’æ€æƒ³\nXGBoostçš„ç›®æ ‡å‡½æ•°æ¨å¯¼\nXGBoostçš„å›å½’æ ‘æ„å»ºæ–¹æ³•\nXGBoostä¸GDBTçš„åŒºåˆ«\næœ€ä¼˜æ¨¡å‹çš„æ„å»ºæ–¹æ³•\næ„å»ºæœ€ä¼˜æ¨¡å‹çš„ä¸€èˆ¬æ–¹æ³•æ˜¯æœ€å°åŒ–è®­ç»ƒæ•°æ®çš„æŸå¤±å‡½æ•°ï¼Œæˆ‘ä»¬ç”¨å­—æ¯ Lè¡¨ç¤ºï¼Œå¦‚ä¸‹å¼ï¼š\nå¼ï¼ˆ1ï¼‰ç§°ä¸ºç»éªŒé£é™©æœ€å°åŒ–ï¼Œè®­ç»ƒå¾—åˆ°çš„æ¨¡å‹å¤æ‚åº¦è¾ƒé«˜ã€‚å½“è®­ç»ƒæ•°æ®è¾ƒå°æ—¶ï¼Œæ¨¡å‹å¾ˆå®¹æ˜“å‡ºç°è¿‡æ‹Ÿåˆé—®é¢˜ã€‚\nå› æ­¤ï¼Œä¸ºäº†é™ä½æ¨¡å‹çš„å¤æ‚åº¦ï¼Œå¸¸é‡‡ç”¨ä¸‹å¼ï¼š\nå…¶ä¸­J(f)ä¸ºæ¨¡å‹çš„å¤æ‚åº¦ï¼Œå¼ï¼ˆ2ï¼‰ç§°ä¸ºç»“æ„é£é™©æœ€å°åŒ–ï¼Œç»“æ„é£é™©æœ€å°åŒ–çš„æ¨¡å‹å¾€å¾€å¯¹è®­ç»ƒæ•°æ®ä»¥åŠæœªçŸ¥çš„æµ‹è¯•æ•°æ®éƒ½æœ‰è¾ƒå¥½çš„é¢„æµ‹ ã€‚\nåº”ç”¨ï¼šå†³ç­–æ ‘çš„ç”Ÿæˆå’Œå‰ªæåˆ†åˆ«å¯¹åº”äº†ç»éªŒé£é™©æœ€å°åŒ–å’Œç»“æ„é£é™©æœ€å°åŒ–ï¼ŒXGBoostçš„å†³ç­–æ ‘ç”Ÿæˆæ˜¯ç»“æ„é£é™©æœ€å°åŒ–çš„ç»“æœï¼Œåç»­ä¼šè¯¦ç»†ä»‹ç»ã€‚\nBoostingæ–¹æ³•çš„å›å½’æ€æƒ³\nBoostingæ³•æ˜¯ç»“åˆå¤šä¸ªå¼±å­¦ä¹ å™¨ç»™å‡ºæœ€ç»ˆçš„å­¦ä¹ ç»“æœï¼Œä¸ç®¡ä»»åŠ¡æ˜¯åˆ†ç±»æˆ–å›å½’ï¼Œæˆ‘ä»¬éƒ½ç”¨å›å½’ä»»åŠ¡çš„æ€æƒ³æ¥æ„å»ºæœ€ä¼˜Boostingæ¨¡å‹ ã€‚\nå›å½’æ€æƒ³ï¼šæŠŠæ¯ä¸ªå¼±å­¦ä¹ å™¨çš„è¾“å‡ºç»“æœå½“æˆè¿ç»­å€¼ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯å¯ä»¥å¯¹æ¯ä¸ªå¼±å­¦ä¹ å™¨çš„ç»“æœè¿›è¡Œç´¯åŠ å¤„ç†ï¼Œä¸”èƒ½æ›´å¥½çš„åˆ©ç”¨æŸå¤±å‡½æ•°æ¥ä¼˜åŒ–æ¨¡å‹ã€‚\nå‡è®¾\næ˜¯ç¬¬ t è½®å¼±å­¦ä¹ å™¨çš„è¾“å‡ºç»“æœï¼Œ\næ˜¯æ¨¡å‹çš„è¾“å‡ºç»“æœï¼Œ\næ˜¯å®é™…è¾“å‡ºç»“æœï¼Œè¡¨è¾¾å¼å¦‚ä¸‹ï¼š\nä¸Šé¢ä¸¤å¼å°±æ˜¯åŠ æ³•æ¨¡å‹ï¼Œéƒ½é»˜è®¤å¼±å­¦ä¹ å™¨çš„è¾“å‡ºç»“æœæ˜¯è¿ç»­å€¼ã€‚å› ä¸ºå›å½’ä»»åŠ¡çš„å¼±å­¦ä¹ å™¨æœ¬èº«æ˜¯è¿ç»­å€¼ï¼Œæ‰€ä»¥ä¸åšè®¨è®ºï¼Œä¸‹é¢è¯¦ç»†ä»‹ç»åˆ†ç±»ä»»åŠ¡çš„å›å½’æ€æƒ³ã€‚\nåˆ†ç±»ä»»åŠ¡çš„å›å½’æ€æƒ³ï¼š\næ ¹æ®2.1å¼çš„ç»“æœï¼Œå¾—åˆ°æœ€ç»ˆçš„åˆ†ç±»å™¨ï¼š\nåˆ†ç±»çš„æŸå¤±å‡½æ•°ä¸€èˆ¬é€‰æ‹©æŒ‡æ•°å‡½æ•°æˆ–å¯¹æ•°å‡½æ•°ï¼Œè¿™é‡Œå‡è®¾æŸå¤±å‡½æ•°ä¸ºå¯¹æ•°å‡½æ•°ï¼Œå­¦ä¹ å™¨çš„æŸå¤±å‡½æ•°æ˜¯\nè‹¥å®é™…è¾“å‡ºç»“æœyi=1ï¼Œåˆ™ï¼š\næ±‚ï¼ˆ2.5ï¼‰å¼å¯¹","title":"é›†æˆå­¦ä¹ ä¹‹xgboost"},{"content":"Boostingç®—æ³•çš„å·¥ä½œæœºåˆ¶ ç”¨åˆå§‹æƒé‡D(1)ä»æ•°æ®é›†ä¸­è®­ç»ƒå‡ºä¸€ä¸ªå¼±å­¦ä¹ å™¨1 æ ¹æ®å¼±å­¦ä¹ 1çš„å­¦ä¹ è¯¯å·®ç‡è¡¨ç°æ¥æ›´æ–°è®­ç»ƒæ ·æœ¬çš„æƒé‡D(2)ï¼Œä½¿å¾—ä¹‹å‰å¼±å­¦ä¹ å™¨1å­¦ä¹ è¯¯å·®ç‡é«˜çš„æ ·æœ¬ç‚¹çš„æƒé‡å˜é«˜ï¼Œä½¿å¾—è¿™äº›è¯¯å·®ç‡é«˜çš„ç‚¹åœ¨åé¢çš„å¼±å­¦ä¹ å™¨2ä¸­å¾—åˆ°æ›´å¤šçš„é‡è§†ã€‚ ç„¶ååŸºäºè°ƒæ•´æƒé‡åçš„è®­ç»ƒé›†æ¥è®­ç»ƒå¼±å­¦ä¹ å™¨2 å¦‚æ­¤é‡å¤è¿›è¡Œï¼Œç›´åˆ°å¼±å­¦ä¹ å™¨æ•°è¾¾åˆ°äº‹å…ˆæŒ‡å®šçš„æ•°ç›®Tï¼Œæœ€ç»ˆå°†è¿™Tä¸ªå¼±å­¦ä¹ å™¨é€šè¿‡é›†åˆç­–ç•¥è¿›è¡Œæ•´åˆï¼Œå¾—åˆ°æœ€ç»ˆçš„å¼ºå­¦ä¹ å™¨ã€‚ ç°å¦‚ä»Šå·²ç»æœ‰å¾ˆå¤šçš„æå‡æ–¹æ³•äº†ï¼Œä½†æœ€è‘—åçš„å°±æ˜¯Adaboostï¼ˆé€‚åº”æ€§æå‡ï¼Œæ˜¯Adaptive Boostingçš„ç®€ç§°ï¼‰å’ŒGradient Boostingï¼ˆæ¢¯åº¦æå‡ï¼‰ã€‚è®©æˆ‘ä»¬å…ˆä» Adaboost è¯´èµ·ã€‚\nä»€ä¹ˆæ˜¯AdaBoost AdaBoostæ˜¯ä¸€ä¸ªå…·æœ‰é‡Œç¨‹ç¢‘æ„ä¹‰çš„ç®—æ³•ï¼Œå…¶ä¸­ï¼Œé€‚åº”æ€§ï¼ˆadaptiveï¼‰æ˜¯æŒ‡ï¼šåç»­çš„åˆ†ç±»å™¨ä¸ºæ›´å¥½åœ°æ”¯æŒè¢«å…ˆå‰åˆ†ç±»å™¨åˆ†ç±»é”™è¯¯çš„æ ·æœ¬å®ä¾‹è€Œè¿›è¡Œè°ƒæ•´ã€‚é€šè¿‡å¯¹ä¹‹å‰åˆ†ç±»ç»“æœä¸å¯¹çš„è®­ç»ƒå®ä¾‹å¤šåŠ å…³æ³¨ï¼Œä½¿æ–°çš„é¢„æµ‹å› å­è¶Šæ¥è¶Šå¤šåœ°èšç„¦äºä¹‹å‰é”™è¯¯çš„æƒ…å†µã€‚\nå…·ä½“è¯´æ¥ï¼Œæ•´ä¸ªAdaBoostè¿­ä»£ç®—æ³•å°±3æ­¥ï¼š\nåˆå§‹åŒ–è®­ç»ƒæ•°æ®çš„æƒå€¼åˆ†å¸ƒã€‚å¦‚æœæœ‰Nä¸ªæ ·æœ¬ï¼Œåˆ™æ¯ä¸€ä¸ªè®­ç»ƒæ ·æœ¬æœ€å¼€å§‹æ—¶éƒ½è¢«èµ‹äºˆç›¸åŒçš„æƒå€¼ï¼šã€‚ è®­ç»ƒå¼±åˆ†ç±»å™¨ã€‚å…·ä½“è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæŸä¸ªæ ·æœ¬ç‚¹å·²ç»è¢«å‡†ç¡®åœ°åˆ†ç±»ï¼Œé‚£ä¹ˆåœ¨æ„é€ ä¸‹ä¸€ä¸ªè®­ç»ƒé›†ä¸­ï¼Œå®ƒçš„æƒå€¼å°±è¢«é™ä½ï¼›ç›¸åï¼Œå¦‚æœæŸä¸ªæ ·æœ¬ç‚¹æ²¡æœ‰è¢«å‡†ç¡®åœ°åˆ†ç±»ï¼Œé‚£ä¹ˆå®ƒçš„æƒå€¼å°±å¾—åˆ°æé«˜ã€‚ç„¶åï¼Œæƒå€¼æ›´æ–°è¿‡çš„æ ·æœ¬é›†è¢«ç”¨äºè®­ç»ƒä¸‹ä¸€ä¸ªåˆ†ç±»å™¨ï¼Œæ•´ä¸ªè®­ç»ƒè¿‡ç¨‹å¦‚æ­¤è¿­ä»£åœ°è¿›è¡Œä¸‹å»ã€‚ å°†å„ä¸ªè®­ç»ƒå¾—åˆ°çš„å¼±åˆ†ç±»å™¨ç»„åˆæˆå¼ºåˆ†ç±»å™¨ã€‚å„ä¸ªå¼±åˆ†ç±»å™¨çš„è®­ç»ƒè¿‡ç¨‹ç»“æŸåï¼ŒåŠ å¤§åˆ†ç±»è¯¯å·®ç‡å°çš„å¼±åˆ†ç±»å™¨çš„æƒé‡ï¼Œä½¿å…¶åœ¨æœ€ç»ˆçš„åˆ†ç±»å‡½æ•°ä¸­èµ·ç€è¾ƒå¤§çš„å†³å®šä½œç”¨ï¼Œè€Œé™ä½åˆ†ç±»è¯¯å·®ç‡å¤§çš„å¼±åˆ†ç±»å™¨çš„æƒé‡ï¼Œä½¿å…¶åœ¨æœ€ç»ˆçš„åˆ†ç±»å‡½æ•°ä¸­èµ·ç€è¾ƒå°çš„å†³å®šä½œç”¨ã€‚æ¢è¨€ä¹‹ï¼Œè¯¯å·®ç‡ä½çš„å¼±åˆ†ç±»å™¨åœ¨æœ€ç»ˆåˆ†ç±»å™¨ä¸­å çš„æƒé‡è¾ƒå¤§ï¼Œå¦åˆ™è¾ƒå°ã€‚ åŠ æ³•æ¨¡å‹ä¸å‰å‘åˆ†å¸ƒ åœ¨å­¦ä¹ AdaBoostä¹‹å‰éœ€è¦äº†è§£ä¸¤ä¸ªæ•°å­¦é—®é¢˜ï¼Œè¿™ä¸¤ä¸ªæ•°å­¦é—®é¢˜å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£AdaBoostç®—æ³•ï¼Œå¹¶ä¸”åœ¨é¢è¯•å®˜é—®ä½ ç®—æ³•åŸç†æ—¶ä¸è‡³äºå‘æ‡µã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹åŠ æ³•æ¨¡å‹ä¸å‰å‘åˆ†å¸ƒã€‚\nä»€ä¹ˆæ˜¯åŠ æ³•æ¨¡å‹ å½“åˆ«äººé—®ä½ â€œä»€ä¹ˆæ˜¯åŠ æ³•æ¨¡å‹â€æ—¶ï¼Œä½ åº”å½“çŸ¥é“ï¼šåŠ æ³•æ¨¡å‹é¡¾åæ€ä¹‰å°±æ˜¯æŠŠå„ç§ä¸œè¥¿åŠ èµ·æ¥æ±‚å’Œã€‚å¦‚æœæƒ³è¦æ›´ä¸¥è°¨çš„å®šä¹‰ï¼Œä¸å¦¨ç”¨æ•°å­¦å…¬å¼æ¥è¡¨è¾¾ï¼š è¿™ä¸ªå…¬å¼çœ‹ä¸Šå»å¯èƒ½æœ‰äº›ç³Šæ¶‚ï¼Œå¦‚æœæˆ‘ä»¬å¥—ç”¨åˆ°æå‡æ ‘æ¨¡å‹ä¸­å°±æ¯”è¾ƒå®¹æ˜“ç†è§£ä¸€äº›ã€‚FM(x)è¡¨ç¤ºæœ€ç»ˆç”Ÿæˆçš„æœ€å¥½çš„æå‡æ ‘ï¼Œå…¶ä¸­Mè¡¨ç¤ºç´¯åŠ çš„æ ‘çš„ä¸ªæ•°ã€‚b(x;ym)è¡¨ç¤ºä¸€ä¸ªå†³ç­–æ ‘ï¼Œ$é˜¿å°”æ³•m$ è¡¨ç¤ºç¬¬mä¸ªå†³ç­–æ ‘çš„æƒé‡ï¼Œymè¡¨ç¤ºå†³ç­–æ ‘çš„å‚æ•°ï¼ˆå¦‚å¶èŠ‚ç‚¹çš„ä¸ªæ•°ï¼‰ã€‚\nä»€ä¹ˆæ˜¯å‰å‘åˆ†å¸ƒ é‚£ä¹ˆä»€ä¹ˆæ˜¯å‰å‘åˆ†å¸ƒç®—æ³•å‘¢ï¼Ÿåœ¨æŸå¤±å‡½æ•° çš„æ¡ä»¶ä¸‹ï¼ŒåŠ æ³•æ¨¡å‹FM(x)æˆä¸ºä¸€ä¸ªç»éªŒé£é™©æå°åŒ–é—®é¢˜ï¼Œå³ä½¿å¾—æŸå¤±å‡½æ•°æå°åŒ–ï¼š å‰å‘åˆ†å¸ƒç®—æ³•å°±æ˜¯æ±‚è§£è¿™ä¸ªä¼˜åŒ–é—®é¢˜çš„ä¸€ä¸ªæ€æƒ³ï¼šå› ä¸ºå­¦ä¹ çš„æ˜¯åŠ æ³•æ¨¡å‹ï¼Œå¦‚æœèƒ½å¤Ÿä»å‰å‘åï¼Œæ¯ä¸€æ­¥åªå­¦ä¹ ä¸€ä¸ªåŸºå‡½æ•°ï¼ˆä¸€æ£µå†³ç­–æ ‘ï¼‰åŠå…¶æƒé‡ï¼Œåˆ©ç”¨æ®‹å·®é€æ­¥é€¼è¿‘ä¼˜åŒ–é—®é¢˜ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç®€åŒ–ä¼˜åŒ–çš„å¤æ‚åº¦ã€‚ä»è€Œå¾—åˆ°å‰å‘åˆ†å¸ƒç®—æ³•ä¸ºï¼š\nå¥—ç”¨åœ¨æå‡æ ‘æ¨¡å‹ä¸­è¿›è¡Œç†è§£å°±æ˜¯ï¼š$fm-1(x)$æ˜¯å‰ä¸€æ£µæå‡æ ‘ï¼ˆä¹‹å‰æ ‘çš„ç´¯åŠ ï¼‰ï¼Œåœ¨å…¶åŸºç¡€ä¸Šå†åŠ ä¸Šä¸€æ£µæ ‘$Bxi, Ym$ä¹˜ä¸Šå®ƒçš„æƒé‡ç³»æ•°ï¼Œç”¨è¿™æ£µæ ‘å»æ‹Ÿåˆçš„æ®‹å·®!$é˜¿å°”æ³•m$ï¼ˆè§‚å¯Ÿå€¼ä¸ä¼°è®¡å€¼ä¹‹é—´çš„å·®ï¼‰ï¼Œå†å°†è¿™ä¸¤æ£µæ ‘åˆåœ¨ä¸€èµ·å°±å¾—åˆ°äº†æ–°çš„æå‡æ ‘ã€‚å®é™…ä¸Šå°±æ˜¯è®©ä¸‹ä¸€ä¸ªåŸºåˆ†ç±»å™¨å»æ‹Ÿåˆå½“å‰åˆ†ç±»å™¨å­¦ä¹ å‡ºæ¥çš„æ®‹å·®ã€‚\nå‰å‘åˆ†å¸ƒä¸AdaboostæŸå¤±å‡½æ•°ä¼˜åŒ–çš„å…³ç³» ç°åœ¨äº†è§£äº†åŠ æ³•æ¨¡å‹ä¸å‰å‘åˆ†å¸ƒã€‚é‚£è¿™ä¸¤ä¸ªæ¦‚å¿µä¸Adabooståˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ\nAdaboostå¯ä»¥è®¤ä¸ºå…¶æ¨¡å‹æ˜¯åŠ æ³•æ¨¡å‹ã€æŸå¤±å‡½æ•°ä¸ºæŒ‡æ•°å‡½æ•°ã€å­¦ä¹ ç®—æ³•ä¸ºå‰å‘åˆ†æ­¥ç®—æ³•çš„äºŒç±»åˆ†ç±»å­¦ä¹ æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‰å‘åˆ†å¸ƒç®—æ³•ä½œä¸ºæ¡†æ¶ï¼Œæ¨å¯¼å‡ºAdaboostç®—æ³•çš„æŸå¤±å‡½æ•°ä¼˜åŒ–é—®é¢˜çš„ã€‚\nåœ¨Adaboostä¸­ï¼Œå„ä¸ªåŸºæœ¬åˆ†ç±»å™¨å°±ç›¸å½“äºåŠ æ³•æ¨¡å‹ä¸­çš„åŸºå‡½æ•°$fm-1(x)$ï¼Œä¸”å…¶æŸå¤±å‡½æ•°ä¸ºæŒ‡æ•°å‡½æ•°$b(xi;ym)$ã€‚\nå³ï¼Œéœ€è¦ä¼˜åŒ–çš„é—®é¢˜å¦‚ä¸‹ï¼š å¦‚æœæˆ‘ä»¬ä»¤ï¼Œåˆ™ä¸Šè¿°å…¬å¼å¯ä»¥æ”¹å†™æˆä¸ºï¼š å› ä¸ºä¸è¦ä¹ˆç›¸ç­‰ã€è¦ä¹ˆä¸ç­‰ã€‚æ‰€ä»¥å¯ä»¥å°†å…¶æ‹†æˆä¸¤éƒ¨åˆ†ç›¸åŠ çš„å½¢å¼ï¼š\nç®—æ³•ä¸­éœ€è¦å…³æ³¨çš„å†…å®¹ é¦–å…ˆçœ‹çœ‹ç®—æ³•ä¸­éƒ½å…³æ³¨äº†å“ªäº›å†…å®¹ï¼š é¦–å…ˆï¼Œæˆ‘ä»¬å‡è®¾è®­ç»ƒæ ·æœ¬ä¸º$(x1,y1), (x2, y2)\u0026hellip;(xn, yn)$\nç”±äºAdaBoostæ˜¯ç”±ä¸€ä¸ªä¸ªçš„å¼±åˆ†ç±»å™¨è¿­ä»£è®­ç»ƒå¾—åˆ°ä¸€ä¸ªå¼ºåˆ†ç±»å™¨çš„ï¼Œå› æ­¤æˆ‘ä»¬æœ‰å¦‚ä¸‹å®šä¹‰ï¼š\nå¼±åˆ†ç±»å™¨è¡¨è¾¾å¼ï¼š$Ht(x)$ å…ˆä»¥äºŒåˆ†ç±»ä¸ºä¾‹ï¼Œå®ƒè¾“å‡ºçš„å€¼ä¸º1æˆ–-1ï¼Œåˆ™æœ‰ï¼š$Ht(x) âˆˆ{-1, 1}$\né¦–å…ˆï¼Œæˆ‘ä»¬å‡è®¾è®­ç»ƒæ ·æœ¬ä¸º ç”±äºAdaBoostæ˜¯ç”±ä¸€ä¸ªä¸ªçš„å¼±åˆ†ç±»å™¨è¿­ä»£è®­ç»ƒå¾—åˆ°ä¸€ä¸ªå¼ºåˆ†ç±»å™¨çš„ï¼Œå› æ­¤æˆ‘ä»¬æœ‰å¦‚ä¸‹å®šä¹‰ï¼š\nå¼±åˆ†ç±»å™¨è¡¨è¾¾å¼ï¼š å…¬å¼æ¨å¯¼ï¼ˆé€šè¿‡Zæœ€å°åŒ–è®­ç»ƒè¯¯å·®) Adaboostç®—æ³•ä¹‹æ‰€ä»¥ç§°ä¸ºåå¤§ç®—æ³•ä¹‹ä¸€ï¼Œæœ‰ä¸€ä¸ªé‡è¦åŸå› å°±æ˜¯å®ƒæœ‰å®Œç¾çš„æ•°å­¦æ¨å¯¼è¿‡ç¨‹ï¼Œå…¶å‚æ•°ä¸æ˜¯äººå·¥è®¾å®šçš„ï¼Œè€Œæ˜¯æœ‰è§£æè§£çš„ï¼Œå¹¶ä¸”å¯ä»¥è¯æ˜å…¶è¯¯å·®ä¸Šç•Œè¶Šæ¥è¶Šå°ï¼Œè¶‹è¿‘äºé›¶ï¼›ä¸”å¯ä»¥æ¨å¯¼å‡ºæ¥ã€‚ä¸‹é¢å°±æ¥çœ‹ä¸€ä¸‹å…¬å¼æ¨å¯¼ã€‚\næƒé‡å…¬å¼: é¦–å…ˆè¦æŠŠæ¨¡å‹çš„è¯¯å·®è¡¨ç¤ºå‡ºæ¥ï¼Œåªæœ‰ç”¨æ•°å­¦å…¬å¼è¡¨ç¤ºå‡ºæ¥ï¼Œæ‰èƒ½å¤Ÿè®²æ¨¡å‹çš„ä¼˜åŒ–ã€‚\nå…ˆçœ‹ç¬¬iä¸ªæ ·æœ¬åœ¨t+1ä¸ªå¼±å­¦ä¹ å™¨çš„æƒé‡æ˜¯æ€æ ·çš„? æ¨¡å‹è¯¯å·®ä¸Šé™ æ¨¡å‹è¯¯å·®ä¸Šé™æœ€å°åŒ–ä¸Z æ±‚å‡ºZ æ—¢ç„¶æœ€å°åŒ–Ztå°±ç­‰åŒäºæœ€å°åŒ–æ¨¡å‹è¯¯å·®ä¸Šç•Œï¼Œé‚£æˆ‘ä»¬å¾—å…ˆçŸ¥é“Zté•¿ä»€ä¹ˆæ ·ï¼Œç„¶åæ‰èƒ½å»æœ€å°åŒ–å®ƒã€‚\næˆ‘ä»¬åœ¨å‰é¢å·²ç»è¯´è¿‡ï¼Œä¸ºäº†ä¿è¯æ‰€æœ‰æ ·æœ¬çš„æƒé‡åŠ èµ·æ¥ç­‰äº1ã€‚å› æ­¤éœ€è¦å¯¹æ¯ä¸ªæƒé‡é™¤ä»¥å½’ä¸€åŒ–ç³»æ•°ã€‚å³Ztå®é™…ä¸Šå°±æ˜¯t+1æ—¶åˆ»æ‰€æœ‰æ ·æœ¬åŸå§‹æƒé‡å’Œï¼Œä¹Ÿå°±æ˜¯æ—¶åˆ»çš„å„ç‚¹æƒé‡ä¹˜ä»¥è°ƒæ•´å¹…åº¦å†ç´¯åŠ ï¼š\næ±‚å‡ºä½¿å¾—Zæœ€å°çš„å‚æ•°a AdaBoostè®¡ç®—æ­¥éª¤æ¢³ç†åŠä¼˜ç¼ºç‚¹ ç†è®ºä¸Šä»»ä½•å­¦ä¹ å™¨éƒ½å¯ä»¥ç”¨äºAdaboostã€‚ä½†ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨æœ€å¹¿æ³›çš„Adaboostå¼±å­¦ä¹ å™¨æ˜¯å†³ç­–æ ‘å’Œç¥ç»ç½‘ç»œã€‚å¯¹äºå†³ç­–æ ‘ï¼ŒAdabooståˆ†ç±»ç”¨äº†CARTåˆ†ç±»æ ‘ï¼Œè€ŒAdaboostå›å½’ç”¨äº†CARTå›å½’æ ‘ã€‚\n","permalink":"https://reid00.github.io/en/posts/ml/%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0%E4%B9%8Badaboost/","summary":"Boostingç®—æ³•çš„å·¥ä½œæœºåˆ¶ ç”¨åˆå§‹æƒé‡D(1)ä»æ•°æ®é›†ä¸­è®­ç»ƒå‡ºä¸€ä¸ªå¼±å­¦ä¹ å™¨1 æ ¹æ®å¼±å­¦ä¹ 1çš„å­¦ä¹ è¯¯å·®ç‡è¡¨ç°æ¥æ›´æ–°è®­ç»ƒæ ·æœ¬çš„æƒé‡D(2)ï¼Œä½¿å¾—ä¹‹å‰å¼±å­¦ä¹ å™¨1å­¦ä¹ è¯¯å·®ç‡é«˜çš„æ ·æœ¬ç‚¹çš„æƒé‡å˜é«˜ï¼Œä½¿å¾—è¿™äº›è¯¯å·®ç‡é«˜çš„ç‚¹åœ¨åé¢çš„å¼±å­¦ä¹ å™¨2ä¸­å¾—åˆ°æ›´å¤šçš„é‡è§†ã€‚ ç„¶ååŸºäºè°ƒæ•´æƒé‡åçš„è®­ç»ƒé›†æ¥è®­ç»ƒå¼±å­¦ä¹ å™¨2 å¦‚æ­¤é‡å¤è¿›è¡Œï¼Œç›´åˆ°å¼±å­¦ä¹ å™¨æ•°è¾¾åˆ°äº‹å…ˆæŒ‡å®šçš„æ•°ç›®Tï¼Œæœ€ç»ˆå°†è¿™Tä¸ªå¼±å­¦ä¹ å™¨é€šè¿‡é›†åˆç­–ç•¥è¿›è¡Œæ•´åˆï¼Œå¾—åˆ°æœ€ç»ˆçš„å¼ºå­¦ä¹ å™¨ã€‚ ç°å¦‚ä»Šå·²ç»æœ‰å¾ˆå¤šçš„æå‡æ–¹æ³•äº†ï¼Œä½†æœ€è‘—åçš„å°±æ˜¯Adaboostï¼ˆé€‚åº”æ€§æå‡ï¼Œæ˜¯Adaptive Boostingçš„ç®€ç§°ï¼‰å’ŒGradient Boostingï¼ˆæ¢¯åº¦æå‡ï¼‰ã€‚è®©æˆ‘ä»¬å…ˆä» Adaboost è¯´èµ·ã€‚\nä»€ä¹ˆæ˜¯AdaBoost AdaBoostæ˜¯ä¸€ä¸ªå…·æœ‰é‡Œç¨‹ç¢‘æ„ä¹‰çš„ç®—æ³•ï¼Œå…¶ä¸­ï¼Œé€‚åº”æ€§ï¼ˆadaptiveï¼‰æ˜¯æŒ‡ï¼šåç»­çš„åˆ†ç±»å™¨ä¸ºæ›´å¥½åœ°æ”¯æŒè¢«å…ˆå‰åˆ†ç±»å™¨åˆ†ç±»é”™è¯¯çš„æ ·æœ¬å®ä¾‹è€Œè¿›è¡Œè°ƒæ•´ã€‚é€šè¿‡å¯¹ä¹‹å‰åˆ†ç±»ç»“æœä¸å¯¹çš„è®­ç»ƒå®ä¾‹å¤šåŠ å…³æ³¨ï¼Œä½¿æ–°çš„é¢„æµ‹å› å­è¶Šæ¥è¶Šå¤šåœ°èšç„¦äºä¹‹å‰é”™è¯¯çš„æƒ…å†µã€‚\nå…·ä½“è¯´æ¥ï¼Œæ•´ä¸ªAdaBoostè¿­ä»£ç®—æ³•å°±3æ­¥ï¼š\nåˆå§‹åŒ–è®­ç»ƒæ•°æ®çš„æƒå€¼åˆ†å¸ƒã€‚å¦‚æœæœ‰Nä¸ªæ ·æœ¬ï¼Œåˆ™æ¯ä¸€ä¸ªè®­ç»ƒæ ·æœ¬æœ€å¼€å§‹æ—¶éƒ½è¢«èµ‹äºˆç›¸åŒçš„æƒå€¼ï¼šã€‚ è®­ç»ƒå¼±åˆ†ç±»å™¨ã€‚å…·ä½“è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæŸä¸ªæ ·æœ¬ç‚¹å·²ç»è¢«å‡†ç¡®åœ°åˆ†ç±»ï¼Œé‚£ä¹ˆåœ¨æ„é€ ä¸‹ä¸€ä¸ªè®­ç»ƒé›†ä¸­ï¼Œå®ƒçš„æƒå€¼å°±è¢«é™ä½ï¼›ç›¸åï¼Œå¦‚æœæŸä¸ªæ ·æœ¬ç‚¹æ²¡æœ‰è¢«å‡†ç¡®åœ°åˆ†ç±»ï¼Œé‚£ä¹ˆå®ƒçš„æƒå€¼å°±å¾—åˆ°æé«˜ã€‚ç„¶åï¼Œæƒå€¼æ›´æ–°è¿‡çš„æ ·æœ¬é›†è¢«ç”¨äºè®­ç»ƒä¸‹ä¸€ä¸ªåˆ†ç±»å™¨ï¼Œæ•´ä¸ªè®­ç»ƒè¿‡ç¨‹å¦‚æ­¤è¿­ä»£åœ°è¿›è¡Œä¸‹å»ã€‚ å°†å„ä¸ªè®­ç»ƒå¾—åˆ°çš„å¼±åˆ†ç±»å™¨ç»„åˆæˆå¼ºåˆ†ç±»å™¨ã€‚å„ä¸ªå¼±åˆ†ç±»å™¨çš„è®­ç»ƒè¿‡ç¨‹ç»“æŸåï¼ŒåŠ å¤§åˆ†ç±»è¯¯å·®ç‡å°çš„å¼±åˆ†ç±»å™¨çš„æƒé‡ï¼Œä½¿å…¶åœ¨æœ€ç»ˆçš„åˆ†ç±»å‡½æ•°ä¸­èµ·ç€è¾ƒå¤§çš„å†³å®šä½œç”¨ï¼Œè€Œé™ä½åˆ†ç±»è¯¯å·®ç‡å¤§çš„å¼±åˆ†ç±»å™¨çš„æƒé‡ï¼Œä½¿å…¶åœ¨æœ€ç»ˆçš„åˆ†ç±»å‡½æ•°ä¸­èµ·ç€è¾ƒå°çš„å†³å®šä½œç”¨ã€‚æ¢è¨€ä¹‹ï¼Œè¯¯å·®ç‡ä½çš„å¼±åˆ†ç±»å™¨åœ¨æœ€ç»ˆåˆ†ç±»å™¨ä¸­å çš„æƒé‡è¾ƒå¤§ï¼Œå¦åˆ™è¾ƒå°ã€‚ åŠ æ³•æ¨¡å‹ä¸å‰å‘åˆ†å¸ƒ åœ¨å­¦ä¹ AdaBoostä¹‹å‰éœ€è¦äº†è§£ä¸¤ä¸ªæ•°å­¦é—®é¢˜ï¼Œè¿™ä¸¤ä¸ªæ•°å­¦é—®é¢˜å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£AdaBoostç®—æ³•ï¼Œå¹¶ä¸”åœ¨é¢è¯•å®˜é—®ä½ ç®—æ³•åŸç†æ—¶ä¸è‡³äºå‘æ‡µã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹åŠ æ³•æ¨¡å‹ä¸å‰å‘åˆ†å¸ƒã€‚\nä»€ä¹ˆæ˜¯åŠ æ³•æ¨¡å‹ å½“åˆ«äººé—®ä½ â€œä»€ä¹ˆæ˜¯åŠ æ³•æ¨¡å‹â€æ—¶ï¼Œä½ åº”å½“çŸ¥é“ï¼šåŠ æ³•æ¨¡å‹é¡¾åæ€ä¹‰å°±æ˜¯æŠŠå„ç§ä¸œè¥¿åŠ èµ·æ¥æ±‚å’Œã€‚å¦‚æœæƒ³è¦æ›´ä¸¥è°¨çš„å®šä¹‰ï¼Œä¸å¦¨ç”¨æ•°å­¦å…¬å¼æ¥è¡¨è¾¾ï¼š è¿™ä¸ªå…¬å¼çœ‹ä¸Šå»å¯èƒ½æœ‰äº›ç³Šæ¶‚ï¼Œå¦‚æœæˆ‘ä»¬å¥—ç”¨åˆ°æå‡æ ‘æ¨¡å‹ä¸­å°±æ¯”è¾ƒå®¹æ˜“ç†è§£ä¸€äº›ã€‚FM(x)è¡¨ç¤ºæœ€ç»ˆç”Ÿæˆçš„æœ€å¥½çš„æå‡æ ‘ï¼Œå…¶ä¸­Mè¡¨ç¤ºç´¯åŠ çš„æ ‘çš„ä¸ªæ•°ã€‚b(x;ym)è¡¨ç¤ºä¸€ä¸ªå†³ç­–æ ‘ï¼Œ$é˜¿å°”æ³•m$ è¡¨ç¤ºç¬¬mä¸ªå†³ç­–æ ‘çš„æƒé‡ï¼Œymè¡¨ç¤ºå†³ç­–æ ‘çš„å‚æ•°ï¼ˆå¦‚å¶èŠ‚ç‚¹çš„ä¸ªæ•°ï¼‰ã€‚\nä»€ä¹ˆæ˜¯å‰å‘åˆ†å¸ƒ é‚£ä¹ˆä»€ä¹ˆæ˜¯å‰å‘åˆ†å¸ƒç®—æ³•å‘¢ï¼Ÿåœ¨æŸå¤±å‡½æ•° çš„æ¡ä»¶ä¸‹ï¼ŒåŠ æ³•æ¨¡å‹FM(x)æˆä¸ºä¸€ä¸ªç»éªŒé£é™©æå°åŒ–é—®é¢˜ï¼Œå³ä½¿å¾—æŸå¤±å‡½æ•°æå°åŒ–ï¼š å‰å‘åˆ†å¸ƒç®—æ³•å°±æ˜¯æ±‚è§£è¿™ä¸ªä¼˜åŒ–é—®é¢˜çš„ä¸€ä¸ªæ€æƒ³ï¼šå› ä¸ºå­¦ä¹ çš„æ˜¯åŠ æ³•æ¨¡å‹ï¼Œå¦‚æœèƒ½å¤Ÿä»å‰å‘åï¼Œæ¯ä¸€æ­¥åªå­¦ä¹ ä¸€ä¸ªåŸºå‡½æ•°ï¼ˆä¸€æ£µå†³ç­–æ ‘ï¼‰åŠå…¶æƒé‡ï¼Œåˆ©ç”¨æ®‹å·®é€æ­¥é€¼è¿‘ä¼˜åŒ–é—®é¢˜ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç®€åŒ–ä¼˜åŒ–çš„å¤æ‚åº¦ã€‚ä»è€Œå¾—åˆ°å‰å‘åˆ†å¸ƒç®—æ³•ä¸ºï¼š\nå¥—ç”¨åœ¨æå‡æ ‘æ¨¡å‹ä¸­è¿›è¡Œç†è§£å°±æ˜¯ï¼š$fm-1(x)$æ˜¯å‰ä¸€æ£µæå‡æ ‘ï¼ˆä¹‹å‰æ ‘çš„ç´¯åŠ ï¼‰ï¼Œåœ¨å…¶åŸºç¡€ä¸Šå†åŠ ä¸Šä¸€æ£µæ ‘$Bxi, Ym$ä¹˜ä¸Šå®ƒçš„æƒé‡ç³»æ•°ï¼Œç”¨è¿™æ£µæ ‘å»æ‹Ÿåˆçš„æ®‹å·®!$é˜¿å°”æ³•m$ï¼ˆè§‚å¯Ÿå€¼ä¸ä¼°è®¡å€¼ä¹‹é—´çš„å·®ï¼‰ï¼Œå†å°†è¿™ä¸¤æ£µæ ‘åˆåœ¨ä¸€èµ·å°±å¾—åˆ°äº†æ–°çš„æå‡æ ‘ã€‚å®é™…ä¸Šå°±æ˜¯è®©ä¸‹ä¸€ä¸ªåŸºåˆ†ç±»å™¨å»æ‹Ÿåˆå½“å‰åˆ†ç±»å™¨å­¦ä¹ å‡ºæ¥çš„æ®‹å·®ã€‚\nå‰å‘åˆ†å¸ƒä¸AdaboostæŸå¤±å‡½æ•°ä¼˜åŒ–çš„å…³ç³» ç°åœ¨äº†è§£äº†åŠ æ³•æ¨¡å‹ä¸å‰å‘åˆ†å¸ƒã€‚é‚£è¿™ä¸¤ä¸ªæ¦‚å¿µä¸Adabooståˆæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ\nAdaboostå¯ä»¥è®¤ä¸ºå…¶æ¨¡å‹æ˜¯åŠ æ³•æ¨¡å‹ã€æŸå¤±å‡½æ•°ä¸ºæŒ‡æ•°å‡½æ•°ã€å­¦ä¹ ç®—æ³•ä¸ºå‰å‘åˆ†æ­¥ç®—æ³•çš„äºŒç±»åˆ†ç±»å­¦ä¹ æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‰å‘åˆ†å¸ƒç®—æ³•ä½œä¸ºæ¡†æ¶ï¼Œæ¨å¯¼å‡ºAdaboostç®—æ³•çš„æŸå¤±å‡½æ•°ä¼˜åŒ–é—®é¢˜çš„ã€‚\nåœ¨Adaboostä¸­ï¼Œå„ä¸ªåŸºæœ¬åˆ†ç±»å™¨å°±ç›¸å½“äºåŠ æ³•æ¨¡å‹ä¸­çš„åŸºå‡½æ•°$fm-1(x)$ï¼Œä¸”å…¶æŸå¤±å‡½æ•°ä¸ºæŒ‡æ•°å‡½æ•°$b(xi;ym)$ã€‚\nå³ï¼Œéœ€è¦ä¼˜åŒ–çš„é—®é¢˜å¦‚ä¸‹ï¼š å¦‚æœæˆ‘ä»¬ä»¤ï¼Œåˆ™ä¸Šè¿°å…¬å¼å¯ä»¥æ”¹å†™æˆä¸ºï¼š å› ä¸ºä¸è¦ä¹ˆç›¸ç­‰ã€è¦ä¹ˆä¸ç­‰ã€‚æ‰€ä»¥å¯ä»¥å°†å…¶æ‹†æˆä¸¤éƒ¨åˆ†ç›¸åŠ çš„å½¢å¼ï¼š\nç®—æ³•ä¸­éœ€è¦å…³æ³¨çš„å†…å®¹ é¦–å…ˆçœ‹çœ‹ç®—æ³•ä¸­éƒ½å…³æ³¨äº†å“ªäº›å†…å®¹ï¼š é¦–å…ˆï¼Œæˆ‘ä»¬å‡è®¾è®­ç»ƒæ ·æœ¬ä¸º$(x1,y1), (x2, y2)\u0026hellip;(xn, yn)$\nç”±äºAdaBoostæ˜¯ç”±ä¸€ä¸ªä¸ªçš„å¼±åˆ†ç±»å™¨è¿­ä»£è®­ç»ƒå¾—åˆ°ä¸€ä¸ªå¼ºåˆ†ç±»å™¨çš„ï¼Œå› æ­¤æˆ‘ä»¬æœ‰å¦‚ä¸‹å®šä¹‰ï¼š\nå¼±åˆ†ç±»å™¨è¡¨è¾¾å¼ï¼š$Ht(x)$ å…ˆä»¥äºŒåˆ†ç±»ä¸ºä¾‹ï¼Œå®ƒè¾“å‡ºçš„å€¼ä¸º1æˆ–-1ï¼Œåˆ™æœ‰ï¼š$Ht(x) âˆˆ{-1, 1}$\né¦–å…ˆï¼Œæˆ‘ä»¬å‡è®¾è®­ç»ƒæ ·æœ¬ä¸º ç”±äºAdaBoostæ˜¯ç”±ä¸€ä¸ªä¸ªçš„å¼±åˆ†ç±»å™¨è¿­ä»£è®­ç»ƒå¾—åˆ°ä¸€ä¸ªå¼ºåˆ†ç±»å™¨çš„ï¼Œå› æ­¤æˆ‘ä»¬æœ‰å¦‚ä¸‹å®šä¹‰ï¼š\nå¼±åˆ†ç±»å™¨è¡¨è¾¾å¼ï¼š å…¬å¼æ¨å¯¼ï¼ˆé€šè¿‡Zæœ€å°åŒ–è®­ç»ƒè¯¯å·®) Adaboostç®—æ³•ä¹‹æ‰€ä»¥ç§°ä¸ºåå¤§ç®—æ³•ä¹‹ä¸€ï¼Œæœ‰ä¸€ä¸ªé‡è¦åŸå› å°±æ˜¯å®ƒæœ‰å®Œç¾çš„æ•°å­¦æ¨å¯¼è¿‡ç¨‹ï¼Œå…¶å‚æ•°ä¸æ˜¯äººå·¥è®¾å®šçš„ï¼Œè€Œæ˜¯æœ‰è§£æè§£çš„ï¼Œå¹¶ä¸”å¯ä»¥è¯æ˜å…¶è¯¯å·®ä¸Šç•Œè¶Šæ¥è¶Šå°ï¼Œè¶‹è¿‘äºé›¶ï¼›ä¸”å¯ä»¥æ¨å¯¼å‡ºæ¥ã€‚ä¸‹é¢å°±æ¥çœ‹ä¸€ä¸‹å…¬å¼æ¨å¯¼ã€‚\næƒé‡å…¬å¼: é¦–å…ˆè¦æŠŠæ¨¡å‹çš„è¯¯å·®è¡¨ç¤ºå‡ºæ¥ï¼Œåªæœ‰ç”¨æ•°å­¦å…¬å¼è¡¨ç¤ºå‡ºæ¥ï¼Œæ‰èƒ½å¤Ÿè®²æ¨¡å‹çš„ä¼˜åŒ–ã€‚\nå…ˆçœ‹ç¬¬iä¸ªæ ·æœ¬åœ¨t+1ä¸ªå¼±å­¦ä¹ å™¨çš„æƒé‡æ˜¯æ€æ ·çš„? æ¨¡å‹è¯¯å·®ä¸Šé™ æ¨¡å‹è¯¯å·®ä¸Šé™æœ€å°åŒ–ä¸Z æ±‚å‡ºZ æ—¢ç„¶æœ€å°åŒ–Ztå°±ç­‰åŒäºæœ€å°åŒ–æ¨¡å‹è¯¯å·®ä¸Šç•Œï¼Œé‚£æˆ‘ä»¬å¾—å…ˆçŸ¥é“Zté•¿ä»€ä¹ˆæ ·ï¼Œç„¶åæ‰èƒ½å»æœ€å°åŒ–å®ƒã€‚\næˆ‘ä»¬åœ¨å‰é¢å·²ç»è¯´è¿‡ï¼Œä¸ºäº†ä¿è¯æ‰€æœ‰æ ·æœ¬çš„æƒé‡åŠ èµ·æ¥ç­‰äº1ã€‚å› æ­¤éœ€è¦å¯¹æ¯ä¸ªæƒé‡é™¤ä»¥å½’ä¸€åŒ–ç³»æ•°ã€‚å³Ztå®é™…ä¸Šå°±æ˜¯t+1æ—¶åˆ»æ‰€æœ‰æ ·æœ¬åŸå§‹æƒé‡å’Œï¼Œä¹Ÿå°±æ˜¯æ—¶åˆ»çš„å„ç‚¹æƒé‡ä¹˜ä»¥è°ƒæ•´å¹…åº¦å†ç´¯åŠ ï¼š\næ±‚å‡ºä½¿å¾—Zæœ€å°çš„å‚æ•°a AdaBoostè®¡ç®—æ­¥éª¤æ¢³ç†åŠä¼˜ç¼ºç‚¹ ç†è®ºä¸Šä»»ä½•å­¦ä¹ å™¨éƒ½å¯ä»¥ç”¨äºAdaboostã€‚ä½†ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨æœ€å¹¿æ³›çš„Adaboostå¼±å­¦ä¹ å™¨æ˜¯å†³ç­–æ ‘å’Œç¥ç»ç½‘ç»œã€‚å¯¹äºå†³ç­–æ ‘ï¼ŒAdabooståˆ†ç±»ç”¨äº†CARTåˆ†ç±»æ ‘ï¼Œè€ŒAdaboostå›å½’ç”¨äº†CARTå›å½’æ ‘ã€‚","title":"é›†æˆå­¦ä¹ ä¹‹AdaBoost"},{"content":"ç”Ÿæˆå­æ¨¡å‹çš„ä¸¤ç§å–æ ·æ–¹å¼ é‚£ä¹ˆä¸ºäº†é€ æˆå­æ¨¡å‹ä¹‹é—´çš„å·®è·ï¼Œæ¯ä¸ªå­æ¨¡å‹åªçœ‹æ ·æœ¬ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œè¿™å°±æ¶‰åŠåˆ°ä¸¤ç§å–æ ·æ–¹å¼ï¼š\næ”¾å›å–æ ·ï¼šBaggingï¼Œåœ¨ç»Ÿè®¡å­¦ä¸­ä¹Ÿè¢«ç§°ä¸ºbootstrapã€‚ ä¸æ”¾å›å–æ ·ï¼šBoosting åœ¨é›†æˆå­¦ä¹ ä¸­æˆ‘ä»¬é€šå¸¸é‡‡ç”¨ Bagging çš„æ–¹å¼ï¼Œå…·ä½“åŸå› å¦‚ä¸‹ï¼š\nå› ä¸ºå–æ ·åæ”¾å›ï¼Œæ‰€ä»¥ä¸å—æ ·æœ¬æ•°æ®é‡çš„é™åˆ¶ï¼Œå…è®¸å¯¹åŒä¸€ç§åˆ†ç±»å™¨ä¸Šå¯¹è®­ç»ƒé›†è¿›è¡Œè¿›è¡Œå¤šæ¬¡é‡‡æ ·ï¼Œå¯ä»¥è®­ç»ƒæ›´å¤šçš„å­æ¨¡å‹ã€‚ åœ¨ train_test_split æ—¶ï¼Œä¸é‚£ä¹ˆå¼ºçƒˆçš„ä¾èµ–éšæœºï¼›è€Œ Boostingçš„æ–¹å¼ï¼Œä¼šå—åˆ°éšæœºçš„å½±å“ï¼› Boostingçš„éšæœºé—®é¢˜ï¼šPasting çš„æ–¹å¼ç­‰åŒäºå°† 500 ä¸ªæ ·æœ¬åˆ†æˆ 5 ä»½ï¼Œæ¯ä»½ 100 ä¸ªæ ·æœ¬ï¼Œæ€ä¹ˆåˆ†ï¼Œå°†å¯¹å­æ¨¡å‹æœ‰è¾ƒå¤§å½±å“ï¼Œè¿›è€Œå¯¹é›†æˆç³»ç»Ÿçš„å‡†ç¡®ç‡æœ‰è¾ƒå¤§å½±å“ã€‚ ä»€ä¹ˆæ˜¯Bagging Baggingï¼Œå³bootstrap aggregatingçš„ç¼©å†™ï¼Œæ¯ä¸ªè®­ç»ƒé›†ç§°ä¸ºbootstrapã€‚\nBaggingæ˜¯ä¸€ç§æ ¹æ®å‡åŒ€æ¦‚ç‡åˆ†å¸ƒä»æ•°æ®ä¸­é‡å¤æŠ½æ ·ï¼ˆæœ‰æ”¾å›ï¼‰çš„æŠ€æœ¯ ã€‚\nBaggingèƒ½æå‡æœºå™¨å­¦ä¹ ç®—æ³•çš„ç¨³å®šæ€§å’Œå‡†ç¡®æ€§ï¼Œå®ƒå¯ä»¥å‡å°‘æ¨¡å‹çš„æ–¹å·®ä»è€Œé¿å…overfittingã€‚å®ƒé€šå¸¸åº”ç”¨åœ¨å†³ç­–æ ‘æ–¹æ³•ä¸­ï¼Œå…¶å®å®ƒå¯ä»¥åº”ç”¨åˆ°ä»»ä½•å…¶å®ƒæœºå™¨å­¦ä¹ ç®—æ³•ä¸­ã€‚\nBaggingæ–¹æ³•åœ¨ä¸ç¨³å®šæ¨¡å‹ï¼ˆunstable modelsï¼‰é›†åˆä¸­è¡¨ç°æ¯”è¾ƒå¥½ã€‚è¿™é‡Œè¯´çš„ä¸ç¨³å®šçš„æ¨¡å‹ï¼Œå³åœ¨è®­ç»ƒæ•°æ®å‘ç”Ÿå¾®å°å˜åŒ–æ—¶äº§ç”Ÿä¸åŒæ³›åŒ–è¡Œä¸ºçš„æ¨¡å‹ï¼ˆé«˜æ–¹å·®æ¨¡å‹ï¼‰ï¼Œå¦‚å†³ç­–æ ‘å’Œç¥ç»ç½‘ç»œã€‚\nä½†æ˜¯Baggingåœ¨è¿‡äºç®€å•æ¨¡å‹é›†åˆä¸­è¡¨ç°å¹¶ä¸å¥½ï¼Œå› ä¸ºBaggingæ˜¯ä»æ€»ä½“æ•°æ®é›†éšæœºé€‰å–æ ·æœ¬æ¥è®­ç»ƒæ¨¡å‹ï¼Œè¿‡äºç®€å•çš„æ¨¡å‹å¯èƒ½ä¼šäº§ç”Ÿç›¸åŒçš„é¢„æµ‹ç»“æœï¼Œå¤±å»äº†å¤šæ ·æ€§ã€‚\næ€»ç»“ä¸€ä¸‹Baggingæ–¹æ³•ï¼š\nBaggingé€šè¿‡é™ä½åŸºåˆ†ç±»å™¨çš„æ–¹å·®ï¼Œæ”¹å–„äº†æ³›åŒ–è¯¯å·® å…¶æ€§èƒ½ä¾èµ–äºåŸºåˆ†ç±»å™¨çš„ç¨³å®šæ€§ï¼›å¦‚æœåŸºåˆ†ç±»å™¨ä¸ç¨³å®šï¼Œbaggingæœ‰åŠ©äºé™ä½è®­ç»ƒæ•°æ®çš„éšæœºæ³¢åŠ¨å¯¼è‡´çš„è¯¯å·®ï¼›å¦‚æœç¨³å®šï¼Œåˆ™é›†æˆåˆ†ç±»å™¨çš„è¯¯å·®ä¸»è¦ç”±åŸºåˆ†ç±»å™¨çš„åå·®å¼•èµ· ç”±äºæ¯ä¸ªæ ·æœ¬è¢«é€‰ä¸­çš„æ¦‚ç‡ç›¸åŒï¼Œå› æ­¤baggingå¹¶ä¸ä¾§é‡äºè®­ç»ƒæ•°æ®é›†ä¸­çš„ä»»ä½•ç‰¹å®šå®ä¾‹ Baggingçš„ä½¿ç”¨ sklearnä¸ºBaggingæä¾›äº†ä¸€ä¸ªç®€å•çš„APIï¼šBaggingClassifierç±»ï¼ˆå›å½’æ˜¯BaggingRegressorï¼‰ã€‚é¦–å…ˆéœ€è¦ä¼ å…¥ä¸€ä¸ªæ¨¡å‹ä½œä¸ºå‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨å†³ç­–æ ‘ï¼›ç„¶åéœ€è¦ä¼ å…¥å‚æ•°n_estimatorå³é›†æˆå¤šå°‘ä¸ªå­æ¨¡å‹ï¼›å‚æ•°max_samplesè¡¨ç¤ºæ¯æ¬¡ä»æ•°æ®é›†ä¸­å–å¤šå°‘æ ·æœ¬ï¼›å‚æ•°bootstrapè®¾ç½®ä¸ºTrueè¡¨ç¤ºä½¿ç”¨æœ‰æ”¾å›å–æ ·Baggingï¼Œè®¾ç½®ä¸ºFalseè¡¨ç¤ºä½¿ç”¨æ— æ”¾å›å–æ ·Pastingã€‚å¯ä»¥é€šè¿‡n_jobså‚æ•°æ¥åˆ†é…è®­ç»ƒæ‰€éœ€CPUæ ¸çš„æ•°é‡ï¼Œ-1è¡¨ç¤ºä¼šä½¿ç”¨æ‰€æœ‰ç©ºé—²æ ¸ï¼ˆé›†æˆå­¦ä¹ æ€è·¯ï¼Œææ˜“å¹¶è¡ŒåŒ–å¤„ç†ï¼‰ã€‚\nbaggingæ˜¯ä¸èƒ½å‡å°æ¨¡å‹çš„åå·®çš„ï¼Œå› æ­¤æˆ‘ä»¬è¦é€‰æ‹©å…·æœ‰ä½åå·®çš„åˆ†ç±»å™¨æ¥é›†æˆï¼Œä¾‹å¦‚ï¼šæ²¡æœ‰ä¿®å‰ªçš„å†³ç­–æ ‘ã€‚\nBootstrap åœ¨æ¯ä¸ªé¢„æµ‹å™¨è¢«è®­ç»ƒçš„å­é›†ä¸­å¼•å…¥äº†æ›´å¤šçš„åˆ†é›†ï¼Œæ‰€ä»¥ Bagging ç»“æŸæ—¶çš„åå·®æ¯” Pasting æ›´é«˜ï¼Œä½†è¿™ä¹Ÿæ„å‘³ç€é¢„æµ‹å› å­æœ€ç»ˆå˜å¾—ä¸ç›¸å…³ï¼Œä»è€Œå‡å°‘äº†é›†åˆçš„æ–¹å·®ã€‚æ€»ä½“è€Œè¨€ï¼ŒBagging é€šå¸¸ä¼šå¯¼è‡´æ›´å¥½çš„æ¨¡å‹ï¼Œè¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆå®ƒé€šå¸¸æ˜¯é¦–é€‰çš„ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æœ‰ç©ºé—²æ—¶é—´å’Œ CPU åŠŸç‡ï¼Œå¯ä»¥ä½¿ç”¨äº¤å‰éªŒè¯æ¥è¯„ä¼° Bagging å’Œ Pasting å“ªä¸€ä¸ªæ›´å¥½ã€‚\nOut-of-Bag å¯¹äºBaggingæ¥è¯´ï¼Œä¸€äº›å®ä¾‹å¯èƒ½è¢«ä¸€äº›åˆ†ç±»å™¨é‡å¤é‡‡æ ·ï¼Œä½†å…¶ä»–çš„æœ‰å¯èƒ½ä¸ä¼šè¢«é‡‡æ ·ã€‚ç”±äºæ¯ä¸ªbootstrapçš„Mä¸ªæ ·æœ¬æ˜¯æœ‰æ”¾å›éšæœºé€‰å–çš„ï¼Œå› æ­¤æ¯ä¸ªæ ·æœ¬ä¸è¢«é€‰ä¸­çš„æ¦‚ç‡ä¸ºã€‚å½“Nå’ŒMéƒ½éå¸¸å¤§æ—¶ï¼Œæ¯”å¦‚N=M=10000ï¼Œä¸€ä¸ªæ ·æœ¬ä¸è¢«é€‰ä¸­çš„æ¦‚ç‡p = 36.8%ã€‚å› æ­¤ä¸€ä¸ªbootstrapçº¦åŒ…å«åŸæ ·æœ¬63.2%ï¼Œçº¦36.8%çš„æ ·æœ¬æœªè¢«é€‰ä¸­ã€‚è¿™äº›æ²¡æœ‰è¢«é‡‡æ ·çš„è®­ç»ƒå®ä¾‹å°±å«åšOut-of-Bagå®ä¾‹ã€‚ä½†æ³¨æ„å¯¹äºæ¯ä¸€ä¸ªçš„åˆ†ç±»å™¨æ¥è¯´ï¼Œå®ƒä»¬å„è‡ªçš„æœªé€‰ä¸­éƒ¨åˆ†ä¸æ˜¯ç›¸åŒçš„ã€‚\né‚£ä¹ˆè¿™äº›æœªé€‰ä¸­çš„æ ·æœ¬æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ\nå› ä¸ºåœ¨è®­ç»ƒä¸­åˆ†ç±»å™¨ä»æ¥æ²¡æœ‰çœ‹åˆ°è¿‡Out-of-Bagå®ä¾‹ï¼Œæ‰€ä»¥å®ƒå¯ä»¥åœ¨è¿™äº›æ ·æœ¬ä¸Šè¿›è¡Œé¢„æµ‹ï¼Œå°±ä¸ç”¨åˆ†æ ·æœ¬æµ‹è¯•é›†å’Œæµ‹è¯•æ•°æ®é›†äº†ã€‚\nåœ¨sklearnä¸­ï¼Œå¯ä»¥åœ¨è®­ç»ƒåéœ€è¦åˆ›å»ºä¸€ä¸ªBaggingClassifieræ—¶è®¾ç½®oob_score=Trueæ¥è¿›è¡Œè‡ªåŠ¨è¯„ä¼°ã€‚\n1 2 3 4 5 bagging_clf = BaggingClassifier(DecisionTreeClassifier(), n_estimators=5000, max_samples=100, bootstrap=True, oob_score=True) bagging_clf.fit(X, y) bagging_clf.oob_score_ å¦ä¸€ç§å·®å¼‚åŒ–æ–¹å¼ï¼šé’ˆå¯¹ç‰¹å¾å–æ · æˆ‘ä»¬ä¸Šé¢æåˆ°çš„ï¼Œéƒ½æ˜¯é€šè¿‡å¯¹æ ·æœ¬è¿›è¡Œå–æ ·ï¼Œæ¥å¾—åˆ°å·®å¼‚åŒ–çš„å­æ¨¡å‹ã€‚é™¤äº†å–éƒ¨åˆ†æ ·æœ¬ä»¥å¤–ï¼Œè¿˜å¯ä»¥é’ˆå¯¹ç‰¹å¾è¿›è¡Œéšæœºå–æ ·ã€‚å°¤å…¶æ˜¯åœ¨æ ·æœ¬ç‰¹å¾éå¸¸å¤šçš„æƒ…å†µä¸‹æ—¶ï¼Œå¦‚å›¾åƒé¢†åŸŸä¸­ï¼Œæ¯ä¸ªåƒç´ ç‚¹éƒ½æ˜¯ä¸€ä¸ªç‰¹å¾ï¼Œåˆ™Baggingæ—¶å¯ä»¥å¯¹ç‰¹å¾è¿›è¡Œå–æ ·ã€‚\nåœ¨BaggingClassifierä¸­æœ‰ä¸¤ä¸ªè¶…å‚æ•°ï¼Œmax_featuresè¡¨ç¤ºæ¯æ¬¡å–å¤šå°‘ç‰¹å¾ï¼›bootstrap_featuresè®¾ç½®ä¸ºTrueåˆ™å¼€å¯ã€‚\nåœ¨Baggingä¸­ï¼Œæ‰€æœ‰çš„åˆ†ç±»å™¨éƒ½å¯ä»¥æ˜¯å¹¶è¡Œè®­ç»ƒçš„ã€‚ä¸ä¹‹ç›¸å¯¹åº”çš„ï¼Œä¸²è¡Œè®­ç»ƒçš„Boostingä¹Ÿæ˜¯é›†æˆè®­ç»ƒä¸­çš„ä¸€å¤§ç±»åˆ«ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šä»‹ç»Boostingç®—æ³•ã€‚\nBoostingæ€æƒ³ Boostingæ˜¯å¢å¼ºã€æ¨åŠ¨çš„æ„æ€ã€‚å®ƒæ˜¯ä¸€ç§è¿­ä»£çš„æ–¹æ³•ï¼Œå„ä¸ªå­æ¨¡å‹å½¼æ­¤ä¹‹é—´ä¸æ˜¯ç‹¬ç«‹çš„å…³ç³»ï¼Œè€Œæ˜¯ç›¸äº’å¢å¼ºï¼ˆBoostingï¼‰çš„å…³ç³»ã€‚æ¯ä¸€æ¬¡è®­ç»ƒçš„æ—¶å€™éƒ½æ›´åŠ å…³å¿ƒåˆ†ç±»é”™è¯¯çš„æ ·ä¾‹ï¼Œç»™è¿™äº›åˆ†ç±»é”™è¯¯çš„æ ·ä¾‹å¢åŠ æ›´å¤§çš„æƒé‡ï¼Œä¸‹ä¸€æ¬¡è¿­ä»£çš„ç›®æ ‡å°±æ˜¯èƒ½å¤Ÿæ›´å®¹æ˜“è¾¨åˆ«å‡ºä¸Šä¸€è½®åˆ†ç±»é”™è¯¯çš„æ ·ä¾‹ã€‚æ¯ä¸ªæ¨¡å‹éƒ½åœ¨å°è¯•å¢å¼ºæ•´ä½“çš„æ•ˆæœï¼Œæœ€ç»ˆå°†è¿™äº›å¼±åˆ†ç±»å™¨è¿›è¡ŒåŠ æƒç›¸åŠ ã€‚\nå› æ­¤ä¸Baggingä¸­å„å­¦ä¹ å™¨å¹¶è¡Œå¤„ç†ä¸åŒçš„æ˜¯ï¼šBoostingæ˜¯ä¸²è¡Œçš„ï¼Œç¯ç¯ç›¸æ‰£ä¸”æœ‰å…ˆåé¡ºåºçš„\nBoostingå·¥ä½œæœºåˆ¶ Boostingçš„å·¥ä½œæµç¨‹:\nç°æœ‰åŸå§‹æ•°æ®é›†ï¼Œé¦–å…ˆæŒ‘å‡ºä¸€äº›æ•°æ®ï¼Œç„¶ååœ¨ä¸Šè®­ç»ƒåˆ†ç±»å™¨å¾—åˆ°ã€‚ç„¶åç”¨åœ¨åŸå§‹æ•°æ®é›†ä¸Šæµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹å“ªäº›æ ·æœ¬åˆ†ç±»å¯¹äº†ï¼Œå“ªäº›æ ·æœ¬åˆ†ç±»é”™äº†ã€‚ç„¶åæŠŠåˆ†é”™çš„å’Œåˆ†å¯¹çš„åˆ†åˆ«æŒ‘å‡ºä¸€éƒ¨åˆ†ï¼Œç»„æˆæ–°çš„æ•°æ®é›†ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ»æ„ç­›å‡ºæœ‰å¯¹æœ‰é”™çš„æ•°æ®é›†ï¼‰ã€‚å†ä½¿ç”¨æŸåˆ†ç±»å™¨è®­ç»ƒæ•°æ®é›†ï¼Œå³ä¸“é—¨åœ°ã€æœ‰ç›®çš„æ€§åœ°å­¦ä¹ D1æ•°æ®é›†å“ªäº›å­¦å¯¹äº†ã€å“ªäº›å­¦é”™äº†ï¼Œå¾—åˆ°C2.\næœ‰äº†C1, C2 ä¸¤ä¸ªåˆ†ç±»å™¨éƒ½åœ¨åŸå§‹æ•°æ®é›†Dä¸Šè¿›è¡Œæµ‹è¯•ï¼Œç›®çš„æ˜¯æ‰¾åˆ°C1ã€C2ç»“æœä¸ä¸€è‡´çš„æ ·æœ¬ï¼Œç»„æˆä¸€ä¸ªæ–°çš„æ•°æ®é›†D3ï¼Œå†ç”¨ä¸€ä¸ªåˆ†ç±»å™¨è®­ç»ƒD3ï¼Œå¾—åˆ°ï¼ˆä¸“é—¨ç”¨æ¥è§£å†³C1ã€C2çš„äº‰ç«¯ï¼‰ã€‚\nå…¶ç®—æ³•æµç¨‹ä¸ºï¼š\nå…ˆä»åˆå§‹è®­ç»ƒé›†è®­ç»ƒå‡ºä¸€ä¸ªå¼±å­¦ä¹ å™¨ï¼› å†æ ¹æ®åŸºå­¦ä¹ å™¨çš„è¡¨ç°å¯¹è®­ç»ƒæ ·æœ¬åˆ†å¸ƒè¿›è¡Œè°ƒæ•´ï¼Œä½¿å¾—å…ˆå‰åŸºå­¦ä¹ å™¨åšé”™çš„è®­ç»ƒæ ·æœ¬åœ¨åç»­å—åˆ°æ›´å¤šå…³æ³¨ï¼› ç„¶ååŸºäºè°ƒæ•´åçš„æ ·æœ¬åˆ†å¸ƒæ¥è®­ç»ƒä¸‹ä¸€ä¸ªåŸºå­¦ä¹ å™¨ï¼› å¦‚æ­¤é‡å¤è¿›è¡Œï¼Œç›´è‡³åŸºå­¦ä¹ å™¨æ•°ç›®è¾¾åˆ°äº‹å…ˆæŒ‡å®šçš„å€¼ï¼Œæœ€ç»ˆå°†è¿™ä¸ªåŸºå­¦ä¹ å™¨è¿›è¡ŒåŠ æƒç»“åˆã€‚ä½¿åç»­æ¨¡å‹åº”è¯¥èƒ½å¤Ÿè¡¥å¿æ—©æœŸæ¨¡å‹æ‰€é€ æˆçš„é”™è¯¯ã€‚ å…ˆè®­ç»ƒä¸€ä¸ªåˆ†ç±»å™¨ï¼Œæ ¹æ®è¿™ä¸ªåˆ†ç±»å™¨çš„è¯¯å·®å°†è®­ç»ƒæ ·æœ¬é‡æ–°è°ƒæ•´ï¼Œä¹Ÿå°±æ˜¯åŠ æƒé‡ã€‚åŸæ¥çš„æ¯ä¸ªæ ·æœ¬æœ‰åŒæ ·çš„æœºä¼šå»ä½œä¸ºè®­ç»ƒæ ·æœ¬ï¼Œåœ¨æŸä¸ªæ ·æœ¬ä¸ŠçŠ¯çš„é”™è¯¯è¶Šå¤šï¼Œå…¶æƒé‡ä¹Ÿå°±è¶Šå¤§ã€‚è¿™å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯è®©åé¢çš„åˆ†ç±»å™¨å»é‡ç‚¹å­¦ä¹ å‰é¢åˆ†é”™çš„æ ·æœ¬ã€‚\nBoostingå’ŒBaggingçš„åŒºåˆ«ï¼ˆé‡è¦æ€»ç»“ï¼‰ 1ã€æ ·æœ¬é€‰æ‹©ä¸Šï¼š\nBaggingï¼šè®­ç»ƒé›†æ˜¯åœ¨åŸå§‹é›†ä¸­æœ‰æ”¾å›é€‰å–çš„ï¼Œä»åŸå§‹é›†ä¸­é€‰å‡ºçš„å„è½®è®­ç»ƒé›†ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ã€‚ Boostingï¼šæ¯ä¸€è½®çš„è®­ç»ƒé›†ä¸å˜ï¼Œåªæ˜¯è®­ç»ƒé›†ä¸­æ¯ä¸ªæ ·ä¾‹åœ¨åˆ†ç±»å™¨ä¸­çš„æƒé‡å‘ç”Ÿå˜åŒ–ã€‚è€Œæƒå€¼æ˜¯æ ¹æ®ä¸Šä¸€è½®çš„åˆ†ç±»ç»“æœè¿›è¡Œè°ƒæ•´ã€‚ 2ã€æ ·ä¾‹æƒé‡ï¼š\nBaggingï¼šä½¿ç”¨å‡åŒ€å–æ ·ï¼Œæ¯ä¸ªæ ·ä¾‹çš„æƒé‡ç›¸ç­‰ã€‚ Boostingï¼šæ ¹æ®é”™è¯¯ç‡ä¸æ–­è°ƒæ•´æ ·ä¾‹çš„æƒå€¼ï¼Œé”™è¯¯ç‡è¶Šå¤§åˆ™æƒé‡è¶Šå¤§ã€‚ 3ã€åˆ†ç±»å™¨æƒé‡ï¼š\nBaggingï¼šæ‰€æœ‰åˆ†ç±»å™¨çš„æƒé‡ç›¸ç­‰ã€‚ Boostingï¼šæ¯ä¸ªå¼±åˆ†ç±»å™¨éƒ½æœ‰ç›¸åº”çš„æƒé‡ï¼Œå¯¹äºåˆ†ç±»è¯¯å·®å°çš„åˆ†ç±»å™¨ä¼šæœ‰æ›´å¤§çš„æƒé‡ã€‚ 4ã€å¹¶è¡Œ\u0026amp;ä¸²è¡Œï¼š\nBaggingï¼šå„ä¸ªé¢„æµ‹å‡½æ•°å¯ä»¥å¹¶è¡Œç”Ÿæˆã€‚ Boostingï¼šå„ä¸ªé¢„æµ‹å‡½æ•°åªèƒ½é¡ºåºç”Ÿæˆï¼Œå› ä¸ºåä¸€ä¸ªæ¨¡å‹å‚æ•°éœ€è¦å‰ä¸€è½®æ¨¡å‹çš„ç»“æœã€‚ åå·®å’Œæ–¹å·®ï¼ˆé‡è¦ï¼ï¼‰ åå·®ï¼ˆbiasï¼‰è¡¡é‡äº†æ¨¡å‹çš„é¢„æµ‹å€¼ä¸å®é™…å€¼ä¹‹é—´çš„åç¦»å…³ç³»ï¼Œåæ˜ äº†æ¨¡å‹æœ¬èº«çš„æ‹Ÿåˆèƒ½åŠ›ï¼›æ–¹å·®ï¼ˆvarianceï¼‰æè¿°çš„æ˜¯è®­ç»ƒæ•°æ®åœ¨ä¸åŒè¿­ä»£é˜¶æ®µçš„è®­ç»ƒæ¨¡å‹ä¸­ï¼Œé¢„æµ‹å€¼çš„å˜åŒ–æ³¢åŠ¨æƒ…å†µï¼ˆæˆ–ç§°ä¹‹ä¸ºç¦»æ•£æƒ…å†µï¼‰ã€‚\nBaggingç”¨å¤šä¸ªåˆ†ç±»å™¨è¿›è¡Œå¹¶è¡Œè®­ç»ƒçš„ç›®çš„å°±æ˜¯é™ä½æ–¹å·®ã€‚å› ä¸ºç›¸äº’ç‹¬ç«‹çš„åˆ†ç±»å™¨å¤šäº†ï¼Œå°±ä¼šè®©ç›®æ ‡å€¼æ›´èšåˆã€‚\nè€Œå¯¹äºBoostingæ¥è¯´ï¼Œæ¯ä¸€è½®éƒ½é’ˆå¯¹äºä¸Šä¸€è½®è¿›è¡Œå­¦ä¹ ï¼ŒåŠ›æ±‚å‡†ç¡®ï¼Œå³å¯ä»¥é™ä½åå·®ï¼ˆæ®‹å·®ï¼‰ã€‚\nå› æ­¤ï¼Œåœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬å°±è¦è€ƒè™‘æ¨¡å‹çš„ç‰¹æ€§ã€‚å¯¹äºæ–¹å·®ä½çš„Baggingï¼ˆéšæœºæ£®æ—ï¼‰æ¥è¯´ï¼Œé‡‡ç”¨æ·±åº¦è¾ƒæ·±ä¸”ä¸å‰ªæçš„å†³ç­–æ ‘ï¼Œä»¥æ­¤é™ä½å…¶åå·®ã€‚å¯¹äºåå·®ä½çš„Boostingï¼ˆGBDTï¼‰è¦é€‰ç®€å•çš„ã€æ·±åº¦æµ…çš„å†³ç­–æ ‘ã€‚\nåœ¨Baggingæ–¹æ³•ä¸­å„ä¸ªåŸºä½“å­¦ä¹ å™¨ä¹‹é—´ä¸å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œé›†æˆå¤šä¸ªæ¨¡å‹ï¼Œç»¼åˆæœ‰å·®å¼‚çš„å­æ¨¡å‹ï¼Œèåˆå‡ºæ¯”è¾ƒå¥½çš„æ¨¡å‹ï¼Œä¸”å¯ä»¥å¹¶è¡Œå¤„ç†ã€‚å¦‚éšæœºæ£®æ—ç®—æ³•ï¼ˆRFï¼‰ç­‰ã€‚\nè€ŒBoostingæ–¹æ³•å¿…é¡»ä¸²è¡Œç”Ÿæˆï¼Œå„ä¸ªåŸºå­¦ä¹ å™¨å­˜åœ¨ä¾èµ–å…³ç³»,åŸºäºå‰é¢æ¨¡å‹çš„è®­ç»ƒç»“æœè¯¯å·®ç”Ÿæˆæ–°çš„æ¨¡å‹ï¼Œä»£è¡¨çš„ç®—æ³•æœ‰ï¼šAdaboostã€GBDTã€XGBoostç­‰ã€‚\n","permalink":"https://reid00.github.io/en/posts/ml/%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0%E4%B9%8Bbaggingboosting/","summary":"ç”Ÿæˆå­æ¨¡å‹çš„ä¸¤ç§å–æ ·æ–¹å¼ é‚£ä¹ˆä¸ºäº†é€ æˆå­æ¨¡å‹ä¹‹é—´çš„å·®è·ï¼Œæ¯ä¸ªå­æ¨¡å‹åªçœ‹æ ·æœ¬ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œè¿™å°±æ¶‰åŠåˆ°ä¸¤ç§å–æ ·æ–¹å¼ï¼š\næ”¾å›å–æ ·ï¼šBaggingï¼Œåœ¨ç»Ÿè®¡å­¦ä¸­ä¹Ÿè¢«ç§°ä¸ºbootstrapã€‚ ä¸æ”¾å›å–æ ·ï¼šBoosting åœ¨é›†æˆå­¦ä¹ ä¸­æˆ‘ä»¬é€šå¸¸é‡‡ç”¨ Bagging çš„æ–¹å¼ï¼Œå…·ä½“åŸå› å¦‚ä¸‹ï¼š\nå› ä¸ºå–æ ·åæ”¾å›ï¼Œæ‰€ä»¥ä¸å—æ ·æœ¬æ•°æ®é‡çš„é™åˆ¶ï¼Œå…è®¸å¯¹åŒä¸€ç§åˆ†ç±»å™¨ä¸Šå¯¹è®­ç»ƒé›†è¿›è¡Œè¿›è¡Œå¤šæ¬¡é‡‡æ ·ï¼Œå¯ä»¥è®­ç»ƒæ›´å¤šçš„å­æ¨¡å‹ã€‚ åœ¨ train_test_split æ—¶ï¼Œä¸é‚£ä¹ˆå¼ºçƒˆçš„ä¾èµ–éšæœºï¼›è€Œ Boostingçš„æ–¹å¼ï¼Œä¼šå—åˆ°éšæœºçš„å½±å“ï¼› Boostingçš„éšæœºé—®é¢˜ï¼šPasting çš„æ–¹å¼ç­‰åŒäºå°† 500 ä¸ªæ ·æœ¬åˆ†æˆ 5 ä»½ï¼Œæ¯ä»½ 100 ä¸ªæ ·æœ¬ï¼Œæ€ä¹ˆåˆ†ï¼Œå°†å¯¹å­æ¨¡å‹æœ‰è¾ƒå¤§å½±å“ï¼Œè¿›è€Œå¯¹é›†æˆç³»ç»Ÿçš„å‡†ç¡®ç‡æœ‰è¾ƒå¤§å½±å“ã€‚ ä»€ä¹ˆæ˜¯Bagging Baggingï¼Œå³bootstrap aggregatingçš„ç¼©å†™ï¼Œæ¯ä¸ªè®­ç»ƒé›†ç§°ä¸ºbootstrapã€‚\nBaggingæ˜¯ä¸€ç§æ ¹æ®å‡åŒ€æ¦‚ç‡åˆ†å¸ƒä»æ•°æ®ä¸­é‡å¤æŠ½æ ·ï¼ˆæœ‰æ”¾å›ï¼‰çš„æŠ€æœ¯ ã€‚\nBaggingèƒ½æå‡æœºå™¨å­¦ä¹ ç®—æ³•çš„ç¨³å®šæ€§å’Œå‡†ç¡®æ€§ï¼Œå®ƒå¯ä»¥å‡å°‘æ¨¡å‹çš„æ–¹å·®ä»è€Œé¿å…overfittingã€‚å®ƒé€šå¸¸åº”ç”¨åœ¨å†³ç­–æ ‘æ–¹æ³•ä¸­ï¼Œå…¶å®å®ƒå¯ä»¥åº”ç”¨åˆ°ä»»ä½•å…¶å®ƒæœºå™¨å­¦ä¹ ç®—æ³•ä¸­ã€‚\nBaggingæ–¹æ³•åœ¨ä¸ç¨³å®šæ¨¡å‹ï¼ˆunstable modelsï¼‰é›†åˆä¸­è¡¨ç°æ¯”è¾ƒå¥½ã€‚è¿™é‡Œè¯´çš„ä¸ç¨³å®šçš„æ¨¡å‹ï¼Œå³åœ¨è®­ç»ƒæ•°æ®å‘ç”Ÿå¾®å°å˜åŒ–æ—¶äº§ç”Ÿä¸åŒæ³›åŒ–è¡Œä¸ºçš„æ¨¡å‹ï¼ˆé«˜æ–¹å·®æ¨¡å‹ï¼‰ï¼Œå¦‚å†³ç­–æ ‘å’Œç¥ç»ç½‘ç»œã€‚\nä½†æ˜¯Baggingåœ¨è¿‡äºç®€å•æ¨¡å‹é›†åˆä¸­è¡¨ç°å¹¶ä¸å¥½ï¼Œå› ä¸ºBaggingæ˜¯ä»æ€»ä½“æ•°æ®é›†éšæœºé€‰å–æ ·æœ¬æ¥è®­ç»ƒæ¨¡å‹ï¼Œè¿‡äºç®€å•çš„æ¨¡å‹å¯èƒ½ä¼šäº§ç”Ÿç›¸åŒçš„é¢„æµ‹ç»“æœï¼Œå¤±å»äº†å¤šæ ·æ€§ã€‚\næ€»ç»“ä¸€ä¸‹Baggingæ–¹æ³•ï¼š\nBaggingé€šè¿‡é™ä½åŸºåˆ†ç±»å™¨çš„æ–¹å·®ï¼Œæ”¹å–„äº†æ³›åŒ–è¯¯å·® å…¶æ€§èƒ½ä¾èµ–äºåŸºåˆ†ç±»å™¨çš„ç¨³å®šæ€§ï¼›å¦‚æœåŸºåˆ†ç±»å™¨ä¸ç¨³å®šï¼Œbaggingæœ‰åŠ©äºé™ä½è®­ç»ƒæ•°æ®çš„éšæœºæ³¢åŠ¨å¯¼è‡´çš„è¯¯å·®ï¼›å¦‚æœç¨³å®šï¼Œåˆ™é›†æˆåˆ†ç±»å™¨çš„è¯¯å·®ä¸»è¦ç”±åŸºåˆ†ç±»å™¨çš„åå·®å¼•èµ· ç”±äºæ¯ä¸ªæ ·æœ¬è¢«é€‰ä¸­çš„æ¦‚ç‡ç›¸åŒï¼Œå› æ­¤baggingå¹¶ä¸ä¾§é‡äºè®­ç»ƒæ•°æ®é›†ä¸­çš„ä»»ä½•ç‰¹å®šå®ä¾‹ Baggingçš„ä½¿ç”¨ sklearnä¸ºBaggingæä¾›äº†ä¸€ä¸ªç®€å•çš„APIï¼šBaggingClassifierç±»ï¼ˆå›å½’æ˜¯BaggingRegressorï¼‰ã€‚é¦–å…ˆéœ€è¦ä¼ å…¥ä¸€ä¸ªæ¨¡å‹ä½œä¸ºå‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨å†³ç­–æ ‘ï¼›ç„¶åéœ€è¦ä¼ å…¥å‚æ•°n_estimatorå³é›†æˆå¤šå°‘ä¸ªå­æ¨¡å‹ï¼›å‚æ•°max_samplesè¡¨ç¤ºæ¯æ¬¡ä»æ•°æ®é›†ä¸­å–å¤šå°‘æ ·æœ¬ï¼›å‚æ•°bootstrapè®¾ç½®ä¸ºTrueè¡¨ç¤ºä½¿ç”¨æœ‰æ”¾å›å–æ ·Baggingï¼Œè®¾ç½®ä¸ºFalseè¡¨ç¤ºä½¿ç”¨æ— æ”¾å›å–æ ·Pastingã€‚å¯ä»¥é€šè¿‡n_jobså‚æ•°æ¥åˆ†é…è®­ç»ƒæ‰€éœ€CPUæ ¸çš„æ•°é‡ï¼Œ-1è¡¨ç¤ºä¼šä½¿ç”¨æ‰€æœ‰ç©ºé—²æ ¸ï¼ˆé›†æˆå­¦ä¹ æ€è·¯ï¼Œææ˜“å¹¶è¡ŒåŒ–å¤„ç†ï¼‰ã€‚\nbaggingæ˜¯ä¸èƒ½å‡å°æ¨¡å‹çš„åå·®çš„ï¼Œå› æ­¤æˆ‘ä»¬è¦é€‰æ‹©å…·æœ‰ä½åå·®çš„åˆ†ç±»å™¨æ¥é›†æˆï¼Œä¾‹å¦‚ï¼šæ²¡æœ‰ä¿®å‰ªçš„å†³ç­–æ ‘ã€‚\nBootstrap åœ¨æ¯ä¸ªé¢„æµ‹å™¨è¢«è®­ç»ƒçš„å­é›†ä¸­å¼•å…¥äº†æ›´å¤šçš„åˆ†é›†ï¼Œæ‰€ä»¥ Bagging ç»“æŸæ—¶çš„åå·®æ¯” Pasting æ›´é«˜ï¼Œä½†è¿™ä¹Ÿæ„å‘³ç€é¢„æµ‹å› å­æœ€ç»ˆå˜å¾—ä¸ç›¸å…³ï¼Œä»è€Œå‡å°‘äº†é›†åˆçš„æ–¹å·®ã€‚æ€»ä½“è€Œè¨€ï¼ŒBagging é€šå¸¸ä¼šå¯¼è‡´æ›´å¥½çš„æ¨¡å‹ï¼Œè¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆå®ƒé€šå¸¸æ˜¯é¦–é€‰çš„ã€‚ç„¶è€Œï¼Œå¦‚æœä½ æœ‰ç©ºé—²æ—¶é—´å’Œ CPU åŠŸç‡ï¼Œå¯ä»¥ä½¿ç”¨äº¤å‰éªŒè¯æ¥è¯„ä¼° Bagging å’Œ Pasting å“ªä¸€ä¸ªæ›´å¥½ã€‚\nOut-of-Bag å¯¹äºBaggingæ¥è¯´ï¼Œä¸€äº›å®ä¾‹å¯èƒ½è¢«ä¸€äº›åˆ†ç±»å™¨é‡å¤é‡‡æ ·ï¼Œä½†å…¶ä»–çš„æœ‰å¯èƒ½ä¸ä¼šè¢«é‡‡æ ·ã€‚ç”±äºæ¯ä¸ªbootstrapçš„Mä¸ªæ ·æœ¬æ˜¯æœ‰æ”¾å›éšæœºé€‰å–çš„ï¼Œå› æ­¤æ¯ä¸ªæ ·æœ¬ä¸è¢«é€‰ä¸­çš„æ¦‚ç‡ä¸ºã€‚å½“Nå’ŒMéƒ½éå¸¸å¤§æ—¶ï¼Œæ¯”å¦‚N=M=10000ï¼Œä¸€ä¸ªæ ·æœ¬ä¸è¢«é€‰ä¸­çš„æ¦‚ç‡p = 36.8%ã€‚å› æ­¤ä¸€ä¸ªbootstrapçº¦åŒ…å«åŸæ ·æœ¬63.2%ï¼Œçº¦36.8%çš„æ ·æœ¬æœªè¢«é€‰ä¸­ã€‚è¿™äº›æ²¡æœ‰è¢«é‡‡æ ·çš„è®­ç»ƒå®ä¾‹å°±å«åšOut-of-Bagå®ä¾‹ã€‚ä½†æ³¨æ„å¯¹äºæ¯ä¸€ä¸ªçš„åˆ†ç±»å™¨æ¥è¯´ï¼Œå®ƒä»¬å„è‡ªçš„æœªé€‰ä¸­éƒ¨åˆ†ä¸æ˜¯ç›¸åŒçš„ã€‚\né‚£ä¹ˆè¿™äº›æœªé€‰ä¸­çš„æ ·æœ¬æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ\nå› ä¸ºåœ¨è®­ç»ƒä¸­åˆ†ç±»å™¨ä»æ¥æ²¡æœ‰çœ‹åˆ°è¿‡Out-of-Bagå®ä¾‹ï¼Œæ‰€ä»¥å®ƒå¯ä»¥åœ¨è¿™äº›æ ·æœ¬ä¸Šè¿›è¡Œé¢„æµ‹ï¼Œå°±ä¸ç”¨åˆ†æ ·æœ¬æµ‹è¯•é›†å’Œæµ‹è¯•æ•°æ®é›†äº†ã€‚\nåœ¨sklearnä¸­ï¼Œå¯ä»¥åœ¨è®­ç»ƒåéœ€è¦åˆ›å»ºä¸€ä¸ªBaggingClassifieræ—¶è®¾ç½®oob_score=Trueæ¥è¿›è¡Œè‡ªåŠ¨è¯„ä¼°ã€‚\n1 2 3 4 5 bagging_clf = BaggingClassifier(DecisionTreeClassifier(), n_estimators=5000, max_samples=100, bootstrap=True, oob_score=True) bagging_clf.fit(X, y) bagging_clf.","title":"é›†æˆå­¦ä¹ ä¹‹Bagging,Boosting"},{"content":"ä»€ä¹ˆæ˜¯GBDT åˆ°åº•ä»€ä¹ˆæ˜¯æ¢¯åº¦æå‡æ ‘ï¼Ÿæ‰€è°“çš„GBDTå®é™…ä¸Šå°±æ˜¯ï¼š\nGBDT = Gradient Descent + Boosting + Desicion Tree\nä¸Adaboostç®—æ³•ç±»ä¼¼ï¼ŒGBDTä¹Ÿæ˜¯ä½¿ç”¨äº†å‰å‘åˆ†å¸ƒç®—æ³•çš„åŠ æ³•æ¨¡å‹ã€‚åªä¸è¿‡å¼±å­¦ä¹ å™¨é™å®šäº†åªèƒ½ä½¿ç”¨CARTå›å½’æ ‘æ¨¡å‹ï¼ŒåŒæ—¶è¿­ä»£æ€è·¯å’ŒAdaboostä¹Ÿæœ‰æ‰€ä¸åŒã€‚\nåœ¨Adaboostç®—æ³•ä¸­ï¼Œæˆ‘ä»¬æ˜¯åˆ©ç”¨å‰ä¸€è½®è¿­ä»£å¼±å­¦ä¹ å™¨çš„è¯¯å·®ç‡æ¥æ›´æ–°è®­ç»ƒé›†çš„æƒé‡ã€‚è€ŒGradient Boostingæ˜¯é€šè¿‡ç®—æ¢¯åº¦ï¼ˆgradientï¼‰æ¥å®šä½æ¨¡å‹çš„ä¸è¶³ã€‚\nhttps://mp.weixin.qq.com/s/rmStKvdHq-BOCJo8ZuvgfQ\næœ€å¸¸ç”¨çš„å†³ç­–æ ‘ç®—æ³•: RF, Adaboost, GBDT\nhttps://mp.weixin.qq.com/s/tUl3zhVxLfUd7o06_1Zg2g\nXgboost çš„ä¼˜åŠ¿å’ŒåŸç† åŸç†: https://www.jianshu.com/p/920592e8bcd2\nâ€‹\thttps://www.jianshu.com/p/ac1c12f3fba1\nä¼˜åŠ¿: https://snaildove.github.io/2018/10/02/get-started-XGBoost/\nLightGBM è¯¦è§£ https://blog.csdn.net/VariableX/article/details/106242202\nGBDTåˆ†ç±»ç®—æ³•æµç¨‹ GBDTçš„åˆ†ç±»ç®—æ³•ä»æ€æƒ³ä¸Šå’ŒGBDTçš„å›å½’ç®—æ³•æ²¡æœ‰åŒºåˆ«ï¼Œä½†æ˜¯ç”±äºæ ·æœ¬è¾“å‡ºä¸æ˜¯è¿ç»­çš„å€¼ï¼Œè€Œæ˜¯ç¦»æ•£çš„ç±»åˆ«ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•ç›´æ¥ä»è¾“å‡ºç±»åˆ«å»æ‹Ÿåˆç±»åˆ«è¾“å‡ºçš„è¯¯å·®ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š\nç”¨æŒ‡æ•°æŸå¤±å‡½æ•°ï¼Œæ­¤æ—¶GBDTé€€åŒ–ä¸ºAdaboostç®—æ³•ã€‚ ç”¨ç±»ä¼¼äºé€»è¾‘å›å½’çš„å¯¹æ•°ä¼¼ç„¶æŸå¤±å‡½æ•°çš„æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ç”¨çš„æ˜¯ç±»åˆ«çš„é¢„æµ‹æ¦‚ç‡å€¼å’ŒçœŸå®æ¦‚ç‡å€¼çš„å·®æ¥æ‹ŸåˆæŸå¤±ã€‚ ä¸‹é¢æˆ‘ä»¬ç”¨å¯¹æ•°ä¼¼ç„¶æŸå¤±å‡½æ•°çš„GBDTåˆ†ç±»ã€‚è€Œå¯¹äºå¯¹æ•°ä¼¼ç„¶æŸå¤±å‡½æ•°ï¼Œåˆæœ‰äºŒå…ƒåˆ†ç±»å’Œå¤šå…ƒåˆ†ç±»çš„åŒºåˆ«ã€‚\nsklearnä¸­çš„GBDTè°ƒå‚å¤§æ³• https://mp.weixin.qq.com/s/756Xsy0uhnb8_rheySqLLg\nBoostingé‡è¦å‚æ•° åˆ†ç±»å’Œå›å½’ç®—æ³•çš„å‚æ•°å¤§è‡´ç›¸åŒï¼Œä¸åŒä¹‹å¤„ä¼šæŒ‡å‡ºã€‚\nn_estimators: å¼±å­¦ä¹ å™¨çš„ä¸ªæ•°ã€‚ä¸ªæ•°å¤ªå°å®¹æ˜“æ¬ æ‹Ÿåˆï¼Œä¸ªæ•°å¤ªå¤§å®¹æ˜“è¿‡æ‹Ÿåˆã€‚é»˜è®¤æ˜¯100ï¼Œåœ¨å®é™…è°ƒå‚çš„è¿‡ç¨‹ä¸­ï¼Œå¸¸å¸¸å°†n_estimatorså’Œå‚æ•°learning_rateä¸€èµ·è€ƒè™‘ã€‚\nlearning_rate: æ¯ä¸ªå¼±å­¦ä¹ å™¨çš„æƒé‡ç¼©å‡ç³»æ•°ï¼Œä¹Ÿç§°ä½œæ­¥é•¿ã€‚å¦‚æœæˆ‘ä»¬åœ¨å¼ºå­¦ä¹ å™¨çš„è¿­ä»£å…¬å¼åŠ ä¸Šäº†æ­£åˆ™åŒ–é¡¹ï¼šï¼Œåˆ™é€šè¿‡learning_rateæ¥æ§åˆ¶å…¶æƒé‡ã€‚å¯¹äºåŒæ ·çš„è®­ç»ƒé›†æ‹Ÿåˆæ•ˆæœï¼Œè¾ƒå°çš„learning_rateæ„å‘³ç€éœ€è¦æ›´å¤šçš„å¼±å­¦ä¹ å™¨ã€‚é€šå¸¸ç”¨äºŒè€…ä¸€èµ·å†³å®šç®—æ³•çš„æ‹Ÿåˆæ•ˆæœã€‚æ‰€ä»¥ä¸¤ä¸ªå‚æ•°n_estimatorså’Œlearning_rateè¦ä¸€èµ·è°ƒå‚ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¯ä»¥ä»ä¸€ä¸ªå°ä¸€ç‚¹çš„è¡¥å¿å¼€å§‹è°ƒå‚ï¼Œé»˜è®¤æ˜¯1ã€‚\nsubsample: ä¸æ”¾å›æŠ½æ ·çš„å­é‡‡æ ·ï¼Œå–å€¼ä¸º(0,1]ã€‚å¦‚æœå–å€¼ä¸º1ï¼Œåˆ™å…¨éƒ¨æ ·æœ¬éƒ½ä½¿ç”¨ï¼Œç­‰äºæ²¡æœ‰ä½¿ç”¨å­é‡‡æ ·ã€‚å¦‚æœå–å€¼å°äº1ï¼Œåˆ™åªæœ‰ä¸€éƒ¨åˆ†æ ·æœ¬ä¼šå»åšGBDTçš„å†³ç­–æ ‘æ‹Ÿåˆã€‚é€‰æ‹©å°äº1çš„æ¯”ä¾‹å¯ä»¥å‡å°‘æ–¹å·®ï¼Œå³é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œä½†æ˜¯ä¼šå¢åŠ æ ·æœ¬æ‹Ÿåˆçš„åå·®ï¼Œå› æ­¤å–å€¼ä¸èƒ½å¤ªä½ã€‚æ¨èåœ¨[0.5, 0.8]ä¹‹é—´ï¼Œé»˜è®¤æ˜¯1.0ï¼Œå³ä¸ä½¿ç”¨å­é‡‡æ ·ã€‚\ninit: åˆå§‹åŒ–æ—¶çš„å¼±å­¦ä¹ å™¨ï¼Œå³ã€‚å¦‚æœæˆ‘ä»¬å¯¹æ•°æ®æœ‰å…ˆéªŒçŸ¥è¯†ï¼Œæˆ–è€…ä¹‹å‰åšè¿‡ä¸€äº›æ‹Ÿåˆï¼Œå¯ä»¥ç”¨initå‚æ•°æä¾›çš„å­¦ä¹ å™¨åšåˆå§‹åŒ–åˆ†ç±»å›å½’é¢„æµ‹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ä¸è¾“å…¥ï¼Œç›´æ¥ç”¨è®­ç»ƒé›†æ ·æœ¬æ¥åšæ ·æœ¬é›†çš„åˆå§‹åŒ–åˆ†ç±»å›å½’é¢„æµ‹ã€‚\nloss: GBDTç®—æ³•ä¸­çš„æŸå¤±å‡½æ•°ã€‚åˆ†ç±»æ¨¡å‹å’Œå›å½’æ¨¡å‹çš„æŸå¤±å‡½æ•°æ˜¯ä¸ä¸€æ ·ã€‚\nå¯¹äºå›å½’æ¨¡å‹ï¼Œå¯ä»¥ä½¿ç”¨å‡æ–¹è¯¯å·®lsï¼Œç»å¯¹æŸå¤±ladï¼ŒHuberæŸå¤±huberå’Œåˆ†ä½æ•°æŸå¤±quantileï¼Œé»˜è®¤ä½¿ç”¨å‡æ–¹è¯¯å·®lsã€‚å¦‚æœæ•°æ®çš„å™ªéŸ³ç‚¹ä¸å¤šï¼Œç”¨é»˜è®¤çš„å‡æ–¹å·®lsæ¯”è¾ƒå¥½ï¼›å¦‚æœå™ªéŸ³ç‚¹è¾ƒå¤šï¼Œåˆ™æ¨èç”¨æŠ—å™ªéŸ³çš„æŸå¤±å‡½æ•°huberï¼›è€Œå¦‚æœéœ€è¦å¯¹è®­ç»ƒé›†è¿›è¡Œåˆ†æ®µé¢„æµ‹ï¼Œåˆ™é‡‡ç”¨quantileã€‚ å¯¹äºåˆ†ç±»æ¨¡å‹ï¼Œå¯ä»¥ä½¿ç”¨å¯¹æ•°ä¼¼ç„¶æŸå¤±å‡½æ•°devianceå’ŒæŒ‡æ•°æŸå¤±å‡½æ•°exponentialã€‚é»˜è®¤æ˜¯å¯¹æ•°ä¼¼ç„¶æŸå¤±å‡½æ•°devianceã€‚åœ¨åŸç†ç¯‡ä¸­å¯¹è¿™äº›åˆ†ç±»æŸå¤±å‡½æ•°æœ‰è¯¦ç»†çš„ä»‹ç»ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ¨èä½¿ç”¨é»˜è®¤çš„\u0026quot;deviance\u0026quot;ã€‚å®ƒå¯¹äºŒå…ƒåˆ†ç¦»å’Œå¤šå…ƒåˆ†ç±»å„è‡ªéƒ½æœ‰æ¯”è¾ƒå¥½çš„ä¼˜åŒ–ã€‚è€ŒæŒ‡æ•°æŸå¤±å‡½æ•°ç­‰äºæŠŠæˆ‘ä»¬å¸¦åˆ°äº†Adaboostç®—æ³•ã€‚ alpha: è¿™ä¸ªå‚æ•°åªæœ‰å›å½’ç®—æ³•æœ‰ï¼Œå½“ä½¿ç”¨HuberæŸå¤±huberå’Œåˆ†ä½æ•°æŸå¤±quantileæ—¶ï¼Œéœ€è¦æŒ‡å®šåˆ†ä½æ•°çš„å€¼ã€‚é»˜è®¤æ˜¯0.9ï¼Œå¦‚æœå™ªéŸ³ç‚¹è¾ƒå¤šï¼Œå¯ä»¥é€‚å½“é™ä½è¿™ä¸ªåˆ†ä½æ•°çš„å€¼ã€‚\nå¼±å­¦ä¹ å™¨å‚æ•° GBDTä½¿ç”¨äº†CARTå›å½’å†³ç­–æ ‘ï¼Œå› æ­¤å®ƒçš„å‚æ•°åŸºæœ¬å’Œå†³ç­–æ ‘ç±»ä¼¼ã€‚\nmax_features: åˆ’åˆ†æ—¶è€ƒè™‘çš„æœ€å¤§ç‰¹å¾æ•°ï¼Œé»˜è®¤æ˜¯\u0026quot;None\u0026quot;ã€‚é»˜è®¤æ—¶è¡¨ç¤ºåˆ’åˆ†æ—¶è€ƒè™‘æ‰€æœ‰çš„ç‰¹å¾æ•°ï¼›å¦‚æœæ˜¯\u0026quot;log2\u0026quot;æ„å‘³ç€åˆ’åˆ†æ—¶æœ€å¤šè€ƒè™‘ä¸ªlog2Nç‰¹å¾ï¼›å¦‚æœæ˜¯\u0026quot;sqrt\u0026quot;æˆ–è€…\u0026quot;auto\u0026quot;æ„å‘³ç€åˆ’åˆ†æ—¶æœ€å¤šè€ƒè™‘æ ¹å·Nä¸ªç‰¹å¾ã€‚å¦‚æœæ˜¯æ•´æ•°ï¼Œä»£è¡¨è€ƒè™‘çš„ç‰¹å¾ç»å¯¹æ•°ã€‚å¦‚æœæ˜¯æµ®ç‚¹æ•°ï¼Œä»£è¡¨è€ƒè™‘ç‰¹å¾ç™¾åˆ†æ¯”ï¼Œå³è€ƒè™‘ï¼ˆç™¾åˆ†æ¯”*Nï¼‰å–æ•´åçš„ç‰¹å¾æ•°ã€‚å…¶ä¸­Nä¸ºæ ·æœ¬æ€»ç‰¹å¾æ•°ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæ ·æœ¬ç‰¹å¾æ•°ä¸å¤šï¼Œæ¯”å¦‚å°äº50ï¼Œæˆ‘ä»¬ç”¨é»˜è®¤çš„\u0026quot;None\u0026quot;å°±å¯ä»¥äº†ï¼Œå¦‚æœç‰¹å¾æ•°éå¸¸å¤šï¼Œå¯ä»¥çµæ´»æ§åˆ¶åˆ’åˆ†æ—¶è€ƒè™‘çš„æœ€å¤§ç‰¹å¾æ•°ï¼Œä»¥æ§åˆ¶å†³ç­–æ ‘çš„ç”Ÿæˆæ—¶é—´ã€‚ max_depth: å†³ç­–æ ‘æœ€å¤§æ·±åº¦ã€‚å¦‚æœä¸è¾“å…¥ï¼Œé»˜è®¤å€¼æ˜¯3ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®å°‘æˆ–è€…ç‰¹å¾å°‘çš„æ—¶å€™å¯ä»¥ä¸ç®¡è¿™ä¸ªå€¼ã€‚å¦‚æœæ¨¡å‹æ ·æœ¬é‡å¤šï¼Œç‰¹å¾ä¹Ÿå¤šçš„æƒ…å†µä¸‹ï¼Œæ¨èé™åˆ¶è¿™ä¸ªæœ€å¤§æ·±åº¦ï¼Œå…·ä½“çš„å–å€¼å–å†³äºæ•°æ®çš„åˆ†å¸ƒã€‚ min_samples_split: å†…éƒ¨èŠ‚ç‚¹å†åˆ’åˆ†æ‰€éœ€æœ€å°æ ·æœ¬æ•°ã€‚é™åˆ¶å­æ ‘ç»§ç»­åˆ’åˆ†çš„æ¡ä»¶ï¼Œå¦‚æœæŸèŠ‚ç‚¹çš„æ ·æœ¬æ•°å°‘äºmin_samples_splitï¼Œåˆ™ä¸ä¼šç»§ç»­å†å°è¯•é€‰æ‹©æœ€ä¼˜ç‰¹å¾æ¥è¿›è¡Œåˆ’åˆ†ã€‚é»˜è®¤æ˜¯2ï¼Œå¦‚æœæ ·æœ¬é‡æ•°é‡çº§éå¸¸å¤§ï¼Œåˆ™å¢å¤§è¿™ä¸ªå€¼ã€‚ min_samples_leaf: å¶å­èŠ‚ç‚¹æœ€å°‘æ ·æœ¬æ•°ã€‚é™åˆ¶å¶å­èŠ‚ç‚¹æœ€å°‘çš„æ ·æœ¬æ•°ï¼Œå¦‚æœæŸå¶å­èŠ‚ç‚¹æ•°ç›®å°äºæ ·æœ¬æ•°ï¼Œåˆ™ä¼šå’Œå…„å¼ŸèŠ‚ç‚¹ä¸€èµ·è¢«å‰ªæã€‚é»˜è®¤æ˜¯1,å¯ä»¥è¾“å…¥æœ€å°‘çš„æ ·æœ¬æ•°çš„æ•´æ•°ï¼Œæˆ–è€…æœ€å°‘æ ·æœ¬æ•°å æ ·æœ¬æ€»æ•°çš„ç™¾åˆ†æ¯”ã€‚å¦‚æœæ ·æœ¬é‡ä¸å¤§ï¼Œä¸éœ€è¦ç®¡è¿™ä¸ªå€¼ã€‚å¦‚æœæ ·æœ¬é‡æ•°é‡çº§éå¸¸å¤§ï¼Œåˆ™æ¨èå¢å¤§è¿™ä¸ªå€¼ã€‚ min_weight_fraction_leaf: å¶å­èŠ‚ç‚¹æœ€å°çš„æ ·æœ¬æƒé‡å’Œè¿™ä¸ªå€¼é™åˆ¶äº†å¶å­èŠ‚ç‚¹æ‰€æœ‰æ ·æœ¬æƒé‡å’Œçš„æœ€å°å€¼ï¼Œå¦‚æœå°äºè¿™ä¸ªå€¼ï¼Œåˆ™ä¼šå’Œå…„å¼ŸèŠ‚ç‚¹ä¸€èµ·è¢«å‰ªæã€‚é»˜è®¤æ˜¯0ï¼Œå°±æ˜¯ä¸è€ƒè™‘æƒé‡é—®é¢˜ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬æœ‰è¾ƒå¤šæ ·æœ¬æœ‰ç¼ºå¤±å€¼ï¼Œæˆ–è€…åˆ†ç±»æ ‘æ ·æœ¬çš„åˆ†å¸ƒç±»åˆ«åå·®å¾ˆå¤§ï¼Œå°±ä¼šå¼•å…¥æ ·æœ¬æƒé‡ï¼Œè¿™æ—¶æˆ‘ä»¬å°±è¦æ³¨æ„è¿™ä¸ªå€¼äº†ã€‚ max_leaf_nodes: æœ€å¤§å¶å­èŠ‚ç‚¹æ•°ã€‚é€šè¿‡é™åˆ¶æœ€å¤§å¶å­èŠ‚ç‚¹æ•°ï¼Œå¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œé»˜è®¤æ˜¯Noneï¼Œå³ä¸é™åˆ¶æœ€å¤§çš„å¶å­èŠ‚ç‚¹æ•°ã€‚å¦‚æœåŠ äº†é™åˆ¶ï¼Œç®—æ³•ä¼šå»ºç«‹åœ¨æœ€å¤§å¶å­èŠ‚ç‚¹æ•°å†…æœ€ä¼˜çš„å†³ç­–æ ‘ã€‚å¦‚æœç‰¹å¾ä¸å¤šï¼Œå¯ä»¥ä¸è€ƒè™‘è¿™ä¸ªå€¼ï¼Œä½†æ˜¯å¦‚æœç‰¹å¾åˆ†æˆå¤šçš„è¯ï¼Œå¯ä»¥åŠ ä»¥é™åˆ¶ï¼Œå…·ä½“çš„å€¼å¯ä»¥é€šè¿‡äº¤å‰éªŒè¯å¾—åˆ°ã€‚ min_impurity_split: èŠ‚ç‚¹åˆ’åˆ†æœ€å°ä¸çº¯åº¦ã€‚è¿™ä¸ªå€¼é™åˆ¶äº†å†³ç­–æ ‘çš„å¢é•¿ï¼Œå¦‚æœæŸèŠ‚ç‚¹çš„ä¸çº¯åº¦(åŸºäºåŸºå°¼ç³»æ•°ï¼Œå‡æ–¹å·®)å°äºè¿™ä¸ªé˜ˆå€¼ï¼Œåˆ™è¯¥èŠ‚ç‚¹ä¸å†ç”Ÿæˆå­èŠ‚ç‚¹ã€‚å³ä¸ºå¶å­èŠ‚ç‚¹ ã€‚ä¸€èˆ¬ä¸æ¨èæ”¹åŠ¨é»˜è®¤å€¼1e-7ã€‚ GBDTæœ‰å¾ˆå¤šä¼˜ç‚¹ï¼š\nå¯ä»¥çµæ´»å¤„ç†è¿ç»­å€¼å’Œç¦»æ•£å€¼ç­‰å„ç§ç±»å‹çš„æ•°æ® å¯ä»¥å°‘åšä¸€ç‚¹ç‰¹å¾å·¥ç¨‹éƒ¨åˆ† èƒ½å¤Ÿå¤„ç†å­—æ®µç¼ºå¤±çš„æ•°æ® èƒ½å¤Ÿè‡ªåŠ¨ç»„åˆå¤šä¸ªç‰¹å¾ï¼Œä¸ç”¨å…³å¿ƒç‰¹å¾é—´æ˜¯å¦ä¾èµ– èƒ½å¤Ÿè‡ªåŠ¨å¤„ç†ç‰¹å¾é—´çš„äº¤äº’ï¼Œå¤„ç†å¤šç§ç±»å‹çš„å¼‚æ„æ•°æ® å¯ä»¥é€šè¿‡é€‰æ‹©æŸå¤±å‡½æ•°ï¼Œæ¥å¢å¼ºå¯¹å¼‚å¸¸å€¼çš„é²æ£’æ€§ï¼Œå¦‚ï¼šHuberæŸå¤±å‡½æ•°å’ŒQuantileæŸå¤±å‡½æ•° GBDTä¹Ÿæœ‰ä¸€äº›å±€é™æ€§ï¼š\nåœ¨é«˜ç»´ç¨€ç–æ•°æ®é›†ä¸Šï¼Œè¡¨ç°ä¸å¦‚ç¥ç»ç½‘ç»œå’ŒSVM Boostingå®¶æ—ç®—æ³•ï¼ŒåŸºå­¦ä¹ å™¨éœ€è¦ä¸²è¡Œè®­ç»ƒï¼Œåªèƒ½é€šè¿‡å±€éƒ¨å¹¶è¡Œæé«˜é€Ÿåº¦ï¼ˆè‡ªé‡‡æ ·çš„SGBTï¼‰ ","permalink":"https://reid00.github.io/en/posts/ml/%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0%E4%B9%8Bgbdt/","summary":"ä»€ä¹ˆæ˜¯GBDT åˆ°åº•ä»€ä¹ˆæ˜¯æ¢¯åº¦æå‡æ ‘ï¼Ÿæ‰€è°“çš„GBDTå®é™…ä¸Šå°±æ˜¯ï¼š\nGBDT = Gradient Descent + Boosting + Desicion Tree\nä¸Adaboostç®—æ³•ç±»ä¼¼ï¼ŒGBDTä¹Ÿæ˜¯ä½¿ç”¨äº†å‰å‘åˆ†å¸ƒç®—æ³•çš„åŠ æ³•æ¨¡å‹ã€‚åªä¸è¿‡å¼±å­¦ä¹ å™¨é™å®šäº†åªèƒ½ä½¿ç”¨CARTå›å½’æ ‘æ¨¡å‹ï¼ŒåŒæ—¶è¿­ä»£æ€è·¯å’ŒAdaboostä¹Ÿæœ‰æ‰€ä¸åŒã€‚\nåœ¨Adaboostç®—æ³•ä¸­ï¼Œæˆ‘ä»¬æ˜¯åˆ©ç”¨å‰ä¸€è½®è¿­ä»£å¼±å­¦ä¹ å™¨çš„è¯¯å·®ç‡æ¥æ›´æ–°è®­ç»ƒé›†çš„æƒé‡ã€‚è€ŒGradient Boostingæ˜¯é€šè¿‡ç®—æ¢¯åº¦ï¼ˆgradientï¼‰æ¥å®šä½æ¨¡å‹çš„ä¸è¶³ã€‚\nhttps://mp.weixin.qq.com/s/rmStKvdHq-BOCJo8ZuvgfQ\næœ€å¸¸ç”¨çš„å†³ç­–æ ‘ç®—æ³•: RF, Adaboost, GBDT\nhttps://mp.weixin.qq.com/s/tUl3zhVxLfUd7o06_1Zg2g\nXgboost çš„ä¼˜åŠ¿å’ŒåŸç† åŸç†: https://www.jianshu.com/p/920592e8bcd2\nâ€‹\thttps://www.jianshu.com/p/ac1c12f3fba1\nä¼˜åŠ¿: https://snaildove.github.io/2018/10/02/get-started-XGBoost/\nLightGBM è¯¦è§£ https://blog.csdn.net/VariableX/article/details/106242202\nGBDTåˆ†ç±»ç®—æ³•æµç¨‹ GBDTçš„åˆ†ç±»ç®—æ³•ä»æ€æƒ³ä¸Šå’ŒGBDTçš„å›å½’ç®—æ³•æ²¡æœ‰åŒºåˆ«ï¼Œä½†æ˜¯ç”±äºæ ·æœ¬è¾“å‡ºä¸æ˜¯è¿ç»­çš„å€¼ï¼Œè€Œæ˜¯ç¦»æ•£çš„ç±»åˆ«ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•ç›´æ¥ä»è¾“å‡ºç±»åˆ«å»æ‹Ÿåˆç±»åˆ«è¾“å‡ºçš„è¯¯å·®ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š\nç”¨æŒ‡æ•°æŸå¤±å‡½æ•°ï¼Œæ­¤æ—¶GBDTé€€åŒ–ä¸ºAdaboostç®—æ³•ã€‚ ç”¨ç±»ä¼¼äºé€»è¾‘å›å½’çš„å¯¹æ•°ä¼¼ç„¶æŸå¤±å‡½æ•°çš„æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ç”¨çš„æ˜¯ç±»åˆ«çš„é¢„æµ‹æ¦‚ç‡å€¼å’ŒçœŸå®æ¦‚ç‡å€¼çš„å·®æ¥æ‹ŸåˆæŸå¤±ã€‚ ä¸‹é¢æˆ‘ä»¬ç”¨å¯¹æ•°ä¼¼ç„¶æŸå¤±å‡½æ•°çš„GBDTåˆ†ç±»ã€‚è€Œå¯¹äºå¯¹æ•°ä¼¼ç„¶æŸå¤±å‡½æ•°ï¼Œåˆæœ‰äºŒå…ƒåˆ†ç±»å’Œå¤šå…ƒåˆ†ç±»çš„åŒºåˆ«ã€‚\nsklearnä¸­çš„GBDTè°ƒå‚å¤§æ³• https://mp.weixin.qq.com/s/756Xsy0uhnb8_rheySqLLg\nBoostingé‡è¦å‚æ•° åˆ†ç±»å’Œå›å½’ç®—æ³•çš„å‚æ•°å¤§è‡´ç›¸åŒï¼Œä¸åŒä¹‹å¤„ä¼šæŒ‡å‡ºã€‚\nn_estimators: å¼±å­¦ä¹ å™¨çš„ä¸ªæ•°ã€‚ä¸ªæ•°å¤ªå°å®¹æ˜“æ¬ æ‹Ÿåˆï¼Œä¸ªæ•°å¤ªå¤§å®¹æ˜“è¿‡æ‹Ÿåˆã€‚é»˜è®¤æ˜¯100ï¼Œåœ¨å®é™…è°ƒå‚çš„è¿‡ç¨‹ä¸­ï¼Œå¸¸å¸¸å°†n_estimatorså’Œå‚æ•°learning_rateä¸€èµ·è€ƒè™‘ã€‚\nlearning_rate: æ¯ä¸ªå¼±å­¦ä¹ å™¨çš„æƒé‡ç¼©å‡ç³»æ•°ï¼Œä¹Ÿç§°ä½œæ­¥é•¿ã€‚å¦‚æœæˆ‘ä»¬åœ¨å¼ºå­¦ä¹ å™¨çš„è¿­ä»£å…¬å¼åŠ ä¸Šäº†æ­£åˆ™åŒ–é¡¹ï¼šï¼Œåˆ™é€šè¿‡learning_rateæ¥æ§åˆ¶å…¶æƒé‡ã€‚å¯¹äºåŒæ ·çš„è®­ç»ƒé›†æ‹Ÿåˆæ•ˆæœï¼Œè¾ƒå°çš„learning_rateæ„å‘³ç€éœ€è¦æ›´å¤šçš„å¼±å­¦ä¹ å™¨ã€‚é€šå¸¸ç”¨äºŒè€…ä¸€èµ·å†³å®šç®—æ³•çš„æ‹Ÿåˆæ•ˆæœã€‚æ‰€ä»¥ä¸¤ä¸ªå‚æ•°n_estimatorså’Œlearning_rateè¦ä¸€èµ·è°ƒå‚ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¯ä»¥ä»ä¸€ä¸ªå°ä¸€ç‚¹çš„è¡¥å¿å¼€å§‹è°ƒå‚ï¼Œé»˜è®¤æ˜¯1ã€‚\nsubsample: ä¸æ”¾å›æŠ½æ ·çš„å­é‡‡æ ·ï¼Œå–å€¼ä¸º(0,1]ã€‚å¦‚æœå–å€¼ä¸º1ï¼Œåˆ™å…¨éƒ¨æ ·æœ¬éƒ½ä½¿ç”¨ï¼Œç­‰äºæ²¡æœ‰ä½¿ç”¨å­é‡‡æ ·ã€‚å¦‚æœå–å€¼å°äº1ï¼Œåˆ™åªæœ‰ä¸€éƒ¨åˆ†æ ·æœ¬ä¼šå»åšGBDTçš„å†³ç­–æ ‘æ‹Ÿåˆã€‚é€‰æ‹©å°äº1çš„æ¯”ä¾‹å¯ä»¥å‡å°‘æ–¹å·®ï¼Œå³é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œä½†æ˜¯ä¼šå¢åŠ æ ·æœ¬æ‹Ÿåˆçš„åå·®ï¼Œå› æ­¤å–å€¼ä¸èƒ½å¤ªä½ã€‚æ¨èåœ¨[0.5, 0.8]ä¹‹é—´ï¼Œé»˜è®¤æ˜¯1.0ï¼Œå³ä¸ä½¿ç”¨å­é‡‡æ ·ã€‚\ninit: åˆå§‹åŒ–æ—¶çš„å¼±å­¦ä¹ å™¨ï¼Œå³ã€‚å¦‚æœæˆ‘ä»¬å¯¹æ•°æ®æœ‰å…ˆéªŒçŸ¥è¯†ï¼Œæˆ–è€…ä¹‹å‰åšè¿‡ä¸€äº›æ‹Ÿåˆï¼Œå¯ä»¥ç”¨initå‚æ•°æä¾›çš„å­¦ä¹ å™¨åšåˆå§‹åŒ–åˆ†ç±»å›å½’é¢„æµ‹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ä¸è¾“å…¥ï¼Œç›´æ¥ç”¨è®­ç»ƒé›†æ ·æœ¬æ¥åšæ ·æœ¬é›†çš„åˆå§‹åŒ–åˆ†ç±»å›å½’é¢„æµ‹ã€‚\nloss: GBDTç®—æ³•ä¸­çš„æŸå¤±å‡½æ•°ã€‚åˆ†ç±»æ¨¡å‹å’Œå›å½’æ¨¡å‹çš„æŸå¤±å‡½æ•°æ˜¯ä¸ä¸€æ ·ã€‚\nå¯¹äºå›å½’æ¨¡å‹ï¼Œå¯ä»¥ä½¿ç”¨å‡æ–¹è¯¯å·®lsï¼Œç»å¯¹æŸå¤±ladï¼ŒHuberæŸå¤±huberå’Œåˆ†ä½æ•°æŸå¤±quantileï¼Œé»˜è®¤ä½¿ç”¨å‡æ–¹è¯¯å·®lsã€‚å¦‚æœæ•°æ®çš„å™ªéŸ³ç‚¹ä¸å¤šï¼Œç”¨é»˜è®¤çš„å‡æ–¹å·®lsæ¯”è¾ƒå¥½ï¼›å¦‚æœå™ªéŸ³ç‚¹è¾ƒå¤šï¼Œåˆ™æ¨èç”¨æŠ—å™ªéŸ³çš„æŸå¤±å‡½æ•°huberï¼›è€Œå¦‚æœéœ€è¦å¯¹è®­ç»ƒé›†è¿›è¡Œåˆ†æ®µé¢„æµ‹ï¼Œåˆ™é‡‡ç”¨quantileã€‚ å¯¹äºåˆ†ç±»æ¨¡å‹ï¼Œå¯ä»¥ä½¿ç”¨å¯¹æ•°ä¼¼ç„¶æŸå¤±å‡½æ•°devianceå’ŒæŒ‡æ•°æŸå¤±å‡½æ•°exponentialã€‚é»˜è®¤æ˜¯å¯¹æ•°ä¼¼ç„¶æŸå¤±å‡½æ•°devianceã€‚åœ¨åŸç†ç¯‡ä¸­å¯¹è¿™äº›åˆ†ç±»æŸå¤±å‡½æ•°æœ‰è¯¦ç»†çš„ä»‹ç»ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ¨èä½¿ç”¨é»˜è®¤çš„\u0026quot;deviance\u0026quot;ã€‚å®ƒå¯¹äºŒå…ƒåˆ†ç¦»å’Œå¤šå…ƒåˆ†ç±»å„è‡ªéƒ½æœ‰æ¯”è¾ƒå¥½çš„ä¼˜åŒ–ã€‚è€ŒæŒ‡æ•°æŸå¤±å‡½æ•°ç­‰äºæŠŠæˆ‘ä»¬å¸¦åˆ°äº†Adaboostç®—æ³•ã€‚ alpha: è¿™ä¸ªå‚æ•°åªæœ‰å›å½’ç®—æ³•æœ‰ï¼Œå½“ä½¿ç”¨HuberæŸå¤±huberå’Œåˆ†ä½æ•°æŸå¤±quantileæ—¶ï¼Œéœ€è¦æŒ‡å®šåˆ†ä½æ•°çš„å€¼ã€‚é»˜è®¤æ˜¯0.9ï¼Œå¦‚æœå™ªéŸ³ç‚¹è¾ƒå¤šï¼Œå¯ä»¥é€‚å½“é™ä½è¿™ä¸ªåˆ†ä½æ•°çš„å€¼ã€‚\nå¼±å­¦ä¹ å™¨å‚æ•° GBDTä½¿ç”¨äº†CARTå›å½’å†³ç­–æ ‘ï¼Œå› æ­¤å®ƒçš„å‚æ•°åŸºæœ¬å’Œå†³ç­–æ ‘ç±»ä¼¼ã€‚\nmax_features: åˆ’åˆ†æ—¶è€ƒè™‘çš„æœ€å¤§ç‰¹å¾æ•°ï¼Œé»˜è®¤æ˜¯\u0026quot;None\u0026quot;ã€‚é»˜è®¤æ—¶è¡¨ç¤ºåˆ’åˆ†æ—¶è€ƒè™‘æ‰€æœ‰çš„ç‰¹å¾æ•°ï¼›å¦‚æœæ˜¯\u0026quot;log2\u0026quot;æ„å‘³ç€åˆ’åˆ†æ—¶æœ€å¤šè€ƒè™‘ä¸ªlog2Nç‰¹å¾ï¼›å¦‚æœæ˜¯\u0026quot;sqrt\u0026quot;æˆ–è€…\u0026quot;auto\u0026quot;æ„å‘³ç€åˆ’åˆ†æ—¶æœ€å¤šè€ƒè™‘æ ¹å·Nä¸ªç‰¹å¾ã€‚å¦‚æœæ˜¯æ•´æ•°ï¼Œä»£è¡¨è€ƒè™‘çš„ç‰¹å¾ç»å¯¹æ•°ã€‚å¦‚æœæ˜¯æµ®ç‚¹æ•°ï¼Œä»£è¡¨è€ƒè™‘ç‰¹å¾ç™¾åˆ†æ¯”ï¼Œå³è€ƒè™‘ï¼ˆç™¾åˆ†æ¯”*Nï¼‰å–æ•´åçš„ç‰¹å¾æ•°ã€‚å…¶ä¸­Nä¸ºæ ·æœ¬æ€»ç‰¹å¾æ•°ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæ ·æœ¬ç‰¹å¾æ•°ä¸å¤šï¼Œæ¯”å¦‚å°äº50ï¼Œæˆ‘ä»¬ç”¨é»˜è®¤çš„\u0026quot;None\u0026quot;å°±å¯ä»¥äº†ï¼Œå¦‚æœç‰¹å¾æ•°éå¸¸å¤šï¼Œå¯ä»¥çµæ´»æ§åˆ¶åˆ’åˆ†æ—¶è€ƒè™‘çš„æœ€å¤§ç‰¹å¾æ•°ï¼Œä»¥æ§åˆ¶å†³ç­–æ ‘çš„ç”Ÿæˆæ—¶é—´ã€‚ max_depth: å†³ç­–æ ‘æœ€å¤§æ·±åº¦ã€‚å¦‚æœä¸è¾“å…¥ï¼Œé»˜è®¤å€¼æ˜¯3ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®å°‘æˆ–è€…ç‰¹å¾å°‘çš„æ—¶å€™å¯ä»¥ä¸ç®¡è¿™ä¸ªå€¼ã€‚å¦‚æœæ¨¡å‹æ ·æœ¬é‡å¤šï¼Œç‰¹å¾ä¹Ÿå¤šçš„æƒ…å†µä¸‹ï¼Œæ¨èé™åˆ¶è¿™ä¸ªæœ€å¤§æ·±åº¦ï¼Œå…·ä½“çš„å–å€¼å–å†³äºæ•°æ®çš„åˆ†å¸ƒã€‚ min_samples_split: å†…éƒ¨èŠ‚ç‚¹å†åˆ’åˆ†æ‰€éœ€æœ€å°æ ·æœ¬æ•°ã€‚é™åˆ¶å­æ ‘ç»§ç»­åˆ’åˆ†çš„æ¡ä»¶ï¼Œå¦‚æœæŸèŠ‚ç‚¹çš„æ ·æœ¬æ•°å°‘äºmin_samples_splitï¼Œåˆ™ä¸ä¼šç»§ç»­å†å°è¯•é€‰æ‹©æœ€ä¼˜ç‰¹å¾æ¥è¿›è¡Œåˆ’åˆ†ã€‚é»˜è®¤æ˜¯2ï¼Œå¦‚æœæ ·æœ¬é‡æ•°é‡çº§éå¸¸å¤§ï¼Œåˆ™å¢å¤§è¿™ä¸ªå€¼ã€‚ min_samples_leaf: å¶å­èŠ‚ç‚¹æœ€å°‘æ ·æœ¬æ•°ã€‚é™åˆ¶å¶å­èŠ‚ç‚¹æœ€å°‘çš„æ ·æœ¬æ•°ï¼Œå¦‚æœæŸå¶å­èŠ‚ç‚¹æ•°ç›®å°äºæ ·æœ¬æ•°ï¼Œåˆ™ä¼šå’Œå…„å¼ŸèŠ‚ç‚¹ä¸€èµ·è¢«å‰ªæã€‚é»˜è®¤æ˜¯1,å¯ä»¥è¾“å…¥æœ€å°‘çš„æ ·æœ¬æ•°çš„æ•´æ•°ï¼Œæˆ–è€…æœ€å°‘æ ·æœ¬æ•°å æ ·æœ¬æ€»æ•°çš„ç™¾åˆ†æ¯”ã€‚å¦‚æœæ ·æœ¬é‡ä¸å¤§ï¼Œä¸éœ€è¦ç®¡è¿™ä¸ªå€¼ã€‚å¦‚æœæ ·æœ¬é‡æ•°é‡çº§éå¸¸å¤§ï¼Œåˆ™æ¨èå¢å¤§è¿™ä¸ªå€¼ã€‚ min_weight_fraction_leaf: å¶å­èŠ‚ç‚¹æœ€å°çš„æ ·æœ¬æƒé‡å’Œè¿™ä¸ªå€¼é™åˆ¶äº†å¶å­èŠ‚ç‚¹æ‰€æœ‰æ ·æœ¬æƒé‡å’Œçš„æœ€å°å€¼ï¼Œå¦‚æœå°äºè¿™ä¸ªå€¼ï¼Œåˆ™ä¼šå’Œå…„å¼ŸèŠ‚ç‚¹ä¸€èµ·è¢«å‰ªæã€‚é»˜è®¤æ˜¯0ï¼Œå°±æ˜¯ä¸è€ƒè™‘æƒé‡é—®é¢˜ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬æœ‰è¾ƒå¤šæ ·æœ¬æœ‰ç¼ºå¤±å€¼ï¼Œæˆ–è€…åˆ†ç±»æ ‘æ ·æœ¬çš„åˆ†å¸ƒç±»åˆ«åå·®å¾ˆå¤§ï¼Œå°±ä¼šå¼•å…¥æ ·æœ¬æƒé‡ï¼Œè¿™æ—¶æˆ‘ä»¬å°±è¦æ³¨æ„è¿™ä¸ªå€¼äº†ã€‚ max_leaf_nodes: æœ€å¤§å¶å­èŠ‚ç‚¹æ•°ã€‚é€šè¿‡é™åˆ¶æœ€å¤§å¶å­èŠ‚ç‚¹æ•°ï¼Œå¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œé»˜è®¤æ˜¯Noneï¼Œå³ä¸é™åˆ¶æœ€å¤§çš„å¶å­èŠ‚ç‚¹æ•°ã€‚å¦‚æœåŠ äº†é™åˆ¶ï¼Œç®—æ³•ä¼šå»ºç«‹åœ¨æœ€å¤§å¶å­èŠ‚ç‚¹æ•°å†…æœ€ä¼˜çš„å†³ç­–æ ‘ã€‚å¦‚æœç‰¹å¾ä¸å¤šï¼Œå¯ä»¥ä¸è€ƒè™‘è¿™ä¸ªå€¼ï¼Œä½†æ˜¯å¦‚æœç‰¹å¾åˆ†æˆå¤šçš„è¯ï¼Œå¯ä»¥åŠ ä»¥é™åˆ¶ï¼Œå…·ä½“çš„å€¼å¯ä»¥é€šè¿‡äº¤å‰éªŒè¯å¾—åˆ°ã€‚ min_impurity_split: èŠ‚ç‚¹åˆ’åˆ†æœ€å°ä¸çº¯åº¦ã€‚è¿™ä¸ªå€¼é™åˆ¶äº†å†³ç­–æ ‘çš„å¢é•¿ï¼Œå¦‚æœæŸèŠ‚ç‚¹çš„ä¸çº¯åº¦(åŸºäºåŸºå°¼ç³»æ•°ï¼Œå‡æ–¹å·®)å°äºè¿™ä¸ªé˜ˆå€¼ï¼Œåˆ™è¯¥èŠ‚ç‚¹ä¸å†ç”Ÿæˆå­èŠ‚ç‚¹ã€‚å³ä¸ºå¶å­èŠ‚ç‚¹ ã€‚ä¸€èˆ¬ä¸æ¨èæ”¹åŠ¨é»˜è®¤å€¼1e-7ã€‚ GBDTæœ‰å¾ˆå¤šä¼˜ç‚¹ï¼š","title":"é›†æˆå­¦ä¹ ä¹‹GBD"},{"content":"1.ç®€ä»‹ é€»è¾‘å›å½’æ˜¯é¢è¯•å½“ä¸­éå¸¸å–œæ¬¢é—®åˆ°çš„ä¸€ä¸ªæœºå™¨å­¦ä¹ ç®—æ³•ï¼Œå› ä¸ºè¡¨é¢ä¸Šçœ‹é€»è¾‘å›å½’å½¢å¼ä¸Šå¾ˆç®€å•ï¼Œå¾ˆå¥½æŒæ¡ï¼Œä½†æ˜¯ä¸€é—®èµ·æ¥å°±å®¹æ˜“æ‡µé€¼ã€‚æ‰€ä»¥åœ¨é¢è¯•çš„æ—¶å€™ç»™å¤§å®¶çš„ç¬¬ä¸€ä¸ªå»ºè®®ä¸è¦è¯´è‡ªå·±ç²¾é€šé€»è¾‘å›å½’ï¼Œéå¸¸å®¹æ˜“è¢«é—®å€’ï¼Œä»è€Œå‡åˆ†ã€‚ä¸‹é¢æ€»ç»“äº†ä¸€äº›å¹³å¸¸æˆ‘åœ¨ä½œä¸ºé¢è¯•å®˜é¢è¯•åˆ«äººå’Œè¢«åˆ«äººé¢è¯•çš„æ—¶å€™ï¼Œç»å¸¸é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚\nRegressioné—®é¢˜çš„å¸¸è§„æ­¥éª¤ä¸ºï¼š\nå¯»æ‰¾hå‡½æ•°ï¼ˆå³å‡è®¾ä¼°è®¡çš„å‡½æ•°ï¼‰ï¼› æ„é€ Jå‡½æ•°ï¼ˆæŸå¤±å‡½æ•°ï¼‰ï¼› æƒ³åŠæ³•ä½¿å¾—Jå‡½æ•°æœ€å°å¹¶æ±‚å¾—å›å½’å‚æ•°ï¼ˆÎ¸ï¼‰ï¼› æ•°æ®æ‹Ÿåˆé—®é¢˜ 2.æ­£å¼ä»‹ç» å¦‚ä½•å‡¸æ˜¾ä½ æ˜¯ä¸€ä¸ªå¯¹é€»è¾‘å›å½’å·²ç»éå¸¸äº†è§£çš„äººå‘¢ã€‚é‚£å°±æ˜¯ç”¨ä¸€å¥è¯æ¦‚æ‹¬å®ƒï¼é€»è¾‘å›å½’å‡è®¾æ•°æ®æœä»ä¼¯åŠªåˆ©åˆ†å¸ƒ,é€šè¿‡æå¤§åŒ–ä¼¼ç„¶å‡½æ•°çš„æ–¹æ³•ï¼Œè¿ç”¨æ¢¯åº¦ä¸‹é™æ¥æ±‚è§£å‚æ•°ï¼Œæ¥è¾¾åˆ°å°†æ•°æ®äºŒåˆ†ç±»çš„ç›®çš„ã€‚\nè¿™é‡Œé¢å…¶å®åŒ…å«äº†5ä¸ªç‚¹ 1ï¼šé€»è¾‘å›å½’çš„å‡è®¾ï¼Œ2ï¼šé€»è¾‘å›å½’çš„æŸå¤±å‡½æ•°ï¼Œ3ï¼šé€»è¾‘å›å½’çš„æ±‚è§£æ–¹æ³•ï¼Œ4ï¼šé€»è¾‘å›å½’çš„ç›®çš„ï¼Œ5:é€»è¾‘å›å½’å¦‚ä½•åˆ†ç±»ã€‚è¿™äº›é—®é¢˜æ˜¯è€ƒæ ¸ä½ å¯¹é€»è¾‘å›å½’çš„åŸºæœ¬äº†è§£ã€‚\né€»è¾‘å›å½’çš„åŸºæœ¬å‡è®¾ ä»»ä½•çš„æ¨¡å‹éƒ½æ˜¯æœ‰è‡ªå·±çš„å‡è®¾ï¼Œåœ¨è¿™ä¸ªå‡è®¾ä¸‹æ¨¡å‹æ‰æ˜¯é€‚ç”¨çš„ã€‚é€»è¾‘å›å½’çš„ç¬¬ä¸€ä¸ªåŸºæœ¬å‡è®¾æ˜¯**å‡è®¾æ•°æ®æœä»ä¼¯åŠªåˆ©åˆ†å¸ƒã€‚**ä¼¯åŠªåˆ©åˆ†å¸ƒæœ‰ä¸€ä¸ªç®€å•çš„ä¾‹å­æ˜¯æŠ›ç¡¬å¸ï¼ŒæŠ›ä¸­ä¸ºæ­£é¢çš„æ¦‚ç‡æ˜¯pp,æŠ›ä¸­ä¸ºè´Ÿé¢çš„æ¦‚ç‡æ˜¯1âˆ’p1âˆ’p.åœ¨é€»è¾‘å›å½’è¿™ä¸ªæ¨¡å‹é‡Œé¢æ˜¯å‡è®¾ hÎ¸(x)hÎ¸(x) ä¸ºæ ·æœ¬ä¸ºæ­£çš„æ¦‚ç‡ï¼Œ1âˆ’hÎ¸(x)1âˆ’hÎ¸(x)ä¸ºæ ·æœ¬ä¸ºè´Ÿçš„æ¦‚ç‡ã€‚é‚£ä¹ˆæ•´ä¸ªæ¨¡å‹å¯ä»¥æè¿°ä¸º\nhÎ¸(x;Î¸)=phÎ¸(x;Î¸)=p\né€»è¾‘å›å½’çš„ç¬¬äºŒä¸ªå‡è®¾æ˜¯å‡è®¾æ ·æœ¬ä¸ºæ­£çš„æ¦‚ç‡æ˜¯\np=11+eâˆ’Î¸Txp=11+eâˆ’Î¸Tx\næ‰€ä»¥é€»è¾‘å›å½’çš„æœ€ç»ˆå½¢å¼\nhÎ¸(x;Î¸)=11+eâˆ’Î¸Tx\né€»è¾‘å›å½’çš„æ±‚è§£æ–¹æ³• ç”±äºè¯¥æå¤§ä¼¼ç„¶å‡½æ•°æ— æ³•ç›´æ¥æ±‚è§£ï¼Œæˆ‘ä»¬ä¸€èˆ¬é€šè¿‡å¯¹è¯¥å‡½æ•°è¿›è¡Œæ¢¯åº¦ä¸‹é™æ¥ä¸æ–­é€¼æ€¥æœ€ä¼˜è§£ã€‚åœ¨è¿™ä¸ªåœ°æ–¹å…¶å®ä¼šæœ‰ä¸ªåŠ åˆ†çš„é¡¹ï¼Œè€ƒå¯Ÿä½ å¯¹å…¶ä»–ä¼˜åŒ–æ–¹æ³•çš„äº†è§£ã€‚å› ä¸ºå°±æ¢¯åº¦ä¸‹é™æœ¬èº«æ¥çœ‹çš„è¯å°±æœ‰éšæœºæ¢¯åº¦ä¸‹é™ï¼Œæ‰¹æ¢¯åº¦ä¸‹é™ï¼Œsmall batch æ¢¯åº¦ä¸‹é™ä¸‰ç§æ–¹å¼ï¼Œé¢è¯•å®˜å¯èƒ½ä¼šé—®è¿™ä¸‰ç§æ–¹å¼çš„ä¼˜åŠ£ä»¥åŠå¦‚ä½•é€‰æ‹©æœ€åˆé€‚çš„æ¢¯åº¦ä¸‹é™æ–¹å¼ã€‚\nç®€å•æ¥è¯´ æ‰¹æ¢¯åº¦ä¸‹é™ä¼šè·å¾—å…¨å±€æœ€ä¼˜è§£ï¼Œç¼ºç‚¹æ˜¯åœ¨æ›´æ–°æ¯ä¸ªå‚æ•°çš„æ—¶å€™éœ€è¦éå†æ‰€æœ‰çš„æ•°æ®ï¼Œè®¡ç®—é‡ä¼šå¾ˆå¤§ï¼Œå¹¶ä¸”ä¼šæœ‰å¾ˆå¤šçš„å†—ä½™è®¡ç®—ï¼Œå¯¼è‡´çš„ç»“æœæ˜¯å½“æ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œæ¯ä¸ªå‚æ•°çš„æ›´æ–°éƒ½ä¼šå¾ˆæ…¢ã€‚\néšæœºæ¢¯åº¦ä¸‹é™æ˜¯ä»¥é«˜æ–¹å·®é¢‘ç¹æ›´æ–°ï¼Œä¼˜ç‚¹æ˜¯ä½¿å¾—sgdï¼ˆéšæœºæ¢¯åº¦ä¸‹é™ï¼‰ä¼šè·³åˆ°æ–°çš„å’Œæ½œåœ¨æ›´å¥½çš„å±€éƒ¨æœ€ä¼˜è§£ï¼Œç¼ºç‚¹æ˜¯ä½¿å¾—æ”¶æ•›åˆ°å±€éƒ¨æœ€ä¼˜è§£çš„è¿‡ç¨‹æ›´åŠ çš„å¤æ‚ã€‚\nå¦‚æœä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•(æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•)ï¼Œé‚£ä¹ˆæ¯æ¬¡è¿­ä»£è¿‡ç¨‹ä¸­éƒ½è¦å¯¹ ä¸ªæ ·æœ¬è¿›è¡Œæ±‚æ¢¯åº¦ï¼Œæ‰€ä»¥å¼€é”€éå¸¸å¤§ï¼Œéšæœºæ¢¯åº¦ä¸‹é™çš„æ€æƒ³å°±æ˜¯éšæœºé‡‡æ ·ä¸€ä¸ªæ ·æœ¬ æ¥æ›´æ–°å‚æ•°ï¼Œé‚£ä¹ˆè®¡ç®—å¼€é”€å°±ä» ä¸‹é™åˆ° ã€‚\néšæœºæ¢¯åº¦ä¸‹é™è™½ç„¶æé«˜äº†è®¡ç®—æ•ˆç‡ï¼Œé™ä½äº†è®¡ç®—å¼€é”€ï¼Œä½†æ˜¯ç”±äºæ¯æ¬¡è¿­ä»£åªéšæœºé€‰æ‹©ä¸€ä¸ªæ ·æœ¬ï¼Œå› æ­¤éšæœºæ€§æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥ä¸‹é™è¿‡ç¨‹ä¸­éå¸¸æ›²æŠ˜\nå¯ä»¥çœ‹åˆ°å¤šäº†éšæœºä¸¤ä¸ªå­—ï¼Œéšæœºä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ç”¨æ ·æœ¬ä¸­çš„ä¸€ä¸ªä¾‹å­æ¥è¿‘ä¼¼æˆ‘æ‰€æœ‰çš„æ ·æœ¬ï¼Œæ¥è°ƒæ•´Î¸ï¼Œå› è€Œéšæœºæ¢¯åº¦ä¸‹é™æ˜¯ä¼šå¸¦æ¥ä¸€å®šçš„é—®é¢˜ï¼Œå› ä¸ºè®¡ç®—å¾—åˆ°çš„å¹¶ä¸æ˜¯å‡†ç¡®çš„ä¸€ä¸ªæ¢¯åº¦ï¼Œ**å¯¹äºæœ€ä¼˜åŒ–é—®é¢˜ï¼Œå‡¸é—®é¢˜ï¼Œ**è™½ç„¶ä¸æ˜¯æ¯æ¬¡è¿­ä»£å¾—åˆ°çš„æŸå¤±å‡½æ•°éƒ½å‘ç€å…¨å±€æœ€ä¼˜æ–¹å‘ï¼Œ ä½†æ˜¯å¤§çš„æ•´ä½“çš„æ–¹å‘æ˜¯å‘å…¨å±€æœ€ä¼˜è§£çš„ï¼Œæœ€ç»ˆçš„ç»“æœå¾€å¾€æ˜¯åœ¨å…¨å±€æœ€ä¼˜è§£é™„è¿‘ã€‚\nå°æ‰¹é‡æ¢¯åº¦ä¸‹é™ç»“åˆäº†sgdå’Œbatch gdçš„ä¼˜ç‚¹ï¼Œæ¯æ¬¡æ›´æ–°çš„æ—¶å€™ä½¿ç”¨nä¸ªæ ·æœ¬ã€‚å‡å°‘äº†å‚æ•°æ›´æ–°çš„æ¬¡æ•°ï¼Œå¯ä»¥è¾¾åˆ°æ›´åŠ ç¨³å®šæ”¶æ•›ç»“æœï¼Œä¸€èˆ¬åœ¨æ·±åº¦å­¦ä¹ å½“ä¸­æˆ‘ä»¬é‡‡ç”¨è¿™ç§æ–¹æ³•ã€‚å°æ‰¹é‡æ¢¯åº¦ä¸‹é™çš„å¼€é”€ä¸º å…¶ä¸­ æ˜¯æ‰¹é‡å¤§å°ã€‚\nå…¶å®è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªéšè—çš„æ›´åŠ æ·±çš„åŠ åˆ†é¡¹ï¼Œçœ‹ä½ äº†ä¸äº†è§£è¯¸å¦‚Adamï¼ŒåŠ¨é‡æ³•ç­‰ä¼˜åŒ–æ–¹æ³•ã€‚å› ä¸ºä¸Šè¿°æ–¹æ³•å…¶å®è¿˜æœ‰ä¸¤ä¸ªè‡´å‘½çš„é—®é¢˜ã€‚ ç¬¬ä¸€ä¸ªæ˜¯å¦‚ä½•å¯¹æ¨¡å‹é€‰æ‹©åˆé€‚çš„å­¦ä¹ ç‡ã€‚è‡ªå§‹è‡³ç»ˆä¿æŒåŒæ ·çš„å­¦ä¹ ç‡å…¶å®ä¸å¤ªåˆé€‚ã€‚å› ä¸ºä¸€å¼€å§‹å‚æ•°åˆšåˆšå¼€å§‹å­¦ä¹ çš„æ—¶å€™ï¼Œæ­¤æ—¶çš„å‚æ•°å’Œæœ€ä¼˜è§£éš”çš„æ¯”è¾ƒè¿œï¼Œéœ€è¦ä¿æŒä¸€ä¸ªè¾ƒå¤§çš„å­¦ä¹ ç‡å°½å¿«é€¼è¿‘æœ€ä¼˜è§£ã€‚ä½†æ˜¯å­¦ä¹ åˆ°åé¢çš„æ—¶å€™ï¼Œå‚æ•°å’Œæœ€ä¼˜è§£å·²ç»éš”çš„æ¯”è¾ƒè¿‘äº†ï¼Œä½ è¿˜ä¿æŒæœ€åˆçš„å­¦ä¹ ç‡ï¼Œå®¹æ˜“è¶Šè¿‡æœ€ä¼˜ç‚¹ï¼Œåœ¨æœ€ä¼˜ç‚¹é™„è¿‘æ¥å›æŒ¯è¡ï¼Œé€šä¿—ä¸€ç‚¹è¯´ï¼Œå°±å¾ˆå®¹æ˜“å­¦è¿‡å¤´äº†ï¼Œè·‘åäº†ã€‚ ç¬¬äºŒä¸ªæ˜¯å¦‚ä½•å¯¹å‚æ•°é€‰æ‹©åˆé€‚çš„å­¦ä¹ ç‡ã€‚åœ¨å®è·µä¸­ï¼Œå¯¹æ¯ä¸ªå‚æ•°éƒ½ä¿æŒçš„åŒæ ·çš„å­¦ä¹ ç‡ä¹Ÿæ˜¯å¾ˆä¸åˆç†çš„ã€‚æœ‰äº›å‚æ•°æ›´æ–°é¢‘ç¹ï¼Œé‚£ä¹ˆå­¦ä¹ ç‡å¯ä»¥é€‚å½“å°ä¸€ç‚¹ã€‚æœ‰äº›å‚æ•°æ›´æ–°ç¼“æ…¢ï¼Œé‚£ä¹ˆå­¦ä¹ ç‡å°±åº”è¯¥å¤§ä¸€ç‚¹ã€‚è¿™é‡Œæˆ‘ä»¬ä¸å±•å¼€ï¼Œæœ‰ç©ºæˆ‘ä¼šä¸“é—¨å‡ºä¸€ä¸ªä¸“é¢˜ä»‹ç»ã€‚ é€»è¾‘å›å½’çš„ç›®çš„ è¯¥å‡½æ•°çš„ç›®çš„ä¾¿æ˜¯å°†æ•°æ®äºŒåˆ†ç±»ï¼Œæé«˜å‡†ç¡®ç‡ã€‚ é€»è¾‘å›å½’å¦‚ä½•åˆ†ç±» é€»è¾‘å›å½’ä½œä¸ºä¸€ä¸ªå›å½’(ä¹Ÿå°±æ˜¯yå€¼æ˜¯è¿ç»­çš„)ï¼Œå¦‚ä½•åº”ç”¨åˆ°åˆ†ç±»ä¸Šå»å‘¢ã€‚yå€¼ç¡®å®æ˜¯ä¸€ä¸ªè¿ç»­çš„å˜é‡ã€‚é€»è¾‘å›å½’çš„åšæ³•æ˜¯åˆ’å®šä¸€ä¸ªé˜ˆå€¼ï¼Œyå€¼å¤§äºè¿™ä¸ªé˜ˆå€¼çš„æ˜¯ä¸€ç±»ï¼Œyå€¼å°äºè¿™ä¸ªé˜ˆå€¼çš„æ˜¯å¦å¤–ä¸€ç±»ã€‚é˜ˆå€¼å…·ä½“å¦‚ä½•è°ƒæ•´æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ã€‚ä¸€èˆ¬ä¼šé€‰æ‹©0.5åšä¸ºé˜ˆå€¼æ¥åˆ’åˆ†ã€‚ é€»è¾‘å›å½’çš„æŸå¤±å‡½æ•°ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æå¤§ä¼¼ç„¶å‡½æ•°ä½œä¸ºæŸå¤±å‡½æ•°ï¼Ÿ æŸå¤±å‡½æ•°ä¸€èˆ¬æœ‰å››ç§ï¼Œå¹³æ–¹æŸå¤±å‡½æ•°ï¼Œå¯¹æ•°æŸå¤±å‡½æ•°ï¼ŒHingeLoss0-1æŸå¤±å‡½æ•°ï¼Œç»å¯¹å€¼æŸå¤±å‡½æ•°ã€‚å°†æå¤§ä¼¼ç„¶å‡½æ•°å–å¯¹æ•°ä»¥åç­‰åŒäºå¯¹æ•°æŸå¤±å‡½æ•°ã€‚åœ¨é€»è¾‘å›å½’è¿™ä¸ªæ¨¡å‹ä¸‹ï¼Œå¯¹æ•°æŸå¤±å‡½æ•°çš„è®­ç»ƒæ±‚è§£å‚æ•°çš„é€Ÿåº¦æ˜¯æ¯”è¾ƒå¿«çš„ã€‚è‡³äºåŸå› å¤§å®¶å¯ä»¥æ±‚å‡ºè¿™ä¸ªå¼å­çš„æ¢¯åº¦æ›´æ–°\nè¿™ä¸ªå¼å­çš„æ›´æ–°é€Ÿåº¦åªå’Œç›¸å…³ã€‚å’Œsigmodå‡½æ•°æœ¬èº«çš„æ¢¯åº¦æ˜¯æ— å…³çš„ã€‚è¿™æ ·æ›´æ–°çš„é€Ÿåº¦æ˜¯å¯ä»¥è‡ªå§‹è‡³ç»ˆéƒ½æ¯”è¾ƒçš„ç¨³å®šã€‚\nä¸ºä»€ä¹ˆä¸é€‰å¹³æ–¹æŸå¤±å‡½æ•°çš„å‘¢ï¼Ÿå…¶ä¸€æ˜¯å› ä¸ºå¦‚æœä½ ä½¿ç”¨å¹³æ–¹æŸå¤±å‡½æ•°ï¼Œä½ ä¼šå‘ç°æ¢¯åº¦æ›´æ–°çš„é€Ÿåº¦å’Œsigmodå‡½æ•°æœ¬èº«çš„æ¢¯åº¦æ˜¯å¾ˆç›¸å…³çš„ã€‚sigmodå‡½æ•°åœ¨å®ƒåœ¨å®šä¹‰åŸŸå†…çš„æ¢¯åº¦éƒ½ä¸å¤§äº0.25ã€‚è¿™æ ·è®­ç»ƒä¼šéå¸¸çš„æ…¢ã€‚\né€»è¾‘å›å½’åœ¨è®­ç»ƒçš„è¿‡ç¨‹å½“ä¸­ï¼Œå¦‚æœæœ‰å¾ˆå¤šçš„ç‰¹å¾é«˜åº¦ç›¸å…³æˆ–è€…è¯´æœ‰ä¸€ä¸ªç‰¹å¾é‡å¤äº†100éï¼Œä¼šé€ æˆæ€æ ·çš„å½±å“ï¼Ÿ å…ˆè¯´ç»“è®ºï¼Œå¦‚æœåœ¨æŸå¤±å‡½æ•°æœ€ç»ˆæ”¶æ•›çš„æƒ…å†µä¸‹ï¼Œå…¶å®å°±ç®—æœ‰å¾ˆå¤šç‰¹å¾é«˜åº¦ç›¸å…³ä¹Ÿä¸ä¼šå½±å“åˆ†ç±»å™¨çš„æ•ˆæœã€‚\nä½†æ˜¯å¯¹ç‰¹å¾æœ¬èº«æ¥è¯´çš„è¯ï¼Œå‡è®¾åªæœ‰ä¸€ä¸ªç‰¹å¾ï¼Œåœ¨ä¸è€ƒè™‘é‡‡æ ·çš„æƒ…å†µä¸‹ï¼Œä½ ç°åœ¨å°†å®ƒé‡å¤100éã€‚è®­ç»ƒä»¥åå®Œä»¥åï¼Œæ•°æ®è¿˜æ˜¯è¿™ä¹ˆå¤šï¼Œä½†æ˜¯è¿™ä¸ªç‰¹å¾æœ¬èº«é‡å¤äº†100éï¼Œå®è´¨ä¸Šå°†åŸæ¥çš„ç‰¹å¾åˆ†æˆäº†100ä»½ï¼Œæ¯ä¸€ä¸ªç‰¹å¾éƒ½æ˜¯åŸæ¥ç‰¹å¾æƒé‡å€¼çš„ç™¾åˆ†ä¹‹ä¸€\nå¦‚æœåœ¨éšæœºé‡‡æ ·çš„æƒ…å†µä¸‹ï¼Œå…¶å®è®­ç»ƒæ”¶æ•›å®Œä»¥åï¼Œè¿˜æ˜¯å¯ä»¥è®¤ä¸ºè¿™100ä¸ªç‰¹å¾å’ŒåŸæ¥é‚£ä¸€ä¸ªç‰¹å¾æ‰®æ¼”çš„æ•ˆæœä¸€æ ·ï¼Œåªæ˜¯å¯èƒ½ä¸­é—´å¾ˆå¤šç‰¹å¾çš„å€¼æ­£è´Ÿç›¸æ¶ˆäº†ã€‚\nä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜æ˜¯ä¼šåœ¨è®­ç»ƒçš„è¿‡ç¨‹å½“ä¸­å°†é«˜åº¦ç›¸å…³çš„ç‰¹å¾å»æ‰ï¼Ÿ å»æ‰é«˜åº¦ç›¸å…³çš„ç‰¹å¾ä¼šè®©æ¨¡å‹çš„å¯è§£é‡Šæ€§æ›´å¥½ å¯ä»¥å¤§å¤§æé«˜è®­ç»ƒçš„é€Ÿåº¦ã€‚å¦‚æœæ¨¡å‹å½“ä¸­æœ‰å¾ˆå¤šç‰¹å¾é«˜åº¦ç›¸å…³çš„è¯ï¼Œå°±ç®—æŸå¤±å‡½æ•°æœ¬èº«æ”¶æ•›äº†ï¼Œä½†å®é™…ä¸Šå‚æ•°æ˜¯æ²¡æœ‰æ”¶æ•›çš„ï¼Œè¿™æ ·ä¼šæ‹‰ä½è®­ç»ƒçš„é€Ÿåº¦ã€‚å…¶æ¬¡æ˜¯ç‰¹å¾å¤šäº†ï¼Œæœ¬èº«å°±ä¼šå¢å¤§è®­ç»ƒçš„æ—¶é—´ã€‚ 4.é€»è¾‘å›å½’çš„ä¼˜ç¼ºç‚¹æ€»ç»“ ä¼˜ç‚¹\nå½¢å¼ç®€å•ï¼Œæ¨¡å‹çš„å¯è§£é‡Šæ€§éå¸¸å¥½ã€‚ä»ç‰¹å¾çš„æƒé‡å¯ä»¥çœ‹åˆ°ä¸åŒçš„ç‰¹å¾å¯¹æœ€åç»“æœçš„å½±å“ï¼ŒæŸä¸ªç‰¹å¾çš„æƒé‡å€¼æ¯”è¾ƒé«˜ï¼Œé‚£ä¹ˆè¿™ä¸ªç‰¹å¾æœ€åå¯¹ç»“æœçš„å½±å“ä¼šæ¯”è¾ƒå¤§ã€‚\næ¨¡å‹æ•ˆæœä¸é”™ã€‚åœ¨å·¥ç¨‹ä¸Šæ˜¯å¯ä»¥æ¥å—çš„ï¼ˆä½œä¸ºbaseline)ï¼Œå¦‚æœç‰¹å¾å·¥ç¨‹åšçš„å¥½ï¼Œæ•ˆæœä¸ä¼šå¤ªå·®ï¼Œå¹¶ä¸”ç‰¹å¾å·¥ç¨‹å¯ä»¥å¤§å®¶å¹¶è¡Œå¼€å‘ï¼Œå¤§å¤§åŠ å¿«å¼€å‘çš„é€Ÿåº¦ã€‚\nè®­ç»ƒé€Ÿåº¦è¾ƒå¿«ã€‚åˆ†ç±»çš„æ—¶å€™ï¼Œè®¡ç®—é‡ä»…ä»…åªå’Œç‰¹å¾çš„æ•°ç›®ç›¸å…³ã€‚å¹¶ä¸”é€»è¾‘å›å½’çš„åˆ†å¸ƒå¼ä¼˜åŒ–sgdå‘å±•æ¯”è¾ƒæˆç†Ÿï¼Œè®­ç»ƒçš„é€Ÿåº¦å¯ä»¥é€šè¿‡å †æœºå™¨è¿›ä¸€æ­¥æé«˜ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åœ¨çŸ­æ—¶é—´å†…è¿­ä»£å¥½å‡ ä¸ªç‰ˆæœ¬çš„æ¨¡å‹ã€‚\nèµ„æºå ç”¨å°,å°¤å…¶æ˜¯å†…å­˜ã€‚å› ä¸ºåªéœ€è¦å­˜å‚¨å„ä¸ªç»´åº¦çš„ç‰¹å¾å€¼ï¼Œã€‚\næ–¹ä¾¿è¾“å‡ºç»“æœè°ƒæ•´ã€‚é€»è¾‘å›å½’å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¾—åˆ°æœ€åçš„åˆ†ç±»ç»“æœï¼Œå› ä¸ºè¾“å‡ºçš„æ˜¯æ¯ä¸ªæ ·æœ¬çš„æ¦‚ç‡åˆ†æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„å¯¹è¿™äº›æ¦‚ç‡åˆ†æ•°è¿›è¡Œcutoffï¼Œä¹Ÿå°±æ˜¯åˆ’åˆ†é˜ˆå€¼(å¤§äºæŸä¸ªé˜ˆå€¼çš„æ˜¯ä¸€ç±»ï¼Œå°äºæŸä¸ªé˜ˆå€¼çš„æ˜¯ä¸€ç±»)ã€‚\nä½†æ˜¯é€»è¾‘å›å½’æœ¬èº«ä¹Ÿæœ‰è®¸å¤šçš„ç¼ºç‚¹:\nå‡†ç¡®ç‡å¹¶ä¸æ˜¯å¾ˆé«˜ã€‚å› ä¸ºå½¢å¼éå¸¸çš„ç®€å•(éå¸¸ç±»ä¼¼çº¿æ€§æ¨¡å‹)ï¼Œå¾ˆéš¾å»æ‹Ÿåˆæ•°æ®çš„çœŸå®åˆ†å¸ƒã€‚\nå¾ˆéš¾å¤„ç†æ•°æ®ä¸å¹³è¡¡çš„é—®é¢˜ã€‚ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœæˆ‘ä»¬å¯¹äºä¸€ä¸ªæ­£è´Ÿæ ·æœ¬éå¸¸ä¸å¹³è¡¡çš„é—®é¢˜æ¯”å¦‚æ­£è´Ÿæ ·æœ¬æ¯” 10000:1.æˆ‘ä»¬æŠŠæ‰€æœ‰æ ·æœ¬éƒ½é¢„æµ‹ä¸ºæ­£ä¹Ÿèƒ½ä½¿æŸå¤±å‡½æ•°çš„å€¼æ¯”è¾ƒå°ã€‚ä½†æ˜¯ä½œä¸ºä¸€ä¸ªåˆ†ç±»å™¨ï¼Œå®ƒå¯¹æ­£è´Ÿæ ·æœ¬çš„åŒºåˆ†èƒ½åŠ›ä¸ä¼šå¾ˆå¥½ã€‚\nå¤„ç†éçº¿æ€§æ•°æ®è¾ƒéº»çƒ¦ã€‚é€»è¾‘å›å½’åœ¨ä¸å¼•å…¥å…¶ä»–æ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œåªèƒ½å¤„ç†çº¿æ€§å¯åˆ†çš„æ•°æ®ï¼Œæˆ–è€…è¿›ä¸€æ­¥è¯´ï¼Œå¤„ç†äºŒåˆ†ç±»çš„é—®é¢˜ ã€‚\né€»è¾‘å›å½’æœ¬èº«æ— æ³•ç­›é€‰ç‰¹å¾ã€‚æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šç”¨gbdtæ¥ç­›é€‰ç‰¹å¾ï¼Œç„¶åå†ä¸Šé€»è¾‘å›å½’ã€‚\næ€ä¹ˆé˜²æ­¢è¿‡æ‹Ÿåˆï¼Ÿ é€šè¿‡æ­£åˆ™åŒ–æ–¹æ³•ã€‚æ­£åˆ™åŒ–æ–¹æ³•æ˜¯æŒ‡åœ¨è¿›è¡Œç›®æ ‡å‡½æ•°æˆ–ä»£ä»·å‡½æ•°ä¼˜åŒ–æ—¶ï¼Œåœ¨ç›®æ ‡å‡½æ•°æˆ–ä»£ä»·å‡½æ•°åé¢åŠ ä¸Šä¸€ä¸ªæ­£åˆ™é¡¹ï¼Œä¸€èˆ¬æœ‰L1æ­£åˆ™ä¸L2æ­£åˆ™ç­‰\nä¸ºä»€ä¹ˆæ­£åˆ™åŒ–å¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆï¼Ÿ è¿‡æ‹Ÿåˆè¡¨ç°åœ¨è®­ç»ƒæ•°æ®ä¸Šçš„è¯¯å·®éå¸¸å°ï¼Œè€Œåœ¨æµ‹è¯•æ•°æ®ä¸Šè¯¯å·®åè€Œå¢å¤§ã€‚å…¶åŸå› ä¸€èˆ¬æ˜¯æ¨¡å‹è¿‡äºå¤æ‚ï¼Œè¿‡åˆ†å¾—å»æ‹Ÿåˆæ•°æ®çš„å™ªå£°**ã€‚æ­£åˆ™åŒ–åˆ™æ˜¯å¯¹æ¨¡å‹å‚æ•°æ·»åŠ å…ˆéªŒï¼Œä½¿å¾—æ¨¡å‹å¤æ‚åº¦è¾ƒå°ï¼Œå¯¹äºå™ªå£°æ‰°åŠ¨ç›¸å¯¹è¾ƒå°**ã€‚\næœ€ç®€å•çš„è§£é‡Šå°±æ˜¯åŠ äº†å…ˆéªŒã€‚åœ¨æ•°æ®å°‘çš„æ—¶å€™ï¼Œå…ˆéªŒçŸ¥è¯†å¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆã€‚\nä¸¾ä¸ªä¾‹å­ï¼š\nç¡¬å¸ï¼Œæ¨æ–­æ­£é¢æœä¸Šçš„æ¦‚ç‡ã€‚å¦‚æœåªèƒ½æŠ›5æ¬¡ï¼Œå¾ˆå¯èƒ½5æ¬¡å…¨æ­£é¢æœä¸Šï¼Œè¿™æ ·ä½ å°±å¾—å‡ºé”™è¯¯çš„ç»“è®ºï¼šæ­£é¢æœä¸Šçš„æ¦‚ç‡æ˜¯1\u0026mdash;\u0026mdash;\u0026ndash;è¿‡æ‹Ÿåˆï¼å¦‚æœä½ åœ¨æ¨¡å‹é‡ŒåŠ æ­£é¢æœä¸Šæ¦‚ç‡æ˜¯0.5çš„å…ˆéªŒï¼Œç»“æœå°±ä¸ä¼šé‚£ä¹ˆç¦»è°±ã€‚è¿™å…¶å®å°±æ˜¯æ­£åˆ™\nL1æ­£åˆ™å’ŒL2æ­£åˆ™æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ç›¸åŒç‚¹ï¼šéƒ½ç”¨äºé¿å…è¿‡æ‹Ÿåˆ\nä¸åŒç‚¹ï¼šL2ä¸L1çš„åŒºåˆ«åœ¨äºï¼ŒL1æ­£åˆ™æ˜¯æ‹‰æ™®æ‹‰æ–¯å…ˆéªŒï¼Œè€ŒL2æ­£åˆ™åˆ™æ˜¯é«˜æ–¯å…ˆéªŒã€‚L1å¯ä»¥äº§ç”Ÿç¨€ç–è§£,å¯ä»¥è®©ä¸€éƒ¨åˆ†ç‰¹å¾çš„ç³»æ•°ç¼©å°åˆ°0ï¼Œä»è€Œé—´æ¥å®ç°ç‰¹å¾é€‰æ‹©ã€‚æ‰€ä»¥L1é€‚ç”¨äºç‰¹å¾ä¹‹é—´æœ‰å…³è”çš„æƒ…å†µã€‚L2è®©æ‰€æœ‰ç‰¹å¾çš„ç³»æ•°éƒ½ç¼©å°ï¼Œä½†æ˜¯ä¸ä¼šå‡ä¸º0ï¼Œå®ƒä¼šä½¿ä¼˜åŒ–æ±‚è§£ç¨³å®šå¿«é€Ÿã€‚æ‰€ä»¥L2é€‚ç”¨äºç‰¹å¾ä¹‹é—´æ²¡æœ‰å…³è”çš„æƒ…å†µ\nå› ä¸ºL1å’Œæœä»æ‹‰æ™®æ‹‰æ–¯åˆ†å¸ƒï¼Œæ‰€ä»¥L1åœ¨0ç‚¹å¤„ä¸å¯å¯¼ï¼Œéš¾ä»¥è®¡ç®—ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥ä½¿ç”¨Proximal Algorithmsæˆ–è€…ADMMæ¥è§£å†³ã€‚\nå¦‚ä½•ç”¨LRè§£å†³éçº¿æ€§é—®é¢˜ï¼Ÿ å°†ç‰¹å¾ç¦»æ•£æˆé«˜ç»´çš„01ç‰¹å¾å¯ä»¥è§£å†³åˆ†ç±»æ¨¡å‹çš„éçº¿æ€§é—®é¢˜\n3. é€»è¾‘å›å½’æ˜¯çº¿æ€§æ¨¡å‹ä¹ˆï¼Œè¯´ä¸‹åŸå› ï¼Ÿ ç‹­ä¹‰çº¿æ€§æ¨¡å‹çš„å‰ææ˜¯å› å˜é‡è¯¯å·®æ˜¯æ­£æ€åˆ†å¸ƒï¼Œä½†å¾ˆå¤šæƒ…å†µä¸‹è¿™å¹¶ä¸æ»¡è¶³ï¼Œæ¯”å¦‚å¯¹è¶³çƒæ¯”åˆ†çš„é¢„æµ‹æ˜¾ç„¶ç”¨æ³Šæ¾åˆ†å¸ƒæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚è€Œå¹¿ä¹‰çš„â€å¹¿â€åœ¨äºå¼•å…¥äº†è”ç³»å‡½æ•°ï¼Œäºæ˜¯è¯¯å·®å˜æˆäº†åªè¦æ»¡è¶³æŒ‡æ•°åˆ†å¸ƒæ—å°±è¡Œäº†ï¼Œå› æ­¤é€‚ç”¨æ€§æ›´å¼ºã€‚\nâ€‹ ç®€å•æ¥è¯´å¹¿ä¹‰çº¿æ€§æ¨¡å‹åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€ä¸ªéƒ¨åˆ†æ˜¯æè¿°äº†è‡ªå˜é‡å’Œå› å˜é‡çš„ç³»ç»Ÿå…³ç³»ï¼Œä¹Ÿå°±æ˜¯â€çº¿æ€§â€æ‰€åœ¨ï¼›ç¬¬äºŒä¸ªéƒ¨åˆ†æ˜¯æè¿°äº†å› å˜é‡çš„è¯¯å·®ï¼Œè¿™å¯ä»¥å»ºæ¨¡æˆå„ç§æ»¡è¶³æŒ‡æ•°åˆ†å¸ƒæ—çš„åˆ†å¸ƒã€‚è€Œè”ç³»å‡½æ•°å°±æ˜¯æŠŠè¿™ä¸¤ä¸ªéƒ¨åˆ†è¿æ¥èµ·æ¥çš„æ¡¥æ¢ï¼Œä¹Ÿå°±æ˜¯æŠŠå› å˜é‡çš„æœŸæœ›è¡¨ç¤ºä¸ºäº†è‡ªå˜é‡çº¿æ€§ç»„åˆçš„å‡½æ•°ã€‚è€Œåƒé€»è¾‘å›å½’è¿™æ ·çš„ç®€å•å¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼Œå®é™…æ˜¯å°†è‡ªå˜é‡çš„çº¿æ€§ç»„åˆå˜æˆäº†è”ç³»å‡½æ•°çš„è‡ªç„¶å‚æ•°ï¼Œè¿™ç±»è”ç³»å‡½æ•°ä¹Ÿå¯ä»¥å«åšæ­£åˆ™è”ç³»å‡½æ•°ã€‚\n4. é€»è¾‘å›å½’ç®—æ³•ä¸ºä»€ä¹ˆç”¨çš„æ˜¯sigmoidå‡½æ•°è€Œä¸ç”¨é˜¶è·ƒå‡½æ•°ï¼Ÿ é˜¶è·ƒå‡½æ•°è™½ç„¶èƒ½å¤Ÿç›´è§‚åˆ»ç”»åˆ†ç±»çš„é”™è¯¯ç‡ï¼Œä½†æ˜¯ç”±äºå…¶éå‡¸ã€éå…‰æ»‘çš„ç‰¹ç‚¹ï¼Œä½¿å¾—ç®—æ³•å¾ˆéš¾ç›´æ¥å¯¹è¯¥å‡½æ•°è¿›è¡Œä¼˜åŒ–ã€‚è€Œsigmoidå‡½æ•°æœ¬èº«çš„ç‰¹å¾ï¼ˆå…‰æ»‘æ— é™é˜¶å¯å¯¼ï¼‰ï¼Œä»¥åŠå®Œç¾çš„æ˜ å°„åˆ°æ¦‚ç‡ç©ºé—´ï¼Œå°±ç”¨äºé€»è¾‘å›å½’äº†ã€‚è§£é‡Šä¸Šå¯ä»ä¸‰ä¸ªæ–¹é¢ï¼š- æœ€å¤§ç†µå®šç†- ä¼¯åŠªåˆ©åˆ†å¸ƒå‡è®¾- è´å¶æ–¯ç†è®º\nå‚è€ƒ: https://fengxc.me/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E7%82%B9-%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%E4%B8%AD.html\n","permalink":"https://reid00.github.io/en/posts/ml/%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92%E7%9A%84%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%A2%98%E6%80%BB%E7%BB%93/","summary":"1.ç®€ä»‹ é€»è¾‘å›å½’æ˜¯é¢è¯•å½“ä¸­éå¸¸å–œæ¬¢é—®åˆ°çš„ä¸€ä¸ªæœºå™¨å­¦ä¹ ç®—æ³•ï¼Œå› ä¸ºè¡¨é¢ä¸Šçœ‹é€»è¾‘å›å½’å½¢å¼ä¸Šå¾ˆç®€å•ï¼Œå¾ˆå¥½æŒæ¡ï¼Œä½†æ˜¯ä¸€é—®èµ·æ¥å°±å®¹æ˜“æ‡µé€¼ã€‚æ‰€ä»¥åœ¨é¢è¯•çš„æ—¶å€™ç»™å¤§å®¶çš„ç¬¬ä¸€ä¸ªå»ºè®®ä¸è¦è¯´è‡ªå·±ç²¾é€šé€»è¾‘å›å½’ï¼Œéå¸¸å®¹æ˜“è¢«é—®å€’ï¼Œä»è€Œå‡åˆ†ã€‚ä¸‹é¢æ€»ç»“äº†ä¸€äº›å¹³å¸¸æˆ‘åœ¨ä½œä¸ºé¢è¯•å®˜é¢è¯•åˆ«äººå’Œè¢«åˆ«äººé¢è¯•çš„æ—¶å€™ï¼Œç»å¸¸é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚\nRegressioné—®é¢˜çš„å¸¸è§„æ­¥éª¤ä¸ºï¼š\nå¯»æ‰¾hå‡½æ•°ï¼ˆå³å‡è®¾ä¼°è®¡çš„å‡½æ•°ï¼‰ï¼› æ„é€ Jå‡½æ•°ï¼ˆæŸå¤±å‡½æ•°ï¼‰ï¼› æƒ³åŠæ³•ä½¿å¾—Jå‡½æ•°æœ€å°å¹¶æ±‚å¾—å›å½’å‚æ•°ï¼ˆÎ¸ï¼‰ï¼› æ•°æ®æ‹Ÿåˆé—®é¢˜ 2.æ­£å¼ä»‹ç» å¦‚ä½•å‡¸æ˜¾ä½ æ˜¯ä¸€ä¸ªå¯¹é€»è¾‘å›å½’å·²ç»éå¸¸äº†è§£çš„äººå‘¢ã€‚é‚£å°±æ˜¯ç”¨ä¸€å¥è¯æ¦‚æ‹¬å®ƒï¼é€»è¾‘å›å½’å‡è®¾æ•°æ®æœä»ä¼¯åŠªåˆ©åˆ†å¸ƒ,é€šè¿‡æå¤§åŒ–ä¼¼ç„¶å‡½æ•°çš„æ–¹æ³•ï¼Œè¿ç”¨æ¢¯åº¦ä¸‹é™æ¥æ±‚è§£å‚æ•°ï¼Œæ¥è¾¾åˆ°å°†æ•°æ®äºŒåˆ†ç±»çš„ç›®çš„ã€‚\nè¿™é‡Œé¢å…¶å®åŒ…å«äº†5ä¸ªç‚¹ 1ï¼šé€»è¾‘å›å½’çš„å‡è®¾ï¼Œ2ï¼šé€»è¾‘å›å½’çš„æŸå¤±å‡½æ•°ï¼Œ3ï¼šé€»è¾‘å›å½’çš„æ±‚è§£æ–¹æ³•ï¼Œ4ï¼šé€»è¾‘å›å½’çš„ç›®çš„ï¼Œ5:é€»è¾‘å›å½’å¦‚ä½•åˆ†ç±»ã€‚è¿™äº›é—®é¢˜æ˜¯è€ƒæ ¸ä½ å¯¹é€»è¾‘å›å½’çš„åŸºæœ¬äº†è§£ã€‚\né€»è¾‘å›å½’çš„åŸºæœ¬å‡è®¾ ä»»ä½•çš„æ¨¡å‹éƒ½æ˜¯æœ‰è‡ªå·±çš„å‡è®¾ï¼Œåœ¨è¿™ä¸ªå‡è®¾ä¸‹æ¨¡å‹æ‰æ˜¯é€‚ç”¨çš„ã€‚é€»è¾‘å›å½’çš„ç¬¬ä¸€ä¸ªåŸºæœ¬å‡è®¾æ˜¯**å‡è®¾æ•°æ®æœä»ä¼¯åŠªåˆ©åˆ†å¸ƒã€‚**ä¼¯åŠªåˆ©åˆ†å¸ƒæœ‰ä¸€ä¸ªç®€å•çš„ä¾‹å­æ˜¯æŠ›ç¡¬å¸ï¼ŒæŠ›ä¸­ä¸ºæ­£é¢çš„æ¦‚ç‡æ˜¯pp,æŠ›ä¸­ä¸ºè´Ÿé¢çš„æ¦‚ç‡æ˜¯1âˆ’p1âˆ’p.åœ¨é€»è¾‘å›å½’è¿™ä¸ªæ¨¡å‹é‡Œé¢æ˜¯å‡è®¾ hÎ¸(x)hÎ¸(x) ä¸ºæ ·æœ¬ä¸ºæ­£çš„æ¦‚ç‡ï¼Œ1âˆ’hÎ¸(x)1âˆ’hÎ¸(x)ä¸ºæ ·æœ¬ä¸ºè´Ÿçš„æ¦‚ç‡ã€‚é‚£ä¹ˆæ•´ä¸ªæ¨¡å‹å¯ä»¥æè¿°ä¸º\nhÎ¸(x;Î¸)=phÎ¸(x;Î¸)=p\né€»è¾‘å›å½’çš„ç¬¬äºŒä¸ªå‡è®¾æ˜¯å‡è®¾æ ·æœ¬ä¸ºæ­£çš„æ¦‚ç‡æ˜¯\np=11+eâˆ’Î¸Txp=11+eâˆ’Î¸Tx\næ‰€ä»¥é€»è¾‘å›å½’çš„æœ€ç»ˆå½¢å¼\nhÎ¸(x;Î¸)=11+eâˆ’Î¸Tx\né€»è¾‘å›å½’çš„æ±‚è§£æ–¹æ³• ç”±äºè¯¥æå¤§ä¼¼ç„¶å‡½æ•°æ— æ³•ç›´æ¥æ±‚è§£ï¼Œæˆ‘ä»¬ä¸€èˆ¬é€šè¿‡å¯¹è¯¥å‡½æ•°è¿›è¡Œæ¢¯åº¦ä¸‹é™æ¥ä¸æ–­é€¼æ€¥æœ€ä¼˜è§£ã€‚åœ¨è¿™ä¸ªåœ°æ–¹å…¶å®ä¼šæœ‰ä¸ªåŠ åˆ†çš„é¡¹ï¼Œè€ƒå¯Ÿä½ å¯¹å…¶ä»–ä¼˜åŒ–æ–¹æ³•çš„äº†è§£ã€‚å› ä¸ºå°±æ¢¯åº¦ä¸‹é™æœ¬èº«æ¥çœ‹çš„è¯å°±æœ‰éšæœºæ¢¯åº¦ä¸‹é™ï¼Œæ‰¹æ¢¯åº¦ä¸‹é™ï¼Œsmall batch æ¢¯åº¦ä¸‹é™ä¸‰ç§æ–¹å¼ï¼Œé¢è¯•å®˜å¯èƒ½ä¼šé—®è¿™ä¸‰ç§æ–¹å¼çš„ä¼˜åŠ£ä»¥åŠå¦‚ä½•é€‰æ‹©æœ€åˆé€‚çš„æ¢¯åº¦ä¸‹é™æ–¹å¼ã€‚\nç®€å•æ¥è¯´ æ‰¹æ¢¯åº¦ä¸‹é™ä¼šè·å¾—å…¨å±€æœ€ä¼˜è§£ï¼Œç¼ºç‚¹æ˜¯åœ¨æ›´æ–°æ¯ä¸ªå‚æ•°çš„æ—¶å€™éœ€è¦éå†æ‰€æœ‰çš„æ•°æ®ï¼Œè®¡ç®—é‡ä¼šå¾ˆå¤§ï¼Œå¹¶ä¸”ä¼šæœ‰å¾ˆå¤šçš„å†—ä½™è®¡ç®—ï¼Œå¯¼è‡´çš„ç»“æœæ˜¯å½“æ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œæ¯ä¸ªå‚æ•°çš„æ›´æ–°éƒ½ä¼šå¾ˆæ…¢ã€‚\néšæœºæ¢¯åº¦ä¸‹é™æ˜¯ä»¥é«˜æ–¹å·®é¢‘ç¹æ›´æ–°ï¼Œä¼˜ç‚¹æ˜¯ä½¿å¾—sgdï¼ˆéšæœºæ¢¯åº¦ä¸‹é™ï¼‰ä¼šè·³åˆ°æ–°çš„å’Œæ½œåœ¨æ›´å¥½çš„å±€éƒ¨æœ€ä¼˜è§£ï¼Œç¼ºç‚¹æ˜¯ä½¿å¾—æ”¶æ•›åˆ°å±€éƒ¨æœ€ä¼˜è§£çš„è¿‡ç¨‹æ›´åŠ çš„å¤æ‚ã€‚\nå¦‚æœä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•(æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•)ï¼Œé‚£ä¹ˆæ¯æ¬¡è¿­ä»£è¿‡ç¨‹ä¸­éƒ½è¦å¯¹ ä¸ªæ ·æœ¬è¿›è¡Œæ±‚æ¢¯åº¦ï¼Œæ‰€ä»¥å¼€é”€éå¸¸å¤§ï¼Œéšæœºæ¢¯åº¦ä¸‹é™çš„æ€æƒ³å°±æ˜¯éšæœºé‡‡æ ·ä¸€ä¸ªæ ·æœ¬ æ¥æ›´æ–°å‚æ•°ï¼Œé‚£ä¹ˆè®¡ç®—å¼€é”€å°±ä» ä¸‹é™åˆ° ã€‚\néšæœºæ¢¯åº¦ä¸‹é™è™½ç„¶æé«˜äº†è®¡ç®—æ•ˆç‡ï¼Œé™ä½äº†è®¡ç®—å¼€é”€ï¼Œä½†æ˜¯ç”±äºæ¯æ¬¡è¿­ä»£åªéšæœºé€‰æ‹©ä¸€ä¸ªæ ·æœ¬ï¼Œå› æ­¤éšæœºæ€§æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥ä¸‹é™è¿‡ç¨‹ä¸­éå¸¸æ›²æŠ˜\nå¯ä»¥çœ‹åˆ°å¤šäº†éšæœºä¸¤ä¸ªå­—ï¼Œéšæœºä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ç”¨æ ·æœ¬ä¸­çš„ä¸€ä¸ªä¾‹å­æ¥è¿‘ä¼¼æˆ‘æ‰€æœ‰çš„æ ·æœ¬ï¼Œæ¥è°ƒæ•´Î¸ï¼Œå› è€Œéšæœºæ¢¯åº¦ä¸‹é™æ˜¯ä¼šå¸¦æ¥ä¸€å®šçš„é—®é¢˜ï¼Œå› ä¸ºè®¡ç®—å¾—åˆ°çš„å¹¶ä¸æ˜¯å‡†ç¡®çš„ä¸€ä¸ªæ¢¯åº¦ï¼Œ**å¯¹äºæœ€ä¼˜åŒ–é—®é¢˜ï¼Œå‡¸é—®é¢˜ï¼Œ**è™½ç„¶ä¸æ˜¯æ¯æ¬¡è¿­ä»£å¾—åˆ°çš„æŸå¤±å‡½æ•°éƒ½å‘ç€å…¨å±€æœ€ä¼˜æ–¹å‘ï¼Œ ä½†æ˜¯å¤§çš„æ•´ä½“çš„æ–¹å‘æ˜¯å‘å…¨å±€æœ€ä¼˜è§£çš„ï¼Œæœ€ç»ˆçš„ç»“æœå¾€å¾€æ˜¯åœ¨å…¨å±€æœ€ä¼˜è§£é™„è¿‘ã€‚\nå°æ‰¹é‡æ¢¯åº¦ä¸‹é™ç»“åˆäº†sgdå’Œbatch gdçš„ä¼˜ç‚¹ï¼Œæ¯æ¬¡æ›´æ–°çš„æ—¶å€™ä½¿ç”¨nä¸ªæ ·æœ¬ã€‚å‡å°‘äº†å‚æ•°æ›´æ–°çš„æ¬¡æ•°ï¼Œå¯ä»¥è¾¾åˆ°æ›´åŠ ç¨³å®šæ”¶æ•›ç»“æœï¼Œä¸€èˆ¬åœ¨æ·±åº¦å­¦ä¹ å½“ä¸­æˆ‘ä»¬é‡‡ç”¨è¿™ç§æ–¹æ³•ã€‚å°æ‰¹é‡æ¢¯åº¦ä¸‹é™çš„å¼€é”€ä¸º å…¶ä¸­ æ˜¯æ‰¹é‡å¤§å°ã€‚\nå…¶å®è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªéšè—çš„æ›´åŠ æ·±çš„åŠ åˆ†é¡¹ï¼Œçœ‹ä½ äº†ä¸äº†è§£è¯¸å¦‚Adamï¼ŒåŠ¨é‡æ³•ç­‰ä¼˜åŒ–æ–¹æ³•ã€‚å› ä¸ºä¸Šè¿°æ–¹æ³•å…¶å®è¿˜æœ‰ä¸¤ä¸ªè‡´å‘½çš„é—®é¢˜ã€‚ ç¬¬ä¸€ä¸ªæ˜¯å¦‚ä½•å¯¹æ¨¡å‹é€‰æ‹©åˆé€‚çš„å­¦ä¹ ç‡ã€‚è‡ªå§‹è‡³ç»ˆä¿æŒåŒæ ·çš„å­¦ä¹ ç‡å…¶å®ä¸å¤ªåˆé€‚ã€‚å› ä¸ºä¸€å¼€å§‹å‚æ•°åˆšåˆšå¼€å§‹å­¦ä¹ çš„æ—¶å€™ï¼Œæ­¤æ—¶çš„å‚æ•°å’Œæœ€ä¼˜è§£éš”çš„æ¯”è¾ƒè¿œï¼Œéœ€è¦ä¿æŒä¸€ä¸ªè¾ƒå¤§çš„å­¦ä¹ ç‡å°½å¿«é€¼è¿‘æœ€ä¼˜è§£ã€‚ä½†æ˜¯å­¦ä¹ åˆ°åé¢çš„æ—¶å€™ï¼Œå‚æ•°å’Œæœ€ä¼˜è§£å·²ç»éš”çš„æ¯”è¾ƒè¿‘äº†ï¼Œä½ è¿˜ä¿æŒæœ€åˆçš„å­¦ä¹ ç‡ï¼Œå®¹æ˜“è¶Šè¿‡æœ€ä¼˜ç‚¹ï¼Œåœ¨æœ€ä¼˜ç‚¹é™„è¿‘æ¥å›æŒ¯è¡ï¼Œé€šä¿—ä¸€ç‚¹è¯´ï¼Œå°±å¾ˆå®¹æ˜“å­¦è¿‡å¤´äº†ï¼Œè·‘åäº†ã€‚ ç¬¬äºŒä¸ªæ˜¯å¦‚ä½•å¯¹å‚æ•°é€‰æ‹©åˆé€‚çš„å­¦ä¹ ç‡ã€‚åœ¨å®è·µä¸­ï¼Œå¯¹æ¯ä¸ªå‚æ•°éƒ½ä¿æŒçš„åŒæ ·çš„å­¦ä¹ ç‡ä¹Ÿæ˜¯å¾ˆä¸åˆç†çš„ã€‚æœ‰äº›å‚æ•°æ›´æ–°é¢‘ç¹ï¼Œé‚£ä¹ˆå­¦ä¹ ç‡å¯ä»¥é€‚å½“å°ä¸€ç‚¹ã€‚æœ‰äº›å‚æ•°æ›´æ–°ç¼“æ…¢ï¼Œé‚£ä¹ˆå­¦ä¹ ç‡å°±åº”è¯¥å¤§ä¸€ç‚¹ã€‚è¿™é‡Œæˆ‘ä»¬ä¸å±•å¼€ï¼Œæœ‰ç©ºæˆ‘ä¼šä¸“é—¨å‡ºä¸€ä¸ªä¸“é¢˜ä»‹ç»ã€‚ é€»è¾‘å›å½’çš„ç›®çš„ è¯¥å‡½æ•°çš„ç›®çš„ä¾¿æ˜¯å°†æ•°æ®äºŒåˆ†ç±»ï¼Œæé«˜å‡†ç¡®ç‡ã€‚ é€»è¾‘å›å½’å¦‚ä½•åˆ†ç±» é€»è¾‘å›å½’ä½œä¸ºä¸€ä¸ªå›å½’(ä¹Ÿå°±æ˜¯yå€¼æ˜¯è¿ç»­çš„)ï¼Œå¦‚ä½•åº”ç”¨åˆ°åˆ†ç±»ä¸Šå»å‘¢ã€‚yå€¼ç¡®å®æ˜¯ä¸€ä¸ªè¿ç»­çš„å˜é‡ã€‚é€»è¾‘å›å½’çš„åšæ³•æ˜¯åˆ’å®šä¸€ä¸ªé˜ˆå€¼ï¼Œyå€¼å¤§äºè¿™ä¸ªé˜ˆå€¼çš„æ˜¯ä¸€ç±»ï¼Œyå€¼å°äºè¿™ä¸ªé˜ˆå€¼çš„æ˜¯å¦å¤–ä¸€ç±»ã€‚é˜ˆå€¼å…·ä½“å¦‚ä½•è°ƒæ•´æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ã€‚ä¸€èˆ¬ä¼šé€‰æ‹©0.5åšä¸ºé˜ˆå€¼æ¥åˆ’åˆ†ã€‚ é€»è¾‘å›å½’çš„æŸå¤±å‡½æ•°ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æå¤§ä¼¼ç„¶å‡½æ•°ä½œä¸ºæŸå¤±å‡½æ•°ï¼Ÿ æŸå¤±å‡½æ•°ä¸€èˆ¬æœ‰å››ç§ï¼Œå¹³æ–¹æŸå¤±å‡½æ•°ï¼Œå¯¹æ•°æŸå¤±å‡½æ•°ï¼ŒHingeLoss0-1æŸå¤±å‡½æ•°ï¼Œç»å¯¹å€¼æŸå¤±å‡½æ•°ã€‚å°†æå¤§ä¼¼ç„¶å‡½æ•°å–å¯¹æ•°ä»¥åç­‰åŒäºå¯¹æ•°æŸå¤±å‡½æ•°ã€‚åœ¨é€»è¾‘å›å½’è¿™ä¸ªæ¨¡å‹ä¸‹ï¼Œå¯¹æ•°æŸå¤±å‡½æ•°çš„è®­ç»ƒæ±‚è§£å‚æ•°çš„é€Ÿåº¦æ˜¯æ¯”è¾ƒå¿«çš„ã€‚è‡³äºåŸå› å¤§å®¶å¯ä»¥æ±‚å‡ºè¿™ä¸ªå¼å­çš„æ¢¯åº¦æ›´æ–°\nè¿™ä¸ªå¼å­çš„æ›´æ–°é€Ÿåº¦åªå’Œç›¸å…³ã€‚å’Œsigmodå‡½æ•°æœ¬èº«çš„æ¢¯åº¦æ˜¯æ— å…³çš„ã€‚è¿™æ ·æ›´æ–°çš„é€Ÿåº¦æ˜¯å¯ä»¥è‡ªå§‹è‡³ç»ˆéƒ½æ¯”è¾ƒçš„ç¨³å®šã€‚\nä¸ºä»€ä¹ˆä¸é€‰å¹³æ–¹æŸå¤±å‡½æ•°çš„å‘¢ï¼Ÿå…¶ä¸€æ˜¯å› ä¸ºå¦‚æœä½ ä½¿ç”¨å¹³æ–¹æŸå¤±å‡½æ•°ï¼Œä½ ä¼šå‘ç°æ¢¯åº¦æ›´æ–°çš„é€Ÿåº¦å’Œsigmodå‡½æ•°æœ¬èº«çš„æ¢¯åº¦æ˜¯å¾ˆç›¸å…³çš„ã€‚sigmodå‡½æ•°åœ¨å®ƒåœ¨å®šä¹‰åŸŸå†…çš„æ¢¯åº¦éƒ½ä¸å¤§äº0.25ã€‚è¿™æ ·è®­ç»ƒä¼šéå¸¸çš„æ…¢ã€‚\né€»è¾‘å›å½’åœ¨è®­ç»ƒçš„è¿‡ç¨‹å½“ä¸­ï¼Œå¦‚æœæœ‰å¾ˆå¤šçš„ç‰¹å¾é«˜åº¦ç›¸å…³æˆ–è€…è¯´æœ‰ä¸€ä¸ªç‰¹å¾é‡å¤äº†100éï¼Œä¼šé€ æˆæ€æ ·çš„å½±å“ï¼Ÿ å…ˆè¯´ç»“è®ºï¼Œå¦‚æœåœ¨æŸå¤±å‡½æ•°æœ€ç»ˆæ”¶æ•›çš„æƒ…å†µä¸‹ï¼Œå…¶å®å°±ç®—æœ‰å¾ˆå¤šç‰¹å¾é«˜åº¦ç›¸å…³ä¹Ÿä¸ä¼šå½±å“åˆ†ç±»å™¨çš„æ•ˆæœã€‚\nä½†æ˜¯å¯¹ç‰¹å¾æœ¬èº«æ¥è¯´çš„è¯ï¼Œå‡è®¾åªæœ‰ä¸€ä¸ªç‰¹å¾ï¼Œåœ¨ä¸è€ƒè™‘é‡‡æ ·çš„æƒ…å†µä¸‹ï¼Œä½ ç°åœ¨å°†å®ƒé‡å¤100éã€‚è®­ç»ƒä»¥åå®Œä»¥åï¼Œæ•°æ®è¿˜æ˜¯è¿™ä¹ˆå¤šï¼Œä½†æ˜¯è¿™ä¸ªç‰¹å¾æœ¬èº«é‡å¤äº†100éï¼Œå®è´¨ä¸Šå°†åŸæ¥çš„ç‰¹å¾åˆ†æˆäº†100ä»½ï¼Œæ¯ä¸€ä¸ªç‰¹å¾éƒ½æ˜¯åŸæ¥ç‰¹å¾æƒé‡å€¼çš„ç™¾åˆ†ä¹‹ä¸€\nå¦‚æœåœ¨éšæœºé‡‡æ ·çš„æƒ…å†µä¸‹ï¼Œå…¶å®è®­ç»ƒæ”¶æ•›å®Œä»¥åï¼Œè¿˜æ˜¯å¯ä»¥è®¤ä¸ºè¿™100ä¸ªç‰¹å¾å’ŒåŸæ¥é‚£ä¸€ä¸ªç‰¹å¾æ‰®æ¼”çš„æ•ˆæœä¸€æ ·ï¼Œåªæ˜¯å¯èƒ½ä¸­é—´å¾ˆå¤šç‰¹å¾çš„å€¼æ­£è´Ÿç›¸æ¶ˆäº†ã€‚\nä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜æ˜¯ä¼šåœ¨è®­ç»ƒçš„è¿‡ç¨‹å½“ä¸­å°†é«˜åº¦ç›¸å…³çš„ç‰¹å¾å»æ‰ï¼Ÿ å»æ‰é«˜åº¦ç›¸å…³çš„ç‰¹å¾ä¼šè®©æ¨¡å‹çš„å¯è§£é‡Šæ€§æ›´å¥½ å¯ä»¥å¤§å¤§æé«˜è®­ç»ƒçš„é€Ÿåº¦ã€‚å¦‚æœæ¨¡å‹å½“ä¸­æœ‰å¾ˆå¤šç‰¹å¾é«˜åº¦ç›¸å…³çš„è¯ï¼Œå°±ç®—æŸå¤±å‡½æ•°æœ¬èº«æ”¶æ•›äº†ï¼Œä½†å®é™…ä¸Šå‚æ•°æ˜¯æ²¡æœ‰æ”¶æ•›çš„ï¼Œè¿™æ ·ä¼šæ‹‰ä½è®­ç»ƒçš„é€Ÿåº¦ã€‚å…¶æ¬¡æ˜¯ç‰¹å¾å¤šäº†ï¼Œæœ¬èº«å°±ä¼šå¢å¤§è®­ç»ƒçš„æ—¶é—´ã€‚ 4.é€»è¾‘å›å½’çš„ä¼˜ç¼ºç‚¹æ€»ç»“ ä¼˜ç‚¹\nå½¢å¼ç®€å•ï¼Œæ¨¡å‹çš„å¯è§£é‡Šæ€§éå¸¸å¥½ã€‚ä»ç‰¹å¾çš„æƒé‡å¯ä»¥çœ‹åˆ°ä¸åŒçš„ç‰¹å¾å¯¹æœ€åç»“æœçš„å½±å“ï¼ŒæŸä¸ªç‰¹å¾çš„æƒé‡å€¼æ¯”è¾ƒé«˜ï¼Œé‚£ä¹ˆè¿™ä¸ªç‰¹å¾æœ€åå¯¹ç»“æœçš„å½±å“ä¼šæ¯”è¾ƒå¤§ã€‚\næ¨¡å‹æ•ˆæœä¸é”™ã€‚åœ¨å·¥ç¨‹ä¸Šæ˜¯å¯ä»¥æ¥å—çš„ï¼ˆä½œä¸ºbaseline)ï¼Œå¦‚æœç‰¹å¾å·¥ç¨‹åšçš„å¥½ï¼Œæ•ˆæœä¸ä¼šå¤ªå·®ï¼Œå¹¶ä¸”ç‰¹å¾å·¥ç¨‹å¯ä»¥å¤§å®¶å¹¶è¡Œå¼€å‘ï¼Œå¤§å¤§åŠ å¿«å¼€å‘çš„é€Ÿåº¦ã€‚\nè®­ç»ƒé€Ÿåº¦è¾ƒå¿«ã€‚åˆ†ç±»çš„æ—¶å€™ï¼Œè®¡ç®—é‡ä»…ä»…åªå’Œç‰¹å¾çš„æ•°ç›®ç›¸å…³ã€‚å¹¶ä¸”é€»è¾‘å›å½’çš„åˆ†å¸ƒå¼ä¼˜åŒ–sgdå‘å±•æ¯”è¾ƒæˆç†Ÿï¼Œè®­ç»ƒçš„é€Ÿåº¦å¯ä»¥é€šè¿‡å †æœºå™¨è¿›ä¸€æ­¥æé«˜ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åœ¨çŸ­æ—¶é—´å†…è¿­ä»£å¥½å‡ ä¸ªç‰ˆæœ¬çš„æ¨¡å‹ã€‚\nèµ„æºå ç”¨å°,å°¤å…¶æ˜¯å†…å­˜ã€‚å› ä¸ºåªéœ€è¦å­˜å‚¨å„ä¸ªç»´åº¦çš„ç‰¹å¾å€¼ï¼Œã€‚\næ–¹ä¾¿è¾“å‡ºç»“æœè°ƒæ•´ã€‚é€»è¾‘å›å½’å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¾—åˆ°æœ€åçš„åˆ†ç±»ç»“æœï¼Œå› ä¸ºè¾“å‡ºçš„æ˜¯æ¯ä¸ªæ ·æœ¬çš„æ¦‚ç‡åˆ†æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„å¯¹è¿™äº›æ¦‚ç‡åˆ†æ•°è¿›è¡Œcutoffï¼Œä¹Ÿå°±æ˜¯åˆ’åˆ†é˜ˆå€¼(å¤§äºæŸä¸ªé˜ˆå€¼çš„æ˜¯ä¸€ç±»ï¼Œå°äºæŸä¸ªé˜ˆå€¼çš„æ˜¯ä¸€ç±»)ã€‚\nä½†æ˜¯é€»è¾‘å›å½’æœ¬èº«ä¹Ÿæœ‰è®¸å¤šçš„ç¼ºç‚¹:\nå‡†ç¡®ç‡å¹¶ä¸æ˜¯å¾ˆé«˜ã€‚å› ä¸ºå½¢å¼éå¸¸çš„ç®€å•(éå¸¸ç±»ä¼¼çº¿æ€§æ¨¡å‹)ï¼Œå¾ˆéš¾å»æ‹Ÿåˆæ•°æ®çš„çœŸå®åˆ†å¸ƒã€‚\nå¾ˆéš¾å¤„ç†æ•°æ®ä¸å¹³è¡¡çš„é—®é¢˜ã€‚ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœæˆ‘ä»¬å¯¹äºä¸€ä¸ªæ­£è´Ÿæ ·æœ¬éå¸¸ä¸å¹³è¡¡çš„é—®é¢˜æ¯”å¦‚æ­£è´Ÿæ ·æœ¬æ¯” 10000:1.æˆ‘ä»¬æŠŠæ‰€æœ‰æ ·æœ¬éƒ½é¢„æµ‹ä¸ºæ­£ä¹Ÿèƒ½ä½¿æŸå¤±å‡½æ•°çš„å€¼æ¯”è¾ƒå°ã€‚ä½†æ˜¯ä½œä¸ºä¸€ä¸ªåˆ†ç±»å™¨ï¼Œå®ƒå¯¹æ­£è´Ÿæ ·æœ¬çš„åŒºåˆ†èƒ½åŠ›ä¸ä¼šå¾ˆå¥½ã€‚\nå¤„ç†éçº¿æ€§æ•°æ®è¾ƒéº»çƒ¦ã€‚é€»è¾‘å›å½’åœ¨ä¸å¼•å…¥å…¶ä»–æ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œåªèƒ½å¤„ç†çº¿æ€§å¯åˆ†çš„æ•°æ®ï¼Œæˆ–è€…è¿›ä¸€æ­¥è¯´ï¼Œå¤„ç†äºŒåˆ†ç±»çš„é—®é¢˜ ã€‚","title":"é€»è¾‘å›å½’çš„å¸¸è§é¢è¯•é¢˜æ€»ç»“"},{"content":"è°ƒå‚ â˜… åœ¨ scikit-learn ä¸­ï¼ŒRandom Forestï¼ˆä»¥ä¸‹ç®€ç§°RFï¼‰çš„åˆ†ç±»ç±»æ˜¯ RandomForestClassifierï¼Œå›å½’ç±»æ˜¯ RandomForestRegressorã€‚\nRF éœ€è¦è°ƒå‚çš„å‚æ•°ä¹ŸåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯ Bagging æ¡†æ¶çš„å‚æ•°ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ CART å†³ç­–æ ‘çš„å‚æ•°ã€‚ä¸‹é¢æˆ‘ä»¬å°±å¯¹è¿™äº›å‚æ•°åšä¸€ä¸ªä»‹ç»ã€‚\nRF æ¡†æ¶å‚æ•° é¦–å…ˆæˆ‘ä»¬å…³æ³¨äº RF çš„ Bagging æ¡†æ¶çš„å‚æ•°ã€‚è¿™é‡Œå¯ä»¥å’Œ GBDT å¯¹æ¯”æ¥å­¦ä¹ ã€‚GBDT çš„æ¡†æ¶å‚æ•°æ¯”è¾ƒå¤šï¼Œé‡è¦çš„æœ‰æœ€å¤§è¿­ä»£å™¨ä¸ªæ•°ï¼Œæ­¥é•¿å’Œå­é‡‡æ ·æ¯”ä¾‹ï¼Œè°ƒå‚èµ·æ¥æ¯”è¾ƒè´¹åŠ›ã€‚ä½†æ˜¯ RF åˆ™æ¯”è¾ƒç®€å•ï¼Œè¿™æ˜¯å› ä¸º bagging æ¡†æ¶é‡Œçš„å„ä¸ªå¼±å­¦ä¹ å™¨ä¹‹é—´æ˜¯æ²¡æœ‰ä¾èµ–å…³ç³»çš„ï¼Œè¿™å‡å°çš„è°ƒå‚çš„éš¾åº¦ã€‚æ¢å¥è¯è¯´ï¼Œè¾¾åˆ°åŒæ ·çš„è°ƒå‚æ•ˆæœï¼ŒRF è°ƒå‚æ—¶é—´è¦æ¯” GBDT å°‘ä¸€äº›ã€‚\nä¸‹é¢æˆ‘æ¥çœ‹çœ‹ RF é‡è¦çš„ Bagging æ¡†æ¶çš„å‚æ•°ï¼Œç”±äº RandomForestClassifier å’Œ RandomForestRegressor å‚æ•°ç»å¤§éƒ¨åˆ†ç›¸åŒï¼Œè¿™é‡Œä¼šå°†å®ƒä»¬ä¸€èµ·è®²ï¼Œä¸åŒç‚¹ä¼šæŒ‡å‡ºã€‚\nn_estimatorsï¼šä¹Ÿå°±æ˜¯å¼±å­¦ä¹ å™¨çš„æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œæˆ–è€…è¯´æœ€å¤§çš„å¼±å­¦ä¹ å™¨çš„ä¸ªæ•°ã€‚ä¸€èˆ¬æ¥è¯´ n_estimators å¤ªå°ï¼Œå®¹æ˜“æ¬ æ‹Ÿåˆï¼Œn_estimators å¤ªå¤§ï¼Œè®¡ç®—é‡ä¼šå¤ªå¤§ï¼Œå¹¶ä¸” n_estimators åˆ°ä¸€å®šçš„æ•°é‡åï¼Œå†å¢å¤§ n_estimators è·å¾—çš„æ¨¡å‹æå‡ä¼šå¾ˆå°ï¼Œæ‰€ä»¥ä¸€èˆ¬é€‰æ‹©ä¸€ä¸ªé€‚ä¸­çš„æ•°å€¼ã€‚é»˜è®¤æ˜¯ 100 ã€‚\noob_scoreï¼šå³æ˜¯å¦é‡‡ç”¨è¢‹å¤–æ ·æœ¬æ¥è¯„ä¼°æ¨¡å‹çš„å¥½åã€‚é»˜è®¤è¯† False ã€‚ä¸ªäººæ¨èè®¾ç½®ä¸º True ï¼Œå› ä¸ºè¢‹å¤–åˆ†æ•°ååº”äº†ä¸€ä¸ªæ¨¡å‹æ‹Ÿåˆåçš„æ³›åŒ–èƒ½åŠ›ã€‚\ncriterion: å³ CART æ ‘åšåˆ’åˆ†æ—¶å¯¹ç‰¹å¾çš„è¯„ä»·æ ‡å‡†ã€‚åˆ†ç±»æ¨¡å‹å’Œå›å½’æ¨¡å‹çš„æŸå¤±å‡½æ•°æ˜¯ä¸ä¸€æ ·çš„ã€‚åˆ†ç±» RF å¯¹åº”çš„ CART åˆ†ç±»æ ‘é»˜è®¤æ˜¯åŸºå°¼ç³»æ•° gini ï¼Œå¦ä¸€ä¸ªå¯é€‰æ‹©çš„æ ‡å‡†æ˜¯ä¿¡æ¯å¢ç›Šã€‚å›å½’ RF å¯¹åº”çš„ CART å›å½’æ ‘é»˜è®¤æ˜¯å‡æ–¹å·® mse ï¼Œå¦ä¸€ä¸ªå¯ä»¥é€‰æ‹©çš„æ ‡å‡†æ˜¯ç»å¯¹å€¼å·® mae ã€‚ä¸€èˆ¬æ¥è¯´é€‰æ‹©é»˜è®¤çš„æ ‡å‡†å°±å·²ç»å¾ˆå¥½çš„ã€‚\nä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œ RF é‡è¦çš„æ¡†æ¶å‚æ•°æ¯”è¾ƒå°‘ï¼Œä¸»è¦éœ€è¦å…³æ³¨çš„æ˜¯ n_estimatorsï¼Œå³ RF æœ€å¤§çš„å†³ç­–æ ‘ä¸ªæ•°ã€‚\nRF å†³ç­–æ ‘å‚æ•° RF åˆ’åˆ†æ—¶è€ƒè™‘çš„æœ€å¤§ç‰¹å¾æ•° max_featuresï¼š\nå¯ä»¥ä½¿ç”¨å¾ˆå¤šç§ç±»å‹çš„å€¼ï¼Œé»˜è®¤æ˜¯ auto ï¼Œæ„å‘³ç€åˆ’åˆ†æ—¶æœ€å¤šè€ƒè™‘ $\\sqrt {N}$ ä¸ªç‰¹å¾ï¼›å¦‚æœæ˜¯ log2 æ„å‘³ç€åˆ’åˆ†æ—¶æœ€å¤šè€ƒè™‘ $log_2N$ ä¸ªç‰¹å¾ï¼›å¦‚æœæ˜¯ sqrt æˆ–è€… auto æ„å‘³ç€åˆ’åˆ†æ—¶æœ€å¤šè€ƒè™‘$\\sqrt {N}$ ä¸ªç‰¹å¾ã€‚å¦‚æœæ˜¯æ•´æ•°ï¼Œä»£è¡¨è€ƒè™‘çš„ç‰¹å¾ç»å¯¹æ•°ã€‚å¦‚æœæ˜¯æµ®ç‚¹æ•°ï¼Œä»£è¡¨è€ƒè™‘ç‰¹å¾ç™¾åˆ†æ¯”ï¼Œå³è€ƒè™‘ï¼ˆç™¾åˆ†æ¯” x $N$ï¼‰å–æ•´åçš„ç‰¹å¾æ•°ã€‚å…¶ä¸­ $N$ ä¸ºæ ·æœ¬æ€»ç‰¹å¾æ•°ã€‚ä¸€èˆ¬æˆ‘ä»¬ç”¨é»˜è®¤çš„ auto å°±å¯ä»¥äº†ï¼Œå¦‚æœç‰¹å¾æ•°éå¸¸å¤šï¼Œæˆ‘ä»¬å¯ä»¥çµæ´»ä½¿ç”¨åˆšæ‰æè¿°çš„å…¶ä»–å–å€¼æ¥æ§åˆ¶åˆ’åˆ†æ—¶è€ƒè™‘çš„æœ€å¤§ç‰¹å¾æ•°ï¼Œä»¥æ§åˆ¶å†³ç­–æ ‘çš„ç”Ÿæˆæ—¶é—´ã€‚\nå†³ç­–æ ‘æœ€å¤§æ·±åº¦ max_depthï¼š\né»˜è®¤å¯ä»¥ä¸è¾“å…¥ï¼Œå¦‚æœä¸è¾“å…¥çš„è¯ï¼Œå†³ç­–æ ‘åœ¨å»ºç«‹å­æ ‘çš„æ—¶å€™ä¸ä¼šé™åˆ¶å­æ ‘çš„æ·±åº¦ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®å°‘æˆ–è€…ç‰¹å¾å°‘çš„æ—¶å€™å¯ä»¥ä¸ç®¡è¿™ä¸ªå€¼ã€‚å¦‚æœæ¨¡å‹æ ·æœ¬é‡å¤šï¼Œç‰¹å¾ä¹Ÿå¤šçš„æƒ…å†µä¸‹ï¼Œæ¨èé™åˆ¶è¿™ä¸ªæœ€å¤§æ·±åº¦ï¼Œå…·ä½“çš„å–å€¼å–å†³äºæ•°æ®çš„åˆ†å¸ƒã€‚å¸¸ç”¨çš„å¯ä»¥å–å€¼ 10-100 ä¹‹é—´ã€‚\nå†…éƒ¨èŠ‚ç‚¹å†åˆ’åˆ†æ‰€éœ€æœ€å°æ ·æœ¬æ•° min_samples_splitï¼š\nè¿™ä¸ªå€¼é™åˆ¶äº†å­æ ‘ç»§ç»­åˆ’åˆ†çš„æ¡ä»¶ï¼Œå¦‚æœæŸèŠ‚ç‚¹çš„æ ·æœ¬æ•°å°‘äº min_samples_splitï¼Œåˆ™ä¸ä¼šç»§ç»­å†å°è¯•é€‰æ‹©æœ€ä¼˜ç‰¹å¾æ¥è¿›è¡Œåˆ’åˆ†ã€‚é»˜è®¤æ˜¯ 2ï¼Œå¦‚æœæ ·æœ¬é‡ä¸å¤§ï¼Œä¸éœ€è¦ç®¡è¿™ä¸ªå€¼ã€‚å¦‚æœæ ·æœ¬é‡æ•°é‡çº§éå¸¸å¤§ï¼Œåˆ™æ¨èå¢å¤§è¿™ä¸ªå€¼ã€‚\nå¶å­èŠ‚ç‚¹æœ€å°‘æ ·æœ¬æ•° min_samples_leafï¼š\nè¿™ä¸ªå€¼é™åˆ¶äº†å¶å­èŠ‚ç‚¹æœ€å°‘çš„æ ·æœ¬æ•°ï¼Œå¦‚æœæŸå¶å­èŠ‚ç‚¹æ•°ç›®å°äºæ ·æœ¬æ•°ï¼Œåˆ™ä¼šå’Œå…„å¼ŸèŠ‚ç‚¹ä¸€èµ·è¢«å‰ªæã€‚ é»˜è®¤æ˜¯ 1ï¼Œå¯ä»¥è¾“å…¥æœ€å°‘çš„æ ·æœ¬æ•°çš„æ•´æ•°ï¼Œæˆ–è€…æœ€å°‘æ ·æœ¬æ•°å æ ·æœ¬æ€»æ•°çš„ç™¾åˆ†æ¯”ã€‚å¦‚æœæ ·æœ¬é‡ä¸å¤§ï¼Œä¸éœ€è¦ç®¡è¿™ä¸ªå€¼ã€‚å¦‚æœæ ·æœ¬é‡æ•°é‡çº§éå¸¸å¤§ï¼Œåˆ™æ¨èå¢å¤§è¿™ä¸ªå€¼ã€‚\nå¶å­èŠ‚ç‚¹æœ€å°çš„æ ·æœ¬æƒé‡ min_weight_fraction_leafï¼š\nè¿™ä¸ªå€¼é™åˆ¶äº†å¶å­èŠ‚ç‚¹æ‰€æœ‰æ ·æœ¬æƒé‡å’Œçš„æœ€å°å€¼ï¼Œå¦‚æœå°äºè¿™ä¸ªå€¼ï¼Œåˆ™ä¼šå’Œå…„å¼ŸèŠ‚ç‚¹ä¸€èµ·è¢«å‰ªæã€‚é»˜è®¤æ˜¯ 0ï¼Œå°±æ˜¯ä¸è€ƒè™‘æƒé‡é—®é¢˜ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬æœ‰è¾ƒå¤šæ ·æœ¬æœ‰ç¼ºå¤±å€¼ï¼Œæˆ–è€…åˆ†ç±»æ ‘æ ·æœ¬çš„åˆ†å¸ƒç±»åˆ«åå·®å¾ˆå¤§ï¼Œå°±ä¼šå¼•å…¥æ ·æœ¬æƒé‡ï¼Œè¿™æ—¶æˆ‘ä»¬å°±è¦æ³¨æ„è¿™ä¸ªå€¼äº†ã€‚\næœ€å¤§å¶å­èŠ‚ç‚¹æ•° max_leaf_nodesï¼š\né€šè¿‡é™åˆ¶æœ€å¤§å¶å­èŠ‚ç‚¹æ•°ï¼Œå¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œé»˜è®¤æ˜¯ None ï¼Œå³ä¸é™åˆ¶æœ€å¤§çš„å¶å­èŠ‚ç‚¹æ•°ã€‚å¦‚æœåŠ äº†é™åˆ¶ï¼Œç®—æ³•ä¼šå»ºç«‹åœ¨æœ€å¤§å¶å­èŠ‚ç‚¹æ•°å†…æœ€ä¼˜çš„å†³ç­–æ ‘ã€‚å¦‚æœç‰¹å¾ä¸å¤šï¼Œå¯ä»¥ä¸è€ƒè™‘è¿™ä¸ªå€¼ï¼Œä½†æ˜¯å¦‚æœç‰¹å¾åˆ†æˆå¤šçš„è¯ï¼Œå¯ä»¥åŠ ä»¥é™åˆ¶ï¼Œå…·ä½“çš„å€¼å¯ä»¥é€šè¿‡äº¤å‰éªŒè¯å¾—åˆ°ã€‚\nèŠ‚ç‚¹åˆ’åˆ†æœ€å°ä¸çº¯åº¦ min_impurity_splitï¼š\nè¿™ä¸ªå€¼é™åˆ¶äº†å†³ç­–æ ‘çš„å¢é•¿ï¼Œå¦‚æœæŸèŠ‚ç‚¹çš„ä¸çº¯åº¦ï¼ˆåŸºäºåŸºå°¼ç³»æ•°ï¼Œå‡æ–¹å·®ï¼‰å°äºè¿™ä¸ªé˜ˆå€¼ï¼Œåˆ™è¯¥èŠ‚ç‚¹ä¸å†ç”Ÿæˆå­èŠ‚ç‚¹ã€‚å³ä¸ºå¶å­èŠ‚ç‚¹ ã€‚ä¸€èˆ¬ä¸æ¨èæ”¹åŠ¨ï¼Œé»˜è®¤å€¼ 1e-7ã€‚\nä¸Šé¢å†³ç­–æ ‘å‚æ•°ä¸­æœ€é‡è¦çš„åŒ…æ‹¬æœ€å¤§ç‰¹å¾æ•° max_featuresï¼Œ æœ€å¤§æ·±åº¦ max_depthï¼Œ å†…éƒ¨èŠ‚ç‚¹å†åˆ’åˆ†æ‰€éœ€æœ€å°æ ·æœ¬æ•° min_samples_split å’Œå¶å­èŠ‚ç‚¹æœ€å°‘æ ·æœ¬æ•° min_samples_leaf\nè°ƒå‚å®ä¾‹ æˆ‘ä»¬ä½¿ç”¨ç¤¾äº¤ç½‘ç»œæ•°æ®é›†ä¸ºä¾‹ï¼Œåˆ©ç”¨ sklearn.grid_search ä¸­çš„ GridSearchCV ç±»è¿›è¡Œç½‘æ ¼æœç´¢æœ€ä½³å‚æ•°ï¼Œç°æœ‰ä¸¤ç§è°ƒå‚æ€è·¯ã€‚\nä¸²è¡Œè°ƒå‚æ€è·¯ï¼šè°ƒæ•´ä¸€ä¸ªæˆ–å‡ ä¸ªå‚æ•°ï¼Œå›ºå®šå…¶ä»–å‚æ•°ï¼Œå¾—åˆ°æ‰€è°ƒæ•´å‚æ•°çš„æœ€ä¼˜ã€‚é‡å¤ä»¥ä¸Šæ­¥éª¤ï¼Œä½¿å¾—æ¯ä¸ªå‚æ•°éƒ½å¾—æ‰“æœ€ä¼˜ å¹¶è¡Œè°ƒå‚æ€è·¯ï¼šå‚æ•°åŒæ—¶è¿›è¡Œè°ƒæ•´ï¼Œä¸è¿‡è®¡ç®—é‡æ¯”è¾ƒå¤§ï¼Œä½†æ˜¯ä¸€æ¬¡æ€§èƒ½å¤Ÿæ‰¾åˆ°æœ€å¥½çš„å‚æ•° è½½å…¥éœ€è¦çš„åº“ 1 2 from sklearn.model_selection import GridSearchCV from sklearn.ensemble import RandomForestClassifier è°ƒæ•´å‚æ•° n_estimators 1 2 3 4 5 6 7 8 param_test1 = {\u0026#39;n_estimators\u0026#39;: list(range(10,71,10))} classifier = RandomForestClassifier(n_estimators=10, min_samples_split=20,min_samples_leaf=2,max_depth=9,criterion=\u0026#39;entropy\u0026#39;, oob_score=True,random_state=0) gsearch1= GridSearchCV(estimator=classifier,param_grid=param_test1,scoring=\u0026#39;roc_auc\u0026#39;,cv=5) gsearch1.fit(X_train,y_train) print(gsearch1.cv_results_) print(gsearch1.best_params_) print(gsearch1.best_score_) è°ƒæ•´å‚æ•° max_depth å¾—åˆ°äº†æœ€ä½³çš„å¼±å­¦ä¹ å™¨è¿­ä»£æ¬¡æ•°ä¸º 30 ï¼Œæˆ‘ä»¬å°†ç›¸åº”å‚æ•°è¿›è¡Œä¿®æ”¹ï¼Œæ¥ç€æˆ‘ä»¬å¯¹å†³ç­–æ ‘æœ€å¤§æ·±åº¦ max_depth å’Œå†…éƒ¨èŠ‚ç‚¹å†åˆ’åˆ†æ‰€éœ€æœ€å°æ ·æœ¬æ•° min_samples_split è¿›è¡Œç½‘æ ¼æœç´¢ã€‚\n1 2 3 4 5 6 7 8 9 10 param_test2 = {\u0026#39;max_depth\u0026#39;: list(range(3, 12, 1)), \u0026#39;min_samples_split\u0026#39;: list(range(5, 101, 5))} classifier = RandomForestClassifier(n_estimators=30, min_samples_leaf=2, criterion=\u0026#39;entropy\u0026#39;, oob_score=True, random_state=0) gsearch2 = GridSearchCV(estimator=classifier, param_grid=param_test2, scoring=\u0026#39;roc_auc\u0026#39;, iid=False, cv=5) gsearch2.fit(X_train, y_train) print(gsearch2.best_params_) print(gsearch2.best_score_) Result\n1 2 {\u0026#39;max_depth\u0026#39;: 7, \u0026#39;min_samples_split\u0026#39;: 20} 0.9426982890941702 è°ƒæ•´å‚æ•° min_samples_split å’Œ min_samples_split å¯¹äºå†…éƒ¨èŠ‚ç‚¹å†åˆ’åˆ†æ‰€éœ€æœ€å°æ ·æœ¬æ•° min_samples_split ï¼Œæˆ‘ä»¬æš‚æ—¶ä¸èƒ½ä¸€èµ·å®šä¸‹æ¥ï¼Œå› ä¸ºè¿™ä¸ªè¿˜å’Œå†³ç­–æ ‘å…¶ä»–çš„å‚æ•°å­˜åœ¨å…³è”ã€‚ä¸‹é¢æˆ‘ä»¬å†å¯¹å†…éƒ¨èŠ‚ç‚¹å†åˆ’åˆ†æ‰€éœ€æœ€å°æ ·æœ¬æ•° min_samples_split å’Œå¶å­èŠ‚ç‚¹æœ€å°‘æ ·æœ¬æ•° min_samples_leaf ä¸€èµ·è°ƒå‚ã€‚\n1 2 3 4 5 6 7 8 9 10 param_test3 = {\u0026#39;min_samples_split\u0026#39;: list(range(5, 51, 5)), \u0026#39;min_samples_leaf\u0026#39;: list(range(5, 51, 5))} classifier = RandomForestClassifier(n_estimators=30, max_depth=7, criterion=\u0026#39;entropy\u0026#39;, oob_score=True, random_state=0) gsearch3 = GridSearchCV(estimator=classifier, param_grid=param_test3, scoring=\u0026#39;roc_auc\u0026#39;, iid=False, cv=5) gsearch3.fit(X_train, y_train) print(gsearch3.best_params_) print(gsearch3.best_score_) Result:\n1 2 {\u0026#39;min_samples_leaf\u0026#39;: 5, \u0026#39;min_samples_split\u0026#39;: 30} 0.9419350440517489 è‡³æ­¤ç›¸å…³å‚æ•°å·²è°ƒæ•´å®Œæ¯•ï¼Œä¸è¿‡è¿™ç§ä¸²è¡Œè°ƒä¼˜æ–¹å¼å¹¶ä¸èƒ½ä¸€æ¬¡æ€§æ‰¾åˆ°æœ€å¥½çš„è§£ã€‚æˆ‘ä»¬å¯ä»¥å°†å‚æ•°å¯é€‰çš„å€¼ä¸€æ¬¡æ€§çš„å¯¼å…¥ç½‘æ ¼ï¼Œä½¿å¾—æ‰€æœ‰å‚æ•°è°ƒä¼˜åŒæ­¥è¿›è¡Œï¼Œä½†æ˜¯è¿™æ ·ä¼šé™ä½ç¨‹åºè¿è¡Œçš„æ•ˆç‡ï¼Œå¯èƒ½éœ€è¦å¤§é‡çš„è®¡ç®—èµ„æºã€‚å¦‚æœç®—åŠ›å¼ºå¤§ï¼Œè¿˜æ˜¯å€¼å¾—ä¸€è¯•çš„ã€‚\n","permalink":"https://reid00.github.io/en/posts/ml/%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E5%9B%9E%E5%BD%92%E6%A0%91%E6%A8%A1%E5%9E%8B/","summary":"è°ƒå‚ â˜… åœ¨ scikit-learn ä¸­ï¼ŒRandom Forestï¼ˆä»¥ä¸‹ç®€ç§°RFï¼‰çš„åˆ†ç±»ç±»æ˜¯ RandomForestClassifierï¼Œå›å½’ç±»æ˜¯ RandomForestRegressorã€‚\nRF éœ€è¦è°ƒå‚çš„å‚æ•°ä¹ŸåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯ Bagging æ¡†æ¶çš„å‚æ•°ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ CART å†³ç­–æ ‘çš„å‚æ•°ã€‚ä¸‹é¢æˆ‘ä»¬å°±å¯¹è¿™äº›å‚æ•°åšä¸€ä¸ªä»‹ç»ã€‚\nRF æ¡†æ¶å‚æ•° é¦–å…ˆæˆ‘ä»¬å…³æ³¨äº RF çš„ Bagging æ¡†æ¶çš„å‚æ•°ã€‚è¿™é‡Œå¯ä»¥å’Œ GBDT å¯¹æ¯”æ¥å­¦ä¹ ã€‚GBDT çš„æ¡†æ¶å‚æ•°æ¯”è¾ƒå¤šï¼Œé‡è¦çš„æœ‰æœ€å¤§è¿­ä»£å™¨ä¸ªæ•°ï¼Œæ­¥é•¿å’Œå­é‡‡æ ·æ¯”ä¾‹ï¼Œè°ƒå‚èµ·æ¥æ¯”è¾ƒè´¹åŠ›ã€‚ä½†æ˜¯ RF åˆ™æ¯”è¾ƒç®€å•ï¼Œè¿™æ˜¯å› ä¸º bagging æ¡†æ¶é‡Œçš„å„ä¸ªå¼±å­¦ä¹ å™¨ä¹‹é—´æ˜¯æ²¡æœ‰ä¾èµ–å…³ç³»çš„ï¼Œè¿™å‡å°çš„è°ƒå‚çš„éš¾åº¦ã€‚æ¢å¥è¯è¯´ï¼Œè¾¾åˆ°åŒæ ·çš„è°ƒå‚æ•ˆæœï¼ŒRF è°ƒå‚æ—¶é—´è¦æ¯” GBDT å°‘ä¸€äº›ã€‚\nä¸‹é¢æˆ‘æ¥çœ‹çœ‹ RF é‡è¦çš„ Bagging æ¡†æ¶çš„å‚æ•°ï¼Œç”±äº RandomForestClassifier å’Œ RandomForestRegressor å‚æ•°ç»å¤§éƒ¨åˆ†ç›¸åŒï¼Œè¿™é‡Œä¼šå°†å®ƒä»¬ä¸€èµ·è®²ï¼Œä¸åŒç‚¹ä¼šæŒ‡å‡ºã€‚\nn_estimatorsï¼šä¹Ÿå°±æ˜¯å¼±å­¦ä¹ å™¨çš„æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œæˆ–è€…è¯´æœ€å¤§çš„å¼±å­¦ä¹ å™¨çš„ä¸ªæ•°ã€‚ä¸€èˆ¬æ¥è¯´ n_estimators å¤ªå°ï¼Œå®¹æ˜“æ¬ æ‹Ÿåˆï¼Œn_estimators å¤ªå¤§ï¼Œè®¡ç®—é‡ä¼šå¤ªå¤§ï¼Œå¹¶ä¸” n_estimators åˆ°ä¸€å®šçš„æ•°é‡åï¼Œå†å¢å¤§ n_estimators è·å¾—çš„æ¨¡å‹æå‡ä¼šå¾ˆå°ï¼Œæ‰€ä»¥ä¸€èˆ¬é€‰æ‹©ä¸€ä¸ªé€‚ä¸­çš„æ•°å€¼ã€‚é»˜è®¤æ˜¯ 100 ã€‚\noob_scoreï¼šå³æ˜¯å¦é‡‡ç”¨è¢‹å¤–æ ·æœ¬æ¥è¯„ä¼°æ¨¡å‹çš„å¥½åã€‚é»˜è®¤è¯† False ã€‚ä¸ªäººæ¨èè®¾ç½®ä¸º True ï¼Œå› ä¸ºè¢‹å¤–åˆ†æ•°ååº”äº†ä¸€ä¸ªæ¨¡å‹æ‹Ÿåˆåçš„æ³›åŒ–èƒ½åŠ›ã€‚\ncriterion: å³ CART æ ‘åšåˆ’åˆ†æ—¶å¯¹ç‰¹å¾çš„è¯„ä»·æ ‡å‡†ã€‚åˆ†ç±»æ¨¡å‹å’Œå›å½’æ¨¡å‹çš„æŸå¤±å‡½æ•°æ˜¯ä¸ä¸€æ ·çš„ã€‚åˆ†ç±» RF å¯¹åº”çš„ CART åˆ†ç±»æ ‘é»˜è®¤æ˜¯åŸºå°¼ç³»æ•° gini ï¼Œå¦ä¸€ä¸ªå¯é€‰æ‹©çš„æ ‡å‡†æ˜¯ä¿¡æ¯å¢ç›Šã€‚å›å½’ RF å¯¹åº”çš„ CART å›å½’æ ‘é»˜è®¤æ˜¯å‡æ–¹å·® mse ï¼Œå¦ä¸€ä¸ªå¯ä»¥é€‰æ‹©çš„æ ‡å‡†æ˜¯ç»å¯¹å€¼å·® mae ã€‚ä¸€èˆ¬æ¥è¯´é€‰æ‹©é»˜è®¤çš„æ ‡å‡†å°±å·²ç»å¾ˆå¥½çš„ã€‚","title":"éšæœºæ£®æ—ï¼ˆå›å½’æ ‘ï¼‰æ¨¡å‹"},{"content":"éšæœºæ£®æ—ç®—æ³•æ€æƒ³ éšæœºæ£®æ—ï¼ˆRandom Forestï¼‰ä½¿ç”¨å¤šä¸ªCARTå†³ç­–æ ‘ä½œä¸ºå¼±å­¦ä¹ å™¨ï¼Œä¸åŒå†³ç­–æ ‘ä¹‹é—´æ²¡æœ‰å…³è”ã€‚å½“æˆ‘ä»¬è¿›è¡Œåˆ†ç±»ä»»åŠ¡æ—¶ï¼Œæ–°çš„è¾“å…¥æ ·æœ¬è¿›å…¥ï¼Œå°±è®©æ£®æ—ä¸­çš„æ¯ä¸€æ£µå†³ç­–æ ‘åˆ†åˆ«è¿›è¡Œåˆ¤æ–­å’Œåˆ†ç±»ï¼Œæ¯ä¸ªå†³ç­–æ ‘ä¼šå¾—åˆ°ä¸€ä¸ªè‡ªå·±çš„åˆ†ç±»ç»“æœï¼Œå†³ç­–æ ‘çš„åˆ†ç±»ç»“æœä¸­å“ªä¸€ä¸ªåˆ†ç±»æœ€å¤šï¼Œé‚£ä¹ˆéšæœºæ£®æ—å°±ä¼šæŠŠè¿™ä¸ªç»“æœå½“åšæœ€ç»ˆçš„ç»“æœã€‚\néšæœºæ£®æ—åœ¨ç”Ÿæˆå†³ç­–æ ‘çš„æ—¶å€™ç”¨éšæœºé€‰æ‹©çš„ç‰¹å¾ï¼Œå³ä½¿ç”¨Baggingæ–¹æ³•ã€‚è¿™ä¹ˆåšçš„åŸå› æ˜¯ï¼šå¦‚æœè®­ç»ƒé›†ä¸­çš„æŸå‡ ä¸ªç‰¹å¾å¯¹è¾“å‡ºçš„ç»“æœæœ‰å¾ˆå¼ºçš„é¢„æµ‹æ€§ï¼Œé‚£ä¹ˆè¿™äº›ç‰¹å¾ä¼šè¢«æ¯ä¸ªå†³ç­–æ ‘æ‰€åº”ç”¨ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ ‘ä¹‹é—´å…·æœ‰ç›¸å…³æ€§ï¼Œè¿™æ ·å¹¶ä¸ä¼šå‡å°æ¨¡å‹çš„æ–¹å·®ã€‚\néšæœºæ£®æ—å¯¹å†³ç­–æ ‘çš„å»ºç«‹åšäº†ä¸€äº›æ”¹è¿›ï¼š\néšæœºæ£®æ—ä¸ä¼šåƒæ™®é€šå†³ç­–æ ‘ä¸€æ ·é€‰æ‹©æœ€ä¼˜ç‰¹å¾è¿›è¡Œå­æ ‘çš„åˆ’åˆ†ï¼Œè€Œæ˜¯éšæœºé€‰æ‹©èŠ‚ç‚¹ä¸Šçš„ä¸€éƒ¨åˆ†æ ·æœ¬ç‰¹å¾ï¼šNsubï¼ˆå­é›†ï¼‰ï¼Œç„¶ååœ¨éšæœºæŒ‘é€‰å‡ºæ¥çš„é›†åˆNsubä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªæœ€ä¼˜çš„ç‰¹å¾æ¥åšå†³ç­–æ ‘çš„å·¦å³å­æ ‘åˆ’åˆ†ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¨èå­é›†Nsubå†…ç‰¹å¾çš„ä¸ªæ•°ä¸ºlog2dä¸ªã€‚è¿™æ ·è¿›ä¸€æ­¥å¢å¼ºäº†æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚\nå¦‚æœNsub=Nï¼Œåˆ™æ­¤æ—¶éšæœºæ£®æ—çš„CARTå†³ç­–æ ‘å’Œæ™®é€šçš„CARTå†³ç­–æ ‘æ²¡æœ‰åŒºåˆ«ã€‚Nsubè¶Šå°ï¼Œåˆ™æ¨¡å‹è¶Šå¥å£®ã€‚å½“ç„¶æ­¤æ—¶å¯¹äºè®­ç»ƒé›†çš„æ‹Ÿåˆç¨‹åº¦ä¼šå˜å·®ã€‚ä¹Ÿå°±æ˜¯è¯´Nsubè¶Šå°ï¼Œæ¨¡å‹çš„æ–¹å·®ä¼šå‡å°ï¼Œä½†æ˜¯åå·®ä¼šå¢å¤§ã€‚åœ¨å®é™…æ¡ˆä¾‹ä¸­ï¼Œä¸€èˆ¬ä¼šé€šè¿‡äº¤å‰éªŒè¯è°ƒå‚è·å–ä¸€ä¸ªåˆé€‚çš„çš„Nsubå€¼ã€‚\néšæœºæ£®æ—æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼šä¸åƒå†³ç­–æ ‘ä¸€æ ·æœ‰å¾ˆå¥½åœ°è§£é‡Šæ€§ã€‚ä½†æ˜¯ï¼Œéšæœºæ£®æ—æœ‰æ›´å¥½åœ°å‡†ç¡®æ€§ï¼ŒåŒæ—¶ä¹Ÿå¹¶ä¸éœ€è¦ä¿®å‰ªéšæœºæ£®æ—ã€‚å¯¹äºéšæœºæ£®æ—æ¥è¯´ï¼Œåªéœ€è¦é€‰æ‹©ä¸€ä¸ªå‚æ•°ï¼Œç”Ÿæˆå†³ç­–æ ‘çš„ä¸ªæ•°ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå†³ç­–æ ‘çš„ä¸ªæ•°è¶Šå¤šï¼Œæ€§èƒ½è¶Šå¥½ï¼Œä½†æ˜¯ï¼Œè®¡ç®—å¼€é”€åŒæ—¶ä¹Ÿå¢å¤§äº†ã€‚\néšæœºæ£®æ—å»ºç«‹è¿‡ç¨‹ ç¬¬ä¸€æ­¥ï¼šåŸå§‹è®­ç»ƒé›†Dä¸­æœ‰Nä¸ªæ ·æœ¬ï¼Œä¸”æ¯ä¸ªæ ·æœ¬æœ‰Wç»´ç‰¹å¾ã€‚ä»æ•°æ®é›†Dä¸­æœ‰æ”¾å›çš„éšæœºæŠ½å–xä¸ªæ ·æœ¬ï¼ˆBootstrapingæ–¹æ³•ï¼‰ç»„æˆè®­ç»ƒå­é›†Dsubï¼Œä¸€å…±è¿›è¡Œwæ¬¡é‡‡æ ·ï¼Œå³ç”Ÿæˆwä¸ªè®­ç»ƒå­é›†Dsubã€‚\nç¬¬äºŒæ­¥ï¼šæ¯ä¸ªè®­ç»ƒå­é›†Dsubå½¢æˆä¸€æ£µå†³ç­–æ ‘ï¼Œå½¢æˆäº†ä¸€å…±wæ£µå†³ç­–æ ‘ã€‚è€Œæ¯ä¸€æ¬¡æœªè¢«æŠ½åˆ°çš„æ ·æœ¬åˆ™ç»„æˆäº†wä¸ªoobï¼ˆç”¨æ¥åšé¢„ä¼°ï¼‰ã€‚\nç¬¬ä¸‰æ­¥ï¼šå¯¹äºå•ä¸ªå†³ç­–æ ‘ï¼Œæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹å¤„ä»Mä¸ªç‰¹å¾ä¸­éšæœºæŒ‘é€‰mï¼ˆm\u0026lt;Mï¼‰ä¸ªç‰¹å¾ï¼ŒæŒ‰ç…§ç»“ç‚¹ä¸çº¯åº¦æœ€å°åŸåˆ™è¿›è¡Œåˆ†è£‚ã€‚æ¯æ£µæ ‘éƒ½ä¸€ç›´è¿™æ ·åˆ†è£‚ä¸‹å»ï¼Œç›´åˆ°è¯¥èŠ‚ç‚¹çš„æ‰€æœ‰è®­ç»ƒæ ·ä¾‹éƒ½å±äºåŒä¸€ç±»ã€‚åœ¨å†³ç­–æ ‘çš„åˆ†è£‚è¿‡ç¨‹ä¸­ä¸éœ€è¦å‰ªæã€‚\nç¬¬å››æ­¥ï¼šæ ¹æ®ç”Ÿæˆçš„å¤šä¸ªå†³ç­–æ ‘åˆ†ç±»å™¨å¯¹éœ€è¦è¿›è¡Œé¢„æµ‹çš„æ•°æ®è¿›è¡Œé¢„æµ‹ã€‚æ ¹æ®æ¯æ£µå†³ç­–æ ‘çš„æŠ•ç¥¨ç»“æœï¼Œå¦‚æœæ˜¯åˆ†ç±»æ ‘çš„è¯ï¼Œæœ€åå–ç¥¨æ•°æœ€é«˜çš„ä¸€ä¸ªç±»åˆ«ï¼›å¦‚æœæ˜¯å›å½’æ ‘çš„è¯ï¼Œåˆ©ç”¨ç®€å•çš„å¹³å‡å¾—åˆ°æœ€ç»ˆç»“æœã€‚\néšæœºæ£®æ—ç®—æ³•ä¼˜ç¼ºç‚¹æ€»ç»“åŠé¢è¯•é—®é¢˜ éšæœºæ£®æ—æ˜¯Baggingçš„ä¸€ä¸ªæ‰©å±•å˜ä½“ï¼Œæ˜¯åœ¨ä»¥å†³ç­–æ ‘ä¸ºåŸºå­¦ä¹ å™¨æ„å»ºBaggingé›†æˆçš„åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥åœ¨å†³ç­–æ ‘çš„è®­ç»ƒè¿‡ç¨‹ä¸­å¼•å…¥äº†éšæœºå±æ€§é€‰æ‹©ã€‚\néšæœºæ£®æ—ç®€å•ã€å®¹æ˜“å®ç°ã€è®¡ç®—å¼€é”€å°ï¼Œåœ¨å¾ˆå¤šå®é™…åº”ç”¨ä¸­éƒ½å˜ç°å‡ºäº†å¼ºå¤§çš„æ€§èƒ½ï¼Œè¢«èª‰ä¸ºâ€œä»£è¡¨é›†æˆå­¦ä¹ æŠ€æœ¯æ°´å¹³çš„æ–¹æ³•â€ã€‚å¯ä»¥çœ‹å‡ºï¼Œéšæœºæ£®æ—å¯¹Baggingåªåšäº†å°æ”¹åŠ¨ã€‚å¹¶ä¸”ï¼ŒBaggingæ»¡è¶³å·®å¼‚æ€§çš„æ–¹æ³•æ˜¯å¯¹è®­ç»ƒé›†è¿›è¡Œé‡‡æ ·ï¼›è€Œéšæœºæ£®æ—ä¸ä½†å¯¹è®­ç»ƒé›†è¿›è¡Œéšæœºé‡‡æ ·ï¼Œè€Œä¸”è¿˜éšæœºé€‰æ‹©ç‰¹å¾å­é›†ï¼Œè¿™å°±ä½¿æœ€ç»ˆé›†æˆçš„æ³›åŒ–æ€§è¿›ä¸€æ­¥æå‡ã€‚\néšç€åŸºå­¦ä¹ å™¨æ•°ç›®çš„å¢åŠ ï¼Œéšæœºæ£®æ—é€šå¸¸ä¼šæ”¶æ•›åˆ°æ›´ä½çš„æ³›åŒ–è¯¯å·®ï¼Œå¹¶ä¸”è®­ç»ƒæ•ˆç‡æ˜¯ä¼˜äºBaggingçš„ã€‚\næ€»ç»“ä¸€ä¸‹éšæœºæ£®æ—çš„ä¼˜ç¼ºç‚¹ï¼š\nä¼˜ç‚¹ï¼š\nè®­ç»ƒå¯ä»¥é«˜åº¦å¹¶è¡ŒåŒ–ï¼Œå¯¹äºå¤§æ•°æ®æ—¶ä»£çš„å¤§æ ·æœ¬è®­ç»ƒé€Ÿåº¦æœ‰ä¼˜åŠ¿ã€‚ä¸ªäººè§‰å¾—è¿™æ˜¯çš„æœ€ä¸»è¦çš„ä¼˜ç‚¹ã€‚ ç”±äºå¯ä»¥éšæœºé€‰æ‹©å†³ç­–æ ‘èŠ‚ç‚¹åˆ’åˆ†ç‰¹å¾ï¼Œè¿™æ ·åœ¨æ ·æœ¬ç‰¹å¾ç»´åº¦å¾ˆé«˜çš„æ—¶å€™ï¼Œä»ç„¶èƒ½é«˜æ•ˆçš„è®­ç»ƒæ¨¡å‹ã€‚ åœ¨è®­ç»ƒåï¼Œå¯ä»¥ç»™å‡ºå„ä¸ªç‰¹å¾å¯¹äºè¾“å‡ºçš„é‡è¦æ€§ã€‚ ç”±äºé‡‡ç”¨äº†éšæœºé‡‡æ ·ï¼Œè®­ç»ƒå‡ºçš„æ¨¡å‹çš„æ–¹å·®å°ï¼Œæ³›åŒ–èƒ½åŠ›å¼ºã€‚ ç›¸å¯¹äºBoostingç³»åˆ—çš„Adaboostå’ŒGBDTï¼Œ RFå®ç°æ¯”è¾ƒç®€å•ã€‚ å¯¹éƒ¨åˆ†ç‰¹å¾ç¼ºå¤±ä¸æ•æ„Ÿã€‚ ç¼ºç‚¹æœ‰ï¼š\nåœ¨æŸäº›å™ªéŸ³æ¯”è¾ƒå¤§çš„æ ·æœ¬é›†ä¸Šï¼ŒRFæ¨¡å‹å®¹æ˜“é™·å…¥è¿‡æ‹Ÿåˆã€‚ å–å€¼åˆ’åˆ†æ¯”è¾ƒå¤šçš„ç‰¹å¾å®¹æ˜“å¯¹RFçš„å†³ç­–äº§ç”Ÿæ›´å¤§çš„å½±å“ï¼Œä»è€Œå½±å“æ‹Ÿåˆçš„æ¨¡å‹çš„æ•ˆæœã€‚ ä¸‹é¢çœ‹å‡ ä¸ªé¢è¯•é—®é¢˜ï¼š\n1ã€ä¸ºä»€ä¹ˆè¦æœ‰æ”¾å›çš„æŠ½æ ·ï¼Ÿä¿è¯æ ·æœ¬é›†é—´æœ‰é‡å ï¼Œè‹¥ä¸æ”¾å›ï¼Œæ¯ä¸ªè®­ç»ƒæ ·æœ¬é›†åŠå…¶åˆ†å¸ƒéƒ½ä¸ä¸€æ ·ï¼Œå¯èƒ½å¯¼è‡´è®­ç»ƒçš„å„å†³ç­–æ ‘å·®å¼‚æ€§å¾ˆå¤§ï¼Œæœ€ç»ˆå¤šæ•°è¡¨å†³æ— æ³• â€œæ±‚åŒâ€ï¼Œå³æœ€ç»ˆå¤šæ•°è¡¨å†³ç›¸å½“äºâ€œæ±‚åŒâ€è¿‡ç¨‹ã€‚\n2ã€ä¸ºä»€ä¹ˆRFçš„è®­ç»ƒæ•ˆç‡ä¼˜äºbaggingï¼Ÿå› ä¸ºåœ¨ä¸ªä½“å†³ç­–æ ‘çš„æ„å»ºè¿‡ç¨‹ä¸­ï¼ŒBaggingä½¿ç”¨çš„æ˜¯â€œç¡®å®šå‹â€å†³ç­–æ ‘ï¼Œbaggingåœ¨é€‰æ‹©åˆ’åˆ†å±æ€§æ—¶è¦å¯¹æ¯æ£µæ ‘æ˜¯å¯¹æ‰€æœ‰ç‰¹å¾è¿›è¡Œè€ƒå¯Ÿï¼›è€Œéšæœºæ£®æ—ä»…ä»…è€ƒè™‘ä¸€ä¸ªç‰¹å¾å­é›†ã€‚\n3ã€éšæœºæ£®æ—éœ€è¦å‰ªæå—ï¼Ÿä¸éœ€è¦ï¼Œåå‰ªææ˜¯ä¸ºäº†é¿å…è¿‡æ‹Ÿåˆï¼Œéšæœºæ£®æ—éšæœºé€‰æ‹©å˜é‡ä¸æ ‘çš„æ•°é‡ï¼Œå·²ç»é¿å…äº†è¿‡æ‹Ÿåˆï¼Œæ²¡å¿…è¦å»å‰ªæäº†ã€‚ä¸€èˆ¬rfè¦æ§åˆ¶çš„æ˜¯æ ‘çš„è§„æ¨¡ï¼Œè€Œä¸æ˜¯æ ‘çš„ç½®ä¿¡åº¦ï¼Œå‰©ä¸‹çš„æ¯æ£µæ ‘éœ€è¦åšçš„å°±æ˜¯å°½å¯èƒ½çš„åœ¨è‡ªå·±æ‰€å¯¹åº”çš„æ•°æ®(ç‰¹å¾)é›†æƒ…å†µä¸‹å°½å¯èƒ½çš„åšåˆ°æœ€å¥½çš„é¢„æµ‹ç»“æœã€‚å‰ªæçš„ä½œç”¨å…¶å®è¢«é›†æˆæ–¹æ³•æ¶ˆè§£äº†ï¼Œæ‰€ä»¥ç”¨å¤„ä¸å¤§ã€‚\nExtra-TreeåŠå…¶ä¸RFçš„åŒºåˆ« Extra-Treeæ˜¯éšæœºæ£®æ—çš„ä¸€ä¸ªå˜ç§, åŸç†å‡ ä¹å’Œéšæœºæ£®æ—ä¸€æ¨¡ä¸€æ ·ï¼Œå¯ä»¥ç§°ä¸ºï¼šâ€œæå…¶éšæœºæ£®æ—â€ï¼Œå³å†³ç­–æ ‘åœ¨èŠ‚ç‚¹çš„åˆ’åˆ†ä¸Šï¼Œä½¿ç”¨éšæœºçš„ç‰¹å¾å’Œéšæœºçš„é˜ˆå€¼ã€‚\nç‰¹å¾å’Œé˜ˆå€¼æä¾›äº†é¢å¤–éšæœºæ€§ï¼ŒæŠ‘åˆ¶äº†è¿‡æ‹Ÿåˆï¼Œå†ä¸€æ¬¡ç”¨é«˜åå·®æ¢ä½æ–¹å·®ã€‚å®ƒè¿˜ä½¿å¾— Extra-Tree æ¯”è§„åˆ™çš„éšæœºæ£®æ—æ›´å¿«åœ°è®­ç»ƒï¼Œå› ä¸ºåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ‰¾åˆ°æ¯ä¸ªç‰¹å¾çš„æœ€ä½³é˜ˆå€¼æ˜¯ç”Ÿé•¿æ ‘æœ€è€—æ—¶çš„ä»»åŠ¡ä¹‹ä¸€ã€‚\nExtra-Treeä¸éšæœºæ£®æ—çš„åŒºåˆ«æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š\nå¯¹äºæ¯ä¸ªå†³ç­–æ ‘çš„è®­ç»ƒé›†ï¼Œéšæœºæ£®æ—é‡‡ç”¨çš„æ˜¯éšæœºé‡‡æ ·bootstrapæ¥é€‰æ‹©é‡‡æ ·é›†ä½œä¸ºæ¯ä¸ªå†³ç­–æ ‘çš„è®­ç»ƒé›†ï¼Œè€ŒExtra-Treeä¸€èˆ¬ä¸é‡‡ç”¨éšæœºé‡‡æ ·ï¼Œå³æ¯ä¸ªå†³ç­–æ ‘é‡‡ç”¨åŸå§‹è®­ç»ƒé›†ã€‚ åœ¨é€‰å®šäº†åˆ’åˆ†ç‰¹å¾åï¼Œéšæœºæ£®æ—çš„å†³ç­–æ ‘ä¼šåŸºäºåŸºå°¼ç³»æ•°ï¼Œå‡æ–¹å·®ä¹‹ç±»çš„åŸåˆ™ï¼Œé€‰æ‹©ä¸€ä¸ªæœ€ä¼˜çš„ç‰¹å¾å€¼åˆ’åˆ†ç‚¹ï¼Œè¿™å’Œä¼ ç»Ÿçš„å†³ç­–æ ‘ç›¸åŒã€‚ä½†æ˜¯Extra-Treeæ¯”è¾ƒçš„æ¿€è¿›ï¼Œä»–ä¼šéšæœºçš„é€‰æ‹©ä¸€ä¸ªç‰¹å¾å€¼æ¥åˆ’åˆ†å†³ç­–æ ‘ã€‚ ä»ç¬¬äºŒç‚¹å¯ä»¥çœ‹å‡ºï¼Œç”±äºéšæœºé€‰æ‹©äº†ç‰¹å¾å€¼çš„åˆ’åˆ†ç‚¹ä½ï¼Œè€Œä¸æ˜¯æœ€ä¼˜ç‚¹ä½ï¼Œè¿™æ ·ä¼šå¯¼è‡´ç”Ÿæˆçš„å†³ç­–æ ‘çš„è§„æ¨¡ä¸€èˆ¬ä¼šå¤§äºéšæœºæ£®æ—æ‰€ç”Ÿæˆçš„å†³ç­–æ ‘ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¨¡å‹çš„æ–¹å·®ç›¸å¯¹äºéšæœºæ£®æ—è¿›ä¸€æ­¥å‡å°‘ï¼Œä½†æ˜¯åå€šç›¸å¯¹äºéšæœºæ£®æ—è¿›ä¸€æ­¥å¢å¤§ã€‚åœ¨æŸäº›æ—¶å€™ï¼ŒExtra-Treeçš„æ³›åŒ–èƒ½åŠ›æ¯”éšæœºæ£®æ—æ›´å¥½ã€‚\nRFè¯„ä¼°ç‰¹å¾é‡è¦æ€§ åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ä¼šå…³ç³»å¦‚ä½•åœ¨é«˜ç»´æ•°æ®ä¸­é€‰æ‹©å¯¹ç»“æœå½±å“æœ€å¤§çš„å‰nä¸ªç‰¹å¾ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨PCAã€LASSOç­‰æ–¹æ³•ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨RFç®—æ³•æ¥è¿›è¡Œç‰¹å¾é€‰æ‹©ã€‚æ„Ÿå…´è¶£çš„è¯ã€‚\nRFç®—æ³•çš„æœ‰ä¸€ä¸ªå…¸å‹çš„åº”ç”¨ï¼šè¯„ä¼°å•ä¸ªç‰¹å¾å˜é‡çš„é‡è¦æ€§å¹¶è¿›è¡Œç‰¹å¾é€‰æ‹©ã€‚\nä¸¾ä¸€ä¸ªå…·ä½“çš„åº”ç”¨åœºæ™¯ï¼šé“¶è¡Œè´·æ¬¾ä¸šåŠ¡ä¸­èƒ½å¦æ­£ç¡®çš„è¯„ä¼°ä¼ä¸šçš„ä¿¡ç”¨åº¦ï¼Œå…³ç³»åˆ°èƒ½å¦æœ‰æ•ˆåœ°å›æ”¶è´·æ¬¾ã€‚ä½†æ˜¯ä¿¡ç”¨è¯„ä¼°æ¨¡å‹çš„æ•°æ®ç‰¹å¾æœ‰å¾ˆå¤šï¼Œå…¶ä¸­ä¸ä¹æœ‰å¾ˆå¤šå™ªéŸ³ï¼Œæ‰€ä»¥éœ€è¦è®¡ç®—å‡ºæ¯ä¸€ä¸ªç‰¹å¾çš„é‡è¦æ€§å¹¶å¯¹è¿™äº›ç‰¹å¾è¿›è¡Œä¸€ä¸ªæ’åºï¼Œè¿›è€Œå¯ä»¥ä»æ‰€æœ‰ç‰¹å¾ä¸­é€‰æ‹©å‡ºé‡è¦æ€§é å‰çš„ç‰¹å¾ã€‚\nä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¯„ä¼°ç‰¹å¾é‡è¦æ€§çš„æ­¥éª¤ï¼š\nå¯¹äºRFä¸­çš„æ¯ä¸€æ£µå†³ç­–æ ‘ï¼Œé€‰æ‹©OOBæ•°æ®è®¡ç®—æ¨¡å‹çš„é¢„æµ‹é”™è¯¯ç‡ï¼Œè®°ä¸ºError1ã€‚ï¼ˆåœ¨éšæœºæ£®æ—ç®—æ³•ä¸­ä¸éœ€è¦å†è¿›è¡Œäº¤å‰éªŒè¯æ¥è·å–æµ‹è¯•é›†è¯¯å·®çš„æ— åä¼°è®¡ï¼‰\nç„¶ååœ¨OOBä¸­æ‰€æœ‰æ ·æœ¬çš„ç‰¹å¾Aä¸ŠåŠ å…¥éšæœºå™ªå£°ï¼Œæ¥ç€å†æ¬¡ç”¨OOBæ•°æ®è®¡ç®—æ¨¡å‹é¢„æµ‹é”™è¯¯ç‡ï¼Œè®°ä¸ºError2ã€‚\nè‹¥æ£®æ—ä¸­æœ‰Næ£µæ ‘ï¼Œåˆ™ç‰¹å¾Açš„é‡è¦æ€§ä¸º æ±‚å’Œ(Error2-Error1/N)ã€‚\næˆ‘ä»¬ç»†å“ï¼šåœ¨æŸä¸€ç‰¹å¾Aä¸Šå¢åŠ äº†å™ªéŸ³ï¼Œé‚£ä¹ˆå°±æœ‰ç†ç”±ç›¸ä¿¡é”™è¯¯ç‡Error2è¦å¤§äºError1ï¼ŒError2è¶Šå¤§è¯´æ˜ç‰¹å¾Aé‡è¦ã€‚\nå¯ä»¥è¿™ä¹ˆç†è§£ï¼Œå°Aä»å…¬å¸ç¦»èŒäº†ï¼Œè¿™ä¸ªå…¬å¸å€’é—­äº†ï¼Œè¯´æ˜å°Aå¾ˆé‡è¦ï¼›å¦‚æœå°Aèµ°äº†ï¼Œå…¬å¸æ²¡å˜åŒ–ï¼Œè¯´æ˜å°Aä¹Ÿæ²¡å•¥ç”¨ã€‚\nåœ¨sklearnä¸­æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼š\n1 2 3 4 5 6 7 8 from sklearn.cross_validation import train_test_split from sklearn.ensemble import RandomForestClassifier (å¤„ç†æ•°æ®) rf_clf = RandomForestClassifier(n_estimators=1000, random_state=666) rf_clf.fit(x_train, y_train) importances = rf_clf.feature_importances_ ä»é‡è¦æ€§åˆ°ç‰¹å¾é€‰æ‹© æˆ‘ä»¬å·²ç»çŸ¥é“å¦‚ä½•ä½¿ç”¨RFç®—æ³•è¯„ä¼°ç‰¹å¾é‡è¦æ€§äº†ï¼Œé‚£ä¹ˆåœ¨æ­¤åŸºç¡€ä¸Šåšç‰¹å¾é€‰æ‹©å°±å¾ˆç®€å•äº†ï¼š\nå¯¹æ¯ä¸€ä¸ªç‰¹å¾éƒ½è®¡ç®—å…¶ç‰¹å¾é‡è¦æ€§ã€‚ å°†è¿™äº›ç‰¹å¾æŒ‰ç…§é‡è¦æ€§ä»å¤§åˆ°å°æ’åºã€‚ è®¾ç½®è¦åˆ é™¤çš„ç‰¹å¾çš„æ¯”ç‡ï¼Œåˆ é™¤é‡è¦æ€§æœ€å°çš„é‚£äº›ç‰¹å¾ã€‚ å‰©ä¸‹çš„é‚£äº›ç‰¹å¾ï¼Œç»§ç»­è®¡ç®—æ¯ä¸ªæ¯ä¸ªç‰¹å¾çš„é‡è¦æ€§ï¼Œç„¶åå¾ªç¯å›ç¬¬ä¸€æ­¥ï¼Œç›´åˆ°å‰©ä½™ç‰¹å¾æ•°è¾¾åˆ°æˆ‘ä»¬çš„è¦æ±‚ã€‚ æ‰¿æ¥ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬è¿›è¡Œç‰¹å¾é€‰æ‹©ï¼š\n1 2 threshold = [æŸä¸ªé˜ˆå€¼] x_selected = x_train[:, importances \u0026gt; threshold] ","permalink":"https://reid00.github.io/en/posts/ml/%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E7%AE%97%E6%B3%95%E5%8F%8A%E5%85%B6%E5%9C%A8%E7%89%B9%E5%BE%81%E9%80%89%E6%8B%A9%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/","summary":"éšæœºæ£®æ—ç®—æ³•æ€æƒ³ éšæœºæ£®æ—ï¼ˆRandom Forestï¼‰ä½¿ç”¨å¤šä¸ªCARTå†³ç­–æ ‘ä½œä¸ºå¼±å­¦ä¹ å™¨ï¼Œä¸åŒå†³ç­–æ ‘ä¹‹é—´æ²¡æœ‰å…³è”ã€‚å½“æˆ‘ä»¬è¿›è¡Œåˆ†ç±»ä»»åŠ¡æ—¶ï¼Œæ–°çš„è¾“å…¥æ ·æœ¬è¿›å…¥ï¼Œå°±è®©æ£®æ—ä¸­çš„æ¯ä¸€æ£µå†³ç­–æ ‘åˆ†åˆ«è¿›è¡Œåˆ¤æ–­å’Œåˆ†ç±»ï¼Œæ¯ä¸ªå†³ç­–æ ‘ä¼šå¾—åˆ°ä¸€ä¸ªè‡ªå·±çš„åˆ†ç±»ç»“æœï¼Œå†³ç­–æ ‘çš„åˆ†ç±»ç»“æœä¸­å“ªä¸€ä¸ªåˆ†ç±»æœ€å¤šï¼Œé‚£ä¹ˆéšæœºæ£®æ—å°±ä¼šæŠŠè¿™ä¸ªç»“æœå½“åšæœ€ç»ˆçš„ç»“æœã€‚\néšæœºæ£®æ—åœ¨ç”Ÿæˆå†³ç­–æ ‘çš„æ—¶å€™ç”¨éšæœºé€‰æ‹©çš„ç‰¹å¾ï¼Œå³ä½¿ç”¨Baggingæ–¹æ³•ã€‚è¿™ä¹ˆåšçš„åŸå› æ˜¯ï¼šå¦‚æœè®­ç»ƒé›†ä¸­çš„æŸå‡ ä¸ªç‰¹å¾å¯¹è¾“å‡ºçš„ç»“æœæœ‰å¾ˆå¼ºçš„é¢„æµ‹æ€§ï¼Œé‚£ä¹ˆè¿™äº›ç‰¹å¾ä¼šè¢«æ¯ä¸ªå†³ç­–æ ‘æ‰€åº”ç”¨ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ ‘ä¹‹é—´å…·æœ‰ç›¸å…³æ€§ï¼Œè¿™æ ·å¹¶ä¸ä¼šå‡å°æ¨¡å‹çš„æ–¹å·®ã€‚\néšæœºæ£®æ—å¯¹å†³ç­–æ ‘çš„å»ºç«‹åšäº†ä¸€äº›æ”¹è¿›ï¼š\néšæœºæ£®æ—ä¸ä¼šåƒæ™®é€šå†³ç­–æ ‘ä¸€æ ·é€‰æ‹©æœ€ä¼˜ç‰¹å¾è¿›è¡Œå­æ ‘çš„åˆ’åˆ†ï¼Œè€Œæ˜¯éšæœºé€‰æ‹©èŠ‚ç‚¹ä¸Šçš„ä¸€éƒ¨åˆ†æ ·æœ¬ç‰¹å¾ï¼šNsubï¼ˆå­é›†ï¼‰ï¼Œç„¶ååœ¨éšæœºæŒ‘é€‰å‡ºæ¥çš„é›†åˆNsubä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªæœ€ä¼˜çš„ç‰¹å¾æ¥åšå†³ç­–æ ‘çš„å·¦å³å­æ ‘åˆ’åˆ†ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¨èå­é›†Nsubå†…ç‰¹å¾çš„ä¸ªæ•°ä¸ºlog2dä¸ªã€‚è¿™æ ·è¿›ä¸€æ­¥å¢å¼ºäº†æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚\nå¦‚æœNsub=Nï¼Œåˆ™æ­¤æ—¶éšæœºæ£®æ—çš„CARTå†³ç­–æ ‘å’Œæ™®é€šçš„CARTå†³ç­–æ ‘æ²¡æœ‰åŒºåˆ«ã€‚Nsubè¶Šå°ï¼Œåˆ™æ¨¡å‹è¶Šå¥å£®ã€‚å½“ç„¶æ­¤æ—¶å¯¹äºè®­ç»ƒé›†çš„æ‹Ÿåˆç¨‹åº¦ä¼šå˜å·®ã€‚ä¹Ÿå°±æ˜¯è¯´Nsubè¶Šå°ï¼Œæ¨¡å‹çš„æ–¹å·®ä¼šå‡å°ï¼Œä½†æ˜¯åå·®ä¼šå¢å¤§ã€‚åœ¨å®é™…æ¡ˆä¾‹ä¸­ï¼Œä¸€èˆ¬ä¼šé€šè¿‡äº¤å‰éªŒè¯è°ƒå‚è·å–ä¸€ä¸ªåˆé€‚çš„çš„Nsubå€¼ã€‚\néšæœºæ£®æ—æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼šä¸åƒå†³ç­–æ ‘ä¸€æ ·æœ‰å¾ˆå¥½åœ°è§£é‡Šæ€§ã€‚ä½†æ˜¯ï¼Œéšæœºæ£®æ—æœ‰æ›´å¥½åœ°å‡†ç¡®æ€§ï¼ŒåŒæ—¶ä¹Ÿå¹¶ä¸éœ€è¦ä¿®å‰ªéšæœºæ£®æ—ã€‚å¯¹äºéšæœºæ£®æ—æ¥è¯´ï¼Œåªéœ€è¦é€‰æ‹©ä¸€ä¸ªå‚æ•°ï¼Œç”Ÿæˆå†³ç­–æ ‘çš„ä¸ªæ•°ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå†³ç­–æ ‘çš„ä¸ªæ•°è¶Šå¤šï¼Œæ€§èƒ½è¶Šå¥½ï¼Œä½†æ˜¯ï¼Œè®¡ç®—å¼€é”€åŒæ—¶ä¹Ÿå¢å¤§äº†ã€‚\néšæœºæ£®æ—å»ºç«‹è¿‡ç¨‹ ç¬¬ä¸€æ­¥ï¼šåŸå§‹è®­ç»ƒé›†Dä¸­æœ‰Nä¸ªæ ·æœ¬ï¼Œä¸”æ¯ä¸ªæ ·æœ¬æœ‰Wç»´ç‰¹å¾ã€‚ä»æ•°æ®é›†Dä¸­æœ‰æ”¾å›çš„éšæœºæŠ½å–xä¸ªæ ·æœ¬ï¼ˆBootstrapingæ–¹æ³•ï¼‰ç»„æˆè®­ç»ƒå­é›†Dsubï¼Œä¸€å…±è¿›è¡Œwæ¬¡é‡‡æ ·ï¼Œå³ç”Ÿæˆwä¸ªè®­ç»ƒå­é›†Dsubã€‚\nç¬¬äºŒæ­¥ï¼šæ¯ä¸ªè®­ç»ƒå­é›†Dsubå½¢æˆä¸€æ£µå†³ç­–æ ‘ï¼Œå½¢æˆäº†ä¸€å…±wæ£µå†³ç­–æ ‘ã€‚è€Œæ¯ä¸€æ¬¡æœªè¢«æŠ½åˆ°çš„æ ·æœ¬åˆ™ç»„æˆäº†wä¸ªoobï¼ˆç”¨æ¥åšé¢„ä¼°ï¼‰ã€‚\nç¬¬ä¸‰æ­¥ï¼šå¯¹äºå•ä¸ªå†³ç­–æ ‘ï¼Œæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹å¤„ä»Mä¸ªç‰¹å¾ä¸­éšæœºæŒ‘é€‰mï¼ˆm\u0026lt;Mï¼‰ä¸ªç‰¹å¾ï¼ŒæŒ‰ç…§ç»“ç‚¹ä¸çº¯åº¦æœ€å°åŸåˆ™è¿›è¡Œåˆ†è£‚ã€‚æ¯æ£µæ ‘éƒ½ä¸€ç›´è¿™æ ·åˆ†è£‚ä¸‹å»ï¼Œç›´åˆ°è¯¥èŠ‚ç‚¹çš„æ‰€æœ‰è®­ç»ƒæ ·ä¾‹éƒ½å±äºåŒä¸€ç±»ã€‚åœ¨å†³ç­–æ ‘çš„åˆ†è£‚è¿‡ç¨‹ä¸­ä¸éœ€è¦å‰ªæã€‚\nç¬¬å››æ­¥ï¼šæ ¹æ®ç”Ÿæˆçš„å¤šä¸ªå†³ç­–æ ‘åˆ†ç±»å™¨å¯¹éœ€è¦è¿›è¡Œé¢„æµ‹çš„æ•°æ®è¿›è¡Œé¢„æµ‹ã€‚æ ¹æ®æ¯æ£µå†³ç­–æ ‘çš„æŠ•ç¥¨ç»“æœï¼Œå¦‚æœæ˜¯åˆ†ç±»æ ‘çš„è¯ï¼Œæœ€åå–ç¥¨æ•°æœ€é«˜çš„ä¸€ä¸ªç±»åˆ«ï¼›å¦‚æœæ˜¯å›å½’æ ‘çš„è¯ï¼Œåˆ©ç”¨ç®€å•çš„å¹³å‡å¾—åˆ°æœ€ç»ˆç»“æœã€‚\néšæœºæ£®æ—ç®—æ³•ä¼˜ç¼ºç‚¹æ€»ç»“åŠé¢è¯•é—®é¢˜ éšæœºæ£®æ—æ˜¯Baggingçš„ä¸€ä¸ªæ‰©å±•å˜ä½“ï¼Œæ˜¯åœ¨ä»¥å†³ç­–æ ‘ä¸ºåŸºå­¦ä¹ å™¨æ„å»ºBaggingé›†æˆçš„åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥åœ¨å†³ç­–æ ‘çš„è®­ç»ƒè¿‡ç¨‹ä¸­å¼•å…¥äº†éšæœºå±æ€§é€‰æ‹©ã€‚\néšæœºæ£®æ—ç®€å•ã€å®¹æ˜“å®ç°ã€è®¡ç®—å¼€é”€å°ï¼Œåœ¨å¾ˆå¤šå®é™…åº”ç”¨ä¸­éƒ½å˜ç°å‡ºäº†å¼ºå¤§çš„æ€§èƒ½ï¼Œè¢«èª‰ä¸ºâ€œä»£è¡¨é›†æˆå­¦ä¹ æŠ€æœ¯æ°´å¹³çš„æ–¹æ³•â€ã€‚å¯ä»¥çœ‹å‡ºï¼Œéšæœºæ£®æ—å¯¹Baggingåªåšäº†å°æ”¹åŠ¨ã€‚å¹¶ä¸”ï¼ŒBaggingæ»¡è¶³å·®å¼‚æ€§çš„æ–¹æ³•æ˜¯å¯¹è®­ç»ƒé›†è¿›è¡Œé‡‡æ ·ï¼›è€Œéšæœºæ£®æ—ä¸ä½†å¯¹è®­ç»ƒé›†è¿›è¡Œéšæœºé‡‡æ ·ï¼Œè€Œä¸”è¿˜éšæœºé€‰æ‹©ç‰¹å¾å­é›†ï¼Œè¿™å°±ä½¿æœ€ç»ˆé›†æˆçš„æ³›åŒ–æ€§è¿›ä¸€æ­¥æå‡ã€‚\néšç€åŸºå­¦ä¹ å™¨æ•°ç›®çš„å¢åŠ ï¼Œéšæœºæ£®æ—é€šå¸¸ä¼šæ”¶æ•›åˆ°æ›´ä½çš„æ³›åŒ–è¯¯å·®ï¼Œå¹¶ä¸”è®­ç»ƒæ•ˆç‡æ˜¯ä¼˜äºBaggingçš„ã€‚\næ€»ç»“ä¸€ä¸‹éšæœºæ£®æ—çš„ä¼˜ç¼ºç‚¹ï¼š\nä¼˜ç‚¹ï¼š\nè®­ç»ƒå¯ä»¥é«˜åº¦å¹¶è¡ŒåŒ–ï¼Œå¯¹äºå¤§æ•°æ®æ—¶ä»£çš„å¤§æ ·æœ¬è®­ç»ƒé€Ÿåº¦æœ‰ä¼˜åŠ¿ã€‚ä¸ªäººè§‰å¾—è¿™æ˜¯çš„æœ€ä¸»è¦çš„ä¼˜ç‚¹ã€‚ ç”±äºå¯ä»¥éšæœºé€‰æ‹©å†³ç­–æ ‘èŠ‚ç‚¹åˆ’åˆ†ç‰¹å¾ï¼Œè¿™æ ·åœ¨æ ·æœ¬ç‰¹å¾ç»´åº¦å¾ˆé«˜çš„æ—¶å€™ï¼Œä»ç„¶èƒ½é«˜æ•ˆçš„è®­ç»ƒæ¨¡å‹ã€‚ åœ¨è®­ç»ƒåï¼Œå¯ä»¥ç»™å‡ºå„ä¸ªç‰¹å¾å¯¹äºè¾“å‡ºçš„é‡è¦æ€§ã€‚ ç”±äºé‡‡ç”¨äº†éšæœºé‡‡æ ·ï¼Œè®­ç»ƒå‡ºçš„æ¨¡å‹çš„æ–¹å·®å°ï¼Œæ³›åŒ–èƒ½åŠ›å¼ºã€‚ ç›¸å¯¹äºBoostingç³»åˆ—çš„Adaboostå’ŒGBDTï¼Œ RFå®ç°æ¯”è¾ƒç®€å•ã€‚ å¯¹éƒ¨åˆ†ç‰¹å¾ç¼ºå¤±ä¸æ•æ„Ÿã€‚ ç¼ºç‚¹æœ‰ï¼š\nåœ¨æŸäº›å™ªéŸ³æ¯”è¾ƒå¤§çš„æ ·æœ¬é›†ä¸Šï¼ŒRFæ¨¡å‹å®¹æ˜“é™·å…¥è¿‡æ‹Ÿåˆã€‚ å–å€¼åˆ’åˆ†æ¯”è¾ƒå¤šçš„ç‰¹å¾å®¹æ˜“å¯¹RFçš„å†³ç­–äº§ç”Ÿæ›´å¤§çš„å½±å“ï¼Œä»è€Œå½±å“æ‹Ÿåˆçš„æ¨¡å‹çš„æ•ˆæœã€‚ ä¸‹é¢çœ‹å‡ ä¸ªé¢è¯•é—®é¢˜ï¼š\n1ã€ä¸ºä»€ä¹ˆè¦æœ‰æ”¾å›çš„æŠ½æ ·ï¼Ÿä¿è¯æ ·æœ¬é›†é—´æœ‰é‡å ï¼Œè‹¥ä¸æ”¾å›ï¼Œæ¯ä¸ªè®­ç»ƒæ ·æœ¬é›†åŠå…¶åˆ†å¸ƒéƒ½ä¸ä¸€æ ·ï¼Œå¯èƒ½å¯¼è‡´è®­ç»ƒçš„å„å†³ç­–æ ‘å·®å¼‚æ€§å¾ˆå¤§ï¼Œæœ€ç»ˆå¤šæ•°è¡¨å†³æ— æ³• â€œæ±‚åŒâ€ï¼Œå³æœ€ç»ˆå¤šæ•°è¡¨å†³ç›¸å½“äºâ€œæ±‚åŒâ€è¿‡ç¨‹ã€‚\n2ã€ä¸ºä»€ä¹ˆRFçš„è®­ç»ƒæ•ˆç‡ä¼˜äºbaggingï¼Ÿå› ä¸ºåœ¨ä¸ªä½“å†³ç­–æ ‘çš„æ„å»ºè¿‡ç¨‹ä¸­ï¼ŒBaggingä½¿ç”¨çš„æ˜¯â€œç¡®å®šå‹â€å†³ç­–æ ‘ï¼Œbaggingåœ¨é€‰æ‹©åˆ’åˆ†å±æ€§æ—¶è¦å¯¹æ¯æ£µæ ‘æ˜¯å¯¹æ‰€æœ‰ç‰¹å¾è¿›è¡Œè€ƒå¯Ÿï¼›è€Œéšæœºæ£®æ—ä»…ä»…è€ƒè™‘ä¸€ä¸ªç‰¹å¾å­é›†ã€‚\n3ã€éšæœºæ£®æ—éœ€è¦å‰ªæå—ï¼Ÿä¸éœ€è¦ï¼Œåå‰ªææ˜¯ä¸ºäº†é¿å…è¿‡æ‹Ÿåˆï¼Œéšæœºæ£®æ—éšæœºé€‰æ‹©å˜é‡ä¸æ ‘çš„æ•°é‡ï¼Œå·²ç»é¿å…äº†è¿‡æ‹Ÿåˆï¼Œæ²¡å¿…è¦å»å‰ªæäº†ã€‚ä¸€èˆ¬rfè¦æ§åˆ¶çš„æ˜¯æ ‘çš„è§„æ¨¡ï¼Œè€Œä¸æ˜¯æ ‘çš„ç½®ä¿¡åº¦ï¼Œå‰©ä¸‹çš„æ¯æ£µæ ‘éœ€è¦åšçš„å°±æ˜¯å°½å¯èƒ½çš„åœ¨è‡ªå·±æ‰€å¯¹åº”çš„æ•°æ®(ç‰¹å¾)é›†æƒ…å†µä¸‹å°½å¯èƒ½çš„åšåˆ°æœ€å¥½çš„é¢„æµ‹ç»“æœã€‚å‰ªæçš„ä½œç”¨å…¶å®è¢«é›†æˆæ–¹æ³•æ¶ˆè§£äº†ï¼Œæ‰€ä»¥ç”¨å¤„ä¸å¤§ã€‚\nExtra-TreeåŠå…¶ä¸RFçš„åŒºåˆ« Extra-Treeæ˜¯éšæœºæ£®æ—çš„ä¸€ä¸ªå˜ç§, åŸç†å‡ ä¹å’Œéšæœºæ£®æ—ä¸€æ¨¡ä¸€æ ·ï¼Œå¯ä»¥ç§°ä¸ºï¼šâ€œæå…¶éšæœºæ£®æ—â€ï¼Œå³å†³ç­–æ ‘åœ¨èŠ‚ç‚¹çš„åˆ’åˆ†ä¸Šï¼Œä½¿ç”¨éšæœºçš„ç‰¹å¾å’Œéšæœºçš„é˜ˆå€¼ã€‚\nç‰¹å¾å’Œé˜ˆå€¼æä¾›äº†é¢å¤–éšæœºæ€§ï¼ŒæŠ‘åˆ¶äº†è¿‡æ‹Ÿåˆï¼Œå†ä¸€æ¬¡ç”¨é«˜åå·®æ¢ä½æ–¹å·®ã€‚å®ƒè¿˜ä½¿å¾— Extra-Tree æ¯”è§„åˆ™çš„éšæœºæ£®æ—æ›´å¿«åœ°è®­ç»ƒï¼Œå› ä¸ºåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ‰¾åˆ°æ¯ä¸ªç‰¹å¾çš„æœ€ä½³é˜ˆå€¼æ˜¯ç”Ÿé•¿æ ‘æœ€è€—æ—¶çš„ä»»åŠ¡ä¹‹ä¸€ã€‚\nExtra-Treeä¸éšæœºæ£®æ—çš„åŒºåˆ«æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š\nå¯¹äºæ¯ä¸ªå†³ç­–æ ‘çš„è®­ç»ƒé›†ï¼Œéšæœºæ£®æ—é‡‡ç”¨çš„æ˜¯éšæœºé‡‡æ ·bootstrapæ¥é€‰æ‹©é‡‡æ ·é›†ä½œä¸ºæ¯ä¸ªå†³ç­–æ ‘çš„è®­ç»ƒé›†ï¼Œè€ŒExtra-Treeä¸€èˆ¬ä¸é‡‡ç”¨éšæœºé‡‡æ ·ï¼Œå³æ¯ä¸ªå†³ç­–æ ‘é‡‡ç”¨åŸå§‹è®­ç»ƒé›†ã€‚ åœ¨é€‰å®šäº†åˆ’åˆ†ç‰¹å¾åï¼Œéšæœºæ£®æ—çš„å†³ç­–æ ‘ä¼šåŸºäºåŸºå°¼ç³»æ•°ï¼Œå‡æ–¹å·®ä¹‹ç±»çš„åŸåˆ™ï¼Œé€‰æ‹©ä¸€ä¸ªæœ€ä¼˜çš„ç‰¹å¾å€¼åˆ’åˆ†ç‚¹ï¼Œè¿™å’Œä¼ ç»Ÿçš„å†³ç­–æ ‘ç›¸åŒã€‚ä½†æ˜¯Extra-Treeæ¯”è¾ƒçš„æ¿€è¿›ï¼Œä»–ä¼šéšæœºçš„é€‰æ‹©ä¸€ä¸ªç‰¹å¾å€¼æ¥åˆ’åˆ†å†³ç­–æ ‘ã€‚ ä»ç¬¬äºŒç‚¹å¯ä»¥çœ‹å‡ºï¼Œç”±äºéšæœºé€‰æ‹©äº†ç‰¹å¾å€¼çš„åˆ’åˆ†ç‚¹ä½ï¼Œè€Œä¸æ˜¯æœ€ä¼˜ç‚¹ä½ï¼Œè¿™æ ·ä¼šå¯¼è‡´ç”Ÿæˆçš„å†³ç­–æ ‘çš„è§„æ¨¡ä¸€èˆ¬ä¼šå¤§äºéšæœºæ£®æ—æ‰€ç”Ÿæˆçš„å†³ç­–æ ‘ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¨¡å‹çš„æ–¹å·®ç›¸å¯¹äºéšæœºæ£®æ—è¿›ä¸€æ­¥å‡å°‘ï¼Œä½†æ˜¯åå€šç›¸å¯¹äºéšæœºæ£®æ—è¿›ä¸€æ­¥å¢å¤§ã€‚åœ¨æŸäº›æ—¶å€™ï¼ŒExtra-Treeçš„æ³›åŒ–èƒ½åŠ›æ¯”éšæœºæ£®æ—æ›´å¥½ã€‚\nRFè¯„ä¼°ç‰¹å¾é‡è¦æ€§ åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ä¼šå…³ç³»å¦‚ä½•åœ¨é«˜ç»´æ•°æ®ä¸­é€‰æ‹©å¯¹ç»“æœå½±å“æœ€å¤§çš„å‰nä¸ªç‰¹å¾ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨PCAã€LASSOç­‰æ–¹æ³•ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨RFç®—æ³•æ¥è¿›è¡Œç‰¹å¾é€‰æ‹©ã€‚æ„Ÿå…´è¶£çš„è¯ã€‚\nRFç®—æ³•çš„æœ‰ä¸€ä¸ªå…¸å‹çš„åº”ç”¨ï¼šè¯„ä¼°å•ä¸ªç‰¹å¾å˜é‡çš„é‡è¦æ€§å¹¶è¿›è¡Œç‰¹å¾é€‰æ‹©ã€‚\nä¸¾ä¸€ä¸ªå…·ä½“çš„åº”ç”¨åœºæ™¯ï¼šé“¶è¡Œè´·æ¬¾ä¸šåŠ¡ä¸­èƒ½å¦æ­£ç¡®çš„è¯„ä¼°ä¼ä¸šçš„ä¿¡ç”¨åº¦ï¼Œå…³ç³»åˆ°èƒ½å¦æœ‰æ•ˆåœ°å›æ”¶è´·æ¬¾ã€‚ä½†æ˜¯ä¿¡ç”¨è¯„ä¼°æ¨¡å‹çš„æ•°æ®ç‰¹å¾æœ‰å¾ˆå¤šï¼Œå…¶ä¸­ä¸ä¹æœ‰å¾ˆå¤šå™ªéŸ³ï¼Œæ‰€ä»¥éœ€è¦è®¡ç®—å‡ºæ¯ä¸€ä¸ªç‰¹å¾çš„é‡è¦æ€§å¹¶å¯¹è¿™äº›ç‰¹å¾è¿›è¡Œä¸€ä¸ªæ’åºï¼Œè¿›è€Œå¯ä»¥ä»æ‰€æœ‰ç‰¹å¾ä¸­é€‰æ‹©å‡ºé‡è¦æ€§é å‰çš„ç‰¹å¾ã€‚\nä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¯„ä¼°ç‰¹å¾é‡è¦æ€§çš„æ­¥éª¤ï¼š\nå¯¹äºRFä¸­çš„æ¯ä¸€æ£µå†³ç­–æ ‘ï¼Œé€‰æ‹©OOBæ•°æ®è®¡ç®—æ¨¡å‹çš„é¢„æµ‹é”™è¯¯ç‡ï¼Œè®°ä¸ºError1ã€‚ï¼ˆåœ¨éšæœºæ£®æ—ç®—æ³•ä¸­ä¸éœ€è¦å†è¿›è¡Œäº¤å‰éªŒè¯æ¥è·å–æµ‹è¯•é›†è¯¯å·®çš„æ— åä¼°è®¡ï¼‰\nç„¶ååœ¨OOBä¸­æ‰€æœ‰æ ·æœ¬çš„ç‰¹å¾Aä¸ŠåŠ å…¥éšæœºå™ªå£°ï¼Œæ¥ç€å†æ¬¡ç”¨OOBæ•°æ®è®¡ç®—æ¨¡å‹é¢„æµ‹é”™è¯¯ç‡ï¼Œè®°ä¸ºError2ã€‚\nè‹¥æ£®æ—ä¸­æœ‰Næ£µæ ‘ï¼Œåˆ™ç‰¹å¾Açš„é‡è¦æ€§ä¸º æ±‚å’Œ(Error2-Error1/N)ã€‚\næˆ‘ä»¬ç»†å“ï¼šåœ¨æŸä¸€ç‰¹å¾Aä¸Šå¢åŠ äº†å™ªéŸ³ï¼Œé‚£ä¹ˆå°±æœ‰ç†ç”±ç›¸ä¿¡é”™è¯¯ç‡Error2è¦å¤§äºError1ï¼ŒError2è¶Šå¤§è¯´æ˜ç‰¹å¾Aé‡è¦ã€‚\nå¯ä»¥è¿™ä¹ˆç†è§£ï¼Œå°Aä»å…¬å¸ç¦»èŒäº†ï¼Œè¿™ä¸ªå…¬å¸å€’é—­äº†ï¼Œè¯´æ˜å°Aå¾ˆé‡è¦ï¼›å¦‚æœå°Aèµ°äº†ï¼Œå…¬å¸æ²¡å˜åŒ–ï¼Œè¯´æ˜å°Aä¹Ÿæ²¡å•¥ç”¨ã€‚\nåœ¨sklearnä¸­æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼š\n1 2 3 4 5 6 7 8 from sklearn.cross_validation import train_test_split from sklearn.ensemble import RandomForestClassifier (å¤„ç†æ•°æ®) rf_clf = RandomForestClassifier(n_estimators=1000, random_state=666) rf_clf.","title":"éšæœºæ£®æ—ç®—æ³•åŠå…¶åœ¨ç‰¹å¾é€‰æ‹©ä¸­çš„åº”ç”¨"},{"content":"ä»€ä¹ˆæ˜¯ç”Ÿæˆæ¨¡å‹å’Œåˆ¤åˆ«æ¨¡å‹ï¼Ÿ ä»æœ¬è´¨ä¸Šè®²ï¼Œç”Ÿæˆæ¨¡å‹å’Œåˆ¤åˆ«æ¨¡å‹æ˜¯è§£å†³åˆ†ç±»é—®é¢˜çš„ä¸¤ç±»åŸºæœ¬æ€è·¯ã€‚é¦–å…ˆï¼Œæ‚¨å¾—å…ˆäº†è§£ï¼Œåˆ†ç±»é—®é¢˜ï¼Œå°±æ˜¯ç»™å®šä¸€ä¸ªæ•°æ®xï¼Œè¦åˆ¤æ–­å®ƒå¯¹åº”çš„æ ‡ç­¾yï¼ˆè¿™ä¹ˆnaiveçš„ä¸œè¥¿éƒ½è¦è§£é‡Šä¸‹ï¼Œæ±‚é¢è¯•å®˜æ­¤æ—¶å†…å¿ƒçš„é˜´å½±é¢ç§¯ï¼Œå˜å˜ï¼‰ã€‚ç”Ÿæˆæ¨¡å‹å°±æ˜¯è¦å­¦ä¹ xå’Œyçš„è”åˆæ¦‚ç‡åˆ†å¸ƒP(x,y)ï¼Œç„¶åæ ¹æ®è´å¶æ–¯å…¬å¼æ¥æ±‚å¾—æ¡ä»¶æ¦‚ç‡P(y|x)ï¼Œé¢„æµ‹æ¡ä»¶æ¦‚ç‡æœ€å¤§çš„yã€‚è´å¶æ–¯å…¬å¼è¿™ä¹ˆç®€å•çš„çŸ¥è¯†ç›¸ä¿¡æ‚¨ä¹Ÿäº†è§£ï¼Œæˆ‘å°±ä¸å•°å—¦äº†ã€‚åˆ¤åˆ«æ¨¡å‹å°±æ˜¯ç›´æ¥å­¦ä¹ æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒP(y|x)ã€‚\nä¸¾ä¸ªæ —å­ ä¾‹å­1 å‡è®¾ä½ ä»æ¥æ²¡æœ‰è§è¿‡å¤§è±¡å’ŒçŒ«ï¼Œè¿å¬éƒ½æ²¡æœ‰å¬è¿‡ï¼Œè¿™æ—¶ï¼Œç»™ä½ çœ‹äº†ä¸€å¼ å¤§è±¡çš„ç…§ç‰‡å’Œä¸€å¼ çŒ«çš„ç…§ç‰‡ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š\nç„¶åç‰µæ¥æˆ‘å®¶çš„å¤§è±¡ï¼ˆé¢è¯•å®˜ï¼šä½ å®¶å¼€åŠ¨ç‰©å›­çš„å—ï¼Ÿï¼‰ï¼Œè®©ä½ åˆ¤æ–­è¿™æ˜¯å¤§è±¡è¿˜æ˜¯çŒ«ã€‚ä½ å’‹åŠï¼Ÿ\nä½ å¼€å§‹å›æƒ³åˆšåˆšçœ‹è¿‡çš„ç…§ç‰‡ï¼Œå¤§æ¦‚è®°èµ·æ¥ï¼Œå¤§è±¡å’ŒçŒ«æ¯”èµ·æ¥ï¼Œæœ‰ä¸ªé•¿é¼»å­ï¼Œè€Œçœ¼å‰è¿™ä¸ªå®¶ä¼™ä¹Ÿæœ‰ä¸ªé•¿é¼»å­ï¼Œæ‰€ä»¥ï¼Œä½ å…´å¥‹åœ°è¯´ï¼šâ€œè¿™æ˜¯å¤§è±¡ï¼â€æ­å–œä½ ç­”å¯¹äº†ï¼\nä½ ä¹Ÿæœ‰å¯èƒ½è¿™æ ·åšï¼Œä½ åŠªåŠ›å›æƒ³åˆšæ‰çš„ä¸¤å¼ ç…§ç‰‡ï¼Œç„¶åç”¨ç¬”æŠŠå®ƒä»¬ç”»åœ¨äº†çº¸ä¸Šï¼Œæ‹¿ç€çº¸å’Œæˆ‘å®¶çš„å¤§è±¡åšæ¯”è¾ƒï¼Œä½ å‘ç°ï¼Œçœ¼å‰çš„åŠ¨ç‰©æ›´åƒæ˜¯å¤§è±¡ã€‚äºæ˜¯ï¼Œä½ æƒŠå–œåœ°å®£å¸ƒï¼šâ€œè¿™ç©æ„æ˜¯å¤§è±¡ï¼â€æ­å–œä½ åˆç­”å¯¹äº†ï¼\nåœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œç¬¬ä¸€ä¸ªè§£å†³é—®é¢˜çš„æ€è·¯å°±æ˜¯åˆ¤åˆ«æ¨¡å‹ï¼Œå› ä¸ºä½ åªè®°ä½äº†å¤§è±¡å’ŒçŒ«ä¹‹é—´çš„ä¸åŒä¹‹å¤„ã€‚ç¬¬äºŒä¸ªè§£å†³é—®é¢˜çš„æ€è·¯å°±æ˜¯ç”Ÿæˆæ¨¡å‹ï¼Œå› ä¸ºä½ å®é™…ä¸Šå­¦ä¹ äº†ä»€ä¹ˆæ˜¯å¤§è±¡ï¼Œä»€ä¹ˆæ˜¯çŒ«ã€‚\nä¾‹å­2 æ¥æ¥æ¥ï¼Œçœ‹ä¸€ä¸‹è¿™å››ä¸ªå½¢å¼ä¸º(x,y)çš„æ ·æœ¬ã€‚(1,0), (1,0), (2,0), (2, 1ï¼‰ã€‚å‡è®¾ï¼Œæˆ‘ä»¬æƒ³ä»è¿™å››ä¸ªæ ·æœ¬ä¸­ï¼Œå­¦ä¹ åˆ°å¦‚ä½•é€šè¿‡xåˆ¤æ–­yçš„æ¨¡å‹ã€‚ç”¨ç”Ÿæˆæ¨¡å‹ï¼Œæˆ‘ä»¬è¦å­¦ä¹ P(x,y)ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š\næˆ‘ä»¬å­¦ä¹ åˆ°äº†å››ä¸ªæ¦‚ç‡å€¼ï¼Œå®ƒä»¬çš„å’Œæ˜¯1ï¼Œè¿™å°±æ˜¯P(x,y)ã€‚\næˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨åˆ¤åˆ«æ¨¡å‹ï¼Œæˆ‘ä»¬è¦å­¦ä¹ P(y|x)ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\næˆ‘ä»¬åŒæ ·å­¦ä¹ åˆ°äº†å››ä¸ªæ¦‚ç‡å€¼ï¼Œä½†æ˜¯ï¼Œè¿™æ¬¡ï¼Œæ˜¯æ¯ä¸€è¡Œçš„ä¸¤ä¸ªæ¦‚ç‡å€¼çš„å’Œä¸º1äº†ã€‚è®©æˆ‘ä»¬å…·ä½“æ¥çœ‹ä¸€ä¸‹ï¼Œå¦‚ä½•ä½¿ç”¨è¿™ä¸¤ä¸ªæ¨¡å‹åšåˆ¤æ–­ã€‚\nå‡è®¾ x=1ã€‚\nå¯¹äºç”Ÿæˆæ¨¡å‹ï¼Œ æˆ‘ä»¬ä¼šæ¯”è¾ƒï¼š\nP(x=1,y=0) = 1/2 P(x=1,y=1) = 0 æˆ‘ä»¬å‘ç°P(x=1,y=0)çš„æ¦‚ç‡è¦æ¯”P(x=1,y=1)çš„æ¦‚ç‡å¤§ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åˆ¤æ–­ï¼šx=1æ—¶ï¼Œy=0ã€‚\nå¯¹äºåˆ¤åˆ«æ¨¡å‹ï¼Œæˆ‘ä»¬ä¼šæ¯”è¾ƒï¼š\nP(y=0|x=1) = 1 P(y=1|x=1) = 0 åŒæ ·ï¼ŒP(y=0|x=1)è¦æ¯”P(y=1|x=1)å¤§ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åˆ¤æ–­ï¼šx=1æ—¶ï¼Œy=0ã€‚\næˆ‘ä»¬çœ‹åˆ°ï¼Œè™½ç„¶æœ€åé¢„æµ‹çš„ç»“æœä¸€æ ·ï¼Œä½†æ˜¯å¾—å‡ºç»“æœçš„é€»è¾‘å´æ˜¯å®Œå…¨ä¸åŒçš„ã€‚ä¸¤ä¸ªæ —å­è¯´å®Œï¼Œä½ å¿ƒé‡Œæ„Ÿåˆ°å¾ˆç—›å¿«ï¼Œé¢è¯•å®˜è„¸ä¸Šä¹Ÿéœ²å‡ºäº†èµèµçš„å¾®ç¬‘ï¼Œä½†æ˜¯ï¼Œä»–çªç„¶é—®äº†ä¸€ä¸ªé—®é¢˜ã€‚\nç”Ÿæˆæ¨¡å‹ä¸ºå•¥å«ç”Ÿæˆæ¨¡å‹ è¿™ä¸ªé—®é¢˜ç€å®è®©ä½ æ²¡æƒ³åˆ°ï¼Œä¸è¿‡ï¼Œèªæ˜çš„ä½ ç•¥åŠ æ€è€ƒï¼Œåº”è¯¥å°±å¯ä»¥æƒ³åˆ°ã€‚ç”Ÿæˆæ¨¡å‹ä¹‹æ‰€ä»¥å«ç”Ÿæˆæ¨¡å‹ï¼Œæ˜¯å› ä¸ºï¼Œå®ƒèƒŒåçš„æ€æƒ³æ˜¯ï¼Œxæ˜¯ç‰¹å¾ï¼Œyæ˜¯æ ‡ç­¾ï¼Œä»€ä¹ˆæ ·çš„æ ‡ç­¾å°±ä¼šç”Ÿæˆä»€ä¹ˆæ ·çš„ç‰¹å¾ã€‚å¥½æ¯”è¯´ï¼Œæ ‡ç­¾æ˜¯å¤§è±¡ï¼Œé‚£ä¹ˆå¯èƒ½ç”Ÿæˆçš„ç‰¹å¾å°±æœ‰å¤§è€³æœµï¼Œé•¿é¼»å­ç­‰ç­‰ã€‚\nå½“æˆ‘ä»¬æ¥æ ¹æ®xæ¥åˆ¤æ–­yæ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨æ¯”è¾ƒï¼Œä»€ä¹ˆæ ·çš„yæ ‡ç­¾æ›´å¯èƒ½ç”Ÿæˆç‰¹å¾xï¼Œæˆ‘ä»¬é¢„æµ‹çš„ç»“æœå°±æ˜¯æ›´å¯èƒ½ç”Ÿæˆxç‰¹å¾çš„yæ ‡ç­¾ã€‚\nå¸¸è§çš„ç”Ÿæˆæ¨¡å‹å’Œåˆ¤åˆ«æ¨¡å‹æœ‰å“ªäº›å‘¢ ç”Ÿæˆæ¨¡å‹\nHMM\næœ´ç´ è´å¶æ–¯\nåˆ¤åˆ«æ¨¡å‹\né€»è¾‘å›å½’\nSVM\nCRF\næœ€è¿‘é‚»\nä¸€èˆ¬çš„ç¥ç»ç½‘ç»œ\n","permalink":"https://reid00.github.io/en/posts/ml/%E7%94%9F%E6%88%90%E6%A8%A1%E5%9E%8Bvs%E5%88%A4%E5%88%AB%E6%A8%A1%E5%9E%8B/","summary":"ä»€ä¹ˆæ˜¯ç”Ÿæˆæ¨¡å‹å’Œåˆ¤åˆ«æ¨¡å‹ï¼Ÿ ä»æœ¬è´¨ä¸Šè®²ï¼Œç”Ÿæˆæ¨¡å‹å’Œåˆ¤åˆ«æ¨¡å‹æ˜¯è§£å†³åˆ†ç±»é—®é¢˜çš„ä¸¤ç±»åŸºæœ¬æ€è·¯ã€‚é¦–å…ˆï¼Œæ‚¨å¾—å…ˆäº†è§£ï¼Œåˆ†ç±»é—®é¢˜ï¼Œå°±æ˜¯ç»™å®šä¸€ä¸ªæ•°æ®xï¼Œè¦åˆ¤æ–­å®ƒå¯¹åº”çš„æ ‡ç­¾yï¼ˆè¿™ä¹ˆnaiveçš„ä¸œè¥¿éƒ½è¦è§£é‡Šä¸‹ï¼Œæ±‚é¢è¯•å®˜æ­¤æ—¶å†…å¿ƒçš„é˜´å½±é¢ç§¯ï¼Œå˜å˜ï¼‰ã€‚ç”Ÿæˆæ¨¡å‹å°±æ˜¯è¦å­¦ä¹ xå’Œyçš„è”åˆæ¦‚ç‡åˆ†å¸ƒP(x,y)ï¼Œç„¶åæ ¹æ®è´å¶æ–¯å…¬å¼æ¥æ±‚å¾—æ¡ä»¶æ¦‚ç‡P(y|x)ï¼Œé¢„æµ‹æ¡ä»¶æ¦‚ç‡æœ€å¤§çš„yã€‚è´å¶æ–¯å…¬å¼è¿™ä¹ˆç®€å•çš„çŸ¥è¯†ç›¸ä¿¡æ‚¨ä¹Ÿäº†è§£ï¼Œæˆ‘å°±ä¸å•°å—¦äº†ã€‚åˆ¤åˆ«æ¨¡å‹å°±æ˜¯ç›´æ¥å­¦ä¹ æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒP(y|x)ã€‚\nä¸¾ä¸ªæ —å­ ä¾‹å­1 å‡è®¾ä½ ä»æ¥æ²¡æœ‰è§è¿‡å¤§è±¡å’ŒçŒ«ï¼Œè¿å¬éƒ½æ²¡æœ‰å¬è¿‡ï¼Œè¿™æ—¶ï¼Œç»™ä½ çœ‹äº†ä¸€å¼ å¤§è±¡çš„ç…§ç‰‡å’Œä¸€å¼ çŒ«çš„ç…§ç‰‡ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š\nç„¶åç‰µæ¥æˆ‘å®¶çš„å¤§è±¡ï¼ˆé¢è¯•å®˜ï¼šä½ å®¶å¼€åŠ¨ç‰©å›­çš„å—ï¼Ÿï¼‰ï¼Œè®©ä½ åˆ¤æ–­è¿™æ˜¯å¤§è±¡è¿˜æ˜¯çŒ«ã€‚ä½ å’‹åŠï¼Ÿ\nä½ å¼€å§‹å›æƒ³åˆšåˆšçœ‹è¿‡çš„ç…§ç‰‡ï¼Œå¤§æ¦‚è®°èµ·æ¥ï¼Œå¤§è±¡å’ŒçŒ«æ¯”èµ·æ¥ï¼Œæœ‰ä¸ªé•¿é¼»å­ï¼Œè€Œçœ¼å‰è¿™ä¸ªå®¶ä¼™ä¹Ÿæœ‰ä¸ªé•¿é¼»å­ï¼Œæ‰€ä»¥ï¼Œä½ å…´å¥‹åœ°è¯´ï¼šâ€œè¿™æ˜¯å¤§è±¡ï¼â€æ­å–œä½ ç­”å¯¹äº†ï¼\nä½ ä¹Ÿæœ‰å¯èƒ½è¿™æ ·åšï¼Œä½ åŠªåŠ›å›æƒ³åˆšæ‰çš„ä¸¤å¼ ç…§ç‰‡ï¼Œç„¶åç”¨ç¬”æŠŠå®ƒä»¬ç”»åœ¨äº†çº¸ä¸Šï¼Œæ‹¿ç€çº¸å’Œæˆ‘å®¶çš„å¤§è±¡åšæ¯”è¾ƒï¼Œä½ å‘ç°ï¼Œçœ¼å‰çš„åŠ¨ç‰©æ›´åƒæ˜¯å¤§è±¡ã€‚äºæ˜¯ï¼Œä½ æƒŠå–œåœ°å®£å¸ƒï¼šâ€œè¿™ç©æ„æ˜¯å¤§è±¡ï¼â€æ­å–œä½ åˆç­”å¯¹äº†ï¼\nåœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œç¬¬ä¸€ä¸ªè§£å†³é—®é¢˜çš„æ€è·¯å°±æ˜¯åˆ¤åˆ«æ¨¡å‹ï¼Œå› ä¸ºä½ åªè®°ä½äº†å¤§è±¡å’ŒçŒ«ä¹‹é—´çš„ä¸åŒä¹‹å¤„ã€‚ç¬¬äºŒä¸ªè§£å†³é—®é¢˜çš„æ€è·¯å°±æ˜¯ç”Ÿæˆæ¨¡å‹ï¼Œå› ä¸ºä½ å®é™…ä¸Šå­¦ä¹ äº†ä»€ä¹ˆæ˜¯å¤§è±¡ï¼Œä»€ä¹ˆæ˜¯çŒ«ã€‚\nä¾‹å­2 æ¥æ¥æ¥ï¼Œçœ‹ä¸€ä¸‹è¿™å››ä¸ªå½¢å¼ä¸º(x,y)çš„æ ·æœ¬ã€‚(1,0), (1,0), (2,0), (2, 1ï¼‰ã€‚å‡è®¾ï¼Œæˆ‘ä»¬æƒ³ä»è¿™å››ä¸ªæ ·æœ¬ä¸­ï¼Œå­¦ä¹ åˆ°å¦‚ä½•é€šè¿‡xåˆ¤æ–­yçš„æ¨¡å‹ã€‚ç”¨ç”Ÿæˆæ¨¡å‹ï¼Œæˆ‘ä»¬è¦å­¦ä¹ P(x,y)ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š\næˆ‘ä»¬å­¦ä¹ åˆ°äº†å››ä¸ªæ¦‚ç‡å€¼ï¼Œå®ƒä»¬çš„å’Œæ˜¯1ï¼Œè¿™å°±æ˜¯P(x,y)ã€‚\næˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨åˆ¤åˆ«æ¨¡å‹ï¼Œæˆ‘ä»¬è¦å­¦ä¹ P(y|x)ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\næˆ‘ä»¬åŒæ ·å­¦ä¹ åˆ°äº†å››ä¸ªæ¦‚ç‡å€¼ï¼Œä½†æ˜¯ï¼Œè¿™æ¬¡ï¼Œæ˜¯æ¯ä¸€è¡Œçš„ä¸¤ä¸ªæ¦‚ç‡å€¼çš„å’Œä¸º1äº†ã€‚è®©æˆ‘ä»¬å…·ä½“æ¥çœ‹ä¸€ä¸‹ï¼Œå¦‚ä½•ä½¿ç”¨è¿™ä¸¤ä¸ªæ¨¡å‹åšåˆ¤æ–­ã€‚\nå‡è®¾ x=1ã€‚\nå¯¹äºç”Ÿæˆæ¨¡å‹ï¼Œ æˆ‘ä»¬ä¼šæ¯”è¾ƒï¼š\nP(x=1,y=0) = 1/2 P(x=1,y=1) = 0 æˆ‘ä»¬å‘ç°P(x=1,y=0)çš„æ¦‚ç‡è¦æ¯”P(x=1,y=1)çš„æ¦‚ç‡å¤§ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åˆ¤æ–­ï¼šx=1æ—¶ï¼Œy=0ã€‚\nå¯¹äºåˆ¤åˆ«æ¨¡å‹ï¼Œæˆ‘ä»¬ä¼šæ¯”è¾ƒï¼š\nP(y=0|x=1) = 1 P(y=1|x=1) = 0 åŒæ ·ï¼ŒP(y=0|x=1)è¦æ¯”P(y=1|x=1)å¤§ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åˆ¤æ–­ï¼šx=1æ—¶ï¼Œy=0ã€‚\næˆ‘ä»¬çœ‹åˆ°ï¼Œè™½ç„¶æœ€åé¢„æµ‹çš„ç»“æœä¸€æ ·ï¼Œä½†æ˜¯å¾—å‡ºç»“æœçš„é€»è¾‘å´æ˜¯å®Œå…¨ä¸åŒçš„ã€‚ä¸¤ä¸ªæ —å­è¯´å®Œï¼Œä½ å¿ƒé‡Œæ„Ÿåˆ°å¾ˆç—›å¿«ï¼Œé¢è¯•å®˜è„¸ä¸Šä¹Ÿéœ²å‡ºäº†èµèµçš„å¾®ç¬‘ï¼Œä½†æ˜¯ï¼Œä»–çªç„¶é—®äº†ä¸€ä¸ªé—®é¢˜ã€‚\nç”Ÿæˆæ¨¡å‹ä¸ºå•¥å«ç”Ÿæˆæ¨¡å‹ è¿™ä¸ªé—®é¢˜ç€å®è®©ä½ æ²¡æƒ³åˆ°ï¼Œä¸è¿‡ï¼Œèªæ˜çš„ä½ ç•¥åŠ æ€è€ƒï¼Œåº”è¯¥å°±å¯ä»¥æƒ³åˆ°ã€‚ç”Ÿæˆæ¨¡å‹ä¹‹æ‰€ä»¥å«ç”Ÿæˆæ¨¡å‹ï¼Œæ˜¯å› ä¸ºï¼Œå®ƒèƒŒåçš„æ€æƒ³æ˜¯ï¼Œxæ˜¯ç‰¹å¾ï¼Œyæ˜¯æ ‡ç­¾ï¼Œä»€ä¹ˆæ ·çš„æ ‡ç­¾å°±ä¼šç”Ÿæˆä»€ä¹ˆæ ·çš„ç‰¹å¾ã€‚å¥½æ¯”è¯´ï¼Œæ ‡ç­¾æ˜¯å¤§è±¡ï¼Œé‚£ä¹ˆå¯èƒ½ç”Ÿæˆçš„ç‰¹å¾å°±æœ‰å¤§è€³æœµï¼Œé•¿é¼»å­ç­‰ç­‰ã€‚\nå½“æˆ‘ä»¬æ¥æ ¹æ®xæ¥åˆ¤æ–­yæ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨æ¯”è¾ƒï¼Œä»€ä¹ˆæ ·çš„yæ ‡ç­¾æ›´å¯èƒ½ç”Ÿæˆç‰¹å¾xï¼Œæˆ‘ä»¬é¢„æµ‹çš„ç»“æœå°±æ˜¯æ›´å¯èƒ½ç”Ÿæˆxç‰¹å¾çš„yæ ‡ç­¾ã€‚\nå¸¸è§çš„ç”Ÿæˆæ¨¡å‹å’Œåˆ¤åˆ«æ¨¡å‹æœ‰å“ªäº›å‘¢ ç”Ÿæˆæ¨¡å‹\nHMM\næœ´ç´ è´å¶æ–¯\nåˆ¤åˆ«æ¨¡å‹\né€»è¾‘å›å½’\nSVM\nCRF\næœ€è¿‘é‚»\nä¸€èˆ¬çš„ç¥ç»ç½‘ç»œ","title":"ç”Ÿæˆæ¨¡å‹vsåˆ¤åˆ«æ¨¡å‹"},{"content":"ä»‹ç» ç§°å‡½æ•°ä¸ºæ•ˆç”¨å‡½æ•° çº¿æ€§å›å½’æ¨¡å‹çœ‹èµ·æ¥éå¸¸ç®€å•ï¼Œç®€å•åˆ°è®©äººæ€€ç–‘å…¶æ˜¯å¦æœ‰ç ”ç©¶ä»·å€¼ä»¥åŠä½¿ç”¨ä»·å€¼ã€‚ä½†å®é™…ä¸Šï¼Œçº¿æ€§å›å½’æ¨¡å‹å¯ä»¥è¯´æ˜¯æœ€é‡è¦çš„æ•°å­¦æ¨¡å‹ä¹‹ä¸€ï¼Œå¾ˆå¤šæ¨¡å‹éƒ½æ˜¯å»ºç«‹åœ¨å®ƒçš„åŸºç¡€ä¹‹ä¸Šï¼Œå¯ä»¥è¢«ç§°ä¸ºæ˜¯â€œæ¨¡å‹ä¹‹æ¯â€ã€‚\n1.1 ä»€ä¹ˆæ˜¯ç®€å•çº¿æ€§å›å½’ æ‰€è°“ç®€å•ï¼Œæ˜¯æŒ‡åªæœ‰ä¸€ä¸ªæ ·æœ¬ç‰¹å¾ï¼Œå³åªæœ‰ä¸€ä¸ªè‡ªå˜é‡ï¼›æ‰€è°“çº¿æ€§ï¼Œæ˜¯æŒ‡æ–¹ç¨‹æ˜¯çº¿æ€§çš„ï¼›æ‰€è°“å›å½’ï¼Œæ˜¯æŒ‡ç”¨æ–¹ç¨‹æ¥æ¨¡æ‹Ÿå˜é‡ä¹‹é—´æ˜¯å¦‚ä½•å…³è”çš„ã€‚\nç®€å•çº¿æ€§å›å½’ï¼Œå…¶æ€æƒ³ç®€å•ï¼Œå®ç°å®¹æ˜“ï¼ˆä¸å…¶èƒŒåå¼ºå¤§çš„æ•°å­¦æ€§è´¨ç›¸å…³ã€‚åŒæ—¶ä¹Ÿæ˜¯è®¸å¤šå¼ºå¤§çš„éçº¿æ€§æ¨¡å‹ï¼ˆå¤šé¡¹å¼å›å½’ã€é€»è¾‘å›å½’ã€SVMï¼‰çš„åŸºç¡€ã€‚å¹¶ä¸”å…¶ç»“æœå…·æœ‰å¾ˆå¥½çš„å¯è§£é‡Šæ€§ã€‚\n1.2 ä¸€ç§åŸºæœ¬æ¨å¯¼æ€ æˆ‘ä»¬æ‰€è°“çš„å»ºæ¨¡è¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªæ¨¡å‹ï¼Œæœ€å¤§ç¨‹åº¦çš„æ‹Ÿåˆæˆ‘ä»¬çš„æ•°æ®ã€‚ åœ¨ç®€å•çº¿å›å½’é—®é¢˜ä¸­ï¼Œæ¨¡å‹å°±æ˜¯æˆ‘ä»¬çš„ç›´çº¿æ–¹ç¨‹ï¼šy = ax + b ã€‚\nè¦æƒ³æœ€å¤§çš„æ‹Ÿåˆæ•°æ®ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯æ‰¾åˆ°æ²¡æœ‰æ‹Ÿåˆçš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯æŸå¤±çš„éƒ¨åˆ†å°½é‡å°ï¼Œå°±æ˜¯æŸå¤±å‡½æ•°ï¼ˆloss functionï¼‰ï¼ˆä¹Ÿæœ‰ç®—æ³•æ˜¯è¡¡é‡æ‹Ÿåˆçš„ç¨‹åº¦ï¼Œç§°å‡½æ•°ä¸ºæ•ˆç”¨å‡½æ•°ï¼ˆutility functionï¼‰ï¼‰ï¼š\nå› æ­¤ï¼Œæ¨å¯¼æ€è·¯ä¸ºï¼š\né€šè¿‡åˆ†æé—®é¢˜ï¼Œç¡®å®šé—®é¢˜çš„æŸå¤±å‡½æ•°æˆ–è€…æ•ˆç”¨å‡½æ•°ï¼› ç„¶åé€šè¿‡æœ€ä¼˜åŒ–æŸå¤±å‡½æ•°æˆ–è€…æ•ˆç”¨å‡½æ•°ï¼Œè·å¾—æœºå™¨å­¦ä¹ çš„æ¨¡å‹ è¿‘ä¹æ‰€æœ‰å‚æ•°å­¦ä¹ ç®—æ³•éƒ½æ˜¯è¿™æ ·çš„å¥—è·¯ï¼ŒåŒºåˆ«æ˜¯æ¨¡å‹ä¸åŒï¼Œå»ºç«‹çš„ç›®æ ‡å‡½æ•°ä¸åŒï¼Œä¼˜åŒ–çš„æ–¹å¼ä¹Ÿä¸åŒã€‚\nå›åˆ°ç®€å•çº¿æ€§å›å½’é—®é¢˜ï¼Œç›®æ ‡ï¼š\nå·²çŸ¥è®­ç»ƒæ•°æ®æ ·æœ¬ã€ ï¼Œæ‰¾åˆ°å’Œçš„å€¼ï¼Œä½¿ å°½å¯èƒ½å°\nè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„æœ€å°äºŒä¹˜æ³•é—®é¢˜ï¼ˆæœ€å°åŒ–è¯¯å·®çš„å¹³æ–¹ï¼‰\né€šè¿‡æœ€å°äºŒä¹˜æ³•å¯ä»¥æ±‚å‡ºaã€bçš„è¡¨è¾¾å¼ï¼š\næœ€å°äºŒä¹˜æ³• 2.1 ç”±æŸå¤±å‡½æ•°å¼•å‡ºä¸€å †â€œé£é™©â€ 2.1.1 æŸå¤±å‡½æ•° åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œæ‰€æœ‰çš„ç®—æ³•æ¨¡å‹å…¶å®éƒ½ä¾èµ–äºæœ€å°åŒ–æˆ–æœ€å¤§åŒ–æŸä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œç›®æ ‡å‡½æ•°â€ã€‚\næœ€å°åŒ–çš„è¿™ç»„å‡½æ•°è¢«ç§°ä¸ºâ€œæŸå¤±å‡½æ•°â€ã€‚ä»€ä¹ˆæ˜¯æŸå¤±å‡½æ•°å‘¢ï¼Ÿ\næŸå¤±å‡½æ•°æè¿°äº†å•ä¸ªæ ·æœ¬é¢„æµ‹å€¼å’ŒçœŸå®å€¼ä¹‹é—´è¯¯å·®çš„ç¨‹åº¦ã€‚ç”¨æ¥åº¦é‡æ¨¡å‹ä¸€æ¬¡é¢„æµ‹çš„å¥½åã€‚\næŸå¤±å‡½æ•°æ˜¯è¡¡é‡é¢„æµ‹æ¨¡å‹é¢„æµ‹æœŸæœ›ç»“æœè¡¨ç°çš„æŒ‡æ ‡ã€‚æŸå¤±å‡½æ•°è¶Šå°ï¼Œæ¨¡å‹çš„é²æ£’æ€§è¶Šå¥½ã€‚ã€‚\nå¸¸ç”¨æŸå¤±å‡½æ•°æœ‰ï¼š\n0-1æŸå¤±å‡½æ•°ï¼šç”¨æ¥è¡¨è¿°åˆ†ç±»é—®é¢˜ï¼Œå½“é¢„æµ‹åˆ†ç±»é”™è¯¯æ—¶ï¼ŒæŸå¤±å‡½æ•°å€¼ä¸º1ï¼Œæ­£ç¡®ä¸º å¹³æ–¹æŸå¤±å‡½æ•°ï¼šç”¨æ¥æè¿°å›å½’é—®é¢˜ï¼Œç”¨æ¥è¡¨ç¤ºè¿ç»­æ€§å˜é‡ï¼Œä¸ºé¢„æµ‹å€¼ä¸çœŸå®å€¼å·®å€¼çš„å¹³æ–¹ã€‚ï¼ˆè¯¯å·®å€¼è¶Šå¤§ã€æƒ©ç½šåŠ›åº¦è¶Šå¼ºï¼Œä¹Ÿå°±æ˜¯å¯¹å·®å€¼æ•æ„Ÿï¼‰\nç»å¯¹æŸå¤±å‡½æ•°ï¼šç”¨åœ¨å›å½’æ¨¡å‹ï¼Œç”¨è·ç¦»çš„ç»å¯¹å€¼æ¥è¡¡é‡ å¯¹æ•°æŸå¤±å‡½æ•°ï¼šæ˜¯é¢„æµ‹å€¼Yå’Œæ¡ä»¶æ¦‚ç‡ä¹‹é—´çš„è¡¡é‡ã€‚äº‹å®ä¸Šï¼Œè¯¥æŸå¤±å‡½æ•°ç”¨åˆ°äº†æå¤§ä¼¼ç„¶ä¼°è®¡çš„æ€æƒ³ã€‚P(Y|X)é€šä¿—çš„è§£é‡Šå°±æ˜¯ï¼šåœ¨å½“å‰æ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œå¯¹äºæ ·æœ¬Xï¼Œå…¶é¢„æµ‹å€¼ä¸ºYï¼Œä¹Ÿå°±æ˜¯é¢„æµ‹æ­£ç¡®çš„æ¦‚ç‡ã€‚ç”±äºæ¦‚ç‡ä¹‹é—´çš„åŒæ—¶æ»¡è¶³éœ€è¦ä½¿ç”¨ä¹˜æ³•ï¼Œä¸ºäº†å°†å…¶è½¬åŒ–ä¸ºåŠ æ³•ï¼Œæˆ‘ä»¬å°†å…¶å–å¯¹æ•°ã€‚æœ€åç”±äºæ˜¯æŸå¤±å‡½æ•°ï¼Œæ‰€ä»¥é¢„æµ‹æ­£ç¡®çš„æ¦‚ç‡è¶Šé«˜ï¼Œå…¶æŸå¤±å€¼åº”è¯¥æ˜¯è¶Šå°ï¼Œå› æ­¤å†åŠ ä¸ªè´Ÿå·å–ä¸ªåã€‚ ä»¥ä¸ŠæŸå¤±å‡½æ•°æ˜¯é’ˆå¯¹äºå•ä¸ªæ ·æœ¬çš„ï¼Œä½†æ˜¯ä¸€ä¸ªè®­ç»ƒæ•°æ®é›†ä¸­å­˜åœ¨Nä¸ªæ ·æœ¬ï¼ŒNä¸ªæ ·æœ¬ç»™å‡ºNä¸ªæŸå¤±ï¼Œå¦‚ä½•è¿›è¡Œé€‰æ‹©å‘¢ï¼Ÿ\nè¿™å°±å¼•å‡ºäº†é£é™©å‡½æ•°ã€‚\n2.1.2 æœŸæœ›é£é™© æœŸæœ›é£é™©æ˜¯æŸå¤±å‡½æ•°çš„æœŸæœ›ï¼Œç”¨æ¥è¡¨è¾¾ç†è®ºä¸Šæ¨¡å‹f(X)å…³äºè”åˆåˆ†å¸ƒP(X,Y)çš„å¹³å‡æ„ä¹‰ä¸‹çš„æŸå¤±ã€‚åˆå«æœŸæœ›æŸå¤±/é£é™©å‡½æ•°ã€‚\n2.1.3 ç»éªŒé£é™© æ¨¡å‹f(X)å…³äºè®­ç»ƒæ•°æ®é›†çš„å¹³å‡æŸå¤±ï¼Œç§°ä¸ºç»éªŒé£é™©æˆ–ç»éªŒæŸå¤±ã€‚\nå…¶å…¬å¼å«ä¹‰ä¸ºï¼šæ¨¡å‹å…³äºè®­ç»ƒé›†çš„å¹³å‡æŸå¤±ï¼ˆæ¯ä¸ªæ ·æœ¬çš„æŸå¤±åŠ èµ·æ¥ï¼Œç„¶åå¹³å‡ä¸€ä¸‹ï¼‰\nç»éªŒé£é™©æœ€å°çš„æ¨¡å‹ä¸ºæœ€ä¼˜æ¨¡å‹ã€‚åœ¨è®­ç»ƒé›†ä¸Šæœ€å°ç»éªŒé£é™©æœ€å°ï¼Œä¹Ÿå°±æ„å‘³ç€é¢„æµ‹å€¼å’ŒçœŸå®å€¼å°½å¯èƒ½æ¥è¿‘ï¼Œæ¨¡å‹çš„æ•ˆæœè¶Šå¥½ã€‚å…¬å¼å«ä¹‰ä¸ºå–è®­ç»ƒæ ·æœ¬é›†ä¸­å¯¹æ•°æŸå¤±å‡½æ•°å¹³å‡å€¼çš„æœ€å°ã€‚\n2.1.4 ç»éªŒé£é™©æœ€å°åŒ–å’Œç»“æ„é£é™©æœ€å°åŒ– æœŸæœ›é£é™©æ˜¯æ¨¡å‹å…³äºè”åˆåˆ†å¸ƒçš„æœŸæœ›æŸå¤±ï¼Œç»éªŒé£é™©æ˜¯æ¨¡å‹å…³äºè®­ç»ƒæ ·æœ¬æ•°æ®é›†çš„å¹³å‡æŸå¤±ã€‚æ ¹æ®å¤§æ•°å®šå¾‹ï¼Œå½“æ ·æœ¬å®¹é‡Nè¶‹äºæ— ç©·æ—¶ï¼Œç»éªŒé£é™©è¶‹äºæœŸæœ›é£é™©ã€‚\nå› æ­¤å¾ˆè‡ªç„¶åœ°æƒ³åˆ°ç”¨ç»éªŒé£é™©å»ä¼°è®¡æœŸæœ›é£é™©ã€‚ä½†æ˜¯ç”±äºè®­ç»ƒæ ·æœ¬ä¸ªæ•°æœ‰é™ï¼Œå¯èƒ½ä¼šå‡ºç°è¿‡åº¦æ‹Ÿåˆçš„é—®é¢˜ï¼Œå³å†³ç­–å‡½æ•°å¯¹äºè®­ç»ƒé›†å‡ ä¹å…¨éƒ¨æ‹Ÿåˆï¼Œä½†æ˜¯å¯¹äºæµ‹è¯•é›†æ‹Ÿåˆæ•ˆæœè¿‡å·®ã€‚å› æ­¤éœ€è¦å¯¹å…¶è¿›è¡ŒçŸ«æ­£ï¼š\nç»“æ„é£é™©æœ€å°åŒ–ï¼šå½“æ ·æœ¬å®¹é‡ä¸å¤§çš„æ—¶å€™ï¼Œç»éªŒé£é™©æœ€å°åŒ–å®¹æ˜“äº§ç”Ÿâ€œè¿‡æ‹Ÿåˆâ€çš„é—®é¢˜ï¼Œä¸ºäº†â€œå‡ç¼“â€è¿‡æ‹Ÿåˆé—®é¢˜ï¼Œæå‡ºäº†ç»“æ„é£é™©æœ€å°ç†è®ºã€‚ç»“æ„é£é™©æœ€å°åŒ–ä¸ºç»éªŒé£é™©ä¸å¤æ‚åº¦åŒæ—¶è¾ƒå°ã€‚ é€šè¿‡å…¬å¼å¯ä»¥çœ‹å‡ºï¼Œç»“æ„é£é™©ï¼šåœ¨ç»éªŒé£é™©ä¸ŠåŠ ä¸Šä¸€ä¸ªæ­£åˆ™åŒ–é¡¹(regularizer)ï¼Œæˆ–è€…å«åšç½šé¡¹(penalty) ã€‚æ­£åˆ™åŒ–é¡¹æ˜¯J(f)æ˜¯å‡½æ•°çš„å¤æ‚åº¦å†ä¹˜ä¸€ä¸ªæƒé‡ç³»æ•°ï¼ˆç”¨ä»¥æƒè¡¡ç»éªŒé£é™©å’Œå¤æ‚åº¦ï¼‰\n2.1.5 å°ç»“ 1ã€æŸå¤±å‡½æ•°ï¼šå•ä¸ªæ ·æœ¬é¢„æµ‹å€¼å’ŒçœŸå®å€¼ä¹‹é—´è¯¯å·®çš„ç¨‹åº¦ã€‚\n2ã€æœŸæœ›é£é™©ï¼šæ˜¯æŸå¤±å‡½æ•°çš„æœŸæœ›ï¼Œç†è®ºä¸Šæ¨¡å‹f(X)å…³äºè”åˆåˆ†å¸ƒP(X,Y)çš„å¹³å‡æ„ä¹‰ä¸‹çš„æŸå¤±ã€‚\n3ã€ç»éªŒé£é™©ï¼šæ¨¡å‹å…³äºè®­ç»ƒé›†çš„å¹³å‡æŸå¤±ï¼ˆæ¯ä¸ªæ ·æœ¬çš„æŸå¤±åŠ èµ·æ¥ï¼Œç„¶åå¹³å‡ä¸€ä¸‹ï¼‰ã€‚\n4ã€ç»“æ„é£é™©ï¼šåœ¨ç»éªŒé£é™©ä¸ŠåŠ ä¸Šä¸€ä¸ªæ­£åˆ™åŒ–é¡¹ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆçš„ç­–ç•¥ã€‚\n2.2 æœ€å°äºŒä¹˜æ³• 2.2.1 ä»€ä¹ˆæ˜¯æœ€å°äºŒä¹˜æ³• è¨€å½’æ­£ä¼ ï¼Œè¿›å…¥æœ€å°äºŒä¹˜æ³•çš„éƒ¨åˆ†ã€‚\nå¤§åé¼é¼çš„æœ€å°äºŒä¹˜æ³•ï¼Œè™½ç„¶å¬ä¸Šå»æŒºé«˜å¤§ä¸Šï¼Œä½†æ˜¯æ€æƒ³è¿˜æ˜¯æŒºæœ´ç´ çš„ï¼Œç¬¦åˆå¤§å®¶çš„ç›´è§‰ã€‚\næœ€å°äºŒä¹˜æ³•æºäºæ³•å›½æ•°å­¦å®¶é˜¿å¾·é‡Œå®‰çš„çŒœæƒ³ï¼š\nå¯¹äºæµ‹é‡å€¼æ¥è¯´ï¼Œè®©æ€»çš„è¯¯å·®çš„å¹³æ–¹æœ€å°çš„å°±æ˜¯çœŸå®å€¼ã€‚è¿™æ˜¯åŸºäºï¼Œå¦‚æœè¯¯å·®æ˜¯éšæœºçš„ï¼Œåº”è¯¥å›´ç»•çœŸå€¼ä¸Šä¸‹æ³¢åŠ¨ã€‚\nå³ï¼š\né‚£ä¹ˆä¸ºäº†æ±‚å‡ºè¿™ä¸ªäºŒæ¬¡å‡½æ•°çš„æœ€å°å€¼ï¼Œå¯¹å…¶è¿›è¡Œæ±‚å¯¼ï¼Œå¯¼æ•°ä¸º0çš„æ—¶å€™å–å¾—æœ€å°å€¼ï¼š\nè¿›è€Œï¼š\næ­£å¥½æ˜¯ç®—æ•°å¹³å‡æ•°ï¼ˆç®—æ•°å¹³å‡æ•°æ˜¯æœ€å°äºŒä¹˜æ³•çš„ç‰¹ä¾‹ï¼‰ã€‚\nè¿™å°±æ˜¯æœ€å°äºŒä¹˜æ³•ï¼Œæ‰€è°“â€œäºŒä¹˜â€å°±æ˜¯å¹³æ–¹çš„æ„æ€ã€‚\nï¼ˆé«˜æ–¯è¯æ˜è¿‡ï¼šå¦‚æœè¯¯å·®çš„åˆ†å¸ƒæ˜¯æ­£æ€åˆ†å¸ƒï¼Œé‚£ä¹ˆæœ€å°äºŒä¹˜æ³•å¾—åˆ°çš„å°±æ˜¯æœ€æœ‰å¯èƒ½çš„å€¼ã€‚ï¼‰\n2.2.2 çº¿æ€§å›å½’ä¸­çš„åº”ç”¨ æˆ‘ä»¬åœ¨ç¬¬ä¸€ç« ä¸­æåˆ°ï¼š\nç›®æ ‡æ˜¯ï¼Œæ‰¾åˆ°aå’Œbï¼Œä½¿å¾—æŸå¤±å‡½æ•°ï¼šå°½å¯èƒ½çš„å°ã€‚\nè¿™é‡Œï¼Œå°†ç®€å•çº¿æ€§é—®é¢˜è½¬ä¸ºæœ€ä¼˜åŒ–é—®é¢˜ã€‚ä¸‹é¢å¯¹å‡½æ•°çš„å„ä¸ªä½ç½®åˆ†é‡æ±‚å¯¼ï¼Œå¯¼æ•°ä¸º0çš„åœ°æ–¹å°±æ˜¯æå€¼ï¼š\nå¯¹ è¿›è¡Œæ±‚å¯¼ï¼š\nç„¶åmbæåˆ°ç­‰å·å‰é¢ï¼Œä¸¤è¾¹åŒæ—¶é™¤ä»¥mï¼Œç­‰å·å³é¢çš„æ¯ä¸€é¡¹ç›¸å½“äºå‡å€¼ã€‚\nç°åœ¨ å¯¹ è¿›è¡Œæ±‚å¯¼ï¼š\næ­¤æ—¶å°†å¯¹ è¿›è¡Œæ±‚å¯¼å¾—åˆ°çš„ç»“æœ ä»£å…¥ä¸Šå¼ä¸­ï¼Œå¾—åˆ°ï¼š\nå°†ä¸Šå¼è¿›è¡Œæ•´ç†ï¼Œå¾—åˆ°\nå°†ä¸Šå¼ç»§ç»­è¿›è¡Œæ•´ç†ï¼š\nè¿™æ ·åœ¨å®ç°çš„æ—¶å€™ç®€å•å¾ˆå¤šã€‚\næœ€ç»ˆæˆ‘ä»¬é€šè¿‡æœ€å°äºŒä¹˜æ³•å¾—åˆ°aã€bçš„è¡¨è¾¾å¼ï¼š\næ€»ç»“ æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬ä»æ•°å­¦çš„è§’åº¦äº†è§£äº†ç®€å•çº¿æ€§å›å½’ï¼Œä»ä¸­æ€»ç»“å‡ºä¸€ç±»æœºå™¨å­¦ä¹ ç®—æ³•çš„åŸºæœ¬æ€è·¯ï¼š\né€šè¿‡åˆ†æé—®é¢˜ï¼Œç¡®å®šé—®é¢˜çš„æŸå¤±å‡½æ•°æˆ–è€…æ•ˆç”¨å‡½æ•°ï¼› ç„¶åé€šè¿‡æœ€ä¼˜åŒ–æŸå¤±å‡½æ•°æˆ–è€…æ•ˆç”¨å‡½æ•°ï¼Œè·å¾—æœºå™¨å­¦ä¹ çš„æ¨¡å‹ã€‚ ç†è§£äº†æŸå¤±å‡½æ•°çš„æ¦‚å¿µï¼Œå¹¶åˆ—ä¸¾å‡ºäº†å¸¸è§æŸå¤±å‡½æ•°ï¼Œå¹¶å¼•å‡ºäº†ä¸€å †â€œé£é™©â€ã€‚æœ€åä¸ºäº†æ±‚å‡ºæœ€å°çš„æŸå¤±å‡½æ•°ï¼Œå­¦ä¹ äº†æœ€å°äºŒä¹˜æ³•ï¼Œå¹¶è¿›è¡Œäº†å®Œæ•´çš„æ•°å­¦æ¨å¯¼ã€‚\nä¸‹ä¸€ç¯‡ï¼Œæˆ‘ä»¬å°†ä¼šå®ç°ç®€å•çº¿æ€§å›å½’ï¼Œå¹¶æ·»åŠ åˆ°æˆ‘ä»¬è‡ªå·±çš„å·¥ç¨‹æ–‡ä»¶é‡Œã€‚\n","permalink":"https://reid00.github.io/en/posts/ml/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92/","summary":"ä»‹ç» ç§°å‡½æ•°ä¸ºæ•ˆç”¨å‡½æ•° çº¿æ€§å›å½’æ¨¡å‹çœ‹èµ·æ¥éå¸¸ç®€å•ï¼Œç®€å•åˆ°è®©äººæ€€ç–‘å…¶æ˜¯å¦æœ‰ç ”ç©¶ä»·å€¼ä»¥åŠä½¿ç”¨ä»·å€¼ã€‚ä½†å®é™…ä¸Šï¼Œçº¿æ€§å›å½’æ¨¡å‹å¯ä»¥è¯´æ˜¯æœ€é‡è¦çš„æ•°å­¦æ¨¡å‹ä¹‹ä¸€ï¼Œå¾ˆå¤šæ¨¡å‹éƒ½æ˜¯å»ºç«‹åœ¨å®ƒçš„åŸºç¡€ä¹‹ä¸Šï¼Œå¯ä»¥è¢«ç§°ä¸ºæ˜¯â€œæ¨¡å‹ä¹‹æ¯â€ã€‚\n1.1 ä»€ä¹ˆæ˜¯ç®€å•çº¿æ€§å›å½’ æ‰€è°“ç®€å•ï¼Œæ˜¯æŒ‡åªæœ‰ä¸€ä¸ªæ ·æœ¬ç‰¹å¾ï¼Œå³åªæœ‰ä¸€ä¸ªè‡ªå˜é‡ï¼›æ‰€è°“çº¿æ€§ï¼Œæ˜¯æŒ‡æ–¹ç¨‹æ˜¯çº¿æ€§çš„ï¼›æ‰€è°“å›å½’ï¼Œæ˜¯æŒ‡ç”¨æ–¹ç¨‹æ¥æ¨¡æ‹Ÿå˜é‡ä¹‹é—´æ˜¯å¦‚ä½•å…³è”çš„ã€‚\nç®€å•çº¿æ€§å›å½’ï¼Œå…¶æ€æƒ³ç®€å•ï¼Œå®ç°å®¹æ˜“ï¼ˆä¸å…¶èƒŒåå¼ºå¤§çš„æ•°å­¦æ€§è´¨ç›¸å…³ã€‚åŒæ—¶ä¹Ÿæ˜¯è®¸å¤šå¼ºå¤§çš„éçº¿æ€§æ¨¡å‹ï¼ˆå¤šé¡¹å¼å›å½’ã€é€»è¾‘å›å½’ã€SVMï¼‰çš„åŸºç¡€ã€‚å¹¶ä¸”å…¶ç»“æœå…·æœ‰å¾ˆå¥½çš„å¯è§£é‡Šæ€§ã€‚\n1.2 ä¸€ç§åŸºæœ¬æ¨å¯¼æ€ æˆ‘ä»¬æ‰€è°“çš„å»ºæ¨¡è¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªæ¨¡å‹ï¼Œæœ€å¤§ç¨‹åº¦çš„æ‹Ÿåˆæˆ‘ä»¬çš„æ•°æ®ã€‚ åœ¨ç®€å•çº¿å›å½’é—®é¢˜ä¸­ï¼Œæ¨¡å‹å°±æ˜¯æˆ‘ä»¬çš„ç›´çº¿æ–¹ç¨‹ï¼šy = ax + b ã€‚\nè¦æƒ³æœ€å¤§çš„æ‹Ÿåˆæ•°æ®ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯æ‰¾åˆ°æ²¡æœ‰æ‹Ÿåˆçš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯æŸå¤±çš„éƒ¨åˆ†å°½é‡å°ï¼Œå°±æ˜¯æŸå¤±å‡½æ•°ï¼ˆloss functionï¼‰ï¼ˆä¹Ÿæœ‰ç®—æ³•æ˜¯è¡¡é‡æ‹Ÿåˆçš„ç¨‹åº¦ï¼Œç§°å‡½æ•°ä¸ºæ•ˆç”¨å‡½æ•°ï¼ˆutility functionï¼‰ï¼‰ï¼š\nå› æ­¤ï¼Œæ¨å¯¼æ€è·¯ä¸ºï¼š\né€šè¿‡åˆ†æé—®é¢˜ï¼Œç¡®å®šé—®é¢˜çš„æŸå¤±å‡½æ•°æˆ–è€…æ•ˆç”¨å‡½æ•°ï¼› ç„¶åé€šè¿‡æœ€ä¼˜åŒ–æŸå¤±å‡½æ•°æˆ–è€…æ•ˆç”¨å‡½æ•°ï¼Œè·å¾—æœºå™¨å­¦ä¹ çš„æ¨¡å‹ è¿‘ä¹æ‰€æœ‰å‚æ•°å­¦ä¹ ç®—æ³•éƒ½æ˜¯è¿™æ ·çš„å¥—è·¯ï¼ŒåŒºåˆ«æ˜¯æ¨¡å‹ä¸åŒï¼Œå»ºç«‹çš„ç›®æ ‡å‡½æ•°ä¸åŒï¼Œä¼˜åŒ–çš„æ–¹å¼ä¹Ÿä¸åŒã€‚\nå›åˆ°ç®€å•çº¿æ€§å›å½’é—®é¢˜ï¼Œç›®æ ‡ï¼š\nå·²çŸ¥è®­ç»ƒæ•°æ®æ ·æœ¬ã€ ï¼Œæ‰¾åˆ°å’Œçš„å€¼ï¼Œä½¿ å°½å¯èƒ½å°\nè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„æœ€å°äºŒä¹˜æ³•é—®é¢˜ï¼ˆæœ€å°åŒ–è¯¯å·®çš„å¹³æ–¹ï¼‰\né€šè¿‡æœ€å°äºŒä¹˜æ³•å¯ä»¥æ±‚å‡ºaã€bçš„è¡¨è¾¾å¼ï¼š\næœ€å°äºŒä¹˜æ³• 2.1 ç”±æŸå¤±å‡½æ•°å¼•å‡ºä¸€å †â€œé£é™©â€ 2.1.1 æŸå¤±å‡½æ•° åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œæ‰€æœ‰çš„ç®—æ³•æ¨¡å‹å…¶å®éƒ½ä¾èµ–äºæœ€å°åŒ–æˆ–æœ€å¤§åŒ–æŸä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œç›®æ ‡å‡½æ•°â€ã€‚\næœ€å°åŒ–çš„è¿™ç»„å‡½æ•°è¢«ç§°ä¸ºâ€œæŸå¤±å‡½æ•°â€ã€‚ä»€ä¹ˆæ˜¯æŸå¤±å‡½æ•°å‘¢ï¼Ÿ\næŸå¤±å‡½æ•°æè¿°äº†å•ä¸ªæ ·æœ¬é¢„æµ‹å€¼å’ŒçœŸå®å€¼ä¹‹é—´è¯¯å·®çš„ç¨‹åº¦ã€‚ç”¨æ¥åº¦é‡æ¨¡å‹ä¸€æ¬¡é¢„æµ‹çš„å¥½åã€‚\næŸå¤±å‡½æ•°æ˜¯è¡¡é‡é¢„æµ‹æ¨¡å‹é¢„æµ‹æœŸæœ›ç»“æœè¡¨ç°çš„æŒ‡æ ‡ã€‚æŸå¤±å‡½æ•°è¶Šå°ï¼Œæ¨¡å‹çš„é²æ£’æ€§è¶Šå¥½ã€‚ã€‚\nå¸¸ç”¨æŸå¤±å‡½æ•°æœ‰ï¼š\n0-1æŸå¤±å‡½æ•°ï¼šç”¨æ¥è¡¨è¿°åˆ†ç±»é—®é¢˜ï¼Œå½“é¢„æµ‹åˆ†ç±»é”™è¯¯æ—¶ï¼ŒæŸå¤±å‡½æ•°å€¼ä¸º1ï¼Œæ­£ç¡®ä¸º å¹³æ–¹æŸå¤±å‡½æ•°ï¼šç”¨æ¥æè¿°å›å½’é—®é¢˜ï¼Œç”¨æ¥è¡¨ç¤ºè¿ç»­æ€§å˜é‡ï¼Œä¸ºé¢„æµ‹å€¼ä¸çœŸå®å€¼å·®å€¼çš„å¹³æ–¹ã€‚ï¼ˆè¯¯å·®å€¼è¶Šå¤§ã€æƒ©ç½šåŠ›åº¦è¶Šå¼ºï¼Œä¹Ÿå°±æ˜¯å¯¹å·®å€¼æ•æ„Ÿï¼‰\nç»å¯¹æŸå¤±å‡½æ•°ï¼šç”¨åœ¨å›å½’æ¨¡å‹ï¼Œç”¨è·ç¦»çš„ç»å¯¹å€¼æ¥è¡¡é‡ å¯¹æ•°æŸå¤±å‡½æ•°ï¼šæ˜¯é¢„æµ‹å€¼Yå’Œæ¡ä»¶æ¦‚ç‡ä¹‹é—´çš„è¡¡é‡ã€‚äº‹å®ä¸Šï¼Œè¯¥æŸå¤±å‡½æ•°ç”¨åˆ°äº†æå¤§ä¼¼ç„¶ä¼°è®¡çš„æ€æƒ³ã€‚P(Y|X)é€šä¿—çš„è§£é‡Šå°±æ˜¯ï¼šåœ¨å½“å‰æ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œå¯¹äºæ ·æœ¬Xï¼Œå…¶é¢„æµ‹å€¼ä¸ºYï¼Œä¹Ÿå°±æ˜¯é¢„æµ‹æ­£ç¡®çš„æ¦‚ç‡ã€‚ç”±äºæ¦‚ç‡ä¹‹é—´çš„åŒæ—¶æ»¡è¶³éœ€è¦ä½¿ç”¨ä¹˜æ³•ï¼Œä¸ºäº†å°†å…¶è½¬åŒ–ä¸ºåŠ æ³•ï¼Œæˆ‘ä»¬å°†å…¶å–å¯¹æ•°ã€‚æœ€åç”±äºæ˜¯æŸå¤±å‡½æ•°ï¼Œæ‰€ä»¥é¢„æµ‹æ­£ç¡®çš„æ¦‚ç‡è¶Šé«˜ï¼Œå…¶æŸå¤±å€¼åº”è¯¥æ˜¯è¶Šå°ï¼Œå› æ­¤å†åŠ ä¸ªè´Ÿå·å–ä¸ªåã€‚ ä»¥ä¸ŠæŸå¤±å‡½æ•°æ˜¯é’ˆå¯¹äºå•ä¸ªæ ·æœ¬çš„ï¼Œä½†æ˜¯ä¸€ä¸ªè®­ç»ƒæ•°æ®é›†ä¸­å­˜åœ¨Nä¸ªæ ·æœ¬ï¼ŒNä¸ªæ ·æœ¬ç»™å‡ºNä¸ªæŸå¤±ï¼Œå¦‚ä½•è¿›è¡Œé€‰æ‹©å‘¢ï¼Ÿ\nè¿™å°±å¼•å‡ºäº†é£é™©å‡½æ•°ã€‚\n2.1.2 æœŸæœ›é£é™© æœŸæœ›é£é™©æ˜¯æŸå¤±å‡½æ•°çš„æœŸæœ›ï¼Œç”¨æ¥è¡¨è¾¾ç†è®ºä¸Šæ¨¡å‹f(X)å…³äºè”åˆåˆ†å¸ƒP(X,Y)çš„å¹³å‡æ„ä¹‰ä¸‹çš„æŸå¤±ã€‚åˆå«æœŸæœ›æŸå¤±/é£é™©å‡½æ•°ã€‚\n2.1.3 ç»éªŒé£é™© æ¨¡å‹f(X)å…³äºè®­ç»ƒæ•°æ®é›†çš„å¹³å‡æŸå¤±ï¼Œç§°ä¸ºç»éªŒé£é™©æˆ–ç»éªŒæŸå¤±ã€‚\nå…¶å…¬å¼å«ä¹‰ä¸ºï¼šæ¨¡å‹å…³äºè®­ç»ƒé›†çš„å¹³å‡æŸå¤±ï¼ˆæ¯ä¸ªæ ·æœ¬çš„æŸå¤±åŠ èµ·æ¥ï¼Œç„¶åå¹³å‡ä¸€ä¸‹ï¼‰\nç»éªŒé£é™©æœ€å°çš„æ¨¡å‹ä¸ºæœ€ä¼˜æ¨¡å‹ã€‚åœ¨è®­ç»ƒé›†ä¸Šæœ€å°ç»éªŒé£é™©æœ€å°ï¼Œä¹Ÿå°±æ„å‘³ç€é¢„æµ‹å€¼å’ŒçœŸå®å€¼å°½å¯èƒ½æ¥è¿‘ï¼Œæ¨¡å‹çš„æ•ˆæœè¶Šå¥½ã€‚å…¬å¼å«ä¹‰ä¸ºå–è®­ç»ƒæ ·æœ¬é›†ä¸­å¯¹æ•°æŸå¤±å‡½æ•°å¹³å‡å€¼çš„æœ€å°ã€‚\n2.1.4 ç»éªŒé£é™©æœ€å°åŒ–å’Œç»“æ„é£é™©æœ€å°åŒ– æœŸæœ›é£é™©æ˜¯æ¨¡å‹å…³äºè”åˆåˆ†å¸ƒçš„æœŸæœ›æŸå¤±ï¼Œç»éªŒé£é™©æ˜¯æ¨¡å‹å…³äºè®­ç»ƒæ ·æœ¬æ•°æ®é›†çš„å¹³å‡æŸå¤±ã€‚æ ¹æ®å¤§æ•°å®šå¾‹ï¼Œå½“æ ·æœ¬å®¹é‡Nè¶‹äºæ— ç©·æ—¶ï¼Œç»éªŒé£é™©è¶‹äºæœŸæœ›é£é™©ã€‚\nå› æ­¤å¾ˆè‡ªç„¶åœ°æƒ³åˆ°ç”¨ç»éªŒé£é™©å»ä¼°è®¡æœŸæœ›é£é™©ã€‚ä½†æ˜¯ç”±äºè®­ç»ƒæ ·æœ¬ä¸ªæ•°æœ‰é™ï¼Œå¯èƒ½ä¼šå‡ºç°è¿‡åº¦æ‹Ÿåˆçš„é—®é¢˜ï¼Œå³å†³ç­–å‡½æ•°å¯¹äºè®­ç»ƒé›†å‡ ä¹å…¨éƒ¨æ‹Ÿåˆï¼Œä½†æ˜¯å¯¹äºæµ‹è¯•é›†æ‹Ÿåˆæ•ˆæœè¿‡å·®ã€‚å› æ­¤éœ€è¦å¯¹å…¶è¿›è¡ŒçŸ«æ­£ï¼š\nç»“æ„é£é™©æœ€å°åŒ–ï¼šå½“æ ·æœ¬å®¹é‡ä¸å¤§çš„æ—¶å€™ï¼Œç»éªŒé£é™©æœ€å°åŒ–å®¹æ˜“äº§ç”Ÿâ€œè¿‡æ‹Ÿåˆâ€çš„é—®é¢˜ï¼Œä¸ºäº†â€œå‡ç¼“â€è¿‡æ‹Ÿåˆé—®é¢˜ï¼Œæå‡ºäº†ç»“æ„é£é™©æœ€å°ç†è®ºã€‚ç»“æ„é£é™©æœ€å°åŒ–ä¸ºç»éªŒé£é™©ä¸å¤æ‚åº¦åŒæ—¶è¾ƒå°ã€‚ é€šè¿‡å…¬å¼å¯ä»¥çœ‹å‡ºï¼Œç»“æ„é£é™©ï¼šåœ¨ç»éªŒé£é™©ä¸ŠåŠ ä¸Šä¸€ä¸ªæ­£åˆ™åŒ–é¡¹(regularizer)ï¼Œæˆ–è€…å«åšç½šé¡¹(penalty) ã€‚æ­£åˆ™åŒ–é¡¹æ˜¯J(f)æ˜¯å‡½æ•°çš„å¤æ‚åº¦å†ä¹˜ä¸€ä¸ªæƒé‡ç³»æ•°ï¼ˆç”¨ä»¥æƒè¡¡ç»éªŒé£é™©å’Œå¤æ‚åº¦ï¼‰\n2.1.5 å°ç»“ 1ã€æŸå¤±å‡½æ•°ï¼šå•ä¸ªæ ·æœ¬é¢„æµ‹å€¼å’ŒçœŸå®å€¼ä¹‹é—´è¯¯å·®çš„ç¨‹åº¦ã€‚\n2ã€æœŸæœ›é£é™©ï¼šæ˜¯æŸå¤±å‡½æ•°çš„æœŸæœ›ï¼Œç†è®ºä¸Šæ¨¡å‹f(X)å…³äºè”åˆåˆ†å¸ƒP(X,Y)çš„å¹³å‡æ„ä¹‰ä¸‹çš„æŸå¤±ã€‚\n3ã€ç»éªŒé£é™©ï¼šæ¨¡å‹å…³äºè®­ç»ƒé›†çš„å¹³å‡æŸå¤±ï¼ˆæ¯ä¸ªæ ·æœ¬çš„æŸå¤±åŠ èµ·æ¥ï¼Œç„¶åå¹³å‡ä¸€ä¸‹ï¼‰ã€‚\n4ã€ç»“æ„é£é™©ï¼šåœ¨ç»éªŒé£é™©ä¸ŠåŠ ä¸Šä¸€ä¸ªæ­£åˆ™åŒ–é¡¹ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆçš„ç­–ç•¥ã€‚\n2.2 æœ€å°äºŒä¹˜æ³• 2.2.1 ä»€ä¹ˆæ˜¯æœ€å°äºŒä¹˜æ³• è¨€å½’æ­£ä¼ ï¼Œè¿›å…¥æœ€å°äºŒä¹˜æ³•çš„éƒ¨åˆ†ã€‚","title":"çº¿æ€§å›å½’"},{"content":"ä¸€ã€çº¿æ€§æ¨¡å‹é¢„æµ‹ä¸€ä¸ªæ ·æœ¬çš„æŸå¤±é‡ æŸå¤±é‡ï¼šæ¨¡å‹å¯¹æ ·æœ¬çš„é¢„æµ‹ç»“æœå’Œè¯¥æ ·æœ¬å¯¹åº”çš„å®é™…ç»“æœçš„å·®è·ï¼›\n1ï¼‰ä¸ºä»€ä¹ˆä¼šæƒ³åˆ°ç”¨ y = -log(x) å‡½æ•°? ï¼ˆè¯¥å‡½æ•°ç§°ä¸º æƒ©ç½šå‡½æ•°ï¼šé¢„æµ‹ç»“æœä¸å®é™…å€¼çš„åå·®è¶Šå¤§ï¼Œæƒ©ç½šè¶Šå¤§ï¼‰ y = 1ï¼ˆp â‰¥ 0.5ï¼‰æ—¶ï¼Œcost = -log(p)ï¼Œp è¶Šå°ï¼Œæ ·æœ¬å‘ç”Ÿæ¦‚ç‡è¶Šå°ï¼ˆæœ€å°ä¸º 0ï¼‰ï¼Œåˆ™æŸå¤±å‡½æ•°è¶Šå¤§ï¼Œåˆ†ç±»é¢„æµ‹å€¼å’Œå®é™…å€¼çš„åå·®è¶Šå¤§ï¼›ç›¸åï¼Œp è¶Šå¤§ï¼Œæ ·æœ¬å‘ç”Ÿæ¦‚ç‡è¶Šå¤§ï¼ˆæœ€å¤§ä¸º 0.5ï¼‰ï¼Œåˆ™æŸå¤±å‡½æ•°è¶Šå°ï¼Œåˆ™é¢„æµ‹å€¼å’Œå®é™…å€¼çš„åå·®è¶Šå°ï¼› y = 0ï¼ˆp â‰¤ 0.5ï¼‰æ—¶ï¼Œcost = -log(1-p)ï¼Œp è¶Šå°ï¼Œæ ·æœ¬å‘ç”Ÿæ¦‚ç‡è¶Šå°ï¼ˆæœ€å°ä¸º 0.5ï¼‰ï¼Œåˆ™æŸå¤±å‡½æ•°è¶Šå¤§ï¼Œåˆ†ç±»é¢„æµ‹å€¼å’Œå®é™…å€¼çš„åå·®è¶Šå¤§ï¼›ç›¸åï¼Œp è¶Šå¤§ï¼Œæ ·æœ¬å‘ç”Ÿæ¦‚ç‡è¶Šå¤§ï¼ˆæœ€å¤§ä¸º 1ï¼‰ï¼Œåˆ™æŸå¤±å‡½æ•°è¶Šå°ï¼Œåˆ™é¢„æµ‹å€¼å’Œå®é™…å€¼çš„åå·®è¶Šå°ï¼› 2ï¼‰æ±‚ä¸€ä¸ªæ ·æœ¬çš„æŸå¤±é‡ ç”±äºé€»è¾‘å›å½’è§£å†³çš„æ˜¯åˆ†ç±»é—®é¢˜ï¼Œè€Œä¸”æ˜¯äºŒåˆ†ç±»ï¼Œå› æ­¤å®šä¹‰æŸå¤±å‡½æ•°æ—¶ä¹Ÿè¦æœ‰ä¸¤ç±»\næƒ©ç½šå‡½æ•°å˜å½¢ï¼š\næƒ©ç½šå‡½æ•°ä½œç”¨ï¼šè®¡ç®—é¢„æµ‹ç»“æœé’ˆå¯¹å®é™…å€¼çš„æŸå¤±é‡ï¼›\nå·²çŸ¥æ ·æœ¬å‘ç”Ÿçš„æ¦‚ç‡ pï¼ˆä¹Ÿå¯ä»¥ç›¸åº”æ±‚å‡ºé¢„æµ‹å€¼ï¼‰ï¼Œä»¥åŠè¯¥æ ·æœ¬çš„å®é™…åˆ†ç±»ç»“æœï¼Œå¾—å‡ºæ­¤æ¬¡é¢„æµ‹ç»“æœé’ˆå¯¹çœŸå€¼çš„æŸå¤±é‡æ˜¯å¤šå°‘ï¼› äºŒã€æ±‚æ•°æ®é›†çš„æŸå¤±å‡½æ•° æ¨¡å‹å˜å½¢ï¼Œå¾—åˆ°æ•°æ®é›†çš„æŸå¤±å‡½æ•°ï¼šæ•°æ®é›†ä¸­çš„æ‰€æœ‰æ ·æœ¬çš„æŸå¤±å€¼çš„å’Œï¼› æœ€ç»ˆçš„æŸå¤±å‡½æ•°æ¨¡å‹ è¯¥æ¨¡å‹ä¸èƒ½ä¼˜åŒ–æˆç®€å•çš„æ•°å­¦è¡¨è¾¾å¼ï¼ˆæˆ–è€…è¯´æ˜¯æ­£è§„æ–¹ç¨‹è§£ï¼šçº¿æ€§å›å½’ç®—æ³•æ‰¾é‚£ä¸ªçš„fit_normal() æ–¹æ³•ï¼‰ï¼Œåªèƒ½ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•æ±‚è§£ï¼› è¯¥å‡½æ•°ä¸ºå‡¸å‡½æ•°ï¼Œæ²¡æœ‰å±€éƒ¨æœ€ä¼˜è§£ï¼Œåªå­˜åœ¨å…¨å±€æœ€ä¼˜è§£ï¼› ä¸‰ã€é€»è¾‘å›å½’æŸå¤±å‡½æ•°çš„æ¢¯åº¦ æŸå¤±å‡½æ•°ï¼š 1ï¼‰Ïƒ(t) å‡½æ•°çš„å¯¼æ•° 2ï¼‰log(Ïƒ(t)) å‡½æ•°çš„å¯¼æ•° å˜å½¢ï¼š\n3ï¼‰log(1 - Ïƒ(t)) å‡½æ•°çš„å¯¼æ•° 4ï¼‰å¯¹æŸå¤±å‡½æ•° J(Î¸) çš„å…¶ä¸­æŸä¸€é¡¹ï¼ˆç¬¬ i è¡Œï¼Œç¬¬ j åˆ—ï¼‰æ±‚å¯¼ ä¸¤å¼ç›¸åŠ ï¼š 5ï¼‰æŸå¤±å‡½æ•° J(Î¸) çš„æ¢¯åº¦ ä¸çº¿æ€§å›å½’æ¢¯åº¦å¯¹æ¯”\næ³¨ï¼šä¸¤è€…çš„é¢„æµ‹å€¼ Ã½ ä¸åŒï¼› æ¢¯åº¦å‘é‡åŒ–å¤„ç† å››ã€ä»£ç å®ç°é€»è¾‘å›å½’ç®—æ³• é€»è¾‘å›å½’ç®—æ³•æ˜¯åœ¨çº¿æ€§å›å½’ç®—æ³•çš„åŸºç¡€ä¸Šæ¼”å˜çš„ï¼›\n1ï¼‰ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 import numpy as np from .metrics import accuracy_score # accuracy_scoreæ–¹æ³•ï¼šæŸ¥çœ‹å‡†ç¡®ç‡ class LogisticRegression: def __init__(self): \u0026#34;\u0026#34;\u0026#34;åˆå§‹åŒ–Logistic Regressionæ¨¡å‹\u0026#34;\u0026#34;\u0026#34; self.coef_ = None self.intercept_ = None self._theta = None def _sigmiod(self, t): \u0026#34;\u0026#34;\u0026#34;å‡½æ•°åé¦–éƒ¨ä¸º\u0026#39;_\u0026#39;ï¼Œè¡¨æ˜è¯¥å‡½æ•°ä¸ºç§æœ‰å‡½æ•°ï¼Œå…¶å®ƒæ¨¡å—ä¸èƒ½è°ƒç”¨\u0026#34;\u0026#34;\u0026#34; return 1. / (1. + np.exp(-t)) def fit(self, X_train, y_train, eta=0.01, n_iters=1e4): \u0026#34;\u0026#34;\u0026#34;æ ¹æ®è®­ç»ƒæ•°æ®é›†X_train, y_train, ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•è®­ç»ƒLogistic Regressionæ¨¡å‹\u0026#34;\u0026#34;\u0026#34; assert X_train.shape[0] == y_train.shape[0], \\ \u0026#34;the size of X_train must be equal to the size of y_train\u0026#34; def J(theta, X_b, y): y_hat = self._sigmiod(X_b.dot(theta)) try: return - np.sum(y*np.log(y_hat) + (1-y)*np.log(1-y_hat)) / len(y) except: return float(\u0026#39;inf\u0026#39;) def dJ(theta, X_b, y): return X_b.T.dot(self._sigmiod(X_b.dot(theta)) - y) / len(X_b) def gradient_descent(X_b, y, initial_theta, eta, n_iters=1e4, epsilon=1e-8): theta = initial_theta cur_iter = 0 while cur_iter \u0026lt; n_iters: gradient = dJ(theta, X_b, y) last_theta = theta theta = theta - eta * gradient if (abs(J(theta, X_b, y) - J(last_theta, X_b, y)) \u0026lt; epsilon): break cur_iter += 1 return theta X_b = np.hstack([np.ones((len(X_train), 1)), X_train]) initial_theta = np.zeros(X_b.shape[1]) self._theta = gradient_descent(X_b, y_train, initial_theta, eta, n_iters) self.intercept_ = self._theta[0] self.coef_ = self._theta[1:] return self def predict_proda(self, X_predict): \u0026#34;\u0026#34;\u0026#34;ç»™å®šå¾…é¢„æµ‹æ•°æ®é›†X_predictï¼Œè¿”å› X_predict ä¸­çš„æ ·æœ¬çš„å‘ç”Ÿçš„æ¦‚ç‡å‘é‡\u0026#34;\u0026#34;\u0026#34; assert self.intercept_ is not None and self.coef_ is not None, \\ \u0026#34;must fit before predict!\u0026#34; assert X_predict.shape[1] == len(self.coef_), \\ \u0026#34;the feature number of X_predict must be equal to X_train\u0026#34; X_b = np.hstack([np.ones((len(X_predict), 1)), X_predict]) return self._sigmiod(X_b.dot(self._theta)) def predict(self, X_predict): \u0026#34;\u0026#34;\u0026#34;ç»™å®šå¾…é¢„æµ‹æ•°æ®é›†X_predictï¼Œè¿”å›è¡¨ç¤ºX_predictçš„åˆ†ç±»ç»“æœçš„å‘é‡\u0026#34;\u0026#34;\u0026#34; assert self.intercept_ is not None and self.coef_ is not None, \\ \u0026#34;must fit before predict!\u0026#34; assert X_predict.shape[1] == len(self.coef_), \\ \u0026#34;the feature number of X_predict must be equal to X_train\u0026#34; proda = self.predict_proda(X_predict) # prodaï¼šå•ä¸ªå¾…é¢„æµ‹æ ·æœ¬çš„å‘ç”Ÿæ¦‚ç‡ # proda \u0026gt;= 0.5ï¼šè¿”å›å…ƒç´ ä¸ºå¸ƒå°”ç±»å‹çš„å‘é‡ï¼› # np.array(proda \u0026gt;= 0.5, dtype=\u0026#39;int\u0026#39;)ï¼šå°†å¸ƒå°”æ•°æ®ç±»å‹çš„å‘é‡è½¬åŒ–ä¸ºå…ƒç´ ä¸º int å‹çš„æ•°ç»„ï¼Œåˆ™è¯¥æ•°ç»„ä¸­çš„ 0 å’Œ 1 ä»£è¡¨ä¸¤ç§ä¸åŒçš„åˆ†ç±»ç±»åˆ«ï¼› return np.array(proda \u0026gt;= 0.5, dtype=\u0026#39;int\u0026#39;) def score(self, X_test, y_test): \u0026#34;\u0026#34;\u0026#34;æ ¹æ®æµ‹è¯•æ•°æ®é›† X_test å’Œ y_test ç¡®å®šå½“å‰æ¨¡å‹çš„å‡†ç¡®åº¦\u0026#34;\u0026#34;\u0026#34; y_predict = self.predict(X_test) # åˆ†ç±»é—®é¢˜çš„åŒ–ï¼ŒæŸ¥çœ‹æ ‡å‡†æ˜¯åˆ†ç±»çš„å‡†ç¡®åº¦ï¼šaccuracy_score(y_test, y_predict) return accuracy_score(y_test, y_predict) def __repr__(self): \u0026#34;\u0026#34;\u0026#34;å®ä¾‹åŒ–ç±»ä¹‹åï¼Œè¾“å‡ºæ˜¾ç¤º LogisticRegression()\u0026#34;\u0026#34;\u0026#34; return \u0026#34;LogisticRegression()\u0026#34; 2ï¼‰ä½¿ç”¨è‡ªå·±çš„ç®—æ³•ï¼ˆJupyter NoteBook ä¸­ä½¿ç”¨ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 import numpy as np import matplotlib.pyplot as plt from sklearn import datasets iris = datasets.load_iris() X = iris.data y = iris.target X = X[y\u0026lt;2, :2] y = y[y\u0026lt;2] from playML.train_test_split import train_test_split X_train, X_test, y_train, y_test = train_test_split(X, y, seed=666) from playML.LogisticRegression import LogisticRegression log_reg = LogisticRegression() log_reg.fit(X_train, y_train) log_reg.score(X_test, y_test) # è¾“å‡ºï¼š1.0 # æŸ¥çœ‹æµ‹è¯•æ•°æ®é›†çš„æ ·æœ¬å‘ç”Ÿçš„æ¦‚ç‡ log_reg.predict_proda(X_test) # è¾“å‡ºï¼šarray([0.92972035, 0.98664939, 0.14852024, 0.17601199, 0.0369836 , 0.0186637 , 0.04936918, 0.99669244, 0.97993941, 0.74524655, 0.04473194, 0.00339285, 0.26131273, 0.0369836 , 0.84192923, 0.79892262, 0.82890209, 0.32358166, 0.06535323, 0.20735334]) ","permalink":"https://reid00.github.io/en/posts/ml/%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92/","summary":"ä¸€ã€çº¿æ€§æ¨¡å‹é¢„æµ‹ä¸€ä¸ªæ ·æœ¬çš„æŸå¤±é‡ æŸå¤±é‡ï¼šæ¨¡å‹å¯¹æ ·æœ¬çš„é¢„æµ‹ç»“æœå’Œè¯¥æ ·æœ¬å¯¹åº”çš„å®é™…ç»“æœçš„å·®è·ï¼›\n1ï¼‰ä¸ºä»€ä¹ˆä¼šæƒ³åˆ°ç”¨ y = -log(x) å‡½æ•°? ï¼ˆè¯¥å‡½æ•°ç§°ä¸º æƒ©ç½šå‡½æ•°ï¼šé¢„æµ‹ç»“æœä¸å®é™…å€¼çš„åå·®è¶Šå¤§ï¼Œæƒ©ç½šè¶Šå¤§ï¼‰ y = 1ï¼ˆp â‰¥ 0.5ï¼‰æ—¶ï¼Œcost = -log(p)ï¼Œp è¶Šå°ï¼Œæ ·æœ¬å‘ç”Ÿæ¦‚ç‡è¶Šå°ï¼ˆæœ€å°ä¸º 0ï¼‰ï¼Œåˆ™æŸå¤±å‡½æ•°è¶Šå¤§ï¼Œåˆ†ç±»é¢„æµ‹å€¼å’Œå®é™…å€¼çš„åå·®è¶Šå¤§ï¼›ç›¸åï¼Œp è¶Šå¤§ï¼Œæ ·æœ¬å‘ç”Ÿæ¦‚ç‡è¶Šå¤§ï¼ˆæœ€å¤§ä¸º 0.5ï¼‰ï¼Œåˆ™æŸå¤±å‡½æ•°è¶Šå°ï¼Œåˆ™é¢„æµ‹å€¼å’Œå®é™…å€¼çš„åå·®è¶Šå°ï¼› y = 0ï¼ˆp â‰¤ 0.5ï¼‰æ—¶ï¼Œcost = -log(1-p)ï¼Œp è¶Šå°ï¼Œæ ·æœ¬å‘ç”Ÿæ¦‚ç‡è¶Šå°ï¼ˆæœ€å°ä¸º 0.5ï¼‰ï¼Œåˆ™æŸå¤±å‡½æ•°è¶Šå¤§ï¼Œåˆ†ç±»é¢„æµ‹å€¼å’Œå®é™…å€¼çš„åå·®è¶Šå¤§ï¼›ç›¸åï¼Œp è¶Šå¤§ï¼Œæ ·æœ¬å‘ç”Ÿæ¦‚ç‡è¶Šå¤§ï¼ˆæœ€å¤§ä¸º 1ï¼‰ï¼Œåˆ™æŸå¤±å‡½æ•°è¶Šå°ï¼Œåˆ™é¢„æµ‹å€¼å’Œå®é™…å€¼çš„åå·®è¶Šå°ï¼› 2ï¼‰æ±‚ä¸€ä¸ªæ ·æœ¬çš„æŸå¤±é‡ ç”±äºé€»è¾‘å›å½’è§£å†³çš„æ˜¯åˆ†ç±»é—®é¢˜ï¼Œè€Œä¸”æ˜¯äºŒåˆ†ç±»ï¼Œå› æ­¤å®šä¹‰æŸå¤±å‡½æ•°æ—¶ä¹Ÿè¦æœ‰ä¸¤ç±»\næƒ©ç½šå‡½æ•°å˜å½¢ï¼š\næƒ©ç½šå‡½æ•°ä½œç”¨ï¼šè®¡ç®—é¢„æµ‹ç»“æœé’ˆå¯¹å®é™…å€¼çš„æŸå¤±é‡ï¼›\nå·²çŸ¥æ ·æœ¬å‘ç”Ÿçš„æ¦‚ç‡ pï¼ˆä¹Ÿå¯ä»¥ç›¸åº”æ±‚å‡ºé¢„æµ‹å€¼ï¼‰ï¼Œä»¥åŠè¯¥æ ·æœ¬çš„å®é™…åˆ†ç±»ç»“æœï¼Œå¾—å‡ºæ­¤æ¬¡é¢„æµ‹ç»“æœé’ˆå¯¹çœŸå€¼çš„æŸå¤±é‡æ˜¯å¤šå°‘ï¼› äºŒã€æ±‚æ•°æ®é›†çš„æŸå¤±å‡½æ•° æ¨¡å‹å˜å½¢ï¼Œå¾—åˆ°æ•°æ®é›†çš„æŸå¤±å‡½æ•°ï¼šæ•°æ®é›†ä¸­çš„æ‰€æœ‰æ ·æœ¬çš„æŸå¤±å€¼çš„å’Œï¼› æœ€ç»ˆçš„æŸå¤±å‡½æ•°æ¨¡å‹ è¯¥æ¨¡å‹ä¸èƒ½ä¼˜åŒ–æˆç®€å•çš„æ•°å­¦è¡¨è¾¾å¼ï¼ˆæˆ–è€…è¯´æ˜¯æ­£è§„æ–¹ç¨‹è§£ï¼šçº¿æ€§å›å½’ç®—æ³•æ‰¾é‚£ä¸ªçš„fit_normal() æ–¹æ³•ï¼‰ï¼Œåªèƒ½ä½¿ç”¨æ¢¯åº¦ä¸‹é™æ³•æ±‚è§£ï¼› è¯¥å‡½æ•°ä¸ºå‡¸å‡½æ•°ï¼Œæ²¡æœ‰å±€éƒ¨æœ€ä¼˜è§£ï¼Œåªå­˜åœ¨å…¨å±€æœ€ä¼˜è§£ï¼› ä¸‰ã€é€»è¾‘å›å½’æŸå¤±å‡½æ•°çš„æ¢¯åº¦ æŸå¤±å‡½æ•°ï¼š 1ï¼‰Ïƒ(t) å‡½æ•°çš„å¯¼æ•° 2ï¼‰log(Ïƒ(t)) å‡½æ•°çš„å¯¼æ•° å˜å½¢ï¼š\n3ï¼‰log(1 - Ïƒ(t)) å‡½æ•°çš„å¯¼æ•° 4ï¼‰å¯¹æŸå¤±å‡½æ•° J(Î¸) çš„å…¶ä¸­æŸä¸€é¡¹ï¼ˆç¬¬ i è¡Œï¼Œç¬¬ j åˆ—ï¼‰æ±‚å¯¼ ä¸¤å¼ç›¸åŠ ï¼š 5ï¼‰æŸå¤±å‡½æ•° J(Î¸) çš„æ¢¯åº¦ ä¸çº¿æ€§å›å½’æ¢¯åº¦å¯¹æ¯”\næ³¨ï¼šä¸¤è€…çš„é¢„æµ‹å€¼ Ã½ ä¸åŒï¼› æ¢¯åº¦å‘é‡åŒ–å¤„ç† å››ã€ä»£ç å®ç°é€»è¾‘å›å½’ç®—æ³• é€»è¾‘å›å½’ç®—æ³•æ˜¯åœ¨çº¿æ€§å›å½’ç®—æ³•çš„åŸºç¡€ä¸Šæ¼”å˜çš„ï¼›","title":"é€»è¾‘å›å½’"},{"content":"Summary æœ¬æ–‡å°†ä»ä¸€ä¸ªä¸‹å±±çš„åœºæ™¯å¼€å§‹ï¼Œå…ˆæå‡ºæ¢¯åº¦ä¸‹é™ç®—æ³•çš„åŸºæœ¬æ€æƒ³ï¼Œè¿›è€Œä»æ•°å­¦ä¸Šè§£é‡Šæ¢¯åº¦ä¸‹é™ç®—æ³•çš„åŸç†ï¼Œæœ€åå®ç°ä¸€ä¸ªç®€å•çš„æ¢¯åº¦ä¸‹é™ç®—æ³•çš„å®ä¾‹ï¼\næ¢¯åº¦ä¸‹é™çš„åœºæ™¯å‡è®¾ æ¢¯åº¦ä¸‹é™æ³•çš„åŸºæœ¬æ€æƒ³å¯ä»¥ç±»æ¯”ä¸ºä¸€ä¸ªä¸‹å±±çš„è¿‡ç¨‹ã€‚å‡è®¾è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šä¸€ä¸ªäººè¢«å›°åœ¨å±±ä¸Šï¼Œéœ€è¦ä»å±±ä¸Šä¸‹æ¥(i.e. æ‰¾åˆ°å±±çš„æœ€ä½ç‚¹ï¼Œä¹Ÿå°±æ˜¯å±±è°·)ã€‚ä½†æ­¤æ—¶å±±ä¸Šçš„æµ“é›¾å¾ˆå¤§ï¼Œå¯¼è‡´å¯è§†åº¦å¾ˆä½ã€‚å› æ­¤ï¼Œä¸‹å±±çš„è·¯å¾„å°±æ— æ³•ç¡®å®šï¼Œä»–å¿…é¡»åˆ©ç”¨è‡ªå·±å‘¨å›´çš„ä¿¡æ¯å»æ‰¾åˆ°ä¸‹å±±çš„è·¯å¾„ã€‚è¿™ä¸ªæ—¶å€™ï¼Œä»–å°±å¯ä»¥åˆ©ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•æ¥å¸®åŠ©è‡ªå·±ä¸‹å±±ã€‚å…·ä½“æ¥è¯´å°±æ˜¯ï¼Œä»¥ä»–å½“å‰çš„æ‰€å¤„çš„ä½ç½®ä¸ºåŸºå‡†ï¼Œå¯»æ‰¾è¿™ä¸ªä½ç½®æœ€é™¡å³­çš„åœ°æ–¹ï¼Œç„¶åæœç€å±±çš„é«˜åº¦ä¸‹é™çš„åœ°æ–¹èµ°ï¼ŒåŒç†ï¼Œå¦‚æœæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä¸Šå±±ï¼Œä¹Ÿå°±æ˜¯çˆ¬åˆ°å±±é¡¶ï¼Œé‚£ä¹ˆæ­¤æ—¶åº”è¯¥æ˜¯æœç€æœ€é™¡å³­çš„æ–¹å‘å¾€ä¸Šèµ°ã€‚ç„¶åæ¯èµ°ä¸€æ®µè·ç¦»ï¼Œéƒ½åå¤é‡‡ç”¨åŒä¸€ä¸ªæ–¹æ³•ï¼Œæœ€åå°±èƒ½æˆåŠŸçš„æŠµè¾¾å±±è°·ã€‚\næˆ‘ä»¬åŒæ—¶å¯ä»¥å‡è®¾è¿™åº§å±±æœ€é™¡å³­çš„åœ°æ–¹æ˜¯æ— æ³•é€šè¿‡è‚‰çœ¼ç«‹é©¬è§‚å¯Ÿå‡ºæ¥çš„ï¼Œè€Œæ˜¯éœ€è¦ä¸€ä¸ªå¤æ‚çš„å·¥å…·æ¥æµ‹é‡ï¼ŒåŒæ—¶ï¼Œè¿™ä¸ªäººæ­¤æ—¶æ­£å¥½æ‹¥æœ‰æµ‹é‡å‡ºæœ€é™¡å³­æ–¹å‘çš„èƒ½åŠ›ã€‚æ‰€ä»¥ï¼Œæ­¤äººæ¯èµ°ä¸€æ®µè·ç¦»ï¼Œéƒ½éœ€è¦ä¸€æ®µæ—¶é—´æ¥æµ‹é‡æ‰€åœ¨ä½ç½®æœ€é™¡å³­çš„æ–¹å‘ï¼Œè¿™æ˜¯æ¯”è¾ƒè€—æ—¶çš„ã€‚é‚£ä¹ˆä¸ºäº†åœ¨å¤ªé˜³ä¸‹å±±ä¹‹å‰åˆ°è¾¾å±±åº•ï¼Œå°±è¦å°½å¯èƒ½çš„å‡å°‘æµ‹é‡æ–¹å‘çš„æ¬¡æ•°ã€‚è¿™æ˜¯ä¸€ä¸ªä¸¤éš¾çš„é€‰æ‹©ï¼Œå¦‚æœæµ‹é‡çš„é¢‘ç¹ï¼Œå¯ä»¥ä¿è¯ä¸‹å±±çš„æ–¹å‘æ˜¯ç»å¯¹æ­£ç¡®çš„ï¼Œä½†åˆéå¸¸è€—æ—¶ï¼Œå¦‚æœæµ‹é‡çš„è¿‡å°‘ï¼Œåˆæœ‰åç¦»è½¨é“çš„é£é™©ã€‚æ‰€ä»¥éœ€è¦æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„æµ‹é‡æ–¹å‘çš„é¢‘ç‡ï¼Œæ¥ç¡®ä¿ä¸‹å±±çš„æ–¹å‘ä¸é”™è¯¯ï¼ŒåŒæ—¶åˆä¸è‡³äºè€—æ—¶å¤ªå¤šï¼\næ¢¯åº¦ä¸‹é™ é¦–å…ˆï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¯å¾®åˆ†çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å°±ä»£è¡¨ç€ä¸€åº§å±±ã€‚æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æ‰¾åˆ°è¿™ä¸ªå‡½æ•°çš„æœ€å°å€¼ï¼Œä¹Ÿå°±æ˜¯å±±åº•ã€‚æ ¹æ®ä¹‹å‰çš„åœºæ™¯å‡è®¾ï¼Œæœ€å¿«çš„ä¸‹å±±çš„æ–¹å¼å°±æ˜¯æ‰¾åˆ°å½“å‰ä½ç½®æœ€é™¡å³­çš„æ–¹å‘ï¼Œç„¶åæ²¿ç€æ­¤æ–¹å‘å‘ä¸‹èµ°ï¼Œå¯¹åº”åˆ°å‡½æ•°ä¸­ï¼Œå°±æ˜¯æ‰¾åˆ°ç»™å®šç‚¹çš„æ¢¯åº¦ ï¼Œç„¶åæœç€æ¢¯åº¦ç›¸åçš„æ–¹å‘ï¼Œå°±èƒ½è®©å‡½æ•°å€¼ä¸‹é™çš„æœ€å¿«ï¼å› ä¸ºæ¢¯åº¦çš„æ–¹å‘å°±æ˜¯å‡½æ•°ä¹‹å˜åŒ–æœ€å¿«çš„æ–¹å‘(åœ¨åé¢ä¼šè¯¦ç»†è§£é‡Š) æ‰€ä»¥ï¼Œæˆ‘ä»¬é‡å¤åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œåå¤æ±‚å–æ¢¯åº¦ï¼Œæœ€åå°±èƒ½åˆ°è¾¾å±€éƒ¨çš„æœ€å°å€¼ï¼Œè¿™å°±ç±»ä¼¼äºæˆ‘ä»¬ä¸‹å±±çš„è¿‡ç¨‹ã€‚è€Œæ±‚å–æ¢¯åº¦å°±ç¡®å®šäº†æœ€é™¡å³­çš„æ–¹å‘ï¼Œä¹Ÿå°±æ˜¯åœºæ™¯ä¸­æµ‹é‡æ–¹å‘çš„æ‰‹æ®µã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆæ¢¯åº¦çš„æ–¹å‘å°±æ˜¯æœ€é™¡å³­çš„æ–¹å‘å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»å¾®åˆ†å¼€å§‹è®²èµ·\nå¾®åˆ† çœ‹å¾…å¾®åˆ†çš„æ„ä¹‰ï¼Œå¯ä»¥æœ‰ä¸åŒçš„è§’åº¦ï¼Œæœ€å¸¸ç”¨çš„ä¸¤ç§æ˜¯ï¼š\nå‡½æ•°å›¾åƒä¸­ï¼ŒæŸç‚¹çš„åˆ‡çº¿çš„æ–œç‡\nå‡½æ•°çš„å˜åŒ–ç‡ å‡ ä¸ªå¾®åˆ†çš„ä¾‹å­ï¼š\nä¸Šé¢çš„ä¾‹å­éƒ½æ˜¯å•å˜é‡çš„å¾®åˆ†ï¼Œå½“ä¸€ä¸ªå‡½æ•°æœ‰å¤šä¸ªå˜é‡çš„æ—¶å€™ï¼Œå°±æœ‰äº†å¤šå˜é‡çš„å¾®åˆ†ï¼Œå³åˆ†åˆ«å¯¹æ¯ä¸ªå˜é‡è¿›è¡Œæ±‚å¾®åˆ†\næ¢¯åº¦ æ¢¯åº¦å®é™…ä¸Šå°±æ˜¯å¤šå˜é‡å¾®åˆ†çš„ä¸€èˆ¬åŒ–ã€‚ ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¢¯åº¦å°±æ˜¯åˆ†åˆ«å¯¹æ¯ä¸ªå˜é‡è¿›è¡Œå¾®åˆ†ï¼Œç„¶åç”¨é€—å·åˆ†å‰²å¼€ï¼Œæ¢¯åº¦æ˜¯ç”¨\u0026lt;\u0026gt;åŒ…æ‹¬èµ·æ¥ï¼Œè¯´æ˜æ¢¯åº¦å…¶å®ä¸€ä¸ªå‘é‡ã€‚\næ¢¯åº¦æ˜¯å¾®ç§¯åˆ†ä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼Œä¹‹å‰æåˆ°è¿‡æ¢¯åº¦çš„æ„ä¹‰\nåœ¨å•å˜é‡çš„å‡½æ•°ä¸­ï¼Œæ¢¯åº¦å…¶å®å°±æ˜¯å‡½æ•°çš„å¾®åˆ†ï¼Œä»£è¡¨ç€å‡½æ•°åœ¨æŸä¸ªç»™å®šç‚¹çš„åˆ‡çº¿çš„æ–œç‡ åœ¨å¤šå˜é‡å‡½æ•°ä¸­ï¼Œæ¢¯åº¦æ˜¯ä¸€ä¸ªå‘é‡ï¼Œå‘é‡æœ‰æ–¹å‘ï¼Œæ¢¯åº¦çš„æ–¹å‘å°±æŒ‡å‡ºäº†å‡½æ•°åœ¨ç»™å®šç‚¹çš„ä¸Šå‡æœ€å¿«çš„æ–¹å‘ è¿™ä¹Ÿå°±è¯´æ˜äº†ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦åƒæ–¹ç™¾è®¡çš„æ±‚å–æ¢¯åº¦ï¼æˆ‘ä»¬éœ€è¦åˆ°è¾¾å±±åº•ï¼Œå°±éœ€è¦åœ¨æ¯ä¸€æ­¥è§‚æµ‹åˆ°æ­¤æ—¶æœ€é™¡å³­çš„åœ°æ–¹ï¼Œæ¢¯åº¦å°±æ°å·§å‘Šè¯‰äº†æˆ‘ä»¬è¿™ä¸ªæ–¹å‘ã€‚æ¢¯åº¦çš„æ–¹å‘æ˜¯å‡½æ•°åœ¨ç»™å®šç‚¹ä¸Šå‡æœ€å¿«çš„æ–¹å‘ï¼Œé‚£ä¹ˆæ¢¯åº¦çš„åæ–¹å‘å°±æ˜¯å‡½æ•°åœ¨ç»™å®šç‚¹ä¸‹é™æœ€å¿«çš„æ–¹å‘ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ã€‚æ‰€ä»¥æˆ‘ä»¬åªè¦æ²¿ç€æ¢¯åº¦çš„æ–¹å‘ä¸€ç›´èµ°ï¼Œå°±èƒ½èµ°åˆ°å±€éƒ¨çš„æœ€ä½ç‚¹ï¼\næ¢¯åº¦ä¸‹é™ç®—æ³•çš„æ•°å­¦è§£é‡Š ä¸Šé¢æˆ‘ä»¬èŠ±äº†å¤§é‡çš„ç¯‡å¹…ä»‹ç»æ¢¯åº¦ä¸‹é™ç®—æ³•çš„åŸºæœ¬æ€æƒ³å’Œåœºæ™¯å‡è®¾ï¼Œä»¥åŠæ¢¯åº¦çš„æ¦‚å¿µå’Œæ€æƒ³ã€‚ä¸‹é¢æˆ‘ä»¬å°±å¼€å§‹ä»æ•°å­¦ä¸Šè§£é‡Šæ¢¯åº¦ä¸‹é™ç®—æ³•çš„è®¡ç®—è¿‡ç¨‹å’Œæ€æƒ³ï¼ æ­¤å…¬å¼çš„æ„ä¹‰æ˜¯ï¼šJæ˜¯å…³äºÎ˜çš„ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å½“å‰æ‰€å¤„çš„ä½ç½®ä¸ºÎ˜0ç‚¹ï¼Œè¦ä»è¿™ä¸ªç‚¹èµ°åˆ°Jçš„æœ€å°å€¼ç‚¹ï¼Œä¹Ÿå°±æ˜¯å±±åº•ã€‚é¦–å…ˆæˆ‘ä»¬å…ˆç¡®å®šå‰è¿›çš„æ–¹å‘ï¼Œä¹Ÿå°±æ˜¯æ¢¯åº¦çš„åå‘ï¼Œç„¶åèµ°ä¸€æ®µè·ç¦»çš„æ­¥é•¿ï¼Œä¹Ÿå°±æ˜¯Î±ï¼Œèµ°å®Œè¿™ä¸ªæ®µæ­¥é•¿ï¼Œå°±åˆ°è¾¾äº†Î˜1è¿™ä¸ªç‚¹ï¼\nä¸‹é¢å°±è¿™ä¸ªå…¬å¼çš„å‡ ä¸ªå¸¸è§çš„ç–‘é—®ï¼š\nÎ±æ˜¯ä»€ä¹ˆå«ä¹‰ï¼Ÿ Î±åœ¨æ¢¯åº¦ä¸‹é™ç®—æ³•ä¸­è¢«ç§°ä½œä¸ºå­¦ä¹ ç‡æˆ–è€…æ­¥é•¿ï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡Î±æ¥æ§åˆ¶æ¯ä¸€æ­¥èµ°çš„è·ç¦»ï¼Œä»¥ä¿è¯ä¸è¦æ­¥å­è·¨çš„å¤ªå¤§æ‰¯ç€è›‹ï¼Œå“ˆå“ˆï¼Œå…¶å®å°±æ˜¯ä¸è¦èµ°å¤ªå¿«ï¼Œé”™è¿‡äº†æœ€ä½ç‚¹ã€‚åŒæ—¶ä¹Ÿè¦ä¿è¯ä¸è¦èµ°çš„å¤ªæ…¢ï¼Œå¯¼è‡´å¤ªé˜³ä¸‹å±±äº†ï¼Œè¿˜æ²¡æœ‰èµ°åˆ°å±±ä¸‹ã€‚æ‰€ä»¥Î±çš„é€‰æ‹©åœ¨æ¢¯åº¦ä¸‹é™æ³•ä¸­å¾€å¾€æ˜¯å¾ˆé‡è¦çš„ï¼Î±ä¸èƒ½å¤ªå¤§ä¹Ÿä¸èƒ½å¤ªå°ï¼Œå¤ªå°çš„è¯ï¼Œå¯èƒ½å¯¼è‡´è¿Ÿè¿Ÿèµ°ä¸åˆ°æœ€ä½ç‚¹ï¼Œå¤ªå¤§çš„è¯ï¼Œä¼šå¯¼è‡´é”™è¿‡æœ€ä½ç‚¹ï¼ ä¸ºä»€ä¹ˆè¦æ¢¯åº¦è¦ä¹˜ä»¥ä¸€ä¸ªè´Ÿå·ï¼Ÿ æ¢¯åº¦å‰åŠ ä¸€ä¸ªè´Ÿå·ï¼Œå°±æ„å‘³ç€æœç€æ¢¯åº¦ç›¸åçš„æ–¹å‘å‰è¿›ï¼æˆ‘ä»¬åœ¨å‰æ–‡æåˆ°ï¼Œæ¢¯åº¦çš„æ–¹å‘å®é™…å°±æ˜¯å‡½æ•°åœ¨æ­¤ç‚¹ä¸Šå‡æœ€å¿«çš„æ–¹å‘ï¼è€Œæˆ‘ä»¬éœ€è¦æœç€ä¸‹é™æœ€å¿«çš„æ–¹å‘èµ°ï¼Œè‡ªç„¶å°±æ˜¯è´Ÿçš„æ¢¯åº¦çš„æ–¹å‘ï¼Œæ‰€ä»¥æ­¤å¤„éœ€è¦åŠ ä¸Šè´Ÿå·\næ¢¯åº¦ä¸‹é™ç®—æ³•çš„å®ä¾‹ æˆ‘ä»¬å·²ç»åŸºæœ¬äº†è§£äº†æ¢¯åº¦ä¸‹é™ç®—æ³•çš„è®¡ç®—è¿‡ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥çœ‹å‡ ä¸ªæ¢¯åº¦ä¸‹é™ç®—æ³•çš„å°å®ä¾‹ï¼Œé¦–å…ˆä»å•å˜é‡çš„å‡½æ•°å¼€å§‹\nå•å˜é‡å‡½æ•°çš„æ¢¯åº¦ä¸‹é™ æˆ‘ä»¬å‡è®¾æœ‰ä¸€ä¸ªå•å˜é‡çš„å‡½æ•°\nå‡½æ•°çš„å¾®åˆ† åˆå§‹åŒ–ï¼Œèµ·ç‚¹ä¸º å­¦ä¹ ç‡ä¸º æ ¹æ®æ¢¯åº¦ä¸‹é™çš„è®¡ç®—å…¬å¼\næˆ‘ä»¬å¼€å§‹è¿›è¡Œæ¢¯åº¦ä¸‹é™çš„è¿­ä»£è®¡ç®—è¿‡ç¨‹ï¼š\nimage.png\nå¦‚å›¾ï¼Œç»è¿‡å››æ¬¡çš„è¿ç®—ï¼Œä¹Ÿå°±æ˜¯èµ°äº†å››æ­¥ï¼ŒåŸºæœ¬å°±æŠµè¾¾äº†å‡½æ•°çš„æœ€ä½ç‚¹ï¼Œä¹Ÿå°±æ˜¯å±±åº•\nå¤šå˜é‡å‡½æ•°çš„æ¢¯åº¦ä¸‹é™ æˆ‘ä»¬å‡è®¾æœ‰ä¸€ä¸ªç›®æ ‡å‡½æ•°\nç°åœ¨è¦é€šè¿‡æ¢¯åº¦ä¸‹é™æ³•è®¡ç®—è¿™ä¸ªå‡½æ•°çš„æœ€å°å€¼ã€‚æˆ‘ä»¬é€šè¿‡è§‚å¯Ÿå°±èƒ½å‘ç°æœ€å°å€¼å…¶å®å°±æ˜¯ (0ï¼Œ0)ç‚¹ã€‚ä½†æ˜¯æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼šä»æ¢¯åº¦ä¸‹é™ç®—æ³•å¼€å§‹ä¸€æ­¥æ­¥è®¡ç®—åˆ°è¿™ä¸ªæœ€å°å€¼ï¼ æˆ‘ä»¬å‡è®¾åˆå§‹çš„èµ·ç‚¹ä¸ºï¼š\nåˆå§‹çš„å­¦ä¹ ç‡ä¸ºï¼š\nå‡½æ•°çš„æ¢¯åº¦ä¸ºï¼š\nè¿›è¡Œå¤šæ¬¡è¿­ä»£ï¼š\næˆ‘ä»¬å‘ç°ï¼Œå·²ç»åŸºæœ¬é è¿‘å‡½æ•°çš„æœ€å°å€¼ç‚¹\næ¢¯åº¦ä¸‹é™ç®—æ³•çš„å®ç° ä¸‹é¢æˆ‘ä»¬å°†ç”¨pythonå®ç°ä¸€ä¸ªç®€å•çš„æ¢¯åº¦ä¸‹é™ç®—æ³•ã€‚åœºæ™¯æ˜¯ä¸€ä¸ªç®€å•çš„çº¿æ€§å›å½’çš„ä¾‹å­ï¼šå‡è®¾ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ç³»åˆ—çš„ç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\næˆ‘ä»¬å°†ç”¨æ¢¯åº¦ä¸‹é™æ³•æ¥æ‹Ÿåˆå‡ºè¿™æ¡ç›´çº¿ï¼\né¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªä»£ä»·å‡½æ•°ï¼Œåœ¨æ­¤æˆ‘ä»¬é€‰ç”¨å‡æ–¹è¯¯å·®ä»£ä»·å‡½æ•°\næ­¤å…¬å¼ä¸­\nmæ˜¯æ•°æ®é›†ä¸­ç‚¹çš„ä¸ªæ•°\nÂ½æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œè¿™æ ·æ˜¯ä¸ºäº†åœ¨æ±‚æ¢¯åº¦çš„æ—¶å€™ï¼ŒäºŒæ¬¡æ–¹ä¹˜ä¸‹æ¥å°±å’Œè¿™é‡Œçš„Â½æŠµæ¶ˆäº†ï¼Œè‡ªç„¶å°±æ²¡æœ‰å¤šä½™çš„å¸¸æ•°ç³»æ•°ï¼Œæ–¹ä¾¿åç»­çš„è®¡ç®—ï¼ŒåŒæ—¶å¯¹ç»“æœä¸ä¼šæœ‰å½±å“\ny æ˜¯æ•°æ®é›†ä¸­æ¯ä¸ªç‚¹çš„çœŸå®yåæ ‡çš„å€¼\nh æ˜¯æˆ‘ä»¬çš„é¢„æµ‹å‡½æ•°ï¼Œæ ¹æ®æ¯ä¸€ä¸ªè¾“å…¥xï¼Œæ ¹æ®Î˜ è®¡ç®—å¾—åˆ°é¢„æµ‹çš„yå€¼ï¼Œå³\næˆ‘ä»¬å¯ä»¥æ ¹æ®ä»£ä»·å‡½æ•°çœ‹åˆ°ï¼Œä»£ä»·å‡½æ•°ä¸­çš„å˜é‡æœ‰ä¸¤ä¸ªï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªå¤šå˜é‡çš„æ¢¯åº¦ä¸‹é™é—®é¢˜ï¼Œæ±‚è§£å‡ºä»£ä»·å‡½æ•°çš„æ¢¯åº¦ï¼Œä¹Ÿå°±æ˜¯åˆ†åˆ«å¯¹ä¸¤ä¸ªå˜é‡è¿›è¡Œå¾®åˆ†\næ˜ç¡®äº†ä»£ä»·å‡½æ•°å’Œæ¢¯åº¦ï¼Œä»¥åŠé¢„æµ‹çš„å‡½æ•°å½¢å¼ã€‚æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ç¼–å†™ä»£ç äº†ã€‚ä½†åœ¨è¿™ä¹‹å‰ï¼Œéœ€è¦è¯´æ˜ä¸€ç‚¹ï¼Œå°±æ˜¯ä¸ºäº†æ–¹ä¾¿ä»£ç çš„ç¼–å†™ï¼Œæˆ‘ä»¬ä¼šå°†æ‰€æœ‰çš„å…¬å¼éƒ½è½¬æ¢ä¸ºçŸ©é˜µçš„å½¢å¼ï¼Œpythonä¸­è®¡ç®—çŸ©é˜µæ˜¯éå¸¸æ–¹ä¾¿çš„ï¼ŒåŒæ—¶ä»£ç ä¹Ÿä¼šå˜å¾—éå¸¸çš„ç®€æ´ã€‚\nä¸ºäº†è½¬æ¢ä¸ºçŸ©é˜µçš„è®¡ç®—ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°é¢„æµ‹å‡½æ•°çš„å½¢å¼\næˆ‘ä»¬æœ‰ä¸¤ä¸ªå˜é‡ï¼Œä¸ºäº†å¯¹è¿™ä¸ªå…¬å¼è¿›è¡ŒçŸ©é˜µåŒ–ï¼Œæˆ‘ä»¬å¯ä»¥ç»™æ¯ä¸€ä¸ªç‚¹xå¢åŠ ä¸€ç»´ï¼Œè¿™ä¸€ç»´çš„å€¼å›ºå®šä¸º1ï¼Œè¿™ä¸€ç»´å°†ä¼šä¹˜åˆ°Î˜0ä¸Šã€‚è¿™æ ·å°±æ–¹ä¾¿æˆ‘ä»¬ç»Ÿä¸€çŸ©é˜µåŒ–çš„è®¡ç®—\nç„¶åæˆ‘ä»¬å°†ä»£ä»·å‡½æ•°å’Œæ¢¯åº¦è½¬åŒ–ä¸ºçŸ©é˜µå‘é‡ç›¸ä¹˜çš„å½¢å¼\ncoding time é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰æ•°æ®é›†å’Œå­¦ä¹ ç‡\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 import numpy as np # Size of the points dataset. m = 20 # Points x-coordinate and dummy value (x0, x1). X0 = np.ones((m, 1)) X1 = np.arange(1, m+1).reshape(m, 1) X = np.hstack((X0, X1)) # Points y-coordinate y = np.array([ 3, 4, 5, 5, 2, 4, 7, 8, 11, 8, 12, 11, 13, 13, 16, 17, 18, 17, 19, 21 ]).reshape(m, 1) # The Learning Rate alpha. alpha = 0.01 æ¥ä¸‹æ¥æˆ‘ä»¬ä»¥çŸ©é˜µå‘é‡çš„å½¢å¼å®šä¹‰ä»£ä»·å‡½æ•°å’Œä»£ä»·å‡½æ•°çš„æ¢¯åº¦\n1 2 3 4 5 6 7 8 9 def error_function(theta, X, y): \u0026#39;\u0026#39;\u0026#39;Error function J definition.\u0026#39;\u0026#39;\u0026#39; diff = np.dot(X, theta) - y return (1./2*m) * np.dot(np.transpose(diff), diff) def gradient_function(theta, X, y): \u0026#39;\u0026#39;\u0026#39;Gradient of the function J definition.\u0026#39;\u0026#39;\u0026#39; diff = np.dot(X, theta) - y return (1./m) * np.dot(np.transpose(X), diff) æœ€åå°±æ˜¯ç®—æ³•çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œæ¢¯åº¦ä¸‹é™è¿­ä»£è®¡ç®—\n1 2 3 4 5 6 7 8 def gradient_descent(X, y, alpha): \u0026#39;\u0026#39;\u0026#39;Perform gradient descent.\u0026#39;\u0026#39;\u0026#39; theta = np.array([1, 1]).reshape(2, 1) gradient = gradient_function(theta, X, y) while not np.all(np.absolute(gradient) \u0026lt;= 1e-5): theta = theta - alpha * gradient gradient = gradient_function(theta, X, y) return theta å½“æ¢¯åº¦å°äº1e-5æ—¶ï¼Œè¯´æ˜å·²ç»è¿›å…¥äº†æ¯”è¾ƒå¹³æ»‘çš„çŠ¶æ€ï¼Œç±»ä¼¼äºå±±è°·çš„çŠ¶æ€ï¼Œè¿™æ—¶å€™å†ç»§ç»­è¿­ä»£æ•ˆæœä¹Ÿä¸å¤§äº†ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å¯ä»¥é€€å‡ºå¾ªç¯ï¼\nå®Œæ•´çš„ä»£ç å¦‚ä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 import numpy as np # Size of the points dataset. m = 20 # Points x-coordinate and dummy value (x0, x1). X0 = np.ones((m, 1)) X1 = np.arange(1, m+1).reshape(m, 1) X = np.hstack((X0, X1)) # Points y-coordinate y = np.array([ 3, 4, 5, 5, 2, 4, 7, 8, 11, 8, 12, 11, 13, 13, 16, 17, 18, 17, 19, 21 ]).reshape(m, 1) # The Learning Rate alpha. alpha = 0.01 def error_function(theta, X, y): \u0026#39;\u0026#39;\u0026#39;Error function J definition.\u0026#39;\u0026#39;\u0026#39; diff = np.dot(X, theta) - y return (1./2*m) * np.dot(np.transpose(diff), diff) def gradient_function(theta, X, y): \u0026#39;\u0026#39;\u0026#39;Gradient of the function J definition.\u0026#39;\u0026#39;\u0026#39; diff = np.dot(X, theta) - y return (1./m) * np.dot(np.transpose(X), diff) def gradient_descent(X, y, alpha): \u0026#39;\u0026#39;\u0026#39;Perform gradient descent.\u0026#39;\u0026#39;\u0026#39; theta = np.array([1, 1]).reshape(2, 1) gradient = gradient_function(theta, X, y) while not np.all(np.absolute(gradient) \u0026lt;= 1e-5): theta = theta - alpha * gradient gradient = gradient_function(theta, X, y) return theta optimal = gradient_descent(X, y, alpha) print(\u0026#39;optimal:\u0026#39;, optimal) print(\u0026#39;error function:\u0026#39;, error_function(optimal, X, y)[0,0]) è¿è¡Œä»£ç ï¼Œè®¡ç®—å¾—åˆ°çš„ç»“æœå¦‚ä¸‹\næ‰€æ‹Ÿåˆå‡ºçš„ç›´çº¿å¦‚ä¸‹\nå°ç»“ è‡³æ­¤ï¼Œæˆ‘ä»¬å°±åŸºæœ¬ä»‹ç»å®Œäº†æ¢¯åº¦ä¸‹é™æ³•çš„åŸºæœ¬æ€æƒ³å’Œç®—æ³•æµç¨‹ï¼Œå¹¶ä¸”ç”¨pythonå®ç°äº†ä¸€ä¸ªç®€å•çš„æ¢¯åº¦ä¸‹é™ç®—æ³•æ‹Ÿåˆç›´çº¿çš„æ¡ˆä¾‹ï¼ æœ€åï¼Œæˆ‘ä»¬å›åˆ°æ–‡ç« å¼€å¤´æ‰€æå‡ºçš„åœºæ™¯å‡è®¾: è¿™ä¸ªä¸‹å±±çš„äººå®é™…ä¸Šå°±ä»£è¡¨äº†åå‘ä¼ æ’­ç®—æ³•ï¼Œä¸‹å±±çš„è·¯å¾„å…¶å®å°±ä»£è¡¨ç€ç®—æ³•ä¸­ä¸€ç›´åœ¨å¯»æ‰¾çš„å‚æ•°Î˜ï¼Œå±±ä¸Šå½“å‰ç‚¹çš„æœ€é™¡å³­çš„æ–¹å‘å®é™…ä¸Šå°±æ˜¯ä»£ä»·å‡½æ•°åœ¨è¿™ä¸€ç‚¹çš„æ¢¯åº¦æ–¹å‘ï¼Œåœºæ™¯ä¸­è§‚æµ‹æœ€é™¡å³­æ–¹å‘æ‰€ç”¨çš„å·¥å…·å°±æ˜¯å¾®åˆ† ã€‚åœ¨ä¸‹ä¸€æ¬¡è§‚æµ‹ä¹‹å‰çš„æ—¶é—´å°±æ˜¯æœ‰æˆ‘ä»¬ç®—æ³•ä¸­çš„å­¦ä¹ ç‡Î±æ‰€å®šä¹‰çš„ã€‚ å¯ä»¥çœ‹åˆ°åœºæ™¯å‡è®¾å’Œæ¢¯åº¦ä¸‹é™ç®—æ³•å¾ˆå¥½çš„å®Œæˆäº†å¯¹åº”ï¼\n","permalink":"https://reid00.github.io/en/posts/ml/%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D%E5%8E%9F%E7%90%86%E4%BB%8B%E7%BB%8D/","summary":"Summary æœ¬æ–‡å°†ä»ä¸€ä¸ªä¸‹å±±çš„åœºæ™¯å¼€å§‹ï¼Œå…ˆæå‡ºæ¢¯åº¦ä¸‹é™ç®—æ³•çš„åŸºæœ¬æ€æƒ³ï¼Œè¿›è€Œä»æ•°å­¦ä¸Šè§£é‡Šæ¢¯åº¦ä¸‹é™ç®—æ³•çš„åŸç†ï¼Œæœ€åå®ç°ä¸€ä¸ªç®€å•çš„æ¢¯åº¦ä¸‹é™ç®—æ³•çš„å®ä¾‹ï¼\næ¢¯åº¦ä¸‹é™çš„åœºæ™¯å‡è®¾ æ¢¯åº¦ä¸‹é™æ³•çš„åŸºæœ¬æ€æƒ³å¯ä»¥ç±»æ¯”ä¸ºä¸€ä¸ªä¸‹å±±çš„è¿‡ç¨‹ã€‚å‡è®¾è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šä¸€ä¸ªäººè¢«å›°åœ¨å±±ä¸Šï¼Œéœ€è¦ä»å±±ä¸Šä¸‹æ¥(i.e. æ‰¾åˆ°å±±çš„æœ€ä½ç‚¹ï¼Œä¹Ÿå°±æ˜¯å±±è°·)ã€‚ä½†æ­¤æ—¶å±±ä¸Šçš„æµ“é›¾å¾ˆå¤§ï¼Œå¯¼è‡´å¯è§†åº¦å¾ˆä½ã€‚å› æ­¤ï¼Œä¸‹å±±çš„è·¯å¾„å°±æ— æ³•ç¡®å®šï¼Œä»–å¿…é¡»åˆ©ç”¨è‡ªå·±å‘¨å›´çš„ä¿¡æ¯å»æ‰¾åˆ°ä¸‹å±±çš„è·¯å¾„ã€‚è¿™ä¸ªæ—¶å€™ï¼Œä»–å°±å¯ä»¥åˆ©ç”¨æ¢¯åº¦ä¸‹é™ç®—æ³•æ¥å¸®åŠ©è‡ªå·±ä¸‹å±±ã€‚å…·ä½“æ¥è¯´å°±æ˜¯ï¼Œä»¥ä»–å½“å‰çš„æ‰€å¤„çš„ä½ç½®ä¸ºåŸºå‡†ï¼Œå¯»æ‰¾è¿™ä¸ªä½ç½®æœ€é™¡å³­çš„åœ°æ–¹ï¼Œç„¶åæœç€å±±çš„é«˜åº¦ä¸‹é™çš„åœ°æ–¹èµ°ï¼ŒåŒç†ï¼Œå¦‚æœæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä¸Šå±±ï¼Œä¹Ÿå°±æ˜¯çˆ¬åˆ°å±±é¡¶ï¼Œé‚£ä¹ˆæ­¤æ—¶åº”è¯¥æ˜¯æœç€æœ€é™¡å³­çš„æ–¹å‘å¾€ä¸Šèµ°ã€‚ç„¶åæ¯èµ°ä¸€æ®µè·ç¦»ï¼Œéƒ½åå¤é‡‡ç”¨åŒä¸€ä¸ªæ–¹æ³•ï¼Œæœ€åå°±èƒ½æˆåŠŸçš„æŠµè¾¾å±±è°·ã€‚\næˆ‘ä»¬åŒæ—¶å¯ä»¥å‡è®¾è¿™åº§å±±æœ€é™¡å³­çš„åœ°æ–¹æ˜¯æ— æ³•é€šè¿‡è‚‰çœ¼ç«‹é©¬è§‚å¯Ÿå‡ºæ¥çš„ï¼Œè€Œæ˜¯éœ€è¦ä¸€ä¸ªå¤æ‚çš„å·¥å…·æ¥æµ‹é‡ï¼ŒåŒæ—¶ï¼Œè¿™ä¸ªäººæ­¤æ—¶æ­£å¥½æ‹¥æœ‰æµ‹é‡å‡ºæœ€é™¡å³­æ–¹å‘çš„èƒ½åŠ›ã€‚æ‰€ä»¥ï¼Œæ­¤äººæ¯èµ°ä¸€æ®µè·ç¦»ï¼Œéƒ½éœ€è¦ä¸€æ®µæ—¶é—´æ¥æµ‹é‡æ‰€åœ¨ä½ç½®æœ€é™¡å³­çš„æ–¹å‘ï¼Œè¿™æ˜¯æ¯”è¾ƒè€—æ—¶çš„ã€‚é‚£ä¹ˆä¸ºäº†åœ¨å¤ªé˜³ä¸‹å±±ä¹‹å‰åˆ°è¾¾å±±åº•ï¼Œå°±è¦å°½å¯èƒ½çš„å‡å°‘æµ‹é‡æ–¹å‘çš„æ¬¡æ•°ã€‚è¿™æ˜¯ä¸€ä¸ªä¸¤éš¾çš„é€‰æ‹©ï¼Œå¦‚æœæµ‹é‡çš„é¢‘ç¹ï¼Œå¯ä»¥ä¿è¯ä¸‹å±±çš„æ–¹å‘æ˜¯ç»å¯¹æ­£ç¡®çš„ï¼Œä½†åˆéå¸¸è€—æ—¶ï¼Œå¦‚æœæµ‹é‡çš„è¿‡å°‘ï¼Œåˆæœ‰åç¦»è½¨é“çš„é£é™©ã€‚æ‰€ä»¥éœ€è¦æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„æµ‹é‡æ–¹å‘çš„é¢‘ç‡ï¼Œæ¥ç¡®ä¿ä¸‹å±±çš„æ–¹å‘ä¸é”™è¯¯ï¼ŒåŒæ—¶åˆä¸è‡³äºè€—æ—¶å¤ªå¤šï¼\næ¢¯åº¦ä¸‹é™ é¦–å…ˆï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¯å¾®åˆ†çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°å°±ä»£è¡¨ç€ä¸€åº§å±±ã€‚æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æ‰¾åˆ°è¿™ä¸ªå‡½æ•°çš„æœ€å°å€¼ï¼Œä¹Ÿå°±æ˜¯å±±åº•ã€‚æ ¹æ®ä¹‹å‰çš„åœºæ™¯å‡è®¾ï¼Œæœ€å¿«çš„ä¸‹å±±çš„æ–¹å¼å°±æ˜¯æ‰¾åˆ°å½“å‰ä½ç½®æœ€é™¡å³­çš„æ–¹å‘ï¼Œç„¶åæ²¿ç€æ­¤æ–¹å‘å‘ä¸‹èµ°ï¼Œå¯¹åº”åˆ°å‡½æ•°ä¸­ï¼Œå°±æ˜¯æ‰¾åˆ°ç»™å®šç‚¹çš„æ¢¯åº¦ ï¼Œç„¶åæœç€æ¢¯åº¦ç›¸åçš„æ–¹å‘ï¼Œå°±èƒ½è®©å‡½æ•°å€¼ä¸‹é™çš„æœ€å¿«ï¼å› ä¸ºæ¢¯åº¦çš„æ–¹å‘å°±æ˜¯å‡½æ•°ä¹‹å˜åŒ–æœ€å¿«çš„æ–¹å‘(åœ¨åé¢ä¼šè¯¦ç»†è§£é‡Š) æ‰€ä»¥ï¼Œæˆ‘ä»¬é‡å¤åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œåå¤æ±‚å–æ¢¯åº¦ï¼Œæœ€åå°±èƒ½åˆ°è¾¾å±€éƒ¨çš„æœ€å°å€¼ï¼Œè¿™å°±ç±»ä¼¼äºæˆ‘ä»¬ä¸‹å±±çš„è¿‡ç¨‹ã€‚è€Œæ±‚å–æ¢¯åº¦å°±ç¡®å®šäº†æœ€é™¡å³­çš„æ–¹å‘ï¼Œä¹Ÿå°±æ˜¯åœºæ™¯ä¸­æµ‹é‡æ–¹å‘çš„æ‰‹æ®µã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆæ¢¯åº¦çš„æ–¹å‘å°±æ˜¯æœ€é™¡å³­çš„æ–¹å‘å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»å¾®åˆ†å¼€å§‹è®²èµ·\nå¾®åˆ† çœ‹å¾…å¾®åˆ†çš„æ„ä¹‰ï¼Œå¯ä»¥æœ‰ä¸åŒçš„è§’åº¦ï¼Œæœ€å¸¸ç”¨çš„ä¸¤ç§æ˜¯ï¼š\nå‡½æ•°å›¾åƒä¸­ï¼ŒæŸç‚¹çš„åˆ‡çº¿çš„æ–œç‡\nå‡½æ•°çš„å˜åŒ–ç‡ å‡ ä¸ªå¾®åˆ†çš„ä¾‹å­ï¼š\nä¸Šé¢çš„ä¾‹å­éƒ½æ˜¯å•å˜é‡çš„å¾®åˆ†ï¼Œå½“ä¸€ä¸ªå‡½æ•°æœ‰å¤šä¸ªå˜é‡çš„æ—¶å€™ï¼Œå°±æœ‰äº†å¤šå˜é‡çš„å¾®åˆ†ï¼Œå³åˆ†åˆ«å¯¹æ¯ä¸ªå˜é‡è¿›è¡Œæ±‚å¾®åˆ†\næ¢¯åº¦ æ¢¯åº¦å®é™…ä¸Šå°±æ˜¯å¤šå˜é‡å¾®åˆ†çš„ä¸€èˆ¬åŒ–ã€‚ ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¢¯åº¦å°±æ˜¯åˆ†åˆ«å¯¹æ¯ä¸ªå˜é‡è¿›è¡Œå¾®åˆ†ï¼Œç„¶åç”¨é€—å·åˆ†å‰²å¼€ï¼Œæ¢¯åº¦æ˜¯ç”¨\u0026lt;\u0026gt;åŒ…æ‹¬èµ·æ¥ï¼Œè¯´æ˜æ¢¯åº¦å…¶å®ä¸€ä¸ªå‘é‡ã€‚\næ¢¯åº¦æ˜¯å¾®ç§¯åˆ†ä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼Œä¹‹å‰æåˆ°è¿‡æ¢¯åº¦çš„æ„ä¹‰\nåœ¨å•å˜é‡çš„å‡½æ•°ä¸­ï¼Œæ¢¯åº¦å…¶å®å°±æ˜¯å‡½æ•°çš„å¾®åˆ†ï¼Œä»£è¡¨ç€å‡½æ•°åœ¨æŸä¸ªç»™å®šç‚¹çš„åˆ‡çº¿çš„æ–œç‡ åœ¨å¤šå˜é‡å‡½æ•°ä¸­ï¼Œæ¢¯åº¦æ˜¯ä¸€ä¸ªå‘é‡ï¼Œå‘é‡æœ‰æ–¹å‘ï¼Œæ¢¯åº¦çš„æ–¹å‘å°±æŒ‡å‡ºäº†å‡½æ•°åœ¨ç»™å®šç‚¹çš„ä¸Šå‡æœ€å¿«çš„æ–¹å‘ è¿™ä¹Ÿå°±è¯´æ˜äº†ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦åƒæ–¹ç™¾è®¡çš„æ±‚å–æ¢¯åº¦ï¼æˆ‘ä»¬éœ€è¦åˆ°è¾¾å±±åº•ï¼Œå°±éœ€è¦åœ¨æ¯ä¸€æ­¥è§‚æµ‹åˆ°æ­¤æ—¶æœ€é™¡å³­çš„åœ°æ–¹ï¼Œæ¢¯åº¦å°±æ°å·§å‘Šè¯‰äº†æˆ‘ä»¬è¿™ä¸ªæ–¹å‘ã€‚æ¢¯åº¦çš„æ–¹å‘æ˜¯å‡½æ•°åœ¨ç»™å®šç‚¹ä¸Šå‡æœ€å¿«çš„æ–¹å‘ï¼Œé‚£ä¹ˆæ¢¯åº¦çš„åæ–¹å‘å°±æ˜¯å‡½æ•°åœ¨ç»™å®šç‚¹ä¸‹é™æœ€å¿«çš„æ–¹å‘ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ã€‚æ‰€ä»¥æˆ‘ä»¬åªè¦æ²¿ç€æ¢¯åº¦çš„æ–¹å‘ä¸€ç›´èµ°ï¼Œå°±èƒ½èµ°åˆ°å±€éƒ¨çš„æœ€ä½ç‚¹ï¼\næ¢¯åº¦ä¸‹é™ç®—æ³•çš„æ•°å­¦è§£é‡Š ä¸Šé¢æˆ‘ä»¬èŠ±äº†å¤§é‡çš„ç¯‡å¹…ä»‹ç»æ¢¯åº¦ä¸‹é™ç®—æ³•çš„åŸºæœ¬æ€æƒ³å’Œåœºæ™¯å‡è®¾ï¼Œä»¥åŠæ¢¯åº¦çš„æ¦‚å¿µå’Œæ€æƒ³ã€‚ä¸‹é¢æˆ‘ä»¬å°±å¼€å§‹ä»æ•°å­¦ä¸Šè§£é‡Šæ¢¯åº¦ä¸‹é™ç®—æ³•çš„è®¡ç®—è¿‡ç¨‹å’Œæ€æƒ³ï¼ æ­¤å…¬å¼çš„æ„ä¹‰æ˜¯ï¼šJæ˜¯å…³äºÎ˜çš„ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å½“å‰æ‰€å¤„çš„ä½ç½®ä¸ºÎ˜0ç‚¹ï¼Œè¦ä»è¿™ä¸ªç‚¹èµ°åˆ°Jçš„æœ€å°å€¼ç‚¹ï¼Œä¹Ÿå°±æ˜¯å±±åº•ã€‚é¦–å…ˆæˆ‘ä»¬å…ˆç¡®å®šå‰è¿›çš„æ–¹å‘ï¼Œä¹Ÿå°±æ˜¯æ¢¯åº¦çš„åå‘ï¼Œç„¶åèµ°ä¸€æ®µè·ç¦»çš„æ­¥é•¿ï¼Œä¹Ÿå°±æ˜¯Î±ï¼Œèµ°å®Œè¿™ä¸ªæ®µæ­¥é•¿ï¼Œå°±åˆ°è¾¾äº†Î˜1è¿™ä¸ªç‚¹ï¼\nä¸‹é¢å°±è¿™ä¸ªå…¬å¼çš„å‡ ä¸ªå¸¸è§çš„ç–‘é—®ï¼š\nÎ±æ˜¯ä»€ä¹ˆå«ä¹‰ï¼Ÿ Î±åœ¨æ¢¯åº¦ä¸‹é™ç®—æ³•ä¸­è¢«ç§°ä½œä¸ºå­¦ä¹ ç‡æˆ–è€…æ­¥é•¿ï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡Î±æ¥æ§åˆ¶æ¯ä¸€æ­¥èµ°çš„è·ç¦»ï¼Œä»¥ä¿è¯ä¸è¦æ­¥å­è·¨çš„å¤ªå¤§æ‰¯ç€è›‹ï¼Œå“ˆå“ˆï¼Œå…¶å®å°±æ˜¯ä¸è¦èµ°å¤ªå¿«ï¼Œé”™è¿‡äº†æœ€ä½ç‚¹ã€‚åŒæ—¶ä¹Ÿè¦ä¿è¯ä¸è¦èµ°çš„å¤ªæ…¢ï¼Œå¯¼è‡´å¤ªé˜³ä¸‹å±±äº†ï¼Œè¿˜æ²¡æœ‰èµ°åˆ°å±±ä¸‹ã€‚æ‰€ä»¥Î±çš„é€‰æ‹©åœ¨æ¢¯åº¦ä¸‹é™æ³•ä¸­å¾€å¾€æ˜¯å¾ˆé‡è¦çš„ï¼Î±ä¸èƒ½å¤ªå¤§ä¹Ÿä¸èƒ½å¤ªå°ï¼Œå¤ªå°çš„è¯ï¼Œå¯èƒ½å¯¼è‡´è¿Ÿè¿Ÿèµ°ä¸åˆ°æœ€ä½ç‚¹ï¼Œå¤ªå¤§çš„è¯ï¼Œä¼šå¯¼è‡´é”™è¿‡æœ€ä½ç‚¹ï¼ ä¸ºä»€ä¹ˆè¦æ¢¯åº¦è¦ä¹˜ä»¥ä¸€ä¸ªè´Ÿå·ï¼Ÿ æ¢¯åº¦å‰åŠ ä¸€ä¸ªè´Ÿå·ï¼Œå°±æ„å‘³ç€æœç€æ¢¯åº¦ç›¸åçš„æ–¹å‘å‰è¿›ï¼æˆ‘ä»¬åœ¨å‰æ–‡æåˆ°ï¼Œæ¢¯åº¦çš„æ–¹å‘å®é™…å°±æ˜¯å‡½æ•°åœ¨æ­¤ç‚¹ä¸Šå‡æœ€å¿«çš„æ–¹å‘ï¼è€Œæˆ‘ä»¬éœ€è¦æœç€ä¸‹é™æœ€å¿«çš„æ–¹å‘èµ°ï¼Œè‡ªç„¶å°±æ˜¯è´Ÿçš„æ¢¯åº¦çš„æ–¹å‘ï¼Œæ‰€ä»¥æ­¤å¤„éœ€è¦åŠ ä¸Šè´Ÿå·\næ¢¯åº¦ä¸‹é™ç®—æ³•çš„å®ä¾‹ æˆ‘ä»¬å·²ç»åŸºæœ¬äº†è§£äº†æ¢¯åº¦ä¸‹é™ç®—æ³•çš„è®¡ç®—è¿‡ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥çœ‹å‡ ä¸ªæ¢¯åº¦ä¸‹é™ç®—æ³•çš„å°å®ä¾‹ï¼Œé¦–å…ˆä»å•å˜é‡çš„å‡½æ•°å¼€å§‹\nå•å˜é‡å‡½æ•°çš„æ¢¯åº¦ä¸‹é™ æˆ‘ä»¬å‡è®¾æœ‰ä¸€ä¸ªå•å˜é‡çš„å‡½æ•°\nå‡½æ•°çš„å¾®åˆ† åˆå§‹åŒ–ï¼Œèµ·ç‚¹ä¸º å­¦ä¹ ç‡ä¸º æ ¹æ®æ¢¯åº¦ä¸‹é™çš„è®¡ç®—å…¬å¼\næˆ‘ä»¬å¼€å§‹è¿›è¡Œæ¢¯åº¦ä¸‹é™çš„è¿­ä»£è®¡ç®—è¿‡ç¨‹ï¼š\nimage.png\nå¦‚å›¾ï¼Œç»è¿‡å››æ¬¡çš„è¿ç®—ï¼Œä¹Ÿå°±æ˜¯èµ°äº†å››æ­¥ï¼ŒåŸºæœ¬å°±æŠµè¾¾äº†å‡½æ•°çš„æœ€ä½ç‚¹ï¼Œä¹Ÿå°±æ˜¯å±±åº•\nå¤šå˜é‡å‡½æ•°çš„æ¢¯åº¦ä¸‹é™ æˆ‘ä»¬å‡è®¾æœ‰ä¸€ä¸ªç›®æ ‡å‡½æ•°\nç°åœ¨è¦é€šè¿‡æ¢¯åº¦ä¸‹é™æ³•è®¡ç®—è¿™ä¸ªå‡½æ•°çš„æœ€å°å€¼ã€‚æˆ‘ä»¬é€šè¿‡è§‚å¯Ÿå°±èƒ½å‘ç°æœ€å°å€¼å…¶å®å°±æ˜¯ (0ï¼Œ0)ç‚¹ã€‚ä½†æ˜¯æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼šä»æ¢¯åº¦ä¸‹é™ç®—æ³•å¼€å§‹ä¸€æ­¥æ­¥è®¡ç®—åˆ°è¿™ä¸ªæœ€å°å€¼ï¼ æˆ‘ä»¬å‡è®¾åˆå§‹çš„èµ·ç‚¹ä¸ºï¼š\nåˆå§‹çš„å­¦ä¹ ç‡ä¸ºï¼š\nå‡½æ•°çš„æ¢¯åº¦ä¸ºï¼š\nè¿›è¡Œå¤šæ¬¡è¿­ä»£ï¼š\næˆ‘ä»¬å‘ç°ï¼Œå·²ç»åŸºæœ¬é è¿‘å‡½æ•°çš„æœ€å°å€¼ç‚¹\næ¢¯åº¦ä¸‹é™ç®—æ³•çš„å®ç° ä¸‹é¢æˆ‘ä»¬å°†ç”¨pythonå®ç°ä¸€ä¸ªç®€å•çš„æ¢¯åº¦ä¸‹é™ç®—æ³•ã€‚åœºæ™¯æ˜¯ä¸€ä¸ªç®€å•çš„çº¿æ€§å›å½’çš„ä¾‹å­ï¼šå‡è®¾ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ç³»åˆ—çš„ç‚¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\næˆ‘ä»¬å°†ç”¨æ¢¯åº¦ä¸‹é™æ³•æ¥æ‹Ÿåˆå‡ºè¿™æ¡ç›´çº¿ï¼\né¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªä»£ä»·å‡½æ•°ï¼Œåœ¨æ­¤æˆ‘ä»¬é€‰ç”¨å‡æ–¹è¯¯å·®ä»£ä»·å‡½æ•°\næ­¤å…¬å¼ä¸­\nmæ˜¯æ•°æ®é›†ä¸­ç‚¹çš„ä¸ªæ•°\nÂ½æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œè¿™æ ·æ˜¯ä¸ºäº†åœ¨æ±‚æ¢¯åº¦çš„æ—¶å€™ï¼ŒäºŒæ¬¡æ–¹ä¹˜ä¸‹æ¥å°±å’Œè¿™é‡Œçš„Â½æŠµæ¶ˆäº†ï¼Œè‡ªç„¶å°±æ²¡æœ‰å¤šä½™çš„å¸¸æ•°ç³»æ•°ï¼Œæ–¹ä¾¿åç»­çš„è®¡ç®—ï¼ŒåŒæ—¶å¯¹ç»“æœä¸ä¼šæœ‰å½±å“\ny æ˜¯æ•°æ®é›†ä¸­æ¯ä¸ªç‚¹çš„çœŸå®yåæ ‡çš„å€¼\nh æ˜¯æˆ‘ä»¬çš„é¢„æµ‹å‡½æ•°ï¼Œæ ¹æ®æ¯ä¸€ä¸ªè¾“å…¥xï¼Œæ ¹æ®Î˜ è®¡ç®—å¾—åˆ°é¢„æµ‹çš„yå€¼ï¼Œå³\næˆ‘ä»¬å¯ä»¥æ ¹æ®ä»£ä»·å‡½æ•°çœ‹åˆ°ï¼Œä»£ä»·å‡½æ•°ä¸­çš„å˜é‡æœ‰ä¸¤ä¸ªï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªå¤šå˜é‡çš„æ¢¯åº¦ä¸‹é™é—®é¢˜ï¼Œæ±‚è§£å‡ºä»£ä»·å‡½æ•°çš„æ¢¯åº¦ï¼Œä¹Ÿå°±æ˜¯åˆ†åˆ«å¯¹ä¸¤ä¸ªå˜é‡è¿›è¡Œå¾®åˆ†\næ˜ç¡®äº†ä»£ä»·å‡½æ•°å’Œæ¢¯åº¦ï¼Œä»¥åŠé¢„æµ‹çš„å‡½æ•°å½¢å¼ã€‚æˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ç¼–å†™ä»£ç äº†ã€‚ä½†åœ¨è¿™ä¹‹å‰ï¼Œéœ€è¦è¯´æ˜ä¸€ç‚¹ï¼Œå°±æ˜¯ä¸ºäº†æ–¹ä¾¿ä»£ç çš„ç¼–å†™ï¼Œæˆ‘ä»¬ä¼šå°†æ‰€æœ‰çš„å…¬å¼éƒ½è½¬æ¢ä¸ºçŸ©é˜µçš„å½¢å¼ï¼Œpythonä¸­è®¡ç®—çŸ©é˜µæ˜¯éå¸¸æ–¹ä¾¿çš„ï¼ŒåŒæ—¶ä»£ç ä¹Ÿä¼šå˜å¾—éå¸¸çš„ç®€æ´ã€‚\nä¸ºäº†è½¬æ¢ä¸ºçŸ©é˜µçš„è®¡ç®—ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°é¢„æµ‹å‡½æ•°çš„å½¢å¼\næˆ‘ä»¬æœ‰ä¸¤ä¸ªå˜é‡ï¼Œä¸ºäº†å¯¹è¿™ä¸ªå…¬å¼è¿›è¡ŒçŸ©é˜µåŒ–ï¼Œæˆ‘ä»¬å¯ä»¥ç»™æ¯ä¸€ä¸ªç‚¹xå¢åŠ ä¸€ç»´ï¼Œè¿™ä¸€ç»´çš„å€¼å›ºå®šä¸º1ï¼Œè¿™ä¸€ç»´å°†ä¼šä¹˜åˆ°Î˜0ä¸Šã€‚è¿™æ ·å°±æ–¹ä¾¿æˆ‘ä»¬ç»Ÿä¸€çŸ©é˜µåŒ–çš„è®¡ç®—\nç„¶åæˆ‘ä»¬å°†ä»£ä»·å‡½æ•°å’Œæ¢¯åº¦è½¬åŒ–ä¸ºçŸ©é˜µå‘é‡ç›¸ä¹˜çš„å½¢å¼\ncoding time é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰æ•°æ®é›†å’Œå­¦ä¹ ç‡","title":"æ¢¯åº¦ä¸‹é™åŸç†ä»‹ç»"},{"content":"Summary æ•°æ®å’Œç‰¹å¾å†³å®šäº†æœºå™¨å­¦ä¹ çš„ä¸Šé™ï¼Œè€Œæ¨¡å‹å’Œç®—æ³•åªæ˜¯é€¼è¿‘è¿™ä¸ªä¸Šé™è€Œå·²ã€‚ç”±æ­¤å¯è§ï¼Œç‰¹å¾å·¥ç¨‹åœ¨æœºå™¨å­¦ä¹ ä¸­å æœ‰ç›¸å½“é‡è¦çš„åœ°ä½ã€‚åœ¨å®é™…åº”ç”¨å½“ä¸­ï¼Œå¯ä»¥è¯´ç‰¹å¾å·¥ç¨‹æ˜¯æœºå™¨å­¦ä¹ æˆåŠŸçš„å…³é”®ã€‚\nä»€ä¹ˆæ˜¯ç‰¹å¾å·¥ç¨‹ ç‰¹å¾å·¥ç¨‹åˆåŒ…å«äº†Data PreProcessingï¼ˆæ•°æ®é¢„å¤„ç†ï¼‰ã€Feature Extractionï¼ˆç‰¹å¾æå–ï¼‰ã€Feature Selectionï¼ˆç‰¹å¾é€‰æ‹©ï¼‰å’ŒFeature constructionï¼ˆç‰¹å¾æ„é€ ï¼‰ç­‰å­é—®é¢˜ï¼Œæœ¬ç« å†…å®¹ä¸»è¦è®¨è®ºæ•°æ®é¢„å¤„ç†çš„æ–¹æ³•åŠå®ç°ã€‚ ç‰¹å¾å·¥ç¨‹æ˜¯æœºå™¨å­¦ä¹ ä¸­æœ€é‡è¦çš„èµ·å§‹æ­¥éª¤ï¼Œæ•°æ®é¢„å¤„ç†æ˜¯ç‰¹å¾å·¥ç¨‹çš„æœ€é‡è¦çš„èµ·å§‹æ­¥éª¤ï¼Œè€Œæ•°æ®æ¸…æ´—æ˜¯æ•°æ®é¢„å¤„ç†çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¼šç›´æ¥å½±å“æœºå™¨å­¦ä¹ çš„æ•ˆæœã€‚\næ•°æ®æ¸…æ´—æ•´ä½“ä»‹ç» 1. ç®±çº¿å›¾åˆ†æå¼‚å¸¸å€¼ ç®±çº¿å›¾æä¾›äº†è¯†åˆ«å¼‚å¸¸å€¼çš„æ ‡å‡†ï¼Œå¦‚æœä¸€ä¸ªæ•°ä¸‹é›¨ QL-1.5IQR or å¤§äºOU + 1.5 IQR, åˆ™è¿™ä¸ªå€¼è¢«ç§°ä¸ºå¼‚å¸¸å€¼ã€‚\nQL ä¸‹å››åˆ†ä½æ•°ï¼Œè¡¨ç¤ºå››åˆ†ä¹‹ä¸€çš„æ•°æ®å€¼æ¯”å®ƒå° QUã€€ä¸Šå››åˆ†ä½æ•°ï¼Œè¡¨ç¤ºå››åˆ†ä¹‹ä¸€çš„æ•°æ®å€¼æ¯”å®ƒå¤§ IRQã€€å››åˆ†ä½è·ï¼Œæ˜¯QUï¼QLã€€çš„å·®å€¼ï¼ŒåŒ…å«äº†å…¨éƒ¨å…³å·®å€¼çš„ä¸€èˆ¬ 2. æ•°æ®çš„å…‰æ»‘å¤„ç† é™¤äº†æ£€æµ‹å‡ºå¼‚å¸¸å€¼ç„¶åå†å¤„ç†å¼‚å¸¸å€¼å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å¯¹å¼‚å¸¸æ•°æ®è¿›è¡Œå…‰æ»‘å¤„ç†ã€‚\n2.1. å˜é‡åˆ†ç®±ï¼ˆå³å˜é‡ç¦»æ•£åŒ–) ç¦»æ•£ç‰¹å¾çš„å¢åŠ å’Œå‡å°‘éƒ½å¾ˆå®¹æ˜“ï¼Œæ˜“äºæ¨¡å‹çš„å¿«é€Ÿè¿­ä»£ï¼› ç¨€ç–å‘é‡å†…ç§¯ä¹˜æ³•è¿ç®—é€Ÿåº¦å¿«ï¼Œè®¡ç®—ç»“æœæ–¹ä¾¿å­˜å‚¨ï¼Œå®¹æ˜“æ‰©å±•ï¼› ç¦»æ•£åŒ–åçš„ç‰¹å¾å¯¹å¼‚å¸¸æ•°æ®æœ‰å¾ˆå¼ºçš„é²æ£’æ€§ï¼šæ¯”å¦‚ä¸€ä¸ªç‰¹å¾æ˜¯å¹´é¾„\u0026gt;30æ˜¯1ï¼Œå¦åˆ™0ã€‚å¦‚æœç‰¹å¾æ²¡æœ‰ç¦»æ•£åŒ–ï¼Œä¸€ä¸ªå¼‚å¸¸æ•°æ®â€œå¹´é¾„300å²â€ä¼šç»™æ¨¡å‹é€ æˆå¾ˆå¤§çš„å¹²æ‰°ï¼› é€»è¾‘å›å½’å±äºå¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼Œè¡¨è¾¾èƒ½åŠ›å—é™ï¼›å•å˜é‡ç¦»æ•£åŒ–ä¸ºNä¸ªåï¼Œæ¯ä¸ªå˜é‡æœ‰å•ç‹¬çš„æƒé‡ï¼Œç›¸å½“äºä¸ºæ¨¡å‹å¼•å…¥äº†éçº¿æ€§ï¼Œèƒ½å¤Ÿæå‡æ¨¡å‹è¡¨è¾¾èƒ½åŠ›ï¼ŒåŠ å¤§æ‹Ÿåˆï¼› ç¦»æ•£åŒ–åå¯ä»¥è¿›è¡Œç‰¹å¾äº¤å‰ï¼Œç”±M+Nä¸ªå˜é‡å˜ä¸ºM*Nä¸ªå˜é‡ï¼Œè¿›ä¸€æ­¥å¼•å…¥éçº¿æ€§ï¼Œæå‡è¡¨è¾¾èƒ½åŠ›ï¼› ç‰¹å¾ç¦»æ•£åŒ–åï¼Œæ¨¡å‹ä¼šæ›´ç¨³å®šï¼Œæ¯”å¦‚å¦‚æœå¯¹ç”¨æˆ·å¹´é¾„ç¦»æ•£åŒ–ï¼Œ20-30ä½œä¸ºä¸€ä¸ªåŒºé—´ï¼Œä¸ä¼šå› ä¸ºä¸€ä¸ªç”¨æˆ·å¹´é¾„é•¿äº†ä¸€å²å°±å˜æˆä¸€ä¸ªå®Œå…¨ä¸åŒçš„äººã€‚å½“ç„¶å¤„äºåŒºé—´ç›¸é‚»å¤„çš„æ ·æœ¬ä¼šåˆšå¥½ç›¸åï¼Œæ‰€ä»¥æ€ä¹ˆåˆ’åˆ†åŒºé—´æ˜¯é—¨å­¦é—®ï¼› ç‰¹å¾ç¦»æ•£åŒ–ä»¥åï¼Œèµ·åˆ°äº†ç®€åŒ–äº†é€»è¾‘å›å½’æ¨¡å‹çš„ä½œç”¨ï¼Œé™ä½äº†æ¨¡å‹è¿‡æ‹Ÿåˆçš„é£é™©ã€‚ å¯ä»¥å°†ç¼ºå¤±ä½œä¸ºç‹¬ç«‹çš„ä¸€ç±»å¸¦å…¥æ¨¡å‹ã€‚ å°†æ‰€æœ‰å˜é‡å˜æ¢åˆ°ç›¸ä¼¼çš„å°ºåº¦ä¸Šã€‚ 2.1.0 å˜é‡åˆ†ç®±çš„æ–¹æ³• 2.1.1 æ— åºå˜é‡åˆ†ç®± ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨å®é™…æ¨¡å‹å»ºç«‹å½“ä¸­ï¼Œæœ‰ä¸ª job èŒä¸šçš„ç‰¹å¾ï¼Œå–å€¼ä¸ºï¼ˆâ€œå›½å®¶æœºå…³äººå‘˜â€ï¼Œâ€œä¸“ä¸šæŠ€æœ¯äººå‘˜â€ï¼Œâ€œå•†ä¸šæœåŠ¡äººå‘˜â€ï¼‰ï¼Œå¯¹äºè¿™ä¸€ç±»å˜é‡ï¼Œå¦‚æœæˆ‘ä»¬å°†å…¶ä¾æ¬¡èµ‹å€¼ä¸ºï¼ˆå›½å®¶æœºå…³äººå‘˜=1ï¼›ä¸“ä¸šæŠ€æœ¯äººå‘˜=2ï¼›å•†ä¸šæœåŠ¡äººå‘˜=3ï¼‰ï¼Œå°±å¾ˆå®¹æ˜“äº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œä¸åŒç§ç±»çš„èŒä¸šåœ¨æ•°æ®å±‚é¢ä¸Šå°±æœ‰äº†å¤§å°é¡ºåºä¹‹åˆ†ï¼Œå›½å®¶æœºå…³äººå‘˜å’Œå•†ä¸šæœåŠ¡äººå‘˜çš„å·®è·æ˜¯2ï¼Œä¸“ä¸šæŠ€æœ¯äººå‘˜å’Œå•†ä¸šæœåŠ¡äººå‘˜çš„ä¹‹é—´çš„å·®è·æ˜¯1ï¼Œè€Œæˆ‘ä»¬åŸæ¥çš„ä¸­æ–‡åˆ†ç±»ä¸­æ˜¯ä¸å­˜åœ¨è¿™ç§å…ˆåé¡ºåºå…³ç³»çš„ã€‚æ‰€ä»¥è¿™ä¹ˆç®€å•çš„èµ‹å€¼æ˜¯ä¼šä½¿å˜é‡å¤±å»åŸæ¥çš„è¡¡é‡æ•ˆæœã€‚\næ€ä¹ˆå¤„ç†è¿™ä¸ªé—®é¢˜å‘¢? â€œä¸€ä½æœ‰æ•ˆç¼–ç â€ ï¼ˆone-hot Encodingï¼‰å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé€šå¸¸å«åšè™šå˜é‡æˆ–è€…å“‘å˜é‡ï¼ˆdummpy variableï¼‰ï¼šæ¯”å¦‚èŒä¸šç‰¹å¾æœ‰3ä¸ªä¸åŒå˜é‡ï¼Œé‚£ä¹ˆå°†å…¶ç”Ÿæˆä¸ª2å“‘å˜é‡ï¼Œåˆ†åˆ«æ˜¯â€œæ˜¯å¦å›½å®¶å…šæ”¿èŒä¸šäººå‘˜â€ï¼Œâ€œæ˜¯å¦ä¸“ä¸šæŠ€æœ¯äººå‘˜â€ ï¼Œæ¯ä¸ªè™šå˜é‡å–å€¼ï¼ˆ1ï¼Œ0ï¼‰ã€‚ ä¸ºä»€ä¹ˆ2ä¸ªå“‘å˜é‡è€Œé3ä¸ªï¼Ÿ åœ¨æ¨¡å‹ä¸­å¼•å…¥å¤šä¸ªè™šæ‹Ÿå˜é‡æ—¶ï¼Œè™šæ‹Ÿå˜é‡çš„ä¸ªæ•°åº”æŒ‰ä¸‹åˆ—åŸåˆ™ç¡®å®šï¼š å›å½’æ¨¡å‹æœ‰æˆªè·ï¼šä¸€èˆ¬çš„ï¼Œè‹¥è¯¥ç‰¹å¾ä¸‹nä¸ªå±æ€§å‡äº’æ–¥ï¼ˆå¦‚ï¼Œç”·/å¥³;å„¿ç«¥/é’å¹´/ä¸­å¹´/è€å¹´ï¼‰ï¼Œåœ¨ç”Ÿæˆè™šæ‹Ÿå˜é‡æ—¶ï¼Œåº”è¯¥ç”Ÿæˆ n-1ä¸ªè™šå˜é‡ï¼Œè¿™æ ·å¯ä»¥é¿å…äº§ç”Ÿå¤šé‡å…±çº¿æ€§ å›å½’æ¨¡å‹æ— æˆªè·é¡¹ï¼šæœ‰nä¸ªç‰¹å¾ï¼Œè®¾ç½®nä¸ªè™šæ‹Ÿå˜é‡ python å®ç°æ–¹æ³•pd.get_dummies() 2.1.2 æœ‰åºå˜é‡åˆ†ç®± æœ‰åºå¤šåˆ†ç±»å˜é‡æ˜¯å¾ˆå¸¸è§çš„å˜é‡å½¢å¼ï¼Œé€šå¸¸åœ¨å˜é‡ä¸­æœ‰å¤šä¸ªå¯èƒ½ä¼šå‡ºç°çš„å–å€¼ï¼Œå„å–å€¼ä¹‹é—´è¿˜å­˜åœ¨ç­‰çº§å…³ç³»ã€‚æ¯”å¦‚é«˜è¡€å‹åˆ†çº§ï¼ˆ0=æ­£å¸¸ï¼Œ1=æ­£å¸¸é«˜å€¼ï¼Œ2=1çº§é«˜è¡€å‹ï¼Œ3=2çº§é«˜è¡€å‹ï¼Œ4=3çº§é«˜è¡€å‹ï¼‰è¿™ç±»å˜é‡å¤„ç†èµ·æ¥ç®€ç›´ä¸è¦å¤ªçœå¿ƒï¼Œä½¿ç”¨ pandas ä¸­çš„ mapï¼ˆï¼‰æ›¿æ¢ç›¸åº”å˜é‡å°±è¡Œã€‚\n1 2 3 4 5 import pandas as pd df= pd.DataFrame([\u0026#39;æ­£å¸¸\u0026#39;,\u0026#39;3çº§é«˜è¡€å‹\u0026#39;,\u0026#39;æ­£å¸¸\u0026#39;,\u0026#39;2çº§é«˜è¡€å‹\u0026#39;,\u0026#39;æ­£å¸¸\u0026#39;,\u0026#39;æ­£å¸¸é«˜å€¼\u0026#39;,\u0026#39;1çº§é«˜è¡€å‹\u0026#39;],columns=[\u0026#39;blood_pressure\u0026#39;]) dic_blood = {\u0026#39;æ­£å¸¸\u0026#39;:0,\u0026#39;æ­£å¸¸é«˜å€¼\u0026#39;:1,\u0026#39;1çº§é«˜è¡€å‹\u0026#39;:2,\u0026#39;2çº§é«˜è¡€å‹\u0026#39;:3,\u0026#39;3çº§é«˜è¡€å‹\u0026#39;:4} df[\u0026#39;blood_pressure_enc\u0026#39;] = df[\u0026#39;blood_pressure\u0026#39;].map(dic_blood) print(df) 2.1.3 è¿ç»­å˜é‡çš„åˆ†ç®±æ–¹å¼ ç­‰å®½åˆ’åˆ†ï¼šæŒ‰ç…§ç›¸åŒå®½åº¦å°†æ•°æ®åˆ†æˆå‡ ç­‰ä»½ã€‚ç¼ºç‚¹æ˜¯å—åˆ°å¼‚å¸¸å€¼çš„å½±å“æ¯”è¾ƒå¤§ã€‚ pandas.cutæ–¹æ³•å¯ä»¥è¿›è¡Œç­‰å®½åˆ’åˆ†ã€‚ ç­‰é¢‘åˆ’åˆ†ï¼šå°†æ•°æ®åˆ†æˆå‡ ç­‰ä»½ï¼Œæ¯ç­‰ä»½æ•°æ®é‡Œé¢çš„ä¸ªæ•°æ˜¯ä¸€æ ·çš„ã€‚pandas.qcutæ–¹æ³•å¯ä»¥è¿›è¡Œç­‰é¢‘åˆ’åˆ†ã€‚ 1 2 3 4 5 6 import pandas as pd df = pd.DataFrame([[22,1],[13,1],[33,1],[52,0],[16,0],[42,1],[53,1],[39,1],[26,0],[66,0]],columns=[\u0026#39;age\u0026#39;,\u0026#39;Y\u0026#39;]) #print(df) df[\u0026#39;age_bin_1\u0026#39;] = pd.qcut(df[\u0026#39;age\u0026#39;],3) #æ–°å¢ä¸€åˆ—å­˜å‚¨ç­‰é¢‘åˆ’åˆ†çš„åˆ†ç®±ç‰¹å¾ df[\u0026#39;age_bin_2\u0026#39;] = pd.cut(df[\u0026#39;age\u0026#39;],3) #æ–°å¢ä¸€åˆ—å­˜å‚¨ç­‰è·åˆ’åˆ†çš„åˆ†ç®±ç‰¹å¾ print(df) 2.1.4 æœ‰ç›‘ç£å­¦ä¹ åˆ†ç®±æ–¹æ³• æœ€å°ç†µæ³•åˆ†ç®± å‡è®¾å› å˜é‡ä¸ºåˆ†ç±»å˜é‡ï¼Œå¯å–å€¼1ï¼Œâ€¦ ï¼ŒJã€‚ä»¤pijpijè¡¨ç¤ºç¬¬iä¸ªåˆ†ç®±å†…å› å˜é‡å–å€¼ä¸ºjçš„è§‚æµ‹çš„æ¯”ä¾‹ï¼Œi=1ï¼Œâ€¦ï¼Œkï¼Œj=1ï¼Œâ€¦ï¼ŒJï¼›é‚£ä¹ˆç¬¬iä¸ªåˆ†ç®±çš„ç†µå€¼ä¸ºâˆ‘Jj=0âˆ’pijÃ—logpijâˆ‘j=0Jâˆ’pijÃ—logpijã€‚å¦‚æœç¬¬iä¸ªåˆ†ç®±å†…å› å˜é‡å„ç±»åˆ«çš„æ¯”ä¾‹ç›¸ç­‰ï¼Œå³p11=p12=p1J=1/Jp11=p12=p1J=1/Jï¼Œé‚£ä¹ˆç¬¬iä¸ªåˆ†ç®±çš„ç†µå€¼è¾¾åˆ°æœ€å¤§å€¼ï¼›å¦‚æœç¬¬iä¸ªåˆ†ç®±å†…å› å˜é‡åªæœ‰ä¸€ç§å–å€¼ï¼Œå³æŸä¸ªpijpijç­‰äº1è€Œå…¶ä»–ç±»åˆ«çš„æ¯”ä¾‹ç­‰äº0ï¼Œé‚£ä¹ˆç¬¬iä¸ªåˆ†ç®±çš„ç†µå€¼è¾¾åˆ°æœ€å°å€¼ã€‚ ä»¤ririè¡¨ç¤ºç¬¬iä¸ªåˆ†ç®±çš„è§‚æµ‹æ•°å æ‰€æœ‰è§‚æµ‹æ•°çš„æ¯”ä¾‹ï¼›é‚£ä¹ˆæ€»ç†µå€¼ä¸ºâˆ‘ki=0âˆ‘Jj=0(âˆ’pijÃ—logpij)âˆ‘i=0kâˆ‘j=0J(âˆ’pijÃ—logpij)ã€‚éœ€è¦ä½¿æ€»ç†µå€¼è¾¾åˆ°æœ€å°ï¼Œä¹Ÿå°±æ˜¯ä½¿åˆ†ç®±èƒ½å¤Ÿæœ€å¤§é™åº¦åœ°åŒºåˆ†å› å˜é‡çš„å„ç±»åˆ«ã€‚ å¡æ–¹åˆ†ç®± (å¸¸ç”¨) è‡ªåº•å‘ä¸Šçš„(å³åŸºäºåˆå¹¶çš„)æ•°æ®ç¦»æ•£åŒ–æ–¹æ³•ã€‚ å®ƒä¾èµ–äºå¡æ–¹æ£€éªŒ:å…·æœ‰æœ€å°å¡æ–¹å€¼çš„ç›¸é‚»åŒºé—´åˆå¹¶åœ¨ä¸€èµ·,ç›´åˆ°æ»¡è¶³ç¡®å®šçš„åœæ­¢å‡†åˆ™ã€‚ åŸºæœ¬æ€æƒ³: å¯¹äºç²¾ç¡®çš„ç¦»æ•£åŒ–ï¼Œç›¸å¯¹ç±»é¢‘ç‡åœ¨ä¸€ä¸ªåŒºé—´å†…åº”å½“å®Œå…¨ä¸€è‡´ã€‚å› æ­¤,å¦‚æœä¸¤ä¸ªç›¸é‚»çš„åŒºé—´å…·æœ‰éå¸¸ç±»ä¼¼çš„ç±»åˆ†å¸ƒï¼Œåˆ™è¿™ä¸¤ä¸ªåŒºé—´å¯ä»¥åˆå¹¶ï¼›å¦åˆ™ï¼Œå®ƒä»¬åº”å½“ä¿æŒåˆ†å¼€ã€‚è€Œä½å¡æ–¹å€¼è¡¨æ˜å®ƒä»¬å…·æœ‰ç›¸ä¼¼çš„ç±»åˆ†å¸ƒã€‚ 2.2 æ— é‡çº²åŒ– æ— é‡çº²åŒ–ä½¿ä¸åŒè§„æ ¼çš„æ•°æ®è½¬æ¢åˆ°åŒä¸€è§„æ ¼ã€‚å¸¸è§çš„æ— é‡çº²åŒ–æ–¹æ³•æœ‰æ ‡å‡†åŒ–å’ŒåŒºé—´ç¼©æ”¾æ³•ã€‚æ ‡å‡†åŒ–çš„å‰ææ˜¯ç‰¹å¾å€¼æœä»æ­£æ€åˆ†å¸ƒï¼Œæ ‡å‡†åŒ–åï¼Œå…¶è½¬æ¢æˆæ ‡å‡†æ­£æ€åˆ†å¸ƒã€‚åŒºé—´ç¼©æ”¾æ³•åˆ©ç”¨äº†è¾¹ç•Œå€¼ä¿¡æ¯ï¼Œå°†ç‰¹å¾çš„å–å€¼åŒºé—´ç¼©æ”¾åˆ°æŸä¸ªç‰¹ç‚¹çš„èŒƒå›´ï¼Œä¾‹å¦‚[0, 1]ç­‰ã€‚\n2.2.1 æ ‡å‡†åŒ– æ ‡å‡†åŒ–éœ€è¦è®¡ç®—ç‰¹å¾çš„å‡å€¼å’Œæ ‡å‡†å·®ï¼Œå…¬å¼è¡¨è¾¾ä¸ºï¼š\nä½¿ç”¨preproccessingåº“çš„StandardScalerç±»å¯¹æ•°æ®è¿›è¡Œæ ‡å‡†åŒ–çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 from sklearn.preprocessing import StandardScaler #æ ‡å‡†åŒ–ï¼Œè¿”å›å€¼ä¸ºæ ‡å‡†åŒ–åçš„æ•°æ® StandardScaler().fit_transform(iris.data) 2.2.2 åŒºé—´ç¼©æ”¾æ³• åŒºé—´ç¼©æ”¾æ³•çš„æ€è·¯æœ‰å¤šç§ï¼Œå¸¸è§çš„ä¸€ç§ä¸ºåˆ©ç”¨ä¸¤ä¸ªæœ€å€¼è¿›è¡Œç¼©æ”¾ï¼Œå…¬å¼è¡¨è¾¾ä¸ºï¼š\nä½¿ç”¨preproccessingåº“çš„MinMaxScalerç±»å¯¹æ•°æ®è¿›è¡ŒåŒºé—´ç¼©æ”¾çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 from sklearn.preprocessing import MinMaxScaler #åŒºé—´ç¼©æ”¾ï¼Œè¿”å›å€¼ä¸ºç¼©æ”¾åˆ°[0, 1]åŒºé—´çš„æ•°æ® MinMaxScaler().fit_transform(iris.data) 2.1.3 æ ‡å‡†åŒ–ä¸å½’ä¸€åŒ–çš„åŒºåˆ« ç®€å•æ¥è¯´ï¼Œæ ‡å‡†åŒ–æ˜¯ä¾ç…§ç‰¹å¾çŸ©é˜µçš„åˆ—å¤„ç†æ•°æ®ï¼Œå…¶é€šè¿‡æ±‚z-scoreçš„æ–¹æ³•ï¼Œå°†æ ·æœ¬çš„ç‰¹å¾å€¼è½¬æ¢åˆ°åŒä¸€é‡çº²ä¸‹ã€‚å½’ä¸€åŒ–æ˜¯ä¾ç…§ç‰¹å¾çŸ©é˜µçš„è¡Œå¤„ç†æ•°æ®ï¼Œå…¶ç›®çš„åœ¨äºæ ·æœ¬å‘é‡åœ¨ç‚¹ä¹˜è¿ç®—æˆ–å…¶ä»–æ ¸å‡½æ•°è®¡ç®—ç›¸ä¼¼æ€§æ—¶ï¼Œæ‹¥æœ‰ç»Ÿä¸€çš„æ ‡å‡†ï¼Œä¹Ÿå°±æ˜¯è¯´éƒ½è½¬åŒ–ä¸ºâ€œå•ä½å‘é‡â€ã€‚è§„åˆ™ä¸ºl2çš„å½’ä¸€åŒ–å…¬å¼å¦‚ä¸‹ï¼š\nä»€ä¹ˆæ—¶å€™éœ€è¦è¿›è¡Œå½’ä¸€åŒ–ï¼Ÿ\nå½’ä¸€åŒ–ååŠ å¿«äº†æ¢¯åº¦ä¸‹é™æ±‚æœ€ä¼˜è§£çš„é€Ÿåº¦ å½’ä¸€åŒ–æœ‰å¯èƒ½æé«˜ç²¾åº¦ ä»€ä¹ˆæ—¶å€™éœ€è¦è¿›è¡Œå½’ä¸€åŒ–ï¼Ÿ\né€šå¸¸åœ¨éœ€è¦ç”¨åˆ°æ¢¯åº¦ä¸‹é™æ³•çš„æ—¶å€™ã€‚ åŒ…æ‹¬çº¿æ€§å›å½’ã€é€»è¾‘å›å½’ã€æ”¯æŒå‘é‡æœºã€ç¥ç»ç½‘ç»œç­‰æ¨¡å‹ã€‚\nå†³ç­–æ ‘æ¨¡å‹å°±ä¸é€‚ç”¨ ä¾‹å¦‚ C4.5 ï¼Œä¸»è¦æ ¹æ®ä¿¡æ¯å¢ç›Šæ¯”æ¥åˆ†è£‚ï¼Œå½’ä¸€åŒ–ä¸ä¼šæ”¹å˜æ ·æœ¬åœ¨ç‰¹å¾ x ä¸Šçš„ä¿¡æ¯å¢ç›Š\næ¯”è¾ƒæ¦‚ç‡å¤§å°åˆ†å¸ƒå³å¯ï¼Œä¸éœ€è¦ã€‚\nä½¿ç”¨preproccessingåº“çš„Normalizerç±»å¯¹æ•°æ®è¿›è¡Œå½’ä¸€åŒ–çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 from sklearn.preprocessing import Normalizer #å½’ä¸€åŒ–ï¼Œè¿”å›å€¼ä¸ºå½’ä¸€åŒ–åçš„æ•°æ® Normalizer().fit_transform(iris.data) 2.3 å¯¹å®šé‡ç‰¹å¾äºŒå€¼åŒ– å®šé‡ç‰¹å¾äºŒå€¼åŒ–çš„æ ¸å¿ƒåœ¨äºè®¾å®šä¸€ä¸ªé˜ˆå€¼ï¼Œå¤§äºé˜ˆå€¼çš„èµ‹å€¼ä¸º1ï¼Œå°äºç­‰äºé˜ˆå€¼çš„èµ‹å€¼ä¸º0ï¼Œå…¬å¼è¡¨è¾¾å¦‚ä¸‹ï¼š\nä½¿ç”¨preproccessingåº“çš„Binarizerç±»å¯¹æ•°æ®è¿›è¡ŒäºŒå€¼åŒ–çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 from sklearn.preprocessing import Binarizer #äºŒå€¼åŒ–ï¼Œé˜ˆå€¼è®¾ç½®ä¸º3ï¼Œè¿”å›å€¼ä¸ºäºŒå€¼åŒ–åçš„æ•°æ® Binarizer(threshold=3).fit_transform(iris.data) 2.4 å¯¹å®šæ€§ç‰¹å¾å“‘ç¼–ç  ç”±äºIRISæ•°æ®é›†çš„ç‰¹å¾çš†ä¸ºå®šé‡ç‰¹å¾ï¼Œæ•…ä½¿ç”¨å…¶ç›®æ ‡å€¼è¿›è¡Œå“‘ç¼–ç ï¼ˆå®é™…ä¸Šæ˜¯ä¸éœ€è¦çš„ï¼‰ã€‚ä½¿ç”¨preproccessingåº“çš„OneHotEncoderç±»å¯¹æ•°æ®è¿›è¡Œå“‘ç¼–ç çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 from sklearn.preprocessing import OneHotEncoder #å“‘ç¼–ç ï¼Œå¯¹IRISæ•°æ®é›†çš„ç›®æ ‡å€¼ï¼Œè¿”å›å€¼ä¸ºå“‘ç¼–ç åçš„æ•°æ® OneHotEncoder().fit_transform(iris.target.reshape((-1,1))) 2.5 ç¼ºå¤±å€¼è®¡ç®— ç”±äºIRISæ•°æ®é›†æ²¡æœ‰ç¼ºå¤±å€¼ï¼Œæ•…å¯¹æ•°æ®é›†æ–°å¢ä¸€ä¸ªæ ·æœ¬ï¼Œ4ä¸ªç‰¹å¾å‡èµ‹å€¼ä¸ºNaNï¼Œè¡¨ç¤ºæ•°æ®ç¼ºå¤±ã€‚ä½¿ç”¨preproccessingåº“çš„Imputerç±»å¯¹æ•°æ®è¿›è¡Œç¼ºå¤±å€¼è®¡ç®—çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 from numpy import vstack, array, nan from sklearn.preprocessing import Imputer #ç¼ºå¤±å€¼è®¡ç®—ï¼Œè¿”å›å€¼ä¸ºè®¡ç®—ç¼ºå¤±å€¼åçš„æ•°æ® #å‚æ•°missing_valueä¸ºç¼ºå¤±å€¼çš„è¡¨ç¤ºå½¢å¼ï¼Œé»˜è®¤ä¸ºNaN #å‚æ•°strategyä¸ºç¼ºå¤±å€¼å¡«å……æ–¹å¼ï¼Œé»˜è®¤ä¸ºmeanï¼ˆå‡å€¼ï¼‰ Imputer().fit_transform(vstack((array([nan, nan, nan, nan]), iris.data))) 2.6 æ•°æ®å˜æ¢ å¸¸è§çš„æ•°æ®å˜æ¢æœ‰åŸºäºå¤šé¡¹å¼çš„ã€åŸºäºæŒ‡æ•°å‡½æ•°çš„ã€åŸºäºå¯¹æ•°å‡½æ•°çš„ã€‚4ä¸ªç‰¹å¾ï¼Œåº¦ä¸º2çš„å¤šé¡¹å¼è½¬æ¢å…¬å¼å¦‚ä¸‹ï¼š\nä½¿ç”¨preproccessingåº“çš„PolynomialFeaturesç±»å¯¹æ•°æ®è¿›è¡Œå¤šé¡¹å¼è½¬æ¢çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 from sklearn.preprocessing import PolynomialFeatures #å¤šé¡¹å¼è½¬æ¢ #å‚æ•°degreeä¸ºåº¦ï¼Œé»˜è®¤å€¼ä¸º2 PolynomialFeatures().fit_transform(iris.data) åŸºäºå•å˜å…ƒå‡½æ•°çš„æ•°æ®å˜æ¢å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç»Ÿä¸€çš„æ–¹å¼å®Œæˆï¼Œä½¿ç”¨preproccessingåº“çš„FunctionTransformerå¯¹æ•°æ®è¿›è¡Œå¯¹æ•°å‡½æ•°è½¬æ¢çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 from numpy import log1p from sklearn.preprocessing import FunctionTransformer #è‡ªå®šä¹‰è½¬æ¢å‡½æ•°ä¸ºå¯¹æ•°å‡½æ•°çš„æ•°æ®å˜æ¢ #ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å•å˜å…ƒå‡½æ•° FunctionTransformer(log1p).fit_transform(iris.data) 2.7 å›å½’ å¯ä»¥ç”¨ä¸€ä¸ªå‡½æ•°ï¼ˆå¦‚å›å½’å‡½æ•°ï¼‰æ‹Ÿåˆæ•°æ®æ¥å…‰æ»‘æ•°æ®ã€‚çº¿æ€§å›å½’æ¶‰åŠæ‰¾å‡ºæ‹Ÿåˆä¸¤ä¸ªå±æ€§ï¼ˆæˆ–å˜é‡ï¼‰çš„â€œæœ€ä½³â€çº¿ï¼Œæ˜¯çš„ä¸€ä¸ªå±æ€§å¯ä»¥ç”¨æ¥é¢„æµ‹å¦ä¸€ä¸ªã€‚å¤šå…ƒçº¿æ€§å›å½’æ˜¯çº¿æ€§å›å½’çš„æ‰©å±•ï¼Œå…¶ä¸­æ¶‰åŠçš„å±æ€§å¤šäºä¸¤ä¸ªï¼Œå¹¶ä¸”æ•°æ®æ‹Ÿåˆåˆ°ä¸€ä¸ªå¤šç»´æ›²é¢ã€‚\n3. å¼‚å¸¸å€¼å¤„ç†æ–¹æ³• åˆ é™¤å«æœ‰å¼‚å¸¸å€¼çš„è®°å½•ï¼› æŸäº›ç­›é€‰å‡ºæ¥çš„å¼‚å¸¸æ ·æœ¬æ˜¯å¦çœŸçš„æ˜¯ä¸éœ€è¦çš„å¼‚å¸¸ç‰¹å¾æ ·æœ¬ï¼Œæœ€å¥½æ‰¾æ‡‚ä¸šåŠ¡çš„å†ç¡®è®¤ä¸€ä¸‹ï¼Œé˜²æ­¢æˆ‘ä»¬å°†æ­£å¸¸çš„æ ·æœ¬è¿‡æ»¤æ‰äº†ã€‚ å°†å¼‚å¸¸å€¼è§†ä¸ºç¼ºå¤±å€¼ï¼Œäº¤ç»™ç¼ºå¤±å€¼å¤„ç†æ–¹æ³•æ¥å¤„ç†ï¼› ä½¿ç”¨å‡å€¼/ä¸­ä½æ•°/ä¼—æ•°æ¥ä¿®æ­£ï¼› ä¸å¤„ç†ã€‚ 4. ä»€ä¹ˆæ˜¯ç»„åˆç‰¹å¾ï¼Ÿå¦‚ä½•å¤„ç†é«˜ç»´ç»„åˆç‰¹å¾ï¼Ÿ ä¸ºäº†æé«˜å¤æ‚å…³ç³»çš„æ‹Ÿåˆèƒ½åŠ›ï¼Œåœ¨ç‰¹å¾å·¥ç¨‹ä¸­ç»å¸¸ä¼šæŠŠä¸€é˜¶ç¦»æ•£ç‰¹å¾ä¸¤ä¸¤ç»„åˆæˆé«˜é˜¶ç‰¹å¾ï¼Œæ„æˆäº¤äº’ç‰¹å¾ï¼ˆInteraction Featureï¼‰ã€‚ä»¥å¹¿å‘Šç‚¹å‡»é¢„ä¼°é—®é¢˜ä¸ºä¾‹ï¼Œå¦‚å›¾1æ‰€ç¤ºï¼ŒåŸå§‹æ•°æ®æœ‰è¯­è¨€å’Œç±»å‹ä¸¤ç§ç¦»æ•£ç‰¹å¾ã€‚ä¸ºäº†æé«˜æ‹Ÿåˆèƒ½åŠ›ï¼Œè¯­è¨€å’Œç±»å‹å¯ä»¥ç»„æˆäºŒé˜¶ç‰¹å¾ã€‚\n5. ç±»åˆ«å‹ç‰¹å¾ ä»€ä¹ˆæ˜¯ç±»åˆ«å‹ç‰¹å¾ï¼Ÿ\nä¾‹å¦‚ï¼šæ€§åˆ«ï¼ˆç”·ã€å¥³ï¼‰ã€è¡€å‹ï¼ˆAã€Bã€ABã€Oï¼‰\né€šå¸¸æ˜¯å­—ç¬¦ä¸²å½¢å¼ï¼Œéœ€è¦è½¬åŒ–æˆæ•°å€¼å‹ï¼Œä¼ é€’ç»™æ¨¡å‹\nå¦‚ä½•å¤„ç†ç±»åˆ«å‹ç‰¹å¾ï¼Ÿ\nåºå·ç¼–ç ï¼ˆOrdinal Encodingï¼‰ ä¾‹å¦‚å­¦ä¹ æˆç»©æœ‰é«˜ä¸­ä½ä¸‰æ¡£ï¼Œä¹Ÿå°±æ˜¯ä¸åŒç±»åˆ«ä¹‹é—´å…³ç³»ã€‚\nè¿™æ—¶å¯ä»¥ç”¨321æ¥è¡¨ç¤ºï¼Œä¿ç•™äº†å¤§å°å…³ç³»ã€‚\nç‹¬çƒ­ç¼–ç ï¼ˆOne-hot Encodingï¼‰ ä¾‹å¦‚è¡€å‹ï¼Œå®ƒçš„ç±»åˆ«æ²¡æœ‰å¤§å°å…³ç³»ã€‚A å‹è¡€è¡¨ç¤ºä¸ºï¼ˆ1, 0, 0, 0ï¼‰ï¼ŒB å‹è¡€è¡¨ç¤ºä¸ºï¼ˆ0, 1, 0, 0ï¼‰â€¦â€¦\näºŒè¿›åˆ¶ç¼–ç ï¼ˆBinary Encodingï¼‰ ç¬¬ä¸€æ­¥ï¼Œå…ˆç”¨åºå·ç¼–ç ç»™æ¯ä¸ªç±»åˆ«ç¼–ç \nç¬¬äºŒæ­¥ï¼Œå°†ç±»åˆ« ID è½¬åŒ–ä¸ºç›¸åº”çš„äºŒè¿›åˆ¶\n","permalink":"https://reid00.github.io/en/posts/ml/%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B%E4%B9%8B%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86/","summary":"Summary æ•°æ®å’Œç‰¹å¾å†³å®šäº†æœºå™¨å­¦ä¹ çš„ä¸Šé™ï¼Œè€Œæ¨¡å‹å’Œç®—æ³•åªæ˜¯é€¼è¿‘è¿™ä¸ªä¸Šé™è€Œå·²ã€‚ç”±æ­¤å¯è§ï¼Œç‰¹å¾å·¥ç¨‹åœ¨æœºå™¨å­¦ä¹ ä¸­å æœ‰ç›¸å½“é‡è¦çš„åœ°ä½ã€‚åœ¨å®é™…åº”ç”¨å½“ä¸­ï¼Œå¯ä»¥è¯´ç‰¹å¾å·¥ç¨‹æ˜¯æœºå™¨å­¦ä¹ æˆåŠŸçš„å…³é”®ã€‚\nä»€ä¹ˆæ˜¯ç‰¹å¾å·¥ç¨‹ ç‰¹å¾å·¥ç¨‹åˆåŒ…å«äº†Data PreProcessingï¼ˆæ•°æ®é¢„å¤„ç†ï¼‰ã€Feature Extractionï¼ˆç‰¹å¾æå–ï¼‰ã€Feature Selectionï¼ˆç‰¹å¾é€‰æ‹©ï¼‰å’ŒFeature constructionï¼ˆç‰¹å¾æ„é€ ï¼‰ç­‰å­é—®é¢˜ï¼Œæœ¬ç« å†…å®¹ä¸»è¦è®¨è®ºæ•°æ®é¢„å¤„ç†çš„æ–¹æ³•åŠå®ç°ã€‚ ç‰¹å¾å·¥ç¨‹æ˜¯æœºå™¨å­¦ä¹ ä¸­æœ€é‡è¦çš„èµ·å§‹æ­¥éª¤ï¼Œæ•°æ®é¢„å¤„ç†æ˜¯ç‰¹å¾å·¥ç¨‹çš„æœ€é‡è¦çš„èµ·å§‹æ­¥éª¤ï¼Œè€Œæ•°æ®æ¸…æ´—æ˜¯æ•°æ®é¢„å¤„ç†çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¼šç›´æ¥å½±å“æœºå™¨å­¦ä¹ çš„æ•ˆæœã€‚\næ•°æ®æ¸…æ´—æ•´ä½“ä»‹ç» 1. ç®±çº¿å›¾åˆ†æå¼‚å¸¸å€¼ ç®±çº¿å›¾æä¾›äº†è¯†åˆ«å¼‚å¸¸å€¼çš„æ ‡å‡†ï¼Œå¦‚æœä¸€ä¸ªæ•°ä¸‹é›¨ QL-1.5IQR or å¤§äºOU + 1.5 IQR, åˆ™è¿™ä¸ªå€¼è¢«ç§°ä¸ºå¼‚å¸¸å€¼ã€‚\nQL ä¸‹å››åˆ†ä½æ•°ï¼Œè¡¨ç¤ºå››åˆ†ä¹‹ä¸€çš„æ•°æ®å€¼æ¯”å®ƒå° QUã€€ä¸Šå››åˆ†ä½æ•°ï¼Œè¡¨ç¤ºå››åˆ†ä¹‹ä¸€çš„æ•°æ®å€¼æ¯”å®ƒå¤§ IRQã€€å››åˆ†ä½è·ï¼Œæ˜¯QUï¼QLã€€çš„å·®å€¼ï¼ŒåŒ…å«äº†å…¨éƒ¨å…³å·®å€¼çš„ä¸€èˆ¬ 2. æ•°æ®çš„å…‰æ»‘å¤„ç† é™¤äº†æ£€æµ‹å‡ºå¼‚å¸¸å€¼ç„¶åå†å¤„ç†å¼‚å¸¸å€¼å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å¯¹å¼‚å¸¸æ•°æ®è¿›è¡Œå…‰æ»‘å¤„ç†ã€‚\n2.1. å˜é‡åˆ†ç®±ï¼ˆå³å˜é‡ç¦»æ•£åŒ–) ç¦»æ•£ç‰¹å¾çš„å¢åŠ å’Œå‡å°‘éƒ½å¾ˆå®¹æ˜“ï¼Œæ˜“äºæ¨¡å‹çš„å¿«é€Ÿè¿­ä»£ï¼› ç¨€ç–å‘é‡å†…ç§¯ä¹˜æ³•è¿ç®—é€Ÿåº¦å¿«ï¼Œè®¡ç®—ç»“æœæ–¹ä¾¿å­˜å‚¨ï¼Œå®¹æ˜“æ‰©å±•ï¼› ç¦»æ•£åŒ–åçš„ç‰¹å¾å¯¹å¼‚å¸¸æ•°æ®æœ‰å¾ˆå¼ºçš„é²æ£’æ€§ï¼šæ¯”å¦‚ä¸€ä¸ªç‰¹å¾æ˜¯å¹´é¾„\u0026gt;30æ˜¯1ï¼Œå¦åˆ™0ã€‚å¦‚æœç‰¹å¾æ²¡æœ‰ç¦»æ•£åŒ–ï¼Œä¸€ä¸ªå¼‚å¸¸æ•°æ®â€œå¹´é¾„300å²â€ä¼šç»™æ¨¡å‹é€ æˆå¾ˆå¤§çš„å¹²æ‰°ï¼› é€»è¾‘å›å½’å±äºå¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼Œè¡¨è¾¾èƒ½åŠ›å—é™ï¼›å•å˜é‡ç¦»æ•£åŒ–ä¸ºNä¸ªåï¼Œæ¯ä¸ªå˜é‡æœ‰å•ç‹¬çš„æƒé‡ï¼Œç›¸å½“äºä¸ºæ¨¡å‹å¼•å…¥äº†éçº¿æ€§ï¼Œèƒ½å¤Ÿæå‡æ¨¡å‹è¡¨è¾¾èƒ½åŠ›ï¼ŒåŠ å¤§æ‹Ÿåˆï¼› ç¦»æ•£åŒ–åå¯ä»¥è¿›è¡Œç‰¹å¾äº¤å‰ï¼Œç”±M+Nä¸ªå˜é‡å˜ä¸ºM*Nä¸ªå˜é‡ï¼Œè¿›ä¸€æ­¥å¼•å…¥éçº¿æ€§ï¼Œæå‡è¡¨è¾¾èƒ½åŠ›ï¼› ç‰¹å¾ç¦»æ•£åŒ–åï¼Œæ¨¡å‹ä¼šæ›´ç¨³å®šï¼Œæ¯”å¦‚å¦‚æœå¯¹ç”¨æˆ·å¹´é¾„ç¦»æ•£åŒ–ï¼Œ20-30ä½œä¸ºä¸€ä¸ªåŒºé—´ï¼Œä¸ä¼šå› ä¸ºä¸€ä¸ªç”¨æˆ·å¹´é¾„é•¿äº†ä¸€å²å°±å˜æˆä¸€ä¸ªå®Œå…¨ä¸åŒçš„äººã€‚å½“ç„¶å¤„äºåŒºé—´ç›¸é‚»å¤„çš„æ ·æœ¬ä¼šåˆšå¥½ç›¸åï¼Œæ‰€ä»¥æ€ä¹ˆåˆ’åˆ†åŒºé—´æ˜¯é—¨å­¦é—®ï¼› ç‰¹å¾ç¦»æ•£åŒ–ä»¥åï¼Œèµ·åˆ°äº†ç®€åŒ–äº†é€»è¾‘å›å½’æ¨¡å‹çš„ä½œç”¨ï¼Œé™ä½äº†æ¨¡å‹è¿‡æ‹Ÿåˆçš„é£é™©ã€‚ å¯ä»¥å°†ç¼ºå¤±ä½œä¸ºç‹¬ç«‹çš„ä¸€ç±»å¸¦å…¥æ¨¡å‹ã€‚ å°†æ‰€æœ‰å˜é‡å˜æ¢åˆ°ç›¸ä¼¼çš„å°ºåº¦ä¸Šã€‚ 2.1.0 å˜é‡åˆ†ç®±çš„æ–¹æ³• 2.1.1 æ— åºå˜é‡åˆ†ç®± ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨å®é™…æ¨¡å‹å»ºç«‹å½“ä¸­ï¼Œæœ‰ä¸ª job èŒä¸šçš„ç‰¹å¾ï¼Œå–å€¼ä¸ºï¼ˆâ€œå›½å®¶æœºå…³äººå‘˜â€ï¼Œâ€œä¸“ä¸šæŠ€æœ¯äººå‘˜â€ï¼Œâ€œå•†ä¸šæœåŠ¡äººå‘˜â€ï¼‰ï¼Œå¯¹äºè¿™ä¸€ç±»å˜é‡ï¼Œå¦‚æœæˆ‘ä»¬å°†å…¶ä¾æ¬¡èµ‹å€¼ä¸ºï¼ˆå›½å®¶æœºå…³äººå‘˜=1ï¼›ä¸“ä¸šæŠ€æœ¯äººå‘˜=2ï¼›å•†ä¸šæœåŠ¡äººå‘˜=3ï¼‰ï¼Œå°±å¾ˆå®¹æ˜“äº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œä¸åŒç§ç±»çš„èŒä¸šåœ¨æ•°æ®å±‚é¢ä¸Šå°±æœ‰äº†å¤§å°é¡ºåºä¹‹åˆ†ï¼Œå›½å®¶æœºå…³äººå‘˜å’Œå•†ä¸šæœåŠ¡äººå‘˜çš„å·®è·æ˜¯2ï¼Œä¸“ä¸šæŠ€æœ¯äººå‘˜å’Œå•†ä¸šæœåŠ¡äººå‘˜çš„ä¹‹é—´çš„å·®è·æ˜¯1ï¼Œè€Œæˆ‘ä»¬åŸæ¥çš„ä¸­æ–‡åˆ†ç±»ä¸­æ˜¯ä¸å­˜åœ¨è¿™ç§å…ˆåé¡ºåºå…³ç³»çš„ã€‚æ‰€ä»¥è¿™ä¹ˆç®€å•çš„èµ‹å€¼æ˜¯ä¼šä½¿å˜é‡å¤±å»åŸæ¥çš„è¡¡é‡æ•ˆæœã€‚\næ€ä¹ˆå¤„ç†è¿™ä¸ªé—®é¢˜å‘¢? â€œä¸€ä½æœ‰æ•ˆç¼–ç â€ ï¼ˆone-hot Encodingï¼‰å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé€šå¸¸å«åšè™šå˜é‡æˆ–è€…å“‘å˜é‡ï¼ˆdummpy variableï¼‰ï¼šæ¯”å¦‚èŒä¸šç‰¹å¾æœ‰3ä¸ªä¸åŒå˜é‡ï¼Œé‚£ä¹ˆå°†å…¶ç”Ÿæˆä¸ª2å“‘å˜é‡ï¼Œåˆ†åˆ«æ˜¯â€œæ˜¯å¦å›½å®¶å…šæ”¿èŒä¸šäººå‘˜â€ï¼Œâ€œæ˜¯å¦ä¸“ä¸šæŠ€æœ¯äººå‘˜â€ ï¼Œæ¯ä¸ªè™šå˜é‡å–å€¼ï¼ˆ1ï¼Œ0ï¼‰ã€‚ ä¸ºä»€ä¹ˆ2ä¸ªå“‘å˜é‡è€Œé3ä¸ªï¼Ÿ åœ¨æ¨¡å‹ä¸­å¼•å…¥å¤šä¸ªè™šæ‹Ÿå˜é‡æ—¶ï¼Œè™šæ‹Ÿå˜é‡çš„ä¸ªæ•°åº”æŒ‰ä¸‹åˆ—åŸåˆ™ç¡®å®šï¼š å›å½’æ¨¡å‹æœ‰æˆªè·ï¼šä¸€èˆ¬çš„ï¼Œè‹¥è¯¥ç‰¹å¾ä¸‹nä¸ªå±æ€§å‡äº’æ–¥ï¼ˆå¦‚ï¼Œç”·/å¥³;å„¿ç«¥/é’å¹´/ä¸­å¹´/è€å¹´ï¼‰ï¼Œåœ¨ç”Ÿæˆè™šæ‹Ÿå˜é‡æ—¶ï¼Œåº”è¯¥ç”Ÿæˆ n-1ä¸ªè™šå˜é‡ï¼Œè¿™æ ·å¯ä»¥é¿å…äº§ç”Ÿå¤šé‡å…±çº¿æ€§ å›å½’æ¨¡å‹æ— æˆªè·é¡¹ï¼šæœ‰nä¸ªç‰¹å¾ï¼Œè®¾ç½®nä¸ªè™šæ‹Ÿå˜é‡ python å®ç°æ–¹æ³•pd.get_dummies() 2.1.2 æœ‰åºå˜é‡åˆ†ç®± æœ‰åºå¤šåˆ†ç±»å˜é‡æ˜¯å¾ˆå¸¸è§çš„å˜é‡å½¢å¼ï¼Œé€šå¸¸åœ¨å˜é‡ä¸­æœ‰å¤šä¸ªå¯èƒ½ä¼šå‡ºç°çš„å–å€¼ï¼Œå„å–å€¼ä¹‹é—´è¿˜å­˜åœ¨ç­‰çº§å…³ç³»ã€‚æ¯”å¦‚é«˜è¡€å‹åˆ†çº§ï¼ˆ0=æ­£å¸¸ï¼Œ1=æ­£å¸¸é«˜å€¼ï¼Œ2=1çº§é«˜è¡€å‹ï¼Œ3=2çº§é«˜è¡€å‹ï¼Œ4=3çº§é«˜è¡€å‹ï¼‰è¿™ç±»å˜é‡å¤„ç†èµ·æ¥ç®€ç›´ä¸è¦å¤ªçœå¿ƒï¼Œä½¿ç”¨ pandas ä¸­çš„ mapï¼ˆï¼‰æ›¿æ¢ç›¸åº”å˜é‡å°±è¡Œã€‚\n1 2 3 4 5 import pandas as pd df= pd.","title":"ç‰¹å¾å·¥ç¨‹ä¹‹æ•°æ®é¢„å¤„ç†"},{"content":"Summary æ•°æ®å’Œç‰¹å¾å†³å®šäº†æœºå™¨å­¦ä¹ çš„ä¸Šé™ï¼Œè€Œæ¨¡å‹å’Œç®—æ³•åªæ˜¯é€¼è¿‘è¿™ä¸ªä¸Šé™è€Œå·²ã€‚ç”±æ­¤å¯è§ï¼Œç‰¹å¾å·¥ç¨‹åœ¨æœºå™¨å­¦ä¹ ä¸­å æœ‰ç›¸å½“é‡è¦çš„åœ°ä½ã€‚åœ¨å®é™…åº”ç”¨å½“ä¸­ï¼Œå¯ä»¥è¯´ç‰¹å¾å·¥ç¨‹æ˜¯æœºå™¨å­¦ä¹ æˆåŠŸçš„å…³é”®ã€‚\né‚£ç‰¹å¾å·¥ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ\nâ€‹\tç‰¹å¾å·¥ç¨‹æ˜¯åˆ©ç”¨æ•°æ®é¢†åŸŸçš„ç›¸å…³çŸ¥è¯†æ¥åˆ›å»ºèƒ½å¤Ÿä½¿æœºå™¨å­¦ä¹ ç®—æ³•è¾¾åˆ°æœ€ä½³æ€§èƒ½çš„ç‰¹å¾çš„è¿‡ç¨‹ã€‚\nç‰¹å¾å·¥ç¨‹åˆåŒ…å«äº†Feature Selectionï¼ˆç‰¹å¾é€‰æ‹©ï¼‰ã€Feature Extractionï¼ˆç‰¹å¾æå–ï¼‰å’ŒFeature constructionï¼ˆç‰¹å¾æ„é€ ï¼‰ç­‰å­é—®é¢˜ï¼Œæœ¬ç« å†…å®¹ä¸»è¦è®¨è®ºç‰¹å¾é€‰æ‹©ç›¸å…³çš„æ–¹æ³•åŠå®ç°ã€‚\nåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæœ‰å¤§é‡çš„ç‰¹å¾å¯ä½¿ç”¨ï¼Œæœ‰çš„ç‰¹å¾æºå¸¦çš„ä¿¡æ¯ä¸°å¯Œï¼Œæœ‰çš„ç‰¹å¾æºå¸¦çš„ä¿¡æ¯æœ‰é‡å ï¼Œæœ‰çš„ç‰¹å¾åˆ™å±äºæ— å…³ç‰¹å¾ï¼Œå¦‚æœæ‰€æœ‰ç‰¹å¾ä¸ç»ç­›é€‰åœ°å…¨éƒ¨ä½œä¸ºè®­ç»ƒç‰¹å¾ï¼Œç»å¸¸ä¼šå‡ºç°ç»´åº¦ç¾éš¾é—®é¢˜ï¼Œç”šè‡³ä¼šé™ä½æ¨¡å‹çš„å‡†ç¡®æ€§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œç‰¹å¾ç­›é€‰ï¼Œæ’é™¤æ— æ•ˆ/å†—ä½™çš„ç‰¹å¾ï¼ŒæŠŠæœ‰ç”¨çš„ç‰¹å¾æŒ‘é€‰å‡ºæ¥ä½œä¸ºæ¨¡å‹çš„è®­ç»ƒæ•°æ®ã€‚\nç‰¹å¾é€‰æ‹©ä»‹ç» ç‰¹å¾æŒ‰é‡è¦æ€§åˆ†ç±» ç›¸å…³ç‰¹å¾\nå¯¹äºå­¦ä¹ ä»»åŠ¡ï¼ˆä¾‹å¦‚åˆ†ç±»é—®é¢˜ï¼‰æœ‰å¸®åŠ©ï¼Œå¯ä»¥æå‡å­¦ä¹ ç®—æ³•çš„æ•ˆæœ\næ— å…³ç‰¹å¾\nå¯¹äºæˆ‘ä»¬çš„ç®—æ³•æ²¡æœ‰ä»»ä½•å¸®åŠ©ï¼Œä¸ä¼šç»™ç®—æ³•çš„æ•ˆæœå¸¦æ¥ä»»ä½•æå‡\nå†—ä½™ç‰¹å¾\nä¸ä¼šå¯¹æˆ‘ä»¬çš„ç®—æ³•å¸¦æ¥æ–°çš„ä¿¡æ¯ï¼Œæˆ–è€…è¿™ç§ç‰¹å¾çš„ä¿¡æ¯å¯ä»¥ç”±å…¶ä»–çš„ç‰¹å¾æ¨æ–­å‡º\nç‰¹å¾é€‰æ‹©çš„ç›®çš„ å¯¹äºä¸€ä¸ªç‰¹å®šçš„å­¦ä¹ ç®—æ³•æ¥è¯´ï¼Œå“ªä¸€ä¸ªç‰¹å¾æ˜¯æœ‰æ•ˆçš„æ˜¯æœªçŸ¥çš„ã€‚å› æ­¤ï¼Œéœ€è¦ä»æ‰€æœ‰ç‰¹å¾ä¸­é€‰æ‹©å‡ºå¯¹äºå­¦ä¹ ç®—æ³•æœ‰ç›Šçš„ç›¸å…³ç‰¹å¾ã€‚è€Œä¸”åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç»å¸¸ä¼šå‡ºç°ç»´åº¦ç¾éš¾é—®é¢˜ã€‚å¦‚æœåªé€‰æ‹©æ‰€æœ‰ç‰¹å¾ä¸­çš„éƒ¨åˆ†ç‰¹å¾æ„å»ºæ¨¡å‹ï¼Œé‚£ä¹ˆå¯ä»¥å¤§å¤§å‡å°‘å­¦ä¹ ç®—æ³•çš„è¿è¡Œæ—¶é—´ï¼Œä¹Ÿå¯ä»¥å¢åŠ æ¨¡å‹çš„å¯è§£é‡Šæ€§\nç‰¹å¾é€‰æ‹©çš„åŸåˆ™ è·å–å°½å¯èƒ½å°çš„ç‰¹å¾å­é›†ï¼Œä¸æ˜¾è‘—é™ä½åˆ†ç±»ç²¾åº¦ã€ä¸å½±å“åˆ†ç±»åˆ†å¸ƒä»¥åŠç‰¹å¾å­é›†åº”å…·æœ‰ç¨³å®šã€é€‚åº”æ€§å¼ºç­‰ç‰¹ç‚¹\nç‰¹å¾é€‰æ‹©çš„æ–¹æ³• Filter æ–¹æ³•(è¿‡æ»¤å¼) å…ˆè¿›è¡Œç‰¹å¾é€‰æ‹©ï¼Œç„¶åå»è®­ç»ƒå­¦ä¹ å™¨ï¼Œæ‰€ä»¥ç‰¹å¾é€‰æ‹©çš„è¿‡ç¨‹ä¸å­¦ä¹ å™¨æ— å…³ã€‚ç›¸å½“äºå…ˆå¯¹ç‰¹å¾è¿›è¡Œè¿‡æ»¤æ“ä½œï¼Œç„¶åç”¨ç‰¹å¾å­é›†æ¥è®­ç»ƒåˆ†ç±»å™¨ã€‚\n**ä¸»è¦æ€æƒ³ï¼š**å¯¹æ¯ä¸€ç»´ç‰¹å¾â€œæ‰“åˆ†â€ï¼Œå³ç»™æ¯ä¸€ç»´çš„ç‰¹å¾èµ‹äºˆæƒé‡ï¼Œè¿™æ ·çš„æƒé‡å°±ä»£è¡¨ç€è¯¥ç‰¹å¾çš„é‡è¦æ€§ï¼Œç„¶åä¾æ®æƒé‡æ’åºã€‚\nä¸»è¦æ–¹æ³•ï¼š\nå¡æ–¹æ£€éªŒ ä¿¡æ¯å¢ç›Š ç›¸å…³ç³»æ•° ä¼˜ç‚¹: è¿è¡Œé€Ÿåº¦å¿«ï¼Œæ˜¯ä¸€ç§éå¸¸æµè¡Œçš„ç‰¹å¾é€‰æ‹©æ–¹æ³•ã€‚\n**ç¼ºç‚¹ï¼š**æ— æ³•æä¾›åé¦ˆï¼Œç‰¹å¾é€‰æ‹©çš„æ ‡å‡†/è§„èŒƒçš„åˆ¶å®šæ˜¯åœ¨ç‰¹å¾æœç´¢ç®—æ³•ä¸­å®Œæˆï¼Œå­¦ä¹ ç®—æ³•æ— æ³•å‘ç‰¹å¾æœç´¢ç®—æ³•ä¼ é€’å¯¹ç‰¹å¾çš„éœ€æ±‚ã€‚å¦å¤–ï¼Œå¯èƒ½å¤„ç†æŸä¸ªç‰¹å¾æ—¶ç”±äºä»»æ„åŸå› è¡¨ç¤ºè¯¥ç‰¹å¾ä¸é‡è¦ï¼Œä½†æ˜¯è¯¥ç‰¹å¾ä¸å…¶ä»–ç‰¹å¾ç»“åˆèµ·æ¥åˆ™å¯èƒ½å˜å¾—å¾ˆé‡è¦ã€‚\nWrapper æ–¹æ³• (å°è£…å¼) ç›´æ¥æŠŠæœ€åè¦ä½¿ç”¨çš„åˆ†ç±»å™¨ä½œä¸ºç‰¹å¾é€‰æ‹©çš„è¯„ä»·å‡½æ•°ï¼Œå¯¹äºç‰¹å®šçš„åˆ†ç±»å™¨é€‰æ‹©æœ€ä¼˜çš„ç‰¹å¾å­é›†ã€‚\nä¸»è¦æ€æƒ³ï¼š å°†å­é›†çš„é€‰æ‹©çœ‹ä½œæ˜¯ä¸€ä¸ªæœç´¢å¯»ä¼˜é—®é¢˜ï¼Œç”Ÿæˆä¸åŒçš„ç»„åˆï¼Œå¯¹ç»„åˆè¿›è¡Œè¯„ä»·ï¼Œå†ä¸å…¶ä»–çš„ç»„åˆè¿›è¡Œæ¯”è¾ƒã€‚è¿™æ ·å°±å°†å­é›†çš„é€‰æ‹©çœ‹ä½œæ˜¯ä¸€ä¸ªä¼˜åŒ–é—®é¢˜ï¼Œè¿™é‡Œæœ‰å¾ˆå¤šçš„ä¼˜åŒ–ç®—æ³•å¯ä»¥è§£å†³ï¼Œå°¤å…¶æ˜¯ä¸€äº›å¯å‘å¼çš„ä¼˜åŒ–ç®—æ³•ï¼Œå¦‚GAã€PSOï¼ˆå¦‚ï¼šä¼˜åŒ–ç®—æ³•-ç²’å­ç¾¤ç®—æ³•ï¼‰ã€DEã€ABCï¼ˆå¦‚ï¼šä¼˜åŒ–ç®—æ³•-äººå·¥èœ‚ç¾¤ç®—æ³•ï¼‰ç­‰ã€‚\nä¸»è¦æ–¹æ³•:\né€’å½’ç‰¹å¾æ¶ˆé™¤ç®—æ³• ä¼˜ç‚¹: å¯¹ç‰¹å¾è¿›è¡Œæœç´¢æ—¶å›´ç»•å­¦ä¹ ç®—æ³•å±•å¼€çš„ï¼Œå¯¹ç‰¹å¾é€‰æ‹©çš„æ ‡å‡†/è§„èŒƒæ˜¯åœ¨å­¦ä¹ ç®—æ³•çš„éœ€æ±‚ä¸­å±•å¼€çš„ï¼Œèƒ½å¤Ÿè€ƒè™‘å­¦ä¹ ç®—æ³•æ‰€å±çš„ä»»æ„å­¦ä¹ åå·®ï¼Œä»è€Œç¡®å®šæœ€ä½³å­ç‰¹å¾ï¼ŒçœŸæ­£å…³æ³¨çš„æ˜¯å­¦ä¹ é—®é¢˜æœ¬èº«ã€‚ç”±äºæ¯æ¬¡å°è¯•é’ˆå¯¹ç‰¹å®šå­é›†æ—¶å¿…é¡»è¿è¡Œå­¦ä¹ ç®—æ³•ï¼Œæ‰€ä»¥èƒ½å¤Ÿå…³æ³¨åˆ°å­¦ä¹ ç®—æ³•çš„å­¦ä¹ åå·®/å½’çº³åå·®ï¼Œå› æ­¤å°è£…èƒ½å¤Ÿå‘æŒ¥å·¨å¤§çš„ä½œç”¨ã€‚\nç¼ºç‚¹: è¿è¡Œé€Ÿåº¦è¿œæ…¢äºè¿‡æ»¤ç®—æ³•ï¼Œå®é™…åº”ç”¨ç”¨å°è£…æ–¹æ³•æ²¡æœ‰è¿‡æ»¤æ–¹æ³•æµè¡Œã€‚\nEmbedded æ–¹æ³•(åµŒå…¥å¼) å°†ç‰¹å¾é€‰æ‹©åµŒå…¥åˆ°æ¨¡å‹è®­ç»ƒå½“ä¸­ï¼Œå…¶è®­ç»ƒå¯èƒ½æ˜¯ç›¸åŒçš„æ¨¡å‹ï¼Œä½†æ˜¯ç‰¹å¾é€‰æ‹©å®Œæˆåï¼Œè¿˜èƒ½ç»™äºˆç‰¹å¾é€‰æ‹©å®Œæˆçš„ç‰¹å¾å’Œæ¨¡å‹è®­ç»ƒå‡ºçš„è¶…å‚æ•°ï¼Œå†æ¬¡è®­ç»ƒä¼˜åŒ–ã€‚\nä¸»è¦æ€æƒ³: åœ¨æ¨¡å‹æ—¢å®šçš„æƒ…å†µä¸‹å­¦ä¹ å‡ºå¯¹æé«˜æ¨¡å‹å‡†ç¡®æ€§æœ€å¥½çš„ç‰¹å¾ã€‚ä¹Ÿå°±æ˜¯åœ¨ç¡®å®šæ¨¡å‹çš„è¿‡ç¨‹ä¸­ï¼ŒæŒ‘é€‰å‡ºé‚£äº›å¯¹æ¨¡å‹çš„è®­ç»ƒæœ‰é‡è¦æ„ä¹‰çš„ç‰¹å¾ã€‚\nä¸»è¦æ–¹æ³•: ç”¨å¸¦æœ‰L1æ­£åˆ™åŒ–çš„é¡¹å®Œæˆç‰¹å¾é€‰æ‹©ï¼ˆä¹Ÿå¯ä»¥ç»“åˆL2æƒ©ç½šé¡¹æ¥ä¼˜åŒ–ï¼‰ã€éšæœºæ£®æ—å¹³å‡ä¸çº¯åº¦å‡å°‘æ³•/å¹³å‡ç²¾ç¡®åº¦å‡å°‘æ³•ã€‚\nä¼˜ç‚¹: å¯¹ç‰¹å¾è¿›è¡Œæœç´¢æ—¶å›´ç»•å­¦ä¹ ç®—æ³•å±•å¼€çš„ï¼Œèƒ½å¤Ÿè€ƒè™‘å­¦ä¹ ç®—æ³•æ‰€å±çš„ä»»æ„å­¦ä¹ åå·®ã€‚è®­ç»ƒæ¨¡å‹çš„æ¬¡æ•°å°äºWrapperæ–¹æ³•ï¼Œæ¯”è¾ƒèŠ‚çœæ—¶é—´ã€‚\nç¼ºç‚¹: è¿è¡Œé€Ÿåº¦æ…¢\nç‰¹å¾é€‰æ‹©çš„å®ç°æ–¹æ³• ä»ä¸¤ä¸ªæ–¹é¢è€ƒè™‘æ¥é€‰æ‹©ç‰¹å¾ï¼š ç‰¹å¾æ˜¯å¦å‘æ•£ï¼š å¦‚æœä¸€ä¸ªç‰¹å¾ä¸å‘æ•£ï¼Œä¾‹å¦‚æ–¹å·®æ¥è¿‘äº0ï¼Œä¹Ÿå°±æ˜¯è¯´æ ·æœ¬åœ¨è¿™ä¸ªç‰¹å¾ä¸ŠåŸºæœ¬ä¸Šæ²¡æœ‰å·®å¼‚ï¼Œè¿™ä¸ªç‰¹å¾å¯¹äºæ ·æœ¬çš„åŒºåˆ†å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ã€‚\nå‡è®¾æŸç‰¹å¾çš„ç‰¹å¾å€¼åªæœ‰0å’Œ1ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰è¾“å…¥æ ·æœ¬ä¸­ï¼Œ95%çš„å®ä¾‹çš„è¯¥ç‰¹å¾å–å€¼éƒ½æ˜¯1ï¼Œé‚£å°±å¯ä»¥è®¤ä¸ºè¿™ä¸ªç‰¹å¾ä½œç”¨ä¸å¤§ã€‚å¦‚æœ100%éƒ½æ˜¯1ï¼Œé‚£è¿™ä¸ªç‰¹å¾å°±æ²¡æ„ä¹‰äº†ã€‚\n**ç‰¹å¾ä¸ç›®æ ‡çš„ç›¸å…³æ€§ï¼š**è¿™ç‚¹æ¯”è¾ƒæ˜¾è§ï¼Œä¸ç›®æ ‡ç›¸å…³æ€§é«˜çš„ç‰¹å¾ï¼Œåº”å½“ä¼˜é€‰é€‰æ‹©ã€‚é™¤æ–¹å·®æ³•å¤–ï¼Œæœ¬æ–‡ä»‹ç»çš„å…¶ä»–æ–¹æ³•å‡ä»ç›¸å…³æ€§è€ƒè™‘ã€‚\nFilter: å¡æ–¹æ£€éªŒ ç»å…¸çš„å¡æ–¹æ£€éªŒæ˜¯æ£€éªŒå®šæ€§è‡ªå˜é‡å¯¹å®šæ€§å› å˜é‡çš„ç›¸å…³æ€§ã€‚å‡è®¾è‡ªå˜é‡æœ‰Nç§å–å€¼ï¼Œå› å˜é‡æœ‰Mç§å–å€¼ï¼Œè€ƒè™‘è‡ªå˜é‡ç­‰äºiä¸”å› å˜é‡ç­‰äºjçš„æ ·æœ¬é¢‘æ•°çš„è§‚å¯Ÿå€¼ä¸æœŸæœ›çš„å·®è·ï¼Œæ„å»ºç»Ÿè®¡é‡ï¼š\nä¸éš¾å‘ç°ï¼Œè¿™ä¸ªç»Ÿè®¡é‡çš„å«ä¹‰ç®€è€Œè¨€ä¹‹å°±æ˜¯è‡ªå˜é‡å¯¹å› å˜é‡çš„ç›¸å…³æ€§ã€‚ç”¨feature_selectionåº“çš„SelectKBestç±»ç»“åˆå¡æ–¹æ£€éªŒæ¥é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 from sklearn.feature_selection import SelectKBest from sklearn.feature_selection import chi2 #é€‰æ‹©Kä¸ªæœ€å¥½çš„ç‰¹å¾ï¼Œè¿”å›é€‰æ‹©ç‰¹å¾åçš„æ•°æ® SelectKBest(chi2, k=2).fit_transform(iris.data, iris.target) æ–¹å·®é€‰æ‹© ä½¿ç”¨æ–¹å·®é€‰æ‹©æ³•ï¼Œå…ˆè¦è®¡ç®—å„ä¸ªç‰¹å¾çš„æ–¹å·®ï¼Œç„¶åæ ¹æ®é˜ˆå€¼ï¼Œé€‰æ‹©æ–¹å·®å¤§äºé˜ˆå€¼çš„ç‰¹å¾ã€‚ä½¿ç”¨feature_selectionåº“çš„VarianceThresholdç±»æ¥é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 from sklearn.feature_selection import VarianceThreshold #æ–¹å·®é€‰æ‹©æ³•ï¼Œè¿”å›å€¼ä¸ºç‰¹å¾é€‰æ‹©åçš„æ•°æ® #å‚æ•°thresholdä¸ºæ–¹å·®çš„é˜ˆå€¼ VarianceThreshold(threshold=3).fit_transform(iris.data) ç›¸å…³ç³»æ•° ä½¿ç”¨ç›¸å…³ç³»æ•°æ³•ï¼Œå…ˆè¦è®¡ç®—å„ä¸ªç‰¹å¾å¯¹ç›®æ ‡å€¼çš„ç›¸å…³ç³»æ•°ä»¥åŠç›¸å…³ç³»æ•°çš„På€¼ã€‚ç”¨feature_selectionåº“çš„SelectKBestç±»ç»“åˆç›¸å…³ç³»æ•°æ¥é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 from sklearn.feature_selection import SelectKBest from scipy.stats import pearsonr #é€‰æ‹©Kä¸ªæœ€å¥½çš„ç‰¹å¾ï¼Œè¿”å›é€‰æ‹©ç‰¹å¾åçš„æ•°æ® #ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè®¡ç®—è¯„ä¼°ç‰¹å¾æ˜¯å¦å¥½çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°è¾“å…¥ç‰¹å¾çŸ©é˜µå’Œç›®æ ‡å‘é‡ï¼Œè¾“å‡ºäºŒå…ƒç»„ï¼ˆè¯„åˆ†ï¼ŒPå€¼ï¼‰çš„æ•°ç»„ï¼Œæ•°ç»„ç¬¬ié¡¹ä¸ºç¬¬iä¸ªç‰¹å¾çš„è¯„åˆ†å’ŒPå€¼ã€‚åœ¨æ­¤å®šä¹‰ä¸ºè®¡ç®—ç›¸å…³ç³»æ•° #å‚æ•°kä¸ºé€‰æ‹©çš„ç‰¹å¾ä¸ªæ•° SelectKBest(lambda X, Y: array(map(lambda x:pearsonr(x, Y), X.T)).T, k=2).fit_transform(iris.data, iris.target) äº’ä¿¡æ¯æ³• ç»å…¸çš„äº’ä¿¡æ¯ä¹Ÿæ˜¯è¯„ä»·å®šæ€§è‡ªå˜é‡å¯¹å®šæ€§å› å˜é‡çš„ç›¸å…³æ€§çš„ï¼Œäº’ä¿¡æ¯è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š\nä¸ºäº†å¤„ç†å®šé‡æ•°æ®ï¼Œæœ€å¤§ä¿¡æ¯ç³»æ•°æ³•è¢«æå‡ºï¼Œä½¿ç”¨feature_selectionåº“çš„SelectKBestç±»ç»“åˆæœ€å¤§ä¿¡æ¯ç³»æ•°æ³•æ¥é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 from sklearn.feature_selection import SelectKBest from minepy import MINE #ç”±äºMINEçš„è®¾è®¡ä¸æ˜¯å‡½æ•°å¼çš„ï¼Œå®šä¹‰micæ–¹æ³•å°†å…¶ä¸ºå‡½æ•°å¼çš„ï¼Œè¿”å›ä¸€ä¸ªäºŒå…ƒç»„ï¼ŒäºŒå…ƒç»„çš„ç¬¬2é¡¹è®¾ç½®æˆå›ºå®šçš„På€¼0.5 def mic(x, y): m = MINE() m.compute_score(x, y) return (m.mic(), 0.5) #é€‰æ‹©Kä¸ªæœ€å¥½çš„ç‰¹å¾ï¼Œè¿”å›ç‰¹å¾é€‰æ‹©åçš„æ•°æ® SelectKBest(lambda X, Y: array(map(lambda x:mic(x, Y), X.T)).T, k=2).fit_transform(iris.data, iris.target) Wrapper: é€’å½’ç‰¹å¾æ¶ˆé™¤æ³• é€’å½’æ¶ˆé™¤ç‰¹å¾æ³•ä½¿ç”¨ä¸€ä¸ªåŸºæ¨¡å‹æ¥è¿›è¡Œå¤šè½®è®­ç»ƒï¼Œæ¯è½®è®­ç»ƒåï¼Œæ¶ˆé™¤è‹¥å¹²æƒå€¼ç³»æ•°çš„ç‰¹å¾ï¼Œå†åŸºäºæ–°çš„ç‰¹å¾é›†è¿›è¡Œä¸‹ä¸€è½®è®­ç»ƒã€‚ä½¿ç”¨feature_selectionåº“çš„RFEç±»æ¥é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 from sklearn.feature_selection import RFE from sklearn.linear_model import LogisticRegression #é€’å½’ç‰¹å¾æ¶ˆé™¤æ³•ï¼Œè¿”å›ç‰¹å¾é€‰æ‹©åçš„æ•°æ® #å‚æ•°estimatorä¸ºåŸºæ¨¡å‹ #å‚æ•°n_features_to_selectä¸ºé€‰æ‹©çš„ç‰¹å¾ä¸ªæ•° RFE(estimator=LogisticRegression(), n_features_to_select=2).fit_transform(iris.data, iris.target) Embedded : åŸºäºæƒ©ç½šé¡¹çš„ç‰¹å¾é€‰æ‹©æ³• ä½¿ç”¨å¸¦æƒ©ç½šé¡¹çš„åŸºæ¨¡å‹ï¼Œé™¤äº†ç­›é€‰å‡ºç‰¹å¾å¤–ï¼ŒåŒæ—¶ä¹Ÿè¿›è¡Œäº†é™ç»´ã€‚ä½¿ç”¨feature_selectionåº“çš„SelectFromModelç±»ç»“åˆå¸¦L1æƒ©ç½šé¡¹çš„é€»è¾‘å›å½’æ¨¡å‹ï¼Œæ¥é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 from sklearn.feature_selection import SelectFromModel from sklearn.linear_model import LogisticRegression #å¸¦L1æƒ©ç½šé¡¹çš„é€»è¾‘å›å½’ä½œä¸ºåŸºæ¨¡å‹çš„ç‰¹å¾é€‰æ‹© SelectFromModel(LogisticRegression(penalty=\u0026#34;l1\u0026#34;, C=0.1)).fit_transform(iris.data, iris.target) å®é™…ä¸Šï¼ŒL1æƒ©ç½šé¡¹é™ç»´çš„åŸç†åœ¨äºä¿ç•™å¤šä¸ªå¯¹ç›®æ ‡å€¼å…·æœ‰åŒç­‰ç›¸å…³æ€§çš„ç‰¹å¾ä¸­çš„ä¸€ä¸ªï¼Œæ‰€ä»¥æ²¡é€‰åˆ°çš„ç‰¹å¾ä¸ä»£è¡¨ä¸é‡è¦ã€‚æ•…ï¼Œå¯ç»“åˆL2æƒ©ç½šé¡¹æ¥ä¼˜åŒ–ã€‚å…·ä½“æ“ä½œä¸ºï¼šè‹¥ä¸€ä¸ªç‰¹å¾åœ¨L1ä¸­çš„æƒå€¼ä¸º1ï¼Œé€‰æ‹©åœ¨L2ä¸­æƒå€¼å·®åˆ«ä¸å¤§ä¸”åœ¨L1ä¸­æƒå€¼ä¸º0çš„ç‰¹å¾æ„æˆåŒç±»é›†åˆï¼Œå°†è¿™ä¸€é›†åˆä¸­çš„ç‰¹å¾å¹³åˆ†L1ä¸­çš„æƒå€¼ï¼Œæ•…éœ€è¦æ„å»ºä¸€ä¸ªæ–°çš„é€»è¾‘å›å½’æ¨¡å‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 from sklearn.linear_model import LogisticRegression class LR(LogisticRegression): def __init__(self, threshold=0.01, dual=False, tol=1e-4, C=1.0, fit_intercept=True, intercept_scaling=1, class_weight=None, random_state=None, solver=\u0026#39;liblinear\u0026#39;, max_iter=100, multi_class=\u0026#39;ovr\u0026#39;, verbose=0, warm_start=False, n_jobs=1): #æƒå€¼ç›¸è¿‘çš„é˜ˆå€¼ self.threshold = threshold LogisticRegression.__init__(self, penalty=\u0026#39;l1\u0026#39;, dual=dual, tol=tol, C=C, fit_intercept=fit_intercept, intercept_scaling=intercept_scaling, class_weight=class_weight, random_state=random_state, solver=solver, max_iter=max_iter, multi_class=multi_class, verbose=verbose, warm_start=warm_start, n_jobs=n_jobs) #ä½¿ç”¨åŒæ ·çš„å‚æ•°åˆ›å»ºL2é€»è¾‘å›å½’ self.l2 = LogisticRegression(penalty=\u0026#39;l2\u0026#39;, dual=dual, tol=tol, C=C, fit_intercept=fit_intercept, intercept_scaling=intercept_scaling, class_weight = class_weight, random_state=random_state, solver=solver, max_iter=max_iter, multi_class=multi_class, verbose=verbose, warm_start=warm_start, n_jobs=n_jobs) def fit(self, X, y, sample_weight=None): #è®­ç»ƒL1é€»è¾‘å›å½’ super(LR, self).fit(X, y, sample_weight=sample_weight) self.coef_old_ = self.coef_.copy() #è®­ç»ƒL2é€»è¾‘å›å½’ self.l2.fit(X, y, sample_weight=sample_weight) cntOfRow, cntOfCol = self.coef_.shape #æƒå€¼ç³»æ•°çŸ©é˜µçš„è¡Œæ•°å¯¹åº”ç›®æ ‡å€¼çš„ç§ç±»æ•°ç›® for i in range(cntOfRow): for j in range(cntOfCol): coef = self.coef_[i][j] #L1é€»è¾‘å›å½’çš„æƒå€¼ç³»æ•°ä¸ä¸º0 if coef != 0: idx = [j] #å¯¹åº”åœ¨L2é€»è¾‘å›å½’ä¸­çš„æƒå€¼ç³»æ•° coef1 = self.l2.coef_[i][j] for k in range(cntOfCol): coef2 = self.l2.coef_[i][k] #åœ¨L2é€»è¾‘å›å½’ä¸­ï¼Œæƒå€¼ç³»æ•°ä¹‹å·®å°äºè®¾å®šçš„é˜ˆå€¼ï¼Œä¸”åœ¨L1ä¸­å¯¹åº”çš„æƒå€¼ä¸º0 if abs(coef1-coef2) \u0026lt; self.threshold and j != k and self.coef_[i][k] == 0: idx.append(k) #è®¡ç®—è¿™ä¸€ç±»ç‰¹å¾çš„æƒå€¼ç³»æ•°å‡å€¼ mean = coef / len(idx) self.coef_[i][idx] = mean return self ä½¿ç”¨feature_selectionåº“çš„SelectFromModelç±»ç»“åˆå¸¦L1ä»¥åŠL2æƒ©ç½šé¡¹çš„é€»è¾‘å›å½’æ¨¡å‹ï¼Œæ¥é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 from sklearn.feature_selection import SelectFromModel #å¸¦L1å’ŒL2æƒ©ç½šé¡¹çš„é€»è¾‘å›å½’ä½œä¸ºåŸºæ¨¡å‹çš„ç‰¹å¾é€‰æ‹© #å‚æ•°thresholdä¸ºæƒå€¼ç³»æ•°ä¹‹å·®çš„é˜ˆå€¼ SelectFromModel(LR(threshold=0.5, C=0.1)).fit_transform(iris.data, iris.target) åŸºäºæ ‘æ¨¡å‹çš„ç‰¹å¾é€‰æ‹©æ³•\næ ‘æ¨¡å‹ä¸­GBDTä¹Ÿå¯ç”¨æ¥ä½œä¸ºåŸºæ¨¡å‹è¿›è¡Œç‰¹å¾é€‰æ‹©ï¼Œä½¿ç”¨feature_selectionåº“çš„SelectFromModelç±»ç»“åˆGBDTæ¨¡å‹ï¼Œæ¥é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 from sklearn.feature_selection import SelectFromModel from sklearn.ensemble import GradientBoostingClassifier #GBDTä½œä¸ºåŸºæ¨¡å‹çš„ç‰¹å¾é€‰æ‹© SelectFromModel(GradientBoostingClassifier()).fit_transform(iris.data, iris.target) é™ç»´ å½“ç‰¹å¾é€‰æ‹©å®Œæˆåï¼Œå¯ä»¥ç›´æ¥è®­ç»ƒæ¨¡å‹äº†ï¼Œä½†æ˜¯å¯èƒ½ç”±äºç‰¹å¾çŸ©é˜µè¿‡å¤§ï¼Œå¯¼è‡´è®¡ç®—é‡å¤§ï¼Œè®­ç»ƒæ—¶é—´é•¿çš„é—®é¢˜ï¼Œå› æ­¤é™ä½ç‰¹å¾çŸ©é˜µç»´åº¦ä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„ã€‚å¸¸è§çš„é™ç»´æ–¹æ³•é™¤äº†ä»¥ä¸Šæåˆ°çš„åŸºäºL1æƒ©ç½šé¡¹çš„æ¨¡å‹ä»¥å¤–ï¼Œå¦å¤–è¿˜æœ‰ä¸»æˆåˆ†åˆ†ææ³•ï¼ˆPCAï¼‰å’Œçº¿æ€§åˆ¤åˆ«åˆ†æï¼ˆLDAï¼‰ï¼Œçº¿æ€§åˆ¤åˆ«åˆ†ææœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªåˆ†ç±»æ¨¡å‹ã€‚PCAå’ŒLDAæœ‰å¾ˆå¤šçš„ç›¸ä¼¼ç‚¹ï¼Œå…¶æœ¬è´¨æ˜¯è¦å°†åŸå§‹çš„æ ·æœ¬æ˜ å°„åˆ°ç»´åº¦æ›´ä½çš„æ ·æœ¬ç©ºé—´ä¸­ï¼Œä½†æ˜¯PCAå’ŒLDAçš„æ˜ å°„ç›®æ ‡ä¸ä¸€æ ·ï¼šPCAæ˜¯ä¸ºäº†è®©æ˜ å°„åçš„æ ·æœ¬å…·æœ‰æœ€å¤§çš„å‘æ•£æ€§ï¼›è€ŒLDAæ˜¯ä¸ºäº†è®©æ˜ å°„åçš„æ ·æœ¬æœ‰æœ€å¥½çš„åˆ†ç±»æ€§èƒ½ã€‚æ‰€ä»¥è¯´PCAæ˜¯ä¸€ç§æ— ç›‘ç£çš„é™ç»´æ–¹æ³•ï¼Œè€ŒLDAæ˜¯ä¸€ç§æœ‰ç›‘ç£çš„é™ç»´æ–¹æ³•ã€‚\nä¸»æˆåˆ†åˆ†ææ³•(PCA) ä½¿ç”¨decompositionåº“çš„PCAç±»é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 from sklearn.decomposition import PCA #ä¸»æˆåˆ†åˆ†ææ³•ï¼Œè¿”å›é™ç»´åçš„æ•°æ® #å‚æ•°n_componentsä¸ºä¸»æˆåˆ†æ•°ç›® PCA(n_components=2).fit_transform(iris.data) çº¿æ€§åˆ¤åˆ«åˆ†ææ³•ï¼ˆLDAï¼‰ ä½¿ç”¨ldaåº“çš„LDAç±»é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 from sklearn.lda import LDA #çº¿æ€§åˆ¤åˆ«åˆ†ææ³•ï¼Œè¿”å›é™ç»´åçš„æ•°æ® #å‚æ•°n_componentsä¸ºé™ç»´åçš„ç»´æ•° LDA(n_components=2).fit_transform(iris.data, iris.target) ä»€ä¹ˆæ˜¯ç‰¹å¾é€‰æ‹©ï¼Œä¸ºä»€ä¹ˆè¦è¿›è¡Œç‰¹å¾é€‰æ‹©ï¼Œä»¥åŠå¦‚ä½•è¿›è¡Œï¼Ÿ ç‰¹å¾é€‰æ‹©æ˜¯é€šè¿‡é€‰æ‹©æ—§å±æ€§çš„å­é›†å¾—åˆ°æ–°å±æ€§ï¼Œæ˜¯ä¸€ç§ç»´è§„çº¦æ–¹å¼ã€‚\nWhyï¼š åº”ç”¨æ–¹é¢ï¼šæå‡å‡†ç¡®ç‡ï¼Œç‰¹å¾é€‰æ‹©èƒ½å¤Ÿåˆ é™¤å†—ä½™ä¸ç›¸å…³çš„ç‰¹å¾å¹¶é™ä½å™ªå£°ï¼Œé¿å…ç»´ç¾éš¾ã€‚åœ¨è®¸å¤šæ•°æ®æŒ–æ˜ç®—æ³•ä¸­ï¼Œç»´åº¦è¾ƒä½ï¼Œæ•ˆæœæ›´å¥½ï¼›\næ‰§è¡Œæ–¹é¢ï¼šç»´åº¦è¶Šå°‘ï¼Œè¿è¡Œæ•ˆç‡è¶Šé«˜ï¼ŒåŒæ—¶å†…å­˜éœ€æ±‚è¶Šå°‘ã€‚\nHow: è¿‡æ»¤æ–¹æ³•ï¼Œç‹¬ç«‹äºç®—æ³•ï¼Œåœ¨ç®—æ³•è¿è¡Œå‰è¿›è¡Œç‰¹å¾é€‰æ‹©ã€‚å¦‚å¯ä»¥é€‰æ‹©å±æ€§çš„é›†åˆï¼Œé›†åˆå†…å±æ€§å¯¹ä¹‹é—´çš„ç›¸å…³åº¦å°½å¯èƒ½ä½ã€‚å¸¸ç”¨å¯¹ç‰¹å¾é‡è¦æ€§ï¼ˆæ–¹å·®ï¼Œäº’ä¿¡æ¯ï¼Œç›¸å…³ç³»æ•°ï¼Œå¡æ–¹æ£€éªŒï¼‰æ’åºé€‰æ‹©ï¼›å¯ç»“åˆåˆ«çš„ç®—æ³•ï¼ˆéšæœºæ£®æ—ï¼ŒGBDTç­‰ï¼‰è¿›è¡Œç‰¹å¾é‡è¦æ€§æå–ï¼Œè¿‡æ»¤ä¹‹åå†åº”ç”¨äºå½“å‰ç®—æ³•ã€‚ åŒ…è£…æ–¹æ³•ï¼Œç®—æ³•ä½œä¸ºé»‘ç›’ï¼Œåœ¨ç¡®å®šæ¨¡å‹å’Œè¯„ä»·å‡†åˆ™ä¹‹åï¼Œå¯¹ç‰¹å¾ç©ºé—´çš„ä¸åŒå­é›†åšäº¤å‰éªŒè¯ï¼Œè¿›è€Œæœç´¢æœ€ä½³ç‰¹å¾å­é›†ã€‚æ·±åº¦å­¦ä¹ å…·æœ‰è‡ªåŠ¨åŒ–åŒ…è£…å­¦ä¹ çš„ç‰¹æ€§ã€‚ æ€»ä¹‹ï¼Œç‰¹å¾å­é›†é€‰æ‹©æ˜¯æœç´¢æ‰€æœ‰å¯èƒ½çš„ç‰¹æ€§å­é›†çš„è¿‡ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„æœç´¢ç­–ç•¥ï¼Œä½†æ˜¯æœç´¢ç­–ç•¥çš„æ•ˆç‡è¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¹¶ä¸”åº”å½“æ‰¾åˆ°æœ€ä¼˜æˆ–è¿‘ä¼¼æœ€ä¼˜çš„ç‰¹å¾å­é›†ã€‚ åµŒå…¥æ–¹æ³•ï¼Œç®—æ³•æœ¬èº«å†³å®šä½¿ç”¨å“ªäº›å±æ€§å’Œå¿½ç•¥å“ªäº›å±æ€§ã€‚å³ç‰¹å¾é€‰æ‹©ä¸è®­ç»ƒè¿‡ç¨‹èä¸ºä¸€ä½“ï¼Œæ¯”å¦‚L1æ­£åˆ™ã€å†³ç­–æ ‘ç­‰ï¼› å‚è€ƒ: https://blog.csdn.net/Dream_angel_Z/article/details/49388733\n","permalink":"https://reid00.github.io/en/posts/ml/%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B%E4%B9%8B%E7%89%B9%E5%BE%81%E9%80%89%E6%8B%A9/","summary":"Summary æ•°æ®å’Œç‰¹å¾å†³å®šäº†æœºå™¨å­¦ä¹ çš„ä¸Šé™ï¼Œè€Œæ¨¡å‹å’Œç®—æ³•åªæ˜¯é€¼è¿‘è¿™ä¸ªä¸Šé™è€Œå·²ã€‚ç”±æ­¤å¯è§ï¼Œç‰¹å¾å·¥ç¨‹åœ¨æœºå™¨å­¦ä¹ ä¸­å æœ‰ç›¸å½“é‡è¦çš„åœ°ä½ã€‚åœ¨å®é™…åº”ç”¨å½“ä¸­ï¼Œå¯ä»¥è¯´ç‰¹å¾å·¥ç¨‹æ˜¯æœºå™¨å­¦ä¹ æˆåŠŸçš„å…³é”®ã€‚\né‚£ç‰¹å¾å·¥ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿ\nâ€‹\tç‰¹å¾å·¥ç¨‹æ˜¯åˆ©ç”¨æ•°æ®é¢†åŸŸçš„ç›¸å…³çŸ¥è¯†æ¥åˆ›å»ºèƒ½å¤Ÿä½¿æœºå™¨å­¦ä¹ ç®—æ³•è¾¾åˆ°æœ€ä½³æ€§èƒ½çš„ç‰¹å¾çš„è¿‡ç¨‹ã€‚\nç‰¹å¾å·¥ç¨‹åˆåŒ…å«äº†Feature Selectionï¼ˆç‰¹å¾é€‰æ‹©ï¼‰ã€Feature Extractionï¼ˆç‰¹å¾æå–ï¼‰å’ŒFeature constructionï¼ˆç‰¹å¾æ„é€ ï¼‰ç­‰å­é—®é¢˜ï¼Œæœ¬ç« å†…å®¹ä¸»è¦è®¨è®ºç‰¹å¾é€‰æ‹©ç›¸å…³çš„æ–¹æ³•åŠå®ç°ã€‚\nåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæœ‰å¤§é‡çš„ç‰¹å¾å¯ä½¿ç”¨ï¼Œæœ‰çš„ç‰¹å¾æºå¸¦çš„ä¿¡æ¯ä¸°å¯Œï¼Œæœ‰çš„ç‰¹å¾æºå¸¦çš„ä¿¡æ¯æœ‰é‡å ï¼Œæœ‰çš„ç‰¹å¾åˆ™å±äºæ— å…³ç‰¹å¾ï¼Œå¦‚æœæ‰€æœ‰ç‰¹å¾ä¸ç»ç­›é€‰åœ°å…¨éƒ¨ä½œä¸ºè®­ç»ƒç‰¹å¾ï¼Œç»å¸¸ä¼šå‡ºç°ç»´åº¦ç¾éš¾é—®é¢˜ï¼Œç”šè‡³ä¼šé™ä½æ¨¡å‹çš„å‡†ç¡®æ€§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œç‰¹å¾ç­›é€‰ï¼Œæ’é™¤æ— æ•ˆ/å†—ä½™çš„ç‰¹å¾ï¼ŒæŠŠæœ‰ç”¨çš„ç‰¹å¾æŒ‘é€‰å‡ºæ¥ä½œä¸ºæ¨¡å‹çš„è®­ç»ƒæ•°æ®ã€‚\nç‰¹å¾é€‰æ‹©ä»‹ç» ç‰¹å¾æŒ‰é‡è¦æ€§åˆ†ç±» ç›¸å…³ç‰¹å¾\nå¯¹äºå­¦ä¹ ä»»åŠ¡ï¼ˆä¾‹å¦‚åˆ†ç±»é—®é¢˜ï¼‰æœ‰å¸®åŠ©ï¼Œå¯ä»¥æå‡å­¦ä¹ ç®—æ³•çš„æ•ˆæœ\næ— å…³ç‰¹å¾\nå¯¹äºæˆ‘ä»¬çš„ç®—æ³•æ²¡æœ‰ä»»ä½•å¸®åŠ©ï¼Œä¸ä¼šç»™ç®—æ³•çš„æ•ˆæœå¸¦æ¥ä»»ä½•æå‡\nå†—ä½™ç‰¹å¾\nä¸ä¼šå¯¹æˆ‘ä»¬çš„ç®—æ³•å¸¦æ¥æ–°çš„ä¿¡æ¯ï¼Œæˆ–è€…è¿™ç§ç‰¹å¾çš„ä¿¡æ¯å¯ä»¥ç”±å…¶ä»–çš„ç‰¹å¾æ¨æ–­å‡º\nç‰¹å¾é€‰æ‹©çš„ç›®çš„ å¯¹äºä¸€ä¸ªç‰¹å®šçš„å­¦ä¹ ç®—æ³•æ¥è¯´ï¼Œå“ªä¸€ä¸ªç‰¹å¾æ˜¯æœ‰æ•ˆçš„æ˜¯æœªçŸ¥çš„ã€‚å› æ­¤ï¼Œéœ€è¦ä»æ‰€æœ‰ç‰¹å¾ä¸­é€‰æ‹©å‡ºå¯¹äºå­¦ä¹ ç®—æ³•æœ‰ç›Šçš„ç›¸å…³ç‰¹å¾ã€‚è€Œä¸”åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç»å¸¸ä¼šå‡ºç°ç»´åº¦ç¾éš¾é—®é¢˜ã€‚å¦‚æœåªé€‰æ‹©æ‰€æœ‰ç‰¹å¾ä¸­çš„éƒ¨åˆ†ç‰¹å¾æ„å»ºæ¨¡å‹ï¼Œé‚£ä¹ˆå¯ä»¥å¤§å¤§å‡å°‘å­¦ä¹ ç®—æ³•çš„è¿è¡Œæ—¶é—´ï¼Œä¹Ÿå¯ä»¥å¢åŠ æ¨¡å‹çš„å¯è§£é‡Šæ€§\nç‰¹å¾é€‰æ‹©çš„åŸåˆ™ è·å–å°½å¯èƒ½å°çš„ç‰¹å¾å­é›†ï¼Œä¸æ˜¾è‘—é™ä½åˆ†ç±»ç²¾åº¦ã€ä¸å½±å“åˆ†ç±»åˆ†å¸ƒä»¥åŠç‰¹å¾å­é›†åº”å…·æœ‰ç¨³å®šã€é€‚åº”æ€§å¼ºç­‰ç‰¹ç‚¹\nç‰¹å¾é€‰æ‹©çš„æ–¹æ³• Filter æ–¹æ³•(è¿‡æ»¤å¼) å…ˆè¿›è¡Œç‰¹å¾é€‰æ‹©ï¼Œç„¶åå»è®­ç»ƒå­¦ä¹ å™¨ï¼Œæ‰€ä»¥ç‰¹å¾é€‰æ‹©çš„è¿‡ç¨‹ä¸å­¦ä¹ å™¨æ— å…³ã€‚ç›¸å½“äºå…ˆå¯¹ç‰¹å¾è¿›è¡Œè¿‡æ»¤æ“ä½œï¼Œç„¶åç”¨ç‰¹å¾å­é›†æ¥è®­ç»ƒåˆ†ç±»å™¨ã€‚\n**ä¸»è¦æ€æƒ³ï¼š**å¯¹æ¯ä¸€ç»´ç‰¹å¾â€œæ‰“åˆ†â€ï¼Œå³ç»™æ¯ä¸€ç»´çš„ç‰¹å¾èµ‹äºˆæƒé‡ï¼Œè¿™æ ·çš„æƒé‡å°±ä»£è¡¨ç€è¯¥ç‰¹å¾çš„é‡è¦æ€§ï¼Œç„¶åä¾æ®æƒé‡æ’åºã€‚\nä¸»è¦æ–¹æ³•ï¼š\nå¡æ–¹æ£€éªŒ ä¿¡æ¯å¢ç›Š ç›¸å…³ç³»æ•° ä¼˜ç‚¹: è¿è¡Œé€Ÿåº¦å¿«ï¼Œæ˜¯ä¸€ç§éå¸¸æµè¡Œçš„ç‰¹å¾é€‰æ‹©æ–¹æ³•ã€‚\n**ç¼ºç‚¹ï¼š**æ— æ³•æä¾›åé¦ˆï¼Œç‰¹å¾é€‰æ‹©çš„æ ‡å‡†/è§„èŒƒçš„åˆ¶å®šæ˜¯åœ¨ç‰¹å¾æœç´¢ç®—æ³•ä¸­å®Œæˆï¼Œå­¦ä¹ ç®—æ³•æ— æ³•å‘ç‰¹å¾æœç´¢ç®—æ³•ä¼ é€’å¯¹ç‰¹å¾çš„éœ€æ±‚ã€‚å¦å¤–ï¼Œå¯èƒ½å¤„ç†æŸä¸ªç‰¹å¾æ—¶ç”±äºä»»æ„åŸå› è¡¨ç¤ºè¯¥ç‰¹å¾ä¸é‡è¦ï¼Œä½†æ˜¯è¯¥ç‰¹å¾ä¸å…¶ä»–ç‰¹å¾ç»“åˆèµ·æ¥åˆ™å¯èƒ½å˜å¾—å¾ˆé‡è¦ã€‚\nWrapper æ–¹æ³• (å°è£…å¼) ç›´æ¥æŠŠæœ€åè¦ä½¿ç”¨çš„åˆ†ç±»å™¨ä½œä¸ºç‰¹å¾é€‰æ‹©çš„è¯„ä»·å‡½æ•°ï¼Œå¯¹äºç‰¹å®šçš„åˆ†ç±»å™¨é€‰æ‹©æœ€ä¼˜çš„ç‰¹å¾å­é›†ã€‚\nä¸»è¦æ€æƒ³ï¼š å°†å­é›†çš„é€‰æ‹©çœ‹ä½œæ˜¯ä¸€ä¸ªæœç´¢å¯»ä¼˜é—®é¢˜ï¼Œç”Ÿæˆä¸åŒçš„ç»„åˆï¼Œå¯¹ç»„åˆè¿›è¡Œè¯„ä»·ï¼Œå†ä¸å…¶ä»–çš„ç»„åˆè¿›è¡Œæ¯”è¾ƒã€‚è¿™æ ·å°±å°†å­é›†çš„é€‰æ‹©çœ‹ä½œæ˜¯ä¸€ä¸ªä¼˜åŒ–é—®é¢˜ï¼Œè¿™é‡Œæœ‰å¾ˆå¤šçš„ä¼˜åŒ–ç®—æ³•å¯ä»¥è§£å†³ï¼Œå°¤å…¶æ˜¯ä¸€äº›å¯å‘å¼çš„ä¼˜åŒ–ç®—æ³•ï¼Œå¦‚GAã€PSOï¼ˆå¦‚ï¼šä¼˜åŒ–ç®—æ³•-ç²’å­ç¾¤ç®—æ³•ï¼‰ã€DEã€ABCï¼ˆå¦‚ï¼šä¼˜åŒ–ç®—æ³•-äººå·¥èœ‚ç¾¤ç®—æ³•ï¼‰ç­‰ã€‚\nä¸»è¦æ–¹æ³•:\né€’å½’ç‰¹å¾æ¶ˆé™¤ç®—æ³• ä¼˜ç‚¹: å¯¹ç‰¹å¾è¿›è¡Œæœç´¢æ—¶å›´ç»•å­¦ä¹ ç®—æ³•å±•å¼€çš„ï¼Œå¯¹ç‰¹å¾é€‰æ‹©çš„æ ‡å‡†/è§„èŒƒæ˜¯åœ¨å­¦ä¹ ç®—æ³•çš„éœ€æ±‚ä¸­å±•å¼€çš„ï¼Œèƒ½å¤Ÿè€ƒè™‘å­¦ä¹ ç®—æ³•æ‰€å±çš„ä»»æ„å­¦ä¹ åå·®ï¼Œä»è€Œç¡®å®šæœ€ä½³å­ç‰¹å¾ï¼ŒçœŸæ­£å…³æ³¨çš„æ˜¯å­¦ä¹ é—®é¢˜æœ¬èº«ã€‚ç”±äºæ¯æ¬¡å°è¯•é’ˆå¯¹ç‰¹å®šå­é›†æ—¶å¿…é¡»è¿è¡Œå­¦ä¹ ç®—æ³•ï¼Œæ‰€ä»¥èƒ½å¤Ÿå…³æ³¨åˆ°å­¦ä¹ ç®—æ³•çš„å­¦ä¹ åå·®/å½’çº³åå·®ï¼Œå› æ­¤å°è£…èƒ½å¤Ÿå‘æŒ¥å·¨å¤§çš„ä½œç”¨ã€‚\nç¼ºç‚¹: è¿è¡Œé€Ÿåº¦è¿œæ…¢äºè¿‡æ»¤ç®—æ³•ï¼Œå®é™…åº”ç”¨ç”¨å°è£…æ–¹æ³•æ²¡æœ‰è¿‡æ»¤æ–¹æ³•æµè¡Œã€‚\nEmbedded æ–¹æ³•(åµŒå…¥å¼) å°†ç‰¹å¾é€‰æ‹©åµŒå…¥åˆ°æ¨¡å‹è®­ç»ƒå½“ä¸­ï¼Œå…¶è®­ç»ƒå¯èƒ½æ˜¯ç›¸åŒçš„æ¨¡å‹ï¼Œä½†æ˜¯ç‰¹å¾é€‰æ‹©å®Œæˆåï¼Œè¿˜èƒ½ç»™äºˆç‰¹å¾é€‰æ‹©å®Œæˆçš„ç‰¹å¾å’Œæ¨¡å‹è®­ç»ƒå‡ºçš„è¶…å‚æ•°ï¼Œå†æ¬¡è®­ç»ƒä¼˜åŒ–ã€‚\nä¸»è¦æ€æƒ³: åœ¨æ¨¡å‹æ—¢å®šçš„æƒ…å†µä¸‹å­¦ä¹ å‡ºå¯¹æé«˜æ¨¡å‹å‡†ç¡®æ€§æœ€å¥½çš„ç‰¹å¾ã€‚ä¹Ÿå°±æ˜¯åœ¨ç¡®å®šæ¨¡å‹çš„è¿‡ç¨‹ä¸­ï¼ŒæŒ‘é€‰å‡ºé‚£äº›å¯¹æ¨¡å‹çš„è®­ç»ƒæœ‰é‡è¦æ„ä¹‰çš„ç‰¹å¾ã€‚\nä¸»è¦æ–¹æ³•: ç”¨å¸¦æœ‰L1æ­£åˆ™åŒ–çš„é¡¹å®Œæˆç‰¹å¾é€‰æ‹©ï¼ˆä¹Ÿå¯ä»¥ç»“åˆL2æƒ©ç½šé¡¹æ¥ä¼˜åŒ–ï¼‰ã€éšæœºæ£®æ—å¹³å‡ä¸çº¯åº¦å‡å°‘æ³•/å¹³å‡ç²¾ç¡®åº¦å‡å°‘æ³•ã€‚\nä¼˜ç‚¹: å¯¹ç‰¹å¾è¿›è¡Œæœç´¢æ—¶å›´ç»•å­¦ä¹ ç®—æ³•å±•å¼€çš„ï¼Œèƒ½å¤Ÿè€ƒè™‘å­¦ä¹ ç®—æ³•æ‰€å±çš„ä»»æ„å­¦ä¹ åå·®ã€‚è®­ç»ƒæ¨¡å‹çš„æ¬¡æ•°å°äºWrapperæ–¹æ³•ï¼Œæ¯”è¾ƒèŠ‚çœæ—¶é—´ã€‚\nç¼ºç‚¹: è¿è¡Œé€Ÿåº¦æ…¢\nç‰¹å¾é€‰æ‹©çš„å®ç°æ–¹æ³• ä»ä¸¤ä¸ªæ–¹é¢è€ƒè™‘æ¥é€‰æ‹©ç‰¹å¾ï¼š ç‰¹å¾æ˜¯å¦å‘æ•£ï¼š å¦‚æœä¸€ä¸ªç‰¹å¾ä¸å‘æ•£ï¼Œä¾‹å¦‚æ–¹å·®æ¥è¿‘äº0ï¼Œä¹Ÿå°±æ˜¯è¯´æ ·æœ¬åœ¨è¿™ä¸ªç‰¹å¾ä¸ŠåŸºæœ¬ä¸Šæ²¡æœ‰å·®å¼‚ï¼Œè¿™ä¸ªç‰¹å¾å¯¹äºæ ·æœ¬çš„åŒºåˆ†å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ã€‚\nå‡è®¾æŸç‰¹å¾çš„ç‰¹å¾å€¼åªæœ‰0å’Œ1ï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰è¾“å…¥æ ·æœ¬ä¸­ï¼Œ95%çš„å®ä¾‹çš„è¯¥ç‰¹å¾å–å€¼éƒ½æ˜¯1ï¼Œé‚£å°±å¯ä»¥è®¤ä¸ºè¿™ä¸ªç‰¹å¾ä½œç”¨ä¸å¤§ã€‚å¦‚æœ100%éƒ½æ˜¯1ï¼Œé‚£è¿™ä¸ªç‰¹å¾å°±æ²¡æ„ä¹‰äº†ã€‚\n**ç‰¹å¾ä¸ç›®æ ‡çš„ç›¸å…³æ€§ï¼š**è¿™ç‚¹æ¯”è¾ƒæ˜¾è§ï¼Œä¸ç›®æ ‡ç›¸å…³æ€§é«˜çš„ç‰¹å¾ï¼Œåº”å½“ä¼˜é€‰é€‰æ‹©ã€‚é™¤æ–¹å·®æ³•å¤–ï¼Œæœ¬æ–‡ä»‹ç»çš„å…¶ä»–æ–¹æ³•å‡ä»ç›¸å…³æ€§è€ƒè™‘ã€‚\nFilter: å¡æ–¹æ£€éªŒ ç»å…¸çš„å¡æ–¹æ£€éªŒæ˜¯æ£€éªŒå®šæ€§è‡ªå˜é‡å¯¹å®šæ€§å› å˜é‡çš„ç›¸å…³æ€§ã€‚å‡è®¾è‡ªå˜é‡æœ‰Nç§å–å€¼ï¼Œå› å˜é‡æœ‰Mç§å–å€¼ï¼Œè€ƒè™‘è‡ªå˜é‡ç­‰äºiä¸”å› å˜é‡ç­‰äºjçš„æ ·æœ¬é¢‘æ•°çš„è§‚å¯Ÿå€¼ä¸æœŸæœ›çš„å·®è·ï¼Œæ„å»ºç»Ÿè®¡é‡ï¼š\nä¸éš¾å‘ç°ï¼Œè¿™ä¸ªç»Ÿè®¡é‡çš„å«ä¹‰ç®€è€Œè¨€ä¹‹å°±æ˜¯è‡ªå˜é‡å¯¹å› å˜é‡çš„ç›¸å…³æ€§ã€‚ç”¨feature_selectionåº“çš„SelectKBestç±»ç»“åˆå¡æ–¹æ£€éªŒæ¥é€‰æ‹©ç‰¹å¾çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 from sklearn.","title":"ç‰¹å¾å·¥ç¨‹ä¹‹ç‰¹å¾é€‰æ‹©"},{"content":"ç®€ä»‹ æŸå¤±å‡½æ•°ç”¨æ¥è¯„ä»·æ¨¡å‹çš„é¢„æµ‹å€¼å’ŒçœŸå®å€¼ä¸ä¸€æ ·çš„ç¨‹åº¦ï¼ŒæŸå¤±å‡½æ•°è¶Šå¥½ï¼Œé€šå¸¸æ¨¡å‹çš„æ€§èƒ½è¶Šå¥½ã€‚ä¸åŒçš„æ¨¡å‹ç”¨çš„æŸå¤±å‡½æ•°ä¸€èˆ¬ä¹Ÿä¸ä¸€æ ·ã€‚\næŸå¤±å‡½æ•°åˆ†ä¸ºç»éªŒé£é™©æŸå¤±å‡½æ•°å’Œç»“æ„é£é™©æŸå¤±å‡½æ•°ã€‚ç»éªŒé£é™©æŸå¤±å‡½æ•°æŒ‡é¢„æµ‹ç»“æœå’Œå®é™…ç»“æœçš„å·®åˆ«ï¼Œç»“æ„é£é™©æŸå¤±å‡½æ•°æ˜¯æŒ‡ç»éªŒé£é™©æŸå¤±å‡½æ•°åŠ ä¸Šæ­£åˆ™é¡¹ã€‚\nå¸¸è§çš„æŸå¤±å‡½æ•°ä»¥åŠå…¶ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š\n1. 0-1æŸå¤±å‡½æ•°(zero-one loss) 0-1æŸå¤±æ˜¯æŒ‡é¢„æµ‹å€¼å’Œç›®æ ‡å€¼ä¸ç›¸ç­‰ä¸º1ï¼Œ å¦åˆ™ä¸º0:\nç‰¹ç‚¹ï¼š\n(1) 0-1æŸå¤±å‡½æ•°ç›´æ¥å¯¹åº”åˆ†ç±»åˆ¤æ–­é”™è¯¯çš„ä¸ªæ•°ï¼Œä½†æ˜¯å®ƒæ˜¯ä¸€ä¸ªéå‡¸å‡½æ•°ï¼Œä¸å¤ªé€‚ç”¨.\n(2) æ„ŸçŸ¥æœºå°±æ˜¯ç”¨çš„è¿™ç§æŸå¤±å‡½æ•°ã€‚ä½†æ˜¯ç›¸ç­‰è¿™ä¸ªæ¡ä»¶å¤ªè¿‡ä¸¥æ ¼ï¼Œå› æ­¤å¯ä»¥æ”¾å®½æ¡ä»¶ï¼Œå³æ»¡è¶³ æ—¶è®¤ä¸ºç›¸ç­‰ï¼Œ\n2. ç»å¯¹å€¼æŸå¤±å‡½æ•° ç»å¯¹å€¼æŸå¤±å‡½æ•°æ˜¯è®¡ç®—é¢„æµ‹å€¼ä¸ç›®æ ‡å€¼çš„å·®çš„ç»å¯¹å€¼ï¼š\n3. logå¯¹æ•°æŸå¤±å‡½æ•° logå¯¹æ•°æŸå¤±å‡½æ•°çš„æ ‡å‡†å½¢å¼å¦‚ä¸‹ï¼š\nç‰¹ç‚¹ï¼š\n(1) logå¯¹æ•°æŸå¤±å‡½æ•°èƒ½éå¸¸å¥½çš„è¡¨å¾æ¦‚ç‡åˆ†å¸ƒï¼Œåœ¨å¾ˆå¤šåœºæ™¯å°¤å…¶æ˜¯å¤šåˆ†ç±»ï¼Œå¦‚æœéœ€è¦çŸ¥é“ç»“æœå±äºæ¯ä¸ªç±»åˆ«çš„ç½®ä¿¡åº¦ï¼Œé‚£å®ƒéå¸¸é€‚åˆã€‚\n(2) å¥å£®æ€§ä¸å¼ºï¼Œç›¸æ¯”äºhinge losså¯¹å™ªå£°æ›´æ•æ„Ÿã€‚\n(3) è¾‘å›å½’çš„æŸå¤±å‡½æ•°å°±æ˜¯logå¯¹æ•°æŸå¤±å‡½æ•°ã€‚\n4. å¹³æ–¹æŸå¤±å‡½æ•° å¹³æ–¹æŸå¤±å‡½æ•°æ ‡å‡†å½¢å¼å¦‚ä¸‹ï¼š\nç‰¹ç‚¹ï¼š\n(1)ç»å¸¸åº”ç”¨ä¸å›å½’é—®é¢˜\n5. æŒ‡æ•°æŸå¤±å‡½æ•°ï¼ˆexponential lossï¼‰ æŒ‡æ•°æŸå¤±å‡½æ•°çš„æ ‡å‡†å½¢å¼å¦‚ä¸‹ï¼š\nç‰¹ç‚¹ï¼š\n(1)å¯¹ç¦»ç¾¤ç‚¹ã€å™ªå£°éå¸¸æ•æ„Ÿã€‚ç»å¸¸ç”¨åœ¨AdaBoostç®—æ³•ä¸­ã€‚\n6. Hinge æŸå¤±å‡½æ•° HingeæŸå¤±å‡½æ•°æ ‡å‡†å½¢å¼å¦‚ä¸‹ï¼š\nç‰¹ç‚¹ï¼š\n(1) hingeæŸå¤±å‡½æ•°è¡¨ç¤ºå¦‚æœè¢«åˆ†ç±»æ­£ç¡®ï¼ŒæŸå¤±ä¸º0ï¼Œå¦åˆ™æŸå¤±å°±ä¸º ã€‚SVMå°±æ˜¯ä½¿ç”¨è¿™ä¸ªæŸå¤±å‡½æ•°ã€‚\n(2) ä¸€èˆ¬çš„ æ˜¯é¢„æµ‹å€¼ï¼Œåœ¨-1åˆ°1ä¹‹é—´ï¼Œ æ˜¯ç›®æ ‡å€¼(-1æˆ–1)ã€‚å…¶å«ä¹‰æ˜¯ï¼Œ çš„å€¼åœ¨-1å’Œ+1ä¹‹é—´å°±å¯ä»¥äº†ï¼Œå¹¶ä¸é¼“åŠ± ï¼Œå³å¹¶ä¸é¼“åŠ±åˆ†ç±»å™¨è¿‡åº¦è‡ªä¿¡ï¼Œè®©æŸä¸ªæ­£ç¡®åˆ†ç±»çš„æ ·æœ¬è·ç¦»åˆ†å‰²çº¿è¶…è¿‡1å¹¶ä¸ä¼šæœ‰ä»»ä½•å¥–åŠ±ï¼Œä»è€Œä½¿åˆ†ç±»å™¨å¯ä»¥æ›´ä¸“æ³¨äºæ•´ä½“çš„è¯¯å·®ã€‚\n(3) å¥å£®æ€§ç›¸å¯¹è¾ƒé«˜ï¼Œå¯¹å¼‚å¸¸ç‚¹ã€å™ªå£°ä¸æ•æ„Ÿï¼Œä½†å®ƒæ²¡å¤ªå¥½çš„æ¦‚ç‡è§£é‡Šã€‚\n7. æ„ŸçŸ¥æŸå¤±(perceptron loss)å‡½æ•° æ„ŸçŸ¥æŸå¤±å‡½æ•°çš„æ ‡å‡†å½¢å¼å¦‚ä¸‹ï¼š\nç‰¹ç‚¹ï¼š\n(1)æ˜¯HingeæŸå¤±å‡½æ•°çš„ä¸€ä¸ªå˜ç§ï¼ŒHinge losså¯¹åˆ¤å®šè¾¹ç•Œé™„è¿‘çš„ç‚¹(æ­£ç¡®ç«¯)æƒ©ç½šåŠ›åº¦å¾ˆé«˜ã€‚è€Œperceptron lossåªè¦æ ·æœ¬çš„åˆ¤å®šç±»åˆ«æ­£ç¡®çš„è¯ï¼Œå®ƒå°±æ»¡æ„ï¼Œä¸ç®¡å…¶åˆ¤å®šè¾¹ç•Œçš„è·ç¦»ã€‚å®ƒæ¯”Hinge lossç®€å•ï¼Œå› ä¸ºä¸æ˜¯max-margin boundaryï¼Œæ‰€ä»¥æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›æ²¡ hinge losså¼ºã€‚\n8. äº¤å‰ç†µæŸå¤±å‡½æ•° (Cross-entropy loss function) äº¤å‰ç†µæŸå¤±å‡½æ•°çš„æ ‡å‡†å½¢å¼å¦‚ä¸‹:\næ³¨æ„å…¬å¼ä¸­ è¡¨ç¤ºæ ·æœ¬ï¼Œ è¡¨ç¤ºå®é™…çš„æ ‡ç­¾ï¼Œ è¡¨ç¤ºé¢„æµ‹çš„è¾“å‡ºï¼Œ è¡¨ç¤ºæ ·æœ¬æ€»æ•°é‡ã€‚\nç‰¹ç‚¹ï¼š\n(1)æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§å¯¹æ•°ä¼¼ç„¶å‡½æ•°ï¼Œå¯ç”¨äºäºŒåˆ†ç±»å’Œå¤šåˆ†ç±»ä»»åŠ¡ä¸­ã€‚\näºŒåˆ†ç±»é—®é¢˜ä¸­çš„losså‡½æ•°ï¼ˆè¾“å…¥æ•°æ®æ˜¯softmaxæˆ–è€…sigmoidå‡½æ•°çš„è¾“å‡ºï¼‰ï¼š\nå¤šåˆ†ç±»é—®é¢˜ä¸­çš„losså‡½æ•°ï¼ˆè¾“å…¥æ•°æ®æ˜¯softmaxæˆ–è€…sigmoidå‡½æ•°çš„è¾“å‡ºï¼‰ï¼š\n(2)å½“ä½¿ç”¨sigmoidä½œä¸ºæ¿€æ´»å‡½æ•°çš„æ—¶å€™ï¼Œå¸¸ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°è€Œä¸ç”¨å‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°ï¼Œå› ä¸ºå®ƒå¯ä»¥å®Œç¾è§£å†³å¹³æ–¹æŸå¤±å‡½æ•°æƒé‡æ›´æ–°è¿‡æ…¢çš„é—®é¢˜ï¼Œå…·æœ‰â€œè¯¯å·®å¤§çš„æ—¶å€™ï¼Œæƒé‡æ›´æ–°å¿«ï¼›è¯¯å·®å°çš„æ—¶å€™ï¼Œæƒé‡æ›´æ–°æ…¢â€çš„è‰¯å¥½æ€§è´¨ã€‚\næœ€åå¥‰çŒ®ä¸Šäº¤å‰ç†µæŸå¤±å‡½æ•°çš„å®ç°ä»£ç ï¼šcross_entropy.\nè¿™é‡Œéœ€è¦æ›´æ­£ä¸€ç‚¹ï¼Œå¯¹æ•°æŸå¤±å‡½æ•°å’Œäº¤å‰ç†µæŸå¤±å‡½æ•°åº”è¯¥æ˜¯ç­‰ä»·çš„ï¼ï¼ï¼ï¼ˆæ­¤å¤„æ„Ÿè°¢\n@Areshyy\nçš„æŒ‡æ­£ï¼Œä¸‹é¢è¯´æ˜ä¹Ÿæ˜¯ç”±ä»–æä¾›ï¼‰\nä¸‹é¢æ¥å…·ä½“è¯´æ˜ï¼š\nç›¸å…³é«˜é¢‘é—®é¢˜ï¼š 1.äº¤å‰ç†µå‡½æ•°ä¸æœ€å¤§ä¼¼ç„¶å‡½æ•°çš„è”ç³»å’ŒåŒºåˆ«ï¼Ÿ åŒºåˆ«ï¼šäº¤å‰ç†µå‡½æ•°ä½¿ç”¨æ¥æè¿°æ¨¡å‹é¢„æµ‹å€¼å’ŒçœŸå®å€¼çš„å·®è·å¤§å°ï¼Œè¶Šå¤§ä»£è¡¨è¶Šä¸ç›¸è¿‘ï¼›ä¼¼ç„¶å‡½æ•°çš„æœ¬è´¨å°±æ˜¯è¡¡é‡åœ¨æŸä¸ªå‚æ•°ä¸‹ï¼Œæ•´ä½“çš„ä¼°è®¡å’ŒçœŸå®çš„æƒ…å†µä¸€æ ·çš„æ¦‚ç‡ï¼Œè¶Šå¤§ä»£è¡¨è¶Šç›¸è¿‘ã€‚\nè”ç³»ï¼šäº¤å‰ç†µå‡½æ•°å¯ä»¥ç”±æœ€å¤§ä¼¼ç„¶å‡½æ•°åœ¨ä¼¯åŠªåˆ©åˆ†å¸ƒçš„æ¡ä»¶ä¸‹æ¨å¯¼å‡ºæ¥ï¼Œæˆ–è€…è¯´æœ€å°åŒ–äº¤å‰ç†µå‡½æ•°çš„æœ¬è´¨å°±æ˜¯å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„æœ€å¤§åŒ–ã€‚\næ€ä¹ˆæ¨å¯¼çš„å‘¢ï¼Ÿæˆ‘ä»¬å…·ä½“æ¥çœ‹ä¸€ä¸‹ã€‚\nè®¾ä¸€ä¸ªéšæœºå˜é‡ æ»¡è¶³ä¼¯åŠªåˆ©åˆ†å¸ƒï¼Œ\nåˆ™ çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ä¸ºï¼š\nå› ä¸ºæˆ‘ä»¬åªæœ‰ä¸€ç»„é‡‡æ ·æ•°æ® ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿè®¡å¾—åˆ° å’Œ çš„å€¼ï¼Œä½†æ˜¯ çš„æ¦‚ç‡æ˜¯æœªçŸ¥çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡çš„æ–¹æ³•æ¥ä¼°è®¡è¿™ä¸ª å€¼ã€‚\nå¯¹äºé‡‡æ ·æ•°æ® ï¼Œå…¶å¯¹æ•°ä¼¼ç„¶å‡½æ•°ä¸º:\nå¯ä»¥çœ‹åˆ°ä¸Šå¼å’Œäº¤å‰ç†µå‡½æ•°çš„å½¢å¼å‡ ä¹ç›¸åŒï¼Œæå¤§ä¼¼ç„¶ä¼°è®¡å°±æ˜¯è¦æ±‚è¿™ä¸ªå¼å­çš„æœ€å¤§å€¼ã€‚è€Œç”±äºä¸Šé¢å‡½æ•°çš„å€¼æ€»æ˜¯å°äº0ï¼Œä¸€èˆ¬åƒç¥ç»ç½‘ç»œç­‰å¯¹äºæŸå¤±å‡½æ•°ä¼šç”¨æœ€å°åŒ–çš„æ–¹æ³•è¿›è¡Œä¼˜åŒ–ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šåœ¨å‰é¢åŠ ä¸€ä¸ªè´Ÿå·ï¼Œå¾—åˆ°äº¤å‰ç†µå‡½æ•°ï¼ˆæˆ–äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼‰ï¼š\nè¿™ä¸ªå¼å­æ­ç¤ºäº†äº¤å‰ç†µå‡½æ•°ä¸æå¤§ä¼¼ç„¶ä¼°è®¡çš„è”ç³»ï¼Œæœ€å°åŒ–äº¤å‰ç†µå‡½æ•°çš„æœ¬è´¨å°±æ˜¯å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„æœ€å¤§åŒ–ã€‚\nç°åœ¨æˆ‘ä»¬å¯ä»¥ç”¨æ±‚å¯¼å¾—åˆ°æå¤§å€¼ç‚¹çš„æ–¹æ³•æ¥æ±‚å…¶æå¤§ä¼¼ç„¶ä¼°è®¡ï¼Œé¦–å…ˆå°†å¯¹æ•°ä¼¼ç„¶å‡½æ•°å¯¹ è¿›è¡Œæ±‚å¯¼ï¼Œå¹¶ä»¤å¯¼æ•°ä¸º0ï¼Œå¾—åˆ°\næ¶ˆå»åˆ†æ¯ï¼Œå¾—ï¼š\næ‰€ä»¥:\nè¿™å°±æ˜¯ä¼¯åŠªåˆ©åˆ†å¸ƒä¸‹æœ€å¤§ä¼¼ç„¶ä¼°è®¡æ±‚å‡ºçš„æ¦‚ç‡ ã€‚\n2. åœ¨ç”¨sigmoidä½œä¸ºæ¿€æ´»å‡½æ•°çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆè¦ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼Œè€Œä¸ç”¨å‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°ï¼Ÿ å…¶å®è¿™ä¸ªé—®é¢˜æ±‚ä¸ªå¯¼ï¼Œåˆ†æä¸€ä¸‹ä¸¤ä¸ªè¯¯å·®å‡½æ•°çš„å‚æ•°æ›´æ–°è¿‡ç¨‹å°±ä¼šå‘ç°åŸå› äº†ã€‚\nå¯¹äºå‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°ï¼Œå¸¸å¸¸å®šä¹‰ä¸ºï¼š\nå…¶ä¸­ æ˜¯æˆ‘ä»¬æœŸæœ›çš„è¾“å‡ºï¼Œ ä¸ºç¥ç»å…ƒçš„å®é™…è¾“å‡ºï¼ˆ ï¼‰ã€‚åœ¨è®­ç»ƒç¥ç»ç½‘ç»œçš„æ—¶å€™æˆ‘ä»¬ä½¿ç”¨æ¢¯åº¦ä¸‹é™çš„æ–¹æ³•æ¥æ›´æ–° å’Œ ï¼Œå› æ­¤éœ€è¦è®¡ç®—ä»£ä»·å‡½æ•°å¯¹ å’Œ çš„å¯¼æ•°ï¼š\nç„¶åæ›´æ–°å‚æ•° å’Œ ï¼š\nå› ä¸ºsigmoidçš„æ€§è´¨ï¼Œå¯¼è‡´ åœ¨ å–å¤§éƒ¨åˆ†å€¼æ—¶ä¼šå¾ˆå°ï¼ˆå¦‚ä¸‹å›¾æ ‡å‡ºæ¥çš„ä¸¤ç«¯ï¼Œå‡ ä¹æ¥è¿‘äºå¹³å¦ï¼‰ï¼Œè¿™æ ·ä¼šä½¿å¾— å¾ˆå°ï¼Œå¯¼è‡´å‚æ•° å’Œ æ›´æ–°éå¸¸æ…¢ã€‚\né‚£ä¹ˆä¸ºä»€ä¹ˆäº¤å‰ç†µæŸå¤±å‡½æ•°å°±ä¼šæ¯”è¾ƒå¥½äº†å‘¢ï¼ŸåŒæ ·çš„å¯¹äºäº¤å‰ç†µæŸå¤±å‡½æ•°ï¼Œè®¡ç®—ä¸€ä¸‹å‚æ•°æ›´æ–°çš„æ¢¯åº¦å…¬å¼å°±ä¼šå‘ç°åŸå› ã€‚äº¤å‰ç†µæŸå¤±å‡½æ•°ä¸€èˆ¬å®šä¹‰ä¸ºï¼š\nå…¶ä¸­ æ˜¯æˆ‘ä»¬æœŸæœ›çš„è¾“å‡ºï¼Œ ä¸ºç¥ç»å…ƒçš„å®é™…è¾“å‡ºï¼ˆ ï¼‰ã€‚åŒæ ·å¯ä»¥çœ‹çœ‹å®ƒçš„å¯¼æ•°ï¼š\nå¦å¤–ï¼Œ\næ‰€ä»¥æœ‰ï¼š\næ‰€ä»¥å‚æ•°æ›´æ–°å…¬å¼ä¸ºï¼š\nå¯ä»¥çœ‹åˆ°å‚æ•°æ›´æ–°å…¬å¼ä¸­æ²¡æœ‰ è¿™ä¸€é¡¹ï¼Œæƒé‡çš„æ›´æ–°å— å½±å“ï¼Œå—åˆ°è¯¯å·®çš„å½±å“ï¼Œæ‰€ä»¥å½“è¯¯å·®å¤§çš„æ—¶å€™ï¼Œæƒé‡æ›´æ–°å¿«ï¼›å½“è¯¯å·®å°çš„æ—¶å€™ï¼Œæƒé‡æ›´æ–°æ…¢ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ€§è´¨ã€‚\næ‰€ä»¥å½“ä½¿ç”¨sigmoidä½œä¸ºæ¿€æ´»å‡½æ•°çš„æ—¶å€™ï¼Œå¸¸ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°è€Œä¸ç”¨å‡æ–¹è¯¯å·®æŸå¤±å‡½æ•°ã€‚\n","permalink":"https://reid00.github.io/en/posts/ml/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%B8%B8%E8%A7%81%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/","summary":"ç®€ä»‹ æŸå¤±å‡½æ•°ç”¨æ¥è¯„ä»·æ¨¡å‹çš„é¢„æµ‹å€¼å’ŒçœŸå®å€¼ä¸ä¸€æ ·çš„ç¨‹åº¦ï¼ŒæŸå¤±å‡½æ•°è¶Šå¥½ï¼Œé€šå¸¸æ¨¡å‹çš„æ€§èƒ½è¶Šå¥½ã€‚ä¸åŒçš„æ¨¡å‹ç”¨çš„æŸå¤±å‡½æ•°ä¸€èˆ¬ä¹Ÿä¸ä¸€æ ·ã€‚\næŸå¤±å‡½æ•°åˆ†ä¸ºç»éªŒé£é™©æŸå¤±å‡½æ•°å’Œç»“æ„é£é™©æŸå¤±å‡½æ•°ã€‚ç»éªŒé£é™©æŸå¤±å‡½æ•°æŒ‡é¢„æµ‹ç»“æœå’Œå®é™…ç»“æœçš„å·®åˆ«ï¼Œç»“æ„é£é™©æŸå¤±å‡½æ•°æ˜¯æŒ‡ç»éªŒé£é™©æŸå¤±å‡½æ•°åŠ ä¸Šæ­£åˆ™é¡¹ã€‚\nå¸¸è§çš„æŸå¤±å‡½æ•°ä»¥åŠå…¶ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š\n1. 0-1æŸå¤±å‡½æ•°(zero-one loss) 0-1æŸå¤±æ˜¯æŒ‡é¢„æµ‹å€¼å’Œç›®æ ‡å€¼ä¸ç›¸ç­‰ä¸º1ï¼Œ å¦åˆ™ä¸º0:\nç‰¹ç‚¹ï¼š\n(1) 0-1æŸå¤±å‡½æ•°ç›´æ¥å¯¹åº”åˆ†ç±»åˆ¤æ–­é”™è¯¯çš„ä¸ªæ•°ï¼Œä½†æ˜¯å®ƒæ˜¯ä¸€ä¸ªéå‡¸å‡½æ•°ï¼Œä¸å¤ªé€‚ç”¨.\n(2) æ„ŸçŸ¥æœºå°±æ˜¯ç”¨çš„è¿™ç§æŸå¤±å‡½æ•°ã€‚ä½†æ˜¯ç›¸ç­‰è¿™ä¸ªæ¡ä»¶å¤ªè¿‡ä¸¥æ ¼ï¼Œå› æ­¤å¯ä»¥æ”¾å®½æ¡ä»¶ï¼Œå³æ»¡è¶³ æ—¶è®¤ä¸ºç›¸ç­‰ï¼Œ\n2. ç»å¯¹å€¼æŸå¤±å‡½æ•° ç»å¯¹å€¼æŸå¤±å‡½æ•°æ˜¯è®¡ç®—é¢„æµ‹å€¼ä¸ç›®æ ‡å€¼çš„å·®çš„ç»å¯¹å€¼ï¼š\n3. logå¯¹æ•°æŸå¤±å‡½æ•° logå¯¹æ•°æŸå¤±å‡½æ•°çš„æ ‡å‡†å½¢å¼å¦‚ä¸‹ï¼š\nç‰¹ç‚¹ï¼š\n(1) logå¯¹æ•°æŸå¤±å‡½æ•°èƒ½éå¸¸å¥½çš„è¡¨å¾æ¦‚ç‡åˆ†å¸ƒï¼Œåœ¨å¾ˆå¤šåœºæ™¯å°¤å…¶æ˜¯å¤šåˆ†ç±»ï¼Œå¦‚æœéœ€è¦çŸ¥é“ç»“æœå±äºæ¯ä¸ªç±»åˆ«çš„ç½®ä¿¡åº¦ï¼Œé‚£å®ƒéå¸¸é€‚åˆã€‚\n(2) å¥å£®æ€§ä¸å¼ºï¼Œç›¸æ¯”äºhinge losså¯¹å™ªå£°æ›´æ•æ„Ÿã€‚\n(3) è¾‘å›å½’çš„æŸå¤±å‡½æ•°å°±æ˜¯logå¯¹æ•°æŸå¤±å‡½æ•°ã€‚\n4. å¹³æ–¹æŸå¤±å‡½æ•° å¹³æ–¹æŸå¤±å‡½æ•°æ ‡å‡†å½¢å¼å¦‚ä¸‹ï¼š\nç‰¹ç‚¹ï¼š\n(1)ç»å¸¸åº”ç”¨ä¸å›å½’é—®é¢˜\n5. æŒ‡æ•°æŸå¤±å‡½æ•°ï¼ˆexponential lossï¼‰ æŒ‡æ•°æŸå¤±å‡½æ•°çš„æ ‡å‡†å½¢å¼å¦‚ä¸‹ï¼š\nç‰¹ç‚¹ï¼š\n(1)å¯¹ç¦»ç¾¤ç‚¹ã€å™ªå£°éå¸¸æ•æ„Ÿã€‚ç»å¸¸ç”¨åœ¨AdaBoostç®—æ³•ä¸­ã€‚\n6. Hinge æŸå¤±å‡½æ•° HingeæŸå¤±å‡½æ•°æ ‡å‡†å½¢å¼å¦‚ä¸‹ï¼š\nç‰¹ç‚¹ï¼š\n(1) hingeæŸå¤±å‡½æ•°è¡¨ç¤ºå¦‚æœè¢«åˆ†ç±»æ­£ç¡®ï¼ŒæŸå¤±ä¸º0ï¼Œå¦åˆ™æŸå¤±å°±ä¸º ã€‚SVMå°±æ˜¯ä½¿ç”¨è¿™ä¸ªæŸå¤±å‡½æ•°ã€‚\n(2) ä¸€èˆ¬çš„ æ˜¯é¢„æµ‹å€¼ï¼Œåœ¨-1åˆ°1ä¹‹é—´ï¼Œ æ˜¯ç›®æ ‡å€¼(-1æˆ–1)ã€‚å…¶å«ä¹‰æ˜¯ï¼Œ çš„å€¼åœ¨-1å’Œ+1ä¹‹é—´å°±å¯ä»¥äº†ï¼Œå¹¶ä¸é¼“åŠ± ï¼Œå³å¹¶ä¸é¼“åŠ±åˆ†ç±»å™¨è¿‡åº¦è‡ªä¿¡ï¼Œè®©æŸä¸ªæ­£ç¡®åˆ†ç±»çš„æ ·æœ¬è·ç¦»åˆ†å‰²çº¿è¶…è¿‡1å¹¶ä¸ä¼šæœ‰ä»»ä½•å¥–åŠ±ï¼Œä»è€Œä½¿åˆ†ç±»å™¨å¯ä»¥æ›´ä¸“æ³¨äºæ•´ä½“çš„è¯¯å·®ã€‚\n(3) å¥å£®æ€§ç›¸å¯¹è¾ƒé«˜ï¼Œå¯¹å¼‚å¸¸ç‚¹ã€å™ªå£°ä¸æ•æ„Ÿï¼Œä½†å®ƒæ²¡å¤ªå¥½çš„æ¦‚ç‡è§£é‡Šã€‚\n7. æ„ŸçŸ¥æŸå¤±(perceptron loss)å‡½æ•° æ„ŸçŸ¥æŸå¤±å‡½æ•°çš„æ ‡å‡†å½¢å¼å¦‚ä¸‹ï¼š\nç‰¹ç‚¹ï¼š\n(1)æ˜¯HingeæŸå¤±å‡½æ•°çš„ä¸€ä¸ªå˜ç§ï¼ŒHinge losså¯¹åˆ¤å®šè¾¹ç•Œé™„è¿‘çš„ç‚¹(æ­£ç¡®ç«¯)æƒ©ç½šåŠ›åº¦å¾ˆé«˜ã€‚è€Œperceptron lossåªè¦æ ·æœ¬çš„åˆ¤å®šç±»åˆ«æ­£ç¡®çš„è¯ï¼Œå®ƒå°±æ»¡æ„ï¼Œä¸ç®¡å…¶åˆ¤å®šè¾¹ç•Œçš„è·ç¦»ã€‚å®ƒæ¯”Hinge lossç®€å•ï¼Œå› ä¸ºä¸æ˜¯max-margin boundaryï¼Œæ‰€ä»¥æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›æ²¡ hinge losså¼ºã€‚\n8. äº¤å‰ç†µæŸå¤±å‡½æ•° (Cross-entropy loss function) äº¤å‰ç†µæŸå¤±å‡½æ•°çš„æ ‡å‡†å½¢å¼å¦‚ä¸‹:","title":"æœºå™¨å­¦ä¹ ä¹‹å¸¸è§æŸå¤±å‡½æ•°"},{"content":"1. æ— ç›‘ç£å’Œæœ‰ç›‘ç£çš„åŒºåˆ«ï¼Ÿ æœ‰ç›‘ç£å­¦ä¹ ï¼šå¯¹å…·æœ‰æ¦‚å¿µæ ‡è®°ï¼ˆåˆ†ç±»ï¼‰çš„è®­ç»ƒæ ·æœ¬è¿›è¡Œå­¦ä¹ ï¼Œä»¥å°½å¯èƒ½å¯¹è®­ç»ƒæ ·æœ¬é›†å¤–çš„æ•°æ®è¿›è¡Œæ ‡è®°ï¼ˆåˆ†ç±»ï¼‰é¢„æµ‹ã€‚è¿™é‡Œï¼Œæ‰€æœ‰çš„æ ‡è®°ï¼ˆåˆ†ç±»ï¼‰æ˜¯å·²çŸ¥çš„ã€‚å› æ­¤ï¼Œè®­ç»ƒæ ·æœ¬çš„å²ä¹‰æ€§ä½ã€‚\næ— ç›‘ç£å­¦ä¹ ï¼šå¯¹æ²¡æœ‰æ¦‚å¿µæ ‡è®°ï¼ˆåˆ†ç±»ï¼‰çš„è®­ç»ƒæ ·æœ¬è¿›è¡Œå­¦ä¹ ï¼Œä»¥å‘ç°è®­ç»ƒæ ·æœ¬é›†ä¸­çš„ç»“æ„æ€§çŸ¥è¯†ã€‚è¿™é‡Œï¼Œæ‰€æœ‰çš„æ ‡è®°ï¼ˆåˆ†ç±»ï¼‰æ˜¯æœªçŸ¥çš„ã€‚å› æ­¤ï¼Œè®­ç»ƒæ ·æœ¬çš„å²ä¹‰æ€§é«˜ã€‚èšç±»å°±æ˜¯å…¸å‹çš„æ— ç›‘ç£å­¦ä¹ ã€‚\n2. SVM çš„æ¨å¯¼ï¼Œç‰¹æ€§ï¼Ÿå¤šåˆ†ç±»æ€ä¹ˆå¤„ç†ï¼Ÿ SVMæ˜¯æœ€å¤§é—´éš”åˆ†ç±»å™¨ï¼Œå‡ ä½•é—´éš”å’Œæ ·æœ¬çš„è¯¯åˆ†æ¬¡æ•°ä¹‹é—´å­˜åœ¨å…³ç³»ï¼Œ ï¼Œå…¶ä¸­ ä»çº¿æ€§å¯åˆ†æƒ…å†µä¸‹ï¼ŒåŸé—®é¢˜ï¼Œç‰¹å¾è½¬æ¢åçš„dualé—®é¢˜ï¼Œå¼•å…¥kernel(çº¿æ€§kernelï¼Œå¤šé¡¹å¼ï¼Œé«˜æ–¯)ï¼Œæœ€åæ˜¯soft marginã€‚\nçº¿æ€§ï¼šç®€å•ï¼Œé€Ÿåº¦å¿«ï¼Œä½†æ˜¯éœ€è¦çº¿æ€§å¯åˆ†ã€‚\nå¤šé¡¹å¼ï¼šæ¯”çº¿æ€§æ ¸æ‹Ÿåˆç¨‹åº¦æ›´å¼ºï¼ŒçŸ¥é“å…·ä½“çš„ç»´åº¦ï¼Œä½†æ˜¯é«˜æ¬¡å®¹æ˜“å‡ºç°æ•°å€¼ä¸ç¨³å®šï¼Œå‚æ•°é€‰æ‹©æ¯”è¾ƒå¤šã€‚\né«˜æ–¯ï¼šæ‹Ÿåˆèƒ½åŠ›æœ€å¼ºï¼Œä½†æ˜¯è¦æ³¨æ„è¿‡æ‹Ÿåˆé—®é¢˜ã€‚ä¸è¿‡åªæœ‰ä¸€ä¸ªå‚æ•°éœ€è¦è°ƒæ•´ã€‚\nå¤šåˆ†ç±»é—®é¢˜ï¼Œä¸€èˆ¬å°†äºŒåˆ†ç±»æ¨å¹¿åˆ°å¤šåˆ†ç±»çš„æ–¹å¼æœ‰ä¸‰ç§ï¼Œä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šã€‚\nä¸€å¯¹ä¸€ï¼šå°†Nä¸ªç±»åˆ«ä¸¤ä¸¤é…å¯¹ï¼Œäº§ç”ŸN(N-1)/2ä¸ªäºŒåˆ†ç±»ä»»åŠ¡ï¼Œæµ‹è¯•é˜¶æ®µæ–°æ ·æœ¬åŒæ—¶äº¤ç»™æ‰€æœ‰çš„åˆ†ç±»å™¨ï¼Œæœ€ç»ˆç»“æœé€šè¿‡æŠ•ç¥¨äº§ç”Ÿã€‚\nä¸€å¯¹å¤šï¼šæ¯ä¸€æ¬¡å°†ä¸€ä¸ªä¾‹ä½œä¸ºæ­£ä¾‹ï¼Œå…¶ä»–çš„ä½œä¸ºåä¾‹ï¼Œè®­ç»ƒNä¸ªåˆ†ç±»å™¨ï¼Œæµ‹è¯•æ—¶å¦‚æœåªæœ‰ä¸€ä¸ªåˆ†ç±»å™¨é¢„æµ‹ä¸ºæ­£ç±»ï¼Œåˆ™å¯¹åº”ç±»åˆ«ä¸ºæœ€ç»ˆç»“æœï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œåˆ™ä¸€èˆ¬é€‰æ‹©ç½®ä¿¡åº¦æœ€å¤§çš„ã€‚ä»åˆ†ç±»å™¨è§’åº¦ä¸€å¯¹ä¸€æ›´å¤šï¼Œä½†æ˜¯æ¯ä¸€æ¬¡éƒ½åªç”¨äº†2ä¸ªç±»åˆ«ï¼Œå› æ­¤å½“ç±»åˆ«æ•°å¾ˆå¤šçš„æ—¶å€™ä¸€å¯¹ä¸€å¼€é”€é€šå¸¸æ›´å°(åªè¦è®­ç»ƒå¤æ‚åº¦é«˜äºO(N)å³å¯å¾—åˆ°æ­¤ç»“æœ)ã€‚\nå¤šå¯¹å¤šï¼šè‹¥å¹²å„ç±»ä½œä¸ºæ­£ç±»ï¼Œè‹¥å¹²ä¸ªç±»ä½œä¸ºåç±»ã€‚æ³¨æ„æ­£åç±»å¿…é¡»ç‰¹æ®Šçš„è®¾è®¡ã€‚\n3. LR çš„æ¨å¯¼ï¼Œç‰¹æ€§ï¼Ÿ LRçš„ä¼˜ç‚¹åœ¨äºå®ç°ç®€å•ï¼Œå¹¶ä¸”è®¡ç®—é‡éå¸¸å°ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œå­˜å‚¨èµ„æºä½ï¼Œç¼ºç‚¹å°±æ˜¯å› ä¸ºæ¨¡å‹ç®€å•ï¼Œå¯¹äºå¤æ‚çš„æƒ…å†µä¸‹ä¼šå‡ºç°æ¬ æ‹Ÿåˆï¼Œå¹¶ä¸”åªèƒ½å¤„ç†2åˆ†ç±»é—®é¢˜(å¯ä»¥é€šè¿‡ä¸€èˆ¬çš„äºŒå…ƒè½¬æ¢ä¸ºå¤šå…ƒæˆ–è€…ç”¨softmaxå›å½’)ã€‚\n4. å†³ç­–æ ‘çš„ç‰¹æ€§ï¼Ÿ å†³ç­–æ ‘åŸºäºæ ‘ç»“æ„è¿›è¡Œå†³ç­–ï¼Œä¸äººç±»åœ¨é¢ä¸´é—®é¢˜çš„æ—¶å€™å¤„ç†æœºåˆ¶ååˆ†ç±»ä¼¼ã€‚å…¶ç‰¹ç‚¹åœ¨äºéœ€è¦é€‰æ‹©ä¸€ä¸ªå±æ€§è¿›è¡Œåˆ†æ”¯ï¼Œåœ¨åˆ†æ”¯çš„è¿‡ç¨‹ä¸­é€‰æ‹©ä¿¡æ¯å¢ç›Šæœ€å¤§çš„å±æ€§ï¼Œå®šä¹‰å¦‚ä¸‹ã€€åœ¨åˆ’åˆ†ä¸­æˆ‘ä»¬å¸Œæœ›å†³ç­–æ ‘çš„åˆ†æ”¯èŠ‚ç‚¹æ‰€åŒ…å«çš„æ ·æœ¬å±äºåŒä¸€ç±»åˆ«ï¼Œå³èŠ‚ç‚¹çš„çº¯åº¦è¶Šæ¥è¶Šé«˜ã€‚å†³ç­–æ ‘è®¡ç®—é‡ç®€å•ï¼Œå¯è§£é‡Šæ€§å¼ºï¼Œæ¯”è¾ƒé€‚åˆå¤„ç†æœ‰ç¼ºå¤±å±æ€§å€¼çš„æ ·æœ¬ï¼Œèƒ½å¤Ÿå¤„ç†ä¸ç›¸å…³çš„ç‰¹å¾ï¼Œä½†æ˜¯å®¹æ˜“è¿‡æ‹Ÿåˆï¼Œéœ€è¦ä½¿ç”¨å‰ªææˆ–è€…éšæœºæ£®æ—ã€‚ä¿¡æ¯å¢ç›Šæ˜¯ç†µå‡å»æ¡ä»¶ç†µï¼Œä»£è¡¨ä¿¡æ¯ä¸ç¡®å®šæ€§è¾ƒå°‘çš„ç¨‹åº¦ï¼Œä¿¡æ¯å¢ç›Šè¶Šå¤§ï¼Œè¯´æ˜ä¸ç¡®å®šæ€§é™ä½çš„è¶Šå¤§ï¼Œå› æ­¤è¯´æ˜è¯¥ç‰¹å¾å¯¹åˆ†ç±»æ¥è¯´å¾ˆé‡è¦ã€‚ç”±äºä¿¡æ¯å¢ç›Šå‡†åˆ™ä¼šå¯¹æ•°ç›®è¾ƒå¤šçš„å±æ€§æœ‰æ‰€åå¥½ï¼Œå› æ­¤ä¸€èˆ¬ç”¨ä¿¡æ¯å¢ç›Šç‡(c4.5)\nå…¶ä¸­åˆ†æ¯å¯ä»¥çœ‹ä½œä¸ºå±æ€§è‡ªèº«çš„ç†µã€‚å–å€¼å¯èƒ½æ€§è¶Šå¤šï¼Œå±æ€§çš„ç†µè¶Šå¤§ã€‚\nCartå†³ç­–æ ‘ä½¿ç”¨åŸºå°¼æŒ‡æ•°æ¥é€‰æ‹©åˆ’åˆ†å±æ€§ï¼Œç›´è§‚çš„æ¥è¯´ï¼ŒGini(D)åæ˜ äº†ä»æ•°æ®é›†Dä¸­éšæœºæŠ½å–ä¸¤ä¸ªæ ·æœ¬ï¼Œå…¶ç±»åˆ«æ ‡è®°ä¸ä¸€è‡´çš„æ¦‚ç‡ï¼Œå› æ­¤åŸºå°¼æŒ‡æ•°è¶Šå°æ•°æ®é›†Dçš„çº¯åº¦è¶Šé«˜ï¼Œä¸€èˆ¬ä¸ºäº†é˜²æ­¢è¿‡æ‹Ÿåˆè¦è¿›è¡Œå‰ªæï¼Œæœ‰é¢„å‰ªæå’Œåå‰ªæï¼Œä¸€èˆ¬ç”¨cross validationé›†è¿›è¡Œå‰ªæã€‚\nè¿ç»­å€¼å’Œç¼ºå¤±å€¼çš„å¤„ç†ï¼Œå¯¹äºè¿ç»­å±æ€§aï¼Œå°†aåœ¨Dä¸Šå‡ºç°çš„ä¸åŒçš„å–å€¼è¿›è¡Œæ’åºï¼ŒåŸºäºåˆ’åˆ†ç‚¹tå°†Dåˆ†ä¸ºä¸¤ä¸ªå­é›†ã€‚ä¸€èˆ¬å¯¹æ¯ä¸€ä¸ªè¿ç»­çš„ä¸¤ä¸ªå–å€¼çš„ä¸­ç‚¹ä½œä¸ºåˆ’åˆ†ç‚¹ï¼Œç„¶åæ ¹æ®ä¿¡æ¯å¢ç›Šé€‰æ‹©æœ€å¤§çš„ã€‚ä¸ç¦»æ•£å±æ€§ä¸åŒï¼Œè‹¥å½“å‰èŠ‚ç‚¹åˆ’åˆ†å±æ€§ä¸ºè¿ç»­å±æ€§ï¼Œè¯¥å±æ€§è¿˜å¯ä»¥ä½œä¸ºå…¶åä»£çš„åˆ’åˆ†å±æ€§ã€‚\n5. SVM,LR,å†³ç­–æ ‘å¯¹æ¯”ï¼Ÿ SVMæ—¢å¯ä»¥ç”¨äºåˆ†ç±»é—®é¢˜ï¼Œä¹Ÿå¯ä»¥ç”¨äºå›å½’é—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æ ¸å‡½æ•°å¿«é€Ÿçš„è®¡ç®—ï¼ŒLRå®ç°ç®€å•ï¼Œè®­ç»ƒé€Ÿåº¦éå¸¸å¿«ï¼Œä½†æ˜¯æ¨¡å‹è¾ƒä¸ºç®€å•ï¼Œå†³ç­–æ ‘å®¹æ˜“è¿‡æ‹Ÿåˆï¼Œéœ€è¦è¿›è¡Œå‰ªæç­‰ã€‚ä»ä¼˜åŒ–å‡½æ•°ä¸Šçœ‹ï¼Œsoft marginçš„SVMç”¨çš„æ˜¯hinge lossï¼Œè€Œå¸¦L2æ­£åˆ™åŒ–çš„LRå¯¹åº”çš„æ˜¯cross entropy lossï¼Œå¦å¤–adaboostå¯¹åº”çš„æ˜¯exponential lossã€‚æ‰€ä»¥LRå¯¹è¿œç‚¹æ•æ„Ÿï¼Œä½†æ˜¯SVMå¯¹outlierä¸å¤ªæ•æ„Ÿï¼Œå› ä¸ºåªå…³å¿ƒsupport vectorï¼ŒSVMå¯ä»¥å°†ç‰¹å¾æ˜ å°„åˆ°æ— ç©·ç»´ç©ºé—´ï¼Œä½†æ˜¯LRä¸å¯ä»¥ï¼Œä¸€èˆ¬å°æ•°æ®ä¸­SVMæ¯”LRæ›´ä¼˜ä¸€ç‚¹ï¼Œä½†æ˜¯LRå¯ä»¥é¢„æµ‹æ¦‚ç‡ï¼Œè€ŒSVMä¸å¯ä»¥ï¼ŒSVMä¾èµ–äºæ•°æ®æµ‹åº¦ï¼Œéœ€è¦å…ˆåšå½’ä¸€åŒ–ï¼ŒLRä¸€èˆ¬ä¸éœ€è¦ï¼Œå¯¹äºå¤§é‡çš„æ•°æ®LRä½¿ç”¨æ›´åŠ å¹¿æ³›ï¼ŒLRå‘å¤šåˆ†ç±»çš„æ‰©å±•æ›´åŠ ç›´æ¥ï¼Œå¯¹äºç±»åˆ«ä¸å¹³è¡¡SVMä¸€èˆ¬ç”¨æƒé‡è§£å†³ï¼Œå³ç›®æ ‡å‡½æ•°ä¸­å¯¹æ­£è´Ÿæ ·æœ¬ä»£ä»·å‡½æ•°ä¸åŒï¼ŒLRå¯ä»¥ç”¨ä¸€èˆ¬çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¯¹æœ€åç»“æœè°ƒæ•´(é€šè¿‡é˜ˆå€¼)ï¼Œä¸€èˆ¬å°æ•°æ®ä¸‹æ ·æœ¬ç»´åº¦æ¯”è¾ƒé«˜çš„æ—¶å€™SVMæ•ˆæœè¦æ›´ä¼˜ä¸€äº›ã€‚\n6. GBDT å’Œéšæœºæ£®æ—çš„åŒºåˆ«ï¼Ÿ éšæœºæ£®æ—é‡‡ç”¨çš„æ˜¯baggingçš„æ€æƒ³ï¼Œbaggingåˆç§°ä¸ºbootstrap aggreagationï¼Œé€šè¿‡åœ¨è®­ç»ƒæ ·æœ¬é›†ä¸­è¿›è¡Œæœ‰æ”¾å›çš„é‡‡æ ·å¾—åˆ°å¤šä¸ªé‡‡æ ·é›†ï¼ŒåŸºäºæ¯ä¸ªé‡‡æ ·é›†è®­ç»ƒå‡ºä¸€ä¸ªåŸºå­¦ä¹ å™¨ï¼Œå†å°†åŸºå­¦ä¹ å™¨ç»“åˆã€‚éšæœºæ£®æ—åœ¨å¯¹å†³ç­–æ ‘è¿›è¡Œbaggingçš„åŸºç¡€ä¸Šï¼Œåœ¨å†³ç­–æ ‘çš„è®­ç»ƒè¿‡ç¨‹ä¸­å¼•å…¥äº†éšæœºå±æ€§é€‰æ‹©ã€‚ä¼ ç»Ÿå†³ç­–æ ‘åœ¨é€‰æ‹©åˆ’åˆ†å±æ€§çš„æ—¶å€™æ˜¯åœ¨å½“å‰èŠ‚ç‚¹å±æ€§é›†åˆä¸­é€‰æ‹©æœ€ä¼˜å±æ€§ï¼Œè€Œéšæœºæ£®æ—åˆ™æ˜¯å¯¹ç»“ç‚¹å…ˆéšæœºé€‰æ‹©åŒ…å«kä¸ªå±æ€§çš„å­é›†ï¼Œå†é€‰æ‹©æœ€æœ‰å±æ€§ï¼Œkä½œä¸ºä¸€ä¸ªå‚æ•°æ§åˆ¶äº†éšæœºæ€§çš„å¼•å…¥ç¨‹åº¦ã€‚\nå¦å¤–ï¼ŒGBDTè®­ç»ƒæ˜¯åŸºäºBoostingæ€æƒ³ï¼Œæ¯ä¸€è¿­ä»£ä¸­æ ¹æ®é”™è¯¯æ›´æ–°æ ·æœ¬æƒé‡ï¼Œå› æ­¤æ˜¯ä¸²è¡Œç”Ÿæˆçš„åºåˆ—åŒ–æ–¹æ³•ï¼Œè€Œéšæœºæ£®æ—æ˜¯baggingçš„æ€æƒ³ï¼Œå› æ­¤æ˜¯å¹¶è¡ŒåŒ–æ–¹æ³•ã€‚\n7. å¦‚ä½•åˆ¤æ–­å‡½æ•°å‡¸æˆ–éå‡¸ï¼Ÿä»€ä¹ˆæ˜¯å‡¸ä¼˜åŒ–ï¼Ÿ é¦–å…ˆå®šä¹‰å‡¸é›†ï¼Œå¦‚æœxï¼Œyå±äºæŸä¸ªé›†åˆCï¼Œå¹¶ä¸”æ‰€æœ‰çš„ ä¹Ÿå±äºcï¼Œé‚£ä¹ˆcä¸ºä¸€ä¸ªå‡¸é›†ï¼Œè¿›ä¸€æ­¥ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°å…¶å®šä¹‰åŸŸæ˜¯å‡¸é›†ï¼Œå¹¶ä¸”\nåˆ™è¯¥å‡½æ•°ä¸ºå‡¸å‡½æ•°ã€‚ä¸Šè¿°æ¡ä»¶è¿˜èƒ½æ¨å‡ºæ›´ä¸€èˆ¬çš„ç»“æœï¼Œ\nå¦‚æœå‡½æ•°æœ‰äºŒé˜¶å¯¼æ•°ï¼Œé‚£ä¹ˆå¦‚æœå‡½æ•°äºŒé˜¶å¯¼æ•°ä¸ºæ­£ï¼Œæˆ–è€…å¯¹äºå¤šå…ƒå‡½æ•°ï¼ŒHessiançŸ©é˜µåŠæ­£å®šåˆ™ä¸ºå‡¸å‡½æ•°ã€‚\n(ä¹Ÿå¯èƒ½å¼•åˆ°SVMï¼Œæˆ–è€…å‡¸å‡½æ•°å±€éƒ¨æœ€ä¼˜ä¹Ÿæ˜¯å…¨å±€æœ€ä¼˜çš„è¯æ˜ï¼Œæˆ–è€…ä¸Šè¿°å…¬å¼æœŸæœ›æƒ…å†µä¸‹çš„Jessenä¸ç­‰å¼)\n8. å¦‚ä½•è§£å†³ç±»åˆ«ä¸å¹³è¡¡é—®é¢˜ï¼Ÿ æœ‰äº›æƒ…å†µä¸‹è®­ç»ƒé›†ä¸­çš„æ ·æœ¬åˆ†å¸ƒå¾ˆä¸å¹³è¡¡ï¼Œä¾‹å¦‚åœ¨è‚¿ç˜¤æ£€æµ‹ç­‰é—®é¢˜ä¸­ï¼Œæ­£æ ·æœ¬çš„ä¸ªæ•°å¾€å¾€éå¸¸çš„å°‘ã€‚ä»çº¿æ€§åˆ†ç±»å™¨çš„è§’åº¦ï¼Œåœ¨ç”¨ å¯¹æ–°æ ·æœ¬è¿›è¡Œåˆ†ç±»çš„æ—¶å€™ï¼Œäº‹å®ä¸Šåœ¨ç”¨é¢„æµ‹å‡ºçš„yå€¼å’Œä¸€ä¸ªyå€¼è¿›è¡Œæ¯”è¾ƒï¼Œä¾‹å¦‚å¸¸å¸¸åœ¨y\u0026gt;0.5çš„æ—¶å€™åˆ¤ä¸ºæ­£ä¾‹ï¼Œå¦åˆ™åˆ¤ä¸ºåä¾‹ã€‚å‡ ç‡ åæ˜ äº†æ­£ä¾‹å¯èƒ½æ€§å’Œåä¾‹å¯èƒ½æ€§çš„æ¯”å€¼ï¼Œé˜ˆå€¼0.5æ°å¥½è¡¨æ˜åˆ†ç±»å™¨è®¤ä¸ºæ­£åçš„å¯èƒ½æ€§ç›¸åŒã€‚åœ¨æ ·æœ¬ä¸å‡è¡¡çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥æ˜¯åˆ†ç±»å™¨çš„é¢„æµ‹å‡ ç‡é«˜äºè§‚æµ‹å‡ ç‡å°±åˆ¤æ–­ä¸ºæ­£ä¾‹ï¼Œå› æ­¤åº”è¯¥æ˜¯ æ—¶é¢„æµ‹ä¸ºæ­£ä¾‹ï¼Œè¿™ç§ç­–ç•¥ç§°ä¸ºrebalancingã€‚ä½†æ˜¯è®­ç»ƒé›†å¹¶ä¸ä¸€å®šæ˜¯çœŸå®æ ·æœ¬æ€»ä½“çš„æ— åé‡‡æ ·ï¼Œé€šå¸¸æœ‰ä¸‰ç§åšæ³•ï¼Œä¸€ç§æ˜¯å¯¹è®­ç»ƒé›†çš„è´Ÿæ ·æœ¬è¿›è¡Œæ¬ é‡‡æ ·ï¼Œç¬¬äºŒç§æ˜¯å¯¹æ­£ä¾‹è¿›è¡Œå‡é‡‡æ ·ï¼Œç¬¬ä¸‰ç§æ˜¯ç›´æ¥åŸºäºåŸå§‹è®­ç»ƒé›†è¿›è¡Œå­¦ä¹ ï¼Œåœ¨é¢„æµ‹çš„æ—¶å€™å†æ”¹å˜é˜ˆå€¼ï¼Œç§°ä¸ºé˜ˆå€¼ç§»åŠ¨ã€‚æ³¨æ„è¿‡é‡‡æ ·ä¸€èˆ¬é€šè¿‡å¯¹è®­ç»ƒé›†çš„æ­£ä¾‹è¿›è¡Œæ’å€¼äº§ç”Ÿé¢å¤–çš„æ­£ä¾‹ï¼Œè€Œæ¬ é‡‡æ ·å°†åä¾‹åˆ’åˆ†ä¸ºä¸åŒçš„é›†åˆä¾›ä¸åŒçš„å­¦ä¹ å™¨ä½¿ç”¨ã€‚\n9. è§£é‡Šå¯¹å¶çš„æ¦‚å¿µã€‚ ä¸€ä¸ªä¼˜åŒ–é—®é¢˜å¯ä»¥ä»ä¸¤ä¸ªè§’åº¦è¿›è¡Œè€ƒå¯Ÿï¼Œä¸€ä¸ªæ˜¯primal é—®é¢˜ï¼Œä¸€ä¸ªæ˜¯dual é—®é¢˜ï¼Œå°±æ˜¯å¯¹å¶é—®é¢˜ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å¯¹å¶é—®é¢˜ç»™å‡ºä¸»é—®é¢˜æœ€ä¼˜å€¼çš„ä¸‹ç•Œï¼Œåœ¨å¼ºå¯¹å¶æ€§æˆç«‹çš„æƒ…å†µä¸‹ç”±å¯¹å¶é—®é¢˜å¯ä»¥å¾—åˆ°ä¸»é—®é¢˜çš„æœ€ä¼˜ä¸‹ç•Œï¼Œå¯¹å¶é—®é¢˜æ˜¯å‡¸ä¼˜åŒ–é—®é¢˜ï¼Œå¯ä»¥è¿›è¡Œè¾ƒå¥½çš„æ±‚è§£ï¼ŒSVMä¸­å°±æ˜¯å°†primalé—®é¢˜è½¬æ¢ä¸ºdualé—®é¢˜è¿›è¡Œæ±‚è§£ï¼Œä»è€Œè¿›ä¸€æ­¥å¼•å…¥æ ¸å‡½æ•°çš„æ€æƒ³ã€‚\n10. å¦‚ä½•è¿›è¡Œç‰¹å¾é€‰æ‹© ï¼Ÿ ç‰¹å¾é€‰æ‹©æ˜¯ä¸€ä¸ªé‡è¦çš„æ•°æ®é¢„å¤„ç†è¿‡ç¨‹ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼Œé¦–å…ˆåœ¨ç°å®ä»»åŠ¡ä¸­æˆ‘ä»¬ä¼šé‡åˆ°ç»´æ•°ç¾éš¾çš„é—®é¢˜(æ ·æœ¬å¯†åº¦éå¸¸ç¨€ç–)ï¼Œè‹¥èƒ½ä»ä¸­é€‰æ‹©ä¸€éƒ¨åˆ†ç‰¹å¾ï¼Œé‚£ä¹ˆè¿™ä¸ªé—®é¢˜èƒ½å¤§å¤§ç¼“è§£ï¼Œå¦å¤–å°±æ˜¯å»é™¤ä¸ç›¸å…³ç‰¹å¾ä¼šé™ä½å­¦ä¹ ä»»åŠ¡çš„éš¾åº¦ï¼Œå¢åŠ æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚å†—ä½™ç‰¹å¾æŒ‡è¯¥ç‰¹å¾åŒ…å«çš„ä¿¡æ¯å¯ä»¥ä»å…¶ä»–ç‰¹å¾ä¸­æ¨æ¼”å‡ºæ¥ï¼Œä½†æ˜¯è¿™å¹¶ä¸ä»£è¡¨è¯¥å†—ä½™ç‰¹å¾ä¸€å®šæ²¡æœ‰ä½œç”¨ï¼Œä¾‹å¦‚åœ¨æ¬ æ‹Ÿåˆçš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥ç”¨è¿‡åŠ å…¥å†—ä½™ç‰¹å¾ï¼Œå¢åŠ ç®€å•æ¨¡å‹çš„å¤æ‚åº¦ã€‚\nåœ¨ç†è®ºä¸Šå¦‚æœæ²¡æœ‰ä»»ä½•é¢†åŸŸçŸ¥è¯†ä½œä¸ºå…ˆéªŒå‡è®¾é‚£ä¹ˆåªèƒ½éå†æ‰€æœ‰å¯èƒ½çš„å­é›†ã€‚ä½†æ˜¯è¿™æ˜¾ç„¶æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºéœ€è¦éå†çš„æ•°é‡æ˜¯ç»„åˆçˆ†ç‚¸çš„ã€‚ä¸€èˆ¬æˆ‘ä»¬åˆ†ä¸ºå­é›†æœç´¢å’Œå­é›†è¯„ä»·ä¸¤ä¸ªè¿‡ç¨‹ï¼Œå­é›†æœç´¢ä¸€èˆ¬é‡‡ç”¨è´ªå¿ƒç®—æ³•ï¼Œæ¯ä¸€è½®ä»å€™é€‰ç‰¹å¾ä¸­æ·»åŠ æˆ–è€…åˆ é™¤ï¼Œåˆ†åˆ«æˆä¸ºå‰å‘å’Œåå…ˆæœç´¢ã€‚æˆ–è€…ä¸¤è€…ç»“åˆçš„åŒå‘æœç´¢ã€‚å­é›†è¯„ä»·ä¸€èˆ¬é‡‡ç”¨ä¿¡æ¯å¢ç›Šï¼Œå¯¹äºè¿ç»­æ•°æ®å¾€å¾€æ’åºä¹‹åé€‰æ‹©ä¸­ç‚¹ä½œä¸ºåˆ†å‰²ç‚¹ã€‚\nå¸¸è§çš„ç‰¹å¾é€‰æ‹©æ–¹å¼æœ‰è¿‡æ»¤å¼ï¼ŒåŒ…è£¹å¼å’ŒåµŒå…¥å¼ï¼Œfilterï¼Œwrapperå’Œembeddingã€‚Filterç±»å‹å…ˆå¯¹æ•°æ®é›†è¿›è¡Œç‰¹å¾é€‰æ‹©ï¼Œå†è®­ç»ƒå­¦ä¹ å™¨ã€‚Wrapperç›´æ¥æŠŠæœ€ç»ˆå­¦ä¹ å™¨çš„æ€§èƒ½ä½œä¸ºç‰¹å¾å­é›†çš„è¯„ä»·å‡†åˆ™ï¼Œä¸€èˆ¬é€šè¿‡ä¸æ–­å€™é€‰å­é›†ï¼Œç„¶ååˆ©ç”¨cross-validationè¿‡ç¨‹æ›´æ–°å€™é€‰ç‰¹å¾ï¼Œé€šå¸¸è®¡ç®—é‡æ¯”è¾ƒå¤§ã€‚åµŒå…¥å¼ç‰¹å¾é€‰æ‹©å°†ç‰¹å¾é€‰æ‹©è¿‡ç¨‹å’Œè®­ç»ƒè¿‡ç¨‹èä¸ºäº†ä¸€ä½“ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è‡ªåŠ¨è¿›è¡Œäº†ç‰¹å¾é€‰æ‹©ï¼Œä¾‹å¦‚L1æ­£åˆ™åŒ–æ›´æ˜“äºè·å¾—ç¨€ç–è§£ï¼Œè€ŒL2æ­£åˆ™åŒ–æ›´ä¸å®¹æ˜“è¿‡æ‹Ÿåˆã€‚L1æ­£åˆ™åŒ–å¯ä»¥é€šè¿‡PGDï¼Œè¿‘ç«¯æ¢¯åº¦ä¸‹é™è¿›è¡Œæ±‚è§£ã€‚\n11. ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿‡æ‹Ÿåˆï¼Œæœ‰å“ªäº›æ–¹æ³•å¯ä»¥é¢„é˜²æˆ–å…‹æœè¿‡æ‹Ÿåˆï¼Ÿ ä¸€èˆ¬åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œå°†å­¦ä¹ å™¨åœ¨è®­ç»ƒé›†ä¸Šçš„è¯¯å·®ç§°ä¸ºè®­ç»ƒè¯¯å·®æˆ–è€…ç»éªŒè¯¯å·®ï¼Œåœ¨æ–°æ ·æœ¬ä¸Šçš„è¯¯å·®ç§°ä¸ºæ³›åŒ–è¯¯å·®ã€‚æ˜¾ç„¶æˆ‘ä»¬å¸Œæœ›å¾—åˆ°æ³›åŒ–è¯¯å·®å°çš„å­¦ä¹ å™¨ï¼Œä½†æ˜¯æˆ‘ä»¬äº‹å…ˆå¹¶ä¸çŸ¥é“æ–°æ ·æœ¬ï¼Œå› æ­¤å®é™…ä¸Šå¾€å¾€åŠªåŠ›ä½¿ç»éªŒè¯¯å·®æœ€å°åŒ–ã€‚ç„¶è€Œï¼Œå½“å­¦ä¹ å™¨å°†è®­ç»ƒæ ·æœ¬å­¦çš„å¤ªå¥½çš„æ—¶å€™ï¼Œå¾€å¾€å¯èƒ½æŠŠè®­ç»ƒæ ·æœ¬è‡ªèº«çš„ç‰¹ç‚¹å½“åšäº†æ½œåœ¨æ ·æœ¬å…·æœ‰çš„ä¸€èˆ¬æ€§è´¨ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´æ³›åŒ–æ€§èƒ½ä¸‹é™ï¼Œç§°ä¹‹ä¸ºè¿‡æ‹Ÿåˆï¼Œç›¸åï¼Œæ¬ æ‹Ÿåˆä¸€èˆ¬æŒ‡å¯¹è®­ç»ƒæ ·æœ¬çš„ä¸€èˆ¬æ€§è´¨å°šæœªå­¦ä¹ å¥½ï¼Œåœ¨è®­ç»ƒé›†ä¸Šä»ç„¶æœ‰è¾ƒå¤§çš„è¯¯å·®ã€‚\næ¬ æ‹Ÿåˆï¼šä¸€èˆ¬æ¥è¯´æ¬ æ‹Ÿåˆæ›´å®¹æ˜“è§£å†³ä¸€äº›ï¼Œä¾‹å¦‚å¢åŠ æ¨¡å‹çš„å¤æ‚åº¦ï¼Œå¢åŠ å†³ç­–æ ‘ä¸­çš„åˆ†æ”¯ï¼Œå¢åŠ ç¥ç»ç½‘ç»œä¸­çš„è®­ç»ƒæ¬¡æ•°ç­‰ç­‰ã€‚æ ¹æœ¬çš„åŸå› æ˜¯ç‰¹å¾ç»´åº¦è¿‡å°‘ï¼Œå¯¼è‡´æ‹Ÿåˆçš„å‡½æ•°æ— æ³•æ»¡è¶³è®­ç»ƒé›†ï¼Œè¯¯å·®è¾ƒå¤§ã€‚\næ¬ æ‹Ÿåˆé—®é¢˜å¯ä»¥é€šè¿‡å¢åŠ ç‰¹å¾ç»´åº¦æ¥è§£å†³ã€‚å¯ä»¥è€ƒè™‘åŠ å…¥è¿›ç‰¹å¾ç»„åˆã€é«˜æ¬¡ç‰¹å¾ï¼Œæ¥å¢å¤§å‡è®¾ç©ºé—´;\næ·»åŠ å¤šé¡¹å¼ç‰¹å¾ï¼Œè¿™ä¸ªåœ¨æœºå™¨å­¦ä¹ ç®—æ³•é‡Œé¢ç”¨çš„å¾ˆæ™®éï¼Œä¾‹å¦‚å°†çº¿æ€§æ¨¡å‹é€šè¿‡æ·»åŠ äºŒæ¬¡é¡¹æˆ–è€…ä¸‰æ¬¡é¡¹ä½¿æ¨¡å‹æ³›åŒ–èƒ½åŠ›æ›´å¼º\nå‡å°‘æ­£åˆ™åŒ–å‚æ•°ï¼Œæ­£åˆ™åŒ–çš„ç›®çš„æ˜¯ç”¨æ¥é˜²æ­¢è¿‡æ‹Ÿåˆçš„ï¼Œä½†æ˜¯ç°åœ¨æ¨¡å‹å‡ºç°äº†æ¬ æ‹Ÿåˆï¼Œåˆ™éœ€è¦å‡å°‘æ­£åˆ™åŒ–å‚æ•°\nä½¿ç”¨éçº¿æ€§æ¨¡å‹ï¼Œæ¯”å¦‚æ ¸SVM ã€å†³ç­–æ ‘ã€æ·±åº¦å­¦ä¹ ç­‰æ¨¡å‹\nè¿‡æ‹Ÿåˆï¼šä¸€èˆ¬è®¤ä¸ºè¿‡æ‹Ÿåˆæ˜¯æ— æ³•å½»åº•é¿å…çš„ï¼Œå› ä¸ºæœºå™¨å­¦ä¹ é¢ä¸´çš„é—®é¢˜ä¸€èˆ¬æ˜¯np-hardï¼Œä½†æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„è§£ä¸€å®šè¦åœ¨å¤šé¡¹å¼å†…å¯ä»¥å·¥ä½œï¼Œæ‰€ä»¥ä¼šç‰ºç‰²ä¸€äº›æ³›åŒ–èƒ½åŠ›ã€‚è¿‡æ‹Ÿåˆçš„è§£å†³æ–¹æ¡ˆä¸€èˆ¬æœ‰å¢åŠ æ ·æœ¬æ•°é‡ï¼Œå¯¹æ ·æœ¬è¿›è¡Œé™ç»´ï¼Œé™ä½æ¨¡å‹å¤æ‚åº¦ï¼Œåˆ©ç”¨å…ˆéªŒçŸ¥è¯†(L1ï¼ŒL2æ­£åˆ™åŒ–)ï¼Œåˆ©ç”¨cross-validationï¼Œearly stoppingç­‰ç­‰ã€‚æ ¹æœ¬çš„åŸå› åˆ™æ˜¯ç‰¹å¾ç»´åº¦è¿‡å¤šï¼Œå¯¼è‡´æ‹Ÿåˆçš„å‡½æ•°å®Œç¾çš„ç»è¿‡è®­ç»ƒé›†ï¼Œä½†æ˜¯å¯¹æ–°æ•°æ®çš„é¢„æµ‹ç»“æœåˆ™è¾ƒå·®ã€‚\nå…¶ä»–åŸå› :\nè®­ç»ƒæ•°æ®é›†æ ·æœ¬å•ä¸€ï¼Œæ ·æœ¬ä¸è¶³ã€‚å¦‚æœè®­ç»ƒæ ·æœ¬åªæœ‰è´Ÿæ ·æœ¬ï¼Œç„¶åé‚£ç”Ÿæˆçš„æ¨¡å‹å»é¢„æµ‹æ­£æ ·æœ¬ï¼Œè¿™è‚¯å®šé¢„æµ‹ä¸å‡†ã€‚æ‰€ä»¥è®­ç»ƒæ ·æœ¬è¦å°½å¯èƒ½çš„å…¨é¢ï¼Œè¦†ç›–æ‰€æœ‰çš„æ•°æ®ç±»å‹ã€‚ è®­ç»ƒæ•°æ®ä¸­å™ªå£°å¹²æ‰°è¿‡å¤§ã€‚å™ªå£°æŒ‡è®­ç»ƒæ•°æ®ä¸­çš„å¹²æ‰°æ•°æ®ã€‚è¿‡å¤šçš„å¹²æ‰°ä¼šå¯¼è‡´è®°å½•äº†å¾ˆå¤šå™ªå£°ç‰¹å¾ï¼Œå¿½ç•¥äº†çœŸå®è¾“å…¥å’Œè¾“å‡ºä¹‹é—´çš„å…³ç³»ã€‚ **æ¨¡å‹è¿‡äºå¤æ‚ã€‚**æ¨¡å‹å¤ªå¤æ‚ï¼Œå·²ç»èƒ½å¤Ÿâ€œæ­»è®°ç¡¬èƒŒâ€è®°ä¸‹äº†è®­ç»ƒæ•°æ®çš„ä¿¡æ¯ï¼Œä½†æ˜¯é‡åˆ°æ²¡æœ‰è§è¿‡çš„æ•°æ®çš„æ—¶å€™ä¸èƒ½å¤Ÿå˜é€šï¼Œæ³›åŒ–èƒ½åŠ›å¤ªå·®ã€‚æˆ‘ä»¬å¸Œæœ›æ¨¡å‹å¯¹ä¸åŒçš„æ¨¡å‹éƒ½æœ‰ç¨³å®šçš„è¾“å‡ºã€‚æ¨¡å‹å¤ªå¤æ‚æ˜¯è¿‡æ‹Ÿåˆçš„é‡è¦å› ç´ ã€‚ è·å–å’Œä½¿ç”¨æ›´å¤šçš„æ•°æ®ï¼ˆæ•°æ®é›†å¢å¼ºï¼‰â€”â€”è§£å†³è¿‡æ‹Ÿåˆçš„æ ¹æœ¬æ€§æ–¹æ³•\nå‡å°‘ç‰¹å¾ç»´åº¦; å¯ä»¥äººå·¥é€‰æ‹©ä¿ç•™çš„ç‰¹å¾ï¼Œæˆ–è€…æ¨¡å‹é€‰æ‹©ç®—æ³•\né‡æ–°æ¸…æ´—æ•°æ®ï¼Œå¯¼è‡´è¿‡æ‹Ÿåˆçš„ä¸€ä¸ªåŸå› ä¹Ÿæœ‰å¯èƒ½æ˜¯æ•°æ®ä¸çº¯å¯¼è‡´çš„ï¼Œå¦‚æœå‡ºç°äº†è¿‡æ‹Ÿåˆå°±éœ€è¦æˆ‘ä»¬é‡æ–°æ¸…æ´—æ•°æ®ã€‚\né‡‡ç”¨æ­£åˆ™åŒ–æ–¹æ³•ã€‚æ­£åˆ™åŒ–æ–¹æ³•åŒ…æ‹¬L0æ­£åˆ™ã€L1æ­£åˆ™å’ŒL2æ­£åˆ™ï¼Œè€Œæ­£åˆ™ä¸€èˆ¬æ˜¯åœ¨ç›®æ ‡å‡½æ•°ä¹‹ååŠ ä¸Šå¯¹äºçš„èŒƒæ•°ã€‚ä½†æ˜¯åœ¨æœºå™¨å­¦ä¹ ä¸­ä¸€èˆ¬ä½¿ç”¨L2æ­£åˆ™ï¼Œä¸‹é¢çœ‹å…·ä½“çš„åŸå› ã€‚\nL0èŒƒæ•°æ˜¯æŒ‡å‘é‡ä¸­é0çš„å…ƒç´ çš„ä¸ªæ•°ã€‚L1èŒƒæ•°æ˜¯æŒ‡å‘é‡ä¸­å„ä¸ªå…ƒç´ ç»å¯¹å€¼ä¹‹å’Œï¼Œä¹Ÿå«â€œç¨€ç–è§„åˆ™ç®—å­â€ï¼ˆLasso regularizationï¼‰ã€‚ä¸¤è€…éƒ½å¯ä»¥å®ç°ç¨€ç–æ€§ï¼Œæ—¢ç„¶L0å¯ä»¥å®ç°ç¨€ç–ï¼Œä¸ºä»€ä¹ˆä¸ç”¨L0ï¼Œè€Œè¦ç”¨L1å‘¢ï¼Ÿä¸ªäººç†è§£ä¸€æ˜¯å› ä¸ºL0èŒƒæ•°å¾ˆéš¾ä¼˜åŒ–æ±‚è§£ï¼ˆNPéš¾é—®é¢˜ï¼‰ï¼ŒäºŒæ˜¯L1èŒƒæ•°æ˜¯L0èŒƒæ•°çš„æœ€ä¼˜å‡¸è¿‘ä¼¼ï¼Œè€Œä¸”å®ƒæ¯”L0èŒƒæ•°è¦å®¹æ˜“ä¼˜åŒ–æ±‚è§£ã€‚æ‰€ä»¥å¤§å®¶æ‰æŠŠç›®å…‰å’Œä¸‡åƒå® çˆ±è½¬äºL1èŒƒæ•°ã€‚ L2èŒƒæ•°æ˜¯æŒ‡å‘é‡å„å…ƒç´ çš„å¹³æ–¹å’Œç„¶åæ±‚å¹³æ–¹æ ¹ã€‚å¯ä»¥ä½¿å¾—Wçš„æ¯ä¸ªå…ƒç´ éƒ½å¾ˆå°ï¼Œéƒ½æ¥è¿‘äº0ï¼Œä½†ä¸L1èŒƒæ•°ä¸åŒï¼Œå®ƒä¸ä¼šè®©å®ƒç­‰äº0ï¼Œè€Œæ˜¯æ¥è¿‘äº0ã€‚L2æ­£åˆ™é¡¹èµ·åˆ°ä½¿å¾—å‚æ•°wå˜å°åŠ å‰§çš„æ•ˆæœï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆå¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆå‘¢ï¼Ÿä¸€ä¸ªé€šä¿—çš„ç†è§£ä¾¿æ˜¯ï¼šæ›´å°çš„å‚æ•°å€¼wæ„å‘³ç€æ¨¡å‹çš„å¤æ‚åº¦æ›´ä½ï¼Œå¯¹è®­ç»ƒæ•°æ®çš„æ‹Ÿåˆåˆšåˆšå¥½ï¼ˆå¥¥å¡å§†å‰ƒåˆ€ï¼‰ï¼Œä¸ä¼šè¿‡åˆ†æ‹Ÿåˆè®­ç»ƒæ•°æ®ï¼Œä»è€Œä½¿å¾—ä¸ä¼šè¿‡æ‹Ÿåˆï¼Œä»¥æé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚è¿˜æœ‰å°±æ˜¯çœ‹åˆ°æœ‰äººè¯´L2èŒƒæ•°æœ‰åŠ©äºå¤„ç† condition numberä¸å¥½çš„æƒ…å†µä¸‹çŸ©é˜µæ±‚é€†å¾ˆå›°éš¾çš„é—®é¢˜ã€‚ é‡‡ç”¨dropoutæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•åœ¨ç¥ç»ç½‘ç»œé‡Œé¢å¾ˆå¸¸ç”¨ã€‚ 12. ä»€ä¹ˆæ˜¯åå·®ä¸æ–¹å·®ï¼Ÿ æ³›åŒ–è¯¯å·®å¯ä»¥åˆ†è§£æˆåå·®çš„å¹³æ–¹åŠ ä¸Šæ–¹å·®åŠ ä¸Šå™ªå£°ã€‚åå·®åº¦é‡äº†å­¦ä¹ ç®—æ³•çš„æœŸæœ›é¢„æµ‹å’ŒçœŸå®ç»“æœçš„åç¦»ç¨‹åº¦ï¼Œåˆ»ç”»äº†å­¦ä¹ ç®—æ³•æœ¬èº«çš„æ‹Ÿåˆèƒ½åŠ›ï¼Œæ–¹å·®åº¦é‡äº†åŒæ ·å¤§å°çš„è®­ç»ƒé›†çš„å˜åŠ¨æ‰€å¯¼è‡´çš„å­¦ä¹ æ€§èƒ½çš„å˜åŒ–ï¼Œåˆ»ç”»äº†æ•°æ®æ‰°åŠ¨æ‰€é€ æˆçš„å½±å“ï¼Œå™ªå£°è¡¨è¾¾äº†å½“å‰ä»»åŠ¡ä¸Šä»»ä½•å­¦ä¹ ç®—æ³•æ‰€èƒ½è¾¾åˆ°çš„æœŸæœ›æ³›åŒ–è¯¯å·®ä¸‹ç•Œï¼Œåˆ»ç”»äº†é—®é¢˜æœ¬èº«çš„éš¾åº¦ã€‚åå·®å’Œæ–¹å·®ä¸€èˆ¬ç§°ä¸ºbiaså’Œvarianceï¼Œä¸€èˆ¬è®­ç»ƒç¨‹åº¦è¶Šå¼ºï¼Œåå·®è¶Šå°ï¼Œæ–¹å·®è¶Šå¤§ï¼Œæ³›åŒ–è¯¯å·®ä¸€èˆ¬åœ¨ä¸­é—´æœ‰ä¸€ä¸ªæœ€å°å€¼ï¼Œå¦‚æœåå·®è¾ƒå¤§ï¼Œæ–¹å·®è¾ƒå°ï¼Œæ­¤æ—¶ä¸€èˆ¬ç§°ä¸ºæ¬ æ‹Ÿåˆï¼Œè€Œåå·®è¾ƒå°ï¼Œæ–¹å·®è¾ƒå¤§ç§°ä¸ºè¿‡æ‹Ÿåˆã€‚\nåå·®ï¼š æ–¹å·®ï¼š 13. ç¥ç»ç½‘ç»œçš„åŸç†ï¼Œå¦‚ä½•è¿›è¡Œè®­ç»ƒï¼Ÿ ç¥ç»ç½‘ç»œè‡ªå‘å±•ä»¥æ¥å·²ç»æ˜¯ä¸€ä¸ªéå¸¸åºå¤§çš„å­¦ç§‘ï¼Œä¸€èˆ¬è€Œè¨€è®¤ä¸ºç¥ç»ç½‘ç»œæ˜¯ç”±å•ä¸ªçš„ç¥ç»å…ƒå’Œä¸åŒç¥ç»å…ƒä¹‹é—´çš„è¿æ¥æ„æˆï¼Œä¸å¤Ÿçš„ç»“æ„æ„æˆä¸åŒçš„ç¥ç»ç½‘ç»œã€‚æœ€å¸¸è§çš„ç¥ç»ç½‘ç»œä¸€èˆ¬ç§°ä¸ºå¤šå±‚å‰é¦ˆç¥ç»ç½‘ç»œï¼Œé™¤äº†è¾“å…¥å’Œè¾“å‡ºå±‚ï¼Œä¸­é—´éšè—å±‚çš„ä¸ªæ•°è¢«ç§°ä¸ºç¥ç»ç½‘ç»œçš„å±‚æ•°ã€‚BPç®—æ³•æ˜¯è®­ç»ƒç¥ç»ç½‘ç»œä¸­æœ€è‘—åçš„ç®—æ³•ï¼Œå…¶æœ¬è´¨æ˜¯æ¢¯åº¦ä¸‹é™å’Œé“¾å¼æ³•åˆ™ã€‚\n14. ä»‹ç»å·ç§¯ç¥ç»ç½‘ç»œï¼Œå’Œ DBN æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ å·ç§¯ç¥ç»ç½‘ç»œçš„ç‰¹ç‚¹æ˜¯å·ç§¯æ ¸ï¼ŒCNNä¸­ä½¿ç”¨äº†æƒå…±äº«ï¼Œé€šè¿‡ä¸æ–­çš„ä¸Šé‡‡ç”¨å’Œå·ç§¯å¾—åˆ°ä¸åŒçš„ç‰¹å¾è¡¨ç¤ºï¼Œé‡‡æ ·å±‚åˆç§°ä¸ºpoolingå±‚ï¼ŒåŸºäºå±€éƒ¨ç›¸å…³æ€§åŸç†è¿›è¡Œäºšé‡‡æ ·ï¼Œåœ¨å‡å°‘æ•°æ®é‡çš„åŒæ—¶ä¿æŒæœ‰ç”¨çš„ä¿¡æ¯ã€‚DBNæ˜¯æ·±åº¦ä¿¡å¿µç½‘ç»œï¼Œæ¯ä¸€å±‚æ˜¯ä¸€ä¸ªRBMï¼Œæ•´ä¸ªç½‘ç»œå¯ä»¥è§†ä¸ºRBMå †å å¾—åˆ°ï¼Œé€šå¸¸ä½¿ç”¨æ— ç›‘ç£é€å±‚è®­ç»ƒï¼Œä»ç¬¬ä¸€å±‚å¼€å§‹ï¼Œæ¯ä¸€å±‚åˆ©ç”¨ä¸Šä¸€å±‚çš„è¾“å…¥è¿›è¡Œè®­ç»ƒï¼Œç­‰å„å±‚è®­ç»ƒç»“æŸä¹‹åå†åˆ©ç”¨BPç®—æ³•å¯¹æ•´ä¸ªç½‘ç»œè¿›è¡Œè®­ç»ƒ\n15. é‡‡ç”¨ EM ç®—æ³•æ±‚è§£çš„æ¨¡å‹æœ‰å“ªäº›ï¼Œä¸ºä»€ä¹ˆä¸ç”¨ç‰›é¡¿æ³•æˆ–æ¢¯åº¦ä¸‹é™æ³•ï¼Ÿ ç”¨EMç®—æ³•æ±‚è§£çš„æ¨¡å‹ä¸€èˆ¬æœ‰GMMæˆ–è€…ååŒè¿‡æ»¤ï¼Œk-meanså…¶å®ä¹Ÿå±äºEMã€‚EMç®—æ³•ä¸€å®šä¼šæ”¶æ•›ï¼Œä½†æ˜¯å¯èƒ½æ”¶æ•›åˆ°å±€éƒ¨æœ€ä¼˜ã€‚ç”±äºæ±‚å’Œçš„é¡¹æ•°å°†éšç€éšå˜é‡çš„æ•°ç›®æŒ‡æ•°ä¸Šå‡ï¼Œä¼šç»™æ¢¯åº¦è®¡ç®—å¸¦æ¥éº»çƒ¦ã€‚\n16. ç”¨ EM ç®—æ³•æ¨å¯¼è§£é‡Š Kmeans k-meansç®—æ³•æ˜¯é«˜æ–¯æ··åˆèšç±»åœ¨æ··åˆæˆåˆ†æ–¹å·®ç›¸ç­‰ï¼Œä¸”æ¯ä¸ªæ ·æœ¬ä»…æŒ‡æ´¾ä¸€ä¸ªæ··åˆæˆåˆ†æ—¶å€™çš„ç‰¹ä¾‹ã€‚æ³¨æ„k-meansåœ¨è¿è¡Œä¹‹å‰éœ€è¦è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œä¸ç„¶å¯èƒ½ä¼šå› ä¸ºæ ·æœ¬åœ¨æŸäº›ç»´åº¦ä¸Šè¿‡å¤§å¯¼è‡´è·ç¦»è®¡ç®—å¤±æ•ˆã€‚k-meansä¸­æ¯ä¸ªæ ·æœ¬æ‰€å±çš„ç±»å°±å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªéšå˜é‡ï¼Œåœ¨Eæ­¥ä¸­ï¼Œæˆ‘ä»¬å›ºå®šæ¯ä¸ªç±»çš„ä¸­å¿ƒï¼Œé€šè¿‡å¯¹æ¯ä¸€ä¸ªæ ·æœ¬é€‰æ‹©æœ€è¿‘çš„ç±»ä¼˜åŒ–ç›®æ ‡å‡½æ•°ï¼Œåœ¨Mæ­¥ï¼Œé‡æ–°æ›´æ–°æ¯ä¸ªç±»çš„ä¸­å¿ƒç‚¹ï¼Œè¯¥æ­¥éª¤å¯ä»¥é€šè¿‡å¯¹ç›®æ ‡å‡½æ•°æ±‚å¯¼å®ç°ï¼Œæœ€ç»ˆå¯å¾—æ–°çš„ç±»ä¸­å¿ƒå°±æ˜¯ç±»ä¸­æ ·æœ¬çš„å‡å€¼ã€‚\n17. ç”¨è¿‡å“ªäº›èšç±»ç®—æ³•ï¼Œè§£é‡Šå¯†åº¦èšç±»ç®—æ³•ã€‚ k-meansç®—æ³•ï¼Œèšç±»æ€§èƒ½çš„åº¦é‡ä¸€èˆ¬åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯èšç±»ç»“æœä¸æŸä¸ªå‚è€ƒæ¨¡å‹æ¯”è¾ƒ(å¤–éƒ¨æŒ‡æ ‡)ï¼Œå¦å¤–æ˜¯ç›´æ¥è€ƒå¯Ÿèšç±»ç»“æœ(å†…éƒ¨æŒ‡æ ‡)ã€‚åè€…é€šå¸¸æœ‰DBæŒ‡æ•°å’ŒDIï¼ŒDBæŒ‡æ•°æ˜¯å¯¹æ¯ä¸ªç±»ï¼Œæ‰¾å‡ºç±»å†…å¹³å‡è·ç¦»/ç±»é—´ä¸­å¿ƒè·ç¦»æœ€å¤§çš„ç±»ï¼Œç„¶åè®¡ç®—ä¸Šè¿°å€¼ï¼Œå¹¶å¯¹æ‰€æœ‰çš„ç±»æ±‚å’Œï¼Œè¶Šå°è¶Šå¥½ã€‚ç±»ä¼¼k-meansçš„ç®—æ³•ä»…åœ¨ç±»ä¸­æ•°æ®æ„æˆç°‡çš„æƒ…å†µä¸‹è¡¨ç°è¾ƒå¥½ï¼Œå¯†åº¦èšç±»ç®—æ³•ä»æ ·æœ¬å¯†åº¦çš„è§’åº¦è€ƒå¯Ÿæ ·æœ¬ä¹‹é—´çš„å¯è¿æ¥æ€§ï¼Œå¹¶åŸºäºå¯è¿æ¥æ ·æœ¬ä¸æ–­æ‰©å±•èšç±»è”Ÿå¾—åˆ°æœ€ç»ˆç»“æœã€‚DBSCAN(density-based spatial clustering of applications with noise)æ˜¯ä¸€ç§è‘—åçš„å¯†åº¦èšç±»ç®—æ³•ï¼ŒåŸºäºä¸€ç»„é‚»åŸŸå‚æ•° è¿›è¡Œåˆ»ç”»ï¼ŒåŒ…æ‹¬é‚»åŸŸï¼Œæ ¸å¿ƒå¯¹è±¡(é‚»åŸŸå†…è‡³å°‘åŒ…å« ä¸ªå¯¹è±¡)ï¼Œå¯†åº¦ç›´è¾¾(jç”±iå¯†åº¦ç›´è¾¾ï¼Œè¡¨ç¤ºjåœ¨içš„é‚»åŸŸå†…ï¼Œä¸”iæ˜¯ä¸€ä¸ªæ ¸å¿ƒå¯¹è±¡)ï¼Œå¯†åº¦å¯è¾¾(jç”±iå¯†åº¦å¯è¾¾ï¼Œå­˜åœ¨æ ·æœ¬åºåˆ—ä½¿å¾—æ¯ä¸€å¯¹éƒ½å¯†åº¦ç›´è¾¾)ï¼Œå¯†åº¦ç›¸è¿(xiï¼Œxjå­˜åœ¨kï¼Œiï¼Œjå‡æœ‰kå¯è¾¾)ï¼Œå…ˆæ‰¾å‡ºæ ·æœ¬ä¸­æ‰€æœ‰çš„æ ¸å¿ƒå¯¹è±¡ï¼Œç„¶åä»¥ä»»ä¸€æ ¸å¿ƒå¯¹è±¡ä½œä¸ºå‡ºå‘ç‚¹ï¼Œæ‰¾å‡ºç”±å…¶å¯†åº¦å¯è¾¾çš„æ ·æœ¬ç”Ÿæˆèšç±»è”Ÿï¼Œç›´åˆ°æ‰€æœ‰æ ¸å¿ƒå¯¹è±¡è¢«è®¿é—®è¿‡ä¸ºæ­¢ã€‚\n18. èšç±»ç®—æ³•ä¸­çš„è·ç¦»åº¦é‡æœ‰å“ªäº›ï¼Ÿ èšç±»ç®—æ³•ä¸­çš„è·ç¦»åº¦é‡ä¸€èˆ¬ç”¨é—½ç§‘å¤«æ–¯åŸºè·ç¦»ï¼Œåœ¨på–ä¸åŒçš„å€¼ä¸‹å¯¹åº”ä¸åŒçš„è·ç¦»ï¼Œä¾‹å¦‚p=1çš„æ—¶å€™å¯¹åº”æ›¼å“ˆé¡¿è·ç¦»ï¼Œp=2çš„æƒ…å†µä¸‹å¯¹åº”æ¬§å¼è·ç¦»ï¼Œp=infçš„æƒ…å†µä¸‹å˜ä¸ºåˆ‡æ¯”é›ªå¤«è·ç¦»ï¼Œè¿˜æœ‰jaccardè·ç¦»ï¼Œå¹‚è·ç¦»(é—½ç§‘å¤«æ–¯åŸºçš„æ›´ä¸€èˆ¬å½¢å¼)ï¼Œä½™å¼¦ç›¸ä¼¼åº¦ï¼ŒåŠ æƒçš„è·ç¦»ï¼Œé©¬æ°è·ç¦»(ç±»ä¼¼åŠ æƒ)ä½œä¸ºè·ç¦»åº¦é‡éœ€è¦æ»¡è¶³éè´Ÿæ€§ï¼ŒåŒä¸€æ€§ï¼Œå¯¹ç§°æ€§å’Œç›´é€’æ€§ï¼Œé—½ç§‘å¤«æ–¯åŸºåœ¨p\u0026gt;=1çš„æ—¶å€™æ»¡è¶³è¯»æ¥é‚£ä¸ªæ€§è´¨ï¼Œå¯¹äºä¸€äº›ç¦»æ•£å±æ€§ä¾‹å¦‚{é£æœºï¼Œç«è½¦ï¼Œè½®èˆ¹}åˆ™ä¸èƒ½ç›´æ¥åœ¨å±æ€§å€¼ä¸Šè®¡ç®—è·ç¦»ï¼Œè¿™äº›ç§°ä¸ºæ— åºå±æ€§ï¼Œå¯ä»¥ç”¨VDM(Value Diffrence Metrix)ï¼Œå±æ€§uä¸Šä¸¤ä¸ªç¦»æ•£å€¼aï¼Œbä¹‹é—´çš„VDMè·ç¦»å®šä¹‰ä¸º\nå…¶ä¸­ è¡¨ç¤ºåœ¨ç¬¬iä¸ªç°‡ä¸­å±æ€§uä¸Šaçš„æ ·æœ¬æ•°ï¼Œæ ·æœ¬ç©ºé—´ä¸­ä¸åŒå±æ€§çš„é‡è¦æ€§ä¸åŒçš„æ—¶å€™å¯ä»¥é‡‡ç”¨åŠ æƒè·ç¦»ï¼Œä¸€èˆ¬å¦‚æœè®¤ä¸ºæ‰€æœ‰å±æ€§é‡è¦æ€§ç›¸åŒåˆ™è¦å¯¹ç‰¹å¾è¿›è¡Œå½’ä¸€åŒ–ã€‚ä¸€èˆ¬æ¥è¯´è·ç¦»éœ€è¦çš„æ˜¯ç›¸ä¼¼æ€§åº¦é‡ï¼Œè·ç¦»è¶Šå¤§ï¼Œç›¸ä¼¼åº¦è¶Šå°ï¼Œç”¨äºç›¸ä¼¼æ€§åº¦é‡çš„è·ç¦»æœªå¿…ä¸€å®šè¦æ»¡è¶³è·ç¦»åº¦é‡çš„æ‰€æœ‰æ€§è´¨ï¼Œä¾‹å¦‚ç›´é€’æ€§ã€‚æ¯”å¦‚äººé©¬å’Œäººï¼Œäººé©¬å’Œé©¬çš„è·ç¦»è¾ƒè¿‘ï¼Œç„¶åäººå’Œé©¬çš„è·ç¦»å¯èƒ½å°±å¾ˆè¿œã€‚\n19. è§£é‡Šè´å¶æ–¯å…¬å¼å’Œæœ´ç´ è´å¶æ–¯åˆ†ç±»ã€‚ è´å¶æ–¯å…¬å¼ï¼š\næœ€å°åŒ–åˆ†ç±»é”™è¯¯çš„è´å¶æ–¯æœ€ä¼˜åˆ†ç±»å™¨ç­‰ä»·äºæœ€å¤§åŒ–åéªŒæ¦‚ç‡ã€‚\nåŸºäºè´å¶æ–¯å…¬å¼æ¥ä¼°è®¡åéªŒæ¦‚ç‡çš„ä¸»è¦å›°éš¾åœ¨äºï¼Œæ¡ä»¶æ¦‚ç‡ æ˜¯æ‰€æœ‰å±æ€§ä¸Šçš„è”åˆæ¦‚ç‡ï¼Œéš¾ä»¥ä»æœ‰é™çš„è®­ç»ƒæ ·æœ¬ç›´æ¥ä¼°è®¡å¾—åˆ°ã€‚æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨é‡‡ç”¨äº†å±æ€§æ¡ä»¶ç‹¬ç«‹æ€§å‡è®¾ï¼Œå¯¹äºå·²çŸ¥çš„ç±»åˆ«ï¼Œå‡è®¾æ‰€æœ‰å±æ€§ç›¸äº’ç‹¬ç«‹ã€‚è¿™æ ·ï¼Œæœ´ç´ è´å¶æ–¯åˆ†ç±»åˆ™å®šä¹‰ä¸º\nå¦‚æœæœ‰è¶³å¤Ÿå¤šçš„ç‹¬ç«‹åŒåˆ†å¸ƒæ ·æœ¬ï¼Œé‚£ä¹ˆ å¯ä»¥æ ¹æ®æ¯ä¸ªç±»ä¸­çš„æ ·æœ¬æ•°é‡ç›´æ¥ä¼°è®¡å‡ºæ¥ã€‚åœ¨ç¦»æ•£æƒ…å†µä¸‹å…ˆéªŒæ¦‚ç‡å¯ä»¥åˆ©ç”¨æ ·æœ¬æ•°é‡ä¼°è®¡æˆ–è€…ç¦»æ•£æƒ…å†µä¸‹æ ¹æ®å‡è®¾çš„æ¦‚ç‡å¯†åº¦å‡½æ•°è¿›è¡Œæœ€å¤§ä¼¼ç„¶ä¼°è®¡ã€‚æœ´ç´ è´å¶æ–¯å¯ä»¥ç”¨äºåŒæ—¶åŒ…å«è¿ç»­å˜é‡å’Œç¦»æ•£å˜é‡çš„æƒ…å†µã€‚å¦‚æœç›´æ¥åŸºäºå‡ºç°çš„æ¬¡æ•°è¿›è¡Œä¼°è®¡ï¼Œä¼šå‡ºç°ä¸€é¡¹ä¸º0è€Œä¹˜ç§¯ä¸º0çš„æƒ…å†µï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šç”¨ä¸€äº›å¹³æ»‘çš„æ–¹æ³•ï¼Œä¾‹å¦‚æ‹‰æ™®æ‹‰æ–¯ä¿®æ­£ï¼Œ\nè¿™æ ·æ—¢å¯ä»¥ä¿è¯æ¦‚ç‡çš„å½’ä¸€åŒ–ï¼ŒåŒæ—¶è¿˜èƒ½é¿å…ä¸Šè¿°å‡ºç°çš„ç°è±¡ã€‚\n20. è§£é‡ŠL1å’ŒL2æ­£åˆ™åŒ–çš„ä½œç”¨ã€‚ L1æ­£åˆ™åŒ–æ˜¯åœ¨ä»£ä»·å‡½æ•°åé¢åŠ ä¸Š ï¼ŒL2æ­£åˆ™åŒ–æ˜¯åœ¨ä»£ä»·å‡½æ•°åé¢å¢åŠ äº† ï¼Œä¸¤è€…éƒ½èµ·åˆ°ä¸€å®šçš„è¿‡æ‹Ÿåˆä½œç”¨ï¼Œä¸¤è€…éƒ½å¯¹åº”ä¸€å®šçš„å…ˆéªŒçŸ¥è¯†ï¼ŒL1å¯¹åº”æ‹‰æ™®æ‹‰æ–¯åˆ†å¸ƒï¼ŒL2å¯¹åº”é«˜æ–¯åˆ†å¸ƒï¼ŒL1åå‘äºå‚æ•°ç¨€ç–æ€§ï¼ŒL2åå‘äºå‚æ•°åˆ†å¸ƒè¾ƒä¸ºç¨ \n21. TF-IDFæ˜¯ä»€ä¹ˆï¼Ÿ TFæŒ‡Term frequecyï¼Œä»£è¡¨è¯é¢‘ï¼ŒIDFä»£è¡¨inverse document frequencyï¼Œå«åšé€†æ–‡æ¡£é¢‘ç‡ï¼Œè¿™ä¸ªç®—æ³•å¯ä»¥ç”¨æ¥æå–æ–‡æ¡£çš„å…³é”®è¯ï¼Œé¦–å…ˆä¸€èˆ¬è®¤ä¸ºåœ¨æ–‡ç« ä¸­å‡ºç°æ¬¡æ•°è¾ƒå¤šçš„è¯æ˜¯å…³é”®è¯ï¼Œè¯é¢‘å°±ä»£è¡¨äº†è¿™ä¸€é¡¹ï¼Œç„¶è€Œæœ‰äº›è¯æ˜¯åœç”¨è¯ï¼Œä¾‹å¦‚çš„ï¼Œæ˜¯ï¼Œæœ‰è¿™ç§å¤§é‡å‡ºç°çš„è¯ï¼Œé¦–å…ˆéœ€è¦è¿›è¡Œè¿‡æ»¤ï¼Œæ¯”å¦‚è¿‡æ»¤ä¹‹åå†ç»Ÿè®¡è¯é¢‘å‡ºç°äº†ä¸­å›½ï¼Œèœœèœ‚ï¼Œå…»æ®–ä¸”ä¸‰ä¸ªè¯çš„è¯é¢‘å‡ ä¹ä¸€è‡´ï¼Œä½†æ˜¯ä¸­å›½è¿™ä¸ªè¯å‡ºç°åœ¨å…¶ä»–æ–‡ç« çš„æ¦‚ç‡æ¯”å…¶ä»–ä¸¤ä¸ªè¯è¦é«˜ä¸å°‘ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥è®¤ä¸ºåä¸¤ä¸ªè¯æ›´èƒ½è¡¨ç°æ–‡ç« çš„ä¸»é¢˜ï¼ŒIDFå°±ä»£è¡¨äº†è¿™æ ·çš„ä¿¡æ¯ï¼Œè®¡ç®—è¯¥å€¼éœ€è¦ä¸€ä¸ªè¯­æ–™åº“ï¼Œå¦‚æœä¸€ä¸ªè¯åœ¨è¯­æ–™åº“ä¸­å‡ºç°çš„æ¦‚ç‡è¶Šå°ï¼Œé‚£ä¹ˆè¯¥è¯çš„IDFåº”è¯¥è¶Šå¤§ï¼Œä¸€èˆ¬æ¥è¯´TFè®¡ç®—å…¬å¼ä¸º(æŸä¸ªè¯åœ¨æ–‡ç« ä¸­å‡ºç°æ¬¡æ•°/æ–‡ç« çš„æ€»è¯æ•°)ï¼Œè¿™æ ·æ¶ˆé™¤é•¿æ–‡ç« ä¸­è¯å‡ºç°æ¬¡æ•°å¤šçš„å½±å“ï¼ŒIDFè®¡ç®—å…¬å¼ä¸ºlog(è¯­æ–™åº“æ–‡ç« æ€»æ•°/(åŒ…å«è¯¥è¯çš„æ–‡ç« æ•°)+1)ã€‚å°†ä¸¤è€…ä¹˜ä¹˜èµ·æ¥å°±å¾—åˆ°äº†è¯çš„TF-IDFã€‚ä¼ ç»Ÿçš„TF-IDFå¯¹è¯å‡ºç°çš„ä½ç½®æ²¡æœ‰è¿›è¡Œè€ƒè™‘ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒä½ç½®èµ‹äºˆä¸åŒçš„æƒé‡è¿›è¡Œä¿®æ­£ï¼Œæ³¨æ„è¿™äº›ä¿®æ­£ä¹‹æ‰€ä»¥æ˜¯æœ‰æ•ˆçš„ï¼Œæ­£æ˜¯å› ä¸ºäººè§‚æµ‹è¿‡äº†å¤§é‡çš„ä¿¡æ¯ï¼Œå› æ­¤å»ºè®®äº†ä¸€ä¸ªå…ˆéªŒä¼°è®¡ï¼Œäººå°†è¿™ä¸ªå…ˆéªŒä¼°è®¡èåˆåˆ°äº†ç®—æ³•é‡Œé¢ï¼Œæ‰€ä»¥ä½¿ç®—æ³•æ›´åŠ çš„æœ‰æ•ˆ\n22. æ–‡æœ¬ä¸­çš„ä½™å¼¦è·ç¦»æ˜¯ä»€ä¹ˆï¼Œæœ‰å“ªäº›ä½œç”¨ï¼Ÿ ä½™å¼¦è·ç¦»æ˜¯ä¸¤ä¸ªå‘é‡çš„è·ç¦»çš„ä¸€ç§åº¦é‡æ–¹å¼ï¼Œå…¶å€¼åœ¨-1~1ä¹‹é—´ï¼Œå¦‚æœä¸º1è¡¨ç¤ºä¸¤ä¸ªå‘é‡åŒç›¸ï¼Œ0è¡¨ç¤ºä¸¤ä¸ªå‘é‡æ­£äº¤ï¼Œ-1è¡¨ç¤ºä¸¤ä¸ªå‘é‡åå‘ã€‚ä½¿ç”¨TF-IDFå’Œä½™å¼¦è·ç¦»å¯ä»¥å¯»æ‰¾å†…å®¹ç›¸ä¼¼çš„æ–‡ç« ï¼Œä¾‹å¦‚é¦–å…ˆç”¨TF-IDFæ‰¾å‡ºä¸¤ç¯‡æ–‡ç« çš„å…³é”®è¯ï¼Œç„¶åæ¯ä¸ªæ–‡ç« åˆ†åˆ«å–å‡ºkä¸ªå…³é”®è¯(10-20ä¸ª)ï¼Œç»Ÿè®¡è¿™äº›å…³é”®è¯çš„è¯é¢‘ï¼Œç”Ÿæˆä¸¤ç¯‡æ–‡ç« çš„è¯é¢‘å‘é‡ï¼Œç„¶åç”¨ä½™å¼¦è·ç¦»è®¡ç®—å…¶ç›¸ä¼¼åº¦ã€‚\nå‚è€ƒ:\nåº”è˜æœºå™¨å­¦ä¹ å·¥ç¨‹å¸ˆï¼Ÿè¿™æ˜¯ä½ éœ€è¦çŸ¥é“çš„12ä¸ªåŸºç¡€é¢è¯•é—®é¢˜ Pythonæœºå™¨å­¦ä¹ Sklearnä¸“é¢˜æ–‡ç« é›†é”¦ ","permalink":"https://reid00.github.io/en/posts/ml/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E9%9D%A2%E8%AF%95%E9%A2%98/","summary":"1. æ— ç›‘ç£å’Œæœ‰ç›‘ç£çš„åŒºåˆ«ï¼Ÿ æœ‰ç›‘ç£å­¦ä¹ ï¼šå¯¹å…·æœ‰æ¦‚å¿µæ ‡è®°ï¼ˆåˆ†ç±»ï¼‰çš„è®­ç»ƒæ ·æœ¬è¿›è¡Œå­¦ä¹ ï¼Œä»¥å°½å¯èƒ½å¯¹è®­ç»ƒæ ·æœ¬é›†å¤–çš„æ•°æ®è¿›è¡Œæ ‡è®°ï¼ˆåˆ†ç±»ï¼‰é¢„æµ‹ã€‚è¿™é‡Œï¼Œæ‰€æœ‰çš„æ ‡è®°ï¼ˆåˆ†ç±»ï¼‰æ˜¯å·²çŸ¥çš„ã€‚å› æ­¤ï¼Œè®­ç»ƒæ ·æœ¬çš„å²ä¹‰æ€§ä½ã€‚\næ— ç›‘ç£å­¦ä¹ ï¼šå¯¹æ²¡æœ‰æ¦‚å¿µæ ‡è®°ï¼ˆåˆ†ç±»ï¼‰çš„è®­ç»ƒæ ·æœ¬è¿›è¡Œå­¦ä¹ ï¼Œä»¥å‘ç°è®­ç»ƒæ ·æœ¬é›†ä¸­çš„ç»“æ„æ€§çŸ¥è¯†ã€‚è¿™é‡Œï¼Œæ‰€æœ‰çš„æ ‡è®°ï¼ˆåˆ†ç±»ï¼‰æ˜¯æœªçŸ¥çš„ã€‚å› æ­¤ï¼Œè®­ç»ƒæ ·æœ¬çš„å²ä¹‰æ€§é«˜ã€‚èšç±»å°±æ˜¯å…¸å‹çš„æ— ç›‘ç£å­¦ä¹ ã€‚\n2. SVM çš„æ¨å¯¼ï¼Œç‰¹æ€§ï¼Ÿå¤šåˆ†ç±»æ€ä¹ˆå¤„ç†ï¼Ÿ SVMæ˜¯æœ€å¤§é—´éš”åˆ†ç±»å™¨ï¼Œå‡ ä½•é—´éš”å’Œæ ·æœ¬çš„è¯¯åˆ†æ¬¡æ•°ä¹‹é—´å­˜åœ¨å…³ç³»ï¼Œ ï¼Œå…¶ä¸­ ä»çº¿æ€§å¯åˆ†æƒ…å†µä¸‹ï¼ŒåŸé—®é¢˜ï¼Œç‰¹å¾è½¬æ¢åçš„dualé—®é¢˜ï¼Œå¼•å…¥kernel(çº¿æ€§kernelï¼Œå¤šé¡¹å¼ï¼Œé«˜æ–¯)ï¼Œæœ€åæ˜¯soft marginã€‚\nçº¿æ€§ï¼šç®€å•ï¼Œé€Ÿåº¦å¿«ï¼Œä½†æ˜¯éœ€è¦çº¿æ€§å¯åˆ†ã€‚\nå¤šé¡¹å¼ï¼šæ¯”çº¿æ€§æ ¸æ‹Ÿåˆç¨‹åº¦æ›´å¼ºï¼ŒçŸ¥é“å…·ä½“çš„ç»´åº¦ï¼Œä½†æ˜¯é«˜æ¬¡å®¹æ˜“å‡ºç°æ•°å€¼ä¸ç¨³å®šï¼Œå‚æ•°é€‰æ‹©æ¯”è¾ƒå¤šã€‚\né«˜æ–¯ï¼šæ‹Ÿåˆèƒ½åŠ›æœ€å¼ºï¼Œä½†æ˜¯è¦æ³¨æ„è¿‡æ‹Ÿåˆé—®é¢˜ã€‚ä¸è¿‡åªæœ‰ä¸€ä¸ªå‚æ•°éœ€è¦è°ƒæ•´ã€‚\nå¤šåˆ†ç±»é—®é¢˜ï¼Œä¸€èˆ¬å°†äºŒåˆ†ç±»æ¨å¹¿åˆ°å¤šåˆ†ç±»çš„æ–¹å¼æœ‰ä¸‰ç§ï¼Œä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹å¤šã€‚\nä¸€å¯¹ä¸€ï¼šå°†Nä¸ªç±»åˆ«ä¸¤ä¸¤é…å¯¹ï¼Œäº§ç”ŸN(N-1)/2ä¸ªäºŒåˆ†ç±»ä»»åŠ¡ï¼Œæµ‹è¯•é˜¶æ®µæ–°æ ·æœ¬åŒæ—¶äº¤ç»™æ‰€æœ‰çš„åˆ†ç±»å™¨ï¼Œæœ€ç»ˆç»“æœé€šè¿‡æŠ•ç¥¨äº§ç”Ÿã€‚\nä¸€å¯¹å¤šï¼šæ¯ä¸€æ¬¡å°†ä¸€ä¸ªä¾‹ä½œä¸ºæ­£ä¾‹ï¼Œå…¶ä»–çš„ä½œä¸ºåä¾‹ï¼Œè®­ç»ƒNä¸ªåˆ†ç±»å™¨ï¼Œæµ‹è¯•æ—¶å¦‚æœåªæœ‰ä¸€ä¸ªåˆ†ç±»å™¨é¢„æµ‹ä¸ºæ­£ç±»ï¼Œåˆ™å¯¹åº”ç±»åˆ«ä¸ºæœ€ç»ˆç»“æœï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œåˆ™ä¸€èˆ¬é€‰æ‹©ç½®ä¿¡åº¦æœ€å¤§çš„ã€‚ä»åˆ†ç±»å™¨è§’åº¦ä¸€å¯¹ä¸€æ›´å¤šï¼Œä½†æ˜¯æ¯ä¸€æ¬¡éƒ½åªç”¨äº†2ä¸ªç±»åˆ«ï¼Œå› æ­¤å½“ç±»åˆ«æ•°å¾ˆå¤šçš„æ—¶å€™ä¸€å¯¹ä¸€å¼€é”€é€šå¸¸æ›´å°(åªè¦è®­ç»ƒå¤æ‚åº¦é«˜äºO(N)å³å¯å¾—åˆ°æ­¤ç»“æœ)ã€‚\nå¤šå¯¹å¤šï¼šè‹¥å¹²å„ç±»ä½œä¸ºæ­£ç±»ï¼Œè‹¥å¹²ä¸ªç±»ä½œä¸ºåç±»ã€‚æ³¨æ„æ­£åç±»å¿…é¡»ç‰¹æ®Šçš„è®¾è®¡ã€‚\n3. LR çš„æ¨å¯¼ï¼Œç‰¹æ€§ï¼Ÿ LRçš„ä¼˜ç‚¹åœ¨äºå®ç°ç®€å•ï¼Œå¹¶ä¸”è®¡ç®—é‡éå¸¸å°ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œå­˜å‚¨èµ„æºä½ï¼Œç¼ºç‚¹å°±æ˜¯å› ä¸ºæ¨¡å‹ç®€å•ï¼Œå¯¹äºå¤æ‚çš„æƒ…å†µä¸‹ä¼šå‡ºç°æ¬ æ‹Ÿåˆï¼Œå¹¶ä¸”åªèƒ½å¤„ç†2åˆ†ç±»é—®é¢˜(å¯ä»¥é€šè¿‡ä¸€èˆ¬çš„äºŒå…ƒè½¬æ¢ä¸ºå¤šå…ƒæˆ–è€…ç”¨softmaxå›å½’)ã€‚\n4. å†³ç­–æ ‘çš„ç‰¹æ€§ï¼Ÿ å†³ç­–æ ‘åŸºäºæ ‘ç»“æ„è¿›è¡Œå†³ç­–ï¼Œä¸äººç±»åœ¨é¢ä¸´é—®é¢˜çš„æ—¶å€™å¤„ç†æœºåˆ¶ååˆ†ç±»ä¼¼ã€‚å…¶ç‰¹ç‚¹åœ¨äºéœ€è¦é€‰æ‹©ä¸€ä¸ªå±æ€§è¿›è¡Œåˆ†æ”¯ï¼Œåœ¨åˆ†æ”¯çš„è¿‡ç¨‹ä¸­é€‰æ‹©ä¿¡æ¯å¢ç›Šæœ€å¤§çš„å±æ€§ï¼Œå®šä¹‰å¦‚ä¸‹ã€€åœ¨åˆ’åˆ†ä¸­æˆ‘ä»¬å¸Œæœ›å†³ç­–æ ‘çš„åˆ†æ”¯èŠ‚ç‚¹æ‰€åŒ…å«çš„æ ·æœ¬å±äºåŒä¸€ç±»åˆ«ï¼Œå³èŠ‚ç‚¹çš„çº¯åº¦è¶Šæ¥è¶Šé«˜ã€‚å†³ç­–æ ‘è®¡ç®—é‡ç®€å•ï¼Œå¯è§£é‡Šæ€§å¼ºï¼Œæ¯”è¾ƒé€‚åˆå¤„ç†æœ‰ç¼ºå¤±å±æ€§å€¼çš„æ ·æœ¬ï¼Œèƒ½å¤Ÿå¤„ç†ä¸ç›¸å…³çš„ç‰¹å¾ï¼Œä½†æ˜¯å®¹æ˜“è¿‡æ‹Ÿåˆï¼Œéœ€è¦ä½¿ç”¨å‰ªææˆ–è€…éšæœºæ£®æ—ã€‚ä¿¡æ¯å¢ç›Šæ˜¯ç†µå‡å»æ¡ä»¶ç†µï¼Œä»£è¡¨ä¿¡æ¯ä¸ç¡®å®šæ€§è¾ƒå°‘çš„ç¨‹åº¦ï¼Œä¿¡æ¯å¢ç›Šè¶Šå¤§ï¼Œè¯´æ˜ä¸ç¡®å®šæ€§é™ä½çš„è¶Šå¤§ï¼Œå› æ­¤è¯´æ˜è¯¥ç‰¹å¾å¯¹åˆ†ç±»æ¥è¯´å¾ˆé‡è¦ã€‚ç”±äºä¿¡æ¯å¢ç›Šå‡†åˆ™ä¼šå¯¹æ•°ç›®è¾ƒå¤šçš„å±æ€§æœ‰æ‰€åå¥½ï¼Œå› æ­¤ä¸€èˆ¬ç”¨ä¿¡æ¯å¢ç›Šç‡(c4.5)\nå…¶ä¸­åˆ†æ¯å¯ä»¥çœ‹ä½œä¸ºå±æ€§è‡ªèº«çš„ç†µã€‚å–å€¼å¯èƒ½æ€§è¶Šå¤šï¼Œå±æ€§çš„ç†µè¶Šå¤§ã€‚\nCartå†³ç­–æ ‘ä½¿ç”¨åŸºå°¼æŒ‡æ•°æ¥é€‰æ‹©åˆ’åˆ†å±æ€§ï¼Œç›´è§‚çš„æ¥è¯´ï¼ŒGini(D)åæ˜ äº†ä»æ•°æ®é›†Dä¸­éšæœºæŠ½å–ä¸¤ä¸ªæ ·æœ¬ï¼Œå…¶ç±»åˆ«æ ‡è®°ä¸ä¸€è‡´çš„æ¦‚ç‡ï¼Œå› æ­¤åŸºå°¼æŒ‡æ•°è¶Šå°æ•°æ®é›†Dçš„çº¯åº¦è¶Šé«˜ï¼Œä¸€èˆ¬ä¸ºäº†é˜²æ­¢è¿‡æ‹Ÿåˆè¦è¿›è¡Œå‰ªæï¼Œæœ‰é¢„å‰ªæå’Œåå‰ªæï¼Œä¸€èˆ¬ç”¨cross validationé›†è¿›è¡Œå‰ªæã€‚\nè¿ç»­å€¼å’Œç¼ºå¤±å€¼çš„å¤„ç†ï¼Œå¯¹äºè¿ç»­å±æ€§aï¼Œå°†aåœ¨Dä¸Šå‡ºç°çš„ä¸åŒçš„å–å€¼è¿›è¡Œæ’åºï¼ŒåŸºäºåˆ’åˆ†ç‚¹tå°†Dåˆ†ä¸ºä¸¤ä¸ªå­é›†ã€‚ä¸€èˆ¬å¯¹æ¯ä¸€ä¸ªè¿ç»­çš„ä¸¤ä¸ªå–å€¼çš„ä¸­ç‚¹ä½œä¸ºåˆ’åˆ†ç‚¹ï¼Œç„¶åæ ¹æ®ä¿¡æ¯å¢ç›Šé€‰æ‹©æœ€å¤§çš„ã€‚ä¸ç¦»æ•£å±æ€§ä¸åŒï¼Œè‹¥å½“å‰èŠ‚ç‚¹åˆ’åˆ†å±æ€§ä¸ºè¿ç»­å±æ€§ï¼Œè¯¥å±æ€§è¿˜å¯ä»¥ä½œä¸ºå…¶åä»£çš„åˆ’åˆ†å±æ€§ã€‚\n5. SVM,LR,å†³ç­–æ ‘å¯¹æ¯”ï¼Ÿ SVMæ—¢å¯ä»¥ç”¨äºåˆ†ç±»é—®é¢˜ï¼Œä¹Ÿå¯ä»¥ç”¨äºå›å½’é—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡æ ¸å‡½æ•°å¿«é€Ÿçš„è®¡ç®—ï¼ŒLRå®ç°ç®€å•ï¼Œè®­ç»ƒé€Ÿåº¦éå¸¸å¿«ï¼Œä½†æ˜¯æ¨¡å‹è¾ƒä¸ºç®€å•ï¼Œå†³ç­–æ ‘å®¹æ˜“è¿‡æ‹Ÿåˆï¼Œéœ€è¦è¿›è¡Œå‰ªæç­‰ã€‚ä»ä¼˜åŒ–å‡½æ•°ä¸Šçœ‹ï¼Œsoft marginçš„SVMç”¨çš„æ˜¯hinge lossï¼Œè€Œå¸¦L2æ­£åˆ™åŒ–çš„LRå¯¹åº”çš„æ˜¯cross entropy lossï¼Œå¦å¤–adaboostå¯¹åº”çš„æ˜¯exponential lossã€‚æ‰€ä»¥LRå¯¹è¿œç‚¹æ•æ„Ÿï¼Œä½†æ˜¯SVMå¯¹outlierä¸å¤ªæ•æ„Ÿï¼Œå› ä¸ºåªå…³å¿ƒsupport vectorï¼ŒSVMå¯ä»¥å°†ç‰¹å¾æ˜ å°„åˆ°æ— ç©·ç»´ç©ºé—´ï¼Œä½†æ˜¯LRä¸å¯ä»¥ï¼Œä¸€èˆ¬å°æ•°æ®ä¸­SVMæ¯”LRæ›´ä¼˜ä¸€ç‚¹ï¼Œä½†æ˜¯LRå¯ä»¥é¢„æµ‹æ¦‚ç‡ï¼Œè€ŒSVMä¸å¯ä»¥ï¼ŒSVMä¾èµ–äºæ•°æ®æµ‹åº¦ï¼Œéœ€è¦å…ˆåšå½’ä¸€åŒ–ï¼ŒLRä¸€èˆ¬ä¸éœ€è¦ï¼Œå¯¹äºå¤§é‡çš„æ•°æ®LRä½¿ç”¨æ›´åŠ å¹¿æ³›ï¼ŒLRå‘å¤šåˆ†ç±»çš„æ‰©å±•æ›´åŠ ç›´æ¥ï¼Œå¯¹äºç±»åˆ«ä¸å¹³è¡¡SVMä¸€èˆ¬ç”¨æƒé‡è§£å†³ï¼Œå³ç›®æ ‡å‡½æ•°ä¸­å¯¹æ­£è´Ÿæ ·æœ¬ä»£ä»·å‡½æ•°ä¸åŒï¼ŒLRå¯ä»¥ç”¨ä¸€èˆ¬çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¯¹æœ€åç»“æœè°ƒæ•´(é€šè¿‡é˜ˆå€¼)ï¼Œä¸€èˆ¬å°æ•°æ®ä¸‹æ ·æœ¬ç»´åº¦æ¯”è¾ƒé«˜çš„æ—¶å€™SVMæ•ˆæœè¦æ›´ä¼˜ä¸€äº›ã€‚\n6. GBDT å’Œéšæœºæ£®æ—çš„åŒºåˆ«ï¼Ÿ éšæœºæ£®æ—é‡‡ç”¨çš„æ˜¯baggingçš„æ€æƒ³ï¼Œbaggingåˆç§°ä¸ºbootstrap aggreagationï¼Œé€šè¿‡åœ¨è®­ç»ƒæ ·æœ¬é›†ä¸­è¿›è¡Œæœ‰æ”¾å›çš„é‡‡æ ·å¾—åˆ°å¤šä¸ªé‡‡æ ·é›†ï¼ŒåŸºäºæ¯ä¸ªé‡‡æ ·é›†è®­ç»ƒå‡ºä¸€ä¸ªåŸºå­¦ä¹ å™¨ï¼Œå†å°†åŸºå­¦ä¹ å™¨ç»“åˆã€‚éšæœºæ£®æ—åœ¨å¯¹å†³ç­–æ ‘è¿›è¡Œbaggingçš„åŸºç¡€ä¸Šï¼Œåœ¨å†³ç­–æ ‘çš„è®­ç»ƒè¿‡ç¨‹ä¸­å¼•å…¥äº†éšæœºå±æ€§é€‰æ‹©ã€‚ä¼ ç»Ÿå†³ç­–æ ‘åœ¨é€‰æ‹©åˆ’åˆ†å±æ€§çš„æ—¶å€™æ˜¯åœ¨å½“å‰èŠ‚ç‚¹å±æ€§é›†åˆä¸­é€‰æ‹©æœ€ä¼˜å±æ€§ï¼Œè€Œéšæœºæ£®æ—åˆ™æ˜¯å¯¹ç»“ç‚¹å…ˆéšæœºé€‰æ‹©åŒ…å«kä¸ªå±æ€§çš„å­é›†ï¼Œå†é€‰æ‹©æœ€æœ‰å±æ€§ï¼Œkä½œä¸ºä¸€ä¸ªå‚æ•°æ§åˆ¶äº†éšæœºæ€§çš„å¼•å…¥ç¨‹åº¦ã€‚\nå¦å¤–ï¼ŒGBDTè®­ç»ƒæ˜¯åŸºäºBoostingæ€æƒ³ï¼Œæ¯ä¸€è¿­ä»£ä¸­æ ¹æ®é”™è¯¯æ›´æ–°æ ·æœ¬æƒé‡ï¼Œå› æ­¤æ˜¯ä¸²è¡Œç”Ÿæˆçš„åºåˆ—åŒ–æ–¹æ³•ï¼Œè€Œéšæœºæ£®æ—æ˜¯baggingçš„æ€æƒ³ï¼Œå› æ­¤æ˜¯å¹¶è¡ŒåŒ–æ–¹æ³•ã€‚\n7. å¦‚ä½•åˆ¤æ–­å‡½æ•°å‡¸æˆ–éå‡¸ï¼Ÿä»€ä¹ˆæ˜¯å‡¸ä¼˜åŒ–ï¼Ÿ é¦–å…ˆå®šä¹‰å‡¸é›†ï¼Œå¦‚æœxï¼Œyå±äºæŸä¸ªé›†åˆCï¼Œå¹¶ä¸”æ‰€æœ‰çš„ ä¹Ÿå±äºcï¼Œé‚£ä¹ˆcä¸ºä¸€ä¸ªå‡¸é›†ï¼Œè¿›ä¸€æ­¥ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°å…¶å®šä¹‰åŸŸæ˜¯å‡¸é›†ï¼Œå¹¶ä¸”\nåˆ™è¯¥å‡½æ•°ä¸ºå‡¸å‡½æ•°ã€‚ä¸Šè¿°æ¡ä»¶è¿˜èƒ½æ¨å‡ºæ›´ä¸€èˆ¬çš„ç»“æœï¼Œ\nå¦‚æœå‡½æ•°æœ‰äºŒé˜¶å¯¼æ•°ï¼Œé‚£ä¹ˆå¦‚æœå‡½æ•°äºŒé˜¶å¯¼æ•°ä¸ºæ­£ï¼Œæˆ–è€…å¯¹äºå¤šå…ƒå‡½æ•°ï¼ŒHessiançŸ©é˜µåŠæ­£å®šåˆ™ä¸ºå‡¸å‡½æ•°ã€‚\n(ä¹Ÿå¯èƒ½å¼•åˆ°SVMï¼Œæˆ–è€…å‡¸å‡½æ•°å±€éƒ¨æœ€ä¼˜ä¹Ÿæ˜¯å…¨å±€æœ€ä¼˜çš„è¯æ˜ï¼Œæˆ–è€…ä¸Šè¿°å…¬å¼æœŸæœ›æƒ…å†µä¸‹çš„Jessenä¸ç­‰å¼)\n8. å¦‚ä½•è§£å†³ç±»åˆ«ä¸å¹³è¡¡é—®é¢˜ï¼Ÿ æœ‰äº›æƒ…å†µä¸‹è®­ç»ƒé›†ä¸­çš„æ ·æœ¬åˆ†å¸ƒå¾ˆä¸å¹³è¡¡ï¼Œä¾‹å¦‚åœ¨è‚¿ç˜¤æ£€æµ‹ç­‰é—®é¢˜ä¸­ï¼Œæ­£æ ·æœ¬çš„ä¸ªæ•°å¾€å¾€éå¸¸çš„å°‘ã€‚ä»çº¿æ€§åˆ†ç±»å™¨çš„è§’åº¦ï¼Œåœ¨ç”¨ å¯¹æ–°æ ·æœ¬è¿›è¡Œåˆ†ç±»çš„æ—¶å€™ï¼Œäº‹å®ä¸Šåœ¨ç”¨é¢„æµ‹å‡ºçš„yå€¼å’Œä¸€ä¸ªyå€¼è¿›è¡Œæ¯”è¾ƒï¼Œä¾‹å¦‚å¸¸å¸¸åœ¨y\u0026gt;0.5çš„æ—¶å€™åˆ¤ä¸ºæ­£ä¾‹ï¼Œå¦åˆ™åˆ¤ä¸ºåä¾‹ã€‚å‡ ç‡ åæ˜ äº†æ­£ä¾‹å¯èƒ½æ€§å’Œåä¾‹å¯èƒ½æ€§çš„æ¯”å€¼ï¼Œé˜ˆå€¼0.5æ°å¥½è¡¨æ˜åˆ†ç±»å™¨è®¤ä¸ºæ­£åçš„å¯èƒ½æ€§ç›¸åŒã€‚åœ¨æ ·æœ¬ä¸å‡è¡¡çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥æ˜¯åˆ†ç±»å™¨çš„é¢„æµ‹å‡ ç‡é«˜äºè§‚æµ‹å‡ ç‡å°±åˆ¤æ–­ä¸ºæ­£ä¾‹ï¼Œå› æ­¤åº”è¯¥æ˜¯ æ—¶é¢„æµ‹ä¸ºæ­£ä¾‹ï¼Œè¿™ç§ç­–ç•¥ç§°ä¸ºrebalancingã€‚ä½†æ˜¯è®­ç»ƒé›†å¹¶ä¸ä¸€å®šæ˜¯çœŸå®æ ·æœ¬æ€»ä½“çš„æ— åé‡‡æ ·ï¼Œé€šå¸¸æœ‰ä¸‰ç§åšæ³•ï¼Œä¸€ç§æ˜¯å¯¹è®­ç»ƒé›†çš„è´Ÿæ ·æœ¬è¿›è¡Œæ¬ é‡‡æ ·ï¼Œç¬¬äºŒç§æ˜¯å¯¹æ­£ä¾‹è¿›è¡Œå‡é‡‡æ ·ï¼Œç¬¬ä¸‰ç§æ˜¯ç›´æ¥åŸºäºåŸå§‹è®­ç»ƒé›†è¿›è¡Œå­¦ä¹ ï¼Œåœ¨é¢„æµ‹çš„æ—¶å€™å†æ”¹å˜é˜ˆå€¼ï¼Œç§°ä¸ºé˜ˆå€¼ç§»åŠ¨ã€‚æ³¨æ„è¿‡é‡‡æ ·ä¸€èˆ¬é€šè¿‡å¯¹è®­ç»ƒé›†çš„æ­£ä¾‹è¿›è¡Œæ’å€¼äº§ç”Ÿé¢å¤–çš„æ­£ä¾‹ï¼Œè€Œæ¬ é‡‡æ ·å°†åä¾‹åˆ’åˆ†ä¸ºä¸åŒçš„é›†åˆä¾›ä¸åŒçš„å­¦ä¹ å™¨ä½¿ç”¨ã€‚\n9. è§£é‡Šå¯¹å¶çš„æ¦‚å¿µã€‚ ä¸€ä¸ªä¼˜åŒ–é—®é¢˜å¯ä»¥ä»ä¸¤ä¸ªè§’åº¦è¿›è¡Œè€ƒå¯Ÿï¼Œä¸€ä¸ªæ˜¯primal é—®é¢˜ï¼Œä¸€ä¸ªæ˜¯dual é—®é¢˜ï¼Œå°±æ˜¯å¯¹å¶é—®é¢˜ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å¯¹å¶é—®é¢˜ç»™å‡ºä¸»é—®é¢˜æœ€ä¼˜å€¼çš„ä¸‹ç•Œï¼Œåœ¨å¼ºå¯¹å¶æ€§æˆç«‹çš„æƒ…å†µä¸‹ç”±å¯¹å¶é—®é¢˜å¯ä»¥å¾—åˆ°ä¸»é—®é¢˜çš„æœ€ä¼˜ä¸‹ç•Œï¼Œå¯¹å¶é—®é¢˜æ˜¯å‡¸ä¼˜åŒ–é—®é¢˜ï¼Œå¯ä»¥è¿›è¡Œè¾ƒå¥½çš„æ±‚è§£ï¼ŒSVMä¸­å°±æ˜¯å°†primalé—®é¢˜è½¬æ¢ä¸ºdualé—®é¢˜è¿›è¡Œæ±‚è§£ï¼Œä»è€Œè¿›ä¸€æ­¥å¼•å…¥æ ¸å‡½æ•°çš„æ€æƒ³ã€‚\n10. å¦‚ä½•è¿›è¡Œç‰¹å¾é€‰æ‹© ï¼Ÿ ç‰¹å¾é€‰æ‹©æ˜¯ä¸€ä¸ªé‡è¦çš„æ•°æ®é¢„å¤„ç†è¿‡ç¨‹ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼Œé¦–å…ˆåœ¨ç°å®ä»»åŠ¡ä¸­æˆ‘ä»¬ä¼šé‡åˆ°ç»´æ•°ç¾éš¾çš„é—®é¢˜(æ ·æœ¬å¯†åº¦éå¸¸ç¨€ç–)ï¼Œè‹¥èƒ½ä»ä¸­é€‰æ‹©ä¸€éƒ¨åˆ†ç‰¹å¾ï¼Œé‚£ä¹ˆè¿™ä¸ªé—®é¢˜èƒ½å¤§å¤§ç¼“è§£ï¼Œå¦å¤–å°±æ˜¯å»é™¤ä¸ç›¸å…³ç‰¹å¾ä¼šé™ä½å­¦ä¹ ä»»åŠ¡çš„éš¾åº¦ï¼Œå¢åŠ æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚å†—ä½™ç‰¹å¾æŒ‡è¯¥ç‰¹å¾åŒ…å«çš„ä¿¡æ¯å¯ä»¥ä»å…¶ä»–ç‰¹å¾ä¸­æ¨æ¼”å‡ºæ¥ï¼Œä½†æ˜¯è¿™å¹¶ä¸ä»£è¡¨è¯¥å†—ä½™ç‰¹å¾ä¸€å®šæ²¡æœ‰ä½œç”¨ï¼Œä¾‹å¦‚åœ¨æ¬ æ‹Ÿåˆçš„æƒ…å†µä¸‹ä¹Ÿå¯ä»¥ç”¨è¿‡åŠ å…¥å†—ä½™ç‰¹å¾ï¼Œå¢åŠ ç®€å•æ¨¡å‹çš„å¤æ‚åº¦ã€‚\nåœ¨ç†è®ºä¸Šå¦‚æœæ²¡æœ‰ä»»ä½•é¢†åŸŸçŸ¥è¯†ä½œä¸ºå…ˆéªŒå‡è®¾é‚£ä¹ˆåªèƒ½éå†æ‰€æœ‰å¯èƒ½çš„å­é›†ã€‚ä½†æ˜¯è¿™æ˜¾ç„¶æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºéœ€è¦éå†çš„æ•°é‡æ˜¯ç»„åˆçˆ†ç‚¸çš„ã€‚ä¸€èˆ¬æˆ‘ä»¬åˆ†ä¸ºå­é›†æœç´¢å’Œå­é›†è¯„ä»·ä¸¤ä¸ªè¿‡ç¨‹ï¼Œå­é›†æœç´¢ä¸€èˆ¬é‡‡ç”¨è´ªå¿ƒç®—æ³•ï¼Œæ¯ä¸€è½®ä»å€™é€‰ç‰¹å¾ä¸­æ·»åŠ æˆ–è€…åˆ é™¤ï¼Œåˆ†åˆ«æˆä¸ºå‰å‘å’Œåå…ˆæœç´¢ã€‚æˆ–è€…ä¸¤è€…ç»“åˆçš„åŒå‘æœç´¢ã€‚å­é›†è¯„ä»·ä¸€èˆ¬é‡‡ç”¨ä¿¡æ¯å¢ç›Šï¼Œå¯¹äºè¿ç»­æ•°æ®å¾€å¾€æ’åºä¹‹åé€‰æ‹©ä¸­ç‚¹ä½œä¸ºåˆ†å‰²ç‚¹ã€‚\nå¸¸è§çš„ç‰¹å¾é€‰æ‹©æ–¹å¼æœ‰è¿‡æ»¤å¼ï¼ŒåŒ…è£¹å¼å’ŒåµŒå…¥å¼ï¼Œfilterï¼Œwrapperå’Œembeddingã€‚Filterç±»å‹å…ˆå¯¹æ•°æ®é›†è¿›è¡Œç‰¹å¾é€‰æ‹©ï¼Œå†è®­ç»ƒå­¦ä¹ å™¨ã€‚Wrapperç›´æ¥æŠŠæœ€ç»ˆå­¦ä¹ å™¨çš„æ€§èƒ½ä½œä¸ºç‰¹å¾å­é›†çš„è¯„ä»·å‡†åˆ™ï¼Œä¸€èˆ¬é€šè¿‡ä¸æ–­å€™é€‰å­é›†ï¼Œç„¶ååˆ©ç”¨cross-validationè¿‡ç¨‹æ›´æ–°å€™é€‰ç‰¹å¾ï¼Œé€šå¸¸è®¡ç®—é‡æ¯”è¾ƒå¤§ã€‚åµŒå…¥å¼ç‰¹å¾é€‰æ‹©å°†ç‰¹å¾é€‰æ‹©è¿‡ç¨‹å’Œè®­ç»ƒè¿‡ç¨‹èä¸ºäº†ä¸€ä½“ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è‡ªåŠ¨è¿›è¡Œäº†ç‰¹å¾é€‰æ‹©ï¼Œä¾‹å¦‚L1æ­£åˆ™åŒ–æ›´æ˜“äºè·å¾—ç¨€ç–è§£ï¼Œè€ŒL2æ­£åˆ™åŒ–æ›´ä¸å®¹æ˜“è¿‡æ‹Ÿåˆã€‚L1æ­£åˆ™åŒ–å¯ä»¥é€šè¿‡PGDï¼Œè¿‘ç«¯æ¢¯åº¦ä¸‹é™è¿›è¡Œæ±‚è§£ã€‚\n11. ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿‡æ‹Ÿåˆï¼Œæœ‰å“ªäº›æ–¹æ³•å¯ä»¥é¢„é˜²æˆ–å…‹æœè¿‡æ‹Ÿåˆï¼Ÿ ä¸€èˆ¬åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œå°†å­¦ä¹ å™¨åœ¨è®­ç»ƒé›†ä¸Šçš„è¯¯å·®ç§°ä¸ºè®­ç»ƒè¯¯å·®æˆ–è€…ç»éªŒè¯¯å·®ï¼Œåœ¨æ–°æ ·æœ¬ä¸Šçš„è¯¯å·®ç§°ä¸ºæ³›åŒ–è¯¯å·®ã€‚æ˜¾ç„¶æˆ‘ä»¬å¸Œæœ›å¾—åˆ°æ³›åŒ–è¯¯å·®å°çš„å­¦ä¹ å™¨ï¼Œä½†æ˜¯æˆ‘ä»¬äº‹å…ˆå¹¶ä¸çŸ¥é“æ–°æ ·æœ¬ï¼Œå› æ­¤å®é™…ä¸Šå¾€å¾€åŠªåŠ›ä½¿ç»éªŒè¯¯å·®æœ€å°åŒ–ã€‚ç„¶è€Œï¼Œå½“å­¦ä¹ å™¨å°†è®­ç»ƒæ ·æœ¬å­¦çš„å¤ªå¥½çš„æ—¶å€™ï¼Œå¾€å¾€å¯èƒ½æŠŠè®­ç»ƒæ ·æœ¬è‡ªèº«çš„ç‰¹ç‚¹å½“åšäº†æ½œåœ¨æ ·æœ¬å…·æœ‰çš„ä¸€èˆ¬æ€§è´¨ã€‚è¿™æ ·å°±ä¼šå¯¼è‡´æ³›åŒ–æ€§èƒ½ä¸‹é™ï¼Œç§°ä¹‹ä¸ºè¿‡æ‹Ÿåˆï¼Œç›¸åï¼Œæ¬ æ‹Ÿåˆä¸€èˆ¬æŒ‡å¯¹è®­ç»ƒæ ·æœ¬çš„ä¸€èˆ¬æ€§è´¨å°šæœªå­¦ä¹ å¥½ï¼Œåœ¨è®­ç»ƒé›†ä¸Šä»ç„¶æœ‰è¾ƒå¤§çš„è¯¯å·®ã€‚","title":"æœºå™¨å­¦ä¹ é¢è¯•é¢˜"},{"content":"æ­£åˆ™åŒ–ä¹Ÿæ˜¯æ ¡æ‹›ä¸­å¸¸è€ƒçš„é¢˜ç›®ä¹‹ä¸€ï¼Œåœ¨å»å¹´çš„æ ¡æ‹›ä¸­ï¼Œè¢«é—®åˆ°äº†å¤šæ¬¡ï¼š\n1ã€è¿‡æ‹Ÿåˆçš„è§£å†³æ–¹å¼æœ‰å“ªäº›ï¼Œl1å’Œl2æ­£åˆ™åŒ–éƒ½æœ‰å“ªäº›ä¸åŒï¼Œå„è‡ªæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹(çˆ±å¥‡è‰º) 2ã€L1å’ŒL2æ­£åˆ™åŒ–æ¥é¿å…è¿‡æ‹Ÿåˆæ˜¯å¤§å®¶éƒ½çŸ¥é“çš„äº‹æƒ…ï¼Œè€Œä¸”æˆ‘ä»¬éƒ½çŸ¥é“L1æ­£åˆ™åŒ–å¯ä»¥å¾—åˆ°ç¨€ç–è§£ï¼ŒL2æ­£åˆ™åŒ–å¯ä»¥å¾—åˆ°å¹³æ»‘è§£ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ 3ã€L1å’ŒL2æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»æ•°å­¦è§’åº¦è§£é‡ŠL2ä¸ºä»€ä¹ˆèƒ½æå‡æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚ï¼ˆç¾å›¢ï¼‰ 4ã€L1å’ŒL2çš„åŒºåˆ«ï¼Œä»¥åŠå„è‡ªçš„ä½¿ç”¨åœºæ™¯ï¼ˆå¤´æ¡ï¼‰\næ¥ä¸‹æ¥ï¼Œå’±ä»¬å°±é’ˆå¯¹ä¸Šé¢çš„å‡ ä¸ªé—®é¢˜ï¼Œè¿›è¡Œé’ˆå¯¹æ€§å›ç­”ï¼\nLink: https://mp.weixin.qq.com/s/t4vRBZXhc0LBST8WGzftgg\n","permalink":"https://reid00.github.io/en/posts/ml/%E6%9C%80%E5%B8%B8%E8%80%83%E7%9A%84%E6%AD%A3%E5%88%99%E9%97%AE%E9%A2%98l1l2/","summary":"æ­£åˆ™åŒ–ä¹Ÿæ˜¯æ ¡æ‹›ä¸­å¸¸è€ƒçš„é¢˜ç›®ä¹‹ä¸€ï¼Œåœ¨å»å¹´çš„æ ¡æ‹›ä¸­ï¼Œè¢«é—®åˆ°äº†å¤šæ¬¡ï¼š\n1ã€è¿‡æ‹Ÿåˆçš„è§£å†³æ–¹å¼æœ‰å“ªäº›ï¼Œl1å’Œl2æ­£åˆ™åŒ–éƒ½æœ‰å“ªäº›ä¸åŒï¼Œå„è‡ªæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹(çˆ±å¥‡è‰º) 2ã€L1å’ŒL2æ­£åˆ™åŒ–æ¥é¿å…è¿‡æ‹Ÿåˆæ˜¯å¤§å®¶éƒ½çŸ¥é“çš„äº‹æƒ…ï¼Œè€Œä¸”æˆ‘ä»¬éƒ½çŸ¥é“L1æ­£åˆ™åŒ–å¯ä»¥å¾—åˆ°ç¨€ç–è§£ï¼ŒL2æ­£åˆ™åŒ–å¯ä»¥å¾—åˆ°å¹³æ»‘è§£ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ 3ã€L1å’ŒL2æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä»æ•°å­¦è§’åº¦è§£é‡ŠL2ä¸ºä»€ä¹ˆèƒ½æå‡æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚ï¼ˆç¾å›¢ï¼‰ 4ã€L1å’ŒL2çš„åŒºåˆ«ï¼Œä»¥åŠå„è‡ªçš„ä½¿ç”¨åœºæ™¯ï¼ˆå¤´æ¡ï¼‰\næ¥ä¸‹æ¥ï¼Œå’±ä»¬å°±é’ˆå¯¹ä¸Šé¢çš„å‡ ä¸ªé—®é¢˜ï¼Œè¿›è¡Œé’ˆå¯¹æ€§å›ç­”ï¼\nLink: https://mp.weixin.qq.com/s/t4vRBZXhc0LBST8WGzftgg","title":"æœ€å¸¸è€ƒçš„æ­£åˆ™é—®é¢˜L1L2"},{"content":"è´å¶æ–¯å‡†å¤‡çŸ¥è¯† è´å¶æ–¯å†³ç­–è®ºæ˜¯æ¦‚ç‡æ¡†æ¶ä¸‹å®æ–½å†³ç­–çš„åŸºæœ¬æ–¹æ³•ã€‚è¦äº†è§£è´å¶æ–¯å†³ç­–è®ºï¼Œé¦–å…ˆå¾—å…ˆäº†è§£ä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µï¼šå…ˆéªŒæ¦‚ç‡ã€æ¡ä»¶æ¦‚ç‡ã€åéªŒæ¦‚ç‡ã€è¯¯åˆ¤æŸå¤±ã€æ¡ä»¶é£é™©ã€è´å¶æ–¯åˆ¤åˆ«å‡†åˆ™\nå…ˆéªŒæ¦‚ç‡ï¼š æ‰€è°“å…ˆéªŒæ¦‚ç‡ï¼Œå°±æ˜¯æ ¹æ®ä»¥å¾€çš„ç»éªŒæˆ–è€…ç°æœ‰æ•°æ®çš„åˆ†ææ‰€å¾—åˆ°çš„æ¦‚ç‡ã€‚å¦‚ï¼Œéšæœºæ‰”ä¸€æšç¡¬å¸ï¼Œåˆ™p(æ­£é¢) = p(åé¢) = 1/2ï¼Œè¿™æ˜¯æˆ‘ä»¬æ ¹æ®å·²çŸ¥çš„çŸ¥è¯†æ‰€çŸ¥é“çš„ä¿¡æ¯ï¼Œå³p(æ­£é¢) = 1/2ä¸ºå…ˆéªŒæ¦‚ç‡ã€‚\næ¡ä»¶æ¦‚ç‡ï¼š æ‰€è°“æ¡ä»¶æ¦‚ç‡æ˜¯æŒ‡äº‹ä»¶Aåœ¨å¦ä¸€äº‹ä»¶Bå‘ç”Ÿçš„æ¡ä»¶ä¸‹å‘é€çš„æ¦‚ç‡ã€‚ç”¨æ•°å­¦ç¬¦å·è¡¨ç¤ºä¸ºï¼šP(B\\|A)ï¼Œå³Båœ¨Aå‘ç”Ÿçš„æ¡ä»¶ä¸‹å‘ç”Ÿçš„æ¦‚ç‡ã€‚ä¸¾ä¸ªæ —å­ï¼Œä½ æ—©ä¸Šè¯¯å–äº†ä¸€ç“¶è¿‡æœŸäº†çš„ç‰›å¥¶ï¼ˆAï¼‰ï¼Œé‚£æˆ‘ä»¬æ¥ç®—ä¸€ä¸‹ä½ ä»Šå¤©æ‹‰è‚šå­çš„æ¦‚ç‡ï¼ˆBï¼‰ï¼Œè¿™ä¸ªå°±å«åšæ¡ä»¶æ¦‚ç‡ã€‚å³Pï¼ˆæ‹‰è‚šå­\\|å–äº†è¿‡æœŸç‰›å¥¶ï¼‰ï¼Œ æ˜“è§ï¼Œæ¡ä»¶æ¦‚ç‡æ˜¯æœ‰å› æ±‚æœï¼ˆçŸ¥é“åŸå› æ¨æµ‹ç»“æœï¼‰ã€‚\nåéªŒæ¦‚ç‡ï¼š åéªŒæ¦‚ç‡è·Ÿæ¡ä»¶æ¦‚ç‡çš„è¡¨è¾¾å½¢å¼æœ‰ç‚¹ç›¸ä¼¼ã€‚æ•°å­¦è¡¨è¾¾å¼ä¸ºp(A\\|B), å³Aåœ¨Bå‘ç”Ÿçš„æ¡ä»¶ä¸‹å‘ç”Ÿçš„æ¦‚ç‡ã€‚ä»¥è¯¯å–ç‰›å¥¶çš„ä¾‹å­ä¸ºä¾‹ï¼Œç°åœ¨çŸ¥é“äº†ä½ ä»Šå¤©æ‹‰è‚šå­äº†ï¼ˆBï¼‰ï¼Œç®—ä¸€ä¸‹ä½ æ—©ä¸Šè¯¯å–äº†ä¸€ç“¶è¿‡æœŸäº†çš„ç‰›å¥¶(A)çš„æ¦‚ç‡, å³Pï¼ˆA|Bï¼‰ï¼Œè¿™å°±æ˜¯åéªŒæ¦‚ç‡ï¼ŒåéªŒæ¦‚ç‡æ˜¯æœ‰æœæ±‚å› ï¼ˆçŸ¥é“ç»“æœæ¨å‡ºåŸå› ï¼‰\nè¯¯åˆ¤æŸå¤±ï¼š æ•°å­¦è¡¨è¾¾å¼ï¼šL(j|i)ï¼Œ åˆ¤åˆ«æŸå¤±è¡¨ç¤ºæŠŠä¸€ä¸ªæ ‡è®°ä¸ºiç±»çš„æ ·æœ¬è¯¯åˆ†ç±»ä¸ºjç±»æ‰€é€ æˆçš„æŸå¤±ã€‚ æ¯”å¦‚ï¼Œå½“ä½ å»å‚åŠ ä½“æ£€æ—¶ï¼Œæ˜æ˜ä½ å„é¡¹æŒ‡æ ‡éƒ½æ˜¯æ­£å¸¸çš„ï¼Œä½†æ˜¯åŒ»ç”Ÿå´æŠŠä½ åˆ†ä¸ºç™Œç—‡ç—…äººï¼Œè¿™å°±é€ æˆäº†è¯¯åˆ¤æŸå¤±ï¼Œç”¨æ•°å­¦è¡¨ç¤ºä¸ºï¼šL(ç™Œç—‡|æ­£å¸¸)ã€‚\næ¡ä»¶é£é™©ï¼š æ˜¯æŒ‡åŸºäºåéªŒæ¦‚ç‡P(i|x)å¯è·å¾—å°†æ ·æœ¬xåˆ†ç±»ä¸ºiæ‰€äº§ç”Ÿçš„æœŸæœ›æŸå¤±ï¼Œå…¬å¼ä¸ºï¼šR(i|x) = âˆ‘L(i|j)P(j|x)ã€‚(å…¶å®å°±æ˜¯æ‰€æœ‰åˆ¤åˆ«æŸå¤±çš„åŠ æƒå’Œï¼Œè€Œè¿™ä¸ªæƒå°±æ˜¯æ ·æœ¬åˆ¤ä¸ºjç±»çš„æ¦‚ç‡ï¼Œæ ·æœ¬æœ¬æ¥åº”è¯¥å«æœ‰P(j|x)çš„æ¦‚ç‡åˆ¤ä¸ºjç±»ï¼Œä½†æ˜¯å´åˆ¤ä¸ºäº†iç±»ï¼Œè¿™å°±é€ æˆäº†é”™åˆ¤æŸå¤±ï¼Œè€Œå°†æ‰€æœ‰çš„é”™åˆ¤æŸå¤±ä¸æ­£ç¡®åˆ¤æ–­çš„æ¦‚ç‡çš„ä¹˜ç§¯ç›¸åŠ ï¼Œå°±èƒ½å¾—åˆ°æ ·æœ¬é”™åˆ¤ä¸ºiç±»çš„å¹³å‡æŸå¤±ï¼Œå³æ¡ä»¶é£é™©ã€‚)\nä¸¾ä¸ªæ —å­ï¼Œå‡è®¾æŠŠç™Œç—‡ç—…äººåˆ¤ä¸ºæ­£å¸¸äººçš„è¯¯åˆ¤æŸå¤±æ˜¯100ï¼ŒæŠŠæ­£å¸¸äººåˆ¤ä¸ºç™Œç—‡ç—…äººçš„è¯¯åˆ¤æŸå¤±æ˜¯10ï¼ŒæŠŠæ„Ÿå†’ç—…äººåˆ¤ä¸ºç™Œç—‡çš„è¯¯åˆ¤æŸå¤±æ˜¯8ï¼Œå³Lï¼ˆæ­£å¸¸|ç™Œç—‡ï¼‰ = 100ï¼Œ Lï¼ˆç™Œç—‡|æ­£å¸¸ï¼‰ = 10ï¼ŒL(ç™Œç—‡|æ„Ÿå†’) = 8ï¼Œ ç°åœ¨ï¼Œæˆ‘ä»¬ç»è¿‡è®¡ç®—çŸ¥é“æœ‰ä¸€ä¸ªæ¥ä½“æ£€çš„å‘˜å·¥çš„åéªŒæ¦‚ç‡åˆ†åˆ«ä¸ºï¼šp(æ­£å¸¸|å„é¡¹æŒ‡æ ‡) = 0.2ï¼Œ p(æ„Ÿå†’|å„é¡¹æŒ‡æ ‡) = 0.4, pï¼ˆ ç™Œç—‡|å„é¡¹æŒ‡æ ‡)=0.4ã€‚å‡å¦‚æˆ‘ä»¬éœ€è¦è®¡ç®—å°†è¿™ä¸ªå‘˜å·¥åˆ¤ä¸ºç™Œç—‡çš„æ¡ä»¶é£é™©ï¼Œåˆ™ï¼šRï¼ˆç™Œç—‡|å„é¡¹æŒ‡æ ‡ï¼‰ = Lï¼ˆç™Œç—‡|æ­£å¸¸ï¼‰ p(æ­£å¸¸|å„é¡¹æŒ‡æ ‡) + L(ç™Œç—‡|æ„Ÿå†’) * p(æ„Ÿå†’|å„é¡¹æŒ‡æ ‡) = 5.2ã€‚*\nè´å¶æ–¯åˆ¤åˆ«å‡†åˆ™ï¼š\nè´å¶æ–¯åˆ¤åˆ«å‡†åˆ™æ˜¯æ‰¾åˆ°ä¸€ä¸ªä½¿æ¡ä»¶é£é™©è¾¾åˆ°æœ€å°çš„åˆ¤åˆ«æ–¹æ³•ã€‚å³ï¼Œå°†æ ·æœ¬åˆ¤ä¸ºå“ªä¸€ç±»ï¼Œæ‰€å¾—åˆ°çš„æ¡ä»¶é£é™©R(i|x)ï¼ˆæˆ–è€…è¯´å¹³å‡åˆ¤åˆ«æŸå¤±ï¼‰æœ€å°ï¼Œé‚£å°±å°†æ ·æœ¬å½’ä¸ºé‚£ä¸ªé€ æˆå¹³å‡åˆ¤åˆ«æŸå¤±æœ€å°çš„ç±»ã€‚\næ­¤æ—¶ï¼šh*(x) = argminR(i|x) å°±ç§°ä¸º è´å¶æ–¯æœ€ä¼˜åˆ†ç±»å™¨ã€‚\næ€»ç»“ï¼šè´å¶æ–¯å†³ç­–è®ºæ˜¯åŸºäºå…ˆéªŒæ¦‚ç‡æ±‚è§£åéªŒæ¦‚ç‡çš„æ–¹æ³•ï¼Œå…¶æ ¸å¿ƒæ˜¯å¯»æ‰¾ä¸€ä¸ªåˆ¤åˆ«å‡†åˆ™ä½¿å¾—æ¡ä»¶é£é™©è¾¾åˆ°æœ€å°ã€‚è€Œåœ¨æœ€å°åŒ–åˆ†ç±»é”™è¯¯ç‡çš„ç›®æ ‡ä¸‹ï¼Œè´å¶æ–¯æœ€ä¼˜åˆ†ç±»å™¨åˆå¯ä»¥è½¬åŒ–ä¸ºæ±‚åéªŒæ¦‚ç‡è¾¾åˆ°æœ€å¤§çš„ç±»åˆ«æ ‡è®°ï¼Œå³ h*ï¼ˆx) = argmaxP(i|x)ã€‚ï¼ˆæ­¤æ—¶ï¼ŒL(i|j) = 0, if i = j;L(i|j) = 1, otherwise)\nç®€å•è¯´è¯´æœ´ç´ è´å¶æ–¯ æœ´ç´ è´å¶æ–¯é‡‡ç”¨ å±æ€§æ¡ä»¶ç‹¬ç«‹æ€§ çš„å‡è®¾ï¼Œå¯¹äºç»™å®šçš„å¾…åˆ†ç±»è§‚æµ‹æ•°æ®X,è®¡ç®—åœ¨Xå‡ºç°çš„æ¡ä»¶ä¸‹ï¼Œå„ä¸ªç›®æ ‡ç±»å‡ºç°çš„æ¦‚ç‡ï¼ˆå³åéªŒæ¦‚ç‡ï¼‰ï¼Œå°†è¯¥åéªŒæ¦‚ç‡æœ€å¤§çš„ç±»ä½œä¸ºXæ‰€å±çš„ç±»ã€‚è€Œè®¡ç®—åéªŒæ¦‚ç‡çš„è´å¶æ–¯å…¬å¼ä¸ºï¼šp(A|B) =[ p(A) * p(B|A)]/p(B),å› ä¸ºp(B)è¡¨ç¤ºè§‚æµ‹æ•°æ®Xå‡ºç°çš„æ¦‚ç‡ï¼Œå®ƒåœ¨æ‰€æœ‰å…³äºXçš„åˆ†ç±»è®¡ç®—å…¬å¼ä¸­éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠp(B)å¿½ç•¥ï¼Œåˆ™ p(A|B)= p(A) * p(B|A)ã€‚\nä¸¾ä¸ªæ —å­ï¼Œå…¬å¸é‡Œé¢ç”·æ€§æœ‰60äººï¼Œå¥³æ€§æœ‰40äººï¼Œç”·æ€§ç©¿çš®é‹çš„äººæ•°æœ‰25äººï¼Œç©¿è¿åŠ¨é‹çš„äººæ•°æœ‰35äººï¼Œå¥³æ€§ç©¿çš®é‹çš„äººæ•°æœ‰10äººï¼Œç©¿é«˜è·Ÿé‹çš„äººæ•°æœ‰30äººã€‚ç°åœ¨ä½ åªçŸ¥é“æœ‰ä¸€ä¸ªäººç©¿äº†çš®é‹ï¼Œè¿™æ—¶å€™ä½ å°±éœ€è¦æ¨æµ‹ä»–çš„æ€§åˆ«æ˜¯ä»€ä¹ˆã€‚å¦‚æœæ¨æµ‹å‡ºä»–æ˜¯ç”·æ€§çš„æ¦‚ç‡å¤§äºå¥³æ€§ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºä»–æ˜¯ç”·æ€§ï¼Œå¦åˆ™è®¤ä¸ºä»–æ˜¯å¥³æ€§ã€‚ï¼ˆå¦‚æœæ­¤æ—¶æ¡ä»¶å…è®¸ï¼Œä½ å¯ä»¥ç°åœºç»™é¢è¯•å®˜æ¼”ç¤ºä¸€ä¸‹æ€ä¹ˆè®¡ç®—ï¼Œ è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š\n1 p(æ€§åˆ« = ç”·æ€§) = 0.6p(æ€§åˆ« = å¥³æ€§) = 0.4p(ç©¿çš®é‹\\|ç”·æ€§) = 0.417p(ç©¿çš®é‹\\|å¥³æ€§) = 0.25p(ç©¿çš®é‹\\|ç”·æ€§) * p(æ€§åˆ« = ç”·æ€§) = 0.2502p(ç©¿çš®é‹\\|å¥³æ€§) * p(æ€§åˆ« = å¥³æ€§) = 0.1 æœ´ç´ è´å¶æ–¯ä¸­çš„æœ´ç´ æ€ä¹ˆç†è§£ ç´ è´å¶æ–¯ä¸­çš„æœ´ç´ å¯ä»¥ç†è§£ä¸ºæ˜¯â€œç®€å•ã€å¤©çœŸâ€çš„æ„æ€ï¼Œå› ä¸ºâ€œæœ´ç´ â€æ˜¯å‡è®¾äº†ç‰¹å¾ä¹‹é—´æ˜¯åŒç­‰é‡è¦ã€ç›¸äº’ç‹¬ç«‹ã€äº’ä¸å½±å“çš„ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„ç°å®ç¤¾ä¼šä¸­ï¼Œå±æ€§ä¹‹é—´å¹¶ä¸æ˜¯éƒ½æ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼Œæœ‰äº›å±æ€§ä¹Ÿä¼šå­˜åœ¨æ€§ï¼Œæ‰€ä»¥è¯´æœ´ç´ è´å¶æ–¯æ˜¯ä¸€ç§å¾ˆâ€œæœ´ç´ â€çš„ç®—æ³•ã€‚\nç´ è´å¶æ–¯çš„å·¥ä½œæµç¨‹ å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µè¿›è¡Œï¼Œåˆ†åˆ«æ˜¯å‡†å¤‡é˜¶æ®µã€åˆ†ç±»å™¨è®­ç»ƒé˜¶æ®µå’Œåº”ç”¨é˜¶æ®µã€‚\n**å‡†å¤‡é˜¶æ®µï¼š**è¿™ä¸ªé˜¶æ®µçš„ä»»åŠ¡æ˜¯ä¸ºæœ´ç´ è´å¶æ–¯åˆ†ç±»åšå¿…è¦çš„å‡†å¤‡ï¼Œä¸»è¦å·¥ä½œæ˜¯æ ¹æ®å…·ä½“æƒ…å†µç¡®å®šç‰¹å¾å±æ€§ï¼Œå¹¶å¯¹æ¯ä¸ªç‰¹å¾å±æ€§è¿›è¡Œé€‚å½“åˆ’åˆ†ï¼Œå»é™¤é«˜åº¦ç›¸å…³æ€§çš„å±æ€§(å¦‚æœä¸¤ä¸ªå±æ€§å…·æœ‰é«˜åº¦ç›¸å…³æ€§çš„è¯ï¼Œé‚£ä¹ˆè¯¥å±æ€§å°†ä¼šåœ¨æ¨¡å‹ä¸­å‘æŒ¥äº†2æ¬¡ä½œç”¨ï¼Œä¼šä½¿å¾—æœ´ç´ è´å¶æ–¯æ‰€é¢„æµ‹çš„ç»“æœå‘è¯¥å±æ€§æ‰€å¸Œæœ›çš„æ–¹å‘åç¦»ï¼Œå¯¼è‡´åˆ†ç±»å‡ºç°åå·®)ï¼Œç„¶åç”±äººå·¥å¯¹ä¸€éƒ¨åˆ†å¾…åˆ†ç±»é¡¹è¿›è¡Œåˆ†ç±»ï¼Œå½¢æˆè®­ç»ƒæ ·æœ¬é›†åˆã€‚è¿™ä¸€é˜¶æ®µçš„è¾“å…¥æ˜¯æ‰€æœ‰å¾…åˆ†ç±»æ•°æ®ï¼Œè¾“å‡ºæ˜¯ç‰¹å¾å±æ€§å’Œè®­ç»ƒæ ·æœ¬ã€‚(è¿™ä¸€é˜¶æ®µæ˜¯æ•´ä¸ªæœ´ç´ è´å¶æ–¯åˆ†ç±»ä¸­å”¯ä¸€éœ€è¦äººå·¥å®Œæˆçš„é˜¶æ®µï¼Œå…¶è´¨é‡å¯¹æ•´ä¸ªè¿‡ç¨‹å°†æœ‰é‡è¦å½±å“ã€‚ï¼‰\nåˆ†ç±»å™¨è®­ç»ƒé˜¶æ®µï¼šè¿™ä¸ªé˜¶æ®µçš„ä»»åŠ¡å°±æ˜¯ç”Ÿæˆåˆ†ç±»å™¨ï¼Œä¸»è¦å·¥ä½œæ˜¯è®¡ç®—æ¯ä¸ªç±»åˆ«åœ¨è®­ç»ƒæ ·æœ¬ä¸­çš„å‡ºç°é¢‘ç‡åŠæ¯ä¸ªç‰¹å¾å±æ€§åˆ’åˆ†å¯¹æ¯ä¸ªç±»åˆ«çš„æ¡ä»¶æ¦‚ç‡ä¼°è®¡ï¼Œå¹¶å°†ç»“æœè®°å½•ã€‚å…¶è¾“å…¥æ˜¯ç‰¹å¾å±æ€§å’Œè®­ç»ƒæ ·æœ¬ï¼Œè¾“å‡ºæ˜¯åˆ†ç±»å™¨ã€‚è¿™ä¸€é˜¶æ®µæ˜¯æœºæ¢°æ€§é˜¶æ®µï¼Œæ ¹æ®å‰é¢è®¨è®ºçš„å…¬å¼å¯ä»¥ç”±ç¨‹åºè‡ªåŠ¨è®¡ç®—å®Œæˆã€‚\n**åº”ç”¨é˜¶æ®µï¼š**è¿™ä¸ªé˜¶æ®µçš„ä»»åŠ¡æ˜¯ä½¿ç”¨åˆ†ç±»å™¨å¯¹å¾…åˆ†ç±»é¡¹è¿›è¡Œåˆ†ç±»ï¼Œå…¶è¾“å…¥æ˜¯åˆ†ç±»å™¨å’Œå¾…åˆ†ç±»é¡¹ï¼Œè¾“å‡ºæ˜¯å¾…åˆ†ç±»é¡¹ä¸ç±»åˆ«çš„æ˜ å°„å…³ç³»ã€‚è¿™ä¸€é˜¶æ®µä¹Ÿæ˜¯æœºæ¢°æ€§é˜¶æ®µï¼Œç”±ç¨‹åºå®Œæˆã€‚\næœ´ç´ è´å¶æ–¯æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ æœ´ç´ è´å¶æ–¯æ¨¡å‹å‘æºäºå¤å…¸æ•°å­¦ç†è®ºï¼Œæœ‰ç¨³å®šçš„åˆ†ç±»æ•ˆç‡ã€‚\nå¯¹ç¼ºå¤±æ•°æ®ä¸å¤ªæ•æ„Ÿï¼Œç®—æ³•ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå¸¸ç”¨äºæ–‡æœ¬åˆ†ç±»ã€‚\nåˆ†ç±»å‡†ç¡®åº¦é«˜ï¼Œé€Ÿåº¦å¿«ã€‚\nå¯¹å°è§„æ¨¡çš„æ•°æ®è¡¨ç°å¾ˆå¥½ï¼Œèƒ½å¤„ç†å¤šåˆ†ç±»ä»»åŠ¡ï¼Œé€‚åˆå¢é‡å¼è®­ç»ƒï¼Œå½“æ•°æ®é‡è¶…å‡ºå†…å­˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ‰¹æ‰¹çš„å»å¢é‡è®­ç»ƒ(æœ´ç´ è´å¶æ–¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­åªéœ€è¦è®¡ç®—å„ä¸ªç±»çš„æ¦‚ç‡å’Œå„ä¸ªå±æ€§çš„ç±»æ¡ä»¶æ¦‚ç‡ï¼Œè¿™äº›æ¦‚ç‡å€¼å¯ä»¥å¿«é€Ÿåœ°æ ¹æ®å¢é‡æ•°æ®è¿›è¡Œæ›´æ–°ï¼Œæ— éœ€é‡æ–°å…¨é‡è®¡ç®—)ã€‚\nç¼ºç‚¹ å¯¹è®­ç»ƒæ•°æ®çš„ä¾èµ–æ€§å¾ˆå¼ºï¼Œå¦‚æœè®­ç»ƒæ•°æ®è¯¯å·®è¾ƒå¤§ï¼Œé‚£ä¹ˆé¢„æµ‹å‡ºæ¥çš„æ•ˆæœå°±ä¼šä¸ä½³ã€‚å¯¹è¾“å…¥æ•°æ®çš„è¡¨è¾¾å½¢å¼å¾ˆæ•æ„Ÿï¼ˆç¦»æ•£ã€è¿ç»­ï¼Œå€¼æå¤§æå°ä¹‹ç±»çš„ï¼‰\nç†è®ºä¸Šï¼Œæœ´ç´ è´å¶æ–¯æ¨¡å‹ä¸å…¶ä»–åˆ†ç±»æ–¹æ³•ç›¸æ¯”å…·æœ‰æœ€å°çš„è¯¯å·®ç‡ã€‚\nä½†æ˜¯åœ¨å®é™…ä¸­ï¼Œå› ä¸ºæœ´ç´ è´å¶æ–¯â€œæœ´ç´ ï¼Œâ€çš„ç‰¹ç‚¹ï¼Œå¯¼è‡´åœ¨å±æ€§ä¸ªæ•°æ¯”è¾ƒå¤šæˆ–è€…å±æ€§ä¹‹é—´ç›¸å…³æ€§è¾ƒå¤§æ—¶ï¼Œåˆ†ç±»æ•ˆæœä¸å¥½ã€‚\nè€Œåœ¨å±æ€§ç›¸å…³æ€§è¾ƒå°æ—¶ï¼Œæœ´ç´ è´å¶æ–¯æ€§èƒ½æœ€ä¸ºè‰¯å¥½ã€‚\nå¯¹äºè¿™ä¸€ç‚¹ï¼Œæœ‰åŠæœ´ç´ è´å¶æ–¯ä¹‹ç±»çš„ç®—æ³•é€šè¿‡è€ƒè™‘éƒ¨åˆ†å…³è”æ€§é€‚åº¦æ”¹è¿›ã€‚\néœ€è¦çŸ¥é“å…ˆéªŒæ¦‚ç‡ï¼Œä¸”å…ˆéªŒæ¦‚ç‡å¾ˆå¤šæ—¶å€™æ˜¯åŸºäºå‡è®¾æˆ–è€…å·²æœ‰çš„è®­ç»ƒæ•°æ®æ‰€å¾—çš„ï¼Œè¿™åœ¨æŸäº›æ—¶å€™å¯èƒ½ä¼šå› ä¸ºå‡è®¾å…ˆéªŒæ¦‚ç‡çš„åŸå› å‡ºç°åˆ†ç±»å†³ç­–ä¸Šçš„é”™è¯¯ã€‚\nâ€œæœ´ç´ â€æ˜¯æœ´ç´ è´å¶æ–¯åœ¨è¿›è¡Œé¢„æµ‹æ—¶å€™çš„ç¼ºç‚¹ï¼Œé‚£ä¹ˆæœ‰è¿™ä¹ˆä¸€ä¸ªæ˜æ˜¾çš„å‡è®¾ç¼ºç‚¹åœ¨ï¼Œä¸ºä»€ä¹ˆæœ´ç´ è´å¶æ–¯çš„é¢„æµ‹ä»ç„¶å¯ä»¥å–å¾—è¾ƒå¥½çš„æ•ˆæœï¼Ÿ å¯¹äºåˆ†ç±»ä»»åŠ¡æ¥è¯´ï¼Œåªè¦å„ä¸ªæ¡ä»¶æ¦‚ç‡ä¹‹é—´çš„æ’åºæ­£ç¡®ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡æ¯”è¾ƒæ¦‚ç‡å¤§å°æ¥è¿›è¡Œåˆ†ç±»ï¼Œä¸éœ€è¦çŸ¥é“ç²¾ç¡®çš„æ¦‚ç‡å€¼(æœ´ç´ è´å¶æ–¯åˆ†ç±»çš„æ ¸å¿ƒæ€æƒ³æ˜¯æ‰¾å‡ºåéªŒæ¦‚ç‡æœ€å¤§çš„é‚£ä¸ªç±»ï¼Œè€Œä¸æ˜¯æ±‚å‡ºå…¶ç²¾ç¡®çš„æ¦‚ç‡) å¦‚æœå±æ€§ä¹‹é—´çš„ç›¸äº’ä¾èµ–å¯¹æ‰€æœ‰ç±»åˆ«çš„å½±å“ç›¸åŒï¼Œæˆ–è€…ç›¸äº’ä¾èµ–å…³ç³»å¯ä»¥äº’ç›¸æŠµæ¶ˆï¼Œé‚£ä¹ˆå±æ€§æ¡ä»¶ç‹¬ç«‹æ€§çš„å‡è®¾åœ¨é™ä½è®¡ç®—å¼€é”€çš„åŒæ—¶ä¸ä¼šå¯¹åˆ†ç±»ç»“æœäº§ç”Ÿä¸è‰¯å½±å“ã€‚ ä»€ä¹ˆæ˜¯æ‹‰æ™®æ‹‰æ–¯å¹³æ»‘æ³•? åœ¨ä¼°è®¡æ¡ä»¶æ¦‚ç‡P(X|Y)æ—¶å‡ºç°æ¦‚ç‡ä¸º0çš„æƒ…å†µæ€ä¹ˆåŠï¼Ÿ\nç®€å•æ¥è¯´ï¼šå¼•å…¥Î»ï¼Œå½“Î»=1æ—¶ç§°ä¸ºæ‹‰æ™®æ‹‰æ–¯å¹³æ»‘ã€‚\næ‹‰æ™®æ‹‰æ–¯å¹³æ»‘æ³•æ˜¯æœ´ç´ è´å¶æ–¯ä¸­å¤„ç†é›¶æ¦‚ç‡é—®é¢˜çš„ä¸€ç§ä¿®æ­£æ–¹å¼ã€‚åœ¨è¿›è¡Œåˆ†ç±»çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°æŸä¸ªå±æ€§åœ¨è®­ç»ƒé›†ä¸­æ²¡æœ‰ä¸æŸä¸ªç±»åŒæ—¶å‡ºç°è¿‡çš„æƒ…å†µï¼Œå¦‚æœç›´æ¥åŸºäºæœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨çš„è¡¨è¾¾å¼è¿›è¡Œè®¡ç®—çš„è¯å°±ä¼šå‡ºç°é›¶æ¦‚ç‡ç°è±¡ã€‚ä¸ºäº†é¿å…å…¶ä»–å±æ€§æ‰€æºå¸¦çš„ä¿¡æ¯è¢«è®­ç»ƒé›†ä¸­æœªå‡ºç°è¿‡çš„å±æ€§å€¼â€œæŠ¹å»â€ï¼Œæ‰€ä»¥æ‰ä½¿ç”¨æ‹‰æ™®æ‹‰æ–¯ä¼°è®¡å™¨è¿›è¡Œä¿®æ­£ã€‚å…·ä½“çš„æ–¹æ³•æ˜¯ï¼šåœ¨åˆ†å­ä¸ŠåŠ 1,å¯¹äºå…ˆéªŒæ¦‚ç‡ï¼Œåœ¨åˆ†æ¯ä¸ŠåŠ ä¸Šè®­ç»ƒé›†ä¸­å¯èƒ½çš„ç±»åˆ«æ•°ï¼›å¯¹äºæ¡ä»¶æ¦‚ç‡ï¼Œåˆ™åœ¨åˆ†æ¯ä¸ŠåŠ ä¸Šç¬¬iä¸ªå±æ€§å¯èƒ½çš„å–å€¼æ•°\næœ´ç´ è´å¶æ–¯ä¸­æœ‰æ²¡æœ‰è¶…å‚æ•°å¯ä»¥è°ƒï¼Ÿ æœ´ç´ è´å¶æ–¯æ˜¯æ²¡æœ‰è¶…å‚æ•°å¯ä»¥è°ƒçš„ï¼Œæ‰€ä»¥å®ƒä¸éœ€è¦è°ƒå‚ï¼Œæœ´ç´ è´å¶æ–¯æ˜¯æ ¹æ®è®­ç»ƒé›†è¿›è¡Œåˆ†ç±»ï¼Œåˆ†ç±»å‡ºæ¥çš„ç»“æœåŸºæœ¬ä¸Šå°±æ˜¯ç¡®å®šäº†çš„ï¼Œæ‹‰æ™®æ‹‰æ–¯ä¼°è®¡å™¨ä¸æ˜¯æœ´ç´ è´å¶æ–¯ä¸­çš„å‚æ•°ï¼Œä¸èƒ½é€šè¿‡æ‹‰æ™®æ‹‰æ–¯ä¼°è®¡å™¨æ¥å¯¹æœ´ç´ è´å¶æ–¯è°ƒå‚ã€‚\næœ´ç´ è´å¶æ–¯ä¸­æœ‰å¤šå°‘ç§æ¨¡å‹ï¼Ÿ æœ´ç´ è´å¶æ–¯å«æœ‰3ç§æ¨¡å‹ï¼Œåˆ†åˆ«æ˜¯é«˜æ–¯æ¨¡å‹ï¼Œå¯¹è¿ç»­å‹æ•°æ®è¿›è¡Œå¤„ç†ï¼›å¤šé¡¹å¼æ¨¡å‹ï¼Œå¯¹ç¦»æ•£å‹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè®¡ç®—æ•°æ®çš„æ¡ä»¶æ¦‚ç‡(ä½¿ç”¨æ‹‰æ™®æ‹‰æ–¯ä¼°è®¡å™¨è¿›è¡Œå¹³æ»‘çš„ä¸€ä¸ªæ¨¡å‹)ï¼›ä¼¯åŠªåˆ©æ¨¡å‹ï¼Œä¼¯åŠªåˆ©æ¨¡å‹çš„å–å€¼ç‰¹å¾æ˜¯å¸ƒå°”å‹ï¼Œå³å‡ºç°ä¸ºture,ä¸å‡ºç°ä¸ºfalse,åœ¨è¿›è¡Œæ–‡æ¡£åˆ†ç±»æ—¶ï¼Œå°±æ˜¯ä¸€ä¸ªå•è¯æœ‰æ²¡æœ‰åœ¨ä¸€ä¸ªæ–‡æ¡£ä¸­å‡ºç°è¿‡ã€‚\nä½ çŸ¥é“æœ´ç´ è´å¶æ–¯æœ‰å“ªäº›åº”ç”¨å—ï¼Ÿ çŸ¥é“(è‚¯å®šå¾—çŸ¥é“å•Šï¼Œä¸ç„¶ä¸å°±ç™½å­¦äº†å—ï¼Ÿ) æœ´ç´ è´å¶æ–¯çš„åº”ç”¨æœ€å¹¿çš„åº”è¯¥å°±æ˜¯åœ¨æ–‡æ¡£åˆ†ç±»ã€åƒåœ¾æ–‡æœ¬è¿‡æ»¤(å¦‚åƒåœ¾é‚®ä»¶ã€åƒåœ¾ä¿¡æ¯ç­‰)ã€æƒ…æ„Ÿåˆ†æ(å¾®åšã€è®ºå›ä¸Šçš„ç§¯æã€æ¶ˆæç­‰æƒ…ç»ªåˆ¤åˆ«)è¿™äº›æ–¹é¢ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰å¤šåˆ†ç±»å®æ—¶é¢„æµ‹ã€æ¨èç³»ç»Ÿ(è´å¶æ–¯ä¸ååŒè¿‡æ»¤ç»„åˆä½¿ç”¨)ã€æ‹¼å†™çŸ«æ­£(å½“ä½ è¾“å…¥ä¸€ä¸ªé”™è¯¯å•è¯æ—¶ï¼Œå¯ä»¥é€šè¿‡æ–‡æ¡£åº“ä¸­å‡ºç°çš„æ¦‚ç‡å¯¹ä½ çš„è¾“å…¥è¿›è¡ŒçŸ«æ­£)ç­‰ã€‚\nä½ è§‰å¾—æœ´ç´ è´å¶æ–¯å¯¹å¼‚å¸¸å€¼æ•ä¸æ•æ„Ÿï¼Ÿ æœ´ç´ è´å¶æ–¯å¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿã€‚æ‰€ä»¥åœ¨è¿›è¡Œæ•°æ®å¤„ç†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸å»é™¤å¼‚å¸¸å€¼ï¼Œå› ä¸ºä¿ç•™å¼‚å¸¸å€¼å¯ä»¥ä¿æŒæœ´ç´ è´å¶æ–¯ç®—æ³•çš„æ•´ä½“ç²¾åº¦ï¼Œè€Œå»é™¤å¼‚å¸¸å€¼åˆ™å¯èƒ½åœ¨è¿›è¡Œé¢„æµ‹çš„è¿‡ç¨‹ä¸­ç”±äºå¤±å»éƒ¨åˆ†å¼‚å¸¸å€¼å¯¼è‡´æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ä¸‹é™ã€‚\næœ´ç´ è´å¶æ–¯æ˜¯é«˜æ–¹å·®è¿˜æ˜¯ä½æ–¹å·®æ¨¡å‹ï¼Ÿ æœ´ç´ è´å¶æ–¯æ˜¯ä½æ–¹å·®æ¨¡å‹ã€‚(è¯¯å·® = åå·® + æ–¹å·®)å¯¹äºå¤æ‚æ¨¡å‹æ¥è¯´ï¼Œç”±äºå¤æ‚æ¨¡å‹å……åˆ†æ‹Ÿåˆäº†éƒ¨åˆ†æ•°æ®ï¼Œä½¿å¾—å®ƒä»¬çš„åå·®å˜å°ï¼Œä½†ç”±äºå¯¹éƒ¨åˆ†æ•°æ®è¿‡åˆ†æ‹Ÿåˆï¼Œè¿™å°±å¯¼è‡´é¢„æµ‹çš„æ–¹å·®ä¼šå˜å¤§ã€‚å› ä¸ºæœ´ç´ è´å¶æ–¯å‡è®¾äº†å„ä¸ªå±æ€§ä¹‹é—´æ˜¯ç›¸äº’çš„ï¼Œç®—æ˜¯ä¸€ä¸ªç®€å•çš„æ¨¡å‹ã€‚å¯¹äºç®€å•çš„æ¨¡å‹æ¥è¯´ï¼Œåˆ™æ°æ°ç›¸åï¼Œç®€å•æ¨¡å‹çš„åå·®ä¼šæ›´å¤§ï¼Œç›¸å¯¹çš„ï¼Œæ–¹å·®å°±ä¼šè¾ƒå°ã€‚(åå·®æ˜¯æ¨¡å‹è¾“å‡ºå€¼ä¸çœŸå®å€¼çš„è¯¯å·®ï¼Œä¹Ÿå°±æ˜¯æ¨¡å‹çš„ç²¾å‡†åº¦ï¼Œæ–¹å·®æ˜¯é¢„æµ‹å€¼ä¸æ¨¡å‹è¾“å‡ºæœŸæœ›çš„çš„è¯¯å·®ï¼Œå³æ¨¡å‹çš„ç¨³å®šæ€§ï¼Œä¹Ÿå°±æ˜¯æ•°æ®çš„é›†ä¸­æ€§çš„ä¸€ä¸ªæŒ‡æ ‡)\nNavie Bayeså’ŒLogisticå›å½’åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ å‰è€…æ˜¯ç”Ÿæˆå¼æ¨¡å‹ï¼Œåè€…æ˜¯åˆ¤åˆ«å¼æ¨¡å‹ï¼ŒäºŒè€…çš„åŒºåˆ«å°±æ˜¯ç”Ÿæˆå¼æ¨¡å‹ä¸åˆ¤åˆ«å¼æ¨¡å‹çš„åŒºåˆ«ã€‚\n1ï¼‰é¦–å…ˆï¼ŒNavie Bayesé€šè¿‡å·²çŸ¥æ ·æœ¬æ±‚å¾—å…ˆéªŒæ¦‚ç‡P(Y), åŠæ¡ä»¶æ¦‚ç‡P(X|Y), å¯¹äºç»™å®šçš„å®ä¾‹ï¼Œè®¡ç®—è”åˆæ¦‚ç‡ï¼Œè¿›è€Œæ±‚å‡ºåéªŒæ¦‚ç‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå°è¯•å»æ‰¾åˆ°åº•è¿™ä¸ªæ•°æ®æ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼ˆäº§ç”Ÿçš„ï¼‰ï¼Œç„¶åå†è¿›è¡Œåˆ†ç±»ã€‚å“ªä¸ªç±»åˆ«æœ€æœ‰å¯èƒ½äº§ç”Ÿè¿™ä¸ªä¿¡å·ï¼Œå°±å±äºé‚£ä¸ªç±»åˆ«ã€‚\nä¼˜ç‚¹ï¼šæ ·æœ¬å®¹é‡å¢åŠ æ—¶ï¼Œæ”¶æ•›æ›´å¿«ï¼›éšå˜é‡å­˜åœ¨æ—¶ä¹Ÿå¯é€‚ç”¨ã€‚\nç¼ºç‚¹ï¼šæ—¶é—´é•¿ï¼›éœ€è¦æ ·æœ¬å¤šï¼›æµªè´¹è®¡ç®—èµ„æº\n2ï¼‰ç›¸æ¯”ä¹‹ä¸‹ï¼ŒLogisticå›å½’ä¸å…³å¿ƒæ ·æœ¬ä¸­ç±»åˆ«çš„æ¯”ä¾‹åŠç±»åˆ«ä¸‹å‡ºç°ç‰¹å¾çš„æ¦‚ç‡ï¼Œå®ƒç›´æ¥ç»™å‡ºé¢„æµ‹æ¨¡å‹çš„å¼å­ã€‚è®¾æ¯ä¸ªç‰¹å¾éƒ½æœ‰ä¸€ä¸ªæƒé‡ï¼Œè®­ç»ƒæ ·æœ¬æ•°æ®æ›´æ–°æƒé‡wï¼Œå¾—å‡ºæœ€ç»ˆè¡¨è¾¾å¼ã€‚æ¢¯åº¦æ³•ã€‚\nä¼˜ç‚¹ï¼šç›´æ¥é¢„æµ‹å¾€å¾€å‡†ç¡®ç‡æ›´é«˜ï¼›ç®€åŒ–é—®é¢˜ï¼›å¯ä»¥ååº”æ•°æ®çš„åˆ†å¸ƒæƒ…å†µï¼Œç±»åˆ«çš„å·®å¼‚ç‰¹å¾ï¼›é€‚ç”¨äºè¾ƒå¤šç±»åˆ«çš„è¯†åˆ«ã€‚\nç¼ºç‚¹ï¼šæ”¶æ•›æ…¢ï¼›ä¸é€‚ç”¨äºæœ‰éšå˜é‡çš„æƒ…å†µã€‚\nå‚è€ƒ:https://mp.weixin.qq.com/s/xzJDNRv8ipJY9hTo8WXoCw\n","permalink":"https://reid00.github.io/en/posts/ml/%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF/","summary":"è´å¶æ–¯å‡†å¤‡çŸ¥è¯† è´å¶æ–¯å†³ç­–è®ºæ˜¯æ¦‚ç‡æ¡†æ¶ä¸‹å®æ–½å†³ç­–çš„åŸºæœ¬æ–¹æ³•ã€‚è¦äº†è§£è´å¶æ–¯å†³ç­–è®ºï¼Œé¦–å…ˆå¾—å…ˆäº†è§£ä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µï¼šå…ˆéªŒæ¦‚ç‡ã€æ¡ä»¶æ¦‚ç‡ã€åéªŒæ¦‚ç‡ã€è¯¯åˆ¤æŸå¤±ã€æ¡ä»¶é£é™©ã€è´å¶æ–¯åˆ¤åˆ«å‡†åˆ™\nå…ˆéªŒæ¦‚ç‡ï¼š æ‰€è°“å…ˆéªŒæ¦‚ç‡ï¼Œå°±æ˜¯æ ¹æ®ä»¥å¾€çš„ç»éªŒæˆ–è€…ç°æœ‰æ•°æ®çš„åˆ†ææ‰€å¾—åˆ°çš„æ¦‚ç‡ã€‚å¦‚ï¼Œéšæœºæ‰”ä¸€æšç¡¬å¸ï¼Œåˆ™p(æ­£é¢) = p(åé¢) = 1/2ï¼Œè¿™æ˜¯æˆ‘ä»¬æ ¹æ®å·²çŸ¥çš„çŸ¥è¯†æ‰€çŸ¥é“çš„ä¿¡æ¯ï¼Œå³p(æ­£é¢) = 1/2ä¸ºå…ˆéªŒæ¦‚ç‡ã€‚\næ¡ä»¶æ¦‚ç‡ï¼š æ‰€è°“æ¡ä»¶æ¦‚ç‡æ˜¯æŒ‡äº‹ä»¶Aåœ¨å¦ä¸€äº‹ä»¶Bå‘ç”Ÿçš„æ¡ä»¶ä¸‹å‘é€çš„æ¦‚ç‡ã€‚ç”¨æ•°å­¦ç¬¦å·è¡¨ç¤ºä¸ºï¼šP(B\\|A)ï¼Œå³Båœ¨Aå‘ç”Ÿçš„æ¡ä»¶ä¸‹å‘ç”Ÿçš„æ¦‚ç‡ã€‚ä¸¾ä¸ªæ —å­ï¼Œä½ æ—©ä¸Šè¯¯å–äº†ä¸€ç“¶è¿‡æœŸäº†çš„ç‰›å¥¶ï¼ˆAï¼‰ï¼Œé‚£æˆ‘ä»¬æ¥ç®—ä¸€ä¸‹ä½ ä»Šå¤©æ‹‰è‚šå­çš„æ¦‚ç‡ï¼ˆBï¼‰ï¼Œè¿™ä¸ªå°±å«åšæ¡ä»¶æ¦‚ç‡ã€‚å³Pï¼ˆæ‹‰è‚šå­\\|å–äº†è¿‡æœŸç‰›å¥¶ï¼‰ï¼Œ æ˜“è§ï¼Œæ¡ä»¶æ¦‚ç‡æ˜¯æœ‰å› æ±‚æœï¼ˆçŸ¥é“åŸå› æ¨æµ‹ç»“æœï¼‰ã€‚\nåéªŒæ¦‚ç‡ï¼š åéªŒæ¦‚ç‡è·Ÿæ¡ä»¶æ¦‚ç‡çš„è¡¨è¾¾å½¢å¼æœ‰ç‚¹ç›¸ä¼¼ã€‚æ•°å­¦è¡¨è¾¾å¼ä¸ºp(A\\|B), å³Aåœ¨Bå‘ç”Ÿçš„æ¡ä»¶ä¸‹å‘ç”Ÿçš„æ¦‚ç‡ã€‚ä»¥è¯¯å–ç‰›å¥¶çš„ä¾‹å­ä¸ºä¾‹ï¼Œç°åœ¨çŸ¥é“äº†ä½ ä»Šå¤©æ‹‰è‚šå­äº†ï¼ˆBï¼‰ï¼Œç®—ä¸€ä¸‹ä½ æ—©ä¸Šè¯¯å–äº†ä¸€ç“¶è¿‡æœŸäº†çš„ç‰›å¥¶(A)çš„æ¦‚ç‡, å³Pï¼ˆA|Bï¼‰ï¼Œè¿™å°±æ˜¯åéªŒæ¦‚ç‡ï¼ŒåéªŒæ¦‚ç‡æ˜¯æœ‰æœæ±‚å› ï¼ˆçŸ¥é“ç»“æœæ¨å‡ºåŸå› ï¼‰\nè¯¯åˆ¤æŸå¤±ï¼š æ•°å­¦è¡¨è¾¾å¼ï¼šL(j|i)ï¼Œ åˆ¤åˆ«æŸå¤±è¡¨ç¤ºæŠŠä¸€ä¸ªæ ‡è®°ä¸ºiç±»çš„æ ·æœ¬è¯¯åˆ†ç±»ä¸ºjç±»æ‰€é€ æˆçš„æŸå¤±ã€‚ æ¯”å¦‚ï¼Œå½“ä½ å»å‚åŠ ä½“æ£€æ—¶ï¼Œæ˜æ˜ä½ å„é¡¹æŒ‡æ ‡éƒ½æ˜¯æ­£å¸¸çš„ï¼Œä½†æ˜¯åŒ»ç”Ÿå´æŠŠä½ åˆ†ä¸ºç™Œç—‡ç—…äººï¼Œè¿™å°±é€ æˆäº†è¯¯åˆ¤æŸå¤±ï¼Œç”¨æ•°å­¦è¡¨ç¤ºä¸ºï¼šL(ç™Œç—‡|æ­£å¸¸)ã€‚\næ¡ä»¶é£é™©ï¼š æ˜¯æŒ‡åŸºäºåéªŒæ¦‚ç‡P(i|x)å¯è·å¾—å°†æ ·æœ¬xåˆ†ç±»ä¸ºiæ‰€äº§ç”Ÿçš„æœŸæœ›æŸå¤±ï¼Œå…¬å¼ä¸ºï¼šR(i|x) = âˆ‘L(i|j)P(j|x)ã€‚(å…¶å®å°±æ˜¯æ‰€æœ‰åˆ¤åˆ«æŸå¤±çš„åŠ æƒå’Œï¼Œè€Œè¿™ä¸ªæƒå°±æ˜¯æ ·æœ¬åˆ¤ä¸ºjç±»çš„æ¦‚ç‡ï¼Œæ ·æœ¬æœ¬æ¥åº”è¯¥å«æœ‰P(j|x)çš„æ¦‚ç‡åˆ¤ä¸ºjç±»ï¼Œä½†æ˜¯å´åˆ¤ä¸ºäº†iç±»ï¼Œè¿™å°±é€ æˆäº†é”™åˆ¤æŸå¤±ï¼Œè€Œå°†æ‰€æœ‰çš„é”™åˆ¤æŸå¤±ä¸æ­£ç¡®åˆ¤æ–­çš„æ¦‚ç‡çš„ä¹˜ç§¯ç›¸åŠ ï¼Œå°±èƒ½å¾—åˆ°æ ·æœ¬é”™åˆ¤ä¸ºiç±»çš„å¹³å‡æŸå¤±ï¼Œå³æ¡ä»¶é£é™©ã€‚)\nä¸¾ä¸ªæ —å­ï¼Œå‡è®¾æŠŠç™Œç—‡ç—…äººåˆ¤ä¸ºæ­£å¸¸äººçš„è¯¯åˆ¤æŸå¤±æ˜¯100ï¼ŒæŠŠæ­£å¸¸äººåˆ¤ä¸ºç™Œç—‡ç—…äººçš„è¯¯åˆ¤æŸå¤±æ˜¯10ï¼ŒæŠŠæ„Ÿå†’ç—…äººåˆ¤ä¸ºç™Œç—‡çš„è¯¯åˆ¤æŸå¤±æ˜¯8ï¼Œå³Lï¼ˆæ­£å¸¸|ç™Œç—‡ï¼‰ = 100ï¼Œ Lï¼ˆç™Œç—‡|æ­£å¸¸ï¼‰ = 10ï¼ŒL(ç™Œç—‡|æ„Ÿå†’) = 8ï¼Œ ç°åœ¨ï¼Œæˆ‘ä»¬ç»è¿‡è®¡ç®—çŸ¥é“æœ‰ä¸€ä¸ªæ¥ä½“æ£€çš„å‘˜å·¥çš„åéªŒæ¦‚ç‡åˆ†åˆ«ä¸ºï¼šp(æ­£å¸¸|å„é¡¹æŒ‡æ ‡) = 0.2ï¼Œ p(æ„Ÿå†’|å„é¡¹æŒ‡æ ‡) = 0.4, pï¼ˆ ç™Œç—‡|å„é¡¹æŒ‡æ ‡)=0.4ã€‚å‡å¦‚æˆ‘ä»¬éœ€è¦è®¡ç®—å°†è¿™ä¸ªå‘˜å·¥åˆ¤ä¸ºç™Œç—‡çš„æ¡ä»¶é£é™©ï¼Œåˆ™ï¼šRï¼ˆç™Œç—‡|å„é¡¹æŒ‡æ ‡ï¼‰ = Lï¼ˆç™Œç—‡|æ­£å¸¸ï¼‰ p(æ­£å¸¸|å„é¡¹æŒ‡æ ‡) + L(ç™Œç—‡|æ„Ÿå†’) * p(æ„Ÿå†’|å„é¡¹æŒ‡æ ‡) = 5.2ã€‚*\nè´å¶æ–¯åˆ¤åˆ«å‡†åˆ™ï¼š\nè´å¶æ–¯åˆ¤åˆ«å‡†åˆ™æ˜¯æ‰¾åˆ°ä¸€ä¸ªä½¿æ¡ä»¶é£é™©è¾¾åˆ°æœ€å°çš„åˆ¤åˆ«æ–¹æ³•ã€‚å³ï¼Œå°†æ ·æœ¬åˆ¤ä¸ºå“ªä¸€ç±»ï¼Œæ‰€å¾—åˆ°çš„æ¡ä»¶é£é™©R(i|x)ï¼ˆæˆ–è€…è¯´å¹³å‡åˆ¤åˆ«æŸå¤±ï¼‰æœ€å°ï¼Œé‚£å°±å°†æ ·æœ¬å½’ä¸ºé‚£ä¸ªé€ æˆå¹³å‡åˆ¤åˆ«æŸå¤±æœ€å°çš„ç±»ã€‚\næ­¤æ—¶ï¼šh*(x) = argminR(i|x) å°±ç§°ä¸º è´å¶æ–¯æœ€ä¼˜åˆ†ç±»å™¨ã€‚\næ€»ç»“ï¼šè´å¶æ–¯å†³ç­–è®ºæ˜¯åŸºäºå…ˆéªŒæ¦‚ç‡æ±‚è§£åéªŒæ¦‚ç‡çš„æ–¹æ³•ï¼Œå…¶æ ¸å¿ƒæ˜¯å¯»æ‰¾ä¸€ä¸ªåˆ¤åˆ«å‡†åˆ™ä½¿å¾—æ¡ä»¶é£é™©è¾¾åˆ°æœ€å°ã€‚è€Œåœ¨æœ€å°åŒ–åˆ†ç±»é”™è¯¯ç‡çš„ç›®æ ‡ä¸‹ï¼Œè´å¶æ–¯æœ€ä¼˜åˆ†ç±»å™¨åˆå¯ä»¥è½¬åŒ–ä¸ºæ±‚åéªŒæ¦‚ç‡è¾¾åˆ°æœ€å¤§çš„ç±»åˆ«æ ‡è®°ï¼Œå³ h*ï¼ˆx) = argmaxP(i|x)ã€‚ï¼ˆæ­¤æ—¶ï¼ŒL(i|j) = 0, if i = j;L(i|j) = 1, otherwise)","title":"æœ´ç´ è´å¶æ–¯"},{"content":"åœ¨è°ƒæ•´æ¨¡å‹æ›´æ–°æƒé‡å’Œåå·®å‚æ•°çš„æ–¹å¼æ—¶ï¼Œä½ æ˜¯å¦è€ƒè™‘è¿‡å“ªç§ä¼˜åŒ–ç®—æ³•èƒ½ä½¿æ¨¡å‹äº§ç”Ÿæ›´å¥½ä¸”æ›´å¿«çš„æ•ˆæœï¼Ÿåº”è¯¥ç”¨æ¢¯åº¦ä¸‹é™ï¼Œéšæœºæ¢¯åº¦ä¸‹é™ï¼Œè¿˜æ˜¯Adamæ–¹æ³•ï¼Ÿ\nè¿™ç¯‡æ–‡ç« ä»‹ç»äº†ä¸åŒä¼˜åŒ–ç®—æ³•ä¹‹é—´çš„ä¸»è¦åŒºåˆ«ï¼Œä»¥åŠå¦‚ä½•é€‰æ‹©æœ€ä½³çš„ä¼˜åŒ–æ–¹æ³•ã€‚\næ¢¯åº¦: æ˜¯å¤šå…ƒå‡½æ•°å¯¹å½“å‰ç»™å®šç‚¹ï¼Œä¸Šå‡æœ€å¿«çš„æ–¹å‘ã€‚æ¢¯åº¦æ˜¯ä¸€ç»„å‘é‡ï¼Œæ‰€ä»¥å¸¦æœ‰æ–¹å‘;\næ¢¯åº¦ä¸‹é™æµç¨‹: https://zhuanlan.zhihu.com/p/68468520 w, b æ¯è½®æ˜¯æ¯ä¸ªæ ·æœ¬çš„æƒé‡æ¢¯åº¦å‘é‡å’Œåå·®æ¢¯åº¦å‘é‡çš„å¹³å‡å€¼ï¼›\næ¢¯åº¦ä¸‹é™æœ¬è´¨æ˜¯æ²¿ç€è´Ÿæ¢¯åº¦å€¼æ–¹å‘å¯»æ‰¾æŸå¤±å‡½æ•°Lossçš„æœ€å°å€¼è§£ æ—¶çš„å‚æ•°w,b , ä»è€Œå¾—å‡ºå¯¹æ ·æœ¬æ•°æ®æ‹Ÿåˆæœ€å¥½çš„å‚æ•°w,bã€‚ https://www.jianshu.com/p/c7e642877b0e\nä»€ä¹ˆæ˜¯ä¼˜åŒ–ç®—æ³•ï¼Ÿ ä¼˜åŒ–ç®—æ³•çš„åŠŸèƒ½ï¼Œæ˜¯é€šè¿‡æ”¹å–„è®­ç»ƒæ–¹å¼ï¼Œæ¥æœ€å°åŒ–(æˆ–æœ€å¤§åŒ–)æŸå¤±å‡½æ•°E(x)ã€‚\næ¨¡å‹å†…éƒ¨æœ‰äº›å‚æ•°ï¼Œæ˜¯ç”¨æ¥è®¡ç®—æµ‹è¯•é›†ä¸­ç›®æ ‡å€¼Yçš„çœŸå®å€¼å’Œé¢„æµ‹å€¼çš„åå·®ç¨‹åº¦çš„ï¼ŒåŸºäºè¿™äº›å‚æ•°ï¼Œå°±å½¢æˆäº†æŸå¤±å‡½æ•°E(x)ã€‚\næ¯”å¦‚è¯´ï¼Œæƒé‡(W)å’Œåå·®(b)å°±æ˜¯è¿™æ ·çš„å†…éƒ¨å‚æ•°ï¼Œä¸€èˆ¬ç”¨äºè®¡ç®—è¾“å‡ºå€¼ï¼Œåœ¨è®­ç»ƒç¥ç»ç½‘ç»œæ¨¡å‹æ—¶èµ·åˆ°ä¸»è¦ä½œç”¨ã€‚\n**åœ¨æœ‰æ•ˆåœ°è®­ç»ƒæ¨¡å‹å¹¶äº§ç”Ÿå‡†ç¡®ç»“æœæ—¶ï¼Œæ¨¡å‹çš„å†…éƒ¨å‚æ•°èµ·åˆ°äº†éå¸¸é‡è¦çš„ä½œç”¨ã€‚**è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åº”è¯¥ç”¨å„ç§ä¼˜åŒ–ç­–ç•¥å’Œç®—æ³•ï¼Œæ¥æ›´æ–°å’Œè®¡ç®—å½±å“æ¨¡å‹è®­ç»ƒå’Œæ¨¡å‹è¾“å‡ºçš„ç½‘ç»œå‚æ•°ï¼Œä½¿å…¶é€¼è¿‘æˆ–è¾¾åˆ°æœ€ä¼˜å€¼ã€‚\nä¼˜åŒ–ç®—æ³•åˆ†ä¸ºä¸¤å¤§ç±»ï¼š\n1. ä¸€é˜¶ä¼˜åŒ–ç®—æ³•\nè¿™ç§ç®—æ³•ä½¿ç”¨å„å‚æ•°çš„æ¢¯åº¦å€¼æ¥æœ€å°åŒ–æˆ–æœ€å¤§åŒ–æŸå¤±å‡½æ•°E(x)ã€‚æœ€å¸¸ç”¨çš„ä¸€é˜¶ä¼˜åŒ–ç®—æ³•æ˜¯æ¢¯åº¦ä¸‹é™ã€‚\nå‡½æ•°æ¢¯åº¦ï¼šå¯¼æ•°dy/dxçš„å¤šå˜é‡è¡¨è¾¾å¼ï¼Œç”¨æ¥è¡¨ç¤ºyç›¸å¯¹äºxçš„ç¬æ—¶å˜åŒ–ç‡ã€‚å¾€å¾€ä¸ºäº†è®¡ç®—å¤šå˜é‡å‡½æ•°çš„å¯¼æ•°æ—¶ï¼Œä¼šç”¨æ¢¯åº¦å–ä»£å¯¼æ•°ï¼Œå¹¶ä½¿ç”¨åå¯¼æ•°æ¥è®¡ç®—æ¢¯åº¦ã€‚æ¢¯åº¦å’Œå¯¼æ•°ä¹‹é—´çš„ä¸€ä¸ªä¸»è¦åŒºåˆ«æ˜¯å‡½æ•°çš„æ¢¯åº¦å½¢æˆäº†ä¸€ä¸ªå‘é‡åœºã€‚\nå› æ­¤ï¼Œå¯¹å•å˜é‡å‡½æ•°ï¼Œä½¿ç”¨å¯¼æ•°æ¥åˆ†æï¼›è€Œæ¢¯åº¦æ˜¯åŸºäºå¤šå˜é‡å‡½æ•°è€Œäº§ç”Ÿçš„ã€‚æ›´å¤šç†è®ºç»†èŠ‚åœ¨è¿™é‡Œä¸å†è¿›è¡Œè¯¦ç»†è§£é‡Šã€‚\n2. äºŒé˜¶ä¼˜åŒ–ç®—æ³•\näºŒé˜¶ä¼˜åŒ–ç®—æ³•ä½¿ç”¨äº†äºŒé˜¶å¯¼æ•°(ä¹Ÿå«åšHessianæ–¹æ³•)æ¥æœ€å°åŒ–æˆ–æœ€å¤§åŒ–æŸå¤±å‡½æ•°ã€‚ç”±äºäºŒé˜¶å¯¼æ•°çš„è®¡ç®—æˆæœ¬å¾ˆé«˜ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•å¹¶æ²¡æœ‰å¹¿æ³›ä½¿ç”¨ã€‚\nè¯¦è§£å„ç§ç¥ç»ç½‘ç»œä¼˜åŒ–ç®—æ³• æ¢¯åº¦ä¸‹é™ åœ¨è®­ç»ƒå’Œä¼˜åŒ–æ™ºèƒ½ç³»ç»Ÿæ—¶ï¼Œæ¢¯åº¦ä¸‹é™æ˜¯ä¸€ç§æœ€é‡è¦çš„æŠ€æœ¯å’ŒåŸºç¡€ã€‚æ¢¯åº¦ä¸‹é™çš„åŠŸèƒ½æ˜¯ï¼š\né€šè¿‡å¯»æ‰¾æœ€å°å€¼ï¼Œæ§åˆ¶æ–¹å·®ï¼Œæ›´æ–°æ¨¡å‹å‚æ•°ï¼Œæœ€ç»ˆä½¿æ¨¡å‹æ”¶æ•›ã€‚\nç½‘ç»œæ›´æ–°å‚æ•°çš„å…¬å¼ä¸ºï¼šÎ¸=Î¸âˆ’Î·Ã—âˆ‡(Î¸).J(Î¸)â€Šï¼Œå…¶ä¸­Î·æ˜¯å­¦ä¹ ç‡ï¼Œâˆ‡(Î¸).J(Î¸)æ˜¯æŸå¤±å‡½æ•°J(Î¸)çš„æ¢¯åº¦ã€‚\nè¿™æ˜¯åœ¨ç¥ç»ç½‘ç»œä¸­æœ€å¸¸ç”¨çš„ä¼˜åŒ–ç®—æ³•ã€‚\nå¦‚ä»Šï¼Œæ¢¯åº¦ä¸‹é™ä¸»è¦ç”¨äºåœ¨ç¥ç»ç½‘ç»œæ¨¡å‹ä¸­è¿›è¡Œæƒé‡æ›´æ–°ï¼Œå³åœ¨ä¸€ä¸ªæ–¹å‘ä¸Šæ›´æ–°å’Œè°ƒæ•´æ¨¡å‹çš„å‚æ•°ï¼Œæ¥æœ€å°åŒ–æŸå¤±å‡½æ•°ã€‚\n2006å¹´å¼•å…¥çš„åå‘ä¼ æ’­æŠ€æœ¯ï¼Œä½¿å¾—è®­ç»ƒæ·±å±‚ç¥ç»ç½‘ç»œæˆä¸ºå¯èƒ½ã€‚åå‘ä¼ æ’­æŠ€æœ¯æ˜¯å…ˆåœ¨å‰å‘ä¼ æ’­ä¸­è®¡ç®—è¾“å…¥ä¿¡å·çš„ä¹˜ç§¯åŠå…¶å¯¹åº”çš„æƒé‡ï¼Œç„¶åå°†æ¿€æ´»å‡½æ•°ä½œç”¨äºè¿™äº›ä¹˜ç§¯çš„æ€»å’Œã€‚è¿™ç§å°†è¾“å…¥ä¿¡å·è½¬æ¢ä¸ºè¾“å‡ºä¿¡å·çš„æ–¹å¼ï¼Œæ˜¯ä¸€ç§å¯¹å¤æ‚éçº¿æ€§å‡½æ•°è¿›è¡Œå»ºæ¨¡çš„é‡è¦æ‰‹æ®µï¼Œå¹¶å¼•å…¥äº†éçº¿æ€§æ¿€æ´»å‡½æ•°ï¼Œä½¿å¾—æ¨¡å‹èƒ½å¤Ÿå­¦ä¹ åˆ°å‡ ä¹ä»»æ„å½¢å¼çš„å‡½æ•°æ˜ å°„ã€‚ç„¶åï¼Œåœ¨ç½‘ç»œçš„åå‘ä¼ æ’­è¿‡ç¨‹ä¸­å›ä¼ ç›¸å…³è¯¯å·®ï¼Œä½¿ç”¨æ¢¯åº¦ä¸‹é™æ›´æ–°æƒé‡å€¼ï¼Œé€šè¿‡è®¡ç®—è¯¯å·®å‡½æ•°Eç›¸å¯¹äºæƒé‡å‚æ•°Wçš„æ¢¯åº¦ï¼Œåœ¨æŸå¤±å‡½æ•°æ¢¯åº¦çš„ç›¸åæ–¹å‘ä¸Šæ›´æ–°æƒé‡å‚æ•°ã€‚\n**å›¾1ï¼š**æƒé‡æ›´æ–°æ–¹å‘ä¸æ¢¯åº¦æ–¹å‘ç›¸å å›¾1æ˜¾ç¤ºäº†æƒé‡æ›´æ–°è¿‡ç¨‹ä¸æ¢¯åº¦çŸ¢é‡è¯¯å·®çš„æ–¹å‘ç›¸åï¼Œå…¶ä¸­Uå½¢æ›²çº¿ä¸ºæ¢¯åº¦ã€‚è¦æ³¨æ„åˆ°ï¼Œå½“æƒé‡å€¼Wå¤ªå°æˆ–å¤ªå¤§æ—¶ï¼Œä¼šå­˜åœ¨è¾ƒå¤§çš„è¯¯å·®ï¼Œéœ€è¦æ›´æ–°å’Œä¼˜åŒ–æƒé‡ï¼Œä½¿å…¶è½¬åŒ–ä¸ºåˆé€‚å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬è¯•å›¾åœ¨ä¸æ¢¯åº¦ç›¸åçš„æ–¹å‘æ‰¾åˆ°ä¸€ä¸ªå±€éƒ¨æœ€ä¼˜å€¼ã€‚\næ¢¯åº¦ä¸‹é™çš„å˜ä½“ ä¼ ç»Ÿçš„æ‰¹é‡æ¢¯åº¦ä¸‹é™å°†è®¡ç®—æ•´ä¸ªæ•°æ®é›†æ¢¯åº¦ï¼Œä½†åªä¼šè¿›è¡Œä¸€æ¬¡æ›´æ–°ï¼Œå› æ­¤åœ¨å¤„ç†å¤§å‹æ•°æ®é›†æ—¶é€Ÿåº¦å¾ˆæ…¢ä¸”éš¾ä»¥æ§åˆ¶ï¼Œç”šè‡³å¯¼è‡´å†…å­˜æº¢å‡ºã€‚\næƒé‡æ›´æ–°çš„å¿«æ…¢æ˜¯ç”±å­¦ä¹ ç‡Î·å†³å®šçš„ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å‡¸é¢è¯¯å·®æ›²é¢ä¸­æ”¶æ•›åˆ°å…¨å±€æœ€ä¼˜å€¼ï¼Œåœ¨éå‡¸æ›²é¢ä¸­å¯èƒ½è¶‹äºå±€éƒ¨æœ€ä¼˜å€¼ã€‚\nä½¿ç”¨æ ‡å‡†å½¢å¼çš„æ‰¹é‡æ¢¯åº¦ä¸‹é™è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨è®­ç»ƒå¤§å‹æ•°æ®é›†æ—¶å­˜åœ¨å†—ä½™çš„æƒé‡æ›´æ–°ã€‚\næ ‡å‡†æ¢¯åº¦ä¸‹é™çš„ä¸Šè¿°é—®é¢˜åœ¨éšæœºæ¢¯åº¦ä¸‹é™æ–¹æ³•ä¸­å¾—åˆ°äº†è§£å†³ã€‚\n1. éšæœºæ¢¯åº¦ä¸‹é™(SDG)\néšæœºæ¢¯åº¦ä¸‹é™ï¼ˆStochastic gradient descentï¼ŒSGDï¼‰å¯¹æ¯ä¸ªè®­ç»ƒæ ·æœ¬è¿›è¡Œå‚æ•°æ›´æ–°ï¼Œæ¯æ¬¡æ‰§è¡Œéƒ½è¿›è¡Œä¸€æ¬¡æ›´æ–°ï¼Œä¸”æ‰§è¡Œé€Ÿåº¦æ›´å¿«ã€‚\nÎ¸=Î¸âˆ’Î·â‹…âˆ‡(Î¸) Ã— J(Î¸;x(i);y(i))ï¼Œå…¶ä¸­x(i)å’Œy(i)ä¸ºè®­ç»ƒæ ·æœ¬ã€‚\né¢‘ç¹çš„æ›´æ–°ä½¿å¾—å‚æ•°é—´å…·æœ‰é«˜æ–¹å·®ï¼ŒæŸå¤±å‡½æ•°ä¼šä»¥ä¸åŒçš„å¼ºåº¦æ³¢åŠ¨ã€‚è¿™å®é™…ä¸Šæ˜¯ä¸€ä»¶å¥½äº‹ï¼Œå› ä¸ºå®ƒæœ‰åŠ©äºæˆ‘ä»¬å‘ç°æ–°çš„å’Œå¯èƒ½æ›´ä¼˜çš„å±€éƒ¨æœ€å°å€¼ï¼Œè€Œæ ‡å‡†æ¢¯åº¦ä¸‹é™å°†åªä¼šæ”¶æ•›åˆ°æŸä¸ªå±€éƒ¨æœ€ä¼˜å€¼ã€‚\nä½†SGDçš„é—®é¢˜æ˜¯ï¼Œç”±äºé¢‘ç¹çš„æ›´æ–°å’Œæ³¢åŠ¨ï¼Œæœ€ç»ˆå°†æ”¶æ•›åˆ°æœ€å°é™åº¦ï¼Œå¹¶ä¼šå› æ³¢åŠ¨é¢‘ç¹å­˜åœ¨è¶…è°ƒé‡ã€‚\nè™½ç„¶å·²ç»è¡¨æ˜ï¼Œå½“ç¼“æ…¢é™ä½å­¦ä¹ ç‡Î·æ—¶ï¼Œæ ‡å‡†æ¢¯åº¦ä¸‹é™çš„æ”¶æ•›æ¨¡å¼ä¸SGDçš„æ¨¡å¼ç›¸åŒã€‚\n**å›¾2ï¼š**æ¯ä¸ªè®­ç»ƒæ ·æœ¬ä¸­é«˜æ–¹å·®çš„å‚æ•°æ›´æ–°ä¼šå¯¼è‡´æŸå¤±å‡½æ•°å¤§å¹…æ³¢åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬å¯èƒ½æ— æ³•è·å¾—ç»™å‡ºæŸå¤±å‡½æ•°çš„æœ€å°å€¼ã€‚ å¦ä¸€ç§ç§°ä¸ºâ€œå°æ‰¹é‡æ¢¯åº¦ä¸‹é™â€çš„å˜ä½“ï¼Œåˆ™å¯ä»¥è§£å†³é«˜æ–¹å·®çš„å‚æ•°æ›´æ–°å’Œä¸ç¨³å®šæ”¶æ•›çš„é—®é¢˜ã€‚\n2. å°æ‰¹é‡æ¢¯åº¦ä¸‹é™\nä¸ºäº†é¿å…SGDå’Œæ ‡å‡†æ¢¯åº¦ä¸‹é™ä¸­å­˜åœ¨çš„é—®é¢˜ï¼Œä¸€ä¸ªæ”¹è¿›æ–¹æ³•ä¸ºå°æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼ˆMini Batch Gradient Descentï¼‰ï¼Œå› ä¸ºå¯¹æ¯ä¸ªæ‰¹æ¬¡ä¸­çš„nä¸ªè®­ç»ƒæ ·æœ¬ï¼Œè¿™ç§æ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡æ›´æ–°ã€‚\nä½¿ç”¨å°æ‰¹é‡æ¢¯åº¦ä¸‹é™çš„ä¼˜ç‚¹æ˜¯ï¼š\n1) å¯ä»¥å‡å°‘å‚æ•°æ›´æ–°çš„æ³¢åŠ¨ï¼Œæœ€ç»ˆå¾—åˆ°æ•ˆæœæ›´å¥½å’Œæ›´ç¨³å®šçš„æ”¶æ•›ã€‚\n2) è¿˜å¯ä»¥ä½¿ç”¨æœ€æ–°çš„æ·±å±‚å­¦ä¹ åº“ä¸­é€šç”¨çš„çŸ©é˜µä¼˜åŒ–æ–¹æ³•ï¼Œä½¿è®¡ç®—å°æ‰¹é‡æ•°æ®çš„æ¢¯åº¦æ›´åŠ é«˜æ•ˆã€‚\n3) é€šå¸¸æ¥è¯´ï¼Œå°æ‰¹é‡æ ·æœ¬çš„å¤§å°èŒƒå›´æ˜¯ä»50åˆ°256ï¼Œå¯ä»¥æ ¹æ®å®é™…é—®é¢˜è€Œæœ‰æ‰€ä¸åŒã€‚\n4) åœ¨è®­ç»ƒç¥ç»ç½‘ç»œæ—¶ï¼Œé€šå¸¸éƒ½ä¼šé€‰æ‹©å°æ‰¹é‡æ¢¯åº¦ä¸‹é™ç®—æ³•ã€‚\nè¿™ç§æ–¹æ³•æœ‰æ—¶å€™è¿˜æ˜¯è¢«æˆä¸ºSGDã€‚\nä½¿ç”¨æ¢¯åº¦ä¸‹é™åŠå…¶å˜ä½“æ—¶é¢ä¸´çš„æŒ‘æˆ˜ 1. å¾ˆéš¾é€‰æ‹©å‡ºåˆé€‚çš„å­¦ä¹ ç‡ã€‚å¤ªå°çš„å­¦ä¹ ç‡ä¼šå¯¼è‡´ç½‘ç»œæ”¶æ•›è¿‡äºç¼“æ…¢ï¼Œè€Œå­¦ä¹ ç‡å¤ªå¤§å¯èƒ½ä¼šå½±å“æ”¶æ•›ï¼Œå¹¶å¯¼è‡´æŸå¤±å‡½æ•°åœ¨æœ€å°å€¼ä¸Šæ³¢åŠ¨ï¼Œç”šè‡³å‡ºç°æ¢¯åº¦å‘æ•£ã€‚\n2. æ­¤å¤–ï¼Œç›¸åŒçš„å­¦ä¹ ç‡å¹¶ä¸é€‚ç”¨äºæ‰€æœ‰çš„å‚æ•°æ›´æ–°ã€‚å¦‚æœè®­ç»ƒé›†æ•°æ®å¾ˆç¨€ç–ï¼Œä¸”ç‰¹å¾é¢‘ç‡éå¸¸ä¸åŒï¼Œåˆ™ä¸åº”è¯¥å°†å…¶å…¨éƒ¨æ›´æ–°åˆ°ç›¸åŒçš„ç¨‹åº¦ï¼Œä½†æ˜¯å¯¹äºå¾ˆå°‘å‡ºç°çš„ç‰¹å¾ï¼Œåº”ä½¿ç”¨æ›´å¤§çš„æ›´æ–°ç‡ã€‚\n3. åœ¨ç¥ç»ç½‘ç»œä¸­ï¼Œæœ€å°åŒ–éå‡¸è¯¯å·®å‡½æ•°çš„å¦ä¸€ä¸ªå…³é”®æŒ‘æˆ˜æ˜¯é¿å…é™·äºå¤šä¸ªå…¶ä»–å±€éƒ¨æœ€å°å€¼ä¸­ã€‚å®é™…ä¸Šï¼Œé—®é¢˜å¹¶éæºäºå±€éƒ¨æå°å€¼ï¼Œè€Œæ˜¯æ¥è‡ªéç‚¹ï¼Œå³ä¸€ä¸ªç»´åº¦å‘ä¸Šå€¾æ–œä¸”å¦ä¸€ç»´åº¦å‘ä¸‹å€¾æ–œçš„ç‚¹ã€‚è¿™äº›éç‚¹é€šå¸¸è¢«ç›¸åŒè¯¯å·®å€¼çš„å¹³é¢æ‰€åŒ…å›´ï¼Œè¿™ä½¿å¾—SGDç®—æ³•å¾ˆéš¾è„±ç¦»å‡ºæ¥ï¼Œå› ä¸ºæ¢¯åº¦åœ¨æ‰€æœ‰ç»´åº¦ä¸Šæ¥è¿‘äºé›¶ã€‚\nè¿›ä¸€æ­¥ä¼˜åŒ–æ¢¯åº¦ä¸‹é™ ç°åœ¨æˆ‘ä»¬è¦è®¨è®ºç”¨äºè¿›ä¸€æ­¥ä¼˜åŒ–æ¢¯åº¦ä¸‹é™çš„å„ç§ç®—æ³•ã€‚\n1. åŠ¨é‡\nSGDæ–¹æ³•ä¸­çš„é«˜æ–¹å·®æŒ¯è¡ä½¿å¾—ç½‘ç»œå¾ˆéš¾ç¨³å®šæ”¶æ•›ï¼Œæ‰€ä»¥æœ‰ç ”ç©¶è€…æå‡ºäº†ä¸€ç§ç§°ä¸ºåŠ¨é‡ï¼ˆMomentumï¼‰çš„æŠ€æœ¯ï¼Œé€šè¿‡ä¼˜åŒ–ç›¸å…³æ–¹å‘çš„è®­ç»ƒå’Œå¼±åŒ–æ— å…³æ–¹å‘çš„æŒ¯è¡ï¼Œæ¥åŠ é€ŸSGDè®­ç»ƒã€‚æ¢å¥è¯è¯´ï¼Œè¿™ç§æ–°æ–¹æ³•å°†ä¸Šä¸ªæ­¥éª¤ä¸­æ›´æ–°å‘é‡çš„åˆ†é‡â€™Î³â€™æ·»åŠ åˆ°å½“å‰æ›´æ–°å‘é‡ã€‚\nV(t)=Î³V(tâˆ’1)+Î·âˆ‡(Î¸).J(Î¸)\næœ€åé€šè¿‡Î¸=Î¸âˆ’V(t)æ¥æ›´æ–°å‚æ•°ã€‚\nåŠ¨é‡é¡¹Î³é€šå¸¸è®¾å®šä¸º0.9ï¼Œæˆ–ç›¸è¿‘çš„æŸä¸ªå€¼ã€‚\nè¿™é‡Œçš„åŠ¨é‡ä¸ç»å…¸ç‰©ç†å­¦ä¸­çš„åŠ¨é‡æ˜¯ä¸€è‡´çš„ï¼Œå°±åƒä»å±±ä¸ŠæŠ•å‡ºä¸€ä¸ªçƒï¼Œåœ¨ä¸‹è½è¿‡ç¨‹ä¸­æ”¶é›†åŠ¨é‡ï¼Œå°çƒçš„é€Ÿåº¦ä¸æ–­å¢åŠ ã€‚\nåœ¨å‚æ•°æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå…¶åŸç†ç±»ä¼¼ï¼š\n1) ä½¿ç½‘ç»œèƒ½æ›´ä¼˜å’Œæ›´ç¨³å®šçš„æ”¶æ•›ï¼›\n2) å‡å°‘æŒ¯è¡è¿‡ç¨‹ã€‚\nå½“å…¶æ¢¯åº¦æŒ‡å‘å®é™…ç§»åŠ¨æ–¹å‘æ—¶ï¼ŒåŠ¨é‡é¡¹Î³å¢å¤§ï¼›å½“æ¢¯åº¦ä¸å®é™…ç§»åŠ¨æ–¹å‘ç›¸åæ—¶ï¼ŒÎ³å‡å°ã€‚è¿™ç§æ–¹å¼æ„å‘³ç€åŠ¨é‡é¡¹åªå¯¹ç›¸å…³æ ·æœ¬è¿›è¡Œå‚æ•°æ›´æ–°ï¼Œå‡å°‘äº†ä¸å¿…è¦çš„å‚æ•°æ›´æ–°ï¼Œä»è€Œå¾—åˆ°æ›´å¿«ä¸”ç¨³å®šçš„æ”¶æ•›ï¼Œä¹Ÿå‡å°‘äº†æŒ¯è¡è¿‡ç¨‹ã€‚\n2. Nesterovæ¢¯åº¦åŠ é€Ÿæ³•\nä¸€ä½åå«Yurii Nesterovç ”ç©¶å‘˜ï¼Œè®¤ä¸ºåŠ¨é‡æ–¹æ³•å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼š\nå¦‚æœä¸€ä¸ªæ»šä¸‹å±±å¡çš„çƒï¼Œç›²ç›®æ²¿ç€æ–œå¡ä¸‹æ»‘ï¼Œè¿™æ˜¯éå¸¸ä¸åˆé€‚çš„ã€‚ä¸€ä¸ªæ›´èªæ˜çš„çƒåº”è¯¥è¦æ³¨æ„åˆ°å®ƒå°†è¦å»å“ªï¼Œå› æ­¤åœ¨ä¸Šå¡å†æ¬¡å‘ä¸Šå€¾æ–œæ—¶å°çƒåº”è¯¥è¿›è¡Œå‡é€Ÿã€‚\nå®é™…ä¸Šï¼Œå½“å°çƒè¾¾åˆ°æ›²çº¿ä¸Šçš„æœ€ä½ç‚¹æ—¶ï¼ŒåŠ¨é‡ç›¸å½“é«˜ã€‚ç”±äºé«˜åŠ¨é‡å¯èƒ½ä¼šå¯¼è‡´å…¶å®Œå…¨åœ°é”™è¿‡æœ€å°å€¼ï¼Œå› æ­¤å°çƒä¸çŸ¥é“ä½•æ—¶è¿›è¡Œå‡é€Ÿï¼Œæ•…ç»§ç»­å‘ä¸Šç§»åŠ¨ã€‚\nYurii Nesterovåœ¨1983å¹´å‘è¡¨äº†ä¸€ç¯‡å…³äºè§£å†³åŠ¨é‡é—®é¢˜çš„è®ºæ–‡ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬æŠŠè¿™ç§æ–¹æ³•å«åšNestrovæ¢¯åº¦åŠ é€Ÿæ³•ã€‚\nåœ¨è¯¥æ–¹æ³•ä¸­ï¼Œä»–æå‡ºå…ˆæ ¹æ®ä¹‹å‰çš„åŠ¨é‡è¿›è¡Œå¤§æ­¥è·³è·ƒï¼Œç„¶åè®¡ç®—æ¢¯åº¦è¿›è¡Œæ ¡æ­£ï¼Œä»è€Œå®ç°å‚æ•°æ›´æ–°ã€‚è¿™ç§é¢„æ›´æ–°æ–¹æ³•èƒ½é˜²æ­¢å¤§å¹…æŒ¯è¡ï¼Œä¸ä¼šé”™è¿‡æœ€å°å€¼ï¼Œå¹¶å¯¹å‚æ•°æ›´æ–°æ›´åŠ æ•æ„Ÿã€‚\nNesterovæ¢¯åº¦åŠ é€Ÿæ³•ï¼ˆNAGï¼‰æ˜¯ä¸€ç§èµ‹äºˆäº†åŠ¨é‡é¡¹é¢„çŸ¥èƒ½åŠ›çš„æ–¹æ³•ï¼Œé€šè¿‡ä½¿ç”¨åŠ¨é‡é¡¹Î³V(tâˆ’1)æ¥æ›´æ”¹å‚æ•°Î¸ã€‚é€šè¿‡è®¡ç®—Î¸âˆ’Î³V(tâˆ’1)ï¼Œå¾—åˆ°ä¸‹ä¸€ä½ç½®çš„å‚æ•°è¿‘ä¼¼å€¼ï¼Œè¿™é‡Œçš„å‚æ•°æ˜¯ä¸€ä¸ªç²—ç•¥çš„æ¦‚å¿µã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸æ˜¯é€šè¿‡è®¡ç®—å½“å‰å‚æ•°Î¸çš„æ¢¯åº¦å€¼ï¼Œè€Œæ˜¯é€šè¿‡ç›¸å…³å‚æ•°çš„å¤§è‡´æœªæ¥ä½ç½®ï¼Œæ¥æœ‰æ•ˆåœ°é¢„çŸ¥æœªæ¥ï¼š\nV(t)=Î³V(tâˆ’1)+Î·âˆ‡(Î¸)J( Î¸âˆ’Î³V(tâˆ’1) )ï¼Œç„¶åä½¿ç”¨Î¸=Î¸âˆ’V(t)æ¥æ›´æ–°å‚æ•°ã€‚\nç°åœ¨ï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç½‘ç»œæ›´æ–°ä¸è¯¯å·®å‡½æ•°çš„æ–œç‡ç›¸é€‚åº”ï¼Œå¹¶ä¾æ¬¡åŠ é€ŸSGDï¼Œä¹Ÿå¯æ ¹æ®æ¯ä¸ªå‚æ•°çš„é‡è¦æ€§æ¥è°ƒæ•´å’Œæ›´æ–°å¯¹åº”å‚æ•°ï¼Œä»¥æ‰§è¡Œæ›´å¤§æˆ–æ›´å°çš„æ›´æ–°å¹…åº¦ã€‚\n3. Adagradæ–¹æ³•\nAdagradæ–¹æ³•æ˜¯é€šè¿‡å‚æ•°æ¥è°ƒæ•´åˆé€‚çš„å­¦ä¹ ç‡Î·ï¼Œå¯¹ç¨€ç–å‚æ•°è¿›è¡Œå¤§å¹…æ›´æ–°å’Œå¯¹é¢‘ç¹å‚æ•°è¿›è¡Œå°å¹…æ›´æ–°ã€‚å› æ­¤ï¼ŒAdagradæ–¹æ³•éå¸¸é€‚åˆå¤„ç†ç¨€ç–æ•°æ®ã€‚\nåœ¨æ—¶é—´æ­¥é•¿ä¸­ï¼ŒAdagradæ–¹æ³•åŸºäºæ¯ä¸ªå‚æ•°è®¡ç®—çš„è¿‡å¾€æ¢¯åº¦ï¼Œä¸ºä¸åŒå‚æ•°Î¸è®¾ç½®ä¸åŒçš„å­¦ä¹ ç‡ã€‚\nå…ˆå‰ï¼Œæ¯ä¸ªå‚æ•°Î¸(i)ä½¿ç”¨ç›¸åŒçš„å­¦ä¹ ç‡ï¼Œæ¯æ¬¡ä¼šå¯¹æ‰€æœ‰å‚æ•°Î¸è¿›è¡Œæ›´æ–°ã€‚åœ¨æ¯ä¸ªæ—¶é—´æ­¥tä¸­ï¼ŒAdagradæ–¹æ³•ä¸ºæ¯ä¸ªå‚æ•°Î¸é€‰å–ä¸åŒçš„å­¦ä¹ ç‡ï¼Œæ›´æ–°å¯¹åº”å‚æ•°ï¼Œç„¶åè¿›è¡Œå‘é‡åŒ–ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬æŠŠåœ¨tæ—¶åˆ»å‚æ•°Î¸(i)çš„æŸå¤±å‡½æ•°æ¢¯åº¦è®¾ä¸ºg(t,i)ã€‚\n**å›¾3ï¼š**å‚æ•°æ›´æ–°å…¬å¼ Adagradæ–¹æ³•æ˜¯åœ¨æ¯ä¸ªæ—¶é—´æ­¥ä¸­ï¼Œæ ¹æ®è¿‡å¾€å·²è®¡ç®—çš„å‚æ•°æ¢¯åº¦ï¼Œæ¥ä¸ºæ¯ä¸ªå‚æ•°Î¸(i)ä¿®æ”¹å¯¹åº”çš„å­¦ä¹ ç‡Î·ã€‚\nAdagradæ–¹æ³•çš„ä¸»è¦å¥½å¤„æ˜¯ï¼Œä¸éœ€è¦æ‰‹å·¥æ¥è°ƒæ•´å­¦ä¹ ç‡ã€‚å¤§å¤šæ•°å‚æ•°ä½¿ç”¨äº†é»˜è®¤å€¼0.01ï¼Œä¸”ä¿æŒä¸å˜ã€‚\nAdagradæ–¹æ³•çš„ä¸»è¦ç¼ºç‚¹æ˜¯ï¼Œå­¦ä¹ ç‡Î·æ€»æ˜¯åœ¨é™ä½å’Œè¡°å‡ã€‚\nå› ä¸ºæ¯ä¸ªé™„åŠ é¡¹éƒ½æ˜¯æ­£çš„ï¼Œåœ¨åˆ†æ¯ä¸­ç´¯ç§¯äº†å¤šä¸ªå¹³æ–¹æ¢¯åº¦å€¼ï¼Œæ•…ç´¯ç§¯çš„æ€»å’Œåœ¨è®­ç»ƒæœŸé—´ä¿æŒå¢é•¿ã€‚è¿™åè¿‡æ¥åˆå¯¼è‡´å­¦ä¹ ç‡ä¸‹é™ï¼Œå˜ä¸ºå¾ˆå°æ•°é‡çº§çš„æ•°å­—ï¼Œè¯¥æ¨¡å‹å®Œå…¨åœæ­¢å­¦ä¹ ï¼Œåœæ­¢è·å–æ–°çš„é¢å¤–çŸ¥è¯†ã€‚\nå› ä¸ºéšç€å­¦ä¹ é€Ÿåº¦çš„è¶Šæ¥è¶Šå°ï¼Œæ¨¡å‹çš„å­¦ä¹ èƒ½åŠ›è¿…é€Ÿé™ä½ï¼Œè€Œä¸”æ”¶æ•›é€Ÿåº¦éå¸¸æ…¢ï¼Œéœ€è¦å¾ˆé•¿çš„è®­ç»ƒå’Œå­¦ä¹ ï¼Œå³å­¦ä¹ é€Ÿåº¦é™ä½ã€‚\nå¦ä¸€ä¸ªå«åšAdadeltaçš„ç®—æ³•æ”¹å–„äº†è¿™ä¸ªå­¦ä¹ ç‡ä¸æ–­è¡°å‡çš„é—®é¢˜ã€‚\n4. AdaDeltaæ–¹æ³•\nè¿™æ˜¯ä¸€ä¸ªAdaGradçš„å»¶ä¼¸æ–¹æ³•ï¼Œå®ƒå€¾å‘äºè§£å†³å…¶å­¦ä¹ ç‡è¡°å‡çš„é—®é¢˜ã€‚Adadeltaä¸æ˜¯ç´¯ç§¯æ‰€æœ‰ä¹‹å‰çš„å¹³æ–¹æ¢¯åº¦ï¼Œè€Œæ˜¯å°†ç´¯ç§¯ä¹‹å‰æ¢¯åº¦çš„çª—å£é™åˆ¶åˆ°æŸä¸ªå›ºå®šå¤§å°wã€‚\nä¸ä¹‹å‰æ— æ•ˆåœ°å­˜å‚¨wå…ˆå‰çš„å¹³æ–¹æ¢¯åº¦ä¸åŒï¼Œæ¢¯åº¦çš„å’Œè¢«é€’å½’åœ°å®šä¹‰ä¸ºæ‰€æœ‰å…ˆå‰å¹³æ–¹æ¢¯åº¦çš„è¡°å‡å¹³å‡å€¼ã€‚ä½œä¸ºä¸åŠ¨é‡é¡¹ç›¸ä¼¼çš„åˆ†æ•°Î³ï¼Œåœ¨tæ—¶åˆ»çš„æ»‘åŠ¨å¹³å‡å€¼EgÂ²ä»…ä»…å–å†³äºå…ˆå‰çš„å¹³å‡å€¼å’Œå½“å‰æ¢¯åº¦å€¼ã€‚\nEgÂ²=Î³.EgÂ²+(1âˆ’Î³).gÂ²(t)ï¼Œå…¶ä¸­Î³è®¾ç½®ä¸ºä¸åŠ¨é‡é¡¹ç›¸è¿‘çš„å€¼ï¼Œçº¦ä¸º0.9ã€‚\nÎ”Î¸(t)=âˆ’Î·â‹…g(t,i).\nÎ¸(t+1)=Î¸(t)+Î”Î¸(t)\n**å›¾4ï¼š**å‚æ•°æ›´æ–°çš„æœ€ç»ˆå…¬å¼ AdaDeltaæ–¹æ³•çš„å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œå·²ç»ä¸éœ€è¦è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„å­¦ä¹ ç‡ã€‚\nç›®å‰å·²å®Œæˆçš„æ”¹è¿› 1) ä¸ºæ¯ä¸ªå‚æ•°è®¡ç®—å‡ºä¸åŒå­¦ä¹ ç‡ï¼›\n2) ä¹Ÿè®¡ç®—äº†åŠ¨é‡é¡¹momentumï¼›\n3) é˜²æ­¢å­¦ä¹ ç‡è¡°å‡æˆ–æ¢¯åº¦æ¶ˆå¤±ç­‰é—®é¢˜çš„å‡ºç°ã€‚\nè¿˜å¯ä»¥åšä»€ä¹ˆæ”¹è¿›ï¼Ÿ åœ¨ä¹‹å‰çš„æ–¹æ³•ä¸­è®¡ç®—äº†æ¯ä¸ªå‚æ•°çš„å¯¹åº”å­¦ä¹ ç‡ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆä¸è®¡ç®—æ¯ä¸ªå‚æ•°çš„å¯¹åº”åŠ¨é‡å˜åŒ–å¹¶ç‹¬ç«‹å­˜å‚¨å‘¢ï¼Ÿè¿™å°±æ˜¯Adamç®—æ³•æå‡ºçš„æ”¹è‰¯ç‚¹ã€‚\nAdamç®—æ³•\nAdamç®—æ³•å³è‡ªé€‚åº”æ—¶åˆ»ä¼°è®¡æ–¹æ³•ï¼ˆAdaptive Moment Estimationï¼‰ï¼Œèƒ½è®¡ç®—æ¯ä¸ªå‚æ•°çš„è‡ªé€‚åº”å­¦ä¹ ç‡ã€‚è¿™ä¸ªæ–¹æ³•ä¸ä»…å­˜å‚¨äº†AdaDeltaå…ˆå‰å¹³æ–¹æ¢¯åº¦çš„æŒ‡æ•°è¡°å‡å¹³å‡å€¼ï¼Œè€Œä¸”ä¿æŒäº†å…ˆå‰æ¢¯åº¦M(t)çš„æŒ‡æ•°è¡°å‡å¹³å‡å€¼ï¼Œè¿™ä¸€ç‚¹ä¸åŠ¨é‡ç±»ä¼¼ï¼š\nM(t)ä¸ºæ¢¯åº¦çš„ç¬¬ä¸€æ—¶åˆ»å¹³å‡å€¼ï¼ŒV(t)ä¸ºæ¢¯åº¦çš„ç¬¬äºŒæ—¶åˆ»éä¸­å¿ƒæ–¹å·®å€¼ã€‚\n**å›¾5ï¼š**ä¸¤ä¸ªå…¬å¼åˆ†åˆ«ä¸ºæ¢¯åº¦çš„ç¬¬ä¸€ä¸ªæ—¶åˆ»å¹³å‡å€¼å’Œç¬¬äºŒä¸ªæ—¶åˆ»æ–¹å·® åˆ™å‚æ•°æ›´æ–°çš„æœ€ç»ˆå…¬å¼ä¸ºï¼š\n**å›¾6ï¼š**å‚æ•°æ›´æ–°çš„æœ€ç»ˆå…¬å¼ å…¶ä¸­ï¼ŒÎ²1è®¾ä¸º0.9ï¼ŒÎ²2è®¾ä¸º0.9999ï¼ŒÏµè®¾ä¸º10-8ã€‚\nåœ¨å®é™…åº”ç”¨ä¸­ï¼ŒAdamæ–¹æ³•æ•ˆæœè‰¯å¥½ã€‚ä¸å…¶ä»–è‡ªé€‚åº”å­¦ä¹ ç‡ç®—æ³•ç›¸æ¯”ï¼Œå…¶æ”¶æ•›é€Ÿåº¦æ›´å¿«ï¼Œå­¦ä¹ æ•ˆæœæ›´ä¸ºæœ‰æ•ˆï¼Œè€Œä¸”å¯ä»¥çº æ­£å…¶ä»–ä¼˜åŒ–æŠ€æœ¯ä¸­å­˜åœ¨çš„é—®é¢˜ï¼Œå¦‚å­¦ä¹ ç‡æ¶ˆå¤±ã€æ”¶æ•›è¿‡æ…¢æˆ–æ˜¯é«˜æ–¹å·®çš„å‚æ•°æ›´æ–°å¯¼è‡´æŸå¤±å‡½æ•°æ³¢åŠ¨è¾ƒå¤§ç­‰é—®é¢˜ã€‚\nå¯¹ä¼˜åŒ–ç®—æ³•è¿›è¡Œå¯è§†åŒ–\n**å›¾8ï¼š**å¯¹éç‚¹è¿›è¡ŒSGDä¼˜åŒ– ä»ä¸Šé¢çš„åŠ¨ç”»å¯ä»¥çœ‹å‡ºï¼Œè‡ªé€‚åº”ç®—æ³•èƒ½å¾ˆå¿«æ”¶æ•›ï¼Œå¹¶å¿«é€Ÿæ‰¾åˆ°å‚æ•°æ›´æ–°ä¸­æ­£ç¡®çš„ç›®æ ‡æ–¹å‘ï¼›è€Œæ ‡å‡†çš„SGDã€NAGå’ŒåŠ¨é‡é¡¹ç­‰æ–¹æ³•æ”¶æ•›ç¼“æ…¢ï¼Œä¸”å¾ˆéš¾æ‰¾åˆ°æ­£ç¡®çš„æ–¹å‘ã€‚\nç»“è®º æˆ‘ä»¬åº”è¯¥ä½¿ç”¨å“ªç§ä¼˜åŒ–å™¨ï¼Ÿ\nåœ¨æ„å»ºç¥ç»ç½‘ç»œæ¨¡å‹æ—¶ï¼Œé€‰æ‹©å‡ºæœ€ä½³çš„ä¼˜åŒ–å™¨ï¼Œä»¥ä¾¿å¿«é€Ÿæ”¶æ•›å¹¶æ­£ç¡®å­¦ä¹ ï¼ŒåŒæ—¶è°ƒæ•´å†…éƒ¨å‚æ•°ï¼Œæœ€å¤§ç¨‹åº¦åœ°æœ€å°åŒ–æŸå¤±å‡½æ•°ã€‚\nAdamåœ¨å®é™…åº”ç”¨ä¸­æ•ˆæœè‰¯å¥½ï¼Œè¶…è¿‡äº†å…¶ä»–çš„è‡ªé€‚åº”æŠ€æœ¯ã€‚\n**å¦‚æœè¾“å…¥æ•°æ®é›†æ¯”è¾ƒç¨€ç–ï¼ŒSGDã€NAGå’ŒåŠ¨é‡é¡¹ç­‰æ–¹æ³•å¯èƒ½æ•ˆæœä¸å¥½ã€‚**å› æ­¤å¯¹äºç¨€ç–æ•°æ®é›†ï¼Œåº”è¯¥ä½¿ç”¨æŸç§è‡ªé€‚åº”å­¦ä¹ ç‡çš„æ–¹æ³•ï¼Œä¸”å¦ä¸€å¥½å¤„ä¸ºä¸éœ€è¦äººä¸ºè°ƒæ•´å­¦ä¹ ç‡ï¼Œä½¿ç”¨é»˜è®¤å‚æ•°å°±å¯èƒ½è·å¾—æœ€ä¼˜å€¼ã€‚\nå¦‚æœæƒ³ä½¿è®­ç»ƒæ·±å±‚ç½‘ç»œæ¨¡å‹å¿«é€Ÿæ”¶æ•›æˆ–æ‰€æ„å»ºçš„ç¥ç»ç½‘ç»œè¾ƒä¸ºå¤æ‚ï¼Œåˆ™åº”è¯¥ä½¿ç”¨Adamæˆ–å…¶ä»–è‡ªé€‚åº”å­¦ä¹ é€Ÿç‡çš„æ–¹æ³•ï¼Œå› ä¸ºè¿™äº›æ–¹æ³•çš„å®é™…æ•ˆæœæ›´ä¼˜ã€‚\nå¸Œæœ›ä½ èƒ½é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œå¾ˆå¥½åœ°ç†è§£ä¸åŒä¼˜åŒ–ç®—æ³•é—´çš„ç‰¹æ€§å·®å¼‚ã€‚\nç›¸å…³é“¾æ¥ï¼š äºŒé˜¶ä¼˜åŒ–ç®—æ³•ï¼š https://web.stanford.edu/class/msande311/lecture13.pdf\nNesterovæ¢¯åº¦åŠ é€Ÿæ³•ï¼šhttp://cs231n.github.io/neural-networks-3/\n","permalink":"https://reid00.github.io/en/posts/ml/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%B9%8B%E4%BC%98%E5%8C%96%E7%AE%97%E6%B3%95/","summary":"åœ¨è°ƒæ•´æ¨¡å‹æ›´æ–°æƒé‡å’Œåå·®å‚æ•°çš„æ–¹å¼æ—¶ï¼Œä½ æ˜¯å¦è€ƒè™‘è¿‡å“ªç§ä¼˜åŒ–ç®—æ³•èƒ½ä½¿æ¨¡å‹äº§ç”Ÿæ›´å¥½ä¸”æ›´å¿«çš„æ•ˆæœï¼Ÿåº”è¯¥ç”¨æ¢¯åº¦ä¸‹é™ï¼Œéšæœºæ¢¯åº¦ä¸‹é™ï¼Œè¿˜æ˜¯Adamæ–¹æ³•ï¼Ÿ\nè¿™ç¯‡æ–‡ç« ä»‹ç»äº†ä¸åŒä¼˜åŒ–ç®—æ³•ä¹‹é—´çš„ä¸»è¦åŒºåˆ«ï¼Œä»¥åŠå¦‚ä½•é€‰æ‹©æœ€ä½³çš„ä¼˜åŒ–æ–¹æ³•ã€‚\næ¢¯åº¦: æ˜¯å¤šå…ƒå‡½æ•°å¯¹å½“å‰ç»™å®šç‚¹ï¼Œä¸Šå‡æœ€å¿«çš„æ–¹å‘ã€‚æ¢¯åº¦æ˜¯ä¸€ç»„å‘é‡ï¼Œæ‰€ä»¥å¸¦æœ‰æ–¹å‘;\næ¢¯åº¦ä¸‹é™æµç¨‹: https://zhuanlan.zhihu.com/p/68468520 w, b æ¯è½®æ˜¯æ¯ä¸ªæ ·æœ¬çš„æƒé‡æ¢¯åº¦å‘é‡å’Œåå·®æ¢¯åº¦å‘é‡çš„å¹³å‡å€¼ï¼›\næ¢¯åº¦ä¸‹é™æœ¬è´¨æ˜¯æ²¿ç€è´Ÿæ¢¯åº¦å€¼æ–¹å‘å¯»æ‰¾æŸå¤±å‡½æ•°Lossçš„æœ€å°å€¼è§£ æ—¶çš„å‚æ•°w,b , ä»è€Œå¾—å‡ºå¯¹æ ·æœ¬æ•°æ®æ‹Ÿåˆæœ€å¥½çš„å‚æ•°w,bã€‚ https://www.jianshu.com/p/c7e642877b0e\nä»€ä¹ˆæ˜¯ä¼˜åŒ–ç®—æ³•ï¼Ÿ ä¼˜åŒ–ç®—æ³•çš„åŠŸèƒ½ï¼Œæ˜¯é€šè¿‡æ”¹å–„è®­ç»ƒæ–¹å¼ï¼Œæ¥æœ€å°åŒ–(æˆ–æœ€å¤§åŒ–)æŸå¤±å‡½æ•°E(x)ã€‚\næ¨¡å‹å†…éƒ¨æœ‰äº›å‚æ•°ï¼Œæ˜¯ç”¨æ¥è®¡ç®—æµ‹è¯•é›†ä¸­ç›®æ ‡å€¼Yçš„çœŸå®å€¼å’Œé¢„æµ‹å€¼çš„åå·®ç¨‹åº¦çš„ï¼ŒåŸºäºè¿™äº›å‚æ•°ï¼Œå°±å½¢æˆäº†æŸå¤±å‡½æ•°E(x)ã€‚\næ¯”å¦‚è¯´ï¼Œæƒé‡(W)å’Œåå·®(b)å°±æ˜¯è¿™æ ·çš„å†…éƒ¨å‚æ•°ï¼Œä¸€èˆ¬ç”¨äºè®¡ç®—è¾“å‡ºå€¼ï¼Œåœ¨è®­ç»ƒç¥ç»ç½‘ç»œæ¨¡å‹æ—¶èµ·åˆ°ä¸»è¦ä½œç”¨ã€‚\n**åœ¨æœ‰æ•ˆåœ°è®­ç»ƒæ¨¡å‹å¹¶äº§ç”Ÿå‡†ç¡®ç»“æœæ—¶ï¼Œæ¨¡å‹çš„å†…éƒ¨å‚æ•°èµ·åˆ°äº†éå¸¸é‡è¦çš„ä½œç”¨ã€‚**è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åº”è¯¥ç”¨å„ç§ä¼˜åŒ–ç­–ç•¥å’Œç®—æ³•ï¼Œæ¥æ›´æ–°å’Œè®¡ç®—å½±å“æ¨¡å‹è®­ç»ƒå’Œæ¨¡å‹è¾“å‡ºçš„ç½‘ç»œå‚æ•°ï¼Œä½¿å…¶é€¼è¿‘æˆ–è¾¾åˆ°æœ€ä¼˜å€¼ã€‚\nä¼˜åŒ–ç®—æ³•åˆ†ä¸ºä¸¤å¤§ç±»ï¼š\n1. ä¸€é˜¶ä¼˜åŒ–ç®—æ³•\nè¿™ç§ç®—æ³•ä½¿ç”¨å„å‚æ•°çš„æ¢¯åº¦å€¼æ¥æœ€å°åŒ–æˆ–æœ€å¤§åŒ–æŸå¤±å‡½æ•°E(x)ã€‚æœ€å¸¸ç”¨çš„ä¸€é˜¶ä¼˜åŒ–ç®—æ³•æ˜¯æ¢¯åº¦ä¸‹é™ã€‚\nå‡½æ•°æ¢¯åº¦ï¼šå¯¼æ•°dy/dxçš„å¤šå˜é‡è¡¨è¾¾å¼ï¼Œç”¨æ¥è¡¨ç¤ºyç›¸å¯¹äºxçš„ç¬æ—¶å˜åŒ–ç‡ã€‚å¾€å¾€ä¸ºäº†è®¡ç®—å¤šå˜é‡å‡½æ•°çš„å¯¼æ•°æ—¶ï¼Œä¼šç”¨æ¢¯åº¦å–ä»£å¯¼æ•°ï¼Œå¹¶ä½¿ç”¨åå¯¼æ•°æ¥è®¡ç®—æ¢¯åº¦ã€‚æ¢¯åº¦å’Œå¯¼æ•°ä¹‹é—´çš„ä¸€ä¸ªä¸»è¦åŒºåˆ«æ˜¯å‡½æ•°çš„æ¢¯åº¦å½¢æˆäº†ä¸€ä¸ªå‘é‡åœºã€‚\nå› æ­¤ï¼Œå¯¹å•å˜é‡å‡½æ•°ï¼Œä½¿ç”¨å¯¼æ•°æ¥åˆ†æï¼›è€Œæ¢¯åº¦æ˜¯åŸºäºå¤šå˜é‡å‡½æ•°è€Œäº§ç”Ÿçš„ã€‚æ›´å¤šç†è®ºç»†èŠ‚åœ¨è¿™é‡Œä¸å†è¿›è¡Œè¯¦ç»†è§£é‡Šã€‚\n2. äºŒé˜¶ä¼˜åŒ–ç®—æ³•\näºŒé˜¶ä¼˜åŒ–ç®—æ³•ä½¿ç”¨äº†äºŒé˜¶å¯¼æ•°(ä¹Ÿå«åšHessianæ–¹æ³•)æ¥æœ€å°åŒ–æˆ–æœ€å¤§åŒ–æŸå¤±å‡½æ•°ã€‚ç”±äºäºŒé˜¶å¯¼æ•°çš„è®¡ç®—æˆæœ¬å¾ˆé«˜ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•å¹¶æ²¡æœ‰å¹¿æ³›ä½¿ç”¨ã€‚\nè¯¦è§£å„ç§ç¥ç»ç½‘ç»œä¼˜åŒ–ç®—æ³• æ¢¯åº¦ä¸‹é™ åœ¨è®­ç»ƒå’Œä¼˜åŒ–æ™ºèƒ½ç³»ç»Ÿæ—¶ï¼Œæ¢¯åº¦ä¸‹é™æ˜¯ä¸€ç§æœ€é‡è¦çš„æŠ€æœ¯å’ŒåŸºç¡€ã€‚æ¢¯åº¦ä¸‹é™çš„åŠŸèƒ½æ˜¯ï¼š\né€šè¿‡å¯»æ‰¾æœ€å°å€¼ï¼Œæ§åˆ¶æ–¹å·®ï¼Œæ›´æ–°æ¨¡å‹å‚æ•°ï¼Œæœ€ç»ˆä½¿æ¨¡å‹æ”¶æ•›ã€‚\nç½‘ç»œæ›´æ–°å‚æ•°çš„å…¬å¼ä¸ºï¼šÎ¸=Î¸âˆ’Î·Ã—âˆ‡(Î¸).J(Î¸)â€Šï¼Œå…¶ä¸­Î·æ˜¯å­¦ä¹ ç‡ï¼Œâˆ‡(Î¸).J(Î¸)æ˜¯æŸå¤±å‡½æ•°J(Î¸)çš„æ¢¯åº¦ã€‚\nè¿™æ˜¯åœ¨ç¥ç»ç½‘ç»œä¸­æœ€å¸¸ç”¨çš„ä¼˜åŒ–ç®—æ³•ã€‚\nå¦‚ä»Šï¼Œæ¢¯åº¦ä¸‹é™ä¸»è¦ç”¨äºåœ¨ç¥ç»ç½‘ç»œæ¨¡å‹ä¸­è¿›è¡Œæƒé‡æ›´æ–°ï¼Œå³åœ¨ä¸€ä¸ªæ–¹å‘ä¸Šæ›´æ–°å’Œè°ƒæ•´æ¨¡å‹çš„å‚æ•°ï¼Œæ¥æœ€å°åŒ–æŸå¤±å‡½æ•°ã€‚\n2006å¹´å¼•å…¥çš„åå‘ä¼ æ’­æŠ€æœ¯ï¼Œä½¿å¾—è®­ç»ƒæ·±å±‚ç¥ç»ç½‘ç»œæˆä¸ºå¯èƒ½ã€‚åå‘ä¼ æ’­æŠ€æœ¯æ˜¯å…ˆåœ¨å‰å‘ä¼ æ’­ä¸­è®¡ç®—è¾“å…¥ä¿¡å·çš„ä¹˜ç§¯åŠå…¶å¯¹åº”çš„æƒé‡ï¼Œç„¶åå°†æ¿€æ´»å‡½æ•°ä½œç”¨äºè¿™äº›ä¹˜ç§¯çš„æ€»å’Œã€‚è¿™ç§å°†è¾“å…¥ä¿¡å·è½¬æ¢ä¸ºè¾“å‡ºä¿¡å·çš„æ–¹å¼ï¼Œæ˜¯ä¸€ç§å¯¹å¤æ‚éçº¿æ€§å‡½æ•°è¿›è¡Œå»ºæ¨¡çš„é‡è¦æ‰‹æ®µï¼Œå¹¶å¼•å…¥äº†éçº¿æ€§æ¿€æ´»å‡½æ•°ï¼Œä½¿å¾—æ¨¡å‹èƒ½å¤Ÿå­¦ä¹ åˆ°å‡ ä¹ä»»æ„å½¢å¼çš„å‡½æ•°æ˜ å°„ã€‚ç„¶åï¼Œåœ¨ç½‘ç»œçš„åå‘ä¼ æ’­è¿‡ç¨‹ä¸­å›ä¼ ç›¸å…³è¯¯å·®ï¼Œä½¿ç”¨æ¢¯åº¦ä¸‹é™æ›´æ–°æƒé‡å€¼ï¼Œé€šè¿‡è®¡ç®—è¯¯å·®å‡½æ•°Eç›¸å¯¹äºæƒé‡å‚æ•°Wçš„æ¢¯åº¦ï¼Œåœ¨æŸå¤±å‡½æ•°æ¢¯åº¦çš„ç›¸åæ–¹å‘ä¸Šæ›´æ–°æƒé‡å‚æ•°ã€‚\n**å›¾1ï¼š**æƒé‡æ›´æ–°æ–¹å‘ä¸æ¢¯åº¦æ–¹å‘ç›¸å å›¾1æ˜¾ç¤ºäº†æƒé‡æ›´æ–°è¿‡ç¨‹ä¸æ¢¯åº¦çŸ¢é‡è¯¯å·®çš„æ–¹å‘ç›¸åï¼Œå…¶ä¸­Uå½¢æ›²çº¿ä¸ºæ¢¯åº¦ã€‚è¦æ³¨æ„åˆ°ï¼Œå½“æƒé‡å€¼Wå¤ªå°æˆ–å¤ªå¤§æ—¶ï¼Œä¼šå­˜åœ¨è¾ƒå¤§çš„è¯¯å·®ï¼Œéœ€è¦æ›´æ–°å’Œä¼˜åŒ–æƒé‡ï¼Œä½¿å…¶è½¬åŒ–ä¸ºåˆé€‚å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬è¯•å›¾åœ¨ä¸æ¢¯åº¦ç›¸åçš„æ–¹å‘æ‰¾åˆ°ä¸€ä¸ªå±€éƒ¨æœ€ä¼˜å€¼ã€‚\næ¢¯åº¦ä¸‹é™çš„å˜ä½“ ä¼ ç»Ÿçš„æ‰¹é‡æ¢¯åº¦ä¸‹é™å°†è®¡ç®—æ•´ä¸ªæ•°æ®é›†æ¢¯åº¦ï¼Œä½†åªä¼šè¿›è¡Œä¸€æ¬¡æ›´æ–°ï¼Œå› æ­¤åœ¨å¤„ç†å¤§å‹æ•°æ®é›†æ—¶é€Ÿåº¦å¾ˆæ…¢ä¸”éš¾ä»¥æ§åˆ¶ï¼Œç”šè‡³å¯¼è‡´å†…å­˜æº¢å‡ºã€‚\næƒé‡æ›´æ–°çš„å¿«æ…¢æ˜¯ç”±å­¦ä¹ ç‡Î·å†³å®šçš„ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å‡¸é¢è¯¯å·®æ›²é¢ä¸­æ”¶æ•›åˆ°å…¨å±€æœ€ä¼˜å€¼ï¼Œåœ¨éå‡¸æ›²é¢ä¸­å¯èƒ½è¶‹äºå±€éƒ¨æœ€ä¼˜å€¼ã€‚\nä½¿ç”¨æ ‡å‡†å½¢å¼çš„æ‰¹é‡æ¢¯åº¦ä¸‹é™è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨è®­ç»ƒå¤§å‹æ•°æ®é›†æ—¶å­˜åœ¨å†—ä½™çš„æƒé‡æ›´æ–°ã€‚\næ ‡å‡†æ¢¯åº¦ä¸‹é™çš„ä¸Šè¿°é—®é¢˜åœ¨éšæœºæ¢¯åº¦ä¸‹é™æ–¹æ³•ä¸­å¾—åˆ°äº†è§£å†³ã€‚\n1. éšæœºæ¢¯åº¦ä¸‹é™(SDG)\néšæœºæ¢¯åº¦ä¸‹é™ï¼ˆStochastic gradient descentï¼ŒSGDï¼‰å¯¹æ¯ä¸ªè®­ç»ƒæ ·æœ¬è¿›è¡Œå‚æ•°æ›´æ–°ï¼Œæ¯æ¬¡æ‰§è¡Œéƒ½è¿›è¡Œä¸€æ¬¡æ›´æ–°ï¼Œä¸”æ‰§è¡Œé€Ÿåº¦æ›´å¿«ã€‚\nÎ¸=Î¸âˆ’Î·â‹…âˆ‡(Î¸) Ã— J(Î¸;x(i);y(i))ï¼Œå…¶ä¸­x(i)å’Œy(i)ä¸ºè®­ç»ƒæ ·æœ¬ã€‚\né¢‘ç¹çš„æ›´æ–°ä½¿å¾—å‚æ•°é—´å…·æœ‰é«˜æ–¹å·®ï¼ŒæŸå¤±å‡½æ•°ä¼šä»¥ä¸åŒçš„å¼ºåº¦æ³¢åŠ¨ã€‚è¿™å®é™…ä¸Šæ˜¯ä¸€ä»¶å¥½äº‹ï¼Œå› ä¸ºå®ƒæœ‰åŠ©äºæˆ‘ä»¬å‘ç°æ–°çš„å’Œå¯èƒ½æ›´ä¼˜çš„å±€éƒ¨æœ€å°å€¼ï¼Œè€Œæ ‡å‡†æ¢¯åº¦ä¸‹é™å°†åªä¼šæ”¶æ•›åˆ°æŸä¸ªå±€éƒ¨æœ€ä¼˜å€¼ã€‚\nä½†SGDçš„é—®é¢˜æ˜¯ï¼Œç”±äºé¢‘ç¹çš„æ›´æ–°å’Œæ³¢åŠ¨ï¼Œæœ€ç»ˆå°†æ”¶æ•›åˆ°æœ€å°é™åº¦ï¼Œå¹¶ä¼šå› æ³¢åŠ¨é¢‘ç¹å­˜åœ¨è¶…è°ƒé‡ã€‚\nè™½ç„¶å·²ç»è¡¨æ˜ï¼Œå½“ç¼“æ…¢é™ä½å­¦ä¹ ç‡Î·æ—¶ï¼Œæ ‡å‡†æ¢¯åº¦ä¸‹é™çš„æ”¶æ•›æ¨¡å¼ä¸SGDçš„æ¨¡å¼ç›¸åŒã€‚\n**å›¾2ï¼š**æ¯ä¸ªè®­ç»ƒæ ·æœ¬ä¸­é«˜æ–¹å·®çš„å‚æ•°æ›´æ–°ä¼šå¯¼è‡´æŸå¤±å‡½æ•°å¤§å¹…æ³¢åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬å¯èƒ½æ— æ³•è·å¾—ç»™å‡ºæŸå¤±å‡½æ•°çš„æœ€å°å€¼ã€‚ å¦ä¸€ç§ç§°ä¸ºâ€œå°æ‰¹é‡æ¢¯åº¦ä¸‹é™â€çš„å˜ä½“ï¼Œåˆ™å¯ä»¥è§£å†³é«˜æ–¹å·®çš„å‚æ•°æ›´æ–°å’Œä¸ç¨³å®šæ”¶æ•›çš„é—®é¢˜ã€‚\n2. å°æ‰¹é‡æ¢¯åº¦ä¸‹é™\nä¸ºäº†é¿å…SGDå’Œæ ‡å‡†æ¢¯åº¦ä¸‹é™ä¸­å­˜åœ¨çš„é—®é¢˜ï¼Œä¸€ä¸ªæ”¹è¿›æ–¹æ³•ä¸ºå°æ‰¹é‡æ¢¯åº¦ä¸‹é™ï¼ˆMini Batch Gradient Descentï¼‰ï¼Œå› ä¸ºå¯¹æ¯ä¸ªæ‰¹æ¬¡ä¸­çš„nä¸ªè®­ç»ƒæ ·æœ¬ï¼Œè¿™ç§æ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡æ›´æ–°ã€‚\nä½¿ç”¨å°æ‰¹é‡æ¢¯åº¦ä¸‹é™çš„ä¼˜ç‚¹æ˜¯ï¼š\n1) å¯ä»¥å‡å°‘å‚æ•°æ›´æ–°çš„æ³¢åŠ¨ï¼Œæœ€ç»ˆå¾—åˆ°æ•ˆæœæ›´å¥½å’Œæ›´ç¨³å®šçš„æ”¶æ•›ã€‚\n2) è¿˜å¯ä»¥ä½¿ç”¨æœ€æ–°çš„æ·±å±‚å­¦ä¹ åº“ä¸­é€šç”¨çš„çŸ©é˜µä¼˜åŒ–æ–¹æ³•ï¼Œä½¿è®¡ç®—å°æ‰¹é‡æ•°æ®çš„æ¢¯åº¦æ›´åŠ é«˜æ•ˆã€‚\n3) é€šå¸¸æ¥è¯´ï¼Œå°æ‰¹é‡æ ·æœ¬çš„å¤§å°èŒƒå›´æ˜¯ä»50åˆ°256ï¼Œå¯ä»¥æ ¹æ®å®é™…é—®é¢˜è€Œæœ‰æ‰€ä¸åŒã€‚","title":"æœºå™¨å­¦ä¹ ä¹‹ä¼˜åŒ–ç®—æ³•"},{"content":"æœºå™¨å­¦ä¹ å¸¸è§è·ç¦»ä»‹ç» 1. æ¬§å¼è·ç¦» 2. æ›¼å“ˆé¡¿è·ç¦» æˆ‘ä»¬å¯ä»¥å®šä¹‰æ›¼å“ˆé¡¿è·ç¦»çš„æ­£å¼æ„ä¹‰ä¸ºL1-è·ç¦»æˆ–åŸå¸‚åŒºå—è·ç¦»ï¼Œä¹Ÿå°±æ˜¯åœ¨æ¬§å‡ é‡Œå¾—ç©ºé—´çš„å›ºå®šç›´è§’åæ ‡ç³»ä¸Šä¸¤ç‚¹æ‰€å½¢æˆçš„çº¿æ®µå¯¹è½´äº§ç”Ÿçš„æŠ•å½±çš„è·ç¦»æ€»å’Œã€‚ä¾‹å¦‚åœ¨å¹³é¢ä¸Šï¼Œåæ ‡ï¼ˆx1, y1ï¼‰çš„ç‚¹P1ä¸åæ ‡ï¼ˆx2, y2ï¼‰çš„ç‚¹P2çš„æ›¼å“ˆé¡¿è·ç¦»ä¸ºï¼šï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œæ›¼å“ˆé¡¿è·ç¦»ä¾èµ–åº§æ ‡ç³»ç»Ÿçš„è½¬åº¦ï¼Œè€Œéç³»ç»Ÿåœ¨åº§æ ‡è½´ä¸Šçš„å¹³ç§»æˆ–æ˜ å°„ã€‚ é€šä¿—æ¥è®²ï¼Œæƒ³è±¡ä½ åœ¨æ›¼å“ˆé¡¿è¦ä»ä¸€ä¸ªåå­—è·¯å£å¼€è½¦åˆ°å¦å¤–ä¸€ä¸ªåå­—è·¯å£ï¼Œé©¾é©¶è·ç¦»æ˜¯ä¸¤ç‚¹é—´çš„ç›´çº¿è·ç¦»å—ï¼Ÿæ˜¾ç„¶ä¸æ˜¯ï¼Œé™¤éä½ èƒ½ç©¿è¶Šå¤§æ¥¼ã€‚è€Œå®é™…é©¾é©¶è·ç¦»å°±æ˜¯è¿™ä¸ªâ€œæ›¼å“ˆé¡¿è·ç¦»â€ï¼Œæ­¤å³æ›¼å“ˆé¡¿è·ç¦»åç§°çš„æ¥æºï¼Œ åŒæ—¶ï¼Œæ›¼å“ˆé¡¿è·ç¦»ä¹Ÿç§°ä¸ºåŸå¸‚è¡—åŒºè·ç¦»(City Block distance)ã€‚\n3. åˆ‡æ¯”é›ªå¤«è·ç¦» è‹¥äºŒä¸ªå‘é‡æˆ–äºŒä¸ªç‚¹p ã€and qï¼Œå…¶åº§æ ‡åˆ†åˆ«ä¸ºp1,p2 4. é—µå¯å¤«æ–¯åŸºè·ç¦»(Minkowski Distance) é—µæ°è·ç¦»ä¸æ˜¯ä¸€ç§è·ç¦»ï¼Œè€Œæ˜¯ä¸€ç»„è·ç¦»çš„å®šä¹‰.\n(1) é—µæ°è·ç¦»çš„å®šä¹‰ ä¸¤ä¸ªnç»´å˜é‡a(x11,x12,â€¦,x1n)ä¸ b(x21,x22,â€¦,x2n)é—´çš„é—µå¯å¤«æ–¯åŸºè·ç¦»å®šä¹‰ä¸ºï¼š å…¶ä¸­pæ˜¯ä¸€ä¸ªå˜å‚æ•°ã€‚ å½“p=1æ—¶ï¼Œå°±æ˜¯æ›¼å“ˆé¡¿è·ç¦» å½“p=2æ—¶ï¼Œå°±æ˜¯æ¬§æ°è·ç¦» å½“pâ†’âˆæ—¶ï¼Œå°±æ˜¯åˆ‡æ¯”é›ªå¤«è·ç¦» æ ¹æ®å˜å‚æ•°çš„ä¸åŒï¼Œé—µæ°è·ç¦»å¯ä»¥è¡¨ç¤ºä¸€ç±»çš„è·ç¦»ã€‚\n5. æ ‡å‡†åŒ–æ¬§æ°è·ç¦» (Standardized Euclidean distance ) æ ‡å‡†åŒ–æ¬§æ°è·ç¦»æ˜¯é’ˆå¯¹ç®€å•æ¬§æ°è·ç¦»çš„ç¼ºç‚¹è€Œä½œçš„ä¸€ç§æ”¹è¿›æ–¹æ¡ˆã€‚æ ‡å‡†æ¬§æ°è·ç¦»çš„æ€è·¯ï¼šæ—¢ç„¶æ•°æ®å„ç»´åˆ†é‡çš„åˆ†å¸ƒä¸ä¸€æ ·ï¼Œé‚£å…ˆå°†å„ä¸ªåˆ†é‡éƒ½â€œæ ‡å‡†åŒ–â€åˆ°å‡å€¼ã€æ–¹å·®ç›¸ç­‰ã€‚è‡³äºå‡å€¼å’Œæ–¹å·®æ ‡å‡†åŒ–åˆ°å¤šå°‘ï¼Œå…ˆå¤ä¹ ç‚¹ç»Ÿè®¡å­¦çŸ¥è¯†ã€‚\nå‡è®¾æ ·æœ¬é›†Xçš„æ•°å­¦æœŸæœ›æˆ–å‡å€¼(mean)ä¸ºmï¼Œæ ‡å‡†å·®(standard deviationï¼Œæ–¹å·®å¼€æ ¹)ä¸ºsï¼Œé‚£ä¹ˆXçš„â€œæ ‡å‡†åŒ–å˜é‡â€X*è¡¨ç¤ºä¸ºï¼š(X-mï¼‰/sï¼Œè€Œä¸”æ ‡å‡†åŒ–å˜é‡çš„æ•°å­¦æœŸæœ›ä¸º0ï¼Œæ–¹å·®ä¸º1ã€‚\nå³ï¼Œæ ·æœ¬é›†çš„æ ‡å‡†åŒ–è¿‡ç¨‹(standardization)ç”¨å…¬å¼æè¿°å°±æ˜¯ï¼š æ ‡å‡†åŒ–åçš„å€¼ = ( æ ‡å‡†åŒ–å‰çš„å€¼ ï¼ åˆ†é‡çš„å‡å€¼ ) /åˆ†é‡çš„æ ‡å‡†å·®ã€€ç»è¿‡ç®€å•çš„æ¨å¯¼å°±å¯ä»¥å¾—åˆ°ä¸¤ä¸ªnç»´å‘é‡a(x11,x12,â€¦,x1n)ä¸ b(x21,x22,â€¦,x2n)é—´çš„æ ‡å‡†åŒ–æ¬§æ°è·ç¦»çš„å…¬å¼ï¼šã€€å¦‚æœå°†æ–¹å·®çš„å€’æ•°çœ‹æˆæ˜¯ä¸€ä¸ªæƒé‡ï¼Œè¿™ä¸ªå…¬å¼å¯ä»¥çœ‹æˆæ˜¯ä¸€ç§åŠ æƒæ¬§æ°è·ç¦»(Weighted Euclidean distance)ã€‚\n6. é©¬æ°è·ç¦»(Mahalanobis Distance) æœ‰Mä¸ªæ ·æœ¬å‘é‡X1~Xmï¼Œåæ–¹å·®çŸ©é˜µè®°ä¸ºSï¼Œå‡å€¼è®°ä¸ºå‘é‡Î¼ï¼Œåˆ™å…¶ä¸­æ ·æœ¬å‘é‡Xåˆ°uçš„é©¬æ°è·ç¦»è¡¨ç¤ºä¸ºï¼š (åæ–¹å·®çŸ©é˜µä¸­æ¯ä¸ªå…ƒç´ æ˜¯å„ä¸ªçŸ¢é‡å…ƒç´ ä¹‹é—´çš„åæ–¹å·®Cov(X,Y)ï¼ŒCov(X,Y) = E{ [X-E(X)] [Y-E(Y)]}ï¼Œå…¶ä¸­Eä¸ºæ•°å­¦æœŸæœ›ï¼‰\nè€Œå…¶ä¸­å‘é‡Xiä¸Xjä¹‹é—´çš„é©¬æ°è·ç¦»å®šä¹‰ä¸ºï¼š\nè‹¥åæ–¹å·®çŸ©é˜µæ˜¯å•ä½çŸ©é˜µï¼ˆå„ä¸ªæ ·æœ¬å‘é‡ä¹‹é—´ç‹¬ç«‹åŒåˆ†å¸ƒï¼‰,åˆ™å…¬å¼å°±æˆäº†ï¼š ä¹Ÿå°±æ˜¯æ¬§æ°è·ç¦»äº†ã€‚ã€€è‹¥åæ–¹å·®çŸ©é˜µæ˜¯å¯¹è§’çŸ©é˜µï¼Œå…¬å¼å˜æˆäº†æ ‡å‡†åŒ–æ¬§æ°è·ç¦»ã€‚\né©¬æ°è·ç¦»çš„ä¼˜ç¼ºç‚¹ï¼šé‡çº²æ— å…³ï¼Œæ’é™¤å˜é‡ä¹‹é—´çš„ç›¸å…³æ€§çš„å¹²æ‰°ã€‚ ã€Œå¾®åšä¸Šçš„seafoodé«˜æ¸…ç‰ˆç‚¹è¯„é“ï¼šåŸæ¥é©¬æ°è·ç¦»æ˜¯æ ¹æ®åæ–¹å·®çŸ©é˜µæ¼”å˜ï¼Œä¸€ç›´è¢«è€å¸ˆè¯¯å¯¼äº†ï¼Œæ€ªä¸å¾—çœ‹Killianåœ¨05å¹´NIPSå‘è¡¨çš„LMNNè®ºæ–‡æ—¶å€™è€æ˜¯çœ‹åˆ°åæ–¹å·®çŸ©é˜µå’ŒåŠæ­£å®šï¼ŒåŸæ¥æ˜¯è¿™å›äº‹ã€ 7.å·´æ°è·ç¦»ï¼ˆBhattacharyya Distanceï¼‰ åœ¨ç»Ÿè®¡ä¸­ï¼ŒBhattacharyyaè·ç¦»æµ‹é‡ä¸¤ä¸ªç¦»æ•£æˆ–è¿ç»­æ¦‚ç‡åˆ†å¸ƒçš„ç›¸ä¼¼æ€§ã€‚å®ƒä¸è¡¡é‡ä¸¤ä¸ªç»Ÿè®¡æ ·å“æˆ–ç§ç¾¤ä¹‹é—´çš„é‡å é‡çš„Bhattacharyyaç³»æ•°å¯†åˆ‡ç›¸å…³ã€‚Bhattacharyyaè·ç¦»å’ŒBhattacharyyaç³»æ•°ä»¥20ä¸–çºª30å¹´ä»£æ›¾åœ¨å°åº¦ç»Ÿè®¡ç ”ç©¶æ‰€å·¥ä½œçš„ä¸€ä¸ªç»Ÿè®¡å­¦å®¶A. Bhattacharyaå‘½åã€‚åŒæ—¶ï¼ŒBhattacharyyaç³»æ•°å¯ä»¥è¢«ç”¨æ¥ç¡®å®šä¸¤ä¸ªæ ·æœ¬è¢«è®¤ä¸ºç›¸å¯¹æ¥è¿‘çš„ï¼Œå®ƒæ˜¯ç”¨æ¥æµ‹é‡ä¸­çš„ç±»åˆ†ç±»çš„å¯åˆ†ç¦»æ€§ã€‚\n8.æ±‰æ˜è·ç¦»(Hamming distance) ä¸¤ä¸ªç­‰é•¿å­—ç¬¦ä¸²s1ä¸s2ä¹‹é—´çš„æ±‰æ˜è·ç¦»å®šä¹‰ä¸ºå°†å…¶ä¸­ä¸€ä¸ªå˜ä¸ºå¦å¤–ä¸€ä¸ªæ‰€éœ€è¦ä½œçš„æœ€å°æ›¿æ¢æ¬¡æ•°ã€‚ä¾‹å¦‚å­—ç¬¦ä¸²â€œ1111â€ä¸â€œ1001â€ä¹‹é—´çš„æ±‰æ˜è·ç¦»ä¸º2ã€‚åº”ç”¨ï¼šä¿¡æ¯ç¼–ç ï¼ˆä¸ºäº†å¢å¼ºå®¹é”™æ€§ï¼Œåº”ä½¿å¾—ç¼–ç é—´çš„æœ€å°æ±‰æ˜è·ç¦»å°½å¯èƒ½å¤§ï¼‰ã€‚\n9.å¤¹è§’ä½™å¼¦(Cosine) å‡ ä½•ä¸­å¤¹è§’ä½™å¼¦å¯ç”¨æ¥è¡¡é‡ä¸¤ä¸ªå‘é‡æ–¹å‘çš„å·®å¼‚ï¼Œæœºå™¨å­¦ä¹ ä¸­å€Ÿç”¨è¿™ä¸€æ¦‚å¿µæ¥è¡¡é‡æ ·æœ¬å‘é‡ä¹‹é—´çš„å·®å¼‚ã€‚ 0. æ°å¡å¾·ç›¸ä¼¼ç³»æ•°(Jaccard similarity coefficient) (1) æ°å¡å¾·ç›¸ä¼¼ç³»æ•°\nä¸¤ä¸ªé›†åˆAå’ŒBçš„äº¤é›†å…ƒç´ åœ¨Aï¼ŒBçš„å¹¶é›†ä¸­æ‰€å çš„æ¯”ä¾‹ï¼Œç§°ä¸ºä¸¤ä¸ªé›†åˆçš„æ°å¡å¾·ç›¸ä¼¼ç³»æ•°ï¼Œç”¨ç¬¦å·J(A,B)è¡¨ç¤ºã€‚ã€€æ°å¡å¾·ç›¸ä¼¼ç³»æ•°æ˜¯è¡¡é‡ä¸¤ä¸ªé›†åˆçš„ç›¸ä¼¼åº¦ä¸€ç§æŒ‡æ ‡ã€‚\n(2) æ°å¡å¾·è·ç¦»\nä¸æ°å¡å¾·ç›¸ä¼¼ç³»æ•°ç›¸åçš„æ¦‚å¿µæ˜¯æ°å¡å¾·è·ç¦»(Jaccard distance)ã€‚ æ°å¡å¾·è·ç¦»å¯ç”¨å¦‚ä¸‹å…¬å¼è¡¨ç¤ºï¼š æ°å¡å¾·è·ç¦»ç”¨ä¸¤ä¸ªé›†åˆä¸­ä¸åŒå…ƒç´ å æ‰€æœ‰å…ƒç´ çš„æ¯”ä¾‹æ¥è¡¡é‡ä¸¤ä¸ªé›†åˆçš„åŒºåˆ†åº¦ã€‚\n(3) æ°å¡å¾·ç›¸ä¼¼ç³»æ•°ä¸æ°å¡å¾·è·ç¦»çš„åº”ç”¨\nå¯å°†æ°å¡å¾·ç›¸ä¼¼ç³»æ•°ç”¨åœ¨è¡¡é‡æ ·æœ¬çš„ç›¸ä¼¼åº¦ä¸Šã€‚ ä¸¾ä¾‹ï¼šæ ·æœ¬Aä¸æ ·æœ¬Bæ˜¯ä¸¤ä¸ªnç»´å‘é‡ï¼Œè€Œä¸”æ‰€æœ‰ç»´åº¦çš„å–å€¼éƒ½æ˜¯0æˆ–1ï¼Œä¾‹å¦‚ï¼šA(0111)å’ŒB(1011)ã€‚æˆ‘ä»¬å°†æ ·æœ¬çœ‹æˆæ˜¯ä¸€ä¸ªé›†åˆï¼Œ1è¡¨ç¤ºé›†åˆåŒ…å«è¯¥å…ƒç´ ï¼Œ0è¡¨ç¤ºé›†åˆä¸åŒ…å«è¯¥å…ƒç´ ã€‚\nM11 ï¼šæ ·æœ¬Aä¸Béƒ½æ˜¯1çš„ç»´åº¦çš„ä¸ªæ•°\nâ€‹M01ï¼šæ ·æœ¬Aæ˜¯0ï¼Œæ ·æœ¬Bæ˜¯1çš„ç»´åº¦çš„ä¸ªæ•°\nâ€‹M10ï¼šæ ·æœ¬Aæ˜¯1ï¼Œæ ·æœ¬Bæ˜¯0 çš„ç»´åº¦çš„ä¸ªæ•°\nâ€‹M00ï¼šæ ·æœ¬Aä¸Béƒ½æ˜¯0çš„ç»´åº¦çš„ä¸ªæ•°\n11.çš®å°”é€Šç³»æ•°(Pearson Correlation Coefficient) åœ¨å…·ä½“é˜è¿°çš®å°”é€Šç›¸å…³ç³»æ•°ä¹‹å‰ï¼Œæœ‰å¿…è¦è§£é‡Šä¸‹ä»€ä¹ˆæ˜¯ç›¸å…³ç³»æ•° ( Correlation coefficient )ä¸ç›¸å…³è·ç¦»(Correlation distance)ã€‚\nç›¸å…³ç³»æ•° ( Correlation coefficient )çš„å®šä¹‰æ˜¯ï¼š\n(å…¶ä¸­ï¼ŒEä¸ºæ•°å­¦æœŸæœ›æˆ–å‡å€¼ï¼ŒDä¸ºæ–¹å·®ï¼ŒDå¼€æ ¹å·ä¸ºæ ‡å‡†å·®ï¼ŒE{ [X-E(X)] [Y-E(Y)]}ç§°ä¸ºéšæœºå˜é‡Xä¸Yçš„åæ–¹å·®ï¼Œè®°ä¸ºCov(X,Y)ï¼Œå³Cov(X,Y) = E{ [X-E(X)] [Y-E(Y)]}ï¼Œè€Œä¸¤ä¸ªå˜é‡ä¹‹é—´çš„åæ–¹å·®å’Œæ ‡å‡†å·®çš„å•†åˆ™ç§°ä¸ºéšæœºå˜é‡Xä¸Yçš„ç›¸å…³ç³»æ•°ï¼Œè®°ä¸ºPxy) ç›¸å…³ç³»æ•°è¡¡é‡éšæœºå˜é‡Xä¸Yç›¸å…³ç¨‹åº¦çš„ä¸€ç§æ–¹æ³•ï¼Œç›¸å…³ç³»æ•°çš„å–å€¼èŒƒå›´æ˜¯[-1,1]ã€‚ç›¸å…³ç³»æ•°çš„ç»å¯¹å€¼è¶Šå¤§ï¼Œåˆ™è¡¨æ˜Xä¸Yç›¸å…³åº¦è¶Šé«˜ã€‚å½“Xä¸Yçº¿æ€§ç›¸å…³æ—¶ï¼Œç›¸å…³ç³»æ•°å–å€¼ä¸º1ï¼ˆæ­£çº¿æ€§ç›¸å…³ï¼‰æˆ–-1ï¼ˆè´Ÿçº¿æ€§ç›¸å…³ï¼‰ã€‚ å…·ä½“çš„ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªå˜é‡ï¼šXã€Yï¼Œæœ€ç»ˆè®¡ç®—å‡ºçš„ç›¸å…³ç³»æ•°çš„å«ä¹‰å¯ä»¥æœ‰å¦‚ä¸‹ç†è§£ï¼š\nå½“ç›¸å…³ç³»æ•°ä¸º0æ—¶ï¼ŒXå’ŒYä¸¤å˜é‡æ— å…³ç³»ã€‚ å½“Xçš„å€¼å¢å¤§ï¼ˆå‡å°ï¼‰ï¼ŒYå€¼å¢å¤§ï¼ˆå‡å°ï¼‰ï¼Œä¸¤ä¸ªå˜é‡ä¸ºæ­£ç›¸å…³ï¼Œç›¸å…³ç³»æ•°åœ¨0.00ä¸1.00ä¹‹é—´ã€‚ å½“Xçš„å€¼å¢å¤§ï¼ˆå‡å°ï¼‰ï¼ŒYå€¼å‡å°ï¼ˆå¢å¤§ï¼‰ï¼Œä¸¤ä¸ªå˜é‡ä¸ºè´Ÿç›¸å…³ï¼Œç›¸å…³ç³»æ•°åœ¨-1.00ä¸0.00ä¹‹é—´ã€‚ (2)çš®å°”é€Šç›¸å…³ç³»æ•°çš„é€‚ç”¨èŒƒå›´ å½“ä¸¤ä¸ªå˜é‡çš„æ ‡å‡†å·®éƒ½ä¸ä¸ºé›¶æ—¶ï¼Œç›¸å…³ç³»æ•°æ‰æœ‰å®šä¹‰ï¼Œçš®å°”é€Šç›¸å…³ç³»æ•°é€‚ç”¨äºï¼š\nä¸¤ä¸ªå˜é‡ä¹‹é—´æ˜¯çº¿æ€§å…³ç³»ï¼Œéƒ½æ˜¯è¿ç»­æ•°æ®ã€‚ ä¸¤ä¸ªå˜é‡çš„æ€»ä½“æ˜¯æ­£æ€åˆ†å¸ƒï¼Œæˆ–æ¥è¿‘æ­£æ€çš„å•å³°åˆ†å¸ƒã€‚ ä¸¤ä¸ªå˜é‡çš„è§‚æµ‹å€¼æ˜¯æˆå¯¹çš„ï¼Œæ¯å¯¹è§‚æµ‹å€¼ä¹‹é—´ç›¸äº’ç‹¬ç«‹ã€‚ (3)çš®å°”é€Šç›¸å…³çš„çº¦æŸæ¡ä»¶\nä»ä»¥ä¸Šè§£é‡Š, ä¹Ÿå¯ä»¥ç†è§£çš®å°”é€Šç›¸å…³çš„çº¦æŸæ¡ä»¶:\n1 ä¸¤ä¸ªå˜é‡é—´æœ‰çº¿æ€§å…³ç³» 2 å˜é‡æ˜¯è¿ç»­å˜é‡ 3 å˜é‡å‡ç¬¦åˆæ­£æ€åˆ†å¸ƒ,ä¸”äºŒå…ƒåˆ†å¸ƒä¹Ÿç¬¦åˆæ­£æ€åˆ†å¸ƒ 4 ä¸¤å˜é‡ç‹¬ç«‹ åœ¨å®è·µç»Ÿè®¡ä¸­,ä¸€èˆ¬åªè¾“å‡ºä¸¤ä¸ªç³»æ•°,ä¸€ä¸ªæ˜¯ç›¸å…³ç³»æ•°,ä¹Ÿå°±æ˜¯è®¡ç®—å‡ºæ¥çš„ç›¸å…³ç³»æ•°å¤§å°,åœ¨-1åˆ°1ä¹‹é—´;å¦ä¸€ä¸ªæ˜¯ç‹¬ç«‹æ ·æœ¬æ£€éªŒç³»æ•°,ç”¨æ¥æ£€éªŒæ ·æœ¬ä¸€è‡´æ€§\nSummary: ç®€å•è¯´æ¥ï¼Œå„ç§â€œè·ç¦»â€çš„åº”ç”¨åœºæ™¯ç®€å•æ¦‚æ‹¬ä¸ºï¼Œ\nç©ºé—´ï¼šæ¬§æ°è·ç¦»ï¼Œ\nè·¯å¾„ï¼šæ›¼å“ˆé¡¿è·ç¦»ï¼Œ\nå›½é™…è±¡æ£‹å›½ç‹ï¼šåˆ‡æ¯”é›ªå¤«è·ç¦»ï¼Œ\nä»¥ä¸Šä¸‰ç§çš„ç»Ÿä¸€å½¢å¼:é—µå¯å¤«æ–¯åŸºè·ç¦»ï¼Œ\nåŠ æƒï¼šæ ‡å‡†åŒ–æ¬§æ°è·ç¦»ï¼Œ\næ’é™¤é‡çº²å’Œä¾å­˜ï¼šé©¬æ°è·ç¦»ï¼Œ\nå‘é‡å·®è·ï¼šå¤¹è§’ä½™å¼¦ï¼Œ\nç¼–ç å·®åˆ«ï¼šæ±‰æ˜è·ç¦»ï¼Œ\né›†åˆè¿‘ä¼¼åº¦ï¼šæ°å¡å¾·ç±»ä¼¼ç³»æ•°ä¸è·ç¦»ï¼Œ\nç›¸å…³ï¼šç›¸å…³ç³»æ•°ä¸ç›¸å…³è·ç¦»ã€‚\n","permalink":"https://reid00.github.io/en/posts/ml/%E5%B8%B8%E8%A7%81%E8%B7%9D%E7%A6%BB%E7%9A%84%E4%BB%8B%E7%BB%8D/","summary":"æœºå™¨å­¦ä¹ å¸¸è§è·ç¦»ä»‹ç» 1. æ¬§å¼è·ç¦» 2. æ›¼å“ˆé¡¿è·ç¦» æˆ‘ä»¬å¯ä»¥å®šä¹‰æ›¼å“ˆé¡¿è·ç¦»çš„æ­£å¼æ„ä¹‰ä¸ºL1-è·ç¦»æˆ–åŸå¸‚åŒºå—è·ç¦»ï¼Œä¹Ÿå°±æ˜¯åœ¨æ¬§å‡ é‡Œå¾—ç©ºé—´çš„å›ºå®šç›´è§’åæ ‡ç³»ä¸Šä¸¤ç‚¹æ‰€å½¢æˆçš„çº¿æ®µå¯¹è½´äº§ç”Ÿçš„æŠ•å½±çš„è·ç¦»æ€»å’Œã€‚ä¾‹å¦‚åœ¨å¹³é¢ä¸Šï¼Œåæ ‡ï¼ˆx1, y1ï¼‰çš„ç‚¹P1ä¸åæ ‡ï¼ˆx2, y2ï¼‰çš„ç‚¹P2çš„æ›¼å“ˆé¡¿è·ç¦»ä¸ºï¼šï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œæ›¼å“ˆé¡¿è·ç¦»ä¾èµ–åº§æ ‡ç³»ç»Ÿçš„è½¬åº¦ï¼Œè€Œéç³»ç»Ÿåœ¨åº§æ ‡è½´ä¸Šçš„å¹³ç§»æˆ–æ˜ å°„ã€‚ é€šä¿—æ¥è®²ï¼Œæƒ³è±¡ä½ åœ¨æ›¼å“ˆé¡¿è¦ä»ä¸€ä¸ªåå­—è·¯å£å¼€è½¦åˆ°å¦å¤–ä¸€ä¸ªåå­—è·¯å£ï¼Œé©¾é©¶è·ç¦»æ˜¯ä¸¤ç‚¹é—´çš„ç›´çº¿è·ç¦»å—ï¼Ÿæ˜¾ç„¶ä¸æ˜¯ï¼Œé™¤éä½ èƒ½ç©¿è¶Šå¤§æ¥¼ã€‚è€Œå®é™…é©¾é©¶è·ç¦»å°±æ˜¯è¿™ä¸ªâ€œæ›¼å“ˆé¡¿è·ç¦»â€ï¼Œæ­¤å³æ›¼å“ˆé¡¿è·ç¦»åç§°çš„æ¥æºï¼Œ åŒæ—¶ï¼Œæ›¼å“ˆé¡¿è·ç¦»ä¹Ÿç§°ä¸ºåŸå¸‚è¡—åŒºè·ç¦»(City Block distance)ã€‚\n3. åˆ‡æ¯”é›ªå¤«è·ç¦» è‹¥äºŒä¸ªå‘é‡æˆ–äºŒä¸ªç‚¹p ã€and qï¼Œå…¶åº§æ ‡åˆ†åˆ«ä¸ºp1,p2 4. é—µå¯å¤«æ–¯åŸºè·ç¦»(Minkowski Distance) é—µæ°è·ç¦»ä¸æ˜¯ä¸€ç§è·ç¦»ï¼Œè€Œæ˜¯ä¸€ç»„è·ç¦»çš„å®šä¹‰.\n(1) é—µæ°è·ç¦»çš„å®šä¹‰ ä¸¤ä¸ªnç»´å˜é‡a(x11,x12,â€¦,x1n)ä¸ b(x21,x22,â€¦,x2n)é—´çš„é—µå¯å¤«æ–¯åŸºè·ç¦»å®šä¹‰ä¸ºï¼š å…¶ä¸­pæ˜¯ä¸€ä¸ªå˜å‚æ•°ã€‚ å½“p=1æ—¶ï¼Œå°±æ˜¯æ›¼å“ˆé¡¿è·ç¦» å½“p=2æ—¶ï¼Œå°±æ˜¯æ¬§æ°è·ç¦» å½“pâ†’âˆæ—¶ï¼Œå°±æ˜¯åˆ‡æ¯”é›ªå¤«è·ç¦» æ ¹æ®å˜å‚æ•°çš„ä¸åŒï¼Œé—µæ°è·ç¦»å¯ä»¥è¡¨ç¤ºä¸€ç±»çš„è·ç¦»ã€‚\n5. æ ‡å‡†åŒ–æ¬§æ°è·ç¦» (Standardized Euclidean distance ) æ ‡å‡†åŒ–æ¬§æ°è·ç¦»æ˜¯é’ˆå¯¹ç®€å•æ¬§æ°è·ç¦»çš„ç¼ºç‚¹è€Œä½œçš„ä¸€ç§æ”¹è¿›æ–¹æ¡ˆã€‚æ ‡å‡†æ¬§æ°è·ç¦»çš„æ€è·¯ï¼šæ—¢ç„¶æ•°æ®å„ç»´åˆ†é‡çš„åˆ†å¸ƒä¸ä¸€æ ·ï¼Œé‚£å…ˆå°†å„ä¸ªåˆ†é‡éƒ½â€œæ ‡å‡†åŒ–â€åˆ°å‡å€¼ã€æ–¹å·®ç›¸ç­‰ã€‚è‡³äºå‡å€¼å’Œæ–¹å·®æ ‡å‡†åŒ–åˆ°å¤šå°‘ï¼Œå…ˆå¤ä¹ ç‚¹ç»Ÿè®¡å­¦çŸ¥è¯†ã€‚\nå‡è®¾æ ·æœ¬é›†Xçš„æ•°å­¦æœŸæœ›æˆ–å‡å€¼(mean)ä¸ºmï¼Œæ ‡å‡†å·®(standard deviationï¼Œæ–¹å·®å¼€æ ¹)ä¸ºsï¼Œé‚£ä¹ˆXçš„â€œæ ‡å‡†åŒ–å˜é‡â€X*è¡¨ç¤ºä¸ºï¼š(X-mï¼‰/sï¼Œè€Œä¸”æ ‡å‡†åŒ–å˜é‡çš„æ•°å­¦æœŸæœ›ä¸º0ï¼Œæ–¹å·®ä¸º1ã€‚\nå³ï¼Œæ ·æœ¬é›†çš„æ ‡å‡†åŒ–è¿‡ç¨‹(standardization)ç”¨å…¬å¼æè¿°å°±æ˜¯ï¼š æ ‡å‡†åŒ–åçš„å€¼ = ( æ ‡å‡†åŒ–å‰çš„å€¼ ï¼ åˆ†é‡çš„å‡å€¼ ) /åˆ†é‡çš„æ ‡å‡†å·®ã€€ç»è¿‡ç®€å•çš„æ¨å¯¼å°±å¯ä»¥å¾—åˆ°ä¸¤ä¸ªnç»´å‘é‡a(x11,x12,â€¦,x1n)ä¸ b(x21,x22,â€¦,x2n)é—´çš„æ ‡å‡†åŒ–æ¬§æ°è·ç¦»çš„å…¬å¼ï¼šã€€å¦‚æœå°†æ–¹å·®çš„å€’æ•°çœ‹æˆæ˜¯ä¸€ä¸ªæƒé‡ï¼Œè¿™ä¸ªå…¬å¼å¯ä»¥çœ‹æˆæ˜¯ä¸€ç§åŠ æƒæ¬§æ°è·ç¦»(Weighted Euclidean distance)ã€‚\n6. é©¬æ°è·ç¦»(Mahalanobis Distance) æœ‰Mä¸ªæ ·æœ¬å‘é‡X1~Xmï¼Œåæ–¹å·®çŸ©é˜µè®°ä¸ºSï¼Œå‡å€¼è®°ä¸ºå‘é‡Î¼ï¼Œåˆ™å…¶ä¸­æ ·æœ¬å‘é‡Xåˆ°uçš„é©¬æ°è·ç¦»è¡¨ç¤ºä¸ºï¼š (åæ–¹å·®çŸ©é˜µä¸­æ¯ä¸ªå…ƒç´ æ˜¯å„ä¸ªçŸ¢é‡å…ƒç´ ä¹‹é—´çš„åæ–¹å·®Cov(X,Y)ï¼ŒCov(X,Y) = E{ [X-E(X)] [Y-E(Y)]}ï¼Œå…¶ä¸­Eä¸ºæ•°å­¦æœŸæœ›ï¼‰\nè€Œå…¶ä¸­å‘é‡Xiä¸Xjä¹‹é—´çš„é©¬æ°è·ç¦»å®šä¹‰ä¸ºï¼š\nè‹¥åæ–¹å·®çŸ©é˜µæ˜¯å•ä½çŸ©é˜µï¼ˆå„ä¸ªæ ·æœ¬å‘é‡ä¹‹é—´ç‹¬ç«‹åŒåˆ†å¸ƒï¼‰,åˆ™å…¬å¼å°±æˆäº†ï¼š ä¹Ÿå°±æ˜¯æ¬§æ°è·ç¦»äº†ã€‚ã€€è‹¥åæ–¹å·®çŸ©é˜µæ˜¯å¯¹è§’çŸ©é˜µï¼Œå…¬å¼å˜æˆäº†æ ‡å‡†åŒ–æ¬§æ°è·ç¦»ã€‚\né©¬æ°è·ç¦»çš„ä¼˜ç¼ºç‚¹ï¼šé‡çº²æ— å…³ï¼Œæ’é™¤å˜é‡ä¹‹é—´çš„ç›¸å…³æ€§çš„å¹²æ‰°ã€‚ ã€Œå¾®åšä¸Šçš„seafoodé«˜æ¸…ç‰ˆç‚¹è¯„é“ï¼šåŸæ¥é©¬æ°è·ç¦»æ˜¯æ ¹æ®åæ–¹å·®çŸ©é˜µæ¼”å˜ï¼Œä¸€ç›´è¢«è€å¸ˆè¯¯å¯¼äº†ï¼Œæ€ªä¸å¾—çœ‹Killianåœ¨05å¹´NIPSå‘è¡¨çš„LMNNè®ºæ–‡æ—¶å€™è€æ˜¯çœ‹åˆ°åæ–¹å·®çŸ©é˜µå’ŒåŠæ­£å®šï¼ŒåŸæ¥æ˜¯è¿™å›äº‹ã€ 7.å·´æ°è·ç¦»ï¼ˆBhattacharyya Distanceï¼‰ åœ¨ç»Ÿè®¡ä¸­ï¼ŒBhattacharyyaè·ç¦»æµ‹é‡ä¸¤ä¸ªç¦»æ•£æˆ–è¿ç»­æ¦‚ç‡åˆ†å¸ƒçš„ç›¸ä¼¼æ€§ã€‚å®ƒä¸è¡¡é‡ä¸¤ä¸ªç»Ÿè®¡æ ·å“æˆ–ç§ç¾¤ä¹‹é—´çš„é‡å é‡çš„Bhattacharyyaç³»æ•°å¯†åˆ‡ç›¸å…³ã€‚Bhattacharyyaè·ç¦»å’ŒBhattacharyyaç³»æ•°ä»¥20ä¸–çºª30å¹´ä»£æ›¾åœ¨å°åº¦ç»Ÿè®¡ç ”ç©¶æ‰€å·¥ä½œçš„ä¸€ä¸ªç»Ÿè®¡å­¦å®¶A.","title":"å¸¸è§è·ç¦»çš„ä»‹ç»"},{"content":"Summary PCA æ˜¯æ— ç›‘ç£å­¦ä¹ ä¸­æœ€å¸¸è§çš„æ•°æ®é™ç»´æ–¹æ³•ï¼Œä½†æ˜¯å®é™…ä¸Šé—®é¢˜ç‰¹å¾å¾ˆå¤šçš„æƒ…å†µï¼ŒPCAé€šå¸¸ä¼šé¢„å¤„ç†æ¥å‡å°‘ç‰¹å¾ä¸ªæ•°ã€‚\nå°†ç»´çš„æ„ä¹‰ï¼š é€šè¿‡é™ç»´æé«˜ç®—æ³•çš„æ•ˆç‡ é€šè¿‡é™ç»´æ›´æ–¹ä¾¿æ•°æ®çš„å¯è§†åŒ–ï¼Œé€šè¿‡å¯è§†åŒ–æˆ‘ä»¬å¯ä»¥æ›´å¥½çš„ç†è§£æ•°æ®\nç›¸å…³ç»Ÿè®¡æ¦‚å¿µ å‡å€¼ï¼š è¿°çš„æ˜¯æ ·æœ¬é›†åˆçš„ä¸­é—´ç‚¹ã€‚ æ–¹å·®ï¼š æ¦‚ç‡è®ºå’Œç»Ÿè®¡æ–¹å·®è¡¡é‡éšæœºå˜é‡æˆ–ä¸€ç»„æ•°æ®æ—¶ç¦»æ•£ç¨‹åº¦çš„åº¦é‡ã€‚ æ ‡å‡†å·®ï¼šè€Œæ ‡å‡†å·®ç»™æˆ‘ä»¬æè¿°çš„æ˜¯æ ·æœ¬é›†åˆçš„å„ä¸ªæ ·æœ¬ç‚¹åˆ°å‡å€¼çš„è·ç¦»ä¹‹å¹³å‡ã€‚æ–¹å·®å¼€æ ¹å·ã€‚ æ ‡å‡†å·®å’Œæ–¹å·®ä¸€èˆ¬æ˜¯ç”¨æ¥æè¿°ä¸€ç»´æ•°æ®çš„ åæ–¹å·®: ï¼ˆå¤šç»´ï¼‰åº¦é‡ä¸¤ä¸ªéšæœºå˜é‡å…³ç³»çš„ç»Ÿè®¡é‡,æ¥åº¦é‡å„ä¸ªç»´åº¦åç¦»å…¶å‡å€¼çš„ç¨‹åº¦ã€‚ åæ–¹å·®çŸ©é˜µ: ï¼ˆå¤šç»´ï¼‰åº¦é‡å„ä¸ªç»´åº¦åç¦»å…¶å‡å€¼çš„ç¨‹åº¦ å½“ cov(X, Y)\u0026gt;0æ—¶ï¼Œè¡¨æ˜Xä¸Yæ­£ç›¸å…³(Xè¶Šå¤§ï¼ŒYä¹Ÿè¶Šå¤§ï¼›Xè¶Šå°Yï¼Œä¹Ÿè¶Šå°ã€‚) å½“ cov(X, Y)\u0026lt;0æ—¶ï¼Œè¡¨æ˜Xä¸Yè´Ÿç›¸å…³ï¼› å½“ cov(X, Y)=0æ—¶ï¼Œè¡¨æ˜Xä¸Yä¸ç›¸å…³ã€‚ covåæ–¹å·®=[(x1-xå‡å€¼)(y1-yå‡å€¼)+(x2-xå‡å€¼)(y2-yå‡å€¼)+\u0026hellip;+(xn-xå‡å€¼)*(yn-yå‡å€¼)]/(n-1) PCA æ€æƒ³ å¯¹æ•°æ®è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼ˆä»£ç ä¸­å¹¶éè¿™ä¹ˆåšçš„ï¼Œè€Œæ˜¯ç›´æ¥å‡å»å‡å€¼ï¼‰ è®¡ç®—å½’ä¸€åŒ–åçš„æ•°æ®é›†çš„åæ–¹å·®çŸ©é˜µ è®¡ç®—åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ å°†ç‰¹å¾å€¼æ’åº ä¿ç•™å‰Nä¸ªæœ€å¤§çš„ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ å°†æ•°æ®è½¬æ¢åˆ°ä¸Šé¢å¾—åˆ°çš„Nä¸ªç‰¹å¾å‘é‡æ„å»ºçš„æ–°ç©ºé—´ä¸­ï¼ˆå®ç°äº†ç‰¹å¾å‹ç¼©ï¼‰ ç®€è¿°ä¸»æˆåˆ†åˆ†æPCAå·¥ä½œåŸç†ï¼Œä»¥åŠPCAçš„ä¼˜ç¼ºç‚¹ï¼Ÿ PCAæ—¨åœ¨æ‰¾åˆ°æ•°æ®ä¸­çš„ä¸»æˆåˆ†ï¼Œå¹¶åˆ©ç”¨è¿™äº›ä¸»æˆåˆ†è¡¨å¾åŸå§‹æ•°æ®ï¼Œä»è€Œè¾¾åˆ°é™ç»´çš„ç›®çš„ã€‚\nâ€‹ å·¥ä½œåŸç†å¯ç”±ä¸¤ä¸ªè§’åº¦è§£é‡Šï¼Œç¬¬ä¸€ä¸ªæ˜¯æœ€å¤§åŒ–æŠ•å½±æ–¹å·®ï¼ˆè®©æ•°æ®åœ¨ä¸»è½´ä¸ŠæŠ•å½±çš„æ–¹å·®å°½å¯èƒ½å¤§ï¼‰ï¼›ç¬¬äºŒä¸ªæ˜¯æœ€å°åŒ–å¹³æ–¹è¯¯å·®ï¼ˆæ ·æœ¬ç‚¹åˆ°è¶…å¹³é¢çš„å‚ç›´è·ç¦»è¶³å¤Ÿè¿‘ï¼‰ã€‚\nâ€‹ åšæ³•æ˜¯æ•°æ®ä¸­å¿ƒåŒ–ä¹‹åï¼Œå¯¹æ ·æœ¬æ•°æ®åæ–¹å·®çŸ©é˜µè¿›è¡Œç‰¹å¾åˆ†è§£ï¼Œé€‰å–å‰dä¸ªæœ€å¤§çš„ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ï¼Œå³å¯å°†æ•°æ®ä»åŸæ¥çš„pç»´é™åˆ°dç»´ï¼Œä¹Ÿå¯æ ¹æ®å¥‡å¼‚å€¼åˆ†è§£æ¥æ±‚è§£ä¸»æˆåˆ†ã€‚\nä¼˜ç‚¹ï¼š 1.è®¡ç®—ç®€å•ï¼Œæ˜“äºå®ç°\n2.å„ä¸»æˆåˆ†ä¹‹é—´æ­£äº¤ï¼Œå¯æ¶ˆé™¤åŸå§‹æ•°æ®æˆåˆ†é—´çš„ç›¸äº’å½±å“çš„å› ç´ \n3.ä»…ä»…éœ€è¦ä»¥æ–¹å·®è¡¡é‡ä¿¡æ¯é‡ï¼Œä¸å—æ•°æ®é›†ä»¥å¤–çš„å› ç´ å½±å“\n4.é™ç»´ç»´æ•°æœ¨æœ‰é™åˆ¶ï¼Œå¯æ ¹æ®éœ€è¦åˆ¶å®š\nç¼ºç‚¹ï¼š 1.æ— æ³•åˆ©ç”¨ç±»åˆ«çš„å…ˆéªŒä¿¡æ¯\n2.é™ç»´åï¼Œåªä¸æ•°æ®æœ‰å…³ï¼Œä¸»æˆåˆ†å„ä¸ªç»´åº¦çš„å«ä¹‰æ¨¡ç³Šï¼Œä¸æ˜“äºè§£é‡Š\n3.æ–¹å·®å°çš„éä¸»æˆåˆ†ä¹Ÿå¯èƒ½å«æœ‰å¯¹æ ·æœ¬å·®å¼‚çš„é‡è¦ä¿¡æ¯ï¼Œå› é™ç»´ä¸¢å¼ƒå¯èƒ½å¯¹åç»­æ•°æ®å¤„ç†æœ‰å½±å“\n4.çº¿æ€§æ¨¡å‹ï¼Œå¯¹äºå¤æ‚æ•°æ®é›†éš¾ä»¥å¤„ç†ï¼ˆå¯ç”¨æ ¸æ˜ å°„æ–¹å¼æ”¹è¿›ï¼‰\nPCAä¸­æœ‰ç¬¬ä¸€ä¸»æˆåˆ†ã€ç¬¬äºŒä¸»æˆåˆ†ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œåˆæ˜¯å¦‚ä½•ç¡®å®šçš„ï¼Ÿ ä¸»æˆåˆ†åˆ†ææ˜¯è®¾æ³•å°†åŸæ¥ä¼—å¤šå…·æœ‰ä¸€å®šç›¸å…³æ€§ï¼ˆæ¯”å¦‚Pä¸ªæŒ‡æ ‡ï¼‰ï¼Œé‡æ–°ç»„åˆæˆä¸€ç»„æ–°çš„äº’ç›¸æ— å…³çš„ç»¼åˆæŒ‡æ ‡æ¥ä»£æ›¿åŸæ¥çš„æŒ‡æ ‡ã€‚ä¸»æˆåˆ†åˆ†æï¼Œæ˜¯è€ƒå¯Ÿå¤šä¸ªå˜é‡é—´ç›¸å…³æ€§ä¸€ç§å¤šå…ƒç»Ÿè®¡æ–¹æ³•ï¼Œç ”ç©¶å¦‚ä½•é€šè¿‡å°‘æ•°å‡ ä¸ªä¸»æˆåˆ†æ¥æ­ç¤ºå¤šä¸ªå˜é‡é—´çš„å†…éƒ¨ç»“æ„ï¼Œå³ä»åŸå§‹å˜é‡ä¸­å¯¼å‡ºå°‘æ•°å‡ ä¸ªä¸»æˆåˆ†ï¼Œä½¿å®ƒä»¬å°½å¯èƒ½å¤šåœ°ä¿ç•™åŸå§‹å˜é‡çš„ä¿¡æ¯ï¼Œä¸”å½¼æ­¤é—´äº’ä¸ç›¸å…³ï¼Œé€šå¸¸æ•°å­¦ä¸Šçš„å¤„ç†å°±æ˜¯å°†åŸæ¥Pä¸ªæŒ‡æ ‡ä½œçº¿æ€§ç»„åˆï¼Œä½œä¸ºæ–°çš„ç»¼åˆæŒ‡æ ‡ã€‚\nâ€‹ æœ€ç»å…¸çš„åšæ³•å°±æ˜¯ç”¨F1ï¼ˆé€‰å–çš„ç¬¬ä¸€ä¸ªçº¿æ€§ç»„åˆï¼Œå³ç¬¬ä¸€ä¸ªç»¼åˆæŒ‡æ ‡ï¼‰çš„æ–¹å·®æ¥è¡¨è¾¾ï¼Œå³Var(F1)è¶Šå¤§ï¼Œè¡¨ç¤ºF1åŒ…å«çš„ä¿¡æ¯è¶Šå¤šã€‚å› æ­¤åœ¨æ‰€æœ‰çš„çº¿æ€§ç»„åˆä¸­é€‰å–çš„F1åº”è¯¥æ˜¯æ–¹å·®æœ€å¤§çš„ï¼Œæ•…ç§°F1ä¸ºç¬¬ä¸€ä¸»æˆåˆ†ã€‚å¦‚æœç¬¬ä¸€ä¸»æˆåˆ†ä¸è¶³ä»¥ä»£è¡¨åŸæ¥Pä¸ªæŒ‡æ ‡çš„ä¿¡æ¯ï¼Œå†è€ƒè™‘é€‰å–F2å³é€‰ç¬¬äºŒä¸ªçº¿æ€§ç»„åˆï¼Œä¸ºäº†æœ‰æ•ˆåœ°åæ˜ åŸæ¥ä¿¡æ¯ï¼ŒF1å·²æœ‰çš„ä¿¡æ¯å°±ä¸éœ€è¦å†å‡ºç°åœ¨F2ä¸­ï¼Œç”¨æ•°å­¦è¯­è¨€è¡¨è¾¾å°±æ˜¯è¦æ±‚Cov(F1, F2)=0ï¼Œåˆ™ç§°F2ä¸ºç¬¬äºŒä¸»æˆåˆ†ï¼Œä¾æ­¤ç±»æ¨å¯ä»¥æ„é€ å‡ºç¬¬ä¸‰ã€ç¬¬å››ï¼Œâ€¦â€¦ï¼Œç¬¬Pä¸ªä¸»æˆåˆ†ã€‚\nLDAä¸PCAéƒ½æ˜¯å¸¸ç”¨çš„é™ç»´æ–¹æ³•ï¼ŒäºŒè€…çš„åŒºåˆ« å®ƒå…¶å®æ˜¯å¯¹æ•°æ®åœ¨é«˜ç»´ç©ºé—´ä¸‹çš„ä¸€ä¸ªæŠ•å½±è½¬æ¢ï¼Œé€šè¿‡ä¸€å®šçš„æŠ•å½±è§„åˆ™å°†åŸæ¥ä»ä¸€ä¸ªè§’åº¦çœ‹åˆ°çš„å¤šä¸ªç»´åº¦æ˜ å°„æˆè¾ƒå°‘çš„ç»´åº¦ã€‚åˆ°åº•ä»€ä¹ˆæ˜¯æ˜ å°„ï¼Œä¸‹é¢çš„å›¾å°±å¯ä»¥å¾ˆå¥½åœ°è§£é‡Šè¿™ä¸ªé—®é¢˜â€”â€”æ­£å¸¸è§’åº¦çœ‹æ˜¯ä¸¤ä¸ªåŠæ¤­åœ†å½¢åˆ†å¸ƒçš„æ•°æ®é›†ï¼Œä½†ç»è¿‡æ—‹è½¬ï¼ˆæ˜ å°„ï¼‰ä¹‹åæ˜¯ä¸¤æ¡çº¿æ€§åˆ†å¸ƒæ•°æ®é›†ã€‚\nLDAä¸PCAéƒ½æ˜¯å¸¸ç”¨çš„é™ç»´æ–¹æ³•ï¼ŒäºŒè€…çš„åŒºåˆ«åœ¨äºï¼š\n**å‡ºå‘æ€æƒ³ä¸åŒã€‚**PCAä¸»è¦æ˜¯ä»ç‰¹å¾çš„åæ–¹å·®è§’åº¦ï¼Œå»æ‰¾åˆ°æ¯”è¾ƒå¥½çš„æŠ•å½±æ–¹å¼ï¼Œå³é€‰æ‹©æ ·æœ¬ç‚¹æŠ•å½±å…·æœ‰æœ€å¤§æ–¹å·®çš„æ–¹å‘ï¼ˆ åœ¨ä¿¡å·å¤„ç†ä¸­è®¤ä¸ºä¿¡å·å…·æœ‰è¾ƒå¤§çš„æ–¹å·®ï¼Œå™ªå£°æœ‰è¾ƒå°çš„æ–¹å·®ï¼Œä¿¡å™ªæ¯”å°±æ˜¯ä¿¡å·ä¸å™ªå£°çš„æ–¹å·®æ¯”ï¼Œè¶Šå¤§è¶Šå¥½ã€‚ï¼‰ï¼›è€ŒLDAåˆ™æ›´å¤šçš„æ˜¯è€ƒè™‘äº†åˆ†ç±»æ ‡ç­¾ä¿¡æ¯ï¼Œå¯»æ±‚æŠ•å½±åä¸åŒç±»åˆ«ä¹‹é—´æ•°æ®ç‚¹è·ç¦»æ›´å¤§åŒ–ä»¥åŠåŒä¸€ç±»åˆ«æ•°æ®ç‚¹è·ç¦»æœ€å°åŒ–ï¼Œå³é€‰æ‹©åˆ†ç±»æ€§èƒ½æœ€å¥½çš„æ–¹å‘ã€‚\n**å­¦ä¹ æ¨¡å¼ä¸åŒã€‚**PCAå±äºæ— ç›‘ç£å¼å­¦ä¹ ï¼Œå› æ­¤å¤§å¤šåœºæ™¯ä¸‹åªä½œä¸ºæ•°æ®å¤„ç†è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œéœ€è¦ä¸å…¶ä»–ç®—æ³•ç»“åˆä½¿ç”¨ï¼Œä¾‹å¦‚å°†PCAä¸èšç±»ã€åˆ¤åˆ«åˆ†æã€å›å½’åˆ†æç­‰ç»„åˆä½¿ç”¨ï¼›LDAæ˜¯ä¸€ç§ç›‘ç£å¼å­¦ä¹ æ–¹æ³•ï¼Œæœ¬èº«é™¤äº†å¯ä»¥é™ç»´å¤–ï¼Œè¿˜å¯ä»¥è¿›è¡Œé¢„æµ‹åº”ç”¨ï¼Œå› æ­¤æ—¢å¯ä»¥ç»„åˆå…¶ä»–æ¨¡å‹ä¸€èµ·ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹ä½¿ç”¨ã€‚\n**é™ç»´åå¯ç”¨ç»´åº¦æ•°é‡ä¸åŒã€‚**LDAé™ç»´åæœ€å¤šå¯ç”ŸæˆC-1ç»´å­ç©ºé—´ï¼ˆåˆ†ç±»æ ‡ç­¾æ•°-1ï¼‰ï¼Œå› æ­¤LDAä¸åŸå§‹ç»´åº¦Næ•°é‡æ— å…³ï¼Œåªæœ‰æ•°æ®æ ‡ç­¾åˆ†ç±»æ•°é‡æœ‰å…³ï¼›è€ŒPCAæœ€å¤šæœ‰nç»´åº¦å¯ç”¨ï¼Œå³æœ€å¤§å¯ä»¥é€‰æ‹©å…¨éƒ¨å¯ç”¨ç»´åº¦ã€‚\nçº¿æ€§åˆ¤åˆ«åˆ†æLDAç®—æ³•ç”±äºå…¶ç®€å•æœ‰æ•ˆæ€§åœ¨å¤šä¸ªé¢†åŸŸéƒ½å¾—åˆ°äº†å¹¿æ³›åœ°åº”ç”¨ï¼Œæ˜¯ç›®å‰æœºå™¨å­¦ä¹ ã€æ•°æ®æŒ–æ˜é¢†åŸŸç»å…¸ä¸”çƒ­é—¨çš„ä¸€ä¸ªç®—æ³•ï¼›ä½†æ˜¯ç®—æ³•æœ¬èº«ä»ç„¶å­˜åœ¨ä¸€äº›å±€é™æ€§ï¼š\nå½“æ ·æœ¬æ•°é‡è¿œå°äºæ ·æœ¬çš„ç‰¹å¾ç»´æ•°ï¼Œæ ·æœ¬ä¸æ ·æœ¬ä¹‹é—´çš„è·ç¦»å˜å¤§ä½¿å¾—è·ç¦»åº¦é‡å¤±æ•ˆï¼Œä½¿LDAç®—æ³•ä¸­çš„ç±»å†…ã€ç±»é—´ç¦»æ•£åº¦çŸ©é˜µå¥‡å¼‚ï¼Œä¸èƒ½å¾—åˆ°æœ€ä¼˜çš„æŠ•å½±æ–¹å‘ï¼Œåœ¨äººè„¸è¯†åˆ«é¢†åŸŸä¸­è¡¨ç°å¾—å°¤ä¸ºçªå‡º\nLDAä¸é€‚åˆå¯¹éé«˜æ–¯åˆ†å¸ƒçš„æ ·æœ¬è¿›è¡Œé™ç»´\nLDAåœ¨æ ·æœ¬åˆ†ç±»ä¿¡æ¯ä¾èµ–æ–¹å·®è€Œä¸æ˜¯å‡å€¼æ—¶ï¼Œæ•ˆæœä¸å¥½\nLDAå¯èƒ½è¿‡åº¦æ‹Ÿåˆæ•°æ®\nä¸»æˆåˆ†åˆ†æ PCA è¯¦è§£ åŸç†åŠå¯¹åº”æ“ä½œ ä¸»æˆåˆ†åˆ†æé¡¾åæ€ä¹‰æ˜¯å¯¹ä¸»æˆåˆ†è¿›è¡Œåˆ†æï¼Œé‚£ä¹ˆæ‰¾å‡ºä¸»æˆåˆ†åº”è¯¥æ˜¯keyç‚¹ã€‚PCAçš„åŸºæœ¬æ€æƒ³å°±æ˜¯å°†åˆå§‹æ•°æ®é›†ä¸­çš„nç»´ç‰¹å¾æ˜ å°„è‡³kç»´ä¸Šï¼Œå¾—åˆ°çš„kç»´ç‰¹å¾å°±å¯ä»¥è¢«ç§°ä½œä¸»æˆåˆ†ï¼Œkç»´ä¸æ˜¯åœ¨nç»´ä¸­æŒ‘é€‰å‡ºæ¥çš„ï¼Œè€Œæ˜¯ä»¥nç»´ç‰¹å¾ä¸ºåŸºç¡€é‡æ„å‡ºæ¥çš„ã€‚\nPCAä¼šåœ¨å·²çŸ¥æ•°æ®çš„åŸºç¡€ä¸Šé‡æ„åæ ‡è½´ï¼Œå®ƒçš„åŸç†æ˜¯è¦æœ€å¤§åŒ–ä¿ç•™æ ·æœ¬é—´çš„æ–¹å·®ï¼Œä¸¤ä¸ªç‰¹å¾ä¹‹é—´æ–¹å·®è¶Šå¤§ä¸å°±ä»£è¡¨ç›¸å…³æ€§è¶Šå·®å˜›ã€‚æ¯”å¦‚ï¼š\nç¬¬ä¸€ä¸ªæ–°åæ ‡è½´å°±æ˜¯åŸå§‹æ•°æ®ä¸­æ–¹å·®æœ€å¤§çš„æ–¹å‘ã€‚ ç¬¬äºŒä¸ªæ–°åæ ‡è½´è¦æ˜¯ä¸ç¬¬ä¸€ä¸ªæ–°åæ ‡è½´æ­£äº¤çš„å¹³é¢ä¸­æ–¹å·®æœ€å¤§çš„æ–¹å‘ã€‚ ç¬¬ä¸‰ä¸ªæ–°åæ ‡è½´è¦æ˜¯ä¸ç¬¬ä¸€ã€ç¬¬äºŒæ–°åæ ‡è½´æ­£äº¤çš„å¹³é¢ä¸­æ–¹å·®æœ€å¤§çš„æ–¹å‘ã€‚ ç¬¬å››ã€ç¬¬äº”\u0026hellip;ä¾æ¬¡ç±»æ¨ç›´åˆ°ç¬¬nä¸ªæ–°åæ ‡è½´(å¯¹åº”nç»´)ã€‚ ä¸ºäº†åŠ æ·±è¿™éƒ¨åˆ†ç†è§£ï¼Œä»¥äºŒç»´å¹³é¢å…ˆä¸¾ä¸€ä¸ªä¾‹å­ï¼ŒäºŒç»´å¹³é¢ä¸­ä¾æ®åŸå§‹æ•°æ®æ–°å»ºåæ ‡è½´å¦‚ä¸‹å›¾ï¼š\nä¸ºäº†æ›´ç›´è§‚çš„ç†è§£ï¼Œè‹¥å°†æ–¹å·®æ¢ä¸€ä¸ªè¯´æ³•ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªæ–°åæ ‡è½´å°±æ˜¯è¦†ç›–æ ·æœ¬æœ€å¤šçš„ä¸€æ¡(æ–œå‘å³ä¸Š)ï¼Œç¬¬äºŒä¸ªæ–°åæ ‡è½´éœ€è¦ä¸ç¬¬ä¸€æ–°åæ ‡è½´æ­£äº¤ä¸”è¦†ç›–æ ·æœ¬æœ€å¤š(æ–œå‘å·¦ä¸Š)ï¼Œä¾æ¬¡ç±»æ¨ã€‚\nè¦†ç›–çš„æ ·æœ¬å¤šå°‘å¹¶ä¸æ˜¯ä»¥åæ ‡è½´ç©¿è¿‡å¤šå°‘æ ·æœ¬ç‚¹è¯„åˆ¤çš„ï¼Œè€Œæ˜¯é€šè¿‡æ ·æœ¬ç‚¹å‚ç›´æ˜ å°„è‡³è¯¥è½´çš„ä¸ªæ•°æœ‰å¤šå°‘ï¼Œå…·ä½“å¦‚ä¸‹å›¾ï¼š\nå›åˆ°ä¹‹å‰çš„nç»´é‡æ„åæ ‡è½´ï¼Œç”±äºé¡ºåºæ˜¯ä¾æ®æ–¹å·®çš„å¤§å°ä¾æ¬¡æ’åºçš„ï¼Œæ‰€ä»¥è¶Šåˆ°åé¢æ–¹å·®è¶Šå°ï¼Œè€Œæ–¹å·®è¶Šå°ä»£è¡¨ç‰¹å¾ä¹‹é—´ç›¸å…³æ€§è¶Šå¼ºï¼Œé‚£ä¹ˆè¿™ç±»ç‰¹å¾å°±å¯ä»¥åˆ å»ï¼Œåªä¿ç•™å‰kä¸ªåæ ‡è½´(å¯¹åº”kç»´)ï¼Œè¿™å°±ç›¸å½“äºä¿ç•™äº†å«æœ‰æ•°æ®é›†ç»å¤§éƒ¨åˆ†æ–¹å·®çš„ç‰¹å¾ï¼Œè€Œé™¤å»æ–¹å·®å‡ ä¹ä¸º0çš„ç‰¹å¾ã€‚\né‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒäºŒç»´ã€ä¸‰ç»´å¯ä»¥æ ¹æ®æ ·æœ¬ç‚¹çš„åˆ†å¸ƒç”»å‡ºé‡æ„åæ ‡è½´ï¼Œä½†æ˜¯æ›´é«˜ç»´äººçš„å¤§è„‘æ˜¯ä¸æ¥å—çš„ï¼Œæˆ‘ä»¬ä¸å¾—ä¸é€šè¿‡è®¡ç®—çš„æ–¹å¼æ±‚å¾—ç‰¹å¾ä¹‹é—´çš„æ–¹å·®ï¼Œè¿›è€Œå¾—åˆ°è¿™äº›æ–°åæ ‡è½´çš„çš„æ–¹å‘ã€‚\nå…·ä½“æ–¹æ³•å°±æ˜¯é€šè¿‡è®¡ç®—åŸå§‹æ•°æ®çŸ©é˜µå¯¹åº”çš„åæ–¹å·®çŸ©é˜µï¼Œç„¶åå¯ä»¥å¾—åˆ°åæ–¹å·®çŸ©é˜µå¯¹åº”çš„ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ï¼Œé€‰å–ç‰¹å¾å€¼æœ€å¤§çš„å‰kä¸ªç‰¹å¾å‘é‡ç»„æˆçš„çŸ©é˜µï¼Œé€šè¿‡ç‰¹å¾çŸ©é˜µå°±å¯ä»¥å°†åŸå§‹æ•°æ®çŸ©é˜µä»nç»´ç©ºé—´æ˜ å°„è‡³kç»´ç©ºé—´ï¼Œä»è€Œå®ç°ç‰¹å¾é™ç»´ã€‚\næ–¹å·®ã€åæ–¹å·®åŠåæ–¹å·®çŸ©é˜µ å¦‚æœä½ æ›¾ç»æ¥è§¦è¿‡çº¿æ€§ä»£æ•°å¯èƒ½å¯¹è¿™ä¸‰ä¸ªæ¦‚å¿µå¾ˆç†Ÿæ‚‰ï¼Œå¯èƒ½é—´éš”æ—¶é—´å¤ªä¹…æœ‰äº›æ¨¡ç³Šï¼Œä¸‹é¢å†å¸®å¤§å®¶æ¸©ä¹ ä¸€ä¸‹ï¼š\næ–¹å·®(Variance)ä¸€èˆ¬ç”¨æ¥æè¿°æ ·æœ¬é›†åˆä¸­çš„å„ä¸ªæ ·æœ¬ç‚¹åˆ°æ ·æœ¬å‡å€¼çš„å·®çš„å¹³æ–¹å’Œçš„å‡å€¼ï¼š\nåæ–¹å·®(Covariance)ç›®çš„æ˜¯åº¦é‡ä¸¤ä¸ªå˜é‡(åªèƒ½ä¸ºä¸¤ä¸ª)çº¿æ€§ç›¸å…³çš„ç¨‹åº¦ï¼š\nä¸ºå¯ä»¥è¯´æ˜ä¸¤ä¸ªå˜é‡çº¿æ€§æ— å…³ï¼Œä½†ä¸èƒ½è¯æ˜ä¸¤ä¸ªå˜é‡ç›¸äº’ç‹¬ç«‹ï¼Œå½“æ—¶ï¼ŒäºŒè€…å‘ˆæ­£ç›¸å…³ï¼Œæ—¶ï¼ŒäºŒè€…å‘ˆè´Ÿç›¸å…³ã€‚\nåæ–¹å·®çŸ©é˜µå°±æ˜¯ç”±ä¸¤ä¸¤å˜é‡ä¹‹é—´çš„åæ–¹å·®ç»„æˆï¼Œæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nåæ–¹å·®çŸ©é˜µå¯ä»¥å¤„ç†å¤šç»´åº¦é—®é¢˜ã€‚ åæ–¹å·®çŸ©é˜µæ˜¯ä¸€ä¸ªå¯¹ç§°çš„çŸ©é˜µï¼Œè€Œä¸”å¯¹è§’çº¿æ˜¯å„ä¸ªç»´åº¦ä¸Šçš„æ–¹å·®ã€‚ åæ–¹å·®çŸ©é˜µè®¡ç®—çš„æ˜¯ä¸åŒç»´åº¦ä¹‹é—´çš„åæ–¹å·®ï¼Œè€Œä¸æ˜¯ä¸åŒæ ·æœ¬ä¹‹é—´çš„ã€‚ æ ·æœ¬çŸ©é˜µä¸­è‹¥æ¯è¡Œæ˜¯ä¸€ä¸ªæ ·æœ¬ï¼Œåˆ™æ¯åˆ—ä¸ºä¸€ä¸ªç»´åº¦ã€‚ å‡è®¾æ•°æ®æ˜¯3ç»´çš„ï¼Œé‚£ä¹ˆå¯¹åº”åæ–¹å·®çŸ©é˜µä¸ºï¼š\nè¿™é‡Œç®€è¦æ¦‚æ‹¬ä¸€ä¸‹åæ–¹å·®çŸ©é˜µæ˜¯æ€ä¹ˆæ±‚å¾—çš„ï¼Œå‡è®¾ä¸€ä¸ªæ•°æ®é›†æœ‰3ç»´ç‰¹å¾ã€æ¯ä¸ªç‰¹å¾æœ‰mä¸ªå˜é‡ï¼Œè¿™ä¸ªæ•°æ®é›†å¯¹åº”çš„æ•°æ®çŸ©é˜µå¦‚ä¸‹ï¼š\nè‹¥å‡è®¾ä»–ä»¬çš„å‡å€¼éƒ½ä¸º0ï¼Œå¯ä»¥å¾—åˆ°ä¸‹é¢ç­‰å¼ï¼š\nå¯ä»¥çœ‹åˆ°å¯¹è§’çº¿ä¸Šä¸ºæ¯ä¸ªç‰¹å¾æ–¹å·®ï¼Œå…¶ä½™ä½ç½®ä¸ºä¸¤ä¸ªç‰¹å¾ä¹‹é—´çš„åæ–¹å·®ï¼Œæ±‚å¾—çš„å°±ä¸ºåæ–¹å·®çŸ©é˜µã€‚\nè¿™é‡Œå™è¿°çš„æœ‰äº›ç®€ç•¥ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡ŒæŸ¥è¯¢ç›¸å…³çŸ¥è¯†ã€‚\nç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ å¾—åˆ°äº†æ•°æ®çŸ©é˜µçš„åæ–¹å·®çŸ©é˜µï¼Œä¸‹é¢å°±åº”è¯¥æ±‚åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ï¼Œå…ˆäº†è§£ä¸€ä¸‹è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œå¦‚æœä¸€ä¸ªå‘é‡væ˜¯çŸ©é˜µAçš„ç‰¹å¾å‘é‡ï¼Œé‚£ä¹ˆä¸€å®šå­˜åœ¨ä¸‹åˆ—ç­‰å¼ï¼š\nå…¶ä¸­Aå¯è§†ä¸ºæ•°æ®çŸ©é˜µå¯¹åº”çš„åæ–¹å·®çŸ©é˜µï¼Œæ˜¯ç‰¹å¾å‘é‡vçš„ç‰¹å¾å€¼ã€‚æ•°æ®çŸ©é˜µçš„ä¸»æˆåˆ†å°±æ˜¯ç”±å…¶å¯¹åº”çš„åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å‘é‡ï¼ŒæŒ‰ç…§å¯¹åº”çš„ç‰¹å¾å€¼ç”±å¤§åˆ°å°æ’åºå¾—åˆ°çš„ã€‚æœ€å¤§çš„ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡å°±ä¸ºç¬¬ä¸€ä¸»æˆåˆ†ï¼Œç¬¬äºŒå¤§çš„ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡å°±ä¸ºç¬¬äºŒä¸»æˆåˆ†ï¼Œä¾æ¬¡ç±»æ¨ï¼Œå¦‚æœç”±nç»´æ˜ å°„è‡³kç»´å°±æˆªå–è‡³ç¬¬kä¸»æˆåˆ†ã€‚\nå®ä¾‹æ“ä½œ é€šè¿‡ä¸Šè¿°éƒ¨åˆ†æ€»ç»“ä¸€ä¸‹PCAé™ç»´æ“ä½œçš„æ­¥éª¤ï¼š\nå»å‡å€¼åŒ– ä¾æ®æ•°æ®çŸ©é˜µè®¡ç®—åæ–¹å·®çŸ©é˜µ è®¡ç®—åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ å°†ç‰¹å¾å€¼ä»å¤§åˆ°å°æ’åº ä¿ç•™å‰kä¸ªç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ å°†åŸå§‹æ•°æ®çš„nç»´æ˜ å°„è‡³kç»´ä¸­ å…¬å¼æ‰‹æ¨é™ç»´ åŸå§‹æ•°æ®é›†çŸ©é˜µï¼Œæ¯è¡Œä»£è¡¨ä¸€ä¸ªç‰¹å¾:\nå¯¹æ¯ä¸ªç‰¹å¾å»å‡å€¼åŒ–ï¼š\nè®¡ç®—å¯¹åº”çš„åæ–¹å·®çŸ©é˜µï¼š\nä¾æ®åæ–¹å·®çŸ©é˜µè®¡ç®—ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ï¼Œå¥—å…¥å…¬å¼ï¼š\næ‹†å¼€è®¡ç®—å¦‚ä¸‹ï¼š\nå¯ä»¥æ±‚å¾—ä¸¤ç‰¹å¾å€¼ï¼š\nï¼Œ\nå½“æ—¶ï¼Œå¯¹åº”å‘é‡åº”è¯¥æ»¡è¶³å¦‚ä¸‹ç­‰å¼ï¼š\nå¯¹åº”çš„ç‰¹å¾å‘é‡å¯å–ä¸ºï¼š\nåŒç†å½“æ—¶ï¼Œå¯¹åº”ç‰¹å¾å‘é‡å¯å–ä¸ºï¼š\nè¿™é‡Œæˆ‘å°±ä¸å¯¹ä¸¤ä¸ªç‰¹å¾å‘é‡è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†äº†ï¼Œç›´æ¥åˆå¹¶ä¸¤ä¸ªç‰¹å¾å‘é‡å¯ä»¥å¾—åˆ°çŸ©é˜µPï¼š\né€‰å–å¤§çš„ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ä¹˜ä»¥åŸæ•°æ®çŸ©é˜µåå¯å¾—åˆ°é™ç»´åçš„çŸ©é˜µAï¼š\nç»¼ä¸Šæ­¥éª¤å°±æ˜¯é€šè¿‡PCAæ‰‹æ¨å…¬å¼å®ç°äºŒç»´é™ä¸ºä¸€ç»´çš„æ“ä½œã€‚\nnumpyå®ç°é™ç»´ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 import numpy as np def PCA(X,k): \u0026#39;\u0026#39;\u0026#39; X:è¾“å…¥çŸ©é˜µ k:éœ€è¦é™ä½åˆ°çš„ç»´æ•° \u0026#39;\u0026#39;\u0026#39; X = np.array(X) #è½¬ä¸ºçŸ©é˜µ sample_num ,feature_num = X.shape #æ ·æœ¬æ•°å’Œç‰¹å¾æ•° meanVals = np.mean(X,axis = 0) #æ±‚æ¯ä¸ªç‰¹å¾çš„å‡å€¼ X_mean = X-meanVals #å»å‡å€¼åŒ– Cov = np.dot(X_mean.T,X_mean)/sample_num #æ±‚åæ–¹å·®çŸ©é˜µ feature_val,feature_vec = np.linalg.eig(Cov) #å°†ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡æ‰“åŒ… val_sort = [(np.abs(feature_val[i]),feature_vec[:,i]) for i in range(feature_num)] val_sort.sort(reverse=True) #æŒ‰ç‰¹å¾å€¼ç”±å¤§åˆ°å°æ’åˆ— #æˆªå–è‡³å‰kä¸ªç‰¹å¾å‘é‡ç»„æˆç‰¹å¾çŸ©é˜µ feature_mat = [feature[1] for feature in val_sort[:k]] # é™nç»´æ˜ å°„è‡³kç»´ PCA_mat = np.dot(X_mean,np.array(feature_mat).T) return PCA_mat if __name__ == \u0026#34;__main__\u0026#34;: X = [[1, 1], [1, 3], [2, 3], [4, 4], [2, 4]] print(PCA(X,1)) è¿è¡Œæˆªå›¾å¦‚ä¸‹ï¼š\nä»£ç éƒ¨åˆ†å°±æ˜¯å…¬å¼çš„å¥—ç”¨ï¼Œæ¯ä¸€æ­¥åéƒ½æœ‰æ³¨é‡Šï¼Œä¸å†è¿‡å¤šè§£é‡Šã€‚å¯ä»¥çœ‹åˆ°å¾—åˆ°çš„ç»“æœå’Œä¸Šé¢æ‰‹æ¨å…¬å¼å¾—åˆ°çš„æœ‰äº›å‡ºå…¥ï¼Œä¸Šæ–‡æ›¾æè¿‡ç‰¹å¾å‘é‡æ˜¯å¯ä»¥éšæ„ç¼©æ”¾çš„ï¼Œè¿™ä¹Ÿæ˜¯å¯¼è‡´ä¸¤ä¸ªç»“æœä¸åŒçš„åŸå› ï¼Œå¯ä»¥åœ¨è¿è¡Œä»£ç æ—¶æ‰“å°ä¸€ä¸‹ç‰¹å¾å‘é‡feature_vecï¼Œè§‚å¯Ÿä¸€ä¸‹è¿™ä¸ªç‰¹ç‚¹ã€‚\nsklearnåº“å®ç°é™ç»´ 1 2 3 4 5 6 7 8 from sklearn.decomposition import PCA import numpy as np X = [[1, 1], [1, 3], [2, 3], [4, 4], [2, 4]] X = np.array(X) pca = PCA(n_components=1) PCA_mat = pca.fit_transform(X) print(PCA_mat) è¿™é‡Œåªè¯´ä¸€ä¸‹å‚æ•°n_componentsï¼Œå¦‚æœè¾“å…¥çš„æ˜¯æ•´æ•°ï¼Œä»£è¡¨æ•°æ®é›†éœ€è¦æ˜ å°„çš„ç»´æ•°ï¼Œæ¯”å¦‚è¾“å…¥3ä»£è¡¨æœ€åè¦æ˜ å°„è‡³3ç»´ï¼›å¦‚æœè¾“å…¥çš„æ˜¯å°æ•°ï¼Œåˆ™ä»£è¡¨æ˜ å°„çš„ç»´æ•°ä¸ºåŸæ•°æ®ç»´æ•°çš„å æ¯”ï¼Œæ¯”å¦‚è¾“å…¥0.3ï¼Œå¦‚æœåŸæ•°æ®20ç»´ï¼Œå°±å°†å…¶æ˜ å°„è‡³6ç»´ã€‚\n","permalink":"https://reid00.github.io/en/posts/ml/%E6%95%B0%E6%8D%AE%E9%99%8D%E7%BB%B4%E4%B9%8B%E4%B8%BB%E6%88%90%E5%88%86%E5%88%86%E6%9E%90-pca/","summary":"Summary PCA æ˜¯æ— ç›‘ç£å­¦ä¹ ä¸­æœ€å¸¸è§çš„æ•°æ®é™ç»´æ–¹æ³•ï¼Œä½†æ˜¯å®é™…ä¸Šé—®é¢˜ç‰¹å¾å¾ˆå¤šçš„æƒ…å†µï¼ŒPCAé€šå¸¸ä¼šé¢„å¤„ç†æ¥å‡å°‘ç‰¹å¾ä¸ªæ•°ã€‚\nå°†ç»´çš„æ„ä¹‰ï¼š é€šè¿‡é™ç»´æé«˜ç®—æ³•çš„æ•ˆç‡ é€šè¿‡é™ç»´æ›´æ–¹ä¾¿æ•°æ®çš„å¯è§†åŒ–ï¼Œé€šè¿‡å¯è§†åŒ–æˆ‘ä»¬å¯ä»¥æ›´å¥½çš„ç†è§£æ•°æ®\nç›¸å…³ç»Ÿè®¡æ¦‚å¿µ å‡å€¼ï¼š è¿°çš„æ˜¯æ ·æœ¬é›†åˆçš„ä¸­é—´ç‚¹ã€‚ æ–¹å·®ï¼š æ¦‚ç‡è®ºå’Œç»Ÿè®¡æ–¹å·®è¡¡é‡éšæœºå˜é‡æˆ–ä¸€ç»„æ•°æ®æ—¶ç¦»æ•£ç¨‹åº¦çš„åº¦é‡ã€‚ æ ‡å‡†å·®ï¼šè€Œæ ‡å‡†å·®ç»™æˆ‘ä»¬æè¿°çš„æ˜¯æ ·æœ¬é›†åˆçš„å„ä¸ªæ ·æœ¬ç‚¹åˆ°å‡å€¼çš„è·ç¦»ä¹‹å¹³å‡ã€‚æ–¹å·®å¼€æ ¹å·ã€‚ æ ‡å‡†å·®å’Œæ–¹å·®ä¸€èˆ¬æ˜¯ç”¨æ¥æè¿°ä¸€ç»´æ•°æ®çš„ åæ–¹å·®: ï¼ˆå¤šç»´ï¼‰åº¦é‡ä¸¤ä¸ªéšæœºå˜é‡å…³ç³»çš„ç»Ÿè®¡é‡,æ¥åº¦é‡å„ä¸ªç»´åº¦åç¦»å…¶å‡å€¼çš„ç¨‹åº¦ã€‚ åæ–¹å·®çŸ©é˜µ: ï¼ˆå¤šç»´ï¼‰åº¦é‡å„ä¸ªç»´åº¦åç¦»å…¶å‡å€¼çš„ç¨‹åº¦ å½“ cov(X, Y)\u0026gt;0æ—¶ï¼Œè¡¨æ˜Xä¸Yæ­£ç›¸å…³(Xè¶Šå¤§ï¼ŒYä¹Ÿè¶Šå¤§ï¼›Xè¶Šå°Yï¼Œä¹Ÿè¶Šå°ã€‚) å½“ cov(X, Y)\u0026lt;0æ—¶ï¼Œè¡¨æ˜Xä¸Yè´Ÿç›¸å…³ï¼› å½“ cov(X, Y)=0æ—¶ï¼Œè¡¨æ˜Xä¸Yä¸ç›¸å…³ã€‚ covåæ–¹å·®=[(x1-xå‡å€¼)(y1-yå‡å€¼)+(x2-xå‡å€¼)(y2-yå‡å€¼)+\u0026hellip;+(xn-xå‡å€¼)*(yn-yå‡å€¼)]/(n-1) PCA æ€æƒ³ å¯¹æ•°æ®è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼ˆä»£ç ä¸­å¹¶éè¿™ä¹ˆåšçš„ï¼Œè€Œæ˜¯ç›´æ¥å‡å»å‡å€¼ï¼‰ è®¡ç®—å½’ä¸€åŒ–åçš„æ•°æ®é›†çš„åæ–¹å·®çŸ©é˜µ è®¡ç®—åæ–¹å·®çŸ©é˜µçš„ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡ å°†ç‰¹å¾å€¼æ’åº ä¿ç•™å‰Nä¸ªæœ€å¤§çš„ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ å°†æ•°æ®è½¬æ¢åˆ°ä¸Šé¢å¾—åˆ°çš„Nä¸ªç‰¹å¾å‘é‡æ„å»ºçš„æ–°ç©ºé—´ä¸­ï¼ˆå®ç°äº†ç‰¹å¾å‹ç¼©ï¼‰ ç®€è¿°ä¸»æˆåˆ†åˆ†æPCAå·¥ä½œåŸç†ï¼Œä»¥åŠPCAçš„ä¼˜ç¼ºç‚¹ï¼Ÿ PCAæ—¨åœ¨æ‰¾åˆ°æ•°æ®ä¸­çš„ä¸»æˆåˆ†ï¼Œå¹¶åˆ©ç”¨è¿™äº›ä¸»æˆåˆ†è¡¨å¾åŸå§‹æ•°æ®ï¼Œä»è€Œè¾¾åˆ°é™ç»´çš„ç›®çš„ã€‚\nâ€‹ å·¥ä½œåŸç†å¯ç”±ä¸¤ä¸ªè§’åº¦è§£é‡Šï¼Œç¬¬ä¸€ä¸ªæ˜¯æœ€å¤§åŒ–æŠ•å½±æ–¹å·®ï¼ˆè®©æ•°æ®åœ¨ä¸»è½´ä¸ŠæŠ•å½±çš„æ–¹å·®å°½å¯èƒ½å¤§ï¼‰ï¼›ç¬¬äºŒä¸ªæ˜¯æœ€å°åŒ–å¹³æ–¹è¯¯å·®ï¼ˆæ ·æœ¬ç‚¹åˆ°è¶…å¹³é¢çš„å‚ç›´è·ç¦»è¶³å¤Ÿè¿‘ï¼‰ã€‚\nâ€‹ åšæ³•æ˜¯æ•°æ®ä¸­å¿ƒåŒ–ä¹‹åï¼Œå¯¹æ ·æœ¬æ•°æ®åæ–¹å·®çŸ©é˜µè¿›è¡Œç‰¹å¾åˆ†è§£ï¼Œé€‰å–å‰dä¸ªæœ€å¤§çš„ç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ï¼Œå³å¯å°†æ•°æ®ä»åŸæ¥çš„pç»´é™åˆ°dç»´ï¼Œä¹Ÿå¯æ ¹æ®å¥‡å¼‚å€¼åˆ†è§£æ¥æ±‚è§£ä¸»æˆåˆ†ã€‚\nä¼˜ç‚¹ï¼š 1.è®¡ç®—ç®€å•ï¼Œæ˜“äºå®ç°\n2.å„ä¸»æˆåˆ†ä¹‹é—´æ­£äº¤ï¼Œå¯æ¶ˆé™¤åŸå§‹æ•°æ®æˆåˆ†é—´çš„ç›¸äº’å½±å“çš„å› ç´ \n3.ä»…ä»…éœ€è¦ä»¥æ–¹å·®è¡¡é‡ä¿¡æ¯é‡ï¼Œä¸å—æ•°æ®é›†ä»¥å¤–çš„å› ç´ å½±å“\n4.é™ç»´ç»´æ•°æœ¨æœ‰é™åˆ¶ï¼Œå¯æ ¹æ®éœ€è¦åˆ¶å®š\nç¼ºç‚¹ï¼š 1.æ— æ³•åˆ©ç”¨ç±»åˆ«çš„å…ˆéªŒä¿¡æ¯\n2.é™ç»´åï¼Œåªä¸æ•°æ®æœ‰å…³ï¼Œä¸»æˆåˆ†å„ä¸ªç»´åº¦çš„å«ä¹‰æ¨¡ç³Šï¼Œä¸æ˜“äºè§£é‡Š\n3.æ–¹å·®å°çš„éä¸»æˆåˆ†ä¹Ÿå¯èƒ½å«æœ‰å¯¹æ ·æœ¬å·®å¼‚çš„é‡è¦ä¿¡æ¯ï¼Œå› é™ç»´ä¸¢å¼ƒå¯èƒ½å¯¹åç»­æ•°æ®å¤„ç†æœ‰å½±å“\n4.çº¿æ€§æ¨¡å‹ï¼Œå¯¹äºå¤æ‚æ•°æ®é›†éš¾ä»¥å¤„ç†ï¼ˆå¯ç”¨æ ¸æ˜ å°„æ–¹å¼æ”¹è¿›ï¼‰\nPCAä¸­æœ‰ç¬¬ä¸€ä¸»æˆåˆ†ã€ç¬¬äºŒä¸»æˆåˆ†ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œåˆæ˜¯å¦‚ä½•ç¡®å®šçš„ï¼Ÿ ä¸»æˆåˆ†åˆ†ææ˜¯è®¾æ³•å°†åŸæ¥ä¼—å¤šå…·æœ‰ä¸€å®šç›¸å…³æ€§ï¼ˆæ¯”å¦‚Pä¸ªæŒ‡æ ‡ï¼‰ï¼Œé‡æ–°ç»„åˆæˆä¸€ç»„æ–°çš„äº’ç›¸æ— å…³çš„ç»¼åˆæŒ‡æ ‡æ¥ä»£æ›¿åŸæ¥çš„æŒ‡æ ‡ã€‚ä¸»æˆåˆ†åˆ†æï¼Œæ˜¯è€ƒå¯Ÿå¤šä¸ªå˜é‡é—´ç›¸å…³æ€§ä¸€ç§å¤šå…ƒç»Ÿè®¡æ–¹æ³•ï¼Œç ”ç©¶å¦‚ä½•é€šè¿‡å°‘æ•°å‡ ä¸ªä¸»æˆåˆ†æ¥æ­ç¤ºå¤šä¸ªå˜é‡é—´çš„å†…éƒ¨ç»“æ„ï¼Œå³ä»åŸå§‹å˜é‡ä¸­å¯¼å‡ºå°‘æ•°å‡ ä¸ªä¸»æˆåˆ†ï¼Œä½¿å®ƒä»¬å°½å¯èƒ½å¤šåœ°ä¿ç•™åŸå§‹å˜é‡çš„ä¿¡æ¯ï¼Œä¸”å½¼æ­¤é—´äº’ä¸ç›¸å…³ï¼Œé€šå¸¸æ•°å­¦ä¸Šçš„å¤„ç†å°±æ˜¯å°†åŸæ¥Pä¸ªæŒ‡æ ‡ä½œçº¿æ€§ç»„åˆï¼Œä½œä¸ºæ–°çš„ç»¼åˆæŒ‡æ ‡ã€‚\nâ€‹ æœ€ç»å…¸çš„åšæ³•å°±æ˜¯ç”¨F1ï¼ˆé€‰å–çš„ç¬¬ä¸€ä¸ªçº¿æ€§ç»„åˆï¼Œå³ç¬¬ä¸€ä¸ªç»¼åˆæŒ‡æ ‡ï¼‰çš„æ–¹å·®æ¥è¡¨è¾¾ï¼Œå³Var(F1)è¶Šå¤§ï¼Œè¡¨ç¤ºF1åŒ…å«çš„ä¿¡æ¯è¶Šå¤šã€‚å› æ­¤åœ¨æ‰€æœ‰çš„çº¿æ€§ç»„åˆä¸­é€‰å–çš„F1åº”è¯¥æ˜¯æ–¹å·®æœ€å¤§çš„ï¼Œæ•…ç§°F1ä¸ºç¬¬ä¸€ä¸»æˆåˆ†ã€‚å¦‚æœç¬¬ä¸€ä¸»æˆåˆ†ä¸è¶³ä»¥ä»£è¡¨åŸæ¥Pä¸ªæŒ‡æ ‡çš„ä¿¡æ¯ï¼Œå†è€ƒè™‘é€‰å–F2å³é€‰ç¬¬äºŒä¸ªçº¿æ€§ç»„åˆï¼Œä¸ºäº†æœ‰æ•ˆåœ°åæ˜ åŸæ¥ä¿¡æ¯ï¼ŒF1å·²æœ‰çš„ä¿¡æ¯å°±ä¸éœ€è¦å†å‡ºç°åœ¨F2ä¸­ï¼Œç”¨æ•°å­¦è¯­è¨€è¡¨è¾¾å°±æ˜¯è¦æ±‚Cov(F1, F2)=0ï¼Œåˆ™ç§°F2ä¸ºç¬¬äºŒä¸»æˆåˆ†ï¼Œä¾æ­¤ç±»æ¨å¯ä»¥æ„é€ å‡ºç¬¬ä¸‰ã€ç¬¬å››ï¼Œâ€¦â€¦ï¼Œç¬¬Pä¸ªä¸»æˆåˆ†ã€‚\nLDAä¸PCAéƒ½æ˜¯å¸¸ç”¨çš„é™ç»´æ–¹æ³•ï¼ŒäºŒè€…çš„åŒºåˆ« å®ƒå…¶å®æ˜¯å¯¹æ•°æ®åœ¨é«˜ç»´ç©ºé—´ä¸‹çš„ä¸€ä¸ªæŠ•å½±è½¬æ¢ï¼Œé€šè¿‡ä¸€å®šçš„æŠ•å½±è§„åˆ™å°†åŸæ¥ä»ä¸€ä¸ªè§’åº¦çœ‹åˆ°çš„å¤šä¸ªç»´åº¦æ˜ å°„æˆè¾ƒå°‘çš„ç»´åº¦ã€‚åˆ°åº•ä»€ä¹ˆæ˜¯æ˜ å°„ï¼Œä¸‹é¢çš„å›¾å°±å¯ä»¥å¾ˆå¥½åœ°è§£é‡Šè¿™ä¸ªé—®é¢˜â€”â€”æ­£å¸¸è§’åº¦çœ‹æ˜¯ä¸¤ä¸ªåŠæ¤­åœ†å½¢åˆ†å¸ƒçš„æ•°æ®é›†ï¼Œä½†ç»è¿‡æ—‹è½¬ï¼ˆæ˜ å°„ï¼‰ä¹‹åæ˜¯ä¸¤æ¡çº¿æ€§åˆ†å¸ƒæ•°æ®é›†ã€‚\nLDAä¸PCAéƒ½æ˜¯å¸¸ç”¨çš„é™ç»´æ–¹æ³•ï¼ŒäºŒè€…çš„åŒºåˆ«åœ¨äºï¼š\n**å‡ºå‘æ€æƒ³ä¸åŒã€‚**PCAä¸»è¦æ˜¯ä»ç‰¹å¾çš„åæ–¹å·®è§’åº¦ï¼Œå»æ‰¾åˆ°æ¯”è¾ƒå¥½çš„æŠ•å½±æ–¹å¼ï¼Œå³é€‰æ‹©æ ·æœ¬ç‚¹æŠ•å½±å…·æœ‰æœ€å¤§æ–¹å·®çš„æ–¹å‘ï¼ˆ åœ¨ä¿¡å·å¤„ç†ä¸­è®¤ä¸ºä¿¡å·å…·æœ‰è¾ƒå¤§çš„æ–¹å·®ï¼Œå™ªå£°æœ‰è¾ƒå°çš„æ–¹å·®ï¼Œä¿¡å™ªæ¯”å°±æ˜¯ä¿¡å·ä¸å™ªå£°çš„æ–¹å·®æ¯”ï¼Œè¶Šå¤§è¶Šå¥½ã€‚ï¼‰ï¼›è€ŒLDAåˆ™æ›´å¤šçš„æ˜¯è€ƒè™‘äº†åˆ†ç±»æ ‡ç­¾ä¿¡æ¯ï¼Œå¯»æ±‚æŠ•å½±åä¸åŒç±»åˆ«ä¹‹é—´æ•°æ®ç‚¹è·ç¦»æ›´å¤§åŒ–ä»¥åŠåŒä¸€ç±»åˆ«æ•°æ®ç‚¹è·ç¦»æœ€å°åŒ–ï¼Œå³é€‰æ‹©åˆ†ç±»æ€§èƒ½æœ€å¥½çš„æ–¹å‘ã€‚\n**å­¦ä¹ æ¨¡å¼ä¸åŒã€‚**PCAå±äºæ— ç›‘ç£å¼å­¦ä¹ ï¼Œå› æ­¤å¤§å¤šåœºæ™¯ä¸‹åªä½œä¸ºæ•°æ®å¤„ç†è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œéœ€è¦ä¸å…¶ä»–ç®—æ³•ç»“åˆä½¿ç”¨ï¼Œä¾‹å¦‚å°†PCAä¸èšç±»ã€åˆ¤åˆ«åˆ†æã€å›å½’åˆ†æç­‰ç»„åˆä½¿ç”¨ï¼›LDAæ˜¯ä¸€ç§ç›‘ç£å¼å­¦ä¹ æ–¹æ³•ï¼Œæœ¬èº«é™¤äº†å¯ä»¥é™ç»´å¤–ï¼Œè¿˜å¯ä»¥è¿›è¡Œé¢„æµ‹åº”ç”¨ï¼Œå› æ­¤æ—¢å¯ä»¥ç»„åˆå…¶ä»–æ¨¡å‹ä¸€èµ·ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹ä½¿ç”¨ã€‚\n**é™ç»´åå¯ç”¨ç»´åº¦æ•°é‡ä¸åŒã€‚**LDAé™ç»´åæœ€å¤šå¯ç”ŸæˆC-1ç»´å­ç©ºé—´ï¼ˆåˆ†ç±»æ ‡ç­¾æ•°-1ï¼‰ï¼Œå› æ­¤LDAä¸åŸå§‹ç»´åº¦Næ•°é‡æ— å…³ï¼Œåªæœ‰æ•°æ®æ ‡ç­¾åˆ†ç±»æ•°é‡æœ‰å…³ï¼›è€ŒPCAæœ€å¤šæœ‰nç»´åº¦å¯ç”¨ï¼Œå³æœ€å¤§å¯ä»¥é€‰æ‹©å…¨éƒ¨å¯ç”¨ç»´åº¦ã€‚\nçº¿æ€§åˆ¤åˆ«åˆ†æLDAç®—æ³•ç”±äºå…¶ç®€å•æœ‰æ•ˆæ€§åœ¨å¤šä¸ªé¢†åŸŸéƒ½å¾—åˆ°äº†å¹¿æ³›åœ°åº”ç”¨ï¼Œæ˜¯ç›®å‰æœºå™¨å­¦ä¹ ã€æ•°æ®æŒ–æ˜é¢†åŸŸç»å…¸ä¸”çƒ­é—¨çš„ä¸€ä¸ªç®—æ³•ï¼›ä½†æ˜¯ç®—æ³•æœ¬èº«ä»ç„¶å­˜åœ¨ä¸€äº›å±€é™æ€§ï¼š\nå½“æ ·æœ¬æ•°é‡è¿œå°äºæ ·æœ¬çš„ç‰¹å¾ç»´æ•°ï¼Œæ ·æœ¬ä¸æ ·æœ¬ä¹‹é—´çš„è·ç¦»å˜å¤§ä½¿å¾—è·ç¦»åº¦é‡å¤±æ•ˆï¼Œä½¿LDAç®—æ³•ä¸­çš„ç±»å†…ã€ç±»é—´ç¦»æ•£åº¦çŸ©é˜µå¥‡å¼‚ï¼Œä¸èƒ½å¾—åˆ°æœ€ä¼˜çš„æŠ•å½±æ–¹å‘ï¼Œåœ¨äººè„¸è¯†åˆ«é¢†åŸŸä¸­è¡¨ç°å¾—å°¤ä¸ºçªå‡º\nLDAä¸é€‚åˆå¯¹éé«˜æ–¯åˆ†å¸ƒçš„æ ·æœ¬è¿›è¡Œé™ç»´\nLDAåœ¨æ ·æœ¬åˆ†ç±»ä¿¡æ¯ä¾èµ–æ–¹å·®è€Œä¸æ˜¯å‡å€¼æ—¶ï¼Œæ•ˆæœä¸å¥½\nLDAå¯èƒ½è¿‡åº¦æ‹Ÿåˆæ•°æ®\nä¸»æˆåˆ†åˆ†æ PCA è¯¦è§£ åŸç†åŠå¯¹åº”æ“ä½œ ä¸»æˆåˆ†åˆ†æé¡¾åæ€ä¹‰æ˜¯å¯¹ä¸»æˆåˆ†è¿›è¡Œåˆ†æï¼Œé‚£ä¹ˆæ‰¾å‡ºä¸»æˆåˆ†åº”è¯¥æ˜¯keyç‚¹ã€‚PCAçš„åŸºæœ¬æ€æƒ³å°±æ˜¯å°†åˆå§‹æ•°æ®é›†ä¸­çš„nç»´ç‰¹å¾æ˜ å°„è‡³kç»´ä¸Šï¼Œå¾—åˆ°çš„kç»´ç‰¹å¾å°±å¯ä»¥è¢«ç§°ä½œä¸»æˆåˆ†ï¼Œkç»´ä¸æ˜¯åœ¨nç»´ä¸­æŒ‘é€‰å‡ºæ¥çš„ï¼Œè€Œæ˜¯ä»¥nç»´ç‰¹å¾ä¸ºåŸºç¡€é‡æ„å‡ºæ¥çš„ã€‚","title":"æ•°æ®é™ç»´ä¹‹ä¸»æˆåˆ†åˆ†æ PCA"},{"content":"é—®é¢˜ç›®å½•ï¼š 1ã€å†³ç­–æ ‘çš„å®ç°ã€ID3ã€C4.5ã€CARTï¼ˆè´å£³ï¼‰ 2ã€CARTå›å½’æ ‘æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿï¼ˆè´å£³ï¼‰ 3ã€CARTåˆ†ç±»æ ‘å’ŒID3ä»¥åŠC4.5æœ‰ä»€ä¹ˆåŒºåˆ«ï¼ˆè´å£³ï¼‰ 4ã€å‰ªææœ‰å“ªå‡ ç§æ–¹å¼ï¼ˆè´å£³ï¼‰ 5ã€æ ‘é›†æˆæ¨¡å‹æœ‰å“ªå‡ ç§å®ç°æ–¹å¼ï¼Ÿï¼ˆè´å£³ï¼‰boostingå’Œbaggingçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆçŸ¥ä¹ã€é˜¿é‡Œï¼‰ 6ã€éšæœºæ£®æ—çš„éšæœºä½“ç°åœ¨å“ªäº›æ–¹é¢ï¼ˆè´å£³ã€é˜¿é‡Œï¼‰ 7ã€AdaBoostæ˜¯å¦‚ä½•æ”¹å˜æ ·æœ¬æƒé‡ï¼ŒGBDTåˆ†ç±»æ ‘çš„åŸºæ¨¡å‹æ˜¯ï¼Ÿï¼ˆè´å£³ï¼‰ 8ã€gbdt,xgboost,lgbmçš„åŒºåˆ«(ç™¾åº¦ã€æ»´æ»´ã€é˜¿é‡Œï¼Œå¤´æ¡) 9ã€baggingä¸ºä»€ä¹ˆèƒ½å‡å°æ–¹å·®ï¼Ÿï¼ˆçŸ¥ä¹ï¼‰\nå…¶ä»–é—®é¢˜ï¼š 10ã€å…³äºAUCçš„å¦ä¸€ç§è§£é‡Šï¼šæ˜¯æŒ‘é€‰ä¸€ä¸ªæ­£æ ·æœ¬å’Œä¸€ä¸ªè´Ÿæ ·æœ¬ï¼Œæ­£æ ·æœ¬æ’åœ¨è´Ÿæ ·æœ¬å‰é¢çš„æ¦‚ç‡ï¼Ÿå¦‚ä½•ç†è§£ï¼Ÿ 11ã€æ ¡æ‹›æ˜¯é›†ä¸­æ—¶é—´åˆ·é¢˜å¥½ï¼Œè¿˜æ˜¯æ¯å¤©åˆ·ä¸€ç‚¹å¥½å‘¢ï¼Ÿ 12ã€ç°åœ¨æ¨èåœ¨å·¥ä¸šç•ŒåŸºæœ¬éƒ½ç”¨match+rankingçš„æ¶æ„ï¼Œä½†æ˜¯å­¦æœ¯ç•Œè®ºæ–‡ä¸­çš„å¤§å¤šç®—æ³•ç®—æ˜¯æ²¡æœ‰åŒºåˆ†å—ï¼Ÿend-to-endçš„æ–¹å¼ï¼Œè¿˜æ˜¯ç®—æ˜¯å¬å›ï¼Ÿ 13ã€å†…æ¨åˆ·ç®€å†ä¸¥é‡ä¹ˆï¼Ÿæ²¡æœ‰å®ä¹ ç»å†ï¼Œä¹Ÿæ²¡æœ‰ç‰›é€¼çš„ç«èµ›å’Œè®ºæ–‡ï¼Œæå‰æ‰¹æœ‰é¢è¯•æœºä¼šä¹ˆï¼Ÿæå‰æ‰¹å½±å“æ­£å¼æ‰¹ä¹ˆï¼Ÿ 14ã€é™¤äº†è‡ªå·±é¡¹ç›®ä¸­çš„æ¨¡å‹äº†è§£æ¸…æ¥šï¼Œè¿˜éœ€è¦å‡†å¤‡å“ªäº›ï¼Ÿçœ‹äº†ç¾¤ä¸»çš„é¢ç»å¤§æ¦‚çŸ¥é“äº†ä¸€äº›ï¼Œèƒ½å¦å¤§è‡´æè¿°ä¸‹ï¼Ÿ\n1ã€å†³ç­–æ ‘çš„å®ç°ã€ID3ã€C4.5ã€CARTï¼ˆè´å£³ï¼‰ è¿™é“é¢˜ä¸»è¦æ˜¯è¦æ±‚æŠŠå…¬å¼å†™ä¸€ä¸‹ï¼Œæ‰€ä»¥å†³ç­–æ ‘çš„å…¬å¼å¤§å®¶è¦ç†è§£ï¼Œå¹¶ä¸”èƒ½ç†Ÿç»ƒåœ°å†™å‡ºæ¥ã€‚è¿™é‡Œå’±ä»¬ç®€å•å›é¡¾ä¸€ä¸‹å§ã€‚ä¸»è¦å‚è€ƒç»Ÿè®¡å­¦ä¹ æ–¹æ³•å°±å¥½äº†ã€‚\nID3ä½¿ç”¨ä¿¡æ¯å¢ç›Šæ¥æŒ‡å¯¼æ ‘çš„åˆ†è£‚ï¼š C4.5é€šè¿‡ä¿¡æ¯å¢ç›Šæ¯”æ¥æŒ‡å¯¼æ ‘çš„åˆ†è£‚ï¼š CARTçš„è¯æ—¢å¯ä»¥æ˜¯åˆ†ç±»æ ‘ï¼Œä¹Ÿå¯ä»¥æ˜¯å›å½’æ ‘ã€‚å½“æ˜¯åˆ†ç±»æ ‘æ—¶ï¼Œä½¿ç”¨åŸºå°¼ç³»æ•°æ¥æŒ‡å¯¼æ ‘çš„åˆ†è£‚ï¼š å½“æ˜¯å›å½’æ ‘æ—¶ï¼Œåˆ™ä½¿ç”¨çš„æ˜¯å¹³æ–¹æŸå¤±æœ€å°ï¼š 2ã€CARTå›å½’æ ‘æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿï¼ˆè´å£³ï¼‰ CARTå›å½’æ ‘çš„å®ç°åŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼š 1ï¼‰å†³ç­–æ ‘ç”Ÿæˆï¼šåŸºäºè®­ç»ƒæ•°æ®ç”Ÿæˆå†³ç­–æ ‘ã€ç”Ÿæˆçš„å†³ç­–æ ‘è¦å°½é‡å¤§ 2ï¼‰å†³ç­–æ ‘å‰ªæï¼šç”¨éªŒè¯æ•°æ®é›†å¯¹å·²ç”Ÿæˆçš„æ ‘è¿›è¡Œå‰ªæå¹¶é€‰æ‹©æœ€ä¼˜å­æ ‘ï¼Œè¿™æ—¶ç”¨æŸå¤±å‡½æ•°æœ€å°ä½œä¸ºå‰ªæçš„æ ‡å‡†ã€‚\nè¿™éƒ¨åˆ†çš„çŸ¥è¯†ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹ä¸€ä¹¦ã€‚\n3ã€CARTåˆ†ç±»æ ‘å’ŒID3ä»¥åŠC4.5æœ‰ä»€ä¹ˆåŒºåˆ«ï¼ˆè´å£³ï¼‰ 1ï¼‰é¦–å…ˆæ˜¯å†³ç­–è§„åˆ™çš„åŒºåˆ«ï¼ŒCARTåˆ†ç±»æ ‘ä½¿ç”¨åŸºå°¼ç³»æ•°ã€ID3ä½¿ç”¨çš„æ˜¯ä¿¡æ¯å¢ç›Šï¼Œè€ŒC4.5ä½¿ç”¨çš„æ˜¯ä¿¡æ¯å¢ç›Šæ¯”ã€‚ 2ï¼‰ID3å’ŒC4.5å¯ä»¥æ˜¯å¤šå‰æ ‘ï¼Œä½†æ˜¯CARTåˆ†ç±»æ ‘åªèƒ½æ˜¯äºŒå‰æ ‘ï¼ˆè¿™æ˜¯æˆ‘å½“æ—¶ä¸»è¦å›ç­”çš„ç‚¹ï¼‰\n4ã€å‰ªææœ‰å“ªå‡ ç§æ–¹å¼ï¼ˆè´å£³ï¼‰ å‰å‰ªæå’Œåå‰ªæï¼Œå‚è€ƒå‘¨å¿—åã€Šæœºå™¨å­¦ä¹ ã€‹ã€‚\n5ã€æ ‘é›†æˆæ¨¡å‹æœ‰å“ªå‡ ç§å®ç°æ–¹å¼ï¼Ÿï¼ˆè´å£³ï¼‰boostingå’Œbaggingçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆçŸ¥ä¹ã€é˜¿é‡Œï¼‰ æ ‘é›†æˆæ¨¡å‹ä¸»è¦æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯Baggingå’ŒBoostingã€‚äºŒè€…çš„åŒºåˆ«ä¸»è¦æœ‰ä»¥ä¸‹å››ç‚¹ï¼š 1ï¼‰æ ·æœ¬é€‰æ‹©ä¸Šï¼š Baggingï¼šè®­ç»ƒé›†æ˜¯åœ¨åŸå§‹é›†ä¸­æœ‰æ”¾å›é€‰å–çš„ï¼Œä»åŸå§‹é›†ä¸­é€‰å‡ºçš„å„è½®è®­ç»ƒé›†ä¹‹é—´æ˜¯ç‹¬ç«‹çš„. Boostingï¼šæ¯ä¸€è½®çš„è®­ç»ƒé›†ä¸å˜ï¼Œåªæ˜¯è®­ç»ƒé›†ä¸­æ¯ä¸ªæ ·ä¾‹åœ¨åˆ†ç±»å™¨ä¸­çš„æƒé‡å‘ç”Ÿå˜åŒ–.è€Œæƒå€¼æ˜¯æ ¹æ®ä¸Šä¸€è½®çš„åˆ†ç±»ç»“æœè¿›è¡Œè°ƒæ•´. 2ï¼‰æ ·ä¾‹æƒé‡ï¼š Baggingï¼šä½¿ç”¨å‡åŒ€å–æ ·ï¼Œæ¯ä¸ªæ ·ä¾‹çš„æƒé‡ç›¸ç­‰ Boostingï¼šæ ¹æ®é”™è¯¯ç‡ä¸æ–­è°ƒæ•´æ ·ä¾‹çš„æƒå€¼ï¼Œé”™è¯¯ç‡è¶Šå¤§åˆ™æƒé‡è¶Šå¤§. 3ï¼‰é¢„æµ‹å‡½æ•°ï¼š Baggingï¼šæ‰€æœ‰é¢„æµ‹å‡½æ•°çš„æƒé‡ç›¸ç­‰. Boostingï¼šæ¯ä¸ªå¼±åˆ†ç±»å™¨éƒ½æœ‰ç›¸åº”çš„æƒé‡ï¼Œå¯¹äºåˆ†ç±»è¯¯å·®å°çš„åˆ†ç±»å™¨ä¼šæœ‰æ›´å¤§çš„æƒé‡. 4ï¼‰å¹¶è¡Œè®¡ç®—ï¼š Baggingï¼šå„ä¸ªé¢„æµ‹å‡½æ•°å¯ä»¥å¹¶è¡Œç”Ÿæˆ Boostingï¼šå„ä¸ªé¢„æµ‹å‡½æ•°åªèƒ½é¡ºåºç”Ÿæˆï¼Œå› ä¸ºåä¸€ä¸ªæ¨¡å‹å‚æ•°éœ€è¦å‰ä¸€è½®æ¨¡å‹çš„ç»“æœ.\n6ã€éšæœºæ£®æ—çš„éšæœºä½“ç°åœ¨å“ªäº›æ–¹é¢ï¼ˆè´å£³ã€é˜¿é‡Œï¼‰ éšæœºæ£®æ—çš„éšæœºä¸»è¦ä½“ç°åœ¨ä¸¤ä¸ªæ–¹é¢ï¼šä¸€ä¸ªæ˜¯å»ºç«‹æ¯æ£µæ ‘æ—¶æ‰€é€‰æ‹©çš„ç‰¹å¾æ˜¯éšæœºé€‰æ‹©çš„ï¼›äºŒæ˜¯ç”Ÿæˆæ¯æ£µæ ‘çš„æ ·æœ¬ä¹Ÿæ˜¯é€šè¿‡æœ‰æ”¾å›æŠ½æ ·äº§ç”Ÿçš„ã€‚\n7ã€AdaBoostæ˜¯å¦‚ä½•æ”¹å˜æ ·æœ¬æƒé‡ï¼ŒGBDTåˆ†ç±»æ ‘çš„åŸºæ¨¡å‹æ˜¯ï¼Ÿï¼ˆè´å£³ï¼‰ AdaBoostæ”¹å˜æ ·æœ¬æƒé‡ï¼šå¢åŠ åˆ†ç±»é”™è¯¯çš„æ ·æœ¬çš„æƒé‡ï¼Œå‡å°åˆ†ç±»æ­£ç¡®çš„æ ·æœ¬çš„æƒé‡ã€‚\næœ€åä¸€ä¸ªé—®é¢˜æ˜¯æˆ‘åœ¨é¢è¯•ä¹‹å‰æ²¡æœ‰äº†è§£åˆ°çš„ï¼ŒGBDTæ— è®ºåšåˆ†ç±»è¿˜æ˜¯å›å½’é—®é¢˜ï¼Œä½¿ç”¨çš„éƒ½æ˜¯CARTå›å½’æ ‘ã€‚\n8ã€gbdt,xgboost,lgbmçš„åŒºåˆ«(ç™¾åº¦ã€æ»´æ»´ã€é˜¿é‡Œï¼Œå¤´æ¡) é¦–å…ˆæ¥çœ‹GBDTå’ŒXgboostï¼ŒäºŒè€…çš„åŒºåˆ«å¦‚ä¸‹ï¼š\n1ï¼‰ä¼ ç»Ÿ GBDT ä»¥ CART ä½œä¸ºåŸºåˆ†ç±»å™¨ï¼Œxgboost è¿˜æ”¯æŒçº¿æ€§åˆ†ç±»å™¨ï¼Œè¿™ä¸ªæ—¶å€™ xgboost ç›¸å½“äºå¸¦ L1 å’Œ L2 æ­£åˆ™åŒ–é¡¹çš„é€»è¾‘æ–¯è’‚å›å½’(åˆ†ç±»é—®é¢˜)æˆ–è€…çº¿æ€§å›å½’(å›å½’é—®é¢˜)ã€‚ 2ï¼‰ä¼ ç»Ÿ GBDT åœ¨ä¼˜åŒ–æ—¶åªç”¨åˆ°ä¸€é˜¶å¯¼æ•°ä¿¡æ¯ï¼Œxgboost åˆ™å¯¹ä»£ä»·å‡½æ•°è¿›è¡Œäº†äºŒé˜¶æ³°å‹’å±•å¼€ï¼ŒåŒæ—¶ç”¨åˆ°äº†ä¸€é˜¶å’ŒäºŒé˜¶å¯¼æ•°ã€‚é¡ºä¾¿ ä¸€ä¸‹ï¼Œxgboost å·¥å…·æ”¯æŒè‡ªå®šä¹‰ä»£ä»·å‡½æ•°ï¼Œåªè¦å‡½æ•°å¯ä¸€é˜¶å’ŒäºŒé˜¶æ±‚å¯¼ã€‚ 3ï¼‰xgboost åœ¨ä»£ä»·å‡½æ•°é‡ŒåŠ å…¥äº†æ­£åˆ™é¡¹ï¼Œç”¨äºæ§åˆ¶æ¨¡å‹çš„å¤æ‚åº¦ã€‚æ­£åˆ™é¡¹é‡ŒåŒ…å«äº†æ ‘çš„å¶å­èŠ‚ç‚¹ä¸ªæ•°ã€æ¯ä¸ªå¶å­èŠ‚ç‚¹ä¸Šè¾“å‡ºçš„ score çš„ L2 æ¨¡çš„å¹³æ–¹å’Œã€‚ä» Bias-variance tradeoff è§’åº¦æ¥è®²ï¼Œæ­£åˆ™é¡¹é™ä½äº†æ¨¡å‹çš„varianceï¼Œä½¿å­¦ä¹ å‡ºæ¥çš„æ¨¡å‹æ›´åŠ ç®€å•ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆï¼Œè¿™ä¹Ÿæ˜¯ xgboost ä¼˜äºä¼ ç»ŸGBDT çš„ä¸€ä¸ªç‰¹æ€§ã€‚ 4ï¼‰Shrinkage(ç¼©å‡)ï¼Œç›¸å½“äºå­¦ä¹ é€Ÿç‡(xgboost ä¸­çš„eta)ã€‚xgboost åœ¨è¿›è¡Œå®Œä¸€æ¬¡è¿­ä»£åï¼Œä¼šå°†å¶å­èŠ‚ç‚¹çš„æƒé‡ä¹˜ä¸Šè¯¥ç³»æ•°ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‰Š å¼±æ¯æ£µæ ‘çš„å½±å“ï¼Œè®©åé¢æœ‰æ›´å¤§çš„å­¦ä¹ ç©ºé—´ã€‚å®é™…åº”ç”¨ä¸­ï¼Œä¸€èˆ¬æŠŠ eta è®¾ç½®å¾—å°ä¸€ç‚¹ï¼Œç„¶åè¿­ä»£æ¬¡æ•°è®¾ç½®å¾—å¤§ä¸€ç‚¹ã€‚(è¡¥å……:ä¼ ç»Ÿ GBDT çš„å®ç° ä¹Ÿæœ‰å­¦ä¹ é€Ÿç‡) 5ï¼‰åˆ—æŠ½æ ·(column subsampling)ã€‚xgboost å€Ÿé‰´äº†éšæœºæ£®æ—çš„åšæ³•ï¼Œæ”¯ æŒåˆ—æŠ½æ ·ï¼Œä¸ä»…èƒ½é™ä½è¿‡æ‹Ÿåˆï¼Œè¿˜èƒ½å‡å°‘è®¡ç®—ï¼Œè¿™ä¹Ÿæ˜¯ xgboost å¼‚äºä¼  ç»Ÿ gbdt çš„ä¸€ä¸ªç‰¹æ€§ã€‚ 6ï¼‰å¯¹ç¼ºå¤±å€¼çš„å¤„ç†ã€‚å¯¹äºç‰¹å¾çš„å€¼æœ‰ç¼ºå¤±çš„æ ·æœ¬ï¼Œxgboost å¯ä»¥è‡ªåŠ¨å­¦ä¹  å‡ºå®ƒçš„åˆ†è£‚æ–¹å‘ã€‚ 7ï¼‰xgboost å·¥å…·æ”¯æŒå¹¶è¡Œã€‚boosting ä¸æ˜¯ä¸€ç§ä¸²è¡Œçš„ç»“æ„å—?æ€ä¹ˆå¹¶è¡Œçš„? æ³¨æ„ xgboost çš„å¹¶è¡Œä¸æ˜¯ tree ç²’åº¦çš„å¹¶è¡Œï¼Œxgboost ä¹Ÿæ˜¯ä¸€æ¬¡è¿­ä»£å®Œæ‰èƒ½è¿›è¡Œä¸‹ä¸€æ¬¡è¿­ä»£çš„(ç¬¬ t æ¬¡è¿­ä»£çš„ä»£ä»·å‡½æ•°é‡ŒåŒ…å«äº†å‰é¢ t-1 æ¬¡è¿­ä»£ çš„é¢„æµ‹å€¼)ã€‚xgboost çš„å¹¶è¡Œæ˜¯åœ¨ç‰¹å¾ç²’åº¦ä¸Šçš„ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå†³ç­–æ ‘çš„å­¦ä¹ æœ€è€—æ—¶çš„ä¸€ä¸ªæ­¥éª¤å°±æ˜¯å¯¹ç‰¹å¾çš„å€¼è¿›è¡Œæ’åº(å› ä¸ºè¦ç¡®å®šæœ€ä½³åˆ†å‰²ç‚¹)ï¼Œxgbooståœ¨è®­ç»ƒä¹‹å‰ï¼Œé¢„å…ˆå¯¹æ•°æ®è¿›è¡Œäº†æ’åºï¼Œç„¶åä¿å­˜ä¸º block ç»“æ„ï¼Œåé¢çš„è¿­ä»£ä¸­é‡å¤åœ°ä½¿ç”¨è¿™ä¸ªç»“æ„ï¼Œå¤§å¤§å‡å°è®¡ç®—é‡ã€‚è¿™ä¸ªblockç»“æ„ä¹Ÿä½¿å¾—å¹¶è¡Œæˆä¸ºäº†å¯èƒ½ï¼Œåœ¨è¿›è¡ŒèŠ‚ç‚¹çš„åˆ†è£‚æ—¶ï¼Œéœ€è¦è®¡ç®—æ¯ ä¸ªç‰¹å¾çš„å¢ç›Šï¼Œæœ€ç»ˆé€‰å¢ç›Šæœ€å¤§çš„é‚£ä¸ªç‰¹å¾å»åšåˆ†è£‚ï¼Œé‚£ä¹ˆå„ä¸ªç‰¹å¾çš„å¢ç›Šè®¡ç®—å°±å¯ä»¥å¼€å¤šçº¿ç¨‹è¿›è¡Œã€‚ 8ï¼‰å¯å¹¶è¡Œçš„è¿‘ä¼¼ç›´æ–¹å›¾ç®—æ³•ã€‚æ ‘èŠ‚ç‚¹åœ¨è¿›è¡Œåˆ†è£‚æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—æ¯ä¸ªç‰¹å¾çš„æ¯ä¸ªåˆ†å‰²ç‚¹å¯¹åº”çš„å¢ç›Šï¼Œå³ç”¨è´ªå¿ƒæ³•æšä¸¾æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²ç‚¹ã€‚å½“æ•°æ®æ— æ³•ä¸€æ¬¡è½½å…¥å†…å­˜æˆ–è€…åœ¨åˆ†å¸ƒå¼æƒ…å†µä¸‹ï¼Œè´ªå¿ƒç®—æ³•æ•ˆç‡å°±ä¼šå˜å¾—å¾ˆä½ï¼Œæ‰€ä»¥ xgboost è¿˜ å‡ºäº†ä¸€ç§å¯å¹¶è¡Œçš„è¿‘ä¼¼ç›´æ–¹å›¾ç®—æ³•ï¼Œç”¨äºé«˜æ•ˆåœ°ç”Ÿæˆå€™é€‰çš„åˆ†å‰²ç‚¹ã€‚\nå†æ¥çœ‹Xgboostå’ŒLightGBMï¼ŒäºŒè€…çš„åŒºåˆ«å¦‚ä¸‹ï¼š\n1ï¼‰ç”±äºåœ¨å†³ç­–æ ‘åœ¨æ¯ä¸€æ¬¡é€‰æ‹©èŠ‚ç‚¹ç‰¹å¾çš„è¿‡ç¨‹ä¸­ï¼Œè¦éå†æ‰€æœ‰çš„å±æ€§çš„æ‰€æœ‰å– å€¼å¹¶é€‰æ‹©ä¸€ä¸ªè¾ƒå¥½çš„ã€‚XGBoost ä½¿ç”¨çš„æ˜¯è¿‘ä¼¼ç®—æ³•ç®—æ³•ï¼Œå…ˆå¯¹ç‰¹å¾å€¼è¿›è¡Œæ’åº Pre-sortï¼Œç„¶åæ ¹æ®äºŒé˜¶æ¢¯åº¦è¿›è¡Œåˆ†æ¡¶ï¼Œèƒ½å¤Ÿæ›´ç²¾ç¡®çš„æ‰¾åˆ°æ•°æ®åˆ†éš”ç‚¹;ä½†æ˜¯ å¤æ‚åº¦è¾ƒé«˜ã€‚LightGBM ä½¿ç”¨çš„æ˜¯ histogram ç®—æ³•ï¼Œè¿™ç§åªéœ€è¦å°†æ•°æ®åˆ†å‰²æˆä¸åŒçš„æ®µå³å¯ï¼Œä¸éœ€è¦è¿›è¡Œé¢„å…ˆçš„æ’åºã€‚å ç”¨çš„å†…å­˜æ›´ä½ï¼Œæ•°æ®åˆ†éš”çš„å¤æ‚åº¦æ›´ä½ã€‚ 2ï¼‰å†³ç­–æ ‘ç”Ÿé•¿ç­–ç•¥ï¼Œæˆ‘ä»¬åˆšæ‰ä»‹ç»è¿‡äº†ï¼ŒXGBoosté‡‡ç”¨çš„æ˜¯ Level-wise çš„æ ‘ ç”Ÿé•¿ç­–ç•¥ï¼ŒLightGBM é‡‡ç”¨çš„æ˜¯ leaf-wise çš„ç”Ÿé•¿ç­–ç•¥ã€‚ 3ï¼‰å¹¶è¡Œç­–ç•¥å¯¹æ¯”ï¼ŒXGBoost çš„å¹¶è¡Œä¸»è¦é›†ä¸­åœ¨ç‰¹å¾å¹¶è¡Œä¸Šï¼Œè€Œ LightGBM çš„å¹¶ è¡Œç­–ç•¥åˆ†ç‰¹å¾å¹¶è¡Œï¼Œæ•°æ®å¹¶è¡Œä»¥åŠæŠ•ç¥¨å¹¶è¡Œã€‚\n9ã€baggingä¸ºä»€ä¹ˆèƒ½å‡å°æ–¹å·®ï¼Ÿï¼ˆçŸ¥ä¹ï¼‰ è¿™ä¸ªå½“æ—¶ä¹Ÿæ²¡æœ‰ç­”ä¸Šæ¥ï¼Œå¯ä»¥å‚è€ƒä¸€ä¸‹åšå®¢ï¼šhttps://blog.csdn.net/shenxiaoming77/article/details/53894973\næ ‘æ¨¡å‹ç›¸å…³çš„é¢˜ç›®ä»¥ä¸Šå°±å·®ä¸å¤šäº†ã€‚æ¥ä¸‹æ¥æ•´ç†ä¸€äº›æœ€è¿‘ç¾¤å‹æå‡ºçš„é—®é¢˜ï¼Œæˆ‘è§‰å¾—æœ‰ä¸€äº›å¯èƒ½ä½œä¸ºé¢è¯•é¢˜ï¼Œæœ‰ä¸€äº›æ˜¯å‡†å¤‡æ ¡æ‹›è¿‡ç¨‹ä¸­çš„ç»éªŒï¼š\n10ã€å…³äºAUCçš„å¦ä¸€ç§è§£é‡Šï¼šæ˜¯æŒ‘é€‰ä¸€ä¸ªæ­£æ ·æœ¬å’Œä¸€ä¸ªè´Ÿæ ·æœ¬ï¼Œæ­£æ ·æœ¬æ’åœ¨è´Ÿæ ·æœ¬å‰é¢çš„æ¦‚ç‡ï¼Ÿå¦‚ä½•ç†è§£ï¼Ÿ æˆ‘ä»¬éƒ½çŸ¥é“AUCæ˜¯ROCæ›²çº¿ä¸‹æ–¹çš„é¢ç§¯ï¼ŒROCæ›²çº¿çš„æ¨ªè½´æ˜¯çœŸæ­£ä¾‹ç‡ï¼Œçºµè½´æ˜¯å‡æ­£ä¾‹ç‡ã€‚æˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼ç†è§£ä¸€ä¸‹ï¼šé¦–å…ˆå·æ¢ä¸€ä¸‹æ¦‚å¿µï¼Œæ„æ€è¿˜æ˜¯ä¸€æ ·çš„ï¼Œä»»æ„ç»™å®šä¸€ä¸ªè´Ÿæ ·æœ¬ï¼Œæ‰€æœ‰æ­£æ ·æœ¬çš„scoreä¸­æœ‰å¤šå¤§æ¯”ä¾‹æ˜¯å¤§äºè¯¥è´Ÿç±»æ ·æœ¬çš„scoreï¼Ÿé‚£ä¹ˆå¯¹æ¯ä¸ªè´Ÿæ ·æœ¬æ¥è¯´ï¼Œæœ‰å¤šå°‘çš„æ­£æ ·æœ¬çš„scoreæ¯”å®ƒçš„scoreå¤§å‘¢ï¼Ÿæ˜¯ä¸æ˜¯å°±æ˜¯å½“ç»“æœæŒ‰ç…§scoreæ’åºï¼Œé˜ˆå€¼æ°å¥½ä¸ºè¯¥è´Ÿæ ·æœ¬scoreæ—¶çš„çœŸæ­£ä¾‹ç‡TPRï¼Ÿç†è§£åˆ°è¿™ä¸€å±‚ï¼ŒäºŒè€…ç­‰ä»·çš„å…³ç³»ä¹Ÿå°±è±ç„¶å¼€æœ—äº†ã€‚ROCæ›²çº¿ä¸‹çš„é¢ç§¯æˆ–è€…è¯´AUCçš„å€¼ ä¸ æµ‹è¯•ä»»æ„ç»™ä¸€ä¸ªæ­£ç±»æ ·æœ¬å’Œä¸€ä¸ªè´Ÿç±»æ ·æœ¬ï¼Œæ­£ç±»æ ·æœ¬çš„scoreæœ‰å¤šå¤§çš„æ¦‚ç‡å¤§äºè´Ÿç±»æ ·æœ¬çš„scoreæ˜¯ç­‰ä»·çš„ã€‚\n11ã€æ ¡æ‹›æ˜¯é›†ä¸­æ—¶é—´åˆ·é¢˜å¥½ï¼Œè¿˜æ˜¯æ¯å¤©åˆ·ä¸€ç‚¹å¥½å‘¢ï¼Ÿ æˆ‘çš„å»ºè®®æ˜¯å¹³æ—¶æ¯å¤©åˆ·3ï½5é“ï¼Œç„¶åä¸´è¿‘æ ¡æ‹›çš„æ—¶å€™é›†ä¸­åˆ·ã€‚å¦å¤–å°±æ˜¯æ ¹æ®æ¯æ¬¡é¢è¯•ä¸­è¢«é—®åˆ°çš„é—®é¢˜ï¼Œå¦‚æœæœ‰æ²¡ç­”ä¸Šæ¥çš„ï¼Œå°±é’ˆå¯¹è¿™ä¸€ç±»çš„é¢˜å‹å¤šåˆ·åˆ·ã€‚\n12ã€ç°åœ¨æ¨èåœ¨å·¥ä¸šç•ŒåŸºæœ¬éƒ½ç”¨match+rankingçš„æ¶æ„ï¼Œä½†æ˜¯å­¦æœ¯ç•Œè®ºæ–‡ä¸­çš„å¤§å¤šç®—æ³•ç®—æ˜¯æ²¡æœ‰åŒºåˆ†å—ï¼Ÿend-to-endçš„æ–¹å¼ï¼Œè¿˜æ˜¯ç®—æ˜¯å¬å›ï¼Ÿ å­¦æœ¯ç•Œè®ºæ–‡å¾€å¾€ä¸é’ˆå¯¹æ•´ä¸ªæ¨èç³»ç»Ÿï¼Œè€Œåªé’ˆå¯¹matchæˆ–è€…rankingé˜¶æ®µçš„æŸä¸€ç§æ–¹æ³•è¿›è¡Œç ”ç©¶ã€‚æ¯”å¦‚DeepFMã€Wide \u0026amp; Deepï¼Œåªé’ˆå¯¹rankingé˜¶æ®µã€‚è€Œé˜¿é‡Œæœ‰å‡ ç¯‡ä»‹ç»embeddingçš„è®ºæ–‡ï¼Œåªä»‹ç»matché˜¶æ®µçš„æ–¹æ³•ã€‚end-to-endçš„æ–¹å¼ï¼Œåœ¨matchå’Œrankingé˜¶æ®µéƒ½æœ‰å§ã€‚\n","permalink":"https://reid00.github.io/en/posts/ml/%E6%9C%80%E5%B8%B8%E8%80%83%E7%9A%84%E6%A0%91%E6%A8%A1%E5%9E%8B%E9%97%AE%E9%A2%98/","summary":"é—®é¢˜ç›®å½•ï¼š 1ã€å†³ç­–æ ‘çš„å®ç°ã€ID3ã€C4.5ã€CARTï¼ˆè´å£³ï¼‰ 2ã€CARTå›å½’æ ‘æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿï¼ˆè´å£³ï¼‰ 3ã€CARTåˆ†ç±»æ ‘å’ŒID3ä»¥åŠC4.5æœ‰ä»€ä¹ˆåŒºåˆ«ï¼ˆè´å£³ï¼‰ 4ã€å‰ªææœ‰å“ªå‡ ç§æ–¹å¼ï¼ˆè´å£³ï¼‰ 5ã€æ ‘é›†æˆæ¨¡å‹æœ‰å“ªå‡ ç§å®ç°æ–¹å¼ï¼Ÿï¼ˆè´å£³ï¼‰boostingå’Œbaggingçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆçŸ¥ä¹ã€é˜¿é‡Œï¼‰ 6ã€éšæœºæ£®æ—çš„éšæœºä½“ç°åœ¨å“ªäº›æ–¹é¢ï¼ˆè´å£³ã€é˜¿é‡Œï¼‰ 7ã€AdaBoostæ˜¯å¦‚ä½•æ”¹å˜æ ·æœ¬æƒé‡ï¼ŒGBDTåˆ†ç±»æ ‘çš„åŸºæ¨¡å‹æ˜¯ï¼Ÿï¼ˆè´å£³ï¼‰ 8ã€gbdt,xgboost,lgbmçš„åŒºåˆ«(ç™¾åº¦ã€æ»´æ»´ã€é˜¿é‡Œï¼Œå¤´æ¡) 9ã€baggingä¸ºä»€ä¹ˆèƒ½å‡å°æ–¹å·®ï¼Ÿï¼ˆçŸ¥ä¹ï¼‰\nå…¶ä»–é—®é¢˜ï¼š 10ã€å…³äºAUCçš„å¦ä¸€ç§è§£é‡Šï¼šæ˜¯æŒ‘é€‰ä¸€ä¸ªæ­£æ ·æœ¬å’Œä¸€ä¸ªè´Ÿæ ·æœ¬ï¼Œæ­£æ ·æœ¬æ’åœ¨è´Ÿæ ·æœ¬å‰é¢çš„æ¦‚ç‡ï¼Ÿå¦‚ä½•ç†è§£ï¼Ÿ 11ã€æ ¡æ‹›æ˜¯é›†ä¸­æ—¶é—´åˆ·é¢˜å¥½ï¼Œè¿˜æ˜¯æ¯å¤©åˆ·ä¸€ç‚¹å¥½å‘¢ï¼Ÿ 12ã€ç°åœ¨æ¨èåœ¨å·¥ä¸šç•ŒåŸºæœ¬éƒ½ç”¨match+rankingçš„æ¶æ„ï¼Œä½†æ˜¯å­¦æœ¯ç•Œè®ºæ–‡ä¸­çš„å¤§å¤šç®—æ³•ç®—æ˜¯æ²¡æœ‰åŒºåˆ†å—ï¼Ÿend-to-endçš„æ–¹å¼ï¼Œè¿˜æ˜¯ç®—æ˜¯å¬å›ï¼Ÿ 13ã€å†…æ¨åˆ·ç®€å†ä¸¥é‡ä¹ˆï¼Ÿæ²¡æœ‰å®ä¹ ç»å†ï¼Œä¹Ÿæ²¡æœ‰ç‰›é€¼çš„ç«èµ›å’Œè®ºæ–‡ï¼Œæå‰æ‰¹æœ‰é¢è¯•æœºä¼šä¹ˆï¼Ÿæå‰æ‰¹å½±å“æ­£å¼æ‰¹ä¹ˆï¼Ÿ 14ã€é™¤äº†è‡ªå·±é¡¹ç›®ä¸­çš„æ¨¡å‹äº†è§£æ¸…æ¥šï¼Œè¿˜éœ€è¦å‡†å¤‡å“ªäº›ï¼Ÿçœ‹äº†ç¾¤ä¸»çš„é¢ç»å¤§æ¦‚çŸ¥é“äº†ä¸€äº›ï¼Œèƒ½å¦å¤§è‡´æè¿°ä¸‹ï¼Ÿ\n1ã€å†³ç­–æ ‘çš„å®ç°ã€ID3ã€C4.5ã€CARTï¼ˆè´å£³ï¼‰ è¿™é“é¢˜ä¸»è¦æ˜¯è¦æ±‚æŠŠå…¬å¼å†™ä¸€ä¸‹ï¼Œæ‰€ä»¥å†³ç­–æ ‘çš„å…¬å¼å¤§å®¶è¦ç†è§£ï¼Œå¹¶ä¸”èƒ½ç†Ÿç»ƒåœ°å†™å‡ºæ¥ã€‚è¿™é‡Œå’±ä»¬ç®€å•å›é¡¾ä¸€ä¸‹å§ã€‚ä¸»è¦å‚è€ƒç»Ÿè®¡å­¦ä¹ æ–¹æ³•å°±å¥½äº†ã€‚\nID3ä½¿ç”¨ä¿¡æ¯å¢ç›Šæ¥æŒ‡å¯¼æ ‘çš„åˆ†è£‚ï¼š C4.5é€šè¿‡ä¿¡æ¯å¢ç›Šæ¯”æ¥æŒ‡å¯¼æ ‘çš„åˆ†è£‚ï¼š CARTçš„è¯æ—¢å¯ä»¥æ˜¯åˆ†ç±»æ ‘ï¼Œä¹Ÿå¯ä»¥æ˜¯å›å½’æ ‘ã€‚å½“æ˜¯åˆ†ç±»æ ‘æ—¶ï¼Œä½¿ç”¨åŸºå°¼ç³»æ•°æ¥æŒ‡å¯¼æ ‘çš„åˆ†è£‚ï¼š å½“æ˜¯å›å½’æ ‘æ—¶ï¼Œåˆ™ä½¿ç”¨çš„æ˜¯å¹³æ–¹æŸå¤±æœ€å°ï¼š 2ã€CARTå›å½’æ ‘æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿï¼ˆè´å£³ï¼‰ CARTå›å½’æ ‘çš„å®ç°åŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼š 1ï¼‰å†³ç­–æ ‘ç”Ÿæˆï¼šåŸºäºè®­ç»ƒæ•°æ®ç”Ÿæˆå†³ç­–æ ‘ã€ç”Ÿæˆçš„å†³ç­–æ ‘è¦å°½é‡å¤§ 2ï¼‰å†³ç­–æ ‘å‰ªæï¼šç”¨éªŒè¯æ•°æ®é›†å¯¹å·²ç”Ÿæˆçš„æ ‘è¿›è¡Œå‰ªæå¹¶é€‰æ‹©æœ€ä¼˜å­æ ‘ï¼Œè¿™æ—¶ç”¨æŸå¤±å‡½æ•°æœ€å°ä½œä¸ºå‰ªæçš„æ ‡å‡†ã€‚\nè¿™éƒ¨åˆ†çš„çŸ¥è¯†ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹ä¸€ä¹¦ã€‚\n3ã€CARTåˆ†ç±»æ ‘å’ŒID3ä»¥åŠC4.5æœ‰ä»€ä¹ˆåŒºåˆ«ï¼ˆè´å£³ï¼‰ 1ï¼‰é¦–å…ˆæ˜¯å†³ç­–è§„åˆ™çš„åŒºåˆ«ï¼ŒCARTåˆ†ç±»æ ‘ä½¿ç”¨åŸºå°¼ç³»æ•°ã€ID3ä½¿ç”¨çš„æ˜¯ä¿¡æ¯å¢ç›Šï¼Œè€ŒC4.5ä½¿ç”¨çš„æ˜¯ä¿¡æ¯å¢ç›Šæ¯”ã€‚ 2ï¼‰ID3å’ŒC4.5å¯ä»¥æ˜¯å¤šå‰æ ‘ï¼Œä½†æ˜¯CARTåˆ†ç±»æ ‘åªèƒ½æ˜¯äºŒå‰æ ‘ï¼ˆè¿™æ˜¯æˆ‘å½“æ—¶ä¸»è¦å›ç­”çš„ç‚¹ï¼‰\n4ã€å‰ªææœ‰å“ªå‡ ç§æ–¹å¼ï¼ˆè´å£³ï¼‰ å‰å‰ªæå’Œåå‰ªæï¼Œå‚è€ƒå‘¨å¿—åã€Šæœºå™¨å­¦ä¹ ã€‹ã€‚\n5ã€æ ‘é›†æˆæ¨¡å‹æœ‰å“ªå‡ ç§å®ç°æ–¹å¼ï¼Ÿï¼ˆè´å£³ï¼‰boostingå’Œbaggingçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆçŸ¥ä¹ã€é˜¿é‡Œï¼‰ æ ‘é›†æˆæ¨¡å‹ä¸»è¦æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯Baggingå’ŒBoostingã€‚äºŒè€…çš„åŒºåˆ«ä¸»è¦æœ‰ä»¥ä¸‹å››ç‚¹ï¼š 1ï¼‰æ ·æœ¬é€‰æ‹©ä¸Šï¼š Baggingï¼šè®­ç»ƒé›†æ˜¯åœ¨åŸå§‹é›†ä¸­æœ‰æ”¾å›é€‰å–çš„ï¼Œä»åŸå§‹é›†ä¸­é€‰å‡ºçš„å„è½®è®­ç»ƒé›†ä¹‹é—´æ˜¯ç‹¬ç«‹çš„. Boostingï¼šæ¯ä¸€è½®çš„è®­ç»ƒé›†ä¸å˜ï¼Œåªæ˜¯è®­ç»ƒé›†ä¸­æ¯ä¸ªæ ·ä¾‹åœ¨åˆ†ç±»å™¨ä¸­çš„æƒé‡å‘ç”Ÿå˜åŒ–.è€Œæƒå€¼æ˜¯æ ¹æ®ä¸Šä¸€è½®çš„åˆ†ç±»ç»“æœè¿›è¡Œè°ƒæ•´. 2ï¼‰æ ·ä¾‹æƒé‡ï¼š Baggingï¼šä½¿ç”¨å‡åŒ€å–æ ·ï¼Œæ¯ä¸ªæ ·ä¾‹çš„æƒé‡ç›¸ç­‰ Boostingï¼šæ ¹æ®é”™è¯¯ç‡ä¸æ–­è°ƒæ•´æ ·ä¾‹çš„æƒå€¼ï¼Œé”™è¯¯ç‡è¶Šå¤§åˆ™æƒé‡è¶Šå¤§. 3ï¼‰é¢„æµ‹å‡½æ•°ï¼š Baggingï¼šæ‰€æœ‰é¢„æµ‹å‡½æ•°çš„æƒé‡ç›¸ç­‰. Boostingï¼šæ¯ä¸ªå¼±åˆ†ç±»å™¨éƒ½æœ‰ç›¸åº”çš„æƒé‡ï¼Œå¯¹äºåˆ†ç±»è¯¯å·®å°çš„åˆ†ç±»å™¨ä¼šæœ‰æ›´å¤§çš„æƒé‡. 4ï¼‰å¹¶è¡Œè®¡ç®—ï¼š Baggingï¼šå„ä¸ªé¢„æµ‹å‡½æ•°å¯ä»¥å¹¶è¡Œç”Ÿæˆ Boostingï¼šå„ä¸ªé¢„æµ‹å‡½æ•°åªèƒ½é¡ºåºç”Ÿæˆï¼Œå› ä¸ºåä¸€ä¸ªæ¨¡å‹å‚æ•°éœ€è¦å‰ä¸€è½®æ¨¡å‹çš„ç»“æœ.\n6ã€éšæœºæ£®æ—çš„éšæœºä½“ç°åœ¨å“ªäº›æ–¹é¢ï¼ˆè´å£³ã€é˜¿é‡Œï¼‰ éšæœºæ£®æ—çš„éšæœºä¸»è¦ä½“ç°åœ¨ä¸¤ä¸ªæ–¹é¢ï¼šä¸€ä¸ªæ˜¯å»ºç«‹æ¯æ£µæ ‘æ—¶æ‰€é€‰æ‹©çš„ç‰¹å¾æ˜¯éšæœºé€‰æ‹©çš„ï¼›äºŒæ˜¯ç”Ÿæˆæ¯æ£µæ ‘çš„æ ·æœ¬ä¹Ÿæ˜¯é€šè¿‡æœ‰æ”¾å›æŠ½æ ·äº§ç”Ÿçš„ã€‚\n7ã€AdaBoostæ˜¯å¦‚ä½•æ”¹å˜æ ·æœ¬æƒé‡ï¼ŒGBDTåˆ†ç±»æ ‘çš„åŸºæ¨¡å‹æ˜¯ï¼Ÿï¼ˆè´å£³ï¼‰ AdaBoostæ”¹å˜æ ·æœ¬æƒé‡ï¼šå¢åŠ åˆ†ç±»é”™è¯¯çš„æ ·æœ¬çš„æƒé‡ï¼Œå‡å°åˆ†ç±»æ­£ç¡®çš„æ ·æœ¬çš„æƒé‡ã€‚\næœ€åä¸€ä¸ªé—®é¢˜æ˜¯æˆ‘åœ¨é¢è¯•ä¹‹å‰æ²¡æœ‰äº†è§£åˆ°çš„ï¼ŒGBDTæ— è®ºåšåˆ†ç±»è¿˜æ˜¯å›å½’é—®é¢˜ï¼Œä½¿ç”¨çš„éƒ½æ˜¯CARTå›å½’æ ‘ã€‚\n8ã€gbdt,xgboost,lgbmçš„åŒºåˆ«(ç™¾åº¦ã€æ»´æ»´ã€é˜¿é‡Œï¼Œå¤´æ¡) é¦–å…ˆæ¥çœ‹GBDTå’ŒXgboostï¼ŒäºŒè€…çš„åŒºåˆ«å¦‚ä¸‹ï¼š\n1ï¼‰ä¼ ç»Ÿ GBDT ä»¥ CART ä½œä¸ºåŸºåˆ†ç±»å™¨ï¼Œxgboost è¿˜æ”¯æŒçº¿æ€§åˆ†ç±»å™¨ï¼Œè¿™ä¸ªæ—¶å€™ xgboost ç›¸å½“äºå¸¦ L1 å’Œ L2 æ­£åˆ™åŒ–é¡¹çš„é€»è¾‘æ–¯è’‚å›å½’(åˆ†ç±»é—®é¢˜)æˆ–è€…çº¿æ€§å›å½’(å›å½’é—®é¢˜)ã€‚ 2ï¼‰ä¼ ç»Ÿ GBDT åœ¨ä¼˜åŒ–æ—¶åªç”¨åˆ°ä¸€é˜¶å¯¼æ•°ä¿¡æ¯ï¼Œxgboost åˆ™å¯¹ä»£ä»·å‡½æ•°è¿›è¡Œäº†äºŒé˜¶æ³°å‹’å±•å¼€ï¼ŒåŒæ—¶ç”¨åˆ°äº†ä¸€é˜¶å’ŒäºŒé˜¶å¯¼æ•°ã€‚é¡ºä¾¿ ä¸€ä¸‹ï¼Œxgboost å·¥å…·æ”¯æŒè‡ªå®šä¹‰ä»£ä»·å‡½æ•°ï¼Œåªè¦å‡½æ•°å¯ä¸€é˜¶å’ŒäºŒé˜¶æ±‚å¯¼ã€‚ 3ï¼‰xgboost åœ¨ä»£ä»·å‡½æ•°é‡ŒåŠ å…¥äº†æ­£åˆ™é¡¹ï¼Œç”¨äºæ§åˆ¶æ¨¡å‹çš„å¤æ‚åº¦ã€‚æ­£åˆ™é¡¹é‡ŒåŒ…å«äº†æ ‘çš„å¶å­èŠ‚ç‚¹ä¸ªæ•°ã€æ¯ä¸ªå¶å­èŠ‚ç‚¹ä¸Šè¾“å‡ºçš„ score çš„ L2 æ¨¡çš„å¹³æ–¹å’Œã€‚ä» Bias-variance tradeoff è§’åº¦æ¥è®²ï¼Œæ­£åˆ™é¡¹é™ä½äº†æ¨¡å‹çš„varianceï¼Œä½¿å­¦ä¹ å‡ºæ¥çš„æ¨¡å‹æ›´åŠ ç®€å•ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆï¼Œè¿™ä¹Ÿæ˜¯ xgboost ä¼˜äºä¼ ç»ŸGBDT çš„ä¸€ä¸ªç‰¹æ€§ã€‚ 4ï¼‰Shrinkage(ç¼©å‡)ï¼Œç›¸å½“äºå­¦ä¹ é€Ÿç‡(xgboost ä¸­çš„eta)ã€‚xgboost åœ¨è¿›è¡Œå®Œä¸€æ¬¡è¿­ä»£åï¼Œä¼šå°†å¶å­èŠ‚ç‚¹çš„æƒé‡ä¹˜ä¸Šè¯¥ç³»æ•°ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‰Š å¼±æ¯æ£µæ ‘çš„å½±å“ï¼Œè®©åé¢æœ‰æ›´å¤§çš„å­¦ä¹ ç©ºé—´ã€‚å®é™…åº”ç”¨ä¸­ï¼Œä¸€èˆ¬æŠŠ eta è®¾ç½®å¾—å°ä¸€ç‚¹ï¼Œç„¶åè¿­ä»£æ¬¡æ•°è®¾ç½®å¾—å¤§ä¸€ç‚¹ã€‚(è¡¥å……:ä¼ ç»Ÿ GBDT çš„å®ç° ä¹Ÿæœ‰å­¦ä¹ é€Ÿç‡) 5ï¼‰åˆ—æŠ½æ ·(column subsampling)ã€‚xgboost å€Ÿé‰´äº†éšæœºæ£®æ—çš„åšæ³•ï¼Œæ”¯ æŒåˆ—æŠ½æ ·ï¼Œä¸ä»…èƒ½é™ä½è¿‡æ‹Ÿåˆï¼Œè¿˜èƒ½å‡å°‘è®¡ç®—ï¼Œè¿™ä¹Ÿæ˜¯ xgboost å¼‚äºä¼  ç»Ÿ gbdt çš„ä¸€ä¸ªç‰¹æ€§ã€‚ 6ï¼‰å¯¹ç¼ºå¤±å€¼çš„å¤„ç†ã€‚å¯¹äºç‰¹å¾çš„å€¼æœ‰ç¼ºå¤±çš„æ ·æœ¬ï¼Œxgboost å¯ä»¥è‡ªåŠ¨å­¦ä¹  å‡ºå®ƒçš„åˆ†è£‚æ–¹å‘ã€‚ 7ï¼‰xgboost å·¥å…·æ”¯æŒå¹¶è¡Œã€‚boosting ä¸æ˜¯ä¸€ç§ä¸²è¡Œçš„ç»“æ„å—?","title":"æœ€å¸¸è€ƒçš„æ ‘æ¨¡å‹é—®é¢˜"},{"content":"ç®€è¿°å†³ç­–æ ‘åŸç†ï¼Ÿ å†³ç­–æ ‘æ˜¯ä¸€ç§è‡ªä¸Šè€Œä¸‹ï¼Œå¯¹æ ·æœ¬æ•°æ®è¿›è¡Œæ ‘å½¢åˆ†ç±»çš„è¿‡ç¨‹ï¼Œç”±èŠ‚ç‚¹å’Œæœ‰å‘è¾¹ç»„æˆã€‚èŠ‚ç‚¹åˆ†ä¸ºå†…éƒ¨èŠ‚ç‚¹å’Œå¶èŠ‚ç‚¹ï¼Œå…¶ä¸­æ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªç‰¹å¾æˆ–å±æ€§ï¼Œå¶èŠ‚ç‚¹è¡¨ç¤ºç±»åˆ«ã€‚ä»é¡¶éƒ¨èŠ‚ç‚¹å¼€å§‹ï¼Œæ‰€æœ‰æ ·æœ¬èšåœ¨ä¸€èµ·ï¼Œç»è¿‡æ ¹èŠ‚ç‚¹çš„åˆ’åˆ†ï¼Œæ ·æœ¬è¢«åˆ†åˆ°ä¸åŒçš„å­èŠ‚ç‚¹ä¸­ï¼Œå†æ ¹æ®å­èŠ‚ç‚¹çš„ç‰¹å¾è¿›ä¸€æ­¥åˆ’åˆ†ï¼Œç›´è‡³æ‰€æœ‰æ ·æœ¬éƒ½è¢«å½’åˆ°æŸä¸ªç±»åˆ«ã€‚\nä¸ºä»€ä¹ˆè¦å¯¹å†³ç­–æ ‘è¿›è¡Œå‡æï¼Ÿå¦‚ä½•è¿›è¡Œå‡æï¼Ÿ å‰ªææ˜¯å†³ç­–æ ‘è§£å†³è¿‡æ‹Ÿåˆé—®é¢˜çš„æ–¹æ³•ã€‚åœ¨å†³ç­–æ ‘å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†å°½å¯èƒ½æ­£ç¡®åˆ†ç±»è®­ç»ƒæ ·æœ¬ï¼Œç»“ç‚¹åˆ’åˆ†è¿‡ç¨‹å°†ä¸æ–­é‡å¤ï¼Œæœ‰æ—¶ä¼šé€ æˆå†³ç­–æ ‘åˆ†æ”¯è¿‡å¤šï¼Œäºæ˜¯å¯èƒ½å°†è®­ç»ƒæ ·æœ¬å­¦å¾—å¤ªå¥½ï¼Œä»¥è‡³äºæŠŠè®­ç»ƒé›†è‡ªèº«çš„ä¸€äº›ç‰¹ç‚¹å½“ä½œæ‰€æœ‰æ•°æ®å…±æœ‰çš„ä¸€èˆ¬ç‰¹ç‚¹è€Œå¯¼è‡´æµ‹è¯•é›†é¢„æµ‹æ•ˆæœä¸å¥½ï¼Œå‡ºç°äº†è¿‡æ‹Ÿåˆç°è±¡ã€‚å› æ­¤ï¼Œå¯ä»¥é€šè¿‡å‰ªææ¥å»æ‰ä¸€äº›åˆ†æ”¯æ¥é™ä½è¿‡æ‹Ÿåˆçš„é£é™©ã€‚\nå†³ç­–æ ‘å‰ªæçš„åŸºæœ¬ç­–ç•¥æœ‰â€œé¢„å‰ªæâ€å’Œâ€œåå‰ªæâ€ã€‚é¢„å‰ªææ˜¯æŒ‡åœ¨å†³ç­–æ ‘ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œå¯¹æ¯ä¸ªç»“ç‚¹åœ¨åˆ’åˆ†å‰å…ˆè¿›è¡Œä¼°è®¡ï¼Œè‹¥å½“å‰ç»“ç‚¹çš„åˆ’åˆ†ä¸èƒ½å¸¦æ¥å†³ç­–æ ‘æ³›åŒ–æ€§èƒ½æå‡ï¼Œåˆ™åœæ­¢åˆ’åˆ†å¹¶å°†å½“å‰ç»“ç‚¹æ ‡è®°ä¸ºå¶ç»“ç‚¹ï¼›åå‰ªæåˆ™æ˜¯å…ˆä»è®­ç»ƒé›†ç”Ÿæˆä¸€æ£µå®Œæ•´çš„å†³ç­–æ ‘ï¼Œç„¶åè‡ªåº•å‘ä¸Šåœ°å¯¹éå¶ç»“ç‚¹è¿›è¡Œè€ƒå¯Ÿï¼Œè‹¥å°†è¯¥ç»“ç‚¹å¯¹åº”çš„å­æ ‘æ›¿æ¢ä¸ºå¶ç»“ç‚¹èƒ½å¸¦æ¥å†³ç­–æ ‘æ³›åŒ–æ€§èƒ½æå‡ï¼Œåˆ™å°†è¯¥å­æ ‘æ›¿æ¢ä¸ºå¶ç»“ç‚¹ã€‚\né¢„å‰ªæä½¿å¾—å†³ç­–æ ‘çš„å¾ˆå¤šåˆ†æ”¯éƒ½æ²¡æœ‰\u0026quot;å±•å¼€â€ï¼Œè¿™ä¸ä»…é™ä½äº†è¿‡æ‹Ÿåˆçš„é£é™©ï¼Œè¿˜æ˜¾è‘—å‡å°‘äº†å†³ç­–æ ‘çš„è®­ç»ƒæ—¶é—´å¼€é”€å’Œæµ‹è¯•æ—¶é—´å¼€é”€ã€‚ä½†å¦ä¸€æ–¹é¢ï¼Œæœ‰äº›åˆ†æ”¯çš„å½“å‰åˆ’åˆ†è™½ä¸èƒ½æå‡æ³›åŒ–æ€§èƒ½ã€ç”šè‡³å¯èƒ½å¯¼è‡´æ³›åŒ–æ€§èƒ½æš‚æ—¶ä¸‹é™?ä½†åœ¨å…¶åŸºç¡€ä¸Šè¿›è¡Œçš„åç»­åˆ’åˆ†å´æœ‰å¯èƒ½å¯¼è‡´æ€§èƒ½æ˜¾è‘—æé«˜ï¼›é¢„å‰ªæåŸºäº\u0026quot;è´ªå¿ƒ\u0026quot;æœ¬è´¨ç¦æ­¢è¿™äº›åˆ†æ”¯å±•å¼€ï¼Œç»™é¢„å‰ªæå†³ç­–æ ‘å¸¦æ¥äº†æ¬ æ‹Ÿå«çš„é£é™©ã€‚\nåå‰ªæå†³ç­–æ ‘é€šå¸¸æ¯”é¢„å‰ªæå†³ç­–æ ‘ä¿ç•™äº†æ›´å¤šçš„åˆ†æ”¯ï¼Œä¸€èˆ¬æƒ…å½¢ä¸‹åå‰ªæå†³ç­–æ ‘çš„æ¬ æ‹Ÿåˆé£é™©å¾ˆå°ï¼Œæ³›åŒ–æ€§èƒ½å¾€å¾€ä¼˜äºé¢„å‰ªæå†³ç­–æ ‘ ã€‚ä½†åå‰ªæè¿‡ç¨‹æ˜¯åœ¨ç”Ÿæˆå®Œå…¨å†³ç­–æ ‘ä¹‹åè¿›è¡Œçš„ å¹¶ä¸”è¦ç™½åº•å‘ä¸Šå¯¹æ ‘ä¸­çš„æ‰€æœ‰éå¶ç»“ç‚¹è¿›è¡Œé€ è€ƒå¯Ÿï¼Œå› æ­¤å…¶è®­ç»ƒæ—¶é—´å¼€é”€æ¯”æœªå‰ªæå†³ç­–æ ‘å’Œé¢„å‰ªæå†³ç­–æ ‘éƒ½è¦å¤§å¾—å¤šã€‚\nç®€è¿°å†³ç­–æ ‘çš„ç”Ÿæˆç­–ç•¥ï¼Ÿ å†³ç­–æ ‘ä¸»è¦æœ‰ID3ã€C4.5ã€CARTï¼Œç®—æ³•çš„é€‚ç”¨ç•¥æœ‰ä¸åŒï¼Œä½†å®ƒä»¬æœ‰ä¸ªæ€»åŸåˆ™ï¼Œå³åœ¨é€‰æ‹©ç‰¹å¾ã€å‘ä¸‹åˆ†è£‚ã€æ ‘ç”Ÿæˆä¸­ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸ºäº†è®©ä¿¡æ¯æ›´â€œçº¯â€ã€‚\nä¸¾ä¸€ä¸ªç®€å•ä¾‹å­ï¼Œé€šè¿‡ä¸‰ä¸ªç‰¹å¾ï¼šæ˜¯å¦æœ‰å–‰ç»“ã€èº«é«˜ã€ä½“é‡ï¼Œåˆ¤æ–­äººç¾¤ä¸­çš„ç”·å¥³ï¼Œæ˜¯å¦æœ‰å–‰ç»“æŠŠäººç¾¤åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€è¾¹å…¨æ˜¯ç”·æ€§ã€ä¸€è¾¹å…¨æ˜¯å¥³æ€§ï¼Œè¾¾åˆ°ç†æƒ³ç»“æœï¼Œçº¯åº¦æœ€é«˜ã€‚ é€šè¿‡èº«é«˜æˆ–ä½“é‡ï¼Œäººç¾¤ä¼šæœ‰ç”·æœ‰å¥³ã€‚ ä¸Šè¿°ä¸‰ç§ç®—æ³•ï¼Œä¿¡æ¯å¢ç›Šã€å¢ç›Šç‡ã€åŸºå°¼ç³»æ•°å¯¹â€œçº¯â€çš„ä¸åŒè§£è¯»ã€‚å¦‚ä¸‹è¯¦ç»†é˜è¿°ï¼š\nâ€‹ ç»¼ä¸Šï¼ŒID3é‡‡ç”¨ä¿¡æ¯å¢ç›Šä½œä¸ºåˆ’åˆ†ä¾æ®ï¼Œä¼šå€¾å‘äºå–å€¼è¾ƒå¤šçš„ç‰¹å¾ï¼Œå› ä¸ºä¿¡æ¯å¢ç›Šåæ˜ çš„æ˜¯ç»™å®šæ¡ä»¶ä»¥åä¸ç¡®å®šæ€§å‡å°‘çš„ç¨‹åº¦ï¼Œç‰¹å¾å–å€¼è¶Šå¤šå°±æ„å‘³ç€ä¸ç¡®å®šæ€§æ›´é«˜ã€‚C4.5å¯¹ID3è¿›è¡Œä¼˜åŒ–ï¼Œé€šè¿‡å¼•å…¥ä¿¡æ¯å¢ç›Šç‡ï¼Œå¯¹ç‰¹å¾å–å€¼è¾ƒå¤šçš„å±æ€§è¿›è¡Œæƒ©ç½šã€‚\néšæœºæ£®æ— Baggingï¼ˆå¥—è¢‹æ³•ï¼‰ baggingçš„ç®—æ³•è¿‡ç¨‹å¦‚ä¸‹ï¼š\nä»åŸå§‹æ ·æœ¬é›†ä¸­ä½¿ç”¨Bootstrapingæ–¹æ³•éšæœºæŠ½å–nä¸ªè®­ç»ƒæ ·æœ¬ï¼Œå…±è¿›è¡Œkè½®æŠ½å–ï¼Œå¾—åˆ°kä¸ªè®­ç»ƒé›†ã€‚ï¼ˆkä¸ªè®­ç»ƒé›†ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œå…ƒç´ å¯ä»¥æœ‰é‡å¤ï¼‰ å¯¹äºkä¸ªè®­ç»ƒé›†ï¼Œæˆ‘ä»¬è®­ç»ƒkä¸ªæ¨¡å‹ï¼ˆè¿™kä¸ªæ¨¡å‹å¯ä»¥æ ¹æ®å…·ä½“é—®é¢˜è€Œå®šï¼Œæ¯”å¦‚å†³ç­–æ ‘ï¼Œknnç­‰ï¼‰ å¯¹äºåˆ†ç±»é—®é¢˜ï¼šç”±æŠ•ç¥¨è¡¨å†³äº§ç”Ÿåˆ†ç±»ç»“æœï¼›å¯¹äºå›å½’é—®é¢˜ï¼šç”±kä¸ªæ¨¡å‹é¢„æµ‹ç»“æœçš„å‡å€¼ä½œä¸ºæœ€åé¢„æµ‹ç»“æœã€‚ï¼ˆæ‰€æœ‰æ¨¡å‹çš„é‡è¦æ€§ç›¸åŒï¼‰ Boostingï¼ˆæå‡æ³•ï¼‰ boostingçš„ç®—æ³•è¿‡ç¨‹å¦‚ä¸‹ï¼š\nå¯¹äºè®­ç»ƒé›†ä¸­çš„æ¯ä¸ªæ ·æœ¬å»ºç«‹æƒå€¼wiï¼Œè¡¨ç¤ºå¯¹æ¯ä¸ªæ ·æœ¬çš„å…³æ³¨åº¦ã€‚å½“æŸä¸ªæ ·æœ¬è¢«è¯¯åˆ†ç±»çš„æ¦‚ç‡å¾ˆé«˜æ—¶ï¼Œéœ€è¦åŠ å¤§å¯¹è¯¥æ ·æœ¬çš„æƒå€¼ã€‚ è¿›è¡Œè¿­ä»£çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€æ­¥è¿­ä»£éƒ½æ˜¯ä¸€ä¸ªå¼±åˆ†ç±»å™¨ã€‚æˆ‘ä»¬éœ€è¦ç”¨æŸç§ç­–ç•¥å°†å…¶ç»„åˆï¼Œä½œä¸ºæœ€ç»ˆæ¨¡å‹ã€‚ï¼ˆä¾‹å¦‚AdaBoostç»™æ¯ä¸ªå¼±åˆ†ç±»å™¨ä¸€ä¸ªæƒå€¼ï¼Œå°†å…¶çº¿æ€§ç»„åˆæœ€ä¸ºæœ€ç»ˆåˆ†ç±»å™¨ã€‚è¯¯å·®è¶Šå°çš„å¼±åˆ†ç±»å™¨ï¼Œæƒå€¼è¶Šå¤§ï¼‰ æå‡å°±æ˜¯æŒ‡æ¯ä¸€æ­¥æˆ‘éƒ½äº§ç”Ÿä¸€ä¸ªå¼±é¢„æµ‹æ¨¡å‹ï¼Œç„¶ååŠ æƒç´¯åŠ åˆ°æ€»æ¨¡å‹ä¸­ï¼Œç„¶åæ¯ä¸€æ­¥å¼±é¢„æµ‹æ¨¡å‹ç”Ÿæˆçš„çš„ä¾æ®éƒ½æ˜¯æŸå¤±å‡½æ•°çš„è´Ÿæ¢¯åº¦æ–¹å‘ï¼Œè¿™æ ·è‹¥å¹²æ­¥ä»¥åå°±å¯ä»¥è¾¾åˆ°é€¼è¿‘æŸå¤±å‡½æ•°å±€éƒ¨æœ€å°å€¼çš„ç›®æ ‡ã€‚ Baggingï¼ŒBoostingçš„ä¸»è¦åŒºåˆ« æ ·æœ¬é€‰æ‹©ä¸Šï¼šBaggingé‡‡ç”¨çš„æ˜¯Bootstrapéšæœºæœ‰æ”¾å›æŠ½æ ·ï¼›è€ŒBoostingæ¯ä¸€è½®çš„è®­ç»ƒé›†æ˜¯ä¸å˜çš„ï¼Œæ”¹å˜çš„åªæ˜¯æ¯ä¸€ä¸ªæ ·æœ¬çš„æƒé‡ã€‚\næ¯è½®è®­ç»ƒè¿‡åå¦‚ä½•è°ƒæ•´æ ·æœ¬æƒé‡ ï¼Ÿ\nå¦‚ä½•ç¡®å®šæœ€åå„å­¦ä¹ å™¨çš„æƒé‡ è¿™ä¸¤ä¸ªé—®é¢˜å¯ç”±åŠ æ³•æ¨¡å‹å’ŒæŒ‡æ•°æŸå¤±å‡½æ•°æ¨å¯¼å‡ºæ¥ã€‚\næ ·æœ¬æƒé‡ï¼šBaggingä½¿ç”¨çš„æ˜¯å‡åŒ€å–æ ·ï¼Œæ¯ä¸ªæ ·æœ¬æƒé‡ç›¸ç­‰ï¼›Boostingæ ¹æ®é”™è¯¯ç‡è°ƒæ•´æ ·æœ¬æƒé‡ï¼Œé”™è¯¯ç‡è¶Šå¤§çš„æ ·æœ¬æƒé‡è¶Šå¤§ã€‚\né¢„æµ‹å‡½æ•°ï¼šBaggingæ‰€æœ‰çš„é¢„æµ‹å‡½æ•°çš„æƒé‡ç›¸ç­‰ï¼›Boostingä¸­è¯¯å·®è¶Šå°çš„é¢„æµ‹å‡½æ•°å…¶æƒé‡è¶Šå¤§ã€‚\nå¹¶è¡Œè®¡ç®—ï¼šBaggingå„ä¸ªé¢„æµ‹å‡½æ•°å¯ä»¥å¹¶è¡Œç”Ÿæˆï¼›Boostingå„ä¸ªé¢„æµ‹å‡½æ•°å¿…é¡»æŒ‰é¡ºåºè¿­ä»£ç”Ÿæˆã€‚\nä¸‹é¢æ˜¯å°†å†³ç­–æ ‘ä¸è¿™äº›ç®—æ³•æ¡†æ¶è¿›è¡Œç»“åˆæ‰€å¾—åˆ°çš„æ–°çš„ç®—æ³•ï¼š 1ï¼‰Bagging + å†³ç­–æ ‘ = éšæœºæ£®æ— 2ï¼‰AdaBoost + å†³ç­–æ ‘ = æå‡æ ‘ ï¼ˆè‡ªé€‚åº”æå‡ï¼ˆAdaBoostï¼‰ï¼‰ 3ï¼‰Gradient Boosting + å†³ç­–æ ‘ = GBDT æ¢¯åº¦ä¸‹é™æå‡æ ‘ï¼ˆGDBTï¼‰\né¦–å…ˆæ—¢ç„¶æ˜¯æ ‘ï¼Œé‚£ä¹ˆå®ƒçš„åŸºå‡½æ•°è‚¯å®šå°±æ˜¯å†³ç­–æ ‘å•¦ï¼Œè€ŒæŸå¤±å‡½æ•°åˆ™æ˜¯æ ¹æ®æˆ‘ä»¬å…·ä½“çš„é—®é¢˜å»åˆ†æï¼Œä½†æ–¹æ³•éƒ½ä¸€æ ·ï¼Œæœ€ç»ˆéƒ½èµ°ä¸Šäº†æ¢¯åº¦ä¸‹é™çš„è€è·¯ï¼Œæ¯”å¦‚è¯´è¿›è¡Œåˆ°ç¬¬mæ­¥çš„æ—¶å€™ï¼Œé¦–å…ˆè®¡ç®—æ®‹å·®\næœ‰äº†æ®‹å·®ä¹‹åï¼Œæˆ‘ä»¬å†ç”¨ï¼ˆxi,rimï¼‰å»æ‹Ÿåˆç¬¬mä¸ªåŸºå‡½æ•°ï¼Œå‡è®¾è¿™æ£µæ ‘æŠŠè¾“å…¥ç©ºé—´åˆ’åˆ†æˆjä¸ªç©ºé—´R1mï¼ŒR2mâ€¦â€¦ï¼ŒRjmï¼Œå‡è®¾å®ƒåœ¨æ¯ä¸ªç©ºé—´ä¸Šçš„è¾“å‡ºä¸ºbjmï¼Œè¿™æ ·çš„è¯ï¼Œç¬¬mæ£µæ ‘å¯ä»¥è¡¨ç¤ºå¦‚ä¸‹ï¼š\nä¸‹ä¸€æ­¥ï¼Œå¯¹æ ‘çš„æ¯ä¸ªåŒºåŸŸåˆ†åˆ«ç”¨çº¿æ€§æœç´¢çš„æ–¹å¼å¯»æ‰¾æœ€ä½³æ­¥é•¿ï¼Œè¿™ä¸ªæ­¥é•¿å¯ä»¥å’Œä¸Šé¢çš„åŒºåŸŸé¢„æµ‹å€¼bjmè¿›è¡Œåˆå¹¶ï¼Œæœ€åå°±å¾—åˆ°äº†ç¬¬mæ­¥çš„ç›®æ ‡å‡½æ•°\nå½“ç„¶äº†ï¼Œå¯¹äºGDBTæ¯”è¾ƒå®¹æ˜“å‡ºç°è¿‡æ‹Ÿåˆçš„æƒ…å†µï¼Œæ‰€ä»¥æœ‰å¿…è¦å¢åŠ ä¸€ç‚¹æ­£åˆ™é¡¹ï¼Œæ¯”å¦‚å¶èŠ‚ç‚¹çš„æ•°ç›®æˆ–å¶èŠ‚ç‚¹é¢„æµ‹å€¼çš„å¹³æ–¹å’Œï¼Œè¿›è€Œé™åˆ¶æ¨¡å‹å¤æ‚åº¦çš„è¿‡åº¦æå‡ï¼Œè¿™é‡Œåœ¨ä¸‹é¢çš„å®è·µä¸­çš„å‚æ•°è®¾ç½®æˆ‘ä»¬å¯ä»¥ç»§ç»­è®¨è®ºã€‚\næ„é€ éšæœºæ£®æ—çš„ 4 ä¸ªæ­¥éª¤ï¼š å‡å¦‚æœ‰Nä¸ªæ ·æœ¬ï¼Œåˆ™æœ‰æ”¾å›çš„éšæœºé€‰æ‹©Nä¸ªæ ·æœ¬(æ¯æ¬¡éšæœºé€‰æ‹©ä¸€ä¸ªæ ·æœ¬ï¼Œç„¶åè¿”å›ç»§ç»­é€‰æ‹©)ã€‚è¿™é€‰æ‹©å¥½äº†çš„Nä¸ªæ ·æœ¬ç”¨æ¥è®­ç»ƒä¸€ä¸ªå†³ç­–æ ‘ï¼Œä½œä¸ºå†³ç­–æ ‘æ ¹èŠ‚ç‚¹å¤„çš„æ ·æœ¬ã€‚\nå½“æ¯ä¸ªæ ·æœ¬æœ‰Mä¸ªå±æ€§æ—¶ï¼Œåœ¨å†³ç­–æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹éœ€è¦åˆ†è£‚æ—¶ï¼Œéšæœºä»è¿™Mä¸ªå±æ€§ä¸­é€‰å–å‡ºmä¸ªå±æ€§ï¼Œæ»¡è¶³æ¡ä»¶m \u0026laquo; Mã€‚ç„¶åä»è¿™mä¸ªå±æ€§ä¸­é‡‡ç”¨æŸç§ç­–ç•¥ï¼ˆæ¯”å¦‚è¯´ä¿¡æ¯å¢ç›Šï¼‰æ¥é€‰æ‹©1ä¸ªå±æ€§ä½œä¸ºè¯¥èŠ‚ç‚¹çš„åˆ†è£‚å±æ€§ã€‚\nç­–æ ‘å½¢æˆè¿‡ç¨‹ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦æŒ‰ç…§æ­¥éª¤2æ¥åˆ†è£‚ï¼ˆå¾ˆå®¹æ˜“ç†è§£ï¼Œå¦‚æœä¸‹ä¸€æ¬¡è¯¥èŠ‚ç‚¹é€‰å‡ºæ¥çš„é‚£ä¸€ä¸ªå±æ€§æ˜¯åˆšåˆšå…¶çˆ¶èŠ‚ç‚¹åˆ†è£‚æ—¶ç”¨è¿‡çš„å±æ€§ï¼Œåˆ™è¯¥èŠ‚ç‚¹å·²ç»è¾¾åˆ°äº†å¶å­èŠ‚ç‚¹ï¼Œæ— é¡»ç»§ç»­åˆ†è£‚äº†ï¼‰ã€‚ä¸€ç›´åˆ°ä¸èƒ½å¤Ÿå†åˆ†è£‚ä¸ºæ­¢ã€‚æ³¨æ„æ•´ä¸ªå†³ç­–æ ‘å½¢æˆè¿‡ç¨‹ä¸­æ²¡æœ‰è¿›è¡Œå‰ªæã€‚\næŒ‰ç…§æ­¥éª¤1~3å»ºç«‹å¤§é‡çš„å†³ç­–æ ‘ï¼Œè¿™æ ·å°±æ„æˆäº†éšæœºæ£®æ—äº†ã€‚\néšæœºæ£®æ—çš„ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ å®ƒå¯ä»¥å‡ºæ¥å¾ˆé«˜ç»´åº¦ï¼ˆç‰¹å¾å¾ˆå¤šï¼‰çš„æ•°æ®ï¼Œå¹¶ä¸”ä¸ç”¨é™ç»´ï¼Œæ— éœ€åšç‰¹å¾é€‰æ‹© å®ƒå¯ä»¥åˆ¤æ–­ç‰¹å¾çš„é‡è¦ç¨‹åº¦ å¯ä»¥åˆ¤æ–­å‡ºä¸åŒç‰¹å¾ä¹‹é—´çš„ç›¸äº’å½±å“ ä¸å®¹æ˜“è¿‡æ‹Ÿåˆ è®­ç»ƒé€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œå®¹æ˜“åšæˆå¹¶è¡Œæ–¹æ³• å®ç°èµ·æ¥æ¯”è¾ƒç®€å• å¯¹äºä¸å¹³è¡¡çš„æ•°æ®é›†æ¥è¯´ï¼Œå®ƒå¯ä»¥å¹³è¡¡è¯¯å·®ã€‚ å¦‚æœæœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†çš„ç‰¹å¾é—å¤±ï¼Œä»å¯ä»¥ç»´æŒå‡†ç¡®åº¦ã€‚ ç¼ºç‚¹ éšæœºæ£®æ—å·²ç»è¢«è¯æ˜åœ¨æŸäº›å™ªéŸ³è¾ƒå¤§çš„åˆ†ç±»æˆ–å›å½’é—®é¢˜ä¸Šä¼šè¿‡æ‹Ÿåˆã€‚ å¯¹äºæœ‰ä¸åŒå–å€¼çš„å±æ€§çš„æ•°æ®ï¼Œå–å€¼åˆ’åˆ†è¾ƒå¤šçš„å±æ€§ä¼šå¯¹éšæœºæ£®æ—äº§ç”Ÿæ›´å¤§çš„å½±å“ï¼Œæ‰€ä»¥éšæœºæ£®æ—åœ¨è¿™ç§æ•°æ®ä¸Šäº§å‡ºçš„å±æ€§æƒå€¼æ˜¯ä¸å¯ä¿¡çš„ ","permalink":"https://reid00.github.io/en/posts/ml/%E5%86%B3%E7%AD%96%E6%A0%91%E5%88%B0%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97/","summary":"ç®€è¿°å†³ç­–æ ‘åŸç†ï¼Ÿ å†³ç­–æ ‘æ˜¯ä¸€ç§è‡ªä¸Šè€Œä¸‹ï¼Œå¯¹æ ·æœ¬æ•°æ®è¿›è¡Œæ ‘å½¢åˆ†ç±»çš„è¿‡ç¨‹ï¼Œç”±èŠ‚ç‚¹å’Œæœ‰å‘è¾¹ç»„æˆã€‚èŠ‚ç‚¹åˆ†ä¸ºå†…éƒ¨èŠ‚ç‚¹å’Œå¶èŠ‚ç‚¹ï¼Œå…¶ä¸­æ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªç‰¹å¾æˆ–å±æ€§ï¼Œå¶èŠ‚ç‚¹è¡¨ç¤ºç±»åˆ«ã€‚ä»é¡¶éƒ¨èŠ‚ç‚¹å¼€å§‹ï¼Œæ‰€æœ‰æ ·æœ¬èšåœ¨ä¸€èµ·ï¼Œç»è¿‡æ ¹èŠ‚ç‚¹çš„åˆ’åˆ†ï¼Œæ ·æœ¬è¢«åˆ†åˆ°ä¸åŒçš„å­èŠ‚ç‚¹ä¸­ï¼Œå†æ ¹æ®å­èŠ‚ç‚¹çš„ç‰¹å¾è¿›ä¸€æ­¥åˆ’åˆ†ï¼Œç›´è‡³æ‰€æœ‰æ ·æœ¬éƒ½è¢«å½’åˆ°æŸä¸ªç±»åˆ«ã€‚\nä¸ºä»€ä¹ˆè¦å¯¹å†³ç­–æ ‘è¿›è¡Œå‡æï¼Ÿå¦‚ä½•è¿›è¡Œå‡æï¼Ÿ å‰ªææ˜¯å†³ç­–æ ‘è§£å†³è¿‡æ‹Ÿåˆé—®é¢˜çš„æ–¹æ³•ã€‚åœ¨å†³ç­–æ ‘å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†å°½å¯èƒ½æ­£ç¡®åˆ†ç±»è®­ç»ƒæ ·æœ¬ï¼Œç»“ç‚¹åˆ’åˆ†è¿‡ç¨‹å°†ä¸æ–­é‡å¤ï¼Œæœ‰æ—¶ä¼šé€ æˆå†³ç­–æ ‘åˆ†æ”¯è¿‡å¤šï¼Œäºæ˜¯å¯èƒ½å°†è®­ç»ƒæ ·æœ¬å­¦å¾—å¤ªå¥½ï¼Œä»¥è‡³äºæŠŠè®­ç»ƒé›†è‡ªèº«çš„ä¸€äº›ç‰¹ç‚¹å½“ä½œæ‰€æœ‰æ•°æ®å…±æœ‰çš„ä¸€èˆ¬ç‰¹ç‚¹è€Œå¯¼è‡´æµ‹è¯•é›†é¢„æµ‹æ•ˆæœä¸å¥½ï¼Œå‡ºç°äº†è¿‡æ‹Ÿåˆç°è±¡ã€‚å› æ­¤ï¼Œå¯ä»¥é€šè¿‡å‰ªææ¥å»æ‰ä¸€äº›åˆ†æ”¯æ¥é™ä½è¿‡æ‹Ÿåˆçš„é£é™©ã€‚\nå†³ç­–æ ‘å‰ªæçš„åŸºæœ¬ç­–ç•¥æœ‰â€œé¢„å‰ªæâ€å’Œâ€œåå‰ªæâ€ã€‚é¢„å‰ªææ˜¯æŒ‡åœ¨å†³ç­–æ ‘ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œå¯¹æ¯ä¸ªç»“ç‚¹åœ¨åˆ’åˆ†å‰å…ˆè¿›è¡Œä¼°è®¡ï¼Œè‹¥å½“å‰ç»“ç‚¹çš„åˆ’åˆ†ä¸èƒ½å¸¦æ¥å†³ç­–æ ‘æ³›åŒ–æ€§èƒ½æå‡ï¼Œåˆ™åœæ­¢åˆ’åˆ†å¹¶å°†å½“å‰ç»“ç‚¹æ ‡è®°ä¸ºå¶ç»“ç‚¹ï¼›åå‰ªæåˆ™æ˜¯å…ˆä»è®­ç»ƒé›†ç”Ÿæˆä¸€æ£µå®Œæ•´çš„å†³ç­–æ ‘ï¼Œç„¶åè‡ªåº•å‘ä¸Šåœ°å¯¹éå¶ç»“ç‚¹è¿›è¡Œè€ƒå¯Ÿï¼Œè‹¥å°†è¯¥ç»“ç‚¹å¯¹åº”çš„å­æ ‘æ›¿æ¢ä¸ºå¶ç»“ç‚¹èƒ½å¸¦æ¥å†³ç­–æ ‘æ³›åŒ–æ€§èƒ½æå‡ï¼Œåˆ™å°†è¯¥å­æ ‘æ›¿æ¢ä¸ºå¶ç»“ç‚¹ã€‚\né¢„å‰ªæä½¿å¾—å†³ç­–æ ‘çš„å¾ˆå¤šåˆ†æ”¯éƒ½æ²¡æœ‰\u0026quot;å±•å¼€â€ï¼Œè¿™ä¸ä»…é™ä½äº†è¿‡æ‹Ÿåˆçš„é£é™©ï¼Œè¿˜æ˜¾è‘—å‡å°‘äº†å†³ç­–æ ‘çš„è®­ç»ƒæ—¶é—´å¼€é”€å’Œæµ‹è¯•æ—¶é—´å¼€é”€ã€‚ä½†å¦ä¸€æ–¹é¢ï¼Œæœ‰äº›åˆ†æ”¯çš„å½“å‰åˆ’åˆ†è™½ä¸èƒ½æå‡æ³›åŒ–æ€§èƒ½ã€ç”šè‡³å¯èƒ½å¯¼è‡´æ³›åŒ–æ€§èƒ½æš‚æ—¶ä¸‹é™?ä½†åœ¨å…¶åŸºç¡€ä¸Šè¿›è¡Œçš„åç»­åˆ’åˆ†å´æœ‰å¯èƒ½å¯¼è‡´æ€§èƒ½æ˜¾è‘—æé«˜ï¼›é¢„å‰ªæåŸºäº\u0026quot;è´ªå¿ƒ\u0026quot;æœ¬è´¨ç¦æ­¢è¿™äº›åˆ†æ”¯å±•å¼€ï¼Œç»™é¢„å‰ªæå†³ç­–æ ‘å¸¦æ¥äº†æ¬ æ‹Ÿå«çš„é£é™©ã€‚\nåå‰ªæå†³ç­–æ ‘é€šå¸¸æ¯”é¢„å‰ªæå†³ç­–æ ‘ä¿ç•™äº†æ›´å¤šçš„åˆ†æ”¯ï¼Œä¸€èˆ¬æƒ…å½¢ä¸‹åå‰ªæå†³ç­–æ ‘çš„æ¬ æ‹Ÿåˆé£é™©å¾ˆå°ï¼Œæ³›åŒ–æ€§èƒ½å¾€å¾€ä¼˜äºé¢„å‰ªæå†³ç­–æ ‘ ã€‚ä½†åå‰ªæè¿‡ç¨‹æ˜¯åœ¨ç”Ÿæˆå®Œå…¨å†³ç­–æ ‘ä¹‹åè¿›è¡Œçš„ å¹¶ä¸”è¦ç™½åº•å‘ä¸Šå¯¹æ ‘ä¸­çš„æ‰€æœ‰éå¶ç»“ç‚¹è¿›è¡Œé€ è€ƒå¯Ÿï¼Œå› æ­¤å…¶è®­ç»ƒæ—¶é—´å¼€é”€æ¯”æœªå‰ªæå†³ç­–æ ‘å’Œé¢„å‰ªæå†³ç­–æ ‘éƒ½è¦å¤§å¾—å¤šã€‚\nç®€è¿°å†³ç­–æ ‘çš„ç”Ÿæˆç­–ç•¥ï¼Ÿ å†³ç­–æ ‘ä¸»è¦æœ‰ID3ã€C4.5ã€CARTï¼Œç®—æ³•çš„é€‚ç”¨ç•¥æœ‰ä¸åŒï¼Œä½†å®ƒä»¬æœ‰ä¸ªæ€»åŸåˆ™ï¼Œå³åœ¨é€‰æ‹©ç‰¹å¾ã€å‘ä¸‹åˆ†è£‚ã€æ ‘ç”Ÿæˆä¸­ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸ºäº†è®©ä¿¡æ¯æ›´â€œçº¯â€ã€‚\nä¸¾ä¸€ä¸ªç®€å•ä¾‹å­ï¼Œé€šè¿‡ä¸‰ä¸ªç‰¹å¾ï¼šæ˜¯å¦æœ‰å–‰ç»“ã€èº«é«˜ã€ä½“é‡ï¼Œåˆ¤æ–­äººç¾¤ä¸­çš„ç”·å¥³ï¼Œæ˜¯å¦æœ‰å–‰ç»“æŠŠäººç¾¤åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€è¾¹å…¨æ˜¯ç”·æ€§ã€ä¸€è¾¹å…¨æ˜¯å¥³æ€§ï¼Œè¾¾åˆ°ç†æƒ³ç»“æœï¼Œçº¯åº¦æœ€é«˜ã€‚ é€šè¿‡èº«é«˜æˆ–ä½“é‡ï¼Œäººç¾¤ä¼šæœ‰ç”·æœ‰å¥³ã€‚ ä¸Šè¿°ä¸‰ç§ç®—æ³•ï¼Œä¿¡æ¯å¢ç›Šã€å¢ç›Šç‡ã€åŸºå°¼ç³»æ•°å¯¹â€œçº¯â€çš„ä¸åŒè§£è¯»ã€‚å¦‚ä¸‹è¯¦ç»†é˜è¿°ï¼š\nâ€‹ ç»¼ä¸Šï¼ŒID3é‡‡ç”¨ä¿¡æ¯å¢ç›Šä½œä¸ºåˆ’åˆ†ä¾æ®ï¼Œä¼šå€¾å‘äºå–å€¼è¾ƒå¤šçš„ç‰¹å¾ï¼Œå› ä¸ºä¿¡æ¯å¢ç›Šåæ˜ çš„æ˜¯ç»™å®šæ¡ä»¶ä»¥åä¸ç¡®å®šæ€§å‡å°‘çš„ç¨‹åº¦ï¼Œç‰¹å¾å–å€¼è¶Šå¤šå°±æ„å‘³ç€ä¸ç¡®å®šæ€§æ›´é«˜ã€‚C4.5å¯¹ID3è¿›è¡Œä¼˜åŒ–ï¼Œé€šè¿‡å¼•å…¥ä¿¡æ¯å¢ç›Šç‡ï¼Œå¯¹ç‰¹å¾å–å€¼è¾ƒå¤šçš„å±æ€§è¿›è¡Œæƒ©ç½šã€‚\néšæœºæ£®æ— Baggingï¼ˆå¥—è¢‹æ³•ï¼‰ baggingçš„ç®—æ³•è¿‡ç¨‹å¦‚ä¸‹ï¼š\nä»åŸå§‹æ ·æœ¬é›†ä¸­ä½¿ç”¨Bootstrapingæ–¹æ³•éšæœºæŠ½å–nä¸ªè®­ç»ƒæ ·æœ¬ï¼Œå…±è¿›è¡Œkè½®æŠ½å–ï¼Œå¾—åˆ°kä¸ªè®­ç»ƒé›†ã€‚ï¼ˆkä¸ªè®­ç»ƒé›†ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œå…ƒç´ å¯ä»¥æœ‰é‡å¤ï¼‰ å¯¹äºkä¸ªè®­ç»ƒé›†ï¼Œæˆ‘ä»¬è®­ç»ƒkä¸ªæ¨¡å‹ï¼ˆè¿™kä¸ªæ¨¡å‹å¯ä»¥æ ¹æ®å…·ä½“é—®é¢˜è€Œå®šï¼Œæ¯”å¦‚å†³ç­–æ ‘ï¼Œknnç­‰ï¼‰ å¯¹äºåˆ†ç±»é—®é¢˜ï¼šç”±æŠ•ç¥¨è¡¨å†³äº§ç”Ÿåˆ†ç±»ç»“æœï¼›å¯¹äºå›å½’é—®é¢˜ï¼šç”±kä¸ªæ¨¡å‹é¢„æµ‹ç»“æœçš„å‡å€¼ä½œä¸ºæœ€åé¢„æµ‹ç»“æœã€‚ï¼ˆæ‰€æœ‰æ¨¡å‹çš„é‡è¦æ€§ç›¸åŒï¼‰ Boostingï¼ˆæå‡æ³•ï¼‰ boostingçš„ç®—æ³•è¿‡ç¨‹å¦‚ä¸‹ï¼š\nå¯¹äºè®­ç»ƒé›†ä¸­çš„æ¯ä¸ªæ ·æœ¬å»ºç«‹æƒå€¼wiï¼Œè¡¨ç¤ºå¯¹æ¯ä¸ªæ ·æœ¬çš„å…³æ³¨åº¦ã€‚å½“æŸä¸ªæ ·æœ¬è¢«è¯¯åˆ†ç±»çš„æ¦‚ç‡å¾ˆé«˜æ—¶ï¼Œéœ€è¦åŠ å¤§å¯¹è¯¥æ ·æœ¬çš„æƒå€¼ã€‚ è¿›è¡Œè¿­ä»£çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€æ­¥è¿­ä»£éƒ½æ˜¯ä¸€ä¸ªå¼±åˆ†ç±»å™¨ã€‚æˆ‘ä»¬éœ€è¦ç”¨æŸç§ç­–ç•¥å°†å…¶ç»„åˆï¼Œä½œä¸ºæœ€ç»ˆæ¨¡å‹ã€‚ï¼ˆä¾‹å¦‚AdaBoostç»™æ¯ä¸ªå¼±åˆ†ç±»å™¨ä¸€ä¸ªæƒå€¼ï¼Œå°†å…¶çº¿æ€§ç»„åˆæœ€ä¸ºæœ€ç»ˆåˆ†ç±»å™¨ã€‚è¯¯å·®è¶Šå°çš„å¼±åˆ†ç±»å™¨ï¼Œæƒå€¼è¶Šå¤§ï¼‰ æå‡å°±æ˜¯æŒ‡æ¯ä¸€æ­¥æˆ‘éƒ½äº§ç”Ÿä¸€ä¸ªå¼±é¢„æµ‹æ¨¡å‹ï¼Œç„¶ååŠ æƒç´¯åŠ åˆ°æ€»æ¨¡å‹ä¸­ï¼Œç„¶åæ¯ä¸€æ­¥å¼±é¢„æµ‹æ¨¡å‹ç”Ÿæˆçš„çš„ä¾æ®éƒ½æ˜¯æŸå¤±å‡½æ•°çš„è´Ÿæ¢¯åº¦æ–¹å‘ï¼Œè¿™æ ·è‹¥å¹²æ­¥ä»¥åå°±å¯ä»¥è¾¾åˆ°é€¼è¿‘æŸå¤±å‡½æ•°å±€éƒ¨æœ€å°å€¼çš„ç›®æ ‡ã€‚ Baggingï¼ŒBoostingçš„ä¸»è¦åŒºåˆ« æ ·æœ¬é€‰æ‹©ä¸Šï¼šBaggingé‡‡ç”¨çš„æ˜¯Bootstrapéšæœºæœ‰æ”¾å›æŠ½æ ·ï¼›è€ŒBoostingæ¯ä¸€è½®çš„è®­ç»ƒé›†æ˜¯ä¸å˜çš„ï¼Œæ”¹å˜çš„åªæ˜¯æ¯ä¸€ä¸ªæ ·æœ¬çš„æƒé‡ã€‚\næ¯è½®è®­ç»ƒè¿‡åå¦‚ä½•è°ƒæ•´æ ·æœ¬æƒé‡ ï¼Ÿ\nå¦‚ä½•ç¡®å®šæœ€åå„å­¦ä¹ å™¨çš„æƒé‡ è¿™ä¸¤ä¸ªé—®é¢˜å¯ç”±åŠ æ³•æ¨¡å‹å’ŒæŒ‡æ•°æŸå¤±å‡½æ•°æ¨å¯¼å‡ºæ¥ã€‚\næ ·æœ¬æƒé‡ï¼šBaggingä½¿ç”¨çš„æ˜¯å‡åŒ€å–æ ·ï¼Œæ¯ä¸ªæ ·æœ¬æƒé‡ç›¸ç­‰ï¼›Boostingæ ¹æ®é”™è¯¯ç‡è°ƒæ•´æ ·æœ¬æƒé‡ï¼Œé”™è¯¯ç‡è¶Šå¤§çš„æ ·æœ¬æƒé‡è¶Šå¤§ã€‚\né¢„æµ‹å‡½æ•°ï¼šBaggingæ‰€æœ‰çš„é¢„æµ‹å‡½æ•°çš„æƒé‡ç›¸ç­‰ï¼›Boostingä¸­è¯¯å·®è¶Šå°çš„é¢„æµ‹å‡½æ•°å…¶æƒé‡è¶Šå¤§ã€‚\nå¹¶è¡Œè®¡ç®—ï¼šBaggingå„ä¸ªé¢„æµ‹å‡½æ•°å¯ä»¥å¹¶è¡Œç”Ÿæˆï¼›Boostingå„ä¸ªé¢„æµ‹å‡½æ•°å¿…é¡»æŒ‰é¡ºåºè¿­ä»£ç”Ÿæˆã€‚\nä¸‹é¢æ˜¯å°†å†³ç­–æ ‘ä¸è¿™äº›ç®—æ³•æ¡†æ¶è¿›è¡Œç»“åˆæ‰€å¾—åˆ°çš„æ–°çš„ç®—æ³•ï¼š 1ï¼‰Bagging + å†³ç­–æ ‘ = éšæœºæ£®æ— 2ï¼‰AdaBoost + å†³ç­–æ ‘ = æå‡æ ‘ ï¼ˆè‡ªé€‚åº”æå‡ï¼ˆAdaBoostï¼‰ï¼‰ 3ï¼‰Gradient Boosting + å†³ç­–æ ‘ = GBDT æ¢¯åº¦ä¸‹é™æå‡æ ‘ï¼ˆGDBTï¼‰\né¦–å…ˆæ—¢ç„¶æ˜¯æ ‘ï¼Œé‚£ä¹ˆå®ƒçš„åŸºå‡½æ•°è‚¯å®šå°±æ˜¯å†³ç­–æ ‘å•¦ï¼Œè€ŒæŸå¤±å‡½æ•°åˆ™æ˜¯æ ¹æ®æˆ‘ä»¬å…·ä½“çš„é—®é¢˜å»åˆ†æï¼Œä½†æ–¹æ³•éƒ½ä¸€æ ·ï¼Œæœ€ç»ˆéƒ½èµ°ä¸Šäº†æ¢¯åº¦ä¸‹é™çš„è€è·¯ï¼Œæ¯”å¦‚è¯´è¿›è¡Œåˆ°ç¬¬mæ­¥çš„æ—¶å€™ï¼Œé¦–å…ˆè®¡ç®—æ®‹å·®\næœ‰äº†æ®‹å·®ä¹‹åï¼Œæˆ‘ä»¬å†ç”¨ï¼ˆxi,rimï¼‰å»æ‹Ÿåˆç¬¬mä¸ªåŸºå‡½æ•°ï¼Œå‡è®¾è¿™æ£µæ ‘æŠŠè¾“å…¥ç©ºé—´åˆ’åˆ†æˆjä¸ªç©ºé—´R1mï¼ŒR2mâ€¦â€¦ï¼ŒRjmï¼Œå‡è®¾å®ƒåœ¨æ¯ä¸ªç©ºé—´ä¸Šçš„è¾“å‡ºä¸ºbjmï¼Œè¿™æ ·çš„è¯ï¼Œç¬¬mæ£µæ ‘å¯ä»¥è¡¨ç¤ºå¦‚ä¸‹ï¼š\nä¸‹ä¸€æ­¥ï¼Œå¯¹æ ‘çš„æ¯ä¸ªåŒºåŸŸåˆ†åˆ«ç”¨çº¿æ€§æœç´¢çš„æ–¹å¼å¯»æ‰¾æœ€ä½³æ­¥é•¿ï¼Œè¿™ä¸ªæ­¥é•¿å¯ä»¥å’Œä¸Šé¢çš„åŒºåŸŸé¢„æµ‹å€¼bjmè¿›è¡Œåˆå¹¶ï¼Œæœ€åå°±å¾—åˆ°äº†ç¬¬mæ­¥çš„ç›®æ ‡å‡½æ•°\nå½“ç„¶äº†ï¼Œå¯¹äºGDBTæ¯”è¾ƒå®¹æ˜“å‡ºç°è¿‡æ‹Ÿåˆçš„æƒ…å†µï¼Œæ‰€ä»¥æœ‰å¿…è¦å¢åŠ ä¸€ç‚¹æ­£åˆ™é¡¹ï¼Œæ¯”å¦‚å¶èŠ‚ç‚¹çš„æ•°ç›®æˆ–å¶èŠ‚ç‚¹é¢„æµ‹å€¼çš„å¹³æ–¹å’Œï¼Œè¿›è€Œé™åˆ¶æ¨¡å‹å¤æ‚åº¦çš„è¿‡åº¦æå‡ï¼Œè¿™é‡Œåœ¨ä¸‹é¢çš„å®è·µä¸­çš„å‚æ•°è®¾ç½®æˆ‘ä»¬å¯ä»¥ç»§ç»­è®¨è®ºã€‚\næ„é€ éšæœºæ£®æ—çš„ 4 ä¸ªæ­¥éª¤ï¼š å‡å¦‚æœ‰Nä¸ªæ ·æœ¬ï¼Œåˆ™æœ‰æ”¾å›çš„éšæœºé€‰æ‹©Nä¸ªæ ·æœ¬(æ¯æ¬¡éšæœºé€‰æ‹©ä¸€ä¸ªæ ·æœ¬ï¼Œç„¶åè¿”å›ç»§ç»­é€‰æ‹©)ã€‚è¿™é€‰æ‹©å¥½äº†çš„Nä¸ªæ ·æœ¬ç”¨æ¥è®­ç»ƒä¸€ä¸ªå†³ç­–æ ‘ï¼Œä½œä¸ºå†³ç­–æ ‘æ ¹èŠ‚ç‚¹å¤„çš„æ ·æœ¬ã€‚\nå½“æ¯ä¸ªæ ·æœ¬æœ‰Mä¸ªå±æ€§æ—¶ï¼Œåœ¨å†³ç­–æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹éœ€è¦åˆ†è£‚æ—¶ï¼Œéšæœºä»è¿™Mä¸ªå±æ€§ä¸­é€‰å–å‡ºmä¸ªå±æ€§ï¼Œæ»¡è¶³æ¡ä»¶m \u0026laquo; Mã€‚ç„¶åä»è¿™mä¸ªå±æ€§ä¸­é‡‡ç”¨æŸç§ç­–ç•¥ï¼ˆæ¯”å¦‚è¯´ä¿¡æ¯å¢ç›Šï¼‰æ¥é€‰æ‹©1ä¸ªå±æ€§ä½œä¸ºè¯¥èŠ‚ç‚¹çš„åˆ†è£‚å±æ€§ã€‚\nç­–æ ‘å½¢æˆè¿‡ç¨‹ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦æŒ‰ç…§æ­¥éª¤2æ¥åˆ†è£‚ï¼ˆå¾ˆå®¹æ˜“ç†è§£ï¼Œå¦‚æœä¸‹ä¸€æ¬¡è¯¥èŠ‚ç‚¹é€‰å‡ºæ¥çš„é‚£ä¸€ä¸ªå±æ€§æ˜¯åˆšåˆšå…¶çˆ¶èŠ‚ç‚¹åˆ†è£‚æ—¶ç”¨è¿‡çš„å±æ€§ï¼Œåˆ™è¯¥èŠ‚ç‚¹å·²ç»è¾¾åˆ°äº†å¶å­èŠ‚ç‚¹ï¼Œæ— é¡»ç»§ç»­åˆ†è£‚äº†ï¼‰ã€‚ä¸€ç›´åˆ°ä¸èƒ½å¤Ÿå†åˆ†è£‚ä¸ºæ­¢ã€‚æ³¨æ„æ•´ä¸ªå†³ç­–æ ‘å½¢æˆè¿‡ç¨‹ä¸­æ²¡æœ‰è¿›è¡Œå‰ªæã€‚\næŒ‰ç…§æ­¥éª¤1~3å»ºç«‹å¤§é‡çš„å†³ç­–æ ‘ï¼Œè¿™æ ·å°±æ„æˆäº†éšæœºæ£®æ—äº†ã€‚\néšæœºæ£®æ—çš„ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ å®ƒå¯ä»¥å‡ºæ¥å¾ˆé«˜ç»´åº¦ï¼ˆç‰¹å¾å¾ˆå¤šï¼‰çš„æ•°æ®ï¼Œå¹¶ä¸”ä¸ç”¨é™ç»´ï¼Œæ— éœ€åšç‰¹å¾é€‰æ‹© å®ƒå¯ä»¥åˆ¤æ–­ç‰¹å¾çš„é‡è¦ç¨‹åº¦ å¯ä»¥åˆ¤æ–­å‡ºä¸åŒç‰¹å¾ä¹‹é—´çš„ç›¸äº’å½±å“ ä¸å®¹æ˜“è¿‡æ‹Ÿåˆ è®­ç»ƒé€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œå®¹æ˜“åšæˆå¹¶è¡Œæ–¹æ³• å®ç°èµ·æ¥æ¯”è¾ƒç®€å• å¯¹äºä¸å¹³è¡¡çš„æ•°æ®é›†æ¥è¯´ï¼Œå®ƒå¯ä»¥å¹³è¡¡è¯¯å·®ã€‚ å¦‚æœæœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†çš„ç‰¹å¾é—å¤±ï¼Œä»å¯ä»¥ç»´æŒå‡†ç¡®åº¦ã€‚ ç¼ºç‚¹ éšæœºæ£®æ—å·²ç»è¢«è¯æ˜åœ¨æŸäº›å™ªéŸ³è¾ƒå¤§çš„åˆ†ç±»æˆ–å›å½’é—®é¢˜ä¸Šä¼šè¿‡æ‹Ÿåˆã€‚ å¯¹äºæœ‰ä¸åŒå–å€¼çš„å±æ€§çš„æ•°æ®ï¼Œå–å€¼åˆ’åˆ†è¾ƒå¤šçš„å±æ€§ä¼šå¯¹éšæœºæ£®æ—äº§ç”Ÿæ›´å¤§çš„å½±å“ï¼Œæ‰€ä»¥éšæœºæ£®æ—åœ¨è¿™ç§æ•°æ®ä¸Šäº§å‡ºçš„å±æ€§æƒå€¼æ˜¯ä¸å¯ä¿¡çš„ ","title":"å†³ç­–æ ‘åˆ°éšæœºæ£®æ—"},{"content":"Summary â€œæ‰€æœ‰æ¨¡å‹éƒ½æ˜¯åçš„ï¼Œä½†æœ‰äº›æ¨¡å‹æ˜¯æœ‰ç”¨çš„â€ã€‚æˆ‘ä»¬å»ºç«‹æ¨¡å‹ä¹‹åï¼Œæ¥ä¸‹æ¥å°±è¦å»è¯„ä¼°æ¨¡å‹ï¼Œç¡®å®šè¿™ä¸ªæ¨¡å‹æ˜¯å¦â€˜æœ‰ç”¨â€™ã€‚å½“ä½ è´¹å°½å…¨åŠ›å»å»ºç«‹å®Œæ¨¡å‹åï¼Œä½ ä¼šå‘ç°ä»…ä»…å°±æ˜¯ä¸€äº›å•ä¸ªçš„æ•°å€¼æˆ–å•ä¸ªçš„æ›²çº¿å»å‘Šè¯‰ä½ ä½ çš„æ¨¡å‹åˆ°åº•æ˜¯å¦èƒ½å¤Ÿæ´¾ä¸Šç”¨åœºã€‚\nâ€‹ åœ¨å®é™…æƒ…å†µä¸­ï¼Œæˆ‘ä»¬ä¼šç”¨ä¸åŒçš„åº¦é‡å»è¯„ä¼°æˆ‘ä»¬çš„æ¨¡å‹ï¼Œè€Œåº¦é‡çš„é€‰æ‹©ï¼Œå®Œå…¨å–å†³äºæ¨¡å‹çš„ç±»å‹å’Œæ¨¡å‹ä»¥åè¦åšçš„äº‹ã€‚ä¸‹é¢æˆ‘ä»¬å°±ä¼šå­¦ä¹ åˆ°ä¸€äº›ç”¨äºè¯„ä»·æ¨¡å‹çš„å¸¸ç”¨åº¦é‡å’Œå›¾è¡¨ä»¥åŠå®ƒä»¬å„è‡ªçš„ä½¿ç”¨åœºæ™¯ã€‚\næ¨¡å‹è¯„ä¼°è¿™éƒ¨åˆ†ä¼šä»‹ç»ä»¥ä¸‹å‡ æ–¹é¢çš„å†…å®¹ï¼š\næ€§èƒ½åº¦é‡ æ¨¡å‹è¯„ä¼°æ–¹æ³• æ³›åŒ–èƒ½åŠ› è¿‡æ‹Ÿåˆã€æ¬ æ‹Ÿåˆ è¶…å‚æ•°è°ƒä¼˜ æœ¬æ–‡ä¼šé¦–å…ˆä»‹ç»æ€§èƒ½åº¦é‡æ–¹é¢çš„å†…å®¹ï¼Œä¸»è¦æ˜¯åˆ†ç±»é—®é¢˜å’Œå›å½’é—®é¢˜çš„æ€§èƒ½æŒ‡æ ‡ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•çš„ä»‹ç»ï¼š\nå‡†ç¡®ç‡å’Œé”™è¯¯ç‡ ç²¾ç¡®ç‡ã€å¬å›ç‡ä»¥åŠ F1 ROC æ›²çº¿ å’Œ AUC ä»£ä»·çŸ©é˜µ å›å½’é—®é¢˜çš„æ€§èƒ½åº¦é‡ å…¶ä»–è¯„ä»·æŒ‡æ ‡ï¼Œå¦‚è®¡ç®—é€Ÿåº¦ã€é²æ£’æ€§ç­‰ 1. æ€§èƒ½åº¦é‡ æ€§èƒ½åº¦é‡å°±æ˜¯æŒ‡å¯¹æ¨¡å‹æ³›åŒ–èƒ½åŠ›è¡¡é‡çš„è¯„ä»·æ ‡å‡†ã€‚\n1.1 å‡†ç¡®ç‡å’Œé”™è¯¯ç‡ åˆ†ç±»é—®é¢˜ä¸­æœ€å¸¸ç”¨çš„ä¸¤ä¸ªæ€§èƒ½åº¦é‡æ ‡å‡†\u0026ndash; å‡†ç¡®ç‡å’Œé”™è¯¯ç‡ã€‚\nå‡†ç¡®ç‡ï¼š æŒ‡çš„æ˜¯åˆ†ç±»æ­£ç¡®çš„æ ·æœ¬æ•°é‡å æ ·æœ¬æ€»æ•°çš„æ¯”ä¾‹ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\né”™è¯¯ç‡ï¼šæŒ‡åˆ†ç±»é”™è¯¯çš„æ ·æœ¬å æ ·æœ¬æ€»æ•°çš„æ¯”ä¾‹ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\né”™è¯¯ç‡ä¹Ÿæ˜¯æŸå¤±å‡½æ•°ä¸º 0-1 æŸå¤±æ—¶çš„è¯¯å·®ã€‚\nè¿™ä¸¤ç§è¯„ä»·æ ‡å‡†æ˜¯åˆ†ç±»é—®é¢˜ä¸­æœ€ç®€å•ä¹Ÿæ˜¯æœ€ç›´è§‚çš„è¯„ä»·æŒ‡æ ‡ã€‚ä½†å®ƒä»¬éƒ½å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ç±»åˆ«ä¸å¹³è¡¡çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬éƒ½æ— æ³•æœ‰æ•ˆè¯„ä»·æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚å³å¦‚æœæ­¤æ—¶æœ‰ 99% çš„è´Ÿæ ·æœ¬ï¼Œé‚£ä¹ˆæ¨¡å‹é¢„æµ‹æ‰€æœ‰æ ·æœ¬éƒ½æ˜¯è´Ÿæ ·æœ¬çš„æ—¶å€™ï¼Œå¯ä»¥å¾—åˆ° 99% çš„å‡†ç¡®ç‡ã€‚\nè¿™ç§æƒ…å†µå°±æ˜¯åœ¨ç±»åˆ«ä¸å¹³è¡¡çš„æ—¶å€™ï¼Œå æ¯”å¤§çš„ç±»åˆ«å¾€å¾€æˆä¸ºå½±å“å‡†ç¡®ç‡çš„æœ€ä¸»è¦å› ç´ ï¼\nè¿™ç§æ—¶å€™ï¼Œå…¶ä¸­ä¸€ç§è§£å†³æ–¹æ³•å°±æ˜¯æ›´æ¢è¯„ä»·æŒ‡æ ‡ï¼Œæ¯”å¦‚é‡‡ç”¨æ›´ä¸ºæœ‰æ•ˆçš„å¹³å‡å‡†ç¡®ç‡(æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬å‡†ç¡®ç‡çš„ç®—æœ¯å¹³å‡)ï¼Œå³ï¼š\nå…¶ä¸­ m æ˜¯ç±»åˆ«çš„æ•°é‡ã€‚\nå¯¹äºå‡†ç¡®ç‡å’Œé”™è¯¯ç‡ï¼Œç”¨ Python ä»£ç å®ç°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n1 2 3 4 5 6 def accuracy(y_true,y_pred): return sum(y==y_p for y,y_p in zip(y_true,y_pred))/len(y_true def error(y_true, y_pred): return sum(y != y_p for y, y_p in zip(y_true, y_pred)) / len(y_true) ä¸€ä¸ªç®€å•çš„äºŒåˆ†ç±»æµ‹è¯•æ ·ä¾‹ï¼š\n1 2 3 4 5 6 7 y_true = [1, 0, 1, 0, 1] y_pred = [0, 0, 1, 1, 0] acc = accuracy(y_true, y_pred) err = error(y_true, y_pred) print(\u0026#39;accuracy=\u0026#39;, acc) print(\u0026#39;error=\u0026#39;, err) è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š\n1 2 accuracy= 0.4 error= 0.6 1.2 ç²¾ç¡®ç‡ã€å¬å›ç‡ã€P-R æ›²çº¿å’Œ F1 ç²¾ç¡®ç‡ï¼Œä¹Ÿè¢«ç§°ä½œæŸ¥å‡†ç‡ï¼Œæ˜¯æŒ‡æ‰€æœ‰é¢„æµ‹ä¸ºæ­£ç±»çš„ç»“æœä¸­ï¼ŒçœŸæ­£çš„æ­£ç±»çš„æ¯”ä¾‹ã€‚å…¬å¼å¦‚ä¸‹ï¼š\nå¬å›ç‡ï¼Œä¹Ÿè¢«ç§°ä½œæŸ¥å…¨ç‡ï¼Œæ˜¯æŒ‡æ‰€æœ‰æ­£ç±»ä¸­ï¼Œè¢«åˆ†ç±»å™¨æ‰¾å‡ºæ¥çš„æ¯”ä¾‹ã€‚å…¬å¼å¦‚ä¸‹ï¼š\nå¯¹äºä¸Šè¿°ä¸¤ä¸ªå…¬å¼çš„ç¬¦å·å®šä¹‰ï¼Œæ˜¯åœ¨äºŒåˆ†ç±»é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬å°†å…³æ³¨çš„ç±»åˆ«ä½œä¸ºæ­£ç±»ï¼Œå…¶ä»–ç±»åˆ«ä½œä¸ºè´Ÿç±»åˆ«ï¼Œå› æ­¤ï¼Œå®šä¹‰ï¼š\nTP(True Positive)ï¼šçœŸæ­£æ­£ç±»çš„æ•°é‡ï¼Œå³åˆ†ç±»ä¸ºæ­£ç±»ï¼Œå®é™…ä¹Ÿæ˜¯æ­£ç±»çš„æ ·æœ¬æ•°é‡ï¼› FP(False Positive)ï¼šå‡æ­£ç±»çš„æ•°é‡ï¼Œå³åˆ†ç±»ä¸ºæ­£ç±»ï¼Œä½†å®é™…æ˜¯è´Ÿç±»çš„æ ·æœ¬æ•°é‡ï¼› FN(False Negative)ï¼šå‡è´Ÿç±»çš„æ•°é‡ï¼Œå³åˆ†ç±»ä¸ºè´Ÿç±»ï¼Œä½†å®é™…æ˜¯æ­£ç±»çš„æ ·æœ¬æ•°é‡ï¼› TN(True Negative)ï¼šçœŸè´Ÿç±»çš„æ•°é‡ï¼Œå³åˆ†ç±»æ˜¯è´Ÿç±»ï¼Œå®é™…ä¹Ÿè´Ÿç±»çš„æ ·æœ¬æ•°é‡ã€‚ æ›´å½¢è±¡çš„è¯´æ˜ï¼Œå¯ä»¥å‚è€ƒä¸‹è¡¨ï¼Œä¹Ÿæ˜¯æ··æ·†çŸ©é˜µçš„å®šä¹‰ï¼š\né¢„æµ‹ï¼šæ­£ç±» é¢„æµ‹ï¼šè´Ÿç±» å®é™…ï¼šæ­£ç±» TP FN å®é™…ï¼šè´Ÿç±» FP TN ç²¾ç¡®ç‡å’Œå¬å›ç‡æ˜¯ä¸€å¯¹çŸ›ç›¾çš„åº¦é‡ï¼Œé€šå¸¸ç²¾ç¡®ç‡é«˜æ—¶ï¼Œå¬å›ç‡å¾€å¾€ä¼šæ¯”è¾ƒä½ï¼›è€Œå¬å›ç‡é«˜æ—¶ï¼Œç²¾ç¡®ç‡åˆ™ä¼šæ¯”è¾ƒä½ï¼ŒåŸå› å¦‚ä¸‹ï¼š\nç²¾ç¡®ç‡è¶Šé«˜ï¼Œä»£è¡¨é¢„æµ‹ä¸ºæ­£ç±»çš„æ¯”ä¾‹æ›´é«˜ï¼Œè€Œè¦åšåˆ°è¿™ç‚¹ï¼Œé€šå¸¸å°±æ˜¯åªé€‰æ‹©æœ‰æŠŠæ¡çš„æ ·æœ¬ã€‚æœ€ç®€å•çš„å°±æ˜¯åªæŒ‘é€‰æœ€æœ‰æŠŠæ¡çš„ä¸€ä¸ªæ ·æœ¬ï¼Œæ­¤æ—¶ FP=0ï¼ŒP=1ï¼Œä½† FN å¿…ç„¶éå¸¸å¤§(æ²¡æŠŠæ¡çš„éƒ½åˆ¤å®šä¸ºè´Ÿç±»)ï¼Œå¬å›ç‡å°±éå¸¸ä½äº†ï¼› å¬å›ç‡è¦é«˜ï¼Œå°±æ˜¯éœ€è¦æ‰¾åˆ°æ‰€æœ‰æ­£ç±»å‡ºæ¥ï¼Œè¦åšåˆ°è¿™ç‚¹ï¼Œæœ€ç®€å•çš„å°±æ˜¯æ‰€æœ‰ç±»åˆ«éƒ½åˆ¤å®šä¸ºæ­£ç±»ï¼Œé‚£ä¹ˆ FN=0 ï¼Œä½† FP ä¹Ÿå¾ˆå¤§ï¼Œæ‰€æœ‰ç²¾ç¡®ç‡å°±å¾ˆä½äº†ã€‚ è€Œä¸”ä¸åŒçš„é—®é¢˜ï¼Œä¾§é‡çš„è¯„ä»·æŒ‡æ ‡ä¹Ÿä¸åŒï¼Œæ¯”å¦‚ï¼š\nå¯¹äºæ¨èç³»ç»Ÿï¼Œä¾§é‡çš„æ˜¯ç²¾ç¡®ç‡ã€‚ä¹Ÿå°±æ˜¯å¸Œæœ›æ¨èçš„ç»“æœéƒ½æ˜¯ç”¨æˆ·æ„Ÿå…´è¶£çš„ç»“æœï¼Œå³ç”¨æˆ·æ„Ÿå…´è¶£çš„ä¿¡æ¯æ¯”ä¾‹è¦é«˜ï¼Œå› ä¸ºé€šå¸¸ç»™ç”¨æˆ·å±•ç¤ºçš„çª—å£æœ‰é™ï¼Œä¸€èˆ¬åªèƒ½å±•ç¤º 5 ä¸ªï¼Œæˆ–è€… 10 ä¸ªï¼Œæ‰€ä»¥æ›´è¦æ±‚æ¨èç»™ç”¨æˆ·çœŸæ­£æ„Ÿå…´è¶£çš„ä¿¡æ¯ï¼› å¯¹äºåŒ»å­¦è¯Šæ–­ç³»ç»Ÿï¼Œä¾§é‡çš„æ˜¯å¬å›ç‡ã€‚å³å¸Œæœ›ä¸æ¼æ£€ä»»ä½•ç–¾ç—…æ‚£è€…ï¼Œå¦‚æœæ¼æ£€äº†ï¼Œå°±å¯èƒ½è€½ææ‚£è€…æ²»ç–—ï¼Œå¯¼è‡´ç—…æƒ…æ¶åŒ–ã€‚ ç²¾ç¡®ç‡å’Œå¬å›ç‡çš„ä»£ç ç®€å•å®ç°å¦‚ä¸‹ï¼Œè¿™æ˜¯åŸºäºäºŒåˆ†ç±»çš„æƒ…å†µ\n1 2 3 4 5 6 7 8 def precision(y_true, y_pred): true_positive = sum(y and y_p for y, y_p in zip(y_true, y_pred)) predicted_positive = sum(y_pred) return true_positive / predicted_positive def recall(y_true, y_pred): true_positive = sum(y and y_p for y, y_p in zip(y_true, y_pred)) real_positive = sum(y_true) return true_positive / real_positive ç»“æœ\n1 2 3 4 5 6 7 8 y_true = [1, 0, 1, 0, 1] y_pred = [0, 0, 1, 1, 0] precisions = precision(y_true, y_pred) recalls = recall(y_true, y_pred) print(\u0026#39;precisions=\u0026#39;, precisions) # è¾“å‡ºä¸º0.5 print(\u0026#39;recalls=\u0026#39;, recalls) # è¾“å‡ºä¸º 0.3333 1.2.2 P-R æ›²çº¿å’Œ F1 é¢„æµ‹ç»“æœå…¶å®å°±æ˜¯åˆ†ç±»å™¨å¯¹æ ·æœ¬åˆ¤æ–­ä¸ºæŸä¸ªç±»åˆ«çš„ç½®ä¿¡åº¦ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸åŒçš„é˜ˆå€¼æ¥è°ƒæ•´åˆ†ç±»å™¨å¯¹æŸä¸ªæ ·æœ¬çš„è¾“å‡ºç»“æœï¼Œæ¯”å¦‚è®¾ç½®é˜ˆå€¼æ˜¯ 0.9ï¼Œé‚£ä¹ˆåªæœ‰ç½®ä¿¡åº¦æ˜¯å¤§äºç­‰äº 0.9 çš„æ ·æœ¬æ‰ä¼šæœ€ç»ˆåˆ¤å®šä¸ºæ­£ç±»ï¼Œå…¶ä½™çš„éƒ½æ˜¯è´Ÿç±»ã€‚\næˆ‘ä»¬è®¾ç½®ä¸åŒçš„é˜ˆå€¼ï¼Œè‡ªç„¶å°±ä¼šå¾—åˆ°ä¸åŒçš„æ­£ç±»æ•°é‡å’Œè´Ÿç±»æ•°é‡ï¼Œä¾æ¬¡è®¡ç®—ä¸åŒæƒ…å†µçš„ç²¾ç¡®ç‡å’Œå¬å›ç‡ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥ä»¥ç²¾ç¡®ç‡ä¸ºçºµè½´ï¼Œå¬å›ç‡ä¸ºæ¨ªè½´ï¼Œç»˜åˆ¶ä¸€æ¡â€œP-Ræ›²çº¿â€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nå½“ç„¶ï¼Œä»¥ä¸Šè¿™ä¸ªæ›²çº¿æ˜¯æ¯”è¾ƒç†æƒ³æƒ…å†µä¸‹çš„ï¼Œæœªæ¥ç»˜å›¾æ–¹ä¾¿å’Œç¾è§‚ï¼Œå®é™…æƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nå¯¹äº P-R æ›²çº¿ï¼Œæœ‰ï¼š\n1.æ›²çº¿ä»å·¦ä¸Šè§’ (0,1) åˆ°å³ä¸‹è§’ (1,0) çš„èµ°åŠ¿ï¼Œæ­£å¥½åæ˜ äº†ç²¾ç¡®ç‡å’Œå¬å›ç‡æ˜¯ä¸€å¯¹çŸ›ç›¾çš„åº¦é‡ï¼Œä¸€ä¸ªé«˜å¦ä¸€ä¸ªä½çš„ç‰¹ç‚¹ï¼š\nå¼€å§‹æ˜¯ç²¾ç¡®ç‡é«˜ï¼Œå› ä¸ºè®¾ç½®é˜ˆå€¼å¾ˆé«˜ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªæ ·æœ¬ï¼ˆåˆ†ç±»å™¨æœ€æœ‰æŠŠæ¡æ˜¯æ­£ç±»ï¼‰è¢«é¢„æµ‹ä¸ºæ­£ç±»ï¼Œå…¶ä»–éƒ½æ˜¯è´Ÿç±»ï¼Œæ‰€ä»¥ç²¾ç¡®ç‡é«˜ï¼Œå‡ ä¹æ˜¯ 1ï¼Œè€Œå¬å›ç‡å‡ ä¹æ˜¯ 0ï¼Œä»…ä»…æ‰¾åˆ° 1 ä¸ªæ­£ç±»ã€‚ å³ä¸‹è§’æ—¶å€™å°±æ˜¯å¬å›ç‡å¾ˆé«˜ï¼Œç²¾ç¡®ç‡å¾ˆä½ï¼Œæ­¤æ—¶è®¾ç½®é˜ˆå€¼å°±æ˜¯ 0ï¼Œæ‰€ä»¥ç±»åˆ«éƒ½è¢«é¢„æµ‹ä¸ºæ­£ç±»ï¼Œæ‰€æœ‰æ­£ç±»éƒ½è¢«æ‰¾åˆ°äº†ï¼Œå¬å›ç‡å¾ˆé«˜ï¼Œè€Œç²¾ç¡®ç‡éå¸¸ä½ï¼Œå› ä¸ºå¤§é‡è´Ÿç±»è¢«é¢„æµ‹ä¸ºæ­£ç±»ã€‚ 2.P-R æ›²çº¿å¯ä»¥éå¸¸ç›´è§‚æ˜¾ç¤ºå‡ºåˆ†ç±»å™¨åœ¨æ ·æœ¬æ€»ä½“ä¸Šçš„ç²¾ç¡®ç‡å’Œå¬å›ç‡ã€‚æ‰€ä»¥å¯ä»¥å¯¹æ¯”ä¸¤ä¸ªåˆ†ç±»å™¨åœ¨åŒä¸ªæµ‹è¯•é›†ä¸Šçš„ P-R æ›²çº¿æ¥æ¯”è¾ƒå®ƒä»¬çš„åˆ†ç±»èƒ½åŠ›ï¼š\nå¦‚æœåˆ†ç±»å™¨ B çš„ P-R æ›²çº¿è¢«åˆ†ç±»å™¨ A çš„æ›²çº¿å®Œå…¨åŒ…ä½ï¼Œå¦‚ä¸‹å·¦å›¾æ‰€ç¤ºï¼Œåˆ™å¯ä»¥è¯´ï¼ŒA çš„æ€§èƒ½ä¼˜äº B; å¦‚æœæ˜¯ä¸‹é¢çš„å³å›¾ï¼Œä¸¤è€…çš„æ›²çº¿æœ‰äº¤å‰ï¼Œåˆ™å¾ˆéš¾ç›´æ¥åˆ¤æ–­ä¸¤ä¸ªåˆ†ç±»å™¨çš„ä¼˜åŠ£ï¼Œåªèƒ½æ ¹æ®å…·ä½“çš„ç²¾ç¡®ç‡å’Œå¬å›ç‡è¿›è¡Œæ¯”è¾ƒï¼š ä¸€ä¸ªåˆç†çš„ä¾æ®æ˜¯æ¯”è¾ƒ P-R æ›²çº¿ä¸‹æ–¹çš„é¢ç§¯å¤§å°ï¼Œå®ƒåœ¨ä¸€å®šç¨‹åº¦ä¸Šè¡¨å¾äº†åˆ†ç±»å™¨åœ¨ç²¾ç¡®ç‡å’Œå¬å›ç‡ä¸Šå–å¾—â€œåŒé«˜â€çš„æ¯”ä¾‹ï¼Œä½†è¿™ä¸ªæ•°å€¼ä¸å®¹æ˜“è®¡ç®—ï¼› å¦ä¸€ä¸ªæ¯”è¾ƒå°±æ˜¯å¹³è¡¡ç‚¹(Break-Event Point, BEP)ï¼Œå®ƒæ˜¯ç²¾ç¡®ç‡ç­‰äºå¬å›ç‡æ—¶çš„å–å€¼ï¼Œå¦‚ä¸‹å³å›¾æ‰€ç¤ºï¼Œè€Œä¸”å¯ä»¥åˆ¤å®šï¼Œå¹³è¡¡ç‚¹è¾ƒè¿œçš„æ›²çº¿æ›´å¥½ã€‚ å½“ç„¶äº†ï¼Œå¹³è¡¡ç‚¹è¿˜æ˜¯è¿‡äºç®€åŒ–ï¼Œäºæ˜¯æœ‰äº† F1 å€¼è¿™ä¸ªæ–°çš„è¯„ä»·æ ‡å‡†ï¼Œå®ƒæ˜¯ç²¾ç¡®ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡å€¼ï¼Œå®šä¹‰ä¸ºï¼š\nF1 è¿˜æœ‰ä¸€ä¸ªæ›´ä¸€èˆ¬çš„å½¢å¼ï¼š ï¼Œèƒ½è®©æˆ‘ä»¬è¡¨è¾¾å‡ºå¯¹ç²¾ç¡®ç‡å’Œå¬å›ç‡çš„ä¸åŒåå¥½ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\nå…¶ä¸­ åº¦é‡äº†å¬å›ç‡å¯¹ç²¾ç¡®ç‡çš„ç›¸å¯¹é‡è¦æ€§ï¼Œå½“ ï¼Œå°±æ˜¯ F1ï¼›å¦‚æœ ï¼Œå¬å›ç‡æ›´åŠ é‡è¦ï¼›å¦‚æœ ï¼Œåˆ™æ˜¯ç²¾ç¡®ç‡æ›´åŠ é‡è¦ã€‚\n1.2.3 å®ç²¾ç¡®ç‡/å¾®ç²¾ç¡®ç‡ã€å®å¬å›ç‡/å¾®å¬å›ç‡ä»¥åŠå® F1 / å¾® F1 å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸æ­¢ä¸€ä¸ªäºŒåˆ†ç±»çš„æ··æ·†çŸ©é˜µï¼Œæ¯”å¦‚å¤šæ¬¡è®­ç»ƒ/æµ‹è¯•å¾—åˆ°å¤šä¸ªæ··æ·†çŸ©é˜µï¼Œåœ¨å¤šä¸ªæ•°æ®é›†ä¸Šè¿›è¡Œè®­ç»ƒ/æµ‹è¯•æ¥ä¼°è®¡ç®—æ³•çš„â€œå…¨å±€â€æ€§èƒ½ï¼Œæˆ–è€…æ˜¯æ‰§è¡Œå¤šåˆ†ç±»ä»»åŠ¡æ—¶å¯¹ç±»åˆ«ä¸¤ä¸¤ç»„åˆå¾—åˆ°å¤šä¸ªæ··æ·†çŸ©é˜µã€‚\næ€»ä¹‹ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ n ä¸ªäºŒåˆ†ç±»æ··æ·†çŸ©é˜µä¸Šç»¼åˆè€ƒå¯Ÿç²¾ç¡®ç‡å’Œå¬å›ç‡ã€‚è¿™é‡Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•æ¥è¿›è¡Œè€ƒå¯Ÿï¼š\n1.ç¬¬ä¸€ç§æ˜¯ç›´æ¥åœ¨å„ä¸ªæ··æ·†çŸ©é˜µä¸Šåˆ†åˆ«è®¡ç®—å‡ºç²¾ç¡®ç‡å’Œå¬å›ç‡ï¼Œè®°ä¸º ï¼Œæ¥ç€è®¡ç®—å¹³å‡å€¼ï¼Œå°±å¾—åˆ°å®ç²¾ç¡®ç‡(macro-P)ã€å®å¬å›ç‡(macro-R)ä»¥åŠå® F1(macro-F1) , å®šä¹‰å¦‚ä¸‹ï¼š\n2.ç¬¬äºŒç§åˆ™æ˜¯å¯¹æ¯ä¸ªæ··æ·†çŸ©é˜µçš„å¯¹åº”å…ƒç´ è¿›è¡Œå¹³å‡ï¼Œå¾—åˆ° TPã€FPã€TNã€FN çš„å¹³å‡å€¼ï¼Œå†åŸºäºè¿™äº›å¹³å‡å€¼å°±å°±å¾—åˆ°å¾®ç²¾ç¡®ç‡(micro-P)ã€å¾®å¬å›ç‡(micro-R)ä»¥åŠå¾® F1(micro-F1) , å®šä¹‰å¦‚ä¸‹ï¼š\n1.3 ROC ä¸ AUC 1.3.1 ROC æ›²çº¿ ROC æ›²çº¿çš„ Receiver Operating Characteristic æ›²çº¿çš„ç®€ç§°ï¼Œä¸­æ–‡åæ˜¯â€œå—è¯•è€…å·¥ä½œç‰¹å¾â€ï¼Œèµ·æºäºå†›äº‹é¢†åŸŸï¼Œåå¹¿æ³›åº”ç”¨äºåŒ»å­¦é¢†åŸŸã€‚\nå®ƒçš„æ¨ªåæ ‡æ˜¯å‡æ­£ä¾‹ç‡(False Positive Rate, FPR)ï¼Œçºµåæ ‡æ˜¯çœŸæ­£ä¾‹ç‡(True Positive Rate, TPR)ï¼Œä¸¤è€…çš„å®šä¹‰åˆ†åˆ«å¦‚ä¸‹ï¼š\nTPR è¡¨ç¤ºæ­£ç±»ä¸­è¢«åˆ†ç±»å™¨é¢„æµ‹ä¸ºæ­£ç±»çš„æ¦‚ç‡ï¼Œåˆšå¥½å°±ç­‰äºæ­£ç±»çš„å¬å›ç‡ï¼›\nFPR è¡¨ç¤ºè´Ÿç±»ä¸­è¢«åˆ†ç±»å™¨é¢„æµ‹ä¸ºæ­£ç±»çš„æ¦‚ç‡ï¼Œå®ƒç­‰äº 1 å‡å»è´Ÿç±»çš„å¬å›ç‡ï¼Œè´Ÿç±»çš„å¬å›ç‡å¦‚ä¸‹ï¼Œç§°ä¸ºçœŸåä¾‹ç‡(True Negative Rate, TNR), ä¹Ÿè¢«ç§°ä¸ºç‰¹å¼‚æ€§ï¼Œè¡¨ç¤ºè´Ÿç±»è¢«æ­£ç¡®åˆ†ç±»çš„æ¯”ä¾‹ã€‚\nç¬¬äºŒç§æ›´ç›´è§‚åœ°ç»˜åˆ¶ ROC æ›²çº¿çš„æ–¹æ³•ï¼Œé¦–å…ˆç»Ÿè®¡å‡ºæ­£è´Ÿæ ·æœ¬çš„æ•°é‡ï¼Œå‡è®¾åˆ†åˆ«æ˜¯ P å’Œ Nï¼Œæ¥ç€ï¼Œå°†æ¨ªè½´çš„åˆ»åº¦é—´éš”è®¾ç½®ä¸º 1/Nï¼Œçºµè½´çš„åˆ»åº¦é—´éš”è®¾ç½®ä¸º 1/Pã€‚ç„¶åæ ¹æ®æ¨¡å‹è¾“å‡ºçš„æ¦‚ç‡å¯¹æ ·æœ¬æ’åºï¼Œå¹¶æŒ‰é¡ºåºéå†æ ·æœ¬ï¼Œä»é›¶ç‚¹å¼€å§‹ç»˜åˆ¶ ROC æ›²çº¿ï¼Œæ¯æ¬¡é‡åˆ°ä¸€ä¸ªæ­£æ ·æœ¬å°±æ²¿çºµè½´æ–¹å‘ç»˜åˆ¶ä¸€ä¸ªåˆ»åº¦é—´éš”çš„æ›²çº¿ï¼Œé‡åˆ°ä¸€ä¸ªè´Ÿæ ·æœ¬å°±æ²¿æ¨ªè½´ç»˜åˆ¶ä¸€ä¸ªåˆ»åº¦é—´éš”çš„æ›²çº¿ï¼Œç›´åˆ°éå†å®Œæ‰€æœ‰æ ·æœ¬ï¼Œæ›²çº¿æœ€ç»ˆåœç•™åœ¨ (1,1) è¿™ä¸ªç‚¹ï¼Œæ­¤æ—¶å°±å®Œæˆäº† ROC æ›²çº¿çš„ç»˜åˆ¶äº†ã€‚\nå½“ç„¶ï¼Œæ›´ä¸€èˆ¬çš„ ROC æ›²çº¿æ˜¯å¦‚ä¸‹å›¾æ‰€ç¤ºçš„ï¼Œä¼šæ›´åŠ çš„å¹³æ»‘ï¼Œä¸Šå›¾æ˜¯ç”±äºæ ·æœ¬æ•°é‡æœ‰é™æ‰å¯¼è‡´çš„ã€‚\nå¯¹äº ROC æ›²çº¿ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹ç‰¹æ€§ï¼š\n1.ROC æ›²çº¿é€šå¸¸éƒ½æ˜¯ä»å·¦ä¸‹è§’ (0,0) å¼€å§‹ï¼Œåˆ°å³ä¸Šè§’ (1,1) ç»“æŸã€‚\nå¼€å§‹æ—¶å€™ï¼Œ\nç¬¬ä¸€ä¸ªæ ·æœ¬è¢«é¢„æµ‹ä¸ºæ­£ç±»\nï¼Œå…¶ä»–éƒ½æ˜¯é¢„æµ‹ä¸ºè´Ÿç±»åˆ«ï¼›\nTPR ä¼šå¾ˆä½ï¼Œå‡ ä¹æ˜¯ 0ï¼Œä¸Šè¿°ä¾‹å­å°±æ˜¯ 0.1ï¼Œæ­¤æ—¶å¤§é‡æ­£ç±»æ²¡æœ‰è¢«åˆ†ç±»å™¨æ‰¾å‡ºæ¥ï¼› FPR ä¹Ÿå¾ˆä½ï¼Œå¯èƒ½å°±æ˜¯0ï¼Œä¸Šè¿°ä¾‹å­å°±æ˜¯ 0ï¼Œè¿™æ—¶å€™è¢«é¢„æµ‹ä¸ºæ­£ç±»çš„æ ·æœ¬å¯èƒ½å®é™…ä¹Ÿæ˜¯æ­£ç±»ï¼Œæ‰€ä»¥å‡ ä¹æ²¡æœ‰é¢„æµ‹é”™è¯¯çš„æ­£ç±»æ ·æœ¬ã€‚ ç»“æŸæ—¶å€™ï¼Œ\næ‰€æœ‰æ ·æœ¬éƒ½é¢„æµ‹ä¸ºæ­£ç±».\nTPR å‡ ä¹å°±æ˜¯ 1ï¼Œå› ä¸ºæ‰€æœ‰æ ·æœ¬éƒ½é¢„æµ‹ä¸ºæ­£ç±»ï¼Œé‚£è‚¯å®šå°±æ‰¾å‡ºæ‰€æœ‰çš„æ­£ç±»æ ·æœ¬äº†ï¼› FPR ä¹Ÿæ˜¯å‡ ä¹ä¸º 1ï¼Œå› ä¸ºæ‰€æœ‰è´Ÿæ ·æœ¬éƒ½è¢«é”™è¯¯åˆ¤æ–­ä¸ºæ­£ç±»ã€‚ 2.ROC æ›²çº¿ä¸­ï¼š\nå¯¹è§’çº¿å¯¹åº”äºéšæœºçŒœæƒ³æ¨¡å‹ï¼Œå³æ¦‚ç‡ä¸º 0.5ï¼› ç‚¹ (0,1) æ˜¯ç†æƒ³æ¨¡å‹ï¼Œå› ä¸ºæ­¤æ—¶ TPR=1ï¼ŒFPR=0ï¼Œä¹Ÿå°±æ˜¯æ­£ç±»éƒ½é¢„æµ‹å‡ºæ¥ï¼Œå¹¶ä¸”æ²¡æœ‰é¢„æµ‹é”™è¯¯ï¼› é€šå¸¸ï¼ŒROC æ›²çº¿è¶Šæ¥è¿‘ç‚¹ (0, 1) è¶Šå¥½ã€‚ 3.åŒæ ·å¯ä»¥æ ¹æ® ROC æ›²çº¿æ¥åˆ¤æ–­ä¸¤ä¸ªåˆ†ç±»å™¨çš„æ€§èƒ½ï¼š\nå¦‚æœåˆ†ç±»å™¨ A çš„ ROC æ›²çº¿è¢«åˆ†ç±»å™¨ B çš„æ›²çº¿å®Œå…¨åŒ…ä½ï¼Œå¯ä»¥è¯´ B çš„æ€§èƒ½å¥½è¿‡ Aï¼Œè¿™å¯¹åº”äºä¸Šä¸€æ¡è¯´çš„ ROC æ›²çº¿è¶Šæ¥è¿‘ç‚¹ (0, 1) è¶Šå¥½ï¼› å¦‚æœä¸¤ä¸ªåˆ†ç±»å™¨çš„ ROC æ›²çº¿å‘ç”Ÿäº†äº¤å‰ï¼Œåˆ™åŒæ ·å¾ˆéš¾ç›´æ¥åˆ¤æ–­ä¸¤è€…çš„æ€§èƒ½ä¼˜åŠ£ï¼Œéœ€è¦å€ŸåŠ© ROC æ›²çº¿ä¸‹é¢ç§¯å¤§å°æ¥åšåˆ¤æ–­ï¼Œè€Œè¿™ä¸ªé¢ç§¯è¢«ç§°ä¸º AUC:Area Under ROC Curveã€‚ 1.3.2 ROC å’Œ P-R æ›²çº¿çš„å¯¹æ¯” ç›¸åŒç‚¹\n1.ä¸¤è€…åˆ»ç”»çš„éƒ½æ˜¯é˜ˆå€¼çš„é€‰æ‹©å¯¹åˆ†ç±»åº¦é‡æŒ‡æ ‡çš„å½±å“ã€‚è™½ç„¶æ¯ä¸ªåˆ†ç±»å™¨å¯¹æ¯ä¸ªæ ·æœ¬éƒ½ä¼šè¾“å‡ºä¸€ä¸ªæ¦‚ç‡ï¼Œä¹Ÿå°±æ˜¯ç½®ä¿¡åº¦ï¼Œä½†é€šå¸¸æˆ‘ä»¬éƒ½ä¼šäººä¸ºè®¾ç½®ä¸€ä¸ªé˜ˆå€¼æ¥å½±å“åˆ†ç±»å™¨æœ€ç»ˆåˆ¤æ–­çš„ç»“æœï¼Œæ¯”å¦‚è®¾ç½®ä¸€ä¸ªå¾ˆé«˜çš„é˜ˆå€¼\u0026ndash;0.95ï¼Œæˆ–è€…æ¯”è¾ƒä½çš„é˜ˆå€¼\u0026ndash;0.3ã€‚\nå¦‚æœæ˜¯åå‘äºç²¾ç¡®ç‡ï¼Œåˆ™æé«˜é˜ˆå€¼ï¼Œä¿è¯åªæŠŠæœ‰æŠŠæ¡çš„æ ·æœ¬åˆ¤æ–­ä¸ºæ­£ç±»ï¼Œæ­¤æ—¶å¯ä»¥è®¾ç½®é˜ˆå€¼ä¸º 0.9ï¼Œæˆ–è€…æ›´é«˜ï¼› å¦‚æœåå‘äºå¬å›ç‡ï¼Œé‚£ä¹ˆé™ä½é˜ˆå€¼ï¼Œä¿è¯å°†æ›´å¤šçš„æ ·æœ¬åˆ¤æ–­ä¸ºæ­£ç±»ï¼Œæ›´å®¹æ˜“æ‰¾å‡ºæ‰€æœ‰çœŸæ­£çš„æ­£æ ·æœ¬ï¼Œæ­¤æ—¶è®¾ç½®é˜ˆå€¼æ˜¯ 0.5ï¼Œæˆ–è€…æ›´ä½ã€‚ 2.ä¸¤ä¸ªæ›²çº¿çš„æ¯ä¸ªç‚¹éƒ½æ˜¯å¯¹åº”æŸä¸ªé˜ˆå€¼çš„é€‰æ‹©ï¼Œè¯¥ç‚¹æ˜¯åœ¨è¯¥é˜ˆå€¼ä¸‹çš„ (ç²¾ç¡®ç‡ï¼Œå¬å›ç‡) / (TPR, FPR)ã€‚ç„¶åæ²¿ç€æ¨ªè½´æ–¹å‘å¯¹åº”é˜ˆå€¼çš„ä¸‹é™ã€‚\nä¸åŒ\nç›¸æ¯”è¾ƒ P-R æ›²çº¿ï¼ŒROC æ›²çº¿æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯æ­£è´Ÿæ ·æœ¬çš„åˆ†å¸ƒå‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒçš„æ›²çº¿å½¢çŠ¶èƒ½å¤ŸåŸºæœ¬ä¿æŒä¸å˜ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º:\nåˆ†åˆ«æ¯”è¾ƒäº†å¢åŠ åå€çš„è´Ÿæ ·æœ¬åï¼Œ P-R å’Œ ROC æ›²çº¿çš„å˜åŒ–ï¼Œå¯ä»¥çœ‹åˆ° ROC æ›²çº¿çš„å½¢çŠ¶åŸºæœ¬ä¸å˜ï¼Œä½† P-R æ›²çº¿å‘ç”Ÿäº†æ˜æ˜¾çš„å˜åŒ–ã€‚\næ‰€ä»¥ ROC æ›²çº¿çš„è¿™ä¸ªç‰¹ç‚¹å¯ä»¥é™ä½ä¸åŒæµ‹è¯•é›†å¸¦æ¥çš„å¹²æ‰°ï¼Œæ›´åŠ å®¢è§‚åœ°è¯„ä¼°æ¨¡å‹æœ¬èº«çš„æ€§èƒ½ï¼Œå› æ­¤å®ƒé€‚ç”¨çš„åœºæ™¯æ›´å¤šï¼Œæ¯”å¦‚æ’åºã€æ¨èã€å¹¿å‘Šç­‰é¢†åŸŸã€‚\nè¿™ä¹Ÿæ˜¯ç”±äºç°å®åœºæ™¯ä¸­å¾ˆå¤šé—®é¢˜éƒ½ä¼šå­˜åœ¨æ­£è´Ÿæ ·æœ¬æ•°é‡ä¸å¹³è¡¡çš„æƒ…å†µï¼Œæ¯”å¦‚è®¡ç®—å¹¿å‘Šé¢†åŸŸç»å¸¸æ¶‰åŠè½¬åŒ–ç‡æ¨¡å‹ï¼Œæ­£æ ·æœ¬çš„æ•°é‡å¾€å¾€æ˜¯è´Ÿæ ·æœ¬æ•°é‡çš„åƒåˆ†ä¹‹ä¸€ç”šè‡³ä¸‡åˆ†ä¹‹ä¸€ï¼Œè¿™æ—¶å€™é€‰æ‹© ROC æ›²çº¿æ›´åŠ è€ƒéªŒåæ˜ æ¨¡å‹æœ¬èº«çš„å¥½åã€‚\nå½“ç„¶ï¼Œå¦‚æœå¸Œæœ›çœ‹åˆ°æ¨¡å‹åœ¨ç‰¹å®šæ•°æ®é›†ä¸Šçš„è¡¨ç°ï¼ŒP-R æ›²çº¿ä¼šæ›´ç›´è§‚åœ°åæ˜ å…¶æ€§èƒ½ã€‚æ‰€ä»¥è¿˜æ˜¯éœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚\n1.3.3 AUC æ›²çº¿ AUC æ˜¯ ROC æ›²çº¿çš„é¢ç§¯ï¼Œå…¶ç‰©ç†æ„ä¹‰æ˜¯ï¼šä»æ‰€æœ‰æ­£æ ·æœ¬ä¸­éšæœºæŒ‘é€‰ä¸€ä¸ªæ ·æœ¬ï¼Œæ¨¡å‹å°†å…¶é¢„æµ‹ä¸ºæ­£æ ·æœ¬çš„æ¦‚ç‡æ˜¯ ï¼›ä»æ‰€æœ‰è´Ÿæ ·æœ¬ä¸­éšæœºæŒ‘é€‰ä¸€ä¸ªæ ·æœ¬ï¼Œæ¨¡å‹å°†å…¶é¢„æµ‹ä¸ºæ­£æ ·æœ¬çš„æ¦‚ç‡æ˜¯ ã€‚ çš„æ¦‚ç‡å°±æ˜¯ AUCã€‚\nAUC æ›²çº¿æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š\nå¦‚æœå®Œå…¨éšæœºåœ°å¯¹æ ·æœ¬è¿›è¡Œåˆ†ç±»ï¼Œé‚£ä¹ˆ çš„æ¦‚ç‡æ˜¯ 0.5ï¼Œåˆ™ AUC=0.5ï¼›\nAUC åœ¨æ ·æœ¬ä¸å¹³è¡¡çš„æ¡ä»¶ä¸‹ä¾ç„¶é€‚ç”¨ã€‚\nå¦‚ï¼šåœ¨åæ¬ºè¯ˆåœºæ™¯ä¸‹ï¼Œå‡è®¾æ­£å¸¸ç”¨æˆ·ä¸ºæ­£ç±»ï¼ˆè®¾å æ¯” 99.9%ï¼‰ï¼Œæ¬ºè¯ˆç”¨æˆ·ä¸ºè´Ÿç±»ï¼ˆè®¾å æ¯” 0.1%ï¼‰ã€‚\nå¦‚æœä½¿ç”¨å‡†ç¡®ç‡è¯„ä¼°ï¼Œåˆ™å°†æ‰€æœ‰ç”¨æˆ·é¢„æµ‹ä¸ºæ­£ç±»å³å¯è·å¾— 99.9%çš„å‡†ç¡®ç‡ã€‚å¾ˆæ˜æ˜¾è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é¢„æµ‹ç»“æœï¼Œå› ä¸ºæ¬ºè¯ˆç”¨æˆ·å…¨éƒ¨æœªèƒ½æ‰¾å‡ºã€‚\nå¦‚æœä½¿ç”¨ AUC è¯„ä¼°ï¼Œåˆ™æ­¤æ—¶ FPR=1,TPR=1ï¼Œå¯¹åº”çš„ AUC=0.5 ã€‚å› æ­¤ AUC æˆåŠŸçš„æŒ‡å‡ºäº†è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é¢„æµ‹ç»“æœã€‚\nAUC ååº”çš„æ˜¯æ¨¡å‹å¯¹äºæ ·æœ¬çš„æ’åºèƒ½åŠ›ï¼ˆæ ¹æ®æ ·æœ¬é¢„æµ‹ä¸ºæ­£ç±»çš„æ¦‚ç‡æ¥æ’åºï¼‰ã€‚å¦‚ï¼šAUC=0.8 è¡¨ç¤ºï¼šç»™å®šä¸€ä¸ªæ­£æ ·æœ¬å’Œä¸€ä¸ªè´Ÿæ ·æœ¬ï¼Œåœ¨ 80% çš„æƒ…å†µä¸‹ï¼Œæ¨¡å‹å¯¹æ­£æ ·æœ¬é¢„æµ‹ä¸ºæ­£ç±»çš„æ¦‚ç‡å¤§äºå¯¹è´Ÿæ ·æœ¬é¢„æµ‹ä¸ºæ­£ç±»çš„æ¦‚ç‡ã€‚\nAUC å¯¹äºå‡åŒ€é‡‡æ ·ä¸æ•æ„Ÿã€‚å¦‚ï¼šä¸Šè¿°åæ¬ºè¯ˆåœºæ™¯ä¸­ï¼Œå‡è®¾å¯¹æ­£å¸¸ç”¨æˆ·è¿›è¡Œå‡åŒ€çš„é™é‡‡æ ·ã€‚ä»»æ„ç»™å®šä¸€ä¸ªè´Ÿæ ·æœ¬ nï¼Œè®¾æ¨¡å‹å¯¹å…¶é¢„æµ‹ä¸ºæ­£ç±»çš„æ¦‚ç‡ä¸º Pn ã€‚é™é‡‡æ ·å‰åï¼Œç”±äºæ˜¯å‡åŒ€é‡‡æ ·ï¼Œå› æ­¤é¢„æµ‹ä¸ºæ­£ç±»çš„æ¦‚ç‡å¤§äº Pn å’Œå°äº Pn çš„çœŸæ­£æ ·æœ¬çš„æ¯”ä¾‹æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚å› æ­¤ AUC ä¿æŒä¸å˜ã€‚\nä½†æ˜¯å¦‚æœæ˜¯éå‡åŒ€çš„é™é‡‡æ ·ï¼Œåˆ™é¢„æµ‹ä¸ºæ­£ç±»çš„æ¦‚ç‡å¤§äº Pn å’Œå°äº Pn çš„çœŸæ­£æ ·æœ¬çš„æ¯”ä¾‹ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´ AUC å‘ç”Ÿå˜åŒ–ã€‚\næ­£è´Ÿæ ·æœ¬ä¹‹é—´çš„é¢„æµ‹ä¸ºæ­£ç±»æ¦‚ç‡ä¹‹é—´çš„å·®è·è¶Šå¤§ï¼Œåˆ™ AUC è¶Šé«˜ã€‚å› ä¸ºè¿™è¡¨æ˜æ­£è´Ÿæ ·æœ¬ä¹‹é—´æ’åºçš„æŠŠæ¡è¶Šå¤§ï¼ŒåŒºåˆ†åº¦è¶Šé«˜ã€‚\nå¦‚ï¼šåœ¨ç”µå•†åœºæ™¯ä¸­ï¼Œç‚¹å‡»ç‡æ¨¡å‹çš„ AUC è¦ä½äºè´­ä¹°è½¬åŒ–æ¨¡å‹çš„ AUC ã€‚å› ä¸ºç‚¹å‡»è¡Œä¸ºçš„æˆæœ¬ä½äºè´­ä¹°è¡Œä¸ºçš„æˆæœ¬ï¼Œæ‰€ä»¥ç‚¹å‡»ç‡æ¨¡å‹ä¸­æ­£è´Ÿæ ·æœ¬çš„å·®åˆ«è¦å°äºè´­ä¹°è½¬åŒ–æ¨¡å‹ä¸­æ­£è´Ÿæ ·æœ¬çš„å·®åˆ«ã€‚\nAUC çš„è®¡ç®—å¯ä»¥é€šè¿‡å¯¹ ROC æ›²çº¿ä¸‹å„éƒ¨åˆ†çš„é¢ç§¯æ±‚å’Œè€Œå¾—ã€‚å‡è®¾ ROC æ›²çº¿æ˜¯ç”±åæ ‡ä¸ºä¸‹åˆ—è¿™äº›ç‚¹æŒ‰é¡ºåºè¿æ¥è€Œæˆçš„ï¼š\né‚£ä¹ˆ AUC å¯ä»¥è¿™æ ·ä¼°ç®—ï¼š\n1.4 ä»£ä»·çŸ©é˜µ å‰é¢ä»‹ç»çš„æ€§èƒ½æŒ‡æ ‡éƒ½æœ‰ä¸€ä¸ªéšå¼çš„å‰æï¼Œé”™è¯¯éƒ½æ˜¯å‡ç­‰ä»£ä»·ã€‚ä½†å®é™…åº”ç”¨è¿‡ç¨‹ä¸­ï¼Œä¸åŒç±»å‹çš„é”™è¯¯æ‰€é€ æˆçš„åæœæ˜¯ä¸åŒçš„ã€‚æ¯”å¦‚å°†å¥åº·äººåˆ¤æ–­ä¸ºæ‚£è€…ï¼Œä¸æ‚£è€…è¢«åˆ¤æ–­ä¸ºå¥åº·äººï¼Œä»£ä»·è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ï¼Œå‰è€…å¯èƒ½å°±æ˜¯éœ€è¦å†æ¬¡è¿›è¡Œæ£€æŸ¥ï¼Œè€Œåè€…å¯èƒ½é”™è¿‡æ²»ç–—çš„æœ€ä½³æ—¶æœºã€‚\nå› æ­¤ï¼Œä¸ºäº†è¡¡é‡ä¸åŒç±»å‹æ‰€é€ æˆçš„ä¸åŒæŸå¤±ï¼Œå¯ä»¥ä¸ºé”™è¯¯èµ‹äºˆéå‡ç­‰ä»£ä»·(unequal cost)ã€‚\nå¯¹äºä¸€ä¸ªäºŒç±»åˆ†ç±»é—®é¢˜ï¼Œå¯ä»¥è®¾å®šä¸€ä¸ªä»£ä»·çŸ©é˜µ(cost matrix)ï¼Œå…¶ä¸­ è¡¨ç¤ºå°†ç¬¬ i ç±»æ ·æœ¬é¢„æµ‹ä¸ºç¬¬ j ç±»æ ·æœ¬çš„ä»£ä»·ï¼Œè€Œé¢„æµ‹æ­£ç¡®çš„ä»£ä»·æ˜¯ 0 ã€‚å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š\né¢„æµ‹ï¼šç¬¬ 0 ç±» é¢„æµ‹ï¼šç¬¬ 1 ç±» çœŸå®ï¼šç¬¬ 0 ç±» 0 çœŸå®ï¼š ç¬¬ 1 ç±» 0 åœ¨éå‡ç­‰ä»£ä»·ä¸‹ï¼Œå¸Œæœ›æ‰¾åˆ°çš„ä¸å†æ˜¯ç®€å•åœ°æœ€å°åŒ–é”™è¯¯ç‡çš„æ¨¡å‹ï¼Œè€Œæ˜¯å¸Œæœ›æ‰¾åˆ°æœ€å°åŒ–æ€»ä½“ä»£ä»· total cost çš„æ¨¡å‹ã€‚\nåœ¨éå‡ç­‰ä»£ä»·ä¸‹ï¼ŒROC æ›²çº¿ä¸èƒ½ç›´æ¥åæ˜ å‡ºåˆ†ç±»å™¨çš„æœŸæœ›æ€»ä½“ä»£ä»·ï¼Œæ­¤æ—¶éœ€è¦ä½¿ç”¨ä»£ä»·æ›²çº¿ cost curve\nä»£ä»·æ›²çº¿çš„æ¨ªè½´æ˜¯æ­£ä¾‹æ¦‚ç‡ä»£ä»·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå…¶ä¸­ p æ˜¯æ­£ä¾‹(ç¬¬ 0 ç±»)çš„æ¦‚ç‡ ä»£ä»·æ›²çº¿çš„çºµè½´æ˜¯å½’ä¸€åŒ–ä»£ä»·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nå…¶ä¸­ï¼Œå‡æ­£ä¾‹ç‡ FPR è¡¨ç¤ºæ¨¡å‹å°†è´Ÿæ ·æœ¬é¢„æµ‹ä¸ºæ­£ç±»çš„æ¦‚ç‡ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\nå‡è´Ÿä¾‹ç‡ FNR è¡¨ç¤ºå°†æ­£æ ·æœ¬é¢„æµ‹ä¸ºè´Ÿç±»çš„æ¦‚ç‡ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\nä»£ä»·æ›²çº¿å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n1.5 å›å½’é—®é¢˜çš„æ€§èƒ½åº¦é‡ å¯¹äºå›å½’é—®é¢˜ï¼Œå¸¸ç”¨çš„æ€§èƒ½åº¦é‡æ ‡å‡†æœ‰ï¼š\n1.å‡æ–¹è¯¯å·®(Mean Square Error, MSE)ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\n2.å‡æ–¹æ ¹è¯¯å·®(Root Mean Squared Error, RMSE)ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\n3.å‡æ–¹æ ¹å¯¹æ•°è¯¯å·®(Root Mean Squared Logarithmic Error, RMSLE)ï¼Œå®šä¹‰å¦‚ä¸‹\n4.å¹³å‡ç»å¯¹è¯¯å·®(Mean Absolute Error, MAE)ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\nè¿™å››ä¸ªæ ‡å‡†ä¸­ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªï¼Œå³ MSE å’Œ RMSEï¼Œè¿™ä¸¤ä¸ªæ ‡å‡†ä¸€èˆ¬éƒ½å¯ä»¥å¾ˆå¥½åæ˜ å›å½’æ¨¡å‹é¢„æµ‹å€¼å’ŒçœŸå®å€¼çš„åç¦»ç¨‹åº¦ï¼Œä½†å¦‚æœé‡åˆ°ä¸ªåˆ«åç¦»ç¨‹åº¦éå¸¸å¤§çš„ç¦»ç¾¤ç‚¹æ—¶ï¼Œå³ä¾¿æ•°é‡å¾ˆå°‘ï¼Œä¹Ÿä¼šè®©è¿™ä¸¤ä¸ªæŒ‡æ ‡å˜å¾—å¾ˆå·®ã€‚\né‡åˆ°è¿™ç§æƒ…å†µï¼Œæœ‰ä¸‰ç§è§£å†³æ€è·¯ï¼š\nå°†ç¦»ç¾¤ç‚¹ä½œä¸ºå™ªå£°ç‚¹æ¥å¤„ç†ï¼Œå³æ•°æ®é¢„å¤„ç†éƒ¨åˆ†éœ€è¦è¿‡æ»¤æ‰è¿™äº›å™ªå£°ç‚¹ï¼› ä»æ¨¡å‹æ€§èƒ½å…¥æ‰‹ï¼Œæé«˜æ¨¡å‹çš„é¢„æµ‹èƒ½åŠ›ï¼Œå°†è¿™äº›ç¦»ç¾¤ç‚¹äº§ç”Ÿçš„æœºåˆ¶å»ºæ¨¡åˆ°æ¨¡å‹ä¸­ï¼Œä½†è¿™ä¸ªæ–¹æ³•ä¼šæ¯”è¾ƒå›°éš¾ï¼› é‡‡ç”¨å…¶ä»–æŒ‡æ ‡ï¼Œæ¯”å¦‚ç¬¬ä¸‰ä¸ªæŒ‡æ ‡ RMSLEï¼Œå®ƒå…³æ³¨çš„æ˜¯é¢„æµ‹è¯¯å·®çš„æ¯”ä¾‹ï¼Œå³ä¾¿å­˜åœ¨ç¦»ç¾¤ç‚¹ï¼Œä¹Ÿå¯ä»¥é™ä½è¿™äº›ç¦»ç¾¤ç‚¹çš„å½±å“ï¼›æˆ–è€…æ˜¯ MAPEï¼Œå¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®(Mean Absolute Percent Error)ï¼Œå®šä¹‰ä¸ºï¼š RMSE çš„ç®€å•ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š\n1 2 3 4 5 6 7 8 def rmse(predictions, targets): # çœŸå®å€¼å’Œé¢„æµ‹å€¼çš„è¯¯å·® differences = predictions - targets differences_squared = differences ** 2 mean_of_differences_squared = differences_squared.mean() # å–å¹³æ–¹æ ¹ rmse_val = np.sqrt(mean_of_differences_squared) return rmse_val 1.6 å…¶ä»–è¯„ä»·æŒ‡æ ‡ è®¡ç®—é€Ÿåº¦ï¼šæ¨¡å‹è®­ç»ƒå’Œé¢„æµ‹éœ€è¦çš„æ—¶é—´ï¼› é²æ£’æ€§ï¼šå¤„ç†ç¼ºå¤±å€¼å’Œå¼‚å¸¸å€¼çš„èƒ½åŠ›ï¼› å¯æ‹“å±•æ€§ï¼šå¤„ç†å¤§æ•°æ®é›†çš„èƒ½åŠ›ï¼› å¯è§£é‡Šæ€§ï¼šæ¨¡å‹é¢„æµ‹æ ‡å‡†çš„å¯ç†è§£æ€§ï¼Œæ¯”å¦‚å†³ç­–æ ‘äº§ç”Ÿçš„è§„åˆ™å°±å¾ˆå®¹æ˜“ç†è§£ï¼Œè€Œç¥ç»ç½‘ç»œè¢«ç§°ä¸ºé»‘ç›’å­çš„åŸå› å°±æ˜¯å®ƒçš„å¤§é‡å‚æ•°å¹¶ä¸å¥½ç†è§£ã€‚ ","permalink":"https://reid00.github.io/en/posts/ml/%E5%A6%82%E4%BD%95%E8%AF%84%E4%BB%B7%E6%A8%A1%E5%9E%8B%E5%A5%BD%E5%9D%8F/","summary":"Summary â€œæ‰€æœ‰æ¨¡å‹éƒ½æ˜¯åçš„ï¼Œä½†æœ‰äº›æ¨¡å‹æ˜¯æœ‰ç”¨çš„â€ã€‚æˆ‘ä»¬å»ºç«‹æ¨¡å‹ä¹‹åï¼Œæ¥ä¸‹æ¥å°±è¦å»è¯„ä¼°æ¨¡å‹ï¼Œç¡®å®šè¿™ä¸ªæ¨¡å‹æ˜¯å¦â€˜æœ‰ç”¨â€™ã€‚å½“ä½ è´¹å°½å…¨åŠ›å»å»ºç«‹å®Œæ¨¡å‹åï¼Œä½ ä¼šå‘ç°ä»…ä»…å°±æ˜¯ä¸€äº›å•ä¸ªçš„æ•°å€¼æˆ–å•ä¸ªçš„æ›²çº¿å»å‘Šè¯‰ä½ ä½ çš„æ¨¡å‹åˆ°åº•æ˜¯å¦èƒ½å¤Ÿæ´¾ä¸Šç”¨åœºã€‚\nâ€‹ åœ¨å®é™…æƒ…å†µä¸­ï¼Œæˆ‘ä»¬ä¼šç”¨ä¸åŒçš„åº¦é‡å»è¯„ä¼°æˆ‘ä»¬çš„æ¨¡å‹ï¼Œè€Œåº¦é‡çš„é€‰æ‹©ï¼Œå®Œå…¨å–å†³äºæ¨¡å‹çš„ç±»å‹å’Œæ¨¡å‹ä»¥åè¦åšçš„äº‹ã€‚ä¸‹é¢æˆ‘ä»¬å°±ä¼šå­¦ä¹ åˆ°ä¸€äº›ç”¨äºè¯„ä»·æ¨¡å‹çš„å¸¸ç”¨åº¦é‡å’Œå›¾è¡¨ä»¥åŠå®ƒä»¬å„è‡ªçš„ä½¿ç”¨åœºæ™¯ã€‚\næ¨¡å‹è¯„ä¼°è¿™éƒ¨åˆ†ä¼šä»‹ç»ä»¥ä¸‹å‡ æ–¹é¢çš„å†…å®¹ï¼š\næ€§èƒ½åº¦é‡ æ¨¡å‹è¯„ä¼°æ–¹æ³• æ³›åŒ–èƒ½åŠ› è¿‡æ‹Ÿåˆã€æ¬ æ‹Ÿåˆ è¶…å‚æ•°è°ƒä¼˜ æœ¬æ–‡ä¼šé¦–å…ˆä»‹ç»æ€§èƒ½åº¦é‡æ–¹é¢çš„å†…å®¹ï¼Œä¸»è¦æ˜¯åˆ†ç±»é—®é¢˜å’Œå›å½’é—®é¢˜çš„æ€§èƒ½æŒ‡æ ‡ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•çš„ä»‹ç»ï¼š\nå‡†ç¡®ç‡å’Œé”™è¯¯ç‡ ç²¾ç¡®ç‡ã€å¬å›ç‡ä»¥åŠ F1 ROC æ›²çº¿ å’Œ AUC ä»£ä»·çŸ©é˜µ å›å½’é—®é¢˜çš„æ€§èƒ½åº¦é‡ å…¶ä»–è¯„ä»·æŒ‡æ ‡ï¼Œå¦‚è®¡ç®—é€Ÿåº¦ã€é²æ£’æ€§ç­‰ 1. æ€§èƒ½åº¦é‡ æ€§èƒ½åº¦é‡å°±æ˜¯æŒ‡å¯¹æ¨¡å‹æ³›åŒ–èƒ½åŠ›è¡¡é‡çš„è¯„ä»·æ ‡å‡†ã€‚\n1.1 å‡†ç¡®ç‡å’Œé”™è¯¯ç‡ åˆ†ç±»é—®é¢˜ä¸­æœ€å¸¸ç”¨çš„ä¸¤ä¸ªæ€§èƒ½åº¦é‡æ ‡å‡†\u0026ndash; å‡†ç¡®ç‡å’Œé”™è¯¯ç‡ã€‚\nå‡†ç¡®ç‡ï¼š æŒ‡çš„æ˜¯åˆ†ç±»æ­£ç¡®çš„æ ·æœ¬æ•°é‡å æ ·æœ¬æ€»æ•°çš„æ¯”ä¾‹ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\né”™è¯¯ç‡ï¼šæŒ‡åˆ†ç±»é”™è¯¯çš„æ ·æœ¬å æ ·æœ¬æ€»æ•°çš„æ¯”ä¾‹ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\né”™è¯¯ç‡ä¹Ÿæ˜¯æŸå¤±å‡½æ•°ä¸º 0-1 æŸå¤±æ—¶çš„è¯¯å·®ã€‚\nè¿™ä¸¤ç§è¯„ä»·æ ‡å‡†æ˜¯åˆ†ç±»é—®é¢˜ä¸­æœ€ç®€å•ä¹Ÿæ˜¯æœ€ç›´è§‚çš„è¯„ä»·æŒ‡æ ‡ã€‚ä½†å®ƒä»¬éƒ½å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ç±»åˆ«ä¸å¹³è¡¡çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬éƒ½æ— æ³•æœ‰æ•ˆè¯„ä»·æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚å³å¦‚æœæ­¤æ—¶æœ‰ 99% çš„è´Ÿæ ·æœ¬ï¼Œé‚£ä¹ˆæ¨¡å‹é¢„æµ‹æ‰€æœ‰æ ·æœ¬éƒ½æ˜¯è´Ÿæ ·æœ¬çš„æ—¶å€™ï¼Œå¯ä»¥å¾—åˆ° 99% çš„å‡†ç¡®ç‡ã€‚\nè¿™ç§æƒ…å†µå°±æ˜¯åœ¨ç±»åˆ«ä¸å¹³è¡¡çš„æ—¶å€™ï¼Œå æ¯”å¤§çš„ç±»åˆ«å¾€å¾€æˆä¸ºå½±å“å‡†ç¡®ç‡çš„æœ€ä¸»è¦å› ç´ ï¼\nè¿™ç§æ—¶å€™ï¼Œå…¶ä¸­ä¸€ç§è§£å†³æ–¹æ³•å°±æ˜¯æ›´æ¢è¯„ä»·æŒ‡æ ‡ï¼Œæ¯”å¦‚é‡‡ç”¨æ›´ä¸ºæœ‰æ•ˆçš„å¹³å‡å‡†ç¡®ç‡(æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬å‡†ç¡®ç‡çš„ç®—æœ¯å¹³å‡)ï¼Œå³ï¼š\nå…¶ä¸­ m æ˜¯ç±»åˆ«çš„æ•°é‡ã€‚\nå¯¹äºå‡†ç¡®ç‡å’Œé”™è¯¯ç‡ï¼Œç”¨ Python ä»£ç å®ç°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n1 2 3 4 5 6 def accuracy(y_true,y_pred): return sum(y==y_p for y,y_p in zip(y_true,y_pred))/len(y_true def error(y_true, y_pred): return sum(y != y_p for y, y_p in zip(y_true, y_pred)) / len(y_true) ä¸€ä¸ªç®€å•çš„äºŒåˆ†ç±»æµ‹è¯•æ ·ä¾‹ï¼š","title":"å¦‚ä½•è¯„ä»·æ¨¡å‹å¥½å"},{"content":"ç®€ä»‹ å¸¸ç”¨çš„Normalizationæ–¹æ³•ä¸»è¦æœ‰ï¼šBatch Normalizationï¼ˆBNï¼Œ2015å¹´ï¼‰ã€Layer Normalizationï¼ˆLNï¼Œ2016å¹´ï¼‰ã€Instance Normalizationï¼ˆINï¼Œ2017å¹´ï¼‰ã€Group Normalizationï¼ˆGNï¼Œ2018å¹´ï¼‰ã€‚å®ƒä»¬éƒ½æ˜¯ä»æ¿€æ´»å‡½æ•°çš„è¾“å…¥æ¥è€ƒè™‘ã€åšæ–‡ç« çš„ï¼Œä»¥ä¸åŒçš„æ–¹å¼å¯¹æ¿€æ´»å‡½æ•°çš„è¾“å…¥è¿›è¡Œ Norm çš„ã€‚\næˆ‘ä»¬å°†è¾“å…¥çš„ feature map shape è®°ä¸º**[N, C, H, W]**ï¼Œå…¶ä¸­Nè¡¨ç¤ºbatch sizeï¼Œå³Nä¸ªæ ·æœ¬ï¼›Cè¡¨ç¤ºé€šé“æ•°ï¼›Hã€Wåˆ†åˆ«è¡¨ç¤ºç‰¹å¾å›¾çš„é«˜åº¦ã€å®½åº¦ã€‚è¿™å‡ ä¸ªæ–¹æ³•ä¸»è¦çš„åŒºåˆ«å°±æ˜¯åœ¨ï¼š\nBNæ˜¯åœ¨batchä¸Šï¼Œå¯¹Nã€Hã€Wåšå½’ä¸€åŒ–ï¼Œè€Œä¿ç•™é€šé“ C çš„ç»´åº¦ã€‚BNå¯¹è¾ƒå°çš„batch sizeæ•ˆæœä¸å¥½ã€‚BNé€‚ç”¨äºå›ºå®šæ·±åº¦çš„å‰å‘ç¥ç»ç½‘ç»œï¼Œå¦‚CNNï¼Œä¸é€‚ç”¨äºRNNï¼›\nLNåœ¨é€šé“æ–¹å‘ä¸Šï¼Œå¯¹Cã€Hã€Wå½’ä¸€åŒ–ï¼Œä¸»è¦å¯¹RNNæ•ˆæœæ˜æ˜¾ï¼›\nINåœ¨å›¾åƒåƒç´ ä¸Šï¼Œå¯¹Hã€Wåšå½’ä¸€åŒ–ï¼Œç”¨åœ¨é£æ ¼åŒ–è¿ç§»ï¼›\nGNå°†channelåˆ†ç»„ï¼Œç„¶åå†åšå½’ä¸€åŒ–ã€‚\næ¯ä¸ªå­å›¾è¡¨ç¤ºä¸€ä¸ªç‰¹å¾å›¾ï¼Œå…¶ä¸­Nä¸ºæ‰¹é‡ï¼ŒCä¸ºé€šé“ï¼Œï¼ˆHï¼ŒWï¼‰ä¸ºç‰¹å¾å›¾çš„é«˜åº¦å’Œå®½åº¦ã€‚é€šè¿‡è“è‰²éƒ¨åˆ†çš„å€¼æ¥è®¡ç®—å‡å€¼å’Œæ–¹å·®ï¼Œä»è€Œè¿›è¡Œå½’ä¸€åŒ–ã€‚\nå¦‚æœæŠŠç‰¹å¾å›¾æ¯”å–»æˆä¸€æ‘ä¹¦ï¼Œè¿™æ‘ä¹¦æ€»å…±æœ‰ N æœ¬ï¼Œæ¯æœ¬æœ‰ C é¡µï¼Œæ¯é¡µæœ‰ H è¡Œï¼Œæ¯è¡Œ æœ‰W ä¸ªå­—ç¬¦ã€‚\nBN æ±‚å‡å€¼æ—¶ï¼Œç›¸å½“äºæŠŠè¿™äº›ä¹¦æŒ‰é¡µç ä¸€ä¸€å¯¹åº”åœ°åŠ èµ·æ¥ï¼ˆä¾‹å¦‚ç¬¬1æœ¬ä¹¦ç¬¬36é¡µï¼Œç¬¬2æœ¬ä¹¦ç¬¬36é¡µ\u0026hellip;\u0026hellip;ï¼‰ï¼Œå†é™¤ä»¥æ¯ä¸ªé¡µç ä¸‹çš„å­—ç¬¦æ€»æ•°ï¼šNÃ—HÃ—Wï¼Œå› æ­¤å¯ä»¥æŠŠ BN çœ‹æˆæ±‚â€œå¹³å‡ä¹¦â€çš„æ“ä½œï¼ˆæ³¨æ„è¿™ä¸ªâ€œå¹³å‡ä¹¦â€æ¯é¡µåªæœ‰ä¸€ä¸ªå­—ï¼‰ï¼Œæ±‚æ ‡å‡†å·®æ—¶ä¹Ÿæ˜¯åŒç†ã€‚\nLN æ±‚å‡å€¼æ—¶ï¼Œç›¸å½“äºæŠŠæ¯ä¸€æœ¬ä¹¦çš„æ‰€æœ‰å­—åŠ èµ·æ¥ï¼Œå†é™¤ä»¥è¿™æœ¬ä¹¦çš„å­—ç¬¦æ€»æ•°ï¼šCÃ—HÃ—Wï¼Œå³æ±‚æ•´æœ¬ä¹¦çš„â€œå¹³å‡å­—â€ï¼Œæ±‚æ ‡å‡†å·®æ—¶ä¹Ÿæ˜¯åŒç†ã€‚\nIN æ±‚å‡å€¼æ—¶ï¼Œç›¸å½“äºæŠŠä¸€é¡µä¹¦ä¸­æ‰€æœ‰å­—åŠ èµ·æ¥ï¼Œå†é™¤ä»¥è¯¥é¡µçš„æ€»å­—æ•°ï¼šHÃ—Wï¼Œå³æ±‚æ¯é¡µä¹¦çš„â€œå¹³å‡å­—â€ï¼Œæ±‚æ ‡å‡†å·®æ—¶ä¹Ÿæ˜¯åŒç†ã€‚\nGN ç›¸å½“äºæŠŠä¸€æœ¬ C é¡µçš„ä¹¦å¹³å‡åˆ†æˆ G ä»½ï¼Œæ¯ä»½æˆä¸ºæœ‰ C/G é¡µçš„å°å†Œå­ï¼Œæ±‚æ¯ä¸ªå°å†Œå­çš„â€œå¹³å‡å­—â€å’Œå­—çš„â€œæ ‡å‡†å·®â€ã€‚\nå‚è€ƒ:\nhttps://mp.weixin.qq.com/s/dDMPBYjPeilivSA8J8W7lA https://zhuanlan.zhihu.com/p/72589565 ","permalink":"https://reid00.github.io/en/posts/ml/%E5%B8%B8%E7%94%A8normalization%E6%96%B9%E6%B3%95%E7%9A%84%E6%80%BB%E7%BB%93%E4%B8%8E%E6%80%9D%E8%80%83/","summary":"ç®€ä»‹ å¸¸ç”¨çš„Normalizationæ–¹æ³•ä¸»è¦æœ‰ï¼šBatch Normalizationï¼ˆBNï¼Œ2015å¹´ï¼‰ã€Layer Normalizationï¼ˆLNï¼Œ2016å¹´ï¼‰ã€Instance Normalizationï¼ˆINï¼Œ2017å¹´ï¼‰ã€Group Normalizationï¼ˆGNï¼Œ2018å¹´ï¼‰ã€‚å®ƒä»¬éƒ½æ˜¯ä»æ¿€æ´»å‡½æ•°çš„è¾“å…¥æ¥è€ƒè™‘ã€åšæ–‡ç« çš„ï¼Œä»¥ä¸åŒçš„æ–¹å¼å¯¹æ¿€æ´»å‡½æ•°çš„è¾“å…¥è¿›è¡Œ Norm çš„ã€‚\næˆ‘ä»¬å°†è¾“å…¥çš„ feature map shape è®°ä¸º**[N, C, H, W]**ï¼Œå…¶ä¸­Nè¡¨ç¤ºbatch sizeï¼Œå³Nä¸ªæ ·æœ¬ï¼›Cè¡¨ç¤ºé€šé“æ•°ï¼›Hã€Wåˆ†åˆ«è¡¨ç¤ºç‰¹å¾å›¾çš„é«˜åº¦ã€å®½åº¦ã€‚è¿™å‡ ä¸ªæ–¹æ³•ä¸»è¦çš„åŒºåˆ«å°±æ˜¯åœ¨ï¼š\nBNæ˜¯åœ¨batchä¸Šï¼Œå¯¹Nã€Hã€Wåšå½’ä¸€åŒ–ï¼Œè€Œä¿ç•™é€šé“ C çš„ç»´åº¦ã€‚BNå¯¹è¾ƒå°çš„batch sizeæ•ˆæœä¸å¥½ã€‚BNé€‚ç”¨äºå›ºå®šæ·±åº¦çš„å‰å‘ç¥ç»ç½‘ç»œï¼Œå¦‚CNNï¼Œä¸é€‚ç”¨äºRNNï¼›\nLNåœ¨é€šé“æ–¹å‘ä¸Šï¼Œå¯¹Cã€Hã€Wå½’ä¸€åŒ–ï¼Œä¸»è¦å¯¹RNNæ•ˆæœæ˜æ˜¾ï¼›\nINåœ¨å›¾åƒåƒç´ ä¸Šï¼Œå¯¹Hã€Wåšå½’ä¸€åŒ–ï¼Œç”¨åœ¨é£æ ¼åŒ–è¿ç§»ï¼›\nGNå°†channelåˆ†ç»„ï¼Œç„¶åå†åšå½’ä¸€åŒ–ã€‚\næ¯ä¸ªå­å›¾è¡¨ç¤ºä¸€ä¸ªç‰¹å¾å›¾ï¼Œå…¶ä¸­Nä¸ºæ‰¹é‡ï¼ŒCä¸ºé€šé“ï¼Œï¼ˆHï¼ŒWï¼‰ä¸ºç‰¹å¾å›¾çš„é«˜åº¦å’Œå®½åº¦ã€‚é€šè¿‡è“è‰²éƒ¨åˆ†çš„å€¼æ¥è®¡ç®—å‡å€¼å’Œæ–¹å·®ï¼Œä»è€Œè¿›è¡Œå½’ä¸€åŒ–ã€‚\nå¦‚æœæŠŠç‰¹å¾å›¾æ¯”å–»æˆä¸€æ‘ä¹¦ï¼Œè¿™æ‘ä¹¦æ€»å…±æœ‰ N æœ¬ï¼Œæ¯æœ¬æœ‰ C é¡µï¼Œæ¯é¡µæœ‰ H è¡Œï¼Œæ¯è¡Œ æœ‰W ä¸ªå­—ç¬¦ã€‚\nBN æ±‚å‡å€¼æ—¶ï¼Œç›¸å½“äºæŠŠè¿™äº›ä¹¦æŒ‰é¡µç ä¸€ä¸€å¯¹åº”åœ°åŠ èµ·æ¥ï¼ˆä¾‹å¦‚ç¬¬1æœ¬ä¹¦ç¬¬36é¡µï¼Œç¬¬2æœ¬ä¹¦ç¬¬36é¡µ\u0026hellip;\u0026hellip;ï¼‰ï¼Œå†é™¤ä»¥æ¯ä¸ªé¡µç ä¸‹çš„å­—ç¬¦æ€»æ•°ï¼šNÃ—HÃ—Wï¼Œå› æ­¤å¯ä»¥æŠŠ BN çœ‹æˆæ±‚â€œå¹³å‡ä¹¦â€çš„æ“ä½œï¼ˆæ³¨æ„è¿™ä¸ªâ€œå¹³å‡ä¹¦â€æ¯é¡µåªæœ‰ä¸€ä¸ªå­—ï¼‰ï¼Œæ±‚æ ‡å‡†å·®æ—¶ä¹Ÿæ˜¯åŒç†ã€‚\nLN æ±‚å‡å€¼æ—¶ï¼Œç›¸å½“äºæŠŠæ¯ä¸€æœ¬ä¹¦çš„æ‰€æœ‰å­—åŠ èµ·æ¥ï¼Œå†é™¤ä»¥è¿™æœ¬ä¹¦çš„å­—ç¬¦æ€»æ•°ï¼šCÃ—HÃ—Wï¼Œå³æ±‚æ•´æœ¬ä¹¦çš„â€œå¹³å‡å­—â€ï¼Œæ±‚æ ‡å‡†å·®æ—¶ä¹Ÿæ˜¯åŒç†ã€‚\nIN æ±‚å‡å€¼æ—¶ï¼Œç›¸å½“äºæŠŠä¸€é¡µä¹¦ä¸­æ‰€æœ‰å­—åŠ èµ·æ¥ï¼Œå†é™¤ä»¥è¯¥é¡µçš„æ€»å­—æ•°ï¼šHÃ—Wï¼Œå³æ±‚æ¯é¡µä¹¦çš„â€œå¹³å‡å­—â€ï¼Œæ±‚æ ‡å‡†å·®æ—¶ä¹Ÿæ˜¯åŒç†ã€‚\nGN ç›¸å½“äºæŠŠä¸€æœ¬ C é¡µçš„ä¹¦å¹³å‡åˆ†æˆ G ä»½ï¼Œæ¯ä»½æˆä¸ºæœ‰ C/G é¡µçš„å°å†Œå­ï¼Œæ±‚æ¯ä¸ªå°å†Œå­çš„â€œå¹³å‡å­—â€å’Œå­—çš„â€œæ ‡å‡†å·®â€ã€‚\nå‚è€ƒ:\nhttps://mp.weixin.qq.com/s/dDMPBYjPeilivSA8J8W7lA https://zhuanlan.zhihu.com/p/72589565 ","title":"å¸¸ç”¨Normalizationæ–¹æ³•çš„æ€»ç»“ä¸æ€è€ƒ"},{"content":"1. SVM SVMçš„åº”ç”¨ SVMåœ¨å¾ˆå¤šè¯¸å¦‚æ–‡æœ¬åˆ†ç±»ï¼Œå›¾åƒåˆ†ç±»ï¼Œç”Ÿç‰©åºåˆ—åˆ†æå’Œç”Ÿç‰©æ•°æ®æŒ–æ˜ï¼Œæ‰‹å†™å­—ç¬¦è¯†åˆ«ç­‰é¢†åŸŸæœ‰å¾ˆå¤šçš„åº”ç”¨ï¼Œä½†æˆ–è®¸ä½ å¹¶æ²¡å¼ºçƒˆçš„æ„è¯†åˆ°ï¼ŒSVMå¯ä»¥æˆåŠŸåº”ç”¨çš„é¢†åŸŸè¿œè¿œè¶…å‡ºç°åœ¨å·²ç»åœ¨å¼€å‘åº”ç”¨äº†çš„é¢†åŸŸã€‚\né€šå¸¸äººä»¬ä¼šä»ä¸€äº›å¸¸ç”¨çš„æ ¸å‡½æ•°ä¸­é€‰æ‹©ï¼ˆæ ¹æ®é—®é¢˜å’Œæ•°æ®çš„ä¸åŒï¼Œé€‰æ‹©ä¸åŒçš„å‚æ•°ï¼Œå®é™…ä¸Šå°±æ˜¯å¾—åˆ°äº†ä¸åŒçš„æ ¸å‡½æ•°ï¼‰ï¼Œä¾‹å¦‚ï¼šå¤šé¡¹å¼æ ¸ã€é«˜æ–¯æ ¸ã€çº¿æ€§æ ¸ã€‚\nSVMæ˜¯ä¸€ç§äºŒç±»åˆ†ç±»æ¨¡å‹ã€‚å®ƒçš„åŸºæœ¬æ¨¡å‹æ˜¯åœ¨ç‰¹å¾ç©ºé—´ä¸­å¯»æ‰¾é—´éš”æœ€å¤§åŒ–çš„åˆ†ç¦»è¶…å¹³é¢çš„çº¿æ€§åˆ†ç±»å™¨ã€‚ï¼ˆé—´éš”æœ€å¤§æ˜¯å®ƒæœ‰åˆ«äºæ„ŸçŸ¥æœºï¼‰\nï¼ˆ1ï¼‰å½“è®­ç»ƒæ ·æœ¬çº¿æ€§å¯åˆ†æ—¶ï¼Œé€šè¿‡ç¡¬é—´éš”æœ€å¤§åŒ–ï¼Œå­¦ä¹ ä¸€ä¸ªçº¿æ€§åˆ†ç±»å™¨ï¼Œå³çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœºï¼›\nï¼ˆ2ï¼‰å½“è®­ç»ƒæ•°æ®è¿‘ä¼¼çº¿æ€§å¯åˆ†æ—¶ï¼Œå¼•å…¥æ¾å¼›å˜é‡ï¼Œé€šè¿‡è½¯é—´éš”æœ€å¤§åŒ–ï¼Œå­¦ä¹ ä¸€ä¸ªçº¿æ€§åˆ†ç±»å™¨ï¼Œå³çº¿æ€§æ”¯æŒå‘é‡æœºï¼›\nï¼ˆ3ï¼‰å½“è®­ç»ƒæ•°æ®çº¿æ€§ä¸å¯åˆ†æ—¶ï¼Œé€šè¿‡ä½¿ç”¨æ ¸æŠ€å·§åŠè½¯é—´éš”æœ€å¤§åŒ–ï¼Œå­¦ä¹ éçº¿æ€§æ”¯æŒå‘é‡æœºã€‚\næ³¨ï¼šä»¥ä¸Šå„SVMçš„æ•°å­¦æ¨å¯¼åº”è¯¥ç†Ÿæ‚‰ï¼šç¡¬é—´éš”æœ€å¤§åŒ–ï¼ˆå‡ ä½•é—´éš”ï¼‰\u0026mdash;å­¦ä¹ çš„å¯¹å¶é—®é¢˜\u0026mdash;è½¯é—´éš”æœ€å¤§åŒ–ï¼ˆå¼•å…¥æ¾å¼›å˜é‡ï¼‰\u0026mdash;éçº¿æ€§æ”¯æŒå‘é‡æœºï¼ˆæ ¸æŠ€å·§ï¼‰ã€‚\nè¯»è€…å¯èƒ½è¿˜æ˜¯æ²¡æ˜ç™½æ ¸å‡½æ•°åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Ÿæˆ‘å†ç®€è¦æ¦‚æ‹¬ä¸‹ï¼Œå³ä»¥ä¸‹ä¸‰ç‚¹ï¼š\nå®é™…ä¸­ï¼Œæˆ‘ä»¬ä¼šç»å¸¸é‡åˆ°çº¿æ€§ä¸å¯åˆ†çš„æ ·ä¾‹ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬çš„å¸¸ç”¨åšæ³•æ˜¯æŠŠæ ·ä¾‹ç‰¹å¾æ˜ å°„åˆ°é«˜ç»´ç©ºé—´ä¸­å»(æ˜ å°„åˆ°é«˜ç»´ç©ºé—´åï¼Œç›¸å…³ç‰¹å¾ä¾¿è¢«åˆ†å¼€äº†ï¼Œä¹Ÿå°±è¾¾åˆ°äº†åˆ†ç±»çš„ç›®çš„)ï¼› ä½†è¿›ä¸€æ­¥ï¼Œå¦‚æœå‡¡æ˜¯é‡åˆ°çº¿æ€§ä¸å¯åˆ†çš„æ ·ä¾‹ï¼Œä¸€å¾‹æ˜ å°„åˆ°é«˜ç»´ç©ºé—´ï¼Œé‚£ä¹ˆè¿™ä¸ªç»´åº¦å¤§å°æ˜¯ä¼šé«˜åˆ°å¯æ€•çš„ã€‚é‚£å’‹åŠå‘¢ï¼Ÿ æ­¤æ—¶ï¼Œæ ¸å‡½æ•°å°±éš†é‡ç™»åœºäº†ï¼Œæ ¸å‡½æ•°çš„ä»·å€¼åœ¨äºå®ƒè™½ç„¶ä¹Ÿæ˜¯å°†ç‰¹å¾è¿›è¡Œä»ä½ç»´åˆ°é«˜ç»´çš„è½¬æ¢ï¼Œä½†æ ¸å‡½æ•°ç»å°±ç»åœ¨å®ƒäº‹å…ˆåœ¨ä½ç»´ä¸Šè¿›è¡Œè®¡ç®—ï¼Œè€Œå°†å®è´¨ä¸Šçš„åˆ†ç±»æ•ˆæœè¡¨ç°åœ¨äº†é«˜ç»´ä¸Šï¼Œé¿å…äº†ç›´æ¥åœ¨é«˜ç»´ç©ºé—´ä¸­çš„å¤æ‚è®¡ç®— 2. SVMçš„ä¸€äº›é—®é¢˜ SVMä¸ºä»€ä¹ˆé‡‡ç”¨é—´éš”æœ€å¤§åŒ–ï¼Ÿ å½“è®­ç»ƒæ•°æ®çº¿æ€§å¯åˆ†æ—¶ï¼Œå­˜åœ¨æ— ç©·ä¸ªåˆ†ç¦»è¶…å¹³é¢å¯ä»¥å°†ä¸¤ç±»æ•°æ®æ­£ç¡®åˆ†å¼€ã€‚\næ„ŸçŸ¥æœºåˆ©ç”¨è¯¯åˆ†ç±»æœ€å°ç­–ç•¥ï¼Œæ±‚å¾—åˆ†ç¦»è¶…å¹³é¢ï¼Œä¸è¿‡æ­¤æ—¶çš„è§£æœ‰æ— ç©·å¤šä¸ªã€‚\nçº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœºåˆ©ç”¨é—´éš”æœ€å¤§åŒ–æ±‚å¾—æœ€ä¼˜åˆ†ç¦»è¶…å¹³é¢ï¼Œè¿™æ—¶ï¼Œè§£æ˜¯å”¯ä¸€çš„ã€‚å¦ä¸€æ–¹é¢ï¼Œæ­¤æ—¶çš„åˆ†éš”è¶…å¹³é¢æ‰€äº§ç”Ÿçš„åˆ†ç±»ç»“æœæ˜¯æœ€é²æ£’çš„ï¼Œå¯¹æœªçŸ¥å®ä¾‹çš„æ³›åŒ–èƒ½åŠ›æœ€å¼ºã€‚\nç„¶ååº”è¯¥å€Ÿæ­¤é˜è¿°ï¼Œå‡ ä½•é—´éš”ï¼Œå‡½æ•°é—´éš”ï¼ŒåŠä»å‡½æ•°é—´éš”â€”\u0026gt;æ±‚è§£æœ€å°åŒ–1/2 ||w||^2 æ—¶çš„wå’Œbã€‚å³çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœºå­¦ä¹ ç®—æ³•â€”æœ€å¤§é—´éš”æ³•çš„ç”±æ¥ã€‚\nSVMå¦‚ä½•å¤„ç†å¤šåˆ†ç±»é—®é¢˜ï¼Ÿ** ä¸€èˆ¬æœ‰ä¸¤ç§åšæ³•ï¼šä¸€ç§æ˜¯ç›´æ¥æ³•ï¼Œç›´æ¥åœ¨ç›®æ ‡å‡½æ•°ä¸Šä¿®æ”¹ï¼Œå°†å¤šä¸ªåˆ†ç±»é¢çš„å‚æ•°æ±‚è§£åˆå¹¶åˆ°ä¸€ä¸ªæœ€ä¼˜åŒ–é—®é¢˜é‡Œé¢ã€‚çœ‹ä¼¼ç®€å•ä½†æ˜¯è®¡ç®—é‡å´éå¸¸çš„å¤§ã€‚\nå¦å¤–ä¸€ç§åšæ³•æ˜¯é—´æ¥æ³•ï¼šå¯¹è®­ç»ƒå™¨è¿›è¡Œç»„åˆã€‚å…¶ä¸­æ¯”è¾ƒå…¸å‹çš„æœ‰ä¸€å¯¹ä¸€ï¼Œå’Œä¸€å¯¹å¤šã€‚\nä¸€å¯¹å¤šï¼Œå°±æ˜¯å¯¹æ¯ä¸ªç±»éƒ½è®­ç»ƒå‡ºä¸€ä¸ªåˆ†ç±»å™¨ï¼Œç”±svmæ˜¯äºŒåˆ†ç±»ï¼Œæ‰€ä»¥å°†æ­¤è€Œåˆ†ç±»å™¨çš„ä¸¤ç±»è®¾å®šä¸ºç›®æ ‡ç±»ä¸ºä¸€ç±»ï¼Œå…¶ä½™ç±»ä¸ºå¦å¤–ä¸€ç±»ã€‚è¿™æ ·é’ˆå¯¹kä¸ªç±»å¯ä»¥è®­ç»ƒå‡ºkä¸ªåˆ†ç±»å™¨ï¼Œå½“æœ‰ä¸€ä¸ªæ–°çš„æ ·æœ¬æ¥çš„æ—¶å€™ï¼Œç”¨è¿™kä¸ªåˆ†ç±»å™¨æ¥æµ‹è¯•ï¼Œé‚£ä¸ªåˆ†ç±»å™¨çš„æ¦‚ç‡é«˜ï¼Œé‚£ä¹ˆè¿™ä¸ªæ ·æœ¬å°±å±äºå“ªä¸€ç±»ã€‚è¿™ç§æ–¹æ³•æ•ˆæœä¸å¤ªå¥½ï¼Œbiasæ¯”è¾ƒé«˜ã€‚\nsvmä¸€å¯¹ä¸€æ³•ï¼ˆone-vs-oneï¼‰ï¼Œé’ˆå¯¹ä»»æ„ä¸¤ä¸ªç±»è®­ç»ƒå‡ºä¸€ä¸ªåˆ†ç±»å™¨ï¼Œå¦‚æœæœ‰kç±»ï¼Œä¸€å…±è®­ç»ƒå‡ºC(2,k) ä¸ªåˆ†ç±»å™¨ï¼Œè¿™æ ·å½“æœ‰ä¸€ä¸ªæ–°çš„æ ·æœ¬è¦æ¥çš„æ—¶å€™ï¼Œç”¨è¿™C(2,k) ä¸ªåˆ†ç±»å™¨æ¥æµ‹è¯•ï¼Œæ¯å½“è¢«åˆ¤å®šå±äºæŸä¸€ç±»çš„æ—¶å€™ï¼Œè¯¥ç±»å°±åŠ ä¸€ï¼Œæœ€åç¥¨æ•°æœ€å¤šçš„ç±»åˆ«è¢«è®¤å®šä¸ºè¯¥æ ·æœ¬çš„ç±»ã€‚\næ˜¯å¦å­˜åœ¨ä¸€ç»„å‚æ•°ä½¿SVMè®­ç»ƒè¯¯å·®ä¸º0ï¼Ÿ Y\nè®­ç»ƒè¯¯å·®ä¸º0çš„SVMåˆ†ç±»å™¨ä¸€å®šå­˜åœ¨å—ï¼Ÿ ä¸€å®šå­˜åœ¨\nåŠ å…¥æ¾å¼›å˜é‡çš„SVMçš„è®­ç»ƒè¯¯å·®å¯ä»¥ä¸º0å—ï¼Ÿ å¦‚æœæ•°æ®ä¸­å‡ºç°äº†ç¦»ç¾¤ç‚¹outliersï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨æ¾å¼›å˜é‡æ¥è§£å†³ã€‚\nä½¿ç”¨SMOç®—æ³•è®­ç»ƒçš„çº¿æ€§åˆ†ç±»å™¨å¹¶ä¸ä¸€å®šèƒ½å¾—åˆ°è®­ç»ƒè¯¯å·®ä¸º0çš„æ¨¡å‹ã€‚è¿™æ˜¯ç”± äºæˆ‘ä»¬çš„ä¼˜åŒ–ç›®æ ‡æ”¹å˜äº†ï¼Œå¹¶ä¸å†æ˜¯ä½¿è®­ç»ƒè¯¯å·®æœ€å°ã€‚\nå¸¦æ ¸çš„SVMä¸ºä»€ä¹ˆèƒ½åˆ†ç±»éçº¿æ€§é—®é¢˜? æ ¸å‡½æ•°çš„æœ¬è´¨æ˜¯ä¸¤ä¸ªå‡½æ•°çš„å…§ç§¯ï¼Œé€šè¿‡æ ¸å‡½æ•°å°†å…¶éšå°„åˆ°é«˜ç»´ç©ºé—´ï¼Œåœ¨é«˜ç»´ç©ºé—´éçº¿æ€§é—®é¢˜è½¬åŒ–ä¸ºçº¿æ€§é—®é¢˜, SVMå¾—åˆ°è¶…å¹³é¢æ˜¯é«˜ç»´ç©ºé—´çš„çº¿æ€§åˆ†ç±»å¹³é¢ã€‚å…¶åˆ†ç±»ç»“æœä¹Ÿè§†ä¸ºä½ç»´ç©ºé—´çš„éçº¿æ€§åˆ†ç±»ç»“æœ, å› è€Œå¸¦æ ¸çš„SVMå°±èƒ½åˆ†ç±»éçº¿æ€§é—®é¢˜ã€‚\nå¦‚ä½•é€‰æ‹©æ ¸å‡½æ•°ï¼Ÿ å¦‚æœç‰¹å¾çš„æ•°é‡å¤§åˆ°å’Œæ ·æœ¬æ•°é‡å·®ä¸å¤šï¼Œåˆ™é€‰ç”¨LRæˆ–è€…çº¿æ€§æ ¸çš„SVMï¼› å¦‚æœç‰¹å¾çš„æ•°é‡å°ï¼Œæ ·æœ¬çš„æ•°é‡æ­£å¸¸ï¼Œåˆ™é€‰ç”¨SVM+é«˜æ–¯æ ¸å‡½æ•°ï¼› å¦‚æœç‰¹å¾çš„æ•°é‡å°ï¼Œè€Œæ ·æœ¬çš„æ•°é‡å¾ˆå¤§ï¼Œåˆ™éœ€è¦æ‰‹å·¥æ·»åŠ ä¸€äº›ç‰¹å¾ä»è€Œå˜æˆç¬¬ä¸€ç§æƒ…å†µã€‚ 3. LRå’ŒSVMçš„è”ç³»ä¸åŒºåˆ« ç›¸åŒç‚¹ éƒ½æ˜¯çº¿æ€§åˆ†ç±»å™¨ã€‚æœ¬è´¨ä¸Šéƒ½æ˜¯æ±‚ä¸€ä¸ªæœ€ä½³åˆ†ç±»è¶…å¹³é¢ã€‚\néƒ½æ˜¯ç›‘ç£å­¦ä¹ ç®—æ³•\néƒ½æ˜¯åˆ¤åˆ«æ¨¡å‹ã€‚åˆ¤åˆ«æ¨¡å‹ä¸å…³å¿ƒæ•°æ®æ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼Œå®ƒåªå…³å¿ƒä¿¡å·ä¹‹é—´çš„å·®åˆ«ï¼Œç„¶åç”¨å·®åˆ«æ¥ç®€å•å¯¹ç»™å®šçš„ä¸€ä¸ªä¿¡å·è¿›è¡Œåˆ†ç±»ã€‚å¸¸è§çš„åˆ¤åˆ«æ¨¡å‹æœ‰ï¼šKNNã€SVMã€LRï¼Œå¸¸è§çš„ç”Ÿæˆæ¨¡å‹æœ‰ï¼šæœ´ç´ è´å¶æ–¯ï¼Œéšé©¬å°”å¯å¤«æ¨¡å‹ã€‚\nä¸åŒç‚¹ LRæ˜¯å‚æ•°æ¨¡å‹ï¼Œsvmæ˜¯éå‚æ•°æ¨¡å‹ï¼Œlinearå’Œrbfåˆ™æ˜¯é’ˆå¯¹æ•°æ®çº¿æ€§å¯åˆ†å’Œä¸å¯åˆ†çš„åŒºåˆ«\nä»ç›®æ ‡å‡½æ•°æ¥çœ‹ï¼ŒåŒºåˆ«åœ¨äºé€»è¾‘å›å½’é‡‡ç”¨çš„æ˜¯logistical lossï¼ŒSVMé‡‡ç”¨çš„æ˜¯hinge lossï¼Œè¿™ä¸¤ä¸ªæŸå¤±å‡½æ•°çš„ç›®çš„éƒ½æ˜¯å¢åŠ å¯¹åˆ†ç±»å½±å“è¾ƒå¤§çš„æ•°æ®ç‚¹çš„æƒé‡ï¼Œå‡å°‘ä¸åˆ†ç±»å…³ç³»è¾ƒå°çš„æ•°æ®ç‚¹çš„æƒé‡ã€‚\nSVMçš„å¤„ç†æ–¹æ³•æ˜¯åªè€ƒè™‘support vectorsï¼Œä¹Ÿå°±æ˜¯å’Œåˆ†ç±»æœ€ç›¸å…³çš„å°‘æ•°ç‚¹ï¼Œå»å­¦ä¹ åˆ†ç±»å™¨ã€‚è€Œé€»è¾‘å›å½’é€šè¿‡éçº¿æ€§æ˜ å°„ï¼Œå¤§å¤§å‡å°äº†ç¦»åˆ†ç±»å¹³é¢è¾ƒè¿œçš„ç‚¹çš„æƒé‡ï¼Œç›¸å¯¹æå‡äº†ä¸åˆ†ç±»æœ€ç›¸å…³çš„æ•°æ®ç‚¹çš„æƒé‡ã€‚\né€»è¾‘å›å½’ç›¸å¯¹æ¥è¯´æ¨¡å‹æ›´ç®€å•ï¼Œå¥½ç†è§£ï¼Œç‰¹åˆ«æ˜¯å¤§è§„æ¨¡çº¿æ€§åˆ†ç±»æ—¶æ¯”è¾ƒæ–¹ä¾¿ã€‚è€ŒSVMçš„ç†è§£å’Œä¼˜åŒ–ç›¸å¯¹æ¥è¯´å¤æ‚ä¸€äº›ï¼ŒSVMè½¬åŒ–ä¸ºå¯¹å¶é—®é¢˜å,åˆ†ç±»åªéœ€è¦è®¡ç®—ä¸å°‘æ•°å‡ ä¸ªæ”¯æŒå‘é‡çš„è·ç¦»,è¿™ä¸ªåœ¨è¿›è¡Œå¤æ‚æ ¸å‡½æ•°è®¡ç®—æ—¶ä¼˜åŠ¿å¾ˆæ˜æ˜¾,èƒ½å¤Ÿå¤§å¤§ç®€åŒ–æ¨¡å‹å’Œè®¡ç®—ã€‚\nlogic èƒ½åšçš„ svmèƒ½åšï¼Œä½†å¯èƒ½åœ¨å‡†ç¡®ç‡ä¸Šæœ‰é—®é¢˜ï¼Œsvmèƒ½åšçš„logicæœ‰çš„åšä¸äº†ã€‚\n4. çº¿æ€§åˆ†ç±»å™¨ä¸éçº¿æ€§åˆ†ç±»å™¨çš„åŒºåˆ«ä»¥åŠä¼˜åŠ£ çº¿æ€§å’Œéçº¿æ€§æ˜¯é’ˆå¯¹æ¨¡å‹å‚æ•°å’Œè¾“å…¥ç‰¹å¾æ¥è®²çš„ï¼›æ¯”å¦‚è¾“å…¥xï¼Œæ¨¡å‹y=ax+ax^2 é‚£ä¹ˆå°±æ˜¯éçº¿æ€§æ¨¡å‹ï¼Œå¦‚æœè¾“å…¥æ˜¯xå’ŒX^2åˆ™æ¨¡å‹æ˜¯çº¿æ€§çš„ã€‚\nçº¿æ€§åˆ†ç±»å™¨å¯è§£é‡Šæ€§å¥½ï¼Œè®¡ç®—å¤æ‚åº¦è¾ƒä½ï¼Œä¸è¶³ä¹‹å¤„æ˜¯æ¨¡å‹çš„æ‹Ÿåˆæ•ˆæœç›¸å¯¹å¼±äº›ã€‚\nLR,è´å¶æ–¯åˆ†ç±»ï¼Œå•å±‚æ„ŸçŸ¥æœºã€çº¿æ€§å›å½’\néçº¿æ€§åˆ†ç±»å™¨æ•ˆæœæ‹Ÿåˆèƒ½åŠ›è¾ƒå¼ºï¼Œä¸è¶³ä¹‹å¤„æ˜¯æ•°æ®é‡ä¸è¶³å®¹æ˜“è¿‡æ‹Ÿåˆã€è®¡ç®—å¤æ‚åº¦é«˜ã€å¯è§£é‡Šæ€§ä¸å¥½ã€‚\nå†³ç­–æ ‘ã€RFã€GBDTã€å¤šå±‚æ„ŸçŸ¥æœº\nSVMä¸¤ç§éƒ½æœ‰ï¼ˆçœ‹çº¿æ€§æ ¸è¿˜æ˜¯é«˜æ–¯æ ¸ å³RBF ï¼‰\nçº¿æ€§æ ¸ï¼šä¸»è¦ç”¨äºçº¿æ€§å¯åˆ†çš„æƒ…å½¢ï¼Œå‚æ•°å°‘ï¼Œé€Ÿåº¦å¿«ï¼Œå¯¹äºä¸€èˆ¬æ•°æ®ï¼Œåˆ†ç±»æ•ˆæœå·²ç»å¾ˆç†æƒ³äº†ã€‚\nRBF æ ¸ï¼šä¸»è¦ç”¨äºçº¿æ€§ä¸å¯åˆ†çš„æƒ…å½¢ï¼Œå‚æ•°å¤šï¼Œåˆ†ç±»ç»“æœéå¸¸ä¾èµ–äºå‚æ•°ã€‚æœ‰å¾ˆå¤šäººæ˜¯é€šè¿‡è®­ç»ƒæ•°æ®çš„äº¤å‰éªŒè¯æ¥å¯»æ‰¾åˆé€‚çš„å‚æ•°ï¼Œä¸è¿‡è¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒè€—æ—¶ã€‚ å¦‚æœ Feature çš„æ•°é‡å¾ˆå¤§ï¼Œè·Ÿæ ·æœ¬æ•°é‡å·®ä¸å¤šï¼Œè¿™æ—¶å€™é€‰ç”¨çº¿æ€§æ ¸çš„ SVMã€‚ å¦‚æœ Feature çš„æ•°é‡æ¯”è¾ƒå°ï¼Œæ ·æœ¬æ•°é‡ä¸€èˆ¬ï¼Œä¸ç®—å¤§ä¹Ÿä¸ç®—å°ï¼Œé€‰ç”¨é«˜æ–¯æ ¸çš„ SVMã€‚\n*ä¸ºä»€ä¹ˆè¦è½¬ä¸ºå¯¹å¶é—®é¢˜ï¼Ÿï¼ˆé˜¿é‡Œé¢è¯•ï¼‰*\n(a) ç›®å‰å¤„ç†çš„æ¨¡å‹ä¸¥é‡ä¾èµ–äºæ•°æ®é›†çš„ç»´åº¦dï¼Œå¦‚æœç»´åº¦då¤ªé«˜å°±ä¼šä¸¥é‡æå‡è¿ç®—æ—¶é—´ï¼›\n(b) å¯¹å¶é—®é¢˜äº‹å®ä¸ŠæŠŠSVMä»ä¾èµ–dä¸ªç»´åº¦è½¬å˜åˆ°ä¾èµ–Nä¸ªæ•°æ®ç‚¹ï¼Œè€ƒè™‘åˆ°åœ¨æœ€åè®¡ç®—æ—¶åªæœ‰æ”¯æŒå‘é‡æ‰æœ‰æ„ä¹‰ï¼Œæ‰€ä»¥è¿™ä¸ªè®¡ç®—é‡å®é™…ä¸Šæ¯”Nå°å¾ˆå¤šã€‚\nä¸€ã€æ˜¯å¯¹å¶é—®é¢˜å¾€å¾€æ›´æ˜“æ±‚è§£ï¼ˆå½“æˆ‘ä»¬å¯»æ‰¾çº¦æŸå­˜åœ¨æ—¶çš„æœ€ä¼˜ç‚¹çš„æ—¶å€™ï¼Œçº¦æŸçš„å­˜åœ¨è™½ç„¶å‡å°äº†éœ€è¦æœå¯»çš„èŒƒå›´ï¼Œä½†æ˜¯å´ä½¿é—®é¢˜å˜å¾—æ›´åŠ å¤æ‚ã€‚ä¸ºäº†ä½¿é—®é¢˜å˜å¾—æ˜“äºå¤„ç†ï¼Œæˆ‘ä»¬çš„æ–¹æ³•æ˜¯æŠŠç›®æ ‡å‡½æ•°å’Œçº¦æŸå…¨éƒ¨èå…¥ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œå³æ‹‰æ ¼æœ—æ—¥å‡½æ•°ï¼Œå†é€šè¿‡è¿™ä¸ªå‡½æ•°æ¥å¯»æ‰¾æœ€ä¼˜ç‚¹ã€‚ï¼‰\näºŒã€è‡ªç„¶å¼•å…¥æ ¸å‡½æ•°ï¼Œè¿›è€Œæ¨å¹¿åˆ°éçº¿æ€§åˆ†ç±»é—®é¢˜\nå‚è€ƒ: https://cloud.tencent.com/developer/article/1541701\n","permalink":"https://reid00.github.io/en/posts/ml/svm/","summary":"1. SVM SVMçš„åº”ç”¨ SVMåœ¨å¾ˆå¤šè¯¸å¦‚æ–‡æœ¬åˆ†ç±»ï¼Œå›¾åƒåˆ†ç±»ï¼Œç”Ÿç‰©åºåˆ—åˆ†æå’Œç”Ÿç‰©æ•°æ®æŒ–æ˜ï¼Œæ‰‹å†™å­—ç¬¦è¯†åˆ«ç­‰é¢†åŸŸæœ‰å¾ˆå¤šçš„åº”ç”¨ï¼Œä½†æˆ–è®¸ä½ å¹¶æ²¡å¼ºçƒˆçš„æ„è¯†åˆ°ï¼ŒSVMå¯ä»¥æˆåŠŸåº”ç”¨çš„é¢†åŸŸè¿œè¿œè¶…å‡ºç°åœ¨å·²ç»åœ¨å¼€å‘åº”ç”¨äº†çš„é¢†åŸŸã€‚\né€šå¸¸äººä»¬ä¼šä»ä¸€äº›å¸¸ç”¨çš„æ ¸å‡½æ•°ä¸­é€‰æ‹©ï¼ˆæ ¹æ®é—®é¢˜å’Œæ•°æ®çš„ä¸åŒï¼Œé€‰æ‹©ä¸åŒçš„å‚æ•°ï¼Œå®é™…ä¸Šå°±æ˜¯å¾—åˆ°äº†ä¸åŒçš„æ ¸å‡½æ•°ï¼‰ï¼Œä¾‹å¦‚ï¼šå¤šé¡¹å¼æ ¸ã€é«˜æ–¯æ ¸ã€çº¿æ€§æ ¸ã€‚\nSVMæ˜¯ä¸€ç§äºŒç±»åˆ†ç±»æ¨¡å‹ã€‚å®ƒçš„åŸºæœ¬æ¨¡å‹æ˜¯åœ¨ç‰¹å¾ç©ºé—´ä¸­å¯»æ‰¾é—´éš”æœ€å¤§åŒ–çš„åˆ†ç¦»è¶…å¹³é¢çš„çº¿æ€§åˆ†ç±»å™¨ã€‚ï¼ˆé—´éš”æœ€å¤§æ˜¯å®ƒæœ‰åˆ«äºæ„ŸçŸ¥æœºï¼‰\nï¼ˆ1ï¼‰å½“è®­ç»ƒæ ·æœ¬çº¿æ€§å¯åˆ†æ—¶ï¼Œé€šè¿‡ç¡¬é—´éš”æœ€å¤§åŒ–ï¼Œå­¦ä¹ ä¸€ä¸ªçº¿æ€§åˆ†ç±»å™¨ï¼Œå³çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœºï¼›\nï¼ˆ2ï¼‰å½“è®­ç»ƒæ•°æ®è¿‘ä¼¼çº¿æ€§å¯åˆ†æ—¶ï¼Œå¼•å…¥æ¾å¼›å˜é‡ï¼Œé€šè¿‡è½¯é—´éš”æœ€å¤§åŒ–ï¼Œå­¦ä¹ ä¸€ä¸ªçº¿æ€§åˆ†ç±»å™¨ï¼Œå³çº¿æ€§æ”¯æŒå‘é‡æœºï¼›\nï¼ˆ3ï¼‰å½“è®­ç»ƒæ•°æ®çº¿æ€§ä¸å¯åˆ†æ—¶ï¼Œé€šè¿‡ä½¿ç”¨æ ¸æŠ€å·§åŠè½¯é—´éš”æœ€å¤§åŒ–ï¼Œå­¦ä¹ éçº¿æ€§æ”¯æŒå‘é‡æœºã€‚\næ³¨ï¼šä»¥ä¸Šå„SVMçš„æ•°å­¦æ¨å¯¼åº”è¯¥ç†Ÿæ‚‰ï¼šç¡¬é—´éš”æœ€å¤§åŒ–ï¼ˆå‡ ä½•é—´éš”ï¼‰\u0026mdash;å­¦ä¹ çš„å¯¹å¶é—®é¢˜\u0026mdash;è½¯é—´éš”æœ€å¤§åŒ–ï¼ˆå¼•å…¥æ¾å¼›å˜é‡ï¼‰\u0026mdash;éçº¿æ€§æ”¯æŒå‘é‡æœºï¼ˆæ ¸æŠ€å·§ï¼‰ã€‚\nè¯»è€…å¯èƒ½è¿˜æ˜¯æ²¡æ˜ç™½æ ¸å‡½æ•°åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Ÿæˆ‘å†ç®€è¦æ¦‚æ‹¬ä¸‹ï¼Œå³ä»¥ä¸‹ä¸‰ç‚¹ï¼š\nå®é™…ä¸­ï¼Œæˆ‘ä»¬ä¼šç»å¸¸é‡åˆ°çº¿æ€§ä¸å¯åˆ†çš„æ ·ä¾‹ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬çš„å¸¸ç”¨åšæ³•æ˜¯æŠŠæ ·ä¾‹ç‰¹å¾æ˜ å°„åˆ°é«˜ç»´ç©ºé—´ä¸­å»(æ˜ å°„åˆ°é«˜ç»´ç©ºé—´åï¼Œç›¸å…³ç‰¹å¾ä¾¿è¢«åˆ†å¼€äº†ï¼Œä¹Ÿå°±è¾¾åˆ°äº†åˆ†ç±»çš„ç›®çš„)ï¼› ä½†è¿›ä¸€æ­¥ï¼Œå¦‚æœå‡¡æ˜¯é‡åˆ°çº¿æ€§ä¸å¯åˆ†çš„æ ·ä¾‹ï¼Œä¸€å¾‹æ˜ å°„åˆ°é«˜ç»´ç©ºé—´ï¼Œé‚£ä¹ˆè¿™ä¸ªç»´åº¦å¤§å°æ˜¯ä¼šé«˜åˆ°å¯æ€•çš„ã€‚é‚£å’‹åŠå‘¢ï¼Ÿ æ­¤æ—¶ï¼Œæ ¸å‡½æ•°å°±éš†é‡ç™»åœºäº†ï¼Œæ ¸å‡½æ•°çš„ä»·å€¼åœ¨äºå®ƒè™½ç„¶ä¹Ÿæ˜¯å°†ç‰¹å¾è¿›è¡Œä»ä½ç»´åˆ°é«˜ç»´çš„è½¬æ¢ï¼Œä½†æ ¸å‡½æ•°ç»å°±ç»åœ¨å®ƒäº‹å…ˆåœ¨ä½ç»´ä¸Šè¿›è¡Œè®¡ç®—ï¼Œè€Œå°†å®è´¨ä¸Šçš„åˆ†ç±»æ•ˆæœè¡¨ç°åœ¨äº†é«˜ç»´ä¸Šï¼Œé¿å…äº†ç›´æ¥åœ¨é«˜ç»´ç©ºé—´ä¸­çš„å¤æ‚è®¡ç®— 2. SVMçš„ä¸€äº›é—®é¢˜ SVMä¸ºä»€ä¹ˆé‡‡ç”¨é—´éš”æœ€å¤§åŒ–ï¼Ÿ å½“è®­ç»ƒæ•°æ®çº¿æ€§å¯åˆ†æ—¶ï¼Œå­˜åœ¨æ— ç©·ä¸ªåˆ†ç¦»è¶…å¹³é¢å¯ä»¥å°†ä¸¤ç±»æ•°æ®æ­£ç¡®åˆ†å¼€ã€‚\næ„ŸçŸ¥æœºåˆ©ç”¨è¯¯åˆ†ç±»æœ€å°ç­–ç•¥ï¼Œæ±‚å¾—åˆ†ç¦»è¶…å¹³é¢ï¼Œä¸è¿‡æ­¤æ—¶çš„è§£æœ‰æ— ç©·å¤šä¸ªã€‚\nçº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœºåˆ©ç”¨é—´éš”æœ€å¤§åŒ–æ±‚å¾—æœ€ä¼˜åˆ†ç¦»è¶…å¹³é¢ï¼Œè¿™æ—¶ï¼Œè§£æ˜¯å”¯ä¸€çš„ã€‚å¦ä¸€æ–¹é¢ï¼Œæ­¤æ—¶çš„åˆ†éš”è¶…å¹³é¢æ‰€äº§ç”Ÿçš„åˆ†ç±»ç»“æœæ˜¯æœ€é²æ£’çš„ï¼Œå¯¹æœªçŸ¥å®ä¾‹çš„æ³›åŒ–èƒ½åŠ›æœ€å¼ºã€‚\nç„¶ååº”è¯¥å€Ÿæ­¤é˜è¿°ï¼Œå‡ ä½•é—´éš”ï¼Œå‡½æ•°é—´éš”ï¼ŒåŠä»å‡½æ•°é—´éš”â€”\u0026gt;æ±‚è§£æœ€å°åŒ–1/2 ||w||^2 æ—¶çš„wå’Œbã€‚å³çº¿æ€§å¯åˆ†æ”¯æŒå‘é‡æœºå­¦ä¹ ç®—æ³•â€”æœ€å¤§é—´éš”æ³•çš„ç”±æ¥ã€‚\nSVMå¦‚ä½•å¤„ç†å¤šåˆ†ç±»é—®é¢˜ï¼Ÿ** ä¸€èˆ¬æœ‰ä¸¤ç§åšæ³•ï¼šä¸€ç§æ˜¯ç›´æ¥æ³•ï¼Œç›´æ¥åœ¨ç›®æ ‡å‡½æ•°ä¸Šä¿®æ”¹ï¼Œå°†å¤šä¸ªåˆ†ç±»é¢çš„å‚æ•°æ±‚è§£åˆå¹¶åˆ°ä¸€ä¸ªæœ€ä¼˜åŒ–é—®é¢˜é‡Œé¢ã€‚çœ‹ä¼¼ç®€å•ä½†æ˜¯è®¡ç®—é‡å´éå¸¸çš„å¤§ã€‚\nå¦å¤–ä¸€ç§åšæ³•æ˜¯é—´æ¥æ³•ï¼šå¯¹è®­ç»ƒå™¨è¿›è¡Œç»„åˆã€‚å…¶ä¸­æ¯”è¾ƒå…¸å‹çš„æœ‰ä¸€å¯¹ä¸€ï¼Œå’Œä¸€å¯¹å¤šã€‚\nä¸€å¯¹å¤šï¼Œå°±æ˜¯å¯¹æ¯ä¸ªç±»éƒ½è®­ç»ƒå‡ºä¸€ä¸ªåˆ†ç±»å™¨ï¼Œç”±svmæ˜¯äºŒåˆ†ç±»ï¼Œæ‰€ä»¥å°†æ­¤è€Œåˆ†ç±»å™¨çš„ä¸¤ç±»è®¾å®šä¸ºç›®æ ‡ç±»ä¸ºä¸€ç±»ï¼Œå…¶ä½™ç±»ä¸ºå¦å¤–ä¸€ç±»ã€‚è¿™æ ·é’ˆå¯¹kä¸ªç±»å¯ä»¥è®­ç»ƒå‡ºkä¸ªåˆ†ç±»å™¨ï¼Œå½“æœ‰ä¸€ä¸ªæ–°çš„æ ·æœ¬æ¥çš„æ—¶å€™ï¼Œç”¨è¿™kä¸ªåˆ†ç±»å™¨æ¥æµ‹è¯•ï¼Œé‚£ä¸ªåˆ†ç±»å™¨çš„æ¦‚ç‡é«˜ï¼Œé‚£ä¹ˆè¿™ä¸ªæ ·æœ¬å°±å±äºå“ªä¸€ç±»ã€‚è¿™ç§æ–¹æ³•æ•ˆæœä¸å¤ªå¥½ï¼Œbiasæ¯”è¾ƒé«˜ã€‚\nsvmä¸€å¯¹ä¸€æ³•ï¼ˆone-vs-oneï¼‰ï¼Œé’ˆå¯¹ä»»æ„ä¸¤ä¸ªç±»è®­ç»ƒå‡ºä¸€ä¸ªåˆ†ç±»å™¨ï¼Œå¦‚æœæœ‰kç±»ï¼Œä¸€å…±è®­ç»ƒå‡ºC(2,k) ä¸ªåˆ†ç±»å™¨ï¼Œè¿™æ ·å½“æœ‰ä¸€ä¸ªæ–°çš„æ ·æœ¬è¦æ¥çš„æ—¶å€™ï¼Œç”¨è¿™C(2,k) ä¸ªåˆ†ç±»å™¨æ¥æµ‹è¯•ï¼Œæ¯å½“è¢«åˆ¤å®šå±äºæŸä¸€ç±»çš„æ—¶å€™ï¼Œè¯¥ç±»å°±åŠ ä¸€ï¼Œæœ€åç¥¨æ•°æœ€å¤šçš„ç±»åˆ«è¢«è®¤å®šä¸ºè¯¥æ ·æœ¬çš„ç±»ã€‚\næ˜¯å¦å­˜åœ¨ä¸€ç»„å‚æ•°ä½¿SVMè®­ç»ƒè¯¯å·®ä¸º0ï¼Ÿ Y\nè®­ç»ƒè¯¯å·®ä¸º0çš„SVMåˆ†ç±»å™¨ä¸€å®šå­˜åœ¨å—ï¼Ÿ ä¸€å®šå­˜åœ¨\nåŠ å…¥æ¾å¼›å˜é‡çš„SVMçš„è®­ç»ƒè¯¯å·®å¯ä»¥ä¸º0å—ï¼Ÿ å¦‚æœæ•°æ®ä¸­å‡ºç°äº†ç¦»ç¾¤ç‚¹outliersï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨æ¾å¼›å˜é‡æ¥è§£å†³ã€‚\nä½¿ç”¨SMOç®—æ³•è®­ç»ƒçš„çº¿æ€§åˆ†ç±»å™¨å¹¶ä¸ä¸€å®šèƒ½å¾—åˆ°è®­ç»ƒè¯¯å·®ä¸º0çš„æ¨¡å‹ã€‚è¿™æ˜¯ç”± äºæˆ‘ä»¬çš„ä¼˜åŒ–ç›®æ ‡æ”¹å˜äº†ï¼Œå¹¶ä¸å†æ˜¯ä½¿è®­ç»ƒè¯¯å·®æœ€å°ã€‚\nå¸¦æ ¸çš„SVMä¸ºä»€ä¹ˆèƒ½åˆ†ç±»éçº¿æ€§é—®é¢˜? æ ¸å‡½æ•°çš„æœ¬è´¨æ˜¯ä¸¤ä¸ªå‡½æ•°çš„å…§ç§¯ï¼Œé€šè¿‡æ ¸å‡½æ•°å°†å…¶éšå°„åˆ°é«˜ç»´ç©ºé—´ï¼Œåœ¨é«˜ç»´ç©ºé—´éçº¿æ€§é—®é¢˜è½¬åŒ–ä¸ºçº¿æ€§é—®é¢˜, SVMå¾—åˆ°è¶…å¹³é¢æ˜¯é«˜ç»´ç©ºé—´çš„çº¿æ€§åˆ†ç±»å¹³é¢ã€‚å…¶åˆ†ç±»ç»“æœä¹Ÿè§†ä¸ºä½ç»´ç©ºé—´çš„éçº¿æ€§åˆ†ç±»ç»“æœ, å› è€Œå¸¦æ ¸çš„SVMå°±èƒ½åˆ†ç±»éçº¿æ€§é—®é¢˜ã€‚\nå¦‚ä½•é€‰æ‹©æ ¸å‡½æ•°ï¼Ÿ å¦‚æœç‰¹å¾çš„æ•°é‡å¤§åˆ°å’Œæ ·æœ¬æ•°é‡å·®ä¸å¤šï¼Œåˆ™é€‰ç”¨LRæˆ–è€…çº¿æ€§æ ¸çš„SVMï¼› å¦‚æœç‰¹å¾çš„æ•°é‡å°ï¼Œæ ·æœ¬çš„æ•°é‡æ­£å¸¸ï¼Œåˆ™é€‰ç”¨SVM+é«˜æ–¯æ ¸å‡½æ•°ï¼› å¦‚æœç‰¹å¾çš„æ•°é‡å°ï¼Œè€Œæ ·æœ¬çš„æ•°é‡å¾ˆå¤§ï¼Œåˆ™éœ€è¦æ‰‹å·¥æ·»åŠ ä¸€äº›ç‰¹å¾ä»è€Œå˜æˆç¬¬ä¸€ç§æƒ…å†µã€‚ 3. LRå’ŒSVMçš„è”ç³»ä¸åŒºåˆ« ç›¸åŒç‚¹ éƒ½æ˜¯çº¿æ€§åˆ†ç±»å™¨ã€‚æœ¬è´¨ä¸Šéƒ½æ˜¯æ±‚ä¸€ä¸ªæœ€ä½³åˆ†ç±»è¶…å¹³é¢ã€‚\néƒ½æ˜¯ç›‘ç£å­¦ä¹ ç®—æ³•\néƒ½æ˜¯åˆ¤åˆ«æ¨¡å‹ã€‚åˆ¤åˆ«æ¨¡å‹ä¸å…³å¿ƒæ•°æ®æ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼Œå®ƒåªå…³å¿ƒä¿¡å·ä¹‹é—´çš„å·®åˆ«ï¼Œç„¶åç”¨å·®åˆ«æ¥ç®€å•å¯¹ç»™å®šçš„ä¸€ä¸ªä¿¡å·è¿›è¡Œåˆ†ç±»ã€‚å¸¸è§çš„åˆ¤åˆ«æ¨¡å‹æœ‰ï¼šKNNã€SVMã€LRï¼Œå¸¸è§çš„ç”Ÿæˆæ¨¡å‹æœ‰ï¼šæœ´ç´ è´å¶æ–¯ï¼Œéšé©¬å°”å¯å¤«æ¨¡å‹ã€‚\nä¸åŒç‚¹ LRæ˜¯å‚æ•°æ¨¡å‹ï¼Œsvmæ˜¯éå‚æ•°æ¨¡å‹ï¼Œlinearå’Œrbfåˆ™æ˜¯é’ˆå¯¹æ•°æ®çº¿æ€§å¯åˆ†å’Œä¸å¯åˆ†çš„åŒºåˆ«\nä»ç›®æ ‡å‡½æ•°æ¥çœ‹ï¼ŒåŒºåˆ«åœ¨äºé€»è¾‘å›å½’é‡‡ç”¨çš„æ˜¯logistical lossï¼ŒSVMé‡‡ç”¨çš„æ˜¯hinge lossï¼Œè¿™ä¸¤ä¸ªæŸå¤±å‡½æ•°çš„ç›®çš„éƒ½æ˜¯å¢åŠ å¯¹åˆ†ç±»å½±å“è¾ƒå¤§çš„æ•°æ®ç‚¹çš„æƒé‡ï¼Œå‡å°‘ä¸åˆ†ç±»å…³ç³»è¾ƒå°çš„æ•°æ®ç‚¹çš„æƒé‡ã€‚\nSVMçš„å¤„ç†æ–¹æ³•æ˜¯åªè€ƒè™‘support vectorsï¼Œä¹Ÿå°±æ˜¯å’Œåˆ†ç±»æœ€ç›¸å…³çš„å°‘æ•°ç‚¹ï¼Œå»å­¦ä¹ åˆ†ç±»å™¨ã€‚è€Œé€»è¾‘å›å½’é€šè¿‡éçº¿æ€§æ˜ å°„ï¼Œå¤§å¤§å‡å°äº†ç¦»åˆ†ç±»å¹³é¢è¾ƒè¿œçš„ç‚¹çš„æƒé‡ï¼Œç›¸å¯¹æå‡äº†ä¸åˆ†ç±»æœ€ç›¸å…³çš„æ•°æ®ç‚¹çš„æƒé‡ã€‚\né€»è¾‘å›å½’ç›¸å¯¹æ¥è¯´æ¨¡å‹æ›´ç®€å•ï¼Œå¥½ç†è§£ï¼Œç‰¹åˆ«æ˜¯å¤§è§„æ¨¡çº¿æ€§åˆ†ç±»æ—¶æ¯”è¾ƒæ–¹ä¾¿ã€‚è€ŒSVMçš„ç†è§£å’Œä¼˜åŒ–ç›¸å¯¹æ¥è¯´å¤æ‚ä¸€äº›ï¼ŒSVMè½¬åŒ–ä¸ºå¯¹å¶é—®é¢˜å,åˆ†ç±»åªéœ€è¦è®¡ç®—ä¸å°‘æ•°å‡ ä¸ªæ”¯æŒå‘é‡çš„è·ç¦»,è¿™ä¸ªåœ¨è¿›è¡Œå¤æ‚æ ¸å‡½æ•°è®¡ç®—æ—¶ä¼˜åŠ¿å¾ˆæ˜æ˜¾,èƒ½å¤Ÿå¤§å¤§ç®€åŒ–æ¨¡å‹å’Œè®¡ç®—ã€‚\nlogic èƒ½åšçš„ svmèƒ½åšï¼Œä½†å¯èƒ½åœ¨å‡†ç¡®ç‡ä¸Šæœ‰é—®é¢˜ï¼Œsvmèƒ½åšçš„logicæœ‰çš„åšä¸äº†ã€‚\n4. çº¿æ€§åˆ†ç±»å™¨ä¸éçº¿æ€§åˆ†ç±»å™¨çš„åŒºåˆ«ä»¥åŠä¼˜åŠ£ çº¿æ€§å’Œéçº¿æ€§æ˜¯é’ˆå¯¹æ¨¡å‹å‚æ•°å’Œè¾“å…¥ç‰¹å¾æ¥è®²çš„ï¼›æ¯”å¦‚è¾“å…¥xï¼Œæ¨¡å‹y=ax+ax^2 é‚£ä¹ˆå°±æ˜¯éçº¿æ€§æ¨¡å‹ï¼Œå¦‚æœè¾“å…¥æ˜¯xå’ŒX^2åˆ™æ¨¡å‹æ˜¯çº¿æ€§çš„ã€‚\nçº¿æ€§åˆ†ç±»å™¨å¯è§£é‡Šæ€§å¥½ï¼Œè®¡ç®—å¤æ‚åº¦è¾ƒä½ï¼Œä¸è¶³ä¹‹å¤„æ˜¯æ¨¡å‹çš„æ‹Ÿåˆæ•ˆæœç›¸å¯¹å¼±äº›ã€‚\nLR,è´å¶æ–¯åˆ†ç±»ï¼Œå•å±‚æ„ŸçŸ¥æœºã€çº¿æ€§å›å½’\néçº¿æ€§åˆ†ç±»å™¨æ•ˆæœæ‹Ÿåˆèƒ½åŠ›è¾ƒå¼ºï¼Œä¸è¶³ä¹‹å¤„æ˜¯æ•°æ®é‡ä¸è¶³å®¹æ˜“è¿‡æ‹Ÿåˆã€è®¡ç®—å¤æ‚åº¦é«˜ã€å¯è§£é‡Šæ€§ä¸å¥½ã€‚","title":"SVM"},{"content":"Word2vec ä»‹ç» Word2Vecæ˜¯googleåœ¨2013å¹´æ¨å‡ºçš„ä¸€ä¸ªNLPå·¥å…·ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯èƒ½å¤Ÿå°†å•è¯è½¬åŒ–ä¸ºå‘é‡æ¥è¡¨ç¤ºã€‚é¦–å…ˆï¼Œword2vecå¯ä»¥åœ¨ç™¾ä¸‡æ•°é‡çº§çš„è¯å…¸å’Œä¸Šäº¿çš„æ•°æ®é›†ä¸Šè¿›è¡Œé«˜æ•ˆåœ°è®­ç»ƒï¼›å…¶æ¬¡ï¼Œè¯¥å·¥å…·å¾—åˆ°çš„è®­ç»ƒç»“æœâ€”â€”è¯å‘é‡ï¼ˆword embeddingï¼‰ï¼Œå¯ä»¥å¾ˆå¥½åœ°åº¦é‡è¯ä¸è¯ä¹‹é—´çš„ç›¸ä¼¼æ€§ã€‚éšç€æ·±åº¦å­¦ä¹ ï¼ˆDeep Learningï¼‰åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä¸­åº”ç”¨çš„æ™®åŠï¼Œå¾ˆå¤šäººè¯¯ä»¥ä¸ºword2vecæ˜¯ä¸€ç§æ·±åº¦å­¦ä¹ ç®—æ³•ã€‚å…¶å®word2vecç®—æ³•çš„èƒŒåæ˜¯ä¸€ä¸ªæµ…å±‚ç¥ç»ç½‘ç»œ(æœ‰ä¸€ä¸ªéšå«å±‚çš„ç¥ç»å…ƒç½‘ç»œ)ã€‚å¦å¤–éœ€è¦å¼ºè°ƒçš„ä¸€ç‚¹æ˜¯ï¼Œword2vecæ˜¯ä¸€ä¸ªè®¡ç®—word vectorçš„å¼€æºå·¥å…·ã€‚å½“æˆ‘ä»¬åœ¨è¯´word2vecç®—æ³•æˆ–æ¨¡å‹çš„æ—¶å€™ï¼Œå…¶å®æŒ‡çš„æ˜¯å…¶èƒŒåç”¨äºè®¡ç®—word vectorçš„CBOWæ¨¡å‹å’ŒSkip-gramæ¨¡å‹ã€‚å¾ˆå¤šäººä»¥ä¸ºword2vecæŒ‡çš„æ˜¯ä¸€ä¸ªç®—æ³•æˆ–æ¨¡å‹ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§è°¬è¯¯ã€‚\nç”¨è¯å‘é‡æ¥è¡¨ç¤ºè¯å¹¶ä¸æ˜¯Word2Vecçš„é¦–åˆ›ï¼Œåœ¨å¾ˆä¹…ä¹‹å‰å°±å‡ºç°äº†ã€‚æœ€æ—©çš„è¯å‘é‡é‡‡ç”¨One-Hotç¼–ç ï¼Œåˆç§°ä¸ºä¸€ä½æœ‰æ•ˆç¼–ç ï¼Œæ¯ä¸ªè¯å‘é‡ç»´åº¦å¤§å°ä¸ºæ•´ä¸ªè¯æ±‡è¡¨çš„å¤§å°ï¼Œå¯¹äºæ¯ä¸ªå…·ä½“çš„è¯æ±‡è¡¨ä¸­çš„è¯ï¼Œå°†å¯¹åº”çš„ä½ç½®ç½®ä¸º1ã€‚è½¬åŒ–ä¸ºNç»´å‘é‡ã€‚\né‡‡ç”¨One-Hotç¼–ç æ–¹å¼æ¥è¡¨ç¤ºè¯å‘é‡éå¸¸ç®€å•ï¼Œä½†ç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œä¸€æ–¹é¢æˆ‘ä»¬å®é™…ä½¿ç”¨çš„è¯æ±‡è¡¨å¾ˆå¤§ï¼Œç»å¸¸æ˜¯ç™¾ä¸‡çº§ä»¥ä¸Šï¼Œè¿™ä¹ˆé«˜ç»´çš„æ•°æ®å¤„ç†èµ·æ¥ä¼šæ¶ˆè€—å¤§é‡çš„è®¡ç®—èµ„æºä¸æ—¶é—´ã€‚å¦ä¸€æ–¹é¢ï¼ŒOne-Hotç¼–ç ä¸­æ‰€æœ‰è¯å‘é‡ä¹‹é—´å½¼æ­¤æ­£äº¤ï¼Œæ²¡æœ‰ä½“ç°è¯ä¸è¯ä¹‹é—´çš„ç›¸ä¼¼å…³ç³»ã€‚\nWord2vec æ˜¯ Word Embedding æ–¹å¼ä¹‹ä¸€ï¼Œå±äº NLP é¢†åŸŸã€‚ä»–æ˜¯å°†è¯è½¬åŒ–ä¸ºã€Œå¯è®¡ç®—ã€ã€Œç»“æ„åŒ–ã€çš„å‘é‡çš„è¿‡ç¨‹ã€‚æœ¬æ–‡å°†è®²è§£ Word2vec çš„åŸç†å’Œä¼˜ç¼ºç‚¹ã€‚\nä»€ä¹ˆæ˜¯ Word2vec ï¼Ÿ ä»€ä¹ˆæ˜¯ Word Embedding ï¼Ÿ åœ¨è¯´æ˜ Word2vec ä¹‹å‰ï¼Œéœ€è¦å…ˆè§£é‡Šä¸€ä¸‹ Word Embeddingã€‚ å®ƒå°±æ˜¯å°†ã€Œä¸å¯è®¡ç®—ã€ã€Œéç»“æ„åŒ–ã€çš„è¯è½¬åŒ–ä¸ºã€Œå¯è®¡ç®—ã€ã€Œç»“æ„åŒ–ã€çš„å‘é‡ã€‚\nè¿™ä¸€æ­¥è§£å†³çš„æ˜¯â€å°†ç°å®é—®é¢˜è½¬åŒ–ä¸ºæ•°å­¦é—®é¢˜â€œï¼Œæ˜¯äººå·¥æ™ºèƒ½éå¸¸å…³é”®çš„ä¸€æ­¥ã€‚ å°†ç°å®é—®é¢˜è½¬åŒ–ä¸ºæ•°å­¦é—®é¢˜åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œåé¢è¿˜éœ€è¦æ±‚è§£è¿™ä¸ªæ•°å­¦é—®é¢˜ã€‚æ‰€ä»¥ Word Embedding çš„æ¨¡å‹æœ¬èº«å¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯ç”Ÿæˆå‡ºæ¥çš„ç»“æœâ€”â€”è¯å‘é‡ã€‚å› ä¸ºåœ¨åç»­çš„ä»»åŠ¡ä¸­ä¼šç›´æ¥ç”¨åˆ°è¿™ä¸ªè¯å‘é‡ã€‚\nä»€ä¹ˆæ˜¯ Word2vec ï¼Ÿ Word2vec æ˜¯ Word Embedding çš„æ–¹æ³•ä¹‹ä¸€ã€‚ä»–æ˜¯ 2013 å¹´ç”±è°·æ­Œçš„ Mikolov æå‡ºäº†ä¸€å¥—æ–°çš„è¯åµŒå…¥æ–¹æ³•ã€‚\nWord2vec åœ¨æ•´ä¸ª NLP é‡Œçš„ä½ç½®å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š Word2vec çš„ 2 ç§è®­ç»ƒæ¨¡å¼ CBOW(Continuous Bag-of-Words Model)å’ŒSkip-gram (Continuous Skip-gram Model)ï¼Œæ˜¯Word2vec çš„ä¸¤ç§è®­ç»ƒæ¨¡å¼ã€‚CBOWé€‚åˆäºæ•°æ®é›†è¾ƒå°çš„æƒ…å†µï¼Œè€ŒSkip-Gramåœ¨å¤§å‹è¯­æ–™ä¸­è¡¨ç°æ›´å¥½ã€‚ä¸‹é¢ç®€å•åšä¸€ä¸‹è§£é‡Šï¼š\nè¯å‘é‡è®­ç»ƒçš„é¢„å¤„ç†æ­¥éª¤ï¼š\n1. å¯¹è¾“å…¥çš„æ–‡æœ¬ç”Ÿæˆä¸€ä¸ªè¯æ±‡è¡¨ï¼Œæ¯ä¸ªè¯ç»Ÿè®¡è¯é¢‘ï¼ŒæŒ‰ç…§è¯é¢‘ä»é«˜åˆ°ä½æ’åºï¼Œå–æœ€é¢‘ç¹çš„Vä¸ªè¯ï¼Œæ„æˆä¸€ä¸ªè¯æ±‡è¡¨ã€‚æ¯ä¸ªè¯å­˜åœ¨ä¸€ä¸ªone-hotå‘é‡ï¼Œå‘é‡çš„ç»´åº¦æ˜¯Vï¼Œå¦‚æœè¯¥è¯åœ¨è¯æ±‡è¡¨ä¸­å‡ºç°è¿‡ï¼Œåˆ™å‘é‡ä¸­è¯æ±‡è¡¨ä¸­å¯¹åº”çš„ä½ç½®ä¸º1ï¼Œå…¶ä»–ä½ç½®å…¨ä¸º0ã€‚å¦‚æœè¯æ±‡è¡¨ä¸­ä¸å‡ºç°ï¼Œåˆ™å‘é‡ä¸ºå…¨0 2. å°†è¾“å…¥æ–‡æœ¬çš„æ¯ä¸ªè¯éƒ½ç”Ÿæˆä¸€ä¸ªone-hotå‘é‡ï¼Œæ­¤å¤„æ³¨æ„ä¿ç•™æ¯ä¸ªè¯çš„åŸå§‹ä½ç½®ï¼Œå› ä¸ºæ˜¯ä¸Šä¸‹æ–‡ç›¸å…³çš„ 3. ç¡®å®šè¯å‘é‡çš„ç»´æ•°N CBOW é€šè¿‡ä¸Šä¸‹æ–‡æ¥é¢„æµ‹å½“å‰å€¼ã€‚ç›¸å½“äºä¸€å¥è¯ä¸­æ‰£æ‰ä¸€ä¸ªè¯ï¼Œè®©ä½ çŒœè¿™ä¸ªè¯æ˜¯ä»€ä¹ˆã€‚ CBOWçš„å¤„ç†æ­¥éª¤ï¼š\nç¡®å®šçª—å£å¤§å°windowï¼Œå¯¹æ¯ä¸ªè¯ç”Ÿæˆ2*windowä¸ªè®­ç»ƒæ ·æœ¬ï¼Œ(i-window, i)ï¼Œ(i-window+1, i)ï¼Œ\u0026hellip;ï¼Œ(i+window-1, i)ï¼Œ(i+window, i) ç¡®å®šbatch_sizeï¼Œæ³¨æ„batch_sizeçš„å¤§å°å¿…é¡»æ˜¯2*windowçš„æ•´æ•°å€ï¼Œè¿™ç¡®ä¿æ¯ä¸ªbatchåŒ…å«äº†ä¸€ä¸ªè¯æ±‡å¯¹åº”çš„æ‰€æœ‰æ ·æœ¬ è®­ç»ƒç®—æ³•æœ‰ä¸¤ç§ï¼šå±‚æ¬¡ Softmax å’Œ Negative Sampling ç¥ç»ç½‘ç»œè¿­ä»£è®­ç»ƒä¸€å®šæ¬¡æ•°ï¼Œå¾—åˆ°è¾“å…¥å±‚åˆ°éšè—å±‚çš„å‚æ•°çŸ©é˜µï¼ŒçŸ©é˜µä¸­æ¯ä¸€è¡Œçš„è½¬ç½®å³æ˜¯å¯¹åº”è¯çš„è¯å‘é‡ Skip-gram ç”¨å½“å‰è¯æ¥é¢„æµ‹ä¸Šä¸‹æ–‡ã€‚ç›¸å½“äºç»™ä½ ä¸€ä¸ªè¯ï¼Œè®©ä½ çŒœå‰é¢å’Œåé¢å¯èƒ½å‡ºç°ä»€ä¹ˆè¯ã€‚ Skip-gramå¤„ç†æ­¥éª¤ï¼š\nç¡®å®šçª—å£å¤§å°windowï¼Œå¯¹æ¯ä¸ªè¯ç”Ÿæˆ2*windowä¸ªè®­ç»ƒæ ·æœ¬ï¼Œ(i, i-window)ï¼Œ(i, i-window+1)ï¼Œ\u0026hellip;ï¼Œ(i, i+window-1)ï¼Œ(i, i+window) ç¡®å®šbatch_sizeï¼Œæ³¨æ„batch_sizeçš„å¤§å°å¿…é¡»æ˜¯2*windowçš„æ•´æ•°å€ï¼Œè¿™ç¡®ä¿æ¯ä¸ªbatchåŒ…å«äº†ä¸€ä¸ªè¯æ±‡å¯¹åº”çš„æ‰€æœ‰æ ·æœ¬ è®­ç»ƒç®—æ³•æœ‰ä¸¤ç§ï¼šå±‚æ¬¡ Softmax å’Œ Negative Sampling ç¥ç»ç½‘ç»œè¿­ä»£è®­ç»ƒä¸€å®šæ¬¡æ•°ï¼Œå¾—åˆ°è¾“å…¥å±‚åˆ°éšè—å±‚çš„å‚æ•°çŸ©é˜µï¼ŒçŸ©é˜µä¸­æ¯ä¸€è¡Œçš„è½¬ç½®å³æ˜¯å¯¹åº”è¯çš„è¯å‘é‡ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸ªæœ€ç®€å•çš„ä¾‹å­ã€‚ä¸Šé¢è¯´åˆ°ï¼Œ y æ˜¯ x çš„ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥ y åªå–ä¸Šä¸‹æ–‡é‡Œä¸€ä¸ªè¯è¯­çš„æ—¶å€™ï¼Œè¯­è¨€æ¨¡å‹å°±å˜æˆï¼š ç”¨å½“å‰è¯ x é¢„æµ‹å®ƒçš„ä¸‹ä¸€ä¸ªè¯ y ä½†å¦‚ä¸Šé¢æ‰€è¯´ï¼Œä¸€èˆ¬çš„æ•°å­¦æ¨¡å‹åªæ¥å—æ•°å€¼å‹è¾“å…¥ï¼Œè¿™é‡Œçš„ x è¯¥æ€ä¹ˆè¡¨ç¤ºå‘¢ï¼Ÿ æ˜¾ç„¶ä¸èƒ½ç”¨ Word2vecï¼Œå› ä¸ºè¿™æ˜¯æˆ‘ä»¬è®­ç»ƒå®Œæ¨¡å‹çš„äº§ç‰©ï¼Œç°åœ¨æˆ‘ä»¬æƒ³è¦çš„æ˜¯ x çš„ä¸€ä¸ªåŸå§‹è¾“å…¥å½¢å¼ã€‚\nç­”æ¡ˆæ˜¯ï¼šone-hot encoder\næ‰€è°“ one-hot encoderï¼Œå…¶æ€æƒ³è·Ÿç‰¹å¾å·¥ç¨‹é‡Œå¤„ç†ç±»åˆ«å˜é‡çš„ one-hot ä¸€æ ·ã€‚æœ¬è´¨ä¸Šæ˜¯ç”¨ä¸€ä¸ªåªå«ä¸€ä¸ª 1ã€å…¶ä»–éƒ½æ˜¯ 0 çš„å‘é‡æ¥å”¯ä¸€è¡¨ç¤ºè¯è¯­ã€‚\næˆ‘ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾å…¨ä¸–ç•Œæ‰€æœ‰çš„è¯è¯­æ€»å…±æœ‰ V ä¸ªï¼Œè¿™ V ä¸ªè¯è¯­æœ‰è‡ªå·±çš„å…ˆåé¡ºåºï¼Œå‡è®¾ã€å´å½¦ç¥–ã€è¿™ä¸ªè¯æ˜¯ç¬¬1ä¸ªè¯ï¼Œã€æˆ‘ã€è¿™ä¸ªå•è¯æ˜¯ç¬¬2ä¸ªè¯ï¼Œé‚£ä¹ˆã€å´å½¦ç¥–ã€å°±å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ª V ç»´å…¨é›¶å‘é‡ã€æŠŠç¬¬1ä¸ªä½ç½®çš„0å˜æˆ1ï¼Œè€Œã€æˆ‘ã€åŒæ ·è¡¨ç¤ºä¸º V ç»´å…¨é›¶å‘é‡ã€æŠŠç¬¬2ä¸ªä½ç½®çš„0å˜æˆ1ã€‚è¿™æ ·ï¼Œæ¯ä¸ªè¯è¯­éƒ½å¯ä»¥æ‰¾åˆ°å±äºè‡ªå·±çš„å”¯ä¸€è¡¨ç¤ºã€‚\nOKï¼Œé‚£æˆ‘ä»¬æ¥ä¸‹æ¥å°±å¯ä»¥çœ‹çœ‹ Skip-gram çš„ç½‘ç»œç»“æ„äº†ï¼Œx å°±æ˜¯ä¸Šé¢æåˆ°çš„ one-hot encoder å½¢å¼çš„è¾“å…¥ï¼Œy æ˜¯åœ¨è¿™ V ä¸ªè¯ä¸Šè¾“å‡ºçš„æ¦‚ç‡ï¼Œæˆ‘ä»¬å¸Œæœ›è·ŸçœŸå®çš„ y çš„ one-hot encoder ä¸€æ ·ã€‚ é¦–å…ˆè¯´æ˜ä¸€ç‚¹ï¼šéšå±‚çš„æ¿€æ´»å‡½æ•°å…¶å®æ˜¯çº¿æ€§çš„ï¼Œç›¸å½“äºæ²¡åšä»»ä½•å¤„ç†ï¼ˆè¿™ä¹Ÿæ˜¯ Word2vec ç®€åŒ–ä¹‹å‰è¯­è¨€æ¨¡å‹çš„ç‹¬åˆ°ä¹‹å¤„ï¼‰ï¼Œæˆ‘ä»¬è¦è®­ç»ƒè¿™ä¸ªç¥ç»ç½‘ç»œï¼Œç”¨åå‘ä¼ æ’­ç®—æ³•ï¼Œæœ¬è´¨ä¸Šæ˜¯é“¾å¼æ±‚å¯¼ï¼Œåœ¨æ­¤ä¸å±•å¼€è¯´æ˜äº†ï¼Œ\né¦–å…ˆè¯´æ˜ä¸€ç‚¹ï¼šéšå±‚çš„æ¿€æ´»å‡½æ•°å…¶å®æ˜¯çº¿æ€§çš„ï¼Œç›¸å½“äºæ²¡åšä»»ä½•å¤„ç†ï¼ˆè¿™ä¹Ÿæ˜¯ Word2vec ç®€åŒ–ä¹‹å‰è¯­è¨€æ¨¡å‹çš„ç‹¬åˆ°ä¹‹å¤„ï¼‰ï¼Œæˆ‘ä»¬è¦è®­ç»ƒè¿™ä¸ªç¥ç»ç½‘ç»œï¼Œç”¨åå‘ä¼ æ’­ç®—æ³•ï¼Œæœ¬è´¨ä¸Šæ˜¯é“¾å¼æ±‚å¯¼ï¼Œåœ¨æ­¤ä¸å±•å¼€è¯´æ˜äº†ï¼Œ\nå½“æ¨¡å‹è®­ç»ƒå®Œåï¼Œæœ€åå¾—åˆ°çš„å…¶å®æ˜¯ç¥ç»ç½‘ç»œçš„æƒé‡ï¼Œæ¯”å¦‚ç°åœ¨è¾“å…¥ä¸€ä¸ª x çš„ one-hot encoder: [1,0,0,â€¦,0]ï¼Œå¯¹åº”åˆšè¯´çš„é‚£ä¸ªè¯è¯­ã€å´å½¦ç¥–ã€ï¼Œåˆ™åœ¨è¾“å…¥å±‚åˆ°éšå«å±‚çš„æƒé‡é‡Œï¼Œåªæœ‰å¯¹åº” 1 è¿™ä¸ªä½ç½®çš„æƒé‡è¢«æ¿€æ´»ï¼Œè¿™äº›æƒé‡çš„ä¸ªæ•°ï¼Œè·Ÿéšå«å±‚èŠ‚ç‚¹æ•°æ˜¯ä¸€è‡´çš„ï¼Œä»è€Œè¿™äº›æƒé‡ç»„æˆä¸€ä¸ªå‘é‡ vx æ¥è¡¨ç¤ºxï¼Œè€Œå› ä¸ºæ¯ä¸ªè¯è¯­çš„ one-hot encoder é‡Œé¢ 1 çš„ä½ç½®æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªå‘é‡ vx å°±å¯ä»¥ç”¨æ¥å”¯ä¸€è¡¨ç¤º xã€‚\næ‰€ä»¥ Word2vec æœ¬è´¨ä¸Šæ˜¯ä¸€ç§é™ç»´æ“ä½œâ€”â€”æŠŠè¯è¯­ä» one-hot encoder å½¢å¼çš„è¡¨ç¤ºé™ç»´åˆ° Word2vec å½¢å¼çš„è¡¨ç¤ºã€‚\néšå±‚ç»†èŠ‚ å‡å¦‚è¯æ±‡è¡¨é•¿åº¦ä¸º10000ï¼Œé¦–å…ˆä½¿ç”¨one-hotå½¢å¼è¡¨ç¤ºæ¯ä¸€ä¸ªå•è¯ï¼Œç»è¿‡éšå±‚300ä¸ªç¥ç»å…ƒè®¡ç®—ï¼Œæœ€åä½¿ç”¨Softmaxå±‚å¯¹å•è¯æ¦‚ç‡è¾“å‡ºã€‚æ¯ä¸€å¯¹å•è¯ç»„ï¼Œå‰è€…ä½œä¸ºxè¾“å…¥ï¼Œåè€…ä½œä¸ºyæ ‡ç­¾ã€‚\nå‡å¦‚æˆ‘ä»¬æƒ³è¦å­¦ä¹ çš„è¯å‘é‡ç»´åº¦ä¸º300ï¼Œåˆ™éœ€è¦å°†éšå±‚çš„ç¥ç»å…ƒä¸ªæ•°è®¾ç½®ä¸º300(300æ˜¯Googleåœ¨å…¶å‘å¸ƒçš„è®­ç»ƒæ¨¡å‹ä¸­ä½¿ç”¨çš„ç»´åº¦ï¼Œå¯è°ƒ)ã€‚\néšå±‚çš„æƒé‡çŸ©é˜µå°±æ˜¯è¯å‘é‡ï¼Œæˆ‘ä»¬æ¨¡å‹å­¦ä¹ åˆ°çš„å°±æ˜¯éšå±‚çš„æƒé‡çŸ©é˜µã€‚ ä¹‹æ‰€ä»¥è¿™æ ·ï¼Œæ¥çœ‹ä¸€ä¸‹one-hotè¾“å…¥åä¸éšå±‚çš„è®¡ç®—å°±æ˜ç™½äº†ã€‚ å½“ä½¿ç”¨One-hotå»ä¹˜ä»¥çŸ©é˜µçš„æ—¶å€™ï¼Œä¼šå°†æŸä¸€è¡Œé€‰æ‹©å‡ºæ¥ï¼Œå³æŸ¥è¡¨æ“ä½œï¼Œæ‰€ä»¥æƒé‡çŸ©é˜µæ˜¯æ‰€æœ‰è¯å‘é‡ç»„æˆçš„åˆ—è¡¨ã€‚\nCBOW è¯¦è§£: CBOW æ˜¯ Continuous Bag-of-Words çš„ç¼©å†™ï¼Œä¸ç¥ç»ç½‘ç»œè¯­è¨€æ¨¡å‹ä¸åŒçš„æ˜¯ï¼ŒCBOWå»æ‰äº†æœ€è€—æ—¶çš„éçº¿æ€§éšè—å±‚\nä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒCBOWæ¨¡å‹é¢„æµ‹çš„æ˜¯ ï¼Œç”±äºå›¾ä¸­ç›®æ ‡è¯ å‰ååªå–äº†å„ä¸¤ä¸ªè¯ï¼Œæ‰€ä»¥çª—å£çš„æ€»å¤§å°æ˜¯2ã€‚å‡è®¾ç›®æ ‡è¯ å‰åå„å–kä¸ªè¯ï¼Œå³çª—å£çš„å¤§å°æ˜¯kï¼Œé‚£ä¹ˆCBOWæ¨¡å‹é¢„æµ‹çš„å°†æ˜¯ è¾“å…¥å±‚åˆ°éšè—å±‚\nä»¥å›¾2ä¸ºä¾‹ï¼Œè¾“å…¥å±‚æ˜¯å››ä¸ªè¯çš„one-hotå‘é‡è¡¨ç¤ºï¼Œåˆ†åˆ«ä¸º ï¼ˆç»´åº¦éƒ½ä¸ºV x 1ï¼ŒVæ˜¯æ¨¡å‹çš„è®­ç»ƒæœ¬æ–‡ä¸­æ‰€æœ‰è¯çš„ä¸ªæ•°ï¼‰ï¼Œè®°è¾“å…¥å±‚åˆ°éšè—å±‚çš„æƒé‡çŸ©é˜µä¸º ï¼ˆç»´åº¦ä¸ºV x dï¼Œdæ˜¯è®¤ä¸ºç»™å®šçš„è¯å‘é‡ç»´åº¦ï¼‰ï¼Œéšè—å±‚çš„å‘é‡ä¸º ï¼ˆç»´åº¦ä¸ºd x 1ï¼‰ï¼Œé‚£ä¹ˆ\nå…¶å®è¿™é‡Œå°±æ˜¯ä¸€ä¸ªç®€å•åœ°æ±‚å’Œå¹³å‡ã€‚\néšè—å±‚åˆ°è¾“å‡ºå±‚\nè®°éšè—å±‚åˆ°è¾“å‡ºå±‚çš„æƒé‡çŸ©é˜µä¸º ï¼ˆç»´åº¦ä¸ºd x Vï¼‰ï¼Œè¾“å‡ºå±‚çš„å‘é‡ä¸º ï¼ˆç»´åº¦ä¸ºV x 1ï¼‰ï¼Œé‚£ä¹ˆ\næ³¨æ„ï¼Œè¾“å‡ºå±‚çš„å‘é‡ ä¸è¾“å…¥å±‚çš„å‘é‡ä¸º è™½ç„¶ç»´åº¦æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ å¹¶ä¸æ˜¯one-hotå‘é‡ï¼Œå¹¶ä¸”å‘é‡ ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯æœ‰æ„ä¹‰çš„ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å‡è®¾è®­ç»ƒæ ·æœ¬åªæœ‰ä¸€å¥è¯â€œI like to eat appleâ€ï¼Œæ­¤åˆ»æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ Iã€likeã€eatã€apple å››ä¸ªè¯æ¥é¢„æµ‹ to ï¼Œè¾“å‡ºå±‚çš„ç»“æœå¦‚å›¾3æ‰€ç¤ºã€‚\nå›¾3 å‘é‡yçš„ä¾‹å­\nå‘é‡yä¸­çš„æ¯ä¸ªå…ƒç´ è¡¨ç¤ºæˆ‘ç”¨ Iã€likeã€eatã€apple å››ä¸ªè¯é¢„æµ‹å‡ºæ¥çš„è¯æ˜¯å½“å…ƒç´ å¯¹åº”çš„è¯çš„æ¦‚ç‡ï¼Œæ¯”å¦‚æ˜¯likeçš„æ¦‚ç‡ä¸º0.05ï¼Œæ˜¯toçš„æ¦‚ç‡æ˜¯0.80ã€‚ç”±äºæˆ‘ä»¬æƒ³è®©æ¨¡å‹é¢„æµ‹å‡ºæ¥çš„è¯æ˜¯toï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦å°½é‡è®©toçš„æ¦‚ç‡å°½å¯èƒ½çš„å¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›®æ ‡æ˜¯æœ€å¤§åŒ–å‡½æ•° æœ‰äº†æœ€å¤§åŒ–çš„ç›®æ ‡å‡½æ•°ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯æ±‚è§£è¿™ä¸ªç›®æ ‡å‡½æ•°ï¼Œé¦–å…ˆæ±‚ ï¼Œç„¶åæ±‚æ¢¯åº¦ï¼Œå†æ¢¯åº¦ä¸‹é™ï¼Œå…·ä½“ç»†èŠ‚åœ¨æ­¤çœç•¥ï¼Œå› ä¸ºè¿™ç§æ–¹æ³•æ¶‰åŠåˆ°softmaxå±‚ï¼Œsoftmaxæ¯æ¬¡è®¡ç®—éƒ½è¦éå†æ•´ä¸ªè¯è¡¨ï¼Œä»£ä»·ååˆ†æ˜‚è´µï¼Œæ‰€ä»¥å®ç°çš„æ—¶å€™æˆ‘ä»¬ä¸ç”¨è¿™ç§æ–¹æ³•ï¼Œæ¬¡softmaxæˆ–è€…è´Ÿé‡‡æ ·æ¥æ›¿æ¢æ‰è¾“å‡ºå±‚ï¼Œé™ä½å¤æ‚åº¦ã€‚\nä¼˜åŒ–æ–¹æ³• ä¸ºäº†æé«˜é€Ÿåº¦ï¼ŒWord2vec ç»å¸¸é‡‡ç”¨ 2 ç§åŠ é€Ÿæ–¹å¼ï¼š\nNegative Sampleï¼ˆè´Ÿé‡‡æ ·ï¼‰\næœ¬è´¨æ˜¯é¢„æµ‹æ€»ä½“ç±»åˆ«çš„ä¸€ä¸ªå­é›† Hierarchical Softmax ï¼ˆå±‚æ¬¡Softmax, huffmanæ ‘ï¼‰\næœ¬è´¨æ˜¯æŠŠ N åˆ†ç±»é—®é¢˜å˜æˆ log(N)æ¬¡äºŒåˆ†ç±» Word2vec çš„ä¼˜ç¼ºç‚¹ éœ€è¦è¯´æ˜çš„æ˜¯ï¼šWord2vec æ˜¯ä¸Šä¸€ä»£çš„äº§ç‰©ï¼ˆ18 å¹´ä¹‹å‰ï¼‰ï¼Œ 18 å¹´ä¹‹åæƒ³è¦å¾—åˆ°æœ€å¥½çš„æ•ˆæœï¼Œå·²ç»ä¸ä½¿ç”¨ Word Embedding çš„æ–¹æ³•äº†ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šç”¨åˆ° Word2vecã€‚\nä¼˜ç‚¹ï¼š ç”±äº Word2vec ä¼šè€ƒè™‘ä¸Šä¸‹æ–‡ï¼Œè·Ÿä¹‹å‰çš„ Embedding æ–¹æ³•ç›¸æ¯”ï¼Œæ•ˆæœè¦æ›´å¥½ï¼ˆä½†ä¸å¦‚ 18 å¹´ä¹‹åçš„æ–¹æ³•ï¼‰ æ¯”ä¹‹å‰çš„ Embeddingæ–¹ æ³•ç»´åº¦æ›´å°‘ï¼Œæ‰€ä»¥é€Ÿåº¦æ›´å¿« é€šç”¨æ€§å¾ˆå¼ºï¼Œå¯ä»¥ç”¨åœ¨å„ç§ NLP ä»»åŠ¡ä¸­ ç¼ºç‚¹ï¼š ç”±äºè¯å’Œå‘é‡æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œæ‰€ä»¥å¤šä¹‰è¯çš„é—®é¢˜æ— æ³•è§£å†³ã€‚ Word2vec æ˜¯ä¸€ç§é™æ€çš„æ–¹å¼ï¼Œè™½ç„¶é€šç”¨æ€§å¼ºï¼Œä½†æ˜¯æ— æ³•é’ˆå¯¹ç‰¹å®šä»»åŠ¡åšåŠ¨æ€ä¼˜åŒ– é—®é¢˜ å‡å¦‚ä½¿ç”¨è¯å‘é‡ç»´åº¦ä¸º300ï¼Œè¯æ±‡é‡ä¸º10000ä¸ªå•è¯ï¼Œé‚£ä¹ˆç¥ç»ç½‘ç»œè¾“å…¥å±‚ä¸éšå±‚ï¼Œéšå±‚ä¸è¾“å‡ºå±‚çš„å‚æ•°é‡ä¼šè¾¾åˆ°æƒŠäººçš„300x10000=300ä¸‡ï¼è®­ç»ƒå¦‚è¯åºå¤§çš„ç¥ç»ç½‘ç»œéœ€è¦åºå¤§çš„æ•°æ®é‡ï¼Œè¿˜è¦é¿å…è¿‡æ‹Ÿåˆã€‚å› æ­¤ï¼ŒGoogleåœ¨å…¶ç¬¬äºŒç¯‡è®ºæ–‡ä¸­è¯´æ˜äº†è®­ç»ƒçš„trickï¼Œå…¶åˆ›æ–°ç‚¹å¦‚ä¸‹ï¼š\nå°†å¸¸ç”¨è¯å¯¹æˆ–çŸ­è¯­è§†ä¸ºæ¨¡å‹ä¸­çš„å•ä¸ªâ€wordâ€ã€‚ å¯¹é¢‘ç¹çš„è¯è¿›è¡Œå­é‡‡æ ·ä»¥å‡å°‘è®­ç»ƒæ ·ä¾‹çš„æ•°é‡ã€‚ åœ¨æŸå¤±å‡½æ•°ä¸­ä½¿ç”¨â€è´Ÿé‡‡æ ·(Negative Sampling)â€çš„æŠ€æœ¯ï¼Œä½¿æ¯ä¸ªè®­ç»ƒæ ·æœ¬ä»…æ›´æ–°æ¨¡å‹æƒé‡çš„ä¸€å°éƒ¨åˆ†ã€‚ å­é‡‡æ ·å’Œè´Ÿé‡‡æ ·æŠ€æœ¯ä¸ä»…é™ä½äº†è®¡ç®—é‡ï¼Œè¿˜æå‡äº†è¯å‘é‡çš„æ•ˆæœã€‚\nå¯¹é¢‘ç¹è¯å­é‡‡æ · åœ¨ä»¥ä¸Šä¾‹å­ä¸­ï¼Œå¯ä»¥çœ‹åˆ°é¢‘ç¹å•è¯â€™theâ€™çš„ä¸¤ä¸ªé—®é¢˜:\nå¯¹äºå•è¯å¯¹(â€˜foxâ€™,â€™theâ€™)ï¼Œå…¶å¯¹å•è¯â€™foxâ€™çš„è¯­ä¹‰è¡¨è¾¾å¹¶æ²¡æœ‰ä»€ä¹ˆæœ‰æ•ˆå¸®åŠ©ï¼Œâ€™theâ€™åœ¨æ¯ä¸ªå•è¯çš„ä¸Šä¸‹æ–‡ä¸­å‡ºç°éƒ½éå¸¸é¢‘ç¹ã€‚ é¢„æ–™ä¸­æœ‰å¾ˆå¤šå•è¯å¯¹(â€˜theâ€™,â€¦)ï¼Œæˆ‘ä»¬åº”æ›´å¥½çš„å­¦ä¹ å•è¯â€™theâ€™ Word2vecä½¿ç”¨å­é‡‡æ ·æŠ€æœ¯æ¥è§£å†³ä»¥ä¸Šé—®é¢˜ï¼Œæ ¹æ®å•è¯çš„é¢‘æ¬¡æ¥å‰Šå‡è¯¥å•è¯çš„é‡‡æ ·ç‡ã€‚ä»¥window sizeä¸º10ä¸ºä¾‹å­ï¼Œæˆ‘ä»¬åˆ é™¤â€™theâ€™ï¼š\nå½“æˆ‘ä»¬è®­ç»ƒå…¶ä½™å•è¯æ—¶å€™ï¼Œâ€™theâ€™ä¸ä¼šå‡ºç°åœ¨ä»–ä»¬çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ å½“ä¸­å¿ƒè¯ä¸ºâ€™theâ€™æ—¶ï¼Œè®­ç»ƒæ ·æœ¬æ•°é‡å°‘äº10ã€‚ è´Ÿé‡‡æ ·(Negative Sampling) è®­ç»ƒä¸€ä¸ªç½‘ç»œæ˜¯è¯´ï¼Œè®¡ç®—è®­ç»ƒæ ·æœ¬ç„¶åè½»å¾®è°ƒæ•´æ‰€æœ‰çš„ç¥ç»å…ƒæƒé‡æ¥æé«˜å‡†ç¡®ç‡ã€‚æ¢å¥è¯è¯´ï¼Œæ¯ä¸€ä¸ªè®­ç»ƒæ ·æœ¬éƒ½éœ€è¦æ›´æ–°æ‰€æœ‰ç¥ç»ç½‘ç»œçš„æƒé‡ã€‚\nå°±åƒå¦‚ä¸Šæ‰€è¯´ï¼Œå½“è¯æ±‡è¡¨ç‰¹åˆ«å¤§çš„æ—¶å€™ï¼Œå¦‚æ­¤å¤šçš„ç¥ç»ç½‘ç»œå‚æ•°åœ¨å¦‚æ­¤å¤§çš„æ•°æ®é‡ä¸‹ï¼Œæ¯æ¬¡éƒ½è¦è¿›è¡Œæƒé‡æ›´æ–°ï¼Œè´Ÿæ‹…å¾ˆå¤§ã€‚\nåœ¨æ¯ä¸ªæ ·æœ¬è®­ç»ƒæ—¶ï¼Œåªä¿®æ”¹éƒ¨åˆ†çš„ç½‘ç»œå‚æ•°ï¼Œè´Ÿé‡‡æ ·æ˜¯é€šè¿‡è¿™ç§æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚\nå½“æˆ‘ä»¬çš„ç¥ç»ç½‘ç»œè®­ç»ƒåˆ°å•è¯ç»„(â€˜foxâ€™, â€˜quickâ€™)æ—¶å€™ï¼Œå¾—åˆ°çš„è¾“å‡ºæˆ–labeléƒ½æ˜¯ä¸€ä¸ªone-hotå‘é‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¡¨ç¤ºâ€™quickâ€™çš„ä½ç½®æ•°å€¼ä¸º1ï¼Œå…¶å®ƒå…¨ä¸º0ã€‚\nè´Ÿé‡‡æ ·æ˜¯éšæœºé€‰æ‹©è¾ƒå°æ•°é‡çš„â€™è´Ÿ(Negative)â€™å•è¯(æ¯”å¦‚5ä¸ª)ï¼Œæ¥åšå‚æ•°æ›´æ–°ã€‚è¿™é‡Œçš„â€™è´Ÿâ€™è¡¨ç¤ºçš„æ˜¯ç½‘ç»œè¾“å‡ºå‘é‡ç§ä½ç½®ä¸º0è¡¨ç¤ºçš„å•è¯ã€‚å½“ç„¶ï¼Œâ€™æ­£(Positive)â€™(å³æ­£ç¡®å•è¯â€™quickâ€™)æƒé‡ä¹Ÿä¼šæ›´æ–°ã€‚\nè®ºæ–‡ä¸­è¡¨è¿°ï¼Œå°æ•°é‡çº§ä¸Šé‡‡ç”¨5-20ï¼Œå¤§æ•°æ®é›†ä½¿ç”¨2-5ä¸ªå•è¯ã€‚\næˆ‘ä»¬çš„æ¨¡å‹æƒé‡çŸ©é˜µä¸º300x10000ï¼Œæ›´æ–°çš„å•è¯ä¸º5ä¸ªâ€™è´Ÿâ€™è¯å’Œä¸€ä¸ªâ€™æ­£â€™è¯ï¼Œå…±è®¡1800ä¸ªå‚æ•°ï¼Œè¿™æ˜¯è¾“å‡ºå±‚å…¨éƒ¨3Må‚æ•°çš„0.06%ï¼ï¼\nè´Ÿé‡‡æ ·çš„é€‰å–æ˜¯å’Œé¢‘æ¬¡ç›¸å…³çš„ï¼Œé¢‘æ¬¡è¶Šé«˜ï¼Œè´Ÿé‡‡æ ·çš„æ¦‚ç‡è¶Šå¤§ï¼š $$P(w_i) = \\frac{f(w_i)^{3/4}}{\\sum_{j=0}^n(f(w_j)^{3/4})}$$ è®ºæ–‡é€‰æ‹©0.75ä½œä¸ºæŒ‡æ•°æ˜¯å› ä¸ºå®éªŒæ•ˆæœå¥½ã€‚Cè¯­è¨€å®ç°çš„ä»£ç å¾ˆæœ‰æ„æ€ï¼šé¦–å…ˆç”¨ç´¢å¼•å€¼å¡«å……å¤šæ¬¡å¡«å……è¯æ±‡è¡¨ä¸­çš„æ¯ä¸ªå•è¯ï¼Œå•è¯ç´¢å¼•å‡ºç°çš„æ¬¡æ•°ä¸º$P(w_i) * \\text{table_size}$ã€‚ç„¶åè´Ÿé‡‡æ ·åªéœ€è¦ç”Ÿæˆä¸€ä¸ª1åˆ°100Mçš„æ•´æ•°ï¼Œå¹¶ç”¨äºç´¢å¼•è¡¨ä¸­æ•°æ®ã€‚ç”±äºæ¦‚ç‡é«˜çš„å•è¯åœ¨è¡¨ä¸­å‡ºç°çš„æ¬¡æ•°å¤šï¼Œå¾ˆå¯èƒ½ä¼šé€‰æ‹©è¿™äº›è¯ã€‚\nGloVe æ¨¡å‹ æ¨¡å‹ç›®æ ‡ï¼šè¿›è¡Œè¯çš„å‘é‡åŒ–è¡¨ç¤ºï¼Œä½¿å¾—å‘é‡ä¹‹é—´å°½å¯èƒ½å¤šåœ°è•´å«è¯­ä¹‰å’Œè¯­æ³•çš„ä¿¡æ¯ã€‚\nè¾“å…¥ï¼šè¯­æ–™åº“\nè¾“å‡ºï¼šè¯å‘é‡\næ–¹æ³•æ¦‚è¿°ï¼šé¦–å…ˆåŸºäºè¯­æ–™åº“æ„å»ºè¯çš„å…±ç°çŸ©é˜µï¼Œç„¶ååŸºäºå…±ç°çŸ©é˜µå’ŒGloVeæ¨¡å‹å­¦ä¹ è¯å‘é‡ã€‚\nGlobal Vectorèåˆäº†çŸ©é˜µåˆ†è§£çš„å…¨å±€ç»Ÿè®¡ä¿¡æ¯å’Œä¸Šä¸‹æ–‡ä¿¡æ¯\nå¸¸è§çš„é—®é¢˜ 1ã€æ–‡æœ¬è¡¨ç¤ºå“ªäº›æ–¹æ³•ï¼Ÿ åŸºäº one-hotã€tf-idfã€textrank ç­‰çš„ bag-of-wordsï¼› ä¸»é¢˜æ¨¡å‹ï¼šLSAï¼ˆSVDï¼‰ã€pLSAã€LDAï¼› åŸºäºè¯å‘é‡çš„å›ºå®šè¡¨å¾ï¼šWord2vecã€FastTextã€GloVe åŸºäºè¯å‘é‡çš„åŠ¨æ€è¡¨å¾ï¼šELMoã€GPTã€BERT 2ã€æ€ä¹ˆä»è¯­è¨€æ¨¡å‹ç†è§£è¯å‘é‡ï¼Ÿæ€ä¹ˆç†è§£åˆ†å¸ƒå¼å‡è®¾ï¼Ÿ ä¸Šé¢ç»™å‡ºçš„ 4 ä¸ªç±»å‹ä¹Ÿæ˜¯ nlp é¢†åŸŸæœ€ä¸ºå¸¸ç”¨çš„æ–‡æœ¬è¡¨ç¤ºäº†ï¼Œæ–‡æœ¬æ˜¯ç”±æ¯ä¸ªå•è¯æ„æˆçš„ï¼Œè€Œè°ˆèµ·è¯å‘é‡ï¼Œone-hot æ˜¯å¯è®¤ä¸ºæ˜¯æœ€ä¸ºç®€å•çš„è¯å‘é‡ï¼Œä½†å­˜åœ¨ç»´åº¦ç¾éš¾å’Œè¯­ä¹‰é¸¿æ²Ÿç­‰é—®é¢˜ï¼›é€šè¿‡æ„å»ºå…±ç°çŸ©é˜µå¹¶åˆ©ç”¨ SVD æ±‚è§£æ„å»ºè¯å‘é‡ï¼Œåˆ™è®¡ç®—å¤æ‚åº¦é«˜ï¼›è€Œæ—©æœŸè¯å‘é‡çš„ç ”ç©¶é€šå¸¸æ¥æºäºè¯­è¨€æ¨¡å‹ï¼Œæ¯”å¦‚ NNLM å’Œ RNNLMï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯è¯­è¨€æ¨¡å‹ï¼Œè€Œè¯å‘é‡åªæ˜¯ä¸€ä¸ªå‰¯äº§ç‰©ã€‚\næ‰€è°“åˆ†å¸ƒå¼å‡è®¾ï¼Œç”¨ä¸€å¥è¯å¯ä»¥è¡¨è¾¾ï¼šç›¸åŒä¸Šä¸‹æ–‡è¯­å¢ƒçš„è¯æœ‰ä¼¼å«ä¹‰ã€‚è€Œç”±æ­¤å¼•ç”³å‡ºäº† Word2vecã€FastTextï¼Œåœ¨æ­¤ç±»è¯å‘é‡ä¸­ï¼Œè™½ç„¶å…¶æœ¬è´¨ä»ç„¶æ˜¯è¯­è¨€æ¨¡å‹ï¼Œä½†æ˜¯å®ƒçš„ç›®æ ‡å¹¶ä¸æ˜¯è¯­è¨€æ¨¡å‹æœ¬èº«ï¼Œè€Œæ˜¯è¯å‘é‡ï¼Œå…¶æ‰€ä½œçš„ä¸€ç³»åˆ—ä¼˜åŒ–ï¼Œéƒ½æ˜¯ä¸ºäº†æ›´å¿«æ›´å¥½çš„å¾—åˆ°è¯å‘é‡ã€‚GloVe åˆ™æ˜¯åŸºäºå…¨å±€è¯­æ–™åº“ã€å¹¶ç»“åˆä¸Šä¸‹æ–‡è¯­å¢ƒæ„å»ºè¯å‘é‡ï¼Œç»“åˆäº† LSA å’Œ Word2vec çš„ä¼˜ç‚¹ã€‚\n3ã€ä¼ ç»Ÿçš„è¯å‘é‡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿå„ç§è¯å‘é‡çš„ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ ä¸Šè¿°æ–¹æ³•å¾—åˆ°çš„è¯å‘é‡æ˜¯å›ºå®šè¡¨å¾çš„ï¼Œæ— æ³•è§£å†³ä¸€è¯å¤šä¹‰ç­‰é—®é¢˜ï¼Œå¦‚â€œå·æ™®â€ã€‚ä¸ºæ­¤å¼•å…¥åŸºäºè¯­è¨€æ¨¡å‹çš„åŠ¨æ€è¡¨å¾æ–¹æ³•ï¼šELMoã€GPTã€BERTã€‚\nå„ç§è¯å‘é‡çš„ç‰¹ç‚¹ï¼š\nOne-hot è¡¨ç¤º ï¼šç»´åº¦ç¾éš¾ã€è¯­ä¹‰é¸¿æ²Ÿï¼› åˆ†å¸ƒå¼è¡¨ç¤º (distributed representation) çŸ©é˜µåˆ†è§£ï¼ˆLSAï¼‰ï¼šåˆ©ç”¨å…¨å±€è¯­æ–™ç‰¹å¾ï¼Œä½† SVD æ±‚è§£è®¡ç®—å¤æ‚åº¦å¤§ï¼› åŸºäº NNLM/RNNLM çš„è¯å‘é‡ï¼šè¯å‘é‡ä¸ºå‰¯äº§ç‰©ï¼Œå­˜åœ¨æ•ˆç‡ä¸é«˜ç­‰é—®é¢˜ï¼› Word2vecã€FastTextï¼šä¼˜åŒ–æ•ˆç‡é«˜ï¼Œä½†æ˜¯åŸºäºå±€éƒ¨è¯­æ–™ï¼› GloVeï¼šåŸºäºå…¨å±€é¢„æ–™ï¼Œç»“åˆäº† LSA å’Œ Word2vec çš„ä¼˜ç‚¹ï¼› ELMoã€GPTã€BERTï¼šåŠ¨æ€ç‰¹å¾ï¼› 4ã€Word2vec å’Œ NNLM å¯¹æ¯”æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿï¼ˆWord2vecvs NNLMï¼‰ 1ï¼‰å…¶æœ¬è´¨éƒ½å¯ä»¥çœ‹ä½œæ˜¯è¯­è¨€æ¨¡å‹ï¼›\n2ï¼‰è¯å‘é‡åªä¸è¿‡ NNLM ä¸€ä¸ªäº§ç‰©ï¼ŒWord2vec è™½ç„¶å…¶æœ¬è´¨ä¹Ÿæ˜¯è¯­è¨€æ¨¡å‹ï¼Œä½†æ˜¯å…¶ä¸“æ³¨äºè¯å‘é‡æœ¬èº«ï¼Œå› æ­¤åšäº†è®¸å¤šä¼˜åŒ–æ¥æé«˜è®¡ç®—æ•ˆç‡ï¼š\nä¸ NNLM ç›¸æ¯”ï¼Œè¯å‘é‡ç›´æ¥ sumï¼Œä¸å†æ‹¼æ¥ï¼Œå¹¶èˆå¼ƒéšå±‚ï¼› è€ƒè™‘åˆ° sofmax å½’ä¸€åŒ–éœ€è¦éå†æ•´ä¸ªè¯æ±‡è¡¨ï¼Œé‡‡ç”¨ hierarchical softmax å’Œ negative sampling è¿›è¡Œä¼˜åŒ–ï¼Œhierarchical softmax å®è´¨ä¸Šç”Ÿæˆä¸€é¢—å¸¦æƒè·¯å¾„æœ€å°çš„å“ˆå¤«æ›¼æ ‘ï¼Œè®©é«˜é¢‘è¯æœç´¢è·¯åŠ²å˜å°ï¼›negative sampling æ›´ä¸ºç›´æ¥ï¼Œå®è´¨ä¸Šå¯¹æ¯ä¸€ä¸ªæ ·æœ¬ä¸­æ¯ä¸€ä¸ªè¯éƒ½è¿›è¡Œè´Ÿä¾‹é‡‡æ ·ï¼› 5ã€Word2vec å’Œ FastText å¯¹æ¯”æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿï¼ˆWord2vec vs FastTextï¼‰ 1ï¼‰éƒ½å¯ä»¥æ— ç›‘ç£å­¦ä¹ è¯å‘é‡ï¼Œ FastText è®­ç»ƒè¯å‘é‡æ—¶ä¼šè€ƒè™‘ subwordï¼›\n2ï¼‰ FastText è¿˜å¯ä»¥è¿›è¡Œæœ‰ç›‘ç£å­¦ä¹ è¿›è¡Œæ–‡æœ¬åˆ†ç±»ï¼Œå…¶ä¸»è¦ç‰¹ç‚¹ï¼š\nç»“æ„ä¸ CBOW ç±»ä¼¼ï¼Œä½†å­¦ä¹ ç›®æ ‡æ˜¯äººå·¥æ ‡æ³¨çš„åˆ†ç±»ç»“æœï¼› é‡‡ç”¨ hierarchical softmax å¯¹è¾“å‡ºçš„åˆ†ç±»æ ‡ç­¾å»ºç«‹å“ˆå¤«æ›¼æ ‘ï¼Œæ ·æœ¬ä¸­æ ‡ç­¾å¤šçš„ç±»åˆ«è¢«åˆ†é…çŸ­çš„æœå¯»è·¯å¾„ å¼•å…¥ N-gramï¼Œè€ƒè™‘è¯åºç‰¹å¾ å¼•å…¥ subword æ¥å¤„ç†é•¿è¯ï¼Œå¤„ç†æœªç™»é™†è¯é—®é¢˜ï¼› 6ã€GloVe å’Œ Word2vecã€ LSA å¯¹æ¯”æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿï¼ˆWord2vecvs GloVe vs LSAï¼‰ 1ï¼‰GloVe vs LSA\nLSAï¼ˆLatent Semantic Analysisï¼‰å¯ä»¥åŸºäº co-occurance matrix æ„å»ºè¯å‘é‡ï¼Œå®è´¨ä¸Šæ˜¯åŸºäºå…¨å±€è¯­æ–™é‡‡ç”¨ SVD è¿›è¡ŒçŸ©é˜µåˆ†è§£ï¼Œç„¶è€Œ SVD è®¡ç®—å¤æ‚åº¦é«˜ï¼›\nGloVe å¯çœ‹ä½œæ˜¯å¯¹ LSA ä¸€ç§ä¼˜åŒ–çš„é«˜æ•ˆçŸ©é˜µåˆ†è§£ç®—æ³•ï¼Œé‡‡ç”¨ Adagrad å¯¹æœ€å°å¹³æ–¹æŸå¤±è¿›è¡Œä¼˜åŒ–ï¼›\n2ï¼‰Word2vecvs GloVe\nWord2vec æ˜¯å±€éƒ¨è¯­æ–™åº“è®­ç»ƒçš„ï¼Œå…¶ç‰¹å¾æå–æ˜¯åŸºäºæ»‘çª—çš„ï¼›è€Œ GloVe çš„æ»‘çª—æ˜¯ä¸ºäº†æ„å»º co-occurance matrixï¼Œæ˜¯åŸºäºå…¨å±€è¯­æ–™çš„ï¼Œå¯è§ GloVe éœ€è¦äº‹å…ˆç»Ÿè®¡å…±ç°æ¦‚ç‡ï¼›å› æ­¤ï¼ŒWord2vec å¯ä»¥è¿›è¡Œåœ¨çº¿å­¦ä¹ ï¼ŒGloVe åˆ™éœ€è¦ç»Ÿè®¡å›ºå®šè¯­æ–™ä¿¡æ¯ã€‚\nWord2vec æ˜¯æ— ç›‘ç£å­¦ä¹ ï¼ŒåŒæ ·ç”±äºä¸éœ€è¦äººå·¥æ ‡æ³¨ï¼›GloVe é€šå¸¸è¢«è®¤ä¸ºæ˜¯æ— ç›‘ç£å­¦ä¹ ï¼Œä½†å®é™…ä¸Š GloVe è¿˜æ˜¯æœ‰ label çš„ï¼Œå³å…±ç°æ¬¡æ•° [å…¬å¼]ã€‚\nWord2vec æŸå¤±å‡½æ•°å®è´¨ä¸Šæ˜¯å¸¦æƒé‡çš„äº¤å‰ç†µï¼Œæƒé‡å›ºå®šï¼›GloVe çš„æŸå¤±å‡½æ•°æ˜¯æœ€å°å¹³æ–¹æŸå¤±å‡½æ•°ï¼Œæƒé‡å¯ä»¥åšæ˜ å°„å˜æ¢ã€‚\næ€»ä½“æ¥çœ‹ï¼ŒGloVe å¯ä»¥è¢«çœ‹ä½œæ˜¯æ›´æ¢äº†ç›®æ ‡å‡½æ•°å’Œæƒé‡å‡½æ•°çš„å…¨å±€ Word2vecã€‚\n7ã€ Word2vec çš„ä¸¤ç§ä¼˜åŒ–æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿå®ƒä»¬çš„ç›®æ ‡å‡½æ•°æ€æ ·ç¡®å®šçš„ï¼Ÿè®­ç»ƒè¿‡ç¨‹åˆæ˜¯æ€æ ·çš„ï¼Ÿ ä¸ç»è¿‡ä¼˜åŒ–çš„ CBOW å’Œ Skip-gram ä¸­ , åœ¨æ¯ä¸ªæ ·æœ¬ä¸­æ¯ä¸ªè¯çš„è®­ç»ƒè¿‡ç¨‹éƒ½è¦éå†æ•´ä¸ªè¯æ±‡è¡¨ï¼Œä¹Ÿå°±æ˜¯éƒ½éœ€è¦ç»è¿‡ softmax å½’ä¸€åŒ–ï¼Œè®¡ç®—è¯¯å·®å‘é‡å’Œæ¢¯åº¦ä»¥æ›´æ–°ä¸¤ä¸ªè¯å‘é‡çŸ©é˜µï¼ˆè¿™ä¸¤ä¸ªè¯å‘é‡çŸ©é˜µå®é™…ä¸Šå°±æ˜¯æœ€ç»ˆçš„è¯å‘é‡ï¼Œå¯è®¤ä¸ºåˆå§‹åŒ–ä¸ä¸€æ ·ï¼‰ï¼Œå½“è¯­æ–™åº“è§„æ¨¡å˜å¤§ã€è¯æ±‡è¡¨å¢é•¿æ—¶ï¼Œè®­ç»ƒå˜å¾—ä¸åˆ‡å®é™…ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒWord2vec æ”¯æŒä¸¤ç§ä¼˜åŒ–æ–¹æ³•ï¼šhierarchical softmax å’Œ negative samplingã€‚\nï¼ˆ1ï¼‰åŸºäº hierarchical softmax çš„ CBOW å’Œ Skip-gram\nhierarchical softmax ä½¿ç”¨ä¸€é¢—äºŒå‰æ ‘è¡¨ç¤ºè¯æ±‡è¡¨ä¸­çš„å•è¯ï¼Œæ¯ä¸ªå•è¯éƒ½ä½œä¸ºäºŒå‰æ ‘çš„å¶å­èŠ‚ç‚¹ã€‚å¯¹äºä¸€ä¸ªå¤§å°ä¸º V çš„è¯æ±‡è¡¨ï¼Œå…¶å¯¹åº”çš„äºŒå‰æ ‘åŒ…å« V-1 éå¶å­èŠ‚ç‚¹ã€‚å‡å¦‚æ¯ä¸ªéå¶å­èŠ‚ç‚¹å‘å·¦è½¬æ ‡è®°ä¸º 1ï¼Œå‘å³è½¬æ ‡è®°ä¸º 0ï¼Œé‚£ä¹ˆæ¯ä¸ªå•è¯éƒ½å…·æœ‰å”¯ä¸€çš„ä»æ ¹èŠ‚ç‚¹åˆ°è¾¾è¯¥å¶å­èŠ‚ç‚¹çš„ç”±ï½›0 1ï½ç»„æˆçš„ä»£å·ï¼ˆå®é™…ä¸Šä¸ºå“ˆå¤«æ›¼ç¼–ç ï¼Œä¸ºå“ˆå¤«æ›¼æ ‘ï¼Œæ˜¯å¸¦æƒè·¯å¾„é•¿åº¦æœ€çŸ­çš„æ ‘ï¼Œå“ˆå¤«æ›¼æ ‘ä¿è¯äº†è¯é¢‘é«˜çš„å•è¯çš„è·¯å¾„çŸ­ï¼Œè¯é¢‘ç›¸å¯¹ä½çš„å•è¯çš„è·¯å¾„é•¿ï¼Œè¿™ç§ç¼–ç æ–¹å¼å¾ˆå¤§ç¨‹åº¦å‡å°‘äº†è®¡ç®—é‡ï¼‰ã€‚\nï¼ˆ2ï¼‰åŸºäº negative sampling çš„ CBOW å’Œ Skip-gram\nnegative sampling æ˜¯ä¸€ç§ä¸åŒäº hierarchical softmax çš„ä¼˜åŒ–ç­–ç•¥ï¼Œç›¸æ¯”äº hierarchical softmaxï¼Œnegative sampling çš„æƒ³æ³•æ›´ç›´æ¥â€”â€”ä¸ºæ¯ä¸ªè®­ç»ƒå®ä¾‹éƒ½æä¾›è´Ÿä¾‹ã€‚\nè´Ÿé‡‡æ ·ç®—æ³•å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¸¦æƒé‡‡æ ·è¿‡ç¨‹ï¼Œè´Ÿä¾‹çš„é€‰æ‹©æœºåˆ¶æ˜¯å’Œå•è¯è¯é¢‘è”ç³»èµ·æ¥çš„ã€‚\nå…·ä½“åšæ³•æ˜¯ä»¥ N+1 ä¸ªç‚¹å¯¹åŒºé—´ [0,1] åšéç­‰è·åˆ‡åˆ†ï¼Œå¹¶å¼•å…¥çš„ä¸€ä¸ªåœ¨åŒºé—´ [0,1] ä¸Šçš„ M ç­‰è·åˆ‡åˆ†ï¼Œå…¶ä¸­ M \u0026raquo; Nã€‚æºç ä¸­å– M = 10^8ã€‚ç„¶åå¯¹ä¸¤ä¸ªåˆ‡åˆ†åšæŠ•å½±ï¼Œå¾—åˆ°æ˜ å°„å…³ç³»ï¼šé‡‡æ ·æ—¶ï¼Œæ¯æ¬¡ç”Ÿæˆä¸€ä¸ª [1, M-1] ä¹‹é—´çš„æ•´æ•° iï¼Œåˆ™ Table(i) å°±å¯¹åº”ä¸€ä¸ªæ ·æœ¬ï¼›å½“é‡‡æ ·åˆ°æ­£ä¾‹æ—¶ï¼Œè·³è¿‡ï¼ˆæ‹’ç»é‡‡æ ·ï¼‰ã€‚\nå‚è€ƒï¼š https://zhuanlan.zhihu.com/p/44599645\n","permalink":"https://reid00.github.io/en/posts/ml/word2vec/","summary":"Word2vec ä»‹ç» Word2Vecæ˜¯googleåœ¨2013å¹´æ¨å‡ºçš„ä¸€ä¸ªNLPå·¥å…·ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯èƒ½å¤Ÿå°†å•è¯è½¬åŒ–ä¸ºå‘é‡æ¥è¡¨ç¤ºã€‚é¦–å…ˆï¼Œword2vecå¯ä»¥åœ¨ç™¾ä¸‡æ•°é‡çº§çš„è¯å…¸å’Œä¸Šäº¿çš„æ•°æ®é›†ä¸Šè¿›è¡Œé«˜æ•ˆåœ°è®­ç»ƒï¼›å…¶æ¬¡ï¼Œè¯¥å·¥å…·å¾—åˆ°çš„è®­ç»ƒç»“æœâ€”â€”è¯å‘é‡ï¼ˆword embeddingï¼‰ï¼Œå¯ä»¥å¾ˆå¥½åœ°åº¦é‡è¯ä¸è¯ä¹‹é—´çš„ç›¸ä¼¼æ€§ã€‚éšç€æ·±åº¦å­¦ä¹ ï¼ˆDeep Learningï¼‰åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä¸­åº”ç”¨çš„æ™®åŠï¼Œå¾ˆå¤šäººè¯¯ä»¥ä¸ºword2vecæ˜¯ä¸€ç§æ·±åº¦å­¦ä¹ ç®—æ³•ã€‚å…¶å®word2vecç®—æ³•çš„èƒŒåæ˜¯ä¸€ä¸ªæµ…å±‚ç¥ç»ç½‘ç»œ(æœ‰ä¸€ä¸ªéšå«å±‚çš„ç¥ç»å…ƒç½‘ç»œ)ã€‚å¦å¤–éœ€è¦å¼ºè°ƒçš„ä¸€ç‚¹æ˜¯ï¼Œword2vecæ˜¯ä¸€ä¸ªè®¡ç®—word vectorçš„å¼€æºå·¥å…·ã€‚å½“æˆ‘ä»¬åœ¨è¯´word2vecç®—æ³•æˆ–æ¨¡å‹çš„æ—¶å€™ï¼Œå…¶å®æŒ‡çš„æ˜¯å…¶èƒŒåç”¨äºè®¡ç®—word vectorçš„CBOWæ¨¡å‹å’ŒSkip-gramæ¨¡å‹ã€‚å¾ˆå¤šäººä»¥ä¸ºword2vecæŒ‡çš„æ˜¯ä¸€ä¸ªç®—æ³•æˆ–æ¨¡å‹ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§è°¬è¯¯ã€‚\nç”¨è¯å‘é‡æ¥è¡¨ç¤ºè¯å¹¶ä¸æ˜¯Word2Vecçš„é¦–åˆ›ï¼Œåœ¨å¾ˆä¹…ä¹‹å‰å°±å‡ºç°äº†ã€‚æœ€æ—©çš„è¯å‘é‡é‡‡ç”¨One-Hotç¼–ç ï¼Œåˆç§°ä¸ºä¸€ä½æœ‰æ•ˆç¼–ç ï¼Œæ¯ä¸ªè¯å‘é‡ç»´åº¦å¤§å°ä¸ºæ•´ä¸ªè¯æ±‡è¡¨çš„å¤§å°ï¼Œå¯¹äºæ¯ä¸ªå…·ä½“çš„è¯æ±‡è¡¨ä¸­çš„è¯ï¼Œå°†å¯¹åº”çš„ä½ç½®ç½®ä¸º1ã€‚è½¬åŒ–ä¸ºNç»´å‘é‡ã€‚\né‡‡ç”¨One-Hotç¼–ç æ–¹å¼æ¥è¡¨ç¤ºè¯å‘é‡éå¸¸ç®€å•ï¼Œä½†ç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œä¸€æ–¹é¢æˆ‘ä»¬å®é™…ä½¿ç”¨çš„è¯æ±‡è¡¨å¾ˆå¤§ï¼Œç»å¸¸æ˜¯ç™¾ä¸‡çº§ä»¥ä¸Šï¼Œè¿™ä¹ˆé«˜ç»´çš„æ•°æ®å¤„ç†èµ·æ¥ä¼šæ¶ˆè€—å¤§é‡çš„è®¡ç®—èµ„æºä¸æ—¶é—´ã€‚å¦ä¸€æ–¹é¢ï¼ŒOne-Hotç¼–ç ä¸­æ‰€æœ‰è¯å‘é‡ä¹‹é—´å½¼æ­¤æ­£äº¤ï¼Œæ²¡æœ‰ä½“ç°è¯ä¸è¯ä¹‹é—´çš„ç›¸ä¼¼å…³ç³»ã€‚\nWord2vec æ˜¯ Word Embedding æ–¹å¼ä¹‹ä¸€ï¼Œå±äº NLP é¢†åŸŸã€‚ä»–æ˜¯å°†è¯è½¬åŒ–ä¸ºã€Œå¯è®¡ç®—ã€ã€Œç»“æ„åŒ–ã€çš„å‘é‡çš„è¿‡ç¨‹ã€‚æœ¬æ–‡å°†è®²è§£ Word2vec çš„åŸç†å’Œä¼˜ç¼ºç‚¹ã€‚\nä»€ä¹ˆæ˜¯ Word2vec ï¼Ÿ ä»€ä¹ˆæ˜¯ Word Embedding ï¼Ÿ åœ¨è¯´æ˜ Word2vec ä¹‹å‰ï¼Œéœ€è¦å…ˆè§£é‡Šä¸€ä¸‹ Word Embeddingã€‚ å®ƒå°±æ˜¯å°†ã€Œä¸å¯è®¡ç®—ã€ã€Œéç»“æ„åŒ–ã€çš„è¯è½¬åŒ–ä¸ºã€Œå¯è®¡ç®—ã€ã€Œç»“æ„åŒ–ã€çš„å‘é‡ã€‚\nè¿™ä¸€æ­¥è§£å†³çš„æ˜¯â€å°†ç°å®é—®é¢˜è½¬åŒ–ä¸ºæ•°å­¦é—®é¢˜â€œï¼Œæ˜¯äººå·¥æ™ºèƒ½éå¸¸å…³é”®çš„ä¸€æ­¥ã€‚ å°†ç°å®é—®é¢˜è½¬åŒ–ä¸ºæ•°å­¦é—®é¢˜åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œåé¢è¿˜éœ€è¦æ±‚è§£è¿™ä¸ªæ•°å­¦é—®é¢˜ã€‚æ‰€ä»¥ Word Embedding çš„æ¨¡å‹æœ¬èº«å¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯ç”Ÿæˆå‡ºæ¥çš„ç»“æœâ€”â€”è¯å‘é‡ã€‚å› ä¸ºåœ¨åç»­çš„ä»»åŠ¡ä¸­ä¼šç›´æ¥ç”¨åˆ°è¿™ä¸ªè¯å‘é‡ã€‚\nä»€ä¹ˆæ˜¯ Word2vec ï¼Ÿ Word2vec æ˜¯ Word Embedding çš„æ–¹æ³•ä¹‹ä¸€ã€‚ä»–æ˜¯ 2013 å¹´ç”±è°·æ­Œçš„ Mikolov æå‡ºäº†ä¸€å¥—æ–°çš„è¯åµŒå…¥æ–¹æ³•ã€‚\nWord2vec åœ¨æ•´ä¸ª NLP é‡Œçš„ä½ç½®å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š Word2vec çš„ 2 ç§è®­ç»ƒæ¨¡å¼ CBOW(Continuous Bag-of-Words Model)å’ŒSkip-gram (Continuous Skip-gram Model)ï¼Œæ˜¯Word2vec çš„ä¸¤ç§è®­ç»ƒæ¨¡å¼ã€‚CBOWé€‚åˆäºæ•°æ®é›†è¾ƒå°çš„æƒ…å†µï¼Œè€ŒSkip-Gramåœ¨å¤§å‹è¯­æ–™ä¸­è¡¨ç°æ›´å¥½ã€‚ä¸‹é¢ç®€å•åšä¸€ä¸‹è§£é‡Šï¼š\nè¯å‘é‡è®­ç»ƒçš„é¢„å¤„ç†æ­¥éª¤ï¼š\n1. å¯¹è¾“å…¥çš„æ–‡æœ¬ç”Ÿæˆä¸€ä¸ªè¯æ±‡è¡¨ï¼Œæ¯ä¸ªè¯ç»Ÿè®¡è¯é¢‘ï¼ŒæŒ‰ç…§è¯é¢‘ä»é«˜åˆ°ä½æ’åºï¼Œå–æœ€é¢‘ç¹çš„Vä¸ªè¯ï¼Œæ„æˆä¸€ä¸ªè¯æ±‡è¡¨ã€‚æ¯ä¸ªè¯å­˜åœ¨ä¸€ä¸ªone-hotå‘é‡ï¼Œå‘é‡çš„ç»´åº¦æ˜¯Vï¼Œå¦‚æœè¯¥è¯åœ¨è¯æ±‡è¡¨ä¸­å‡ºç°è¿‡ï¼Œåˆ™å‘é‡ä¸­è¯æ±‡è¡¨ä¸­å¯¹åº”çš„ä½ç½®ä¸º1ï¼Œå…¶ä»–ä½ç½®å…¨ä¸º0ã€‚å¦‚æœè¯æ±‡è¡¨ä¸­ä¸å‡ºç°ï¼Œåˆ™å‘é‡ä¸ºå…¨0 2. å°†è¾“å…¥æ–‡æœ¬çš„æ¯ä¸ªè¯éƒ½ç”Ÿæˆä¸€ä¸ªone-hotå‘é‡ï¼Œæ­¤å¤„æ³¨æ„ä¿ç•™æ¯ä¸ªè¯çš„åŸå§‹ä½ç½®ï¼Œå› ä¸ºæ˜¯ä¸Šä¸‹æ–‡ç›¸å…³çš„ 3. ç¡®å®šè¯å‘é‡çš„ç»´æ•°N CBOW é€šè¿‡ä¸Šä¸‹æ–‡æ¥é¢„æµ‹å½“å‰å€¼ã€‚ç›¸å½“äºä¸€å¥è¯ä¸­æ‰£æ‰ä¸€ä¸ªè¯ï¼Œè®©ä½ çŒœè¿™ä¸ªè¯æ˜¯ä»€ä¹ˆã€‚ CBOWçš„å¤„ç†æ­¥éª¤ï¼š","title":"Word2vec"},{"content":"å†³ç­–æ ‘ å†³ç­–æ ‘ï¼ˆdecision treeï¼‰æ˜¯ä¸€ä¸ªæ ‘ç»“æ„ï¼ˆå¯ä»¥æ˜¯äºŒå‰æ ‘æˆ–éäºŒå‰æ ‘ï¼‰ã€‚å…¶æ¯ä¸ªéå¶èŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªç‰¹å¾å±æ€§ä¸Šçš„æµ‹è¯•ï¼Œæ¯ä¸ªåˆ†æ”¯ä»£è¡¨è¿™ä¸ªç‰¹å¾å±æ€§åœ¨æŸä¸ªå€¼åŸŸä¸Šçš„è¾“å‡ºï¼Œè€Œæ¯ä¸ªå¶èŠ‚ç‚¹å­˜æ”¾ä¸€ä¸ªç±»åˆ«ã€‚ä½¿ç”¨å†³ç­–æ ‘è¿›è¡Œå†³ç­–çš„è¿‡ç¨‹å°±æ˜¯ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œæµ‹è¯•å¾…åˆ†ç±»é¡¹ä¸­ç›¸åº”çš„ç‰¹å¾å±æ€§ï¼Œå¹¶æŒ‰ç…§å…¶å€¼é€‰æ‹©è¾“å‡ºåˆ†æ”¯ï¼Œç›´åˆ°åˆ°è¾¾å¶å­èŠ‚ç‚¹ï¼Œå°†å¶å­èŠ‚ç‚¹å­˜æ”¾çš„ç±»åˆ«ä½œä¸ºå†³ç­–ç»“æœ[1]ã€‚ ä¸‹é¢å…ˆæ¥çœ‹ä¸€ä¸ªå°ä¾‹å­ï¼Œçœ‹çœ‹å†³ç­–æ ‘åˆ°åº•æ˜¯ä»€ä¹ˆæ¦‚å¿µï¼ˆè¿™ä¸ªä¾‹å­æ¥æºäº[2]ï¼‰ã€‚\nå†³ç­–æ ‘çš„è®­ç»ƒæ•°æ®å¾€å¾€å°±æ˜¯è¿™æ ·çš„è¡¨æ ¼å½¢å¼ï¼Œè¡¨ä¸­çš„å‰ä¸‰åˆ—ï¼ˆIDä¸ç®—ï¼‰æ˜¯æ•°æ®æ ·æœ¬çš„å±æ€§ï¼Œæœ€åä¸€åˆ—æ˜¯å†³ç­–æ ‘éœ€è¦åšçš„åˆ†ç±»ç»“æœã€‚é€šè¿‡è¯¥æ•°æ®ï¼Œæ„å»ºçš„å†³ç­–æ ‘å¦‚ä¸‹ï¼š\næœ‰äº†è¿™æ£µæ ‘ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹æ–°æ¥çš„ç”¨æˆ·æ•°æ®è¿›è¡Œæ˜¯å¦å¯ä»¥å¿è¿˜çš„é¢„æµ‹äº†ã€‚\nå†³ç­–æ ‘æœ€é‡è¦çš„æ˜¯å†³ç­–æ ‘çš„æ„é€ ã€‚æ‰€è°“å†³ç­–æ ‘çš„æ„é€ å°±æ˜¯è¿›è¡Œå±æ€§é€‰æ‹©åº¦é‡ç¡®å®šå„ä¸ªç‰¹å¾å±æ€§ä¹‹é—´çš„æ‹“æ‰‘ç»“æ„ã€‚æ„é€ å†³ç­–æ ‘çš„å…³é”®æ­¥éª¤æ˜¯åˆ†è£‚å±æ€§ã€‚æ‰€è°“åˆ†è£‚å±æ€§å°±æ˜¯åœ¨æŸä¸ªèŠ‚ç‚¹å¤„æŒ‰ç…§æŸä¸€ç‰¹å¾å±æ€§çš„ä¸åŒåˆ’åˆ†æ„é€ ä¸åŒçš„åˆ†æ”¯ï¼Œå…¶ç›®æ ‡æ˜¯è®©å„ä¸ªåˆ†è£‚å­é›†å°½å¯èƒ½åœ°â€œçº¯â€ã€‚å°½å¯èƒ½â€œçº¯â€å°±æ˜¯å°½é‡è®©ä¸€ä¸ªåˆ†è£‚å­é›†ä¸­å¾…åˆ†ç±»é¡¹å±äºåŒä¸€ç±»åˆ«ã€‚åˆ†è£‚å±æ€§åˆ†ä¸ºä¸‰ç§ä¸åŒçš„æƒ…å†µ[1]ï¼š 1ã€å±æ€§æ˜¯ç¦»æ•£å€¼ä¸”ä¸è¦æ±‚ç”ŸæˆäºŒå‰å†³ç­–æ ‘ã€‚æ­¤æ—¶ç”¨å±æ€§çš„æ¯ä¸€ä¸ªåˆ’åˆ†ä½œä¸ºä¸€ä¸ªåˆ†æ”¯ã€‚ 2ã€å±æ€§æ˜¯ç¦»æ•£å€¼ä¸”è¦æ±‚ç”ŸæˆäºŒå‰å†³ç­–æ ‘ã€‚æ­¤æ—¶ä½¿ç”¨å±æ€§åˆ’åˆ†çš„ä¸€ä¸ªå­é›†è¿›è¡Œæµ‹è¯•ï¼ŒæŒ‰ç…§â€œå±äºæ­¤å­é›†â€å’Œâ€œä¸å±äºæ­¤å­é›†â€åˆ†æˆä¸¤ä¸ªåˆ†æ”¯ã€‚ 3ã€å±æ€§æ˜¯è¿ç»­å€¼ã€‚æ­¤æ—¶ç¡®å®šä¸€ä¸ªå€¼ä½œä¸ºåˆ†è£‚ç‚¹split_pointï¼ŒæŒ‰ç…§\u0026gt;split_pointå’Œ\u0026lt;=split_pointç”Ÿæˆä¸¤ä¸ªåˆ†æ”¯ã€‚\nå†³ç­–æ ‘çš„å±æ€§åˆ†è£‚é€‰æ‹©æ˜¯â€è´ªå¿ƒâ€œç®—æ³•ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰å›æº¯çš„ã€‚\nID3.5 å¥½äº†ï¼Œæ¥ä¸‹æ¥è¯´ä¸€ä¸‹æ•™ç§‘ä¹¦ä¸Šæåˆ°æœ€å¤šçš„å†³ç­–æ ‘ID3.5ç®—æ³•ï¼ˆæ˜¯æœ€åŸºæœ¬çš„æ¨¡å‹ï¼Œç®€å•å®ç”¨ï¼Œä½†æ˜¯åœ¨æŸäº›åœºåˆä¸‹ä¹Ÿæœ‰ç¼ºé™·ï¼‰ã€‚\nä¿¡æ¯è®ºä¸­æœ‰ç†µï¼ˆentropyï¼‰çš„æ¦‚å¿µï¼Œè¡¨ç¤ºçŠ¶æ€çš„æ··ä¹±ç¨‹åº¦ï¼Œç†µè¶Šå¤§è¶Šæ··ä¹±ã€‚ç†µçš„å˜åŒ–å¯ä»¥çœ‹åšæ˜¯ä¿¡æ¯å¢ç›Šï¼Œå†³ç­–æ ‘ID3ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä»¥ä¿¡æ¯å¢ç›Šåº¦é‡å±æ€§é€‰æ‹©ï¼Œé€‰æ‹©åˆ†è£‚åä¿¡æ¯å¢ç›Šæœ€å¤§çš„å±æ€§è¿›è¡Œåˆ†è£‚ã€‚\nè®¾Dä¸ºç”¨ï¼ˆè¾“å‡ºï¼‰ç±»åˆ«å¯¹è®­ç»ƒå…ƒç»„è¿›è¡Œçš„åˆ’åˆ†ï¼Œåˆ™Dçš„ç†µè¡¨ç¤ºä¸ºï¼š info(D)=âˆ’âˆ‘i=1mpilog2(pi)info(D)=âˆ’âˆ‘i=1mpilog2â¡(pi)\nå…¶ä¸­pipiè¡¨ç¤ºç¬¬iä¸ªç±»åˆ«åœ¨æ•´ä¸ªè®­ç»ƒå…ƒç»„ä¸­å‡ºç°çš„æ¦‚ç‡ï¼Œä¸€èˆ¬æ¥è¯´ä¼šç”¨è¿™ä¸ªç±»åˆ«çš„æ ·æœ¬æ•°é‡å æ€»é‡çš„å æ¯”æ¥ä½œä¸ºæ¦‚ç‡çš„ä¼°è®¡ï¼›ç†µçš„å®é™…æ„ä¹‰è¡¨ç¤ºæ˜¯Dä¸­å…ƒç»„çš„ç±»æ ‡å·æ‰€éœ€è¦çš„å¹³å‡ä¿¡æ¯é‡ã€‚ç†µçš„å«ä¹‰å¯ä»¥çœ‹æˆ‘å‰é¢å†™çš„PRML ch1.6 ä¿¡æ¯è®ºçš„ä»‹ç»ã€‚ å¦‚æœå°†è®­ç»ƒå…ƒç»„DæŒ‰å±æ€§Aè¿›è¡Œåˆ’åˆ†ï¼Œåˆ™Aå¯¹Dåˆ’åˆ†çš„æœŸæœ›ä¿¡æ¯ä¸ºï¼š infoA(D)=âˆ‘j=1v|Dj||D|info(Dj) infoA(D)=âˆ‘j=1v|Dj||D|info(Dj) äºæ˜¯ï¼Œä¿¡æ¯å¢ç›Šå°±æ˜¯ä¸¤è€…çš„å·®å€¼ï¼š gain(A)=info(D)âˆ’infoA(D) gain(A)=info(D)âˆ’infoA(D) ID3å†³ç­–æ ‘ç®—æ³•å°±ç”¨åˆ°ä¸Šé¢çš„ä¿¡æ¯å¢ç›Šï¼Œåœ¨æ¯æ¬¡åˆ†è£‚çš„æ—¶å€™è´ªå¿ƒé€‰æ‹©ä¿¡æ¯å¢ç›Šæœ€å¤§çš„å±æ€§ï¼Œä½œä¸ºæœ¬æ¬¡åˆ†è£‚å±æ€§ã€‚æ¯æ¬¡åˆ†è£‚å°±ä¼šä½¿å¾—æ ‘é•¿é«˜ä¸€å±‚ã€‚è¿™æ ·é€æ­¥ç”Ÿäº§ä¸‹å»ï¼Œå°±ä¸€å®šå¯ä»¥æ„å»ºä¸€é¢—å†³ç­–æ ‘ã€‚ï¼ˆåŸºæœ¬åŸç†å°±æ˜¯è¿™æ ·ï¼Œä½†æ˜¯å®é™…ä¸­ï¼Œä¸ºäº†é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œä»¥åŠå¯èƒ½é‡åˆ°å¶å­èŠ‚ç‚¹ç±»åˆ«ä¸çº¯çš„æƒ…å†µï¼Œéœ€è¦æœ‰ä¸€äº›ç‰¹æ®Šçš„trickï¼Œè¿™äº›ç•™åˆ°æœ€åè®²ï¼‰\nOKï¼Œå€Ÿé‰´ä¸€ä¸‹[1]ä¸­çš„ä¸€ä¸ªå°ä¾‹å­ï¼Œæ¥çœ‹ä¸€ä¸‹ä¿¡æ¯å¢ç›Šçš„è®¡ç®—è¿‡ç¨‹ã€‚\nè¿™ä¸ªä¾‹å­æ˜¯è¿™æ ·çš„ï¼šè¾“å…¥æ ·æœ¬çš„å±æ€§æœ‰ä¸‰ä¸ªâ€”â€”æ—¥å¿—å¯†åº¦ï¼ˆLï¼‰ï¼Œå¥½å‹å¯†åº¦ï¼ˆFï¼‰ï¼Œä»¥åŠæ˜¯å¦ä½¿ç”¨çœŸå®å¤´åƒï¼ˆHï¼‰ï¼›æ ·æœ¬çš„æ ‡è®°æ˜¯è´¦å·æ˜¯å¦çœŸå®yes or noã€‚\nç„¶åå¯ä»¥ä¸€æ¬¡è®¡ç®—æ¯ä¸€ä¸ªå±æ€§çš„ä¿¡æ¯å¢ç›Šï¼Œæ¯”å¦‚æ—¥è‡´å¯†åº¦çš„ä¿¡æ¯å¢ç›Šæ˜¯0.276ã€‚\nåŒç†å¯å¾—Hå’ŒFçš„ä¿¡æ¯å¢ç›Šä¸º0.033å’Œ0.553ã€‚å› ä¸ºFå…·æœ‰æœ€å¤§çš„ä¿¡æ¯å¢ç›Šï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡åˆ†è£‚é€‰æ‹©Fä¸ºåˆ†è£‚å±æ€§ï¼Œåˆ†è£‚åçš„ç»“æœå¦‚ä¸‹å›¾è¡¨ç¤ºï¼š\nä¸Šé¢ä¸ºäº†ç®€ä¾¿ï¼Œå°†ç‰¹å¾å±æ€§ç¦»æ•£åŒ–äº†ï¼Œå…¶å®æ—¥å¿—å¯†åº¦å’Œå¥½å‹å¯†åº¦éƒ½æ˜¯è¿ç»­çš„å±æ€§ã€‚å¯¹äºç‰¹å¾å±æ€§ä¸ºè¿ç»­å€¼ï¼Œå¯ä»¥å¦‚æ­¤ä½¿ç”¨ID3ç®—æ³•ï¼šå…ˆå°†Dä¸­å…ƒç´ æŒ‰ç…§ç‰¹å¾å±æ€§æ’åºï¼Œåˆ™æ¯ä¸¤ä¸ªç›¸é‚»å…ƒç´ çš„ä¸­é—´ç‚¹å¯ä»¥çœ‹åšæ½œåœ¨åˆ†è£‚ç‚¹ï¼Œä»ç¬¬ä¸€ä¸ªæ½œåœ¨åˆ†è£‚ç‚¹å¼€å§‹ï¼Œåˆ†è£‚Då¹¶è®¡ç®—ä¸¤ä¸ªé›†åˆçš„æœŸæœ›ä¿¡æ¯ï¼Œå…·æœ‰æœ€å°æœŸæœ›ä¿¡æ¯çš„ç‚¹ç§°ä¸ºè¿™ä¸ªå±æ€§çš„æœ€ä½³åˆ†è£‚ç‚¹ï¼Œå…¶ä¿¡æ¯æœŸæœ›ä½œä¸ºæ­¤å±æ€§çš„ä¿¡æ¯æœŸæœ›ã€‚\nC4.5 ID3æœ‰ä¸€äº›ç¼ºé™·ï¼Œå°±æ˜¯é€‰æ‹©çš„æ—¶å€™å®¹æ˜“é€‰æ‹©ä¸€äº›æ¯”è¾ƒå®¹æ˜“åˆ†çº¯å‡€çš„å±æ€§ï¼Œå°¤å…¶åœ¨å…·æœ‰åƒIDå€¼è¿™æ ·çš„å±æ€§ï¼Œå› ä¸ºæ¯ä¸ªIDéƒ½å¯¹åº”ä¸€ä¸ªç±»åˆ«ï¼Œæ‰€ä»¥åˆ†çš„å¾ˆçº¯å‡€ï¼ŒID3æ¯”è¾ƒå€¾å‘æ‰¾åˆ°è¿™æ ·çš„å±æ€§åšåˆ†è£‚ã€‚\nC4.5ç®—æ³•å®šä¹‰äº†åˆ†è£‚ä¿¡æ¯ï¼Œè¡¨ç¤ºä¸ºï¼š split_infoA(D)=âˆ’âˆ‘j=1v|Dj||D|log2(|Dj||D|) split_infoA(D)=âˆ’âˆ‘j=1v|Dj||D|log2â¡(|Dj||D|) å¾ˆå®¹æ˜“ç†è§£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªç†µçš„å®šä¹‰ï¼Œpi=|Dj||D|pi=|Dj||D|ï¼Œå¯ä»¥çœ‹åšæ˜¯å±æ€§åˆ†è£‚çš„ç†µï¼Œåˆ†çš„è¶Šå¤šå°±è¶Šæ··ä¹±ï¼Œç†µè¶Šå¤§ã€‚å®šä¹‰ä¿¡æ¯å¢ç›Šç‡ï¼š gain_ratio(A)=gain(A)split_info(A) gain_ratio(A)=gain(A)split_info(A)\nC4.5å°±æ˜¯é€‰æ‹©æœ€å¤§å¢ç›Šç‡çš„å±æ€§æ¥åˆ†è£‚ï¼Œå…¶ä»–ç±»ä¼¼ID3.5ã€‚\nCART CARTï¼ˆClassification And Regression Treeï¼‰ç®—æ³•æ—¢å¯ä»¥ç”¨äºåˆ›å»ºåˆ†ç±»æ ‘ï¼Œä¹Ÿå¯ä»¥ç”¨äºåˆ›å»ºå›å½’æ ‘ã€‚CARTç®—æ³•çš„é‡è¦ç‰¹ç‚¹åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š\näºŒåˆ†(Binary Split)ï¼šåœ¨æ¯æ¬¡åˆ¤æ–­è¿‡ç¨‹ä¸­ï¼Œéƒ½æ˜¯å¯¹æ ·æœ¬æ•°æ®è¿›è¡ŒäºŒåˆ†ã€‚CARTç®—æ³•æ˜¯ä¸€ç§äºŒåˆ†é€’å½’åˆ†å‰²æŠ€æœ¯ï¼ŒæŠŠå½“å‰æ ·æœ¬åˆ’åˆ†ä¸ºä¸¤ä¸ªå­æ ·æœ¬ï¼Œä½¿å¾—ç”Ÿæˆçš„æ¯ä¸ªéå¶å­ç»“ç‚¹éƒ½æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œå› æ­¤CARTç®—æ³•ç”Ÿæˆçš„å†³ç­–æ ‘æ˜¯ç»“æ„ç®€æ´çš„äºŒå‰æ ‘ã€‚ç”±äºCARTç®—æ³•æ„æˆçš„æ˜¯ä¸€ä¸ªäºŒå‰æ ‘ï¼Œå®ƒåœ¨æ¯ä¸€æ­¥çš„å†³ç­–æ—¶åªèƒ½æ˜¯â€œæ˜¯â€æˆ–è€…â€œå¦â€ï¼Œå³ä½¿ä¸€ä¸ªfeatureæœ‰å¤šä¸ªå–å€¼ï¼Œä¹Ÿæ˜¯æŠŠæ•°æ®åˆ†ä¸ºä¸¤éƒ¨åˆ† å•å˜é‡åˆ†å‰²(Split Based on One Variable)ï¼šæ¯æ¬¡æœ€ä¼˜åˆ’åˆ†éƒ½æ˜¯é’ˆå¯¹å•ä¸ªå˜é‡ã€‚ å‰ªæç­–ç•¥ï¼šCARTç®—æ³•çš„å…³é”®ç‚¹ï¼Œä¹Ÿæ˜¯æ•´ä¸ªTree-Basedç®—æ³•çš„å…³é”®æ­¥éª¤ã€‚å‰ªæè¿‡ç¨‹ç‰¹åˆ«é‡è¦ï¼Œæ‰€ä»¥åœ¨æœ€ä¼˜å†³ç­–æ ‘ç”Ÿæˆè¿‡ç¨‹ä¸­å æœ‰é‡è¦åœ°ä½ã€‚æœ‰ç ”ç©¶è¡¨æ˜ï¼Œå‰ªæè¿‡ç¨‹çš„é‡è¦æ€§è¦æ¯”æ ‘ç”Ÿæˆè¿‡ç¨‹æ›´ä¸ºé‡è¦ï¼Œå¯¹äºä¸åŒçš„åˆ’åˆ†æ ‡å‡†ç”Ÿæˆçš„æœ€å¤§æ ‘(Maximum Tree)ï¼Œåœ¨å‰ªæä¹‹åéƒ½èƒ½å¤Ÿä¿ç•™æœ€é‡è¦çš„å±æ€§åˆ’åˆ†ï¼Œå·®åˆ«ä¸å¤§ã€‚åè€Œæ˜¯å‰ªææ–¹æ³•å¯¹äºæœ€ä¼˜æ ‘çš„ç”Ÿæˆæ›´ä¸ºå…³é”®ã€‚ CARTåˆ†ç±»å†³ç­–æ ‘ GINIæŒ‡æ•° CARTçš„åˆ†æ”¯æ ‡å‡†å»ºç«‹åœ¨GINIæŒ‡æ•°è¿™ä¸ªæ¦‚å¿µä¸Šï¼ŒGINIæŒ‡æ•°ä¸»è¦æ˜¯åº¦é‡æ•°æ®åˆ’åˆ†çš„ä¸çº¯åº¦ï¼Œæ˜¯ä»‹äº0~1ä¹‹é—´çš„æ•°ã€‚GINIå€¼è¶Šå°ï¼Œè¡¨æ˜æ ·æœ¬é›†åˆçš„çº¯å‡€åº¦è¶Šé«˜ï¼›GINIå€¼è¶Šå¤§è¡¨æ˜æ ·æœ¬é›†åˆçš„ç±»åˆ«è¶Šæ‚ä¹±\nCARTåˆ†ç±»æ—¶ï¼Œä½¿ç”¨åŸºå°¼æŒ‡æ•°ï¼ˆGiniï¼‰æ¥é€‰æ‹©æœ€å¥½çš„æ•°æ®åˆ†å‰²çš„ç‰¹å¾ï¼Œginiæè¿°çš„æ˜¯çº¯åº¦ï¼Œä¸ä¿¡æ¯ç†µçš„å«ä¹‰ç›¸ä¼¼ã€‚CARTä¸­æ¯ä¸€æ¬¡è¿­ä»£éƒ½ä¼šé™ä½GINIç³»æ•°ã€‚æœ€å¥½çš„åˆ’åˆ†å°±æ˜¯ä½¿å¾—GINI_Gainæœ€å°çš„åˆ’åˆ†ã€‚\nåœæ­¢æ¡ä»¶ å†³ç­–æ ‘çš„æ„å»ºè¿‡ç¨‹æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥éœ€è¦ç¡®å®šåœæ­¢æ¡ä»¶ï¼Œå¦åˆ™è¿‡ç¨‹å°†ä¸ä¼šç»“æŸã€‚ä¸€ç§æœ€ç›´è§‚çš„æ–¹å¼æ˜¯å½“æ¯ä¸ªå­èŠ‚ç‚¹åªæœ‰ä¸€ç§ç±»å‹çš„è®°å½•æ—¶åœæ­¢ï¼Œä½†æ˜¯è¿™æ ·å¾€å¾€ä¼šä½¿å¾—æ ‘çš„èŠ‚ç‚¹è¿‡å¤šï¼Œå¯¼è‡´è¿‡æ‹Ÿåˆé—®é¢˜ï¼ˆOverfittingï¼‰ã€‚å¦ä¸€ç§å¯è¡Œçš„æ–¹æ³•æ˜¯å½“å‰èŠ‚ç‚¹ä¸­çš„è®°å½•æ•°ä½äºä¸€ä¸ªæœ€å°çš„é˜€å€¼ï¼Œé‚£ä¹ˆå°±åœæ­¢åˆ†å‰²ï¼Œå°†max(P(i))å¯¹åº”çš„åˆ†ç±»ä½œä¸ºå½“å‰å¶èŠ‚ç‚¹çš„åˆ†ç±»ã€‚\nè¿‡åº¦æ‹Ÿåˆ é‡‡ç”¨ä¸Šé¢ç®—æ³•ç”Ÿæˆçš„å†³ç­–æ ‘åœ¨äº‹ä»¶ä¸­å¾€å¾€ä¼šå¯¼è‡´è¿‡åº¦æ‹Ÿåˆã€‚ä¹Ÿå°±æ˜¯è¯¥å†³ç­–æ ‘å¯¹è®­ç»ƒæ•°æ®å¯ä»¥å¾—åˆ°å¾ˆä½çš„é”™è¯¯ç‡ï¼Œä½†æ˜¯è¿ç”¨åˆ°æµ‹è¯•æ•°æ®ä¸Šå´å¾—åˆ°éå¸¸é«˜çš„é”™è¯¯ç‡ã€‚è¿‡æ¸¡æ‹Ÿåˆçš„åŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š â€¢å™ªéŸ³æ•°æ®ï¼šè®­ç»ƒæ•°æ®ä¸­å­˜åœ¨å™ªéŸ³æ•°æ®ï¼Œå†³ç­–æ ‘çš„æŸäº›èŠ‚ç‚¹æœ‰å™ªéŸ³æ•°æ®ä½œä¸ºåˆ†å‰²æ ‡å‡†ï¼Œå¯¼è‡´å†³ç­–æ ‘æ— æ³•ä»£è¡¨çœŸå®æ•°æ®ã€‚ â€¢ç¼ºå°‘ä»£è¡¨æ€§æ•°æ®ï¼šè®­ç»ƒæ•°æ®æ²¡æœ‰åŒ…å«æ‰€æœ‰å…·æœ‰ä»£è¡¨æ€§çš„æ•°æ®ï¼Œå¯¼è‡´æŸä¸€ç±»æ•°æ®æ— æ³•å¾ˆå¥½çš„åŒ¹é…ï¼Œè¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡è§‚å¯Ÿæ··æ·†çŸ©é˜µï¼ˆConfusion Matrixï¼‰åˆ†æå¾—å‡ºã€‚ â€¢å¤šé‡æ¯”è¾ƒï¼ˆMulitple Comparisionï¼‰ï¼šä¸¾ä¸ªåˆ—å­ï¼Œè‚¡ç¥¨åˆ†æå¸ˆé¢„æµ‹è‚¡ç¥¨æ¶¨æˆ–è·Œã€‚å‡è®¾åˆ†æå¸ˆéƒ½æ˜¯é éšæœºçŒœæµ‹ï¼Œä¹Ÿå°±æ˜¯ä»–ä»¬æ­£ç¡®çš„æ¦‚ç‡æ˜¯0.5ã€‚æ¯ä¸€ä¸ªäººé¢„æµ‹10æ¬¡ï¼Œé‚£ä¹ˆé¢„æµ‹æ­£ç¡®çš„æ¬¡æ•°åœ¨8æ¬¡æˆ–8æ¬¡ä»¥ä¸Šçš„æ¦‚ç‡ä¸º ï¼ŒC810âˆ—(0.5)10+C910âˆ—(0.5)10+C1010âˆ—(0.5)10C108âˆ—(0.5)10+C109âˆ—(0.5)10+C1010âˆ—(0.5)10åªæœ‰5%å·¦å³ï¼Œæ¯”è¾ƒä½ã€‚ä½†æ˜¯å¦‚æœ50ä¸ªåˆ†æå¸ˆï¼Œæ¯ä¸ªäººé¢„æµ‹10æ¬¡ï¼Œé€‰æ‹©è‡³å°‘ä¸€ä¸ªäººå¾—åˆ°8æ¬¡æˆ–ä»¥ä¸Šçš„äººä½œä¸ºä»£è¡¨ï¼Œé‚£ä¹ˆæ¦‚ç‡ä¸º 1âˆ’(1âˆ’0.0547)50=0.93991âˆ’(1âˆ’0.0547)50=0.9399ï¼Œæ¦‚ç‡ååˆ†å¤§ï¼Œéšç€åˆ†æå¸ˆäººæ•°çš„å¢åŠ ï¼Œæ¦‚ç‡æ— é™æ¥è¿‘1ã€‚ä½†æ˜¯ï¼Œé€‰å‡ºæ¥çš„åˆ†æå¸ˆå…¶å®æ˜¯æ‰“é…±æ²¹çš„ï¼Œä»–å¯¹æœªæ¥çš„é¢„æµ‹ä¸èƒ½åšä»»ä½•ä¿è¯ã€‚ä¸Šé¢è¿™ä¸ªä¾‹å­å°±æ˜¯å¤šé‡æ¯”è¾ƒã€‚è¿™ä¸€æƒ…å†µå’Œå†³ç­–æ ‘é€‰å–åˆ†å‰²ç‚¹ç±»ä¼¼ï¼Œéœ€è¦åœ¨æ¯ä¸ªå˜é‡çš„æ¯ä¸€ä¸ªå€¼ä¸­é€‰å–ä¸€ä¸ªä½œä¸ºåˆ†å‰²çš„ä»£è¡¨ï¼Œæ‰€ä»¥é€‰å‡ºä¸€ä¸ªå™ªéŸ³åˆ†å‰²æ ‡å‡†çš„æ¦‚ç‡æ˜¯å¾ˆå¤§çš„ã€‚\nä¼˜åŒ–æ–¹æ¡ˆ1ï¼šä¿®å‰ªæå¶ å†³ç­–æ ‘è¿‡æ¸¡æ‹Ÿåˆå¾€å¾€æ˜¯å› ä¸ºå¤ªè¿‡â€œèŒ‚ç››â€ï¼Œä¹Ÿå°±æ˜¯èŠ‚ç‚¹è¿‡å¤šï¼Œæ‰€ä»¥éœ€è¦è£å‰ªï¼ˆPrune Treeï¼‰æå¶ã€‚è£å‰ªæå¶çš„ç­–ç•¥å¯¹å†³ç­–æ ‘æ­£ç¡®ç‡çš„å½±å“å¾ˆå¤§ã€‚ä¸»è¦æœ‰ä¸¤ç§è£å‰ªç­–ç•¥ã€‚\nå‰ç½®è£å‰ª ï¼ˆPrePruneï¼šé¢„å‰ªæï¼‰åœ¨æ„å»ºå†³ç­–æ ‘çš„è¿‡ç¨‹æ—¶ï¼Œæå‰åœæ­¢ã€‚é‚£ä¹ˆï¼Œä¼šå°†åˆ‡åˆ†èŠ‚ç‚¹çš„æ¡ä»¶è®¾ç½®çš„å¾ˆè‹›åˆ»ï¼Œå¯¼è‡´å†³ç­–æ ‘å¾ˆçŸ­å°ã€‚ç»“æœå°±æ˜¯å†³ç­–æ ‘æ— æ³•è¾¾åˆ°æœ€ä¼˜ã€‚å®è·µè¯æ˜è¿™ä¸­ç­–ç•¥æ— æ³•å¾—åˆ°è¾ƒå¥½çš„ç»“æœã€‚\nåç½®è£å‰ªï¼ˆPostPruneï¼šåå‰ªæï¼‰ å†³ç­–æ ‘æ„å»ºå¥½åï¼Œç„¶åæ‰å¼€å§‹è£å‰ªã€‚é‡‡ç”¨ä¸¤ç§æ–¹æ³•ï¼š1ï¼‰ç”¨å•ä¸€å¶èŠ‚ç‚¹ä»£æ›¿æ•´ä¸ªå­æ ‘ï¼Œå¶èŠ‚ç‚¹çš„åˆ†ç±»é‡‡ç”¨å­æ ‘ä¸­æœ€ä¸»è¦çš„åˆ†ç±»ï¼›2ï¼‰å°†ä¸€ä¸ªå­—æ•°å®Œå…¨æ›¿ä»£å¦å¤–ä¸€é¢—å­æ ‘ã€‚åç½®è£å‰ªæœ‰ä¸ªé—®é¢˜å°±æ˜¯è®¡ç®—æ•ˆç‡ï¼Œæœ‰äº›èŠ‚ç‚¹è®¡ç®—åå°±è¢«è£å‰ªäº†ï¼Œå¯¼è‡´æœ‰ç‚¹æµªè´¹ã€‚\nå‰ªæå¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šé¢„å‰ªæ(Pre-Pruning)å’Œåå‰ªæ(Post-Pruning),ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†å­¦ä¹ ä¸‹è¿™ä¸¤ç§æ–¹æ³•ï¼š PrePruneï¼šé¢„å‰ªæï¼ŒåŠæ—©çš„åœæ­¢æ ‘å¢é•¿ï¼Œæ–¹æ³•å¯ä»¥å‚è€ƒè§ä¸Šé¢æ ‘åœæ­¢å¢é•¿çš„æ–¹æ³•ã€‚ PostPruneï¼šåå‰ªæï¼Œåœ¨å·²ç”Ÿæˆè¿‡æ‹Ÿåˆå†³ç­–æ ‘ä¸Šè¿›è¡Œå‰ªæï¼Œå¯ä»¥å¾—åˆ°ç®€åŒ–ç‰ˆçš„å‰ªæå†³ç­–æ ‘ã€‚\nä¼˜åŒ–æ–¹æ¡ˆ2ï¼šK-Fold Cross Validation é¦–å…ˆè®¡ç®—å‡ºæ•´ä½“çš„å†³ç­–æ ‘Tï¼Œå¶èŠ‚ç‚¹ä¸ªæ•°è®°ä½œNï¼Œè®¾iå±äº[1,N]ã€‚å¯¹æ¯ä¸ªiï¼Œä½¿ç”¨K-Fold Validataionæ–¹æ³•è®¡ç®—å†³ç­–æ ‘ï¼Œå¹¶è£å‰ªåˆ°iä¸ªèŠ‚ç‚¹ï¼Œè®¡ç®—é”™è¯¯ç‡ï¼Œæœ€åæ±‚å‡ºå¹³å‡é”™è¯¯ç‡ã€‚ï¼ˆæ„æ€æ˜¯è¯´å¯¹æ¯ä¸€ä¸ªå¯èƒ½çš„iï¼Œéƒ½åšKæ¬¡ï¼Œç„¶åå–Kæ¬¡çš„å¹³å‡é”™è¯¯ç‡ã€‚ï¼‰è¿™æ ·å¯ä»¥ç”¨å…·æœ‰æœ€å°é”™è¯¯ç‡å¯¹åº”çš„iä½œä¸ºæœ€ç»ˆå†³ç­–æ ‘çš„å¤§å°ï¼Œå¯¹åŸå§‹å†³ç­–æ ‘è¿›è¡Œè£å‰ªï¼Œå¾—åˆ°æœ€ä¼˜å†³ç­–æ ‘ã€‚\nä¼˜åŒ–æ–¹æ¡ˆ3ï¼šRandom Forest Random Forestæ˜¯ç”¨è®­ç»ƒæ•°æ®éšæœºçš„è®¡ç®—å‡ºè®¸å¤šå†³ç­–æ ‘ï¼Œå½¢æˆäº†ä¸€ä¸ªæ£®æ—ã€‚ç„¶åç”¨è¿™ä¸ªæ£®æ—å¯¹æœªçŸ¥æ•°æ®è¿›è¡Œé¢„æµ‹ï¼Œé€‰å–æŠ•ç¥¨æœ€å¤šçš„åˆ†ç±»ã€‚å®è·µè¯æ˜ï¼Œæ­¤ç®—æ³•çš„é”™è¯¯ç‡å¾—åˆ°äº†ç»ä¸€æ­¥çš„é™ä½ã€‚è¿™ç§æ–¹æ³•èƒŒåçš„åŸç†å¯ä»¥ç”¨â€œä¸‰ä¸ªè‡­çš®åŒ å®šä¸€ä¸ªè¯¸è‘›äº®â€è¿™å¥è°šè¯­æ¥æ¦‚æ‹¬ã€‚ä¸€é¢—æ ‘é¢„æµ‹æ­£ç¡®çš„æ¦‚ç‡å¯èƒ½ä¸é«˜ï¼Œä½†æ˜¯é›†ä½“é¢„æµ‹æ­£ç¡®çš„æ¦‚ç‡å´å¾ˆé«˜ã€‚RFæ˜¯éå¸¸å¸¸ç”¨çš„åˆ†ç±»ç®—æ³•ï¼Œæ•ˆæœä¸€èˆ¬éƒ½å¾ˆå¥½ã€‚\nOKï¼Œå†³ç­–æ ‘å°±è®²åˆ°è¿™é‡Œï¼Œå•†ç”¨çš„å†³ç­–æ ‘C5.0äº†è§£ä¸æ˜¯å¾ˆå¤šï¼›è¿˜æœ‰åˆ†ç±»å›å½’æ ‘CARTä¹Ÿå¾ˆå¸¸ç”¨ã€‚\n","permalink":"https://reid00.github.io/en/posts/ml/%E5%86%B3%E7%AD%96%E6%A0%91/","summary":"å†³ç­–æ ‘ å†³ç­–æ ‘ï¼ˆdecision treeï¼‰æ˜¯ä¸€ä¸ªæ ‘ç»“æ„ï¼ˆå¯ä»¥æ˜¯äºŒå‰æ ‘æˆ–éäºŒå‰æ ‘ï¼‰ã€‚å…¶æ¯ä¸ªéå¶èŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªç‰¹å¾å±æ€§ä¸Šçš„æµ‹è¯•ï¼Œæ¯ä¸ªåˆ†æ”¯ä»£è¡¨è¿™ä¸ªç‰¹å¾å±æ€§åœ¨æŸä¸ªå€¼åŸŸä¸Šçš„è¾“å‡ºï¼Œè€Œæ¯ä¸ªå¶èŠ‚ç‚¹å­˜æ”¾ä¸€ä¸ªç±»åˆ«ã€‚ä½¿ç”¨å†³ç­–æ ‘è¿›è¡Œå†³ç­–çš„è¿‡ç¨‹å°±æ˜¯ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œæµ‹è¯•å¾…åˆ†ç±»é¡¹ä¸­ç›¸åº”çš„ç‰¹å¾å±æ€§ï¼Œå¹¶æŒ‰ç…§å…¶å€¼é€‰æ‹©è¾“å‡ºåˆ†æ”¯ï¼Œç›´åˆ°åˆ°è¾¾å¶å­èŠ‚ç‚¹ï¼Œå°†å¶å­èŠ‚ç‚¹å­˜æ”¾çš„ç±»åˆ«ä½œä¸ºå†³ç­–ç»“æœ[1]ã€‚ ä¸‹é¢å…ˆæ¥çœ‹ä¸€ä¸ªå°ä¾‹å­ï¼Œçœ‹çœ‹å†³ç­–æ ‘åˆ°åº•æ˜¯ä»€ä¹ˆæ¦‚å¿µï¼ˆè¿™ä¸ªä¾‹å­æ¥æºäº[2]ï¼‰ã€‚\nå†³ç­–æ ‘çš„è®­ç»ƒæ•°æ®å¾€å¾€å°±æ˜¯è¿™æ ·çš„è¡¨æ ¼å½¢å¼ï¼Œè¡¨ä¸­çš„å‰ä¸‰åˆ—ï¼ˆIDä¸ç®—ï¼‰æ˜¯æ•°æ®æ ·æœ¬çš„å±æ€§ï¼Œæœ€åä¸€åˆ—æ˜¯å†³ç­–æ ‘éœ€è¦åšçš„åˆ†ç±»ç»“æœã€‚é€šè¿‡è¯¥æ•°æ®ï¼Œæ„å»ºçš„å†³ç­–æ ‘å¦‚ä¸‹ï¼š\næœ‰äº†è¿™æ£µæ ‘ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹æ–°æ¥çš„ç”¨æˆ·æ•°æ®è¿›è¡Œæ˜¯å¦å¯ä»¥å¿è¿˜çš„é¢„æµ‹äº†ã€‚\nå†³ç­–æ ‘æœ€é‡è¦çš„æ˜¯å†³ç­–æ ‘çš„æ„é€ ã€‚æ‰€è°“å†³ç­–æ ‘çš„æ„é€ å°±æ˜¯è¿›è¡Œå±æ€§é€‰æ‹©åº¦é‡ç¡®å®šå„ä¸ªç‰¹å¾å±æ€§ä¹‹é—´çš„æ‹“æ‰‘ç»“æ„ã€‚æ„é€ å†³ç­–æ ‘çš„å…³é”®æ­¥éª¤æ˜¯åˆ†è£‚å±æ€§ã€‚æ‰€è°“åˆ†è£‚å±æ€§å°±æ˜¯åœ¨æŸä¸ªèŠ‚ç‚¹å¤„æŒ‰ç…§æŸä¸€ç‰¹å¾å±æ€§çš„ä¸åŒåˆ’åˆ†æ„é€ ä¸åŒçš„åˆ†æ”¯ï¼Œå…¶ç›®æ ‡æ˜¯è®©å„ä¸ªåˆ†è£‚å­é›†å°½å¯èƒ½åœ°â€œçº¯â€ã€‚å°½å¯èƒ½â€œçº¯â€å°±æ˜¯å°½é‡è®©ä¸€ä¸ªåˆ†è£‚å­é›†ä¸­å¾…åˆ†ç±»é¡¹å±äºåŒä¸€ç±»åˆ«ã€‚åˆ†è£‚å±æ€§åˆ†ä¸ºä¸‰ç§ä¸åŒçš„æƒ…å†µ[1]ï¼š 1ã€å±æ€§æ˜¯ç¦»æ•£å€¼ä¸”ä¸è¦æ±‚ç”ŸæˆäºŒå‰å†³ç­–æ ‘ã€‚æ­¤æ—¶ç”¨å±æ€§çš„æ¯ä¸€ä¸ªåˆ’åˆ†ä½œä¸ºä¸€ä¸ªåˆ†æ”¯ã€‚ 2ã€å±æ€§æ˜¯ç¦»æ•£å€¼ä¸”è¦æ±‚ç”ŸæˆäºŒå‰å†³ç­–æ ‘ã€‚æ­¤æ—¶ä½¿ç”¨å±æ€§åˆ’åˆ†çš„ä¸€ä¸ªå­é›†è¿›è¡Œæµ‹è¯•ï¼ŒæŒ‰ç…§â€œå±äºæ­¤å­é›†â€å’Œâ€œä¸å±äºæ­¤å­é›†â€åˆ†æˆä¸¤ä¸ªåˆ†æ”¯ã€‚ 3ã€å±æ€§æ˜¯è¿ç»­å€¼ã€‚æ­¤æ—¶ç¡®å®šä¸€ä¸ªå€¼ä½œä¸ºåˆ†è£‚ç‚¹split_pointï¼ŒæŒ‰ç…§\u0026gt;split_pointå’Œ\u0026lt;=split_pointç”Ÿæˆä¸¤ä¸ªåˆ†æ”¯ã€‚\nå†³ç­–æ ‘çš„å±æ€§åˆ†è£‚é€‰æ‹©æ˜¯â€è´ªå¿ƒâ€œç®—æ³•ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰å›æº¯çš„ã€‚\nID3.5 å¥½äº†ï¼Œæ¥ä¸‹æ¥è¯´ä¸€ä¸‹æ•™ç§‘ä¹¦ä¸Šæåˆ°æœ€å¤šçš„å†³ç­–æ ‘ID3.5ç®—æ³•ï¼ˆæ˜¯æœ€åŸºæœ¬çš„æ¨¡å‹ï¼Œç®€å•å®ç”¨ï¼Œä½†æ˜¯åœ¨æŸäº›åœºåˆä¸‹ä¹Ÿæœ‰ç¼ºé™·ï¼‰ã€‚\nä¿¡æ¯è®ºä¸­æœ‰ç†µï¼ˆentropyï¼‰çš„æ¦‚å¿µï¼Œè¡¨ç¤ºçŠ¶æ€çš„æ··ä¹±ç¨‹åº¦ï¼Œç†µè¶Šå¤§è¶Šæ··ä¹±ã€‚ç†µçš„å˜åŒ–å¯ä»¥çœ‹åšæ˜¯ä¿¡æ¯å¢ç›Šï¼Œå†³ç­–æ ‘ID3ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä»¥ä¿¡æ¯å¢ç›Šåº¦é‡å±æ€§é€‰æ‹©ï¼Œé€‰æ‹©åˆ†è£‚åä¿¡æ¯å¢ç›Šæœ€å¤§çš„å±æ€§è¿›è¡Œåˆ†è£‚ã€‚\nè®¾Dä¸ºç”¨ï¼ˆè¾“å‡ºï¼‰ç±»åˆ«å¯¹è®­ç»ƒå…ƒç»„è¿›è¡Œçš„åˆ’åˆ†ï¼Œåˆ™Dçš„ç†µè¡¨ç¤ºä¸ºï¼š info(D)=âˆ’âˆ‘i=1mpilog2(pi)info(D)=âˆ’âˆ‘i=1mpilog2â¡(pi)\nå…¶ä¸­pipiè¡¨ç¤ºç¬¬iä¸ªç±»åˆ«åœ¨æ•´ä¸ªè®­ç»ƒå…ƒç»„ä¸­å‡ºç°çš„æ¦‚ç‡ï¼Œä¸€èˆ¬æ¥è¯´ä¼šç”¨è¿™ä¸ªç±»åˆ«çš„æ ·æœ¬æ•°é‡å æ€»é‡çš„å æ¯”æ¥ä½œä¸ºæ¦‚ç‡çš„ä¼°è®¡ï¼›ç†µçš„å®é™…æ„ä¹‰è¡¨ç¤ºæ˜¯Dä¸­å…ƒç»„çš„ç±»æ ‡å·æ‰€éœ€è¦çš„å¹³å‡ä¿¡æ¯é‡ã€‚ç†µçš„å«ä¹‰å¯ä»¥çœ‹æˆ‘å‰é¢å†™çš„PRML ch1.6 ä¿¡æ¯è®ºçš„ä»‹ç»ã€‚ å¦‚æœå°†è®­ç»ƒå…ƒç»„DæŒ‰å±æ€§Aè¿›è¡Œåˆ’åˆ†ï¼Œåˆ™Aå¯¹Dåˆ’åˆ†çš„æœŸæœ›ä¿¡æ¯ä¸ºï¼š infoA(D)=âˆ‘j=1v|Dj||D|info(Dj) infoA(D)=âˆ‘j=1v|Dj||D|info(Dj) äºæ˜¯ï¼Œä¿¡æ¯å¢ç›Šå°±æ˜¯ä¸¤è€…çš„å·®å€¼ï¼š gain(A)=info(D)âˆ’infoA(D) gain(A)=info(D)âˆ’infoA(D) ID3å†³ç­–æ ‘ç®—æ³•å°±ç”¨åˆ°ä¸Šé¢çš„ä¿¡æ¯å¢ç›Šï¼Œåœ¨æ¯æ¬¡åˆ†è£‚çš„æ—¶å€™è´ªå¿ƒé€‰æ‹©ä¿¡æ¯å¢ç›Šæœ€å¤§çš„å±æ€§ï¼Œä½œä¸ºæœ¬æ¬¡åˆ†è£‚å±æ€§ã€‚æ¯æ¬¡åˆ†è£‚å°±ä¼šä½¿å¾—æ ‘é•¿é«˜ä¸€å±‚ã€‚è¿™æ ·é€æ­¥ç”Ÿäº§ä¸‹å»ï¼Œå°±ä¸€å®šå¯ä»¥æ„å»ºä¸€é¢—å†³ç­–æ ‘ã€‚ï¼ˆåŸºæœ¬åŸç†å°±æ˜¯è¿™æ ·ï¼Œä½†æ˜¯å®é™…ä¸­ï¼Œä¸ºäº†é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œä»¥åŠå¯èƒ½é‡åˆ°å¶å­èŠ‚ç‚¹ç±»åˆ«ä¸çº¯çš„æƒ…å†µï¼Œéœ€è¦æœ‰ä¸€äº›ç‰¹æ®Šçš„trickï¼Œè¿™äº›ç•™åˆ°æœ€åè®²ï¼‰\nOKï¼Œå€Ÿé‰´ä¸€ä¸‹[1]ä¸­çš„ä¸€ä¸ªå°ä¾‹å­ï¼Œæ¥çœ‹ä¸€ä¸‹ä¿¡æ¯å¢ç›Šçš„è®¡ç®—è¿‡ç¨‹ã€‚\nè¿™ä¸ªä¾‹å­æ˜¯è¿™æ ·çš„ï¼šè¾“å…¥æ ·æœ¬çš„å±æ€§æœ‰ä¸‰ä¸ªâ€”â€”æ—¥å¿—å¯†åº¦ï¼ˆLï¼‰ï¼Œå¥½å‹å¯†åº¦ï¼ˆFï¼‰ï¼Œä»¥åŠæ˜¯å¦ä½¿ç”¨çœŸå®å¤´åƒï¼ˆHï¼‰ï¼›æ ·æœ¬çš„æ ‡è®°æ˜¯è´¦å·æ˜¯å¦çœŸå®yes or noã€‚\nç„¶åå¯ä»¥ä¸€æ¬¡è®¡ç®—æ¯ä¸€ä¸ªå±æ€§çš„ä¿¡æ¯å¢ç›Šï¼Œæ¯”å¦‚æ—¥è‡´å¯†åº¦çš„ä¿¡æ¯å¢ç›Šæ˜¯0.276ã€‚\nåŒç†å¯å¾—Hå’ŒFçš„ä¿¡æ¯å¢ç›Šä¸º0.033å’Œ0.553ã€‚å› ä¸ºFå…·æœ‰æœ€å¤§çš„ä¿¡æ¯å¢ç›Šï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡åˆ†è£‚é€‰æ‹©Fä¸ºåˆ†è£‚å±æ€§ï¼Œåˆ†è£‚åçš„ç»“æœå¦‚ä¸‹å›¾è¡¨ç¤ºï¼š\nä¸Šé¢ä¸ºäº†ç®€ä¾¿ï¼Œå°†ç‰¹å¾å±æ€§ç¦»æ•£åŒ–äº†ï¼Œå…¶å®æ—¥å¿—å¯†åº¦å’Œå¥½å‹å¯†åº¦éƒ½æ˜¯è¿ç»­çš„å±æ€§ã€‚å¯¹äºç‰¹å¾å±æ€§ä¸ºè¿ç»­å€¼ï¼Œå¯ä»¥å¦‚æ­¤ä½¿ç”¨ID3ç®—æ³•ï¼šå…ˆå°†Dä¸­å…ƒç´ æŒ‰ç…§ç‰¹å¾å±æ€§æ’åºï¼Œåˆ™æ¯ä¸¤ä¸ªç›¸é‚»å…ƒç´ çš„ä¸­é—´ç‚¹å¯ä»¥çœ‹åšæ½œåœ¨åˆ†è£‚ç‚¹ï¼Œä»ç¬¬ä¸€ä¸ªæ½œåœ¨åˆ†è£‚ç‚¹å¼€å§‹ï¼Œåˆ†è£‚Då¹¶è®¡ç®—ä¸¤ä¸ªé›†åˆçš„æœŸæœ›ä¿¡æ¯ï¼Œå…·æœ‰æœ€å°æœŸæœ›ä¿¡æ¯çš„ç‚¹ç§°ä¸ºè¿™ä¸ªå±æ€§çš„æœ€ä½³åˆ†è£‚ç‚¹ï¼Œå…¶ä¿¡æ¯æœŸæœ›ä½œä¸ºæ­¤å±æ€§çš„ä¿¡æ¯æœŸæœ›ã€‚\nC4.5 ID3æœ‰ä¸€äº›ç¼ºé™·ï¼Œå°±æ˜¯é€‰æ‹©çš„æ—¶å€™å®¹æ˜“é€‰æ‹©ä¸€äº›æ¯”è¾ƒå®¹æ˜“åˆ†çº¯å‡€çš„å±æ€§ï¼Œå°¤å…¶åœ¨å…·æœ‰åƒIDå€¼è¿™æ ·çš„å±æ€§ï¼Œå› ä¸ºæ¯ä¸ªIDéƒ½å¯¹åº”ä¸€ä¸ªç±»åˆ«ï¼Œæ‰€ä»¥åˆ†çš„å¾ˆçº¯å‡€ï¼ŒID3æ¯”è¾ƒå€¾å‘æ‰¾åˆ°è¿™æ ·çš„å±æ€§åšåˆ†è£‚ã€‚\nC4.5ç®—æ³•å®šä¹‰äº†åˆ†è£‚ä¿¡æ¯ï¼Œè¡¨ç¤ºä¸ºï¼š split_infoA(D)=âˆ’âˆ‘j=1v|Dj||D|log2(|Dj||D|) split_infoA(D)=âˆ’âˆ‘j=1v|Dj||D|log2â¡(|Dj||D|) å¾ˆå®¹æ˜“ç†è§£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªç†µçš„å®šä¹‰ï¼Œpi=|Dj||D|pi=|Dj||D|ï¼Œå¯ä»¥çœ‹åšæ˜¯å±æ€§åˆ†è£‚çš„ç†µï¼Œåˆ†çš„è¶Šå¤šå°±è¶Šæ··ä¹±ï¼Œç†µè¶Šå¤§ã€‚å®šä¹‰ä¿¡æ¯å¢ç›Šç‡ï¼š gain_ratio(A)=gain(A)split_info(A) gain_ratio(A)=gain(A)split_info(A)\nC4.5å°±æ˜¯é€‰æ‹©æœ€å¤§å¢ç›Šç‡çš„å±æ€§æ¥åˆ†è£‚ï¼Œå…¶ä»–ç±»ä¼¼ID3.5ã€‚\nCART CARTï¼ˆClassification And Regression Treeï¼‰ç®—æ³•æ—¢å¯ä»¥ç”¨äºåˆ›å»ºåˆ†ç±»æ ‘ï¼Œä¹Ÿå¯ä»¥ç”¨äºåˆ›å»ºå›å½’æ ‘ã€‚CARTç®—æ³•çš„é‡è¦ç‰¹ç‚¹åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š\näºŒåˆ†(Binary Split)ï¼šåœ¨æ¯æ¬¡åˆ¤æ–­è¿‡ç¨‹ä¸­ï¼Œéƒ½æ˜¯å¯¹æ ·æœ¬æ•°æ®è¿›è¡ŒäºŒåˆ†ã€‚CARTç®—æ³•æ˜¯ä¸€ç§äºŒåˆ†é€’å½’åˆ†å‰²æŠ€æœ¯ï¼ŒæŠŠå½“å‰æ ·æœ¬åˆ’åˆ†ä¸ºä¸¤ä¸ªå­æ ·æœ¬ï¼Œä½¿å¾—ç”Ÿæˆçš„æ¯ä¸ªéå¶å­ç»“ç‚¹éƒ½æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼Œå› æ­¤CARTç®—æ³•ç”Ÿæˆçš„å†³ç­–æ ‘æ˜¯ç»“æ„ç®€æ´çš„äºŒå‰æ ‘ã€‚ç”±äºCARTç®—æ³•æ„æˆçš„æ˜¯ä¸€ä¸ªäºŒå‰æ ‘ï¼Œå®ƒåœ¨æ¯ä¸€æ­¥çš„å†³ç­–æ—¶åªèƒ½æ˜¯â€œæ˜¯â€æˆ–è€…â€œå¦â€ï¼Œå³ä½¿ä¸€ä¸ªfeatureæœ‰å¤šä¸ªå–å€¼ï¼Œä¹Ÿæ˜¯æŠŠæ•°æ®åˆ†ä¸ºä¸¤éƒ¨åˆ† å•å˜é‡åˆ†å‰²(Split Based on One Variable)ï¼šæ¯æ¬¡æœ€ä¼˜åˆ’åˆ†éƒ½æ˜¯é’ˆå¯¹å•ä¸ªå˜é‡ã€‚ å‰ªæç­–ç•¥ï¼šCARTç®—æ³•çš„å…³é”®ç‚¹ï¼Œä¹Ÿæ˜¯æ•´ä¸ªTree-Basedç®—æ³•çš„å…³é”®æ­¥éª¤ã€‚å‰ªæè¿‡ç¨‹ç‰¹åˆ«é‡è¦ï¼Œæ‰€ä»¥åœ¨æœ€ä¼˜å†³ç­–æ ‘ç”Ÿæˆè¿‡ç¨‹ä¸­å æœ‰é‡è¦åœ°ä½ã€‚æœ‰ç ”ç©¶è¡¨æ˜ï¼Œå‰ªæè¿‡ç¨‹çš„é‡è¦æ€§è¦æ¯”æ ‘ç”Ÿæˆè¿‡ç¨‹æ›´ä¸ºé‡è¦ï¼Œå¯¹äºä¸åŒçš„åˆ’åˆ†æ ‡å‡†ç”Ÿæˆçš„æœ€å¤§æ ‘(Maximum Tree)ï¼Œåœ¨å‰ªæä¹‹åéƒ½èƒ½å¤Ÿä¿ç•™æœ€é‡è¦çš„å±æ€§åˆ’åˆ†ï¼Œå·®åˆ«ä¸å¤§ã€‚åè€Œæ˜¯å‰ªææ–¹æ³•å¯¹äºæœ€ä¼˜æ ‘çš„ç”Ÿæˆæ›´ä¸ºå…³é”®ã€‚ CARTåˆ†ç±»å†³ç­–æ ‘ GINIæŒ‡æ•° CARTçš„åˆ†æ”¯æ ‡å‡†å»ºç«‹åœ¨GINIæŒ‡æ•°è¿™ä¸ªæ¦‚å¿µä¸Šï¼ŒGINIæŒ‡æ•°ä¸»è¦æ˜¯åº¦é‡æ•°æ®åˆ’åˆ†çš„ä¸çº¯åº¦ï¼Œæ˜¯ä»‹äº0~1ä¹‹é—´çš„æ•°ã€‚GINIå€¼è¶Šå°ï¼Œè¡¨æ˜æ ·æœ¬é›†åˆçš„çº¯å‡€åº¦è¶Šé«˜ï¼›GINIå€¼è¶Šå¤§è¡¨æ˜æ ·æœ¬é›†åˆçš„ç±»åˆ«è¶Šæ‚ä¹±\nCARTåˆ†ç±»æ—¶ï¼Œä½¿ç”¨åŸºå°¼æŒ‡æ•°ï¼ˆGiniï¼‰æ¥é€‰æ‹©æœ€å¥½çš„æ•°æ®åˆ†å‰²çš„ç‰¹å¾ï¼Œginiæè¿°çš„æ˜¯çº¯åº¦ï¼Œä¸ä¿¡æ¯ç†µçš„å«ä¹‰ç›¸ä¼¼ã€‚CARTä¸­æ¯ä¸€æ¬¡è¿­ä»£éƒ½ä¼šé™ä½GINIç³»æ•°ã€‚æœ€å¥½çš„åˆ’åˆ†å°±æ˜¯ä½¿å¾—GINI_Gainæœ€å°çš„åˆ’åˆ†ã€‚\nåœæ­¢æ¡ä»¶ å†³ç­–æ ‘çš„æ„å»ºè¿‡ç¨‹æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥éœ€è¦ç¡®å®šåœæ­¢æ¡ä»¶ï¼Œå¦åˆ™è¿‡ç¨‹å°†ä¸ä¼šç»“æŸã€‚ä¸€ç§æœ€ç›´è§‚çš„æ–¹å¼æ˜¯å½“æ¯ä¸ªå­èŠ‚ç‚¹åªæœ‰ä¸€ç§ç±»å‹çš„è®°å½•æ—¶åœæ­¢ï¼Œä½†æ˜¯è¿™æ ·å¾€å¾€ä¼šä½¿å¾—æ ‘çš„èŠ‚ç‚¹è¿‡å¤šï¼Œå¯¼è‡´è¿‡æ‹Ÿåˆé—®é¢˜ï¼ˆOverfittingï¼‰ã€‚å¦ä¸€ç§å¯è¡Œçš„æ–¹æ³•æ˜¯å½“å‰èŠ‚ç‚¹ä¸­çš„è®°å½•æ•°ä½äºä¸€ä¸ªæœ€å°çš„é˜€å€¼ï¼Œé‚£ä¹ˆå°±åœæ­¢åˆ†å‰²ï¼Œå°†max(P(i))å¯¹åº”çš„åˆ†ç±»ä½œä¸ºå½“å‰å¶èŠ‚ç‚¹çš„åˆ†ç±»ã€‚\nè¿‡åº¦æ‹Ÿåˆ é‡‡ç”¨ä¸Šé¢ç®—æ³•ç”Ÿæˆçš„å†³ç­–æ ‘åœ¨äº‹ä»¶ä¸­å¾€å¾€ä¼šå¯¼è‡´è¿‡åº¦æ‹Ÿåˆã€‚ä¹Ÿå°±æ˜¯è¯¥å†³ç­–æ ‘å¯¹è®­ç»ƒæ•°æ®å¯ä»¥å¾—åˆ°å¾ˆä½çš„é”™è¯¯ç‡ï¼Œä½†æ˜¯è¿ç”¨åˆ°æµ‹è¯•æ•°æ®ä¸Šå´å¾—åˆ°éå¸¸é«˜çš„é”™è¯¯ç‡ã€‚è¿‡æ¸¡æ‹Ÿåˆçš„åŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š â€¢å™ªéŸ³æ•°æ®ï¼šè®­ç»ƒæ•°æ®ä¸­å­˜åœ¨å™ªéŸ³æ•°æ®ï¼Œå†³ç­–æ ‘çš„æŸäº›èŠ‚ç‚¹æœ‰å™ªéŸ³æ•°æ®ä½œä¸ºåˆ†å‰²æ ‡å‡†ï¼Œå¯¼è‡´å†³ç­–æ ‘æ— æ³•ä»£è¡¨çœŸå®æ•°æ®ã€‚ â€¢ç¼ºå°‘ä»£è¡¨æ€§æ•°æ®ï¼šè®­ç»ƒæ•°æ®æ²¡æœ‰åŒ…å«æ‰€æœ‰å…·æœ‰ä»£è¡¨æ€§çš„æ•°æ®ï¼Œå¯¼è‡´æŸä¸€ç±»æ•°æ®æ— æ³•å¾ˆå¥½çš„åŒ¹é…ï¼Œè¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡è§‚å¯Ÿæ··æ·†çŸ©é˜µï¼ˆConfusion Matrixï¼‰åˆ†æå¾—å‡ºã€‚ â€¢å¤šé‡æ¯”è¾ƒï¼ˆMulitple Comparisionï¼‰ï¼šä¸¾ä¸ªåˆ—å­ï¼Œè‚¡ç¥¨åˆ†æå¸ˆé¢„æµ‹è‚¡ç¥¨æ¶¨æˆ–è·Œã€‚å‡è®¾åˆ†æå¸ˆéƒ½æ˜¯é éšæœºçŒœæµ‹ï¼Œä¹Ÿå°±æ˜¯ä»–ä»¬æ­£ç¡®çš„æ¦‚ç‡æ˜¯0.5ã€‚æ¯ä¸€ä¸ªäººé¢„æµ‹10æ¬¡ï¼Œé‚£ä¹ˆé¢„æµ‹æ­£ç¡®çš„æ¬¡æ•°åœ¨8æ¬¡æˆ–8æ¬¡ä»¥ä¸Šçš„æ¦‚ç‡ä¸º ï¼ŒC810âˆ—(0.5)10+C910âˆ—(0.5)10+C1010âˆ—(0.5)10C108âˆ—(0.5)10+C109âˆ—(0.5)10+C1010âˆ—(0.5)10åªæœ‰5%å·¦å³ï¼Œæ¯”è¾ƒä½ã€‚ä½†æ˜¯å¦‚æœ50ä¸ªåˆ†æå¸ˆï¼Œæ¯ä¸ªäººé¢„æµ‹10æ¬¡ï¼Œé€‰æ‹©è‡³å°‘ä¸€ä¸ªäººå¾—åˆ°8æ¬¡æˆ–ä»¥ä¸Šçš„äººä½œä¸ºä»£è¡¨ï¼Œé‚£ä¹ˆæ¦‚ç‡ä¸º 1âˆ’(1âˆ’0.","title":"å†³ç­–æ ‘"},{"content":"Summary ç®€å•çš„è¯´ï¼Œk-è¿‘é‚»ç®—æ³•é‡‡ç”¨æµ‹é‡ä¸åŒç‰¹å¾å€¼ä¹‹é—´çš„è·ç¦»æ–¹æ³•è¿›è¡Œåˆ†ç±»ã€‚ å®ƒçš„æ€è·¯æ˜¯ï¼šå¦‚æœä¸€ä¸ªæ ·æœ¬åœ¨ç‰¹å¾ç©ºé—´ä¸­çš„kä¸ªæœ€ç›¸ä¼¼(å³ç‰¹å¾ç©ºé—´ä¸­æœ€é‚»è¿‘)çš„æ ·æœ¬ä¸­çš„å¤§å¤šæ•°å±äºæŸä¸€ä¸ªç±»åˆ«ï¼Œåˆ™è¯¥æ ·æœ¬ä¹Ÿå±äºè¿™ä¸ªç±»åˆ«ï¼Œå…¶ä¸­Ké€šå¸¸æ˜¯ä¸å¤§äº20çš„æ•´æ•°ã€‚KNNç®—æ³•ä¸­ï¼Œæ‰€é€‰æ‹©çš„é‚»å±…éƒ½æ˜¯å·²ç»æ­£ç¡®åˆ†ç±»çš„å¯¹è±¡ã€‚è¯¥æ–¹æ³•åœ¨å®šç±»å†³ç­–ä¸Šåªä¾æ®æœ€é‚»è¿‘çš„ä¸€ä¸ªæˆ–è€…å‡ ä¸ªæ ·æœ¬çš„ç±»åˆ«æ¥å†³å®šå¾…åˆ†æ ·æœ¬æ‰€å±çš„ç±»åˆ«ã€‚\nä¼˜ç‚¹ï¼šç²¾åº¦é«˜ã€å¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿã€æ— æ•°æ®è¾“å…¥å‡å®šã€‚\nç¼ºç‚¹ï¼šè®¡ç®—å¤æ‚åº¦é«˜ã€ç©ºé—´å¤æ‚åº¦é«˜ã€‚\né€‚ç”¨æ•°æ®èŒƒå›´ï¼šæ•°å€¼å‹å’Œæ ‡ç§°å‹ã€‚\nè¯¦ç»†ä»‹ç» ä¸‹é¢é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­è¯´æ˜ä¸€ä¸‹ï¼šå¦‚ä¸‹å›¾ï¼Œç»¿è‰²åœ†è¦è¢«å†³å®šèµ‹äºˆå“ªä¸ªç±»ï¼Œæ˜¯çº¢è‰²ä¸‰è§’å½¢è¿˜æ˜¯è“è‰²å››æ–¹å½¢ï¼Ÿå¦‚æœK=3ï¼Œç”±äºçº¢è‰²ä¸‰è§’å½¢æ‰€å æ¯”ä¾‹ä¸º2/3ï¼Œç»¿è‰²åœ†å°†è¢«èµ‹äºˆçº¢è‰²ä¸‰è§’å½¢é‚£ä¸ªç±»ï¼Œå¦‚æœK=5ï¼Œç”±äºè“è‰²å››æ–¹å½¢æ¯”ä¾‹ä¸º3/5ï¼Œå› æ­¤ç»¿è‰²åœ†è¢«èµ‹äºˆè“è‰²å››æ–¹å½¢ç±»ã€‚\nç”±æ­¤ä¹Ÿè¯´æ˜äº†KNNç®—æ³•çš„ç»“æœå¾ˆå¤§ç¨‹åº¦å–å†³äºKçš„é€‰æ‹©ã€‚\nåœ¨KNNä¸­ï¼Œé€šè¿‡è®¡ç®—å¯¹è±¡é—´è·ç¦»æ¥ä½œä¸ºå„ä¸ªå¯¹è±¡ä¹‹é—´çš„éç›¸ä¼¼æ€§æŒ‡æ ‡ï¼Œé¿å…äº†å¯¹è±¡ä¹‹é—´çš„åŒ¹é…é—®é¢˜ï¼Œåœ¨è¿™é‡Œè·ç¦»ä¸€èˆ¬ä½¿ç”¨æ¬§æ°è·ç¦»æˆ–æ›¼å“ˆé¡¿è·ç¦»ï¼š\n**æ¥ä¸‹æ¥å¯¹KNNç®—æ³•çš„æ€æƒ³æ€»ç»“ä¸€ä¸‹ï¼š**å°±æ˜¯åœ¨è®­ç»ƒé›†ä¸­æ•°æ®å’Œæ ‡ç­¾å·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œè¾“å…¥æµ‹è¯•æ•°æ®ï¼Œå°†æµ‹è¯•æ•°æ®çš„ç‰¹å¾ä¸è®­ç»ƒé›†ä¸­å¯¹åº”çš„ç‰¹å¾è¿›è¡Œç›¸äº’æ¯”è¾ƒï¼Œæ‰¾åˆ°è®­ç»ƒé›†ä¸­ä¸ä¹‹æœ€ä¸ºç›¸ä¼¼çš„å‰Kä¸ªæ•°æ®ï¼Œåˆ™è¯¥æµ‹è¯•æ•°æ®å¯¹åº”çš„ç±»åˆ«å°±æ˜¯Kä¸ªæ•°æ®ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„é‚£ä¸ªåˆ†ç±»ï¼Œå…¶ç®—æ³•çš„æè¿°ä¸ºï¼š\n1ï¼‰è®¡ç®—æµ‹è¯•æ•°æ®ä¸å„ä¸ªè®­ç»ƒæ•°æ®ä¹‹é—´çš„è·ç¦»ï¼›\n2ï¼‰æŒ‰ç…§è·ç¦»çš„é€’å¢å…³ç³»è¿›è¡Œæ’åºï¼›\n3ï¼‰é€‰å–è·ç¦»æœ€å°çš„Kä¸ªç‚¹ï¼›\n4ï¼‰ç¡®å®šå‰Kä¸ªç‚¹æ‰€åœ¨ç±»åˆ«çš„å‡ºç°é¢‘ç‡ï¼›\n5ï¼‰è¿”å›å‰Kä¸ªç‚¹ä¸­å‡ºç°é¢‘ç‡æœ€é«˜çš„ç±»åˆ«ä½œä¸ºæµ‹è¯•æ•°æ®çš„é¢„æµ‹åˆ†ç±»ã€‚\nå¸¸è§é—®é¢˜ 1. Kå€¼è®¾å®šä¸ºå¤šå¤§ï¼Ÿ Kå¤ªå°ï¼Œåˆ†ç±»ç»“æœæ˜“å—å™ªå£°ç‚¹å½±å“ï¼›kå¤ªå¤§ï¼Œè¿‘é‚»ä¸­åˆå¯èƒ½åŒ…å«å¤ªå¤šçš„å…¶å®ƒç±»åˆ«çš„ç‚¹ã€‚ï¼ˆå¯¹è·ç¦»åŠ æƒï¼Œå¯ä»¥é™ä½kå€¼è®¾å®šçš„å½±å“ï¼‰ kå€¼é€šå¸¸æ˜¯é‡‡ç”¨äº¤å‰æ£€éªŒæ¥ç¡®å®šï¼ˆä»¥k=1ä¸ºåŸºå‡†ï¼‰ ç»éªŒè§„åˆ™ï¼škä¸€èˆ¬ä½äºè®­ç»ƒæ ·æœ¬æ•°çš„å¹³æ–¹æ ¹\n2. ç±»åˆ«å¦‚ä½•åˆ¤å®šæœ€åˆé€‚ï¼Ÿ æŠ•ç¥¨æ³•æ²¡æœ‰è€ƒè™‘è¿‘é‚»çš„è·ç¦»çš„è¿œè¿‘ï¼Œè·ç¦»æ›´è¿‘çš„è¿‘é‚»ä¹Ÿè®¸æ›´åº”è¯¥å†³å®šæœ€ç»ˆçš„åˆ†ç±»ï¼Œæ‰€ä»¥åŠ æƒæŠ•ç¥¨æ³•æ›´æ°å½“ä¸€äº›ã€‚\n3. å¦‚ä½•é€‰æ‹©åˆé€‚çš„è·ç¦»è¡¡é‡ï¼Ÿ é«˜ç»´åº¦å¯¹è·ç¦»è¡¡é‡çš„å½±å“ï¼šä¼—æ‰€å‘¨çŸ¥å½“å˜é‡æ•°è¶Šå¤šï¼Œæ¬§å¼è·ç¦»çš„åŒºåˆ†èƒ½åŠ›å°±è¶Šå·®ã€‚ å˜é‡å€¼åŸŸå¯¹è·ç¦»çš„å½±å“ï¼šå€¼åŸŸè¶Šå¤§çš„å˜é‡å¸¸å¸¸ä¼šåœ¨è·ç¦»è®¡ç®—ä¸­å æ®ä¸»å¯¼ä½œç”¨ï¼Œå› æ­¤åº”å…ˆå¯¹å˜é‡è¿›è¡Œæ ‡å‡†åŒ–ã€‚\n4. è®­ç»ƒæ ·æœ¬æ˜¯å¦è¦ä¸€è§†åŒä»ï¼Ÿ åœ¨è®­ç»ƒé›†ä¸­ï¼Œæœ‰äº›æ ·æœ¬å¯èƒ½æ˜¯æ›´å€¼å¾—ä¾èµ–çš„ã€‚ å¯ä»¥ç»™ä¸åŒçš„æ ·æœ¬æ–½åŠ ä¸åŒçš„æƒé‡ï¼ŒåŠ å¼ºä¾èµ–æ ·æœ¬çš„æƒé‡ï¼Œé™ä½ä¸å¯ä¿¡èµ–æ ·æœ¬çš„å½±å“ã€‚\n5. æ€§èƒ½é—®é¢˜ï¼Ÿ KNNæ˜¯ä¸€ç§æ‡’æƒ°ç®—æ³•ï¼Œå¹³æ—¶ä¸å¥½å¥½å­¦ä¹ ï¼Œè€ƒè¯•ï¼ˆå¯¹æµ‹è¯•æ ·æœ¬åˆ†ç±»ï¼‰æ—¶æ‰ä¸´é˜µç£¨æªï¼ˆä¸´æ—¶å»æ‰¾kä¸ªè¿‘é‚»ï¼‰ã€‚ æ‡’æƒ°çš„åæœï¼šæ„é€ æ¨¡å‹å¾ˆç®€å•ï¼Œä½†åœ¨å¯¹æµ‹è¯•æ ·æœ¬åˆ†ç±»åœ°çš„ç³»ç»Ÿå¼€é”€å¤§ï¼Œå› ä¸ºè¦æ‰«æå…¨éƒ¨è®­ç»ƒæ ·æœ¬å¹¶è®¡ç®—è·ç¦»ã€‚ å·²ç»æœ‰ä¸€äº›æ–¹æ³•æé«˜è®¡ç®—çš„æ•ˆç‡ï¼Œä¾‹å¦‚å‹ç¼©è®­ç»ƒæ ·æœ¬é‡ç­‰ã€‚\n6. èƒ½å¦å¤§å¹…å‡å°‘è®­ç»ƒæ ·æœ¬é‡ï¼ŒåŒæ—¶åˆä¿æŒåˆ†ç±»ç²¾åº¦ï¼Ÿ æµ“ç¼©æŠ€æœ¯(condensing) ç¼–è¾‘æŠ€æœ¯(editing)\nç®—æ³•å®ä¾‹ å¦‚scikit-learnä¸­çš„KNNç®—æ³•ä½¿ç”¨:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #coding:utf-8 from sklearn import datasets #sk-learn å†…ç½®æ•°æ®åº“ import numpy as np \u0026#39;\u0026#39;\u0026#39;KNNç®—æ³•\u0026#39;\u0026#39;\u0026#39; iris = datasets.load_iris() #å†…ç½®çš„é¸¢å°¾èŠ±å‰æ•°æ®é›† #æ•°æ®é›†åŒ…å«150ä¸ªæ•°æ®é›†ï¼Œåˆ†ä¸º3ç±»ï¼Œæ¯ç±»50ä¸ªæ•°æ®, #å¯é€šè¿‡èŠ±è¼é•¿åº¦ï¼ŒèŠ±è¼å®½åº¦ï¼ŒèŠ±ç“£é•¿åº¦ï¼ŒèŠ±ç“£å®½åº¦4ä¸ªç‰¹å¾é¢„æµ‹é¸¢å°¾èŠ±å‰å±äº #(Setosaï¼ŒVersicolourï¼ŒVirginica)ä¸‰ä¸ªç§ç±»ä¸­çš„å“ªä¸€ç±» iris_X,iris_y = iris.data,iris.target #æ•°æ®é›†åŠå…¶å¯¹åº”çš„åˆ†ç±»æ ‡ç­¾ # å°†æ•°æ®é›†éšæœºåˆ†ä¸ºè®­ç»ƒæ•°æ®é›†å’Œæµ‹è¯•æ•°æ®é›† np.random.seed(0) indices = np.random.permutation(len(iris_X)) #ç”¨äºè®­ç»ƒæ¨¡å‹ iris_X_train = iris_X[indices[:-10]] iris_y_train = iris_y[indices[:-10]] #ç”¨äºæµ‹è¯•æ¨¡å‹ iris_X_test = iris_X[indices[-10:]] iris_y_test = iris_y[indices[-10:]] from sklearn.neighbors import KNeighborsClassifier knn = KNeighborsClassifier() knn.fit(iris_X_train,iris_y_train) prediction = knn.predict(iris_X_test) score = knn.score(iris_X_test,iris_y_test) print \u0026#39;çœŸå®åˆ†ç±»æ ‡ç­¾:\u0026#39;+str(iris_y_test) print \u0026#39;æ¨¡å‹åˆ†ç±»ç»“æœ:\u0026#39;+str(prediction)+\u0026#39;\\nç®—æ³•å‡†ç¡®åº¦:\u0026#39;+str(score) è¾“å‡ºç»“æœ:\n1 2 3 çœŸå®åˆ†ç±»æ ‡ç­¾:[1 1 1 0 0 0 2 1 2 0] æ¨¡å‹åˆ†ç±»ç»“æœ:[1 2 1 0 0 0 2 1 2 0] ç®—æ³•å‡†ç¡®åº¦:0.9 ","permalink":"https://reid00.github.io/en/posts/ml/knn%E7%AE%97%E6%B3%95/","summary":"Summary ç®€å•çš„è¯´ï¼Œk-è¿‘é‚»ç®—æ³•é‡‡ç”¨æµ‹é‡ä¸åŒç‰¹å¾å€¼ä¹‹é—´çš„è·ç¦»æ–¹æ³•è¿›è¡Œåˆ†ç±»ã€‚ å®ƒçš„æ€è·¯æ˜¯ï¼šå¦‚æœä¸€ä¸ªæ ·æœ¬åœ¨ç‰¹å¾ç©ºé—´ä¸­çš„kä¸ªæœ€ç›¸ä¼¼(å³ç‰¹å¾ç©ºé—´ä¸­æœ€é‚»è¿‘)çš„æ ·æœ¬ä¸­çš„å¤§å¤šæ•°å±äºæŸä¸€ä¸ªç±»åˆ«ï¼Œåˆ™è¯¥æ ·æœ¬ä¹Ÿå±äºè¿™ä¸ªç±»åˆ«ï¼Œå…¶ä¸­Ké€šå¸¸æ˜¯ä¸å¤§äº20çš„æ•´æ•°ã€‚KNNç®—æ³•ä¸­ï¼Œæ‰€é€‰æ‹©çš„é‚»å±…éƒ½æ˜¯å·²ç»æ­£ç¡®åˆ†ç±»çš„å¯¹è±¡ã€‚è¯¥æ–¹æ³•åœ¨å®šç±»å†³ç­–ä¸Šåªä¾æ®æœ€é‚»è¿‘çš„ä¸€ä¸ªæˆ–è€…å‡ ä¸ªæ ·æœ¬çš„ç±»åˆ«æ¥å†³å®šå¾…åˆ†æ ·æœ¬æ‰€å±çš„ç±»åˆ«ã€‚\nä¼˜ç‚¹ï¼šç²¾åº¦é«˜ã€å¯¹å¼‚å¸¸å€¼ä¸æ•æ„Ÿã€æ— æ•°æ®è¾“å…¥å‡å®šã€‚\nç¼ºç‚¹ï¼šè®¡ç®—å¤æ‚åº¦é«˜ã€ç©ºé—´å¤æ‚åº¦é«˜ã€‚\né€‚ç”¨æ•°æ®èŒƒå›´ï¼šæ•°å€¼å‹å’Œæ ‡ç§°å‹ã€‚\nè¯¦ç»†ä»‹ç» ä¸‹é¢é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­è¯´æ˜ä¸€ä¸‹ï¼šå¦‚ä¸‹å›¾ï¼Œç»¿è‰²åœ†è¦è¢«å†³å®šèµ‹äºˆå“ªä¸ªç±»ï¼Œæ˜¯çº¢è‰²ä¸‰è§’å½¢è¿˜æ˜¯è“è‰²å››æ–¹å½¢ï¼Ÿå¦‚æœK=3ï¼Œç”±äºçº¢è‰²ä¸‰è§’å½¢æ‰€å æ¯”ä¾‹ä¸º2/3ï¼Œç»¿è‰²åœ†å°†è¢«èµ‹äºˆçº¢è‰²ä¸‰è§’å½¢é‚£ä¸ªç±»ï¼Œå¦‚æœK=5ï¼Œç”±äºè“è‰²å››æ–¹å½¢æ¯”ä¾‹ä¸º3/5ï¼Œå› æ­¤ç»¿è‰²åœ†è¢«èµ‹äºˆè“è‰²å››æ–¹å½¢ç±»ã€‚\nç”±æ­¤ä¹Ÿè¯´æ˜äº†KNNç®—æ³•çš„ç»“æœå¾ˆå¤§ç¨‹åº¦å–å†³äºKçš„é€‰æ‹©ã€‚\nåœ¨KNNä¸­ï¼Œé€šè¿‡è®¡ç®—å¯¹è±¡é—´è·ç¦»æ¥ä½œä¸ºå„ä¸ªå¯¹è±¡ä¹‹é—´çš„éç›¸ä¼¼æ€§æŒ‡æ ‡ï¼Œé¿å…äº†å¯¹è±¡ä¹‹é—´çš„åŒ¹é…é—®é¢˜ï¼Œåœ¨è¿™é‡Œè·ç¦»ä¸€èˆ¬ä½¿ç”¨æ¬§æ°è·ç¦»æˆ–æ›¼å“ˆé¡¿è·ç¦»ï¼š\n**æ¥ä¸‹æ¥å¯¹KNNç®—æ³•çš„æ€æƒ³æ€»ç»“ä¸€ä¸‹ï¼š**å°±æ˜¯åœ¨è®­ç»ƒé›†ä¸­æ•°æ®å’Œæ ‡ç­¾å·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œè¾“å…¥æµ‹è¯•æ•°æ®ï¼Œå°†æµ‹è¯•æ•°æ®çš„ç‰¹å¾ä¸è®­ç»ƒé›†ä¸­å¯¹åº”çš„ç‰¹å¾è¿›è¡Œç›¸äº’æ¯”è¾ƒï¼Œæ‰¾åˆ°è®­ç»ƒé›†ä¸­ä¸ä¹‹æœ€ä¸ºç›¸ä¼¼çš„å‰Kä¸ªæ•°æ®ï¼Œåˆ™è¯¥æµ‹è¯•æ•°æ®å¯¹åº”çš„ç±»åˆ«å°±æ˜¯Kä¸ªæ•°æ®ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„é‚£ä¸ªåˆ†ç±»ï¼Œå…¶ç®—æ³•çš„æè¿°ä¸ºï¼š\n1ï¼‰è®¡ç®—æµ‹è¯•æ•°æ®ä¸å„ä¸ªè®­ç»ƒæ•°æ®ä¹‹é—´çš„è·ç¦»ï¼›\n2ï¼‰æŒ‰ç…§è·ç¦»çš„é€’å¢å…³ç³»è¿›è¡Œæ’åºï¼›\n3ï¼‰é€‰å–è·ç¦»æœ€å°çš„Kä¸ªç‚¹ï¼›\n4ï¼‰ç¡®å®šå‰Kä¸ªç‚¹æ‰€åœ¨ç±»åˆ«çš„å‡ºç°é¢‘ç‡ï¼›\n5ï¼‰è¿”å›å‰Kä¸ªç‚¹ä¸­å‡ºç°é¢‘ç‡æœ€é«˜çš„ç±»åˆ«ä½œä¸ºæµ‹è¯•æ•°æ®çš„é¢„æµ‹åˆ†ç±»ã€‚\nå¸¸è§é—®é¢˜ 1. Kå€¼è®¾å®šä¸ºå¤šå¤§ï¼Ÿ Kå¤ªå°ï¼Œåˆ†ç±»ç»“æœæ˜“å—å™ªå£°ç‚¹å½±å“ï¼›kå¤ªå¤§ï¼Œè¿‘é‚»ä¸­åˆå¯èƒ½åŒ…å«å¤ªå¤šçš„å…¶å®ƒç±»åˆ«çš„ç‚¹ã€‚ï¼ˆå¯¹è·ç¦»åŠ æƒï¼Œå¯ä»¥é™ä½kå€¼è®¾å®šçš„å½±å“ï¼‰ kå€¼é€šå¸¸æ˜¯é‡‡ç”¨äº¤å‰æ£€éªŒæ¥ç¡®å®šï¼ˆä»¥k=1ä¸ºåŸºå‡†ï¼‰ ç»éªŒè§„åˆ™ï¼škä¸€èˆ¬ä½äºè®­ç»ƒæ ·æœ¬æ•°çš„å¹³æ–¹æ ¹\n2. ç±»åˆ«å¦‚ä½•åˆ¤å®šæœ€åˆé€‚ï¼Ÿ æŠ•ç¥¨æ³•æ²¡æœ‰è€ƒè™‘è¿‘é‚»çš„è·ç¦»çš„è¿œè¿‘ï¼Œè·ç¦»æ›´è¿‘çš„è¿‘é‚»ä¹Ÿè®¸æ›´åº”è¯¥å†³å®šæœ€ç»ˆçš„åˆ†ç±»ï¼Œæ‰€ä»¥åŠ æƒæŠ•ç¥¨æ³•æ›´æ°å½“ä¸€äº›ã€‚\n3. å¦‚ä½•é€‰æ‹©åˆé€‚çš„è·ç¦»è¡¡é‡ï¼Ÿ é«˜ç»´åº¦å¯¹è·ç¦»è¡¡é‡çš„å½±å“ï¼šä¼—æ‰€å‘¨çŸ¥å½“å˜é‡æ•°è¶Šå¤šï¼Œæ¬§å¼è·ç¦»çš„åŒºåˆ†èƒ½åŠ›å°±è¶Šå·®ã€‚ å˜é‡å€¼åŸŸå¯¹è·ç¦»çš„å½±å“ï¼šå€¼åŸŸè¶Šå¤§çš„å˜é‡å¸¸å¸¸ä¼šåœ¨è·ç¦»è®¡ç®—ä¸­å æ®ä¸»å¯¼ä½œç”¨ï¼Œå› æ­¤åº”å…ˆå¯¹å˜é‡è¿›è¡Œæ ‡å‡†åŒ–ã€‚\n4. è®­ç»ƒæ ·æœ¬æ˜¯å¦è¦ä¸€è§†åŒä»ï¼Ÿ åœ¨è®­ç»ƒé›†ä¸­ï¼Œæœ‰äº›æ ·æœ¬å¯èƒ½æ˜¯æ›´å€¼å¾—ä¾èµ–çš„ã€‚ å¯ä»¥ç»™ä¸åŒçš„æ ·æœ¬æ–½åŠ ä¸åŒçš„æƒé‡ï¼ŒåŠ å¼ºä¾èµ–æ ·æœ¬çš„æƒé‡ï¼Œé™ä½ä¸å¯ä¿¡èµ–æ ·æœ¬çš„å½±å“ã€‚\n5. æ€§èƒ½é—®é¢˜ï¼Ÿ KNNæ˜¯ä¸€ç§æ‡’æƒ°ç®—æ³•ï¼Œå¹³æ—¶ä¸å¥½å¥½å­¦ä¹ ï¼Œè€ƒè¯•ï¼ˆå¯¹æµ‹è¯•æ ·æœ¬åˆ†ç±»ï¼‰æ—¶æ‰ä¸´é˜µç£¨æªï¼ˆä¸´æ—¶å»æ‰¾kä¸ªè¿‘é‚»ï¼‰ã€‚ æ‡’æƒ°çš„åæœï¼šæ„é€ æ¨¡å‹å¾ˆç®€å•ï¼Œä½†åœ¨å¯¹æµ‹è¯•æ ·æœ¬åˆ†ç±»åœ°çš„ç³»ç»Ÿå¼€é”€å¤§ï¼Œå› ä¸ºè¦æ‰«æå…¨éƒ¨è®­ç»ƒæ ·æœ¬å¹¶è®¡ç®—è·ç¦»ã€‚ å·²ç»æœ‰ä¸€äº›æ–¹æ³•æé«˜è®¡ç®—çš„æ•ˆç‡ï¼Œä¾‹å¦‚å‹ç¼©è®­ç»ƒæ ·æœ¬é‡ç­‰ã€‚\n6. èƒ½å¦å¤§å¹…å‡å°‘è®­ç»ƒæ ·æœ¬é‡ï¼ŒåŒæ—¶åˆä¿æŒåˆ†ç±»ç²¾åº¦ï¼Ÿ æµ“ç¼©æŠ€æœ¯(condensing) ç¼–è¾‘æŠ€æœ¯(editing)\nç®—æ³•å®ä¾‹ å¦‚scikit-learnä¸­çš„KNNç®—æ³•ä½¿ç”¨:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 #coding:utf-8 from sklearn import datasets #sk-learn å†…ç½®æ•°æ®åº“ import numpy as np \u0026#39;\u0026#39;\u0026#39;KNNç®—æ³•\u0026#39;\u0026#39;\u0026#39; iris = datasets.","title":"KNNç®—æ³•"},{"content":"æ¦‚å¿µ L0ï¼šè®¡ç®—éé›¶ä¸ªæ•°ï¼Œç”¨äºäº§ç”Ÿç¨€ç–æ€§ï¼Œä½†æ˜¯åœ¨å®é™…ç ”ç©¶ä¸­å¾ˆå°‘ç”¨ï¼Œå› ä¸ºL0èŒƒæ•°å¾ˆéš¾ä¼˜åŒ–æ±‚è§£ï¼Œæ˜¯ä¸€ä¸ªNP-hardé—®é¢˜ï¼Œå› æ­¤æ›´å¤šæƒ…å†µä¸‹æˆ‘ä»¬æ˜¯ä½¿ç”¨L1èŒƒæ•° L1ï¼šè®¡ç®—ç»å¯¹å€¼ä¹‹å’Œï¼Œç”¨ä»¥äº§ç”Ÿç¨€ç–æ€§ï¼Œå› ä¸ºå®ƒæ˜¯L0èŒƒå¼çš„ä¸€ä¸ªæœ€ä¼˜å‡¸è¿‘ä¼¼ï¼Œå®¹æ˜“ä¼˜åŒ–æ±‚è§£ L2ï¼šè®¡ç®—å¹³æ–¹å’Œå†å¼€æ ¹å·ï¼ŒL2èŒƒæ•°æ›´å¤šæ˜¯é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œå¹¶ä¸”è®©ä¼˜åŒ–æ±‚è§£å˜å¾—ç¨³å®šå¾ˆå¿«é€Ÿï¼ˆè¿™æ˜¯å› ä¸ºåŠ å…¥äº†L2èŒƒå¼ä¹‹åï¼Œæ»¡è¶³äº†å¼ºå‡¸ï¼‰ã€‚\nL1èŒƒæ•°(Lasso Regularization)ï¼šå‘é‡ä¸­å„ä¸ªå…ƒç´ ç»å¯¹å€¼çš„å’Œã€‚\nL2èŒƒæ•°(Ridge Regression)ï¼šå‘é‡ä¸­å„å…ƒç´ å¹³æ–¹å’Œå†æ±‚å¹³æ–¹æ ¹ã€‚\nä½œç”¨ L1æ­£åˆ™åŒ–å¯ä»¥äº§ç”Ÿç¨€ç–æƒå€¼çŸ©é˜µï¼Œå³äº§ç”Ÿä¸€ä¸ªç¨€ç–æ¨¡å‹ï¼Œå¯ä»¥ç”¨äºç‰¹å¾é€‰æ‹©\nL2æ­£åˆ™åŒ–å¯ä»¥é˜²æ­¢æ¨¡å‹è¿‡æ‹Ÿåˆï¼ˆoverfittingï¼‰ï¼›ä¸€å®šç¨‹åº¦ä¸Šï¼ŒL1ä¹Ÿå¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆ\nL1æ­£åˆ™åŒ–æ˜¯åœ¨ä»£ä»·å‡½æ•°åé¢åŠ ä¸Š L2æ­£åˆ™åŒ–æ˜¯åœ¨ä»£ä»·å‡½æ•°åé¢å¢åŠ äº† ä¸¤è€…éƒ½èµ·åˆ°ä¸€å®šçš„è¿‡æ‹Ÿåˆä½œç”¨ï¼Œä¸¤è€…éƒ½å¯¹åº”ä¸€å®šçš„å…ˆéªŒçŸ¥è¯†ï¼ŒL1å¯¹åº”æ‹‰æ™®æ‹‰æ–¯åˆ†å¸ƒï¼ŒL2å¯¹åº”é«˜æ–¯åˆ†å¸ƒï¼ŒL1åå‘äºå‚æ•°ç¨€ç–æ€§ï¼ŒL2åå‘äºå‚æ•°åˆ†å¸ƒè¾ƒä¸ºç¨ ã€‚\n","permalink":"https://reid00.github.io/en/posts/ml/l1l2%E6%AD%A3%E5%88%99/","summary":"æ¦‚å¿µ L0ï¼šè®¡ç®—éé›¶ä¸ªæ•°ï¼Œç”¨äºäº§ç”Ÿç¨€ç–æ€§ï¼Œä½†æ˜¯åœ¨å®é™…ç ”ç©¶ä¸­å¾ˆå°‘ç”¨ï¼Œå› ä¸ºL0èŒƒæ•°å¾ˆéš¾ä¼˜åŒ–æ±‚è§£ï¼Œæ˜¯ä¸€ä¸ªNP-hardé—®é¢˜ï¼Œå› æ­¤æ›´å¤šæƒ…å†µä¸‹æˆ‘ä»¬æ˜¯ä½¿ç”¨L1èŒƒæ•° L1ï¼šè®¡ç®—ç»å¯¹å€¼ä¹‹å’Œï¼Œç”¨ä»¥äº§ç”Ÿç¨€ç–æ€§ï¼Œå› ä¸ºå®ƒæ˜¯L0èŒƒå¼çš„ä¸€ä¸ªæœ€ä¼˜å‡¸è¿‘ä¼¼ï¼Œå®¹æ˜“ä¼˜åŒ–æ±‚è§£ L2ï¼šè®¡ç®—å¹³æ–¹å’Œå†å¼€æ ¹å·ï¼ŒL2èŒƒæ•°æ›´å¤šæ˜¯é˜²æ­¢è¿‡æ‹Ÿåˆï¼Œå¹¶ä¸”è®©ä¼˜åŒ–æ±‚è§£å˜å¾—ç¨³å®šå¾ˆå¿«é€Ÿï¼ˆè¿™æ˜¯å› ä¸ºåŠ å…¥äº†L2èŒƒå¼ä¹‹åï¼Œæ»¡è¶³äº†å¼ºå‡¸ï¼‰ã€‚\nL1èŒƒæ•°(Lasso Regularization)ï¼šå‘é‡ä¸­å„ä¸ªå…ƒç´ ç»å¯¹å€¼çš„å’Œã€‚\nL2èŒƒæ•°(Ridge Regression)ï¼šå‘é‡ä¸­å„å…ƒç´ å¹³æ–¹å’Œå†æ±‚å¹³æ–¹æ ¹ã€‚\nä½œç”¨ L1æ­£åˆ™åŒ–å¯ä»¥äº§ç”Ÿç¨€ç–æƒå€¼çŸ©é˜µï¼Œå³äº§ç”Ÿä¸€ä¸ªç¨€ç–æ¨¡å‹ï¼Œå¯ä»¥ç”¨äºç‰¹å¾é€‰æ‹©\nL2æ­£åˆ™åŒ–å¯ä»¥é˜²æ­¢æ¨¡å‹è¿‡æ‹Ÿåˆï¼ˆoverfittingï¼‰ï¼›ä¸€å®šç¨‹åº¦ä¸Šï¼ŒL1ä¹Ÿå¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆ\nL1æ­£åˆ™åŒ–æ˜¯åœ¨ä»£ä»·å‡½æ•°åé¢åŠ ä¸Š L2æ­£åˆ™åŒ–æ˜¯åœ¨ä»£ä»·å‡½æ•°åé¢å¢åŠ äº† ä¸¤è€…éƒ½èµ·åˆ°ä¸€å®šçš„è¿‡æ‹Ÿåˆä½œç”¨ï¼Œä¸¤è€…éƒ½å¯¹åº”ä¸€å®šçš„å…ˆéªŒçŸ¥è¯†ï¼ŒL1å¯¹åº”æ‹‰æ™®æ‹‰æ–¯åˆ†å¸ƒï¼ŒL2å¯¹åº”é«˜æ–¯åˆ†å¸ƒï¼ŒL1åå‘äºå‚æ•°ç¨€ç–æ€§ï¼ŒL2åå‘äºå‚æ•°åˆ†å¸ƒè¾ƒä¸ºç¨ ã€‚","title":"L1L2æ­£åˆ™"},{"content":"Refer ï¼šhttps://blog.csdn.net/shenfuli/article/details/106523650\nMulti-Head Attention: https://blog.csdn.net/qq_37394634/article/details/102679096\n","permalink":"https://reid00.github.io/en/posts/ml/self-attention/","summary":"Refer ï¼šhttps://blog.csdn.net/shenfuli/article/details/106523650\nMulti-Head Attention: https://blog.csdn.net/qq_37394634/article/details/102679096","title":"Self Attention"},{"content":"æ¦‚è¿° GBDTçš„åŠ å…¥ï¼Œæ˜¯ä¸ºäº†å¼¥è¡¥LRéš¾ä»¥å®ç°ç‰¹å¾ç»„åˆçš„ç¼ºç‚¹ã€‚\nLR LRä½œä¸ºä¸€ä¸ªçº¿æ€§æ¨¡å‹ï¼Œä»¥æ¦‚ç‡å½¢å¼è¾“å‡ºç»“æœï¼Œåœ¨å·¥ä¸šä¸Šå¾—åˆ°äº†ååˆ†å¹¿æ³›çš„åº”ç”¨ã€‚ å…¶å…·æœ‰ç®€å•å¿«é€Ÿé«˜æ•ˆï¼Œç»“æœå¯è§£é‡Šï¼Œå¯ä»¥åˆ†å¸ƒå¼è®¡ç®—ã€‚æ­é…L1ï¼ŒL2æ­£åˆ™ï¼Œå¯ä»¥æœ‰å¾ˆå¥½åœ°é²æ£’æ€§ä»¥åŠæŒ‘é€‰ç‰¹å¾çš„èƒ½åŠ›ã€‚\nä½†ç”±äºå…¶ç®€å•ï¼Œä¹Ÿä¼´éšç€æ‹Ÿåˆèƒ½åŠ›ä¸è¶³ï¼Œæ— æ³•åšç‰¹å¾ç»„åˆçš„ç¼ºç‚¹ã€‚\né€šè¿‡æ¢¯åº¦ä¸‹é™æ³•å¯ä»¥ä¼˜åŒ–å‚æ•°\nå¯ä»¥ç§°ä¹‹ä¸Šæ˜¯ CTR é¢„ä¼°æ¨¡å‹çš„å¼€å±±é¼»ç¥–ï¼Œä¹Ÿæ˜¯å·¥ä¸šç•Œä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„ CTR é¢„ä¼°æ¨¡å‹\nä½†æ˜¯åœ¨CTRé¢†åŸŸï¼Œå•çº¯çš„LRè™½ç„¶å¯ä»¥å¿«é€Ÿå¤„ç†æµ·é‡é«˜ç»´ç¦»æ•£ç‰¹å¾ï¼Œä½†æ˜¯ç”±äºçº¿æ€§æ¨¡å‹çš„å±€é™æ€§ï¼Œå…¶åœ¨ç‰¹å¾ç»„åˆæ–¹é¢ä»æœ‰ä¸è¶³ï¼Œæ‰€ä»¥åç»­æ‰å‘å±•å‡ºäº†FMæ¥å¼•å…¥ç‰¹å¾äº¤å‰ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œä¸šç•Œä¹Ÿæœ‰ä½¿ç”¨GBDTæ¥ä½œä¸ºç‰¹å¾ç»„åˆçš„å·¥å…·ï¼Œå…¶ç»“æœè¾“å‡ºç»™LRã€‚\nLR ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼šç”±äº LR æ¨¡å‹ç®€å•ï¼Œè®­ç»ƒæ—¶ä¾¿äºå¹¶è¡ŒåŒ–ï¼Œåœ¨é¢„æµ‹æ—¶åªéœ€è¦å¯¹ç‰¹å¾è¿›è¡Œçº¿æ€§åŠ æƒï¼Œæ‰€ä»¥æ€§èƒ½æ¯”è¾ƒå¥½ï¼Œå¾€å¾€é€‚åˆå¤„ç†æµ·é‡ id ç±»ç‰¹å¾ï¼Œç”¨ id ç±»ç‰¹å¾æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„å¥½å¤„ï¼Œå°±æ˜¯é˜²æ­¢ä¿¡æ¯æŸå¤±ï¼ˆç›¸å¯¹äºèŒƒåŒ–çš„ CTR ç‰¹å¾ï¼‰ï¼Œå¯¹äºå¤´éƒ¨èµ„æºä¼šæœ‰æ›´ç»†è‡´çš„æè¿°ã€‚\nç¼ºç‚¹ï¼šLR çš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œé¦–å…ˆå¯¹è¿ç»­ç‰¹å¾çš„å¤„ç†éœ€è¦å…ˆè¿›è¡Œç¦»æ•£åŒ–ï¼Œå¦‚ä¸Šæ–‡æ‰€è¯´ï¼Œäººå·¥åˆ†æ¡¶çš„æ–¹å¼ä¼šå¼•å…¥å¤šç§é—®é¢˜ã€‚å¦å¤– LR éœ€è¦è¿›è¡Œäººå·¥ç‰¹å¾ç»„åˆï¼Œè¿™å°±éœ€è¦å¼€å‘è€…æœ‰éå¸¸ä¸°å¯Œçš„é¢†åŸŸç»éªŒï¼Œæ‰èƒ½ä¸èµ°å¼¯è·¯ã€‚è¿™æ ·çš„æ¨¡å‹è¿ç§»èµ·æ¥æ¯”è¾ƒå›°éš¾ï¼Œæ¢ä¸€ä¸ªé¢†åŸŸåˆéœ€è¦é‡æ–°è¿›è¡Œå¤§é‡çš„ç‰¹å¾å·¥ç¨‹ã€‚\nGBDT+LR é¦–å…ˆï¼ŒGBDTæ˜¯ä¸€å †æ ‘çš„ç»„åˆï¼Œå‡è®¾æœ‰kæ£µæ ‘ ã€‚ å¯¹äºç¬¬iæ£µæ ‘ ï¼Œå…¶å­˜åœ¨ ä¸ªå¶å­èŠ‚ç‚¹ã€‚è€Œä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€æ¡è·¯å¾„ï¼Œè¿™æ¡è·¯å¾„æ˜¯ä¸€äº›ç‰¹å¾çš„ç»„åˆï¼Œä¾‹å¦‚ä»æ ¹èŠ‚ç‚¹åˆ°æŸä¸€ä¸ªå¶å­èŠ‚ç‚¹çš„è·¯å¾„å¯èƒ½æ˜¯â€œ â€è¿™å°±æ˜¯ä¸€ç»„ç‰¹å¾ç»„åˆã€‚åˆ°è¾¾è¿™ä¸ªå¶å­èŠ‚ç‚¹çš„æ ·æœ¬éƒ½æ‹¥æœ‰è¿™æ ·çš„ç»„åˆç‰¹å¾ï¼Œè€Œè¿™ä¸ªç»„åˆç‰¹å¾ä½¿å¾—è¿™ä¸ªæ ·æœ¬å¾—åˆ°äº†GBDTçš„é¢„æµ‹ç»“æœã€‚ æ‰€ä»¥å¯¹äºGBDTå­æ ‘ ï¼Œä¼šè¿”å›ä¸€ä¸ª ç»´çš„one-hotå‘é‡ å¯¹äºæ•´ä¸ªGBDTï¼Œä¼šè¿”å›ä¸€ä¸ª ç»´çš„å‘é‡ ï¼Œè¿™ä¸ªå‘é‡ç”±0-1ç»„æˆã€‚\nç„¶åï¼Œè¿™ä¸ª ,ä¼šä½œä¸ºè¾“å…¥ï¼Œé€è¿›LRæ¨¡å‹ï¼Œæœ€ç»ˆè¾“å‡ºç»“æœ\næ¨¡å‹å¤§è‡´å¦‚å›¾æ‰€ç¤ºã€‚ä¸Šå›¾ä¸­ç”±ä¸¤æ£µå­æ ‘ï¼Œåˆ†åˆ«æœ‰3å’Œ2ä¸ªå¶å­èŠ‚ç‚¹ã€‚å¯¹äºä¸€ä¸ªæ ·æœ¬xï¼Œæœ€ç»ˆå¯ä»¥è½å…¥ç¬¬ä¸€æ£µæ ‘çš„æŸä¸€ä¸ªå¶å­å’Œç¬¬äºŒæ£µæ ‘çš„æŸä¸€ä¸ªå¶å­ï¼Œå¾—åˆ°ä¸¤ä¸ªç‹¬çƒ­ç¼–ç çš„ç»“æœä¾‹å¦‚ [0,0,1],[1,0]ç»„åˆå¾—[0,0,1,1,0]è¾“å…¥åˆ°LRæ¨¡å‹æœ€åè¾“å‡ºç»“æœã€‚\nç”±äºLRå–„äºå¤„ç†ç¦»æ•£ç‰¹å¾ï¼ŒGBDTå–„äºå¤„ç†è¿ç»­ç‰¹å¾ã€‚æ‰€ä»¥ä¹Ÿå¯ä»¥äº¤ç”±GBDTå¤„ç†è¿ç»­ç‰¹å¾ï¼Œè¾“å‡ºç»“æœæ‹¼æ¥ä¸Šç¦»æ•£ç‰¹å¾ä¸€èµ·è¾“å…¥LRã€‚\nè®¨è®º è‡³äºGBDTä¸ºä½•ä¸å–„äºå¤„ç†é«˜ç»´ç¦»æ•£ç‰¹å¾ï¼Ÿ\nhttps://cloud.tencent.com/developer/article/1005416\nç¼ºç‚¹ï¼šå¯¹äºæµ·é‡çš„ id ç±»ç‰¹å¾ï¼ŒGBDT ç”±äºæ ‘çš„æ·±åº¦å’Œæ£µæ ‘é™åˆ¶ï¼ˆé˜²æ­¢è¿‡æ‹Ÿåˆï¼‰ï¼Œä¸èƒ½æœ‰æ•ˆçš„å­˜å‚¨ï¼›å¦å¤–æµ·é‡ç‰¹å¾åœ¨ä¹Ÿä¼šå­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼Œç»ç¬”è€…æµ‹è¯•ï¼Œå½“ GBDT çš„ one hot ç‰¹å¾å¤§äº 10 ä¸‡ç»´æ—¶ï¼Œå°±å¿…é¡»åšåˆ†å¸ƒå¼çš„è®­ç»ƒæ‰èƒ½ä¿è¯ä¸çˆ†å†…å­˜ã€‚æ‰€ä»¥ GBDT é€šå¸¸é…åˆå°‘é‡çš„åé¦ˆ CTR ç‰¹å¾æ¥è¡¨è¾¾ï¼Œè¿™æ ·è™½ç„¶å…·æœ‰ä¸€å®šçš„èŒƒåŒ–èƒ½åŠ›ï¼Œä½†æ˜¯åŒæ—¶ä¼šæœ‰ä¿¡æ¯æŸå¤±ï¼Œå¯¹äºå¤´éƒ¨èµ„æºä¸èƒ½æœ‰æ•ˆçš„è¡¨è¾¾ã€‚\nhttps://www.zhihu.com/question/35821566\nåæ¥æ€è€ƒåå‘ç°åŸå› æ˜¯å› ä¸ºç°åœ¨çš„æ¨¡å‹æ™®ééƒ½ä¼šå¸¦ç€æ­£åˆ™é¡¹ï¼Œè€Œ lr ç­‰çº¿æ€§æ¨¡å‹çš„æ­£åˆ™é¡¹æ˜¯å¯¹æƒé‡çš„æƒ©ç½šï¼Œä¹Ÿå°±æ˜¯ W1ä¸€æ—¦è¿‡å¤§ï¼Œæƒ©ç½šå°±ä¼šå¾ˆå¤§ï¼Œè¿›ä¸€æ­¥å‹ç¼© W1çš„å€¼ï¼Œä½¿ä»–ä¸è‡³äºè¿‡å¤§ï¼Œè€Œæ ‘æ¨¡å‹åˆ™ä¸ä¸€æ ·ï¼Œæ ‘æ¨¡å‹çš„æƒ©ç½šé¡¹é€šå¸¸ä¸ºå¶å­èŠ‚ç‚¹æ•°å’Œæ·±åº¦ç­‰ï¼Œè€Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå¯¹äºä¸Šé¢è¿™ç§ caseï¼Œæ ‘åªéœ€è¦ä¸€ä¸ªèŠ‚ç‚¹å°±å¯ä»¥å®Œç¾åˆ†å‰²9990å’Œ10ä¸ªæ ·æœ¬ï¼Œæƒ©ç½šé¡¹æå…¶ä¹‹å°. è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆåœ¨é«˜ç»´ç¨€ç–ç‰¹å¾çš„æ—¶å€™ï¼Œçº¿æ€§æ¨¡å‹ä¼šæ¯”éçº¿æ€§æ¨¡å‹å¥½çš„åŸå› äº†ï¼šå¸¦æ­£åˆ™åŒ–çš„çº¿æ€§æ¨¡å‹æ¯”è¾ƒä¸å®¹æ˜“å¯¹ç¨€ç–ç‰¹å¾è¿‡æ‹Ÿåˆã€‚\nGBDTå½“æ ‘æ·±åº¦\u0026gt;2æ—¶ï¼Œå…¶å®ç»„åˆçš„æ˜¯å¤šå…ƒç‰¹å¾äº†ï¼Œè€Œä¸”ç”±äºå­æ ‘è§„æ¨¡çš„é™åˆ¶ï¼Œå¯¼è‡´å…¶ç‰¹å¾ç»„åˆçš„èƒ½åŠ›å¹¶ä¸æ˜¯å¾ˆå¼ºï¼Œæ‰€ä»¥æ‰æœ‰äº†åç»­FMï¼ŒFFMçš„å‘å±•x\nGBDT + LR æ”¹è¿› Facebook çš„æ–¹æ¡ˆåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå‘ç°å¹¶ä¸å¯è¡Œï¼Œå› ä¸ºå¹¿å‘Šç³»ç»Ÿå¾€å¾€å­˜åœ¨ä¸Šäº¿ç»´çš„ id ç±»ç‰¹å¾(ç”¨æˆ· guid10 äº¿ç»´ï¼Œå¹¿å‘Š aid ä¸Šç™¾ä¸‡ç»´)ï¼Œè€Œ GBDT ç”±äºæ ‘çš„æ·±åº¦å’Œæ£µæ ‘çš„é™åˆ¶ï¼Œæ— æ³•å­˜å‚¨è¿™ä¹ˆå¤š id ç±»ç‰¹å¾ï¼Œå¯¼è‡´ä¿¡æ¯çš„æŸå¤±ã€‚æœ‰å¦‚ä¸‹æ”¹è¿›æ–¹æ¡ˆä¾›è¯»è€…å‚è€ƒï¼š\n**æ–¹æ¡ˆä¸€ï¼š**GBDT è®­ç»ƒé™¤ id ç±»ç‰¹å¾ä»¥å¤–çš„æ‰€æœ‰ç‰¹å¾ï¼Œå…¶ä»– id ç±»ç‰¹å¾åœ¨ LR é˜¶æ®µå†åŠ å…¥ã€‚è¿™æ ·çš„å¥½å¤„å¾ˆæ˜æ˜¾ï¼Œæ—¢åˆ©ç”¨äº† GBDT å¯¹è¿ç»­ç‰¹å¾çš„è‡ªåŠ¨ç¦»æ•£åŒ–å’Œç‰¹å¾ç»„åˆï¼ŒåŒæ—¶ LR åˆæœ‰æ•ˆåˆ©ç”¨äº† id ç±»ç¦»æ•£ç‰¹å¾ï¼Œé˜²æ­¢ä¿¡æ¯æŸå¤±ã€‚\n**æ–¹æ¡ˆäºŒï¼š**GBDT åˆ†åˆ«è®­ç»ƒ id ç±»æ ‘å’Œé id ç±»æ ‘ï¼Œå¹¶æŠŠç»„åˆç‰¹å¾ä¼ å…¥ LR è¿›è¡ŒäºŒæ¬¡è®­ç»ƒã€‚å¯¹äº id ç±»æ ‘å¯ä»¥æœ‰æ•ˆä¿ç•™å¤´éƒ¨èµ„æºçš„ä¿¡æ¯ä¸å—æŸå¤±ï¼›å¯¹äºé id ç±»æ ‘ï¼Œé•¿å°¾èµ„æºå¯ä»¥åˆ©ç”¨å…¶èŒƒåŒ–ä¿¡æ¯ï¼ˆåé¦ˆ CTR ç­‰ï¼‰ã€‚ä½†è¿™æ ·åšæœ‰ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œä»‹äºå¤´éƒ¨èµ„æºå’Œé•¿å°¾èµ„æºä¸­é—´çš„ä¸€éƒ¨åˆ†èµ„æºï¼Œå…¶æœ‰æ•ˆä¿¡æ¯å³åŒ…å«åœ¨èŒƒåŒ–ä¿¡æ¯(åé¦ˆ CTR) ä¸­ï¼ŒåˆåŒ…å«åœ¨ id ç±»ç‰¹å¾ä¸­ï¼Œè€Œ GBDT çš„é id ç±»æ ‘åªå­˜çš„ä¸‹å¤´éƒ¨çš„èµ„æºä¿¡æ¯ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¼šæœ‰éƒ¨åˆ†ä¿¡æ¯æŸå¤±ã€‚\nä¼˜ç¼ºç‚¹:\nä¼˜ç‚¹ï¼šGBDT å¯ä»¥è‡ªåŠ¨è¿›è¡Œç‰¹å¾ç»„åˆå’Œç¦»æ•£åŒ–ï¼ŒLR å¯ä»¥æœ‰æ•ˆåˆ©ç”¨æµ·é‡ id ç±»ç¦»æ•£ç‰¹å¾ï¼Œä¿æŒä¿¡æ¯çš„å®Œæ•´æ€§ã€‚\nç¼ºç‚¹ï¼šLR é¢„æµ‹çš„æ—¶å€™éœ€è¦ç­‰å¾… GBDT çš„è¾“å‡ºï¼Œä¸€æ–¹é¢ GBDTåœ¨çº¿é¢„æµ‹æ…¢äºå• LRï¼Œå¦ä¸€æ–¹é¢ GBDT ç›®å‰ä¸æ”¯æŒåœ¨çº¿ç®—æ³•ï¼Œåªèƒ½ä»¥ç¦»çº¿æ–¹å¼è¿›è¡Œæ›´æ–°ã€‚\n","permalink":"https://reid00.github.io/en/posts/ml/gbdt+lr/","summary":"æ¦‚è¿° GBDTçš„åŠ å…¥ï¼Œæ˜¯ä¸ºäº†å¼¥è¡¥LRéš¾ä»¥å®ç°ç‰¹å¾ç»„åˆçš„ç¼ºç‚¹ã€‚\nLR LRä½œä¸ºä¸€ä¸ªçº¿æ€§æ¨¡å‹ï¼Œä»¥æ¦‚ç‡å½¢å¼è¾“å‡ºç»“æœï¼Œåœ¨å·¥ä¸šä¸Šå¾—åˆ°äº†ååˆ†å¹¿æ³›çš„åº”ç”¨ã€‚ å…¶å…·æœ‰ç®€å•å¿«é€Ÿé«˜æ•ˆï¼Œç»“æœå¯è§£é‡Šï¼Œå¯ä»¥åˆ†å¸ƒå¼è®¡ç®—ã€‚æ­é…L1ï¼ŒL2æ­£åˆ™ï¼Œå¯ä»¥æœ‰å¾ˆå¥½åœ°é²æ£’æ€§ä»¥åŠæŒ‘é€‰ç‰¹å¾çš„èƒ½åŠ›ã€‚\nä½†ç”±äºå…¶ç®€å•ï¼Œä¹Ÿä¼´éšç€æ‹Ÿåˆèƒ½åŠ›ä¸è¶³ï¼Œæ— æ³•åšç‰¹å¾ç»„åˆçš„ç¼ºç‚¹ã€‚\né€šè¿‡æ¢¯åº¦ä¸‹é™æ³•å¯ä»¥ä¼˜åŒ–å‚æ•°\nå¯ä»¥ç§°ä¹‹ä¸Šæ˜¯ CTR é¢„ä¼°æ¨¡å‹çš„å¼€å±±é¼»ç¥–ï¼Œä¹Ÿæ˜¯å·¥ä¸šç•Œä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„ CTR é¢„ä¼°æ¨¡å‹\nä½†æ˜¯åœ¨CTRé¢†åŸŸï¼Œå•çº¯çš„LRè™½ç„¶å¯ä»¥å¿«é€Ÿå¤„ç†æµ·é‡é«˜ç»´ç¦»æ•£ç‰¹å¾ï¼Œä½†æ˜¯ç”±äºçº¿æ€§æ¨¡å‹çš„å±€é™æ€§ï¼Œå…¶åœ¨ç‰¹å¾ç»„åˆæ–¹é¢ä»æœ‰ä¸è¶³ï¼Œæ‰€ä»¥åç»­æ‰å‘å±•å‡ºäº†FMæ¥å¼•å…¥ç‰¹å¾äº¤å‰ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œä¸šç•Œä¹Ÿæœ‰ä½¿ç”¨GBDTæ¥ä½œä¸ºç‰¹å¾ç»„åˆçš„å·¥å…·ï¼Œå…¶ç»“æœè¾“å‡ºç»™LRã€‚\nLR ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼šç”±äº LR æ¨¡å‹ç®€å•ï¼Œè®­ç»ƒæ—¶ä¾¿äºå¹¶è¡ŒåŒ–ï¼Œåœ¨é¢„æµ‹æ—¶åªéœ€è¦å¯¹ç‰¹å¾è¿›è¡Œçº¿æ€§åŠ æƒï¼Œæ‰€ä»¥æ€§èƒ½æ¯”è¾ƒå¥½ï¼Œå¾€å¾€é€‚åˆå¤„ç†æµ·é‡ id ç±»ç‰¹å¾ï¼Œç”¨ id ç±»ç‰¹å¾æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„å¥½å¤„ï¼Œå°±æ˜¯é˜²æ­¢ä¿¡æ¯æŸå¤±ï¼ˆç›¸å¯¹äºèŒƒåŒ–çš„ CTR ç‰¹å¾ï¼‰ï¼Œå¯¹äºå¤´éƒ¨èµ„æºä¼šæœ‰æ›´ç»†è‡´çš„æè¿°ã€‚\nç¼ºç‚¹ï¼šLR çš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œé¦–å…ˆå¯¹è¿ç»­ç‰¹å¾çš„å¤„ç†éœ€è¦å…ˆè¿›è¡Œç¦»æ•£åŒ–ï¼Œå¦‚ä¸Šæ–‡æ‰€è¯´ï¼Œäººå·¥åˆ†æ¡¶çš„æ–¹å¼ä¼šå¼•å…¥å¤šç§é—®é¢˜ã€‚å¦å¤– LR éœ€è¦è¿›è¡Œäººå·¥ç‰¹å¾ç»„åˆï¼Œè¿™å°±éœ€è¦å¼€å‘è€…æœ‰éå¸¸ä¸°å¯Œçš„é¢†åŸŸç»éªŒï¼Œæ‰èƒ½ä¸èµ°å¼¯è·¯ã€‚è¿™æ ·çš„æ¨¡å‹è¿ç§»èµ·æ¥æ¯”è¾ƒå›°éš¾ï¼Œæ¢ä¸€ä¸ªé¢†åŸŸåˆéœ€è¦é‡æ–°è¿›è¡Œå¤§é‡çš„ç‰¹å¾å·¥ç¨‹ã€‚\nGBDT+LR é¦–å…ˆï¼ŒGBDTæ˜¯ä¸€å †æ ‘çš„ç»„åˆï¼Œå‡è®¾æœ‰kæ£µæ ‘ ã€‚ å¯¹äºç¬¬iæ£µæ ‘ ï¼Œå…¶å­˜åœ¨ ä¸ªå¶å­èŠ‚ç‚¹ã€‚è€Œä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€æ¡è·¯å¾„ï¼Œè¿™æ¡è·¯å¾„æ˜¯ä¸€äº›ç‰¹å¾çš„ç»„åˆï¼Œä¾‹å¦‚ä»æ ¹èŠ‚ç‚¹åˆ°æŸä¸€ä¸ªå¶å­èŠ‚ç‚¹çš„è·¯å¾„å¯èƒ½æ˜¯â€œ â€è¿™å°±æ˜¯ä¸€ç»„ç‰¹å¾ç»„åˆã€‚åˆ°è¾¾è¿™ä¸ªå¶å­èŠ‚ç‚¹çš„æ ·æœ¬éƒ½æ‹¥æœ‰è¿™æ ·çš„ç»„åˆç‰¹å¾ï¼Œè€Œè¿™ä¸ªç»„åˆç‰¹å¾ä½¿å¾—è¿™ä¸ªæ ·æœ¬å¾—åˆ°äº†GBDTçš„é¢„æµ‹ç»“æœã€‚ æ‰€ä»¥å¯¹äºGBDTå­æ ‘ ï¼Œä¼šè¿”å›ä¸€ä¸ª ç»´çš„one-hotå‘é‡ å¯¹äºæ•´ä¸ªGBDTï¼Œä¼šè¿”å›ä¸€ä¸ª ç»´çš„å‘é‡ ï¼Œè¿™ä¸ªå‘é‡ç”±0-1ç»„æˆã€‚\nç„¶åï¼Œè¿™ä¸ª ,ä¼šä½œä¸ºè¾“å…¥ï¼Œé€è¿›LRæ¨¡å‹ï¼Œæœ€ç»ˆè¾“å‡ºç»“æœ\næ¨¡å‹å¤§è‡´å¦‚å›¾æ‰€ç¤ºã€‚ä¸Šå›¾ä¸­ç”±ä¸¤æ£µå­æ ‘ï¼Œåˆ†åˆ«æœ‰3å’Œ2ä¸ªå¶å­èŠ‚ç‚¹ã€‚å¯¹äºä¸€ä¸ªæ ·æœ¬xï¼Œæœ€ç»ˆå¯ä»¥è½å…¥ç¬¬ä¸€æ£µæ ‘çš„æŸä¸€ä¸ªå¶å­å’Œç¬¬äºŒæ£µæ ‘çš„æŸä¸€ä¸ªå¶å­ï¼Œå¾—åˆ°ä¸¤ä¸ªç‹¬çƒ­ç¼–ç çš„ç»“æœä¾‹å¦‚ [0,0,1],[1,0]ç»„åˆå¾—[0,0,1,1,0]è¾“å…¥åˆ°LRæ¨¡å‹æœ€åè¾“å‡ºç»“æœã€‚\nç”±äºLRå–„äºå¤„ç†ç¦»æ•£ç‰¹å¾ï¼ŒGBDTå–„äºå¤„ç†è¿ç»­ç‰¹å¾ã€‚æ‰€ä»¥ä¹Ÿå¯ä»¥äº¤ç”±GBDTå¤„ç†è¿ç»­ç‰¹å¾ï¼Œè¾“å‡ºç»“æœæ‹¼æ¥ä¸Šç¦»æ•£ç‰¹å¾ä¸€èµ·è¾“å…¥LRã€‚\nè®¨è®º è‡³äºGBDTä¸ºä½•ä¸å–„äºå¤„ç†é«˜ç»´ç¦»æ•£ç‰¹å¾ï¼Ÿ\nhttps://cloud.tencent.com/developer/article/1005416\nç¼ºç‚¹ï¼šå¯¹äºæµ·é‡çš„ id ç±»ç‰¹å¾ï¼ŒGBDT ç”±äºæ ‘çš„æ·±åº¦å’Œæ£µæ ‘é™åˆ¶ï¼ˆé˜²æ­¢è¿‡æ‹Ÿåˆï¼‰ï¼Œä¸èƒ½æœ‰æ•ˆçš„å­˜å‚¨ï¼›å¦å¤–æµ·é‡ç‰¹å¾åœ¨ä¹Ÿä¼šå­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼Œç»ç¬”è€…æµ‹è¯•ï¼Œå½“ GBDT çš„ one hot ç‰¹å¾å¤§äº 10 ä¸‡ç»´æ—¶ï¼Œå°±å¿…é¡»åšåˆ†å¸ƒå¼çš„è®­ç»ƒæ‰èƒ½ä¿è¯ä¸çˆ†å†…å­˜ã€‚æ‰€ä»¥ GBDT é€šå¸¸é…åˆå°‘é‡çš„åé¦ˆ CTR ç‰¹å¾æ¥è¡¨è¾¾ï¼Œè¿™æ ·è™½ç„¶å…·æœ‰ä¸€å®šçš„èŒƒåŒ–èƒ½åŠ›ï¼Œä½†æ˜¯åŒæ—¶ä¼šæœ‰ä¿¡æ¯æŸå¤±ï¼Œå¯¹äºå¤´éƒ¨èµ„æºä¸èƒ½æœ‰æ•ˆçš„è¡¨è¾¾ã€‚\nhttps://www.zhihu.com/question/35821566\nåæ¥æ€è€ƒåå‘ç°åŸå› æ˜¯å› ä¸ºç°åœ¨çš„æ¨¡å‹æ™®ééƒ½ä¼šå¸¦ç€æ­£åˆ™é¡¹ï¼Œè€Œ lr ç­‰çº¿æ€§æ¨¡å‹çš„æ­£åˆ™é¡¹æ˜¯å¯¹æƒé‡çš„æƒ©ç½šï¼Œä¹Ÿå°±æ˜¯ W1ä¸€æ—¦è¿‡å¤§ï¼Œæƒ©ç½šå°±ä¼šå¾ˆå¤§ï¼Œè¿›ä¸€æ­¥å‹ç¼© W1çš„å€¼ï¼Œä½¿ä»–ä¸è‡³äºè¿‡å¤§ï¼Œè€Œæ ‘æ¨¡å‹åˆ™ä¸ä¸€æ ·ï¼Œæ ‘æ¨¡å‹çš„æƒ©ç½šé¡¹é€šå¸¸ä¸ºå¶å­èŠ‚ç‚¹æ•°å’Œæ·±åº¦ç­‰ï¼Œè€Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå¯¹äºä¸Šé¢è¿™ç§ caseï¼Œæ ‘åªéœ€è¦ä¸€ä¸ªèŠ‚ç‚¹å°±å¯ä»¥å®Œç¾åˆ†å‰²9990å’Œ10ä¸ªæ ·æœ¬ï¼Œæƒ©ç½šé¡¹æå…¶ä¹‹å°.","title":"GBDT+LR"},{"content":"ä¸€ã€æ¦‚è¿° ç½‘ç»œè¡¨ç¤ºå­¦ä¹ ï¼ˆRepresentation Learning on Networkï¼‰ï¼Œä¸€èˆ¬è¯´çš„å°±æ˜¯å‘é‡åŒ–ï¼ˆEmbeddingï¼‰æŠ€æœ¯ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å°†ç½‘ç»œä¸­çš„ç»“æ„ï¼ˆèŠ‚ç‚¹ã€è¾¹æˆ–è€…å­å›¾ï¼‰ï¼Œé€šè¿‡ä¸€ç³»åˆ—è¿‡ç¨‹ï¼Œå˜æˆä¸€ä¸ªå¤šç»´å‘é‡ï¼Œé€šè¿‡è¿™æ ·ä¸€å±‚è½¬åŒ–ï¼Œèƒ½å¤Ÿå°†å¤æ‚çš„ç½‘ç»œä¿¡æ¯å˜æˆç»“æ„åŒ–çš„å¤šç»´ç‰¹å¾ï¼Œä»è€Œåˆ©ç”¨æœºå™¨å­¦ä¹ æ–¹æ³•å®ç°æ›´æ–¹ä¾¿çš„ç®—æ³•åº”ç”¨\nä¸»æµçš„KG embeddingçš„æ–¹æ³•åŒ…æ‹¬åŸºäºå¹³ç§»çš„æ¨¡å‹ï¼ˆå…¸å‹ä»£è¡¨ï¼šTransEï¼‰ï¼ŒåŸºäºçŸ©é˜µåˆ†è§£çš„æ¨¡å‹ï¼ˆå…¸å‹ä»£è¡¨ï¼šRESCALï¼‰ï¼ŒåŸºäºç¥ç»ç½‘ç»œçš„æ¨¡å‹ï¼ˆå…¸å‹ä»£è¡¨ï¼šNTNï¼‰å’ŒåŸºäºå›¾ç¥ç»ç½‘ç»œçš„æ¨¡å‹ï¼ˆå…¸å‹ä»£è¡¨ï¼šRGCNï¼‰ã€‚\næˆ‘ä»¬å¼€å§‹ä»‹ç»çŸ¥è¯†è¡¨ç¤ºå­¦ä¹ çš„å‡ ä¸ªä»£è¡¨æ¨¡å‹ï¼ŒåŒ…æ‹¬ï¼šç»“æ„å‘é‡æ¨¡å‹ã€è¯­ä¹‰åŒ¹é…èƒ½é‡æ¨¡å‹ã€éšå˜é‡æ¨¡å‹ã€ç¥ç»å¼ é‡ç½‘ç»œæ¨¡å‹ã€çŸ©é˜µåˆ†è§£æ¨¡å‹å’Œå¹³ç§»æ¨¡å‹ï¼Œç­‰ç­‰ã€‚\nä½†æ˜¯ä¼ ç»Ÿçš„KG embeddingæ¨¡å‹å­˜åœ¨ä¸€äº›ä¸è¶³ï¼Œä¾‹å¦‚å¤§å¤šæ•°æ–¹æ³•å®Œå…¨ä¾èµ–äºçŸ¥è¯†å›¾è°±ä¸­çš„ä¸‰å…ƒç»„æ•°æ®ï¼ŒçŸ¥è¯†å›¾è°±è¡¨ç¤ºå­¦ä¹ è¿‡ç¨‹ç¼ºä¹å¯è§£é‡Šæ€§ã€‚é’ˆå¯¹å®Œå…¨ä¾èµ–äºä¸‰å…ƒç»„æ•°æ®çš„é—®é¢˜ï¼Œä¸€ç±»æœ‰æ•ˆçš„æ–¹æ¡ˆæ˜¯å¼•å…¥çŸ¥è¯†å›¾è°±å›¾ç»“æ„ä¸­å­˜åœ¨çš„è·¯å¾„ä¿¡æ¯ï¼Œç»å…¸çš„åŸºäºè·¯å¾„çš„KG embeddingçš„æ–¹æ³•æ˜¯PTransEï¼Œå¯¹äºç”±å…³ç³»è·¯å¾„ä¸­çš„æ‰€æœ‰å…³ç³»çš„å‘é‡è¡¨ç¤ºï¼ŒPTtransEé€šè¿‡æ±‚å’Œã€ä¹˜ç§¯å’ŒRNNä¸‰ç§ç­–ç•¥è¿›è¡Œè·¯å¾„çš„ç»„åˆã€‚ç„¶è€Œï¼Œç°æœ‰çš„åŸºäºè·¯å¾„çš„çŸ¥è¯†å›¾è°±è¡¨ç¤ºå­¦ä¹ æ¨¡å‹çš„è·¯å¾„è¡¨ç¤ºè¿‡ç¨‹ä¸­å®Œå…¨åŸºäºæ•°æ®é©±åŠ¨ï¼Œç¼ºä¹å¯è§£é‡Šæ€§ã€‚åŒæ—¶ï¼ŒPTransEï¼ŒPathRNNç­‰å®Œå…¨æ•°æ®é©±åŠ¨çš„æ–¹æ³•åœ¨è¡¨ç¤ºè·¯å¾„çš„è¿‡ç¨‹ä¸­ä¼šé€ æˆè¯¯å·®ç´¯ç§¯å¹¶è¿›ä¸€æ­¥é™åˆ¶è·¯å¾„è¡¨ç¤ºçš„ç²¾åº¦ã€‚\nç›®å‰æåˆ°å›¾ç®—æ³•ä¸€èˆ¬æŒ‡ï¼š\nç»å…¸æ•°æ®ç»“æ„ä¸ç®—æ³•å±‚é¢çš„ï¼šæœ€å°ç”Ÿæˆæ ‘(Prim,Kruskal,\u0026hellip;)ï¼Œæœ€çŸ­è·¯(Dijkstra,Floyed,\u0026hellip;)ï¼Œæ‹“æ‰‘æ’åºï¼Œå…³é”®è·¯å¾„ç­‰\næ¦‚ç‡å›¾æ¨¡å‹ï¼Œæ¶‰åŠå›¾çš„è¡¨ç¤ºï¼Œæ¨æ–­å’Œå­¦ä¹ ï¼Œè¯¦ç»†å¯ä»¥å‚è€ƒKollerçš„ä¹¦æˆ–è€…å…¬å¼€è¯¾\nå›¾ç¥ç»ç½‘ç»œï¼Œä¸»è¦åŒ…æ‹¬Graph Embedding(åŸºäºéšæœºæ¸¸èµ°)å’ŒGraph CNN(åŸºäºé‚»å±…æ±‡èš)ä¸¤éƒ¨åˆ†ã€‚\näºŒã€Trans ç³»åˆ— ç°åœ¨ä¸»è¦ä»‹ç»çŸ¥è¯†è¡¨ç¤ºå­¦ä¹ çš„ä¸€ä¸ªæœ€ç®€å•ä¹Ÿæ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ¡ˆï¼Œå«TransEã€‚åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œæ¯ä¸ªå®ä½“å’Œå…³ç³»éƒ½è¡¨ç¤ºæˆä½ç»´å‘é‡ã€‚é‚£ä¹ˆå¦‚ä½•æ€ä¹ˆå­¦ä¹ è¿™äº›ä½ç»´å‘é‡å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ªå­¦ä¹ ç›®æ ‡ï¼Œè¿™ä¸ªç›®æ ‡å°±æ˜¯ï¼Œç»™å®šä»»ä½•ä¸€ä¸ªä¸‰å…ƒç»„ï¼Œæˆ‘ä»¬éƒ½å°†ä¸­é—´çš„relationçœ‹æˆæ˜¯ä»headåˆ°tailçš„ä¸€ä¸ªç¿»è¯‘è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´æŠŠheadçš„å‘é‡åŠ ä¸Šrelationçš„å‘é‡ï¼Œè¦è®©å®ƒå°½å¯èƒ½åœ°ç­‰äºtailå‘é‡ã€‚åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ä¸æ–­è°ƒæ•´ã€æ›´æ–°å®ä½“å’Œå…³ç³»å‘é‡çš„å–å€¼ï¼Œä½¿è¿™äº›ç­‰å¼å°½å¯èƒ½å®ç°ã€‚\näº›å®ä½“å’Œå…³ç³»çš„è¡¨ç¤ºå¯ä»¥ç”¨æ¥åšä»€ä¹ˆå‘¢ï¼Ÿä¸€ä¸ªç›´è§‚çš„åº”ç”¨å°±æ˜¯Entity Predictionï¼ˆå®ä½“é¢„æµ‹ï¼‰ã€‚å°±æ˜¯è¯´ï¼Œå¦‚æœç»™ä¸€ä¸ªhead entityï¼Œå†ç»™ä¸€ä¸ªrelationï¼Œé‚£ä¹ˆå¯ä»¥åˆ©ç”¨åˆšæ‰å­¦åˆ°çš„å‘é‡è¡¨ç¤ºï¼Œå»é¢„æµ‹å®ƒçš„tail entityå¯èƒ½æ˜¯ä»€ä¹ˆã€‚æ€æƒ³éå¸¸ç®€å•ï¼Œç›´æ¥æŠŠh rï¼Œç„¶åå»æ‰¾è·Ÿh rå‘é‡æœ€ç›¸è¿‘çš„tailå‘é‡å°±å¯ä»¥äº†ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿç”¨è¿™ä¸ªä»»åŠ¡æ¥åˆ¤æ–­ä¸åŒè¡¨ç¤ºæ¨¡å‹çš„æ•ˆæœã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä»¥TransEä¸ºä»£è¡¨çš„ç¿»è¯‘æ¨¡å‹ï¼Œéœ€è¦å­¦ä¹ çš„å‚æ•°æ•°é‡è¦å°å¾ˆå¤šï¼Œä½†åŒæ—¶èƒ½å¤Ÿè¾¾åˆ°éå¸¸å¥½çš„é¢„æµ‹å‡†ç¡®ç‡ã€‚\ntrans ç³»åˆ—è¯¦è§£: http://aiblog.top/2019/07/08/Trans%E7%B3%BB%E5%88%97%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/\nè¿™é‡Œä¸¾ä¸€äº›ä¾‹å­ã€‚é¦–å…ˆï¼Œåˆ©ç”¨TransEå­¦åˆ°çš„å®ä½“è¡¨ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°è®¡ç®—å‡ºè·ŸæŸä¸ªå®ä½“æœ€ç›¸ä¼¼çš„å®ä½“ã€‚å¤§å®¶å¯ä»¥çœ‹åˆ°\nï¼Œå…³äºä¸­å›½ã€å¥¥å·´é©¬ã€è‹¹æœï¼Œé€šè¿‡TransEå‘é‡å¾—åˆ°çš„ç›¸ä¼¼å®ä½“èƒ½å¤Ÿéå¸¸å¥½åœ°åæ˜ è¿™äº›å®ä½“çš„å…³è”ã€‚\nå¦‚æœå·²çŸ¥head entityå’Œrelationï¼Œæˆ‘ä»¬å¯ä»¥ç”¨TransEæ¨¡å‹åˆ¤æ–­å¯¹åº”çš„tail entityæ˜¯ä»€ä¹ˆã€‚æ¯”å¦‚è¯´ä¸ä¸­å›½ç›¸é‚»çš„å›½å®¶æˆ–è€…åœ°åŒºï¼Œå¯ä»¥çœ‹åˆ°æ¯”è¾ƒé å‰çš„å®ä½“å‡æ¯”è¾ƒç›¸å…³ã€‚æ¯”å¦‚è¯´å¥¥å·´é©¬æ›¾ç»å…¥å­¦çš„å­¦æ ¡ï¼Œè™½ç„¶å‰é¢çš„æœ‰äº›å¹¶ä¸å‡†ç¡®ï¼Œä½†æ˜¯åŸºæœ¬ä¸Šä¹Ÿéƒ½æ˜¯å¤§å­¦æˆ–æ•™è‚²æœºæ„ã€‚\nå¾ˆå¤šæƒ…å†µä¸‹TransEå…³äºh r=tçš„å‡è®¾å…¶å®æœ¬èº«å¹¶ä¸ç¬¦åˆå®é™…ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå‡å¦‚å¤´å®ä½“æ˜¯ç¾å›½ï¼Œå…³ç³»æ˜¯æ€»ç»Ÿï¼Œè€Œç¾å›½æ€»ç»Ÿå…¶å®æœ‰éå¸¸å¤šï¼Œæˆ‘ä»¬æ‹¿å‡ºä»»æ„ä¸¤ä¸ªå®ä½“æ¥ï¼Œæ¯”å¦‚å¥¥å·´é©¬å’Œå¸ƒä»€ï¼Œè¿™ä¸¤ä¸ªäººéƒ½å¯ä»¥è·ŸUSAæ„æˆåŒæ ·çš„å…³ç³»ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹è¿™ä¸¤ä¸ªä¸‰å…ƒç»„å­¦ä¹ TransEæ¨¡å‹ï¼Œå°±ä¼šå‘ç°ï¼Œå®ƒå€¾å‘äºè®©å¥¥å·´é©¬å’Œå¸ƒä»€åœ¨ç©ºé—´ä¸­å˜å¾—éå¸¸æ¥è¿‘ã€‚è€Œè¿™å…¶å®ä¸å¤ªç¬¦åˆå¸¸ç†ï¼Œå› ä¸ºå¥¥å·´é©¬å’Œå¸ƒä»€è™½ç„¶éƒ½æ˜¯ç¾å›½æ€»ç»Ÿï¼Œä½†æ˜¯åœ¨å…¶ä»–æ–¹é¢æœ‰åƒå·®ä¸‡åˆ«ã€‚è¿™å…¶å®å°±æ˜¯æ¶‰åŠåˆ°å¤æ‚å…³ç³»çš„å¤„ç†é—®é¢˜ï¼Œå³æ‰€è°“çš„1å¯¹Nï¼ŒNå¯¹1ã€Nå¯¹Nè¿™äº›å…³ç³»ã€‚åˆšæ‰ä¾‹å­å°±æ˜¯å…¸å‹çš„1å¯¹Nå…³ç³»ï¼Œå°±æ˜¯ä¸€ä¸ªUSAå¯èƒ½ä¼šå¯¹åº”å¤šä¸ªtail entityã€‚ä¸ºäº†è§£å†³TransEåœ¨å¤„ç†å¤æ‚å…³ç³»æ—¶çš„ä¸è¶³ï¼Œç ”ç©¶è€…æå‡ºå¾ˆå¤šæ‰©å±•æ¨¡å‹ï¼ŒåŸºæœ¬æ€æƒ³æ˜¯ï¼Œé¦–å…ˆæŠŠå®ä½“æŒ‰ç…§å…³ç³»è¿›è¡Œæ˜ å°„ï¼Œç„¶åä¸è¯¥å…³ç³»æ„å»ºç¿»è¯‘ç­‰å¼ã€‚\n1 - 1 transE æ•ˆæœå¾ˆå¥½ï¼Œä½†æ˜¯1-N, N-1, N-N è¿™äº›å¤æ‚æƒ…å†µæ¯”è¾ƒéš¾ã€‚\nTransHå’ŒTransRå‡ä¸ºä»£è¡¨æ‰©å±•æ¨¡å‹ä¹‹ä¸€ï¼Œå…¶ä¸­TransHç”±MSRAç ”ç©¶è€…æå‡ºï¼ŒTransRç”±æˆ‘ä»¬å®éªŒå®¤æå‡ºã€‚å¯ä»¥çœ‹åˆ°ï¼ŒTransEåœ¨å®ä½“é¢„æµ‹ä»»åŠ¡èƒ½å¤Ÿè¾¾åˆ°47.1çš„å‡†ç¡®ç‡ï¼Œè€Œé‡‡ç”¨TransHå’ŒTransRï¼Œç‰¹åˆ«æ˜¯TransRå¯ä»¥è¾¾åˆ°20%çš„æå‡ã€‚å¯¹äºçŸ¥è¯†å›¾è°±å¤æ‚å…³ç³»çš„å¤„ç†ï¼Œè¿˜æœ‰å¾ˆå¤šå·¥ä½œéœ€è¦åšã€‚è¿™é‡Œåªæ˜¯ç®€ä»‹äº†ä¸€äº›åˆæ­¥å°è¯•ã€‚\nå¯¹äºTransHå’ŒTransRçš„æ•ˆæœæˆ‘ä»¬ç»™å‡ºä¸€äº›ä¾‹å­ã€‚æ¯”å¦‚å¯¹äºã€Šæ³°å¦å°¼å…‹å·ã€‹ç”µå½±ï¼Œæƒ³çœ‹å®ƒçš„ç”µå½±é£æ ¼æ˜¯ä»€ä¹ˆï¼ŒTransEå¾—åˆ°çš„æ•ˆæœæ¯”TransHå’ŒTransRéƒ½è¦å·®ä¸€äº›ã€‚å†å¦‚å‰‘æ¡¥å¤§å­¦çš„æ°å‡ºæ ¡å‹æœ‰å“ªäº›ï¼Ÿæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹è¿™ç§å…¸å‹çš„1å¯¹Nå…³ç³»ï¼ŒTransRå’ŒTransHå‡åšå¾—æ›´å¥½ä¸€äº›ã€‚\nTrans ç³»åˆ—Github: https://github.com/thunlp/OpenKE\nè€ƒè™‘çŸ¥è¯†å›¾è°±å¤æ‚å…³ç³»ï¼š æŒ‰ç…§çŸ¥è¯†å›¾è°±ä¸­å…³ç³»ä¸¤ç«¯è¿æ¥å®ä½“çš„å¯¹åº”æ•°ç›®ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…³ç³»åˆ’åˆ†ä¸ºä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šå››ç§ç±»å‹ã€‚ç±»å‹å…³ç³»æŒ‡çš„æ˜¯ï¼Œè¯¥ç±»å‹å…³ç³»ä¸­çš„ä¸€ä¸ªå·¦ä¾§å®ä½“ä¼šå¹³å‡å¯¹åº”å¤šä¸ªå³ä¾§å®ä½“ã€‚ ç°æœ‰çŸ¥è¯†è¡¨ç¤ºå­¦ä¹ ç®—æ³•åœ¨å¤„ç†å››ç§ç±»å‹å…³ç³»æ—¶çš„æ€§èƒ½å·®å¼‚è¾ƒå¤§ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æå‡ºäº†åŸºäºç©ºé—´è½¬ç§»çš„ TransR æ¨¡å‹å¯¹ä¸åŒçš„çŸ¥è¯†/å…³ç³»çš„ç»“æ„ç±»å‹è¿›è¡Œç²¾ç»†å»ºæ¨¡ã€‚\nè€ƒè™‘çŸ¥è¯†å›¾è°±å¤æ‚è·¯å¾„ï¼š åœ¨çŸ¥è¯†å›¾è°±ä¸­ï¼Œæœ‰äº›å¤šæ­¥å…³ç³»è·¯å¾„ä¹Ÿèƒ½å¤Ÿåæ˜ å®ä½“ä¹‹é—´çš„å…³ç³»ã€‚ä¸ºäº†çªç ´ç°æœ‰çŸ¥è¯†è¡¨ç¤ºå­¦ä¹ æ¨¡å‹å­¤ç«‹å­¦ä¹ æ¯ä¸ªä¸‰å…ƒç»„çš„å±€é™æ€§ï¼Œæˆ‘ä»¬å°†å€Ÿé‰´å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRecursive Neural Networksï¼‰çš„å­¦æœ¯æ€æƒ³ï¼Œæå‡ºè€ƒè™‘å…³ç³»è·¯å¾„çš„è¡¨ç¤ºå­¦ä¹ æ–¹æ³•ã€‚æˆ‘ä»¬ä»¥å¹³ç§»æ¨¡å‹ TransE ä½œä¸ºåŸºç¡€è¿›è¡Œæ‰©å±•ï¼Œæå‡º Path-based TransEï¼ˆPTransEï¼‰æ¨¡å‹å¯¹çŸ¥è¯†å›¾è°±ä¸­çš„å¤æ‚å…³ç³»è·¯å¾„è¿›è¡Œå»ºæ¨¡ã€‚\nè€ƒè™‘çŸ¥è¯†å›¾è°±å¤æ‚å±æ€§ï¼š ç°æœ‰çŸ¥è¯†è¡¨ç¤ºå­¦ä¹ æ¨¡å‹å°†æ‰€æœ‰å…³ç³»éƒ½è¡¨ç¤ºä¸ºå‘é‡ï¼Œè¿™åœ¨æå¤§ç¨‹åº¦ä¸Šé™åˆ¶äº†å¯¹å…³ç³»çš„è¯­ä¹‰çš„è¡¨ç¤ºèƒ½åŠ›ã€‚è¿™ç§å±€é™æ€§åœ¨å±æ€§çŸ¥è¯†çš„è¡¨ç¤ºä¸Šå°¤ä¸ºçªå‡ºã€‚æˆ‘ä»¬é¢å‘å±æ€§çŸ¥è¯†ï¼Œç ”ç©¶åˆ©ç”¨åˆ†ç±»æ¨¡å‹è¡¨ç¤ºå±æ€§å…³ç³»ï¼Œé€š è¿‡å­¦ä¹ åˆ†ç±»å™¨å»ºç«‹å®ä½“ä¸å±æ€§ä¹‹é—´çš„å…³ç³»ï¼Œåœ¨æ—¢æœ‰çŸ¥è¯†å›¾è°±å…³ç³»è¡¨ç¤ºæ–¹æ¡ˆçš„åŸºç¡€ä¸Šï¼Œæ¢ç´¢å…·æœ‰æ›´å¼ºè¡¨ç¤ºèƒ½åŠ›çš„è¡¨ç¤ºæ–¹æ¡ˆã€‚\näºŒã€DeepWalk DeepWalkçš„æ€æƒ³ç±»ä¼¼word2vecï¼Œä½¿ç”¨å›¾ä¸­èŠ‚ç‚¹ä¸èŠ‚ç‚¹çš„å…±ç°å…³ç³»æ¥å­¦ä¹ èŠ‚ç‚¹çš„å‘é‡è¡¨ç¤ºã€‚é‚£ä¹ˆå…³é”®çš„é—®é¢˜å°±æ˜¯å¦‚ä½•æ¥æè¿°èŠ‚ç‚¹ä¸èŠ‚ç‚¹çš„å…±ç°å…³ç³»ï¼ŒDeepWalkç»™å‡ºçš„æ–¹æ³•æ˜¯ä½¿ç”¨éšæœºæ¸¸èµ°(RandomWalk)çš„æ–¹å¼åœ¨å›¾ä¸­è¿›è¡ŒèŠ‚ç‚¹é‡‡æ ·ã€‚\nRandomWalkæ˜¯ä¸€ç§å¯é‡å¤è®¿é—®å·²è®¿é—®èŠ‚ç‚¹çš„æ·±åº¦ä¼˜å…ˆéå†ç®—æ³•ã€‚ç»™å®šå½“å‰è®¿é—®èµ·å§‹èŠ‚ç‚¹ï¼Œä»å…¶é‚»å±…ä¸­éšæœºé‡‡æ ·èŠ‚ç‚¹ä½œä¸ºä¸‹ä¸€ä¸ªè®¿é—®èŠ‚ç‚¹ï¼Œé‡å¤æ­¤è¿‡ç¨‹ï¼Œç›´åˆ°è®¿é—®åºåˆ—é•¿åº¦æ»¡è¶³é¢„è®¾æ¡ä»¶ã€‚\nè·å–è¶³å¤Ÿæ•°é‡çš„èŠ‚ç‚¹è®¿é—®åºåˆ—åï¼Œä½¿ç”¨skip-gram model è¿›è¡Œå‘é‡å­¦ä¹ ã€‚\nDeepWalk æ ¸å¿ƒä»£ç  DeepWalkç®—æ³•ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ï¼Œç¬¬ä¸€æ­¥ä¸ºéšæœºæ¸¸èµ°é‡‡æ ·èŠ‚ç‚¹åºåˆ—ï¼Œç¬¬äºŒæ­¥ä¸ºä½¿ç”¨skip-gram modelword2vecå­¦ä¹ è¡¨è¾¾å‘é‡ã€‚\nâ‘ æ„å»ºåŒæ„ç½‘ç»œï¼Œä»ç½‘ç»œä¸­çš„æ¯ä¸ªèŠ‚ç‚¹å¼€å§‹åˆ†åˆ«è¿›è¡ŒRandom Walk é‡‡æ ·ï¼Œå¾—åˆ°å±€éƒ¨ç›¸å…³è”çš„è®­ç»ƒæ•°æ®ï¼›\nâ‘¡å¯¹é‡‡æ ·æ•°æ®è¿›è¡ŒSkipGramè®­ç»ƒï¼Œå°†ç¦»æ•£çš„ç½‘ç»œèŠ‚ç‚¹è¡¨ç¤ºæˆå‘é‡åŒ–ï¼Œæœ€å¤§åŒ–èŠ‚ç‚¹å…±ç°ï¼Œä½¿ç”¨Hierarchical Softmaxæ¥åšè¶…å¤§è§„æ¨¡åˆ†ç±»çš„åˆ†ç±»å™¨\nRandom Walk æˆ‘ä»¬å¯ä»¥é€šè¿‡å¹¶è¡Œçš„æ–¹å¼åŠ é€Ÿè·¯å¾„é‡‡æ ·ï¼Œåœ¨é‡‡ç”¨å¤šè¿›ç¨‹è¿›è¡ŒåŠ é€Ÿæ—¶ï¼Œç›¸æ¯”äºå¼€ä¸€ä¸ªè¿›ç¨‹æ± è®©æ¯æ¬¡å¤–å±‚å¾ªç¯å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œæˆ‘ä»¬é‡‡ç”¨å›ºå®šä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…æŒ‡å®šæ•°é‡çš„num_walksçš„æ–¹å¼ï¼Œè¿™æ ·å¯ä»¥æœ€å¤§é™åº¦å‡å°‘è¿›ç¨‹é¢‘ç¹åˆ›å»ºä¸é”€æ¯çš„æ—¶é—´å¼€é”€ã€‚\ndeepwalk_walkæ–¹æ³•å¯¹åº”ä¸Šä¸€èŠ‚ä¼ªä»£ç ä¸­ç¬¬6è¡Œï¼Œ_simulate_walkså¯¹åº”ä¼ªä»£ç ä¸­ç¬¬3è¡Œå¼€å§‹çš„å¤–å±‚å¾ªç¯ã€‚æœ€åçš„Parallelä¸ºå¤šè¿›ç¨‹å¹¶è¡Œæ—¶çš„ä»»åŠ¡åˆ†é…æ“ä½œã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 def deepwalk_walk(self, walk_length, start_node): walk = [start_node] while len(walk) \u0026lt; walk_length: cur = walk[-1] cur_nbrs = list(self.G.neighbors(cur)) if len(cur_nbrs) \u0026gt; 0: walk.append(random.choice(cur_nbrs)) else: break return walk def _simulate_walks(self, nodes, num_walks, walk_length,): walks = [] for _ in range(num_walks): random.shuffle(nodes) for v in nodes: walks.append(self.deepwalk_walk(alk_length=walk_length, start_node=v)) return walks results = Parallel(n_jobs=workers, verbose=verbose, )( delayed(self._simulate_walks)(nodes, num, walk_length) for num in partition_num(num_walks, workers)) walks = list(itertools.chain(*results)) Word2vec è¿™é‡Œå°±å·ä¸ªæ‡’ç›´æ¥ç”¨gensimé‡Œçš„Word2Vecäº†ã€‚\n1 2 from gensim.models import Word2Vec w2v_model = Word2Vec(walks,sg=1,hs=1) DeepWalkåº”ç”¨ è¿™é‡Œç®€å•çš„ç”¨DeepWalkç®—æ³•åœ¨wikiæ•°æ®é›†ä¸Šè¿›è¡ŒèŠ‚ç‚¹åˆ†ç±»ä»»åŠ¡å’Œå¯è§†åŒ–ä»»åŠ¡ã€‚ wikiæ•°æ®é›†åŒ…å« 2,405 ä¸ªç½‘é¡µå’Œ17,981æ¡ç½‘é¡µä¹‹é—´çš„é“¾æ¥å…³ç³»ï¼Œä»¥åŠæ¯ä¸ªç½‘é¡µçš„æ‰€å±ç±»åˆ«ã€‚\næœ¬ä¾‹ä¸­çš„è®­ç»ƒï¼Œè¯„æµ‹å’Œå¯è§†åŒ–çš„å®Œæ•´ä»£ç åœ¨ä¸‹é¢çš„gitä»“åº“ä¸­ï¼Œåé¢è¿˜ä¼šé™†ç»­æ›´æ–°line,node2vec,sdne,struc2vecç­‰graph embeddingç®—æ³•ä»¥åŠä¸€äº›GCNç®—æ³•\n1 2 3 4 5 6 7 8 G = nx.read_edgelist(\u0026#39;../data/wiki/Wiki_edgelist.txt\u0026#39;,create_using=nx.DiGraph(),nodetype=None,data=[(\u0026#39;weight\u0026#39;,int)]) model = DeepWalk(G,walk_length=10,num_walks=80,workers=1) model.train(window_size=5,iter=3) embeddings = model.get_embeddings() evaluate_embeddings(embeddings) plot_embeddings(embeddings) åˆ†ç±»ä»»åŠ¡ç»“æœ micro-F1 : 0.6674\nmacro-F1 : 0.5768\n","permalink":"https://reid00.github.io/en/posts/ml/kg%E8%A1%A8%E7%A4%BA%E5%AD%A6%E4%B9%A0/","summary":"ä¸€ã€æ¦‚è¿° ç½‘ç»œè¡¨ç¤ºå­¦ä¹ ï¼ˆRepresentation Learning on Networkï¼‰ï¼Œä¸€èˆ¬è¯´çš„å°±æ˜¯å‘é‡åŒ–ï¼ˆEmbeddingï¼‰æŠ€æœ¯ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å°†ç½‘ç»œä¸­çš„ç»“æ„ï¼ˆèŠ‚ç‚¹ã€è¾¹æˆ–è€…å­å›¾ï¼‰ï¼Œé€šè¿‡ä¸€ç³»åˆ—è¿‡ç¨‹ï¼Œå˜æˆä¸€ä¸ªå¤šç»´å‘é‡ï¼Œé€šè¿‡è¿™æ ·ä¸€å±‚è½¬åŒ–ï¼Œèƒ½å¤Ÿå°†å¤æ‚çš„ç½‘ç»œä¿¡æ¯å˜æˆç»“æ„åŒ–çš„å¤šç»´ç‰¹å¾ï¼Œä»è€Œåˆ©ç”¨æœºå™¨å­¦ä¹ æ–¹æ³•å®ç°æ›´æ–¹ä¾¿çš„ç®—æ³•åº”ç”¨\nä¸»æµçš„KG embeddingçš„æ–¹æ³•åŒ…æ‹¬åŸºäºå¹³ç§»çš„æ¨¡å‹ï¼ˆå…¸å‹ä»£è¡¨ï¼šTransEï¼‰ï¼ŒåŸºäºçŸ©é˜µåˆ†è§£çš„æ¨¡å‹ï¼ˆå…¸å‹ä»£è¡¨ï¼šRESCALï¼‰ï¼ŒåŸºäºç¥ç»ç½‘ç»œçš„æ¨¡å‹ï¼ˆå…¸å‹ä»£è¡¨ï¼šNTNï¼‰å’ŒåŸºäºå›¾ç¥ç»ç½‘ç»œçš„æ¨¡å‹ï¼ˆå…¸å‹ä»£è¡¨ï¼šRGCNï¼‰ã€‚\næˆ‘ä»¬å¼€å§‹ä»‹ç»çŸ¥è¯†è¡¨ç¤ºå­¦ä¹ çš„å‡ ä¸ªä»£è¡¨æ¨¡å‹ï¼ŒåŒ…æ‹¬ï¼šç»“æ„å‘é‡æ¨¡å‹ã€è¯­ä¹‰åŒ¹é…èƒ½é‡æ¨¡å‹ã€éšå˜é‡æ¨¡å‹ã€ç¥ç»å¼ é‡ç½‘ç»œæ¨¡å‹ã€çŸ©é˜µåˆ†è§£æ¨¡å‹å’Œå¹³ç§»æ¨¡å‹ï¼Œç­‰ç­‰ã€‚\nä½†æ˜¯ä¼ ç»Ÿçš„KG embeddingæ¨¡å‹å­˜åœ¨ä¸€äº›ä¸è¶³ï¼Œä¾‹å¦‚å¤§å¤šæ•°æ–¹æ³•å®Œå…¨ä¾èµ–äºçŸ¥è¯†å›¾è°±ä¸­çš„ä¸‰å…ƒç»„æ•°æ®ï¼ŒçŸ¥è¯†å›¾è°±è¡¨ç¤ºå­¦ä¹ è¿‡ç¨‹ç¼ºä¹å¯è§£é‡Šæ€§ã€‚é’ˆå¯¹å®Œå…¨ä¾èµ–äºä¸‰å…ƒç»„æ•°æ®çš„é—®é¢˜ï¼Œä¸€ç±»æœ‰æ•ˆçš„æ–¹æ¡ˆæ˜¯å¼•å…¥çŸ¥è¯†å›¾è°±å›¾ç»“æ„ä¸­å­˜åœ¨çš„è·¯å¾„ä¿¡æ¯ï¼Œç»å…¸çš„åŸºäºè·¯å¾„çš„KG embeddingçš„æ–¹æ³•æ˜¯PTransEï¼Œå¯¹äºç”±å…³ç³»è·¯å¾„ä¸­çš„æ‰€æœ‰å…³ç³»çš„å‘é‡è¡¨ç¤ºï¼ŒPTtransEé€šè¿‡æ±‚å’Œã€ä¹˜ç§¯å’ŒRNNä¸‰ç§ç­–ç•¥è¿›è¡Œè·¯å¾„çš„ç»„åˆã€‚ç„¶è€Œï¼Œç°æœ‰çš„åŸºäºè·¯å¾„çš„çŸ¥è¯†å›¾è°±è¡¨ç¤ºå­¦ä¹ æ¨¡å‹çš„è·¯å¾„è¡¨ç¤ºè¿‡ç¨‹ä¸­å®Œå…¨åŸºäºæ•°æ®é©±åŠ¨ï¼Œç¼ºä¹å¯è§£é‡Šæ€§ã€‚åŒæ—¶ï¼ŒPTransEï¼ŒPathRNNç­‰å®Œå…¨æ•°æ®é©±åŠ¨çš„æ–¹æ³•åœ¨è¡¨ç¤ºè·¯å¾„çš„è¿‡ç¨‹ä¸­ä¼šé€ æˆè¯¯å·®ç´¯ç§¯å¹¶è¿›ä¸€æ­¥é™åˆ¶è·¯å¾„è¡¨ç¤ºçš„ç²¾åº¦ã€‚\nç›®å‰æåˆ°å›¾ç®—æ³•ä¸€èˆ¬æŒ‡ï¼š\nç»å…¸æ•°æ®ç»“æ„ä¸ç®—æ³•å±‚é¢çš„ï¼šæœ€å°ç”Ÿæˆæ ‘(Prim,Kruskal,\u0026hellip;)ï¼Œæœ€çŸ­è·¯(Dijkstra,Floyed,\u0026hellip;)ï¼Œæ‹“æ‰‘æ’åºï¼Œå…³é”®è·¯å¾„ç­‰\næ¦‚ç‡å›¾æ¨¡å‹ï¼Œæ¶‰åŠå›¾çš„è¡¨ç¤ºï¼Œæ¨æ–­å’Œå­¦ä¹ ï¼Œè¯¦ç»†å¯ä»¥å‚è€ƒKollerçš„ä¹¦æˆ–è€…å…¬å¼€è¯¾\nå›¾ç¥ç»ç½‘ç»œï¼Œä¸»è¦åŒ…æ‹¬Graph Embedding(åŸºäºéšæœºæ¸¸èµ°)å’ŒGraph CNN(åŸºäºé‚»å±…æ±‡èš)ä¸¤éƒ¨åˆ†ã€‚\näºŒã€Trans ç³»åˆ— ç°åœ¨ä¸»è¦ä»‹ç»çŸ¥è¯†è¡¨ç¤ºå­¦ä¹ çš„ä¸€ä¸ªæœ€ç®€å•ä¹Ÿæ˜¯æœ€æœ‰æ•ˆçš„æ–¹æ¡ˆï¼Œå«TransEã€‚åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œæ¯ä¸ªå®ä½“å’Œå…³ç³»éƒ½è¡¨ç¤ºæˆä½ç»´å‘é‡ã€‚é‚£ä¹ˆå¦‚ä½•æ€ä¹ˆå­¦ä¹ è¿™äº›ä½ç»´å‘é‡å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ªå­¦ä¹ ç›®æ ‡ï¼Œè¿™ä¸ªç›®æ ‡å°±æ˜¯ï¼Œç»™å®šä»»ä½•ä¸€ä¸ªä¸‰å…ƒç»„ï¼Œæˆ‘ä»¬éƒ½å°†ä¸­é—´çš„relationçœ‹æˆæ˜¯ä»headåˆ°tailçš„ä¸€ä¸ªç¿»è¯‘è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´æŠŠheadçš„å‘é‡åŠ ä¸Šrelationçš„å‘é‡ï¼Œè¦è®©å®ƒå°½å¯èƒ½åœ°ç­‰äºtailå‘é‡ã€‚åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ä¸æ–­è°ƒæ•´ã€æ›´æ–°å®ä½“å’Œå…³ç³»å‘é‡çš„å–å€¼ï¼Œä½¿è¿™äº›ç­‰å¼å°½å¯èƒ½å®ç°ã€‚\näº›å®ä½“å’Œå…³ç³»çš„è¡¨ç¤ºå¯ä»¥ç”¨æ¥åšä»€ä¹ˆå‘¢ï¼Ÿä¸€ä¸ªç›´è§‚çš„åº”ç”¨å°±æ˜¯Entity Predictionï¼ˆå®ä½“é¢„æµ‹ï¼‰ã€‚å°±æ˜¯è¯´ï¼Œå¦‚æœç»™ä¸€ä¸ªhead entityï¼Œå†ç»™ä¸€ä¸ªrelationï¼Œé‚£ä¹ˆå¯ä»¥åˆ©ç”¨åˆšæ‰å­¦åˆ°çš„å‘é‡è¡¨ç¤ºï¼Œå»é¢„æµ‹å®ƒçš„tail entityå¯èƒ½æ˜¯ä»€ä¹ˆã€‚æ€æƒ³éå¸¸ç®€å•ï¼Œç›´æ¥æŠŠh rï¼Œç„¶åå»æ‰¾è·Ÿh rå‘é‡æœ€ç›¸è¿‘çš„tailå‘é‡å°±å¯ä»¥äº†ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿç”¨è¿™ä¸ªä»»åŠ¡æ¥åˆ¤æ–­ä¸åŒè¡¨ç¤ºæ¨¡å‹çš„æ•ˆæœã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä»¥TransEä¸ºä»£è¡¨çš„ç¿»è¯‘æ¨¡å‹ï¼Œéœ€è¦å­¦ä¹ çš„å‚æ•°æ•°é‡è¦å°å¾ˆå¤šï¼Œä½†åŒæ—¶èƒ½å¤Ÿè¾¾åˆ°éå¸¸å¥½çš„é¢„æµ‹å‡†ç¡®ç‡ã€‚\ntrans ç³»åˆ—è¯¦è§£: http://aiblog.top/2019/07/08/Trans%E7%B3%BB%E5%88%97%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3/\nè¿™é‡Œä¸¾ä¸€äº›ä¾‹å­ã€‚é¦–å…ˆï¼Œåˆ©ç”¨TransEå­¦åˆ°çš„å®ä½“è¡¨ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°è®¡ç®—å‡ºè·ŸæŸä¸ªå®ä½“æœ€ç›¸ä¼¼çš„å®ä½“ã€‚å¤§å®¶å¯ä»¥çœ‹åˆ°\nï¼Œå…³äºä¸­å›½ã€å¥¥å·´é©¬ã€è‹¹æœï¼Œé€šè¿‡TransEå‘é‡å¾—åˆ°çš„ç›¸ä¼¼å®ä½“èƒ½å¤Ÿéå¸¸å¥½åœ°åæ˜ è¿™äº›å®ä½“çš„å…³è”ã€‚\nå¦‚æœå·²çŸ¥head entityå’Œrelationï¼Œæˆ‘ä»¬å¯ä»¥ç”¨TransEæ¨¡å‹åˆ¤æ–­å¯¹åº”çš„tail entityæ˜¯ä»€ä¹ˆã€‚æ¯”å¦‚è¯´ä¸ä¸­å›½ç›¸é‚»çš„å›½å®¶æˆ–è€…åœ°åŒºï¼Œå¯ä»¥çœ‹åˆ°æ¯”è¾ƒé å‰çš„å®ä½“å‡æ¯”è¾ƒç›¸å…³ã€‚æ¯”å¦‚è¯´å¥¥å·´é©¬æ›¾ç»å…¥å­¦çš„å­¦æ ¡ï¼Œè™½ç„¶å‰é¢çš„æœ‰äº›å¹¶ä¸å‡†ç¡®ï¼Œä½†æ˜¯åŸºæœ¬ä¸Šä¹Ÿéƒ½æ˜¯å¤§å­¦æˆ–æ•™è‚²æœºæ„ã€‚\nå¾ˆå¤šæƒ…å†µä¸‹TransEå…³äºh r=tçš„å‡è®¾å…¶å®æœ¬èº«å¹¶ä¸ç¬¦åˆå®é™…ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå‡å¦‚å¤´å®ä½“æ˜¯ç¾å›½ï¼Œå…³ç³»æ˜¯æ€»ç»Ÿï¼Œè€Œç¾å›½æ€»ç»Ÿå…¶å®æœ‰éå¸¸å¤šï¼Œæˆ‘ä»¬æ‹¿å‡ºä»»æ„ä¸¤ä¸ªå®ä½“æ¥ï¼Œæ¯”å¦‚å¥¥å·´é©¬å’Œå¸ƒä»€ï¼Œè¿™ä¸¤ä¸ªäººéƒ½å¯ä»¥è·ŸUSAæ„æˆåŒæ ·çš„å…³ç³»ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹è¿™ä¸¤ä¸ªä¸‰å…ƒç»„å­¦ä¹ TransEæ¨¡å‹ï¼Œå°±ä¼šå‘ç°ï¼Œå®ƒå€¾å‘äºè®©å¥¥å·´é©¬å’Œå¸ƒä»€åœ¨ç©ºé—´ä¸­å˜å¾—éå¸¸æ¥è¿‘ã€‚è€Œè¿™å…¶å®ä¸å¤ªç¬¦åˆå¸¸ç†ï¼Œå› ä¸ºå¥¥å·´é©¬å’Œå¸ƒä»€è™½ç„¶éƒ½æ˜¯ç¾å›½æ€»ç»Ÿï¼Œä½†æ˜¯åœ¨å…¶ä»–æ–¹é¢æœ‰åƒå·®ä¸‡åˆ«ã€‚è¿™å…¶å®å°±æ˜¯æ¶‰åŠåˆ°å¤æ‚å…³ç³»çš„å¤„ç†é—®é¢˜ï¼Œå³æ‰€è°“çš„1å¯¹Nï¼ŒNå¯¹1ã€Nå¯¹Nè¿™äº›å…³ç³»ã€‚åˆšæ‰ä¾‹å­å°±æ˜¯å…¸å‹çš„1å¯¹Nå…³ç³»ï¼Œå°±æ˜¯ä¸€ä¸ªUSAå¯èƒ½ä¼šå¯¹åº”å¤šä¸ªtail entityã€‚ä¸ºäº†è§£å†³TransEåœ¨å¤„ç†å¤æ‚å…³ç³»æ—¶çš„ä¸è¶³ï¼Œç ”ç©¶è€…æå‡ºå¾ˆå¤šæ‰©å±•æ¨¡å‹ï¼ŒåŸºæœ¬æ€æƒ³æ˜¯ï¼Œé¦–å…ˆæŠŠå®ä½“æŒ‰ç…§å…³ç³»è¿›è¡Œæ˜ å°„ï¼Œç„¶åä¸è¯¥å…³ç³»æ„å»ºç¿»è¯‘ç­‰å¼ã€‚\n1 - 1 transE æ•ˆæœå¾ˆå¥½ï¼Œä½†æ˜¯1-N, N-1, N-N è¿™äº›å¤æ‚æƒ…å†µæ¯”è¾ƒéš¾ã€‚\nTransHå’ŒTransRå‡ä¸ºä»£è¡¨æ‰©å±•æ¨¡å‹ä¹‹ä¸€ï¼Œå…¶ä¸­TransHç”±MSRAç ”ç©¶è€…æå‡ºï¼ŒTransRç”±æˆ‘ä»¬å®éªŒå®¤æå‡ºã€‚å¯ä»¥çœ‹åˆ°ï¼ŒTransEåœ¨å®ä½“é¢„æµ‹ä»»åŠ¡èƒ½å¤Ÿè¾¾åˆ°47.1çš„å‡†ç¡®ç‡ï¼Œè€Œé‡‡ç”¨TransHå’ŒTransRï¼Œç‰¹åˆ«æ˜¯TransRå¯ä»¥è¾¾åˆ°20%çš„æå‡ã€‚å¯¹äºçŸ¥è¯†å›¾è°±å¤æ‚å…³ç³»çš„å¤„ç†ï¼Œè¿˜æœ‰å¾ˆå¤šå·¥ä½œéœ€è¦åšã€‚è¿™é‡Œåªæ˜¯ç®€ä»‹äº†ä¸€äº›åˆæ­¥å°è¯•ã€‚\nå¯¹äºTransHå’ŒTransRçš„æ•ˆæœæˆ‘ä»¬ç»™å‡ºä¸€äº›ä¾‹å­ã€‚æ¯”å¦‚å¯¹äºã€Šæ³°å¦å°¼å…‹å·ã€‹ç”µå½±ï¼Œæƒ³çœ‹å®ƒçš„ç”µå½±é£æ ¼æ˜¯ä»€ä¹ˆï¼ŒTransEå¾—åˆ°çš„æ•ˆæœæ¯”TransHå’ŒTransRéƒ½è¦å·®ä¸€äº›ã€‚å†å¦‚å‰‘æ¡¥å¤§å­¦çš„æ°å‡ºæ ¡å‹æœ‰å“ªäº›ï¼Ÿæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹è¿™ç§å…¸å‹çš„1å¯¹Nå…³ç³»ï¼ŒTransRå’ŒTransHå‡åšå¾—æ›´å¥½ä¸€äº›ã€‚\nTrans ç³»åˆ—Github: https://github.com/thunlp/OpenKE\nè€ƒè™‘çŸ¥è¯†å›¾è°±å¤æ‚å…³ç³»ï¼š æŒ‰ç…§çŸ¥è¯†å›¾è°±ä¸­å…³ç³»ä¸¤ç«¯è¿æ¥å®ä½“çš„å¯¹åº”æ•°ç›®ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…³ç³»åˆ’åˆ†ä¸ºä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šå››ç§ç±»å‹ã€‚ç±»å‹å…³ç³»æŒ‡çš„æ˜¯ï¼Œè¯¥ç±»å‹å…³ç³»ä¸­çš„ä¸€ä¸ªå·¦ä¾§å®ä½“ä¼šå¹³å‡å¯¹åº”å¤šä¸ªå³ä¾§å®ä½“ã€‚ ç°æœ‰çŸ¥è¯†è¡¨ç¤ºå­¦ä¹ ç®—æ³•åœ¨å¤„ç†å››ç§ç±»å‹å…³ç³»æ—¶çš„æ€§èƒ½å·®å¼‚è¾ƒå¤§ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æå‡ºäº†åŸºäºç©ºé—´è½¬ç§»çš„ TransR æ¨¡å‹å¯¹ä¸åŒçš„çŸ¥è¯†/å…³ç³»çš„ç»“æ„ç±»å‹è¿›è¡Œç²¾ç»†å»ºæ¨¡ã€‚\nè€ƒè™‘çŸ¥è¯†å›¾è°±å¤æ‚è·¯å¾„ï¼š åœ¨çŸ¥è¯†å›¾è°±ä¸­ï¼Œæœ‰äº›å¤šæ­¥å…³ç³»è·¯å¾„ä¹Ÿèƒ½å¤Ÿåæ˜ å®ä½“ä¹‹é—´çš„å…³ç³»ã€‚ä¸ºäº†çªç ´ç°æœ‰çŸ¥è¯†è¡¨ç¤ºå­¦ä¹ æ¨¡å‹å­¤ç«‹å­¦ä¹ æ¯ä¸ªä¸‰å…ƒç»„çš„å±€é™æ€§ï¼Œæˆ‘ä»¬å°†å€Ÿé‰´å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRecursive Neural Networksï¼‰çš„å­¦æœ¯æ€æƒ³ï¼Œæå‡ºè€ƒè™‘å…³ç³»è·¯å¾„çš„è¡¨ç¤ºå­¦ä¹ æ–¹æ³•ã€‚æˆ‘ä»¬ä»¥å¹³ç§»æ¨¡å‹ TransE ä½œä¸ºåŸºç¡€è¿›è¡Œæ‰©å±•ï¼Œæå‡º Path-based TransEï¼ˆPTransEï¼‰æ¨¡å‹å¯¹çŸ¥è¯†å›¾è°±ä¸­çš„å¤æ‚å…³ç³»è·¯å¾„è¿›è¡Œå»ºæ¨¡ã€‚\nè€ƒè™‘çŸ¥è¯†å›¾è°±å¤æ‚å±æ€§ï¼š ç°æœ‰çŸ¥è¯†è¡¨ç¤ºå­¦ä¹ æ¨¡å‹å°†æ‰€æœ‰å…³ç³»éƒ½è¡¨ç¤ºä¸ºå‘é‡ï¼Œè¿™åœ¨æå¤§ç¨‹åº¦ä¸Šé™åˆ¶äº†å¯¹å…³ç³»çš„è¯­ä¹‰çš„è¡¨ç¤ºèƒ½åŠ›ã€‚è¿™ç§å±€é™æ€§åœ¨å±æ€§çŸ¥è¯†çš„è¡¨ç¤ºä¸Šå°¤ä¸ºçªå‡ºã€‚æˆ‘ä»¬é¢å‘å±æ€§çŸ¥è¯†ï¼Œç ”ç©¶åˆ©ç”¨åˆ†ç±»æ¨¡å‹è¡¨ç¤ºå±æ€§å…³ç³»ï¼Œé€š è¿‡å­¦ä¹ åˆ†ç±»å™¨å»ºç«‹å®ä½“ä¸å±æ€§ä¹‹é—´çš„å…³ç³»ï¼Œåœ¨æ—¢æœ‰çŸ¥è¯†å›¾è°±å…³ç³»è¡¨ç¤ºæ–¹æ¡ˆçš„åŸºç¡€ä¸Šï¼Œæ¢ç´¢å…·æœ‰æ›´å¼ºè¡¨ç¤ºèƒ½åŠ›çš„è¡¨ç¤ºæ–¹æ¡ˆã€‚\näºŒã€DeepWalk DeepWalkçš„æ€æƒ³ç±»ä¼¼word2vecï¼Œä½¿ç”¨å›¾ä¸­èŠ‚ç‚¹ä¸èŠ‚ç‚¹çš„å…±ç°å…³ç³»æ¥å­¦ä¹ èŠ‚ç‚¹çš„å‘é‡è¡¨ç¤ºã€‚é‚£ä¹ˆå…³é”®çš„é—®é¢˜å°±æ˜¯å¦‚ä½•æ¥æè¿°èŠ‚ç‚¹ä¸èŠ‚ç‚¹çš„å…±ç°å…³ç³»ï¼ŒDeepWalkç»™å‡ºçš„æ–¹æ³•æ˜¯ä½¿ç”¨éšæœºæ¸¸èµ°(RandomWalk)çš„æ–¹å¼åœ¨å›¾ä¸­è¿›è¡ŒèŠ‚ç‚¹é‡‡æ ·ã€‚\nRandomWalkæ˜¯ä¸€ç§å¯é‡å¤è®¿é—®å·²è®¿é—®èŠ‚ç‚¹çš„æ·±åº¦ä¼˜å…ˆéå†ç®—æ³•ã€‚ç»™å®šå½“å‰è®¿é—®èµ·å§‹èŠ‚ç‚¹ï¼Œä»å…¶é‚»å±…ä¸­éšæœºé‡‡æ ·èŠ‚ç‚¹ä½œä¸ºä¸‹ä¸€ä¸ªè®¿é—®èŠ‚ç‚¹ï¼Œé‡å¤æ­¤è¿‡ç¨‹ï¼Œç›´åˆ°è®¿é—®åºåˆ—é•¿åº¦æ»¡è¶³é¢„è®¾æ¡ä»¶ã€‚\nè·å–è¶³å¤Ÿæ•°é‡çš„èŠ‚ç‚¹è®¿é—®åºåˆ—åï¼Œä½¿ç”¨skip-gram model è¿›è¡Œå‘é‡å­¦ä¹ ã€‚","title":"KGè¡¨ç¤ºå­¦ä¹ "},{"content":"èšç±»ä¸åˆ†ç±»çš„åŒºåˆ« åˆ†ç±»ï¼šç±»åˆ«æ˜¯å·²çŸ¥çš„ï¼Œé€šè¿‡å¯¹å·²çŸ¥åˆ†ç±»çš„æ•°æ®è¿›è¡Œè®­ç»ƒå’Œå­¦ä¹ ï¼Œæ‰¾åˆ°è¿™äº›ä¸åŒç±»çš„ç‰¹å¾ï¼Œå†å¯¹æœªåˆ†ç±»çš„æ•°æ®è¿›è¡Œåˆ†ç±»ã€‚å±äºç›‘ç£å­¦ä¹ ã€‚\nèšç±»ï¼šäº‹å…ˆä¸çŸ¥é“æ•°æ®ä¼šåˆ†ä¸ºå‡ ç±»ï¼Œé€šè¿‡èšç±»åˆ†æå°†æ•°æ®èšåˆæˆå‡ ä¸ªç¾¤ä½“ã€‚èšç±»ä¸éœ€è¦å¯¹æ•°æ®è¿›è¡Œè®­ç»ƒå’Œå­¦ä¹ ã€‚å±äºæ— ç›‘ç£å­¦ä¹ ã€‚\nå…³äºç›‘ç£å­¦ä¹ å’Œæ— ç›‘ç£å­¦ä¹ ï¼Œè¿™é‡Œç»™ä¸€ä¸ªç®€å•çš„ä»‹ç»ï¼šæ˜¯å¦æœ‰ç›‘ç£ï¼Œå°±çœ‹è¾“å…¥æ•°æ®æ˜¯å¦æœ‰æ ‡ç­¾ï¼Œè¾“å…¥æ•°æ®æœ‰æ ‡ç­¾ï¼Œåˆ™ä¸ºæœ‰ç›‘ç£å­¦ä¹ ï¼Œå¦åˆ™ä¸ºæ— ç›‘ç£å­¦ä¹ ã€‚\nk-means èšç±» èšç±»ç®—æ³•æœ‰å¾ˆå¤šç§ï¼ŒK-Means æ˜¯èšç±»ç®—æ³•ä¸­çš„æœ€å¸¸ç”¨çš„ä¸€ç§ï¼Œç®—æ³•æœ€å¤§çš„ç‰¹ç‚¹æ˜¯ç®€å•ï¼Œå¥½ç†è§£ï¼Œè¿ç®—é€Ÿåº¦å¿«ï¼Œä½†æ˜¯åªèƒ½åº”ç”¨äºè¿ç»­å‹çš„æ•°æ®ï¼Œå¹¶ä¸”ä¸€å®šè¦åœ¨èšç±»å‰éœ€è¦æ‰‹å·¥æŒ‡å®šè¦åˆ†æˆå‡ ç±»ã€‚\nK-Means èšç±»ç®—æ³•çš„å¤§è‡´æ„æ€å°±æ˜¯â€œç‰©ä»¥ç±»èšï¼Œäººä»¥ç¾¤åˆ†â€ï¼š\né¦–å…ˆè¾“å…¥ k çš„å€¼ï¼Œå³æˆ‘ä»¬æŒ‡å®šå¸Œæœ›é€šè¿‡èšç±»å¾—åˆ° k ä¸ªåˆ†ç»„ï¼› ä»æ•°æ®é›†ä¸­éšæœºé€‰å– k ä¸ªæ•°æ®ç‚¹ä½œä¸ºåˆå§‹å¤§ä½¬ï¼ˆè´¨å¿ƒï¼‰ï¼› å¯¹é›†åˆä¸­æ¯ä¸€ä¸ªå°å¼Ÿï¼Œè®¡ç®—ä¸æ¯ä¸€ä¸ªå¤§ä½¬çš„è·ç¦»ï¼Œç¦»å“ªä¸ªå¤§ä½¬è·ç¦»è¿‘ï¼Œå°±è·Ÿå®šå“ªä¸ªå¤§ä½¬ã€‚ è¿™æ—¶æ¯ä¸€ä¸ªå¤§ä½¬æ‰‹ä¸‹éƒ½èšé›†äº†ä¸€ç¥¨å°å¼Ÿï¼Œè¿™æ—¶å€™å¬å¼€é€‰ä¸¾å¤§ä¼šï¼Œæ¯ä¸€ç¾¤é€‰å‡ºæ–°çš„å¤§ä½¬ï¼ˆå³é€šè¿‡ç®—æ³•é€‰å‡ºæ–°çš„è´¨å¿ƒï¼‰ã€‚ å¦‚æœæ–°å¤§ä½¬å’Œè€å¤§ä½¬ä¹‹é—´çš„è·ç¦»å°äºæŸä¸€ä¸ªè®¾ç½®çš„é˜ˆå€¼ï¼ˆè¡¨ç¤ºé‡æ–°è®¡ç®—çš„è´¨å¿ƒçš„ä½ç½®å˜åŒ–ä¸å¤§ï¼Œè¶‹äºç¨³å®šï¼Œæˆ–è€…è¯´æ”¶æ•›ï¼‰ï¼Œå¯ä»¥è®¤ä¸ºæˆ‘ä»¬è¿›è¡Œçš„èšç±»å·²ç»è¾¾åˆ°æœŸæœ›çš„ç»“æœï¼Œç®—æ³•ç»ˆæ­¢ã€‚ å¦‚æœæ–°å¤§ä½¬å’Œè€å¤§ä½¬è·ç¦»å˜åŒ–å¾ˆå¤§ï¼Œéœ€è¦è¿­ä»£3~5æ­¥éª¤ã€‚ ç”¨Python ä»£ç å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # dataSetæ ·æœ¬ç‚¹,k ç°‡çš„ä¸ªæ•° # disMeasè·ç¦»é‡åº¦ï¼Œé»˜è®¤ä¸ºæ¬§å‡ é‡Œå¾—è·ç¦» # createCent,åˆå§‹ç‚¹çš„é€‰å– def kMeans(dataSet, k, distMeas=distEclud, createCent=randCent): m = shape(dataSet)[0] #æ ·æœ¬æ•° clusterAssment = mat(zeros((m,2))) #m*2çš„çŸ©é˜µ centroids = createCent(dataSet, k) #åˆå§‹åŒ–kä¸ªä¸­å¿ƒ clusterChanged = True while clusterChanged: #å½“èšç±»ä¸å†å˜åŒ– clusterChanged = False for i in range(m): minDist = inf; minIndex = -1 for j in range(k): #æ‰¾åˆ°æœ€è¿‘çš„è´¨å¿ƒ distJI = distMeas(centroids[j,:],dataSet[i,:]) if distJI \u0026lt; minDist: minDist = distJI; minIndex = j if clusterAssment[i,0] != minIndex: clusterChanged = True # ç¬¬1åˆ—ä¸ºæ‰€å±è´¨å¿ƒï¼Œç¬¬2åˆ—ä¸ºè·ç¦» clusterAssment[i,:] = minIndex,minDist**2 print centroids # æ›´æ”¹è´¨å¿ƒä½ç½® for cent in range(k): ptsInClust = dataSet[nonzero(clusterAssment[:,0].A==cent)[0]] centroids[cent,:] = mean(ptsInClust, axis=0) return centroids, clusterAssment é‡ç‚¹ç†è§£ä¸€ä¸‹ï¼š\n1 2 3 for cent in range(k): ptsInClust = dataSet[nonzero(clusterAssment[:,0].A==cent)[0]] centroids[cent,:] = mean(ptsInClust, axis=0) å¾ªç¯æ¯ä¸€ä¸ªè´¨å¿ƒï¼Œæ‰¾åˆ°å±äºå½“å‰è´¨å¿ƒçš„æ‰€æœ‰ç‚¹ï¼Œç„¶åæ ¹æ®è¿™äº›ç‚¹å»æ›´æ–°å½“å‰çš„è´¨å¿ƒã€‚ nonzero()è¿”å›çš„æ˜¯ä¸€ä¸ªäºŒç»´çš„æ•°ç»„ï¼Œå…¶è¡¨ç¤ºé0çš„å…ƒç´ ä½ç½®ã€‚\n1 2 3 4 5 6 7 8 \u0026gt;\u0026gt;\u0026gt; from numpy import * \u0026gt;\u0026gt;\u0026gt; a=array([[1,0,0],[0,1,2],[2,0,0]]) \u0026gt;\u0026gt;\u0026gt; a array([[1, 0, 0], [0, 1, 2], [2, 0, 0]]) \u0026gt;\u0026gt;\u0026gt; nonzero(a) (array([0, 1, 1, 2]), array([0, 1, 2, 0])) K-Meansç®—æ³•çš„ç¼ºé™· kå‡å€¼ç®—æ³•éå¸¸ç®€å•ä¸”ä½¿ç”¨å¹¿æ³›ï¼Œä½†æ˜¯å…¶æœ‰ä¸»è¦çš„ä¸¤ä¸ªç¼ºé™·ï¼š\nKå€¼éœ€è¦é¢„å…ˆç»™å®šï¼Œå±äºé¢„å…ˆçŸ¥è¯†ï¼Œå¾ˆå¤šæƒ…å†µä¸‹Kå€¼çš„ä¼°è®¡æ˜¯éå¸¸å›°éš¾çš„ï¼Œå¯¹äºåƒè®¡ç®—å…¨éƒ¨å¾®ä¿¡ç”¨æˆ·çš„äº¤å¾€åœˆè¿™æ ·çš„åœºæ™¯å°±å®Œå…¨çš„æ²¡åŠæ³•ç”¨K-Meansè¿›è¡Œã€‚å¯¹äºå¯ä»¥ç¡®å®šKå€¼ä¸ä¼šå¤ªå¤§ä½†ä¸æ˜ç¡®ç²¾ç¡®çš„Kå€¼çš„åœºæ™¯ï¼Œå¯ä»¥è¿›è¡Œè¿­ä»£è¿ç®—ï¼Œç„¶åæ‰¾å‡ºCost Functionæœ€å°æ—¶æ‰€å¯¹åº”çš„Kå€¼ï¼Œè¿™ä¸ªå€¼å¾€å¾€èƒ½è¾ƒå¥½çš„æè¿°æœ‰å¤šå°‘ä¸ªç°‡ç±»ã€‚ K-Meansç®—æ³•å¯¹åˆå§‹é€‰å–çš„èšç±»ä¸­å¿ƒç‚¹æ˜¯æ•æ„Ÿçš„ï¼Œä¸åŒçš„éšæœºç§å­ç‚¹å¾—åˆ°çš„èšç±»ç»“æœå®Œå…¨ä¸åŒ Kå‡å€¼ç®—æ³•å¹¶ä¸æ˜¯å¾ˆæ‰€æœ‰çš„æ•°æ®ç±»å‹ã€‚å®ƒä¸èƒ½å¤„ç†éçƒå½¢ç°‡ã€ä¸åŒå°ºå¯¸å’Œä¸åŒå¯†åº¦çš„ç°‡ï¼Œé“¶å† æŒ‡å®šè¶³å¤Ÿå¤§çš„ç°‡çš„ä¸ªæ•°æ˜¯ä»–é€šå¸¸å¯ä»¥å‘ç°çº¯å­ç°‡ã€‚ å¯¹ç¦»ç¾¤ç‚¹çš„æ•°æ®è¿›è¡Œèšç±»æ—¶ï¼ŒKå‡å€¼ä¹Ÿæœ‰é—®é¢˜ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œç¦»ç¾¤ç‚¹æ£€æµ‹å’Œåˆ é™¤æœ‰å¾ˆå¤§çš„å¸®åŠ© KMeans çš„æ—¶é—´å¤æ‚åº¦: O(knt)\n","permalink":"https://reid00.github.io/en/posts/ml/kmeans%E8%81%9A%E7%B1%BB%E5%88%86%E6%9E%90/","summary":"èšç±»ä¸åˆ†ç±»çš„åŒºåˆ« åˆ†ç±»ï¼šç±»åˆ«æ˜¯å·²çŸ¥çš„ï¼Œé€šè¿‡å¯¹å·²çŸ¥åˆ†ç±»çš„æ•°æ®è¿›è¡Œè®­ç»ƒå’Œå­¦ä¹ ï¼Œæ‰¾åˆ°è¿™äº›ä¸åŒç±»çš„ç‰¹å¾ï¼Œå†å¯¹æœªåˆ†ç±»çš„æ•°æ®è¿›è¡Œåˆ†ç±»ã€‚å±äºç›‘ç£å­¦ä¹ ã€‚\nèšç±»ï¼šäº‹å…ˆä¸çŸ¥é“æ•°æ®ä¼šåˆ†ä¸ºå‡ ç±»ï¼Œé€šè¿‡èšç±»åˆ†æå°†æ•°æ®èšåˆæˆå‡ ä¸ªç¾¤ä½“ã€‚èšç±»ä¸éœ€è¦å¯¹æ•°æ®è¿›è¡Œè®­ç»ƒå’Œå­¦ä¹ ã€‚å±äºæ— ç›‘ç£å­¦ä¹ ã€‚\nå…³äºç›‘ç£å­¦ä¹ å’Œæ— ç›‘ç£å­¦ä¹ ï¼Œè¿™é‡Œç»™ä¸€ä¸ªç®€å•çš„ä»‹ç»ï¼šæ˜¯å¦æœ‰ç›‘ç£ï¼Œå°±çœ‹è¾“å…¥æ•°æ®æ˜¯å¦æœ‰æ ‡ç­¾ï¼Œè¾“å…¥æ•°æ®æœ‰æ ‡ç­¾ï¼Œåˆ™ä¸ºæœ‰ç›‘ç£å­¦ä¹ ï¼Œå¦åˆ™ä¸ºæ— ç›‘ç£å­¦ä¹ ã€‚\nk-means èšç±» èšç±»ç®—æ³•æœ‰å¾ˆå¤šç§ï¼ŒK-Means æ˜¯èšç±»ç®—æ³•ä¸­çš„æœ€å¸¸ç”¨çš„ä¸€ç§ï¼Œç®—æ³•æœ€å¤§çš„ç‰¹ç‚¹æ˜¯ç®€å•ï¼Œå¥½ç†è§£ï¼Œè¿ç®—é€Ÿåº¦å¿«ï¼Œä½†æ˜¯åªèƒ½åº”ç”¨äºè¿ç»­å‹çš„æ•°æ®ï¼Œå¹¶ä¸”ä¸€å®šè¦åœ¨èšç±»å‰éœ€è¦æ‰‹å·¥æŒ‡å®šè¦åˆ†æˆå‡ ç±»ã€‚\nK-Means èšç±»ç®—æ³•çš„å¤§è‡´æ„æ€å°±æ˜¯â€œç‰©ä»¥ç±»èšï¼Œäººä»¥ç¾¤åˆ†â€ï¼š\né¦–å…ˆè¾“å…¥ k çš„å€¼ï¼Œå³æˆ‘ä»¬æŒ‡å®šå¸Œæœ›é€šè¿‡èšç±»å¾—åˆ° k ä¸ªåˆ†ç»„ï¼› ä»æ•°æ®é›†ä¸­éšæœºé€‰å– k ä¸ªæ•°æ®ç‚¹ä½œä¸ºåˆå§‹å¤§ä½¬ï¼ˆè´¨å¿ƒï¼‰ï¼› å¯¹é›†åˆä¸­æ¯ä¸€ä¸ªå°å¼Ÿï¼Œè®¡ç®—ä¸æ¯ä¸€ä¸ªå¤§ä½¬çš„è·ç¦»ï¼Œç¦»å“ªä¸ªå¤§ä½¬è·ç¦»è¿‘ï¼Œå°±è·Ÿå®šå“ªä¸ªå¤§ä½¬ã€‚ è¿™æ—¶æ¯ä¸€ä¸ªå¤§ä½¬æ‰‹ä¸‹éƒ½èšé›†äº†ä¸€ç¥¨å°å¼Ÿï¼Œè¿™æ—¶å€™å¬å¼€é€‰ä¸¾å¤§ä¼šï¼Œæ¯ä¸€ç¾¤é€‰å‡ºæ–°çš„å¤§ä½¬ï¼ˆå³é€šè¿‡ç®—æ³•é€‰å‡ºæ–°çš„è´¨å¿ƒï¼‰ã€‚ å¦‚æœæ–°å¤§ä½¬å’Œè€å¤§ä½¬ä¹‹é—´çš„è·ç¦»å°äºæŸä¸€ä¸ªè®¾ç½®çš„é˜ˆå€¼ï¼ˆè¡¨ç¤ºé‡æ–°è®¡ç®—çš„è´¨å¿ƒçš„ä½ç½®å˜åŒ–ä¸å¤§ï¼Œè¶‹äºç¨³å®šï¼Œæˆ–è€…è¯´æ”¶æ•›ï¼‰ï¼Œå¯ä»¥è®¤ä¸ºæˆ‘ä»¬è¿›è¡Œçš„èšç±»å·²ç»è¾¾åˆ°æœŸæœ›çš„ç»“æœï¼Œç®—æ³•ç»ˆæ­¢ã€‚ å¦‚æœæ–°å¤§ä½¬å’Œè€å¤§ä½¬è·ç¦»å˜åŒ–å¾ˆå¤§ï¼Œéœ€è¦è¿­ä»£3~5æ­¥éª¤ã€‚ ç”¨Python ä»£ç å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # dataSetæ ·æœ¬ç‚¹,k ç°‡çš„ä¸ªæ•° # disMeasè·ç¦»é‡åº¦ï¼Œé»˜è®¤ä¸ºæ¬§å‡ é‡Œå¾—è·ç¦» # createCent,åˆå§‹ç‚¹çš„é€‰å– def kMeans(dataSet, k, distMeas=distEclud, createCent=randCent): m = shape(dataSet)[0] #æ ·æœ¬æ•° clusterAssment = mat(zeros((m,2))) #m*2çš„çŸ©é˜µ centroids = createCent(dataSet, k) #åˆå§‹åŒ–kä¸ªä¸­å¿ƒ clusterChanged = True while clusterChanged: #å½“èšç±»ä¸å†å˜åŒ– clusterChanged = False for i in range(m): minDist = inf; minIndex = -1 for j in range(k): #æ‰¾åˆ°æœ€è¿‘çš„è´¨å¿ƒ distJI = distMeas(centroids[j,:],dataSet[i,:]) if distJI \u0026lt; minDist: minDist = distJI; minIndex = j if clusterAssment[i,0] !","title":"KMeansèšç±»åˆ†æ"},{"content":"01 å…¨è¿æ¥ç½‘ç»œ å…¨è¿æ¥ã€å¯†é›†å’Œçº¿æ€§ç½‘ç»œæ˜¯æœ€åŸºæœ¬ä½†åŠŸèƒ½å¼ºå¤§çš„æ¶æ„è¿™æ˜¯æœºå™¨å­¦ä¹ çš„ç›´æ¥æ‰©å±•ï¼Œå°†ç¥ç»ç½‘ç»œä¸å•ä¸ªéšè—å±‚ç»“åˆä½¿ç”¨ã€‚å…¨è¿æ¥å±‚å……å½“æ‰€æœ‰æ¶æ„çš„æœ€åä¸€éƒ¨åˆ†ï¼Œç”¨äºè·å¾—ä½¿ç”¨ä¸‹æ–¹æ·±åº¦ç½‘ç»œæ‰€å¾—åˆ†æ•°çš„æ¦‚ç‡åˆ†å¸ƒã€‚\n**å¦‚å…¶åç§°æ‰€ç¤ºï¼Œå…¨è¿æ¥ç½‘ç»œå°†å…¶ä¸Šä¸€å±‚å’Œä¸‹ä¸€å±‚ä¸­çš„æ‰€æœ‰ç¥ç»å…ƒç›¸äº’è¿æ¥ã€‚**ç½‘ç»œå¯èƒ½æœ€ç»ˆé€šè¿‡è®¾ç½®æƒé‡æ¥å…³é—­ä¸€äº›ç¥ç»å…ƒï¼Œä½†åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œæœ€åˆæ‰€æœ‰ç¥ç»å…ƒéƒ½å‚ä¸è®­ç»ƒã€‚\n02 ç¼–ç å™¨å’Œè§£ç å™¨ ç¼–ç å™¨å’Œè§£ç å™¨å¯èƒ½æ˜¯æ·±åº¦å­¦ä¹ å¦ä¸€ä¸ªæœ€åŸºæœ¬çš„æ¶æ„ä¹‹ä¸€ã€‚æ‰€æœ‰ç½‘ç»œéƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç¼–ç å™¨â€“è§£ç å™¨å±‚ã€‚ä½ å¯ä»¥å°†å…¨è¿æ¥å±‚ä¸­çš„éšè—å±‚è§†ä¸ºæ¥è‡ªç¼–ç å™¨çš„ç¼–ç å½¢å¼ï¼Œå°†è¾“å‡ºå±‚è§†ä¸ºè§£ç å™¨ï¼Œå®ƒå°†éšè—å±‚è§£ç å¹¶ä½œä¸ºè¾“å‡ºã€‚é€šå¸¸ï¼Œç¼–ç å™¨å°†è¾“å…¥ç¼–ç åˆ°ä¸­é—´çŠ¶æ€ï¼Œå…¶ä¸­è¾“å…¥ä¸ºå‘é‡ï¼Œç„¶åè§£ç å™¨ç½‘ç»œå°†è¯¥ä¸­é—´çŠ¶æ€è§£ç ä¸ºæˆ‘ä»¬æƒ³è¦çš„è¾“å‡ºå½¢å¼ã€‚\nç¼–ç å™¨â€“è§£ç å™¨ç½‘ç»œçš„ä¸€ä¸ªè§„èŒƒç¤ºä¾‹æ˜¯åºåˆ—åˆ°åºåˆ— ï¼ˆseq2seqï¼‰ç½‘ç»œï¼ˆå›¾1.11ï¼‰ï¼Œå¯ç”¨äºæœºå™¨ç¿»è¯‘ã€‚ä¸€ä¸ªå¥å­å°†è¢«ç¼–ç ä¸ºä¸­é—´å‘é‡è¡¨ç¤ºå½¢å¼ï¼Œå…¶ä¸­æ•´ä¸ªå¥å­ä»¥ä¸€äº›æµ®ç‚¹æ•°å­—çš„å½¢å¼è¡¨ç¤ºï¼Œè§£ç å™¨æ ¹æ®ä¸­é—´å‘é‡è§£ç ä»¥ç”Ÿæˆç›®æ ‡è¯­è¨€çš„å¥å­ä½œä¸ºè¾“å‡ºã€‚\nâ–²å›¾1.11 seq2seq ç½‘ç»œ\nè‡ªåŠ¨ç¼–ç å™¨ï¼ˆå›¾1.12ï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç¼–ç å™¨â€“è§£ç å™¨ç½‘ç»œï¼Œå±äºæ— ç›‘ç£å­¦ä¹ èŒƒç•´ã€‚è‡ªåŠ¨ç¼–ç å™¨å°è¯•ä»æœªæ ‡è®°çš„æ•°æ®ä¸­è¿›è¡Œå­¦ä¹ ï¼Œå°†ç›®æ ‡å€¼è®¾ç½®ä¸ºè¾“å…¥å€¼ã€‚\nä¾‹å¦‚ï¼Œå¦‚æœè¾“å…¥ä¸€ä¸ªå¤§å°ä¸º100Ã—100çš„å›¾åƒï¼Œåˆ™è¾“å…¥å‘é‡çš„ç»´åº¦ä¸º10 000ã€‚å› æ­¤ï¼Œè¾“å‡ºçš„å¤§å°ä¹Ÿå°†ä¸º 10 000ï¼Œä½†éšè—å±‚çš„å¤§å°å¯èƒ½ä¸º 500ã€‚ç®€è€Œè¨€ä¹‹ï¼Œä½ æ­£åœ¨å°è¯•å°†è¾“å…¥è½¬æ¢ä¸ºè¾ƒå°çš„éšè—çŠ¶æ€è¡¨ç¤ºå½¢å¼ï¼Œä»éšè—çŠ¶æ€é‡æ–°ç”Ÿæˆç›¸åŒçš„è¾“å…¥ã€‚\nå›¾1.12 è‡ªåŠ¨ç¼–ç å™¨çš„ç»“æ„\nä½ å¦‚æœèƒ½å¤Ÿè®­ç»ƒä¸€ä¸ªå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹çš„ç¥ç»ç½‘ç»œï¼Œå°±ä¼šæ‰¾åˆ°ä¸€ä¸ªå¥½çš„å‹ç¼©ç®—æ³•ï¼Œå…¶å¯ä»¥å°†é«˜ç»´è¾“å…¥å˜ä¸ºä½ç»´å‘é‡ï¼Œè¿™å…·æœ‰æ•°é‡çº§æ”¶ç›Šã€‚\nå¦‚ä»Šï¼Œè‡ªåŠ¨ç¼–ç å™¨æ­£è¢«å¹¿æ³›åº”ç”¨äºä¸åŒçš„æƒ…æ™¯å’Œè¡Œä¸šã€‚\n03 å¾ªç¯ç¥ç»ç½‘ç»œ å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰æ˜¯**æœ€å¸¸è§çš„æ·±åº¦å­¦ä¹ ç®—æ³•ä¹‹ä¸€ï¼Œå®ƒå¸­å·äº†æ•´ä¸ªä¸–ç•Œã€‚**æˆ‘ä»¬ç°åœ¨åœ¨è‡ªç„¶è¯­è¨€å¤„ç†æˆ–ç†è§£æ–¹é¢å‡ ä¹æ‰€æœ‰æœ€å…ˆè¿›çš„æ€§èƒ½éƒ½å½’åŠŸäºRNNçš„å˜ä½“ã€‚åœ¨å¾ªç¯ç½‘ç»œä¸­ï¼Œä½ å°è¯•è¯†åˆ«æ•°æ®ä¸­çš„æœ€å°å•å…ƒï¼Œå¹¶ä½¿æ•°æ®æˆä¸ºä¸€ç»„è¿™æ ·çš„å•å…ƒã€‚\nåœ¨è‡ªç„¶è¯­è¨€çš„ç¤ºä¾‹ä¸­ï¼Œæœ€å¸¸è§çš„æ–¹æ³•æ˜¯å°†ä¸€ä¸ªå•è¯ä½œä¸ºä¸€ä¸ªå•å…ƒï¼Œå¹¶åœ¨å¤„ç†å¥å­æ—¶å°†å¥å­è§†ä¸ºä¸€ç»„å•è¯ã€‚ä½ åœ¨æ•´ä¸ªå¥å­ä¸Šå±•å¼€RNNï¼Œä¸€æ¬¡å¤„ç†ä¸€ä¸ªå•è¯ï¼ˆå›¾1.13ï¼‰ã€‚RNN å…·æœ‰é€‚ç”¨äºä¸åŒæ•°æ®é›†çš„å˜ä½“ï¼Œæœ‰æ—¶æˆ‘ä»¬ä¼šæ ¹æ®æ•ˆç‡é€‰æ‹©å˜ä½“ã€‚é•¿çŸ­æœŸè®°å¿† ï¼ˆLSTMï¼‰å’Œé—¨æ§å¾ªç¯å•å…ƒï¼ˆGRUï¼‰æ˜¯æœ€å¸¸è§çš„ RNN å•å…ƒã€‚\nå›¾1.13 å¾ªç¯ç½‘ç»œä¸­å•è¯çš„å‘é‡è¡¨ç¤ºå½¢å¼\n04 é€’å½’ç¥ç»ç½‘ç»œ é¡¾åæ€ä¹‰ï¼Œé€’å½’ç¥ç»ç½‘ç»œæ˜¯ä¸€ç§æ ‘çŠ¶ç½‘ç»œï¼Œç”¨äºç†è§£åºåˆ—æ•°æ®çš„åˆ†å±‚ç»“æ„ã€‚é€’å½’ç½‘ç»œè¢«ç ”ç©¶è€…ï¼ˆå°¤å…¶æ˜¯ Salesforce çš„é¦–å¸­ç§‘å­¦å®¶ç†æŸ¥å¾·Â·ç´¢å½»å’Œä»–çš„å›¢é˜Ÿï¼‰å¹¿æ³›ç”¨äºè‡ªç„¶è¯­è¨€å¤„ç†ã€‚\nå­—å‘é‡èƒ½å¤Ÿæœ‰æ•ˆåœ°å°†ä¸€ä¸ªå•è¯çš„å«ä¹‰æ˜ å°„åˆ°ä¸€ä¸ªå‘é‡ç©ºé—´ï¼Œä½†å½“æ¶‰åŠæ•´ä¸ªå¥å­çš„å«ä¹‰æ—¶ï¼Œå´æ²¡æœ‰åƒword2vecè¿™æ ·é’ˆå¯¹å•è¯çš„é¦–é€‰è§£å†³æ–¹æ¡ˆã€‚é€’å½’ç¥ç»ç½‘ç»œæ˜¯æ­¤ç±»åº”ç”¨æœ€å¸¸ç”¨çš„ç®—æ³•ä¹‹ä¸€ã€‚ é€’å½’ç½‘ç»œå¯ä»¥åˆ›å»ºè§£ææ ‘å’Œç»„åˆå‘é‡ï¼Œå¹¶æ˜ å°„å…¶ä»–åˆ†å±‚å…³ç³»ï¼ˆå›¾1.14ï¼‰ï¼Œè¿™åè¿‡æ¥åˆå¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°ç»„åˆå•è¯å’Œå½¢æˆå¥å­çš„è§„åˆ™ã€‚æ–¯å¦ç¦è‡ªç„¶è¯­è¨€æ¨ç†å°ç»„å¼€å‘äº†ä¸€ç§è‘—åçš„ã€ä½¿ç”¨è‰¯å¥½çš„ç®—æ³•ï¼Œç§°ä¸ºSNLIï¼Œè¿™æ˜¯åº”ç”¨é€’å½’ç½‘ç»œçš„ä¸€ä¸ªå¥½ä¾‹å­ã€‚\nâ–²å›¾1.14 é€’å½’ç½‘ç»œä¸­å•è¯çš„å‘é‡è¡¨ç¤ºå½¢å¼\n05 å·ç§¯ç¥ç»ç½‘ç»œ å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ï¼ˆå›¾1.15ï¼‰ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨è®¡ç®—æœºè§†è§‰ä¸­è·å¾—è¶…äººçš„æ€§èƒ½ï¼Œå®ƒåœ¨2010å¹´ä»£æ—©æœŸè¾¾åˆ°äº†äººç±»çš„ç²¾åº¦ï¼Œè€Œä¸”å…¶ç²¾åº¦ä»åœ¨é€å¹´æé«˜ã€‚\nå·ç§¯ç½‘ç»œæ˜¯æœ€å®¹æ˜“ç†è§£çš„ç½‘ç»œï¼Œå› ä¸ºå®ƒæœ‰å¯è§†åŒ–å·¥å…·æ¥æ˜¾ç¤ºæ¯ä¸€å±‚æ­£åœ¨åšä»€ä¹ˆã€‚\nFacebook AIç ”ç©¶ï¼ˆFAIRï¼‰è´Ÿè´£äººYann LeCunæ—©åœ¨20ä¸–çºª90å¹´ä»£å°±å‘æ˜äº†CNNã€‚äººä»¬å½“æ—¶æ— æ³•ä½¿ç”¨å®ƒï¼Œå› ä¸ºå¹¶æ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®é›†å’Œè®¡ç®—èƒ½åŠ›ã€‚CNNåƒæ»‘åŠ¨çª—å£ä¸€æ ·æ‰«æè¾“å…¥å¹¶ç”Ÿæˆä¸­é—´è¡¨å¾ï¼Œç„¶ååœ¨å®ƒåˆ°è¾¾æœ«ç«¯çš„å…¨è¿æ¥å±‚ä¹‹å‰å¯¹å…¶è¿›è¡Œé€å±‚æŠ½è±¡ã€‚CNNä¹Ÿå·²æˆåŠŸåº”ç”¨äºéå›¾åƒæ•°æ®é›†ã€‚\nâ–²å›¾1.15 å…¸å‹çš„ CNN\nFacebookçš„ç ”ç©¶å°ç»„å‘ç°äº†ä¸€ä¸ªåŸºäºå·ç§¯ç¥ç»ç½‘ç»œçš„å…ˆè¿›è‡ªç„¶è¯­è¨€å¤„ç†ç³»ç»Ÿï¼Œå…¶å·ç§¯ç½‘ç»œä¼˜äºRNNï¼Œè€Œåè€…è¢«è®¤ä¸ºæ˜¯ä»»ä½•åºåˆ—æ•°æ®é›†çš„é¦–é€‰æ¶æ„ã€‚è™½ç„¶ä¸€äº›ç¥ç»ç§‘å­¦å®¶å’Œäººå·¥æ™ºèƒ½ç ”ç©¶äººå‘˜ä¸å–œæ¬¢CNNï¼ˆå› ä¸ºä»–ä»¬è®¤ä¸ºå¤§è„‘ä¸ä¼šåƒCNNé‚£æ ·åšï¼‰ï¼Œä½†åŸºäºCNNçš„ç½‘ç»œæ­£åœ¨å‡»è´¥æ‰€æœ‰ç°æœ‰çš„ç½‘ç»œå®ç°ã€‚\n06 ç”Ÿæˆå¯¹æŠ—ç½‘ç»œ ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼ˆGANï¼‰ç”± Ian Goodfellow äº 2014 å¹´å‘æ˜ï¼Œè‡ªé‚£æ—¶èµ·ï¼Œå®ƒé¢ è¦†äº†æ•´ä¸ª AI ç¤¾ç¾¤ã€‚å®ƒæ˜¯æœ€ç®€å•ã€æœ€æ˜æ˜¾çš„å®ç°ä¹‹ä¸€ï¼Œä½†å…¶èƒ½åŠ›å¸å¼•äº†å…¨ä¸–ç•Œçš„æ³¨æ„ã€‚GANçš„é…ç½®å¦‚å›¾1.16æ‰€ç¤ºã€‚\nâ–²å›¾1.16 GANé…ç½® ä¸¤ä¸ªç½‘ç»œç›¸äº’ç«äº‰ï¼Œæœ€ç»ˆè¾¾åˆ°ä¸€ç§å¹³è¡¡ï¼Œå³ç”Ÿæˆç½‘ç»œå¯ä»¥ç”Ÿæˆæ•°æ®ï¼Œè€Œé‰´åˆ«ç½‘ç»œå¾ˆéš¾å°†å…¶ä¸å®é™…å›¾åƒåŒºåˆ†å¼€ã€‚\nä¸€ä¸ªçœŸå®çš„ä¾‹å­å°±æ˜¯è­¦å¯Ÿå’Œé€ å‡è€…ä¹‹é—´çš„æ–—äº‰ï¼šå‡è®¾ä¸€ä¸ªé€ å‡è€…è¯•å›¾åˆ¶é€ å‡å¸ï¼Œè€Œè­¦å¯Ÿè¯•å›¾è¯†ç ´å®ƒã€‚æœ€åˆï¼Œé€ å‡è€…æ²¡æœ‰è¶³å¤Ÿçš„çŸ¥è¯†æ¥åˆ¶é€ çœ‹èµ·æ¥çœŸå®çš„å‡å¸ã€‚éšç€æ—¶é—´çš„æµé€ï¼Œé€ å‡è€…è¶Šæ¥è¶Šå–„äºåˆ¶é€ çœ‹èµ·æ¥æ›´åƒçœŸå®è´§å¸çš„å‡å¸ã€‚è¿™æ—¶ï¼Œè­¦å¯Ÿèµ·åˆæœªèƒ½è¯†åˆ«å‡å¸ï¼Œä½†æœ€ç»ˆä»–ä»¬ä¼šå†æ¬¡æˆåŠŸè¯†åˆ«ã€‚\nè¿™ç§ç”Ÿæˆâ€“å¯¹æŠ—è¿‡ç¨‹æœ€ç»ˆä¼šå½¢æˆä¸€ç§å¹³è¡¡ã€‚GAN å…·æœ‰æå¤§çš„ä¼˜åŠ¿ã€‚\n07 å¼ºåŒ–å­¦ä¹  é€šè¿‡äº’åŠ¨è¿›è¡Œå­¦ä¹ æ˜¯äººç±»æ™ºåŠ›çš„åŸºç¡€ï¼Œå¼ºåŒ–å­¦ä¹ æ˜¯é¢†å¯¼æˆ‘ä»¬æœè¿™ä¸ªæ–¹å‘å‰è¿›çš„æ–¹æ³•ã€‚è¿‡å»å¼ºåŒ–å­¦ä¹ æ˜¯ä¸€ä¸ªå®Œå…¨ä¸åŒçš„é¢†åŸŸï¼Œå®ƒè®¤ä¸ºäººç±»é€šè¿‡è¯•é”™è¿›è¡Œå­¦ä¹ ã€‚ç„¶è€Œï¼Œéšç€æ·±åº¦å­¦ä¹ çš„æ¨è¿›ï¼Œå¦ä¸€ä¸ªé¢†åŸŸå‡ºç°äº†â€œæ·±åº¦å¼ºåŒ–å­¦ä¹ â€ï¼Œå®ƒç»“åˆäº†æ·±åº¦å­¦ä¹ ä¸å¼ºåŒ–å­¦ä¹ ã€‚\nç°ä»£å¼ºåŒ–å­¦ä¹ ä½¿ç”¨æ·±åº¦ç½‘ç»œæ¥è¿›è¡Œå­¦ä¹ ï¼Œè€Œä¸æ˜¯ç”±äººä»¬æ˜¾å¼ç¼–ç è¿™äº›è§„åˆ™ã€‚æˆ‘ä»¬å°†ç ”ç©¶Qå­¦ä¹ å’Œæ·±åº¦Qå­¦ä¹ ï¼Œå±•ç¤ºç»“åˆæ·±åº¦å­¦ä¹ çš„å¼ºåŒ–å­¦ä¹ ä¸ä¸ç»“åˆæ·±åº¦å­¦ä¹ çš„å¼ºåŒ–å­¦ä¹ ä¹‹é—´çš„åŒºåˆ«ã€‚\nå¼ºåŒ–å­¦ä¹ è¢«è®¤ä¸ºæ˜¯é€šå‘ä¸€èˆ¬æ™ºèƒ½çš„é€”å¾„ä¹‹ä¸€ï¼Œå…¶ä¸­è®¡ç®—æœºæˆ–æ™ºèƒ½ä½“é€šè¿‡ä¸ç°å®ä¸–ç•Œã€ç‰©ä½“æˆ–å®éªŒäº’åŠ¨æˆ–è€…é€šè¿‡åé¦ˆæ¥è¿›è¡Œå­¦ä¹ ã€‚**è®­ç»ƒå¼ºåŒ–å­¦ä¹ æ™ºèƒ½ä½“å’Œè®­ç»ƒç‹—å¾ˆåƒï¼Œå®ƒä»¬éƒ½æ˜¯é€šè¿‡æ­£ã€è´Ÿæ¿€åŠ±è¿›è¡Œçš„ã€‚**å½“ä½ å› ä¸ºç‹—æ¡åˆ°çƒè€Œå¥–åŠ±å®ƒä¸€å—é¥¼å¹²æˆ–è€…å› ä¸ºç‹—æ²¡æ¡åˆ°çƒè€Œå¯¹å®ƒå¤§å–Šå¤§å«æ—¶ï¼Œä½ å°±æ˜¯åœ¨é€šè¿‡ç§¯æå’Œæ¶ˆæçš„å¥–åŠ±å‘ç‹—çš„å¤§è„‘ä¸­å¼ºåŒ–çŸ¥è¯†ã€‚\n**æˆ‘ä»¬å¯¹AIæ™ºèƒ½ä½“ä¹Ÿåšäº†åŒæ ·çš„æ“ä½œï¼Œä½†æ­£å¥–åŠ±å°†æ˜¯ä¸€ä¸ªæ­£æ•°ï¼Œè´Ÿå¥–åŠ±å°†æ˜¯ä¸€ä¸ªè´Ÿæ•°ã€‚**å°½ç®¡æˆ‘ä»¬ä¸èƒ½å°†å¼ºåŒ–å­¦ä¹ è§†ä¸ºä¸ CNN/RNN ç­‰ç±»ä¼¼çš„å¦ä¸€ç§æ¶æ„ï¼Œä½†è¿™é‡Œå°†å…¶ä½œä¸ºä½¿ç”¨æ·±åº¦ç¥ç»ç½‘ç»œæ¥è§£å†³å®é™…é—®é¢˜çš„å¦ä¸€ç§æ–¹æ³•ï¼Œå…¶é…ç½®å¦‚å›¾1.17æ‰€ç¤ºã€‚\n","permalink":"https://reid00.github.io/en/posts/ml/cnn-rnn-gan/","summary":"01 å…¨è¿æ¥ç½‘ç»œ å…¨è¿æ¥ã€å¯†é›†å’Œçº¿æ€§ç½‘ç»œæ˜¯æœ€åŸºæœ¬ä½†åŠŸèƒ½å¼ºå¤§çš„æ¶æ„è¿™æ˜¯æœºå™¨å­¦ä¹ çš„ç›´æ¥æ‰©å±•ï¼Œå°†ç¥ç»ç½‘ç»œä¸å•ä¸ªéšè—å±‚ç»“åˆä½¿ç”¨ã€‚å…¨è¿æ¥å±‚å……å½“æ‰€æœ‰æ¶æ„çš„æœ€åä¸€éƒ¨åˆ†ï¼Œç”¨äºè·å¾—ä½¿ç”¨ä¸‹æ–¹æ·±åº¦ç½‘ç»œæ‰€å¾—åˆ†æ•°çš„æ¦‚ç‡åˆ†å¸ƒã€‚\n**å¦‚å…¶åç§°æ‰€ç¤ºï¼Œå…¨è¿æ¥ç½‘ç»œå°†å…¶ä¸Šä¸€å±‚å’Œä¸‹ä¸€å±‚ä¸­çš„æ‰€æœ‰ç¥ç»å…ƒç›¸äº’è¿æ¥ã€‚**ç½‘ç»œå¯èƒ½æœ€ç»ˆé€šè¿‡è®¾ç½®æƒé‡æ¥å…³é—­ä¸€äº›ç¥ç»å…ƒï¼Œä½†åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œæœ€åˆæ‰€æœ‰ç¥ç»å…ƒéƒ½å‚ä¸è®­ç»ƒã€‚\n02 ç¼–ç å™¨å’Œè§£ç å™¨ ç¼–ç å™¨å’Œè§£ç å™¨å¯èƒ½æ˜¯æ·±åº¦å­¦ä¹ å¦ä¸€ä¸ªæœ€åŸºæœ¬çš„æ¶æ„ä¹‹ä¸€ã€‚æ‰€æœ‰ç½‘ç»œéƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªç¼–ç å™¨â€“è§£ç å™¨å±‚ã€‚ä½ å¯ä»¥å°†å…¨è¿æ¥å±‚ä¸­çš„éšè—å±‚è§†ä¸ºæ¥è‡ªç¼–ç å™¨çš„ç¼–ç å½¢å¼ï¼Œå°†è¾“å‡ºå±‚è§†ä¸ºè§£ç å™¨ï¼Œå®ƒå°†éšè—å±‚è§£ç å¹¶ä½œä¸ºè¾“å‡ºã€‚é€šå¸¸ï¼Œç¼–ç å™¨å°†è¾“å…¥ç¼–ç åˆ°ä¸­é—´çŠ¶æ€ï¼Œå…¶ä¸­è¾“å…¥ä¸ºå‘é‡ï¼Œç„¶åè§£ç å™¨ç½‘ç»œå°†è¯¥ä¸­é—´çŠ¶æ€è§£ç ä¸ºæˆ‘ä»¬æƒ³è¦çš„è¾“å‡ºå½¢å¼ã€‚\nç¼–ç å™¨â€“è§£ç å™¨ç½‘ç»œçš„ä¸€ä¸ªè§„èŒƒç¤ºä¾‹æ˜¯åºåˆ—åˆ°åºåˆ— ï¼ˆseq2seqï¼‰ç½‘ç»œï¼ˆå›¾1.11ï¼‰ï¼Œå¯ç”¨äºæœºå™¨ç¿»è¯‘ã€‚ä¸€ä¸ªå¥å­å°†è¢«ç¼–ç ä¸ºä¸­é—´å‘é‡è¡¨ç¤ºå½¢å¼ï¼Œå…¶ä¸­æ•´ä¸ªå¥å­ä»¥ä¸€äº›æµ®ç‚¹æ•°å­—çš„å½¢å¼è¡¨ç¤ºï¼Œè§£ç å™¨æ ¹æ®ä¸­é—´å‘é‡è§£ç ä»¥ç”Ÿæˆç›®æ ‡è¯­è¨€çš„å¥å­ä½œä¸ºè¾“å‡ºã€‚\nâ–²å›¾1.11 seq2seq ç½‘ç»œ\nè‡ªåŠ¨ç¼–ç å™¨ï¼ˆå›¾1.12ï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç¼–ç å™¨â€“è§£ç å™¨ç½‘ç»œï¼Œå±äºæ— ç›‘ç£å­¦ä¹ èŒƒç•´ã€‚è‡ªåŠ¨ç¼–ç å™¨å°è¯•ä»æœªæ ‡è®°çš„æ•°æ®ä¸­è¿›è¡Œå­¦ä¹ ï¼Œå°†ç›®æ ‡å€¼è®¾ç½®ä¸ºè¾“å…¥å€¼ã€‚\nä¾‹å¦‚ï¼Œå¦‚æœè¾“å…¥ä¸€ä¸ªå¤§å°ä¸º100Ã—100çš„å›¾åƒï¼Œåˆ™è¾“å…¥å‘é‡çš„ç»´åº¦ä¸º10 000ã€‚å› æ­¤ï¼Œè¾“å‡ºçš„å¤§å°ä¹Ÿå°†ä¸º 10 000ï¼Œä½†éšè—å±‚çš„å¤§å°å¯èƒ½ä¸º 500ã€‚ç®€è€Œè¨€ä¹‹ï¼Œä½ æ­£åœ¨å°è¯•å°†è¾“å…¥è½¬æ¢ä¸ºè¾ƒå°çš„éšè—çŠ¶æ€è¡¨ç¤ºå½¢å¼ï¼Œä»éšè—çŠ¶æ€é‡æ–°ç”Ÿæˆç›¸åŒçš„è¾“å…¥ã€‚\nå›¾1.12 è‡ªåŠ¨ç¼–ç å™¨çš„ç»“æ„\nä½ å¦‚æœèƒ½å¤Ÿè®­ç»ƒä¸€ä¸ªå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹çš„ç¥ç»ç½‘ç»œï¼Œå°±ä¼šæ‰¾åˆ°ä¸€ä¸ªå¥½çš„å‹ç¼©ç®—æ³•ï¼Œå…¶å¯ä»¥å°†é«˜ç»´è¾“å…¥å˜ä¸ºä½ç»´å‘é‡ï¼Œè¿™å…·æœ‰æ•°é‡çº§æ”¶ç›Šã€‚\nå¦‚ä»Šï¼Œè‡ªåŠ¨ç¼–ç å™¨æ­£è¢«å¹¿æ³›åº”ç”¨äºä¸åŒçš„æƒ…æ™¯å’Œè¡Œä¸šã€‚\n03 å¾ªç¯ç¥ç»ç½‘ç»œ å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰æ˜¯**æœ€å¸¸è§çš„æ·±åº¦å­¦ä¹ ç®—æ³•ä¹‹ä¸€ï¼Œå®ƒå¸­å·äº†æ•´ä¸ªä¸–ç•Œã€‚**æˆ‘ä»¬ç°åœ¨åœ¨è‡ªç„¶è¯­è¨€å¤„ç†æˆ–ç†è§£æ–¹é¢å‡ ä¹æ‰€æœ‰æœ€å…ˆè¿›çš„æ€§èƒ½éƒ½å½’åŠŸäºRNNçš„å˜ä½“ã€‚åœ¨å¾ªç¯ç½‘ç»œä¸­ï¼Œä½ å°è¯•è¯†åˆ«æ•°æ®ä¸­çš„æœ€å°å•å…ƒï¼Œå¹¶ä½¿æ•°æ®æˆä¸ºä¸€ç»„è¿™æ ·çš„å•å…ƒã€‚\nåœ¨è‡ªç„¶è¯­è¨€çš„ç¤ºä¾‹ä¸­ï¼Œæœ€å¸¸è§çš„æ–¹æ³•æ˜¯å°†ä¸€ä¸ªå•è¯ä½œä¸ºä¸€ä¸ªå•å…ƒï¼Œå¹¶åœ¨å¤„ç†å¥å­æ—¶å°†å¥å­è§†ä¸ºä¸€ç»„å•è¯ã€‚ä½ åœ¨æ•´ä¸ªå¥å­ä¸Šå±•å¼€RNNï¼Œä¸€æ¬¡å¤„ç†ä¸€ä¸ªå•è¯ï¼ˆå›¾1.13ï¼‰ã€‚RNN å…·æœ‰é€‚ç”¨äºä¸åŒæ•°æ®é›†çš„å˜ä½“ï¼Œæœ‰æ—¶æˆ‘ä»¬ä¼šæ ¹æ®æ•ˆç‡é€‰æ‹©å˜ä½“ã€‚é•¿çŸ­æœŸè®°å¿† ï¼ˆLSTMï¼‰å’Œé—¨æ§å¾ªç¯å•å…ƒï¼ˆGRUï¼‰æ˜¯æœ€å¸¸è§çš„ RNN å•å…ƒã€‚\nå›¾1.13 å¾ªç¯ç½‘ç»œä¸­å•è¯çš„å‘é‡è¡¨ç¤ºå½¢å¼\n04 é€’å½’ç¥ç»ç½‘ç»œ é¡¾åæ€ä¹‰ï¼Œé€’å½’ç¥ç»ç½‘ç»œæ˜¯ä¸€ç§æ ‘çŠ¶ç½‘ç»œï¼Œç”¨äºç†è§£åºåˆ—æ•°æ®çš„åˆ†å±‚ç»“æ„ã€‚é€’å½’ç½‘ç»œè¢«ç ”ç©¶è€…ï¼ˆå°¤å…¶æ˜¯ Salesforce çš„é¦–å¸­ç§‘å­¦å®¶ç†æŸ¥å¾·Â·ç´¢å½»å’Œä»–çš„å›¢é˜Ÿï¼‰å¹¿æ³›ç”¨äºè‡ªç„¶è¯­è¨€å¤„ç†ã€‚\nå­—å‘é‡èƒ½å¤Ÿæœ‰æ•ˆåœ°å°†ä¸€ä¸ªå•è¯çš„å«ä¹‰æ˜ å°„åˆ°ä¸€ä¸ªå‘é‡ç©ºé—´ï¼Œä½†å½“æ¶‰åŠæ•´ä¸ªå¥å­çš„å«ä¹‰æ—¶ï¼Œå´æ²¡æœ‰åƒword2vecè¿™æ ·é’ˆå¯¹å•è¯çš„é¦–é€‰è§£å†³æ–¹æ¡ˆã€‚é€’å½’ç¥ç»ç½‘ç»œæ˜¯æ­¤ç±»åº”ç”¨æœ€å¸¸ç”¨çš„ç®—æ³•ä¹‹ä¸€ã€‚ é€’å½’ç½‘ç»œå¯ä»¥åˆ›å»ºè§£ææ ‘å’Œç»„åˆå‘é‡ï¼Œå¹¶æ˜ å°„å…¶ä»–åˆ†å±‚å…³ç³»ï¼ˆå›¾1.14ï¼‰ï¼Œè¿™åè¿‡æ¥åˆå¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°ç»„åˆå•è¯å’Œå½¢æˆå¥å­çš„è§„åˆ™ã€‚æ–¯å¦ç¦è‡ªç„¶è¯­è¨€æ¨ç†å°ç»„å¼€å‘äº†ä¸€ç§è‘—åçš„ã€ä½¿ç”¨è‰¯å¥½çš„ç®—æ³•ï¼Œç§°ä¸ºSNLIï¼Œè¿™æ˜¯åº”ç”¨é€’å½’ç½‘ç»œçš„ä¸€ä¸ªå¥½ä¾‹å­ã€‚\nâ–²å›¾1.14 é€’å½’ç½‘ç»œä¸­å•è¯çš„å‘é‡è¡¨ç¤ºå½¢å¼\n05 å·ç§¯ç¥ç»ç½‘ç»œ å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ï¼ˆå›¾1.15ï¼‰ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨è®¡ç®—æœºè§†è§‰ä¸­è·å¾—è¶…äººçš„æ€§èƒ½ï¼Œå®ƒåœ¨2010å¹´ä»£æ—©æœŸè¾¾åˆ°äº†äººç±»çš„ç²¾åº¦ï¼Œè€Œä¸”å…¶ç²¾åº¦ä»åœ¨é€å¹´æé«˜ã€‚\nå·ç§¯ç½‘ç»œæ˜¯æœ€å®¹æ˜“ç†è§£çš„ç½‘ç»œï¼Œå› ä¸ºå®ƒæœ‰å¯è§†åŒ–å·¥å…·æ¥æ˜¾ç¤ºæ¯ä¸€å±‚æ­£åœ¨åšä»€ä¹ˆã€‚\nFacebook AIç ”ç©¶ï¼ˆFAIRï¼‰è´Ÿè´£äººYann LeCunæ—©åœ¨20ä¸–çºª90å¹´ä»£å°±å‘æ˜äº†CNNã€‚äººä»¬å½“æ—¶æ— æ³•ä½¿ç”¨å®ƒï¼Œå› ä¸ºå¹¶æ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®é›†å’Œè®¡ç®—èƒ½åŠ›ã€‚CNNåƒæ»‘åŠ¨çª—å£ä¸€æ ·æ‰«æè¾“å…¥å¹¶ç”Ÿæˆä¸­é—´è¡¨å¾ï¼Œç„¶ååœ¨å®ƒåˆ°è¾¾æœ«ç«¯çš„å…¨è¿æ¥å±‚ä¹‹å‰å¯¹å…¶è¿›è¡Œé€å±‚æŠ½è±¡ã€‚CNNä¹Ÿå·²æˆåŠŸåº”ç”¨äºéå›¾åƒæ•°æ®é›†ã€‚\nâ–²å›¾1.15 å…¸å‹çš„ CNN\nFacebookçš„ç ”ç©¶å°ç»„å‘ç°äº†ä¸€ä¸ªåŸºäºå·ç§¯ç¥ç»ç½‘ç»œçš„å…ˆè¿›è‡ªç„¶è¯­è¨€å¤„ç†ç³»ç»Ÿï¼Œå…¶å·ç§¯ç½‘ç»œä¼˜äºRNNï¼Œè€Œåè€…è¢«è®¤ä¸ºæ˜¯ä»»ä½•åºåˆ—æ•°æ®é›†çš„é¦–é€‰æ¶æ„ã€‚è™½ç„¶ä¸€äº›ç¥ç»ç§‘å­¦å®¶å’Œäººå·¥æ™ºèƒ½ç ”ç©¶äººå‘˜ä¸å–œæ¬¢CNNï¼ˆå› ä¸ºä»–ä»¬è®¤ä¸ºå¤§è„‘ä¸ä¼šåƒCNNé‚£æ ·åšï¼‰ï¼Œä½†åŸºäºCNNçš„ç½‘ç»œæ­£åœ¨å‡»è´¥æ‰€æœ‰ç°æœ‰çš„ç½‘ç»œå®ç°ã€‚\n06 ç”Ÿæˆå¯¹æŠ—ç½‘ç»œ ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼ˆGANï¼‰ç”± Ian Goodfellow äº 2014 å¹´å‘æ˜ï¼Œè‡ªé‚£æ—¶èµ·ï¼Œå®ƒé¢ è¦†äº†æ•´ä¸ª AI ç¤¾ç¾¤ã€‚å®ƒæ˜¯æœ€ç®€å•ã€æœ€æ˜æ˜¾çš„å®ç°ä¹‹ä¸€ï¼Œä½†å…¶èƒ½åŠ›å¸å¼•äº†å…¨ä¸–ç•Œçš„æ³¨æ„ã€‚GANçš„é…ç½®å¦‚å›¾1.16æ‰€ç¤ºã€‚\nâ–²å›¾1.16 GANé…ç½® ä¸¤ä¸ªç½‘ç»œç›¸äº’ç«äº‰ï¼Œæœ€ç»ˆè¾¾åˆ°ä¸€ç§å¹³è¡¡ï¼Œå³ç”Ÿæˆç½‘ç»œå¯ä»¥ç”Ÿæˆæ•°æ®ï¼Œè€Œé‰´åˆ«ç½‘ç»œå¾ˆéš¾å°†å…¶ä¸å®é™…å›¾åƒåŒºåˆ†å¼€ã€‚\nä¸€ä¸ªçœŸå®çš„ä¾‹å­å°±æ˜¯è­¦å¯Ÿå’Œé€ å‡è€…ä¹‹é—´çš„æ–—äº‰ï¼šå‡è®¾ä¸€ä¸ªé€ å‡è€…è¯•å›¾åˆ¶é€ å‡å¸ï¼Œè€Œè­¦å¯Ÿè¯•å›¾è¯†ç ´å®ƒã€‚æœ€åˆï¼Œé€ å‡è€…æ²¡æœ‰è¶³å¤Ÿçš„çŸ¥è¯†æ¥åˆ¶é€ çœ‹èµ·æ¥çœŸå®çš„å‡å¸ã€‚éšç€æ—¶é—´çš„æµé€ï¼Œé€ å‡è€…è¶Šæ¥è¶Šå–„äºåˆ¶é€ çœ‹èµ·æ¥æ›´åƒçœŸå®è´§å¸çš„å‡å¸ã€‚è¿™æ—¶ï¼Œè­¦å¯Ÿèµ·åˆæœªèƒ½è¯†åˆ«å‡å¸ï¼Œä½†æœ€ç»ˆä»–ä»¬ä¼šå†æ¬¡æˆåŠŸè¯†åˆ«ã€‚\nè¿™ç§ç”Ÿæˆâ€“å¯¹æŠ—è¿‡ç¨‹æœ€ç»ˆä¼šå½¢æˆä¸€ç§å¹³è¡¡ã€‚GAN å…·æœ‰æå¤§çš„ä¼˜åŠ¿ã€‚\n07 å¼ºåŒ–å­¦ä¹  é€šè¿‡äº’åŠ¨è¿›è¡Œå­¦ä¹ æ˜¯äººç±»æ™ºåŠ›çš„åŸºç¡€ï¼Œå¼ºåŒ–å­¦ä¹ æ˜¯é¢†å¯¼æˆ‘ä»¬æœè¿™ä¸ªæ–¹å‘å‰è¿›çš„æ–¹æ³•ã€‚è¿‡å»å¼ºåŒ–å­¦ä¹ æ˜¯ä¸€ä¸ªå®Œå…¨ä¸åŒçš„é¢†åŸŸï¼Œå®ƒè®¤ä¸ºäººç±»é€šè¿‡è¯•é”™è¿›è¡Œå­¦ä¹ ã€‚ç„¶è€Œï¼Œéšç€æ·±åº¦å­¦ä¹ çš„æ¨è¿›ï¼Œå¦ä¸€ä¸ªé¢†åŸŸå‡ºç°äº†â€œæ·±åº¦å¼ºåŒ–å­¦ä¹ â€ï¼Œå®ƒç»“åˆäº†æ·±åº¦å­¦ä¹ ä¸å¼ºåŒ–å­¦ä¹ ã€‚","title":"CNN RNN GAN"},{"content":"ç®€ä»‹ åœ¨æ¨èã€æœç´¢ã€å¹¿å‘Šç­‰é¢†åŸŸï¼ŒCTRï¼ˆclick-through rateï¼‰é¢„ä¼°æ˜¯ä¸€é¡¹éå¸¸æ ¸å¿ƒçš„æŠ€æœ¯ï¼Œè¿™é‡Œå¼•ç”¨é˜¿é‡Œå¦ˆå¦ˆèµ„æ·±ç®—æ³•ä¸“å®¶æœ±å°å¼ºå¤§ä½¬çš„ä¸€å¥è¯ï¼šâ€œå®ƒï¼ˆCTRé¢„ä¼°ï¼‰æ˜¯é•¶åµŒåœ¨äº’è”ç½‘æŠ€æœ¯ä¸Šçš„æ˜ç â€ã€‚\næœ¬ç¯‡æ–‡ç« ä¸»è¦æ˜¯å¯¹CTRé¢„ä¼°ä¸­çš„å¸¸è§æ¨¡å‹è¿›è¡Œæ¢³ç†ä¸æ€»ç»“ï¼Œå¹¶åˆ†æˆæ¨¡å—è¿›è¡Œæ¦‚è¿°ã€‚æ¯ä¸ªæ¨¡å‹éƒ½ä¼šä»ã€Œæ¨¡å‹ç»“æ„ã€ã€ã€Œä¼˜åŠ¿ã€ã€ã€Œä¸è¶³ã€ä¸‰ä¸ªæ–¹é¢è¿›è¡Œæ¢è®¨ï¼Œåœ¨æœ€åå¯¹æ‰€æœ‰æ¨¡å‹ä¹‹é—´çš„å…³ç³»è¿›è¡Œæ¯”è¾ƒä¸æ€»ç»“ã€‚æœ¬ç¯‡æ–‡ç« è®¨è®ºçš„æ¨¡å‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆåŸåˆ›å›¾ï¼‰ï¼Œè¿™ä¸ªå›¾ä¸­å±•ç¤ºäº†æœ¬ç¯‡æ–‡ç« æ‰€è¦è®²è¿°çš„ç®—æ³•ä»¥åŠä¹‹é—´çš„å…³ç³»ï¼Œåœ¨æ–‡ç« çš„æœ€åæ€»ç»“ä¼šå¯¹è¿™å¼ å›¾è¿›è¡Œè¯¦ç»†åœ°è¯´æ˜ã€‚\nä¸€. åˆ†å¸ƒå¼çº¿æ€§æ¨¡å‹ Logistic Regression Logistic Regressionæ˜¯æ¯ä¸€ä½ç®—æ³•å·¥ç¨‹å¸ˆå†ä¹Ÿç†Ÿæ‚‰ä¸è¿‡çš„åŸºæœ¬ç®—æ³•ä¹‹ä¸€äº†ï¼Œæ¯«ä¸å¤¸å¼ åœ°è¯´ï¼ŒLRä½œä¸ºæœ€ç»å…¸çš„ç»Ÿè®¡å­¦ä¹ ç®—æ³•å‡ ä¹ç»Ÿæ²»äº†æ—©æœŸå·¥ä¸šæœºå™¨å­¦ä¹ æ—¶ä»£ã€‚è¿™æ˜¯å› ä¸ºå…¶å…·å¤‡ç®€å•ã€æ—¶é—´å¤æ‚åº¦ä½ã€å¯å¤§è§„æ¨¡å¹¶è¡ŒåŒ–ç­‰ä¼˜è‰¯ç‰¹æ€§ã€‚åœ¨æ—©æœŸçš„CTRé¢„ä¼°ä¸­ï¼Œç®—æ³•å·¥ç¨‹å¸ˆä»¬é€šè¿‡æ‰‹åŠ¨è®¾è®¡äº¤å‰ç‰¹å¾ä»¥åŠç‰¹å¾ç¦»æ•£åŒ–ç­‰æ–¹å¼ï¼Œèµ‹äºˆLRè¿™æ ·çš„çº¿æ€§æ¨¡å‹å¯¹æ•°æ®é›†çš„éçº¿æ€§å­¦ä¹ èƒ½åŠ›ï¼Œé«˜ç»´ç¦»æ•£ç‰¹å¾+æ‰‹åŠ¨äº¤å‰ç‰¹å¾æ„æˆäº†CTRé¢„ä¼°çš„åŸºç¡€ç‰¹å¾ã€‚LRåœ¨å·¥ç¨‹ä¸Šæ˜“äºå¤§è§„æ¨¡å¹¶è¡ŒåŒ–è®­ç»ƒæ°æ°é€‚åº”äº†è¿™ä¸ªæ—¶ä»£çš„è¦æ±‚ã€‚\næ¨¡å‹ç»“æ„ï¼š\nä¼˜åŠ¿ï¼š\næ¨¡å‹ç®€å•ï¼Œå…·å¤‡ä¸€å®šå¯è§£é‡Šæ€§ è®¡ç®—æ—¶é—´å¤æ‚åº¦ä½ å·¥ç¨‹ä¸Šå¯å¤§è§„æ¨¡å¹¶è¡ŒåŒ– ä¸è¶³ï¼š\nä¾èµ–äºäººå·¥å¤§é‡çš„ç‰¹å¾å·¥ç¨‹ï¼Œä¾‹å¦‚éœ€è¦æ ¹æ®ä¸šåŠ¡èƒŒçŸ¥è¯†é€šè¿‡ç‰¹å¾å·¥ç¨‹èå…¥æ¨¡å‹ ç‰¹å¾äº¤å‰éš¾ä»¥ç©·å°½ å¯¹äºè®­ç»ƒé›†ä¸­æ²¡æœ‰å‡ºç°çš„äº¤å‰ç‰¹å¾æ— æ³•è¿›è¡Œå‚æ•°å­¦ä¹  äºŒ. è‡ªåŠ¨åŒ–ç‰¹å¾å·¥ç¨‹ GBDT + LRï¼ˆ2014ï¼‰â€”â€” ç‰¹å¾è‡ªåŠ¨åŒ–æ—¶ä»£çš„åˆæ¢ç´¢ Facebookåœ¨2014å¹´æå‡ºäº†GBDT+LRçš„ç»„åˆæ¨¡å‹æ¥è¿›è¡ŒCTRé¢„ä¼°ï¼Œå…¶æœ¬è´¨ä¸Šæ˜¯é€šè¿‡Boosting Treeæ¨¡å‹æœ¬èº«çš„ç‰¹å¾ç»„åˆèƒ½åŠ›æ¥æ›¿ä»£åŸå…ˆç®—æ³•å·¥ç¨‹å¸ˆä»¬æ‰‹åŠ¨ç»„åˆç‰¹å¾çš„è¿‡ç¨‹ã€‚GBDTç­‰è¿™ç±»Boosting Treeæ¨¡å‹æœ¬èº«å…·å¤‡äº†ç‰¹å¾ç­›é€‰èƒ½åŠ›ï¼ˆæ¯æ¬¡åˆ†è£‚é€‰å–å¢ç›Šæœ€å¤§çš„åˆ†è£‚ç‰¹å¾ä¸åˆ†è£‚ç‚¹ï¼‰ä»¥åŠé«˜é˜¶ç‰¹å¾ç»„åˆèƒ½åŠ›ï¼ˆæ ‘æ¨¡å‹å¤©ç„¶ä¼˜åŠ¿ï¼‰å¯¹åº”æ ‘çš„ä¸€æ¡è·¯å¾„ï¼ˆç”¨å¶å­èŠ‚ç‚¹æ¥è¡¨ç¤ºï¼‰ï¼Œå› æ­¤é€šè¿‡GBDTæ¥è‡ªåŠ¨ç”Ÿæˆç‰¹å¾å‘é‡å°±æˆäº†ä¸€ä¸ªéå¸¸è‡ªç„¶çš„æ€è·¯ã€‚æ³¨æ„è¿™é‡Œè™½ç„¶æ˜¯ä¸¤ä¸ªæ¨¡å‹çš„ç»„åˆï¼Œä½†å®é™…å¹¶éæ˜¯ç«¯åˆ°ç«¯çš„æ¨¡å‹ï¼Œè€Œæ˜¯ä¸¤é˜¶æ®µçš„ã€è§£è€¦çš„ï¼Œå³å…ˆé€šè¿‡GBDTè®­ç»ƒå¾—åˆ°ç‰¹å¾å‘é‡åï¼Œå†ä½œä¸ºä¸‹æ¸¸LRçš„è¾“å…¥ï¼ŒLRçš„åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¹¶ä¸ä¼šå¯¹GBDTè¿›è¡Œæ›´æ–°ã€‚\næ¨¡å‹ç»“æ„ï¼š\né€šè¿‡GBDTè®­ç»ƒæ¨¡å‹ï¼Œå¾—åˆ°ç»„åˆçš„ç‰¹å¾å‘é‡ã€‚ä¾‹å¦‚è®­ç»ƒäº†ä¸¤æ£µæ ‘ï¼Œæ¯æ£µæ ‘æœ‰5ä¸ªå¶å­ç»“ç‚¹ï¼Œå¯¹äºæŸä¸ªç‰¹å®šæ ·æœ¬æ¥è¯´ï¼Œè½åœ¨äº†ç¬¬ä¸€æ£µæ ‘çš„ç¬¬3ä¸ªç»“ç‚¹ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥å¾—åˆ°å‘é‡ ï¼›è½åœ¨ç¬¬äºŒæ£µæ ‘çš„ç¬¬4ä¸ªç»“ç‚¹ï¼Œæ­¤æ—¶çš„åˆ°å‘é‡ ï¼›é‚£ä¹ˆæœ€ç»ˆé€šè¿‡concatæ‰€æœ‰æ ‘çš„å‘é‡ï¼Œå¾—åˆ°è¿™ä¸ªæ ·æœ¬çš„æœ€ç»ˆå‘é‡ ã€‚å°†è¿™ä¸ªå‘é‡ä½œä¸ºä¸‹æ¸¸LRæ¨¡å‹çš„inputsï¼Œè¿›è¡Œè®­ç»ƒã€‚\nä¼˜åŠ¿ï¼š\nç‰¹å¾å·¥ç¨‹è‡ªåŠ¨åŒ–ï¼Œé€šè¿‡Boosting Treeæ¨¡å‹çš„å¤©ç„¶ä¼˜åŠ¿è‡ªåŠ¨æ¢ç´¢ç‰¹å¾ç»„åˆ ä¸è¶³ï¼š\nä¸¤é˜¶æ®µçš„ã€éç«¯åˆ°ç«¯çš„æ¨¡å‹ CTRé¢„ä¼°åœºæ™¯æ¶‰åŠåˆ°å¤§é‡é«˜ç»´ç¨€ç–ç‰¹å¾ï¼Œæ ‘æ¨¡å‹å¹¶ä¸é€‚åˆå¤„ç†ï¼ˆå› æ­¤å®é™…ä¸Šä¼šå°†denseç‰¹å¾æˆ–è€…ä½ç»´çš„ç¦»æ•£ç‰¹å¾ç»™GBDTï¼Œå‰©ä½™é«˜ç»´ç¨€ç–ç‰¹å¾åœ¨LRé˜¶æ®µè¿›è¡Œè®­ç»ƒï¼‰ GBDTæ¨¡å‹æœ¬èº«æ¯”è¾ƒå¤æ‚ï¼Œæ— æ³•åšåˆ°online learningï¼Œæ¨¡å‹å¯¹æ•°æ®çš„æ„ŸçŸ¥ç›¸å¯¹è¾ƒæ»åï¼ˆå¿…é¡»æé«˜ç¦»çº¿æ¨¡å‹çš„æ›´æ–°é¢‘ç‡ï¼‰ ç”±äºLRå–„äºå¤„ç†ç¦»æ•£ç‰¹å¾ï¼ŒGBDTå–„äºå¤„ç†è¿ç»­ç‰¹å¾ã€‚æ‰€ä»¥ä¹Ÿå¯ä»¥äº¤ç”±GBDTå¤„ç†è¿ç»­ç‰¹å¾ï¼Œè¾“å‡ºç»“æœæ‹¼æ¥ä¸Šç¦»æ•£ç‰¹å¾ä¸€èµ·è¾“å…¥LRã€‚\nä¸‰. FMæ¨¡å‹ä»¥åŠå˜ä½“ ï¼ˆ1ï¼‰FMï¼šFactorization Machines, 2010 â€”â€” éšå‘é‡å­¦ä¹ æå‡æ¨¡å‹è¡¨è¾¾ FMæ˜¯åœ¨2010å¹´æå‡ºçš„ä¸€ç§å¯ä»¥å­¦ä¹ äºŒé˜¶ç‰¹å¾äº¤å‰çš„æ¨¡å‹ï¼Œé€šè¿‡åœ¨åŸå…ˆçº¿æ€§æ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œæšä¸¾äº†æ‰€æœ‰ç‰¹å¾çš„äºŒé˜¶äº¤å‰ä¿¡æ¯åèå…¥æ¨¡å‹ï¼Œæé«˜äº†æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚ä½†ä¸åŒçš„æ˜¯ï¼Œæ¨¡å‹åœ¨äºŒé˜¶äº¤å‰ä¿¡æ¯çš„æƒé‡å­¦ä¹ ä¸Šï¼Œé‡‡ç”¨äº†éšå‘é‡å†…ç§¯ï¼ˆä¹Ÿå¯çœ‹åšembeddingï¼‰çš„æ–¹å¼è¿›è¡Œå­¦ä¹ ã€‚\nFMå’ŒåŸºäºæ ‘çš„æ¨¡å‹ï¼ˆe.g. GBDTï¼‰éƒ½èƒ½å¤Ÿè‡ªåŠ¨å­¦ä¹ ç‰¹å¾äº¤å‰ç»„åˆã€‚åŸºäºæ ‘çš„æ¨¡å‹é€‚åˆè¿ç»­ä¸­ä½åº¦ç¨€ç–æ•°æ®ï¼Œå®¹æ˜“å­¦åˆ°é«˜é˜¶ç»„åˆã€‚ä½†æ˜¯æ ‘æ¨¡å‹å´ä¸é€‚åˆå­¦ä¹ é«˜åº¦ç¨€ç–æ•°æ®çš„ç‰¹å¾ç»„åˆï¼Œä¸€æ–¹é¢é«˜åº¦ç¨€ç–æ•°æ®çš„ç‰¹å¾ç»´åº¦ä¸€èˆ¬å¾ˆé«˜ï¼Œè¿™æ—¶åŸºäºæ ‘çš„æ¨¡å‹å­¦ä¹ æ•ˆç‡å¾ˆä½ï¼Œç”šè‡³ä¸å¯è¡Œï¼›å¦ä¸€æ–¹é¢æ ‘æ¨¡å‹ä¹Ÿä¸èƒ½å­¦ä¹ åˆ°è®­ç»ƒæ•°æ®ä¸­å¾ˆå°‘æˆ–æ²¡æœ‰å‡ºç°çš„ç‰¹å¾ç»„åˆã€‚ç›¸åï¼ŒFMæ¨¡å‹å› ä¸ºé€šè¿‡éšå‘é‡çš„å†…ç§¯æ¥æå–ç‰¹å¾ç»„åˆï¼Œå¯¹äºè®­ç»ƒæ•°æ®ä¸­å¾ˆå°‘æˆ–æ²¡æœ‰å‡ºç°çš„ç‰¹å¾ç»„åˆä¹Ÿèƒ½å¤Ÿå­¦ä¹ åˆ°ã€‚ä¾‹å¦‚ï¼Œç‰¹å¾ å’Œç‰¹å¾ åœ¨è®­ç»ƒæ•°æ®ä¸­ä»æ¥æ²¡æœ‰æˆå¯¹å‡ºç°è¿‡ï¼Œä½†ç‰¹å¾ ç»å¸¸å’Œç‰¹å¾ æˆå¯¹å‡ºç°ï¼Œç‰¹å¾ ä¹Ÿç»å¸¸å’Œç‰¹å¾ æˆå¯¹å‡ºç°ï¼Œå› è€Œåœ¨FMæ¨¡å‹ä¸­ç‰¹å¾ å’Œç‰¹å¾ ä¹Ÿä¼šæœ‰ä¸€å®šçš„ç›¸å…³æ€§ã€‚æ¯•ç«Ÿæ‰€æœ‰åŒ…å«ç‰¹å¾ çš„è®­ç»ƒæ ·æœ¬éƒ½ä¼šå¯¼è‡´æ¨¡å‹æ›´æ–°ç‰¹å¾ çš„éšå‘é‡ ï¼ŒåŒç†ï¼Œæ‰€æœ‰åŒ…å«ç‰¹å¾ çš„æ ·æœ¬ä¹Ÿä¼šå¯¼è‡´æ¨¡å‹æ›´æ–°éšå‘é‡ ï¼Œè¿™æ · å°±ä¸å¤ªå¯èƒ½ä¸º0ã€‚\næ¨¡å‹ç»“æ„ï¼š\nFMçš„å…¬å¼åŒ…å«äº†ä¸€é˜¶çº¿æ€§éƒ¨åˆ†ä¸äºŒé˜¶ç‰¹å¾äº¤å‰éƒ¨åˆ†ï¼š\nåœ¨LRä¸­ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡æ‰‹åŠ¨æ„é€ äº¤å‰ç‰¹å¾åï¼Œå–‚ç»™æ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œä¾‹å¦‚æˆ‘ä»¬æ„é€ æ€§åˆ«ä¸å¹¿å‘Šç±»åˆ«çš„äº¤å‰ç‰¹å¾ï¼š (gender=â€™å¥³â€™ \u0026amp; ad_category=â€™ç¾å¦†â€™)ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¼šé’ˆå¯¹è¿™ä¸ªäº¤å‰ç‰¹å¾å­¦ä¹ ä¸€ä¸ªå‚æ•° ã€‚ä½†æ˜¯åœ¨LRä¸­ï¼Œå‚æ•°æ¢¯åº¦æ›´æ–°å…¬å¼ä¸è¯¥ç‰¹å¾å–å€¼ å…³ç³»å¯†åˆ‡ï¼š ï¼Œå½“ å–å€¼ä¸º0æ—¶ï¼Œå‚æ•° å°±æ— æ³•å¾—åˆ°æ›´æ–°ï¼Œè€Œ è¦éé›¶å°±è¦æ±‚äº¤å‰ç‰¹å¾çš„ä¸¤é¡¹éƒ½è¦éé›¶ï¼Œä½†å®é™…åœ¨æ•°æ®é«˜åº¦ç¨€ç–ï¼Œä¸€æ—¦ä¸¤ä¸ªç‰¹å¾åªè¦æœ‰ä¸€ä¸ªå–0ï¼Œå‚æ•° ä¸èƒ½å¾—åˆ°æœ‰æ•ˆæ›´æ–°ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äºè®­ç»ƒé›†ä¸­æ²¡æœ‰å‡ºç°çš„äº¤å‰ç‰¹å¾ï¼Œä¹Ÿæ²¡åŠæ³•å­¦ä¹ è¿™ç±»æƒé‡ï¼Œæ³›åŒ–æ€§èƒ½ä¸å¤Ÿå¥½ã€‚\nå¦å¤–ï¼Œåœ¨FMä¸­é€šè¿‡å°†ç‰¹å¾éšå°„åˆ°kç»´ç©ºé—´æ±‚å†…ç§¯çš„æ–¹å¼ï¼Œæ‰“ç ´äº†äº¤å‰ç‰¹å¾æƒé‡é—´çš„éš”ç¦»æ€§ï¼ˆbreak the independence of the interaction parametersï¼‰ï¼Œå¢åŠ æ¨¡å‹åœ¨ç¨€ç–åœºæ™¯ä¸‹å­¦ä¹ äº¤å‰ç‰¹å¾çš„èƒ½åŠ›ã€‚ä¸€ä¸ªäº¤å‰ç‰¹å¾å‚æ•°çš„ä¼°è®¡ï¼Œå¯ä»¥å¸®åŠ©ä¼°è®¡å…¶ä»–ç›¸å…³çš„äº¤å‰ç‰¹å¾å‚æ•°ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰äº¤å‰ç‰¹å¾gender=male \u0026amp; movie_genre=warï¼Œæˆ‘ä»¬éœ€è¦ä¼°è®¡è¿™ä¸ªäº¤å‰ç‰¹å¾å‰çš„å‚æ•° ï¼ŒFMé€šè¿‡å°† åˆ†è§£ä¸º çš„æ–¹å¼è¿›è¡Œä¼°è®¡ï¼Œé‚£ä¹ˆå¯¹äºæ¯æ¬¡æ›´æ–°maleæˆ–è€…warçš„éšå‘é‡ æ—¶ï¼Œéƒ½ä¼šå½±å“å…¶ä»–ä¸maleæˆ–è€…waräº¤å‰çš„ç‰¹å¾å‚æ•°ä¼°è®¡ï¼Œä½¿å¾—ç‰¹å¾æƒé‡çš„å­¦ä¹ ä¸å†äº’ç›¸ç‹¬ç«‹ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå¯¹äºtraindata setä¸­æ²¡æœ‰å‡ºç°è¿‡çš„äº¤å‰ç‰¹å¾ï¼ŒFMä»ç„¶å¯ä»¥ç»™åˆ°ä¸€ä¸ªè¾ƒå¥½çš„éé›¶é¢„ä¼°å€¼ã€‚\nä¼˜åŠ¿ï¼š\nå¯ä»¥æœ‰æ•ˆå¤„ç†ç¨€ç–åœºæ™¯ä¸‹çš„ç‰¹å¾å­¦ä¹  å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ï¼ˆåŒ–ç®€æ€è·¯ï¼š ï¼‰ å¯¹è®­ç»ƒé›†ä¸­æœªå‡ºç°çš„äº¤å‰ç‰¹å¾ä¿¡æ¯ä¹Ÿå¯è¿›è¡Œæ³›åŒ– ä¸è¶³ï¼š 2-wayçš„FMä»…æšä¸¾äº†æ‰€æœ‰ç‰¹å¾çš„äºŒé˜¶äº¤å‰ä¿¡æ¯ï¼Œæ²¡æœ‰è€ƒè™‘é«˜é˜¶ç‰¹å¾çš„ä¿¡æ¯ FFMï¼ˆField-aware Factorization Machineï¼‰æ˜¯Yuchin Juanç­‰äººåœ¨2015å¹´çš„æ¯”èµ›ä¸­æå‡ºçš„ä¸€ç§å¯¹FMæ”¹è¿›ç®—æ³•ï¼Œä¸»è¦æ˜¯å¼•å…¥äº†fieldæ¦‚å¿µï¼Œå³è®¤ä¸ºæ¯ä¸ªfeatureå¯¹äºä¸åŒfieldçš„äº¤å‰éƒ½æœ‰ä¸åŒçš„ç‰¹å¾è¡¨è¾¾ã€‚FFMç›¸æ¯”äºFMçš„è®¡ç®—æ—¶é—´å¤æ‚åº¦æ›´é«˜ï¼Œä½†åŒæ—¶ä¹Ÿæé«˜äº†æœ¬èº«æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚FMä¹Ÿå¯ä»¥çœ‹æˆåªæœ‰ä¸€ä¸ªfieldçš„FFMï¼Œè¿™é‡Œä¸åšè¿‡å¤šèµ˜è¿°ã€‚\nï¼ˆ2ï¼‰AFMï¼šAttentional Factorization Machines, 2017 â€”â€” å¼•å…¥Attentionæœºåˆ¶çš„FM AFMå…¨ç§°Attentional Factorization Machinesï¼Œé¡¾åæ€ä¹‰å°±æ˜¯å¼•å…¥Attentionæœºåˆ¶çš„FMæ¨¡å‹ã€‚æˆ‘ä»¬çŸ¥é“FMæ¨¡å‹æšä¸¾äº†æ‰€æœ‰çš„äºŒé˜¶äº¤å‰ç‰¹å¾ï¼ˆsecond-order interactionsï¼‰ï¼Œå³ ï¼Œå®é™…ä¸Šæœ‰ä¸€äº›äº¤å‰ç‰¹å¾å¯èƒ½ä¸æˆ‘ä»¬çš„é¢„ä¼°ç›®æ ‡å…³è”æ€§ä¸æ˜¯å¾ˆå¤§ï¼›AFMå°±æ˜¯é€šè¿‡Attentionæœºåˆ¶æ¥å­¦ä¹ ä¸åŒäºŒé˜¶äº¤å‰ç‰¹å¾çš„é‡è¦æ€§ï¼ˆè¿™ä¸ªæ€è·¯ä¸FFMä¸­ä¸åŒfieldç‰¹å¾äº¤å‰ä½¿ç”¨ä¸åŒçš„embeddingå®é™…ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯é€šè¿‡å¼•å…¥é¢å¤–ä¿¡æ¯æ¥è¡¨è¾¾ä¸åŒç‰¹å¾äº¤å‰çš„é‡è¦æ€§ï¼‰ã€‚\nä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨é¢„ä¼°ç”¨æˆ·æ˜¯å¦ä¼šç‚¹å‡»å¹¿å‘Šæ—¶ï¼Œæˆ‘ä»¬å‡è®¾æœ‰ç”¨æˆ·æ€§åˆ«ã€å¹¿å‘Šç‰ˆä½å°ºå¯¸å¤§å°ã€å¹¿å‘Šç±»å‹ä¸‰ä¸ªç‰¹å¾ï¼Œåˆ†åˆ«å¯¹åº”ä¸‰ä¸ªembeddingï¼š ï¼Œ ï¼Œ ï¼Œå¯¹äºç”¨æˆ·â€œæ˜¯å¦ç‚¹å‡»â€è¿™ä¸€ç›®æ ‡ æ¥è¯´ï¼Œæ˜¾ç„¶æ€§åˆ«ä¸ad_sizeçš„äº¤å‰ç‰¹å¾å¯¹äº çš„ç›¸å…³åº¦ä¸å¤§ï¼Œä½†æ€§åˆ«ä¸ad_categoryçš„äº¤å‰ç‰¹å¾ï¼ˆå¦‚gender=å¥³æ€§\u0026amp;category=ç¾å¦†ï¼‰å°±ä¼šä¸ æ›´åŠ ç›¸å…³ï¼›æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬è®¤ä¸ºå½“æ€§åˆ«ä¸ad_categoryäº¤å‰æ—¶ï¼Œé‡è¦æ€§åº”è¯¥è¦é«˜äºæ€§åˆ«ä¸ad_sizeçš„äº¤å‰ï¼›FFMä¸­é€šè¿‡å¼•å…¥Field-awareçš„æ¦‚å¿µæ¥é‡åŒ–è¿™ç§ä¸ä¸åŒç‰¹å¾äº¤å‰æ—¶çš„é‡è¦æ€§ï¼ŒAFMåˆ™æ˜¯é€šè¿‡åŠ å…¥Attentionæœºåˆ¶ï¼Œèµ‹äºˆé‡è¦äº¤å‰ç‰¹å¾æ›´é«˜çš„é‡è¦æ€§ã€‚\næ¨¡å‹ç»“æ„ï¼š\nAFMåœ¨FMçš„äºŒé˜¶äº¤å‰ç‰¹å¾ä¸Šå¼•å…¥Attentionæƒé‡ï¼Œå…¬å¼å¦‚ä¸‹ï¼š\nå…¶ä¸­ ä»£è¡¨element-wiseçš„å‘é‡ç›¸ä¹˜ï¼Œä¸‹åŒã€‚\nå…¶ä¸­ï¼Œ æ˜¯æ¨¡å‹æ‰€å­¦ä¹ åˆ°çš„ ä¸ ç‰¹å¾äº¤å‰çš„é‡è¦æ€§ï¼Œå…¶å…¬å¼å¦‚ä¸‹ï¼š\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„æƒé‡ å®é™…æ˜¯é€šè¿‡è¾“å…¥ å’Œ è®­ç»ƒäº†ä¸€ä¸ªä¸€å±‚éšè—å±‚çš„NNç½‘ç»œï¼Œè®©æ¨¡å‹è‡ªè¡Œå»å­¦ä¹ è¿™ä¸ªæƒé‡ã€‚\nå¯¹æ¯”AFMå’ŒFMçš„å…¬å¼æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒAFMå®é™…ä¸Šæ˜¯FMçš„æ›´åŠ æ³›åŒ–çš„ä¸€ç§å½¢å¼ã€‚å½“æˆ‘ä»¬ä»¤å‘é‡ ï¼Œæƒé‡ æ—¶ï¼ŒAFMå°±ä¼šé€€åŒ–æˆFMæ¨¡å‹ã€‚\nä¼˜åŠ¿ï¼š\nåœ¨FMçš„äºŒé˜¶äº¤å‰é¡¹ä¸Šå¼•å…¥Attentionæœºåˆ¶ï¼Œèµ‹äºˆä¸åŒäº¤å‰ç‰¹å¾ä¸åŒçš„é‡è¦åº¦ï¼Œå¢åŠ äº†æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ› Attentionçš„å¼•å…¥ï¼Œä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†æ¨¡å‹çš„å¯è§£é‡Šæ€§ ä¸è¶³ï¼š\nä»ç„¶æ˜¯ä¸€ç§æµ…å±‚æ¨¡å‹ï¼Œæ¨¡å‹æ²¡æœ‰å­¦ä¹ åˆ°é«˜é˜¶çš„äº¤å‰ç‰¹å¾ å››. Embedding+MLPç»“æ„ä¸‹çš„æµ…å±‚æ”¹é€  æœ¬ç« æ‰€ä»‹ç»çš„éƒ½æ˜¯å…·å¤‡Embedding+MLPè¿™æ ·ç»“æ„çš„æ¨¡å‹ï¼Œä¹‹æ‰€ä»¥ç§°ä½œæµ…å±‚æ”¹é€ ï¼Œä¸»è¦åŸå› åœ¨äºè¿™äº›æ¨¡å‹éƒ½æ˜¯åœ¨embeddingå±‚è¿›è¡Œçš„ä¸€äº›æ”¹å˜ï¼Œä¾‹å¦‚FNNçš„é¢„è®­ç»ƒEmbeddingã€PNNçš„Product layerã€NFMçš„Bi-Interaction Layerç­‰ç­‰ï¼Œè¿™äº›æ”¹å˜èƒŒåçš„æ€è·¯å¯ä»¥å½’çº³ä¸ºï¼šä½¿ç”¨å¤æ‚çš„æ“ä½œè®©æ¨¡å‹åœ¨æµ…å±‚å°½å¯èƒ½åŒ…å«æ›´å¤šçš„ä¿¡æ¯ï¼Œé™ä½åç»­ä¸‹æ¸¸MLPçš„å­¦ä¹ è´Ÿæ‹…ã€‚\nï¼ˆ1ï¼‰FNNï¼š Factorisation Machine supported Neural Network, 2016 â€”â€” é¢„è®­ç»ƒEmbeddingçš„NNæ¨¡å‹ FNNæ˜¯2016å¹´æå‡ºçš„ä¸€ç§åŸºäºFMé¢„è®­ç»ƒEmbeddingçš„NNæ¨¡å‹ï¼Œå…¶æ€è·¯ä¹Ÿæ¯”è¾ƒç®€å•ï¼›FMæœ¬èº«å…·å¤‡å­¦ä¹ ç‰¹å¾Embeddingçš„èƒ½åŠ›ï¼ŒDNNå…·å¤‡é«˜é˜¶ç‰¹å¾äº¤å‰çš„èƒ½åŠ›ï¼Œå› æ­¤å°†ä¸¤è€…ç»“åˆæ˜¯å¾ˆç›´æ¥çš„æ€è·¯ã€‚FMé¢„è®­ç»ƒçš„Embeddingå¯ä»¥çœ‹åšæ˜¯â€œå…ˆéªŒä¸“å®¶çŸ¥è¯†â€ï¼Œç›´æ¥å°†ä¸“å®¶çŸ¥è¯†è¾“å…¥NNæ¥è¿›è¡Œå­¦ä¹ ã€‚æ³¨æ„ï¼ŒFNNæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸¤é˜¶æ®µçš„æ¨¡å‹ï¼Œä¸Facebookåœ¨2014å¹´æå‡ºGBDT+LRæ¨¡å‹åœ¨æ€æƒ³ä¸Šä¸€è„‰ç›¸æ‰¿ã€‚\næ¨¡å‹ç»“æ„ï¼š\nFNNæœ¬èº«åœ¨ç»“æ„ä¸Šå¹¶ä¸å¤æ‚ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå°±æ˜¯å°†FMé¢„è®­ç»ƒå¥½çš„Embeddingå‘é‡ç›´æ¥å–‚ç»™ä¸‹æ¸¸çš„DNNæ¨¡å‹ï¼Œè®©DNNæ¥è¿›è¡Œæ›´é«˜é˜¶äº¤å‰ä¿¡æ¯çš„å­¦ä¹ ã€‚\nä¼˜åŠ¿ï¼š\nç¦»çº¿è®­ç»ƒFMå¾—åˆ°embeddingï¼Œå†è¾“å…¥NNï¼Œç›¸å½“äºå¼•å…¥å…ˆéªŒä¸“å®¶ç»éªŒ åŠ é€Ÿæ¨¡å‹çš„è®­ç»ƒå’Œæ”¶æ•› NNæ¨¡å‹çœå»äº†å­¦ä¹ feature embeddingçš„æ­¥éª¤ï¼Œè®­ç»ƒå¼€é”€ä½ ä¸è¶³ï¼š\néç«¯åˆ°ç«¯çš„ä¸¤é˜¶æ®µæ¨¡å‹ï¼Œä¸åˆ©äºonline learning é¢„è®­ç»ƒçš„Embeddingå—åˆ°FMæ¨¡å‹çš„é™åˆ¶ FNNä¸­åªè€ƒè™‘äº†ç‰¹å¾çš„é«˜é˜¶äº¤å‰ï¼Œå¹¶æ²¡æœ‰ä¿ç•™ä½é˜¶ç‰¹å¾ä¿¡æ¯ ï¼ˆ2ï¼‰PNNï¼šProduct-based Neural Network, 2016 â€”â€” å¼•å…¥ä¸åŒProductæ“ä½œçš„Embeddingå±‚ PNNæ˜¯2016å¹´æå‡ºçš„ä¸€ç§åœ¨NNä¸­å¼•å…¥Product Layerçš„æ¨¡å‹ï¼Œå…¶æœ¬è´¨ä¸Šå’ŒFNNç±»ä¼¼ï¼Œéƒ½å±äºEmbedding+MLPç»“æ„ã€‚ä½œè€…è®¤ä¸ºï¼Œåœ¨DNNä¸­ç‰¹å¾Embeddingé€šè¿‡ç®€å•çš„concatæˆ–è€…addéƒ½ä¸è¶³ä»¥å­¦ä¹ åˆ°ç‰¹å¾ä¹‹é—´å¤æ‚çš„ä¾èµ–ä¿¡æ¯ï¼Œå› æ­¤PNNé€šè¿‡å¼•å…¥Product Layeræ¥è¿›è¡Œæ›´å¤æ‚å’Œå……åˆ†çš„ç‰¹å¾äº¤å‰å…³ç³»çš„å­¦ä¹ ã€‚PNNä¸»è¦åŒ…å«äº†IPNNå’ŒOPNNä¸¤ç§ç»“æ„ï¼Œåˆ†åˆ«å¯¹åº”ç‰¹å¾ä¹‹é—´Inner Productçš„äº¤å‰è®¡ç®—å’ŒOuter Productçš„äº¤å‰è®¡ç®—æ–¹å¼ã€‚\næ¨¡å‹ç»“æ„ï¼š\nPNNç»“æ„æ˜¾ç¤ºé€šè¿‡Embedding Lookupå¾—åˆ°æ¯ä¸ªfieldçš„Embeddingå‘é‡ï¼Œæ¥ç€å°†è¿™äº›å‘é‡è¾“å…¥Product Layerï¼Œåœ¨Product Layerä¸­åŒ…å«äº†ä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯å·¦è¾¹çš„ ï¼Œå°±æ˜¯å°†ç‰¹å¾åŸå§‹çš„Embeddingå‘é‡ç›´æ¥ä¿ç•™ï¼›å¦ä¸€éƒ¨åˆ†æ˜¯å³ä¾§çš„ ï¼Œå³å¯¹åº”ç‰¹å¾ä¹‹é—´çš„productæ“ä½œï¼›å¯ä»¥çœ‹åˆ°PNNç›¸æ¯”äºFNNä¸€ä¸ªä¼˜åŠ¿å°±æ˜¯ä¿ç•™äº†åŸå§‹çš„ä½é˜¶embeddingç‰¹å¾ã€‚\nåœ¨PNNä¸­ï¼Œç”±äºå¼•å…¥Productæ“ä½œï¼Œä¼šä½¿æ¨¡å‹çš„æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦éƒ½è¿›ä¸€æ­¥å¢åŠ ã€‚è¿™é‡Œä»¥IPNNä¸ºä¾‹ï¼Œå…¶ä¸­ æ˜¯pair-wiseçš„ç‰¹å¾äº¤å‰å‘é‡ï¼Œå‡è®¾æˆ‘ä»¬å…±æœ‰Nä¸ªç‰¹å¾ï¼Œæ¯ä¸ªç‰¹å¾çš„embeddingä¿¡æ¯ ï¼›åœ¨Inner Productçš„æƒ…å†µä¸‹ï¼Œé€šè¿‡äº¤å‰é¡¹å…¬å¼ ä¼šå¾—åˆ° ï¼ˆå…¶ä¸­ æ˜¯å¯¹ç§°çŸ©é˜µï¼‰ï¼Œæ­¤æ—¶ä»Productå±‚åˆ° å±‚ï¼ˆå‡è®¾ å±‚æœ‰ ä¸ªç»“ç‚¹ï¼‰ï¼Œå¯¹äº å±‚çš„æ¯ä¸ªç»“ç‚¹æˆ‘ä»¬æœ‰ï¼š ï¼Œå› æ­¤è¿™é‡Œä»product layeråˆ°L1å±‚å‚æ•°ç©ºé—´å¤æ‚åº¦ä¸º ï¼›ä½œè€…å€Ÿé‰´äº†FMçš„æ€æƒ³å¯¹å‚æ•° è¿›è¡Œäº†çŸ©é˜µåˆ†è§£ï¼š ï¼Œæ­¤æ—¶L1å±‚æ¯ä¸ªç»“ç‚¹çš„è®¡ç®—å¯ä»¥åŒ–ç®€ä¸ºï¼š ï¼Œç©ºé—´å¤æ‚åº¦é€€åŒ– ã€‚\nä¼˜åŠ¿ï¼š\nPNNé€šè¿‡ ä¿ç•™äº†ä½é˜¶Embeddingç‰¹å¾ä¿¡æ¯ é€šè¿‡Product Layerå¼•å…¥æ›´å¤æ‚çš„ç‰¹å¾äº¤å‰æ–¹å¼ï¼Œ ä¸è¶³ï¼š\nè®¡ç®—æ—¶é—´å¤æ‚åº¦ç›¸å¯¹è¾ƒé«˜ ï¼ˆ3ï¼‰NFMï¼šNeural Factorization Machines, 2017 â€”â€” å¼•å…¥Bi-Interaction Poolingç»“æ„çš„NNæ¨¡å‹ NFMå…¨ç¨‹ä¸ºNeural Factorization Machinesï¼Œå®ƒä¸FNNä¸€æ ·ï¼Œéƒ½å±äºå°†FMä¸NNè¿›è¡Œç»“åˆçš„æ¨¡å‹ã€‚ä½†ä¸åŒçš„æ˜¯NFMç›¸æ¯”äºFNNæ˜¯ä¸€ç§ç«¯åˆ°ç«¯çš„æ¨¡å‹ã€‚NFMä¸PNNä¹Ÿæœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å‡ºï¼Œæœ¬è´¨ä¸Šä¹Ÿå±äºEmbedding+MLPç»“æ„ï¼Œåªæ˜¯åœ¨æµ…å±‚çš„ç‰¹å¾äº¤äº’ä¸Šé‡‡ç”¨äº†ä¸åŒçš„ç»“æ„ã€‚NFMå°†PNNçš„Product Layeræ›¿æ¢æˆäº†Bi-interaction Poolingç»“æ„æ¥è¿›è¡Œç‰¹å¾äº¤å‰çš„å­¦ä¹ ã€‚\næ¨¡å‹ç»“æ„ï¼š\nNFMçš„æ•´ä¸ªæ¨¡å‹å…¬å¼ä¸ºï¼š\nå…¶ä¸­ æ˜¯Bi-Interaction Pooling+NNéƒ¨åˆ†çš„è¾“å‡ºç»“æœã€‚æˆ‘ä»¬é‡ç‚¹å…³æ³¨NFMä¸­çš„Bi-Interaction Poolingå±‚ï¼š\nNFMçš„ç»“æ„å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé€šè¿‡å¯¹ç‰¹å¾Embeddingä¹‹åï¼Œè¿›å…¥Bi-Interaction Poolingå±‚ã€‚è¿™é‡Œæ³¨æ„ä¸€ä¸ªå°ç»†èŠ‚ï¼ŒNFMçš„å¯¹Dense Featureï¼ŒEmbeddingæ–¹å¼äºAFMç›¸åŒï¼Œå°†Dense Feature Embeddingä»¥åå†ç”¨dense featureåŸå§‹çš„æ•°æ®è¿›è¡Œäº†scaleï¼Œå³ ã€‚\nNFMçš„Bi-Interaction Poolingå±‚æ˜¯å¯¹ä¸¤ä¸¤ç‰¹å¾çš„embeddingè¿›è¡Œelement-wiseçš„ä¹˜æ³•ï¼Œå…¬å¼å¦‚ä¸‹ï¼š\nå‡è®¾æˆ‘ä»¬æ¯ä¸ªç‰¹å¾Embeddingå‘é‡çš„ç»´åº¦ä¸º ï¼Œåˆ™ ï¼ŒBi-Interaction Poolingçš„æ“ä½œç®€å•æ¥è¯´å°±æ˜¯å°†æ‰€æœ‰äºŒé˜¶äº¤å‰çš„ç»“æœå‘é‡è¿›è¡Œsum poolingåå†é€å…¥NNè¿›è¡Œè®­ç»ƒã€‚å¯¹æ¯”AFMçš„Attentionå±‚ï¼ŒBi-Interaction Poolingå±‚é‡‡ç”¨ç›´æ¥sumçš„æ–¹å¼ï¼Œç¼ºå°‘äº†Attentionæœºåˆ¶ï¼›å¯¹æ¯”FMè«æ˜æ˜Ÿï¼ŒNFMå¦‚æœå°†åç»­DNNéšè—å±‚åˆ æ‰ï¼Œå°±ä¼šé€€åŒ–ä¸ºä¸€ä¸ªFMæ¨¡å‹ã€‚\nNFMåœ¨è¾“å…¥å±‚ä»¥åŠBi-Interaction Poolingå±‚åéƒ½å¼•å…¥äº†BNå±‚ï¼Œä¹ŸåŠ é€Ÿäº†æ¨¡å‹äº†æ”¶æ•›ã€‚\nä¼˜åŠ¿ï¼š\nç›¸æ¯”äºEmbeddingçš„concatæ“ä½œï¼ŒNFMåœ¨low levelè¿›è¡Œinteractionå¯ä»¥æé«˜æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ› å…·å¤‡ä¸€å®šé«˜é˜¶ç‰¹å¾äº¤å‰çš„èƒ½åŠ› Bi-Interaction Poolingçš„äº¤å‰å…·å¤‡çº¿æ€§è®¡ç®—æ—¶é—´å¤æ‚åº¦ ä¸è¶³ï¼š\nç›´æ¥è¿›è¡Œsum poolingæ“ä½œä¼šæŸå¤±ä¸€å®šçš„ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒAFMå¼•å…¥Attention ï¼ˆ4ï¼‰ONNï¼šOperation-aware Neural Network, 2019 â€”â€” FFMä¸NNçš„ç»“åˆä½“ ONNæ˜¯2019å¹´å‘è¡¨çš„CTRé¢„ä¼°ï¼Œæˆ‘ä»¬çŸ¥é“PNNé€šè¿‡å¼•å…¥ä¸åŒçš„Productæ“ä½œæ¥è¿›è¡Œç‰¹å¾äº¤å‰ï¼ŒONNè®¤ä¸ºé’ˆå¯¹ä¸åŒçš„ç‰¹å¾äº¤å‰æ“ä½œï¼Œåº”è¯¥ç”¨ä¸åŒçš„Embeddingï¼Œå¦‚æœç”¨åŒæ ·çš„Embeddingï¼Œé‚£ä¹ˆå„ä¸ªä¸åŒæ“ä½œä¹‹é—´å°±ä¼šäº’ç›¸å½±å“è€Œæœ€ç»ˆé™åˆ¶äº†æ¨¡å‹çš„è¡¨è¾¾ã€‚\næˆ‘ä»¬ä¼šå‘ç°ONNçš„æ€è·¯åœ¨æœ¬è´¨ä¸Šå…¶å®å’ŒFFMã€AFMéƒ½æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œè¿™ä¸‰ä¸ªæ¨¡å‹éƒ½æ˜¯é€šè¿‡å¼•å…¥äº†é¢å¤–çš„ä¿¡æ¯æ¥åŒºåˆ†ä¸åŒfieldä¹‹é—´çš„äº¤å‰åº”è¯¥å…·å¤‡ä¸åŒçš„ä¿¡æ¯è¡¨è¾¾ã€‚æ€»ç»“ä¸‹æ¥ï¼š\nFFMï¼šå¼•å…¥Field-awareï¼Œå¯¹äºfield aæ¥è¯´ï¼Œä¸field bäº¤å‰å’Œfield cäº¤å‰åº”è¯¥ç”¨ä¸åŒçš„embedding AFMï¼šå¼•å…¥Attentionæœºåˆ¶ï¼Œaä¸bçš„äº¤å‰ç‰¹å¾é‡è¦åº¦ä¸aä¸cçš„äº¤å‰é‡è¦åº¦ä¸åŒ ONNï¼šå¼•å…¥Operation-awareï¼Œaä¸bè¿›è¡Œå†…ç§¯æ‰€ç”¨çš„embeddingï¼Œä¸åŒäºaä¸bè¿›è¡Œå¤–ç§¯ç”¨çš„embedding å¯¹æ¯”ä¸Šé¢ä¸‰ä¸ªæ¨¡å‹ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ç»™æ¨¡å‹å¢åŠ æ›´å¤šçš„è¡¨è¾¾èƒ½åŠ›ï¼Œä¸ªäººè§‰å¾—ONNå°±æ˜¯FFMä¸NNçš„ç»“åˆã€‚\næ¨¡å‹ç»“æ„ï¼š\nONNæ²¿è¢­äº†Embedding+MLPç»“æ„ã€‚åœ¨Embeddingå±‚é‡‡ç”¨Operation-aware Embeddingï¼Œå¯ä»¥çœ‹åˆ°å¯¹äºä¸€ä¸ªfeatureï¼Œä¼šå¾—åˆ°å¤šä¸ªembeddingç»“æœï¼›åœ¨å›¾ä¸­ä»¥çº¢è‰²è™šçº¿ä¸ºåˆ†å‰²ï¼Œç¬¬ä¸€åˆ—çš„embeddingæ˜¯featureæœ¬èº«çš„embeddingä¿¡æ¯ï¼Œä»ç¬¬äºŒåˆ—å¼€å§‹å¾€åæ˜¯å½“å‰ç‰¹å¾ä¸ç¬¬nä¸ªç‰¹å¾äº¤å‰æ‰€ä½¿ç”¨çš„embeddingã€‚\nåœ¨Embedding featureså±‚ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åŒ…å«äº†ä¸¤éƒ¨åˆ†ï¼š\nå·¦ä¾§éƒ¨åˆ†ä¸ºæ¯ä¸ªç‰¹å¾æœ¬èº«çš„embeddingä¿¡æ¯ï¼Œå…¶ä»£è¡¨äº†ä¸€é˜¶ç‰¹å¾ä¿¡æ¯ å³ä¾§éƒ¨åˆ†æ˜¯ä¸FFMç›¸åŒçš„äºŒé˜¶äº¤å‰ç‰¹å¾éƒ¨åˆ† è¿™ä¸¤éƒ¨åˆ†concatä¹‹åæ¥å…¥MLPå¾—åˆ°æœ€åçš„é¢„æµ‹ç»“æœã€‚\nä¼˜åŠ¿ï¼š\nå¼•å…¥Operation-awareï¼Œè¿›ä¸€æ­¥å¢åŠ äº†æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ› åŒæ—¶åŒ…å«äº†ç‰¹å¾ä¸€é˜¶ä¿¡æ¯ä¸é«˜é˜¶äº¤å‰ä¿¡æ¯ ä¸è¶³ï¼š\næ¨¡å‹å¤æ‚åº¦ç›¸å¯¹è¾ƒé«˜ï¼Œæ¯ä¸ªfeatureå¯¹åº”å¤šä¸ªembeddingç»“æœ äº”. åŒè·¯å¹¶è¡Œçš„æ¨¡å‹ç»„åˆ è¿™ä¸€éƒ¨åˆ†å°†ä»‹ç»åŒè·¯å¹¶è¡Œçš„æ¨¡å‹ç»“æ„ï¼Œä¹‹æ‰€ä»¥ç§°ä¸ºåŒè·¯å¹¶è¡Œï¼Œæ˜¯å› ä¸ºåœ¨è¿™ä¸€éƒ¨åˆ†çš„æ¨¡å‹ä¸­ï¼Œä»¥Wide\u0026amp;Deepå’ŒDeepFMä¸ºä»£è¡¨çš„æ¨¡å‹æ¶æ„éƒ½æ˜¯é‡‡ç”¨äº†åŒè·¯çš„ç»“æ„ã€‚ä¾‹å¦‚Wide\u0026amp;Deepçš„å·¦è·¯ä¸ºEmbedding+MLPï¼Œå³è·¯ä¸ºCross Feature LRï¼›DeepFMçš„å·¦è·¯ä¸ºFMï¼Œå³è·¯ä¸ºEmbedding+MLPã€‚è¿™ç±»æ¨¡å‹é€šè¿‡ä½¿ç”¨ä¸åŒçš„æ¨¡å‹è¿›è¡Œè”åˆè®­ç»ƒï¼Œä¸åŒå­æ¨¡å‹ä¹‹é—´äº’ç›¸å¼¥è¡¥ï¼Œå¢åŠ æ•´ä¸ªæ¨¡å‹ä¿¡æ¯è¡¨è¾¾å’Œå­¦ä¹ çš„å¤šæ ·æ€§ã€‚\nï¼ˆ1ï¼‰WDLï¼šWide and Deep Learning, 2016 â€”â€” Memorizationä¸Generalizationçš„ä¿¡æ¯äº’è¡¥ Wide And Deepæ˜¯2016å¹´Googleæå‡ºçš„ç”¨äºGoogle Play appæ¨èä¸šåŠ¡çš„ä¸€ç§ç®—æ³•ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡ç»“åˆWideçº¿æ€§æ¨¡å‹çš„è®°å¿†æ€§ï¼ˆmemorizationï¼‰å’ŒDeepæ·±åº¦æ¨¡å‹çš„æ³›åŒ–æ€§ï¼ˆgeneralizationï¼‰æ¥å¯¹ç”¨æˆ·è¡Œä¸ºä¿¡æ¯è¿›è¡Œå­¦ä¹ å»ºæ¨¡ã€‚\næ¨¡å‹ç»“æ„ï¼š\nä¼˜åŠ¿ï¼š\nWideå±‚ä¸Deepå±‚äº’è¡¥äº’åˆ©ï¼ŒDeepå±‚å¼¥è¡¥Memorizationå±‚æ³›åŒ–æ€§ä¸è¶³çš„é—®é¢˜ wideå’Œdeepçš„joint trainingå¯ä»¥å‡å°wideéƒ¨åˆ†çš„model sizeï¼ˆå³åªéœ€è¦å°‘æ•°çš„äº¤å‰ç‰¹å¾ï¼‰ å¯ä»¥åŒæ—¶å­¦ä¹ ä½é˜¶ç‰¹å¾äº¤å‰ï¼ˆwideéƒ¨åˆ†ï¼‰å’Œé«˜é˜¶ç‰¹å¾äº¤å‰ï¼ˆdeepéƒ¨åˆ†ï¼‰ ä¸è¶³ï¼š ä»éœ€è¦æ‰‹åŠ¨è®¾è®¡äº¤å‰ç‰¹å¾ ï¼ˆ2ï¼‰DeepFMï¼šDeep Factorization Machines, 2017 â€”â€” FMåŸºç¡€ä¸Šå¼•å…¥NNéšå¼é«˜é˜¶äº¤å‰ä¿¡æ¯ æˆ‘ä»¬çŸ¥é“FMåªèƒ½å¤Ÿå»æ˜¾å¼åœ°æ•æ‰äºŒé˜¶äº¤å‰ä¿¡æ¯ï¼Œè€Œå¯¹äºé«˜é˜¶çš„ç‰¹å¾ç»„åˆå´æ— èƒ½ä¸ºåŠ›ã€‚DeepFMå°±æ˜¯åœ¨FMæ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œå¢åŠ DNNéƒ¨åˆ†ï¼Œè¿›è€Œæé«˜æ¨¡å‹å¯¹äºé«˜é˜¶ç»„åˆç‰¹å¾çš„ä¿¡æ¯æå–ã€‚DeepFMèƒ½å¤Ÿåšåˆ°ç«¯åˆ°ç«¯çš„ã€è‡ªåŠ¨çš„è¿›è¡Œé«˜é˜¶ç‰¹å¾ç»„åˆï¼Œå¹¶ä¸”ä¸éœ€è¦äººå·¥å¹²é¢„ã€‚\næ¨¡å‹ç»“æ„ï¼š\nDeepFMåŒ…å«äº†FMå’ŒNNä¸¤éƒ¨åˆ†ï¼Œè¿™ä¸¤éƒ¨åˆ†å…±äº«äº†Embeddingå±‚ï¼š\nå·¦ä¾§FMéƒ¨åˆ†å°±æ˜¯2-wayçš„FMï¼šåŒ…å«äº†çº¿æ€§éƒ¨åˆ†å’ŒäºŒé˜¶äº¤å‰éƒ¨åˆ†å³ä¾§NNéƒ¨åˆ†ä¸FMå…±äº«Embeddingï¼Œå°†æ‰€æœ‰ç‰¹å¾çš„embeddingè¿›è¡Œconcatä¹‹åä½œä¸ºNNéƒ¨åˆ†çš„è¾“å…¥ï¼Œæœ€ç»ˆé€šè¿‡NNå¾—åˆ°ã€‚\nä¼˜åŠ¿ï¼š\næ¨¡å‹å…·å¤‡åŒæ—¶å­¦ä¹ ä½é˜¶ä¸é«˜é˜¶ç‰¹å¾çš„èƒ½åŠ› å…±äº«embeddingå±‚ï¼Œå…±äº«äº†ç‰¹å¾çš„ä¿¡æ¯è¡¨è¾¾ ä¸è¶³ï¼š\nDNNéƒ¨åˆ†å¯¹äºé«˜é˜¶ç‰¹å¾çš„å­¦ä¹ ä»ç„¶æ˜¯éšå¼çš„ å‚è€ƒ:\nhttps://wqw547243068.github.io/2020/08/02/CTR/ https://zhuanlan.zhihu.com/p/35465875 CTR é¢„ä¼°æ¨¡å‹çš„è¿›åŒ–ä¹‹è·¯ ","permalink":"https://reid00.github.io/en/posts/ml/ctr%E5%8F%91%E5%B1%95/","summary":"ç®€ä»‹ åœ¨æ¨èã€æœç´¢ã€å¹¿å‘Šç­‰é¢†åŸŸï¼ŒCTRï¼ˆclick-through rateï¼‰é¢„ä¼°æ˜¯ä¸€é¡¹éå¸¸æ ¸å¿ƒçš„æŠ€æœ¯ï¼Œè¿™é‡Œå¼•ç”¨é˜¿é‡Œå¦ˆå¦ˆèµ„æ·±ç®—æ³•ä¸“å®¶æœ±å°å¼ºå¤§ä½¬çš„ä¸€å¥è¯ï¼šâ€œå®ƒï¼ˆCTRé¢„ä¼°ï¼‰æ˜¯é•¶åµŒåœ¨äº’è”ç½‘æŠ€æœ¯ä¸Šçš„æ˜ç â€ã€‚\næœ¬ç¯‡æ–‡ç« ä¸»è¦æ˜¯å¯¹CTRé¢„ä¼°ä¸­çš„å¸¸è§æ¨¡å‹è¿›è¡Œæ¢³ç†ä¸æ€»ç»“ï¼Œå¹¶åˆ†æˆæ¨¡å—è¿›è¡Œæ¦‚è¿°ã€‚æ¯ä¸ªæ¨¡å‹éƒ½ä¼šä»ã€Œæ¨¡å‹ç»“æ„ã€ã€ã€Œä¼˜åŠ¿ã€ã€ã€Œä¸è¶³ã€ä¸‰ä¸ªæ–¹é¢è¿›è¡Œæ¢è®¨ï¼Œåœ¨æœ€åå¯¹æ‰€æœ‰æ¨¡å‹ä¹‹é—´çš„å…³ç³»è¿›è¡Œæ¯”è¾ƒä¸æ€»ç»“ã€‚æœ¬ç¯‡æ–‡ç« è®¨è®ºçš„æ¨¡å‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆåŸåˆ›å›¾ï¼‰ï¼Œè¿™ä¸ªå›¾ä¸­å±•ç¤ºäº†æœ¬ç¯‡æ–‡ç« æ‰€è¦è®²è¿°çš„ç®—æ³•ä»¥åŠä¹‹é—´çš„å…³ç³»ï¼Œåœ¨æ–‡ç« çš„æœ€åæ€»ç»“ä¼šå¯¹è¿™å¼ å›¾è¿›è¡Œè¯¦ç»†åœ°è¯´æ˜ã€‚\nä¸€. åˆ†å¸ƒå¼çº¿æ€§æ¨¡å‹ Logistic Regression Logistic Regressionæ˜¯æ¯ä¸€ä½ç®—æ³•å·¥ç¨‹å¸ˆå†ä¹Ÿç†Ÿæ‚‰ä¸è¿‡çš„åŸºæœ¬ç®—æ³•ä¹‹ä¸€äº†ï¼Œæ¯«ä¸å¤¸å¼ åœ°è¯´ï¼ŒLRä½œä¸ºæœ€ç»å…¸çš„ç»Ÿè®¡å­¦ä¹ ç®—æ³•å‡ ä¹ç»Ÿæ²»äº†æ—©æœŸå·¥ä¸šæœºå™¨å­¦ä¹ æ—¶ä»£ã€‚è¿™æ˜¯å› ä¸ºå…¶å…·å¤‡ç®€å•ã€æ—¶é—´å¤æ‚åº¦ä½ã€å¯å¤§è§„æ¨¡å¹¶è¡ŒåŒ–ç­‰ä¼˜è‰¯ç‰¹æ€§ã€‚åœ¨æ—©æœŸçš„CTRé¢„ä¼°ä¸­ï¼Œç®—æ³•å·¥ç¨‹å¸ˆä»¬é€šè¿‡æ‰‹åŠ¨è®¾è®¡äº¤å‰ç‰¹å¾ä»¥åŠç‰¹å¾ç¦»æ•£åŒ–ç­‰æ–¹å¼ï¼Œèµ‹äºˆLRè¿™æ ·çš„çº¿æ€§æ¨¡å‹å¯¹æ•°æ®é›†çš„éçº¿æ€§å­¦ä¹ èƒ½åŠ›ï¼Œé«˜ç»´ç¦»æ•£ç‰¹å¾+æ‰‹åŠ¨äº¤å‰ç‰¹å¾æ„æˆäº†CTRé¢„ä¼°çš„åŸºç¡€ç‰¹å¾ã€‚LRåœ¨å·¥ç¨‹ä¸Šæ˜“äºå¤§è§„æ¨¡å¹¶è¡ŒåŒ–è®­ç»ƒæ°æ°é€‚åº”äº†è¿™ä¸ªæ—¶ä»£çš„è¦æ±‚ã€‚\næ¨¡å‹ç»“æ„ï¼š\nä¼˜åŠ¿ï¼š\næ¨¡å‹ç®€å•ï¼Œå…·å¤‡ä¸€å®šå¯è§£é‡Šæ€§ è®¡ç®—æ—¶é—´å¤æ‚åº¦ä½ å·¥ç¨‹ä¸Šå¯å¤§è§„æ¨¡å¹¶è¡ŒåŒ– ä¸è¶³ï¼š\nä¾èµ–äºäººå·¥å¤§é‡çš„ç‰¹å¾å·¥ç¨‹ï¼Œä¾‹å¦‚éœ€è¦æ ¹æ®ä¸šåŠ¡èƒŒçŸ¥è¯†é€šè¿‡ç‰¹å¾å·¥ç¨‹èå…¥æ¨¡å‹ ç‰¹å¾äº¤å‰éš¾ä»¥ç©·å°½ å¯¹äºè®­ç»ƒé›†ä¸­æ²¡æœ‰å‡ºç°çš„äº¤å‰ç‰¹å¾æ— æ³•è¿›è¡Œå‚æ•°å­¦ä¹  äºŒ. è‡ªåŠ¨åŒ–ç‰¹å¾å·¥ç¨‹ GBDT + LRï¼ˆ2014ï¼‰â€”â€” ç‰¹å¾è‡ªåŠ¨åŒ–æ—¶ä»£çš„åˆæ¢ç´¢ Facebookåœ¨2014å¹´æå‡ºäº†GBDT+LRçš„ç»„åˆæ¨¡å‹æ¥è¿›è¡ŒCTRé¢„ä¼°ï¼Œå…¶æœ¬è´¨ä¸Šæ˜¯é€šè¿‡Boosting Treeæ¨¡å‹æœ¬èº«çš„ç‰¹å¾ç»„åˆèƒ½åŠ›æ¥æ›¿ä»£åŸå…ˆç®—æ³•å·¥ç¨‹å¸ˆä»¬æ‰‹åŠ¨ç»„åˆç‰¹å¾çš„è¿‡ç¨‹ã€‚GBDTç­‰è¿™ç±»Boosting Treeæ¨¡å‹æœ¬èº«å…·å¤‡äº†ç‰¹å¾ç­›é€‰èƒ½åŠ›ï¼ˆæ¯æ¬¡åˆ†è£‚é€‰å–å¢ç›Šæœ€å¤§çš„åˆ†è£‚ç‰¹å¾ä¸åˆ†è£‚ç‚¹ï¼‰ä»¥åŠé«˜é˜¶ç‰¹å¾ç»„åˆèƒ½åŠ›ï¼ˆæ ‘æ¨¡å‹å¤©ç„¶ä¼˜åŠ¿ï¼‰å¯¹åº”æ ‘çš„ä¸€æ¡è·¯å¾„ï¼ˆç”¨å¶å­èŠ‚ç‚¹æ¥è¡¨ç¤ºï¼‰ï¼Œå› æ­¤é€šè¿‡GBDTæ¥è‡ªåŠ¨ç”Ÿæˆç‰¹å¾å‘é‡å°±æˆäº†ä¸€ä¸ªéå¸¸è‡ªç„¶çš„æ€è·¯ã€‚æ³¨æ„è¿™é‡Œè™½ç„¶æ˜¯ä¸¤ä¸ªæ¨¡å‹çš„ç»„åˆï¼Œä½†å®é™…å¹¶éæ˜¯ç«¯åˆ°ç«¯çš„æ¨¡å‹ï¼Œè€Œæ˜¯ä¸¤é˜¶æ®µçš„ã€è§£è€¦çš„ï¼Œå³å…ˆé€šè¿‡GBDTè®­ç»ƒå¾—åˆ°ç‰¹å¾å‘é‡åï¼Œå†ä½œä¸ºä¸‹æ¸¸LRçš„è¾“å…¥ï¼ŒLRçš„åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¹¶ä¸ä¼šå¯¹GBDTè¿›è¡Œæ›´æ–°ã€‚\næ¨¡å‹ç»“æ„ï¼š\né€šè¿‡GBDTè®­ç»ƒæ¨¡å‹ï¼Œå¾—åˆ°ç»„åˆçš„ç‰¹å¾å‘é‡ã€‚ä¾‹å¦‚è®­ç»ƒäº†ä¸¤æ£µæ ‘ï¼Œæ¯æ£µæ ‘æœ‰5ä¸ªå¶å­ç»“ç‚¹ï¼Œå¯¹äºæŸä¸ªç‰¹å®šæ ·æœ¬æ¥è¯´ï¼Œè½åœ¨äº†ç¬¬ä¸€æ£µæ ‘çš„ç¬¬3ä¸ªç»“ç‚¹ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥å¾—åˆ°å‘é‡ ï¼›è½åœ¨ç¬¬äºŒæ£µæ ‘çš„ç¬¬4ä¸ªç»“ç‚¹ï¼Œæ­¤æ—¶çš„åˆ°å‘é‡ ï¼›é‚£ä¹ˆæœ€ç»ˆé€šè¿‡concatæ‰€æœ‰æ ‘çš„å‘é‡ï¼Œå¾—åˆ°è¿™ä¸ªæ ·æœ¬çš„æœ€ç»ˆå‘é‡ ã€‚å°†è¿™ä¸ªå‘é‡ä½œä¸ºä¸‹æ¸¸LRæ¨¡å‹çš„inputsï¼Œè¿›è¡Œè®­ç»ƒã€‚\nä¼˜åŠ¿ï¼š\nç‰¹å¾å·¥ç¨‹è‡ªåŠ¨åŒ–ï¼Œé€šè¿‡Boosting Treeæ¨¡å‹çš„å¤©ç„¶ä¼˜åŠ¿è‡ªåŠ¨æ¢ç´¢ç‰¹å¾ç»„åˆ ä¸è¶³ï¼š\nä¸¤é˜¶æ®µçš„ã€éç«¯åˆ°ç«¯çš„æ¨¡å‹ CTRé¢„ä¼°åœºæ™¯æ¶‰åŠåˆ°å¤§é‡é«˜ç»´ç¨€ç–ç‰¹å¾ï¼Œæ ‘æ¨¡å‹å¹¶ä¸é€‚åˆå¤„ç†ï¼ˆå› æ­¤å®é™…ä¸Šä¼šå°†denseç‰¹å¾æˆ–è€…ä½ç»´çš„ç¦»æ•£ç‰¹å¾ç»™GBDTï¼Œå‰©ä½™é«˜ç»´ç¨€ç–ç‰¹å¾åœ¨LRé˜¶æ®µè¿›è¡Œè®­ç»ƒï¼‰ GBDTæ¨¡å‹æœ¬èº«æ¯”è¾ƒå¤æ‚ï¼Œæ— æ³•åšåˆ°online learningï¼Œæ¨¡å‹å¯¹æ•°æ®çš„æ„ŸçŸ¥ç›¸å¯¹è¾ƒæ»åï¼ˆå¿…é¡»æé«˜ç¦»çº¿æ¨¡å‹çš„æ›´æ–°é¢‘ç‡ï¼‰ ç”±äºLRå–„äºå¤„ç†ç¦»æ•£ç‰¹å¾ï¼ŒGBDTå–„äºå¤„ç†è¿ç»­ç‰¹å¾ã€‚æ‰€ä»¥ä¹Ÿå¯ä»¥äº¤ç”±GBDTå¤„ç†è¿ç»­ç‰¹å¾ï¼Œè¾“å‡ºç»“æœæ‹¼æ¥ä¸Šç¦»æ•£ç‰¹å¾ä¸€èµ·è¾“å…¥LRã€‚\nä¸‰. FMæ¨¡å‹ä»¥åŠå˜ä½“ ï¼ˆ1ï¼‰FMï¼šFactorization Machines, 2010 â€”â€” éšå‘é‡å­¦ä¹ æå‡æ¨¡å‹è¡¨è¾¾ FMæ˜¯åœ¨2010å¹´æå‡ºçš„ä¸€ç§å¯ä»¥å­¦ä¹ äºŒé˜¶ç‰¹å¾äº¤å‰çš„æ¨¡å‹ï¼Œé€šè¿‡åœ¨åŸå…ˆçº¿æ€§æ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œæšä¸¾äº†æ‰€æœ‰ç‰¹å¾çš„äºŒé˜¶äº¤å‰ä¿¡æ¯åèå…¥æ¨¡å‹ï¼Œæé«˜äº†æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚ä½†ä¸åŒçš„æ˜¯ï¼Œæ¨¡å‹åœ¨äºŒé˜¶äº¤å‰ä¿¡æ¯çš„æƒé‡å­¦ä¹ ä¸Šï¼Œé‡‡ç”¨äº†éšå‘é‡å†…ç§¯ï¼ˆä¹Ÿå¯çœ‹åšembeddingï¼‰çš„æ–¹å¼è¿›è¡Œå­¦ä¹ ã€‚\nFMå’ŒåŸºäºæ ‘çš„æ¨¡å‹ï¼ˆe.g. GBDTï¼‰éƒ½èƒ½å¤Ÿè‡ªåŠ¨å­¦ä¹ ç‰¹å¾äº¤å‰ç»„åˆã€‚åŸºäºæ ‘çš„æ¨¡å‹é€‚åˆè¿ç»­ä¸­ä½åº¦ç¨€ç–æ•°æ®ï¼Œå®¹æ˜“å­¦åˆ°é«˜é˜¶ç»„åˆã€‚ä½†æ˜¯æ ‘æ¨¡å‹å´ä¸é€‚åˆå­¦ä¹ é«˜åº¦ç¨€ç–æ•°æ®çš„ç‰¹å¾ç»„åˆï¼Œä¸€æ–¹é¢é«˜åº¦ç¨€ç–æ•°æ®çš„ç‰¹å¾ç»´åº¦ä¸€èˆ¬å¾ˆé«˜ï¼Œè¿™æ—¶åŸºäºæ ‘çš„æ¨¡å‹å­¦ä¹ æ•ˆç‡å¾ˆä½ï¼Œç”šè‡³ä¸å¯è¡Œï¼›å¦ä¸€æ–¹é¢æ ‘æ¨¡å‹ä¹Ÿä¸èƒ½å­¦ä¹ åˆ°è®­ç»ƒæ•°æ®ä¸­å¾ˆå°‘æˆ–æ²¡æœ‰å‡ºç°çš„ç‰¹å¾ç»„åˆã€‚ç›¸åï¼ŒFMæ¨¡å‹å› ä¸ºé€šè¿‡éšå‘é‡çš„å†…ç§¯æ¥æå–ç‰¹å¾ç»„åˆï¼Œå¯¹äºè®­ç»ƒæ•°æ®ä¸­å¾ˆå°‘æˆ–æ²¡æœ‰å‡ºç°çš„ç‰¹å¾ç»„åˆä¹Ÿèƒ½å¤Ÿå­¦ä¹ åˆ°ã€‚ä¾‹å¦‚ï¼Œç‰¹å¾ å’Œç‰¹å¾ åœ¨è®­ç»ƒæ•°æ®ä¸­ä»æ¥æ²¡æœ‰æˆå¯¹å‡ºç°è¿‡ï¼Œä½†ç‰¹å¾ ç»å¸¸å’Œç‰¹å¾ æˆå¯¹å‡ºç°ï¼Œç‰¹å¾ ä¹Ÿç»å¸¸å’Œç‰¹å¾ æˆå¯¹å‡ºç°ï¼Œå› è€Œåœ¨FMæ¨¡å‹ä¸­ç‰¹å¾ å’Œç‰¹å¾ ä¹Ÿä¼šæœ‰ä¸€å®šçš„ç›¸å…³æ€§ã€‚æ¯•ç«Ÿæ‰€æœ‰åŒ…å«ç‰¹å¾ çš„è®­ç»ƒæ ·æœ¬éƒ½ä¼šå¯¼è‡´æ¨¡å‹æ›´æ–°ç‰¹å¾ çš„éšå‘é‡ ï¼ŒåŒç†ï¼Œæ‰€æœ‰åŒ…å«ç‰¹å¾ çš„æ ·æœ¬ä¹Ÿä¼šå¯¼è‡´æ¨¡å‹æ›´æ–°éšå‘é‡ ï¼Œè¿™æ · å°±ä¸å¤ªå¯èƒ½ä¸º0ã€‚\næ¨¡å‹ç»“æ„ï¼š\nFMçš„å…¬å¼åŒ…å«äº†ä¸€é˜¶çº¿æ€§éƒ¨åˆ†ä¸äºŒé˜¶ç‰¹å¾äº¤å‰éƒ¨åˆ†ï¼š\nåœ¨LRä¸­ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡æ‰‹åŠ¨æ„é€ äº¤å‰ç‰¹å¾åï¼Œå–‚ç»™æ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œä¾‹å¦‚æˆ‘ä»¬æ„é€ æ€§åˆ«ä¸å¹¿å‘Šç±»åˆ«çš„äº¤å‰ç‰¹å¾ï¼š (gender=â€™å¥³â€™ \u0026amp; ad_category=â€™ç¾å¦†â€™)ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¼šé’ˆå¯¹è¿™ä¸ªäº¤å‰ç‰¹å¾å­¦ä¹ ä¸€ä¸ªå‚æ•° ã€‚ä½†æ˜¯åœ¨LRä¸­ï¼Œå‚æ•°æ¢¯åº¦æ›´æ–°å…¬å¼ä¸è¯¥ç‰¹å¾å–å€¼ å…³ç³»å¯†åˆ‡ï¼š ï¼Œå½“ å–å€¼ä¸º0æ—¶ï¼Œå‚æ•° å°±æ— æ³•å¾—åˆ°æ›´æ–°ï¼Œè€Œ è¦éé›¶å°±è¦æ±‚äº¤å‰ç‰¹å¾çš„ä¸¤é¡¹éƒ½è¦éé›¶ï¼Œä½†å®é™…åœ¨æ•°æ®é«˜åº¦ç¨€ç–ï¼Œä¸€æ—¦ä¸¤ä¸ªç‰¹å¾åªè¦æœ‰ä¸€ä¸ªå–0ï¼Œå‚æ•° ä¸èƒ½å¾—åˆ°æœ‰æ•ˆæ›´æ–°ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äºè®­ç»ƒé›†ä¸­æ²¡æœ‰å‡ºç°çš„äº¤å‰ç‰¹å¾ï¼Œä¹Ÿæ²¡åŠæ³•å­¦ä¹ è¿™ç±»æƒé‡ï¼Œæ³›åŒ–æ€§èƒ½ä¸å¤Ÿå¥½ã€‚","title":"CTRå‘å±•"},{"content":"ä»‹ç» FMå’ŒFMMæ¨¡å‹åœ¨æ•°æ®é‡æ¯”è¾ƒå¤§å¹¶ä¸”ç‰¹å¾ç¨€ç–çš„æƒ…å†µä¸‹ï¼Œä»ç„¶æœ‰ä¼˜ç§€çš„æ€§èƒ½è¡¨ç°ï¼Œåœ¨CTR/CVRä»»åŠ¡ä¸Šå°¤å…¶çªå‡ºã€‚\næœ¬æ–‡åŒ…æ‹¬ï¼š\n- FM æ¨¡å‹ - FFM æ¨¡å‹ - Deep FM æ¨¡å‹ - Deep FFMæ¨¡å‹ FMæ¨¡å‹çš„å¼•å…¥-å¹¿å‘Šç‰¹å¾çš„ç¨€ç–æ€§ FMï¼ˆFactorization machinesï¼‰æ¨¡å‹ç”±Steffen Rendleäº2010å¹´æå‡ºï¼Œç›®çš„æ˜¯è§£å†³ç¨€ç–æ•°æ®ä¸‹çš„ç‰¹å¾ç»„åˆé—®é¢˜ã€‚\nåœ¨ä»‹ç»FMæ¨¡å‹ä¹‹å‰ï¼Œæ¥çœ‹çœ‹ç¨€ç–æ•°æ®çš„è®­ç»ƒé—®é¢˜ã€‚\nä»¥å¹¿å‘ŠCTRï¼ˆclick-through rateï¼‰ç‚¹å‡»ç‡é¢„æµ‹ä»»åŠ¡ä¸ºä¾‹ï¼Œå‡è®¾æœ‰å¦‚ä¸‹æ•°æ®\nClicked? Country Day Ad_type 1 USA 26/11/15 Movie 0 China 19/2/15 Game 1 China 26/11/15 Game ç¬¬ä¸€åˆ—Clickedæ˜¯ç±»åˆ«æ ‡è®°ï¼Œæ ‡è®°ç”¨æˆ·æ˜¯å¦ç‚¹å‡»äº†è¯¥å¹¿å‘Šï¼Œè€Œå…¶ä½™åˆ—åˆ™æ˜¯ç‰¹å¾ï¼ˆè¿™é‡Œçš„ä¸‰ä¸ªç‰¹å¾éƒ½æ˜¯ç±»åˆ«ç±»å‹ï¼‰ï¼Œä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬ä¼šå¯¹æ•°æ®è¿›è¡ŒOne-hotç¼–ç å°†ç±»åˆ«ç‰¹å¾è½¬åŒ–ä¸ºæ•°å€¼ç‰¹å¾ï¼Œè½¬åŒ–åæ•°æ®å¦‚ä¸‹:\nClicked? Country=USA Country=China Day=26/11/15 Day=19/2/15 Ad_type=Movie Ad_type=Game 1 1 0 1 0 1 0 0 0 1 0 1 0 1 1 0 1 1 0 0 1 ç»è¿‡One-hotç¼–ç åï¼Œç‰¹å¾ç©ºé—´æ˜¯ååˆ†ç¨€ç–çš„ã€‚ç‰¹åˆ«çš„ï¼ŒæŸç±»åˆ«ç‰¹å¾æœ‰mç§ä¸åŒçš„å–å€¼ï¼Œåˆ™one-hotç¼–ç åå°±ä¼šè¢«å˜ä¸ºmç»´ï¼å½“ç±»åˆ«ç‰¹å¾è¶Šå¤šã€ç±»åˆ«ç‰¹å¾çš„å–å€¼è¶Šå¤šï¼Œå…¶ç‰¹å¾ç©ºé—´å°±æ›´åŠ ç¨€ç–ã€‚\næ­¤å¤–ï¼Œå¾€å¾€æˆ‘ä»¬ä¼šå°†ç‰¹å¾è¿›è¡Œä¸¤ä¸¤çš„ç»„åˆï¼Œè¿™æ˜¯å› ä¸ºï¼š\né€šè¿‡è§‚å¯Ÿå¤§é‡çš„æ ·æœ¬æ•°æ®å¯ä»¥å‘ç°ï¼ŒæŸäº›ç‰¹å¾ç»è¿‡å…³è”ä¹‹åï¼Œä¸labelä¹‹é—´çš„ç›¸å…³æ€§å°±ä¼šæé«˜ã€‚ä¾‹å¦‚ï¼Œâ€œUSAâ€ä¸â€œThanksgivingâ€ã€â€œChinaâ€ä¸â€œChinese New Yearâ€è¿™æ ·çš„å…³è”ç‰¹å¾ï¼Œå¯¹ç”¨æˆ·çš„ç‚¹å‡»æœ‰ç€æ­£å‘çš„å½±å“ã€‚æ¢å¥è¯è¯´ï¼Œæ¥è‡ªâ€œChinaâ€çš„ç”¨æˆ·å¾ˆå¯èƒ½ä¼šåœ¨â€œChinese New Yearâ€æœ‰å¤§é‡çš„æµè§ˆã€è´­ä¹°è¡Œä¸ºï¼Œè€Œåœ¨â€œThanksgivingâ€å´ä¸ä¼šæœ‰ç‰¹åˆ«çš„æ¶ˆè´¹è¡Œä¸ºã€‚è¿™ç§å…³è”ç‰¹å¾ä¸labelçš„æ­£å‘ç›¸å…³æ€§åœ¨å®é™…é—®é¢˜ä¸­æ˜¯æ™®éå­˜åœ¨çš„ï¼Œå¦‚â€œåŒ–å¦†å“â€ç±»å•†å“ä¸â€œå¥³â€æ€§ï¼Œâ€œçƒç±»è¿åŠ¨é…ä»¶â€çš„å•†å“ä¸â€œç”·â€æ€§ï¼Œâ€œç”µå½±ç¥¨â€çš„å•†å“ä¸â€œç”µå½±â€å“ç±»åå¥½ç­‰ã€‚\nå†æ¯”å¦‚ï¼Œç”¨æˆ·æ›´å¸¸åœ¨é¥­ç‚¹çš„æ—¶é—´ä¸‹è½½å¤–å–appï¼Œå› æ­¤ï¼Œå¼•å…¥ä¸¤ä¸ªç‰¹å¾çš„ç»„åˆæ˜¯éå¸¸æœ‰æ„ä¹‰çš„ã€‚\nå¦‚ä½•è¡¨ç¤ºä¸¤ä¸ªç‰¹å¾çš„ç»„åˆå‘¢ï¼Ÿä¸€ç§ç›´æ¥çš„æ–¹æ³•å°±æ˜¯é‡‡ç”¨å¤šé¡¹å¼æ¨¡å‹æ¥è¡¨ç¤ºä¸¤ä¸ªç‰¹å¾çš„ç»„åˆï¼Œxixiä¸ºç¬¬iiä¸ªç‰¹å¾çš„å–å€¼ï¼ˆæ³¨æ„å’Œä»¥å¾€è¡¨ç¤ºç¬¬iiä¸ªæ ·æœ¬çš„ç‰¹å¾å‘é‡çš„åŒºåˆ«ï¼‰ï¼Œxixjxixjè¡¨ç¤ºç‰¹å¾xixiå’Œxjxjçš„ç‰¹å¾ç»„åˆï¼Œå…¶ç³»æ•°wijwijå³ä¸ºæˆ‘ä»¬å­¦ä¹ çš„å‚æ•°ï¼Œä¹Ÿæ˜¯xixjxixjç»„åˆçš„é‡è¦ç¨‹åº¦ï¼š\nå¼1-1ä¹Ÿå¯ä»¥ç§°ä¸ºPoly2(degree-2 poly-nomial mappings)æ¨¡å‹ã€‚æ³¨æ„åˆ°å¼å­1-1ä¸­å‚æ•°çš„ä¸ªæ•°æ˜¯éå¸¸å¤šçš„ï¼ä¸€æ¬¡é¡¹æœ‰d+1ä¸ªï¼ŒäºŒæ¬¡é¡¹ï¼ˆå³ç»„åˆç‰¹å¾çš„å‚æ•°ï¼‰å…±æœ‰d(dâˆ’1)2d(dâˆ’1)2ä¸ªï¼Œè€Œå‚æ•°ä¸å‚æ•°ä¹‹é—´å½¼æ­¤ç‹¬ç«‹ï¼Œåœ¨ç¨€ç–åœºæ™¯ä¸‹ï¼ŒäºŒæ¬¡é¡¹çš„è®­ç»ƒæ˜¯å¾ˆå›°éš¾çš„ã€‚å› ä¸ºè¦è®­ç»ƒwijwijï¼Œéœ€è¦æœ‰å¤§é‡çš„xixiå’Œxjxjéƒ½éé›¶çš„æ ·æœ¬ï¼ˆåªæœ‰éé›¶ç»„åˆæ‰æœ‰æ„ä¹‰ï¼‰ã€‚è€Œæ ·æœ¬æœ¬èº«æ˜¯ç¨€ç–çš„ï¼Œæ»¡è¶³xixjâ‰ 0xixjâ‰ 0çš„æ ·æœ¬ä¼šéå¸¸å°‘ï¼Œæ ·æœ¬å°‘åˆ™éš¾ä»¥ä¼°è®¡å‚æ•°wijwijï¼Œè®­ç»ƒå‡ºæ¥å®¹æ˜“å¯¼è‡´æ¨¡å‹çš„è¿‡æ‹Ÿåˆã€‚\nä¸ºæ­¤ï¼ŒRendleäº2010å¹´æå‡ºFMæ¨¡å‹ï¼Œå®ƒèƒ½å¾ˆå¥½çš„æ±‚è§£å¼1-1ï¼Œå…¶ç‰¹ç‚¹å¦‚ä¸‹ï¼š\nFMæ¨¡å‹å¯ä»¥åœ¨éå¸¸ç¨€ç–çš„æƒ…å†µä¸‹è¿›è¡Œå‚æ•°ä¼°è®¡ FMæ¨¡å‹æ˜¯çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨åŸé—®é¢˜è¿›è¡Œæ±‚è§£ï¼Œè€Œä¸”ä¸ç”¨åƒSVMä¸€æ ·ä¾èµ–æ”¯æŒå‘é‡ã€‚ FMæ¨¡å‹æ˜¯ä¸€ä¸ªé€šç”¨çš„æ¨¡å‹ï¼Œå…¶è®­ç»ƒæ•°æ®çš„ç‰¹å¾å–å€¼å¯ä»¥æ˜¯ä»»æ„å®æ•°ã€‚è€Œå…¶å®ƒæœ€å…ˆè¿›çš„åˆ†è§£æ¨¡å‹å¯¹è¾“å…¥æ•°æ®æœ‰ä¸¥æ ¼çš„é™åˆ¶ã€‚FMså¯ä»¥æ¨¡æ‹ŸMFã€SVD++ã€PITFæˆ–FPMCæ¨¡å‹ã€‚ FMæ¨¡å‹ å‰é¢æåˆ°è¿‡ï¼Œå¼1-1çš„å‚æ•°éš¾ä»¥è®­ç»ƒæ—¶å› ä¸ºè®­ç»ƒæ•°æ®çš„ç¨€ç–æ€§ã€‚å¯¹äºä¸åŒçš„ç‰¹å¾å¯¹xi,xjxi,xjå’Œxi,xkxi,xkï¼Œå¼1-1è®¤ä¸ºæ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œå¯¹å‚æ•°wijwijå’Œwikwikåˆ†åˆ«è¿›è¡Œè®­ç»ƒã€‚è€Œå®é™…ä¸Šå¹¶éå¦‚æ­¤ï¼Œä¸åŒçš„ç‰¹å¾ä¹‹é—´è¿›è¡Œç»„åˆå¹¶éå®Œå…¨ç‹¬ç«‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:\nå›æƒ³çŸ©é˜µåˆ†è§£ï¼Œä¸€ä¸ªratingå¯ä»¥åˆ†è§£ä¸ºuserçŸ©é˜µå’ŒitemçŸ©é˜µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nåˆ†è§£åå¾—åˆ°userå’ŒitemçŸ©é˜µçš„ç»´åº¦åˆ†åˆ«ä¸ºnknkå’Œkmkmï¼Œï¼ˆkä¸€èˆ¬ç”±ç”¨æˆ·æŒ‡å®šï¼‰ï¼Œç›¸æ¯”åŸæ¥çš„ratingçŸ©é˜µï¼Œç©ºé—´å ç”¨å¾—åˆ°é™ä½ï¼Œå¹¶ä¸”åˆ†è§£åçš„userçŸ©é˜µæš—å«ç€useråå¥½ï¼ŒItemçŸ©é˜µæš—å«ç€itemçš„å±æ€§ï¼Œè€ŒuserçŸ©é˜µä¹˜ä¸ŠitemçŸ©é˜µå°±æ˜¯ratingçŸ©é˜µä¸­ç”¨æˆ·å¯¹itemçš„è¯„åˆ†ã€‚\nå› æ­¤ï¼Œå‚è€ƒçŸ©é˜µåˆ†è§£çš„è¿‡ç¨‹ï¼ŒFMæ¨¡å‹ä¹Ÿå°†å¼1-1çš„äºŒæ¬¡é¡¹å‚æ•°wijwijè¿›è¡Œåˆ†è§£:\nå…¶ä¸­viviæ˜¯ç¬¬iiç»´ç‰¹å¾çš„éšå‘é‡ï¼Œå…¶é•¿åº¦ä¸ºk(kâ‰ªd)k(kâ‰ªd)ã€‚ (viâ‹…vj)(viâ‹…vj)ä¸ºå†…ç§¯ï¼Œå…¶ä¹˜ç§¯ä¸ºåŸæ¥çš„wijwijï¼Œå³ ^wij=(viâ‹…vj)=âˆ‘kf=1vi,fâ‹…vj,fw^ij=(viâ‹…vj)=âˆ‘f=1kvi,fâ‹…vj,f\nä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œè€ƒè™‘ä¸‹é¢çš„æ•°æ®é›†ï¼ˆå®é™…ä¸­åº”è¯¥è¿›è¡Œone-hotç¼–ç ï¼Œä½†å¹¶ä¸å½±å“æ­¤å¤„çš„è¯´æ˜ï¼‰ï¼š\næ•°æ®é›† Clicked? Publisher Advertiser Poly2å‚æ•° FMå‚æ•° è®­ç»ƒé›† 1 NBC Nike wNBC,NikewNBC,Nike VNBCâ‹…VNikeVNBCâ‹…VNike è®­ç»ƒé›† 0 EPSN Adidas wEPSN,AdidaswEPSN,Adidas VEPSNâ‹…VAdidasVEPSNâ‹…VAdidas æµ‹è¯•é›† ? NBC Adidas wNBC,AdidaswNBC,Adidas VNBCâ‹…VAdidas å¯¹äºä¸Šé¢çš„è®­ç»ƒé›†ï¼Œæ²¡æœ‰ï¼ˆNBCï¼ŒAdidasï¼‰ç»„åˆï¼Œå› æ­¤ï¼ŒPoly2æ¨¡å‹å°±æ— æ³•å­¦ä¹ åˆ°å‚æ•°wNBC,AdidaswNBC,Adidasã€‚è€ŒFMæ¨¡å‹å¯ä»¥é€šè¿‡ç‰¹å¾ç»„åˆ(NBCï¼ŒNike)ã€(EPSNï¼ŒAdidas) åˆ†åˆ«å­¦ä¹ åˆ°éšå‘é‡VNBCVNBCå’ŒVAdidasVAdidasï¼Œè¿™æ ·ä½¿å¾—åœ¨æµ‹è¯•é›†ä¸­å¾—ä»¥è¿›è¡Œé¢„æµ‹ã€‚\næ›´ä¸€èˆ¬çš„ï¼Œç»è¿‡åˆ†è§£ï¼Œå¼2-1çš„å‚æ•°ä¸ªæ•°å‡å°‘ä¸ºkdkdä¸ªï¼Œå¯¹æ¯”å¼1-1ï¼Œå‚æ•°ä¸ªæ•°å¤§å¤§å‡å°‘ã€‚ä½¿ç”¨å°çš„kï¼Œä½¿å¾—æ¨¡å‹èƒ½å¤Ÿæé«˜åœ¨ç¨€ç–æƒ…å†µä¸‹çš„æ³›åŒ–æ€§èƒ½ã€‚æ­¤å¤–ï¼Œå°†wijwijè¿›è¡Œåˆ†è§£ï¼Œä½¿å¾—ä¸åŒçš„ç‰¹å¾å¯¹ä¸å†æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œè€Œå®ƒä»¬çš„å…³è”æ€§å¯ä»¥ç”¨éšå¼å› å­è¡¨ç¤ºï¼Œè¿™å°†ä½¿å¾—æœ‰æ›´å¤šçš„æ•°æ®å¯ä»¥ç”¨äºæ¨¡å‹å‚æ•°çš„å­¦ä¹ ã€‚æ¯”å¦‚xi,xjxi,xjä¸xi,xkxi,xkçš„å‚æ•°åˆ†åˆ«ä¸ºï¼šâŸ¨vi,vjâŸ©âŸ¨vi,vjâŸ©å’ŒâŸ¨vi,vkâŸ©âŸ¨vi,vkâŸ©ï¼Œå®ƒä»¬éƒ½å¯ä»¥ç”¨æ¥å­¦ä¹ viviï¼Œæ›´ä¸€èˆ¬çš„ï¼ŒåŒ…å«xixjâ‰ 0\u0026amp;iâ‰ jxixjâ‰ 0\u0026amp;iâ‰ jçš„æ‰€æœ‰æ ·æœ¬éƒ½èƒ½ç”¨æ¥å­¦ä¹ viviï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…äº†æ•°æ®ç¨€ç–æ€§çš„å½±å“ã€‚\næ­¤å¤–ï¼Œå¼2-1çš„å¤æ‚åº¦å¯ä»¥ä»O(kd2)O(kd2)ä¼˜åŒ–åˆ°O(kd)O(kd)ï¼š\nå¯ä»¥çœ‹å‡ºï¼ŒFMæ¨¡å‹å¯ä»¥åœ¨çº¿æ€§çš„æ—¶é—´åšå‡ºé¢„æµ‹ã€‚\nFMæ¨¡å‹å­¦ä¹  åœ¨2-4å¼ä¸­ï¼Œâˆ‘dj=1vj,fxjâˆ‘j=1dvj,fxjåªä¸ffæœ‰å…³è€Œä¸iiæ— å…³ï¼Œåœ¨æ¯æ¬¡è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥é¢„å…ˆå¯¹æ‰€æœ‰ffçš„âˆ‘dj=1vj,fxjâˆ‘j=1dvj,fxjè¿›è¡Œè®¡ç®—ï¼Œå¤æ‚åº¦O(kd)O(kd)ï¼Œå°±èƒ½åœ¨å¸¸æ•°æ—¶é—´O(1)O(1)å†…å¾—åˆ°vi,fvi,fçš„æ¢¯åº¦ã€‚è€Œå¯¹äºå…¶å®ƒå‚æ•°w0w0å’Œwiwiï¼Œæ˜¾ç„¶ä¹Ÿæ˜¯åœ¨å¸¸æ•°æ—¶é—´å†…è®¡ç®—æ¢¯åº¦ã€‚æ­¤å¤–ï¼Œæ›´æ–°å‚æ•°åªéœ€è¦O(1)O(1), ä¸€å…±æœ‰1+d+kd1+d+kdä¸ªå‚æ•°ï¼Œå› æ­¤FMå‚æ•°è®­ç»ƒçš„å¤æ‚åº¦ä¹Ÿæ˜¯O(kd)O(kd)ã€‚\næ‰€ä»¥è¯´ï¼ŒFMæ¨¡å‹æ˜¯ä¸€ç§é«˜æ•ˆçš„æ¨¡å‹ï¼Œæ˜¯çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„ï¼Œå¯ä»¥åœ¨çº¿æ€§çš„æ—¶é—´åšå‡ºè®­ç»ƒå’Œé¢„æµ‹ã€‚\nFFMæ¨¡å‹ è€ƒè™‘ä¸‹é¢çš„æ•°æ®é›†ï¼š\nClicked? Publisher(P) Advertiser(A) Gender(G) 1 EPSN Nike Male 0 NBC Adidas Female å¯¹äºç¬¬ä¸€æ¡æ•°æ®æ¥è¯´ï¼ŒFMæ¨¡å‹çš„äºŒæ¬¡é¡¹ä¸ºï¼šwEPSNâ‹…wNike+wEPSNâ‹…wMale+wNikeâ‹…wMalewEPSNâ‹…wNike+wEPSNâ‹…wMale+wNikeâ‹…wMaleã€‚ï¼ˆè¿™é‡Œåªæ˜¯æŠŠä¸Šé¢çš„vç¬¦åˆæ”¹æˆäº†wï¼‰æ¯ä¸ªç‰¹å¾åªç”¨ä¸€ä¸ªéšå‘é‡æ¥å­¦ä¹ å’Œå…¶å®ƒç‰¹å¾çš„æ½œåœ¨å½±å“ã€‚å¯¹äºä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒNikeæ˜¯å¹¿å‘Šä¸»ï¼ŒMaleæ˜¯ç”¨æˆ·çš„æ€§åˆ«ï¼Œæè¿°ï¼ˆEPSNï¼ŒNikeï¼‰å’Œï¼ˆEPSNï¼ŒMaleï¼‰ç‰¹å¾ç»„åˆï¼ŒFMæ¨¡å‹éƒ½ç”¨åŒä¸€ä¸ªwESPNwESPNï¼Œè€Œå®é™…ä¸Šï¼ŒESPNä½œä¸ºå¹¿å‘Šå•†ï¼Œå…¶å¯¹å¹¿å‘Šä¸»å’Œç”¨æˆ·æ€§åˆ«çš„æ½œåœ¨å½±å“å¯èƒ½æ˜¯ä¸åŒçš„ã€‚\nå› æ­¤ï¼ŒYu-Chin Juanå€Ÿé‰´Michael Jahrerçš„è®ºæ–‡ï¼ˆEnsemble of collaborative filtering and feature engineered models for click through rate predictionï¼‰ï¼Œå°†fieldæ¦‚å¿µå¼•å…¥FMæ¨¡å‹ã€‚\nfieldæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå³ç›¸åŒæ€§è´¨çš„ç‰¹å¾æ”¾åœ¨ä¸€ä¸ªfieldã€‚æ¯”å¦‚EPSNã€NBCéƒ½æ˜¯å±äºå¹¿å‘Šå•†fieldçš„ï¼ŒNikeã€Adidaséƒ½æ˜¯å±äºå¹¿å‘Šä¸»fieldï¼ŒMaleã€Femaleéƒ½æ˜¯å±äºæ€§åˆ«fieldçš„ã€‚ç®€å•çš„è¯´ï¼ŒåŒä¸€ä¸ªç±»åˆ«ç‰¹å¾è¿›è¡Œone-hotç¼–ç åç”Ÿæˆçš„æ•°å€¼ç‰¹å¾éƒ½å¯ä»¥æ”¾åœ¨åŒä¸€ä¸ªfieldä¸­ï¼Œæ¯”å¦‚æœ€å¼€å§‹çš„ä¾‹å­ä¸­Day=26/11/15 Day=19/2/15å¯ä»¥æ”¾äºåŒä¸€ä¸ªfieldä¸­ã€‚å¦‚æœæ˜¯æ•°å€¼ç‰¹å¾è€Œéç±»åˆ«ï¼Œå¯ä»¥ç›´æ¥ä½œä¸ºä¸€ä¸ªfieldã€‚\nå¼•å…¥äº†fieldåï¼Œå¯¹äºåˆšæ‰çš„ä¾‹å­æ¥è¯´ï¼ŒäºŒæ¬¡é¡¹å˜ä¸ºï¼š\nå¯¹äºç‰¹å¾ç»„åˆï¼ˆEPSNï¼ŒNikeï¼‰æ¥è¯´ï¼Œå…¶éšå‘é‡é‡‡ç”¨çš„æ˜¯wEPSN,AwEPSN,Aå’ŒwNike,PwNike,Pï¼Œå¯¹äºwEPSN,AwEPSN,Aè¿™æ˜¯å› ä¸ºNikeå±äºå¹¿å‘Šä¸»ï¼ˆAdvertiserï¼‰çš„fieldï¼Œè€Œç¬¬äºŒé¡¹wNike,PwNike,Påˆ™æ˜¯EPSNæ˜¯å¹¿å‘Šå•†ï¼ˆPublisherï¼‰çš„fieldã€‚ å†ä¸¾ä¸ªä¾‹å­ï¼Œå¯¹äºç‰¹å¾ç»„åˆï¼ˆEPSNï¼ŒMaleï¼‰æ¥è¯´ï¼ŒwEPSN,GwEPSN,G æ˜¯å› ä¸ºMaleæ˜¯ç”¨æˆ·æ€§åˆ«(Gender)çš„fieldï¼Œè€Œç¬¬äºŒé¡¹wMale,PwMale,Pæ˜¯å› ä¸ºEPSNæ˜¯å¹¿å‘Šå•†ï¼ˆPublisherï¼‰çš„fieldã€‚ ä¸‹é¢çš„å›¾æ¥è‡ªcriteoï¼Œå¾ˆå¥½çš„è¡¨ç¤ºäº†ä¸‰ä¸ªæ¨¡å‹çš„åŒºåˆ«\nFFM æ•°å­¦å…¬å¼ å› æ­¤ï¼ŒFFMçš„æ•°å­¦å…¬å¼è¡¨ç¤ºä¸ºï¼š\nå…¶ä¸­fifiå’Œfjfjåˆ†åˆ«ä»£è¡¨ç¬¬iä¸ªç‰¹å¾å’Œç¬¬jä¸ªç‰¹å¾æ‰€å±çš„fieldã€‚è‹¥fieldæœ‰ffä¸ªï¼Œéšå‘é‡çš„é•¿åº¦ä¸ºkï¼Œåˆ™äºŒæ¬¡é¡¹ç³»æ•°å…±æœ‰dfkdfkä¸ªï¼Œè¿œå¤šäºFMæ¨¡å‹çš„dkdkä¸ªã€‚æ­¤å¤–ï¼Œéšå‘é‡å’Œfieldç›¸å…³ï¼Œå¹¶ä¸èƒ½åƒFMæ¨¡å‹ä¸€æ ·å°†äºŒæ¬¡é¡¹åŒ–ç®€ï¼Œè®¡ç®—çš„å¤æ‚åº¦æ˜¯d2kd2kã€‚\né€šå¸¸æƒ…å†µä¸‹ï¼Œæ¯ä¸ªéšå‘é‡åªéœ€è¦å­¦ä¹ ç‰¹å®šfieldçš„è¡¨ç¤ºï¼Œæ‰€ä»¥æœ‰kFFMâ‰ªkFMkFFMâ‰ªkFMã€‚\nFFM æ¨¡å‹å­¦ä¹  ä¸ºäº†æ–¹ä¾¿æ¨å¯¼ï¼Œè¿™é‡Œçœç•¥FFMçš„ä¸€æ¬¡é¡¹å’Œå¸¸æ•°é¡¹ï¼Œå…¬å¼ä¸ºï¼š\næ³¨æ„åˆ°âˆ‚Lerrâˆ‚Ï•âˆ‚Lerrâˆ‚Ï•å’Œå‚æ•°æ— å…³ï¼Œæ¯æ¬¡æ›´æ–°æ¨¡å‹æ—¶ï¼Œåªéœ€è¦è®¡ç®—ä¸€æ¬¡ï¼Œä¹‹åç›´æ¥è°ƒç”¨ç»“æœå³å¯ã€‚å¯¹äºæ€»å…±æœ‰dfkdfkä¸ªæ¨¡å‹å‚æ•°çš„è®¡ç®—æ¥è¯´ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼èƒ½æå¤§æå‡è¿ç®—æ•ˆç‡ã€‚\nç¬¬äºŒä¸ªtrickæ˜¯FFMçš„å­¦ä¹ ç‡æ˜¯éšè¿­ä»£æ¬¡æ•°å˜åŒ–çš„ï¼Œå…·ä½“çš„æ˜¯é‡‡ç”¨AdaGradç®—æ³•ï¼Œè¿™é‡Œè¿›è¡Œç®€å•çš„ä»‹ç»ã€‚\nAdagradç®—æ³•èƒ½å¤Ÿåœ¨è®­ç»ƒä¸­è‡ªåŠ¨çš„è°ƒæ•´å­¦ä¹ ç‡ï¼Œå¯¹äºç¨€ç–çš„å‚æ•°å¢åŠ å­¦ä¹ ç‡ï¼Œè€Œç¨ å¯†çš„å‚æ•°åˆ™é™ä½å­¦ä¹ ç‡ã€‚å› æ­¤ï¼ŒAdagradéå¸¸é€‚åˆå¤„ç†ç¨€ç–æ•°æ®ã€‚\nè®¾gt,jgt,jä¸ºç¬¬tè½®ç¬¬jä¸ªå‚æ•°çš„æ¢¯åº¦ï¼Œåˆ™SGDå’Œé‡‡ç”¨Adagradçš„å‚æ•°æ›´æ–°å…¬å¼åˆ†åˆ«å¦‚ä¸‹ï¼š\nå¯ä»¥çœ‹å‡ºï¼ŒAdagradåœ¨å­¦ä¹ ç‡Î·Î·ä¸Šè¿˜é™¤ä»¥ä¸€é¡¹âˆšGt,jj+ÏµGt,jj+Ïµï¼Œè¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼ŸÏµÏµä¸ºå¹³æ»‘é¡¹ï¼Œé˜²æ­¢åˆ†æ¯ä¸º0ï¼ŒGt,jj=âˆ‘tÎ¹=1g2Î¹,jjGt,jj=âˆ‘Î¹=1tgÎ¹,jj2å³Gt,jjGt,jjä¸ºå¯¹è§’çŸ©é˜µï¼Œæ¯ä¸ªå¯¹è§’çº¿ä½ç½®j,jj,jçš„å€¼ä¸ºå‚æ•°wjwjæ¯ä¸€è½®çš„å¹³æ–¹å’Œï¼Œå¯ä»¥çœ‹å‡ºï¼Œéšç€è¿­ä»£çš„è¿›è¡Œï¼Œæ¯ä¸ªå‚æ•°çš„å†å²æ¢¯åº¦ç´¯åŠ åˆ°ä¸€èµ·ï¼Œä½¿å¾—æ¯ä¸ªå‚æ•°çš„å­¦ä¹ ç‡é€æ¸å‡å°ã€‚\nå®ç°çš„trick é™¤äº†ä¸Šé¢æåˆ°çš„æ¢¯åº¦åˆ†æ­¥è®¡ç®—å’Œè‡ªé€‚åº”å­¦ä¹ ç‡ä¸¤ä¸ªtrickå¤–ï¼Œè¿˜æœ‰ï¼š\nOpenMPå¤šæ ¸å¹¶è¡Œè®¡ç®—ã€‚OpenMPæ˜¯ç”¨äºå…±äº«å†…å­˜å¹¶è¡Œç³»ç»Ÿçš„å¤šå¤„ç†å™¨ç¨‹åºè®¾è®¡çš„ç¼–è¯‘æ–¹æ¡ˆï¼Œä¾¿äºç§»æ¤å’Œå¤šæ ¸æ‰©å±•[12]ã€‚FFMçš„æºç é‡‡ç”¨äº†OpenMPçš„APIï¼Œå¯¹å‚æ•°è®­ç»ƒè¿‡ç¨‹SGDè¿›è¡Œäº†å¤šçº¿ç¨‹æ‰©å±•ï¼Œæ”¯æŒå¤šçº¿ç¨‹ç¼–è¯‘ã€‚å› æ­¤ï¼ŒOpenMPæŠ€æœ¯æå¤§åœ°æé«˜äº†FFMçš„è®­ç»ƒæ•ˆç‡å’Œå¤šæ ¸CPUçš„åˆ©ç”¨ç‡ã€‚åœ¨è®­ç»ƒæ¨¡å‹æ—¶ï¼Œè¾“å…¥çš„è®­ç»ƒå‚æ•°ns_threadsæŒ‡å®šäº†çº¿ç¨‹æ•°é‡ï¼Œä¸€èˆ¬è®¾å®šä¸ºCPUçš„æ ¸å¿ƒæ•°ï¼Œä¾¿äºå®Œå…¨åˆ©ç”¨CPUèµ„æºã€‚ SSE3æŒ‡ä»¤å¹¶è¡Œç¼–ç¨‹ã€‚SSE3å…¨ç§°ä¸ºæ•°æ®æµå•æŒ‡ä»¤å¤šæ•°æ®æ‰©å±•æŒ‡ä»¤é›†3ï¼Œæ˜¯CPUå¯¹æ•°æ®å±‚å¹¶è¡Œçš„å…³é”®æŒ‡ä»¤ï¼Œä¸»è¦ç”¨äºå¤šåª’ä½“å’Œæ¸¸æˆçš„åº”ç”¨ç¨‹åºä¸­[13]ã€‚SSE3æŒ‡ä»¤é‡‡ç”¨128ä½çš„å¯„å­˜å™¨ï¼ŒåŒæ—¶æ“ä½œ4ä¸ªå•ç²¾åº¦æµ®ç‚¹æ•°æˆ–æ•´æ•°ã€‚SSE3æŒ‡ä»¤çš„åŠŸèƒ½éå¸¸ç±»ä¼¼äºå‘é‡è¿ç®—ã€‚ä¾‹å¦‚ï¼Œaå’Œbé‡‡ç”¨SSE3æŒ‡ä»¤ç›¸åŠ ï¼ˆaå’Œbåˆ†åˆ«åŒ…å«4ä¸ªæ•°æ®ï¼‰ï¼Œå…¶åŠŸèƒ½æ˜¯aç§çš„4ä¸ªå…ƒç´ ä¸bä¸­4ä¸ªå…ƒç´ å¯¹åº”ç›¸åŠ ï¼Œå¾—åˆ°4ä¸ªç›¸åŠ åçš„å€¼ã€‚é‡‡ç”¨SSE3æŒ‡ä»¤åï¼Œå‘é‡è¿ç®—çš„é€Ÿåº¦æ›´åŠ å¿«æ·ï¼Œè¿™å¯¹åŒ…å«å¤§é‡å‘é‡è¿ç®—çš„FFMæ¨¡å‹æ˜¯éå¸¸æœ‰åˆ©çš„ã€‚ é™¤äº†ä¸Šé¢çš„æŠ€å·§ä¹‹å¤–ï¼ŒFFMçš„å®ç°ä¸­è¿˜æœ‰å¾ˆå¤šè°ƒä¼˜æŠ€å·§éœ€è¦æ¢ç´¢ã€‚ä¾‹å¦‚ï¼Œä»£ç æ˜¯æŒ‰fieldå’Œç‰¹å¾çš„ç¼–å·ç”³è¯·å‚æ•°ç©ºé—´çš„ï¼Œå¦‚æœé€‰å–äº†éè¿ç»­æˆ–è¿‡å¤§çš„ç¼–å·ï¼Œå°±ä¼šé€ æˆå¤§é‡çš„å†…å­˜æµªè´¹ï¼›åœ¨æ¯ä¸ªæ ·æœ¬ä¸­åŠ å…¥å€¼ä¸º1çš„æ–°ç‰¹å¾ï¼Œç›¸å½“äºå¼•å…¥äº†å› å­åŒ–çš„ä¸€æ¬¡é¡¹ï¼Œé¿å…äº†ç¼ºå°‘ä¸€æ¬¡é¡¹å¸¦æ¥çš„æ¨¡å‹åå·®ç­‰ã€‚\né€‚ç”¨èŒƒå›´å’Œä½¿ç”¨æŠ€å·§ åœ¨FFMåŸè®ºæ–‡ä¸­ï¼Œä½œè€…æŒ‡å‡ºï¼ŒFFMæ¨¡å‹å¯¹äºone-hotåç±»åˆ«ç‰¹å¾ååˆ†æœ‰æ•ˆï¼Œä½†æ˜¯å¦‚æœæ•°æ®ä¸å¤Ÿç¨€ç–ï¼Œå¯èƒ½ç›¸æ¯”å…¶å®ƒæ¨¡å‹æå‡æ²¡æœ‰ç¨€ç–çš„æ—¶å€™é‚£ä¹ˆå¤§ï¼Œæ­¤å¤–ï¼Œå¯¹äºæ•°å€¼å‹çš„æ•°æ®æ•ˆæœä¸æ˜¯ç‰¹åˆ«çš„å¥½ã€‚\nåœ¨Githubä¸Šæœ‰FFMçš„å¼€æºå®ç°ï¼Œè¦ä½¿ç”¨FFMæ¨¡å‹ï¼Œç‰¹å¾éœ€è¦è½¬åŒ–ä¸ºâ€œfield_id:feature_id:valueâ€æ ¼å¼ï¼Œç›¸æ¯”LibSVMçš„æ ¼å¼å¤šäº†field_idï¼Œå³ç‰¹å¾æ‰€å±çš„fieldçš„ç¼–å·ï¼Œfeature_idæ˜¯ç‰¹å¾ç¼–å·ï¼Œvalueä¸ºç‰¹å¾çš„å€¼ã€‚\næ­¤å¤–ï¼Œç¾å›¢ç‚¹è¯„çš„æ–‡ç« ä¸­ï¼Œæåˆ°äº†è®­ç»ƒFFMæ—¶çš„ä¸€äº›æ³¨æ„äº‹é¡¹ï¼š\nç¬¬ä¸€ï¼Œæ ·æœ¬å½’ä¸€åŒ–ã€‚FFMé»˜è®¤æ˜¯è¿›è¡Œæ ·æœ¬æ•°æ®çš„å½’ä¸€åŒ–çš„ ã€‚è‹¥ä¸è¿›è¡Œå½’ä¸€åŒ–ï¼Œå¾ˆå®¹æ˜“é€ æˆæ•°æ®infæº¢å‡ºï¼Œè¿›è€Œå¼•èµ·æ¢¯åº¦è®¡ç®—çš„nané”™è¯¯ã€‚å› æ­¤ï¼Œæ ·æœ¬å±‚é¢çš„æ•°æ®æ˜¯æ¨èè¿›è¡Œå½’ä¸€åŒ–çš„ã€‚\nç¬¬äºŒï¼Œç‰¹å¾å½’ä¸€åŒ–ã€‚CTR/CVRæ¨¡å‹é‡‡ç”¨äº†å¤šç§ç±»å‹çš„æºç‰¹å¾ï¼ŒåŒ…æ‹¬æ•°å€¼å‹å’Œcategoricalç±»å‹ç­‰ã€‚ä½†æ˜¯ï¼Œcategoricalç±»ç¼–ç åçš„ç‰¹å¾å–å€¼åªæœ‰0æˆ–1ï¼Œè¾ƒå¤§çš„æ•°å€¼å‹ç‰¹å¾ä¼šé€ æˆæ ·æœ¬å½’ä¸€åŒ–åcategoricalç±»ç”Ÿæˆç‰¹å¾çš„å€¼éå¸¸å°ï¼Œæ²¡æœ‰åŒºåˆ†æ€§ã€‚ä¾‹å¦‚ï¼Œä¸€æ¡ç”¨æˆ·-å•†å“è®°å½•ï¼Œç”¨æˆ·ä¸ºâ€œç”·â€æ€§ï¼Œå•†å“çš„é”€é‡æ˜¯5000ä¸ªï¼ˆå‡è®¾å…¶å®ƒç‰¹å¾çš„å€¼ä¸ºé›¶ï¼‰ï¼Œé‚£ä¹ˆå½’ä¸€åŒ–åç‰¹å¾â€œsex=maleâ€ï¼ˆæ€§åˆ«ä¸ºç”·ï¼‰çš„å€¼ç•¥å°äº0.0002ï¼Œè€Œâ€œvolumeâ€ï¼ˆé”€é‡ï¼‰çš„å€¼è¿‘ä¼¼ä¸º1ã€‚ç‰¹å¾â€œsex=maleâ€åœ¨è¿™ä¸ªæ ·æœ¬ä¸­çš„ä½œç”¨å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œè¿™æ˜¯ç›¸å½“ä¸åˆç†çš„ã€‚å› æ­¤ï¼Œå°†æºæ•°å€¼å‹ç‰¹å¾çš„å€¼å½’ä¸€åŒ–åˆ°[0,1]æ˜¯éå¸¸å¿…è¦çš„ã€‚\nç¬¬ä¸‰ï¼Œçœç•¥é›¶å€¼ç‰¹å¾ã€‚ä»FFMæ¨¡å‹çš„è¡¨è¾¾å¼(3-1)å¯ä»¥çœ‹å‡ºï¼Œé›¶å€¼ç‰¹å¾å¯¹æ¨¡å‹å®Œå…¨æ²¡æœ‰è´¡çŒ®ã€‚åŒ…å«é›¶å€¼ç‰¹å¾çš„ä¸€æ¬¡é¡¹å’Œç»„åˆé¡¹å‡ä¸ºé›¶ï¼Œå¯¹äºè®­ç»ƒæ¨¡å‹å‚æ•°æˆ–è€…ç›®æ ‡å€¼é¢„ä¼°æ˜¯æ²¡æœ‰ä½œç”¨çš„ã€‚å› æ­¤ï¼Œå¯ä»¥çœå»é›¶å€¼ç‰¹å¾ï¼Œæé«˜FFMæ¨¡å‹è®­ç»ƒå’Œé¢„æµ‹çš„é€Ÿåº¦ï¼Œè¿™ä¹Ÿæ˜¯ç¨€ç–æ ·æœ¬é‡‡ç”¨FFMçš„æ˜¾è‘—ä¼˜åŠ¿ã€‚\nå‚è€ƒ: https://www.hrwhisper.me/machine-learning-fm-ffm-deepfm-deepffm/\n","permalink":"https://reid00.github.io/en/posts/ml/fm-ffm-deepfm/","summary":"ä»‹ç» FMå’ŒFMMæ¨¡å‹åœ¨æ•°æ®é‡æ¯”è¾ƒå¤§å¹¶ä¸”ç‰¹å¾ç¨€ç–çš„æƒ…å†µä¸‹ï¼Œä»ç„¶æœ‰ä¼˜ç§€çš„æ€§èƒ½è¡¨ç°ï¼Œåœ¨CTR/CVRä»»åŠ¡ä¸Šå°¤å…¶çªå‡ºã€‚\næœ¬æ–‡åŒ…æ‹¬ï¼š\n- FM æ¨¡å‹ - FFM æ¨¡å‹ - Deep FM æ¨¡å‹ - Deep FFMæ¨¡å‹ FMæ¨¡å‹çš„å¼•å…¥-å¹¿å‘Šç‰¹å¾çš„ç¨€ç–æ€§ FMï¼ˆFactorization machinesï¼‰æ¨¡å‹ç”±Steffen Rendleäº2010å¹´æå‡ºï¼Œç›®çš„æ˜¯è§£å†³ç¨€ç–æ•°æ®ä¸‹çš„ç‰¹å¾ç»„åˆé—®é¢˜ã€‚\nåœ¨ä»‹ç»FMæ¨¡å‹ä¹‹å‰ï¼Œæ¥çœ‹çœ‹ç¨€ç–æ•°æ®çš„è®­ç»ƒé—®é¢˜ã€‚\nä»¥å¹¿å‘ŠCTRï¼ˆclick-through rateï¼‰ç‚¹å‡»ç‡é¢„æµ‹ä»»åŠ¡ä¸ºä¾‹ï¼Œå‡è®¾æœ‰å¦‚ä¸‹æ•°æ®\nClicked? Country Day Ad_type 1 USA 26/11/15 Movie 0 China 19/2/15 Game 1 China 26/11/15 Game ç¬¬ä¸€åˆ—Clickedæ˜¯ç±»åˆ«æ ‡è®°ï¼Œæ ‡è®°ç”¨æˆ·æ˜¯å¦ç‚¹å‡»äº†è¯¥å¹¿å‘Šï¼Œè€Œå…¶ä½™åˆ—åˆ™æ˜¯ç‰¹å¾ï¼ˆè¿™é‡Œçš„ä¸‰ä¸ªç‰¹å¾éƒ½æ˜¯ç±»åˆ«ç±»å‹ï¼‰ï¼Œä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬ä¼šå¯¹æ•°æ®è¿›è¡ŒOne-hotç¼–ç å°†ç±»åˆ«ç‰¹å¾è½¬åŒ–ä¸ºæ•°å€¼ç‰¹å¾ï¼Œè½¬åŒ–åæ•°æ®å¦‚ä¸‹:\nClicked? Country=USA Country=China Day=26/11/15 Day=19/2/15 Ad_type=Movie Ad_type=Game 1 1 0 1 0 1 0 0 0 1 0 1 0 1 1 0 1 1 0 0 1 ç»è¿‡One-hotç¼–ç åï¼Œç‰¹å¾ç©ºé—´æ˜¯ååˆ†ç¨€ç–çš„ã€‚ç‰¹åˆ«çš„ï¼ŒæŸç±»åˆ«ç‰¹å¾æœ‰mç§ä¸åŒçš„å–å€¼ï¼Œåˆ™one-hotç¼–ç åå°±ä¼šè¢«å˜ä¸ºmç»´ï¼å½“ç±»åˆ«ç‰¹å¾è¶Šå¤šã€ç±»åˆ«ç‰¹å¾çš„å–å€¼è¶Šå¤šï¼Œå…¶ç‰¹å¾ç©ºé—´å°±æ›´åŠ ç¨€ç–ã€‚\næ­¤å¤–ï¼Œå¾€å¾€æˆ‘ä»¬ä¼šå°†ç‰¹å¾è¿›è¡Œä¸¤ä¸¤çš„ç»„åˆï¼Œè¿™æ˜¯å› ä¸ºï¼š","title":"FM FFM DeepFM"},{"content":"å‰è¨€ å…ˆæ¥çœ‹çœ‹ä¸€åˆ™å°æ•…äº‹\næˆ‘ä»¬å†™å¥½çš„ä¸€è¡Œè¡Œä»£ç ï¼Œä¸ºäº†è®©å…¶å·¥ä½œèµ·æ¥ï¼Œæˆ‘ä»¬è¿˜å¾—æŠŠå®ƒé€è¿›åŸï¼ˆè¿›ç¨‹ï¼‰é‡Œï¼Œé‚£æ—¢ç„¶è¿›äº†åŸé‡Œï¼Œé‚£è‚¯å®šä¸èƒ½èƒ¡ä½œéä¸ºäº†ã€‚\nåŸé‡Œäººæœ‰åŸé‡Œäººçš„è§„çŸ©ï¼ŒåŸä¸­æœ‰ä¸ªä¸“é—¨ç®¡è¾–ä½ ä»¬çš„åŸç®¡ï¼ˆæ“ä½œç³»ç»Ÿï¼‰ï¼Œäººå®¶è®©ä½ ä¼‘æ¯å°±ä¼‘æ¯ï¼Œè®©ä½ å·¥ä½œå°±å·¥ä½œï¼Œæ¯•ç«Ÿæ‘Šä½ï¼ˆCPUï¼‰å°±ä¸€ä¸ªï¼Œæ¯ä¸ªäººéƒ½è¦å è¿™ä¸ªæ‘Šä½æ¥å·¥ä½œï¼ŒåŸé‡Œè¦å·¥ä½œçš„äººå¤šç€å»äº†ã€‚\næ‰€ä»¥åŸç®¡ä¸ºäº†å…¬å¹³èµ·è§ï¼Œå®ƒä½¿ç”¨ä¸€ç§ç­–ç•¥ï¼ˆè°ƒåº¦ï¼‰æ–¹å¼ï¼Œç»™æ¯ä¸ªäººä¸€ä¸ªå›ºå®šçš„å·¥ä½œæ—¶é—´ï¼ˆæ—¶é—´ç‰‡ï¼‰ï¼Œæ—¶é—´åˆ°äº†å°±ä¼šé€šçŸ¥ä½ å»ä¼‘æ¯è€Œæ¢å¦å¤–ä¸€ä¸ªäººä¸Šåœºå·¥ä½œã€‚\nå¦å¤–ï¼Œåœ¨ä¼‘æ¯æ—¶å€™ä½ ä¹Ÿä¸èƒ½å·æ‡’ï¼Œè¦è®°ä½å·¥ä½œåˆ°å“ªäº†ï¼Œä¸ç„¶ä¸‹æ¬¡åˆ°ä½ å·¥ä½œäº†ï¼Œä½ å¿˜è®°å·¥ä½œåˆ°å“ªäº†ï¼Œé‚£è¿˜æ€ä¹ˆç»§ç»­ï¼Ÿ\næœ‰çš„äººï¼Œå¯èƒ½è¿˜è¿›å…¥äº†å¿åŸï¼ˆçº¿ç¨‹ï¼‰å·¥ä½œï¼Œè¿™é‡Œç›¸å¯¹è½»æ¾ä¸€äº›ï¼Œåœ¨ä¼‘æ¯çš„æ—¶å€™ï¼Œè¦è®°ä½çš„ä¸œè¥¿ç›¸å¯¹è¾ƒå°‘ï¼Œè€Œä¸”è¿˜èƒ½å…±äº«åŸé‡Œçš„èµ„æºã€‚\nâ€œå“å“Ÿï¼Œéš¾é“æœ¬æ–‡å†…å®¹æ˜¯è¿›ç¨‹å’Œçº¿ç¨‹ï¼Ÿâ€\nå¯ä»¥ï¼Œèªæ˜çš„ä½ çŒœå‡ºæ¥äº†ï¼Œä¹Ÿä¸æ‰è´¹æˆ‘çç¼–ä¹±é€ çš„æ•…äº‹äº†ã€‚\nè¿›ç¨‹å’Œçº¿ç¨‹å¯¹äºå†™ä»£ç çš„æˆ‘ä»¬ï¼ŒçœŸçš„å¤©å¤©è§ã€æ—¥æ—¥è§äº†ï¼Œä½†è§çš„å¤šä¸ä»£è¡¨ä½ å°±ç†Ÿæ‚‰å®ƒä»¬ï¼Œæ¯”å¦‚ç®€å•é—®ä½ ä¸€å¥ï¼Œä½ çŸ¥é“å®ƒä»¬çš„å·¥ä½œåŸç†å’ŒåŒºåˆ«å—ï¼Ÿ\nä¸çŸ¥é“æ²¡å…³ç³»ï¼Œä»Šå¤©å°±è¦è·Ÿå¤§å®¶è®¨è®ºæ“ä½œç³»ç»Ÿçš„è¿›ç¨‹å’Œçº¿ç¨‹ã€‚\næçº²\næ­£æ–‡ è¿›ç¨‹ æˆ‘ä»¬ç¼–å†™çš„ä»£ç åªæ˜¯ä¸€ä¸ªå­˜å‚¨åœ¨ç¡¬ç›˜çš„é™æ€æ–‡ä»¶ï¼Œé€šè¿‡ç¼–è¯‘åå°±ä¼šç”ŸæˆäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶åï¼Œå®ƒä¼šè¢«è£…è½½åˆ°å†…å­˜ä¸­ï¼Œæ¥ç€ CPU ä¼šæ‰§è¡Œç¨‹åºä¸­çš„æ¯ä¸€æ¡æŒ‡ä»¤ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿è¡Œä¸­çš„ç¨‹åºï¼Œå°±è¢«ç§°ä¸ºã€Œè¿›ç¨‹ã€ã€‚\nç°åœ¨æˆ‘ä»¬è€ƒè™‘æœ‰ä¸€ä¸ªä¼šè¯»å–ç¡¬ç›˜æ–‡ä»¶æ•°æ®çš„ç¨‹åºè¢«æ‰§è¡Œäº†ï¼Œé‚£ä¹ˆå½“è¿è¡Œåˆ°è¯»å–æ–‡ä»¶çš„æŒ‡ä»¤æ—¶ï¼Œå°±ä¼šå»ä»ç¡¬ç›˜è¯»å–æ•°æ®ï¼Œä½†æ˜¯ç¡¬ç›˜çš„è¯»å†™é€Ÿåº¦æ˜¯éå¸¸æ…¢çš„ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœ CPU å‚»å‚»çš„ç­‰ç¡¬ç›˜è¿”å›æ•°æ®çš„è¯ï¼Œé‚£ CPU çš„åˆ©ç”¨ç‡æ˜¯éå¸¸ä½çš„ã€‚\nåšä¸ªç±»æ¯”ï¼Œä½ å»ç…®å¼€æ°´æ—¶ï¼Œä½ ä¼šå‚»å‚»çš„ç­‰æ°´å£¶çƒ§å¼€å—ï¼Ÿå¾ˆæ˜æ˜¾ï¼Œå°å­©ä¹Ÿä¸ä¼šå‚»ç­‰ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ°´å£¶çƒ§å¼€ä¹‹å‰å»åšå…¶ä»–äº‹æƒ…ã€‚å½“æ°´å£¶çƒ§å¼€äº†ï¼Œæˆ‘ä»¬è‡ªç„¶å°±ä¼šå¬åˆ°â€œå˜€å˜€å˜€â€çš„å£°éŸ³ï¼Œäºæ˜¯å†æŠŠçƒ§å¼€çš„æ°´å€’å…¥åˆ°æ°´æ¯é‡Œå°±å¥½äº†ã€‚\næ‰€ä»¥ï¼Œå½“è¿›ç¨‹è¦ä»ç¡¬ç›˜è¯»å–æ•°æ®æ—¶ï¼ŒCPU ä¸éœ€è¦é˜»å¡ç­‰å¾…æ•°æ®çš„è¿”å›ï¼Œè€Œæ˜¯å»æ‰§è¡Œå¦å¤–çš„è¿›ç¨‹ã€‚å½“ç¡¬ç›˜æ•°æ®è¿”å›æ—¶ï¼ŒCPU ä¼šæ”¶åˆ°ä¸ªä¸­æ–­ï¼Œäºæ˜¯ CPU å†ç»§ç»­è¿è¡Œè¿™ä¸ªè¿›ç¨‹ã€‚\nè¿›ç¨‹ 1 ä¸è¿›ç¨‹ 2 åˆ‡æ¢\nè¿™ç§å¤šä¸ªç¨‹åºã€äº¤æ›¿æ‰§è¡Œçš„æ€æƒ³ï¼Œå°±æœ‰ CPU ç®¡ç†å¤šä¸ªè¿›ç¨‹çš„åˆæ­¥æƒ³æ³•ã€‚\nå¯¹äºä¸€ä¸ªæ”¯æŒå¤šè¿›ç¨‹çš„ç³»ç»Ÿï¼ŒCPU ä¼šä»ä¸€ä¸ªè¿›ç¨‹å¿«é€Ÿåˆ‡æ¢è‡³å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œå…¶é—´æ¯ä¸ªè¿›ç¨‹å„è¿è¡Œå‡ åæˆ–å‡ ç™¾ä¸ªæ¯«ç§’ã€‚\nè™½ç„¶å•æ ¸çš„ CPU åœ¨æŸä¸€ä¸ªç¬é—´ï¼Œåªèƒ½è¿è¡Œä¸€ä¸ªè¿›ç¨‹ã€‚ä½†åœ¨ 1 ç§’é’ŸæœŸé—´ï¼Œå®ƒå¯èƒ½ä¼šè¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼Œè¿™æ ·å°±äº§ç”Ÿå¹¶è¡Œçš„é”™è§‰ï¼Œå®é™…ä¸Šè¿™æ˜¯å¹¶å‘ã€‚\nå¹¶å‘å’Œå¹¶è¡Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\nä¸€å›¾èƒœåƒè¨€ã€‚\nå¹¶å‘ä¸å¹¶è¡Œ\nè¿›ç¨‹ä¸ç¨‹åºçš„å…³ç³»çš„ç±»æ¯”\nåˆ°äº†æ™šé¥­æ—¶é—´ï¼Œä¸€å¯¹å°æƒ…ä¾£è‚šå­éƒ½å’•å’•å«äº†ï¼Œäºæ˜¯ç”·ç”Ÿè§æœºè¡Œäº‹ï¼Œå°±æƒ³ç»™å¥³ç”Ÿåšæ™šé¥­ï¼Œæ‰€ä»¥ä»–å°±åœ¨ç½‘ä¸Šæ‰¾äº†è¾£å­é¸¡çš„èœè°±ï¼Œæ¥ç€ä¹°äº†ä¸€äº›é¸¡è‚‰ã€è¾£æ¤’ã€é¦™æ–™ç­‰ææ–™ï¼Œç„¶åè¾¹çœ‹è¾¹å­¦è¾¹åšè¿™é“èœã€‚\nçªç„¶ï¼Œå¥³ç”Ÿè¯´å¥¹æƒ³å–å¯ä¹ï¼Œé‚£ä¹ˆç”·ç”Ÿåªå¥½æŠŠåšèœçš„äº‹æƒ…æš‚åœä¸€ä¸‹ï¼Œå¹¶åœ¨æ‰‹æœºèœè°±æ ‡è®°åšåˆ°å“ªä¸€ä¸ªæ­¥éª¤ï¼ŒæŠŠçŠ¶æ€ä¿¡æ¯è®°å½•äº†ä¸‹æ¥ã€‚\nç„¶åç”·ç”Ÿå¬ä»å¥³ç”Ÿçš„æŒ‡ä»¤ï¼Œè·‘å»ä¸‹æ¥¼ä¹°äº†ä¸€ç“¶å†°å¯ä¹åï¼Œåˆå›åˆ°å¨æˆ¿ç»§ç»­åšèœã€‚\nè¿™ä½“ç°äº†ï¼ŒCPU å¯ä»¥ä»ä¸€ä¸ªè¿›ç¨‹ï¼ˆåšèœï¼‰åˆ‡æ¢åˆ°å¦å¤–ä¸€ä¸ªè¿›ç¨‹ï¼ˆä¹°å¯ä¹ï¼‰ï¼Œåœ¨åˆ‡æ¢å‰å¿…é¡»è¦è®°å½•å½“å‰è¿›ç¨‹ä¸­è¿è¡Œçš„çŠ¶æ€ä¿¡æ¯ï¼Œä»¥å¤‡ä¸‹æ¬¡åˆ‡æ¢å›æ¥çš„æ—¶å€™å¯ä»¥æ¢å¤æ‰§è¡Œã€‚\næ‰€ä»¥ï¼Œå¯ä»¥å‘ç°è¿›ç¨‹æœ‰ç€ã€Œè¿è¡Œ - æš‚åœ - è¿è¡Œã€çš„æ´»åŠ¨è§„å¾‹ã€‚\nè¿›ç¨‹çš„çŠ¶æ€ åœ¨ä¸Šé¢ï¼Œæˆ‘ä»¬çŸ¥é“äº†è¿›ç¨‹æœ‰ç€ã€Œè¿è¡Œ - æš‚åœ - è¿è¡Œã€çš„æ´»åŠ¨è§„å¾‹ã€‚ä¸€èˆ¬è¯´æ¥ï¼Œä¸€ä¸ªè¿›ç¨‹å¹¶ä¸æ˜¯è‡ªå§‹è‡³ç»ˆè¿ç»­ä¸åœåœ°è¿è¡Œçš„ï¼Œå®ƒä¸å¹¶å‘æ‰§è¡Œä¸­çš„å…¶ä»–è¿›ç¨‹çš„æ‰§è¡Œæ˜¯ç›¸äº’åˆ¶çº¦çš„ã€‚\nå®ƒæœ‰æ—¶å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œæœ‰æ—¶åˆç”±äºæŸç§åŸå› è€Œæš‚åœè¿è¡Œå¤„äºç­‰å¾…çŠ¶æ€ï¼Œå½“ä½¿å®ƒæš‚åœçš„åŸå› æ¶ˆå¤±åï¼Œå®ƒåˆè¿›å…¥å‡†å¤‡è¿è¡ŒçŠ¶æ€ã€‚\næ‰€ä»¥ï¼Œåœ¨ä¸€ä¸ªè¿›ç¨‹çš„æ´»åŠ¨æœŸé—´è‡³å°‘å…·å¤‡ä¸‰ç§åŸºæœ¬çŠ¶æ€ï¼Œå³è¿è¡ŒçŠ¶æ€ã€å°±ç»ªçŠ¶æ€ã€é˜»å¡çŠ¶æ€ã€‚\nè¿›ç¨‹çš„ä¸‰ç§åŸºæœ¬çŠ¶æ€\nä¸Šå›¾ä¸­å„ä¸ªçŠ¶æ€çš„æ„ä¹‰ï¼š\nè¿è¡ŒçŠ¶æ€ï¼ˆRuningï¼‰ï¼šè¯¥æ—¶åˆ»è¿›ç¨‹å ç”¨ CPUï¼› å°±ç»ªçŠ¶æ€ï¼ˆReadyï¼‰ï¼šå¯è¿è¡Œï¼Œä½†å› ä¸ºå…¶ä»–è¿›ç¨‹æ­£åœ¨è¿è¡Œè€Œæš‚åœåœæ­¢ï¼› é˜»å¡çŠ¶æ€ï¼ˆBlockedï¼‰ï¼šè¯¥è¿›ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸€äº‹ä»¶å‘ç”Ÿï¼ˆå¦‚ç­‰å¾…è¾“å…¥/è¾“å‡ºæ“ä½œçš„å®Œæˆï¼‰è€Œæš‚æ—¶åœæ­¢è¿è¡Œï¼Œè¿™æ—¶ï¼Œå³ä½¿ç»™å®ƒCPUæ§åˆ¶æƒï¼Œå®ƒä¹Ÿæ— æ³•è¿è¡Œï¼› å½“ç„¶ï¼Œè¿›ç¨‹å¦å¤–ä¸¤ä¸ªåŸºæœ¬çŠ¶æ€ï¼š\nåˆ›å»ºçŠ¶æ€ï¼ˆnewï¼‰ï¼šè¿›ç¨‹æ­£åœ¨è¢«åˆ›å»ºæ—¶çš„çŠ¶æ€ï¼› ç»“æŸçŠ¶æ€ï¼ˆExitï¼‰ï¼šè¿›ç¨‹æ­£åœ¨ä»ç³»ç»Ÿä¸­æ¶ˆå¤±æ—¶çš„çŠ¶æ€ï¼› äºæ˜¯ï¼Œä¸€ä¸ªå®Œæ•´çš„è¿›ç¨‹çŠ¶æ€çš„å˜è¿å¦‚ä¸‹å›¾ï¼š\nè¿›ç¨‹äº”ç§çŠ¶æ€çš„å˜è¿\nå†æ¥è¯¦ç»†è¯´æ˜ä¸€ä¸‹è¿›ç¨‹çš„çŠ¶æ€å˜è¿ï¼š\nNULL -\u0026gt; åˆ›å»ºçŠ¶æ€ï¼šä¸€ä¸ªæ–°è¿›ç¨‹è¢«åˆ›å»ºæ—¶çš„ç¬¬ä¸€ä¸ªçŠ¶æ€ï¼› åˆ›å»ºçŠ¶æ€ -\u0026gt; å°±ç»ªçŠ¶æ€ï¼šå½“è¿›ç¨‹è¢«åˆ›å»ºå®Œæˆå¹¶åˆå§‹åŒ–åï¼Œä¸€åˆ‡å°±ç»ªå‡†å¤‡è¿è¡Œæ—¶ï¼Œå˜ä¸ºå°±ç»ªçŠ¶æ€ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ˆå¿«çš„ï¼› å°±ç»ªæ€ -\u0026gt; è¿è¡ŒçŠ¶æ€ï¼šå¤„äºå°±ç»ªçŠ¶æ€çš„è¿›ç¨‹è¢«æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹è°ƒåº¦å™¨é€‰ä¸­åï¼Œå°±åˆ†é…ç»™ CPU æ­£å¼è¿è¡Œè¯¥è¿›ç¨‹ï¼› è¿è¡ŒçŠ¶æ€ -\u0026gt; ç»“æŸçŠ¶æ€ï¼šå½“è¿›ç¨‹å·²ç»è¿è¡Œå®Œæˆæˆ–å‡ºé”™æ—¶ï¼Œä¼šè¢«æ“ä½œç³»ç»Ÿä½œç»“æŸçŠ¶æ€å¤„ç†ï¼› è¿è¡ŒçŠ¶æ€ -\u0026gt; å°±ç»ªçŠ¶æ€ï¼šå¤„äºè¿è¡ŒçŠ¶æ€çš„è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±äºåˆ†é…ç»™å®ƒçš„è¿è¡Œæ—¶é—´ç‰‡ç”¨å®Œï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠè¯¥è¿›ç¨‹å˜ä¸ºå°±ç»ªæ€ï¼Œæ¥ç€ä»å°±ç»ªæ€é€‰ä¸­å¦å¤–ä¸€ä¸ªè¿›ç¨‹è¿è¡Œï¼› è¿è¡ŒçŠ¶æ€ -\u0026gt; é˜»å¡çŠ¶æ€ï¼šå½“è¿›ç¨‹è¯·æ±‚æŸä¸ªäº‹ä»¶ä¸”å¿…é¡»ç­‰å¾…æ—¶ï¼Œä¾‹å¦‚è¯·æ±‚ I/O äº‹ä»¶ï¼› é˜»å¡çŠ¶æ€ -\u0026gt; å°±ç»ªçŠ¶æ€ï¼šå½“è¿›ç¨‹è¦ç­‰å¾…çš„äº‹ä»¶å®Œæˆæ—¶ï¼Œå®ƒä»é˜»å¡çŠ¶æ€å˜åˆ°å°±ç»ªçŠ¶æ€ï¼› å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªçŠ¶æ€å«æŒ‚èµ·çŠ¶æ€ï¼Œå®ƒè¡¨ç¤ºè¿›ç¨‹æ²¡æœ‰å æœ‰ç‰©ç†å†…å­˜ç©ºé—´ã€‚è¿™è·Ÿé˜»å¡çŠ¶æ€æ˜¯ä¸ä¸€æ ·ï¼Œé˜»å¡çŠ¶æ€æ˜¯ç­‰å¾…æŸä¸ªäº‹ä»¶çš„è¿”å›ã€‚\nç”±äºè™šæ‹Ÿå†…å­˜ç®¡ç†åŸå› ï¼Œè¿›ç¨‹çš„æ‰€ä½¿ç”¨çš„ç©ºé—´å¯èƒ½å¹¶æ²¡æœ‰æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼Œè€Œæ˜¯åœ¨ç¡¬ç›˜ä¸Šï¼Œè¿™æ—¶è¿›ç¨‹å°±ä¼šå‡ºç°æŒ‚èµ·çŠ¶æ€ï¼Œå¦å¤–è°ƒç”¨ sleep ä¹Ÿä¼šè¢«æŒ‚èµ·ã€‚\nè™šæ‹Ÿå†…å­˜ç®¡ç†-æ¢å…¥æ¢å‡º\næŒ‚èµ·çŠ¶æ€å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š\né˜»å¡æŒ‚èµ·çŠ¶æ€ï¼šè¿›ç¨‹åœ¨å¤–å­˜ï¼ˆç¡¬ç›˜ï¼‰å¹¶ç­‰å¾…æŸä¸ªäº‹ä»¶çš„å‡ºç°ï¼› å°±ç»ªæŒ‚èµ·çŠ¶æ€ï¼šè¿›ç¨‹åœ¨å¤–å­˜ï¼ˆç¡¬ç›˜ï¼‰ï¼Œä½†åªè¦è¿›å…¥å†…å­˜ï¼Œå³åˆ»ç«‹åˆ»è¿è¡Œï¼› è¿™ä¸¤ç§æŒ‚èµ·çŠ¶æ€åŠ ä¸Šå‰é¢çš„äº”ç§çŠ¶æ€ï¼Œå°±å˜æˆäº†ä¸ƒç§çŠ¶æ€å˜è¿ï¼ˆç•™ç»™æˆ‘çš„é¢œè‰²ä¸å¤šäº†ï¼‰ï¼Œè§å¦‚ä¸‹å›¾ï¼š\nä¸ƒç§çŠ¶æ€å˜è¿\nè¿›ç¨‹çš„æ§åˆ¶ç»“æ„ åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œæ˜¯ç”¨è¿›ç¨‹æ§åˆ¶å—ï¼ˆprocess control blockï¼ŒPCBï¼‰æ•°æ®ç»“æ„æ¥æè¿°è¿›ç¨‹çš„ã€‚\né‚£ PCB æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ‰“å¼€çŸ¥ä¹æœç´¢ä½ å°±ä¼šå‘ç°è¿™ä¸ªä¸œè¥¿å¹¶ä¸æ˜¯é‚£ä¹ˆç®€å•ã€‚\nçŸ¥ä¹æœ PCB çš„æç¤º\næ‰“ä½æ‰“ä½ï¼Œæˆ‘ä»¬æ˜¯ä¸ªæ­£ç»çš„äººï¼Œæ€ä¹ˆä¼šå»çœ‹é‚£äº›é—®é¢˜å‘¢ï¼Ÿæ˜¯å§ï¼Œå›æ¥å›æ¥ã€‚\nPCB æ˜¯è¿›ç¨‹å­˜åœ¨çš„å”¯ä¸€æ ‡è¯†ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªè¿›ç¨‹çš„å­˜åœ¨ï¼Œå¿…ç„¶ä¼šæœ‰ä¸€ä¸ª PCBï¼Œå¦‚æœè¿›ç¨‹æ¶ˆå¤±äº†ï¼Œé‚£ä¹ˆ PCB ä¹Ÿä¼šéšä¹‹æ¶ˆå¤±ã€‚\nPCB å…·ä½“åŒ…å«ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿ\nè¿›ç¨‹æè¿°ä¿¡æ¯ï¼š\nè¿›ç¨‹æ ‡è¯†ç¬¦ï¼šæ ‡è¯†å„ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªå¹¶ä¸”å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼› ç”¨æˆ·æ ‡è¯†ç¬¦ï¼šè¿›ç¨‹å½’å±çš„ç”¨æˆ·ï¼Œç”¨æˆ·æ ‡è¯†ç¬¦ä¸»è¦ä¸ºå…±äº«å’Œä¿æŠ¤æœåŠ¡ï¼› è¿›ç¨‹æ§åˆ¶å’Œç®¡ç†ä¿¡æ¯ï¼š\nè¿›ç¨‹å½“å‰çŠ¶æ€ï¼Œå¦‚ newã€readyã€runningã€waiting æˆ– blocked ç­‰ï¼› è¿›ç¨‹ä¼˜å…ˆçº§ï¼šè¿›ç¨‹æŠ¢å  CPU æ—¶çš„ä¼˜å…ˆçº§ï¼› èµ„æºåˆ†é…æ¸…å•ï¼š\næœ‰å…³å†…å­˜åœ°å€ç©ºé—´æˆ–è™šæ‹Ÿåœ°å€ç©ºé—´çš„ä¿¡æ¯ï¼Œæ‰€æ‰“å¼€æ–‡ä»¶çš„åˆ—è¡¨å’Œæ‰€ä½¿ç”¨çš„ I/O è®¾å¤‡ä¿¡æ¯ã€‚ CPU ç›¸å…³ä¿¡æ¯ï¼š\nCPU ä¸­å„ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œå½“è¿›ç¨‹è¢«åˆ‡æ¢æ—¶ï¼ŒCPU çš„çŠ¶æ€ä¿¡æ¯éƒ½ä¼šè¢«ä¿å­˜åœ¨ç›¸åº”çš„ PCB ä¸­ï¼Œä»¥ä¾¿è¿›ç¨‹é‡æ–°æ‰§è¡Œæ—¶ï¼Œèƒ½ä»æ–­ç‚¹å¤„ç»§ç»­æ‰§è¡Œã€‚ å¯è§ï¼ŒPCB åŒ…å«ä¿¡æ¯è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ã€‚\næ¯ä¸ª PCB æ˜¯å¦‚ä½•ç»„ç»‡çš„å‘¢ï¼Ÿ\né€šå¸¸æ˜¯é€šè¿‡é“¾è¡¨çš„æ–¹å¼è¿›è¡Œç»„ç»‡ï¼ŒæŠŠå…·æœ‰ç›¸åŒçŠ¶æ€çš„è¿›ç¨‹é“¾åœ¨ä¸€èµ·ï¼Œç»„æˆå„ç§é˜Ÿåˆ—ã€‚æ¯”å¦‚ï¼š\nå°†æ‰€æœ‰å¤„äºå°±ç»ªçŠ¶æ€çš„è¿›ç¨‹é“¾åœ¨ä¸€èµ·ï¼Œç§°ä¸ºå°±ç»ªé˜Ÿåˆ—ï¼› æŠŠæ‰€æœ‰å› ç­‰å¾…æŸäº‹ä»¶è€Œå¤„äºç­‰å¾…çŠ¶æ€çš„è¿›ç¨‹é“¾åœ¨ä¸€èµ·å°±ç»„æˆå„ç§é˜»å¡é˜Ÿåˆ—ï¼› å¦å¤–ï¼Œå¯¹äºè¿è¡Œé˜Ÿåˆ—åœ¨å•æ ¸ CPU ç³»ç»Ÿä¸­åˆ™åªæœ‰ä¸€ä¸ªè¿è¡ŒæŒ‡é’ˆäº†ï¼Œå› ä¸ºå•æ ¸ CPU åœ¨æŸä¸ªæ—¶é—´ï¼Œåªèƒ½è¿è¡Œä¸€ä¸ªç¨‹åºã€‚ é‚£ä¹ˆï¼Œå°±ç»ªé˜Ÿåˆ—å’Œé˜»å¡é˜Ÿåˆ—é“¾è¡¨çš„ç»„ç»‡å½¢å¼å¦‚ä¸‹å›¾ï¼š\nå°±ç»ªé˜Ÿåˆ—å’Œé˜»å¡é˜Ÿåˆ—\né™¤äº†é“¾æ¥çš„ç»„ç»‡æ–¹å¼ï¼Œè¿˜æœ‰ç´¢å¼•æ–¹å¼ï¼Œå®ƒçš„å·¥ä½œåŸç†ï¼šå°†åŒä¸€çŠ¶æ€çš„è¿›ç¨‹ç»„ç»‡åœ¨ä¸€ä¸ªç´¢å¼•è¡¨ä¸­ï¼Œç´¢å¼•è¡¨é¡¹æŒ‡å‘ç›¸åº”çš„ PCBï¼Œä¸åŒçŠ¶æ€å¯¹åº”ä¸åŒçš„ç´¢å¼•è¡¨ã€‚\nä¸€èˆ¬ä¼šé€‰æ‹©é“¾è¡¨ï¼Œå› ä¸ºå¯èƒ½é¢ä¸´è¿›ç¨‹åˆ›å»ºï¼Œé”€æ¯ç­‰è°ƒåº¦å¯¼è‡´è¿›ç¨‹çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥é“¾è¡¨èƒ½å¤Ÿæ›´åŠ çµæ´»çš„æ’å…¥å’Œåˆ é™¤ã€‚\nè¿›ç¨‹çš„æ§åˆ¶ æˆ‘ä»¬ç†ŸçŸ¥äº†è¿›ç¨‹çš„çŠ¶æ€å˜è¿å’Œè¿›ç¨‹çš„æ•°æ®ç»“æ„ PCB åï¼Œå†æ¥çœ‹çœ‹è¿›ç¨‹çš„åˆ›å»ºã€ç»ˆæ­¢ã€é˜»å¡ã€å”¤é†’çš„è¿‡ç¨‹ï¼Œè¿™äº›è¿‡ç¨‹ä¹Ÿå°±æ˜¯è¿›ç¨‹çš„æ§åˆ¶ã€‚\n01 åˆ›å»ºè¿›ç¨‹\næ“ä½œç³»ç»Ÿå…è®¸ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºå¦ä¸€ä¸ªè¿›ç¨‹ï¼Œè€Œä¸”å…è®¸å­è¿›ç¨‹ç»§æ‰¿çˆ¶è¿›ç¨‹æ‰€æ‹¥æœ‰çš„èµ„æºï¼Œå½“å­è¿›ç¨‹è¢«ç»ˆæ­¢æ—¶ï¼Œå…¶åœ¨çˆ¶è¿›ç¨‹å¤„ç»§æ‰¿çš„èµ„æºåº”å½“è¿˜ç»™çˆ¶è¿›ç¨‹ã€‚åŒæ—¶ï¼Œç»ˆæ­¢çˆ¶è¿›ç¨‹æ—¶åŒæ—¶ä¹Ÿä¼šç»ˆæ­¢å…¶æ‰€æœ‰çš„å­è¿›ç¨‹ã€‚\nåˆ›å»ºè¿›ç¨‹çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š\nä¸ºæ–°è¿›ç¨‹åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„è¿›ç¨‹æ ‡è¯†å·ï¼Œå¹¶ç”³è¯·ä¸€ä¸ªç©ºç™½çš„ PCBï¼ŒPCB æ˜¯æœ‰é™çš„ï¼Œè‹¥ç”³è¯·å¤±è´¥åˆ™åˆ›å»ºå¤±è´¥ï¼› ä¸ºè¿›ç¨‹åˆ†é…èµ„æºï¼Œæ­¤å¤„å¦‚æœèµ„æºä¸è¶³ï¼Œè¿›ç¨‹å°±ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œä»¥ç­‰å¾…èµ„æºï¼› åˆå§‹åŒ– PCBï¼› å¦‚æœè¿›ç¨‹çš„è°ƒåº¦é˜Ÿåˆ—èƒ½å¤Ÿæ¥çº³æ–°è¿›ç¨‹ï¼Œé‚£å°±å°†è¿›ç¨‹æ’å…¥åˆ°å°±ç»ªé˜Ÿåˆ—ï¼Œç­‰å¾…è¢«è°ƒåº¦è¿è¡Œï¼› 02 ç»ˆæ­¢è¿›ç¨‹\nè¿›ç¨‹å¯ä»¥æœ‰ 3 ç§ç»ˆæ­¢æ–¹å¼ï¼šæ­£å¸¸ç»“æŸã€å¼‚å¸¸ç»“æŸä»¥åŠå¤–ç•Œå¹²é¢„ï¼ˆä¿¡å· kill æ‰ï¼‰ã€‚\nç»ˆæ­¢è¿›ç¨‹çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š\næŸ¥æ‰¾éœ€è¦ç»ˆæ­¢çš„è¿›ç¨‹çš„ PCBï¼› å¦‚æœå¤„äºæ‰§è¡ŒçŠ¶æ€ï¼Œåˆ™ç«‹å³ç»ˆæ­¢è¯¥è¿›ç¨‹çš„æ‰§è¡Œï¼Œç„¶åå°† CPU èµ„æºåˆ†é…ç»™å…¶ä»–è¿›ç¨‹ï¼› å¦‚æœå…¶è¿˜æœ‰å­è¿›ç¨‹ï¼Œåˆ™åº”å°†å…¶æ‰€æœ‰å­è¿›ç¨‹ç»ˆæ­¢ï¼› å°†è¯¥è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å…¨éƒ¨èµ„æºéƒ½å½’è¿˜ç»™çˆ¶è¿›ç¨‹æˆ–æ“ä½œç³»ç»Ÿï¼› å°†å…¶ä» PCB æ‰€åœ¨é˜Ÿåˆ—ä¸­åˆ é™¤ï¼› 03 é˜»å¡è¿›ç¨‹\nå½“è¿›ç¨‹éœ€è¦ç­‰å¾…æŸä¸€äº‹ä»¶å®Œæˆæ—¶ï¼Œå®ƒå¯ä»¥è°ƒç”¨é˜»å¡è¯­å¥æŠŠè‡ªå·±é˜»å¡ç­‰å¾…ã€‚è€Œä¸€æ—¦è¢«é˜»å¡ç­‰å¾…ï¼Œå®ƒåªèƒ½ç”±å¦ä¸€ä¸ªè¿›ç¨‹å”¤é†’ã€‚\né˜»å¡è¿›ç¨‹çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š\næ‰¾åˆ°å°†è¦è¢«é˜»å¡è¿›ç¨‹æ ‡è¯†å·å¯¹åº”çš„ PCBï¼› å¦‚æœè¯¥è¿›ç¨‹ä¸ºè¿è¡ŒçŠ¶æ€ï¼Œåˆ™ä¿æŠ¤å…¶ç°åœºï¼Œå°†å…¶çŠ¶æ€è½¬ä¸ºé˜»å¡çŠ¶æ€ï¼Œåœæ­¢è¿è¡Œï¼› å°†è¯¥ PCB æ’å…¥çš„é˜»å¡é˜Ÿåˆ—ä¸­å»ï¼› 04 å”¤é†’è¿›ç¨‹\nè¿›ç¨‹ç”±ã€Œè¿è¡Œã€è½¬å˜ä¸ºã€Œé˜»å¡ã€çŠ¶æ€æ˜¯ç”±äºè¿›ç¨‹å¿…é¡»ç­‰å¾…æŸä¸€äº‹ä»¶çš„å®Œæˆï¼Œæ‰€ä»¥å¤„äºé˜»å¡çŠ¶æ€çš„è¿›ç¨‹æ˜¯ç»å¯¹ä¸å¯èƒ½å«é†’è‡ªå·±çš„ã€‚\nå¦‚æœæŸè¿›ç¨‹æ­£åœ¨ç­‰å¾… I/O äº‹ä»¶ï¼Œéœ€ç”±åˆ«çš„è¿›ç¨‹å‘æ¶ˆæ¯ç»™å®ƒï¼Œåˆ™åªæœ‰å½“è¯¥è¿›ç¨‹æ‰€æœŸå¾…çš„äº‹ä»¶å‡ºç°æ—¶ï¼Œæ‰ç”±å‘ç°è€…è¿›ç¨‹ç”¨å”¤é†’è¯­å¥å«é†’å®ƒã€‚\nå”¤é†’è¿›ç¨‹çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š\nåœ¨è¯¥äº‹ä»¶çš„é˜»å¡é˜Ÿåˆ—ä¸­æ‰¾åˆ°ç›¸åº”è¿›ç¨‹çš„ PCBï¼› å°†å…¶ä»é˜»å¡é˜Ÿåˆ—ä¸­ç§»å‡ºï¼Œå¹¶ç½®å…¶çŠ¶æ€ä¸ºå°±ç»ªçŠ¶æ€ï¼› æŠŠè¯¥ PCB æ’å…¥åˆ°å°±ç»ªé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è°ƒåº¦ç¨‹åºè°ƒåº¦ï¼› è¿›ç¨‹çš„é˜»å¡å’Œå”¤é†’æ˜¯ä¸€å¯¹åŠŸèƒ½ç›¸åçš„è¯­å¥ï¼Œå¦‚æœæŸä¸ªè¿›ç¨‹è°ƒç”¨äº†é˜»å¡è¯­å¥ï¼Œåˆ™å¿…æœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„å”¤é†’è¯­å¥ã€‚\nè¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ å„ä¸ªè¿›ç¨‹ä¹‹é—´æ˜¯å…±äº« CPU èµ„æºçš„ï¼Œåœ¨ä¸åŒçš„æ—¶å€™è¿›ç¨‹ä¹‹é—´éœ€è¦åˆ‡æ¢ï¼Œè®©ä¸åŒçš„è¿›ç¨‹å¯ä»¥åœ¨ CPU æ‰§è¡Œï¼Œé‚£ä¹ˆè¿™ä¸ªä¸€ä¸ªè¿›ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹è¿è¡Œï¼Œç§°ä¸ºè¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚\nåœ¨è¯¦ç»†è¯´è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢\nå¤§å¤šæ•°æ“ä½œç³»ç»Ÿéƒ½æ˜¯å¤šä»»åŠ¡ï¼Œé€šå¸¸æ”¯æŒå¤§äº CPU æ•°é‡çš„ä»»åŠ¡åŒæ—¶è¿è¡Œã€‚å®é™…ä¸Šï¼Œè¿™äº›ä»»åŠ¡å¹¶ä¸æ˜¯åŒæ—¶è¿è¡Œçš„ï¼Œåªæ˜¯å› ä¸ºç³»ç»Ÿåœ¨å¾ˆçŸ­çš„æ—¶é—´å†…ï¼Œè®©å„ä¸ªä»»åŠ¡åˆ†åˆ«åœ¨ CPU è¿è¡Œï¼Œäºæ˜¯å°±é€ æˆåŒæ—¶è¿è¡Œçš„é”™è§‰ã€‚\nä»»åŠ¡æ˜¯äº¤ç»™ CPU è¿è¡Œçš„ï¼Œé‚£ä¹ˆåœ¨æ¯ä¸ªä»»åŠ¡è¿è¡Œå‰ï¼ŒCPU éœ€è¦çŸ¥é“ä»»åŠ¡ä»å“ªé‡ŒåŠ è½½ï¼Œåˆä»å“ªé‡Œå¼€å§‹è¿è¡Œã€‚\næ‰€ä»¥ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦äº‹å…ˆå¸® CPU è®¾ç½®å¥½ CPU å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨ã€‚\nCPU å¯„å­˜å™¨æ˜¯ CPU å†…éƒ¨ä¸€ä¸ªå®¹é‡å°ï¼Œä½†æ˜¯é€Ÿåº¦æå¿«çš„å†…å­˜ï¼ˆç¼“å­˜ï¼‰ã€‚æˆ‘ä¸¾ä¸ªä¾‹å­ï¼Œå¯„å­˜å™¨åƒæ˜¯ä½ çš„å£è¢‹ï¼Œå†…å­˜åƒä½ çš„ä¹¦åŒ…ï¼Œç¡¬ç›˜åˆ™æ˜¯ä½ å®¶é‡Œçš„æŸœå­ï¼Œå¦‚æœä½ çš„ä¸œè¥¿å­˜æ”¾åˆ°å£è¢‹ï¼Œé‚£è‚¯å®šæ˜¯æ¯”ä½ ä»ä¹¦åŒ…æˆ–å®¶é‡ŒæŸœå­å–å‡ºæ¥è¦å¿«çš„å¤šã€‚\nå†æ¥ï¼Œç¨‹åºè®¡æ•°å™¨åˆ™æ˜¯ç”¨æ¥å­˜å‚¨ CPU æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ä½ç½®ã€æˆ–è€…å³å°†æ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤ä½ç½®ã€‚\næ‰€ä»¥è¯´ï¼ŒCPU å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°æ˜¯ CPU åœ¨è¿è¡Œä»»ä½•ä»»åŠ¡å‰ï¼Œæ‰€å¿…é¡»ä¾èµ–çš„ç¯å¢ƒï¼Œè¿™äº›ç¯å¢ƒå°±å«åš CPU ä¸Šä¸‹æ–‡ã€‚\næ—¢ç„¶çŸ¥é“äº†ä»€ä¹ˆæ˜¯ CPU ä¸Šä¸‹æ–‡ï¼Œé‚£ç†è§£ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢å°±ä¸éš¾äº†ã€‚\nCPU ä¸Šä¸‹æ–‡åˆ‡æ¢å°±æ˜¯å…ˆæŠŠå‰ä¸€ä¸ªä»»åŠ¡çš„ CPU ä¸Šä¸‹æ–‡ï¼ˆCPU å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨ï¼‰ä¿å­˜èµ·æ¥ï¼Œç„¶ååŠ è½½æ–°ä»»åŠ¡çš„ä¸Šä¸‹æ–‡åˆ°è¿™äº›å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨ï¼Œæœ€åå†è·³è½¬åˆ°ç¨‹åºè®¡æ•°å™¨æ‰€æŒ‡çš„æ–°ä½ç½®ï¼Œè¿è¡Œæ–°ä»»åŠ¡ã€‚\nç³»ç»Ÿå†…æ ¸ä¼šå­˜å‚¨ä¿æŒä¸‹æ¥çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå½“æ­¤ä»»åŠ¡å†æ¬¡è¢«åˆ†é…ç»™ CPU è¿è¡Œæ—¶ï¼ŒCPU ä¼šé‡æ–°åŠ è½½è¿™äº›ä¸Šä¸‹æ–‡ï¼Œè¿™æ ·å°±èƒ½ä¿è¯ä»»åŠ¡åŸæ¥çš„çŠ¶æ€ä¸å—å½±å“ï¼Œè®©ä»»åŠ¡çœ‹èµ·æ¥è¿˜æ˜¯è¿ç»­è¿è¡Œã€‚\nä¸Šé¢è¯´åˆ°æ‰€è°“çš„ã€Œä»»åŠ¡ã€ï¼Œä¸»è¦åŒ…å«è¿›ç¨‹ã€çº¿ç¨‹å’Œä¸­æ–­ã€‚æ‰€ä»¥ï¼Œå¯ä»¥æ ¹æ®ä»»åŠ¡çš„ä¸åŒï¼ŒæŠŠ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢åˆ†æˆï¼šè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ã€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚\nè¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°åº•æ˜¯åˆ‡æ¢ä»€ä¹ˆå‘¢ï¼Ÿ\nè¿›ç¨‹æ˜¯ç”±å†…æ ¸ç®¡ç†å’Œè°ƒåº¦çš„ï¼Œæ‰€ä»¥è¿›ç¨‹çš„åˆ‡æ¢åªèƒ½å‘ç”Ÿåœ¨å†…æ ¸æ€ã€‚\næ‰€ä»¥ï¼Œè¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸ä»…åŒ…å«äº†è™šæ‹Ÿå†…å­˜ã€æ ˆã€å…¨å±€å˜é‡ç­‰ç”¨æˆ·ç©ºé—´çš„èµ„æºï¼Œè¿˜åŒ…æ‹¬äº†å†…æ ¸å †æ ˆã€å¯„å­˜å™¨ç­‰å†…æ ¸ç©ºé—´çš„èµ„æºã€‚\né€šå¸¸ï¼Œä¼šæŠŠäº¤æ¢çš„ä¿¡æ¯ä¿å­˜åœ¨è¿›ç¨‹çš„ PCBï¼Œå½“è¦è¿è¡Œå¦å¤–ä¸€ä¸ªè¿›ç¨‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ä»è¿™ä¸ªè¿›ç¨‹çš„ PCB å–å‡ºä¸Šä¸‹æ–‡ï¼Œç„¶åæ¢å¤åˆ° CPU ä¸­ï¼Œè¿™ä½¿å¾—è¿™ä¸ªè¿›ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢\nå¤§å®¶éœ€è¦æ³¨æ„ï¼Œè¿›ç¨‹çš„ä¸Šä¸‹æ–‡å¼€é”€æ˜¯å¾ˆå…³é”®çš„ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒçš„å¼€é”€è¶Šå°è¶Šå¥½ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—è¿›ç¨‹å¯ä»¥æŠŠæ›´å¤šæ—¶é—´èŠ±è´¹åœ¨æ‰§è¡Œç¨‹åºä¸Šï¼Œè€Œä¸æ˜¯è€—è´¹åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚\nå‘ç”Ÿè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æœ‰å“ªäº›åœºæ™¯ï¼Ÿ\nä¸ºäº†ä¿è¯æ‰€æœ‰è¿›ç¨‹å¯ä»¥å¾—åˆ°å…¬å¹³è°ƒåº¦ï¼ŒCPU æ—¶é—´è¢«åˆ’åˆ†ä¸ºä¸€æ®µæ®µçš„æ—¶é—´ç‰‡ï¼Œè¿™äº›æ—¶é—´ç‰‡å†è¢«è½®æµåˆ†é…ç»™å„ä¸ªè¿›ç¨‹ã€‚è¿™æ ·ï¼Œå½“æŸä¸ªè¿›ç¨‹çš„æ—¶é—´ç‰‡è€—å°½äº†ï¼Œå°±ä¼šè¢«ç³»ç»ŸæŒ‚èµ·ï¼Œåˆ‡æ¢åˆ°å…¶å®ƒæ­£åœ¨ç­‰å¾… CPU çš„è¿›ç¨‹è¿è¡Œï¼› è¿›ç¨‹åœ¨ç³»ç»Ÿèµ„æºä¸è¶³ï¼ˆæ¯”å¦‚å†…å­˜ä¸è¶³ï¼‰æ—¶ï¼Œè¦ç­‰åˆ°èµ„æºæ»¡è¶³åæ‰å¯ä»¥è¿è¡Œï¼Œè¿™ä¸ªæ—¶å€™è¿›ç¨‹ä¹Ÿä¼šè¢«æŒ‚èµ·ï¼Œå¹¶ç”±ç³»ç»Ÿè°ƒåº¦å…¶ä»–è¿›ç¨‹è¿è¡Œï¼› å½“è¿›ç¨‹é€šè¿‡ç¡çœ å‡½æ•° sleep è¿™æ ·çš„æ–¹æ³•å°†è‡ªå·±ä¸»åŠ¨æŒ‚èµ·æ—¶ï¼Œè‡ªç„¶ä¹Ÿä¼šé‡æ–°è°ƒåº¦ï¼› å½“æœ‰ä¼˜å…ˆçº§æ›´é«˜çš„è¿›ç¨‹è¿è¡Œæ—¶ï¼Œä¸ºäº†ä¿è¯é«˜ä¼˜å…ˆçº§è¿›ç¨‹çš„è¿è¡Œï¼Œå½“å‰è¿›ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œç”±é«˜ä¼˜å…ˆçº§è¿›ç¨‹æ¥è¿è¡Œï¼› å‘ç”Ÿç¡¬ä»¶ä¸­æ–­æ—¶ï¼ŒCPU ä¸Šçš„è¿›ç¨‹ä¼šè¢«ä¸­æ–­æŒ‚èµ·ï¼Œè½¬è€Œæ‰§è¡Œå†…æ ¸ä¸­çš„ä¸­æ–­æœåŠ¡ç¨‹åºï¼› ä»¥ä¸Šï¼Œå°±æ˜¯å‘ç”Ÿè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¸¸è§åœºæ™¯äº†ã€‚\nçº¿ç¨‹ åœ¨æ—©æœŸçš„æ“ä½œç³»ç»Ÿä¸­éƒ½æ˜¯ä»¥è¿›ç¨‹ä½œä¸ºç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½ï¼Œç›´åˆ°åé¢ï¼Œè®¡ç®—æœºç§‘å­¦å®¶ä»¬åˆæå‡ºäº†æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹ã€‚\nä¸ºä»€ä¹ˆä½¿ç”¨çº¿ç¨‹ï¼Ÿ æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½ è¦ç¼–å†™ä¸€ä¸ªè§†é¢‘æ’­æ”¾å™¨è½¯ä»¶ï¼Œé‚£ä¹ˆè¯¥è½¯ä»¶åŠŸèƒ½çš„æ ¸å¿ƒæ¨¡å—æœ‰ä¸‰ä¸ªï¼š\nä»è§†é¢‘æ–‡ä»¶å½“ä¸­è¯»å–æ•°æ®ï¼› å¯¹è¯»å–çš„æ•°æ®è¿›è¡Œè§£å‹ç¼©ï¼› æŠŠè§£å‹ç¼©åçš„è§†é¢‘æ•°æ®æ’­æ”¾å‡ºæ¥ï¼› å¯¹äºå•è¿›ç¨‹çš„å®ç°æ–¹å¼ï¼Œæˆ‘æƒ³å¤§å®¶éƒ½ä¼šæ˜¯ä»¥ä¸‹è¿™ä¸ªæ–¹å¼ï¼š\nå•è¿›ç¨‹å®ç°æ–¹å¼\nå¯¹äºå•è¿›ç¨‹çš„è¿™ç§æ–¹å¼ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š\næ’­æ”¾å‡ºæ¥çš„ç”»é¢å’Œå£°éŸ³ä¼šä¸è¿è´¯ï¼Œå› ä¸ºå½“ CPU èƒ½åŠ›ä¸å¤Ÿå¼ºçš„æ—¶å€™ï¼ŒRead çš„æ—¶å€™å¯èƒ½è¿›ç¨‹å°±ç­‰åœ¨è¿™äº†ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ç­‰åŠå¤©æ‰è¿›è¡Œæ•°æ®è§£å‹å’Œæ’­æ”¾ï¼› å„ä¸ªå‡½æ•°ä¹‹é—´ä¸æ˜¯å¹¶å‘æ‰§è¡Œï¼Œå½±å“èµ„æºçš„ä½¿ç”¨æ•ˆç‡ï¼› é‚£æ”¹è¿›æˆå¤šè¿›ç¨‹çš„æ–¹å¼ï¼š\nå¤šè¿›ç¨‹å®ç°æ–¹å¼\nå¯¹äºå¤šè¿›ç¨‹çš„è¿™ç§æ–¹å¼ï¼Œä¾ç„¶ä¼šå­˜åœ¨é—®é¢˜ï¼š\nè¿›ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡ï¼Œå…±äº«æ•°æ®ï¼Ÿ ç»´æŠ¤è¿›ç¨‹çš„ç³»ç»Ÿå¼€é”€è¾ƒå¤§ï¼Œå¦‚åˆ›å»ºè¿›ç¨‹æ—¶ï¼Œåˆ†é…èµ„æºã€å»ºç«‹ PCBï¼›ç»ˆæ­¢è¿›ç¨‹æ—¶ï¼Œå›æ”¶èµ„æºã€æ’¤é”€ PCBï¼›è¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œä¿å­˜å½“å‰è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼› é‚£åˆ°åº•å¦‚ä½•è§£å†³å‘¢ï¼Ÿéœ€è¦æœ‰ä¸€ç§æ–°çš„å®ä½“ï¼Œæ»¡è¶³ä»¥ä¸‹ç‰¹æ€§ï¼š\nå®ä½“ä¹‹é—´å¯ä»¥å¹¶å‘è¿è¡Œï¼› å®ä½“ä¹‹é—´å…±äº«ç›¸åŒçš„åœ°å€ç©ºé—´ï¼› è¿™ä¸ªæ–°çš„å®ä½“ï¼Œå°±æ˜¯çº¿ç¨‹( *Thread* )ï¼Œçº¿ç¨‹ä¹‹é—´å¯ä»¥å¹¶å‘è¿è¡Œä¸”å…±äº«ç›¸åŒçš„åœ°å€ç©ºé—´ã€‚\nä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ çº¿ç¨‹æ˜¯è¿›ç¨‹å½“ä¸­çš„ä¸€æ¡æ‰§è¡Œæµç¨‹ã€‚\nåŒä¸€ä¸ªè¿›ç¨‹å†…å¤šä¸ªçº¿ç¨‹ä¹‹é—´å¯ä»¥å…±äº«ä»£ç æ®µã€æ•°æ®æ®µã€æ‰“å¼€çš„æ–‡ä»¶ç­‰èµ„æºï¼Œä½†æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ç‹¬ç«‹ä¸€å¥—çš„å¯„å­˜å™¨å’Œæ ˆï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿çº¿ç¨‹çš„æ§åˆ¶æµæ˜¯ç›¸å¯¹ç‹¬ç«‹çš„ã€‚\nå¤šçº¿ç¨‹\nçº¿ç¨‹çš„ä¼˜ç¼ºç‚¹ï¼Ÿ\nçº¿ç¨‹çš„ä¼˜ç‚¹ï¼š\nä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ªçº¿ç¨‹ï¼› å„ä¸ªçº¿ç¨‹ä¹‹é—´å¯ä»¥å¹¶å‘æ‰§è¡Œï¼› å„ä¸ªçº¿ç¨‹ä¹‹é—´å¯ä»¥å…±äº«åœ°å€ç©ºé—´å’Œæ–‡ä»¶ç­‰èµ„æºï¼› çº¿ç¨‹çš„ç¼ºç‚¹ï¼š\nå½“è¿›ç¨‹ä¸­çš„ä¸€ä¸ªçº¿ç¨‹å¥”æºƒæ—¶ï¼Œä¼šå¯¼è‡´å…¶æ‰€å±è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹å¥”æºƒã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå¯¹äºæ¸¸æˆçš„ç”¨æˆ·è®¾è®¡ï¼Œåˆ™ä¸åº”è¯¥ä½¿ç”¨å¤šçº¿ç¨‹çš„æ–¹å¼ï¼Œå¦åˆ™ä¸€ä¸ªç”¨æˆ·æŒ‚äº†ï¼Œä¼šå½±å“å…¶ä»–åŒä¸ªè¿›ç¨‹çš„çº¿ç¨‹ã€‚\nçº¿ç¨‹ä¸è¿›ç¨‹çš„æ¯”è¾ƒ çº¿ç¨‹ä¸è¿›ç¨‹çš„æ¯”è¾ƒå¦‚ä¸‹ï¼š\nè¿›ç¨‹æ˜¯èµ„æºï¼ˆåŒ…æ‹¬å†…å­˜ã€æ‰“å¼€çš„æ–‡ä»¶ç­‰ï¼‰åˆ†é…çš„å•ä½ï¼Œçº¿ç¨‹æ˜¯ CPU è°ƒåº¦çš„å•ä½ï¼› è¿›ç¨‹æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„èµ„æºå¹³å°ï¼Œè€Œçº¿ç¨‹åªç‹¬äº«å¿…ä¸å¯å°‘çš„èµ„æºï¼Œå¦‚å¯„å­˜å™¨å’Œæ ˆï¼› çº¿ç¨‹åŒæ ·å…·æœ‰å°±ç»ªã€é˜»å¡ã€æ‰§è¡Œä¸‰ç§åŸºæœ¬çŠ¶æ€ï¼ŒåŒæ ·å…·æœ‰çŠ¶æ€ä¹‹é—´çš„è½¬æ¢å…³ç³»ï¼› çº¿ç¨‹èƒ½å‡å°‘å¹¶å‘æ‰§è¡Œçš„æ—¶é—´å’Œç©ºé—´å¼€é”€ï¼› å¯¹äºï¼Œçº¿ç¨‹ç›¸æ¯”è¿›ç¨‹èƒ½å‡å°‘å¼€é”€ï¼Œä½“ç°åœ¨ï¼š\nçº¿ç¨‹çš„åˆ›å»ºæ—¶é—´æ¯”è¿›ç¨‹å¿«ï¼Œå› ä¸ºè¿›ç¨‹åœ¨åˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œè¿˜éœ€è¦èµ„æºç®¡ç†ä¿¡æ¯ï¼Œæ¯”å¦‚å†…å­˜ç®¡ç†ä¿¡æ¯ã€æ–‡ä»¶ç®¡ç†ä¿¡æ¯ï¼Œè€Œçº¿ç¨‹åœ¨åˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šæ¶‰åŠè¿™äº›èµ„æºç®¡ç†ä¿¡æ¯ï¼Œè€Œæ˜¯å…±äº«å®ƒä»¬ï¼› çº¿ç¨‹çš„ç»ˆæ­¢æ—¶é—´æ¯”è¿›ç¨‹å¿«ï¼Œå› ä¸ºçº¿ç¨‹é‡Šæ”¾çš„èµ„æºç›¸æ¯”è¿›ç¨‹å°‘å¾ˆå¤šï¼› åŒä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹åˆ‡æ¢æ¯”è¿›ç¨‹åˆ‡æ¢å¿«ï¼Œå› ä¸ºçº¿ç¨‹å…·æœ‰ç›¸åŒçš„åœ°å€ç©ºé—´ï¼ˆè™šæ‹Ÿå†…å­˜å…±äº«ï¼‰ï¼Œè¿™æ„å‘³ç€åŒä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹éƒ½å…·æœ‰åŒä¸€ä¸ªé¡µè¡¨ï¼Œé‚£ä¹ˆåœ¨åˆ‡æ¢çš„æ—¶å€™ä¸éœ€è¦åˆ‡æ¢é¡µè¡¨ã€‚è€Œå¯¹äºè¿›ç¨‹ä¹‹é—´çš„åˆ‡æ¢ï¼Œåˆ‡æ¢çš„æ—¶å€™è¦æŠŠé¡µè¡¨ç»™åˆ‡æ¢æ‰ï¼Œè€Œé¡µè¡¨çš„åˆ‡æ¢è¿‡ç¨‹å¼€é”€æ˜¯æ¯”è¾ƒå¤§çš„ï¼› ç”±äºåŒä¸€è¿›ç¨‹çš„å„çº¿ç¨‹é—´å…±äº«å†…å­˜å’Œæ–‡ä»¶èµ„æºï¼Œé‚£ä¹ˆåœ¨çº¿ç¨‹ä¹‹é—´æ•°æ®ä¼ é€’çš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦ç»è¿‡å†…æ ¸äº†ï¼Œè¿™å°±ä½¿å¾—çº¿ç¨‹ä¹‹é—´çš„æ•°æ®äº¤äº’æ•ˆç‡æ›´é«˜äº†ï¼› æ‰€ä»¥ï¼Œçº¿ç¨‹æ¯”è¿›ç¨‹ä¸ç®¡æ˜¯æ—¶é—´æ•ˆç‡ï¼Œè¿˜æ˜¯ç©ºé—´æ•ˆç‡éƒ½è¦é«˜ã€‚\nçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ åœ¨å‰é¢æˆ‘ä»¬çŸ¥é“äº†ï¼Œçº¿ç¨‹ä¸è¿›ç¨‹æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼šçº¿ç¨‹æ˜¯è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œè€Œè¿›ç¨‹åˆ™æ˜¯èµ„æºæ‹¥æœ‰çš„åŸºæœ¬å•ä½ã€‚\næ‰€ä»¥ï¼Œæ‰€è°“æ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦ï¼Œå®é™…ä¸Šçš„è°ƒåº¦å¯¹è±¡æ˜¯çº¿ç¨‹ï¼Œè€Œè¿›ç¨‹åªæ˜¯ç»™çº¿ç¨‹æä¾›äº†è™šæ‹Ÿå†…å­˜ã€å…¨å±€å˜é‡ç­‰èµ„æºã€‚\nå¯¹äºçº¿ç¨‹å’Œè¿›ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç†è§£ï¼š\nå½“è¿›ç¨‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œå¯ä»¥è®¤ä¸ºè¿›ç¨‹å°±ç­‰äºçº¿ç¨‹ï¼› å½“è¿›ç¨‹æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹æ—¶ï¼Œè¿™äº›çº¿ç¨‹ä¼šå…±äº«ç›¸åŒçš„è™šæ‹Ÿå†…å­˜å’Œå…¨å±€å˜é‡ç­‰èµ„æºï¼Œè¿™äº›èµ„æºåœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶æ˜¯ä¸éœ€è¦ä¿®æ”¹çš„ï¼› å¦å¤–ï¼Œçº¿ç¨‹ä¹Ÿæœ‰è‡ªå·±çš„ç§æœ‰æ•°æ®ï¼Œæ¯”å¦‚æ ˆå’Œå¯„å­˜å™¨ç­‰ï¼Œè¿™äº›åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ä¹Ÿæ˜¯éœ€è¦ä¿å­˜çš„ã€‚\nçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ˜¯ä»€ä¹ˆï¼Ÿ\nè¿™è¿˜å¾—çœ‹çº¿ç¨‹æ˜¯ä¸æ˜¯å±äºåŒä¸€ä¸ªè¿›ç¨‹ï¼š\nå½“ä¸¤ä¸ªçº¿ç¨‹ä¸æ˜¯å±äºåŒä¸€ä¸ªè¿›ç¨‹ï¼Œåˆ™åˆ‡æ¢çš„è¿‡ç¨‹å°±è·Ÿè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸€æ ·ï¼› å½“ä¸¤ä¸ªçº¿ç¨‹æ˜¯å±äºåŒä¸€ä¸ªè¿›ç¨‹ï¼Œå› ä¸ºè™šæ‹Ÿå†…å­˜æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥åœ¨åˆ‡æ¢æ—¶ï¼Œè™šæ‹Ÿå†…å­˜è¿™äº›èµ„æºå°±ä¿æŒä¸åŠ¨ï¼Œåªéœ€è¦åˆ‡æ¢çº¿ç¨‹çš„ç§æœ‰æ•°æ®ã€å¯„å­˜å™¨ç­‰ä¸å…±äº«çš„æ•°æ®ï¼› æ‰€ä»¥ï¼Œçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ç›¸æ¯”è¿›ç¨‹ï¼Œå¼€é”€è¦å°å¾ˆå¤šã€‚\nçº¿ç¨‹çš„å®ç° ä¸»è¦æœ‰ä¸‰ç§çº¿ç¨‹çš„å®ç°æ–¹å¼ï¼š\nç”¨æˆ·çº¿ç¨‹ï¼ˆ*User Thread*ï¼‰ï¼šåœ¨ç”¨æˆ·ç©ºé—´å®ç°çš„çº¿ç¨‹ï¼Œä¸æ˜¯ç”±å†…æ ¸ç®¡ç†çš„çº¿ç¨‹ï¼Œæ˜¯ç”±ç”¨æˆ·æ€çš„çº¿ç¨‹åº“æ¥å®Œæˆçº¿ç¨‹çš„ç®¡ç†ï¼› å†…æ ¸çº¿ç¨‹ï¼ˆ*Kernel Thread*ï¼‰ï¼šåœ¨å†…æ ¸ä¸­å®ç°çš„çº¿ç¨‹ï¼Œæ˜¯ç”±å†…æ ¸ç®¡ç†çš„çº¿ç¨‹ï¼› è½»é‡çº§è¿›ç¨‹ï¼ˆ*LightWeight Process*ï¼‰ï¼šåœ¨å†…æ ¸ä¸­æ¥æ”¯æŒç”¨æˆ·çº¿ç¨‹ï¼› é‚£ä¹ˆï¼Œè¿™è¿˜éœ€è¦è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹çš„å¯¹åº”å…³ç³»ã€‚\né¦–å…ˆï¼Œç¬¬ä¸€ç§å…³ç³»æ˜¯å¤šå¯¹ä¸€çš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªç”¨æˆ·çº¿ç¨‹å¯¹åº”åŒä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼š\nå¤šå¯¹ä¸€\nç¬¬äºŒç§æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹å¯¹åº”ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼š\nä¸€å¯¹ä¸€\nç¬¬ä¸‰ç§æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªç”¨æˆ·çº¿ç¨‹å¯¹åº”åˆ°å¤šä¸ªå†…æ ¸çº¿ç¨‹ï¼š\nå¤šå¯¹å¤š\nç”¨æˆ·çº¿ç¨‹å¦‚ä½•ç†è§£ï¼Ÿå­˜åœ¨ä»€ä¹ˆä¼˜åŠ¿å’Œç¼ºé™·ï¼Ÿ\nç”¨æˆ·çº¿ç¨‹æ˜¯åŸºäºç”¨æˆ·æ€çš„çº¿ç¨‹ç®¡ç†åº“æ¥å®ç°çš„ï¼Œé‚£ä¹ˆçº¿ç¨‹æ§åˆ¶å—ï¼ˆ*Thread Control Block, TCB*ï¼‰ ä¹Ÿæ˜¯åœ¨åº“é‡Œé¢æ¥å®ç°çš„ï¼Œå¯¹äºæ“ä½œç³»ç»Ÿè€Œè¨€æ˜¯çœ‹ä¸åˆ°è¿™ä¸ª TCB çš„ï¼Œå®ƒåªèƒ½çœ‹åˆ°æ•´ä¸ªè¿›ç¨‹çš„ PCBã€‚\næ‰€ä»¥ï¼Œç”¨æˆ·çº¿ç¨‹çš„æ•´ä¸ªçº¿ç¨‹ç®¡ç†å’Œè°ƒåº¦ï¼Œæ“ä½œç³»ç»Ÿæ˜¯ä¸ç›´æ¥å‚ä¸çš„ï¼Œè€Œæ˜¯ç”±ç”¨æˆ·çº§çº¿ç¨‹åº“å‡½æ•°æ¥å®Œæˆçº¿ç¨‹çš„ç®¡ç†ï¼ŒåŒ…æ‹¬çº¿ç¨‹çš„åˆ›å»ºã€ç»ˆæ­¢ã€åŒæ­¥å’Œè°ƒåº¦ç­‰ã€‚\nç”¨æˆ·çº§çº¿ç¨‹çš„æ¨¡å‹ï¼Œä¹Ÿå°±ç±»ä¼¼å‰é¢æåˆ°çš„å¤šå¯¹ä¸€çš„å…³ç³»ï¼Œå³å¤šä¸ªç”¨æˆ·çº¿ç¨‹å¯¹åº”åŒä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹\nç”¨æˆ·çº¿ç¨‹çš„ä¼˜ç‚¹ï¼š\næ¯ä¸ªè¿›ç¨‹éƒ½éœ€è¦æœ‰å®ƒç§æœ‰çš„çº¿ç¨‹æ§åˆ¶å—ï¼ˆTCBï¼‰åˆ—è¡¨ï¼Œç”¨æ¥è·Ÿè¸ªè®°å½•å®ƒå„ä¸ªçº¿ç¨‹çŠ¶æ€ä¿¡æ¯ï¼ˆPCã€æ ˆæŒ‡é’ˆã€å¯„å­˜å™¨ï¼‰ï¼ŒTCB ç”±ç”¨æˆ·çº§çº¿ç¨‹åº“å‡½æ•°æ¥ç»´æŠ¤ï¼Œå¯ç”¨äºä¸æ”¯æŒçº¿ç¨‹æŠ€æœ¯çš„æ“ä½œç³»ç»Ÿï¼› ç”¨æˆ·çº¿ç¨‹çš„åˆ‡æ¢ä¹Ÿæ˜¯ç”±çº¿ç¨‹åº“å‡½æ•°æ¥å®Œæˆçš„ï¼Œæ— éœ€ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„åˆ‡æ¢ï¼Œæ‰€ä»¥é€Ÿåº¦ç‰¹åˆ«å¿«ï¼› ç”¨æˆ·çº¿ç¨‹çš„ç¼ºç‚¹ï¼š\nç”±äºæ“ä½œç³»ç»Ÿä¸å‚ä¸çº¿ç¨‹çš„è°ƒåº¦ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹å‘èµ·äº†ç³»ç»Ÿè°ƒç”¨è€Œé˜»å¡ï¼Œé‚£è¿›ç¨‹æ‰€åŒ…å«çš„ç”¨æˆ·çº¿ç¨‹éƒ½ä¸èƒ½æ‰§è¡Œäº†ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹å¼€å§‹è¿è¡Œåï¼Œé™¤éå®ƒä¸»åŠ¨åœ°äº¤å‡º CPU çš„ä½¿ç”¨æƒï¼Œå¦åˆ™å®ƒæ‰€åœ¨çš„è¿›ç¨‹å½“ä¸­çš„å…¶ä»–çº¿ç¨‹æ— æ³•è¿è¡Œï¼Œå› ä¸ºç”¨æˆ·æ€çš„çº¿ç¨‹æ²¡æ³•æ‰“æ–­å½“å‰è¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œå®ƒæ²¡æœ‰è¿™ä¸ªç‰¹æƒï¼Œåªæœ‰æ“ä½œç³»ç»Ÿæ‰æœ‰ï¼Œä½†æ˜¯ç”¨æˆ·çº¿ç¨‹ä¸æ˜¯ç”±æ“ä½œç³»ç»Ÿç®¡ç†çš„ã€‚ ç”±äºæ—¶é—´ç‰‡åˆ†é…ç»™è¿›ç¨‹ï¼Œæ•…ä¸å…¶ä»–è¿›ç¨‹æ¯”ï¼Œåœ¨å¤šçº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹å¾—åˆ°çš„æ—¶é—´ç‰‡è¾ƒå°‘ï¼Œæ‰§è¡Œä¼šæ¯”è¾ƒæ…¢ï¼› ä»¥ä¸Šï¼Œå°±æ˜¯ç”¨æˆ·çº¿ç¨‹çš„ä¼˜ç¼ºç‚¹äº†ã€‚\né‚£å†…æ ¸çº¿ç¨‹å¦‚ä½•ç†è§£ï¼Ÿå­˜åœ¨ä»€ä¹ˆä¼˜åŠ¿å’Œç¼ºé™·ï¼Ÿ\nå†…æ ¸çº¿ç¨‹æ˜¯ç”±æ“ä½œç³»ç»Ÿç®¡ç†çš„ï¼Œçº¿ç¨‹å¯¹åº”çš„ TCB è‡ªç„¶æ˜¯æ”¾åœ¨æ“ä½œç³»ç»Ÿé‡Œçš„ï¼Œè¿™æ ·çº¿ç¨‹çš„åˆ›å»ºã€ç»ˆæ­¢å’Œç®¡ç†éƒ½æ˜¯ç”±æ“ä½œç³»ç»Ÿè´Ÿè´£ã€‚\nå†…æ ¸çº¿ç¨‹çš„æ¨¡å‹ï¼Œä¹Ÿå°±ç±»ä¼¼å‰é¢æåˆ°çš„ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œå³ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹å¯¹åº”ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nå†…æ ¸çº¿ç¨‹æ¨¡å‹\nå†…æ ¸çº¿ç¨‹çš„ä¼˜ç‚¹ï¼š\nåœ¨ä¸€ä¸ªè¿›ç¨‹å½“ä¸­ï¼Œå¦‚æœæŸä¸ªå†…æ ¸çº¿ç¨‹å‘èµ·ç³»ç»Ÿè°ƒç”¨è€Œè¢«é˜»å¡ï¼Œå¹¶ä¸ä¼šå½±å“å…¶ä»–å†…æ ¸çº¿ç¨‹çš„è¿è¡Œï¼› åˆ†é…ç»™çº¿ç¨‹ï¼Œå¤šçº¿ç¨‹çš„è¿›ç¨‹è·å¾—æ›´å¤šçš„ CPU è¿è¡Œæ—¶é—´ï¼› å†…æ ¸çº¿ç¨‹çš„ç¼ºç‚¹ï¼š\nåœ¨æ”¯æŒå†…æ ¸çº¿ç¨‹çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œç”±å†…æ ¸æ¥ç»´æŠ¤è¿›ç¨‹å’Œçº¿ç¨‹çš„ä¸Šä¸‹é—®ä¿¡æ¯ï¼Œå¦‚ PCB å’Œ TCBï¼› çº¿ç¨‹çš„åˆ›å»ºã€ç»ˆæ­¢å’Œåˆ‡æ¢éƒ½æ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨çš„æ–¹å¼æ¥è¿›è¡Œï¼Œå› æ­¤å¯¹äºç³»ç»Ÿæ¥è¯´ï¼Œç³»ç»Ÿå¼€é”€æ¯”è¾ƒå¤§ï¼› ä»¥ä¸Šï¼Œå°±æ˜¯å†…æ ¸çº¿çš„ä¼˜ç¼ºç‚¹äº†ã€‚\næœ€åçš„è½»é‡çº§è¿›ç¨‹å¦‚ä½•ç†è§£ï¼Ÿ\nè½»é‡çº§è¿›ç¨‹ï¼ˆ*Light-weight processï¼ŒLWP*ï¼‰æ˜¯å†…æ ¸æ”¯æŒçš„ç”¨æˆ·çº¿ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹å¯æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª LWPï¼Œæ¯ä¸ª LWP æ˜¯è·Ÿå†…æ ¸çº¿ç¨‹ä¸€å¯¹ä¸€æ˜ å°„çš„ï¼Œä¹Ÿå°±æ˜¯ LWP éƒ½æ˜¯ç”±ä¸€ä¸ªå†…æ ¸çº¿ç¨‹æ”¯æŒã€‚\nå¦å¤–ï¼ŒLWP åªèƒ½ç”±å†…æ ¸ç®¡ç†å¹¶åƒæ™®é€šè¿›ç¨‹ä¸€æ ·è¢«è°ƒåº¦ï¼ŒLinux å†…æ ¸æ˜¯æ”¯æŒ LWP çš„å…¸å‹ä¾‹å­ã€‚\nåœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸­ï¼ŒLWPä¸æ™®é€šè¿›ç¨‹çš„åŒºåˆ«ä¹Ÿåœ¨äºå®ƒåªæœ‰ä¸€ä¸ªæœ€å°çš„æ‰§è¡Œä¸Šä¸‹æ–‡å’Œè°ƒåº¦ç¨‹åºæ‰€éœ€çš„ç»Ÿè®¡ä¿¡æ¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªè¿›ç¨‹ä»£è¡¨ç¨‹åºçš„ä¸€ä¸ªå®ä¾‹ï¼Œè€Œ LWP ä»£è¡¨ç¨‹åºçš„æ‰§è¡Œçº¿ç¨‹ï¼Œå› ä¸ºä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹ä¸åƒè¿›ç¨‹é‚£æ ·éœ€è¦é‚£ä¹ˆå¤šçŠ¶æ€ä¿¡æ¯ï¼Œæ‰€ä»¥ LWP ä¹Ÿä¸å¸¦æœ‰è¿™æ ·çš„ä¿¡æ¯ã€‚\nåœ¨ LWP ä¹‹ä¸Šä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨ç”¨æˆ·çº¿ç¨‹çš„ï¼Œé‚£ä¹ˆ LWP ä¸ç”¨æˆ·çº¿ç¨‹çš„å¯¹åº”å…³ç³»å°±æœ‰ä¸‰ç§ï¼š\n1 : 1ï¼Œå³ä¸€ä¸ª LWP å¯¹åº” ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹ï¼› N : 1ï¼Œå³ä¸€ä¸ª LWP å¯¹åº”å¤šä¸ªç”¨æˆ·çº¿ç¨‹ï¼› N : Nï¼Œå³å¤šä¸ª LMP å¯¹åº”å¤šä¸ªç”¨æˆ·çº¿ç¨‹ï¼› æ¥ä¸‹æ¥é’ˆå¯¹ä¸Šé¢è¿™ä¸‰ç§å¯¹åº”å…³ç³»è¯´æ˜å®ƒä»¬ä¼˜ç¼ºç‚¹ã€‚å…ˆä¸‹å›¾çš„ LWP æ¨¡å‹ï¼š\nLWP æ¨¡å‹\n1 : 1 æ¨¡å¼\nä¸€ä¸ªçº¿ç¨‹å¯¹åº”åˆ°ä¸€ä¸ª LWP å†å¯¹åº”åˆ°ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œå¦‚ä¸Šå›¾çš„è¿›ç¨‹ 4ï¼Œå±äºæ­¤æ¨¡å‹ã€‚\nä¼˜ç‚¹ï¼šå®ç°å¹¶è¡Œï¼Œå½“ä¸€ä¸ª LWP é˜»å¡ï¼Œä¸ä¼šå½±å“å…¶ä»– LWPï¼› ç¼ºç‚¹ï¼šæ¯ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹ï¼Œå°±äº§ç”Ÿä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œåˆ›å»ºçº¿ç¨‹çš„å¼€é”€è¾ƒå¤§ã€‚ N : 1 æ¨¡å¼\nå¤šä¸ªç”¨æˆ·çº¿ç¨‹å¯¹åº”ä¸€ä¸ª LWP å†å¯¹åº”ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œå¦‚ä¸Šå›¾çš„è¿›ç¨‹ 2ï¼Œçº¿ç¨‹ç®¡ç†æ˜¯åœ¨ç”¨æˆ·ç©ºé—´å®Œæˆçš„ï¼Œæ­¤æ¨¡å¼ä¸­ç”¨æˆ·çš„çº¿ç¨‹å¯¹æ“ä½œç³»ç»Ÿä¸å¯è§ã€‚\nä¼˜ç‚¹ï¼šç”¨æˆ·çº¿ç¨‹è¦å¼€å‡ ä¸ªéƒ½æ²¡é—®é¢˜ï¼Œä¸”ä¸Šä¸‹æ–‡åˆ‡æ¢å‘ç”Ÿç”¨æˆ·ç©ºé—´ï¼Œåˆ‡æ¢çš„æ•ˆç‡è¾ƒé«˜ï¼› ç¼ºç‚¹ï¼šä¸€ä¸ªç”¨æˆ·çº¿ç¨‹å¦‚æœé˜»å¡äº†ï¼Œåˆ™æ•´ä¸ªè¿›ç¨‹éƒ½å°†ä¼šé˜»å¡ï¼Œå¦å¤–åœ¨å¤šæ ¸ CPU ä¸­ï¼Œæ˜¯æ²¡åŠæ³•å……åˆ†åˆ©ç”¨ CPU çš„ã€‚ M : N æ¨¡å¼\næ ¹æ®å‰é¢çš„ä¸¤ä¸ªæ¨¡å‹æ··æ­ä¸€èµ·ï¼Œå°±å½¢æˆ M:N æ¨¡å‹ï¼Œè¯¥æ¨¡å‹æä¾›äº†ä¸¤çº§æ§åˆ¶ï¼Œé¦–å…ˆå¤šä¸ªç”¨æˆ·çº¿ç¨‹å¯¹åº”åˆ°å¤šä¸ª LWPï¼ŒLWP å†ä¸€ä¸€å¯¹åº”åˆ°å†…æ ¸çº¿ç¨‹ï¼Œå¦‚ä¸Šå›¾çš„è¿›ç¨‹ 3ã€‚\nä¼˜ç‚¹ï¼šç»¼åˆäº†å‰ä¸¤ç§ä¼˜ç‚¹ï¼Œå¤§éƒ¨åˆ†çš„çº¿ç¨‹ä¸Šä¸‹æ–‡å‘ç”Ÿåœ¨ç”¨æˆ·ç©ºé—´ï¼Œä¸”å¤šä¸ªçº¿ç¨‹åˆå¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸ CPU çš„èµ„æºã€‚ ç»„åˆæ¨¡å¼\nå¦‚ä¸Šå›¾çš„è¿›ç¨‹ 5ï¼Œæ­¤è¿›ç¨‹ç»“åˆ 1:1 æ¨¡å‹å’Œ M:N æ¨¡å‹ã€‚å¼€å‘äººå‘˜å¯ä»¥é’ˆå¯¹ä¸åŒçš„åº”ç”¨ç‰¹ç‚¹è°ƒèŠ‚å†…æ ¸çº¿ç¨‹çš„æ•°ç›®æ¥è¾¾åˆ°ç‰©ç†å¹¶è¡Œæ€§å’Œé€»è¾‘å¹¶è¡Œæ€§çš„æœ€ä½³æ–¹æ¡ˆã€‚\nè°ƒåº¦ è¿›ç¨‹éƒ½å¸Œæœ›è‡ªå·±èƒ½å¤Ÿå ç”¨ CPU è¿›è¡Œå·¥ä½œï¼Œé‚£ä¹ˆè¿™æ¶‰åŠåˆ°å‰é¢è¯´è¿‡çš„è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚\nä¸€æ—¦æ“ä½œç³»ç»ŸæŠŠè¿›ç¨‹åˆ‡æ¢åˆ°è¿è¡ŒçŠ¶æ€ï¼Œä¹Ÿå°±æ„å‘³ç€è¯¥è¿›ç¨‹å ç”¨ç€ CPU åœ¨æ‰§è¡Œï¼Œä½†æ˜¯å½“æ“ä½œç³»ç»ŸæŠŠè¿›ç¨‹åˆ‡æ¢åˆ°å…¶ä»–çŠ¶æ€æ—¶ï¼Œé‚£å°±ä¸èƒ½åœ¨ CPU ä¸­æ‰§è¡Œäº†ï¼Œäºæ˜¯æ“ä½œç³»ç»Ÿä¼šé€‰æ‹©ä¸‹ä¸€ä¸ªè¦è¿è¡Œçš„è¿›ç¨‹ã€‚\né€‰æ‹©ä¸€ä¸ªè¿›ç¨‹è¿è¡Œè¿™ä¸€åŠŸèƒ½æ˜¯åœ¨æ“ä½œç³»ç»Ÿä¸­å®Œæˆçš„ï¼Œé€šå¸¸ç§°ä¸ºè°ƒåº¦ç¨‹åºï¼ˆschedulerï¼‰ã€‚\né‚£åˆ°åº•ä»€ä¹ˆæ—¶å€™è°ƒåº¦è¿›ç¨‹ï¼Œæˆ–ä»¥ä»€ä¹ˆåŸåˆ™æ¥è°ƒåº¦è¿›ç¨‹å‘¢ï¼Ÿ\nè°ƒåº¦æ—¶æœº åœ¨è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå½“è¿›ç¨‹ä»ä¸€ä¸ªè¿è¡ŒçŠ¶æ€åˆ°å¦å¤–ä¸€çŠ¶æ€å˜åŒ–çš„æ—¶å€™ï¼Œå…¶å®ä¼šè§¦å‘ä¸€æ¬¡è°ƒåº¦ã€‚\næ¯”å¦‚ï¼Œä»¥ä¸‹çŠ¶æ€çš„å˜åŒ–éƒ½ä¼šè§¦å‘æ“ä½œç³»ç»Ÿçš„è°ƒåº¦ï¼š\nä»å°±ç»ªæ€ -\u0026gt; è¿è¡Œæ€ï¼šå½“è¿›ç¨‹è¢«åˆ›å»ºæ—¶ï¼Œä¼šè¿›å…¥åˆ°å°±ç»ªé˜Ÿåˆ—ï¼Œæ“ä½œç³»ç»Ÿä¼šä»å°±ç»ªé˜Ÿåˆ—é€‰æ‹©ä¸€ä¸ªè¿›ç¨‹è¿è¡Œï¼› ä»è¿è¡Œæ€ -\u0026gt; é˜»å¡æ€ï¼šå½“è¿›ç¨‹å‘ç”Ÿ I/O äº‹ä»¶è€Œé˜»å¡æ—¶ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»å¦å¤–ä¸€ä¸ªè¿›ç¨‹è¿è¡Œï¼› ä»è¿è¡Œæ€ -\u0026gt; ç»“æŸæ€ï¼šå½“è¿›ç¨‹é€€å‡ºç»“æŸåï¼Œæ“ä½œç³»ç»Ÿå¾—ä»å°±ç»ªé˜Ÿåˆ—é€‰æ‹©å¦å¤–ä¸€ä¸ªè¿›ç¨‹è¿è¡Œï¼› å› ä¸ºï¼Œè¿™äº›çŠ¶æ€å˜åŒ–çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦è€ƒè™‘æ˜¯å¦è¦è®©æ–°çš„è¿›ç¨‹ç»™ CPU è¿è¡Œï¼Œæˆ–è€…æ˜¯å¦è®©å½“å‰è¿›ç¨‹ä» CPU ä¸Šé€€å‡ºæ¥è€Œæ¢å¦ä¸€ä¸ªè¿›ç¨‹è¿è¡Œã€‚\nå¦å¤–ï¼Œå¦‚æœç¡¬ä»¶æ—¶é’Ÿæä¾›æŸä¸ªé¢‘ç‡çš„å‘¨æœŸæ€§ä¸­æ–­ï¼Œé‚£ä¹ˆå¯ä»¥æ ¹æ®å¦‚ä½•å¤„ç†æ—¶é’Ÿä¸­æ–­ ï¼ŒæŠŠè°ƒåº¦ç®—æ³•åˆ†ä¸ºä¸¤ç±»ï¼š\néæŠ¢å å¼è°ƒåº¦ç®—æ³•æŒ‘é€‰ä¸€ä¸ªè¿›ç¨‹ï¼Œç„¶åè®©è¯¥è¿›ç¨‹è¿è¡Œç›´åˆ°è¢«é˜»å¡ï¼Œæˆ–è€…ç›´åˆ°è¯¥è¿›ç¨‹é€€å‡ºï¼Œæ‰ä¼šè°ƒç”¨å¦å¤–ä¸€ä¸ªè¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¼šç†æ—¶é’Ÿä¸­æ–­è¿™ä¸ªäº‹æƒ…ã€‚ æŠ¢å å¼è°ƒåº¦ç®—æ³•æŒ‘é€‰ä¸€ä¸ªè¿›ç¨‹ï¼Œç„¶åè®©è¯¥è¿›ç¨‹åªè¿è¡ŒæŸæ®µæ—¶é—´ï¼Œå¦‚æœåœ¨è¯¥æ—¶æ®µç»“æŸæ—¶ï¼Œè¯¥è¿›ç¨‹ä»ç„¶åœ¨è¿è¡Œæ—¶ï¼Œåˆ™ä¼šæŠŠå®ƒæŒ‚èµ·ï¼Œæ¥ç€è°ƒåº¦ç¨‹åºä»å°±ç»ªé˜Ÿåˆ—æŒ‘é€‰å¦å¤–ä¸€ä¸ªè¿›ç¨‹ã€‚è¿™ç§æŠ¢å å¼è°ƒåº¦å¤„ç†ï¼Œéœ€è¦åœ¨æ—¶é—´é—´éš”çš„æœ«ç«¯å‘ç”Ÿæ—¶é’Ÿä¸­æ–­ï¼Œä»¥ä¾¿æŠŠ CPU æ§åˆ¶è¿”å›ç»™è°ƒåº¦ç¨‹åºè¿›è¡Œè°ƒåº¦ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„æ—¶é—´ç‰‡æœºåˆ¶ã€‚ è°ƒåº¦åŸåˆ™ åŸåˆ™ä¸€ï¼šå¦‚æœè¿è¡Œçš„ç¨‹åºï¼Œå‘ç”Ÿäº† I/O äº‹ä»¶çš„è¯·æ±‚ï¼Œé‚£ CPU ä½¿ç”¨ç‡å¿…ç„¶ä¼šå¾ˆä½ï¼Œå› ä¸ºæ­¤æ—¶è¿›ç¨‹åœ¨é˜»å¡ç­‰å¾…ç¡¬ç›˜çš„æ•°æ®è¿”å›ã€‚è¿™æ ·çš„è¿‡ç¨‹ï¼ŒåŠ¿å¿…ä¼šé€ æˆ CPU çªç„¶çš„ç©ºé—²ã€‚æ‰€ä»¥ï¼Œä¸ºäº†æé«˜ CPU åˆ©ç”¨ç‡ï¼Œåœ¨è¿™ç§å‘é€ I/O äº‹ä»¶è‡´ä½¿ CPU ç©ºé—²çš„æƒ…å†µä¸‹ï¼Œè°ƒåº¦ç¨‹åºéœ€è¦ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªè¿›ç¨‹æ¥è¿è¡Œã€‚\nåŸåˆ™äºŒï¼šæœ‰çš„ç¨‹åºæ‰§è¡ŒæŸä¸ªä»»åŠ¡èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”è¾ƒé•¿ï¼Œå¦‚æœè¿™ä¸ªç¨‹åºä¸€ç›´å ç”¨ç€ CPUï¼Œä¼šé€ æˆç³»ç»Ÿååé‡ï¼ˆCPU åœ¨å•ä½æ—¶é—´å†…å®Œæˆçš„è¿›ç¨‹æ•°é‡ï¼‰çš„é™ä½ã€‚æ‰€ä»¥ï¼Œè¦æé«˜ç³»ç»Ÿçš„ååç‡ï¼Œè°ƒåº¦ç¨‹åºè¦æƒè¡¡é•¿ä»»åŠ¡å’ŒçŸ­ä»»åŠ¡è¿›ç¨‹çš„è¿è¡Œå®Œæˆæ•°é‡ã€‚\nåŸåˆ™ä¸‰ï¼šä»è¿›ç¨‹å¼€å§‹åˆ°ç»“æŸçš„è¿‡ç¨‹ä¸­ï¼Œå®é™…ä¸Šæ˜¯åŒ…å«ä¸¤ä¸ªæ—¶é—´ï¼Œåˆ†åˆ«æ˜¯è¿›ç¨‹è¿è¡Œæ—¶é—´å’Œè¿›ç¨‹ç­‰å¾…æ—¶é—´ï¼Œè¿™ä¸¤ä¸ªæ—¶é—´æ€»å’Œå°±ç§°ä¸ºå‘¨è½¬æ—¶é—´ã€‚è¿›ç¨‹çš„å‘¨è½¬æ—¶é—´è¶Šå°è¶Šå¥½ï¼Œå¦‚æœè¿›ç¨‹çš„ç­‰å¾…æ—¶é—´å¾ˆé•¿è€Œè¿è¡Œæ—¶é—´å¾ˆçŸ­ï¼Œé‚£å‘¨è½¬æ—¶é—´å°±å¾ˆé•¿ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ï¼Œè°ƒåº¦ç¨‹åºåº”è¯¥é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿã€‚\nåŸåˆ™å››ï¼šå¤„äºå°±ç»ªé˜Ÿåˆ—çš„è¿›ç¨‹ï¼Œä¹Ÿä¸èƒ½ç­‰å¤ªä¹…ï¼Œå½“ç„¶å¸Œæœ›è¿™ä¸ªç­‰å¾…çš„æ—¶é—´è¶ŠçŸ­è¶Šå¥½ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾—è¿›ç¨‹æ›´å¿«çš„åœ¨ CPU ä¸­æ‰§è¡Œã€‚æ‰€ä»¥ï¼Œå°±ç»ªé˜Ÿåˆ—ä¸­è¿›ç¨‹çš„ç­‰å¾…æ—¶é—´ä¹Ÿæ˜¯è°ƒåº¦ç¨‹åºæ‰€éœ€è¦è€ƒè™‘çš„åŸåˆ™ã€‚\nåŸåˆ™äº”ï¼šå¯¹äºé¼ æ ‡ã€é”®ç›˜è¿™ç§äº¤äº’å¼æ¯”è¾ƒå¼ºçš„åº”ç”¨ï¼Œæˆ‘ä»¬å½“ç„¶å¸Œæœ›å®ƒçš„å“åº”æ—¶é—´è¶Šå¿«è¶Šå¥½ï¼Œå¦åˆ™å°±ä¼šå½±å“ç”¨æˆ·ä½“éªŒäº†ã€‚æ‰€ä»¥ï¼Œå¯¹äºäº¤äº’å¼æ¯”è¾ƒå¼ºçš„åº”ç”¨ï¼Œå“åº”æ—¶é—´ä¹Ÿæ˜¯è°ƒåº¦ç¨‹åºéœ€è¦è€ƒè™‘çš„åŸåˆ™ã€‚\näº”ç§è°ƒåº¦åŸåˆ™\né’ˆå¯¹ä¸Šé¢çš„äº”ç§è°ƒåº¦åŸåˆ™ï¼Œæ€»ç»“æˆå¦‚ä¸‹ï¼š\nCPU åˆ©ç”¨ç‡ï¼šè°ƒåº¦ç¨‹åºåº”ç¡®ä¿ CPU æ˜¯å§‹ç»ˆåŒ†å¿™çš„çŠ¶æ€ï¼Œè¿™å¯æé«˜ CPU çš„åˆ©ç”¨ç‡ï¼› ç³»ç»Ÿååé‡ï¼šååé‡è¡¨ç¤ºçš„æ˜¯å•ä½æ—¶é—´å†… CPU å®Œæˆè¿›ç¨‹çš„æ•°é‡ï¼Œé•¿ä½œä¸šçš„è¿›ç¨‹ä¼šå ç”¨è¾ƒé•¿çš„ CPU èµ„æºï¼Œå› æ­¤ä¼šé™ä½ååé‡ï¼Œç›¸åï¼ŒçŸ­ä½œä¸šçš„è¿›ç¨‹ä¼šæå‡ç³»ç»Ÿååé‡ï¼› å‘¨è½¬æ—¶é—´ï¼šå‘¨è½¬æ—¶é—´æ˜¯è¿›ç¨‹è¿è¡Œå’Œé˜»å¡æ—¶é—´æ€»å’Œï¼Œä¸€ä¸ªè¿›ç¨‹çš„å‘¨è½¬æ—¶é—´è¶Šå°è¶Šå¥½ï¼› ç­‰å¾…æ—¶é—´ï¼šè¿™ä¸ªç­‰å¾…æ—¶é—´ä¸æ˜¯é˜»å¡çŠ¶æ€çš„æ—¶é—´ï¼Œè€Œæ˜¯è¿›ç¨‹å¤„äºå°±ç»ªé˜Ÿåˆ—çš„æ—¶é—´ï¼Œç­‰å¾…çš„æ—¶é—´è¶Šé•¿ï¼Œç”¨æˆ·è¶Šä¸æ»¡æ„ï¼› å“åº”æ—¶é—´ï¼šç”¨æˆ·æäº¤è¯·æ±‚åˆ°ç³»ç»Ÿç¬¬ä¸€æ¬¡äº§ç”Ÿå“åº”æ‰€èŠ±è´¹çš„æ—¶é—´ï¼Œåœ¨äº¤äº’å¼ç³»ç»Ÿä¸­ï¼Œå“åº”æ—¶é—´æ˜¯è¡¡é‡è°ƒåº¦ç®—æ³•å¥½åçš„ä¸»è¦æ ‡å‡†ã€‚ è¯´ç™½äº†ï¼Œè¿™ä¹ˆå¤šè°ƒåº¦åŸåˆ™ï¼Œç›®çš„å°±æ˜¯è¦ä½¿å¾—è¿›ç¨‹è¦ã€Œå¿«ã€ã€‚\nè°ƒåº¦ç®—æ³• ä¸åŒçš„è°ƒåº¦ç®—æ³•é€‚ç”¨çš„åœºæ™¯ä¹Ÿæ˜¯ä¸åŒçš„ã€‚\næ¥ä¸‹æ¥ï¼Œè¯´è¯´åœ¨å•æ ¸ CPU ç³»ç»Ÿä¸­å¸¸è§çš„è°ƒåº¦ç®—æ³•ã€‚\n01 å…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•\næœ€ç®€å•çš„ä¸€ä¸ªè°ƒåº¦ç®—æ³•ï¼Œå°±æ˜¯éæŠ¢å å¼çš„å…ˆæ¥å…ˆæœåŠ¡ï¼ˆ*First Come First Severd, FCFS*ï¼‰ç®—æ³•äº†ã€‚\nFCFS è°ƒåº¦ç®—æ³•\né¡¾åæ€ä¹‰ï¼Œå…ˆæ¥ååˆ°ï¼Œæ¯æ¬¡ä»å°±ç»ªé˜Ÿåˆ—é€‰æ‹©æœ€å…ˆè¿›å…¥é˜Ÿåˆ—çš„è¿›ç¨‹ï¼Œç„¶åä¸€ç›´è¿è¡Œï¼Œç›´åˆ°è¿›ç¨‹é€€å‡ºæˆ–è¢«é˜»å¡ï¼Œæ‰ä¼šç»§ç»­ä»é˜Ÿåˆ—ä¸­é€‰æ‹©ç¬¬ä¸€ä¸ªè¿›ç¨‹æ¥ç€è¿è¡Œã€‚\nè¿™ä¼¼ä¹å¾ˆå…¬å¹³ï¼Œä½†æ˜¯å½“ä¸€ä¸ªé•¿ä½œä¸šå…ˆè¿è¡Œäº†ï¼Œé‚£ä¹ˆåé¢çš„çŸ­ä½œä¸šç­‰å¾…çš„æ—¶é—´å°±ä¼šå¾ˆé•¿ï¼Œä¸åˆ©äºçŸ­ä½œä¸šã€‚\nFCFS å¯¹é•¿ä½œä¸šæœ‰åˆ©ï¼Œé€‚ç”¨äº CPU ç¹å¿™å‹ä½œä¸šçš„ç³»ç»Ÿï¼Œè€Œä¸é€‚ç”¨äº I/O ç¹å¿™å‹ä½œä¸šçš„ç³»ç»Ÿã€‚\n02 æœ€çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•\næœ€çŸ­ä½œä¸šä¼˜å…ˆï¼ˆ*Shortest Job First, SJF*ï¼‰è°ƒåº¦ç®—æ³•åŒæ ·ä¹Ÿæ˜¯é¡¾åæ€ä¹‰ï¼Œå®ƒä¼šä¼˜å…ˆé€‰æ‹©è¿è¡Œæ—¶é—´æœ€çŸ­çš„è¿›ç¨‹æ¥è¿è¡Œï¼Œè¿™æœ‰åŠ©äºæé«˜ç³»ç»Ÿçš„ååé‡ã€‚\nSJF è°ƒåº¦ç®—æ³•\nè¿™æ˜¾ç„¶å¯¹é•¿ä½œä¸šä¸åˆ©ï¼Œå¾ˆå®¹æ˜“é€ æˆä¸€ç§æç«¯ç°è±¡ã€‚\næ¯”å¦‚ï¼Œä¸€ä¸ªé•¿ä½œä¸šåœ¨å°±ç»ªé˜Ÿåˆ—ç­‰å¾…è¿è¡Œï¼Œè€Œè¿™ä¸ªå°±ç»ªé˜Ÿåˆ—æœ‰éå¸¸å¤šçš„çŸ­ä½œä¸šï¼Œé‚£ä¹ˆå°±ä¼šä½¿å¾—é•¿ä½œä¸šä¸æ–­çš„å¾€åæ¨ï¼Œå‘¨è½¬æ—¶é—´å˜é•¿ï¼Œè‡´ä½¿é•¿ä½œä¸šé•¿æœŸä¸ä¼šè¢«è¿è¡Œã€‚\n03 é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•\nå‰é¢çš„ã€Œå…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•ã€å’Œã€Œæœ€çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•ã€éƒ½æ²¡æœ‰å¾ˆå¥½çš„æƒè¡¡çŸ­ä½œä¸šå’Œé•¿ä½œä¸šã€‚\né‚£ä¹ˆï¼Œé«˜å“åº”æ¯”ä¼˜å…ˆ ï¼ˆ*Highest Response Ratio Next, HRRN*ï¼‰è°ƒåº¦ç®—æ³•ä¸»è¦æ˜¯æƒè¡¡äº†çŸ­ä½œä¸šå’Œé•¿ä½œä¸šã€‚\næ¯æ¬¡è¿›è¡Œè¿›ç¨‹è°ƒåº¦æ—¶ï¼Œå…ˆè®¡ç®—ã€Œå“åº”æ¯”ä¼˜å…ˆçº§ã€ï¼Œç„¶åæŠŠã€Œå“åº”æ¯”ä¼˜å…ˆçº§ã€æœ€é«˜çš„è¿›ç¨‹æŠ•å…¥è¿è¡Œï¼Œã€Œå“åº”æ¯”ä¼˜å…ˆçº§ã€çš„è®¡ç®—å…¬å¼ï¼š\nä»ä¸Šé¢çš„å…¬å¼ï¼Œå¯ä»¥å‘ç°ï¼š\nå¦‚æœä¸¤ä¸ªè¿›ç¨‹çš„ã€Œç­‰å¾…æ—¶é—´ã€ç›¸åŒæ—¶ï¼Œã€Œè¦æ±‚çš„æœåŠ¡æ—¶é—´ã€è¶ŠçŸ­ï¼Œã€Œå“åº”æ¯”ã€å°±è¶Šé«˜ï¼Œè¿™æ ·çŸ­ä½œä¸šçš„è¿›ç¨‹å®¹æ˜“è¢«é€‰ä¸­è¿è¡Œï¼› å¦‚æœä¸¤ä¸ªè¿›ç¨‹ã€Œè¦æ±‚çš„æœåŠ¡æ—¶é—´ã€ç›¸åŒæ—¶ï¼Œã€Œç­‰å¾…æ—¶é—´ã€è¶Šé•¿ï¼Œã€Œå“åº”æ¯”ã€å°±è¶Šé«˜ï¼Œè¿™å°±å…¼é¡¾åˆ°äº†é•¿ä½œä¸šè¿›ç¨‹ï¼Œå› ä¸ºè¿›ç¨‹çš„å“åº”æ¯”å¯ä»¥éšæ—¶é—´ç­‰å¾…çš„å¢åŠ è€Œæé«˜ï¼Œå½“å…¶ç­‰å¾…æ—¶é—´è¶³å¤Ÿé•¿æ—¶ï¼Œå…¶å“åº”æ¯”ä¾¿å¯ä»¥å‡åˆ°å¾ˆé«˜ï¼Œä»è€Œè·å¾—è¿è¡Œçš„æœºä¼šï¼› 04 æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•\næœ€å¤è€ã€æœ€ç®€å•ã€æœ€å…¬å¹³ä¸”ä½¿ç”¨æœ€å¹¿çš„ç®—æ³•å°±æ˜¯æ—¶é—´ç‰‡è½®è½¬ï¼ˆ*Round Robin, RR*ï¼‰è°ƒåº¦ç®—æ³•ã€‚ ã€‚\nRR è°ƒåº¦ç®—æ³•\næ¯ä¸ªè¿›ç¨‹è¢«åˆ†é…ä¸€ä¸ªæ—¶é—´æ®µï¼Œç§°ä¸ºæ—¶é—´ç‰‡ï¼ˆ*Quantum*ï¼‰ï¼Œå³å…è®¸è¯¥è¿›ç¨‹åœ¨è¯¥æ—¶é—´æ®µä¸­è¿è¡Œã€‚\nå¦‚æœæ—¶é—´ç‰‡ç”¨å®Œï¼Œè¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆå°†ä¼šæŠŠæ­¤è¿›ç¨‹ä» CPU é‡Šæ”¾å‡ºæ¥ï¼Œå¹¶æŠŠ CPU åˆ†é…å¦å¤–ä¸€ä¸ªè¿›ç¨‹ï¼› å¦‚æœè¯¥è¿›ç¨‹åœ¨æ—¶é—´ç‰‡ç»“æŸå‰é˜»å¡æˆ–ç»“æŸï¼Œåˆ™ CPU ç«‹å³è¿›è¡Œåˆ‡æ¢ï¼› å¦å¤–ï¼Œæ—¶é—´ç‰‡çš„é•¿åº¦å°±æ˜¯ä¸€ä¸ªå¾ˆå…³é”®çš„ç‚¹ï¼š\nå¦‚æœæ—¶é—´ç‰‡è®¾å¾—å¤ªçŸ­ä¼šå¯¼è‡´è¿‡å¤šçš„è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œé™ä½äº† CPU æ•ˆç‡ï¼› å¦‚æœè®¾å¾—å¤ªé•¿åˆå¯èƒ½å¼•èµ·å¯¹çŸ­ä½œä¸šè¿›ç¨‹çš„å“åº”æ—¶é—´å˜é•¿ã€‚å°† é€šå¸¸æ—¶é—´ç‰‡è®¾ä¸º 20ms~50ms é€šå¸¸æ˜¯ä¸€ä¸ªæ¯”è¾ƒåˆç†çš„æŠ˜ä¸­å€¼ã€‚\n05 æœ€é«˜ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•\nå‰é¢çš„ã€Œæ—¶é—´ç‰‡è½®è½¬ç®—æ³•ã€åšäº†ä¸ªå‡è®¾ï¼Œå³è®©æ‰€æœ‰çš„è¿›ç¨‹åŒç­‰é‡è¦ï¼Œä¹Ÿä¸åè¢’è°ï¼Œå¤§å®¶çš„è¿è¡Œæ—¶é—´éƒ½ä¸€æ ·ã€‚\nä½†æ˜¯ï¼Œå¯¹äºå¤šç”¨æˆ·è®¡ç®—æœºç³»ç»Ÿå°±æœ‰ä¸åŒçš„çœ‹æ³•äº†ï¼Œå®ƒä»¬å¸Œæœ›è°ƒåº¦æ˜¯æœ‰ä¼˜å…ˆçº§çš„ï¼Œå³å¸Œæœ›è°ƒåº¦ç¨‹åºèƒ½ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰æ‹©æœ€é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹è¿›è¡Œè¿è¡Œï¼Œè¿™ç§°ä¸ºæœ€é«˜ä¼˜å…ˆçº§ï¼ˆ*Highest Priority Firstï¼ŒHPF*ï¼‰è°ƒåº¦ç®—æ³•ã€‚\nè¿›ç¨‹çš„ä¼˜å…ˆçº§å¯ä»¥åˆ†ä¸ºï¼Œé™æ€ä¼˜å…ˆçº§æˆ–åŠ¨æ€ä¼˜å…ˆçº§ï¼š\né™æ€ä¼˜å…ˆçº§ï¼šåˆ›å»ºè¿›ç¨‹æ—¶å€™ï¼Œå°±å·²ç»ç¡®å®šäº†ä¼˜å…ˆçº§äº†ï¼Œç„¶åæ•´ä¸ªè¿è¡Œæ—¶é—´ä¼˜å…ˆçº§éƒ½ä¸ä¼šå˜åŒ–ï¼› åŠ¨æ€ä¼˜å…ˆçº§ï¼šæ ¹æ®è¿›ç¨‹çš„åŠ¨æ€å˜åŒ–è°ƒæ•´ä¼˜å…ˆçº§ï¼Œæ¯”å¦‚å¦‚æœè¿›ç¨‹è¿è¡Œæ—¶é—´å¢åŠ ï¼Œåˆ™é™ä½å…¶ä¼˜å…ˆçº§ï¼Œå¦‚æœè¿›ç¨‹ç­‰å¾…æ—¶é—´ï¼ˆå°±ç»ªé˜Ÿåˆ—çš„ç­‰å¾…æ—¶é—´ï¼‰å¢åŠ ï¼Œåˆ™å‡é«˜å…¶ä¼˜å…ˆçº§ï¼Œä¹Ÿå°±æ˜¯éšç€æ—¶é—´çš„æ¨ç§»å¢åŠ ç­‰å¾…è¿›ç¨‹çš„ä¼˜å…ˆçº§ã€‚ è¯¥ç®—æ³•ä¹Ÿæœ‰ä¸¤ç§å¤„ç†ä¼˜å…ˆçº§é«˜çš„æ–¹æ³•ï¼ŒéæŠ¢å å¼å’ŒæŠ¢å å¼ï¼š\néæŠ¢å å¼ï¼šå½“å°±ç»ªé˜Ÿåˆ—ä¸­å‡ºç°ä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹ï¼Œè¿è¡Œå®Œå½“å‰è¿›ç¨‹ï¼Œå†é€‰æ‹©ä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹ã€‚ æŠ¢å å¼ï¼šå½“å°±ç»ªé˜Ÿåˆ—ä¸­å‡ºç°ä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹ï¼Œå½“å‰è¿›ç¨‹æŒ‚èµ·ï¼Œè°ƒåº¦ä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹è¿è¡Œã€‚ ä½†æ˜¯ä¾ç„¶æœ‰ç¼ºç‚¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹æ°¸è¿œä¸ä¼šè¿è¡Œã€‚\n06 å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•\nå¤šçº§åé¦ˆé˜Ÿåˆ—ï¼ˆ*Multilevel Feedback Queue*ï¼‰è°ƒåº¦ç®—æ³•æ˜¯ã€Œæ—¶é—´ç‰‡è½®è½¬ç®—æ³•ã€å’Œã€Œæœ€é«˜ä¼˜å…ˆçº§ç®—æ³•ã€çš„ç»¼åˆå’Œå‘å±•ã€‚\né¡¾åæ€ä¹‰ï¼š\nã€Œå¤šçº§ã€è¡¨ç¤ºæœ‰å¤šä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼ŒåŒæ—¶ä¼˜å…ˆçº§è¶Šé«˜æ—¶é—´ç‰‡è¶ŠçŸ­ã€‚ ã€Œåé¦ˆã€è¡¨ç¤ºå¦‚æœæœ‰æ–°çš„è¿›ç¨‹åŠ å…¥ä¼˜å…ˆçº§é«˜çš„é˜Ÿåˆ—æ—¶ï¼Œç«‹åˆ»åœæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œè½¬è€Œå»è¿è¡Œä¼˜å…ˆçº§é«˜çš„é˜Ÿåˆ—ï¼› å¤šçº§åé¦ˆé˜Ÿåˆ—\næ¥çœ‹çœ‹ï¼Œå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š\nè®¾ç½®äº†å¤šä¸ªé˜Ÿåˆ—ï¼Œèµ‹äºˆæ¯ä¸ªé˜Ÿåˆ—ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼ŒåŒæ—¶ä¼˜å…ˆçº§è¶Šé«˜æ—¶é—´ç‰‡è¶ŠçŸ­ï¼› æ–°çš„è¿›ç¨‹ä¼šè¢«æ”¾å…¥åˆ°ç¬¬ä¸€çº§é˜Ÿåˆ—çš„æœ«å°¾ï¼ŒæŒ‰å…ˆæ¥å…ˆæœåŠ¡çš„åŸåˆ™æ’é˜Ÿç­‰å¾…è¢«è°ƒåº¦ï¼Œå¦‚æœåœ¨ç¬¬ä¸€çº§é˜Ÿåˆ—è§„å®šçš„æ—¶é—´ç‰‡æ²¡è¿è¡Œå®Œæˆï¼Œåˆ™å°†å…¶è½¬å…¥åˆ°ç¬¬äºŒçº§é˜Ÿåˆ—çš„æœ«å°¾ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´è‡³å®Œæˆï¼› å½“è¾ƒé«˜ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ä¸ºç©ºï¼Œæ‰è°ƒåº¦è¾ƒä½ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹è¿è¡Œã€‚å¦‚æœè¿›ç¨‹è¿è¡Œæ—¶ï¼Œæœ‰æ–°è¿›ç¨‹è¿›å…¥è¾ƒé«˜ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ï¼Œåˆ™åœæ­¢å½“å‰è¿è¡Œçš„è¿›ç¨‹å¹¶å°†å…¶ç§»å…¥åˆ°åŸé˜Ÿåˆ—æœ«å°¾ï¼Œæ¥ç€è®©è¾ƒé«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹è¿è¡Œï¼› å¯ä»¥å‘ç°ï¼Œå¯¹äºçŸ­ä½œä¸šå¯èƒ½å¯ä»¥åœ¨ç¬¬ä¸€çº§é˜Ÿåˆ—å¾ˆå¿«è¢«å¤„ç†å®Œã€‚å¯¹äºé•¿ä½œä¸šï¼Œå¦‚æœåœ¨ç¬¬ä¸€çº§é˜Ÿåˆ—å¤„ç†ä¸å®Œï¼Œå¯ä»¥ç§»å…¥ä¸‹æ¬¡é˜Ÿåˆ—ç­‰å¾…è¢«æ‰§è¡Œï¼Œè™½ç„¶ç­‰å¾…çš„æ—¶é—´å˜é•¿äº†ï¼Œä½†æ˜¯è¿è¡Œæ—¶é—´ä¹Ÿä¼šæ›´é•¿äº†ï¼Œæ‰€ä»¥è¯¥ç®—æ³•å¾ˆå¥½çš„å…¼é¡¾äº†é•¿çŸ­ä½œä¸šï¼ŒåŒæ—¶æœ‰è¾ƒå¥½çš„å“åº”æ—¶é—´ã€‚\nçœ‹çš„è¿·è¿·ç³Šç³Šï¼Ÿé‚£æˆ‘æ‹¿å»é“¶è¡ŒåŠä¸šåŠ¡çš„ä¾‹å­ï¼ŒæŠŠä¸Šé¢çš„è°ƒåº¦ç®—æ³•ä¸²èµ·æ¥ï¼Œä½ è¿˜ä¸æ‡‚ï¼Œä½ é”¤æˆ‘ï¼\nåŠç†ä¸šåŠ¡çš„å®¢æˆ·ç›¸å½“äºè¿›ç¨‹ï¼Œé“¶è¡Œçª—å£å·¥ä½œäººå‘˜ç›¸å½“äº CPUã€‚\nç°åœ¨ï¼Œå‡è®¾è¿™ä¸ªé“¶è¡Œåªæœ‰ä¸€ä¸ªçª—å£ï¼ˆå•æ ¸ CPU ï¼‰ï¼Œé‚£ä¹ˆå·¥ä½œäººå‘˜ä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªä¸šåŠ¡ã€‚\né“¶è¡ŒåŠä¸šåŠ¡\né‚£ä¹ˆæœ€ç®€å•çš„å¤„ç†æ–¹å¼ï¼Œå°±æ˜¯å…ˆæ¥çš„å…ˆå¤„ç†ï¼Œåé¢æ¥çš„å°±ä¹–ä¹–æ’é˜Ÿï¼Œè¿™å°±æ˜¯å…ˆæ¥å…ˆæœåŠ¡ï¼ˆ*FCFS*ï¼‰è°ƒåº¦ç®—æ³•ã€‚ä½†æ˜¯ä¸‡ä¸€å…ˆæ¥çš„è¿™ä½è€å“¥æ˜¯æ¥è´·æ¬¾çš„ï¼Œè¿™ä¸€è°ˆå°±å¥½å‡ ä¸ªå°æ—¶ï¼Œä¸€ç›´å ç”¨ç€çª—å£ï¼Œè¿™æ ·åé¢çš„äººåªèƒ½å¹²ç­‰ï¼Œæˆ–è®¸åé¢çš„äººåªæ˜¯æƒ³ç®€å•çš„å–ä¸ªé’±ï¼Œå‡ åˆ†é’Ÿå°±èƒ½æå®šï¼Œå´å› ä¸ºå‰é¢è€å“¥åŠé•¿ä¸šåŠ¡è€Œè¦ç­‰å‡ ä¸ªå°æ—¶ï¼Œä½ è¯´æ°”ä¸æ°”äººï¼Ÿ\nå…ˆæ¥å…ˆæœåŠ¡\næœ‰å®¢æˆ·æŠ±æ€¨äº†ï¼Œé‚£æˆ‘ä»¬å°±è¦æ”¹è¿›ï¼Œæˆ‘ä»¬å¹²è„†ä¼˜å…ˆç»™é‚£äº›å‡ åˆ†é’Ÿå°±èƒ½æå®šçš„äººåŠç†ä¸šåŠ¡ï¼Œè¿™å°±æ˜¯çŸ­ä½œä¸šä¼˜å…ˆï¼ˆ*SJF*ï¼‰è°ƒåº¦ç®—æ³•ã€‚å¬èµ·æ¥ä¸é”™ï¼Œä½†æ˜¯ä¾ç„¶è¿˜æ˜¯æœ‰ä¸ªæç«¯æƒ…å†µï¼Œä¸‡ä¸€åŠç†çŸ­ä¸šåŠ¡çš„äººéå¸¸çš„å¤šï¼Œè¿™ä¼šå¯¼è‡´é•¿ä¸šåŠ¡çš„äººä¸€ç›´å¾—ä¸åˆ°æœåŠ¡ï¼Œä¸‡ä¸€è¿™ä¸ªé•¿ä¸šåŠ¡æ˜¯ä¸ªå¤§å®¢æˆ·ï¼Œé‚£ä¸å°±æ¡äº†èŠéº»ä¸¢äº†è¥¿ç“œ\næœ€çŸ­ä½œä¸šä¼˜å…ˆ\né‚£å°±å…¬å¹³èµ·è§ï¼Œç°åœ¨çª—å£å·¥ä½œäººå‘˜è§„å®šï¼Œæ¯ä¸ªäººæˆ‘åªå¤„ç† 10 åˆ†é’Ÿã€‚å¦‚æœ 10 åˆ†é’Ÿä¹‹å†…å¤„ç†å®Œï¼Œå°±é©¬ä¸Šæ¢ä¸‹ä¸€ä¸ªäººã€‚å¦‚æœæ²¡å¤„ç†å®Œï¼Œä¾ç„¶æ¢ä¸‹ä¸€ä¸ªäººï¼Œä½†æ˜¯å®¢æˆ·è‡ªå·±å¾—è®°ä½åŠç†åˆ°å“ªä¸ªæ­¥éª¤äº†ã€‚è¿™ä¸ªä¹Ÿå°±æ˜¯æ—¶é—´ç‰‡è½®è½¬ï¼ˆ*RR*ï¼‰è°ƒåº¦ç®—æ³•ã€‚ä½†æ˜¯å¦‚æœæ—¶é—´ç‰‡è®¾ç½®è¿‡çŸ­ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå¤§é‡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¢å¤§äº†ç³»ç»Ÿå¼€é”€ã€‚å¦‚æœæ—¶é—´ç‰‡è¿‡é•¿ï¼Œç›¸å½“äºé€€åŒ–æˆé€€åŒ–æˆ FCFS ç®—æ³•äº†ã€‚\næ—¶é—´ç‰‡è½®è½¬\næ—¢ç„¶å…¬å¹³ä¹Ÿå¯èƒ½å­˜åœ¨é—®é¢˜ï¼Œé‚£é“¶è¡Œå°±å¯¹å®¢æˆ·åˆ†ç­‰çº§ï¼Œåˆ†ä¸ºæ™®é€šå®¢æˆ·ã€VIP å®¢æˆ·ã€SVIP å®¢æˆ·ã€‚åªè¦é«˜ä¼˜å…ˆçº§çš„å®¢æˆ·ä¸€æ¥ï¼Œå°±ç¬¬ä¸€æ—¶é—´å¤„ç†è¿™ä¸ªå®¢æˆ·ï¼Œè¿™å°±æ˜¯æœ€é«˜ä¼˜å…ˆçº§ï¼ˆ*HPF*ï¼‰è°ƒåº¦ç®—æ³•ã€‚ä½†ä¾ç„¶ä¹Ÿä¼šæœ‰æç«¯çš„é—®é¢˜ï¼Œä¸‡ä¸€å½“å¤©æ¥çš„å…¨æ˜¯é«˜çº§å®¢æˆ·ï¼Œé‚£æ™®é€šå®¢æˆ·ä¸æ˜¯æ²¡æœ‰è¢«æœåŠ¡çš„æœºä¼šï¼Œä¸æŠŠæ™®é€šå®¢æˆ·å½“äººæ˜¯å—ï¼Ÿé‚£æˆ‘ä»¬æŠŠä¼˜å…ˆçº§æ”¹æˆåŠ¨æ€çš„ï¼Œå¦‚æœå®¢æˆ·åŠç†ä¸šåŠ¡æ—¶é—´å¢åŠ ï¼Œåˆ™é™ä½å…¶ä¼˜å…ˆçº§ï¼Œå¦‚æœå®¢æˆ·ç­‰å¾…æ—¶é—´å¢åŠ ï¼Œåˆ™å‡é«˜å…¶ä¼˜å…ˆçº§ã€‚\næœ€é«˜ä¼˜å…ˆçº§ï¼ˆé™æ€ï¼‰\né‚£æœ‰æ²¡æœ‰å…¼é¡¾åˆ°å…¬å¹³å’Œæ•ˆç‡çš„æ–¹å¼å‘¢ï¼Ÿè¿™é‡Œä»‹ç»ä¸€ç§ç®—æ³•ï¼Œè€ƒè™‘çš„è¿˜ç®—å……åˆ†çš„ï¼Œå¤šçº§åé¦ˆé˜Ÿåˆ—ï¼ˆ*MFQ*ï¼‰è°ƒåº¦ç®—æ³•ï¼Œå®ƒæ˜¯æ—¶é—´ç‰‡è½®è½¬ç®—æ³•å’Œä¼˜å…ˆçº§ç®—æ³•çš„ç»¼åˆå’Œå‘å±•ã€‚å®ƒçš„å·¥ä½œæ–¹å¼ï¼š\nå¤šçº§åé¦ˆé˜Ÿåˆ—\né“¶è¡Œè®¾ç½®äº†å¤šä¸ªæ’é˜Ÿï¼ˆå°±ç»ªï¼‰é˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—éƒ½æœ‰ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œå„ä¸ªé˜Ÿåˆ—ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼ŒåŒæ—¶æ¯ä¸ªé˜Ÿåˆ—æ‰§è¡Œæ—¶é—´ç‰‡çš„é•¿åº¦ä¹Ÿä¸åŒï¼Œä¼˜å…ˆçº§è¶Šé«˜çš„æ—¶é—´ç‰‡è¶ŠçŸ­ã€‚ æ–°å®¢æˆ·ï¼ˆè¿›ç¨‹ï¼‰æ¥äº†ï¼Œå…ˆè¿›å…¥ç¬¬ä¸€çº§é˜Ÿåˆ—çš„æœ«å°¾ï¼ŒæŒ‰å…ˆæ¥å…ˆæœåŠ¡åŸåˆ™æ’é˜Ÿç­‰å¾…è¢«å«å·ï¼ˆè¿è¡Œï¼‰ã€‚å¦‚æœæ—¶é—´ç‰‡ç”¨å®Œå®¢æˆ·çš„ä¸šåŠ¡è¿˜æ²¡åŠç†å®Œæˆï¼Œåˆ™è®©å®¢æˆ·è¿›å…¥åˆ°ä¸‹ä¸€çº§é˜Ÿåˆ—çš„æœ«å°¾ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´è‡³å®¢æˆ·ä¸šåŠ¡åŠç†å®Œæˆã€‚ å½“ç¬¬ä¸€çº§é˜Ÿåˆ—æ²¡äººæ’é˜Ÿæ—¶ï¼Œå°±ä¼šå«å·äºŒçº§é˜Ÿåˆ—çš„å®¢æˆ·ã€‚å¦‚æœå®¢æˆ·åŠç†ä¸šåŠ¡è¿‡ç¨‹ä¸­ï¼Œæœ‰æ–°çš„å®¢æˆ·åŠ å…¥åˆ°è¾ƒé«˜ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ­¤æ—¶åŠç†ä¸­çš„å®¢æˆ·éœ€è¦åœæ­¢åŠç†ï¼Œå›åˆ°åŸé˜Ÿåˆ—çš„æœ«å°¾ç­‰å¾…å†æ¬¡å«å·ï¼Œå› ä¸ºè¦æŠŠçª—å£è®©ç»™åˆšè¿›å…¥è¾ƒé«˜ä¼˜å…ˆçº§é˜Ÿåˆ—çš„å®¢æˆ·ã€‚ å¯ä»¥å‘ç°ï¼Œå¯¹äºè¦åŠç†çŸ­ä¸šåŠ¡çš„å®¢æˆ·æ¥è¯´ï¼Œå¯ä»¥å¾ˆå¿«çš„è½®åˆ°å¹¶è§£å†³ã€‚å¯¹äºè¦åŠç†é•¿ä¸šåŠ¡çš„å®¢æˆ·ï¼Œä¸€ä¸‹å­è§£å†³ä¸äº†ï¼Œå°±å¯ä»¥æ”¾åˆ°ä¸‹ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè™½ç„¶ç­‰å¾…çš„æ—¶é—´ç¨å¾®å˜é•¿äº†ï¼Œä½†æ˜¯è½®åˆ°è‡ªå·±çš„åŠç†æ—¶é—´ä¹Ÿå˜é•¿äº†ï¼Œä¹Ÿå¯ä»¥æ¥å—ï¼Œä¸ä¼šé€ æˆæç«¯çš„ç°è±¡ï¼Œå¯ä»¥è¯´æ˜¯ç»¼åˆä¸Šé¢å‡ ç§ç®—æ³•çš„ä¼˜ç‚¹ã€‚\n","permalink":"https://reid00.github.io/en/posts/os_network/%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/","summary":"å‰è¨€ å…ˆæ¥çœ‹çœ‹ä¸€åˆ™å°æ•…äº‹\næˆ‘ä»¬å†™å¥½çš„ä¸€è¡Œè¡Œä»£ç ï¼Œä¸ºäº†è®©å…¶å·¥ä½œèµ·æ¥ï¼Œæˆ‘ä»¬è¿˜å¾—æŠŠå®ƒé€è¿›åŸï¼ˆè¿›ç¨‹ï¼‰é‡Œï¼Œé‚£æ—¢ç„¶è¿›äº†åŸé‡Œï¼Œé‚£è‚¯å®šä¸èƒ½èƒ¡ä½œéä¸ºäº†ã€‚\nåŸé‡Œäººæœ‰åŸé‡Œäººçš„è§„çŸ©ï¼ŒåŸä¸­æœ‰ä¸ªä¸“é—¨ç®¡è¾–ä½ ä»¬çš„åŸç®¡ï¼ˆæ“ä½œç³»ç»Ÿï¼‰ï¼Œäººå®¶è®©ä½ ä¼‘æ¯å°±ä¼‘æ¯ï¼Œè®©ä½ å·¥ä½œå°±å·¥ä½œï¼Œæ¯•ç«Ÿæ‘Šä½ï¼ˆCPUï¼‰å°±ä¸€ä¸ªï¼Œæ¯ä¸ªäººéƒ½è¦å è¿™ä¸ªæ‘Šä½æ¥å·¥ä½œï¼ŒåŸé‡Œè¦å·¥ä½œçš„äººå¤šç€å»äº†ã€‚\næ‰€ä»¥åŸç®¡ä¸ºäº†å…¬å¹³èµ·è§ï¼Œå®ƒä½¿ç”¨ä¸€ç§ç­–ç•¥ï¼ˆè°ƒåº¦ï¼‰æ–¹å¼ï¼Œç»™æ¯ä¸ªäººä¸€ä¸ªå›ºå®šçš„å·¥ä½œæ—¶é—´ï¼ˆæ—¶é—´ç‰‡ï¼‰ï¼Œæ—¶é—´åˆ°äº†å°±ä¼šé€šçŸ¥ä½ å»ä¼‘æ¯è€Œæ¢å¦å¤–ä¸€ä¸ªäººä¸Šåœºå·¥ä½œã€‚\nå¦å¤–ï¼Œåœ¨ä¼‘æ¯æ—¶å€™ä½ ä¹Ÿä¸èƒ½å·æ‡’ï¼Œè¦è®°ä½å·¥ä½œåˆ°å“ªäº†ï¼Œä¸ç„¶ä¸‹æ¬¡åˆ°ä½ å·¥ä½œäº†ï¼Œä½ å¿˜è®°å·¥ä½œåˆ°å“ªäº†ï¼Œé‚£è¿˜æ€ä¹ˆç»§ç»­ï¼Ÿ\næœ‰çš„äººï¼Œå¯èƒ½è¿˜è¿›å…¥äº†å¿åŸï¼ˆçº¿ç¨‹ï¼‰å·¥ä½œï¼Œè¿™é‡Œç›¸å¯¹è½»æ¾ä¸€äº›ï¼Œåœ¨ä¼‘æ¯çš„æ—¶å€™ï¼Œè¦è®°ä½çš„ä¸œè¥¿ç›¸å¯¹è¾ƒå°‘ï¼Œè€Œä¸”è¿˜èƒ½å…±äº«åŸé‡Œçš„èµ„æºã€‚\nâ€œå“å“Ÿï¼Œéš¾é“æœ¬æ–‡å†…å®¹æ˜¯è¿›ç¨‹å’Œçº¿ç¨‹ï¼Ÿâ€\nå¯ä»¥ï¼Œèªæ˜çš„ä½ çŒœå‡ºæ¥äº†ï¼Œä¹Ÿä¸æ‰è´¹æˆ‘çç¼–ä¹±é€ çš„æ•…äº‹äº†ã€‚\nè¿›ç¨‹å’Œçº¿ç¨‹å¯¹äºå†™ä»£ç çš„æˆ‘ä»¬ï¼ŒçœŸçš„å¤©å¤©è§ã€æ—¥æ—¥è§äº†ï¼Œä½†è§çš„å¤šä¸ä»£è¡¨ä½ å°±ç†Ÿæ‚‰å®ƒä»¬ï¼Œæ¯”å¦‚ç®€å•é—®ä½ ä¸€å¥ï¼Œä½ çŸ¥é“å®ƒä»¬çš„å·¥ä½œåŸç†å’ŒåŒºåˆ«å—ï¼Ÿ\nä¸çŸ¥é“æ²¡å…³ç³»ï¼Œä»Šå¤©å°±è¦è·Ÿå¤§å®¶è®¨è®ºæ“ä½œç³»ç»Ÿçš„è¿›ç¨‹å’Œçº¿ç¨‹ã€‚\næçº²\næ­£æ–‡ è¿›ç¨‹ æˆ‘ä»¬ç¼–å†™çš„ä»£ç åªæ˜¯ä¸€ä¸ªå­˜å‚¨åœ¨ç¡¬ç›˜çš„é™æ€æ–‡ä»¶ï¼Œé€šè¿‡ç¼–è¯‘åå°±ä¼šç”ŸæˆäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶åï¼Œå®ƒä¼šè¢«è£…è½½åˆ°å†…å­˜ä¸­ï¼Œæ¥ç€ CPU ä¼šæ‰§è¡Œç¨‹åºä¸­çš„æ¯ä¸€æ¡æŒ‡ä»¤ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿è¡Œä¸­çš„ç¨‹åºï¼Œå°±è¢«ç§°ä¸ºã€Œè¿›ç¨‹ã€ã€‚\nç°åœ¨æˆ‘ä»¬è€ƒè™‘æœ‰ä¸€ä¸ªä¼šè¯»å–ç¡¬ç›˜æ–‡ä»¶æ•°æ®çš„ç¨‹åºè¢«æ‰§è¡Œäº†ï¼Œé‚£ä¹ˆå½“è¿è¡Œåˆ°è¯»å–æ–‡ä»¶çš„æŒ‡ä»¤æ—¶ï¼Œå°±ä¼šå»ä»ç¡¬ç›˜è¯»å–æ•°æ®ï¼Œä½†æ˜¯ç¡¬ç›˜çš„è¯»å†™é€Ÿåº¦æ˜¯éå¸¸æ…¢çš„ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœ CPU å‚»å‚»çš„ç­‰ç¡¬ç›˜è¿”å›æ•°æ®çš„è¯ï¼Œé‚£ CPU çš„åˆ©ç”¨ç‡æ˜¯éå¸¸ä½çš„ã€‚\nåšä¸ªç±»æ¯”ï¼Œä½ å»ç…®å¼€æ°´æ—¶ï¼Œä½ ä¼šå‚»å‚»çš„ç­‰æ°´å£¶çƒ§å¼€å—ï¼Ÿå¾ˆæ˜æ˜¾ï¼Œå°å­©ä¹Ÿä¸ä¼šå‚»ç­‰ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ°´å£¶çƒ§å¼€ä¹‹å‰å»åšå…¶ä»–äº‹æƒ…ã€‚å½“æ°´å£¶çƒ§å¼€äº†ï¼Œæˆ‘ä»¬è‡ªç„¶å°±ä¼šå¬åˆ°â€œå˜€å˜€å˜€â€çš„å£°éŸ³ï¼Œäºæ˜¯å†æŠŠçƒ§å¼€çš„æ°´å€’å…¥åˆ°æ°´æ¯é‡Œå°±å¥½äº†ã€‚\næ‰€ä»¥ï¼Œå½“è¿›ç¨‹è¦ä»ç¡¬ç›˜è¯»å–æ•°æ®æ—¶ï¼ŒCPU ä¸éœ€è¦é˜»å¡ç­‰å¾…æ•°æ®çš„è¿”å›ï¼Œè€Œæ˜¯å»æ‰§è¡Œå¦å¤–çš„è¿›ç¨‹ã€‚å½“ç¡¬ç›˜æ•°æ®è¿”å›æ—¶ï¼ŒCPU ä¼šæ”¶åˆ°ä¸ªä¸­æ–­ï¼Œäºæ˜¯ CPU å†ç»§ç»­è¿è¡Œè¿™ä¸ªè¿›ç¨‹ã€‚\nè¿›ç¨‹ 1 ä¸è¿›ç¨‹ 2 åˆ‡æ¢\nè¿™ç§å¤šä¸ªç¨‹åºã€äº¤æ›¿æ‰§è¡Œçš„æ€æƒ³ï¼Œå°±æœ‰ CPU ç®¡ç†å¤šä¸ªè¿›ç¨‹çš„åˆæ­¥æƒ³æ³•ã€‚\nå¯¹äºä¸€ä¸ªæ”¯æŒå¤šè¿›ç¨‹çš„ç³»ç»Ÿï¼ŒCPU ä¼šä»ä¸€ä¸ªè¿›ç¨‹å¿«é€Ÿåˆ‡æ¢è‡³å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œå…¶é—´æ¯ä¸ªè¿›ç¨‹å„è¿è¡Œå‡ åæˆ–å‡ ç™¾ä¸ªæ¯«ç§’ã€‚\nè™½ç„¶å•æ ¸çš„ CPU åœ¨æŸä¸€ä¸ªç¬é—´ï¼Œåªèƒ½è¿è¡Œä¸€ä¸ªè¿›ç¨‹ã€‚ä½†åœ¨ 1 ç§’é’ŸæœŸé—´ï¼Œå®ƒå¯èƒ½ä¼šè¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼Œè¿™æ ·å°±äº§ç”Ÿå¹¶è¡Œçš„é”™è§‰ï¼Œå®é™…ä¸Šè¿™æ˜¯å¹¶å‘ã€‚\nå¹¶å‘å’Œå¹¶è¡Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\nä¸€å›¾èƒœåƒè¨€ã€‚\nå¹¶å‘ä¸å¹¶è¡Œ\nè¿›ç¨‹ä¸ç¨‹åºçš„å…³ç³»çš„ç±»æ¯”\nåˆ°äº†æ™šé¥­æ—¶é—´ï¼Œä¸€å¯¹å°æƒ…ä¾£è‚šå­éƒ½å’•å’•å«äº†ï¼Œäºæ˜¯ç”·ç”Ÿè§æœºè¡Œäº‹ï¼Œå°±æƒ³ç»™å¥³ç”Ÿåšæ™šé¥­ï¼Œæ‰€ä»¥ä»–å°±åœ¨ç½‘ä¸Šæ‰¾äº†è¾£å­é¸¡çš„èœè°±ï¼Œæ¥ç€ä¹°äº†ä¸€äº›é¸¡è‚‰ã€è¾£æ¤’ã€é¦™æ–™ç­‰ææ–™ï¼Œç„¶åè¾¹çœ‹è¾¹å­¦è¾¹åšè¿™é“èœã€‚\nçªç„¶ï¼Œå¥³ç”Ÿè¯´å¥¹æƒ³å–å¯ä¹ï¼Œé‚£ä¹ˆç”·ç”Ÿåªå¥½æŠŠåšèœçš„äº‹æƒ…æš‚åœä¸€ä¸‹ï¼Œå¹¶åœ¨æ‰‹æœºèœè°±æ ‡è®°åšåˆ°å“ªä¸€ä¸ªæ­¥éª¤ï¼ŒæŠŠçŠ¶æ€ä¿¡æ¯è®°å½•äº†ä¸‹æ¥ã€‚\nç„¶åç”·ç”Ÿå¬ä»å¥³ç”Ÿçš„æŒ‡ä»¤ï¼Œè·‘å»ä¸‹æ¥¼ä¹°äº†ä¸€ç“¶å†°å¯ä¹åï¼Œåˆå›åˆ°å¨æˆ¿ç»§ç»­åšèœã€‚\nè¿™ä½“ç°äº†ï¼ŒCPU å¯ä»¥ä»ä¸€ä¸ªè¿›ç¨‹ï¼ˆåšèœï¼‰åˆ‡æ¢åˆ°å¦å¤–ä¸€ä¸ªè¿›ç¨‹ï¼ˆä¹°å¯ä¹ï¼‰ï¼Œåœ¨åˆ‡æ¢å‰å¿…é¡»è¦è®°å½•å½“å‰è¿›ç¨‹ä¸­è¿è¡Œçš„çŠ¶æ€ä¿¡æ¯ï¼Œä»¥å¤‡ä¸‹æ¬¡åˆ‡æ¢å›æ¥çš„æ—¶å€™å¯ä»¥æ¢å¤æ‰§è¡Œã€‚\næ‰€ä»¥ï¼Œå¯ä»¥å‘ç°è¿›ç¨‹æœ‰ç€ã€Œè¿è¡Œ - æš‚åœ - è¿è¡Œã€çš„æ´»åŠ¨è§„å¾‹ã€‚\nè¿›ç¨‹çš„çŠ¶æ€ åœ¨ä¸Šé¢ï¼Œæˆ‘ä»¬çŸ¥é“äº†è¿›ç¨‹æœ‰ç€ã€Œè¿è¡Œ - æš‚åœ - è¿è¡Œã€çš„æ´»åŠ¨è§„å¾‹ã€‚ä¸€èˆ¬è¯´æ¥ï¼Œä¸€ä¸ªè¿›ç¨‹å¹¶ä¸æ˜¯è‡ªå§‹è‡³ç»ˆè¿ç»­ä¸åœåœ°è¿è¡Œçš„ï¼Œå®ƒä¸å¹¶å‘æ‰§è¡Œä¸­çš„å…¶ä»–è¿›ç¨‹çš„æ‰§è¡Œæ˜¯ç›¸äº’åˆ¶çº¦çš„ã€‚\nå®ƒæœ‰æ—¶å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œæœ‰æ—¶åˆç”±äºæŸç§åŸå› è€Œæš‚åœè¿è¡Œå¤„äºç­‰å¾…çŠ¶æ€ï¼Œå½“ä½¿å®ƒæš‚åœçš„åŸå› æ¶ˆå¤±åï¼Œå®ƒåˆè¿›å…¥å‡†å¤‡è¿è¡ŒçŠ¶æ€ã€‚\næ‰€ä»¥ï¼Œåœ¨ä¸€ä¸ªè¿›ç¨‹çš„æ´»åŠ¨æœŸé—´è‡³å°‘å…·å¤‡ä¸‰ç§åŸºæœ¬çŠ¶æ€ï¼Œå³è¿è¡ŒçŠ¶æ€ã€å°±ç»ªçŠ¶æ€ã€é˜»å¡çŠ¶æ€ã€‚\nè¿›ç¨‹çš„ä¸‰ç§åŸºæœ¬çŠ¶æ€\nä¸Šå›¾ä¸­å„ä¸ªçŠ¶æ€çš„æ„ä¹‰ï¼š\nè¿è¡ŒçŠ¶æ€ï¼ˆRuningï¼‰ï¼šè¯¥æ—¶åˆ»è¿›ç¨‹å ç”¨ CPUï¼› å°±ç»ªçŠ¶æ€ï¼ˆReadyï¼‰ï¼šå¯è¿è¡Œï¼Œä½†å› ä¸ºå…¶ä»–è¿›ç¨‹æ­£åœ¨è¿è¡Œè€Œæš‚åœåœæ­¢ï¼› é˜»å¡çŠ¶æ€ï¼ˆBlockedï¼‰ï¼šè¯¥è¿›ç¨‹æ­£åœ¨ç­‰å¾…æŸä¸€äº‹ä»¶å‘ç”Ÿï¼ˆå¦‚ç­‰å¾…è¾“å…¥/è¾“å‡ºæ“ä½œçš„å®Œæˆï¼‰è€Œæš‚æ—¶åœæ­¢è¿è¡Œï¼Œè¿™æ—¶ï¼Œå³ä½¿ç»™å®ƒCPUæ§åˆ¶æƒï¼Œå®ƒä¹Ÿæ— æ³•è¿è¡Œï¼› å½“ç„¶ï¼Œè¿›ç¨‹å¦å¤–ä¸¤ä¸ªåŸºæœ¬çŠ¶æ€ï¼š","title":"è¿›ç¨‹ä¸çº¿ç¨‹åŸºç¡€çŸ¥è¯†"},{"content":"ä»‹ç» ä»€ä¹ˆæ˜¯é«˜å¹¶å‘ï¼Œä»å­—é¢ä¸Šç†è§£ï¼Œå°±æ˜¯åœ¨æŸä¸€æ—¶åˆ»äº§ç”Ÿå¤§é‡çš„è¯·æ±‚ï¼Œé‚£ä¹ˆå¤šå°‘é‡ç§°ä¸ºå¤§é‡ï¼Œä¸šç•Œå¹¶æ²¡æœ‰æ ‡å‡†çš„è¡¡é‡èŒƒå›´ã€‚åŸå› éå¸¸ç®€å•ï¼Œä¸åŒçš„ä¸šåŠ¡å¤„ç†å¤æ‚åº¦ä¸ä¸€æ ·ã€‚\nè€Œæˆ‘æ‰€ç†è§£çš„é«˜å¹¶å‘ï¼Œå®ƒå¹¶ä¸åªæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè€Œæ›´æ˜¯ä¸€ç§æ¶æ„æ€ç»´æ¨¡å¼ï¼Œå®ƒè®©ä½ åœ¨é¢å¯¹ä¸åŒçš„å¤æ‚æƒ…å†µä¸‹ï¼Œä»å®¹åœ°é€‰æ‹©ä¸åŒçš„æŠ€æœ¯æ‰‹æ®µï¼Œæ¥æå‡åº”ç”¨ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ã€‚\nä½†æ˜¯ï¼Œå¹¶ä¸æ„å‘³åº”ç”¨ç³»ç»Ÿä»è¯ç”Ÿçš„é‚£ä¸€åˆ»ï¼Œå°±éœ€è¦å…·å¤‡å¼ºå¤§çš„å¤„ç†èƒ½åŠ›ï¼Œè¿™ç§åšæ³•å¹¶ä¸æå€¡ã€‚è¦çŸ¥é“ï¼Œè„±ç¦»å®é™…æƒ…å†µçš„æŠ€æœ¯ï¼Œä¼šæ˜¾å¾—æ¯«æ— ä»·å€¼ï¼Œç”šè‡³æ˜¯ä¸€ç§æµªè´¹çš„è¡¨ç°ã€‚\nè¨€å½’æ­£ä¼ ï¼Œé‚£é«˜å¹¶å‘åˆ°åº•æ˜¯ä¸€ç§æ€æ ·çš„æ¶æ„æ€ç»´æ¨¡å¼ï¼Œå®ƒå¯¹æ¶æ„è®¾è®¡åˆæœ‰ä»€ä¹ˆå½±å“ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡å®ƒæ¥é©±åŠ¨æ¶æ„æ¼”è¿›ï¼Œè®©æˆ‘ä»¬æ¥ç€å¾€ä¸‹è¯»ï¼Œæ…¢æ…¢å»ä½“ä¼šè¿™å…¶ä¸­çš„ç²¾é«“ã€‚\næ€§èƒ½æ˜¯ä¸€ç§åŸºç¡€ åœ¨æ¶æ„è®¾è®¡çš„è¿‡ç¨‹ä¸­ï¼Œæ€è€ƒå›ºç„¶é‡è¦ï¼Œä½†ç›®æ ‡æ›´ä¸ºå…³é”®ã€‚é€šè¿‡ç›®æ ‡çš„ç‰µå¼•åŠ›ï¼Œå¯ä»¥å§‹ç»ˆç¡®ä¿æ¨è¿›æ–¹å‘ï¼Œä¸ä¼šè„±ç¦»æˆåŠŸçš„è½¨é“ã€‚é‚£é«˜å¹¶å‘çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Œä¼°è®¡ä½ çš„ç¬¬ä¸€ååº”å°±æ˜¯æ€§èƒ½ã€‚\næ²¡é”™ï¼Œæ€§èƒ½æ˜¯é«˜å¹¶å‘çš„ç›®æ ‡ä¹‹ä¸€ï¼Œå®ƒä¸å¯æˆ–ç¼ºï¼Œä½†å¹¶ä¸ä»£è¡¨æ‰€æœ‰ã€‚è€Œæˆ‘å°†å®ƒè§†ä¸ºæ˜¯é«˜å¹¶å‘çš„ä¸€ç§åŸºç¡€èƒ½åŠ›ï¼Œå®ƒçš„èƒ½åŠ›é«˜ä½å°†ä¼šç›´æ¥å½±å“åˆ°å…¶ä»–èƒ½åŠ›çš„å–èˆã€‚ä¾‹å¦‚ï¼šæœåŠ¡å¯ç”¨æ€§ï¼Œæ•°æ®ä¸€è‡´æ€§ç­‰ã€‚\næ€§èƒ½åœ¨è½¯ä»¶ç ”å‘è¿‡ç¨‹ä¸­æ— å¤„ä¸åœ¨ï¼Œä¸ç®¡æ˜¯åœ¨éåŠŸèƒ½æ€§éœ€æ±‚ä¸­ï¼Œè¿˜æ˜¯åœ¨æ€§èƒ½æµ‹è¯•æŠ¥å‘Šä¸­ï¼Œéƒ½èƒ½è§åˆ°å®ƒçš„èº«å½±ã€‚é‚£ä¹ˆå¦‚ä½•æ¥è¡¡é‡å®ƒçš„é«˜ä½å‘¢ï¼Œå…ˆæ¥çœ‹çœ‹å¸¸ç”¨çš„æ€§èƒ½æŒ‡æ ‡ã€‚\næ¯ç§’å¤„ç†äº‹åŠ¡æ•°ï¼ˆTPSï¼‰ æ¯ç§’èƒ½å¤Ÿå¤„ç†çš„äº‹åŠ¡æ•°ï¼Œå…¶ä¸­T(Transactions)å¯ä»¥å®šä¹‰ä¸åŒçš„å«ä¹‰ï¼Œå®ƒå¯ä»¥æ˜¯å®Œæ•´çš„ä¸€ç¬”ä¸šåŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å•ä¸ªçš„æ¥å£è¯·æ±‚ã€‚\næ¯ç§’è¯·æ±‚æ•°ï¼ˆRPSï¼‰ æ¯ç§’è¯·æ±‚æ•°é‡ï¼Œä¹Ÿå¯ä»¥å«åšQPSï¼Œä½†å®ƒä¸TPSæœ‰æ‰€ä¸åŒï¼Œå‰è€…æ³¨é‡è¯·æ±‚èƒ½åŠ›ï¼Œåè€…æ³¨é‡å¤„ç†èƒ½åŠ›ã€‚ä¸è¿‡ï¼Œè‹¥æ‰€æœ‰è¯·æ±‚éƒ½åœ¨å¾—åˆ°å“åº”åå†æ¬¡å‘èµ·ï¼Œé‚£ä¹ˆRPSåŸºæœ¬ç­‰äºTPSã€‚\nå“åº”æ—¶é•¿ï¼ˆRTï¼‰ ä»å‘å‡ºè¯·æ±‚åˆ°å¾—åˆ°å“åº”çš„è€—æ—¶ï¼Œä¸€èˆ¬å¯ä»¥é‡‡ç”¨æ¯«ç§’å•ä½æ¥è¡¨ç¤ºï¼Œè€Œåœ¨ä¸€äº›å¯¹RTæ¯”è¾ƒæ•æ„Ÿçš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ç²¾åº¦æ›´é«˜çš„å¾®ç§’æ¥è¡¨ç¤ºã€‚\nå¹¶å‘ç”¨æˆ·æ•°ï¼ˆVUï¼‰ åŒæ—¶è¯·æ±‚çš„ç”¨æˆ·æ•°ï¼Œå¾ˆå¤šäººå°†å®ƒä¸å¹¶å‘æ•°ç”»ä¸Šç­‰å·ï¼Œä½†ä¸¤è€…ç¨æœ‰ä¸åŒï¼Œå‰è€…å…³æ³¨å®¢æˆ·ç«¯ï¼Œåè€…å…³æ³¨æœåŠ¡ç«¯ï¼Œé™¤éæ¯ä¸ªç”¨æˆ·ä»…å‘é€ä¸€ç¬”è¯·æ±‚ï¼Œä¸”è¯·æ±‚ä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯æ²¡æœ‰å»¶è¿Ÿï¼ŒåŒæ—¶æœåŠ¡ç«¯æœ‰è¶³å¤Ÿçš„å¤„ç†çº¿ç¨‹ã€‚\nä»¥ä¸Šéƒ½æ˜¯äº›å¸¸ç”¨çš„æ€§èƒ½æŒ‡æ ‡ï¼ŒåŸºæœ¬å¯ä»¥è¦†ç›–80%ä»¥ä¸Šçš„æ€§èƒ½è¡¡é‡è¦æ±‚ã€‚ä½†åƒä¸‡ä¸è¦ä»¥å•ä¸ªæŒ‡æ ‡çš„é«˜ä½æ¥è¡¡é‡æ€§èƒ½ã€‚æ¯”å¦‚ï¼šè®¢å•æŸ¥è¯¢TPS=100ä¸‡å°±è®¤ä¸ºæ€§èƒ½å¾ˆé«˜ï¼Œä½†RT=10ç§’ã€‚\nè¿™æ˜¾ç„¶æ¯«æ— æ„ä¹‰ã€‚å› æ­¤ï¼Œå»ºè®®åŒæ—¶è§‚å¯Ÿå¤šä¸ªæŒ‡æ ‡çš„æ–¹å¼æ¥è¡¡é‡æ€§èƒ½çš„é«˜ä½ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¸»è¦ä¼šå…³æ³¨TPSå’ŒRTï¼Œè€Œä½ å¯ä»¥å°†TPSè§†ä¸ºä¸€ç§æ°´å¹³èƒ½åŠ›ï¼Œæ³¨é‡å¹¶è¡Œå¤„ç†èƒ½åŠ›ï¼Œå°†RTè§†ä¸ºä¸€ç§å‚ç›´èƒ½åŠ›ï¼Œæ³¨é‡å•ç¬”å¤„ç†èƒ½åŠ›ï¼Œä¸¤è€…ç¼ºä¸€ä¸å¯ã€‚\næ¥è§¦è¿‡æ€§èƒ½æµ‹è¯•çš„åŒå­¦ï¼Œå¯èƒ½ä¼šè§è¿‡å¦‚ä¸‹è¿™ç§æ€§èƒ½æµ‹è¯•ç»“æœå›¾ï¼Œå›¾ä¸­åŒ…å«äº†åˆšæ‰æåˆ°è¿‡çš„ä¸‰ä¸ªæ€§èƒ½æŒ‡æ ‡ï¼Œå…¶ä¸­æ¨ªåæ ‡ä¸ºVUï¼Œçºµåæ ‡åˆ†åˆ«ä¸ºTPSå’ŒRTã€‚ å›¾ä¸­çš„ä¸¤æ¡æ›²çº¿ï¼Œåœ¨ä¸æ–­å¢åŠ VUçš„æƒ…å†µä¸‹ï¼ŒTPSä¸æ–­ä¸Šå‡ï¼Œä½†RTä¿æŒç¨³å®šï¼Œä½†å½“VUå¢åŠ åˆ°ä¸€å®šé‡çº§çš„æ—¶å€™ï¼ŒTPSå¼€å§‹è¶‹äºç¨³å®šï¼Œè€ŒRTä¸æ–­ä¸Šå‡ã€‚\nå¦‚æœä½ ä»”ç»†è§‚å¯Ÿï¼Œè¿˜ä¼šå‘ç°ä¸€ä¸ªå¥‡å¦™çš„åœ°æ–¹ï¼Œå½“RT=25msæ—¶ï¼Œå®ƒä»¬ä¸‰è€…å­˜åœ¨ç€æŸç§å…³ç³»ï¼Œå³ï¼šTPS=VU/RTã€‚ä½†å½“RT\u0026gt;25msæ—¶ï¼Œè¿™ç§å…³ç³»ä¼¼ä¹è¢«æ‰“ç ´äº†ï¼Œè¿™é‡Œæš‚æ—¶å…ˆå–ä¸ªå…³å­ï¼Œç¨åå†è¯´ã€‚\næ ¹æ®è¡¨æ ¼ä¸­çš„æ•°æ®ï¼Œæ€§èƒ½æµ‹è¯•æŠ¥å‘Šç»“è®ºï¼šæœ€å¤§TPS=65000ï¼Œå½“RT=25ms(æœ€çŸ­)æ—¶ï¼Œæœ€å¤§å¯æ‰¿å—VU=1500ã€‚\næ„Ÿè§‰æœ‰ç‚¹ä¸å¯¹åŠ²ï¼Œç”¨åˆšæ‰çš„å…¬å¼æ¥éªŒè¯ä¸€ä¸‹ï¼Œ1500/0.025s=60000ï¼Œä½†æœ€å¤§å´æ˜¯TPS=65000ã€‚é‚£æ˜¯å› ä¸ºï¼Œå½“VU=1500æ—¶ï¼Œåº”ç”¨ç³»ç»Ÿçš„ä½¿ç”¨èµ„æºè¿˜æœ‰ç©ºé—´ã€‚\nå†æ¥è§‚å¯Ÿä¸€ä¸‹è¡¨æ ¼ä¸­çš„æ•°æ®ï¼ŒVUä»1500å¢åŠ åˆ°1750æ—¶ï¼ŒTPSç»§ç»­ä¸Šå‡ï¼Œä¸”åˆ°äº†æœ€å¤§å€¼65000ã€‚æ­¤æ—¶ï¼Œä½ æ˜¯ä¸æ˜¯ä¼šç†è§£ä¸ºå½“VUå¢åŠ åˆ°1750æ—¶ï¼Œä½¿ç”¨èµ„æºè¢«è€—å°½äº†ã€‚è¯è™½æ²¡é”™ï¼Œä½†ä¸ä¸¥è°¨ã€‚\næ³¨ï¼šä½¿ç”¨èµ„æºä¸ä¸€å®šæ˜¯æŒ‡ç¡¬ä»¶èµ„æºï¼Œä¹Ÿå¯èƒ½æ˜¯å…¶ä»–æ–¹é¢ï¼Œä¾‹å¦‚ï¼šåº”ç”¨ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§å¤„ç†çº¿ç¨‹ã€‚\nå…¶å®åœ¨VUå¢åŠ åˆ°1750å‰ï¼Œä½¿ç”¨èµ„æºå°±å·²é¥±å’Œï¼Œé‚£å¦‚ä½•æ¥æµ‹ç®—VUçš„ä¸´ç•Œå€¼å‘¢ã€‚ä½ å¯ä»¥å°†æœ€å¤§TPSä½œä¸ºå·²çŸ¥æ¡ä»¶ï¼Œå³ï¼šVU=TPS * RTï¼Œ65000*0.025s=1625ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“VU=1625æ—¶ï¼Œä½¿ç”¨èµ„æºå°†å‡ºç°ç“¶é¢ˆã€‚\nè°ƒæ•´æ€§èƒ½æµ‹è¯•æŠ¥å‘Šç»“è®ºï¼šæœ€å¤§TPS=65000ï¼Œå½“RT=25ms(æœ€çŸ­)æ—¶ï¼Œæœ€å¤§å¯æ‰¿å—VU=1625ã€‚\næœ‰äººä¼šé—®ï¼Œè¡¨æ ¼ä¸­çš„RTæ˜¯ä¸æ˜¯å¹³å‡å€¼ï¼Œé¦–å…ˆå›ç­”ä¸ºæ˜¯ã€‚ä¸è¿‡ï¼Œé«˜å¹¶å‘åœºæ™¯å¯¹RTä¼šç‰¹åˆ«æ•æ„Ÿï¼Œæ‰€ä»¥é™¤äº†è¦è€ƒè™‘RTçš„å¹³å‡å€¼å¤–ï¼Œå»ºè®®è¿˜è¦è€ƒè™‘å®ƒçš„åˆ†ä½å€¼ï¼Œä¾‹å¦‚ï¼šP99ã€‚\nä¸¾ä¾‹ï¼šå‡è®¾1000ç¬”è¯·æ±‚ï¼Œå…¶ä¸­900ç¬”RT=23msï¼Œ50ç¬”RT=36msï¼Œ50ç¬”RT=50ms\nå¹³å‡å€¼ P99å€¼ P95 P90 25ms 50ms 36ms 23ms P99çš„è®¡ç®—æ–¹å¼ï¼Œæ˜¯å°†1000ç¬”è¯·æ±‚çš„RTä»å°åˆ°å¤§è¿›è¡Œæ’åºï¼Œç„¶åå–æ’åœ¨ç¬¬99%ä½çš„æ•°å€¼ï¼ŒåŸºäºä»¥ä¸Šä¸¾ä¾‹æ•°æ®æ¥è¿›è¡Œè®¡ç®—ï¼ŒP99=50msï¼Œå…¶ä»–åˆ†ä½å€¼çš„è®¡ç®—æ–¹å¼ç±»ä¼¼ã€‚\nå†æ¬¡è°ƒæ•´æ€§èƒ½æµ‹è¯•æŠ¥å‘Šç»“è®ºï¼šæœ€å¤§TPS=65000ï¼Œå½“RT(å¹³å‡)=25ms(æœ€çŸ­)æ—¶ï¼Œæœ€å¤§å¯æ‰¿å—VU=1625ï¼ŒRT(P99)=50msï¼ŒRT(P95)=36msï¼ŒRT(P90)=23msã€‚\nåœ¨éåŠŸèƒ½æ€§éœ€æ±‚ä¸­ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°è¿™æ ·çš„éœ€æ±‚ï¼Œæ€§èƒ½æŒ‡æ ‡è¦æ±‚ï¼šRT(å¹³å‡)\u0026lt;=30ã€‚ç»“åˆåˆšæ‰çš„æ€§èƒ½æµ‹è¯•æŠ¥å‘Šç»“è®ºï¼Œå½“RT(å¹³å‡)=25ms(æœ€çŸ­)æ—¶ï¼Œæœ€å¤§å¯æ‰¿å—VU=1625ã€‚é‚£å°±ç­‰äºåœ¨RTä¸Šè¿˜æœ‰5msçš„å®¹å¿æ—¶é—´ã€‚\næ—¢ç„¶æ˜¯è¿™æ ·çš„è¯ï¼Œé‚£æˆ‘ä»¬ä¸å¦¨å°±ç»§ç»­å°è¯•å¢åŠ VUï¼Œä¸è¿‡RT(å¹³å‡)ä¼šå‡ºç°ä¸Šå‡ï¼Œä½†åªè¦æ§åˆ¶ä¸è¦ä¸Šå‡åˆ°30mså³å¯ï¼Œè¿™æ˜¯ä¸€ç§é€šè¿‡ç‰ºç‰²è€—æ—¶(RT)æ¥æ¢å–å¹¶å‘ç”¨æˆ·æ•°(VU)çš„è¡Œä¸ºã€‚ä½†è¯·ä¸è¦æŠŠå®ƒç†è§£ä¸ºæ¯ç¬”è¯·æ±‚è€—æ—¶éƒ½ä¼šä¸Šå‡5msï¼Œè¿™å°†æ˜¯ä¸€ä¸ªä¸¥é‡çš„è¯¯åŒºã€‚\nRT(å¹³å‡)çš„å¢åŠ ï¼Œå®Œå…¨å¯èƒ½æ˜¯ç”±äºåº”ç”¨ç³»ç»Ÿå½“å‰æ²¡æœ‰è¶³å¤Ÿçš„ä½¿ç”¨èµ„æºæ¥å¤„ç†è¯·æ±‚æ‰€é€ æˆçš„ï¼Œä¾‹å¦‚ï¼šå¤„ç†çº¿ç¨‹ã€‚å¦‚æœæ²¡æœ‰å¯ç”¨çº¿ç¨‹å¯ä»¥åˆ†é…ç»™è¯·æ±‚æ—¶ï¼Œå°±ä¼šå°†è¿™è¯·æ±‚å…ˆæ”¾å…¥é˜Ÿåˆ—ï¼Œç­‰å‰é¢çš„è¯·æ±‚å¤„ç†å®Œæˆå¹¶é‡Šæ”¾çº¿ç¨‹åï¼Œå°±å¯ä»¥ç»§ç»­å¤„ç†é˜Ÿåˆ—ä¸­çš„è¯·æ±‚äº†ã€‚\né‚£ä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰è¿›å…¥é˜Ÿåˆ—çš„è¯·æ±‚å¹¶ä¸ä¼šå¢åŠ é¢å¤–çš„è€—æ—¶ï¼Œè€Œåªæœ‰è¿›å…¥é˜Ÿåˆ—çš„è¯·æ±‚ä¼šå¢åŠ ã€‚é‚£ä¹ˆè¿›å…¥é˜Ÿåˆ—çš„è¯·æ±‚ä¼šå¢åŠ å¤šå°‘è€—æ—¶å‘¢ï¼Œåœ¨ç†æƒ³æƒ…å†µä¸‹(RTæ’å®š)ï¼Œå¯èƒ½ä¼šæ˜¯æ­£å¸¸å¤„ç†ä¸€ç¬”è¯·æ±‚è€—æ—¶çš„å€æ•°ï¼Œè€Œå€æ•°çš„å¤§å°åˆå–å†³äºå¹¶å‘è¯·æ±‚çš„æ•°é‡ã€‚\nå‡è®¾æœ€å¤§å¤„ç†çº¿ç¨‹=1625ï¼Œè‹¥æ¯ä¸ªç”¨æˆ·ä»…å‘é€ä¸€ç¬”è¯·æ±‚ï¼Œä¸”è¯·æ±‚ä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯æ²¡æœ‰å»¶è¿Ÿçš„æ¡ä»¶ä¸‹ï¼Œå½“å¹¶å‘ç”¨æˆ·æ•°=1625æ—¶ï¼Œèƒ½å¤Ÿä¿è¯RT=25msï¼Œä½†å½“å¹¶å‘ç”¨æˆ·æ•°\u0026gt;1625æ—¶ï¼Œå› ä¸ºçº¿ç¨‹åªèƒ½åˆ†é…ç»™1625ç¬”è¯·æ±‚ï¼Œé‚£å¤šä½™çš„è¯·æ±‚å°±æ— æ³•ä¿è¯RT=25msã€‚\nè¶…è¿‡1625ç¬”çš„è¯·æ±‚ä¼šå…ˆæ”¾å…¥é˜Ÿåˆ—ï¼Œç­‰å‰é¢1625ç¬”è¯·æ±‚å¤„ç†å®Œæˆåï¼Œå†ä»é˜Ÿåˆ—ä¸­æ‹¿å‡ºæœ€å¤š1625ç¬”è¯·æ±‚è¿›è¡Œä¸‹ä¸€æ‰¹å¤„ç†ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­è¿˜æœ‰å‰©ä½™è¯·æ±‚ï¼Œé‚£å°±ç»§ç»­æŒ‰ç…§è¿™ç§æ–¹å¼å¾ªç¯å¤„ç†ã€‚\nè¿›å…¥é˜Ÿåˆ—çš„è¯·æ±‚ï¼Œæ¯ç­‰å¾…ä¸€æ‰¹å°±éœ€è¦å¢åŠ å‰ä¸€æ‰¹çš„å¤„ç†è€—æ—¶ã€‚åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œæ¯ä¸€æ‰¹éƒ½æ˜¯RT=25msï¼Œå¦‚æœè¿™ç¬”è¯·æ±‚åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…äº†ä¸¤æ‰¹ï¼Œé‚£å°±è¦é¢å¤–å¢åŠ 50msçš„è€—æ—¶ã€‚\nå› æ­¤ï¼Œå¹¶ä¸èƒ½ç®€å•é€šè¿‡VU=TPS* RT=65000*0.03=1950æ¥è®¡ç®—æœ€å¤§å¯æ‰¿å—VUã€‚è€Œæ˜¯éœ€è¦å¼•å…¥ä¸€ç§å«åšç§‘ç‰¹å°”æ³•åˆ™(Littleâ€™s Law)çš„æ’é˜Ÿæ¨¡å‹æ¥ä¼°ç®—ï¼Œä¸è¿‡ç”±äºè¿™ä¸ªæ³•åˆ™æ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œæš‚æ—¶ä¸åšå±•å¼€ã€‚\né€šè¿‡ç²—ç•¥ä¼°ç®—åï¼ŒVUå¤§çº¦åœ¨2032ï¼Œæˆ‘ä»¬å†å¯¹è¿™ä¸ªå€¼ç”¨ä¸Šè¿°è¡¨æ ¼ä¸­å†åå‘éªŒç®—ä¸€ä¸‹ã€‚ æœ€ç»ˆè°ƒæ•´æ€§èƒ½æµ‹è¯•æŠ¥å‘Šç»“è®ºï¼šæœ€å¤§TPS=65000ï¼Œå½“RT(å¹³å‡)=25(æœ€çŸ­)æ—¶ï¼Œæœ€å¤§å¯æ‰¿å—VU=1625ï¼ŒRT(P99)=50ï¼ŒRT(P95)=36ï¼ŒRT(P90)=23ï¼›å½“RT(å¹³å‡)=30(å®¹å¿)æ—¶ï¼Œ(ç†æƒ³æƒ…å†µ)æœ€å¤§å¯æ‰¿å—VU=2032ï¼ŒRT(P99)=RT(P95)=50ï¼ŒRT(P90)=25ã€‚\nè¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆå½“RT\u0026gt;25msæ—¶ï¼ŒVU=TPS*RTä¼šä¸æˆç«‹çš„åŸå› ã€‚ä¸è¿‡ï¼Œè¿™äº›éƒ½æ˜¯åœ¨ç†æƒ³æƒ…å†µä¸‹æ¨æ¼”å‡ºæ¥çš„ï¼Œå®é™…æƒ…å†µä¼šæ¯”è¿™è¦å¤æ‚å¾—å¤šã€‚\næ‰€ä»¥ï¼Œè¿˜æ˜¯å°½é‡é‡‡ç”¨å¤šè½®æ€§èƒ½æµ‹è¯•æ¥å¾—åˆ°æ€§èƒ½æŒ‡æ ‡ï¼Œè¿™æ ·ä¹Ÿæ›´å…·å¤‡çœŸå®æ€§ã€‚æ¯•ç«Ÿå½±å“æ€§èƒ½çš„å› ç´ å®åœ¨å¤§å¤šä¸”å¾ˆéš¾å®Œå…¨æŒæ§ï¼Œä»»ä½•ç»†å¾®å˜åŒ–éƒ½å°†å½±å“æ€§èƒ½æŒ‡æ ‡çš„å˜åŒ–ã€‚\nåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†å¯ä»¥ç”¨å“ªäº›æŒ‡æ ‡æ¥è¡¡é‡æ€§èƒ½çš„é«˜ä½ã€‚ä¸è¿‡ï¼Œè¿™é‡Œæ›´æƒ³å¼ºè°ƒçš„æ˜¯ï¼Œæ€§èƒ½æ˜¯é«˜å¹¶å‘çš„åŸºç¡€èƒ½åŠ›ï¼Œæ˜¯å®ç°é«˜å¹¶å‘çš„åŸºç¡€æ¡ä»¶ï¼Œå¹¶ä¸”ä½ éœ€è¦æœ‰ä¾§é‡æ€§åœ°æå‡ä¸åŒç»´åº¦çš„æ€§èƒ½æŒ‡æ ‡ï¼Œè€Œéä»…å…³æ³¨æŸä¸€é¡¹ã€‚\né™åˆ¶æ˜¯ä¸€ç§è®¾è®¡ ä¸Šæ–‡è¯´åˆ°ï¼Œæ€§èƒ½æ˜¯é«˜å¹¶å‘çš„ç›®æ ‡ä¹‹ä¸€ã€‚è¿½æ±‚æ€§èƒ½æ²¡æœ‰é”™ï¼Œä½†å¹¶éæ°¸æ— æ­¢å¢ƒã€‚æƒ³è¦æå‡æ€§èƒ½ï¼ŒåŠ¿å¿…æŠ•å…¥æˆæœ¬ï¼Œä¸è¿‡å®ƒä»¬å¹¶ä¸æ˜¯ä¸€ç›´æˆæ­£æ¯”ï¼Œè€Œæ˜¯éšç€æˆæœ¬ä¸æ–­å¢åŠ ï¼Œæ€§èƒ½æå‡å¹…åº¦é€æ¸è¡°å‡ï¼Œç”šè‡³å¯èƒ½ä¸å†æå‡ã€‚æ‰€ä»¥ï¼Œæœ‰æ—¶é—´æˆ‘ä»¬è¦æ‡‚å¾—é€‚å¯è€Œæ­¢ã€‚\næ€è€ƒä¸€ä¸‹ï¼Œè¿½æ±‚æ€§èƒ½æ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œè‡³å°‘æœ‰ä¸€ç‚¹ï¼Œæ˜¯ä¸ºäº†è®©åº”ç”¨ç³»ç»Ÿèƒ½å¤Ÿåº”å¯¹çªå‘è¯·æ±‚ã€‚æ¢è¨€ä¹‹ï¼Œå¦‚æœèƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿç®—å®ç°äº†é«˜å¹¶å‘çš„ç›®æ ‡ã€‚\nè€Œæœ‰æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨è§£å†³é—®é¢˜æ—¶ï¼Œä¸è¦æ€»æ˜¯ä¹ æƒ¯åšåŠ æ³•ï¼Œè¿˜å¯ä»¥å°è¯•åšå‡æ³•ï¼Œæ¶æ„è®¾è®¡åŒæ ·å¦‚æ­¤ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•é€šè¿‡åšå‡æ³•çš„æ–¹å¼ï¼Œæ¥è§£å†³åº”å¯¹çªå‘è¯·æ±‚çš„é—®é¢˜å‘¢ã€‚è®©æˆ‘ä»¬æ¥è®²è®²é™åˆ¶ã€‚\né™åˆ¶ï¼Œä»ç‹­ä¹‰ä¸Šå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ç§çº¦æŸæˆ–æ§åˆ¶èƒ½åŠ›ã€‚åœ¨è½¯ä»¶é¢†åŸŸä¸­ï¼Œå®ƒå¯ä»¥é’ˆå¯¹åŠŸèƒ½æ€§æˆ–éåŠŸèƒ½æ€§ï¼Œè€Œåœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸­ï¼Œå®ƒæ›´åå‘äºéåŠŸèƒ½æ€§ã€‚\né™åˆ¶åº”ç”¨ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ï¼Œå¹¶ä¸ä»£è¡¨è¦é™ä½åº”ç”¨ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ï¼Œè€Œæ˜¯é€šè¿‡æŸäº›æ§åˆ¶æ‰‹æ®µï¼Œè®©çªå‘è¯·æ±‚èƒ½å¤Ÿè¢«å¹³æ»‘åœ°å¤„ç†ï¼ŒåŒæ—¶èµ·åˆ°åº”ç”¨ç³»ç»Ÿçš„ä¿æŠ¤èƒ½åŠ›ï¼Œé¿å…ç˜«ç—ªï¼Œè¿˜èƒ½å°†åº”ç”¨ç³»ç»Ÿçš„èµ„æºè¿›è¡Œåˆç†åˆ†é…ï¼Œé¿å…æµªè´¹ã€‚\né‚£ä¹ˆï¼Œåˆ°åº•æœ‰å“ªäº›æ§åˆ¶æ‰‹æ®µï¼Œæ—¢èƒ½å®ç°ä»¥ä¸Šè¿™äº›èƒ½åŠ›ï¼Œåˆèƒ½å‡å°‘å¯¹å®¢æˆ·ä½“éªŒä¸Šçš„å½±å“ï¼Œä¸‹é¢å°±æ¥ä»‹ç»å‡ ç§å¸¸ç”¨çš„æ§åˆ¶æ‰‹æ®µã€‚\nç¬¬ä¸€æ‹›ï¼šé™æµ é™æµï¼Œæ˜¯åœ¨ä¸€ä¸ªæ—¶é—´çª—å£å†…ï¼Œå¯¹è¯·æ±‚è¿›è¡Œé€Ÿç‡æ§åˆ¶ã€‚è‹¥è¯·æ±‚è¾¾åˆ°æå‰è®¾å®šçš„é˜ˆå€¼æ—¶ï¼Œåˆ™å¯¹è¯·æ±‚è¿›è¡Œæ’é˜Ÿæˆ–æ‹’ç»ã€‚å¸¸ç”¨çš„é™æµç®—æ³•æœ‰ä¸¤ç§ï¼šæ¼æ¡¶ç®—æ³•å’Œä»¤ç‰Œæ¡¶ç®—æ³•ã€‚\næ¼æ¡¶ç®—æ³• æ‰€æœ‰è¯·æ±‚å…ˆè¿›å…¥æ¼æ¡¶ï¼Œç„¶åæŒ‰ç…§ä¸€ä¸ªæ’å®šçš„é€Ÿç‡å¯¹æ¼æ¡¶é‡Œçš„è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œæ˜¯ä¸€ç§æ§åˆ¶å¤„ç†é€Ÿç‡çš„é™æµæ–¹å¼ï¼Œç”¨äºå¹³æ»‘çªå‘è¯·æ±‚é€Ÿç‡ã€‚\nå®ƒçš„ä¼˜ç‚¹æ˜¯ï¼Œèƒ½å¤Ÿç¡®ä¿èµ„æºä¸ä¼šç¬é—´è€—å°½ï¼Œé¿å…è¯·æ±‚å¤„ç†å‘ç”Ÿé˜»å¡ç°è±¡ï¼Œå¦å¤–ï¼Œè¿˜èƒ½å¤Ÿä¿æŠ¤è¢«åº”ç”¨ç³»ç»Ÿæ‰€è°ƒç”¨çš„å¤–éƒ¨æœåŠ¡ï¼Œä¹Ÿå…å—çªå‘è¯·æ±‚çš„å†²å‡»ã€‚\nå®ƒçš„ç¼ºç‚¹æ˜¯ï¼Œå¯¹äºçªå‘è¯·æ±‚ä»ç„¶ä¼šä»¥ä¸€ä¸ªæ’å®šçš„é€Ÿç‡æ¥è¿›è¡Œå¤„ç†ï¼Œå…¶çµæ´»æ€§ä¼šè¾ƒå¼±ä¸€ç‚¹ï¼Œå®¹æ˜“å‘ç”Ÿçªå‘è¯·æ±‚è¶…è¿‡æ¼æ¡¶çš„å®¹é‡ï¼Œå¯¼è‡´åç»­è¯·æ±‚ç›´æ¥è¢«ä¸¢å¼ƒã€‚\nä»¤ç‰Œæ¡¶ç®—æ³• åº”ç”¨ç³»ç»Ÿä¼šä»¥ä¸€ä¸ªæ’å®šçš„é€Ÿç‡å¾€æ¡¶é‡Œæ”¾å…¥ä»¤ç‰Œï¼Œè¯·æ±‚å¤„ç†å‰ï¼Œä¼šä»æ¡¶é‡Œè·å–ä»¤ç‰Œï¼Œå½“æ¡¶é‡Œæ²¡æœ‰ä»¤ç‰Œå¯å–æ—¶ï¼Œåˆ™æ‹’ç»æœåŠ¡ï¼Œæ˜¯ä¸€ç§å¹³å‡æµå…¥é€Ÿç‡çš„é™æµæ–¹å¼ã€‚\nå®ƒçš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨é™åˆ¶å¹³å‡æµå…¥é€Ÿç‡çš„åŒæ—¶ï¼Œè¿˜èƒ½åœ¨é¢å¯¹çªå‘è¯·æ±‚çš„æƒ…å†µä¸‹ï¼Œç¡®ä¿èµ„æºè¢«å……åˆ†åˆ©ç”¨ï¼Œä¸ä¼šè¢«é—²ç½®æˆ–æµªè´¹ã€‚\nå®ƒçš„ç¼ºç‚¹æ˜¯ï¼Œèˆå¼ƒäº†å¤„ç†é€Ÿç‡çš„å¼ºæ§åˆ¶èƒ½åŠ›ï¼Œé‚£ä¹ˆå¦‚æœæŸäº›åŠŸèƒ½ä¾èµ–å¤–éƒ¨æœåŠ¡ï¼Œå¯èƒ½å°†ä¼šè®©å¤–éƒ¨æœåŠ¡æ— æ³•æ‰¿å—å‹åŠ›ï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸è¿”å›ï¼Œè€Œä¸”è¿˜æµªè´¹äº†è¿™æ¬¡è·å–çš„ä»¤ç‰Œã€‚\nç»¼ä¸Šï¼Œä¸¤ç§ç®—æ³•å¹¶æ²¡æœ‰ç»å¯¹çš„å¥½åï¼Œè€Œæ˜¯éœ€è¦æ ¹æ®å®é™…çš„æƒ…å†µï¼Œé€‰æ‹©åˆé€‚çš„æ–¹å¼ï¼Œä»è€Œåœ¨å‘æŒ¥é™æµä½œç”¨çš„åŒæ—¶ä¸ä¼šå¼•å‘å…¶ä»–é—®é¢˜ã€‚ä½†åœ¨ä¸€äº›ç§’æ€æ´»åŠ¨ä¸­ï¼Œè½¯ä»¶å…šçš„é«˜é¢‘è¯·æ±‚ï¼Œä¼šå¾ˆå®¹æ˜“è§¦å‘é™æµï¼Œå¯¼è‡´å¤§é‡æ­£å¸¸è¯·æ±‚è¢«è¯¯æ€çš„é—®é¢˜ã€‚\nè™½ç„¶åœ¨è¯·æ±‚è¢«é™æµåï¼Œä¼šè¿”å›å‹å¥½è¯æœ¯ï¼Œå‡è½»å¯¹å®¢æˆ·ä½“éªŒçš„å½±å“ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½ä»–ä»¬çš„è¯·æ±‚ï¼Œä¼šä¸€ç›´æ— æ³•å¾—åˆ°æœ‰æ•ˆå¤„ç†ï¼Œè¿™æ—¶å€™è€å¿ƒå†å¥½çš„å®¢æˆ·ä¹Ÿä¼šç¦»å¼€åŠæŠ±æ€¨ã€‚\næ‰€ä»¥ï¼Œæˆ‘ä»¬é™¤äº†ä½¿ç”¨é™æµè¿™æ‹›å¤–ï¼Œè¿˜å¾—æ­é…å…¶ä»–çš„æ‹›æ•°ç»„åˆä¸€èµ·ä½¿ç”¨ï¼Œä»è€Œè®©åº”ç”¨ç³»ç»Ÿèƒ½å¤Ÿå¯¹èµ„æºè¿›è¡Œåˆç†åˆ†é…ï¼Œé¿å…èµ„æºæµªè´¹ï¼Œå‡å°‘æ­£å¸¸è¯·æ±‚è¢«è¯¯æ€çš„æƒ…å†µã€‚\nç¬¬äºŒæ‹›ï¼šé™é¢‘ é™é¢‘ï¼Œæ˜¯åœ¨ä¸€ä¸ªæ—¶é—´çª—å£å†…ï¼Œå¯¹åŒä¸€ç‰¹å¾çš„è¯·æ±‚è¿›è¡Œé€Ÿç‡æ§åˆ¶ã€‚è‹¥è¯·æ±‚è¾¾åˆ°æå‰è®¾å®šçš„é˜ˆå€¼æ—¶ï¼Œåˆ™ä¼šå¯¹è¯·æ±‚è¿›è¡Œæ‹’ç»ã€‚\nè™½ç„¶å’Œé™æµæœ‰ç‚¹ç±»ä¼¼ï¼Œä½†å­˜åœ¨ç€ç»†å¾®çš„å·®åˆ«ã€‚å¯¹é™æµè€Œè¨€ï¼Œå®ƒå¹¶ä¸å…³å¿ƒè¯·æ±‚æ–¹ï¼Œè€Œåªå¯¹æœåŠ¡ç«¯çš„é€Ÿç‡è¿›è¡Œæ§åˆ¶ï¼Œè€Œå¯¹é™é¢‘è€Œè¨€ï¼Œå®ƒä¼šåŸºäºæŸç§ç‰¹å¾ï¼Œå¯¹è¯·æ±‚æ–¹çš„è¯·æ±‚é€Ÿç‡è¿›è¡Œæ§åˆ¶ã€‚\nè€Œé™é¢‘çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†å‡å°‘åº”ç”¨ç³»ç»Ÿèµ„æºè¢«ä¸æ­£å¸¸çš„è¯·æ±‚æ‰€æ¶ˆè€—ï¼Œè€Œå¯¼è‡´æ­£å¸¸çš„è¯·æ±‚å› é™æµè¢«æ‹’ç»çš„æƒ…å†µå‘ç”Ÿã€‚å®ƒçš„å®ç°æ–¹å¼ä¹Ÿæœ‰å¤šç§ï¼Œè€Œä¸”åœ¨å‰ç«¯å’Œåç«¯éƒ½å¯ä»¥ä½¿ç”¨ã€‚\nè¯†åˆ«ä¸æ­£å¸¸çš„è¯·æ±‚æ˜¯é™é¢‘çš„ç¬¬ä¸€æ­¥ï¼Œä¹Ÿæ˜¯æœ€å…³é”®çš„ä¸€æ­¥ã€‚ä¸€èˆ¬ä¼šåˆ¶å®šæŸç§ç‰¹å¾+æŸæ®µæ—¶é—´+è¯·æ±‚æ•°é‡è¿™ç§ä¸‰æ®µå¼çš„è¯†åˆ«è§„åˆ™ã€‚\nç‰¹å¾å¯ä»¥æ˜¯è´¦å·ã€ä¼šè¯ã€IPåœ°å€ã€è®¾å¤‡å·ç­‰ï¼Œæ—¶é—´ä¸€èˆ¬ä¼šæ˜¯1ç§’ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æ›´é•¿ã€‚è´¦å·+1ç§’+5ç¬”ï¼Œæ„æ€å°±æ˜¯åŒä¸€ä¸ªè´¦å·åœ¨1ç§’å†…å¯ä»¥å‘ç”Ÿ5ç¬”è¯·æ±‚ï¼Œä½†æ˜¯è¿™é‡Œè¯·æ±‚æ•°é‡ä¸é™æµçš„è®¾å®šå‚è€ƒä¾æ®ä¸åŒã€‚\né™æµå¤§å°ä¸»è¦ä¾æ®æ€§èƒ½æ¥å†³å®šï¼Œè€Œé™é¢‘ä¸­çš„è¯·æ±‚æ•°é‡ï¼Œä¸€èˆ¬ä¼šä»¥æ­£å¸¸äººçš„äº¤äº’é€Ÿç‡ä½œä¸ºå‚è€ƒã€‚æ‰€ä»¥ï¼Œå¹¶ä¸èƒ½å› ä¸ºæ€§èƒ½å¥½ï¼Œå°±è®¾å®šè´¦å·+1ç§’+100ç¬”è¿™ç§è¯†åˆ«è§„åˆ™ï¼Œè¿™ä¸ä½†ä¸ç§‘å­¦è¿˜ä¼šæµªè´¹èµ„æºã€‚\næ¥ä¸‹æ¥ï¼Œæœ‰äº†è¯†åˆ«è§„åˆ™è¿˜å¾—æ­é…å¯¹åº”çš„å¤„ç½®æ‰‹æ®µï¼Œå¸¸è§çš„æœ‰ä¸¤ç§æ¨¡å¼ï¼šæŒ‘æˆ˜å’Œæ‹’ç»ã€‚ é™æµä¼šå‘ç”Ÿè¯¯æ€ï¼Œéš¾é“é™é¢‘å°±ä¸ä¼šå—ï¼Œå…¶å®ä¹Ÿä¼šå‘ç”Ÿï¼Œç‰¹åˆ«æ˜¯ç”¨æˆ·çš„ç½‘ç»œç¯å¢ƒæ˜¯ä¸€ä¸ªå‡ºå£IPåœ°å€æ—¶ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ˜¯åŸºäºIPåœ°å€ç‰¹å¾çš„è¯†åˆ«è§„åˆ™ï¼Œè¯·æ±‚æ•°é‡å»ºè®®é€‚å½“æ”¾å¤§ã€‚\nåœ¨é™é¢‘ç­–ç•¥æ–¹é¢ï¼Œå»ºè®®é…ç½®å¤šå±‚+æ¸è¿›å¼çš„æ–¹å¼ï¼Œè¯†åˆ«è§„åˆ™è¾ƒä¸ºä¸¥æ ¼çš„é‡‡ç”¨æŒ‘æˆ˜æ¨¡å¼ï¼Œè¯†åˆ«è§„åˆ™è¾ƒä¸ºå®½æ¾çš„é‡‡ç”¨æ‹’ç»æ¨¡å¼ï¼Œå‡å°‘å› é™é¢‘è€Œå¼•å‘çš„è¯¯æ€æƒ…å†µï¼Œå‚è€ƒå¦‚ä¸‹ï¼š é™é¢‘ç¡®å®å¯ä»¥ä½¿åº”ç”¨ç³»ç»Ÿçš„èµ„æºï¼Œè¢«åˆç†åœ°åˆ†é…ç»™è¯·æ±‚æ–¹ï¼Œä½†å¹¶ä¸èƒ½ä¿è¯ä¸‡æ— ä¸€å¤±ï¼Œç‰¹åˆ«å¯¹äºé‚£äº›æŠ€æœ¯é«˜è¶…çš„è½¯ä»¶å…šä»¬ï¼Œä»–ä»¬ä»ç„¶å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼ç»•å¼€è¿™ç§æ§åˆ¶æ‰‹æ®µã€‚\nä¸è¿‡ï¼Œä½ å¯ä»¥å°†æ­¤è§†ä¸ºä¸€ç§æ”»é˜²æˆ˜ï¼Œé€šè¿‡å¢å¼ºé˜²å®ˆçš„æ–¹å¼ï¼Œæ¥æé«˜æ”»å‡»è€…æˆæœ¬ï¼Œè€Œæ”»å‡»è€…ä¸€å®šä¼šæƒè¡¡æˆæœ¬å’Œæ”¶ç›Šï¼Œå½“æˆæœ¬å¤§äºæ”¶ç›Šæ—¶ï¼Œå¯èƒ½å°±ä¸ä¼šæœ‰æ”»å‡»ï¼Œæ¯•ç«Ÿæ²¡æœ‰äººä¼šè¿™ä¹ˆæ— èŠé€é¡¶ã€‚\nè™½ç„¶æœ‰äº†é™æµå’Œé™é¢‘è¿™ä¸¤æ‹›ï¼Œä½†ä»å¯èƒ½æ— æ³•åº”å¯¹é«˜å¹¶å‘çš„åœºæ™¯ï¼Œå†µä¸”åœ¨åˆæœŸï¼Œé™æµå’Œé™é¢‘çš„ç­–ç•¥ï¼Œä¹Ÿæ— æ³•è®¾è®¡å¾—éå¸¸å®Œç¾ã€‚æ‰€ä»¥ï¼Œæœ‰äº›æ—¶å€™è¿˜å¾—ä½¿å‡ºæœ€åä¸€æ‹›ã€‚\nç¬¬ä¸‰æ‹›ï¼šé™çº§ é™çº§ï¼Œæ˜¯å½“åº”ç”¨ç³»ç»Ÿå¤„ç†è¶…è½½æ—¶ï¼Œå¯¹å…¶æœåŠ¡è¿›è¡Œè£å‰ªçš„ä¸€ç§æœºåˆ¶ã€‚å¸¸è§çš„æ˜¯åº”ç”¨ç³»ç»Ÿå¤„ç†é˜»å¡æ—¶ï¼Œä¼šå…³é—­éæ ¸å¿ƒæœåŠ¡ï¼Œå¹¶å°†èµ„æºç»™åˆ°æ ¸å¿ƒæœåŠ¡ï¼Œä»è€Œç¡®ä¿æ ¸å¿ƒæœåŠ¡æ­£å¸¸ã€‚\nç»å¸¸æœ‰äººå°†å®ƒä¸ç†”æ–­æ··ä¸ºä¸€è°ˆï¼Œä½†å¹¶éä¸€å›äº‹ã€‚é™çº§ä¸»è¦æ˜¯é’ˆå¯¹åº”ç”¨ç³»ç»Ÿæœ¬èº«ï¼Œè‹¥å¤„ç†èƒ½åŠ›ä¸è¶³åˆ™å¯è§¦å‘ï¼Œè€Œç†”æ–­ä¸»è¦æ˜¯é’ˆå¯¹åº”ç”¨ç³»ç»Ÿæ‰€è°ƒç”¨çš„å¤–éƒ¨æœåŠ¡ï¼Œè‹¥å¤–éƒ¨æœåŠ¡ä¸ç¨³å®šæ—¶åˆ™å¯è§¦å‘ã€‚\nå½“ç„¶ï¼Œä¸¤è€…ä¹Ÿæœ‰ä¸€å®šçš„å…³ç³»ï¼Œå› ä¸ºå½“å‘ç”Ÿç†”æ–­æ—¶ï¼Œä¹Ÿå¯ä»¥è§¦å‘é™çº§æœºåˆ¶ï¼Œæ¯”å¦‚å½“åŒæ­¥è°ƒç”¨å¤–éƒ¨æœåŠ¡å‡ºç°æ€§èƒ½é—®é¢˜æ—¶ï¼Œå¯ä»¥é™çº§ä¸ºå¼‚æ­¥è°ƒç”¨ï¼Œé¿å…é€ æˆçº¿ç¨‹é˜»å¡è€Œç˜«ç—ªã€‚\nä¸è¿‡åœ¨é™çº§å‰ï¼Œå¿…é¡»å¾—å…ˆæ¢³ç†åº”ç”¨ç³»ç»Ÿä¸­çš„æ ¸å¿ƒæœåŠ¡ï¼Œå¯ä»¥é‡‡ç”¨ç»å…¸çš„äºŒå…«åŸåˆ™ï¼Œå°†æœåŠ¡åˆ’åˆ†ä¸º20%æ ¸å¿ƒæœåŠ¡+80%éæ ¸å¿ƒæœåŠ¡ã€‚è€Œè¿™ç§åˆ†æ³•çš„æ„å›¾ï¼Œæ˜¯å¸Œæœ›è®©ä½ æ‰¾åˆ°çœŸæ­£é‡è¦çš„æ ¸å¿ƒæœåŠ¡ï¼Œä¸ç„¶ï¼Œä½ ä¼šè§‰å¾—éƒ½å¾ˆé‡è¦ã€‚\nåœ¨æ¢³ç†è¿‡ç¨‹ä¸­ï¼Œå»ºè®®é€šè¿‡å¤šä¸ªç»´åº¦æ¥è¿›è¡Œç»¼åˆè¯„åˆ¤ï¼Œå¦‚ä¸‹æ˜¯æˆ‘ç»å¸¸é‡‡ç”¨çš„ä¸€ç§æ¢³ç†æ–¹æ³•ï¼Œä½ å¯ä»¥å°†æ­¤ä½œä¸ºä¸€ç§å‚è€ƒï¼Œå¹¶ç»“åˆè‡ªå·±çš„æœåŠ¡åˆ†ç±»æ ‡å‡†è¿›è¡Œè°ƒæ•´ã€‚\né¦–å…ˆï¼Œå¯ä»¥è®¾è®¡ä¸€å¼ ç±»ä¼¼å¦‚ä¸‹çš„çŸ©é˜µå›¾ï¼Œè¯·å°½é‡åœ°ç®€çº¦å®ƒï¼Œå°†åº”ç”¨ç³»ç»Ÿä¸­çš„å„ç±»æœåŠ¡ï¼ŒæŒ‰ç…§çŸ©é˜µæ‰€è®¾å®šçš„ä¸åŒå±æ€§è¿›è¡Œåˆ†é—¨åˆ«ç±»ã€‚ ç„¶åï¼Œå°†ä¸šåŠ¡ç±»+æ“ä½œç±»çš„æŒ‘é€‰å‡ºæ¥ä½œä¸ºæ ¸å¿ƒæœåŠ¡ï¼Œä½ ä¼šä¸ä¼šè®¤ä¸ºè¿™å°±ç»“æŸäº†ã€‚ä¸å¥½æ„æ€ï¼Œæ¸¸æˆæ‰åˆšåˆšå¼€å§‹ã€‚ä¸è¿‡ä½ å¯ä»¥è¯•æƒ³ä¸€ä¸‹ï¼Œå‡è®¾ä»…ä¿ç•™è¿™äº›æ ¸å¿ƒæœåŠ¡ï¼Œä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ã€‚\nç”¨æˆ·ç™»å½•ä¸äº†æ— æ³•è®¢å•æ”¯ä»˜ï¼Œè®¢å•æŸ¥è¯¢ä¸äº†æ— æ³•è®¢å•é€€è´§ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¿˜éœ€å¼•å…¥æœåŠ¡å…³é”®è·¯å¾„çš„æ¦‚å¿µï¼Œå¯ä»¥ç†è§£ä¸ºåœ¨ä½¿ç”¨æŸä¸ªæœåŠ¡å‰ï¼Œè¿˜å¿…é¡»è¦ä½¿ç”¨çš„å…¶ä»–æœåŠ¡ã€‚\nåˆ†åˆ«å¯¹æŒ‘é€‰å‡ºæ¥çš„æ ¸å¿ƒæœåŠ¡ï¼Œè¿›è¡ŒæœåŠ¡å…³é”®è·¯å¾„çš„æ¢³ç†ã€‚ è·¯å¾„1ï¼šç”¨æˆ·ç™»å½•â€”â€”\u0026gt;å•†å“æŸ¥è¯¢â€”â€”\u0026gt;è®¢å•ä¸‹å• è·¯å¾„2ï¼šç”¨æˆ·ç™»å½•â€”â€”\u0026gt;å•†å“æŸ¥è¯¢â€”â€”\u0026gt;è®¢å•ä¸‹å•â€”â€”\u0026gt;è®¢å•æ”¯ä»˜ è·¯å¾„3ï¼šç”¨æˆ·ç™»å½•â€”â€”\u0026gt;è®¢å•æŸ¥è¯¢â€”â€”\u0026gt;è®¢å•é€€è´§\nå¾…æœåŠ¡å…³é”®è·¯å¾„æ¢³ç†å®Œæˆåï¼Œå†å¯¹è·¯å¾„ä¸Šçš„æ‰€æœ‰æœåŠ¡è¿›è¡Œåˆå¹¶åŠå»é‡ï¼Œå°†ä¼šå¾—åˆ°ä¸€ç»„æ–°çš„æ ¸å¿ƒæœåŠ¡ï¼šç”¨æˆ·ç™»å½•/å•†å“æŸ¥è¯¢/è®¢å•ä¸‹å•/è®¢å•æ”¯ä»˜/è®¢å•æŸ¥è¯¢/è®¢å•é€€è´§ã€‚\næ¥è®¡ç®—ä¸‹æ ¸å¿ƒæœåŠ¡çš„å æ¯”ï¼Œæ‰€æœ‰æœåŠ¡14ä¸ª/æ ¸å¿ƒæœåŠ¡6ä¸ªï¼Œå 42.86%ï¼Œè¿œè¿œè¶…è¿‡äº†20%ã€‚æ‰€ä»¥ï¼Œå»ºè®®ç»§ç»­ä»è¿™äº›æ ¸å¿ƒæœåŠ¡ä¸­ï¼Œè¯†åˆ«æ›´æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œä½†ä»ç„¶ä»¥æœåŠ¡å…³é”®è·¯å¾„ä¸ºæ•´ä½“ã€‚\nç›¸æ¯”è®¢å•ä¸‹å•/è®¢å•æ”¯ä»˜/è®¢å•é€€è´§è¿™ä¸‰æ¡æœåŠ¡å…³é”®è·¯å¾„ï¼Œæˆ‘æƒ³è®¢å•æ”¯ä»˜å¯èƒ½ä¼šæ›´æœ‰ä»·å€¼ã€‚æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ä»…å°†è®¢å•æ”¯ä»˜è¿™æ¡æœåŠ¡å…³é”®è·¯å¾„ä¸Šçš„æœåŠ¡ä½œä¸ºæ ¸å¿ƒæœåŠ¡ã€‚\né‡æ–°å†æ¥è®¡ç®—ä¸‹æ ¸å¿ƒæœåŠ¡çš„å æ¯”ï¼Œæ‰€æœ‰æœåŠ¡14ä¸ª/æ ¸å¿ƒæœåŠ¡4ä¸ªï¼Œå 28.57%ï¼Œè™½ç„¶è¿˜æ˜¯è¶…è¿‡äº†20%ï¼Œä½†è¿™å¹¶ä¸æ˜¯é‡ç‚¹ï¼Œé‡ç‚¹æ˜¯æˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†æœ€æ ¸å¿ƒçš„æœåŠ¡ã€‚\nå…¶ä½™çš„æ ¸å¿ƒæœåŠ¡ï¼Œå¯ä»¥é™çº§ä¸ºå‡†æ ¸å¿ƒæœåŠ¡ï¼Œé‡ç»„åå¾—åˆ°å¦‚ä¸‹è¿™ä»½æœåŠ¡é‡è¦ç¨‹åº¦æ¸…å•ã€‚ å½“æ‹¥æœ‰è¿™ä»½æ¸…å•åï¼Œè‹¥åº”ç”¨ç³»ç»Ÿå¤„ç†é˜»å¡æ—¶ï¼Œå°±å¯ä»¥æŒ‰ç…§éæ ¸å¿ƒæœåŠ¡\u0026gt;å‡†æ ¸å¿ƒæœåŠ¡\u0026gt;æ ¸å¿ƒæœåŠ¡è¿™ä¸ªé¡ºåºä¾æ¬¡è¿›è¡Œé™çº§ã€‚ä¸è¿‡ï¼Œé™çº§ä¸ä¸€å®šè¦æ‹’ç»è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥æ˜¯é™æµè¯·æ±‚ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å¯¹æœåŠ¡èƒ½åŠ›çš„è£å‰ªåŠ›åº¦ã€‚\nä»¥ä¸Šåªæ˜¯ä¸€ç§ç›¸å¯¹è¾ƒç²—çš„é™çº§ç­–ç•¥ï¼Œå¦‚æœä½ æƒ³è¦åˆ¶å®šæ›´ç²¾ç»†åŒ–çš„é™çº§ç­–ç•¥ï¼Œè¿˜éœ€è¦å¯¹æ¯ä¸ªæœåŠ¡è¿›è¡Œä¼˜å…ˆçº§çš„è®¾å®šï¼Œé«˜ä½ä¾æ®å¯ä»¥ç»“åˆè‡ªèº«éœ€è¦æ¥åˆ¶å®šï¼Œä¾‹å¦‚ï¼šå†å²æœåŠ¡ä½¿ç”¨æƒ…å†µã€‚\nå½“æœ‰äº†é™æµã€é™é¢‘ã€é™çº§è¿™ä¸‰æ‹›ï¼ŒåŸºæœ¬å°±èƒ½å¤Ÿåœ¨èµ„æºæœ‰é™çš„æƒ…å†µä¸‹ï¼Œè®©çªå‘è¯·æ±‚èƒ½å¤Ÿè¢«å¹³æ»‘åœ°å¤„ç†ï¼Œå°†åº”ç”¨ç³»ç»Ÿçš„èµ„æºèƒ½å¤Ÿè¢«åˆç†åœ°åˆ†é…ï¼Œä»¥åŠå½“åº”ç”¨ç³»ç»Ÿå¤„ç†å µå¡æ—¶ï¼Œç¡®ä¿æ ¸å¿ƒæœåŠ¡æ­£å¸¸ã€‚\nå–èˆæ˜¯ä¸€ç§æƒè¡¡ ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»åŸºæœ¬äº†è§£äº†å¦‚ä½•è¡¡é‡æ€§èƒ½çš„æŒ‡æ ‡ï¼Œä»¥åŠå¤§è‡´æŒæ¡äº†å¦‚ä½•ä¿æŠ¤åº”ç”¨ç³»ç»Ÿçš„æ‹›æ•°ã€‚ä½†è¿™äº›å°±æ˜¯é«˜å¹¶å‘å…¨éƒ¨äº†å—ï¼Œæˆ‘æƒ³è¯´è¿™ä»…ä»…åªæ˜¯å…¥é—¨çº§åˆ«ã€‚\nä¸Šè¿°å†…å®¹ï¼Œä¸»è¦æ˜¯ä¸ºäº†è®©ä½ èƒ½å¤Ÿæ¸…æ™°åœ°çœ‹åˆ°åº”ç”¨ç³»ç»Ÿçš„æ€§èƒ½æ°´ä½åœ¨å“ªé‡Œï¼Œä»¥åŠåœ¨èµ„æºæœ‰é™ä¸‹ï¼Œå½“é¢å¯¹çªå‘è¯·æ±‚æ—¶å¯ä»¥é‡‡å–å“ªäº›æ‹›æ•°ï¼Œèƒ½è®©åº”ç”¨ç³»ç»Ÿå®‰å…¨åœ°å­˜æ´»ä¸‹æ¥ã€‚\nå­˜æ´»ï¼Œå³ä»£è¡¨ç€å¯ç”¨æ€§ï¼Œå®ƒä¹Ÿæ˜¯é«˜å¹¶å‘çš„ä¸€ä¸ªç‰¹æ€§ï¼Œè€Œä¸”æ˜¯æˆ‘è®¤ä¸ºç›¸å¯¹æ¯”è¾ƒé‡è¦çš„ç‰¹æ€§ã€‚è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä½ çš„åº”ç”¨ç³»ç»Ÿè¿å¯ç”¨æ€§éƒ½æ— æ³•ä¿è¯ï¼Œé‚£å†é«˜çš„æ€§èƒ½åˆæœ‰ä½•æ„ä¹‰ã€‚\nå¯¹äºå¤§éƒ¨åˆ†åº”ç”¨ç³»ç»Ÿè€Œè¨€ï¼Œå¤§å®¶éƒ½ä¼šæ¯”è¾ƒå…³æ³¨åº”ç”¨ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œ99.9%ä¸å¤Ÿé‚£å°±99.99%ï¼Œç”šè‡³è¿˜æœ‰æƒ³åšåˆ°99.999%çš„ï¼Œæ¯•ç«Ÿå¯ç”¨æ€§çš„ä¸è¶³ä¼šç›´æ¥å½±å“åˆ°ä¸šåŠ¡è¿ä½œã€‚\nä½†å¯¹äºä¸€ä¸ªæƒ³æˆä¸ºé«˜å¹¶å‘çš„åº”ç”¨ç³»ç»Ÿè€Œè¨€ï¼Œä»…å•æ–¹é¢å…³æ³¨é«˜å¯ç”¨ï¼Œè‚¯å®šæ— æ³•ç§°å¾—ä¸Šè¿™ä¸ªå¤´è¡”ï¼Œå®ƒä»ç„¶è¿˜éœ€è¦åœ¨å…¶ä»–ç‰¹æ€§ä¸Šå…·å¤‡æä½³çš„è¡¨ç°ã€‚\nè®©æˆ‘ä»¬æ‹‰å›åˆ°æœ€åˆçš„ç›®æ ‡ï¼Œæ€§èƒ½æ˜¯é«˜å¹¶å‘çš„ç›®æ ‡ä¹‹ä¸€ï¼Œä¸è¿‡ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸å†è°ˆè®ºæ€§èƒ½æŒ‡æ ‡ï¼Œè€Œæ˜¯æ¥ç ”ç©¶å¦‚ä½•æ¥æå‡æ€§èƒ½ã€‚å› ä¸ºï¼Œé«˜æ€§èƒ½æ˜¯é«˜å¹¶å‘çš„å¦å¤–ä¸€ä¸ªé‡è¦ç‰¹æ€§ã€‚\næƒ³è¦æå‡æ€§èƒ½ï¼ŒåŠ¿å¿…æŠ•å…¥æˆæœ¬ã€‚éšç€æˆæœ¬ä¸æ–­å¢åŠ ï¼Œæ€§èƒ½æå‡å¹…åº¦é€æ¸è¡°å‡ã€‚è¿™ä¸¤å¥è¯ï¼Œæ˜¯ä¸æ˜¯è§‰å¾—æœ‰ç‚¹è€³ç†Ÿï¼Œä½†ä¸ç®¡ä½ æ˜¯å¦è¿˜è®°å¾—ï¼Œå…ˆè®©æˆ‘åœ¨è¿™é‡Œæ‰“ä¸ªé—®å·å†è¯´ã€‚\nåœ¨æ¶æ„è®¾è®¡çš„è¿‡ç¨‹ä¸­ï¼Œä½ æ˜¯å¦ç»å¸¸ä¼šå¬åˆ°â€œå–èˆâ€çš„è¿™ä¸ªè¯ï¼Œå®ƒæ˜¯é€šè¿‡ç‰ºç‰²ä¸€ç§èƒ½åŠ›æ¥æ¢å–å¦å¤–ä¸€ç§èƒ½åŠ›çš„æ–¹å¼ï¼Œè¿™äº›èƒ½åŠ›å¯ä»¥æ˜¯æ€§èƒ½ã€å¯ç”¨æ€§ã€æ•°æ®ä¸€è‡´æ€§æˆ–æ˜¯å…¶ä»–èƒ½åŠ›ã€‚\nç­‰ç­‰ï¼Œä½ æ˜¯ä¸æ˜¯çªç„¶æœ‰æ„è¯†åˆ°ï¼Œæå‡æ€§èƒ½å¹¶ä¸åªæœ‰æŠ•å…¥æˆæœ¬è¿™ç§æ–¹å¼ï¼Œè‡³å°‘æ˜¯åœ¨ç¡¬ä»¶èµ„æºæ–¹é¢ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ç‰ºç‰²ä¸€ç§èƒ½åŠ›å»æ¢å–ã€‚é‚£åˆ°åº•é€‰æ‹©ç‰ºç‰²å“ªç§èƒ½åŠ›å‘¢ï¼Œç‰ºç‰²å¯ç”¨æ€§ï¼Œä¸€èˆ¬ä¸ä¼šç¬¬ä¸€æ—¶é—´è€ƒè™‘ï¼Œé‚£æ˜¯ä¸æ˜¯å¯ä»¥è€ƒè™‘ç‰ºç‰²æ•°æ®ä¸€è‡´æ€§ã€‚\nä½†åœ¨è€ƒè™‘å‰å¾—å…ˆå£°æ˜ä¸€ä¸‹ï¼Œæ‰€è°“ç‰ºç‰²æ•°æ®ä¸€è‡´æ€§ï¼Œå¹¶ä¸æ˜¯å®Œå…¨ä¸è¦ï¼Œè€Œæ˜¯å°†æ•°æ®å¼ºä¸€è‡´æ€§é™çº§ä¸ºæœ€ç»ˆä¸€è‡´æ€§ã€‚è€Œå¯¹äºæ•°æ®æœ€ç»ˆä¸€è‡´æ€§çš„ç†è§£ï¼Œå°±æ˜¯åœ¨æ•°æ®æ›´æ–°åï¼Œè¦è¿‡ä¸€æ®µæ—¶é—´åæ‰èƒ½çœ‹åˆ°ï¼Œè€Œæ—¶é—´çš„é•¿çŸ­å°±ä»£è¡¨ç€ç‰ºç‰²äº†å¤šå°‘ã€‚\nä½†å¹¶ä¸æ˜¯è¯´ï¼Œæ‰€æœ‰æƒ…å†µéƒ½å¿…é¡»ç‰ºç‰²æ•°æ®ä¸€è‡´æ€§æ¥æå‡æ€§èƒ½ï¼Œæœ‰äº›æ—¶å€™ä¹Ÿå¯ä»¥è€ƒè™‘ç‰ºç‰²å…¶ä»–èƒ½åŠ›ã€‚ä½†åœ¨å–èˆå‰ï¼Œå¾—å…ˆå¼„æ¸…æ¥šå½“å‰è¦ä»€ä¹ˆï¼Œä½†æ›´éœ€è¦å¼„æ¸…æ¥šå½“å‰å¯ä»¥å¤±å»ä»€ä¹ˆï¼Œä¸åˆç†çš„å–èˆï¼Œä¸ä½†æ— æ³•æ¢å–æ”¶ç›Šï¼Œåè€Œè¿˜ä¼šå¼•æ¥æ›´å¤šçš„é—®é¢˜ã€‚\næƒ…å†µ1ï¼šæ•°æ®ç¼“å­˜ ç¼“å­˜ï¼Œæ˜¯é«˜å¹¶å‘æ¶æ„è®¾è®¡ä¸­ä¸€ç§ä¸å¯æˆ–ç¼ºçš„èƒ½åŠ›ï¼Œä¸€èˆ¬æ˜¯æŒ‡é‚£äº›ç»å¸¸è¢«è®¿é—®çš„çƒ­ç‚¹æ•°æ®ï¼Œå¯ä»¥å°†å®ƒæ”¾å…¥ç¼“å­˜ä¸­ï¼Œä»è€Œæå‡æ•°æ®è¢«è¯»å–çš„æ•ˆç‡ã€‚\nä½†æ˜¯å¦æ‰€æœ‰çš„æ•°æ®éƒ½é€‚åˆæ”¾å…¥ç¼“å­˜ä¸­ï¼Œå¦‚æœæ˜¯é™æ€æ•°æ®ï¼Œé‚£ä¹ˆä½ å¯ä»¥å¾ˆå®‰å¿ƒåœ°æ”¾å…¥ã€‚åŸå› å¾ˆç®€å•ï¼Œé™æ€æ•°æ®ä¸ä¼šæ›´æ–°ï¼Œé‚£ä¹ˆç¼“å­˜å’Œæ•°æ®æºå§‹ç»ˆä¿æŒä¸€è‡´ï¼Œè€Œä¸”å°±ç®—ç¼“å­˜ä¸­çš„æ•°æ®ä¸¢å¤±äº†ï¼Œè‡³å°‘è¿˜æœ‰ä¸€ä»½åœ¨æ•°æ®æºã€‚\né€šè¿‡å°†é™æ€æ•°æ®ç¼“å­˜ï¼Œå¯ä»¥å¾ˆè½»æ˜“åœ°æå‡é™æ€æ•°æ®çš„è®¿é—®æ€§èƒ½ï¼Œç”šè‡³å¯èƒ½æ˜¯å‡ åå€çš„æ•ˆæœã€‚ä½†åº”ç”¨ç³»ç»Ÿä¸­è¿˜æœ‰å¤§é‡çš„åŠ¨æ€æ•°æ®ï¼Œä»…æå‡é™æ€æ•°æ®å¯èƒ½å¯¹æ€»ä½“çš„æå‡å¹¶ä¸ä¸€å®šæ˜¾è‘—ã€‚\nä½ æ˜¯ä¸æ˜¯æƒ³è¯´ï¼Œé‚£å°±æŠŠåŠ¨æ€æ•°æ®ä¹Ÿæ”¾å…¥ç¼“å­˜ä¸­ä¸å°±è¡Œäº†ã€‚åœ¨ä¸‹è¿™ä¸ªå†³å®šå‰ï¼Œå»ºè®®ä½ å…ˆæƒ³ä¸€ä¸‹ï¼ŒåŠ¨æ€æ•°æ®æ˜¯ä¼šæ›´æ–°çš„ï¼Œè¿™å°±æ„å‘³ç€åŠ¨æ€æ•°æ®åœ¨æ”¾å…¥ç¼“å­˜åï¼Œå½“æ•°æ®æºä¸­çš„æ•°æ®è¢«æ›´æ–°åï¼Œå†æ¬¡è®¿é—®è¿”å›çš„éƒ½æ˜¯æ›´æ–°å‰çš„æ•°æ®ï¼Œè¿™ç§æ•ˆæœä½ æ˜¯å¦å¯ä»¥æ¥å—ã€‚\næˆ‘æƒ³åº”è¯¥æ²¡æœ‰äººä¼šæ¥å—å§ï¼Œè€Œä½ æ˜¯ä¸æ˜¯åˆæƒ³è¯´ï¼Œè®¾ç½®ä¸‹ç¼“å­˜ä¼šè¿‡æœŸä¸å°±èƒ½è§£å†³äº†ã€‚æ²¡é”™ï¼Œä½†å¾—ç­‰è¿‡æœŸåæ‰èƒ½è§£å†³ï¼Œé‚£è¿˜æ²¡è¿‡æœŸå‰å‘¢ï¼Œè¿™ç§æ–¹å¼åªèƒ½ç¼“è§£ï¼Œä½†å¹¶ä¸èƒ½æ ¹æ²»ï¼Œè€Œä¸”è¿˜ä¼šå¼•å…¥ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œè¯·é—®è¿‡æœŸè®¾ç½®å¤šä¹…æ‰åˆé€‚ã€‚\nè®¾ç½®ç¼“å­˜5ç§’é’Ÿè¿‡æœŸï¼Œå¯èƒ½æ°¸è¿œæ— æ³•å‘½ä¸­ç¼“å­˜ï¼Œè€Œä¸”ä¸ä½†æ²¡æœ‰æå‡æ€§èƒ½ï¼Œè¿˜å¢åŠ äº†ä»£ç å¤æ‚åº¦ï¼Œæœ‰ç‚¹ç”»è›‡æ·»è¶³çš„æ„Ÿè§‰ã€‚è®¾ç½®ç¼“å­˜5åˆ†é’Ÿè¿‡æœŸï¼Œå‘½ä¸­ç¼“å­˜çš„å‡ ç‡å¯èƒ½ä¼šæé«˜ï¼Œä½†ç¼“å­˜ååœ¨5åˆ†é’Ÿå†…çš„å¦‚æœæ•°æ®æ›´æ–°ï¼Œè¦ä»ç¼“å­˜å¼€å§‹å¾€åæ¨5åˆ†é’Ÿæ‰èƒ½çœ‹åˆ°ã€‚\nå³ï¼šç¬¬1åˆ†é’Ÿç¼“å­˜ï¼Œç¬¬1-6åˆ†é’Ÿå†…çš„ä»»ä½•æ•°æ®æ›´æ–°ï¼Œè¦ç¬¬6åˆ†é’Ÿåæ‰èƒ½çœ‹åˆ°ã€‚\næ‰€ä»¥ï¼Œå¦‚æœä½ æ— æ³•å®¹å¿è¿™ç§æƒ…å†µï¼Œè¯·ä½ ä¸è¦æ»¥ç”¨ç¼“å­˜ï¼Œè™½ç„¶æ€§èƒ½æé«˜äº†ï¼Œä½†é—®é¢˜å¯èƒ½ä¹Ÿå‡ºç°äº†ã€‚åä¹‹ï¼Œå¦‚æœä½ å¯ä»¥å®¹å¿è¿™ç§æƒ…å†µï¼Œé‚£å°±å¯ä»¥è¿™ä¹ˆæ“ä½œï¼Œè€Œè‡³äºè¿‡æœŸè®¾ç½®å¤šä¹…ï¼Œå¯ä»¥ç»“åˆä¸šåŠ¡åœºæ™¯åŠä½¿ç”¨é¢‘ç‡ç»¼åˆæ¥è¯„ä¼°ï¼Œæ¯•ç«Ÿä¸åŒçš„ä¸šåŠ¡å®¹å¿åº¦æ˜¯ä¸åŒçš„ã€‚\nå¯¹äºæ˜¯å¦è¦å°†åŠ¨æ€æ•°æ®è¿›è¡Œç¼“å­˜ï¼Œæœ¬è´¨ä¸Šï¼Œå…¶å®å°±æ˜¯ä¸€ç§å–èˆï¼Œæ˜¯ä¸€ç§æ€§èƒ½ä¸æ•°æ®ä¸€è‡´æ€§çš„æƒè¡¡ï¼Œè€Œç¼“å­˜çš„è¿‡æœŸæ—¶é•¿ï¼Œå°±åƒæ˜¯ä¿æŒè¿™ç§å¹³è¡¡çš„æ”¯ç‚¹ï¼Œä»è€Œè®©è¿™ç§ç‰ºç‰²å˜å¾—æ›´æœ‰æ„ä¹‰ã€‚\næƒ…å†µ2ï¼šå•æœºé™æµ é™æµï¼Œå‰é¢å·²ç»æœ‰ä»‹ç»è¿‡ï¼Œå®ƒæœ‰ä¸¤ç§å¸¸ç”¨çš„é™æµç®—æ³•ï¼Œæ¼æ¡¶ç®—æ³•å’Œä»¤ç‰Œæ¡¶ç®—æ³•ã€‚ä¸è¿‡ï¼Œè¿™ä¸¤ç§ç®—æ³•éƒ½ä»…æ”¯æŒå•æœºé™æµï¼Œä¸æ”¯æŒå…¨å±€é™æµã€‚\nå•æœºé™æµï¼Œå°±æ˜¯å¯¹å•èŠ‚ç‚¹è®¾å®šä¸€ä¸ªé™æµé˜ˆå€¼ï¼Œå¦‚æœå•èŠ‚ç‚¹ä¸Šçš„è¯·æ±‚åˆ°è¾¾é˜ˆå€¼ï¼Œåˆ™ä¼šæ‹’ç»è¯·æ±‚ã€‚ä¾‹å¦‚ï¼šé™æµé˜ˆå€¼=æ¯ç§’100æ¬¡è¯·æ±‚ï¼Œå¦‚æœåœ¨1ç§’å†…å•èŠ‚ç‚¹ä¸Šï¼Œæœ‰ç¬¬101æ¬¡çš„è¯·æ±‚åˆ™æ‹’ç»ã€‚\nå…¨å±€é™æµï¼Œå°±æ˜¯å¯¹ä¸€ç»„èŠ‚ç‚¹è®¾å®šä¸€ä¸ªé™æµæ€»é˜ˆå€¼ï¼Œå¦‚æœè¿™ç»„èŠ‚ç‚¹ä¸Šçš„æ±‡æ€»è¯·æ±‚åˆ°è¾¾é˜ˆå€¼ï¼Œåˆ™ä¼šæ‹’ç»è¯·æ±‚ã€‚ä¾‹å¦‚ï¼š10ä¸ªèŠ‚ç‚¹çš„é™æµæ€»é˜ˆå€¼=1000æ¬¡è¯·æ±‚ï¼Œå¦‚æœåœ¨1ç§’å†…è¿™ç»„èŠ‚ç‚¹ä¸Šï¼Œæ±‡æ€»æœ‰ç¬¬1001æ¬¡è¯·æ±‚åˆ™æ‹’ç»ï¼Œä¸è¿‡å•èŠ‚ç‚¹ä¸Šæœ‰è¶…è¿‡ç¬¬100æ¬¡çš„è¯·æ±‚ä¹Ÿä¼šæ¥å—ã€‚\nè¿™ä¹ˆçœ‹ä¸‹æ¥ï¼Œæ„Ÿè§‰å•æœºé™æµæ§åˆ¶èƒ½åŠ›æ›´å‰å®³ä¸€ç‚¹ï¼Œå®ƒèƒ½ä¿è¯å•èŠ‚ç‚¹çš„è¯·æ±‚ä¸ä¼šè¶…è¿‡100æ¬¡ã€‚è€Œå…¨å±€é™æµåœ¨æç«¯æƒ…å†µä¸‹ï¼Œå•èŠ‚ç‚¹éƒ½æœ‰å¯èƒ½åœ¨1ç§’å†…ä¼šæ¥å—1000æ¬¡è¯·æ±‚ã€‚å½“ç„¶ï¼Œè¿™ç§æƒ…å†µçš„å¯èƒ½æ€§æ¯”è¾ƒä½ï¼Œæ¯”å¦‚åœ¨çªå‘è¯·æ±‚æ—¶ï¼Œ9ä¸ªèŠ‚ç‚¹åŒæ—¶å®•æœºã€‚\næ—¢ç„¶å¦‚æ­¤ï¼Œé‚£å…¨å±€é™æµæœ‰å­˜åœ¨çš„æ„ä¹‰å—ï¼Œéš¾é“è¿™å°±æ˜¯æ¼æ¡¶ç®—æ³•å’Œä»¤ç‰Œæ¡¶ç®—æ³•éƒ½ä¸æ”¯æŒå…¨å±€é™æµçš„åŸå› ã€‚å…¨å±€é™æµå°±çœŸçš„æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰å—ã€‚å­˜åœ¨å³åˆç†ï¼Œæ—¢ç„¶å­˜åœ¨ï¼Œé‚£å°±ä¸€å®šæœ‰å®ƒå­˜åœ¨çš„é“ç†ã€‚\næ¢ä¸ªæƒ…å†µï¼Œè¿˜æ˜¯å°†10ä¸ªèŠ‚ç‚¹ä¸ºä¸€ç»„ï¼Œä¸è¿‡è¿™æ¬¡æ¢æˆé‡‡ç”¨å•æœºé™æµã€‚é—®é¢˜æ¥äº†ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„é™æµé˜ˆå€¼è¯¥å¦‚ä½•è®¾å®šï¼Œå¦‚æœé‡‡ç”¨å¹³å‡åˆ†é…ï¼Œåˆ™é™æµé˜ˆå€¼=æ¯ç§’100æ¬¡è¯·æ±‚ï¼Œè®©æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œåœ¨1ç§’å†…ä¾æ¬¡å‘å‡º1000æ¬¡è¯·æ±‚ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆç°è±¡ã€‚\nç»“æœæ˜¯åœ¨ç¬¬100æ¬¡è¯·æ±‚åï¼Œä»ç¬¬101æ¬¡åˆ°ç¬¬1000æ¬¡çš„è¯·æ±‚ä¸­ï¼Œå¯èƒ½æœ‰äº›è¯·æ±‚ä¼šå‘ç”Ÿè¢«æ‹’ç»çš„æƒ…å†µï¼Œè€Œä¸”è¯·æ±‚ä¸€ä¼šå„¿æˆåŠŸä¸€ä¼šå„¿æ‹’ç»ï¼Œæ²¡æœ‰ä»»ä½•è§„å¾‹ã€‚åŸå› å¯èƒ½æ˜¯10ä¸ªèŠ‚ç‚¹è¯·æ±‚è´Ÿè½½ä¸å‡æ‰€å¼•å‘çš„ï¼Œå¯¼è‡´æŸä¸ªèŠ‚ç‚¹æå‰è¶…è¿‡äº†100æ¬¡è¯·æ±‚ã€‚\nåŸºäºä»¥ä¸Šæƒ…å†µï¼Œæœ€ç»ˆ1000æ¬¡è¯·æ±‚æ²¡æœ‰å…¨éƒ¨æˆåŠŸï¼Œè¿™ç§æƒ…å†µç­‰åŒäºé™ä½äº†åº”ç”¨ç³»ç»Ÿçš„ååèƒ½åŠ›ã€‚è€Œåœ¨å®é™…æƒ…å†µä¸­ï¼Œå°±ç®—é‡‡ç”¨è½®è¯¢çš„è´Ÿè½½ç®—æ³•ï¼Œè¯·æ±‚æ•°ä¸å‡çš„å¯èƒ½æ€§ä»ç„¶è¿˜æ˜¯ä¼šå­˜åœ¨çš„ã€‚è¿™ä¹ˆä¸€çœ‹ï¼Œå•æœºé™æµå¥½åƒä¹Ÿæœ‰ç¼ºé™·ã€‚\nä¼°è®¡ä½ å·²ç»è¢«æˆ‘è¯´æ™•äº†å§ï¼Œè®©æˆ‘ä»¬æ•´ä½“å†é‡æ–°æ¢³ç†ä¸€éï¼Œå¹¶å¯¹ä¸¤ç§ä¸åŒé™æµæ¨¡å¼çš„å½±å“è¿›è¡Œå¯¹æ¯”ã€‚ä¸è¿‡ï¼Œè¿™æ¬¡è¿˜åŠ ä¸Šæ¯ç§’ä¸åŒçš„è¯·æ±‚æ•°é‡ã€‚ ä¸¤ç§é™æµå¯¹æ¯”ä¸‹æ¥ï¼Œå•æœºé™æµæ›´å¼ºè°ƒå•æœºçš„æ§åˆ¶èŒƒå›´ï¼Œä½†å¯èƒ½ä¼šé€ æˆé¢å¤–çš„è¯·æ±‚æ‹’ç»ï¼Œä½†å¯¹å•èŠ‚ç‚¹ä¸ä¼šé€ æˆæ€§èƒ½å‹åŠ›ï¼Œè€Œå…¨å±€é™æµæ›´å¼ºè°ƒæ•´ä½“çš„æ§åˆ¶èŒƒå›´ï¼Œè™½ä¸ä¼šé€ æˆé¢å¤–çš„è¯·æ±‚æ‹’ç»ï¼Œä½†å¯èƒ½ä¼šå¯¹å•èŠ‚ç‚¹é€ æˆæ€§èƒ½å‹åŠ›ï¼Œå¼•å‘æ€§èƒ½è¿‡è½½ã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œå…¨å±€é™æµè¿˜æ˜¯ä¸€ç§é‡‡ç”¨ä¸­å¿ƒåŒ–çš„è®¾è®¡æ€è·¯ï¼Œå› æ­¤åœ¨ç½‘ç»œå¼€é”€æ–¹é¢ï¼Œè¿˜ä¼šäº§ç”Ÿé¢å¤–çš„æ€§èƒ½æŸè€—ï¼Œè¿™ç§æŸè€—åœ¨è¯·æ±‚é‡å°‘çš„æ—¶å€™ä¼°è®¡è¿˜å¯ä»¥å®¹å¿ï¼Œä½†åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹å¯èƒ½æ˜¯åœºç¾éš¾ï¼Œå› ä¸ºåœ¨æ¯æ¬¡é™æµåˆ¤æ–­å‰ï¼Œè¿˜ä¼šäº§ç”Ÿä¸€æ¬¡ç½‘ç»œå¼€é”€ã€‚\næ‰€ä»¥ï¼Œä¸èƒ½ä¸ºäº†æƒ³è¦å®ç°æ›´ç²¾å‡†çš„é™æµï¼Œå°±ç›²ç›®åœ°é‡‡ç”¨å…¨å±€é™æµï¼Œå®ƒå°†åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹æŸè€—æ›´å¤šçš„æ€§èƒ½ã€‚è€Œå•æœºé™æµæ‰€é¢å¤–é€ æˆçš„å°‘é‡è¯·æ±‚æ‹’ç»ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨æŸäº›æŠ€æœ¯æ‰‹æ®µè¿›è¡Œè¡¥å¿ã€‚\nä¸è¿‡ï¼Œä¸ç®¡æ˜¯å•æœºé™æµè¿˜æ˜¯å…¨å±€é™æµï¼Œä¼¼ä¹éƒ½å’Œæ•°æ®ä¸€è‡´æ€§æ²¡æœ‰å…³ç³»ã€‚ä½†äº‹å®ä¸Šï¼Œå…¨å±€é™æµè¿™ç§ç²¾å‡†é™æµçš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥è§†ä¸ºå¦ä¸€ç§ä¸€è‡´æ€§çš„è¡¨ç°ï¼Œè€Œå•æœºé™æµå°±æ˜¯é€šè¿‡å¯¹è¿™ç§ä¸€è‡´æ€§çš„ç‰ºç‰²ï¼Œæ¥å‡å°‘æ€§èƒ½æŸè€—ï¼Œä½•å°ä¸æ˜¯æå‡æ€§èƒ½çš„å¦ä¸€ç§æ–¹å¼ã€‚\nä»¥ä¸Šï¼Œåªæ˜¯ç®€å•åˆ—ä¸¾äº†ä¸¤ç§ä¸åŒæƒ…å†µä¸‹çš„å–èˆï¼Œè€Œåœ¨é«˜å¹¶å‘æ¶æ„ä¸Šï¼Œå¯å–èˆçš„åœ°æ–¹è¿œä¸æ­¢è¿™äº›ã€‚ä½ å¾—çŸ¥é“ï¼Œé«˜å¹¶å‘çš„æ¯ä¸€å¤„è®¾è®¡æˆ–æ¯ä¸€ä»½è®¾è®¡æ–¹æ¡ˆçš„èƒŒåï¼Œéƒ½æ›¾æ˜¯é€šè¿‡ä¸æ–­åœ°å–èˆæ‰€è·å¾—çš„ï¼Œè€Œæ²¡æœ‰å–èˆçš„é«˜å¹¶å‘æ¶æ„å†³ç­–ï¼Œå°†ä¼šæ˜¾å¾—æ¯«æ— è¯´æœåŠ›ã€‚\nå–èˆä¸ä½†å¯ä»¥ä½œä¸ºé«˜å¹¶å‘æ¶æ„å†³ç­–çš„æœ‰åŠ›æ­¦å™¨ï¼Œä¹Ÿå°†æ˜¯é©±åŠ¨æ¶æ„æ¼”è¿›æœ€åˆç†çš„ä¸€ç§æ–¹å¼ã€‚ä½†è¦åˆ‡è®°ï¼Œå–èˆçš„æ–¹å‘å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œè€Œæ˜¯ä¼šéšç€å¤–ç•Œç¯å¢ƒçš„å˜åŒ–è€Œå˜åŒ–ï¼Œå®ƒå°†æ˜¯ä¸€ç§ç‹¬ç‰¹çš„è‰ºæœ¯ã€‚\nå†™åœ¨æœ€å é«˜å¹¶å‘çš„é­…åŠ›ä¹‹å¤„ï¼Œå°±åœ¨äºå®ƒæ²¡æœ‰å”¯ä¸€çš„ç­”æ¡ˆï¼Œè€Œç­”æ¡ˆæ˜¯éœ€è¦æˆ‘ä»¬ä»¥ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ä½œä¸ºçº¿ç´¢å»ä¸æ–­åœ°å¯»æ‰¾ï¼Œè¿™ç§å¯»æ‰¾çš„è¿‡ç¨‹ä¹Ÿæ˜¯ä¸€ç§ä¸æ–­æ€è€ƒçš„è¿‡ç¨‹ï¼Œè¿™å°±æ˜¯æˆ‘ä¸ºä»€ä¹ˆè¯´é«˜å¹¶å‘æ˜¯ä¸€ç§æ¶æ„æ€ç»´æ¨¡å¼ã€‚\næœ¬æ–‡ä»æµ…åˆ°æ·±ä¾æ¬¡è®²è¿°äº†æ€§èƒ½æ˜¯å®ç°é«˜å¹¶å‘çš„åŸºç¡€æ¡ä»¶ï¼Œæ§åˆ¶æ˜¯å®ç°èµ„æºæœ€å¤§åŒ–åˆ©ç”¨çš„æ–¹å¼ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡å–èˆæ¥æ¢å–å½“å‰åº”ç”¨ç³»ç»Ÿæ›´æ‰€éœ€çš„èƒ½åŠ›ï¼Œä½†è¿™äº›ä»…ä»…åªæ˜¯é«˜å¹¶å‘ä¸–ç•Œé‡Œçš„ä¸€ä¸ªè§’è½ã€‚å› ç¯‡å¹…æœ‰é™ï¼Œä»Šå¤©å°±æš‚å‘Šä¸€æ®µè½ã€‚\næœ€åæƒ³è¯´ï¼Œé«˜å¹¶å‘å…¶å®å¹¶ä¸å¯æ€•ï¼Œå¯æ€•çš„æ˜¯ä½ çŸ¥å…¶ç„¶è€Œä¸çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚å¯¹äºè¿½æ±‚æŠ€æœ¯çš„ä½ ï¼Œéœ€è¦ä¸æ–­åœ°æ‹“å®½ä½ çš„æŠ€æœ¯æ·±åº¦ä¸å¹¿åº¦ï¼Œæ‰èƒ½æ›´å¥½åœ°æŒæ¡é«˜å¹¶å‘ï¼Œä»¥åŠè¿ç”¨é«˜å¹¶å‘çš„æ€ç»´æ¨¡å¼æ¥æå‡åº”ç”¨ç³»ç»Ÿå¤„ç†èƒ½åŠ›ã€‚\n","permalink":"https://reid00.github.io/en/posts/os_network/%E9%AB%98%E5%B9%B6%E5%8F%91%E6%9E%B6%E6%9E%84/","summary":"ä»‹ç» ä»€ä¹ˆæ˜¯é«˜å¹¶å‘ï¼Œä»å­—é¢ä¸Šç†è§£ï¼Œå°±æ˜¯åœ¨æŸä¸€æ—¶åˆ»äº§ç”Ÿå¤§é‡çš„è¯·æ±‚ï¼Œé‚£ä¹ˆå¤šå°‘é‡ç§°ä¸ºå¤§é‡ï¼Œä¸šç•Œå¹¶æ²¡æœ‰æ ‡å‡†çš„è¡¡é‡èŒƒå›´ã€‚åŸå› éå¸¸ç®€å•ï¼Œä¸åŒçš„ä¸šåŠ¡å¤„ç†å¤æ‚åº¦ä¸ä¸€æ ·ã€‚\nè€Œæˆ‘æ‰€ç†è§£çš„é«˜å¹¶å‘ï¼Œå®ƒå¹¶ä¸åªæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè€Œæ›´æ˜¯ä¸€ç§æ¶æ„æ€ç»´æ¨¡å¼ï¼Œå®ƒè®©ä½ åœ¨é¢å¯¹ä¸åŒçš„å¤æ‚æƒ…å†µä¸‹ï¼Œä»å®¹åœ°é€‰æ‹©ä¸åŒçš„æŠ€æœ¯æ‰‹æ®µï¼Œæ¥æå‡åº”ç”¨ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ã€‚\nä½†æ˜¯ï¼Œå¹¶ä¸æ„å‘³åº”ç”¨ç³»ç»Ÿä»è¯ç”Ÿçš„é‚£ä¸€åˆ»ï¼Œå°±éœ€è¦å…·å¤‡å¼ºå¤§çš„å¤„ç†èƒ½åŠ›ï¼Œè¿™ç§åšæ³•å¹¶ä¸æå€¡ã€‚è¦çŸ¥é“ï¼Œè„±ç¦»å®é™…æƒ…å†µçš„æŠ€æœ¯ï¼Œä¼šæ˜¾å¾—æ¯«æ— ä»·å€¼ï¼Œç”šè‡³æ˜¯ä¸€ç§æµªè´¹çš„è¡¨ç°ã€‚\nè¨€å½’æ­£ä¼ ï¼Œé‚£é«˜å¹¶å‘åˆ°åº•æ˜¯ä¸€ç§æ€æ ·çš„æ¶æ„æ€ç»´æ¨¡å¼ï¼Œå®ƒå¯¹æ¶æ„è®¾è®¡åˆæœ‰ä»€ä¹ˆå½±å“ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡å®ƒæ¥é©±åŠ¨æ¶æ„æ¼”è¿›ï¼Œè®©æˆ‘ä»¬æ¥ç€å¾€ä¸‹è¯»ï¼Œæ…¢æ…¢å»ä½“ä¼šè¿™å…¶ä¸­çš„ç²¾é«“ã€‚\næ€§èƒ½æ˜¯ä¸€ç§åŸºç¡€ åœ¨æ¶æ„è®¾è®¡çš„è¿‡ç¨‹ä¸­ï¼Œæ€è€ƒå›ºç„¶é‡è¦ï¼Œä½†ç›®æ ‡æ›´ä¸ºå…³é”®ã€‚é€šè¿‡ç›®æ ‡çš„ç‰µå¼•åŠ›ï¼Œå¯ä»¥å§‹ç»ˆç¡®ä¿æ¨è¿›æ–¹å‘ï¼Œä¸ä¼šè„±ç¦»æˆåŠŸçš„è½¨é“ã€‚é‚£é«˜å¹¶å‘çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Œä¼°è®¡ä½ çš„ç¬¬ä¸€ååº”å°±æ˜¯æ€§èƒ½ã€‚\næ²¡é”™ï¼Œæ€§èƒ½æ˜¯é«˜å¹¶å‘çš„ç›®æ ‡ä¹‹ä¸€ï¼Œå®ƒä¸å¯æˆ–ç¼ºï¼Œä½†å¹¶ä¸ä»£è¡¨æ‰€æœ‰ã€‚è€Œæˆ‘å°†å®ƒè§†ä¸ºæ˜¯é«˜å¹¶å‘çš„ä¸€ç§åŸºç¡€èƒ½åŠ›ï¼Œå®ƒçš„èƒ½åŠ›é«˜ä½å°†ä¼šç›´æ¥å½±å“åˆ°å…¶ä»–èƒ½åŠ›çš„å–èˆã€‚ä¾‹å¦‚ï¼šæœåŠ¡å¯ç”¨æ€§ï¼Œæ•°æ®ä¸€è‡´æ€§ç­‰ã€‚\næ€§èƒ½åœ¨è½¯ä»¶ç ”å‘è¿‡ç¨‹ä¸­æ— å¤„ä¸åœ¨ï¼Œä¸ç®¡æ˜¯åœ¨éåŠŸèƒ½æ€§éœ€æ±‚ä¸­ï¼Œè¿˜æ˜¯åœ¨æ€§èƒ½æµ‹è¯•æŠ¥å‘Šä¸­ï¼Œéƒ½èƒ½è§åˆ°å®ƒçš„èº«å½±ã€‚é‚£ä¹ˆå¦‚ä½•æ¥è¡¡é‡å®ƒçš„é«˜ä½å‘¢ï¼Œå…ˆæ¥çœ‹çœ‹å¸¸ç”¨çš„æ€§èƒ½æŒ‡æ ‡ã€‚\næ¯ç§’å¤„ç†äº‹åŠ¡æ•°ï¼ˆTPSï¼‰ æ¯ç§’èƒ½å¤Ÿå¤„ç†çš„äº‹åŠ¡æ•°ï¼Œå…¶ä¸­T(Transactions)å¯ä»¥å®šä¹‰ä¸åŒçš„å«ä¹‰ï¼Œå®ƒå¯ä»¥æ˜¯å®Œæ•´çš„ä¸€ç¬”ä¸šåŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å•ä¸ªçš„æ¥å£è¯·æ±‚ã€‚\næ¯ç§’è¯·æ±‚æ•°ï¼ˆRPSï¼‰ æ¯ç§’è¯·æ±‚æ•°é‡ï¼Œä¹Ÿå¯ä»¥å«åšQPSï¼Œä½†å®ƒä¸TPSæœ‰æ‰€ä¸åŒï¼Œå‰è€…æ³¨é‡è¯·æ±‚èƒ½åŠ›ï¼Œåè€…æ³¨é‡å¤„ç†èƒ½åŠ›ã€‚ä¸è¿‡ï¼Œè‹¥æ‰€æœ‰è¯·æ±‚éƒ½åœ¨å¾—åˆ°å“åº”åå†æ¬¡å‘èµ·ï¼Œé‚£ä¹ˆRPSåŸºæœ¬ç­‰äºTPSã€‚\nå“åº”æ—¶é•¿ï¼ˆRTï¼‰ ä»å‘å‡ºè¯·æ±‚åˆ°å¾—åˆ°å“åº”çš„è€—æ—¶ï¼Œä¸€èˆ¬å¯ä»¥é‡‡ç”¨æ¯«ç§’å•ä½æ¥è¡¨ç¤ºï¼Œè€Œåœ¨ä¸€äº›å¯¹RTæ¯”è¾ƒæ•æ„Ÿçš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ç²¾åº¦æ›´é«˜çš„å¾®ç§’æ¥è¡¨ç¤ºã€‚\nå¹¶å‘ç”¨æˆ·æ•°ï¼ˆVUï¼‰ åŒæ—¶è¯·æ±‚çš„ç”¨æˆ·æ•°ï¼Œå¾ˆå¤šäººå°†å®ƒä¸å¹¶å‘æ•°ç”»ä¸Šç­‰å·ï¼Œä½†ä¸¤è€…ç¨æœ‰ä¸åŒï¼Œå‰è€…å…³æ³¨å®¢æˆ·ç«¯ï¼Œåè€…å…³æ³¨æœåŠ¡ç«¯ï¼Œé™¤éæ¯ä¸ªç”¨æˆ·ä»…å‘é€ä¸€ç¬”è¯·æ±‚ï¼Œä¸”è¯·æ±‚ä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯æ²¡æœ‰å»¶è¿Ÿï¼ŒåŒæ—¶æœåŠ¡ç«¯æœ‰è¶³å¤Ÿçš„å¤„ç†çº¿ç¨‹ã€‚\nä»¥ä¸Šéƒ½æ˜¯äº›å¸¸ç”¨çš„æ€§èƒ½æŒ‡æ ‡ï¼ŒåŸºæœ¬å¯ä»¥è¦†ç›–80%ä»¥ä¸Šçš„æ€§èƒ½è¡¡é‡è¦æ±‚ã€‚ä½†åƒä¸‡ä¸è¦ä»¥å•ä¸ªæŒ‡æ ‡çš„é«˜ä½æ¥è¡¡é‡æ€§èƒ½ã€‚æ¯”å¦‚ï¼šè®¢å•æŸ¥è¯¢TPS=100ä¸‡å°±è®¤ä¸ºæ€§èƒ½å¾ˆé«˜ï¼Œä½†RT=10ç§’ã€‚\nè¿™æ˜¾ç„¶æ¯«æ— æ„ä¹‰ã€‚å› æ­¤ï¼Œå»ºè®®åŒæ—¶è§‚å¯Ÿå¤šä¸ªæŒ‡æ ‡çš„æ–¹å¼æ¥è¡¡é‡æ€§èƒ½çš„é«˜ä½ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¸»è¦ä¼šå…³æ³¨TPSå’ŒRTï¼Œè€Œä½ å¯ä»¥å°†TPSè§†ä¸ºä¸€ç§æ°´å¹³èƒ½åŠ›ï¼Œæ³¨é‡å¹¶è¡Œå¤„ç†èƒ½åŠ›ï¼Œå°†RTè§†ä¸ºä¸€ç§å‚ç›´èƒ½åŠ›ï¼Œæ³¨é‡å•ç¬”å¤„ç†èƒ½åŠ›ï¼Œä¸¤è€…ç¼ºä¸€ä¸å¯ã€‚\næ¥è§¦è¿‡æ€§èƒ½æµ‹è¯•çš„åŒå­¦ï¼Œå¯èƒ½ä¼šè§è¿‡å¦‚ä¸‹è¿™ç§æ€§èƒ½æµ‹è¯•ç»“æœå›¾ï¼Œå›¾ä¸­åŒ…å«äº†åˆšæ‰æåˆ°è¿‡çš„ä¸‰ä¸ªæ€§èƒ½æŒ‡æ ‡ï¼Œå…¶ä¸­æ¨ªåæ ‡ä¸ºVUï¼Œçºµåæ ‡åˆ†åˆ«ä¸ºTPSå’ŒRTã€‚ å›¾ä¸­çš„ä¸¤æ¡æ›²çº¿ï¼Œåœ¨ä¸æ–­å¢åŠ VUçš„æƒ…å†µä¸‹ï¼ŒTPSä¸æ–­ä¸Šå‡ï¼Œä½†RTä¿æŒç¨³å®šï¼Œä½†å½“VUå¢åŠ åˆ°ä¸€å®šé‡çº§çš„æ—¶å€™ï¼ŒTPSå¼€å§‹è¶‹äºç¨³å®šï¼Œè€ŒRTä¸æ–­ä¸Šå‡ã€‚\nå¦‚æœä½ ä»”ç»†è§‚å¯Ÿï¼Œè¿˜ä¼šå‘ç°ä¸€ä¸ªå¥‡å¦™çš„åœ°æ–¹ï¼Œå½“RT=25msæ—¶ï¼Œå®ƒä»¬ä¸‰è€…å­˜åœ¨ç€æŸç§å…³ç³»ï¼Œå³ï¼šTPS=VU/RTã€‚ä½†å½“RT\u0026gt;25msæ—¶ï¼Œè¿™ç§å…³ç³»ä¼¼ä¹è¢«æ‰“ç ´äº†ï¼Œè¿™é‡Œæš‚æ—¶å…ˆå–ä¸ªå…³å­ï¼Œç¨åå†è¯´ã€‚\næ ¹æ®è¡¨æ ¼ä¸­çš„æ•°æ®ï¼Œæ€§èƒ½æµ‹è¯•æŠ¥å‘Šç»“è®ºï¼šæœ€å¤§TPS=65000ï¼Œå½“RT=25ms(æœ€çŸ­)æ—¶ï¼Œæœ€å¤§å¯æ‰¿å—VU=1500ã€‚\næ„Ÿè§‰æœ‰ç‚¹ä¸å¯¹åŠ²ï¼Œç”¨åˆšæ‰çš„å…¬å¼æ¥éªŒè¯ä¸€ä¸‹ï¼Œ1500/0.025s=60000ï¼Œä½†æœ€å¤§å´æ˜¯TPS=65000ã€‚é‚£æ˜¯å› ä¸ºï¼Œå½“VU=1500æ—¶ï¼Œåº”ç”¨ç³»ç»Ÿçš„ä½¿ç”¨èµ„æºè¿˜æœ‰ç©ºé—´ã€‚\nå†æ¥è§‚å¯Ÿä¸€ä¸‹è¡¨æ ¼ä¸­çš„æ•°æ®ï¼ŒVUä»1500å¢åŠ åˆ°1750æ—¶ï¼ŒTPSç»§ç»­ä¸Šå‡ï¼Œä¸”åˆ°äº†æœ€å¤§å€¼65000ã€‚æ­¤æ—¶ï¼Œä½ æ˜¯ä¸æ˜¯ä¼šç†è§£ä¸ºå½“VUå¢åŠ åˆ°1750æ—¶ï¼Œä½¿ç”¨èµ„æºè¢«è€—å°½äº†ã€‚è¯è™½æ²¡é”™ï¼Œä½†ä¸ä¸¥è°¨ã€‚\næ³¨ï¼šä½¿ç”¨èµ„æºä¸ä¸€å®šæ˜¯æŒ‡ç¡¬ä»¶èµ„æºï¼Œä¹Ÿå¯èƒ½æ˜¯å…¶ä»–æ–¹é¢ï¼Œä¾‹å¦‚ï¼šåº”ç”¨ç³»ç»Ÿè®¾ç½®çš„æœ€å¤§å¤„ç†çº¿ç¨‹ã€‚\nå…¶å®åœ¨VUå¢åŠ åˆ°1750å‰ï¼Œä½¿ç”¨èµ„æºå°±å·²é¥±å’Œï¼Œé‚£å¦‚ä½•æ¥æµ‹ç®—VUçš„ä¸´ç•Œå€¼å‘¢ã€‚ä½ å¯ä»¥å°†æœ€å¤§TPSä½œä¸ºå·²çŸ¥æ¡ä»¶ï¼Œå³ï¼šVU=TPS * RTï¼Œ65000*0.025s=1625ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“VU=1625æ—¶ï¼Œä½¿ç”¨èµ„æºå°†å‡ºç°ç“¶é¢ˆã€‚\nè°ƒæ•´æ€§èƒ½æµ‹è¯•æŠ¥å‘Šç»“è®ºï¼šæœ€å¤§TPS=65000ï¼Œå½“RT=25ms(æœ€çŸ­)æ—¶ï¼Œæœ€å¤§å¯æ‰¿å—VU=1625ã€‚\næœ‰äººä¼šé—®ï¼Œè¡¨æ ¼ä¸­çš„RTæ˜¯ä¸æ˜¯å¹³å‡å€¼ï¼Œé¦–å…ˆå›ç­”ä¸ºæ˜¯ã€‚ä¸è¿‡ï¼Œé«˜å¹¶å‘åœºæ™¯å¯¹RTä¼šç‰¹åˆ«æ•æ„Ÿï¼Œæ‰€ä»¥é™¤äº†è¦è€ƒè™‘RTçš„å¹³å‡å€¼å¤–ï¼Œå»ºè®®è¿˜è¦è€ƒè™‘å®ƒçš„åˆ†ä½å€¼ï¼Œä¾‹å¦‚ï¼šP99ã€‚\nä¸¾ä¾‹ï¼šå‡è®¾1000ç¬”è¯·æ±‚ï¼Œå…¶ä¸­900ç¬”RT=23msï¼Œ50ç¬”RT=36msï¼Œ50ç¬”RT=50ms\nå¹³å‡å€¼ P99å€¼ P95 P90 25ms 50ms 36ms 23ms P99çš„è®¡ç®—æ–¹å¼ï¼Œæ˜¯å°†1000ç¬”è¯·æ±‚çš„RTä»å°åˆ°å¤§è¿›è¡Œæ’åºï¼Œç„¶åå–æ’åœ¨ç¬¬99%ä½çš„æ•°å€¼ï¼ŒåŸºäºä»¥ä¸Šä¸¾ä¾‹æ•°æ®æ¥è¿›è¡Œè®¡ç®—ï¼ŒP99=50msï¼Œå…¶ä»–åˆ†ä½å€¼çš„è®¡ç®—æ–¹å¼ç±»ä¼¼ã€‚\nå†æ¬¡è°ƒæ•´æ€§èƒ½æµ‹è¯•æŠ¥å‘Šç»“è®ºï¼šæœ€å¤§TPS=65000ï¼Œå½“RT(å¹³å‡)=25ms(æœ€çŸ­)æ—¶ï¼Œæœ€å¤§å¯æ‰¿å—VU=1625ï¼ŒRT(P99)=50msï¼ŒRT(P95)=36msï¼ŒRT(P90)=23msã€‚\nåœ¨éåŠŸèƒ½æ€§éœ€æ±‚ä¸­ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°è¿™æ ·çš„éœ€æ±‚ï¼Œæ€§èƒ½æŒ‡æ ‡è¦æ±‚ï¼šRT(å¹³å‡)\u0026lt;=30ã€‚ç»“åˆåˆšæ‰çš„æ€§èƒ½æµ‹è¯•æŠ¥å‘Šç»“è®ºï¼Œå½“RT(å¹³å‡)=25ms(æœ€çŸ­)æ—¶ï¼Œæœ€å¤§å¯æ‰¿å—VU=1625ã€‚é‚£å°±ç­‰äºåœ¨RTä¸Šè¿˜æœ‰5msçš„å®¹å¿æ—¶é—´ã€‚\næ—¢ç„¶æ˜¯è¿™æ ·çš„è¯ï¼Œé‚£æˆ‘ä»¬ä¸å¦¨å°±ç»§ç»­å°è¯•å¢åŠ VUï¼Œä¸è¿‡RT(å¹³å‡)ä¼šå‡ºç°ä¸Šå‡ï¼Œä½†åªè¦æ§åˆ¶ä¸è¦ä¸Šå‡åˆ°30mså³å¯ï¼Œè¿™æ˜¯ä¸€ç§é€šè¿‡ç‰ºç‰²è€—æ—¶(RT)æ¥æ¢å–å¹¶å‘ç”¨æˆ·æ•°(VU)çš„è¡Œä¸ºã€‚ä½†è¯·ä¸è¦æŠŠå®ƒç†è§£ä¸ºæ¯ç¬”è¯·æ±‚è€—æ—¶éƒ½ä¼šä¸Šå‡5msï¼Œè¿™å°†æ˜¯ä¸€ä¸ªä¸¥é‡çš„è¯¯åŒºã€‚\nRT(å¹³å‡)çš„å¢åŠ ï¼Œå®Œå…¨å¯èƒ½æ˜¯ç”±äºåº”ç”¨ç³»ç»Ÿå½“å‰æ²¡æœ‰è¶³å¤Ÿçš„ä½¿ç”¨èµ„æºæ¥å¤„ç†è¯·æ±‚æ‰€é€ æˆçš„ï¼Œä¾‹å¦‚ï¼šå¤„ç†çº¿ç¨‹ã€‚å¦‚æœæ²¡æœ‰å¯ç”¨çº¿ç¨‹å¯ä»¥åˆ†é…ç»™è¯·æ±‚æ—¶ï¼Œå°±ä¼šå°†è¿™è¯·æ±‚å…ˆæ”¾å…¥é˜Ÿåˆ—ï¼Œç­‰å‰é¢çš„è¯·æ±‚å¤„ç†å®Œæˆå¹¶é‡Šæ”¾çº¿ç¨‹åï¼Œå°±å¯ä»¥ç»§ç»­å¤„ç†é˜Ÿåˆ—ä¸­çš„è¯·æ±‚äº†ã€‚\né‚£ä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰è¿›å…¥é˜Ÿåˆ—çš„è¯·æ±‚å¹¶ä¸ä¼šå¢åŠ é¢å¤–çš„è€—æ—¶ï¼Œè€Œåªæœ‰è¿›å…¥é˜Ÿåˆ—çš„è¯·æ±‚ä¼šå¢åŠ ã€‚é‚£ä¹ˆè¿›å…¥é˜Ÿåˆ—çš„è¯·æ±‚ä¼šå¢åŠ å¤šå°‘è€—æ—¶å‘¢ï¼Œåœ¨ç†æƒ³æƒ…å†µä¸‹(RTæ’å®š)ï¼Œå¯èƒ½ä¼šæ˜¯æ­£å¸¸å¤„ç†ä¸€ç¬”è¯·æ±‚è€—æ—¶çš„å€æ•°ï¼Œè€Œå€æ•°çš„å¤§å°åˆå–å†³äºå¹¶å‘è¯·æ±‚çš„æ•°é‡ã€‚\nå‡è®¾æœ€å¤§å¤„ç†çº¿ç¨‹=1625ï¼Œè‹¥æ¯ä¸ªç”¨æˆ·ä»…å‘é€ä¸€ç¬”è¯·æ±‚ï¼Œä¸”è¯·æ±‚ä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯æ²¡æœ‰å»¶è¿Ÿçš„æ¡ä»¶ä¸‹ï¼Œå½“å¹¶å‘ç”¨æˆ·æ•°=1625æ—¶ï¼Œèƒ½å¤Ÿä¿è¯RT=25msï¼Œä½†å½“å¹¶å‘ç”¨æˆ·æ•°\u0026gt;1625æ—¶ï¼Œå› ä¸ºçº¿ç¨‹åªèƒ½åˆ†é…ç»™1625ç¬”è¯·æ±‚ï¼Œé‚£å¤šä½™çš„è¯·æ±‚å°±æ— æ³•ä¿è¯RT=25msã€‚\nè¶…è¿‡1625ç¬”çš„è¯·æ±‚ä¼šå…ˆæ”¾å…¥é˜Ÿåˆ—ï¼Œç­‰å‰é¢1625ç¬”è¯·æ±‚å¤„ç†å®Œæˆåï¼Œå†ä»é˜Ÿåˆ—ä¸­æ‹¿å‡ºæœ€å¤š1625ç¬”è¯·æ±‚è¿›è¡Œä¸‹ä¸€æ‰¹å¤„ç†ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­è¿˜æœ‰å‰©ä½™è¯·æ±‚ï¼Œé‚£å°±ç»§ç»­æŒ‰ç…§è¿™ç§æ–¹å¼å¾ªç¯å¤„ç†ã€‚\nè¿›å…¥é˜Ÿåˆ—çš„è¯·æ±‚ï¼Œæ¯ç­‰å¾…ä¸€æ‰¹å°±éœ€è¦å¢åŠ å‰ä¸€æ‰¹çš„å¤„ç†è€—æ—¶ã€‚åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œæ¯ä¸€æ‰¹éƒ½æ˜¯RT=25msï¼Œå¦‚æœè¿™ç¬”è¯·æ±‚åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…äº†ä¸¤æ‰¹ï¼Œé‚£å°±è¦é¢å¤–å¢åŠ 50msçš„è€—æ—¶ã€‚\nå› æ­¤ï¼Œå¹¶ä¸èƒ½ç®€å•é€šè¿‡VU=TPS* RT=65000*0.03=1950æ¥è®¡ç®—æœ€å¤§å¯æ‰¿å—VUã€‚è€Œæ˜¯éœ€è¦å¼•å…¥ä¸€ç§å«åšç§‘ç‰¹å°”æ³•åˆ™(Littleâ€™s Law)çš„æ’é˜Ÿæ¨¡å‹æ¥ä¼°ç®—ï¼Œä¸è¿‡ç”±äºè¿™ä¸ªæ³•åˆ™æ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œæš‚æ—¶ä¸åšå±•å¼€ã€‚\né€šè¿‡ç²—ç•¥ä¼°ç®—åï¼ŒVUå¤§çº¦åœ¨2032ï¼Œæˆ‘ä»¬å†å¯¹è¿™ä¸ªå€¼ç”¨ä¸Šè¿°è¡¨æ ¼ä¸­å†åå‘éªŒç®—ä¸€ä¸‹ã€‚ æœ€ç»ˆè°ƒæ•´æ€§èƒ½æµ‹è¯•æŠ¥å‘Šç»“è®ºï¼šæœ€å¤§TPS=65000ï¼Œå½“RT(å¹³å‡)=25(æœ€çŸ­)æ—¶ï¼Œæœ€å¤§å¯æ‰¿å—VU=1625ï¼ŒRT(P99)=50ï¼ŒRT(P95)=36ï¼ŒRT(P90)=23ï¼›å½“RT(å¹³å‡)=30(å®¹å¿)æ—¶ï¼Œ(ç†æƒ³æƒ…å†µ)æœ€å¤§å¯æ‰¿å—VU=2032ï¼ŒRT(P99)=RT(P95)=50ï¼ŒRT(P90)=25ã€‚\nè¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆå½“RT\u0026gt;25msæ—¶ï¼ŒVU=TPS*RTä¼šä¸æˆç«‹çš„åŸå› ã€‚ä¸è¿‡ï¼Œè¿™äº›éƒ½æ˜¯åœ¨ç†æƒ³æƒ…å†µä¸‹æ¨æ¼”å‡ºæ¥çš„ï¼Œå®é™…æƒ…å†µä¼šæ¯”è¿™è¦å¤æ‚å¾—å¤šã€‚\næ‰€ä»¥ï¼Œè¿˜æ˜¯å°½é‡é‡‡ç”¨å¤šè½®æ€§èƒ½æµ‹è¯•æ¥å¾—åˆ°æ€§èƒ½æŒ‡æ ‡ï¼Œè¿™æ ·ä¹Ÿæ›´å…·å¤‡çœŸå®æ€§ã€‚æ¯•ç«Ÿå½±å“æ€§èƒ½çš„å› ç´ å®åœ¨å¤§å¤šä¸”å¾ˆéš¾å®Œå…¨æŒæ§ï¼Œä»»ä½•ç»†å¾®å˜åŒ–éƒ½å°†å½±å“æ€§èƒ½æŒ‡æ ‡çš„å˜åŒ–ã€‚\nåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†å¯ä»¥ç”¨å“ªäº›æŒ‡æ ‡æ¥è¡¡é‡æ€§èƒ½çš„é«˜ä½ã€‚ä¸è¿‡ï¼Œè¿™é‡Œæ›´æƒ³å¼ºè°ƒçš„æ˜¯ï¼Œæ€§èƒ½æ˜¯é«˜å¹¶å‘çš„åŸºç¡€èƒ½åŠ›ï¼Œæ˜¯å®ç°é«˜å¹¶å‘çš„åŸºç¡€æ¡ä»¶ï¼Œå¹¶ä¸”ä½ éœ€è¦æœ‰ä¾§é‡æ€§åœ°æå‡ä¸åŒç»´åº¦çš„æ€§èƒ½æŒ‡æ ‡ï¼Œè€Œéä»…å…³æ³¨æŸä¸€é¡¹ã€‚\né™åˆ¶æ˜¯ä¸€ç§è®¾è®¡ ä¸Šæ–‡è¯´åˆ°ï¼Œæ€§èƒ½æ˜¯é«˜å¹¶å‘çš„ç›®æ ‡ä¹‹ä¸€ã€‚è¿½æ±‚æ€§èƒ½æ²¡æœ‰é”™ï¼Œä½†å¹¶éæ°¸æ— æ­¢å¢ƒã€‚æƒ³è¦æå‡æ€§èƒ½ï¼ŒåŠ¿å¿…æŠ•å…¥æˆæœ¬ï¼Œä¸è¿‡å®ƒä»¬å¹¶ä¸æ˜¯ä¸€ç›´æˆæ­£æ¯”ï¼Œè€Œæ˜¯éšç€æˆæœ¬ä¸æ–­å¢åŠ ï¼Œæ€§èƒ½æå‡å¹…åº¦é€æ¸è¡°å‡ï¼Œç”šè‡³å¯èƒ½ä¸å†æå‡ã€‚æ‰€ä»¥ï¼Œæœ‰æ—¶é—´æˆ‘ä»¬è¦æ‡‚å¾—é€‚å¯è€Œæ­¢ã€‚\næ€è€ƒä¸€ä¸‹ï¼Œè¿½æ±‚æ€§èƒ½æ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œè‡³å°‘æœ‰ä¸€ç‚¹ï¼Œæ˜¯ä¸ºäº†è®©åº”ç”¨ç³»ç»Ÿèƒ½å¤Ÿåº”å¯¹çªå‘è¯·æ±‚ã€‚æ¢è¨€ä¹‹ï¼Œå¦‚æœèƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿç®—å®ç°äº†é«˜å¹¶å‘çš„ç›®æ ‡ã€‚\nè€Œæœ‰æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨è§£å†³é—®é¢˜æ—¶ï¼Œä¸è¦æ€»æ˜¯ä¹ æƒ¯åšåŠ æ³•ï¼Œè¿˜å¯ä»¥å°è¯•åšå‡æ³•ï¼Œæ¶æ„è®¾è®¡åŒæ ·å¦‚æ­¤ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•é€šè¿‡åšå‡æ³•çš„æ–¹å¼ï¼Œæ¥è§£å†³åº”å¯¹çªå‘è¯·æ±‚çš„é—®é¢˜å‘¢ã€‚è®©æˆ‘ä»¬æ¥è®²è®²é™åˆ¶ã€‚\né™åˆ¶ï¼Œä»ç‹­ä¹‰ä¸Šå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ç§çº¦æŸæˆ–æ§åˆ¶èƒ½åŠ›ã€‚åœ¨è½¯ä»¶é¢†åŸŸä¸­ï¼Œå®ƒå¯ä»¥é’ˆå¯¹åŠŸèƒ½æ€§æˆ–éåŠŸèƒ½æ€§ï¼Œè€Œåœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸­ï¼Œå®ƒæ›´åå‘äºéåŠŸèƒ½æ€§ã€‚\né™åˆ¶åº”ç”¨ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ï¼Œå¹¶ä¸ä»£è¡¨è¦é™ä½åº”ç”¨ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ï¼Œè€Œæ˜¯é€šè¿‡æŸäº›æ§åˆ¶æ‰‹æ®µï¼Œè®©çªå‘è¯·æ±‚èƒ½å¤Ÿè¢«å¹³æ»‘åœ°å¤„ç†ï¼ŒåŒæ—¶èµ·åˆ°åº”ç”¨ç³»ç»Ÿçš„ä¿æŠ¤èƒ½åŠ›ï¼Œé¿å…ç˜«ç—ªï¼Œè¿˜èƒ½å°†åº”ç”¨ç³»ç»Ÿçš„èµ„æºè¿›è¡Œåˆç†åˆ†é…ï¼Œé¿å…æµªè´¹ã€‚\né‚£ä¹ˆï¼Œåˆ°åº•æœ‰å“ªäº›æ§åˆ¶æ‰‹æ®µï¼Œæ—¢èƒ½å®ç°ä»¥ä¸Šè¿™äº›èƒ½åŠ›ï¼Œåˆèƒ½å‡å°‘å¯¹å®¢æˆ·ä½“éªŒä¸Šçš„å½±å“ï¼Œä¸‹é¢å°±æ¥ä»‹ç»å‡ ç§å¸¸ç”¨çš„æ§åˆ¶æ‰‹æ®µã€‚\nç¬¬ä¸€æ‹›ï¼šé™æµ é™æµï¼Œæ˜¯åœ¨ä¸€ä¸ªæ—¶é—´çª—å£å†…ï¼Œå¯¹è¯·æ±‚è¿›è¡Œé€Ÿç‡æ§åˆ¶ã€‚è‹¥è¯·æ±‚è¾¾åˆ°æå‰è®¾å®šçš„é˜ˆå€¼æ—¶ï¼Œåˆ™å¯¹è¯·æ±‚è¿›è¡Œæ’é˜Ÿæˆ–æ‹’ç»ã€‚å¸¸ç”¨çš„é™æµç®—æ³•æœ‰ä¸¤ç§ï¼šæ¼æ¡¶ç®—æ³•å’Œä»¤ç‰Œæ¡¶ç®—æ³•ã€‚\næ¼æ¡¶ç®—æ³• æ‰€æœ‰è¯·æ±‚å…ˆè¿›å…¥æ¼æ¡¶ï¼Œç„¶åæŒ‰ç…§ä¸€ä¸ªæ’å®šçš„é€Ÿç‡å¯¹æ¼æ¡¶é‡Œçš„è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œæ˜¯ä¸€ç§æ§åˆ¶å¤„ç†é€Ÿç‡çš„é™æµæ–¹å¼ï¼Œç”¨äºå¹³æ»‘çªå‘è¯·æ±‚é€Ÿç‡ã€‚\nå®ƒçš„ä¼˜ç‚¹æ˜¯ï¼Œèƒ½å¤Ÿç¡®ä¿èµ„æºä¸ä¼šç¬é—´è€—å°½ï¼Œé¿å…è¯·æ±‚å¤„ç†å‘ç”Ÿé˜»å¡ç°è±¡ï¼Œå¦å¤–ï¼Œè¿˜èƒ½å¤Ÿä¿æŠ¤è¢«åº”ç”¨ç³»ç»Ÿæ‰€è°ƒç”¨çš„å¤–éƒ¨æœåŠ¡ï¼Œä¹Ÿå…å—çªå‘è¯·æ±‚çš„å†²å‡»ã€‚\nå®ƒçš„ç¼ºç‚¹æ˜¯ï¼Œå¯¹äºçªå‘è¯·æ±‚ä»ç„¶ä¼šä»¥ä¸€ä¸ªæ’å®šçš„é€Ÿç‡æ¥è¿›è¡Œå¤„ç†ï¼Œå…¶çµæ´»æ€§ä¼šè¾ƒå¼±ä¸€ç‚¹ï¼Œå®¹æ˜“å‘ç”Ÿçªå‘è¯·æ±‚è¶…è¿‡æ¼æ¡¶çš„å®¹é‡ï¼Œå¯¼è‡´åç»­è¯·æ±‚ç›´æ¥è¢«ä¸¢å¼ƒã€‚","title":"é«˜å¹¶å‘æ¶æ„"},{"content":"æ¿ç“¦å·¥ä»¥åŠäº§å“ä»‹ç» è¯¥å•†å®¶éš¶å±äºç¾å›½IT7å…¬å¸æ——ä¸‹çš„ä¸€æ¬¾ä¾¿å®œå¹´ä»˜KVMæ¶æ„çš„VPSä¸»æœºå•†å®¶ï¼Œä»2013å¹´å¼€å§‹æ¨å‡ºä½ä»·VPSä¸»æœºé…ç½®è¿›å…¥å¸‚åœºï¼Œç¡®å®å—åˆ°å¹¿å¤§ç½‘å‹çš„å–œæ¬¢ï¼Œä¸”åœ¨æœ€è¿‘å‡ å¹´å¼€å§‹æ”¹å˜ç­–ç•¥ï¼Œå–æ¶ˆä½ä»·é…ç½®ï¼Œç„¶åä»¥é«˜é…ç½®å’Œä¼˜åŒ–çº¿è·¯é€Ÿåº¦ã€‚ä»¥å‰æˆ‘ä»¬æ¬ç“¦å·¥VPSä¸»æœºçš„ç”¨æˆ·æ„Ÿè§‰å¯èƒ½å¹¶ä¸æ˜¯ç‰¹åˆ«é€‚åº”ï¼Œå› ä¸ºä»¥å‰å–œæ¬¢ä»–ä»¬æ˜¯å› ä¸ºä¾¿å®œï¼Œå¦‚ä»Šä»·æ ¼æ¯”è¾ƒé«˜ï¼Œä½†æ˜¯çº¿è·¯å’Œé€Ÿåº¦æ¯”è¾ƒå¥½ã€‚\næ¬ç“¦å·¥VPSå•†å®¶æ”¯æŒæ”¯ä»˜å®ã€å¾®ä¿¡ã€PAYPALã€é“¶è”ä»¥åŠä¿¡ç”¨å¡å¤šç§ä»˜æ¬¾æ–¹å¼ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¾ˆå¤šå›½å†…ç”¨æˆ·é€‰æ‹©çš„åŸå› ä¹‹ä¸€ã€‚ç›®å‰æœ€ä½é…ç½®æ˜¯å¹´ä»˜49.99ç¾å…ƒï¼Œä»·æ ¼ä¸Šè‚¯å®šæ²¡æœ‰æ—©å¹´ä¾¿å®œï¼Œä½†æ˜¯æ€§ä»·æ¯”åœ¨åŒè¡Œä¸­è¿˜æ˜¯å…·æœ‰ä¸€å®šä¼˜åŠ¿çš„ã€‚æ¬ç“¦å·¥VPSä¸»æœºçš„ç‰¹ç‚¹åœ¨äºçº¿è·¯è¿˜æ˜¯ä¸é”™çš„ï¼Œè€Œä¸”å¸¦å®½æœ€é«˜10Gbpsï¼Œæ”¯æŒåˆ‡æ¢åˆ°å…¶ä»–æœºæˆ¿ï¼Œå…¨éƒ¨æ˜¯è‡ªå·±æ“ä½œã€‚æˆ‘ä»¬ä¸€å®šè¦æ­£è§„ä½¿ç”¨ã€‚\n**æ¬ç“¦å·¥VPSå½“å‰åº“å­˜æŸ¥çœ‹åˆ—è¡¨ï¼š**https://www.laozuo.org/go/bandwagonhost-cart\næ¬ç“¦å·¥vpsä¸»æœºæ–¹æ¡ˆåˆ†äº« CN2 GIA ECOMMERCEï¼ˆæ¨èï¼‰ CPUï¼š2æ ¸ å†…å­˜ï¼š1GB ç¡¬ç›˜ï¼š20GB SSD æµé‡ï¼š1000GB ç«¯å£ï¼š2.5Gbps æ¶æ„ï¼šKVM+KiwiVMé¢æ¿ IPæ•°ï¼š1ç‹¬ç«‹IP ç³»ç»Ÿï¼šLinux ä»·æ ¼ï¼š$65.99/åŠå¹´ï¼ˆè´­ä¹°ï¼‰ CPUï¼š3æ ¸ å†…å­˜ï¼š2GB ç¡¬ç›˜ï¼š40GB SSD æµé‡ï¼š2000GB ç«¯å£ï¼š2.5Gbps æ¶æ„ï¼šKVM+KiwiVMé¢æ¿ IPæ•°ï¼š1ç‹¬ç«‹IP ç³»ç»Ÿï¼šLinux ä»·æ ¼ï¼š$69.99/å­£åº¦ï¼ˆè´­ä¹°ï¼‰ è¿™ä¸ªé…ç½®æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°2.5Gbpså¸¦å®½èµ·æ­¥ï¼Œæœ€é«˜è¾¾åˆ°10Gbpsï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€å…±æœ‰7ä¸ªæ–¹æ¡ˆï¼Œæ ¹æ®é…ç½®ä¸åŒæœ‰åŒºåˆ«çš„ã€‚ç›¸æ¯”ä¸€èˆ¬çš„é…ç½®æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¸¦å®½ç¡®å®æ¯”è¾ƒé«˜ï¼Œè€Œä¸”æ˜¯CN2 GIAä¼˜åŒ–çº¿è·¯ï¼Œå¦‚æœæœ‰éœ€è¦å¤§å¸¦å®½æ–¹æ¡ˆçš„å¯ä»¥é€‰æ‹©ï¼Œè€Œä¸”è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥åˆ‡æ¢åˆ°å…¶ä»–æœºæˆ¿ã€‚\n2ã€KVMæ™®é€šçº¿è·¯ï¼ˆ8æœºæˆ¿å¯åˆ‡CN2 GT)\nCPUï¼š2æ ¸\nå†…å­˜ï¼š1024MB\nç¡¬ç›˜ï¼š20GB SSD\næµé‡ï¼š1000GB\nç«¯å£ï¼š1Gbps\næ¶æ„ï¼šKVM+KiwiVMé¢æ¿\nIPæ•°ï¼š1ç‹¬ç«‹IP\nç³»ç»Ÿï¼šLinux\nä»·æ ¼ï¼š$49.99/å¹´ï¼ˆè´­ä¹°ï¼‰\nCPUï¼š3æ ¸\nå†…å­˜ï¼š2048MB\nç¡¬ç›˜ï¼š40GB SSD\næµé‡ï¼š2000GB\nç«¯å£ï¼š1Gbps\næ¶æ„ï¼šKVM+KiwiVMé¢æ¿\nIPæ•°ï¼š1ç‹¬ç«‹IP\nç³»ç»Ÿï¼šLinux\nä»·æ ¼ï¼š$27.99/å­£åº¦ï¼ˆè´­ä¹°ï¼‰\nKVMæ™®é€šæ–¹æ¡ˆæœ‰ç›®å‰æœ€ä½å¹´ä»˜49.99æ–¹æ¡ˆï¼Œ2018å¹´12æœˆä»½ä¸‹æ¶åŸæ¥å¹´ä»˜19.99æ–¹æ¡ˆã€‚å…¥é—¨VPSå¯é€‰æ–¹æ¡ˆï¼Œæœ‰8ä¸ªæœºæˆ¿å¯ä»¥åˆ‡æ¢ï¼Œå¯ä»¥åˆ‡æ¢è‡³å•ç¨‹CN2 GTçº¿è·¯ã€‚\n3ã€CN2 GIAä¼˜åŒ–çº¿è·¯ï¼ˆä¸‰ç½‘ç›´è¿åŒç¨‹CN2ï¼‰\nCPUï¼š1æ ¸å¿ƒ\nå†…å­˜ï¼š512MB\nç¡¬ç›˜ï¼š10GB SSD\næµé‡ï¼š300GB\nç«¯å£ï¼š1Gbps\næ¶æ„ï¼šKVM+KiwiVMé¢æ¿\nIPæ•°ï¼š1ç‹¬ç«‹IP\nç³»ç»Ÿï¼šLinux\nä»·æ ¼ï¼š$39.99/å¹´ï¼ˆé™é‡ç¼ºè´§ï¼‰\nCPUï¼š2æ ¸å¿ƒ\nå†…å­˜ï¼š1024MB\nç¡¬ç›˜ï¼š20GB SSD\næµé‡ï¼š1000GB\nç«¯å£ï¼š1Gbps\næ¶æ„ï¼šKVM+KiwiVMé¢æ¿\nIPæ•°ï¼š1ç‹¬ç«‹IP\nç³»ç»Ÿï¼šLinux\nä»·æ ¼ï¼š$25.99/å­£åº¦ï¼ˆCN2 GIAï¼‰\nç›®å‰ä¸­ç¾çº¿è·¯ä¸­è¾ƒå¥½çš„å°±æ˜¯CN2 GIAçº¿è·¯æœºæˆ¿æ–¹æ¡ˆï¼ŒåŒç¨‹CN2ï¼Œä¸”ä¸‰ç½‘ç›´è¿ï¼Œç‰¹ä»·é™é‡æ–¹æ¡ˆå®¹æ˜“ç¼ºè´§ï¼Œå­£ä»˜19.99æ–¹æ¡ˆå¥½åƒä¸€ç›´æœ‰è´§ã€‚æ–¹æ¡ˆè´­ä¹°ä¹‹åå¯ä»¥åˆ‡æ¢10ä¸ªæœºæˆ¿ï¼Œä½†æ˜¯ä¸€èˆ¬æˆ‘ä»¬è‚¯å®šç”¨CN2 GIAï¼Œæ¯•ç«Ÿä¹°å®ƒå°±æ˜¯è¿½æ±‚é€Ÿåº¦å’Œç¨³å®šçš„ã€‚\n4ã€CN2 GTï¼ˆå•ç¨‹ä¼˜åŒ–çº¿è·¯CN2ï¼‰\nCPUï¼š1æ ¸å¿ƒ\nå†…å­˜ï¼š512MB\nç¡¬ç›˜ï¼š10GB SSD\næµé‡ï¼š500GB\nç«¯å£ï¼š1Gbps\næ¶æ„ï¼šKVM\nç³»ç»Ÿï¼šLinux\nIPæ•°ï¼š1ç‹¬ç«‹IP\nä»·æ ¼ï¼š$29.99/å¹´ï¼ˆä¸‹æ¶ç¼ºè´§ï¼‰\nCPUï¼š1æ ¸å¿ƒ\nå†…å­˜ï¼š1024MB\nç¡¬ç›˜ï¼š20GB SSD\næµé‡ï¼š1000GB\nç«¯å£ï¼š1Gbps\næ¶æ„ï¼šKVM\nç³»ç»Ÿï¼šLinux\nIPæ•°ï¼š1ç‹¬ç«‹IP\nä»·æ ¼ï¼š$49.99/å¹´ï¼ˆCN2 GTï¼‰\nCN2 GTçº¿è·¯ç™½å¤©åŸºæœ¬ä¸Šæ²¡æœ‰å¤šå¤§å·®åˆ«ï¼Œè€å·¦æµ‹è¯•åå‘ç°æ™šä¸Šç›¸å¯¹CN2 GIAè¿˜æ˜¯æœ‰ç‚¹è¯§å¼‚çš„ã€‚é‡‡ç”¨å•ç¨‹CN2çº¿è·¯ï¼Œè¿™ä¸ªæ–¹æ¡ˆå¥—é¤æœ‰9ä¸ªæœºæˆ¿å¯ä»¥åˆ‡æ¢ï¼Œä¸å¯ä»¥åˆ‡æ¢åˆ°CN2 GIAã€‚\n5ã€é¦™æ¸¯æœºæˆ¿ï¼ˆPCCWï¼‰\nCPUï¼š2æ ¸\nå†…å­˜ï¼š2GB\nç¡¬ç›˜ï¼š40GB\næµé‡ï¼š500GB\nç«¯å£ï¼š1Gbps\næ¶æ„ï¼šKVM+KiwiVMé¢æ¿\nIPæ•°ï¼š1ç‹¬ç«‹IP\nç³»ç»Ÿï¼šLinux\nä»·æ ¼ï¼š$89.99/æœˆï¼ˆé¦™æ¸¯æœºæˆ¿ï¼‰\nCPUï¼š4æ ¸\nå†…å­˜ï¼š4GB\nç¡¬ç›˜ï¼š80GB\næµé‡ï¼š1000GB\nç«¯å£ï¼š1Gbps\næ¶æ„ï¼šKVM+KiwiVMé¢æ¿\nIPæ•°ï¼š1ç‹¬ç«‹IP\nç³»ç»Ÿï¼šLinux\nä»·æ ¼ï¼š$159.99/æœˆï¼ˆé¦™æ¸¯æœºæˆ¿ï¼‰\næ¬ç“¦å·¥VPSä¸»æœºé¦™æ¸¯æœºæˆ¿ï¼Œä¸å¯ä»¥åˆ‡æ¢åˆ°å…¶ä»–æœºæˆ¿ï¼Œå…¶ä»–é…ç½®ä¹Ÿä¸å¯ä»¥åˆ‡æ¢åˆ°é¦™æ¸¯æœºæˆ¿ã€‚çº¿è·¯æ˜¯PCCWï¼Œé€Ÿåº¦ç¡®å®è¿˜æ˜¯ä¸é”™ï¼Œä½†æ˜¯ä»·æ ¼æˆæœ¬ä¹Ÿé«˜ï¼Œæ¯•ç«Ÿæ˜¯1Gbpså¸¦å®½ï¼Œé€‚åˆé¢„ç®—æ¯”è¾ƒå……è¶³çš„ç”¨æˆ·å’Œé€Ÿåº¦ç”¨æˆ·ã€‚\næ¬ç“¦å·¥VPSä¼˜æƒ ç /æ´»åŠ¨ é€šè¿‡ä¸Šé¢ä»‹ç»å’Œæ•´ç†çš„æ¬ç“¦å·¥å½“å‰å·²æœ‰æ–¹æ¡ˆé…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰å„ç§æœºæˆ¿å¯ä»¥é€‰æ‹©ï¼Œä½†æ˜¯ä¹‹é—´è¿˜æ˜¯æœ‰å·®å¼‚çš„ã€‚ç›®å‰å¤§éƒ¨åˆ†æ–¹æ¡ˆéƒ½æ˜¯å¤šæœºæˆ¿å¯é€‰çš„ï¼Œä½†æ˜¯ä¹‹é—´ä¹Ÿæœ‰ä¸å¯ä»¥äº’é€šåˆ‡æ¢ï¼Œæ—©æœŸå¦‚æœæˆ‘ä»¬è´­ä¹°çš„å•æœºæˆ¿çš„ï¼Œæ˜¯ä¸å¯ä»¥åˆ‡æ¢å¤šæœºæˆ¿çš„ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦è´­ä¹°å¯ä»¥é¡ºå¸¦ä½¿ç”¨BWH3HYATVBJW(ç›®å‰ä¼˜æƒ åŠ›åº¦æœ€å¤§çš„6.58%)ä¼˜æƒ ç ï¼Œå¦‚æœç‚¹å‡»çœ‹åˆ°æ˜¯OUT OF STOCKå°±è¡¨ç¤ºæ— è´§ã€‚\nè´­ä¹°æ•™ç¨‹ (æ¨èè´­ä¹°SPECIAL 20G KVM PROMO V3 - LOS ANGELES - CN2)\næ³¨å†Œæ¬ç“¦å·¥ https://bwh88.net/index.php\næ–¹æ¡ˆæ¨è\næ–¹æ¡ˆ å†…å­˜ CPU ç¡¬ç›˜ æµé‡/æœˆ å¸¦å®½ ä»·æ ¼ æœºæˆ¿ è´­ä¹° CN2 (æœ€ä¾¿å®œ) 1GB 1æ ¸ 20GB 1TB 1Gbps $49.99/å¹´ DC8 CN2 DC3 CN2 è´­ä¹° CN2 2GB 1æ ¸ 40GB 2TB 1Gbps $52.99/åŠå¹´ $99.99/å¹´ DC8 CN2 DC3 CN2 è´­ä¹° CN2 GIA-E (æœ€æ¨è) 1GB 2æ ¸ 20GB 1TB 2.5Gbps $65.99/åŠå¹´ $119.99/å¹´ DC6 CN2 GIA-E DC9 CN2 GIA è´­ä¹° (ç¼ºè´§) CN2 GIA-E 2GB 3æ ¸ 40GB 2TB 2.5Gbps $69.99/å­£åº¦ $229.99/å¹´ DC6 CN2 GIA-E DC9 CN2 GIA è´­ä¹° CN2 GIA 4GB 4æ ¸ 80GB 3TB 1Gbps $32.99/æœˆ $339.99/å¹´ DC9 CN2 GIA è´­ä¹° (ç¼ºè´§) CN2 GIA 8GB 6æ ¸ 160GB 5TB 1Gbps $62.99/æœˆ $645.99/å¹´ DC9 CN2 GIA è´­ä¹° (ç¼ºè´§) HK 2GB 2æ ¸ 40GB 0.5TB 1Gbps $89.99/æœˆ $899.99/å¹´ é¦™æ¸¯ PCCW è´­ä¹° HK 4GB 4æ ¸ 80GB 1TB 1Gbps $155.99/æœˆ $1559.99/å¹´ é¦™æ¸¯ PCCW è´­ä¹° ç‚¹å‡»ä¸Šé¢çš„â€œç›´è¾¾é€šé“â€æˆ–è€…è´­ä¹°é“¾æ¥è¿›å…¥è´­ä¹°é¡µã€‚ï¼ˆå…¶ä»–å¥—é¤ï¼Œè¯·åœ¨ä¸‹æ–¹è¡¨æ ¼è‡ªè¡Œé€‰æ‹©ï¼Œå¹¶åˆ†åˆ«ç‚¹å‡»è¡¨æ ¼ä¸­çš„è´­ä¹°é“¾æ¥è¿›å…¥ã€‚å¦åˆ™ä¼šå‡ºç°æ— æ³•çœ‹åˆ°éªŒè¯ç çš„é—®é¢˜ï¼‰\nè´­ä¹°ä¹‹åå¦‚ä¸‹æˆªå›¾\nè´­ä¹°å®Œä¹‹åä¼šæ”¶åˆ°ä¸‹é¢çš„é‚®ä»¶ï¼Œå‘Šè¯‰ä½ root çš„è´¦å·å¯†ç ï¼Œç«¯å£ç­‰ã€‚ ç‚¹å‡»æ­¤é¡µé¢æŸ¥çœ‹VPS çš„æ›´å¤šä¿¡æ¯: https://bandwagonhost.com/clientarea.php?action=products\nç”¨Xshell è¿œç¨‹VPS SSH åè®® â€‹\tå…·ä½“æ•™ç¨‹å¯ä»¥æœç´¢Xshell remote VPS\nâ€‹\thttps://www.bwgblog.net/bandwagonhost-xshell-ssh.html\næ­å»ºShadowsocks å®‰è£…Shadowsock\nwget \u0026ndash;no-check-certificate -O shadowsocks-all.sh https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks-all.sh\nif promote no weget , run below commad:\n1 yum -y install wget å¢åŠ æ‰§è¡Œæƒé™\n1 chmod +x shadowsocks-all.sh é…ç½®å¹¶è¿è¡Œ\n./shadowsocks-all.sh 2\u0026gt;\u0026amp;1 | tee shadowsocks-all.log æœŸé—´ä¼šæœ‰å¾ˆå¤šé€‰æ‹©çš„é…ç½®ï¼ŒåŒ…æ‹¬shadowsock ç‰ˆæœ¬ï¼Œå¯†ç ï¼Œç«¯å£è®¾ç½®ï¼Œåè®®åŠ å¯†æ–¹å¼ç­‰ï¼Œè‡ªè¡Œé€‰æ‹©å¹¶è®¾ç½®ã€‚å¦‚æœå‡ºç°ä»¥ä¸‹æˆªå›¾å³ä¸ºæˆåŠŸã€‚ å¦‚æœéœ€è¦å¸è½½ shadowsocksï¼š\n./shadowsocks-libev.sh uninstall shadowsock ç›¸å…³å‘½ä»¤:\nShadowsocks-Python ç‰ˆï¼š /etc/init.d/shadowsocks-python start | stop | restart | status\nShadowsocksR ç‰ˆï¼š /etc/init.d/shadowsocks-r start | stop | restart | status\nShadowsocks-Go ç‰ˆï¼š /etc/init.d/shadowsocks-go start | stop | restart | status\nShadowsocks-libev ç‰ˆï¼š /etc/init.d/shadowsocks-libev start | stop | restart | status\nå®¢æˆ·ç«¯é…ç½®Shadowsocks è‡ªè¡Œç™¾åº¦ï¼Œå¯æœ‰ï¼š https://ssr.tools/386\næˆ–è€…\nhttps://crifan.github.io/scientific_network_summary/website/server_client_mode/ss_client/ss_clients/ss_windows.html\nå¦‚è‹¥ä¸‹è½½é€Ÿåº¦å¤ªæ…¢ï¼Œå¯ä»¥åˆ°æˆ‘çš„ç½‘ç›˜ä¸‹è½½:\né“¾æ¥: https://pan.baidu.com/s/1eJr7KlJSB_exVyXZeLseng æå–ç : buei\nå®‰è£…BBRåŠ é€Ÿ å…³é—­é˜²ç«\n1 2 systemctl disable firewalld systemctl stop firewalld BBRå®‰è£…è„šæœ¬\n1 2 3 4 5 6 7 8 9 10 11 wget https://raw.githubusercontent.com/kuoruan/shell-scripts/master/ovz-bbr/ovz-bbr-installer.sh chmod +x ovz-bbr-installer.sh ./ovz-bbr-installer.sh æˆ–è€…: sed -i \u0026#39;/net.core.default_qdisc/d\u0026#39; /etc/sysctl.conf sed -i \u0026#39;/net.ipv4.tcp_congestion_control/d\u0026#39; /etc/sysctl.conf echo \u0026#34;net.core.default_qdisc = fq\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf echo \u0026#34;net.ipv4.tcp_congestion_control = bbr\u0026#34; \u0026gt;\u0026gt; /etc/sysctl.conf sysctl -p reboot å®‰è£…è¿‡ç¨‹ä¸­ä¼šæç¤ºåŠ é€Ÿç«¯å£ï¼Œæœ€ååˆ¤æ–­BBR æ˜¯å¦æ­£å¸¸å·¥ä½œ\néªŒè¯å½“å‰TCPæ§åˆ¶ç®—æ³•çš„å‘½ä»¤ï¼š sysctl net.ipv4.tcp_available_congestion_control\nè¿”å›å€¼ä¸€èˆ¬ä¸ºï¼š net.ipv4.tcp_available_congestion_control = bbr cubic reno æˆ–è€…ä¸ºï¼š net.ipv4.tcp_available_congestion_control = reno cubic bbr\néªŒè¯BBRæ˜¯å¦å·²ç»å¯åŠ¨\nsysctl net.ipv4.tcp_congestion_control\nè¿”å›å€¼ä¸€èˆ¬ä¸ºï¼š net.ipv4.tcp_congestion_control = bbr\nâ€‹\tlsmod | grep bbr\nâ€‹ è¿”å›å€¼æœ‰ tcp_bbr æ¨¡å—å³è¯´æ˜ bbr å·²å¯åŠ¨ã€‚ æ³¨æ„ï¼šå¹¶ä¸æ˜¯æ‰€æœ‰çš„ VPS éƒ½ä¼šæœ‰æ­¤è¿”å›å€¼ï¼Œè‹¥æ²¡æœ‰ä¹Ÿå±æ­£å¸¸ã€‚\n","permalink":"https://reid00.github.io/en/posts/other/%E6%9D%BF%E7%93%A6%E5%B7%A5%E6%90%AD%E5%BB%BAvps%E6%90%AD%E5%BB%BAvpn/","summary":"æ¿ç“¦å·¥ä»¥åŠäº§å“ä»‹ç» è¯¥å•†å®¶éš¶å±äºç¾å›½IT7å…¬å¸æ——ä¸‹çš„ä¸€æ¬¾ä¾¿å®œå¹´ä»˜KVMæ¶æ„çš„VPSä¸»æœºå•†å®¶ï¼Œä»2013å¹´å¼€å§‹æ¨å‡ºä½ä»·VPSä¸»æœºé…ç½®è¿›å…¥å¸‚åœºï¼Œç¡®å®å—åˆ°å¹¿å¤§ç½‘å‹çš„å–œæ¬¢ï¼Œä¸”åœ¨æœ€è¿‘å‡ å¹´å¼€å§‹æ”¹å˜ç­–ç•¥ï¼Œå–æ¶ˆä½ä»·é…ç½®ï¼Œç„¶åä»¥é«˜é…ç½®å’Œä¼˜åŒ–çº¿è·¯é€Ÿåº¦ã€‚ä»¥å‰æˆ‘ä»¬æ¬ç“¦å·¥VPSä¸»æœºçš„ç”¨æˆ·æ„Ÿè§‰å¯èƒ½å¹¶ä¸æ˜¯ç‰¹åˆ«é€‚åº”ï¼Œå› ä¸ºä»¥å‰å–œæ¬¢ä»–ä»¬æ˜¯å› ä¸ºä¾¿å®œï¼Œå¦‚ä»Šä»·æ ¼æ¯”è¾ƒé«˜ï¼Œä½†æ˜¯çº¿è·¯å’Œé€Ÿåº¦æ¯”è¾ƒå¥½ã€‚\næ¬ç“¦å·¥VPSå•†å®¶æ”¯æŒæ”¯ä»˜å®ã€å¾®ä¿¡ã€PAYPALã€é“¶è”ä»¥åŠä¿¡ç”¨å¡å¤šç§ä»˜æ¬¾æ–¹å¼ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¾ˆå¤šå›½å†…ç”¨æˆ·é€‰æ‹©çš„åŸå› ä¹‹ä¸€ã€‚ç›®å‰æœ€ä½é…ç½®æ˜¯å¹´ä»˜49.99ç¾å…ƒï¼Œä»·æ ¼ä¸Šè‚¯å®šæ²¡æœ‰æ—©å¹´ä¾¿å®œï¼Œä½†æ˜¯æ€§ä»·æ¯”åœ¨åŒè¡Œä¸­è¿˜æ˜¯å…·æœ‰ä¸€å®šä¼˜åŠ¿çš„ã€‚æ¬ç“¦å·¥VPSä¸»æœºçš„ç‰¹ç‚¹åœ¨äºçº¿è·¯è¿˜æ˜¯ä¸é”™çš„ï¼Œè€Œä¸”å¸¦å®½æœ€é«˜10Gbpsï¼Œæ”¯æŒåˆ‡æ¢åˆ°å…¶ä»–æœºæˆ¿ï¼Œå…¨éƒ¨æ˜¯è‡ªå·±æ“ä½œã€‚æˆ‘ä»¬ä¸€å®šè¦æ­£è§„ä½¿ç”¨ã€‚\n**æ¬ç“¦å·¥VPSå½“å‰åº“å­˜æŸ¥çœ‹åˆ—è¡¨ï¼š**https://www.laozuo.org/go/bandwagonhost-cart\næ¬ç“¦å·¥vpsä¸»æœºæ–¹æ¡ˆåˆ†äº« CN2 GIA ECOMMERCEï¼ˆæ¨èï¼‰ CPUï¼š2æ ¸ å†…å­˜ï¼š1GB ç¡¬ç›˜ï¼š20GB SSD æµé‡ï¼š1000GB ç«¯å£ï¼š2.5Gbps æ¶æ„ï¼šKVM+KiwiVMé¢æ¿ IPæ•°ï¼š1ç‹¬ç«‹IP ç³»ç»Ÿï¼šLinux ä»·æ ¼ï¼š$65.99/åŠå¹´ï¼ˆè´­ä¹°ï¼‰ CPUï¼š3æ ¸ å†…å­˜ï¼š2GB ç¡¬ç›˜ï¼š40GB SSD æµé‡ï¼š2000GB ç«¯å£ï¼š2.5Gbps æ¶æ„ï¼šKVM+KiwiVMé¢æ¿ IPæ•°ï¼š1ç‹¬ç«‹IP ç³»ç»Ÿï¼šLinux ä»·æ ¼ï¼š$69.99/å­£åº¦ï¼ˆè´­ä¹°ï¼‰ è¿™ä¸ªé…ç½®æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°2.5Gbpså¸¦å®½èµ·æ­¥ï¼Œæœ€é«˜è¾¾åˆ°10Gbpsï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€å…±æœ‰7ä¸ªæ–¹æ¡ˆï¼Œæ ¹æ®é…ç½®ä¸åŒæœ‰åŒºåˆ«çš„ã€‚ç›¸æ¯”ä¸€èˆ¬çš„é…ç½®æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¸¦å®½ç¡®å®æ¯”è¾ƒé«˜ï¼Œè€Œä¸”æ˜¯CN2 GIAä¼˜åŒ–çº¿è·¯ï¼Œå¦‚æœæœ‰éœ€è¦å¤§å¸¦å®½æ–¹æ¡ˆçš„å¯ä»¥é€‰æ‹©ï¼Œè€Œä¸”è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥åˆ‡æ¢åˆ°å…¶ä»–æœºæˆ¿ã€‚\n2ã€KVMæ™®é€šçº¿è·¯ï¼ˆ8æœºæˆ¿å¯åˆ‡CN2 GT)\nCPUï¼š2æ ¸\nå†…å­˜ï¼š1024MB\nç¡¬ç›˜ï¼š20GB SSD\næµé‡ï¼š1000GB\nç«¯å£ï¼š1Gbps\næ¶æ„ï¼šKVM+KiwiVMé¢æ¿\nIPæ•°ï¼š1ç‹¬ç«‹IP\nç³»ç»Ÿï¼šLinux\nä»·æ ¼ï¼š$49.99/å¹´ï¼ˆè´­ä¹°ï¼‰\nCPUï¼š3æ ¸\nå†…å­˜ï¼š2048MB\nç¡¬ç›˜ï¼š40GB SSD\næµé‡ï¼š2000GB\nç«¯å£ï¼š1Gbps\næ¶æ„ï¼šKVM+KiwiVMé¢æ¿\nIPæ•°ï¼š1ç‹¬ç«‹IP\nç³»ç»Ÿï¼šLinux\nä»·æ ¼ï¼š$27.99/å­£åº¦ï¼ˆè´­ä¹°ï¼‰\nKVMæ™®é€šæ–¹æ¡ˆæœ‰ç›®å‰æœ€ä½å¹´ä»˜49.99æ–¹æ¡ˆï¼Œ2018å¹´12æœˆä»½ä¸‹æ¶åŸæ¥å¹´ä»˜19.99æ–¹æ¡ˆã€‚å…¥é—¨VPSå¯é€‰æ–¹æ¡ˆï¼Œæœ‰8ä¸ªæœºæˆ¿å¯ä»¥åˆ‡æ¢ï¼Œå¯ä»¥åˆ‡æ¢è‡³å•ç¨‹CN2 GTçº¿è·¯ã€‚\n3ã€CN2 GIAä¼˜åŒ–çº¿è·¯ï¼ˆä¸‰ç½‘ç›´è¿åŒç¨‹CN2ï¼‰\nCPUï¼š1æ ¸å¿ƒ\nå†…å­˜ï¼š512MB\nç¡¬ç›˜ï¼š10GB SSD\næµé‡ï¼š300GB\nç«¯å£ï¼š1Gbps\næ¶æ„ï¼šKVM+KiwiVMé¢æ¿\nIPæ•°ï¼š1ç‹¬ç«‹IP\nç³»ç»Ÿï¼šLinux\nä»·æ ¼ï¼š$39.99/å¹´ï¼ˆé™é‡ç¼ºè´§ï¼‰\nCPUï¼š2æ ¸å¿ƒ\nå†…å­˜ï¼š1024MB\nç¡¬ç›˜ï¼š20GB SSD","title":"æ¿ç“¦å·¥æ­å»ºVPSæ­å»ºvpn"},{"content":"ä¸€ç›´ä»¥æ¥ï¼Œç¼–ç é—®é¢˜åƒå¹½çµä¸€èˆ¬ï¼Œä¸å°‘å¼€å‘äººå‘˜éƒ½å—è¿‡å®ƒçš„å›°æ‰°ã€‚\nè¯•æƒ³ä½ è¯·æ±‚ä¸€ä¸ªæ•°æ®ï¼Œå´å¾—åˆ°ä¸€å †ä¹±ç ï¼Œä¸ˆäºŒå’Œå°šæ‘¸ä¸ç€å¤´è„‘ã€‚æœ‰åŒäº‹è´¨ç–‘ä½ çš„æ•°æ®æ˜¯ä¹±ç ï¼Œè™½ç„¶ä½ å¾ˆç¡®å®šä¼ äº† UTF-8 ï¼Œå´ä¹Ÿæ— æ³•è‡ªè¯æ¸…ç™½ï¼Œæ›´åˆ«è¯´å¸®åŒäº‹ debug äº†ã€‚\næœ‰æ—¶ï¼Œé ç€ç™¾åº¦å’Œä¸€æ‰‹çè°ƒçš„æ‰‹è‰ºï¼Œä¹±ç ä¹Ÿèƒ½è§£å†³ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿˜æ˜¯å¾ˆç¾¡æ…•é‚£äº›éª¨ç°çº§ç¨‹åºå‘˜ã€‚ä¸ºä»€ä¹ˆä»–ä»¬æ¯æ¬¡éƒ½èƒ½çŠ€åˆ©åœ°æŒ‡å‡ºé—®é¢˜ï¼Œå¹¶å¿«é€Ÿä¿®å¤å‘¢ï¼ŸåŸå› åœ¨äºï¼Œä»–ä»¬æ—©å°±æŠŠç¼–ç é—®é¢˜èƒŒåçš„å„ç§æ¥é¾™å»è„‰ææ¸…æ¥šäº†ã€‚\næœ¬æ–‡ä» ASCII ç è¯´èµ·ï¼Œå¸¦ä½ æ‰’ä¸€æ‰’ç¼–ç èƒŒåé‚£äº›äº‹ã€‚ç›¸ä¿¡ææ¸…ç¼–ç çš„åŸç†åï¼Œä½ å°†ä¸å†ç•æƒ§ä»»ä½•ç¼–ç é—®é¢˜ã€‚\nä» ASCII ç è¯´èµ· ç°ä»£è®¡ç®—æœºæŠ€æœ¯ä»è‹±æ–‡å›½å®¶å…´èµ·ï¼Œæœ€å…ˆé‡åˆ°çš„ä¹Ÿæ˜¯è‹±æ–‡æ–‡æœ¬ã€‚è‹±æ–‡æ–‡æœ¬ä¸€èˆ¬ç”± 26 ä¸ªå­—æ¯ã€ 10 ä¸ªæ•°å­—ä»¥åŠè‹¥å¹²ç¬¦å·ç»„æˆï¼Œæ€»æ•°ä¹Ÿä¸è¿‡ 100 å·¦å³ã€‚\nè®¡ç®—æœºä¸­æœ€åŸºæœ¬çš„å­˜å‚¨å•ä½ä¸º å­—èŠ‚ ( byte )ï¼Œç”± 8 ä¸ªæ¯”ç‰¹ä½( bit )ç»„æˆï¼Œä¹Ÿå«åš å…«ä½å­—èŠ‚ ( octet )ã€‚8 ä¸ªæ¯”ç‰¹ä½å¯ä»¥è¡¨ç¤º $ 2^8 = 256 $ ä¸ªå­—ç¬¦ï¼Œçœ‹ä¸Šå»ç”¨å­—èŠ‚æ¥å­˜å‚¨è‹±æ–‡å­—ç¬¦å³å¯ï¼Ÿ\nè®¡ç®—æœºå…ˆé©±ä»¬ä¹Ÿæ˜¯è¿™ä¹ˆæƒ³çš„ã€‚ä»–ä»¬ä¸ºæ¯ä¸ªè‹±æ–‡å­—ç¬¦ç¼–å·ï¼Œå†åŠ ä¸Šä¸€äº›æ§åˆ¶ç¬¦ï¼Œå½¢æˆäº†æˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„ ASCII ç è¡¨ã€‚å®é™…ä¸Šï¼Œç”±äºè‹±æ–‡å­—ç¬¦ä¸å¤šï¼Œä»–ä»¬åªç”¨äº†å­—èŠ‚çš„å 7 ä½è€Œå·²ã€‚\næ ¹æ® ASCII ç è¡¨ï¼Œç”± 01000001 è¿™ 8 ä¸ªæ¯”ç‰¹ä½ç»„æˆçš„å…«ä½å­—èŠ‚ï¼Œä»£è¡¨å­—æ¯ A ã€‚\né¡ºä¾¿æä¸€ä¸‹ï¼Œæ¯”ç‰¹æœ¬èº«æ²¡æœ‰æ„ä¹‰ï¼Œæ¯”ç‰¹ åœ¨ ä¸Šä¸‹æ–‡ ( context )ä¸­æ‰æ„æˆä¿¡æ¯ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¯¹äºå†…å­˜ä¸­ä¸€ä¸ªå­—èŠ‚ 01000001 ï¼Œä½ å°†å®ƒçœ‹åšä¸€ä¸ªæ•´æ•°ï¼Œå®ƒå°±æ˜¯ 65 ï¼›å°†å®ƒä½œä¸ºä¸€ä¸ªè‹±æ–‡å­—ç¬¦ï¼Œå®ƒå°±æ˜¯å­—æ¯ A ï¼›ä½ çœ‹å¾…æ¯”ç‰¹çš„æ–¹å¼ï¼Œå°±æ˜¯æ‰€è°“çš„ä¸Šä¸‹æ–‡ã€‚\næ‰€ä»¥ï¼ŒçŒœçŒœä¸‹é¢è¿™ä¸ªç¨‹åºè¾“å‡ºå•¥ï¼Ÿ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 #include \u0026lt;stdio.h\u0026gt; int main(int argc, char *argv[]) { char value = 0x41; // as a number, value is 65 or 0x41 in hexadecimal printf(\u0026#34;%d\\n\u0026#34;, value); // as a ASCII character, value is alphabet A printf(\u0026#34;%c\\n\u0026#34;, value); return 0; } latin1 è¥¿æ¬§äººæ°‘æ¥äº†ï¼Œä»–ä»¬ä¸»è¦ä½¿ç”¨æ‹‰ä¸å­—æ¯è¯­è¨€ã€‚ä¸è‹±è¯­ç±»ä¼¼ï¼Œæ‹‰ä¸å­—æ¯æ•°é‡å¹¶ä¸å¤§ï¼Œå¤§æ¦‚ä¹Ÿå°±æ˜¯å‡ åä¸ªã€‚äºæ˜¯ï¼Œè¥¿æ¬§äººæ°‘æ‰“èµ· ASCII ç è¡¨é‚£ä¸ªæœªç”¨çš„æ¯”ç‰¹ä½( b8 )çš„ä¸»æ„ã€‚\nè¿˜è®°å¾—å—ï¼ŸASCII ç è¡¨æ€»å…±å®šä¹‰äº† 128 ä¸ªå­—ç¬¦ï¼ŒèŒƒå›´åœ¨ 0~127 ä¹‹é—´ï¼Œå­—èŠ‚æœ€é«˜ä½ b8 æš‚æœªä½¿ç”¨ã€‚äºæ˜¯ï¼Œè¥¿æ¬§äººæ°‘å°†æ‹‰ä¸å­—æ¯å’Œä¸€äº›è¾…åŠ©ç¬¦å·(å¦‚æ¬§å…ƒç¬¦å·)å®šä¹‰åœ¨ 128~255 ä¹‹é—´ã€‚è¿™å°±æ„æˆäº† latin1 ï¼Œå®ƒæ˜¯ä¸€ä¸ª 8 ä½å­—ç¬¦é›†ï¼Œå®šä¹‰äº†ä»¥ä¸‹å­—ç¬¦ï¼š\nå›¾ä¸­ç»¿è‰²éƒ¨åˆ†æ˜¯ä¸å¯æ‰“å°çš„( unprintable )æ§åˆ¶å­—ç¬¦ï¼Œå·¦åŠéƒ¨åˆ†æ˜¯ ASCII ç ã€‚å› æ­¤ï¼Œlatin1 å­—ç¬¦é›†æ˜¯ ASCII ç çš„è¶…é›†ï¼š\nä¸€ä¸ªå­—èŠ‚æ°æˆä¸¤åŠï¼Œæ¬§ç¾ä¸¤å…„å¼Ÿå„ç”¨ä¸€åŠã€‚è‡³æ­¤ï¼Œæ¬§ç¾äººæ°‘éƒ½ç©å—¨äº†ï¼Œä¸œäºšäººæ°‘å‘¢ï¼Ÿ\nGB2312ã€GBKå’ŒGB18030 ç”±äºå—åˆ°æ±‰æ–‡åŒ–çš„å½±å“ï¼Œä¸œäºšåœ°åŒºä¸»è¦æ˜¯æ±‰å­—åœˆï¼Œæˆ‘ä»¬ä¾¿ä»¥ä¸­æ–‡ä¸ºä¾‹å±•å¼€ä»‹ç»ã€‚\næ±‰å­—æœ‰ä»€ä¹ˆç‰¹ç‚¹å‘¢ï¼Ÿâ€”â€” å…‰å¸¸ç”¨æ±‰å­—å°±æœ‰å‡ åƒä¸ªï¼Œè¿™å¯ä¸æ˜¯ä¸€ä¸ªå­—èŠ‚èƒ½èƒœä»»çš„ã€‚ä¸€ä¸ªå­—èŠ‚ä¸å¤Ÿå°±ä¸¤ä¸ªå‘—ã€‚é“ç†è™½ç„¶å¦‚æ­¤ï¼Œæ“ä½œèµ·æ¥å´æœªå¿…è¿™ä¹ˆç®€å•ã€‚\né¦–å…ˆï¼Œå°†éœ€è¦ç¼–ç çš„æ±‰å­—å’Œ ASCII ç æ•´ç†æˆä¸€ä¸ªå­—ç¬¦é›†ï¼Œä¾‹å¦‚ GB2312 ã€‚ä¸ºä»€ä¹ˆéœ€è¦ ASCII ç å‘¢ï¼Ÿå› ä¸ºï¼Œåœ¨è®¡ç®—æœºä¸–ç•Œï¼Œä¸å¯é¿å…è¦è·Ÿæ•°å­—ã€è‹±æ–‡å­—æ¯æ‰“äº¤é“ã€‚è‡³äºæ‹‰ä¸å­—æ¯ï¼Œé‡è¦æ€§å°±æ²¡é‚£ä¹ˆå¤§ï¼Œä¹Ÿå°±æ— æ‰€è°“äº†ã€‚\nGB2312 å­—ç¬¦é›†æ€»å…±æ”¶å½•äº† 6 åƒå¤šä¸ªæ±‰å­—ï¼Œç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºè¶³çŸ£ï¼Œä½†äº‹æƒ…è¿œæ²¡æœ‰è¿™ä¹ˆç®€å•ã€‚åŒæ ·çš„æ•°å­—å­—ç¬¦ï¼Œåœ¨ GB2312 ä¸­å ç”¨ 2 ä¸ªå­—èŠ‚ï¼Œåœ¨ ASCII ç ä¸­å ç”¨ 1 ä¸ªå­—èŠ‚ï¼Œè¿™ä¸å°±ä¸å…¼å®¹äº†å—ï¼Ÿè®¡ç®—æœºé‡Œå¤ªå¤šä¸œè¥¿æ¶‰åŠ ASCII ç äº†ï¼Œçœ‹çœ‹ä¸€ä¸ª http è¯·æ±‚ï¼š\n1 2 GET / HTTP/1.1 Host: www.example.com é‚£ä¹ˆï¼Œæ€ä¹ˆå…¼å®¹ GB2312 å’Œ ASCII ç å‘¢ï¼Ÿå¤©æ— ç»äººä¹‹è·¯ï¼Œ å˜é•¿ ç¼–ç æ–¹æ¡ˆåº”è¿è€Œç”Ÿã€‚\nå˜é•¿ç¼–ç æ–¹æ¡ˆï¼Œå­—ç¬¦ç”±é•¿åº¦ä¸ä¸€çš„å­—èŠ‚è¡¨ç¤ºï¼Œæœ‰äº›å­—ç¬¦åªéœ€ 1 å­—èŠ‚ï¼Œæœ‰äº›éœ€è¦ 2 å­—èŠ‚ï¼Œç”šè‡³æœ‰äº›éœ€è¦æ›´å¤šå­—èŠ‚ã€‚GB2312 ä¸­çš„ ASCII ç ä¸åŸæ¥ä¿æŒä¸€è‡´ï¼Œè¿˜æ˜¯ç”¨ä¸€ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºï¼Œè¿™æ ·ä¾¿è§£å†³äº†å…¼å®¹é—®é¢˜ã€‚\nåœ¨ GB2312 ä¸­ï¼Œå¦‚æœä¸€ä¸ªå­—èŠ‚æœ€é«˜ä½ b8 ä¸º 0 ï¼Œè¯¥å­—èŠ‚ä¾¿æ˜¯å•å­—èŠ‚ç¼–ç ï¼Œå³ ASCII ç ã€‚å¦‚æœå­—èŠ‚æœ€é«˜ä½ b8 ä¸º 1 ï¼Œå®ƒå°±æ˜¯åŒå­—èŠ‚ç¼–ç çš„é¦–å­—èŠ‚ï¼Œä¸å…¶åå­—èŠ‚ä¸€èµ·è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚\nå˜é•¿ç¼–ç æ–¹æ¡ˆç›®çš„åœ¨äºå…¼å®¹ ASCII ç ï¼Œä½†ä¹Ÿå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šç”±äºå­—èŠ‚ç¼–ç é•¿åº¦ä¸ä¸€ï¼Œå®šä½ç¬¬ N ä¸ªå­—ç¬¦åªèƒ½é€šè¿‡éå†å®ç°ï¼Œæ—¶é—´å¤æ‚åº¦ä» $ O(1) $ é€€åŒ–åˆ° $ O(N) $ ã€‚å¥½åœ¨è¿™ç§æ“ä½œåœºæ™¯å¹¶ä¸å¤šè§ï¼Œå› æ­¤å½±å“å¯ä»¥å¿½ç•¥ã€‚\nGB2312 æ”¶å½•çš„æ±‰å­—ä¸ªæ•°åªæœ‰å¸¸ç”¨çš„ 6 åƒå¤šä¸ªï¼Œé‡åˆ°ç”Ÿåƒ»å­—è¿˜æ˜¯æ— èƒ½ä¸ºåŠ›ã€‚å› æ­¤ï¼Œåæ¥åˆæ¨å‡ºäº† GBK å’Œ GB18030 å­—ç¬¦é›†ã€‚GBK æ˜¯ GB2312 çš„è¶…é›†ï¼Œå®Œå…¨å…¼å®¹ GB2312 ï¼›è€Œ GB18030 åˆæ˜¯ GBK çš„è¶…é›†ï¼Œå®Œå…¨å…¼å®¹ GBK ã€‚\nå› æ­¤ï¼Œå¯¹ä¸­æ–‡ç¼–ç æ–‡æœ¬è¿›è¡Œè§£ç ï¼ŒæŒ‡å®š GB18030 æœ€ä¸ºå¥å£®ï¼š\n1 2 3 \u0026gt;\u0026gt;\u0026gt; raw = b\u0026#39;\\xfd\\x88\\xb5\\xc4\\xb4\\xab\\xc8\\xcb\u0026#39; \u0026gt;\u0026gt;\u0026gt; raw.decode(\u0026#39;gb18030\u0026#39;) \u0026#39;é¾çš„ä¼ äºº\u0026#39; æŒ‡å®š GBK æˆ– GB2312 å°±åªå¥½çœ‹è¿æ°”äº†ï¼ŒGBK å¤šåŠè¿˜æ²¡äº‹ï¼š\n1 2 \u0026gt;\u0026gt;\u0026gt; raw.decode(\u0026#39;gbk\u0026#39;) \u0026#39;é¾çš„ä¼ äºº\u0026#39; GB2312 ç»å¸¸ç›´æ¥æŠ›é”šä¸å•†é‡ï¼š\n1 2 3 4 \u0026gt;\u0026gt;\u0026gt; raw.decode(\u0026#39;gb2312\u0026#39;) Traceback (most recent call last): File \u0026#34;\u0026lt;stdin\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; UnicodeDecodeError: \u0026#39;gb2312\u0026#39; codec can\u0026#39;t decode byte 0xfd in position 0: illegal multibyte sequence chardet æ˜¯ä¸€ä¸ªä¸é”™çš„æ–‡æœ¬ç¼–ç æ£€æµ‹åº“ï¼Œç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œä½†å¯¹ä¸­æ–‡ç¼–ç æ”¯æŒä¸æ˜¯å¾ˆå¥½ã€‚ç»å¸¸ä¸­æ–‡ç¼–ç çš„æ–‡æœ¬è¿›å»ï¼Œæ£€æµ‹å‡ºæ¥çš„ç»“æœæ˜¯ GB2312 ï¼Œä½†ä¸€ç”¨ GB2312 è§£ç å°±è·ªï¼š\n1 2 3 4 5 6 7 8 \u0026gt;\u0026gt;\u0026gt; import chardet \u0026gt;\u0026gt;\u0026gt; raw = b\u0026#39;\\xd6\\xd0\\xb9\\xfa\\xc8\\xcb\\xca\\xc7\\xfd\\x88\\xb5\\xc4\\xb4\\xab\\xc8\\xcb\u0026#39; \u0026gt;\u0026gt;\u0026gt; chardet.detect(raw) {\u0026#39;encoding\u0026#39;: \u0026#39;GB2312\u0026#39;, \u0026#39;confidence\u0026#39;: 0.99, \u0026#39;language\u0026#39;: \u0026#39;Chinese\u0026#39;} \u0026gt;\u0026gt;\u0026gt; raw.decode(\u0026#39;GB2312\u0026#39;) Traceback (most recent call last): File \u0026#34;\u0026lt;stdin\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; UnicodeDecodeError: \u0026#39;gb2312\u0026#39; codec can\u0026#39;t decode byte 0xfd in position 8: illegal multibyte sequence æŒæ¡ GB2312 ã€ GBK ã€ GB18030 ä¸‰è€…çš„å…³ç³»åï¼Œæˆ‘ä»¬å¯ä»¥ç•¥æ–½å°è®¡ã€‚å¦‚æœ chardet æ£€æµ‹å‡ºæ¥ç»“æœæ˜¯ GB2312 ï¼Œå°±ç”¨ GB18030 å»è§£ç ï¼Œå¤§æ¦‚ç‡å¯ä»¥æˆåŠŸï¼\n1 2 \u0026gt;\u0026gt;\u0026gt; raw.decode(\u0026#39;GB18030\u0026#39;) \u0026#39;ä¸­å›½äººæ˜¯é¾çš„ä¼ äºº\u0026#39; Unicode GB2312 ã€ GBK ä¸ GB18030 éƒ½æ˜¯ä¸­æ–‡ç¼–ç å­—ç¬¦é›†ã€‚è™½ç„¶ GB18030 ä¹ŸåŒ…å«æ—¥éŸ©è¡¨æ„æ–‡å­—ï¼Œç®—æ˜¯å›½é™…å­—ç¬¦é›†ï¼Œä½†æ¯•ç«Ÿæ˜¯ä»¥ä¸­æ–‡ä¸ºä¸»ï¼Œæ— æ³•é€‚åº”å…¨çƒåŒ–åº”ç”¨ã€‚\nåœ¨è®¡ç®—æœºå‘å±•æ—©æœŸï¼Œä¸åŒå›½å®¶éƒ½æ¨å‡ºäº†è‡ªå·±çš„å­—ç¬¦é›†å’Œç¼–ç æ–¹æ¡ˆï¼Œäº’ä¸å…¼å®¹ã€‚ä¸­æ–‡ç¼–ç çš„æ–‡æœ¬åœ¨ä½¿ç”¨æ—¥æ–‡ç¼–ç çš„ç³»ç»Ÿä¸Šæ˜¯æ— æ³•æ˜¾ç¤ºçš„ï¼Œè¿™å°±ç»™å›½é™…äº¤å¾€å¸¦æ¥éšœç¢ã€‚\nè¿™æ—¶ï¼Œè‹±é›„å‡ºç°äº†ã€‚ç»Ÿä¸€ç è”ç›Ÿ ç«™å‡ºæ¥è¯´è¦å‘å±•ä¸€ä¸ªé€šç”¨çš„å­—ç¬¦é›†ï¼Œæ”¶å½•ä¸–ç•Œä¸Šæ‰€æœ‰å­—ç¬¦ï¼Œè¿™å°±æ˜¯ Unicode ã€‚ç»è¿‡å¤šå¹´å‘å±•ï¼Œ Unicode å·²ç»æˆä¸ºä¸–ç•Œä¸Šæœ€é€šç”¨çš„å­—ç¬¦é›†ï¼Œä¹Ÿæ˜¯è®¡ç®—æœºç§‘å­¦é¢†åŸŸçš„ä¸šç•Œæ ‡å‡†ã€‚\nUnicode å·²ç»æ”¶å½•çš„å­—ç¬¦æ•°é‡å·²ç»è¶…è¿‡ 13 ä¸‡ä¸ªï¼Œæ¯ä¸ªå­—ç¬¦éœ€å ç”¨è¶…è¿‡ 2 å­—èŠ‚ã€‚ç”±äºå¸¸ç”¨ç¼–ç¨‹è¯­è¨€ä¸€èˆ¬æ²¡æœ‰ 24 ä½æ•°å­—ç±»å‹ï¼Œå› æ­¤ä¸€èˆ¬ç”¨ 32 ä½æ•°å­—è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚è¿™æ ·ä¸€æ¥ï¼ŒåŒæ ·çš„ä¸€ä¸ªè‹±æ–‡å­—æ¯ï¼Œåœ¨ ASCII ä¸­åªéœ€å ç”¨ 1 å­—èŠ‚ï¼Œåœ¨ Unicode åˆ™éœ€è¦å ç”¨ 4 å­—èŠ‚ï¼è‹±ç¾äººæ°‘éƒ½è¦å“­äº†ï¼Œè¯•æƒ³ä½ ç£ç›˜ä¸­çš„æ–‡ä»¶å¤§å°éƒ½å¢å¤§äº† 4 å€æ˜¯ä»€ä¹ˆæ„Ÿå—ï¼\nUTF-8 ä¸ºäº†å…¼å®¹ ASCII å¹¶ä¼˜åŒ–æ–‡æœ¬ç©ºé—´å ç”¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§å˜é•¿å­—èŠ‚ç¼–ç æ–¹æ¡ˆï¼Œè¿™å°±æ˜¯è‘—åçš„ UTF-8 ã€‚ä¸ GB2312 ç­‰ä¸­æ–‡ç¼–ç ä¸€æ ·ï¼ŒUTF-8 ç”¨ä¸å›ºå®šçš„å­—èŠ‚æ•°æ¥è¡¨ç¤ºå­—ç¬¦ï¼š\nASCII å­—ç¬¦ Unicode ç ä½ç”± U+0000 è‡³ U+007F ï¼Œç”¨ 1 ä¸ªå­—èŠ‚ç¼–ç ï¼Œæœ€é«˜ä½ä¸º 0 ï¼› ç ä½ç”± U+0080 è‡³ U+07FF çš„å­—ç¬¦ï¼Œç”¨ 2 ä¸ªå­—èŠ‚ç¼–ç ï¼Œé¦–å­—èŠ‚ä»¥ 110 å¼€å¤´ï¼Œå…¶ä½™å­—èŠ‚ä»¥ 10 å¼€å¤´ï¼› ç ä½ç”± U+0800 è‡³ U+FFFF çš„å­—ç¬¦ï¼Œç”¨ 3 ä¸ªå­—èŠ‚ç¼–ç ï¼Œé¦–å­—èŠ‚ä»¥ 1110 å¼€å¤´ï¼Œå…¶ä½™å­—èŠ‚åŒæ ·ä»¥ 10 å¼€å¤´ï¼› 4 è‡³ 6 å­—èŠ‚ç¼–ç çš„æƒ…å†µä»¥æ­¤ç±»æ¨ï¼› å¦‚å›¾ï¼Œä»¥ 0 å¼€å¤´çš„å­—èŠ‚ä¸º å•å­—èŠ‚ ç¼–ç ï¼Œæ€»å…± 7 ä¸ªæœ‰æ•ˆç¼–ç ä½ï¼Œç¼–ç èŒƒå›´ä¸º U+0000 è‡³ U+007F ï¼Œåˆšå¥½å¯¹åº” ASCII ç æ‰€æœ‰å­—ç¬¦ã€‚ä»¥ 110 å¼€å¤´çš„å­—èŠ‚ä¸º åŒå­—èŠ‚ ç¼–ç ï¼Œæ€»å…± 11 ä¸ªæœ‰æ•ˆç¼–ç ä½ï¼Œæœ€å¤§å€¼æ˜¯ 0x7FF ï¼Œå› æ­¤ç¼–ç èŒƒå›´ä¸º U+0080 è‡³ U+07FF ï¼›ä»¥ 1110 å¼€å¤´çš„å­—èŠ‚ä¸º ä¸‰å­—èŠ‚ ç¼–ç ï¼Œæ€»å…± 16 ä¸ªæœ‰æ•ˆç¼–ç ä½ï¼Œæœ€å¤§å€¼æ˜¯ 0xFFFF å› æ­¤ç¼–ç èŒƒå›´ä¸º U+0800 è‡³ U+FFFF ã€‚\næ ¹æ®å¼€å¤´ä¸åŒï¼Œ UTF-8 æµä¸­çš„å­—èŠ‚ï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š\n| å­—èŠ‚æœ€é«˜ä½ | ç±»åˆ« | æœ‰æ•ˆä½ | |:\u0026mdash;\u0026mdash;\u0026ndash; |:\u0026mdash;\u0026ndash;|:\u0026mdash;\u0026mdash;| | 0 | å•å­—èŠ‚ç¼–ç  | 7 | | 10 | å¤šå­—èŠ‚ç¼–ç éé¦–å­—èŠ‚ | | | 110 | åŒå­—èŠ‚ç¼–ç é¦–å­—èŠ‚ | 11 | | 1110 | ä¸‰å­—èŠ‚ç¼–ç é¦–å­—èŠ‚ | 16 | | 11110 | å››å­—èŠ‚ç¼–ç é¦–å­—èŠ‚ | 21 | | 111110 | äº”å­—èŠ‚ç¼–ç é¦–å­—èŠ‚ | 26 | | 1111110 | å…­å­—èŠ‚ç¼–ç é¦–å­—èŠ‚ | 31 |\nè‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å…·å¤‡äº†è¯»æ‡‚ UTF-8 ç¼–ç å­—èŠ‚æµçš„èƒ½åŠ›ï¼Œä¸ä¿¡æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š\næ¦‚å¿µå›é¡¾ ä¸€ç›´ä»¥æ¥ï¼Œå­—ç¬¦é›† å’Œ ç¼–ç  è¿™ä¸¤ä¸ªè¯ä¸€ç›´æ˜¯æ··ç€ç”¨çš„ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ€»ç®—æœ‰èƒ½åŠ›å˜æ¸…è¿™ä¸¤è€…é—´çš„å…³ç³»äº†ã€‚\nå­—ç¬¦é›† é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç”±ä¸€å®šæ•°é‡å­—ç¬¦ç»„æˆçš„é›†åˆï¼Œæ¯ä¸ªå­—ç¬¦åœ¨é›†åˆä¸­æœ‰å”¯ä¸€ç¼–å·ã€‚å‰æ–‡æåŠçš„ ASCII ã€ latin1 ã€ GB2312 ã€GBK ã€GB18030 ä»¥åŠ Unicode ç­‰ï¼Œæ— ä¸€ä¾‹å¤–ï¼Œéƒ½æ˜¯å­—ç¬¦é›†ã€‚\nè®¡ç®—æœºå­˜å‚¨å’Œç½‘ç»œé€šè®¯çš„åŸºæœ¬å•ä½éƒ½æ˜¯ å­—èŠ‚ ï¼Œå› æ­¤æ–‡æœ¬å¿…é¡»ä»¥ å­—èŠ‚åºåˆ— çš„å½¢å¼è¿›è¡Œå­˜å‚¨æˆ–ä¼ è¾“ã€‚é‚£ä¹ˆï¼Œå­—ç¬¦ç¼–å·å¦‚ä½•è½¬åŒ–æˆå­—èŠ‚å‘¢ï¼Ÿè¿™å°±æ˜¯ ç¼–ç  è¦å›ç­”çš„é—®é¢˜ã€‚\nåœ¨ ASCII ç å’Œ latin ä¸­ï¼Œå­—ç¬¦ç¼–å·ä¸å­—èŠ‚ä¸€ä¸€å¯¹åº”ï¼Œè¿™æ˜¯ä¸€ç§ç¼–ç æ–¹å¼ã€‚GB2312 åˆ™é‡‡ç”¨å˜é•¿å­—èŠ‚ï¼Œè¿™æ˜¯å¦ä¸€ç§ç¼–ç æ–¹å¼ã€‚è€Œ Unicode åˆ™å­˜åœ¨å¤šç§ç¼–ç æ–¹å¼ï¼Œé™¤äº† æœ€å¸¸ç”¨çš„ UTF-8 ç¼–ç ï¼Œè¿˜æœ‰ UTF-16 ç­‰ã€‚å®é™…ä¸Šï¼ŒUTF-16 ç¼–ç æ•ˆç‡æ¯” UTF-8 æ›´é«˜ï¼Œä½†ç”±äºæ— æ³•å…¼å®¹ ASCII ï¼Œåº”ç”¨èŒƒå›´å—åˆ°å¾ˆå¤§åˆ¶çº¦ã€‚\næœ€ä½³å®è·µ è®¤è¯†æ–‡æœ¬ç¼–ç çš„å‰ä¸–ä»Šç”Ÿä¹‹åï¼Œåº”è¯¥å¦‚ä½•è§„é¿ç¼–ç é—®é¢˜å‘¢ï¼Ÿæ˜¯å¦å­˜åœ¨ä¸€äº›æœ€ä½³å®è·µå‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚\nç¼–ç é€‰æ‹© é¡¹ç›®å¼€å§‹å‰ï¼Œéœ€è¦é€‰æ‹©ä¸€ç§é€‚åº”æ€§å¹¿çš„ç¼–ç æ–¹æ¡ˆï¼ŒUTF-8 æ˜¯é¦–é€‰ï¼Œå¥½å¤„å¤šå¤šï¼š\nUnicode æ˜¯ä¸šç•Œæ ‡å‡†ï¼Œç¼–ç å­—ç¬¦æ•°é‡æœ€å¤šï¼Œå¤©ç„¶æ”¯æŒå›½é™…åŒ–ï¼› UTF-8 å®Œå…¨å…¼å®¹ ASCII ç ï¼Œè¿™æ˜¯ç¡¬æ€§æŒ‡æ ‡ï¼› UTF-8 ç›®å‰åº”ç”¨æœ€å¹¿ï¼› å¦‚å› å†å²åŸå› ï¼Œä¸å¾—ä¸ä½¿ç”¨ä¸­æ–‡ç¼–ç æ–¹æ¡ˆï¼Œåˆ™ä¼˜å…ˆé€‰æ‹© GB18030 ã€‚è¿™ä¸ªæ ‡å‡†æœ€æ–°ï¼Œæ¶µç›–å­—ç¬¦æœ€å¤šï¼Œé€‚åº”æ€§æœ€å¼ºã€‚å°½é‡é¿å…é‡‡ç”¨ GBK ï¼Œç‰¹åˆ«æ˜¯ GB2312 ç­‰è€æ—§ç¼–ç æ ‡å‡†ã€‚\nç¼–ç¨‹ä¹ æƒ¯ å¦‚æœä½ ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ï¼Œå­—ç¬¦ä¸²ç±»å‹æ”¯æŒ Unicode ï¼Œé‚£é—®é¢˜å°±ç®€å•äº†ã€‚ç”±äº Unicode å­—ç¬¦ä¸²è‚¯å®šä¸ä¼šå¯¼è‡´è¯¸å¦‚ä¹±ç ç­‰ç¼–ç é—®é¢˜ï¼Œä½ åªéœ€åœ¨è¾“å…¥å’Œè¾“å‡ºç¯èŠ‚ç¨åŠ ç•™æ„ã€‚\nä¸¾ä¸ªä¾‹å­ï¼ŒPython ä» 3 ä»¥åï¼Œ str å°±æ˜¯ Unicode å­—ç¬¦ä¸²äº†ï¼Œè€Œ bytes åˆ™æ˜¯ å­—èŠ‚åºåˆ— ã€‚å› æ­¤ï¼Œåœ¨ Python 3 ç¨‹åºä¸­ï¼Œæ ¸å¿ƒé€»è¾‘åº”è¯¥ç»Ÿä¸€ç”¨ str ç±»å‹ï¼Œé¿å…ä½¿ç”¨ bytes ã€‚æ–‡æœ¬ç¼–ç ã€è§£ç æ“ä½œåˆ™ç»Ÿä¸€åœ¨ç¨‹åºçš„è¾“å…¥ã€è¾“å‡ºå±‚ä¸­è¿›è¡Œã€‚\nå‡å¦‚ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª API æœåŠ¡ï¼Œæ•°æ®åº“æ•°æ®ç¼–ç æ˜¯ GBK ï¼Œè€Œç”¨æˆ·å´ä½¿ç”¨ UTF-8 ç¼–ç ã€‚é‚£ä¹ˆï¼Œåœ¨ç¨‹åº è¾“å…¥å±‚ ï¼Œ GBK æ•°æ®ä»æ•°æ®åº“è¯»å‡ºåï¼Œè§£ç è½¬æ¢æˆ Unicode æ•°æ®ï¼Œå†è¿›å…¥æ ¸å¿ƒå±‚å¤„ç†ã€‚åœ¨ç¨‹åº æ ¸å¿ƒå±‚ ï¼Œæ•°æ®ä»¥ Unicode å½¢å¼è¿›è¡ŒåŠ å·¥å¤„ç†ã€‚ç”±äºæ ¸å¿ƒå±‚å¤„ç†é€»è¾‘å¯èƒ½å¾ˆå¤æ‚ï¼Œç»Ÿä¸€é‡‡ç”¨ Unicode å¯ä»¥å‡å°‘é—®é¢˜çš„å‘ç”Ÿã€‚æœ€åï¼Œåœ¨ç¨‹åºçš„ è¾“å‡ºå±‚ å°†æ•°æ®ä»¥ UTF-8 ç¼–ç ï¼Œå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\næ•´ä¸ªè¿‡ç¨‹ä¼ªä»£ç å¤§æ¦‚å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 # input # read gbk data from database and decode it to unicode data = read_from_database().decode(\u0026#39;gbk\u0026#39;) # core # process unicode data only result = process(data) # output # encoding unicode data into utf8 response_to_user(result.encode(\u0026#39;utf8\u0026#39;)) è¿™æ ·çš„ç¨‹åºç»“æ„çœ‹èµ·æ¥è·Ÿä¸ªä¸‰æ˜æ²»ä¸€æ ·ï¼Œéå¸¸å½¢è±¡ï¼š\nå½“ç„¶äº†ï¼Œè¿˜æœ‰å¾ˆå¤šç¼–ç¨‹è¯­è¨€å­—ç¬¦ä¸²è¿˜ä¸æ”¯æŒ Unicode ã€‚Python 2 ä¸­çš„ str å¯¹è±¡ï¼Œè·Ÿ Python 3 ä¸­çš„ bytes æ¯”è¾ƒåƒï¼Œåªæ˜¯å­—èŠ‚åºåˆ—ï¼›C è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²ç”šè‡³æ›´åŸå§‹ã€‚\nè¿™éƒ½æ— å…³ç´§è¦ï¼Œå¥½çš„ç¼–ç¨‹ä¹ æƒ¯æ˜¯ç›¸é€šçš„ï¼šç¨‹åºæ ¸å¿ƒå±‚ç»Ÿä¸€ä½¿ç”¨æŸç§ç¼–ç ï¼Œè¾“å…¥è¾“å‡ºå±‚åˆ™è´Ÿè´£ç¼–ç è½¬æ¢ã€‚è‡³äºæ ¸å¿ƒå±‚ä½¿ç”¨ä½•ç§ç¼–ç ï¼Œä¸»è¦çœ‹ç¨‹åºä¸­å“ªç§ç¼–ç ä½¿ç”¨æœ€å¤šï¼Œä¸€èˆ¬æ˜¯è·Ÿæ•°æ®åº“ç¼–ç ä¿æŒä¸€è‡´å³å¯ã€‚\n","permalink":"https://reid00.github.io/en/posts/langs_linux/%E7%BC%96%E7%A0%81%E9%82%A3%E4%BA%9B%E4%BA%8B/","summary":"ä¸€ç›´ä»¥æ¥ï¼Œç¼–ç é—®é¢˜åƒå¹½çµä¸€èˆ¬ï¼Œä¸å°‘å¼€å‘äººå‘˜éƒ½å—è¿‡å®ƒçš„å›°æ‰°ã€‚\nè¯•æƒ³ä½ è¯·æ±‚ä¸€ä¸ªæ•°æ®ï¼Œå´å¾—åˆ°ä¸€å †ä¹±ç ï¼Œä¸ˆäºŒå’Œå°šæ‘¸ä¸ç€å¤´è„‘ã€‚æœ‰åŒäº‹è´¨ç–‘ä½ çš„æ•°æ®æ˜¯ä¹±ç ï¼Œè™½ç„¶ä½ å¾ˆç¡®å®šä¼ äº† UTF-8 ï¼Œå´ä¹Ÿæ— æ³•è‡ªè¯æ¸…ç™½ï¼Œæ›´åˆ«è¯´å¸®åŒäº‹ debug äº†ã€‚\næœ‰æ—¶ï¼Œé ç€ç™¾åº¦å’Œä¸€æ‰‹çè°ƒçš„æ‰‹è‰ºï¼Œä¹±ç ä¹Ÿèƒ½è§£å†³ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿˜æ˜¯å¾ˆç¾¡æ…•é‚£äº›éª¨ç°çº§ç¨‹åºå‘˜ã€‚ä¸ºä»€ä¹ˆä»–ä»¬æ¯æ¬¡éƒ½èƒ½çŠ€åˆ©åœ°æŒ‡å‡ºé—®é¢˜ï¼Œå¹¶å¿«é€Ÿä¿®å¤å‘¢ï¼ŸåŸå› åœ¨äºï¼Œä»–ä»¬æ—©å°±æŠŠç¼–ç é—®é¢˜èƒŒåçš„å„ç§æ¥é¾™å»è„‰ææ¸…æ¥šäº†ã€‚\næœ¬æ–‡ä» ASCII ç è¯´èµ·ï¼Œå¸¦ä½ æ‰’ä¸€æ‰’ç¼–ç èƒŒåé‚£äº›äº‹ã€‚ç›¸ä¿¡ææ¸…ç¼–ç çš„åŸç†åï¼Œä½ å°†ä¸å†ç•æƒ§ä»»ä½•ç¼–ç é—®é¢˜ã€‚\nä» ASCII ç è¯´èµ· ç°ä»£è®¡ç®—æœºæŠ€æœ¯ä»è‹±æ–‡å›½å®¶å…´èµ·ï¼Œæœ€å…ˆé‡åˆ°çš„ä¹Ÿæ˜¯è‹±æ–‡æ–‡æœ¬ã€‚è‹±æ–‡æ–‡æœ¬ä¸€èˆ¬ç”± 26 ä¸ªå­—æ¯ã€ 10 ä¸ªæ•°å­—ä»¥åŠè‹¥å¹²ç¬¦å·ç»„æˆï¼Œæ€»æ•°ä¹Ÿä¸è¿‡ 100 å·¦å³ã€‚\nè®¡ç®—æœºä¸­æœ€åŸºæœ¬çš„å­˜å‚¨å•ä½ä¸º å­—èŠ‚ ( byte )ï¼Œç”± 8 ä¸ªæ¯”ç‰¹ä½( bit )ç»„æˆï¼Œä¹Ÿå«åš å…«ä½å­—èŠ‚ ( octet )ã€‚8 ä¸ªæ¯”ç‰¹ä½å¯ä»¥è¡¨ç¤º $ 2^8 = 256 $ ä¸ªå­—ç¬¦ï¼Œçœ‹ä¸Šå»ç”¨å­—èŠ‚æ¥å­˜å‚¨è‹±æ–‡å­—ç¬¦å³å¯ï¼Ÿ\nè®¡ç®—æœºå…ˆé©±ä»¬ä¹Ÿæ˜¯è¿™ä¹ˆæƒ³çš„ã€‚ä»–ä»¬ä¸ºæ¯ä¸ªè‹±æ–‡å­—ç¬¦ç¼–å·ï¼Œå†åŠ ä¸Šä¸€äº›æ§åˆ¶ç¬¦ï¼Œå½¢æˆäº†æˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„ ASCII ç è¡¨ã€‚å®é™…ä¸Šï¼Œç”±äºè‹±æ–‡å­—ç¬¦ä¸å¤šï¼Œä»–ä»¬åªç”¨äº†å­—èŠ‚çš„å 7 ä½è€Œå·²ã€‚\næ ¹æ® ASCII ç è¡¨ï¼Œç”± 01000001 è¿™ 8 ä¸ªæ¯”ç‰¹ä½ç»„æˆçš„å…«ä½å­—èŠ‚ï¼Œä»£è¡¨å­—æ¯ A ã€‚\né¡ºä¾¿æä¸€ä¸‹ï¼Œæ¯”ç‰¹æœ¬èº«æ²¡æœ‰æ„ä¹‰ï¼Œæ¯”ç‰¹ åœ¨ ä¸Šä¸‹æ–‡ ( context )ä¸­æ‰æ„æˆä¿¡æ¯ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¯¹äºå†…å­˜ä¸­ä¸€ä¸ªå­—èŠ‚ 01000001 ï¼Œä½ å°†å®ƒçœ‹åšä¸€ä¸ªæ•´æ•°ï¼Œå®ƒå°±æ˜¯ 65 ï¼›å°†å®ƒä½œä¸ºä¸€ä¸ªè‹±æ–‡å­—ç¬¦ï¼Œå®ƒå°±æ˜¯å­—æ¯ A ï¼›ä½ çœ‹å¾…æ¯”ç‰¹çš„æ–¹å¼ï¼Œå°±æ˜¯æ‰€è°“çš„ä¸Šä¸‹æ–‡ã€‚\næ‰€ä»¥ï¼ŒçŒœçŒœä¸‹é¢è¿™ä¸ªç¨‹åºè¾“å‡ºå•¥ï¼Ÿ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 #include \u0026lt;stdio.","title":"ç¼–ç é‚£äº›äº‹"},{"content":"å‰è¨€ æˆ‘ä»¬æ¯å¤©éƒ½åœ¨ç”¨ Google, ç™¾åº¦è¿™äº›æœç´¢å¼•æ“ï¼Œé‚£å¤§å®¶æœ‰æ²¡æƒ³è¿‡æœç´¢å¼•æ“æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Œçœ‹ä¼¼ç®€å•çš„æœç´¢å…¶å®æŠ€æœ¯ç»†èŠ‚éå¸¸å¤æ‚ï¼Œè¯´æœç´¢å¼•æ“æ˜¯ IT çš‡å† ä¸Šçš„æ˜ç ä¹Ÿä¸ä¸ºè¿‡ï¼Œä»Šå¤©æˆ‘ä»¬æ¥å°±æ¥ç®€å•è¿‡ä¸€ä¸‹æœç´¢å¼•æ“çš„åŸç†ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå½“ç„¶æœç´¢å¼•æ“åšå¤§ç²¾æ·±ï¼Œä¸€ç¯‡æ–‡ç« ä¸å¯èƒ½å®Œå…¨ä»‹ç»å®Œï¼Œæˆ‘ä»¬åªä¼šä»‹ç»å®ƒæœ€é‡è¦çš„å‡ ä¸ªæ­¥éª¤ï¼Œä¸è¿‡ä¸‡å˜ä¸ç¦»å…¶å®—ï¼Œæœç´¢å¼•æ“éƒ½ç¦»å¼€è¿™äº›é‡è¦æ­¥éª¤ï¼Œå‰©ä¸‹çš„æ— éæ˜¯åœ¨å…¶ä¸Šæ·»ç –åŠ ç“¦ï¼Œæ‰€ä»¥æŒæ¡è¿™äº›ã€Œå…³é”®è·¯å¾„ã€ï¼Œèƒ½å¾ˆå¥½åœ°è¾¾åˆ°è§‚ä¸€æ–‘è€Œçª¥å…¨è²çš„ç›®çš„ã€‚\næœ¬æ–‡å°†ä¼šä»ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†æ¥ä»‹ç»æœç´¢å¼•æ“ï¼Œä¼šæ·±åº¦å‰–ææœç´¢å¼•æ“çš„å·¥ä½œåŸç†åŠå…¶ä¸­ç”¨åˆ°çš„ä¸€äº›ç»å…¸æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œç›¸ä¿¡å¤§å®¶çœ‹äº†è‚¯å®šæœ‰æ”¶è·ã€‚\næœç´¢å¼•æ“ç³»ç»Ÿæ¶æ„å›¾\næœç´¢å¼•æ“å·¥ä½œåŸç†è¯¦ç»†å‰–æ\næœç´¢å¼•æ“ç³»ç»Ÿæ¶æ„å›¾ æœç´¢å¼•æ“æ•´ä½“æ¶æ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºæœé›†ï¼Œé¢„å¤„ç†ï¼Œç´¢å¼•ï¼ŒæŸ¥è¯¢è¿™å››æ­¥ï¼Œæ¯ä¸€æ­¥çš„æŠ€æœ¯ç»†èŠ‚éƒ½å¾ˆå¤šï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹æ–‡ä¸­è¯¦ç»†åˆ†ææ¯ä¸€æ­¥çš„å·¥ä½œåŸç†ã€‚ æœç´¢å¼•æ“å·¥ä½œåŸç†è¯¦ç»†å‰–æ ä¸€ã€æœç´¢ çˆ¬è™«ä¸€å¼€å§‹æ˜¯ä¸çŸ¥é“è¯¥ä»å“ªé‡Œå¼€å§‹çˆ¬èµ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»™å®ƒä¸€ç»„ä¼˜è´¨ç§å­ç½‘é¡µçš„é“¾æ¥ï¼Œæ¯”å¦‚æ–°æµªä¸»é¡µï¼Œè…¾è®¯ä¸»é¡µç­‰ï¼Œè¿™äº›ä¸»é¡µæ¯”è¾ƒçŸ¥åï¼Œåœ¨ Alexa æ’åä¸Šä¹Ÿéå¸¸é å‰ï¼Œæ‹¿åˆ°è¿™äº›ä¼˜è´¨ç§å­ç½‘é¡µåï¼Œå°±å¯¹è¿™äº›ç½‘é¡µé€šè¿‡å¹¿åº¦ä¼˜å…ˆéå†ä¸æ–­éå†è¿™äº›ç½‘é¡µï¼Œçˆ¬å–ç½‘é¡µå†…å®¹ï¼Œæå–å‡ºå…¶ä¸­çš„é“¾æ¥ï¼Œä¸æ–­å°†å…¶å°†å…¥åˆ°å¾…çˆ¬å–é˜Ÿåˆ—ï¼Œç„¶åçˆ¬è™«ä¸æ–­åœ°ä» url çš„å¾…çˆ¬å–é˜Ÿåˆ—é‡Œæå–å‡º url è¿›è¡Œçˆ¬å–ï¼Œé‡å¤ä»¥ä¸Šè¿‡ç¨‹\u0026hellip;\nå½“ç„¶äº†ï¼Œåªç”¨ä¸€ä¸ªçˆ¬è™«æ˜¯ä¸å¤Ÿçš„ï¼Œå¯ä»¥å¯åŠ¨å¤šä¸ªçˆ¬è™«å¹¶è¡Œçˆ¬å–ï¼Œè¿™æ ·é€Ÿåº¦ä¼šå¿«å¾ˆå¤šã€‚\n1ã€å¾…çˆ¬å–çš„ url å®ç° å¾…çˆ¬å– url æˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ”¾åˆ° Redis é‡Œï¼Œä¿è¯äº†é«˜æ€§èƒ½ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRedisè¦å¼€å¯æŒä¹…åŒ–åŠŸèƒ½ï¼Œè¿™æ ·æ”¯æŒæ–­ç‚¹ç»­çˆ¬ï¼Œå¦‚æœ Redis æŒ‚æ‰äº†ï¼Œé‡å¯ä¹‹åç”±äºæœ‰æŒç»­ä¹…åŠŸèƒ½ï¼Œå¯ä»¥ä»ä¸Šä¸€ä¸ªå¾…çˆ¬çš„ url å¼€å§‹é‡æ–°çˆ¬ã€‚\n2ã€å¦‚ä½•åˆ¤é‡ å¦‚ä½•é¿å…ç½‘é¡µçš„é‡å¤çˆ¬å–å‘¢ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ url è¿›è¡Œå»é‡æ“ä½œï¼Œå»é‡æ€ä¹ˆå®ç°ï¼Ÿå¯èƒ½æœ‰äººè¯´ç”¨æ•£åˆ—è¡¨ï¼Œå°†æ¯ä¸ªå¾…æŠ“å– url å­˜åœ¨æ•£åˆ—è¡¨é‡Œï¼Œæ¯æ¬¡è¦åŠ å…¥å¾…çˆ¬å– url æ—¶éƒ½é€šè¿‡è¿™ä¸ªæ•£åˆ—è¡¨æ¥åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦çˆ¬å–è¿‡äº†ï¼Œè¿™æ ·åšç¡®å®æ²¡æœ‰é—®é¢˜ï¼Œä½†æˆ‘ä»¬éœ€è¦æ³¨æ„åˆ°çš„æ˜¯è¿™æ ·éœ€è¦ä¼šå‡ºå·¨å¤§çš„ç©ºé—´ä»£ä»·ï¼Œæœ‰å¤šå¤§ï¼Œæˆ‘ä»¬ç®€å•ç®—ä¸€ä¸‹ï¼Œå‡è®¾æœ‰ 10 äº¿ url ï¼ˆä¸è¦è§‰å¾— 10 äº¿å¾ˆå¤§ï¼Œåƒ Google, ç™¾åº¦è¿™æ ·çš„æœç´¢å¼•æ“ï¼Œå®ƒä»¬è¦çˆ¬å–çš„ç½‘é¡µé‡çº§æ¯” 10 äº¿å¤§å¾—å¤šï¼‰ï¼Œæ”¾åœ¨æ•£åˆ—è¡¨é‡Œï¼Œéœ€è¦å¤šå¤§å­˜å‚¨ç©ºé—´å‘¢ï¼Ÿ\næˆ‘ä»¬å‡è®¾æ¯ä¸ªç½‘é¡µ url å¹³å‡é•¿åº¦ 64 å­—èŠ‚ï¼Œåˆ™ 10 äº¿ä¸ª url å¤§çº¦éœ€è¦ 60 G å†…å­˜ï¼Œå¦‚æœç”¨æ•£åˆ—è¡¨å®ç°çš„è¯ï¼Œç”±äºæ•£åˆ—è¡¨ä¸ºäº†é¿å…è¿‡å¤šçš„å†²çªï¼Œéœ€è¦è¾ƒå°çš„è£…è½½å› å­ï¼ˆå‡è®¾å“ˆå¸Œè¡¨è¦è£…è½½ 10 ä¸ªå…ƒç´ ï¼Œå®é™…å¯èƒ½è¦åˆ†é… 20 ä¸ªå…ƒç´ çš„ç©ºé—´ï¼Œä»¥é¿å…å“ˆå¸Œå†²çªï¼‰ï¼ŒåŒæ—¶ä¸ç®¡æ˜¯ç”¨é“¾å¼å­˜å‚¨è¿˜æ˜¯ç”¨çº¢é»‘æ ‘æ¥å¤„ç†å†²çªï¼Œéƒ½è¦å­˜å‚¨æŒ‡é’ˆï¼Œå„ç§è¿™äº›åŠ èµ·æ¥æ‰€éœ€å†…å­˜å¯èƒ½ä¼šè¶…è¿‡ 100 Gï¼Œå†åŠ ä¸Šå†²çªæ—¶éœ€è¦åœ¨é“¾è¡¨ä¸­æ¯”è¾ƒå­—ç¬¦ä¸²ï¼Œæ€§èƒ½ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæŸè€—ï¼Œå½“ç„¶ 100 G å¯¹å¤§å‹æœç´¢å¼•æ“æ¥è¯´ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†å…¶å®è¿˜æœ‰ä¸€ç§æ–¹æ¡ˆå¯ä»¥å®ç°è¿œå°äº 100 G çš„å†…å­˜ï¼šå¸ƒéš†è¿‡æ»¤å™¨ã€‚\né’ˆå¯¹ 10 äº¿ä¸ª urlï¼Œæˆ‘ä»¬åˆ†é… 100 äº¿ä¸ª bitï¼Œå¤§çº¦ 1.2 G, ç›¸æ¯” 100 G å†…å­˜ï¼Œæå‡äº†è¿‘ç™¾å€ï¼å¯è§æŠ€æœ¯æ–¹æ¡ˆçš„åˆç†é€‰æ‹©èƒ½å¾ˆå¥½åœ°è¾¾åˆ°é™æœ¬å¢æ•ˆçš„æ•ˆæœã€‚\nå½“ç„¶æœ‰äººå¯èƒ½ä¼šæå‡ºç–‘é—®ï¼Œå¸ƒéš†è¿‡æ»¤å™¨å¯èƒ½ä¼šå­˜åœ¨è¯¯åˆ¤çš„æƒ…å†µï¼Œå³æŸä¸ªå€¼ç»è¿‡å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­ä¸å­˜åœ¨ï¼Œé‚£è¿™ä¸ªå€¼è‚¯å®šä¸å­˜åœ¨ï¼Œä½†å¦‚æœç»å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­å­˜åœ¨ï¼Œé‚£è¿™ä¸ªå€¼ä¸ä¸€å®šå­˜åœ¨,é’ˆå¯¹è¿™ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´å¸ƒéš†è¿‡æ»¤å™¨çš„å“ˆå¸Œå‡½æ•°æˆ–å…¶åº•å±‚çš„ä½å›¾å¤§å°æ¥å°½å¯èƒ½åœ°é™ä½è¯¯åˆ¤çš„æ¦‚ç‡ï¼Œä½†å¦‚æœè¯¯åˆ¤è¿˜æ˜¯å‘ç”Ÿäº†å‘¢ï¼Œæ­¤æ—¶é’ˆå¯¹è¿™ç§ url å°±ä¸çˆ¬å¥½äº†ï¼Œæ¯•ç«Ÿäº’è”ç½‘ä¸Šè¿™ä¹ˆå¤šç½‘é¡µï¼Œå°‘çˆ¬å‡ ä¸ªä¹Ÿæ— å¦¨ã€‚\n3ã€ç½‘é¡µçš„å­˜å‚¨æ–‡ä»¶: doc_raw.bin çˆ¬å®Œç½‘é¡µï¼Œç½‘é¡µè¯¥å¦‚ä½•å­˜å‚¨å‘¢ï¼Œæœ‰äººè¯´ä¸€ä¸ªç½‘é¡µå­˜ä¸€ä¸ªæ–‡ä»¶ä¸å°±è¡Œäº†ï¼Œå¦‚æœæ˜¯è¿™æ ·ï¼Œ10 äº¿ä¸ªç½‘é¡µå°±è¦å­˜ 10 äº¿ä¸ªæ–‡ä»¶ï¼Œä¸€èˆ¬çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸æ”¯æŒçš„ï¼Œæ‰€ä»¥ä¸€èˆ¬æ˜¯æŠŠç½‘é¡µå†…å®¹å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶ï¼ˆå‡è®¾ä¸º doc_raw.binï¼‰ä¸­ï¼Œå¦‚ä¸‹\nå½“ç„¶ä¸€èˆ¬çš„æ–‡ä»¶ç³»ç»Ÿå¯¹å•ä¸ªæ–‡ä»¶çš„å¤§å°ä¹Ÿæ˜¯æœ‰é™åˆ¶çš„ï¼Œæ¯”å¦‚ 1 Gï¼Œé‚£åœ¨æ–‡ä»¶è¶…è¿‡ 1 G åå†æ–°å»ºä¸€ä¸ªå¥½äº†ã€‚\nå›¾ä¸­ç½‘é¡µ id æ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼Œæ˜¾ç„¶ä¸€ä¸ª url å¯¹åº”ä¸€ä¸ªç½‘é¡µ idï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¢åŠ ä¸€ä¸ªå‘å·å™¨ï¼Œæ¯çˆ¬å–å®Œä¸€ä¸ªç½‘é¡µï¼Œå‘å·å™¨ç»™å®ƒåˆ†é…ä¸€ä¸ª idï¼Œå°†ç½‘é¡µ id ä¸ url å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œå‡è®¾å‘½åä¸º doc_id.bin,å¦‚ä¸‹\näºŒã€é¢„å¤„ç† çˆ¬å–å®Œä¸€ä¸ªç½‘é¡µåæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œé¢„å¤„ç†ï¼Œæˆ‘ä»¬æ‹¿åˆ°çš„æ˜¯ç½‘é¡µçš„ html ä»£ç ï¼Œéœ€è¦æŠŠ\u0026lt;script\u0026gt;,\u0026lt;style\u0026gt;,\u0026lt;option\u0026gt; è¿™äº›æ— ç”¨çš„æ ‡ç­¾åŠæ ‡ç­¾åŒ…å«çš„å†…å®¹ç»™å»æ‰ï¼Œæ€ä¹ˆæŸ¥æ‰¾æ˜¯ä¸ªå­¦é—®ï¼Œå¯èƒ½æœ‰äººä¼šè¯´ç”¨ BFï¼ŒKMP ç­‰ç®—æ³•ï¼Œè¿™äº›ç®—æ³•ç¡®å®å¯ä»¥ï¼Œä¸è¿‡è¿™äº›ç®—æ³•å±äºå•æ¨¡å¼ä¸²åŒ¹é…ç®—æ³•ï¼ŒæŸ¥è¯¢å•ä¸ªå­—æ®µä¸²æ•ˆç‡ç¡®å®ä¸é”™ï¼Œä½†æˆ‘ä»¬æƒ³è¦ä¸€æ¬¡æ€§æŸ¥å‡º\u0026lt;script\u0026gt;,\u0026lt;style\u0026gt;,\u0026lt;option\u0026gt;è¿™äº›å­—æ®µä¸²ï¼Œæœ‰å•¥å¥½çš„æ–¹æ³•ä¸ï¼Œç­”æ¡ˆæ˜¯ç”¨AC è‡ªåŠ¨æœºå¤šæ¨¡å¼ä¸²åŒ¹é…ç®—æ³•ï¼Œå¯ä»¥é«˜æ•ˆä¸€æ¬¡æ€§æ‰¾å‡ºå‡ ä¸ªå¾…æŸ¥æ‰¾çš„å­—æ®µä¸²ï¼Œæœ‰å¤šé«˜æ•ˆï¼Œæ—¶é—´å¤æ‚åº¦æ¥è¿‘ 0(n)ï¼å…³äº AC è‡ªåŠ¨æœºå¤šæ¨¡å¼åŒ¹é…ç®—æ³•çš„åŸç†ä¸å±•å¼€ä»‹ç»ï¼Œå¤§å®¶å¯ä»¥å»ç½‘ä¸Šæœæœçœ‹ï¼Œ è¿™é‡Œåªæ˜¯ç»™å¤§å®¶ä»‹ç»ä¸€ä¸‹æ€è·¯ã€‚\næ‰¾åˆ°è¿™äº›æ ‡ç­¾çš„èµ·å§‹ä½ç½®åï¼Œå‰©ä¸‹çš„å°±ç®€å•äº†ï¼Œæ¥ä¸‹æ¥å¯¹æ¯ä¸ªè¿™äº›æ ‡ç­¾éƒ½æŸ¥æ‰¾å…¶æˆªæ­¢æ ‡ç­¾ \u0026lt;/script\u0026gt;,\u0026lt;/style\u0026gt;,\u0026lt;/option\u0026gt;ï¼Œæ‰¾åˆ°ä¹‹åï¼ŒæŠŠèµ·å§‹ç»ˆæ­¢æ ‡ç­¾åŠå…¶ä¸­çš„å†…å®¹å…¨éƒ¨å»æ‰å³å¯ã€‚\nåšå®Œä»¥ä¸Šæ­¥éª¤åï¼Œæˆ‘ä»¬ä¹Ÿè¦æŠŠå…¶å®ƒçš„ html æ ‡ç­¾å»æ‰ï¼ˆæ ‡ç­¾é‡Œçš„å†…å®¹ä¿ç•™ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬æœ€ç»ˆè¦å¤„ç†çš„æ˜¯çº¯å†…å®¹ï¼ˆå†…å®¹é‡Œé¢åŒ…å«ç”¨æˆ·è¦æœç´¢çš„å…³é”®è¯ï¼‰\nä¸‰ã€åˆ†è¯å¹¶åˆ›å»ºå€’æ’ç´¢å¼• æ‹¿åˆ°ä¸Šè¿°æ­¥éª¤å¤„ç†è¿‡çš„å†…å®¹åï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›å†…å®¹è¿›è¡Œåˆ†è¯ï¼Œå•¥å«åˆ†è¯å‘¢ï¼Œå°±æ˜¯å°†ä¸€æ®µæ–‡æœ¬åˆ‡åˆ†æˆä¸€ä¸ªä¸ªçš„è¯ã€‚æ¯”å¦‚ ã€ŒI am a chineseã€åˆ†è¯åï¼Œå°±æœ‰ ã€ŒIã€,ã€Œamã€,ã€Œaã€,ã€Œchineseã€è¿™å››ä¸ªè¯,ä»ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œè‹±æ–‡åˆ†è¯ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œæ¯ä¸ªå•è¯åŸºæœ¬æ˜¯ç”¨ç©ºæ ¼éš”å¼€çš„ï¼Œåªè¦ä»¥ç©ºæ ¼ä¸ºåˆ†éš”ç¬¦åˆ‡å‰²å­—ç¬¦ä¸²åŸºæœ¬å¯è¾¾åˆ°åˆ†è¯æ•ˆæœï¼Œä½†æ˜¯ä¸­æ–‡ä¸ä¸€æ ·ï¼Œè¯ä¸è¯ä¹‹ç±»æ²¡æœ‰ç©ºæ ¼ç­‰å­—ç¬¦ä¸²åˆ†å‰²ï¼Œæ¯”è¾ƒéš¾ä»¥åˆ†å‰²ã€‚ä»¥ã€Œæˆ‘æ¥åˆ°åŒ—äº¬æ¸…åå¤§å­¦ã€ä¸ºä¾‹ï¼Œä¸åŒçš„æ¨¡å¼äº§ç”Ÿçš„åˆ†è¯ç»“æœä¸ä¸€æ ·ï¼Œä»¥ github ä¸Šæœ‰åçš„ jieba åˆ†è¯å¼€æºåº“ä»¥ä¾‹ï¼Œå®ƒæœ‰å¦‚ä¸‹å‡ ç§åˆ†è¯æ¨¡å¼\nã€å…¨æ¨¡å¼ã€‘: æˆ‘/ æ¥åˆ°/ åŒ—äº¬/ æ¸…å/ æ¸…åå¤§å­¦/ åå¤§/ å¤§å­¦ ã€ç²¾ç¡®æ¨¡å¼ã€‘: æˆ‘/ æ¥åˆ°/ åŒ—äº¬/ æ¸…åå¤§å­¦ ã€æ–°è¯è¯†åˆ«ã€‘ï¼šä»–, æ¥åˆ°, äº†, ç½‘æ˜“, æ­ç ”, å¤§å¦ ã€æœç´¢å¼•æ“æ¨¡å¼ã€‘ï¼š å°æ˜, ç¡•å£«, æ¯•ä¸š, äº, ä¸­å›½, ç§‘å­¦, å­¦é™¢, ç§‘å­¦é™¢, ä¸­å›½ç§‘å­¦é™¢, è®¡ç®—, è®¡ç®—æ‰€, å, åœ¨, æ—¥æœ¬, äº¬éƒ½, å¤§å­¦, æ—¥æœ¬äº¬éƒ½å¤§å­¦, æ·±é€ \nåˆ†è¯ä¸€èˆ¬æ˜¯æ ¹æ®ç°æˆçš„è¯åº“æ¥è¿›è¡ŒåŒ¹é…ï¼Œæ¯”å¦‚è¯åº“ä¸­æœ‰ã€Œä¸­å›½ã€è¿™ä¸ªè¯ï¼Œç”¨å¤„ç†è¿‡çš„ç½‘é¡µæ–‡æœ¬è¿›è¡ŒåŒ¹é…å³å¯ã€‚å½“ç„¶åœ¨åˆ†è¯ä¹‹å‰æˆ‘ä»¬è¦æŠŠä¸€äº›æ— æ„ä¹‰çš„åœæ­¢è¯å¦‚ã€Œçš„ã€,ã€Œåœ°ã€,ã€Œå¾—ã€å…ˆç»™å»æ‰ã€‚\nç»è¿‡åˆ†è¯ä¹‹åæˆ‘ä»¬å¾—åˆ°äº†æ¯ä¸ªåˆ†è¯ä¸å…¶æ–‡æœ¬çš„å…³ç³»ï¼Œå¦‚ä¸‹\nè¿™æ ·æˆ‘ä»¬åœ¨æœã€Œå¤§å­¦ã€çš„æ—¶å€™æ‰¾åˆ°ã€Œå¤§å­¦ã€å¯¹åº”çš„è¡Œï¼Œå°±èƒ½æ‰¾åˆ°æ‰€æœ‰åŒ…å«æœ‰ã€Œå¤§å­¦ã€çš„æ–‡æ¡£ id äº†ã€‚\nçœ‹åˆ°ä»¥ä¸Šã€Œåˆ†è¯ã€+ã€Œå€’æ’ç´¢å¼•ã€çš„å¤„ç†æµç¨‹ï¼Œå¤§å®¶æƒ³åˆ°äº†ä»€ä¹ˆï¼Ÿæ²¡é”™ï¼Œè¿™ä¸å°±æ˜¯ ElasticSearch æœç´¢å¼•æ“å¹²çš„äº‹å—ï¼Œä¹Ÿæ˜¯ ES èƒ½è¾¾åˆ°æ¯«ç§’çº§å“åº”çš„å…³é”®ï¼\nè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ ¹æ®æŸä¸ªè¯è¯­è·å–å¾—äº†ä¸€ç»„ç½‘é¡µçš„ id ä¹‹åï¼Œåœ¨ç»“æœå±•ç¤ºä¸Šï¼Œå“ªäº›ç½‘é¡µåº”è¯¥æ’åœ¨æœ€å‰é¢å‘¢ï¼Œä¸ºå•¥æˆ‘ä»¬åœ¨ Google ä¸Šæœç´¢ä¸€èˆ¬åœ¨ç¬¬ä¸€é¡µçš„å‰å‡ æ¡å°±èƒ½æ‰¾åˆ°æˆ‘ä»¬æƒ³è¦çš„ç­”æ¡ˆã€‚è¿™å°±æ¶‰åŠåˆ°æœç´¢å¼•æ“æ¶‰åŠåˆ°çš„å¦ä¸€ä¸ªé‡è¦çš„ç®—æ³•: PageRankï¼Œå®ƒæ˜¯ Google å¯¹ç½‘é¡µæ’åè¿›è¡Œæ’åçš„ä¸€ç§ç®—æ³•ï¼Œå®ƒä»¥ç½‘é¡µä¹‹é—´çš„è¶…é“¾æ¥ä¸ªæ•°å’Œè´¨é‡ä½œä¸ºä¸»è¦å› ç´ ç²—ç•¥åœ°åˆ†æç½‘é¡µé‡è¦æ€§ä»¥ä¾¿å¯¹å…¶è¿›è¡Œæ‰“åˆ†ã€‚æˆ‘ä»¬ä¸€èˆ¬åœ¨æœé—®é¢˜çš„æ—¶å€™ï¼Œå‰é¢ä¸€ä¸¤ä¸ªåŸºæœ¬ä¸Šéƒ½æ˜¯ stackoverflow ç½‘é¡µï¼Œè¯´æ˜ Google è®¤ä¸ºè¿™ä¸ªç½‘é¡µçš„æƒé‡å¾ˆé«˜ï¼Œå› ä¸ºè¿™ä¸ªç½‘é¡µè¢«å…¨ä¸–ç•Œå‡ ä¹æ‰€æœ‰çš„ç¨‹åºå‘˜ä½¿ç”¨ç€ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰æ— æ•°ä¸ªç½‘é¡µæŒ‡å‘æ­¤ç½‘ç«™çš„é“¾æ¥ï¼Œæ ¹æ® PageRank ç®—æ³•ï¼Œè‡ªç„¶æ­¤ç½‘ç«™æƒé‡å°±å•¦ï¼Œæ©ï¼Œå¯ä»¥ç®€å•åœ°è¿™ä¹ˆè®¤ä¸ºï¼Œå®é™…ä¸Š PageRank çš„è®¡ç®—éœ€è¦ç”¨åˆ°å¤§é‡çš„æ•°å­¦çŸ¥è¯†ï¼Œæ¯•ç«Ÿæ­¤ç®—æ³•æ˜¯ Google çš„ç«‹èº«ä¹‹æœ¬ï¼Œå¤§å®¶å¦‚æœæœ‰å…´è¶£ï¼Œå¯ä»¥å»ç½‘ä¸Šå¤šå¤šäº†è§£ä¸€ä¸‹ã€‚\nå®Œæˆä»¥ä¸Šæ­¥éª¤ï¼Œæœç´¢å¼•æ“å¯¹ç½‘é¡µçš„å¤„ç†å°±å®Œäº†ï¼Œé‚£ä¹ˆç”¨æˆ·è¾“å…¥å…³é”®è¯æœç´¢å¼•æ“åˆæ˜¯æ€ä¹ˆç»™æˆ‘ä»¬å±•ç¤ºå‡ºç»“æœçš„å‘¢ã€‚\nå››ã€æŸ¥è¯¢ ç”¨æˆ·è¾“å…¥å…³é”®è¯åï¼Œé¦–å…ˆè‚¯å®šæ˜¯è¦ç»è¿‡åˆ†è¯å™¨çš„å¤„ç†ã€‚æ¯”å¦‚æˆ‘è¾“å…¥ã€Œä¸­å›½äººæ°‘ã€ï¼Œå‡è®¾åˆ†è¯å™¨åˆ†å°†å…¶åˆ†ä¸ºã€Œä¸­å›½ã€,ã€Œäººæ°‘ã€ä¸¤ä¸ªè¯ï¼Œæ¥ä¸‹æ¥å°±ç”¨è¿™ä¸ªä¸¤è¯å»å€’æ’ç´¢å¼•é‡ŒæŸ¥ç›¸åº”çš„æ–‡æ¡£\nå¾—åˆ°ç½‘é¡µ id åï¼Œæˆ‘ä»¬åˆ†åˆ«å» doc_id.binï¼Œdoc_raw.bin é‡Œæå–å‡ºç½‘é¡µçš„é“¾æ¥å’Œå†…å®¹ï¼ŒæŒ‰æƒé‡ä»å¤§åˆ°å°æ’åˆ—å³å¯ã€‚\nè¿™é‡Œçš„æƒé‡é™¤äº†å’Œä¸Šæ–‡è¯´çš„ PageRank ç®—æ³•æœ‰å…³å¤–ï¼Œè¿˜ä¸å¦å¤–ä¸€ä¸ªã€Œ TF-IDF ã€ï¼ˆhttps://zh.wikipedia.org/wiki/Tf-idfï¼‰ç®—æ³•æœ‰å…³ï¼Œå¤§å®¶å¯ä»¥å»äº†è§£ä¸€ä¸‹ã€‚\nå¦å¤–ç›¸ä¿¡å¤§å®¶åœ¨æœç´¢æ¡†è¾“å…¥æœç´¢è¯çš„æ—¶å€™ï¼Œéƒ½ä¼šæ³¨æ„åˆ°åº•ä¸‹ä¼šå‡ºç°ä¸€ä¸²æœç´¢æç¤ºè¯ï¼Œ\nå¦‚ä½•å®ç°çš„ï¼Œè¿™å°±ä¸å¾—ä¸æåˆ°ä¸€ç§æ ‘å½¢ç»“æ„ï¼šTrie æ ‘ã€‚Trie æ ‘åˆå«å­—å…¸æ ‘ã€å‰ç¼€æ ‘ï¼ˆPrefix Treeï¼‰ã€å•è¯æŸ¥æ‰¾æ ‘ï¼Œæ˜¯ä¸€ç§å¤šå‰æ ‘ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nè¿™é¢—å¤šå‰æ ‘è¡¨ç¤ºäº†å…³é”®å­—é›†åˆ [\u0026ldquo;to\u0026rdquo;ï¼Œ\u0026ldquo;tea\u0026rdquo;ï¼Œ\u0026ldquo;ted\u0026rdquo;ï¼Œ\u0026ldquo;ten\u0026rdquo;ï¼Œ\u0026ldquo;a\u0026rdquo;ï¼Œ\u0026ldquo;i\u0026rdquo;ï¼Œ\u0026ldquo;in\u0026rdquo;, \u0026ldquo;inn\u0026rdquo;]ã€‚ä»ä¸­å¯ä»¥çœ‹å‡º Trie æ ‘å…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š\næ ¹èŠ‚ç‚¹ä¸åŒ…å«å­—ç¬¦ï¼Œé™¤æ ¹èŠ‚ç‚¹å¤–çš„æ¯ä¸€ä¸ªå­èŠ‚ç‚¹éƒ½åŒ…å«ä¸€ä¸ªå­—ç¬¦ ä»æ ¹èŠ‚ç‚¹åˆ°æŸä¸€ä¸ªèŠ‚ç‚¹ï¼Œè·¯å¾„ä¸Šç»è¿‡çš„å­—ç¬¦è¿æ¥èµ·æ¥ï¼Œä¸ºè¯¥èŠ‚ç‚¹å¯¹åº”çš„å­—ç¬¦ä¸² æ¯ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹åŒ…å«çš„å­—ç¬¦äº’ä¸ç›¸åŒ é€šå¸¸åœ¨å®ç°çš„æ—¶å€™ï¼Œä¼šåœ¨èŠ‚ç‚¹ç»“æ„ä¸­è®¾ç½®ä¸€ä¸ªæ ‡å¿—ï¼Œç”¨æ¥æ ‡è®°è¯¥ç»“ç‚¹å¤„æ˜¯å¦æ„æˆä¸€ä¸ªå•è¯ï¼ˆå…³é”®å­—ï¼‰ã€‚\nå¦å¤–æˆ‘ä»¬ä¸éš¾å‘ç°ä¸€ä¸ªè§„å¾‹ï¼Œå…·æœ‰å…¬å…±å‰ç¼€çš„å…³é”®å­—ï¼ˆå•è¯ï¼‰ï¼Œå®ƒä»¬å‰ç¼€éƒ¨åˆ†åœ¨ Trie æ ‘ä¸­æ˜¯ç›¸åŒçš„ï¼Œè¿™ä¹Ÿæ˜¯ Trie æ ‘è¢«ç§°ä¸ºå‰ç¼€æ ‘çš„åŸå› ï¼Œæœ‰äº†è¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬ä¸éš¾è®¾è®¡å‡ºä¸Šæ–‡æ‰€è¿°æœç´¢æ—¶å±•ç¤ºä¸€ä¸²æœç´¢æç¤ºè¯çš„æ€è·¯ï¼š\nä¸€èˆ¬æœç´¢å¼•æ“ä¼šç»´æŠ¤ä¸€ä¸ªè¯åº“ï¼Œå‡è®¾è¿™ä¸ªè¯åº“ç”±æ‰€æœ‰æœç´¢æ¬¡æ•°å¤§äºæŸä¸ªé˜ˆå€¼ï¼ˆå¦‚ 1000ï¼‰çš„å­—ç¬¦ä¸²ç»„æˆï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨è¿™ä¸ªè¯åº“æ„å»ºä¸€é¢— Trie æ ‘ï¼Œè¿™æ ·å½“ç”¨æˆ·è¾“å…¥å­—æ¯çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä»¥è¿™ä¸ªå­—æ¯ä½œä¸ºå‰ç¼€å» Trie æ ‘ä¸­æŸ¥æ‰¾ï¼Œä»¥ä¸Šæ–‡ä¸­æåˆ°çš„ Trie æ ‘ä¸ºä¾‹ï¼Œåˆ™æˆ‘ä»¬è¾“å…¥ã€Œteã€æ—¶ï¼Œç”±äºä»¥ã€Œteã€ä¸ºå‰ç¼€çš„å•è¯æœ‰ [\u0026ldquo;tea\u0026rdquo;ï¼Œ\u0026ldquo;ted\u0026rdquo;ï¼Œ\u0026ldquo;ted\u0026rdquo;ï¼Œ\u0026ldquo;ten\u0026rdquo;]ï¼Œåˆ™åœ¨æœç´¢å¼•æ“çš„æœç´¢æç¤ºæ¡†ä¸­å°±å¯ä»¥å±•ç¤ºè¿™å‡ ä¸ªå­—ç¬¦ä¸²ä»¥ä¾›ç”¨æˆ·é€‰æ‹©ã€‚\näº”ã€å¯»æ‰¾çƒ­é—¨æœç´¢å­—ç¬¦ä¸² Trie æ ‘é™¤äº†ä½œä¸ºå‰ç¼€æ ‘æ¥å®ç°æœç´¢æç¤ºè¯çš„åŠŸèƒ½å¤–ï¼Œè¿˜å¯ä»¥ç”¨æ¥è¾…åŠ©å¯»æ‰¾çƒ­é—¨æœç´¢å­—ç¬¦ä¸²ï¼Œåªè¦å¯¹ Trie æ ‘ç¨åŠ æ”¹é€ å³å¯ã€‚å‡è®¾æˆ‘ä»¬è¦å¯»æ‰¾æœ€çƒ­é—¨çš„ 10 ä¸ªæœç´¢å­—ç¬¦ä¸²ï¼Œåˆ™å…·ä½“å®ç°æ€è·¯å¦‚ä¸‹:\nä¸€èˆ¬æœç´¢å¼•æ“éƒ½ä¼šæœ‰ä¸“é—¨çš„æ—¥å¿—æ¥è®°å½•ç”¨æˆ·çš„æœç´¢è¯ï¼Œæˆ‘ä»¬ç”¨ç”¨æˆ·çš„è¿™äº›æœç´¢è¯æ¥æ„å»ºä¸€é¢— Trie æ ‘ï¼Œä½†è¦ç¨å¾®å¯¹ Trie æ ‘è¿›è¡Œä¸€ä¸‹æ”¹é€ ï¼Œä¸Šæ–‡æåˆ°ï¼ŒTrie æ ‘å®ç°çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨èŠ‚ç‚¹ä¸­è®¾ç½®ä¸€ä¸ªæ ‡å¿—ï¼Œç”¨æ¥æ ‡è®°è¯¥ç»“ç‚¹å¤„æ˜¯å¦æ„æˆä¸€ä¸ªå•è¯ï¼Œä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªæ ‡å¿—æ”¹æˆä»¥èŠ‚ç‚¹ä¸ºç»ˆæ­¢å­—ç¬¦çš„æœç´¢å­—ç¬¦ä¸²ä¸ªæ•°ï¼Œæ¯ä¸ªæœç´¢å­—ç¬¦ä¸²åœ¨ Trie æ ‘éå†ï¼Œåœ¨éå†çš„æœ€åä¸€ä¸ªç»“ç‚¹ä¸ŠæŠŠå­—ç¬¦ä¸²ä¸ªæ•°åŠ  1ï¼Œå³å¯ç»Ÿè®¡å‡ºæ¯ä¸ªå­—ç¬¦ä¸²è¢«æœç´¢äº†å¤šå°‘æ¬¡ï¼ˆæ ¹èŠ‚ç‚¹åˆ°ç»“ç‚¹ç»è¿‡çš„è·¯å¾„å³ä¸ºæœç´¢å­—ç¬¦ä¸²ï¼‰ï¼Œç„¶åæˆ‘ä»¬å†ç»´æŠ¤ä¸€ä¸ªæœ‰ 10 ä¸ªèŠ‚ç‚¹çš„å°é¡¶å †ï¼ˆå †é¡¶å…ƒç´ æ¯”æ‰€æœ‰å…¶ä»–å…ƒç´ å€¼éƒ½å°ï¼Œå¦‚ä¸‹å›¾ç¤ºï¼‰\nä¾æ¬¡éå† Trie æ ‘çš„èŠ‚ç‚¹ï¼Œå°†èŠ‚ç‚¹ï¼ˆå­—ç¬¦ä¸²+æ¬¡æ•°ï¼‰ä¼ ç»™å°é¡¶å †ï¼Œæ ¹æ®æœç´¢æ¬¡æ•°ä¸æ–­è°ƒæ•´å°é¡¶å †ï¼Œè¿™æ ·éå†å®Œ Trie æ ‘çš„èŠ‚ç‚¹åï¼Œå°é¡¶å †é‡Œçš„ 10 ä¸ªèŠ‚ç‚¹å¯¹åº”çš„å­—ç¬¦ä¸²å³æ˜¯æœ€çƒ­é—¨çš„æœç´¢å­—ç¬¦ä¸²ã€‚\næ€»ç»“ æœ¬æ–‡ç®€è¿°äº†æœç´¢å¼•æ“çš„å·¥ä½œåŸç†ï¼Œç›¸ä¿¡å¤§å®¶çœ‹å®Œåå¯¹å…¶å·¥ä½œåŸç†åº”è¯¥æœ‰äº†æ¯”è¾ƒæ¸…é†’çš„è®¤è¯†ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæœç´¢å¼•æ“ä¸­ç”¨åˆ°äº†å¾ˆå¤šç»å…¸çš„æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œæ‰€ä»¥ç°åœ¨å¤§å®¶åº”è¯¥èƒ½æ˜ç™½ä¸ºå•¥ Google, ç™¾åº¦è¿™äº›å…¬å¸å¯¹å€™é€‰äººçš„ç®—æ³•è¦æ±‚è¿™ä¹ˆé«˜äº†ã€‚\n","permalink":"https://reid00.github.io/en/posts/algo/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E8%83%8C%E5%90%8E%E7%9A%84%E7%BB%8F%E5%85%B8%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/","summary":"å‰è¨€ æˆ‘ä»¬æ¯å¤©éƒ½åœ¨ç”¨ Google, ç™¾åº¦è¿™äº›æœç´¢å¼•æ“ï¼Œé‚£å¤§å®¶æœ‰æ²¡æƒ³è¿‡æœç´¢å¼•æ“æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Œçœ‹ä¼¼ç®€å•çš„æœç´¢å…¶å®æŠ€æœ¯ç»†èŠ‚éå¸¸å¤æ‚ï¼Œè¯´æœç´¢å¼•æ“æ˜¯ IT çš‡å† ä¸Šçš„æ˜ç ä¹Ÿä¸ä¸ºè¿‡ï¼Œä»Šå¤©æˆ‘ä»¬æ¥å°±æ¥ç®€å•è¿‡ä¸€ä¸‹æœç´¢å¼•æ“çš„åŸç†ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå½“ç„¶æœç´¢å¼•æ“åšå¤§ç²¾æ·±ï¼Œä¸€ç¯‡æ–‡ç« ä¸å¯èƒ½å®Œå…¨ä»‹ç»å®Œï¼Œæˆ‘ä»¬åªä¼šä»‹ç»å®ƒæœ€é‡è¦çš„å‡ ä¸ªæ­¥éª¤ï¼Œä¸è¿‡ä¸‡å˜ä¸ç¦»å…¶å®—ï¼Œæœç´¢å¼•æ“éƒ½ç¦»å¼€è¿™äº›é‡è¦æ­¥éª¤ï¼Œå‰©ä¸‹çš„æ— éæ˜¯åœ¨å…¶ä¸Šæ·»ç –åŠ ç“¦ï¼Œæ‰€ä»¥æŒæ¡è¿™äº›ã€Œå…³é”®è·¯å¾„ã€ï¼Œèƒ½å¾ˆå¥½åœ°è¾¾åˆ°è§‚ä¸€æ–‘è€Œçª¥å…¨è²çš„ç›®çš„ã€‚\næœ¬æ–‡å°†ä¼šä»ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†æ¥ä»‹ç»æœç´¢å¼•æ“ï¼Œä¼šæ·±åº¦å‰–ææœç´¢å¼•æ“çš„å·¥ä½œåŸç†åŠå…¶ä¸­ç”¨åˆ°çš„ä¸€äº›ç»å…¸æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œç›¸ä¿¡å¤§å®¶çœ‹äº†è‚¯å®šæœ‰æ”¶è·ã€‚\næœç´¢å¼•æ“ç³»ç»Ÿæ¶æ„å›¾\næœç´¢å¼•æ“å·¥ä½œåŸç†è¯¦ç»†å‰–æ\næœç´¢å¼•æ“ç³»ç»Ÿæ¶æ„å›¾ æœç´¢å¼•æ“æ•´ä½“æ¶æ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºæœé›†ï¼Œé¢„å¤„ç†ï¼Œç´¢å¼•ï¼ŒæŸ¥è¯¢è¿™å››æ­¥ï¼Œæ¯ä¸€æ­¥çš„æŠ€æœ¯ç»†èŠ‚éƒ½å¾ˆå¤šï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹æ–‡ä¸­è¯¦ç»†åˆ†ææ¯ä¸€æ­¥çš„å·¥ä½œåŸç†ã€‚ æœç´¢å¼•æ“å·¥ä½œåŸç†è¯¦ç»†å‰–æ ä¸€ã€æœç´¢ çˆ¬è™«ä¸€å¼€å§‹æ˜¯ä¸çŸ¥é“è¯¥ä»å“ªé‡Œå¼€å§‹çˆ¬èµ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»™å®ƒä¸€ç»„ä¼˜è´¨ç§å­ç½‘é¡µçš„é“¾æ¥ï¼Œæ¯”å¦‚æ–°æµªä¸»é¡µï¼Œè…¾è®¯ä¸»é¡µç­‰ï¼Œè¿™äº›ä¸»é¡µæ¯”è¾ƒçŸ¥åï¼Œåœ¨ Alexa æ’åä¸Šä¹Ÿéå¸¸é å‰ï¼Œæ‹¿åˆ°è¿™äº›ä¼˜è´¨ç§å­ç½‘é¡µåï¼Œå°±å¯¹è¿™äº›ç½‘é¡µé€šè¿‡å¹¿åº¦ä¼˜å…ˆéå†ä¸æ–­éå†è¿™äº›ç½‘é¡µï¼Œçˆ¬å–ç½‘é¡µå†…å®¹ï¼Œæå–å‡ºå…¶ä¸­çš„é“¾æ¥ï¼Œä¸æ–­å°†å…¶å°†å…¥åˆ°å¾…çˆ¬å–é˜Ÿåˆ—ï¼Œç„¶åçˆ¬è™«ä¸æ–­åœ°ä» url çš„å¾…çˆ¬å–é˜Ÿåˆ—é‡Œæå–å‡º url è¿›è¡Œçˆ¬å–ï¼Œé‡å¤ä»¥ä¸Šè¿‡ç¨‹\u0026hellip;\nå½“ç„¶äº†ï¼Œåªç”¨ä¸€ä¸ªçˆ¬è™«æ˜¯ä¸å¤Ÿçš„ï¼Œå¯ä»¥å¯åŠ¨å¤šä¸ªçˆ¬è™«å¹¶è¡Œçˆ¬å–ï¼Œè¿™æ ·é€Ÿåº¦ä¼šå¿«å¾ˆå¤šã€‚\n1ã€å¾…çˆ¬å–çš„ url å®ç° å¾…çˆ¬å– url æˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ”¾åˆ° Redis é‡Œï¼Œä¿è¯äº†é«˜æ€§èƒ½ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRedisè¦å¼€å¯æŒä¹…åŒ–åŠŸèƒ½ï¼Œè¿™æ ·æ”¯æŒæ–­ç‚¹ç»­çˆ¬ï¼Œå¦‚æœ Redis æŒ‚æ‰äº†ï¼Œé‡å¯ä¹‹åç”±äºæœ‰æŒç»­ä¹…åŠŸèƒ½ï¼Œå¯ä»¥ä»ä¸Šä¸€ä¸ªå¾…çˆ¬çš„ url å¼€å§‹é‡æ–°çˆ¬ã€‚\n2ã€å¦‚ä½•åˆ¤é‡ å¦‚ä½•é¿å…ç½‘é¡µçš„é‡å¤çˆ¬å–å‘¢ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ url è¿›è¡Œå»é‡æ“ä½œï¼Œå»é‡æ€ä¹ˆå®ç°ï¼Ÿå¯èƒ½æœ‰äººè¯´ç”¨æ•£åˆ—è¡¨ï¼Œå°†æ¯ä¸ªå¾…æŠ“å– url å­˜åœ¨æ•£åˆ—è¡¨é‡Œï¼Œæ¯æ¬¡è¦åŠ å…¥å¾…çˆ¬å– url æ—¶éƒ½é€šè¿‡è¿™ä¸ªæ•£åˆ—è¡¨æ¥åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦çˆ¬å–è¿‡äº†ï¼Œè¿™æ ·åšç¡®å®æ²¡æœ‰é—®é¢˜ï¼Œä½†æˆ‘ä»¬éœ€è¦æ³¨æ„åˆ°çš„æ˜¯è¿™æ ·éœ€è¦ä¼šå‡ºå·¨å¤§çš„ç©ºé—´ä»£ä»·ï¼Œæœ‰å¤šå¤§ï¼Œæˆ‘ä»¬ç®€å•ç®—ä¸€ä¸‹ï¼Œå‡è®¾æœ‰ 10 äº¿ url ï¼ˆä¸è¦è§‰å¾— 10 äº¿å¾ˆå¤§ï¼Œåƒ Google, ç™¾åº¦è¿™æ ·çš„æœç´¢å¼•æ“ï¼Œå®ƒä»¬è¦çˆ¬å–çš„ç½‘é¡µé‡çº§æ¯” 10 äº¿å¤§å¾—å¤šï¼‰ï¼Œæ”¾åœ¨æ•£åˆ—è¡¨é‡Œï¼Œéœ€è¦å¤šå¤§å­˜å‚¨ç©ºé—´å‘¢ï¼Ÿ\næˆ‘ä»¬å‡è®¾æ¯ä¸ªç½‘é¡µ url å¹³å‡é•¿åº¦ 64 å­—èŠ‚ï¼Œåˆ™ 10 äº¿ä¸ª url å¤§çº¦éœ€è¦ 60 G å†…å­˜ï¼Œå¦‚æœç”¨æ•£åˆ—è¡¨å®ç°çš„è¯ï¼Œç”±äºæ•£åˆ—è¡¨ä¸ºäº†é¿å…è¿‡å¤šçš„å†²çªï¼Œéœ€è¦è¾ƒå°çš„è£…è½½å› å­ï¼ˆå‡è®¾å“ˆå¸Œè¡¨è¦è£…è½½ 10 ä¸ªå…ƒç´ ï¼Œå®é™…å¯èƒ½è¦åˆ†é… 20 ä¸ªå…ƒç´ çš„ç©ºé—´ï¼Œä»¥é¿å…å“ˆå¸Œå†²çªï¼‰ï¼ŒåŒæ—¶ä¸ç®¡æ˜¯ç”¨é“¾å¼å­˜å‚¨è¿˜æ˜¯ç”¨çº¢é»‘æ ‘æ¥å¤„ç†å†²çªï¼Œéƒ½è¦å­˜å‚¨æŒ‡é’ˆï¼Œå„ç§è¿™äº›åŠ èµ·æ¥æ‰€éœ€å†…å­˜å¯èƒ½ä¼šè¶…è¿‡ 100 Gï¼Œå†åŠ ä¸Šå†²çªæ—¶éœ€è¦åœ¨é“¾è¡¨ä¸­æ¯”è¾ƒå­—ç¬¦ä¸²ï¼Œæ€§èƒ½ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªæŸè€—ï¼Œå½“ç„¶ 100 G å¯¹å¤§å‹æœç´¢å¼•æ“æ¥è¯´ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†å…¶å®è¿˜æœ‰ä¸€ç§æ–¹æ¡ˆå¯ä»¥å®ç°è¿œå°äº 100 G çš„å†…å­˜ï¼šå¸ƒéš†è¿‡æ»¤å™¨ã€‚","title":"æœç´¢å¼•æ“èƒŒåçš„ç»å…¸æ•°æ®ç»“æ„å’Œç®—æ³•"},{"content":"å¸¸è§åç›´è§‰å®šç† ç”Ÿæ—¥æ‚–è®º å‡è®¾æˆ¿é—´é‡Œæœ‰23äººï¼Œé‚£ä¹ˆä¸¤ä¸ªäººç”Ÿæ—¥æ˜¯åŒå¤©çš„æ¦‚ç‡å°†å¤§äº50%ã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“å¾—å‡ºï¼Œä»»ä½•ä¸€ä¸ªç‰¹å®šçš„æ—¥å­é‡ŒæŸäººè¿‡ç”Ÿæ—¥çš„æ¦‚ç‡æ˜¯1/365ã€‚\næ‰€ä»¥è¿™ä¸ªç†è®ºçœ‹ä¼¼æ˜¯æ— æ³•æˆç«‹ï¼Œä½†ç†è®ºä¸ç°å®å·®å¼‚æ­£æºè‡ªäºï¼šæˆ‘ä»¬çš„å”¯ä¸€è¦æ±‚æ˜¯ä¸¤ä¸ªäººå½¼æ­¤æ‹¥æœ‰åŒä¸€å¤©ç”Ÿæ—¥å³å¯ï¼Œä¸é™å®šåœ¨ç‰¹å®šçš„ä¸€å¤©ã€‚ å¦åˆ™ï¼Œå¦‚æœæ¢åšæŸäººåœ¨æŸç‰¹å®šæ—¥æœŸç”Ÿæ—¥ï¼Œä¾‹å¦‚2æœˆ19æ—¥ï¼Œé‚£ä¹ˆ23ä¸ªäººä¸­æ¦‚ç‡ä¾¿ä»…ä¸º6.12%ã€‚\nå¦ä¸€æ–¹é¢å¦‚æœä½ åœ¨æœ‰23ä¸ªäººçš„æˆ¿é—´æŒ‘é€‰ä¸€äººé—®ä»–ï¼šâ€œæœ‰äººå’Œä½ åŒä¸€å¤©ç”Ÿæ—¥å—ï¼Ÿâ€ç­”æ¡ˆå¾ˆå¯èƒ½æ˜¯å¦å®šçš„ã€‚ ä½†å¦‚æœé‡å¤è¯¢é—®å…¶ä½™22äººï¼Œæ¯é—®ä¸€æ¬¡ï¼Œä½ ä¾¿ä¼šæœ‰æ›´å¤§æœºä¼šå¾—åˆ°è‚¯å®šç­”å¤ï¼Œæœ€ç»ˆè¿™ä¸ªæ¦‚ç‡æ˜¯50.7%ã€‚ ç»“è®º å½“æˆ¿é—´é‡Œæœ‰23äººï¼Œé‚£ä¹ˆå­˜åœ¨ç”Ÿæ—¥ç›¸åŒçš„æ¦‚ç‡è¶…è¿‡50%, å¦‚æœæœ‰60äººï¼Œåˆ™è¶…è¿‡99%\nç”Ÿæ—¥æ‚–è®ºçš„åº”ç”¨ æ—¥æ‚–è®ºæ™®éçš„åº”ç”¨äºæ£€æµ‹å“ˆå¸Œå‡½æ•°ï¼šN ä½é•¿åº¦çš„å“ˆå¸Œè¡¨å¯èƒ½å‘ç”Ÿç¢°æ’æµ‹è¯•æ¬¡æ•°ä¸æ˜¯ 2N æ¬¡è€Œæ˜¯åªæœ‰ 2N/2 æ¬¡ã€‚è¿™ä¸€ç»“è®ºè¢«åº”ç”¨åˆ°ç ´è§£å¯†ç å“ˆå¸Œå‡½æ•° (cryptographic hash function) çš„ â€œç”Ÿæ—¥æ”»å‡»â€ ä¸­ã€‚ ç”Ÿæ—¥é—®é¢˜æ‰€éšå«çš„ç†è®ºå·²ç»åœ¨ [Schnabel 1938] åå­—å«åš â€œæ ‡è®°é‡æ•æ³•â€ (capture-recapture) çš„ç»Ÿè®¡è¯•éªŒå¾—åˆ°åº”ç”¨ï¼Œæ¥ä¼°è®¡æ¹–é‡Œé±¼çš„æ•°é‡ã€‚ å·´æ‹¿èµ«-å¡”å°”æ–¯åŸºæ‚–è®º(åˆ†çƒå®šç†) æ•°å­¦ä¸­ï¼Œæœ‰ä¸€æ¡æå…¶åŸºæœ¬çš„å…¬ç†ï¼Œå«åšé€‰æ‹©å…¬ç†ï¼Œè®¸å¤šæ•°å­¦å†…å®¹éƒ½è¦åŸºäºè¿™æ¡å®šç†æ‰å¾—ä»¥æˆç«‹ã€‚ åœ¨1924å¹´ï¼Œæ•°å­¦å®¶æ–¯ç‰¹Â·å·´æ‹¿èµ«å’Œé˜¿å°”å¼—è±å¾·Â·å¡”æ–¯åŸºæ ¹æ®é€‰æ‹©å…¬ç†ï¼Œå¾—åˆ°ä¸€ä¸ªå¥‡æ€ªçš„æ¨è®ºâ€”â€”åˆ†çƒå®šç†ã€‚ è¯¥å®šç†æŒ‡å‡ºï¼Œä¸€ä¸ªä¸‰ç»´å®å¿ƒçƒåˆ†æˆæœ‰é™ä»½ï¼Œç„¶åå¯ä»¥æ ¹æ®æ—‹è½¬å’Œå¹³ç§»ï¼Œç»„æˆå’ŒåŸæ¥å®Œå…¨ç›¸åŒçš„ä¸¤ä¸ªå®å¿ƒçƒã€‚æ²¡é”™ï¼Œæ¯ä¸€ä¸ªå’ŒåŸæ¥çš„ä¸€æ¨¡ä¸€æ ·ã€‚ åˆ†çƒå®šç†å¤ªè¿åç›´è§‰ï¼Œä½†å®ƒå°±æ˜¯é€‰æ‹©å…¬ç†çš„ä¸¥æ ¼æ¨è®ºï¼Œè€Œä¸”ä¸å®¹ç½®ç–‘çš„ï¼Œé™¤éä½ æŠ›å¼ƒé€‰æ‹©å…¬ç†ï¼Œä½†æ•°å­¦å®¶ä¼šä¸ºæ­¤ä»˜å‡ºæ›´å¤§çš„ä»£ä»·ã€‚\nåœ¨ç°å®ç”Ÿæ´»ä¸­æˆ‘ä»¬æ²¡æœ‰ä»»ä½•åŠæ³•èƒ½å°†ä¸€ä¸ªç‰©ä½“å‡­ç©ºå¤åˆ¶æˆä¸¤ä¸ªã€‚ä½†äº‹å®ä¸Šä»–å´æ˜¯æˆç«‹çš„ï¼Œè¿™ä¸ªç»“æœä¼¼ä¹æŒ‘æˆ˜äº†ç‰©ç†ä¸­çš„è´¨é‡å®ˆæ’å®šå¾‹ï¼Œä½†ä¼¼ä¹åˆæ˜¯åœ¨è¯´ä¸€ä¸ªç‰©ä½“çš„è´¨é‡å¯ä»¥å‡­ç©ºå˜ä¸ºåŸæ¥çš„ä¸¤å€ï¼Ÿ ä½†å¦‚è‹¥åŸè´¨é‡æ˜¯æ— é™çš„è¯ï¼Œç¿»å€åè¿˜æ˜¯æ— é™å¤§ï¼Œé‚£ä¹ˆä»è¿™ä¸€å±‚é¢å‡ºå‘æ¥çœ‹è¿™ä¸€ç†è®ºä¹Ÿå¹¶æ²¡æœ‰æ‰“ç ´ç‰©ç†æ³•åˆ™ã€‚\næœ‰ä¸åŒå±‚æ¬¡çš„æ— ç©·å¤§(æ— ç©·å¤§ä¹Ÿæœ‰ç­‰çº§å¤§å°) ä½ å¯èƒ½ä»æ¥æƒ³è±¡ä¸åˆ°ï¼Œæœ‰ä¸€äº›æ— ç©·å¤§æ¯”å…¶ä»–çš„æ— ç©·æ›´å¤§ã€‚æ— ç©·å¤§åº”è¯¥è¢«ç§°ä¸ºåŸºæ•°ï¼Œå¹¶ä¸”ä¸€ä¸ªæ— ç©·å¤§å¦‚æœæ¯”å¦ä¸€ä¸ªæ— ç©·å¤§æ‹¥æœ‰æ›´å¤§çš„åŸºæ•°ï¼Œåˆ™è¯´å®ƒæ¯”å¦ä¸€ä¸ªæ— ç©·å¤§è¦å¤§ã€‚\nåœ¨äºŒåä¸–çºªä»¥å‰ï¼Œæ•°å­¦å®¶ä»¬é‡åˆ°æ— ç©·å¤§éƒ½é¿è€Œè®©ä¹‹ï¼Œè®¤ä¸ºè¦ä¹ˆå“ªé‡Œå‡ºäº†é—®é¢˜ï¼Œè¦ä¹ˆç»“æœæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ ç›´åˆ°1895å¹´ï¼Œåº·æ‰˜å°”å»ºç«‹è¶…ç©·æ•°ç†è®ºï¼Œäººä»¬æ‰å¾—çŸ¥æ— ç©·å¤§ä¹Ÿæ˜¯æœ‰ç­‰çº§çš„ï¼Œæ¯”å¦‚å®æ•°ä¸ªæ•°çš„æ— ç©·ï¼Œå°±æ¯”æ•´æ•°ä¸ªæ•°çš„æ— ç©·çš„ç­‰çº§é«˜ã€‚ è¿˜æœ‰è®¸å¤šå…³äºæ— ç©·å¤§çš„åŸºæ•°å¤§å¤§å‡ºä¹æˆ‘ä»¬çš„æ„æ–™ã€‚ä¸¾ä¸€ä¸ªéå¸¸ç»å…¸çš„ä¾‹å­ï¼šæ•´æ•°æ¯”å¥‡æ•°å¤šå—ï¼Ÿä½ å¯èƒ½ä¼šæ¯«ä¸çŠ¹è±«çš„å›ç­”ï¼Œé‚£æ˜¯å½“ç„¶ï¼ å› ä¸ºæ•´æ•°å¤šå‡ºäº†ä¸€ç³»åˆ—çš„å¶æ•°ã€‚ä½†ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œä»–ä»¬æ‹¥æœ‰ç›¸åŒçš„åŸºæ•°ï¼Œå› è€Œæ•´æ•°å¹¶ä¸æ¯”å¥‡æ•°å¤šã€‚çŸ¥é“äº†è¿™ä¸ªé“ç†ï¼Œå°±ä¸éš¾å›ç­”è¿™ä¸ªé—®é¢˜äº†å§ï¼šæœ‰ç†æ•°å¤šäºæ•´æ•°å—ï¼Ÿä¸ï¼Œæœ‰ç†æ•°ä¸æ•´æ•°ç›¸åŒå¤šã€‚ å®æ•°é€šå¸¸è¢«è®¤ä¸ºæ˜¯è¿ç»­ç»Ÿï¼Œå¹¶ä¸”è‡³ä»Šå¹¶èƒ½å®Œå…¨çŸ¥é“ï¼Œæ˜¯å¦æœ‰ä»‹äºæ•´æ•°åŸºæ•°å’Œè¿ç»­ç»ŸåŸºæ•°çš„æ— ç©·å¤§ï¼Ÿè¿™ä¸ªçŒœæƒ³è¢«ç§°ä¸ºè¿ç»­ç»ŸçŒœæƒ³ã€‚\nè¿™ä¹Ÿå¤ªè¿åç›´è§‰äº†ï¼Œæˆ‘ä»¬ä»æ¥ä¸æŠŠæ— ç©·å¤§å½“ä½œæ•°ï¼Œä½†æ˜¯æ— ç©·å¤§åœ¨è¶…ç©·æ•°ç†è®ºä¸­ï¼Œå´å­˜åœ¨ä¸åŒçš„ç­‰çº§ã€‚\nå“¥å¾·å°”ä¸å®Œå¤‡å®šç† â€œå¯è¯â€å’Œâ€œçœŸâ€ä¸æ˜¯ç­‰ä»·çš„ 1931å¹´ï¼Œå¥¥åœ°åˆ©æ•°å­¦å®¶å“¥å¾·å°”ï¼Œæå‡ºä¸€æ¡éœ‡æƒŠå­¦æœ¯ç•Œçš„å®šç†â€”â€”å“¥å¾·å°”ä¸å®Œå¤‡å®šç†ã€‚ è¯¥å®šç†æŒ‡å‡ºï¼Œæˆ‘ä»¬ç›®å‰çš„æ•°å­¦ç³»ç»Ÿä¸­ï¼Œå¿…å®šå­˜åœ¨ä¸èƒ½è¢«è¯æ˜ä¹Ÿä¸èƒ½è¢«è¯ä¼ªçš„å®šç†ã€‚è¯¥å®šç†ä¸€å‡ºï¼Œå°±ç²‰ç¢äº†æ•°å­¦å®¶å‡ åƒå¹´çš„æ¢¦æƒ³â€”â€”å³å»ºç«‹å®Œå–„çš„æ•°å­¦ç³»ç»Ÿï¼Œä»ä¸€äº›åŸºæœ¬çš„å…¬ç†å‡ºå‘ï¼Œæ¨å¯¼å‡ºä¸€åˆ‡æ•°å­¦çš„å®šç†å’Œå…¬å¼ã€‚\nå®ƒçš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š\nä»»ä½•ä¸€ä¸ªè¶³å¤Ÿå¼ºçš„ç³»ç»Ÿéƒ½å­˜åœ¨ä¸€ä¸ªå‘½é¢˜ï¼Œæ—¢ä¸èƒ½è¢«è¯æ˜ä¹Ÿä¸èƒ½è¢«è¯ä¼ªï¼ˆä¾‹å¦‚è¿ç»­ç»Ÿå‡è®¾ï¼‰ ä»»ä½•ä¸€ä¸ªè¶³å¤Ÿå¼ºçš„ç³»ç»Ÿéƒ½ä¸èƒ½è¯æ˜å®ƒè‡ªèº«æ˜¯ä¸æ¨å‡ºçŸ›ç›¾ï¼Œå³ä¾¿å®ƒä¸èƒ½è¢«æ¨å‡ºçŸ›ç›¾ ä»¥ä¸Šä¸¤æ¡å®šä¹‰å³è‘—åçš„å“¥å¾·å°”ä¸å®Œå¤‡å®šç†ã€‚ä»–çš„æ„ä¹‰å¹¶ä¸ä»…ä»…å±€é™äºæ•°å­¦ï¼Œä¹Ÿç»™äº†æˆ‘ä»¬æ·±æ·±åœ°å“²å­¦å¯è¿ªã€‚\nè’™æéœå°”é—®é¢˜ ä¸‰é—¨é—®é¢˜äº¦ç§°ä¸ºè’™æéœå°”é—®é¢˜ï¼Œå¤§è‡´å‡ºè‡ªç¾å›½çš„ç”µè§†æ¸¸æˆèŠ‚ç›®Let\u0026rsquo;s Make a Dealã€‚é—®é¢˜åå­—æ¥è‡ªè¯¥èŠ‚ç›®çš„ä¸»æŒäººè’™æÂ·éœå°”ã€‚ å‚èµ›è€…ä¼šçœ‹è§ä¸‰æ‰‡å…³é—­äº†çš„é—¨ï¼Œå…¶ä¸­ä¸€æ‰‡çš„åé¢æœ‰ä¸€è¾†æ±½è½¦ï¼Œé€‰ä¸­åé¢æœ‰è½¦çš„é‚£æ‰‡é—¨å¯èµ¢å¾—è¯¥æ±½è½¦ï¼Œå¦å¤–ä¸¤æ‰‡é—¨åé¢åˆ™å„è—æœ‰ä¸€åªå±±ç¾Šã€‚ å½“å‚èµ›è€…é€‰å®šäº†ä¸€æ‰‡é—¨ï¼Œä½†æœªå»å¼€å¯å®ƒçš„æ—¶å€™ï¼ŒèŠ‚ç›®ä¸»æŒäººå¼€å¯å‰©ä¸‹ä¸¤æ‰‡é—¨çš„å…¶ä¸­ä¸€æ‰‡ï¼Œéœ²å‡ºå…¶ä¸­ä¸€åªå±±ç¾Šã€‚ä¸»æŒäººå…¶åä¼šé—®å‚èµ›è€…è¦ä¸è¦æ¢å¦ä¸€æ‰‡ä»ç„¶å…³ä¸Šçš„é—¨ã€‚ é—®é¢˜æ˜¯ï¼šæ¢å¦ä¸€æ‰‡é—¨ä¼šå¦å¢åŠ å‚èµ›è€…èµ¢å¾—æ±½è½¦çš„æœºä¼šç‡ï¼Ÿ ä¸æ¢é—¨çš„è¯ï¼Œèµ¢å¾—æ±½è½¦çš„å‡ ç‡æ˜¯1/3ã€‚æ¢é—¨çš„è¯ï¼Œèµ¢å¾—æ±½è½¦çš„å‡ ç‡æ˜¯2/3ã€‚\nè¿™ä¸ªé—®é¢˜äº¦è¢«å«åšè’™æéœå°”æ‚–è®ºï¼šè™½ç„¶è¯¥é—®é¢˜çš„ç­”æ¡ˆåœ¨é€»è¾‘ä¸Šå¹¶ä¸è‡ªç›¸çŸ›ç›¾ï¼Œä½†ååˆ†è¿åç›´è§‰ã€‚\nå·´å¡å°”é—®é¢˜ å°†è‡ªç„¶æ•°å„è‡ªå¹³æ–¹å–å€’æ•°åŠ åœ¨ä¸€èµ·ç­‰äºÏ€Â²/6ã€‚ ä¸€èˆ¬äººéƒ½ä¼šè§‰å¾—ï¼Œå·¦è¾¹è¿™ä¸€å¨è‡ªç„¶æ•°ä¼¼ä¹å’ŒÏ€ï¼ˆåœ†çš„å‘¨é•¿ä¸ç›´å¾„çš„æ¯”å€¼ï¼‰ä¸ä¼šå­˜åœ¨ä»»ä½•è”ç³»ï¼ç„¶è€Œå®ƒå°±è¿™ä¹ˆå‘ç”Ÿäº†ï¼\né˜¿è´å°”ä¸å¯è§£å®šç† æ›¼å¾·å‹ƒç½—é›† å¾·å‹ƒç½—é›†æ˜¯ä¸€ä¸ªå¤æ•°é›†ï¼Œè€ƒè™‘å‡½æ•°f(z)=zÂ²+cï¼Œcä¸ºå¤å¸¸æ•°ï¼Œåœ¨è¿™ä¸ºå‚æ•°ã€‚ è‹¥ä»z=0å¼€å§‹ä¸æ–­çš„åˆ©ç”¨f(z)è¿›è¡Œè¿­ä»£ï¼Œåˆ™å‡¡æ˜¯ä½¿å¾—è¿­ä»£ç»“æœä¸ä¼šè·‘å‘æ— ç©·å¤§çš„cç»„æˆçš„é›†åˆè¢«ç§°ä¸ºæ›¼å¾·å‹ƒç½—é›†ã€‚è§„åˆ™ä¸å¤æ‚ï¼Œä½†ä½ å¯èƒ½æ²¡é¢„æ–™åˆ°ä¼šå¾—åˆ°è¿™ä¹ˆå¤æ‚çš„å›¾åƒã€‚ å½“ä½ æ”¾å¤§æ›¼å¾·å‹ƒç½—é›†æ—¶ï¼Œä½ ä¼šåˆå‘ç°æ— é™ä¸ªå°çš„æ›¼å¾·å‹ƒç½—é›†ï¼Œå…¶ä¸­æ¯ä¸ªåˆäº¦æ˜¯å¦‚æ­¤\u0026hellip;ï¼ˆè¿™ç§æ€§è´¨æ˜¯åˆ†å½¢æ‰€ç‰¹æœ‰çš„ï¼‰ è¿™çœŸçš„å¾ˆå¥‘åˆé‚£å¥ä¿—è¯â€œå¤§ä¸­æœ‰å¤§ï¼Œå°ä¸­æœ‰å°â€ï¼Œä¸‹é¢æœ‰ä¸€ä¸ªå…³äºæ”¾å¤§ä»–çš„è§†é¢‘ï¼Œæˆ‘æƒ³è¿™ç»å¯¹ä»¤äººå…´å¥‹ä¸å·²ã€‚ ä¸€ç»´å¯ä»¥å’ŒäºŒç»´ç”šè‡³æ›´é«˜ç»´åº¦ä¸€ä¸€å¯¹åº” æŒ‰ç…§æˆ‘ä»¬çš„å¸¸è¯†ï¼ŒäºŒç»´æ¯”ä¸€ç»´ç­‰çº§é«˜ï¼Œä¸‰ç»´æ¯”å››ç»´ç­‰çº§é«˜ï¼Œæ¯”å¦‚çº¿æ˜¯ä¸€ç»´çš„ï¼Œæ‰€ä»¥çº¿ä¸èƒ½ä¸€ä¸€å¯¹åº”äºé¢ç§¯ã€‚ ä½†äº‹å®å¹¶éå¦‚æ­¤ï¼Œåº·æ‰˜å°”è¯æ˜äº†ä¸€ç»´æ˜¯å¯ä»¥ä¸€ä¸€å¯¹åº”é«˜ç»´çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€æ¡çº¿ä¸Šçš„ç‚¹ï¼Œå¯ä»¥å’Œä¸€å—é¢ç§¯ç”šè‡³ä½“ç§¯çš„ç‚¹ä¸€ä¸€å¯¹åº”ï¼Œæˆ–è€…è¯´ä»–ä»¬åŒ…å«çš„ç‚¹ä¸€æ ·å¤šã€‚ è¯æ˜: åœ¨1890å¹´ï¼Œæ„å¤§åˆ©æ•°å­¦å®¶çš®äºšè¯ºï¼Œå°±å‘æ˜äº†ä¸€ä¸ªå‡½æ•°ï¼Œä½¿å¾—å‡½æ•°åœ¨å®è½´[0,1]ä¸Šçš„å–å€¼ï¼Œå¯ä»¥ä¸€ä¸€å¯¹åº”äºå•ä½æ­£æ–¹å½¢ä¸Šçš„æ‰€æœ‰ç‚¹ï¼Œè¿™æ¡æ›²çº¿å«åšçš®äºšè¯ºæ›²çº¿ã€‚ è¿™ä¸ªæ€§è´¨çš„å‘ç°ï¼Œæš—ç¤ºç€äººç±»å¯¹ç»´åº¦çš„ä¸»è§‚è®¤è¯†ï¼Œå¾ˆå¯èƒ½æ˜¯å­˜åœ¨ç¼ºé™·çš„ã€‚\nå¸Œå°”ä¼¯ç‰¹çš„æ—…åº— å¸Œå°”ä¼¯ç‰¹æœ‰ä¸€ä¸ªæ—…åº—ï¼Œæ—…åº—é‡Œæœ‰æ— é™å¤šé—´æˆ¿é—´ã€‚æœ‰ä¸€å¤©æ‰€æœ‰æˆ¿é—´éƒ½ä½æ»¡äº†äººã€‚ç„¶ååˆæ¥äº†ä¸€åæ—…å®¢ã€‚å¸Œå°”ä¼¯ç‰¹è¯´ï¼šå¾ˆæŠ±æ­‰ï¼Œæˆ¿é—´éƒ½ä½æ»¡äº†ã€‚æ—…å®¢è¯´ï¼šæ²¡å…³ç³»ã€‚ä½ å¯ä»¥è®©ç¬¬ä¸€é—´æˆ¿é—´çš„äººä½ç¬¬äºŒé—´æˆ¿ï¼Œç¬¬äºŒé—´æˆ¿é—´çš„äººä½ç¬¬ä¸‰é—´æˆ¿ï¼Œå¦‚æ­¤ç±»æ¨ï¼Œæˆ‘å°±å¯ä»¥ä½ç¬¬ä¸€é—´æˆ¿é—´äº†ã€‚ä¹Ÿå¯ä»¥è®©ç¬¬ä¸€é—´æˆ¿é—´çš„äººä½ç¬¬äºŒé—´æˆ¿ï¼Œç¬¬äºŒé—´æˆ¿é—´çš„äººä½ç¬¬å››é—´æˆ¿ï¼Œä»¥æ­¤ç±»æ¨ï¼Œæˆ‘ä¹Ÿå¯ä»¥ä½ç¬¬ä¸€é—´æˆ¿é—´ã€‚\nç”šè‡³ï¼ŒæŒ‰ç…§è¿™ç§åšæ³•ï¼Œæ— è®ºå†æ¥å¤šå°‘å®¢äººï¼Œåªè¦å®¢äººæ˜¯æœ‰é™ä¸ªï¼Œè¿™ä¸ªä½æ»¡çš„é…’åº—éƒ½å¯ä»¥ç»§ç»­ç©ºå‡ºæˆ¿é—´æ¥ç»™ä»–ä»¬å®‰æ’ã€‚ ä»–çš„è¯´æ³•å¾ˆåç›´è§‰ï¼Œä½†æ˜¯ä»æ•°å­¦è§’åº¦ä¸Šï¼Œä»–æ˜¯æ­£ç¡®çš„ã€‚\nä¸ºäº†è®¨è®ºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆè¦é—®ï¼šå…¨ä½“æ­£æ•´æ•°å’Œå…¨ä½“æ­£å¶æ•°è°å¤šï¼Ÿ å¤§éƒ¨åˆ†äººçš„ç›´è§‰éƒ½æ˜¯ï¼šæ•´æ•°å¤šã€‚å› ä¸ºæ•´æ•°åŒ…å«å¥‡æ•°å’Œå¶æ•°ï¼Œæ‰€ä»¥æ•´æ•°å¤šã€‚\nä½†æ˜¯ï¼Œæ­£æ•´æ•°é›†åˆå’Œæ­£å¶æ•°é›†åˆéƒ½æ˜¯æ— é™å¤šä¸ªå…ƒç´ ã€‚åœ¨æ•°å­¦ä¸Šï¼Œæ— é™å¤šä¸ªå…ƒç´ çš„é›†åˆæ¯”è¾ƒå¤šå°‘æ—¶è¦ä½¿ç”¨â€œåŠ¿â€çš„æ¦‚å¿µã€‚ä¹Ÿå°±æ˜¯ï¼šå¦‚æœä¸¤ä¸ªé›†åˆå¯ä»¥å»ºç«‹ä¸€ä¸ªä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªé›†åˆçš„å…ƒç´ ä¸ªæ•°å°±æ˜¯ä¸€æ ·å¤šçš„ã€‚ æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬ä»¤xè¡¨ç¤ºæ­£æ•´æ•°ï¼Œyè¡¨ç¤ºæ­£å¶æ•°ï¼Œå»ºç«‹å¯¹åº”å…³ç³»y=2xï¼Œé‚£ä¹ˆæ­£æ•´æ•°å’Œæ­£å¶æ•°ä¹‹é—´å°±å»ºç«‹äº†ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œæ‰€ä»¥æ­£æ•´æ•°é›†åˆå’Œæ­£å¶æ•°é›†åˆæ˜¯ç­‰åŠ¿çš„ï¼Œæˆ–è€…è¯´å…¨ä½“æ­£æ•´æ•°å’Œå…¨ä½“æ­£å¶æ•°ä¸€æ ·å¤šã€‚ æŒ‰ç…§è¿™ç§è§‚ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç»§è€Œå¯ä»¥è¯æ˜å…¨ä½“æ­£æ•´æ•°æ•°å’Œå…¨ä½“éè´Ÿæ•´æ•°ä¸€æ ·å¤šï¼šå»ºç«‹ä¸€ä¸€å¯¹åº”å…³ç³»ï¼šy=x-1ï¼Œxå±äºæ­£æ•´æ•°ï¼Œyå±äºéè´Ÿæ•´æ•°ã€‚ æ‰€ä»¥ï¼Œå®¢äººæ¥åˆ°å¸Œå°”ä¼¯ç‰¹çš„é…’åº—ä½å®¿ï¼Œæå‡ºçš„ä¸¤ç§æ–¹æ¡ˆéƒ½æ˜¯åˆç†çš„ã€‚ç¬¬ä¸€ç§æ–¹æ¡ˆåŸºäºå…¨ä½“æ­£æ•´æ•°ï¼ˆæˆ¿é—´ï¼‰å’Œå…¨ä½“éè´Ÿæ•´æ•°ï¼ˆå®¢äººï¼‰æ˜¯ä¸€æ ·å¤šçš„ï¼Œç¬¬äºŒç§æ–¹æ¡ˆæ˜¯åŸºäºå…¨ä½“æ­£å¶æ•°ï¼ˆæˆ¿é—´ï¼‰å’Œå…¨ä½“æ­£æ•´æ•°ï¼ˆå®¢äººï¼‰æ˜¯ä¸€æ ·å¤šçš„ã€‚\næœ‰ç†ç‚¹ æˆ‘ä»¬æŠŠå¹³é¢ä¸Šæ¨ªåæ ‡å’Œçºµåæ ‡éƒ½ä¸ºæœ‰ç†æ•°çš„ç‚¹ç§°ä¸º æœ‰ç†ç‚¹. æ˜¾ç„¶ï¼Œå¹³é¢ä¸Šçš„æœ‰ç†ç‚¹æœ‰æ— ç©·å¤šä¸ªï¼Œç”šè‡³ä¸éš¾è¯æ˜å®ƒä»¬åœ¨æ•´ä¸ªå¹³é¢å†…æ˜¯ç¨ å¯†çš„ï¼Œå³å¯†å¯†éº»éº»åœ°é“ºæ»¡äº†æ•´ä¸ªå¹³é¢. è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å¹³é¢ä¸Šéšæ‰‹ç”»ä¸€æ¡æ›²çº¿ï¼Œç›´è§‰ä¸Šæˆ‘ä»¬å¯èƒ½è®¤ä¸ºè¿™æ ¹æ›²çº¿åº”è¯¥ä¼šç»è¿‡æ— é™å¤šä¸ªæœ‰ç†ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´æ›²çº¿ä¸Šæœ‰æ— é™å¤šä¸ªæœ‰ç†ç‚¹. ä½†äº‹å®ä¸Šå¹¶éä¸€å®šå¦‚æ­¤ï¼æ¯”å¦‚æˆ‘ä»¬éå¸¸ç†Ÿæ‚‰çš„æ›²çº¿ y=e^xï¼Œå®ƒé™¤äº†(0, 1)å¤–æ²¡æœ‰å…¶ä»–ä»»ä½•æœ‰ç†ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒéå¸¸ç¥å¥‡åœ°é¿å¼€äº†å¤„å¤„ç¨ å¯†çš„æœ‰ç†ç‚¹ï¼Œè¿™å°±æŒºåç›´è§‰çš„. ä¹°å½©ç¥¨ ä¹°å½©ç¥¨ä¸­å¥–çš„æ¦‚ç‡é—®é¢˜ã€‚åŒä¸€å¤©å†…ä¹°30æ³¨ä¸åŒçš„å·ç ä¸­ä¸€ç­‰å¥–æ¦‚ç‡é«˜è¿˜æ˜¯è¿ç»­30æœŸæ¯æ¬¡ä¹°ä¸€æ³¨è‡³å°‘æœ‰ä¸€æ¬¡ä¸­å¤§å¥–çš„æ¦‚ç‡é«˜ã€‚æˆ‘æƒ³å½“ç„¶å¾—äººä¸ºæ˜¯åè€…æ¦‚ç‡é«˜ï¼Œä½†æ˜¯å®é™…ä¸Šç»è¿‡è®¡ç®—åï¼Œæ˜¯å‰è€…æ¦‚ç‡é«˜ï¼Œå¹¶ä¸”ä¸¤è€…çš„ä¸­å¥–å¥–é‡‘æœŸæœ›å€¼æ˜¯ç›¸åŒçš„ã€‚\n","permalink":"https://reid00.github.io/en/posts/other/%E6%95%B0%E5%AD%A6%E4%B8%AD%E7%9A%84%E5%8D%81%E5%A4%A7%E6%82%96%E8%AE%BA/","summary":"å¸¸è§åç›´è§‰å®šç† ç”Ÿæ—¥æ‚–è®º å‡è®¾æˆ¿é—´é‡Œæœ‰23äººï¼Œé‚£ä¹ˆä¸¤ä¸ªäººç”Ÿæ—¥æ˜¯åŒå¤©çš„æ¦‚ç‡å°†å¤§äº50%ã€‚æˆ‘ä»¬å¾ˆå®¹æ˜“å¾—å‡ºï¼Œä»»ä½•ä¸€ä¸ªç‰¹å®šçš„æ—¥å­é‡ŒæŸäººè¿‡ç”Ÿæ—¥çš„æ¦‚ç‡æ˜¯1/365ã€‚\næ‰€ä»¥è¿™ä¸ªç†è®ºçœ‹ä¼¼æ˜¯æ— æ³•æˆç«‹ï¼Œä½†ç†è®ºä¸ç°å®å·®å¼‚æ­£æºè‡ªäºï¼šæˆ‘ä»¬çš„å”¯ä¸€è¦æ±‚æ˜¯ä¸¤ä¸ªäººå½¼æ­¤æ‹¥æœ‰åŒä¸€å¤©ç”Ÿæ—¥å³å¯ï¼Œä¸é™å®šåœ¨ç‰¹å®šçš„ä¸€å¤©ã€‚ å¦åˆ™ï¼Œå¦‚æœæ¢åšæŸäººåœ¨æŸç‰¹å®šæ—¥æœŸç”Ÿæ—¥ï¼Œä¾‹å¦‚2æœˆ19æ—¥ï¼Œé‚£ä¹ˆ23ä¸ªäººä¸­æ¦‚ç‡ä¾¿ä»…ä¸º6.12%ã€‚\nå¦ä¸€æ–¹é¢å¦‚æœä½ åœ¨æœ‰23ä¸ªäººçš„æˆ¿é—´æŒ‘é€‰ä¸€äººé—®ä»–ï¼šâ€œæœ‰äººå’Œä½ åŒä¸€å¤©ç”Ÿæ—¥å—ï¼Ÿâ€ç­”æ¡ˆå¾ˆå¯èƒ½æ˜¯å¦å®šçš„ã€‚ ä½†å¦‚æœé‡å¤è¯¢é—®å…¶ä½™22äººï¼Œæ¯é—®ä¸€æ¬¡ï¼Œä½ ä¾¿ä¼šæœ‰æ›´å¤§æœºä¼šå¾—åˆ°è‚¯å®šç­”å¤ï¼Œæœ€ç»ˆè¿™ä¸ªæ¦‚ç‡æ˜¯50.7%ã€‚ ç»“è®º å½“æˆ¿é—´é‡Œæœ‰23äººï¼Œé‚£ä¹ˆå­˜åœ¨ç”Ÿæ—¥ç›¸åŒçš„æ¦‚ç‡è¶…è¿‡50%, å¦‚æœæœ‰60äººï¼Œåˆ™è¶…è¿‡99%\nç”Ÿæ—¥æ‚–è®ºçš„åº”ç”¨ æ—¥æ‚–è®ºæ™®éçš„åº”ç”¨äºæ£€æµ‹å“ˆå¸Œå‡½æ•°ï¼šN ä½é•¿åº¦çš„å“ˆå¸Œè¡¨å¯èƒ½å‘ç”Ÿç¢°æ’æµ‹è¯•æ¬¡æ•°ä¸æ˜¯ 2N æ¬¡è€Œæ˜¯åªæœ‰ 2N/2 æ¬¡ã€‚è¿™ä¸€ç»“è®ºè¢«åº”ç”¨åˆ°ç ´è§£å¯†ç å“ˆå¸Œå‡½æ•° (cryptographic hash function) çš„ â€œç”Ÿæ—¥æ”»å‡»â€ ä¸­ã€‚ ç”Ÿæ—¥é—®é¢˜æ‰€éšå«çš„ç†è®ºå·²ç»åœ¨ [Schnabel 1938] åå­—å«åš â€œæ ‡è®°é‡æ•æ³•â€ (capture-recapture) çš„ç»Ÿè®¡è¯•éªŒå¾—åˆ°åº”ç”¨ï¼Œæ¥ä¼°è®¡æ¹–é‡Œé±¼çš„æ•°é‡ã€‚ å·´æ‹¿èµ«-å¡”å°”æ–¯åŸºæ‚–è®º(åˆ†çƒå®šç†) æ•°å­¦ä¸­ï¼Œæœ‰ä¸€æ¡æå…¶åŸºæœ¬çš„å…¬ç†ï¼Œå«åšé€‰æ‹©å…¬ç†ï¼Œè®¸å¤šæ•°å­¦å†…å®¹éƒ½è¦åŸºäºè¿™æ¡å®šç†æ‰å¾—ä»¥æˆç«‹ã€‚ åœ¨1924å¹´ï¼Œæ•°å­¦å®¶æ–¯ç‰¹Â·å·´æ‹¿èµ«å’Œé˜¿å°”å¼—è±å¾·Â·å¡”æ–¯åŸºæ ¹æ®é€‰æ‹©å…¬ç†ï¼Œå¾—åˆ°ä¸€ä¸ªå¥‡æ€ªçš„æ¨è®ºâ€”â€”åˆ†çƒå®šç†ã€‚ è¯¥å®šç†æŒ‡å‡ºï¼Œä¸€ä¸ªä¸‰ç»´å®å¿ƒçƒåˆ†æˆæœ‰é™ä»½ï¼Œç„¶åå¯ä»¥æ ¹æ®æ—‹è½¬å’Œå¹³ç§»ï¼Œç»„æˆå’ŒåŸæ¥å®Œå…¨ç›¸åŒçš„ä¸¤ä¸ªå®å¿ƒçƒã€‚æ²¡é”™ï¼Œæ¯ä¸€ä¸ªå’ŒåŸæ¥çš„ä¸€æ¨¡ä¸€æ ·ã€‚ åˆ†çƒå®šç†å¤ªè¿åç›´è§‰ï¼Œä½†å®ƒå°±æ˜¯é€‰æ‹©å…¬ç†çš„ä¸¥æ ¼æ¨è®ºï¼Œè€Œä¸”ä¸å®¹ç½®ç–‘çš„ï¼Œé™¤éä½ æŠ›å¼ƒé€‰æ‹©å…¬ç†ï¼Œä½†æ•°å­¦å®¶ä¼šä¸ºæ­¤ä»˜å‡ºæ›´å¤§çš„ä»£ä»·ã€‚\nåœ¨ç°å®ç”Ÿæ´»ä¸­æˆ‘ä»¬æ²¡æœ‰ä»»ä½•åŠæ³•èƒ½å°†ä¸€ä¸ªç‰©ä½“å‡­ç©ºå¤åˆ¶æˆä¸¤ä¸ªã€‚ä½†äº‹å®ä¸Šä»–å´æ˜¯æˆç«‹çš„ï¼Œè¿™ä¸ªç»“æœä¼¼ä¹æŒ‘æˆ˜äº†ç‰©ç†ä¸­çš„è´¨é‡å®ˆæ’å®šå¾‹ï¼Œä½†ä¼¼ä¹åˆæ˜¯åœ¨è¯´ä¸€ä¸ªç‰©ä½“çš„è´¨é‡å¯ä»¥å‡­ç©ºå˜ä¸ºåŸæ¥çš„ä¸¤å€ï¼Ÿ ä½†å¦‚è‹¥åŸè´¨é‡æ˜¯æ— é™çš„è¯ï¼Œç¿»å€åè¿˜æ˜¯æ— é™å¤§ï¼Œé‚£ä¹ˆä»è¿™ä¸€å±‚é¢å‡ºå‘æ¥çœ‹è¿™ä¸€ç†è®ºä¹Ÿå¹¶æ²¡æœ‰æ‰“ç ´ç‰©ç†æ³•åˆ™ã€‚\næœ‰ä¸åŒå±‚æ¬¡çš„æ— ç©·å¤§(æ— ç©·å¤§ä¹Ÿæœ‰ç­‰çº§å¤§å°) ä½ å¯èƒ½ä»æ¥æƒ³è±¡ä¸åˆ°ï¼Œæœ‰ä¸€äº›æ— ç©·å¤§æ¯”å…¶ä»–çš„æ— ç©·æ›´å¤§ã€‚æ— ç©·å¤§åº”è¯¥è¢«ç§°ä¸ºåŸºæ•°ï¼Œå¹¶ä¸”ä¸€ä¸ªæ— ç©·å¤§å¦‚æœæ¯”å¦ä¸€ä¸ªæ— ç©·å¤§æ‹¥æœ‰æ›´å¤§çš„åŸºæ•°ï¼Œåˆ™è¯´å®ƒæ¯”å¦ä¸€ä¸ªæ— ç©·å¤§è¦å¤§ã€‚\nåœ¨äºŒåä¸–çºªä»¥å‰ï¼Œæ•°å­¦å®¶ä»¬é‡åˆ°æ— ç©·å¤§éƒ½é¿è€Œè®©ä¹‹ï¼Œè®¤ä¸ºè¦ä¹ˆå“ªé‡Œå‡ºäº†é—®é¢˜ï¼Œè¦ä¹ˆç»“æœæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ ç›´åˆ°1895å¹´ï¼Œåº·æ‰˜å°”å»ºç«‹è¶…ç©·æ•°ç†è®ºï¼Œäººä»¬æ‰å¾—çŸ¥æ— ç©·å¤§ä¹Ÿæ˜¯æœ‰ç­‰çº§çš„ï¼Œæ¯”å¦‚å®æ•°ä¸ªæ•°çš„æ— ç©·ï¼Œå°±æ¯”æ•´æ•°ä¸ªæ•°çš„æ— ç©·çš„ç­‰çº§é«˜ã€‚ è¿˜æœ‰è®¸å¤šå…³äºæ— ç©·å¤§çš„åŸºæ•°å¤§å¤§å‡ºä¹æˆ‘ä»¬çš„æ„æ–™ã€‚ä¸¾ä¸€ä¸ªéå¸¸ç»å…¸çš„ä¾‹å­ï¼šæ•´æ•°æ¯”å¥‡æ•°å¤šå—ï¼Ÿä½ å¯èƒ½ä¼šæ¯«ä¸çŠ¹è±«çš„å›ç­”ï¼Œé‚£æ˜¯å½“ç„¶ï¼ å› ä¸ºæ•´æ•°å¤šå‡ºäº†ä¸€ç³»åˆ—çš„å¶æ•°ã€‚ä½†ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œä»–ä»¬æ‹¥æœ‰ç›¸åŒçš„åŸºæ•°ï¼Œå› è€Œæ•´æ•°å¹¶ä¸æ¯”å¥‡æ•°å¤šã€‚çŸ¥é“äº†è¿™ä¸ªé“ç†ï¼Œå°±ä¸éš¾å›ç­”è¿™ä¸ªé—®é¢˜äº†å§ï¼šæœ‰ç†æ•°å¤šäºæ•´æ•°å—ï¼Ÿä¸ï¼Œæœ‰ç†æ•°ä¸æ•´æ•°ç›¸åŒå¤šã€‚ å®æ•°é€šå¸¸è¢«è®¤ä¸ºæ˜¯è¿ç»­ç»Ÿï¼Œå¹¶ä¸”è‡³ä»Šå¹¶èƒ½å®Œå…¨çŸ¥é“ï¼Œæ˜¯å¦æœ‰ä»‹äºæ•´æ•°åŸºæ•°å’Œè¿ç»­ç»ŸåŸºæ•°çš„æ— ç©·å¤§ï¼Ÿè¿™ä¸ªçŒœæƒ³è¢«ç§°ä¸ºè¿ç»­ç»ŸçŒœæƒ³ã€‚\nè¿™ä¹Ÿå¤ªè¿åç›´è§‰äº†ï¼Œæˆ‘ä»¬ä»æ¥ä¸æŠŠæ— ç©·å¤§å½“ä½œæ•°ï¼Œä½†æ˜¯æ— ç©·å¤§åœ¨è¶…ç©·æ•°ç†è®ºä¸­ï¼Œå´å­˜åœ¨ä¸åŒçš„ç­‰çº§ã€‚\nå“¥å¾·å°”ä¸å®Œå¤‡å®šç† â€œå¯è¯â€å’Œâ€œçœŸâ€ä¸æ˜¯ç­‰ä»·çš„ 1931å¹´ï¼Œå¥¥åœ°åˆ©æ•°å­¦å®¶å“¥å¾·å°”ï¼Œæå‡ºä¸€æ¡éœ‡æƒŠå­¦æœ¯ç•Œçš„å®šç†â€”â€”å“¥å¾·å°”ä¸å®Œå¤‡å®šç†ã€‚ è¯¥å®šç†æŒ‡å‡ºï¼Œæˆ‘ä»¬ç›®å‰çš„æ•°å­¦ç³»ç»Ÿä¸­ï¼Œå¿…å®šå­˜åœ¨ä¸èƒ½è¢«è¯æ˜ä¹Ÿä¸èƒ½è¢«è¯ä¼ªçš„å®šç†ã€‚è¯¥å®šç†ä¸€å‡ºï¼Œå°±ç²‰ç¢äº†æ•°å­¦å®¶å‡ åƒå¹´çš„æ¢¦æƒ³â€”â€”å³å»ºç«‹å®Œå–„çš„æ•°å­¦ç³»ç»Ÿï¼Œä»ä¸€äº›åŸºæœ¬çš„å…¬ç†å‡ºå‘ï¼Œæ¨å¯¼å‡ºä¸€åˆ‡æ•°å­¦çš„å®šç†å’Œå…¬å¼ã€‚\nå®ƒçš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š\nä»»ä½•ä¸€ä¸ªè¶³å¤Ÿå¼ºçš„ç³»ç»Ÿéƒ½å­˜åœ¨ä¸€ä¸ªå‘½é¢˜ï¼Œæ—¢ä¸èƒ½è¢«è¯æ˜ä¹Ÿä¸èƒ½è¢«è¯ä¼ªï¼ˆä¾‹å¦‚è¿ç»­ç»Ÿå‡è®¾ï¼‰ ä»»ä½•ä¸€ä¸ªè¶³å¤Ÿå¼ºçš„ç³»ç»Ÿéƒ½ä¸èƒ½è¯æ˜å®ƒè‡ªèº«æ˜¯ä¸æ¨å‡ºçŸ›ç›¾ï¼Œå³ä¾¿å®ƒä¸èƒ½è¢«æ¨å‡ºçŸ›ç›¾ ä»¥ä¸Šä¸¤æ¡å®šä¹‰å³è‘—åçš„å“¥å¾·å°”ä¸å®Œå¤‡å®šç†ã€‚ä»–çš„æ„ä¹‰å¹¶ä¸ä»…ä»…å±€é™äºæ•°å­¦ï¼Œä¹Ÿç»™äº†æˆ‘ä»¬æ·±æ·±åœ°å“²å­¦å¯è¿ªã€‚\nè’™æéœå°”é—®é¢˜ ä¸‰é—¨é—®é¢˜äº¦ç§°ä¸ºè’™æéœå°”é—®é¢˜ï¼Œå¤§è‡´å‡ºè‡ªç¾å›½çš„ç”µè§†æ¸¸æˆèŠ‚ç›®Let\u0026rsquo;s Make a Dealã€‚é—®é¢˜åå­—æ¥è‡ªè¯¥èŠ‚ç›®çš„ä¸»æŒäººè’™æÂ·éœå°”ã€‚ å‚èµ›è€…ä¼šçœ‹è§ä¸‰æ‰‡å…³é—­äº†çš„é—¨ï¼Œå…¶ä¸­ä¸€æ‰‡çš„åé¢æœ‰ä¸€è¾†æ±½è½¦ï¼Œé€‰ä¸­åé¢æœ‰è½¦çš„é‚£æ‰‡é—¨å¯èµ¢å¾—è¯¥æ±½è½¦ï¼Œå¦å¤–ä¸¤æ‰‡é—¨åé¢åˆ™å„è—æœ‰ä¸€åªå±±ç¾Šã€‚ å½“å‚èµ›è€…é€‰å®šäº†ä¸€æ‰‡é—¨ï¼Œä½†æœªå»å¼€å¯å®ƒçš„æ—¶å€™ï¼ŒèŠ‚ç›®ä¸»æŒäººå¼€å¯å‰©ä¸‹ä¸¤æ‰‡é—¨çš„å…¶ä¸­ä¸€æ‰‡ï¼Œéœ²å‡ºå…¶ä¸­ä¸€åªå±±ç¾Šã€‚ä¸»æŒäººå…¶åä¼šé—®å‚èµ›è€…è¦ä¸è¦æ¢å¦ä¸€æ‰‡ä»ç„¶å…³ä¸Šçš„é—¨ã€‚ é—®é¢˜æ˜¯ï¼šæ¢å¦ä¸€æ‰‡é—¨ä¼šå¦å¢åŠ å‚èµ›è€…èµ¢å¾—æ±½è½¦çš„æœºä¼šç‡ï¼Ÿ ä¸æ¢é—¨çš„è¯ï¼Œèµ¢å¾—æ±½è½¦çš„å‡ ç‡æ˜¯1/3ã€‚æ¢é—¨çš„è¯ï¼Œèµ¢å¾—æ±½è½¦çš„å‡ ç‡æ˜¯2/3ã€‚\nè¿™ä¸ªé—®é¢˜äº¦è¢«å«åšè’™æéœå°”æ‚–è®ºï¼šè™½ç„¶è¯¥é—®é¢˜çš„ç­”æ¡ˆåœ¨é€»è¾‘ä¸Šå¹¶ä¸è‡ªç›¸çŸ›ç›¾ï¼Œä½†ååˆ†è¿åç›´è§‰ã€‚\nå·´å¡å°”é—®é¢˜ å°†è‡ªç„¶æ•°å„è‡ªå¹³æ–¹å–å€’æ•°åŠ åœ¨ä¸€èµ·ç­‰äºÏ€Â²/6ã€‚ ä¸€èˆ¬äººéƒ½ä¼šè§‰å¾—ï¼Œå·¦è¾¹è¿™ä¸€å¨è‡ªç„¶æ•°ä¼¼ä¹å’ŒÏ€ï¼ˆåœ†çš„å‘¨é•¿ä¸ç›´å¾„çš„æ¯”å€¼ï¼‰ä¸ä¼šå­˜åœ¨ä»»ä½•è”ç³»ï¼ç„¶è€Œå®ƒå°±è¿™ä¹ˆå‘ç”Ÿäº†ï¼\né˜¿è´å°”ä¸å¯è§£å®šç† æ›¼å¾·å‹ƒç½—é›† å¾·å‹ƒç½—é›†æ˜¯ä¸€ä¸ªå¤æ•°é›†ï¼Œè€ƒè™‘å‡½æ•°f(z)=zÂ²+cï¼Œcä¸ºå¤å¸¸æ•°ï¼Œåœ¨è¿™ä¸ºå‚æ•°ã€‚ è‹¥ä»z=0å¼€å§‹ä¸æ–­çš„åˆ©ç”¨f(z)è¿›è¡Œè¿­ä»£ï¼Œåˆ™å‡¡æ˜¯ä½¿å¾—è¿­ä»£ç»“æœä¸ä¼šè·‘å‘æ— ç©·å¤§çš„cç»„æˆçš„é›†åˆè¢«ç§°ä¸ºæ›¼å¾·å‹ƒç½—é›†ã€‚è§„åˆ™ä¸å¤æ‚ï¼Œä½†ä½ å¯èƒ½æ²¡é¢„æ–™åˆ°ä¼šå¾—åˆ°è¿™ä¹ˆå¤æ‚çš„å›¾åƒã€‚ å½“ä½ æ”¾å¤§æ›¼å¾·å‹ƒç½—é›†æ—¶ï¼Œä½ ä¼šåˆå‘ç°æ— é™ä¸ªå°çš„æ›¼å¾·å‹ƒç½—é›†ï¼Œå…¶ä¸­æ¯ä¸ªåˆäº¦æ˜¯å¦‚æ­¤\u0026hellip;ï¼ˆè¿™ç§æ€§è´¨æ˜¯åˆ†å½¢æ‰€ç‰¹æœ‰çš„ï¼‰ è¿™çœŸçš„å¾ˆå¥‘åˆé‚£å¥ä¿—è¯â€œå¤§ä¸­æœ‰å¤§ï¼Œå°ä¸­æœ‰å°â€ï¼Œä¸‹é¢æœ‰ä¸€ä¸ªå…³äºæ”¾å¤§ä»–çš„è§†é¢‘ï¼Œæˆ‘æƒ³è¿™ç»å¯¹ä»¤äººå…´å¥‹ä¸å·²ã€‚ ä¸€ç»´å¯ä»¥å’ŒäºŒç»´ç”šè‡³æ›´é«˜ç»´åº¦ä¸€ä¸€å¯¹åº” æŒ‰ç…§æˆ‘ä»¬çš„å¸¸è¯†ï¼ŒäºŒç»´æ¯”ä¸€ç»´ç­‰çº§é«˜ï¼Œä¸‰ç»´æ¯”å››ç»´ç­‰çº§é«˜ï¼Œæ¯”å¦‚çº¿æ˜¯ä¸€ç»´çš„ï¼Œæ‰€ä»¥çº¿ä¸èƒ½ä¸€ä¸€å¯¹åº”äºé¢ç§¯ã€‚ ä½†äº‹å®å¹¶éå¦‚æ­¤ï¼Œåº·æ‰˜å°”è¯æ˜äº†ä¸€ç»´æ˜¯å¯ä»¥ä¸€ä¸€å¯¹åº”é«˜ç»´çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€æ¡çº¿ä¸Šçš„ç‚¹ï¼Œå¯ä»¥å’Œä¸€å—é¢ç§¯ç”šè‡³ä½“ç§¯çš„ç‚¹ä¸€ä¸€å¯¹åº”ï¼Œæˆ–è€…è¯´ä»–ä»¬åŒ…å«çš„ç‚¹ä¸€æ ·å¤šã€‚ è¯æ˜: åœ¨1890å¹´ï¼Œæ„å¤§åˆ©æ•°å­¦å®¶çš®äºšè¯ºï¼Œå°±å‘æ˜äº†ä¸€ä¸ªå‡½æ•°ï¼Œä½¿å¾—å‡½æ•°åœ¨å®è½´[0,1]ä¸Šçš„å–å€¼ï¼Œå¯ä»¥ä¸€ä¸€å¯¹åº”äºå•ä½æ­£æ–¹å½¢ä¸Šçš„æ‰€æœ‰ç‚¹ï¼Œè¿™æ¡æ›²çº¿å«åšçš®äºšè¯ºæ›²çº¿ã€‚ è¿™ä¸ªæ€§è´¨çš„å‘ç°ï¼Œæš—ç¤ºç€äººç±»å¯¹ç»´åº¦çš„ä¸»è§‚è®¤è¯†ï¼Œå¾ˆå¯èƒ½æ˜¯å­˜åœ¨ç¼ºé™·çš„ã€‚","title":"æ•°å­¦ä¸­çš„åå¤§æ‚–è®º"},{"content":"1. ä½è¿ç®—æ¦‚è¿° ä»ç°ä»£è®¡ç®—æœºä¸­æ‰€æœ‰çš„æ•°æ®äºŒè¿›åˆ¶çš„å½¢å¼å­˜å‚¨åœ¨è®¾å¤‡ä¸­ã€‚å³ 0ã€1 ä¸¤ç§çŠ¶æ€ï¼Œè®¡ç®—æœºå¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œçš„è¿ç®—(+ã€-ã€*ã€/)éƒ½æ˜¯å«ä½è¿ç®—ï¼Œå³å°†ç¬¦å·ä½å…±åŒå‚ä¸è¿ç®—çš„è¿ç®—ã€‚\n1 2 3 int a = 35; int b = 47; int c = a + b; å®é™…ä¸Šè¿ç®—å¦‚ä¸‹: è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œï¼Œå› ä¸ºåœ¨è®¡ç®—æœºä¸­éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶æ¥è¿›è¡Œè¿ç®—ï¼Œæ‰€ä»¥ä¸Šé¢æˆ‘ä»¬æ‰€ç»™çš„ int å˜é‡ä¼šåœ¨æœºå™¨å†…éƒ¨å…ˆè½¬æ¢ä¸ºäºŒè¿›åˆ¶åœ¨è¿›è¡Œç›¸åŠ ï¼š\n1 2 3 4 35: 0 0 1 0 0 0 1 1 47: 0 0 1 0 1 1 1 1 â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” 82: 0 1 0 1 0 0 1 0 æ‰€ä»¥ï¼Œç›¸æ¯”åœ¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨(+ã€-ã€*ã€/)è¿ç®—ç¬¦ï¼Œåˆç†çš„è¿ç”¨ä½è¿ç®—æ›´èƒ½æ˜¾è‘—æé«˜ä»£ç åœ¨æœºå™¨ä¸Šçš„æ‰§è¡Œæ•ˆç‡ã€‚\n2. ä½è¿ç®—æ¦‚è§ˆ 3. æŒ‰ä½ä¸è¿ç®—ç¬¦ å®šä¹‰ï¼šå‚åŠ è¿ç®—çš„ä¸¤ä¸ªæ•°æ®ï¼ŒæŒ‰äºŒè¿›åˆ¶ä½è¿›è¡Œ\u0026quot;ä¸\u0026quot;è¿ç®—ã€‚ è¿ç®—è§„åˆ™ï¼š\n1 0\u0026amp;0=0 0\u0026amp;1=0 1\u0026amp;0=0 1\u0026amp;1=1 ==æ€»ç»“ï¼šä¸¤ä½åŒæ—¶ä¸º1ï¼Œç»“æœæ‰ä¸º1ï¼Œå¦åˆ™ç»“æœä¸º0ã€‚==\nä¾‹å¦‚ï¼š3\u0026amp;5 å³ 0000 0011\u0026amp; 0000 0101 = 0000 0001ï¼Œå› æ­¤ 3\u0026amp;5 çš„å€¼å¾—1ã€‚ æ³¨æ„ï¼šè´Ÿæ•°æŒ‰è¡¥ç å½¢å¼å‚åŠ æŒ‰ä½ä¸è¿ç®—ã€‚\nä¸è¿ç®— \u0026amp; çš„ç”¨é€”ï¼š 1ï¼‰æ¸…é›¶ å¦‚æœæƒ³å°†ä¸€ä¸ªå•å…ƒæ¸…é›¶ï¼Œå³ä½¿å…¶å…¨éƒ¨äºŒè¿›åˆ¶ä½ä¸º0ï¼Œåªè¦ä¸ä¸€ä¸ªå„ä½éƒ½ä¸ºé›¶çš„æ•°å€¼ç›¸ä¸ï¼Œç»“æœä¸ºé›¶ã€‚\n2ï¼‰å–ä¸€ä¸ªæ•°çš„æŒ‡å®šä½ æ¯”å¦‚å–æ•° X=1010 1110 çš„ä½4ä½ï¼Œåªéœ€è¦å¦æ‰¾ä¸€ä¸ªæ•°Yï¼Œä»¤Yçš„ä½4ä½ä¸º1ï¼Œå…¶ä½™ä½ä¸º0ï¼Œå³Y=0000 1111ï¼Œç„¶åå°†Xä¸Yè¿›è¡ŒæŒ‰ä½ä¸è¿ç®—ï¼ˆX\u0026amp;Y=0000 1110ï¼‰å³å¯å¾—åˆ°Xçš„æŒ‡å®šä½ã€‚\n3ï¼‰åˆ¤æ–­å¥‡å¶ åªè¦æ ¹æ®æœ€æœªä½æ˜¯0è¿˜æ˜¯1æ¥å†³å®šï¼Œä¸º0å°±æ˜¯å¶æ•°ï¼Œä¸º1å°±æ˜¯å¥‡æ•°ã€‚å› æ­¤å¯ä»¥ç”¨if ((a \u0026amp; 1) == 0)ä»£æ›¿if (a % 2 == 0)æ¥åˆ¤æ–­aæ˜¯ä¸æ˜¯å¶æ•°ã€‚\n4. å¼‚æˆ–è¿ç®—ç¬¦ï¼ˆ^ï¼‰ å®šä¹‰ï¼šå‚åŠ è¿ç®—çš„ä¸¤ä¸ªæ•°æ®ï¼ŒæŒ‰äºŒè¿›åˆ¶ä½è¿›è¡Œ\u0026quot;å¼‚æˆ–\u0026quot;è¿ç®—ã€‚\n1 0^0=0 0^1=1 1^0=1 1^1=0 ==æ€»ç»“ï¼šå‚åŠ è¿ç®—çš„ä¸¤ä¸ªå¯¹è±¡ï¼Œå¦‚æœä¸¤ä¸ªç›¸åº”ä½ç›¸åŒä¸º0ï¼Œç›¸å¼‚ä¸º1ã€‚==\nå¼‚æˆ–çš„å‡ æ¡æ€§è´¨:\näº¤æ¢å¾‹ ç»“åˆå¾‹ (a^b)^c == a^(b^c) å¯¹äºä»»ä½•æ•°xï¼Œéƒ½æœ‰ x^x=0ï¼Œx^0=x è‡ªåæ€§: a^b^b=a^0=a; ä¸è¿ç®— ^ çš„ç”¨é€”ï¼š 1ï¼‰ç¿»è½¬æŒ‡å®šä½ æ¯”å¦‚å°†æ•° X=1010 1110 çš„ä½4ä½è¿›è¡Œç¿»è½¬ï¼Œåªéœ€è¦å¦æ‰¾ä¸€ä¸ªæ•°Yï¼Œä»¤Yçš„ä½4ä½ä¸º1ï¼Œå…¶ä½™ä½ä¸º0ï¼Œå³Y=0000 1111ï¼Œç„¶åå°†Xä¸Yè¿›è¡Œå¼‚æˆ–è¿ç®—ï¼ˆX^Y=1010 0001ï¼‰å³å¯å¾—åˆ°ã€‚\n2ï¼‰ä¸0ç›¸å¼‚æˆ–å€¼ä¸å˜ ä¾‹å¦‚ï¼š1010 1110 ^ 0000 0000 = 1010 1110\n3ï¼‰å¸¸è§æ“ä½œ\n1 2 3 4 5 6 7 a=0^a=a^0 0=a^a ç”±ä¸Šé¢ä¸¤ä¸ªæ¨å¯¼å‡ºï¼ša=a^b^b è·å–æœ€åä¸€ä¸ª 1 diff=(n\u0026amp;(n-1))^n 4ï¼‰ äº¤æ¢ä¸¤ä¸ªæ•°\n1 2 3 4 5 void swap(int \u0026amp;a, int \u0026amp;b) { a ^= b; b ^= a; a ^= b; } 5ï¼‰ n \u0026amp; n -1\n1 2 3 4 5 6 7 8 9 ç§»é™¤æœ€åä¸€ä¸ª 1 a=n\u0026amp;(n-1) # ç”¨ O(1) æ—¶é—´æ£€æµ‹æ•´æ•° n æ˜¯å¦æ˜¯ 2 çš„å¹‚æ¬¡ Nå¦‚æœæ˜¯2çš„å¹‚æ¬¡ï¼Œåˆ™Næ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ã€‚ 1.N \u0026gt;0 2.Nçš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­åªæœ‰ä¸€ä¸ª1 å› ä¸ºNçš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­åªæœ‰ä¸€ä¸ª1ï¼Œæ‰€ä»¥ä½¿ç”¨N \u0026amp; (N - 1)å°†Nå”¯ä¸€çš„ä¸€ä¸ª1æ¶ˆå»ï¼Œåº”è¯¥è¿”å›0ã€‚ 5. å·¦ç§»è¿ç®—ç¬¦ï¼ˆ\u0026laquo;ï¼‰ å®šä¹‰ï¼šå°†ä¸€ä¸ªè¿ç®—å¯¹è±¡çš„å„äºŒè¿›åˆ¶ä½å…¨éƒ¨å·¦ç§»è‹¥å¹²ä½ï¼ˆå·¦è¾¹çš„äºŒè¿›åˆ¶ä½ä¸¢å¼ƒï¼Œå³è¾¹è¡¥0ï¼‰ã€‚\nè®¾ a=1010 1110ï¼Œa = a\u0026laquo; 2 å°†açš„äºŒè¿›åˆ¶ä½å·¦ç§»2ä½ã€å³è¡¥0ï¼Œå³å¾—a=1011 1000ã€‚\nè‹¥å·¦ç§»æ—¶èˆå¼ƒçš„é«˜ä½ä¸åŒ…å«1ï¼Œåˆ™æ¯å·¦ç§»ä¸€ä½ï¼Œç›¸å½“äºè¯¥æ•°ä¹˜ä»¥2ã€‚\n6. å³ç§»è¿ç®—ç¬¦ï¼ˆ\u0026raquo;ï¼‰ å®šä¹‰ï¼šå°†ä¸€ä¸ªæ•°çš„å„äºŒè¿›åˆ¶ä½å…¨éƒ¨å³ç§»è‹¥å¹²ä½ï¼Œæ­£æ•°å·¦è¡¥0ï¼Œè´Ÿæ•°å·¦è¡¥1ï¼Œå³è¾¹ä¸¢å¼ƒã€‚\nä¾‹å¦‚ï¼ša=a\u0026raquo;2 å°†açš„äºŒè¿›åˆ¶ä½å³ç§»2ä½ï¼Œå·¦è¡¥0 æˆ–è€… å·¦è¡¥1å¾—çœ‹è¢«ç§»æ•°æ˜¯æ­£è¿˜æ˜¯è´Ÿã€‚\næ“ä½œæ•°æ¯å³ç§»ä¸€ä½ï¼Œç›¸å½“äºè¯¥æ•°é™¤ä»¥2ã€‚\nåº”ç”¨ ä½æ“ä½œç»Ÿè®¡äºŒè¿›åˆ¶ä¸­ 1 çš„ä¸ªæ•°\n1 2 3 4 5 count = 0 for a \u0026gt; 0{ a = a \u0026amp; (a - 1); count++; } ç”¨ä¸€ æ•°ç»„ä¸­ï¼Œåªæœ‰ä¸€ä¸ªæ•°å‡ºç°ä¸€æ¬¡ï¼Œå‰©ä¸‹éƒ½å‡ºç°ä¸¤æ¬¡ï¼Œæ‰¾å‡ºå‡ºç°ä¸€æ¬¡çš„æ•°\n1 a := a^b^b ","permalink":"https://reid00.github.io/en/posts/algo/%E5%B8%B8%E8%A7%81%E7%9A%84%E4%BA%8C%E8%BF%9B%E4%BD%8D%E8%BF%90%E7%AE%97%E6%8A%80%E5%B7%A7/","summary":"1. ä½è¿ç®—æ¦‚è¿° ä»ç°ä»£è®¡ç®—æœºä¸­æ‰€æœ‰çš„æ•°æ®äºŒè¿›åˆ¶çš„å½¢å¼å­˜å‚¨åœ¨è®¾å¤‡ä¸­ã€‚å³ 0ã€1 ä¸¤ç§çŠ¶æ€ï¼Œè®¡ç®—æœºå¯¹äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œçš„è¿ç®—(+ã€-ã€*ã€/)éƒ½æ˜¯å«ä½è¿ç®—ï¼Œå³å°†ç¬¦å·ä½å…±åŒå‚ä¸è¿ç®—çš„è¿ç®—ã€‚\n1 2 3 int a = 35; int b = 47; int c = a + b; å®é™…ä¸Šè¿ç®—å¦‚ä¸‹: è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œï¼Œå› ä¸ºåœ¨è®¡ç®—æœºä¸­éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶æ¥è¿›è¡Œè¿ç®—ï¼Œæ‰€ä»¥ä¸Šé¢æˆ‘ä»¬æ‰€ç»™çš„ int å˜é‡ä¼šåœ¨æœºå™¨å†…éƒ¨å…ˆè½¬æ¢ä¸ºäºŒè¿›åˆ¶åœ¨è¿›è¡Œç›¸åŠ ï¼š\n1 2 3 4 35: 0 0 1 0 0 0 1 1 47: 0 0 1 0 1 1 1 1 â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” 82: 0 1 0 1 0 0 1 0 æ‰€ä»¥ï¼Œç›¸æ¯”åœ¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨(+ã€-ã€*ã€/)è¿ç®—ç¬¦ï¼Œåˆç†çš„è¿ç”¨ä½è¿ç®—æ›´èƒ½æ˜¾è‘—æé«˜ä»£ç åœ¨æœºå™¨ä¸Šçš„æ‰§è¡Œæ•ˆç‡ã€‚\n2. ä½è¿ç®—æ¦‚è§ˆ 3. æŒ‰ä½ä¸è¿ç®—ç¬¦ å®šä¹‰ï¼šå‚åŠ è¿ç®—çš„ä¸¤ä¸ªæ•°æ®ï¼ŒæŒ‰äºŒè¿›åˆ¶ä½è¿›è¡Œ\u0026quot;ä¸\u0026quot;è¿ç®—ã€‚ è¿ç®—è§„åˆ™ï¼š\n1 0\u0026amp;0=0 0\u0026amp;1=0 1\u0026amp;0=0 1\u0026amp;1=1 ==æ€»ç»“ï¼šä¸¤ä½åŒæ—¶ä¸º1ï¼Œç»“æœæ‰ä¸º1ï¼Œå¦åˆ™ç»“æœä¸º0ã€‚==","title":"å¸¸è§çš„äºŒè¿›ä½è¿ç®—æŠ€å·§"},{"content":"èƒŒæ™¯ ä»Šå¤©ï¼ŒèŠä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼šæ‹”æ‰ç½‘çº¿å‡ ç§’ï¼Œå†æ’å›å»ï¼ŒåŸæœ¬çš„ TCP è¿æ¥è¿˜å­˜åœ¨å—ï¼Ÿ\nå¯èƒ½æœ‰çš„åŒå­¦ä¼šè¯´ï¼Œç½‘çº¿éƒ½è¢«æ‹”æ‰äº†ï¼Œé‚£è¯´æ˜ç‰©ç†å±‚è¢«æ–­å¼€äº†ï¼Œé‚£åœ¨ä¸Šå±‚çš„ä¼ è¾“å±‚ç†åº”ä¹Ÿä¼šæ–­å¼€ï¼Œæ‰€ä»¥åŸæœ¬çš„ TCP è¿æ¥å°±ä¸ä¼šå­˜åœ¨äº†ã€‚å°±å¥½åƒï¼Œ æˆ‘ä»¬æ‹¨æ‰“æœ‰çº¿ç”µè¯çš„æ—¶å€™ï¼Œå¦‚æœæŸä¸€æ–¹çš„ç”µè¯çº¿è¢«æ‹”äº†ï¼Œé‚£ä¹ˆæœ¬æ¬¡é€šè¯å°±å½»åº•æ–­äº†ã€‚\nçœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿ\nä¸Šé¢è¿™ä¸ªé€»è¾‘å°±æœ‰é—®é¢˜ã€‚é—®é¢˜åœ¨äºï¼Œé”™è¯¯åœ°è®¤ä¸ºæ‹”æ‰ç½‘çº¿è¿™ä¸ªåŠ¨ä½œä¼šå½±å“ä¼ è¾“å±‚ï¼Œäº‹å®ä¸Šå¹¶ä¸ä¼šå½±å“ã€‚\nå®é™…ä¸Šï¼ŒTCP è¿æ¥åœ¨ Linux å†…æ ¸ä¸­æ˜¯ä¸€ä¸ªåä¸º struct socket çš„ç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“çš„å†…å®¹åŒ…å« TCP è¿æ¥çš„çŠ¶æ€ç­‰ä¿¡æ¯ã€‚å½“æ‹”æ‰ç½‘çº¿çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿå¹¶ä¸ä¼šå˜æ›´è¯¥ç»“æ„ä½“çš„ä»»ä½•å†…å®¹ï¼Œæ‰€ä»¥ TCP è¿æ¥çš„çŠ¶æ€ä¹Ÿä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚\næˆ‘åœ¨æˆ‘çš„ç”µè„‘ä¸Šåšäº†ä¸ªå°å®éªŒï¼Œæˆ‘ç”¨ ssh ç»ˆç«¯è¿æ¥äº†æˆ‘çš„äº‘æœåŠ¡å™¨ï¼Œç„¶åæˆ‘é€šè¿‡æ–­å¼€ wifi çš„æ–¹å¼æ¥æ¨¡æ‹Ÿæ‹”æ‰ç½‘çº¿çš„åœºæ™¯ï¼Œæ­¤æ—¶æŸ¥çœ‹ TCP è¿æ¥çš„çŠ¶æ€æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œè¿˜æ˜¯å¤„äº ESTABLISHED çŠ¶æ€ã€‚ é€šè¿‡ä¸Šé¢è¿™ä¸ªå®éªŒç»“æœï¼Œæˆ‘ä»¬çŸ¥é“äº†ï¼Œæ‹”æ‰ç½‘çº¿è¿™ä¸ªåŠ¨ä½œå¹¶ä¸ä¼šå½±å“ TCP è¿æ¥çš„çŠ¶æ€ã€‚ æ¥ä¸‹æ¥ï¼Œè¦çœ‹æ‹”æ‰ç½‘çº¿åï¼ŒåŒæ–¹åšäº†ä»€ä¹ˆåŠ¨ä½œã€‚ é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œè¦åˆ†åœºæ™¯æ¥è®¨è®ºï¼š\næ‹”æ‰ç½‘çº¿åï¼Œæœ‰æ•°æ®ä¼ è¾“ï¼› æ‹”æ‰ç½‘çº¿åï¼Œæ²¡æœ‰æ•°æ®ä¼ è¾“ã€‚ æ‹”æ‰ç½‘çº¿åï¼Œæœ‰æ•°æ®ä¼ è¾“ åœ¨å®¢æˆ·ç«¯æ‹”æ‰ç½‘çº¿åï¼ŒæœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€çš„æ•°æ®æŠ¥æ–‡ä¼šå¾—ä¸åˆ°ä»»ä½•çš„å“åº”ï¼Œåœ¨ç­‰å¾…ä¸€å®šæ—¶é•¿åï¼ŒæœåŠ¡ç«¯å°±ä¼šè§¦å‘è¶…æ—¶é‡ä¼ æœºåˆ¶ï¼Œé‡ä¼ æœªå¾—åˆ°å“åº”çš„æ•°æ®æŠ¥æ–‡ã€‚\nå¦‚æœåœ¨æœåŠ¡ç«¯é‡ä¼ æŠ¥æ–‡çš„è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯åˆšå¥½æŠŠç½‘çº¿æ’å›å»äº†ï¼Œç”±äºæ‹”æ‰ç½‘çº¿å¹¶ä¸ä¼šæ”¹å˜å®¢æˆ·ç«¯çš„ TCP è¿æ¥çŠ¶æ€ï¼Œå¹¶ä¸”è¿˜æ˜¯å¤„äº ESTABLISHED çŠ¶æ€ï¼Œæ‰€ä»¥è¿™æ—¶å®¢æˆ·ç«¯æ˜¯å¯ä»¥æ­£å¸¸æ¥æ”¶æœåŠ¡ç«¯å‘æ¥çš„æ•°æ®æŠ¥æ–‡çš„ï¼Œç„¶åå®¢æˆ·ç«¯å°±ä¼šå› ACK å“åº”æŠ¥æ–‡ã€‚\næ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ TCP è¿æ¥ä¾ç„¶å­˜åœ¨ï¼Œå°±æ„Ÿè§‰ä»€ä¹ˆäº‹æƒ…éƒ½æ²¡æœ‰å‘ç”Ÿã€‚\nä½†æ˜¯ï¼Œå¦‚æœåœ¨æœåŠ¡ç«¯é‡ä¼ æŠ¥æ–‡çš„è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯ä¸€ç›´æ²¡æœ‰å°†ç½‘çº¿æ’å›å»ï¼ŒæœåŠ¡ç«¯è¶…æ—¶é‡ä¼ æŠ¥æ–‡çš„æ¬¡æ•°è¾¾åˆ°ä¸€å®šé˜ˆå€¼åï¼Œå†…æ ¸å°±ä¼šåˆ¤å®šå‡ºè¯¥ TCP æœ‰é—®é¢˜ï¼Œç„¶åé€šè¿‡ Socket æ¥å£å‘Šè¯‰åº”ç”¨ç¨‹åºè¯¥ TCP è¿æ¥å‡ºé—®é¢˜äº†ï¼Œäºæ˜¯æœåŠ¡ç«¯çš„ TCP è¿æ¥å°±ä¼šæ–­å¼€ã€‚\nè€Œç­‰å®¢æˆ·ç«¯æ’å›ç½‘çº¿åï¼Œå¦‚æœå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€äº†æ•°æ®ï¼Œç”±äºæœåŠ¡ç«¯å·²ç»æ²¡æœ‰ä¸å®¢æˆ·ç«¯ç›¸åŒå››å…ƒç»„çš„ TCP è¿æ¥äº†ï¼Œå› æ­¤æœåŠ¡ç«¯å†…æ ¸å°±ä¼šå›å¤ RST æŠ¥æ–‡ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°åå°±ä¼šé‡Šæ”¾è¯¥ TCP è¿æ¥ã€‚\næ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ TCP è¿æ¥éƒ½å·²ç»æ–­å¼€äº†ã€‚\né‚£ TCP çš„æ•°æ®æŠ¥æ–‡å…·ä½“é‡ä¼ å‡ æ¬¡å‘¢ï¼Ÿ åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæä¾›äº†ä¸€ä¸ªå« tcp_retries2 é…ç½®é¡¹ï¼Œé»˜è®¤å€¼æ˜¯ 15ï¼Œå¦‚ä¸‹ï¼š\n1 2 [root@nebula-server-6 shell]# cat /proc/sys/net/ipv4/tcp_retries2 15 è¿™ä¸ªå†…æ ¸å‚æ•°æ˜¯æ§åˆ¶ï¼Œåœ¨ TCP è¿æ¥å»ºç«‹çš„æƒ…å†µä¸‹ï¼Œè¶…æ—¶é‡ä¼ çš„æœ€å¤§æ¬¡æ•°ã€‚\nä¸è¿‡ tcp_retries2 è®¾ç½®äº† 15 æ¬¡ï¼Œå¹¶ä¸ä»£è¡¨ TCP è¶…æ—¶é‡ä¼ äº† 15 æ¬¡æ‰ä¼šé€šçŸ¥åº”ç”¨ç¨‹åºç»ˆæ­¢è¯¥ TCP è¿æ¥ï¼Œå†…æ ¸è¿˜ä¼šåŸºäºã€Œæœ€å¤§è¶…æ—¶æ—¶é—´ã€æ¥åˆ¤å®šã€‚\næ¯ä¸€è½®çš„è¶…æ—¶æ—¶é—´éƒ½æ˜¯å€æ•°å¢é•¿çš„ï¼Œæ¯”å¦‚ç¬¬ä¸€æ¬¡è§¦å‘è¶…æ—¶é‡ä¼ æ˜¯åœ¨ 2s åï¼Œç¬¬äºŒæ¬¡åˆ™æ˜¯åœ¨ 4s åï¼Œç¬¬ä¸‰æ¬¡åˆ™æ˜¯ 8s åï¼Œä»¥æ­¤ç±»æ¨ã€‚\nå†…æ ¸ä¼šæ ¹æ® tcp_retries2 è®¾ç½®çš„å€¼ï¼Œè®¡ç®—å‡ºä¸€ä¸ªæœ€å¤§è¶…æ—¶æ—¶é—´ã€‚\nåœ¨é‡ä¼ æŠ¥æ–‡ä¸”ä¸€ç›´æ²¡æœ‰æ”¶åˆ°å¯¹æ–¹å“åº”çš„æƒ…å†µæ—¶ï¼Œå…ˆè¾¾åˆ°ã€Œæœ€å¤§é‡ä¼ æ¬¡æ•°ã€æˆ–è€…ã€Œæœ€å¤§è¶…æ—¶æ—¶é—´ã€è¿™ä¸¤ä¸ªçš„å…¶ä¸­ä¸€ä¸ªæ¡ä»¶åï¼Œå°±ä¼šåœæ­¢é‡ä¼ ï¼Œç„¶åå°±ä¼šæ–­å¼€ TCP è¿æ¥ã€‚\næ‹”æ‰ç½‘çº¿åï¼Œæ²¡æœ‰æ•°æ®ä¼ è¾“ã€‚ é’ˆå¯¹æ‹”æ‰ç½‘çº¿åï¼Œæ²¡æœ‰æ•°æ®ä¼ è¾“çš„åœºæ™¯ï¼Œè¿˜å¾—çœ‹æ˜¯å¦å¼€å¯äº† TCP keepalive æœºåˆ¶ ï¼ˆTCP ä¿æ´»æœºåˆ¶ï¼‰ã€‚\nå¦‚æœæ²¡æœ‰å¼€å¯ TCP keepalive æœºåˆ¶ï¼Œåœ¨å®¢æˆ·ç«¯æ‹”æ‰ç½‘çº¿åï¼Œå¹¶ä¸”åŒæ–¹éƒ½æ²¡æœ‰è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ TCP è¿æ¥å°†ä¼šä¸€ç›´ä¿æŒå­˜åœ¨ã€‚\nè€Œå¦‚æœå¼€å¯äº† TCP keepalive æœºåˆ¶ï¼Œåœ¨å®¢æˆ·ç«¯æ‹”æ‰ç½‘çº¿åï¼Œå³ä½¿åŒæ–¹éƒ½æ²¡æœ‰è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œåœ¨æŒç»­ä¸€æ®µæ—¶é—´åï¼ŒTCP å°±ä¼šå‘é€æ¢æµ‹æŠ¥æ–‡ï¼š\nå¦‚æœå¯¹ç«¯æ˜¯æ­£å¸¸å·¥ä½œçš„ã€‚å½“ TCP ä¿æ´»çš„æ¢æµ‹æŠ¥æ–‡å‘é€ç»™å¯¹ç«¯ï¼Œå¯¹ç«¯ä¼šæ­£å¸¸å“åº”ï¼Œè¿™æ · TCP ä¿æ´»æ—¶é—´ä¼šè¢«é‡ç½®ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ª TCP ä¿æ´»æ—¶é—´çš„åˆ°æ¥ã€‚ å¦‚æœå¯¹ç«¯ä¸»æœºå´©æºƒï¼Œæˆ–å¯¹ç«¯ç”±äºå…¶ä»–åŸå› å¯¼è‡´æŠ¥æ–‡ä¸å¯è¾¾ã€‚å½“ TCP ä¿æ´»çš„æ¢æµ‹æŠ¥æ–‡å‘é€ç»™å¯¹ç«¯åï¼ŒçŸ³æ²‰å¤§æµ·ï¼Œæ²¡æœ‰å“åº”ï¼Œè¿ç»­å‡ æ¬¡ï¼Œè¾¾åˆ°ä¿æ´»æ¢æµ‹æ¬¡æ•°åï¼ŒTCP ä¼šæŠ¥å‘Šè¯¥ TCP è¿æ¥å·²ç»æ­»äº¡ã€‚ æ‰€ä»¥ï¼ŒTCP ä¿æ´»æœºåˆ¶å¯ä»¥åœ¨åŒæ–¹æ²¡æœ‰æ•°æ®äº¤äº’çš„æƒ…å†µï¼Œé€šè¿‡æ¢æµ‹æŠ¥æ–‡ï¼Œæ¥ç¡®å®šå¯¹æ–¹çš„ TCP è¿æ¥æ˜¯å¦å­˜æ´»ã€‚ TCP keepalive æœºåˆ¶å…·ä½“æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ è¿™ä¸ªæœºåˆ¶çš„åŸç†æ˜¯è¿™æ ·çš„ï¼š å®šä¹‰ä¸€ä¸ªæ—¶é—´æ®µï¼Œåœ¨è¿™ä¸ªæ—¶é—´æ®µå†…ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•è¿æ¥ç›¸å…³çš„æ´»åŠ¨ï¼ŒTCP ä¿æ´»æœºåˆ¶ä¼šå¼€å§‹ä½œç”¨ï¼Œæ¯éš”ä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œå‘é€ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡ï¼Œè¯¥æ¢æµ‹æŠ¥æ–‡åŒ…å«çš„æ•°æ®éå¸¸å°‘ï¼Œå¦‚æœè¿ç»­å‡ ä¸ªæ¢æµ‹æŠ¥æ–‡éƒ½æ²¡æœ‰å¾—åˆ°å“åº”ï¼Œåˆ™è®¤ä¸ºå½“å‰çš„ TCP è¿æ¥å·²ç»æ­»äº¡ï¼Œç³»ç»Ÿå†…æ ¸å°†é”™è¯¯ä¿¡æ¯é€šçŸ¥ç»™ä¸Šå±‚åº”ç”¨ç¨‹åºã€‚\nåœ¨ Linux å†…æ ¸æœ‰å¯¹åº”çš„å‚æ•°å¯ä»¥è®¾ç½®ä¿æ´»æ—¶é—´ã€ä¿æ´»æ¢æµ‹çš„æ¬¡æ•°ã€ä¿æ´»æ¢æµ‹çš„æ—¶é—´é—´éš”ï¼Œä»¥ä¸‹éƒ½ä¸ºé»˜è®¤å€¼ï¼š\n1 2 3 net.ipv4.tcp_keepalive_time=7200 net.ipv4.tcp_keepalive_intvl=75 net.ipv4.tcp_keepalive_probes=9 tcp_keepalive_time=7200ï¼šè¡¨ç¤ºä¿æ´»æ—¶é—´æ˜¯ 7200 ç§’ï¼ˆ2å°æ—¶ï¼‰ï¼Œä¹Ÿå°± 2 å°æ—¶å†…å¦‚æœæ²¡æœ‰ä»»ä½•è¿æ¥ç›¸å…³çš„æ´»åŠ¨ï¼Œåˆ™ä¼šå¯åŠ¨ä¿æ´»æœºåˆ¶ï¼› tcp_keepalive_intvl=75ï¼šè¡¨ç¤ºæ¯æ¬¡æ£€æµ‹é—´éš” 75 ç§’ï¼› tcp_keepalive_probes=9ï¼šè¡¨ç¤ºæ£€æµ‹ 9 æ¬¡æ— å“åº”ï¼Œè®¤ä¸ºå¯¹æ–¹æ˜¯ä¸å¯è¾¾çš„ï¼Œä»è€Œä¸­æ–­æœ¬æ¬¡çš„è¿æ¥ã€‚ ä¹Ÿå°±æ˜¯è¯´åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæœ€å°‘éœ€è¦ç»è¿‡ 2 å°æ—¶ 11 åˆ† 15 ç§’æ‰å¯ä»¥å‘ç°ä¸€ä¸ªã€Œæ­»äº¡ã€è¿æ¥ã€‚\ntcp_keepalive_time + tcp_keepalive_intvl * tcp_keepalive_probes ==\u0026gt; 7200 + 75 * 9 =7879s (2h11min15s)\næ³¨æ„ï¼Œåº”ç”¨ç¨‹åºè‹¥æƒ³ä½¿ç”¨ TCP ä¿æ´»æœºåˆ¶ï¼Œéœ€è¦é€šè¿‡ socket æ¥å£è®¾ç½® SO_KEEPALIVE é€‰é¡¹æ‰èƒ½å¤Ÿç”Ÿæ•ˆï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé‚£ä¹ˆå°±æ— æ³•ä½¿ç”¨ TCP ä¿æ´»æœºåˆ¶ã€‚\nTCP keepalive æœºåˆ¶æ¢æµ‹çš„æ—¶é—´ä¹Ÿå¤ªé•¿äº†å§ï¼Ÿ å¯¹çš„ï¼Œæ˜¯æœ‰ç‚¹é•¿ã€‚\nTCP keepalive æ˜¯ TCP å±‚ï¼ˆå†…æ ¸æ€ï¼‰ å®ç°çš„ï¼Œå®ƒæ˜¯ç»™æ‰€æœ‰åŸºäº TCP ä¼ è¾“åè®®çš„ç¨‹åºä¸€ä¸ªå…œåº•çš„æ–¹æ¡ˆã€‚\nå®é™…ä¸Šï¼Œæˆ‘ä»¬åº”ç”¨å±‚å¯ä»¥è‡ªå·±å®ç°ä¸€å¥—æ¢æµ‹æœºåˆ¶ï¼Œå¯ä»¥åœ¨è¾ƒçŸ­çš„æ—¶é—´å†…ï¼Œæ¢æµ‹åˆ°å¯¹æ–¹æ˜¯å¦å­˜æ´»ã€‚\næ¯”å¦‚ï¼Œweb æœåŠ¡è½¯ä»¶ä¸€èˆ¬éƒ½ä¼šæä¾› keepalive_timeout å‚æ•°ï¼Œç”¨æ¥æŒ‡å®š HTTP é•¿è¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœè®¾ç½®äº† HTTP é•¿è¿æ¥çš„è¶…æ—¶æ—¶é—´æ˜¯ 60 ç§’ï¼Œweb æœåŠ¡è½¯ä»¶å°±ä¼šå¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¦‚æœå®¢æˆ·ç«¯åœ¨å‘å®Œä¸€ä¸ª HTTP è¯·æ±‚åï¼Œåœ¨ 60 ç§’å†…éƒ½æ²¡æœ‰å†å‘èµ·æ–°çš„è¯·æ±‚ï¼Œå®šæ—¶å™¨çš„æ—¶é—´ä¸€åˆ°ï¼Œå°±ä¼šè§¦å‘å›è°ƒå‡½æ•°æ¥é‡Šæ”¾è¯¥è¿æ¥ã€‚ æ€»ç»“ å®¢æˆ·ç«¯æ‹”æ‰ç½‘çº¿åï¼Œå¹¶ä¸ä¼šç›´æ¥å½±å“ TCP è¿æ¥çŠ¶æ€ã€‚æ‰€ä»¥ï¼Œæ‹”æ‰ç½‘çº¿åï¼ŒTCP è¿æ¥æ˜¯å¦è¿˜ä¼šå­˜åœ¨ï¼Œå…³é”®è¦çœ‹æ‹”æ‰ç½‘çº¿ä¹‹åï¼Œæœ‰æ²¡æœ‰è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚\næœ‰æ•°æ®ä¼ è¾“çš„æƒ…å†µï¼š\nåœ¨å®¢æˆ·ç«¯æ‹”æ‰ç½‘çº¿åï¼Œå¦‚æœæœåŠ¡ç«¯å‘é€äº†æ•°æ®æŠ¥æ–‡ï¼Œé‚£ä¹ˆåœ¨æœåŠ¡ç«¯é‡ä¼ æ¬¡æ•°æ²¡æœ‰è¾¾åˆ°æœ€å¤§å€¼ä¹‹å‰ï¼Œå®¢æˆ·ç«¯å°±æ’å›äº†ç½‘çº¿ï¼Œé‚£ä¹ˆåŒæ–¹åŸæœ¬çš„ TCP è¿æ¥è¿˜æ˜¯èƒ½æ­£å¸¸å­˜åœ¨ï¼Œå°±å¥½åƒä»€ä¹ˆäº‹æƒ…éƒ½æ²¡æœ‰å‘ç”Ÿã€‚\nåœ¨å®¢æˆ·ç«¯æ‹”æ‰ç½‘çº¿åï¼Œå¦‚æœæœåŠ¡ç«¯å‘é€äº†æ•°æ®æŠ¥æ–‡ï¼Œåœ¨å®¢æˆ·ç«¯æ’å›ç½‘çº¿ä¹‹å‰ï¼ŒæœåŠ¡ç«¯é‡ä¼ æ¬¡æ•°è¾¾åˆ°äº†æœ€å¤§å€¼æ—¶ï¼ŒæœåŠ¡ç«¯å°±ä¼šæ–­å¼€ TCP è¿æ¥ã€‚ç­‰åˆ°å®¢æˆ·ç«¯æ’å›ç½‘çº¿åï¼Œå‘æœåŠ¡ç«¯å‘é€äº†æ•°æ®ï¼Œå› ä¸ºæœåŠ¡ç«¯å·²ç»æ–­å¼€äº†ä¸å®¢æˆ·ç«¯ç›¸åŒå››å…ƒç»„çš„ TCP è¿æ¥ï¼Œæ‰€ä»¥å°±ä¼šå› RST æŠ¥æ–‡ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°åå°±ä¼šæ–­å¼€ TCP è¿æ¥ã€‚è‡³æ­¤ï¼Œ åŒæ–¹çš„ TCP è¿æ¥éƒ½æ–­å¼€äº†ã€‚\næ²¡æœ‰æ•°æ®ä¼ è¾“çš„æƒ…å†µï¼š\nå¦‚æœåŒæ–¹éƒ½æ²¡æœ‰å¼€å¯ TCP keepalive æœºåˆ¶ï¼Œé‚£ä¹ˆåœ¨å®¢æˆ·ç«¯æ‹”æ‰ç½‘çº¿åï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸€ç›´ä¸æ’å›ç½‘çº¿ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ TCP è¿æ¥çŠ¶æ€å°†ä¼šä¸€ç›´ä¿æŒå­˜åœ¨ã€‚ å¦‚æœåŒæ–¹éƒ½å¼€å¯äº† TCP keepalive æœºåˆ¶ï¼Œé‚£ä¹ˆåœ¨å®¢æˆ·ç«¯æ‹”æ‰ç½‘çº¿åï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸€ç›´ä¸æ’å›ç½‘çº¿ï¼ŒTCP keepalive æœºåˆ¶ä¼šæ¢æµ‹åˆ°å¯¹æ–¹çš„ TCP è¿æ¥æ²¡æœ‰å­˜æ´»ï¼Œäºæ˜¯å°±ä¼šæ–­å¼€ TCP è¿æ¥ã€‚è€Œå¦‚æœåœ¨ TCP æ¢æµ‹æœŸé—´ï¼Œå®¢æˆ·ç«¯æ’å›äº†ç½‘çº¿ï¼Œé‚£ä¹ˆåŒæ–¹åŸæœ¬çš„ TCP è¿æ¥è¿˜æ˜¯èƒ½æ­£å¸¸å­˜åœ¨ã€‚ é™¤äº†å®¢æˆ·ç«¯æ‹”æ‰ç½‘çº¿çš„åœºæ™¯ï¼Œè¿˜æœ‰å®¢æˆ·ç«¯ã€Œå®•æœºå’Œæ€æ­»è¿›ç¨‹ã€çš„ä¸¤ç§åœºæ™¯ã€‚\nç¬¬ä¸€ä¸ªåœºæ™¯ï¼Œå®¢æˆ·ç«¯å®•æœºè¿™ä»¶äº‹è·Ÿæ‹”æ‰ç½‘çº¿æ˜¯ä¸€æ ·æ— æ³•è¢«æœåŠ¡ç«¯æ„ŸçŸ¥çš„ï¼Œæ‰€ä»¥å¦‚æœåœ¨æ²¡æœ‰æ•°æ®ä¼ è¾“ï¼Œå¹¶ä¸”æ²¡æœ‰å¼€å¯ TCP keepalive æœºåˆ¶æ—¶ï¼ŒæœåŠ¡ç«¯çš„ TCP è¿æ¥å°†ä¼šä¸€ç›´å¤„äº ESTABLISHED è¿æ¥çŠ¶æ€ï¼Œç›´åˆ°æœåŠ¡ç«¯é‡å¯è¿›ç¨‹ã€‚\næ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ä¸€ä¸ªç‚¹ã€‚åœ¨æ²¡æœ‰ä½¿ç”¨ TCP ä¿æ´»æœºåˆ¶ï¼Œä¸”åŒæ–¹ä¸ä¼ è¾“æ•°æ®çš„æƒ…å†µä¸‹ï¼Œä¸€æ–¹çš„ TCP è¿æ¥å¤„åœ¨ ESTABLISHED çŠ¶æ€æ—¶ï¼Œå¹¶ä¸ä»£è¡¨å¦ä¸€æ–¹çš„ TCP è¿æ¥è¿˜ä¸€å®šæ˜¯æ­£å¸¸çš„ã€‚\nç¬¬äºŒä¸ªåœºæ™¯ï¼Œæ€æ­»å®¢æˆ·ç«¯çš„è¿›ç¨‹åï¼Œå®¢æˆ·ç«¯çš„å†…æ ¸å°±ä¼šå‘æœåŠ¡ç«¯å‘é€ FIN æŠ¥æ–‡ï¼Œä¸å®¢æˆ·ç«¯è¿›è¡Œå››æ¬¡æŒ¥æ‰‹ã€‚\næ‰€ä»¥ï¼Œå³ä½¿æ²¡æœ‰å¼€å¯ TCP keepaliveï¼Œä¸”åŒæ–¹ä¹Ÿæ²¡æœ‰æ•°æ®äº¤äº’çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå…¶ä¸­ä¸€æ–¹çš„è¿›ç¨‹å‘ç”Ÿäº†å´©æºƒï¼Œè¿™ä¸ªè¿‡ç¨‹æ“ä½œç³»ç»Ÿæ˜¯å¯ä»¥æ„ŸçŸ¥å¾—åˆ°çš„ï¼Œäºæ˜¯å°±ä¼šå‘é€ FIN æŠ¥æ–‡ç»™å¯¹æ–¹ï¼Œç„¶åä¸å¯¹æ–¹è¿›è¡Œ TCP å››æ¬¡æŒ¥æ‰‹ã€‚\næ‰©å±• TCPé‡ç½®æŠ¥æ–‡æ®µåŠRSTå¸¸è§åœºæ™¯åˆ†æ RSTè¡¨ç¤ºè¿æ¥é‡ç½®ï¼Œç”¨äºå…³é—­é‚£äº›å·²ç»æ²¡æœ‰å¿…è¦ç»§ç»­å­˜åœ¨çš„è¿æ¥ã€‚ä¸€èˆ¬æƒ…å†µä¸‹è¡¨ç¤ºå¼‚å¸¸å…³é—­è¿æ¥ï¼ŒåŒºåˆ«ä¸å››æ¬¡åˆ†æ‰‹æ­£å¸¸å…³é—­è¿æ¥ã€‚\næˆ‘ä»¬çŸ¥é“TCPå»ºç«‹è¿æ¥çš„æ—¶å€™éœ€è¦ä¸‰æ¬¡è¿æ¥ï¼ŒTCPé‡Šæ”¾è¿æ¥çš„æ—¶å€™éœ€è¦å››æ¬¡æŒ¥æ‰‹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†å¾ˆå¤šç‰¹æ®Šçš„æ ‡å¿—æŠ¥æ–‡æ®µï¼Œä¾‹å¦‚SYN ACK FINï¼Œåœ¨TCPåè®®ä¸­ï¼Œé™¤äº†ä¸Šé¢è¯´äº†é‚£äº›æ ‡å¿—æŠ¥æ–‡æ®µä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„æŠ¥æ–‡æ®µï¼Œå¦‚PUSHæ ‡å¿—æŠ¥æ–‡æ®µä»¥åŠä»Šå¤©éœ€è¦é‡ç‚¹è®²è§£çš„RSTæŠ¥æ–‡æ®µã€‚\nRSTï¼šï¼ˆReset the connectionï¼‰ç”¨äºå¤ä½å› æŸç§åŸå› å¼•èµ·å‡ºç°çš„é”™è¯¯è¿æ¥ï¼Œä¹Ÿç”¨æ¥æ‹’ç»éæ³•æ•°æ®å’Œè¯·æ±‚ã€‚å¦‚æœæ¥æ”¶åˆ°RSTä½æ—¶å€™ï¼Œé€šå¸¸å‘ç”Ÿäº†æŸäº›é”™è¯¯ï¼›\nå‘é€RSTåŒ…å…³é—­è¿æ¥æ—¶ï¼Œä¸å¿…ç­‰ç¼“å†²åŒºçš„åŒ…éƒ½å‘å‡ºå»ï¼Œç›´æ¥å°±ä¸¢å¼ƒç¼“å†²åŒºä¸­çš„åŒ…ï¼Œå‘é€RSTï¼›æ¥æ”¶ç«¯æ”¶åˆ°RSTåŒ…åï¼Œä¹Ÿä¸å¿…å‘é€ACKåŒ…æ¥ç¡®è®¤ã€‚\nâ€œConnection resetâ€çš„åŸå› æ˜¯æœåŠ¡å™¨å…³é—­äº†Connection[è°ƒç”¨äº†Socket.close()æ–¹æ³•]ã€‚å¤§å®¶å¯èƒ½æœ‰ç–‘é—®äº†ï¼šæœåŠ¡å™¨å…³é—­äº†Connectionä¸ºä»€ä¹ˆä¼šè¿”å›â€œRSTâ€è€Œä¸æ˜¯è¿”å›â€œFINâ€æ ‡å¿—ã€‚åŸå› åœ¨äºSocket.close()æ–¹æ³•çš„è¯­ä¹‰å’ŒTCPçš„â€œFINâ€æ ‡å¿—è¯­ä¹‰ä¸ä¸€æ ·ï¼š å‘é€TCPçš„â€œFINâ€æ ‡å¿—è¡¨ç¤ºæˆ‘ä¸å†å‘é€æ•°æ®äº†ï¼Œè€ŒSocket.close()è¡¨ç¤ºæˆ‘ä¸åœ¨å‘é€ä¹Ÿä¸æ¥å—æ•°æ®äº†ã€‚é—®é¢˜å°±å‡ºåœ¨â€œæˆ‘ä¸æ¥å—æ•°æ®â€ ä¸Šï¼Œå¦‚æœæ­¤æ—¶å®¢æˆ·ç«¯è¿˜å¾€æœåŠ¡å™¨å‘é€æ•°æ®ï¼ŒæœåŠ¡å™¨å†…æ ¸æ¥æ”¶åˆ°æ•°æ®ï¼Œä½†æ˜¯å‘ç°æ­¤æ—¶Socketå·²ç»closeäº†ï¼Œåˆ™ä¼šè¿”å›â€œRSTâ€æ ‡å¿—ç»™å®¢æˆ·ç«¯ã€‚å½“ç„¶ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å°±ä¼šæç¤ºï¼šâ€œConnection resetâ€ã€‚\näº§ç”ŸRSTçš„ä¸‰ä¸ªæ¡ä»¶æ˜¯ï¼š\nç›®çš„åœ° ä¸ºæŸç«¯å£çš„SYNåˆ°è¾¾ï¼Œç„¶è€Œåœ¨è¯¥ç«¯å£ä¸Šå¹¶æ²¡æœ‰æ­£åœ¨ç›‘å¬çš„æœåŠ¡å™¨ï¼› TCPæƒ³å–æ¶ˆä¸€ä¸ªå·²æœ‰è¿æ¥ï¼› TCPæ¥æ”¶åˆ°ä¸€ä¸ªæ ¹æœ¬ä¸å­˜åœ¨çš„è¿æ¥ä¸Šçš„åˆ†èŠ‚ã€‚ Connection reset ä¸ Connection reset by peer æœåŠ¡å™¨è¿”å›äº† â€œRSTâ€ æ—¶ï¼Œå¦‚æœæ­¤æ—¶å®¢æˆ·ç«¯æ­£åœ¨ä» Socket å¥—æ¥å­—çš„è¾“å‡ºæµä¸­è¯»æ•°æ®åˆ™ä¼šæç¤º Connection reset ï¼› Aå‘Bå‘èµ·è¿æ¥ï¼Œä½†Bä¹‹ä¸Šå¹¶æœªç›‘å¬ç›¸åº”çš„ç«¯å£ï¼Œè¿™æ—¶Bæ“ä½œç³»ç»Ÿä¸Šçš„ TCP å¤„ç†ç¨‹åºä¼šå‘ RST åŒ…ã€‚\næœåŠ¡å™¨è¿”å›äº† â€œRSTâ€ æ—¶ï¼Œå¦‚æœæ­¤æ—¶å®¢æˆ·ç«¯æ­£åœ¨å¾€ Socket å¥—æ¥å­—çš„è¾“å…¥æµä¸­å†™æ•°æ®åˆ™ä¼šæç¤º Connection reset by peer ã€‚ ABæ­£å¸¸å»ºç«‹è¿æ¥äº†ï¼Œæ­£åœ¨é€šè®¯æ—¶ï¼ŒAå‘Bå‘é€äº†FINåŒ…è¦æ±‚å…³è¿æ¥ï¼ŒBå‘é€ACKåï¼Œç½‘æ–­äº†ï¼ŒAé€šè¿‡è‹¥å¹²åŸå› æ”¾å¼ƒäº†è¿™ä¸ªè¿æ¥ï¼ˆä¾‹å¦‚è¿›ç¨‹é‡å¯ï¼‰ã€‚ ç­‰ç½‘ç»œæ¢å¤ä¹‹åï¼ŒBåˆå¼€å§‹å‘æ•°æ®åŒ…ï¼ˆå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“ï¼ŒæœåŠ¡å™¨å·²ç»å¿˜è®°ä¸‰æ¬¡æ¡æ‰‹äº†ï¼‰ï¼ŒAæ”¶åˆ°åè¡¨ç¤ºå‹åŠ›å¾ˆå¤§ï¼Œä¸çŸ¥é“è¿™é‡è¿æ¥å“ªæ¥çš„ï¼Œå°±å‘äº†ä¸ªRSTåŒ…å¼ºåˆ¶æŠŠè¿æ¥å…³äº†ï¼ŒBæ”¶åˆ°åä¼šå‡ºç° connect reset by peer é”™è¯¯ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæœåŠ¡ç«¯æœ‰ä¸¤ç§æƒ…å†µä¸ä¼šå‘é€RSTï¼š\næœåŠ¡å™¨å…³æœºï¼š ä¼šæ–­å¼€ TCP è¿æ¥ï¼Œä¼šå‘é€ FIN æ•°æ®æŠ¥\næœåŠ¡å™¨ä¸»æœºå´©æºƒçš„çŠ¶æ€ å¦‚æœï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å·²ç»å»ºç«‹äº†è¿æ¥çš„æ—¶å€™ï¼Œæ­¤æ—¶æœåŠ¡å™¨å´©æºƒï¼ˆè¾¾åˆ°è¿™ä¸€æ ‡å‡†å¯ä»¥æŠŠæœåŠ¡å™¨çš„ç½‘çº¿æ‹”æ‰ï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒæœåŠ¡å™¨å°±ä¸èƒ½å‘é€ FIN æ•°æ®æŠ¥äº†ï¼Œå’Œå…³æœºä¸ä¸€æ ·çš„ï¼‰\næ­¤æ—¶å¦‚æœå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ•°æ®çš„æ—¶å€™ï¼Œå› ä¸ºæœåŠ¡å™¨å·²ç»ä¸å­˜åœ¨äº†ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å°±ä¸èƒ½æ¥å—åˆ°æœåŠ¡å™¨ç»™å®¢æˆ·ç«¯çš„ ack ä¿¡æ¯ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå®¢æˆ·ç«¯å»ºç«‹çš„æ˜¯ TCP è¿æ¥ï¼Œå°±ä¼šé‡å‘æ•°æ®æŠ¥ï¼Œå‘é€å¤šå°‘æ¬¡ä¹‹åå°±ä¼šè¿”å›è¶…æ—¶ï¼Œä¹Ÿå°±æ˜¯ ETIMEOUT ã€‚\nETIMEOUTï¼šå½“connectè°ƒç”¨çš„æ—¶å€™ä¼šè¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼Œå¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰æ”¶åˆ°æœåŠ¡å™¨å¯¹SYNçš„ACKæ•°æ®æŠ¥ï¼Œå°±ä¼šè¿”å›ETIMEOUTï¼ˆå®¢æˆ·ç«¯åœ¨è¿”å›è¿™ä¸ªé”™è¯¯ä¹‹å‰ä¼šé‡å‘SYNæ•°æ®æŠ¥ï¼‰\nå‰é¢è°ˆåˆ°äº†å¯¼è‡´ â€œConnection resetâ€ çš„åŸå› ï¼Œè€Œå…·ä½“çš„è§£å†³æ–¹æ¡ˆæœ‰å¦‚ä¸‹å‡ ç§ï¼š\nå‡ºé”™äº†é‡è¯•ï¼› å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç»Ÿä¸€ä½¿ç”¨TCPé•¿è¿æ¥ï¼› å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç»Ÿä¸€ä½¿ç”¨TCPçŸ­è¿æ¥ã€‚ é¦–å…ˆæ˜¯å‡ºé”™äº†é‡è¯•ï¼šè¿™ç§æ–¹æ¡ˆå¯ä»¥ç®€å•é˜²æ­¢ â€œConnection resetâ€ é”™è¯¯ï¼Œç„¶åå¦‚æœæœåŠ¡ä¸æ˜¯ â€œå¹‚ç­‰â€ çš„åˆ™ä¸èƒ½ä½¿ç”¨è¯¥æ–¹æ³•ï¼›æ¯”å¦‚æäº¤è®¢å•æ“ä½œå°±ä¸æ˜¯å¹‚ç­‰çš„ï¼Œå¦‚æœä½¿ç”¨é‡è¯•åˆ™å¯èƒ½é€ æˆé‡å¤æå•ã€‚\nç„¶åæ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç»Ÿä¸€ä½¿ç”¨ TCP é•¿è¿æ¥ï¼šå®¢æˆ·ç«¯ä½¿ç”¨ TCP é•¿è¿æ¥å¾ˆå®¹æ˜“é…ç½®ï¼ˆç›´æ¥è®¾ç½®HttpClientå°±å¥½ï¼‰ï¼Œè€ŒæœåŠ¡å™¨é…ç½®é•¿è¿æ¥å°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œå°±æ‹¿tomcatæ¥è¯´ï¼Œéœ€è¦è®¾ç½® tomcat çš„ maxKeepAliveRequests ã€connectionTimeout ç­‰å‚æ•°ã€‚å¦å¤–å¦‚æœä½¿ç”¨äº† nginx è¿›è¡Œåå‘ä»£ç†æˆ–è´Ÿè½½å‡è¡¡ï¼Œæ­¤æ—¶ä¹Ÿéœ€è¦é…ç½® nginx ä»¥æ”¯æŒé•¿è¿æ¥ï¼ˆnginxé»˜è®¤æ˜¯å¯¹å®¢æˆ·ç«¯ä½¿ç”¨é•¿è¿æ¥ï¼Œå¯¹æœåŠ¡å™¨ä½¿ç”¨çŸ­è¿æ¥ï¼Œè¯¦è§ keepalived ç›¸å…³æŒ‡ä»¤ï¼‰ã€‚\nä½¿ç”¨é•¿è¿æ¥å¯ä»¥é¿å…æ¯æ¬¡å»ºç«‹ TCP è¿æ¥çš„ä¸‰æ¬¡æ¡æ‰‹è€ŒèŠ‚çº¦ä¸€å®šçš„æ—¶é—´ï¼Œä½†æ˜¯æˆ‘è¿™è¾¹ç”±äºæ˜¯å†…ç½‘ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„ 3 æ¬¡æ¡æ‰‹å¾ˆå¿«ï¼Œå¤§çº¦åªéœ€1msã€‚pingä¸€ä¸‹å¤§çº¦0.93msï¼ˆä¸€æ¬¡å¾€è¿”ï¼‰ï¼›ä¸‰æ¬¡æ¡æ‰‹ä¹Ÿæ˜¯ä¸€æ¬¡å¾€è¿”ï¼ˆç¬¬ä¸‰æ¬¡æ¡æ‰‹ä¸ç”¨è¿”å›ï¼‰ã€‚æ ¹æ®80/20åŸç†ï¼Œ1mså¯ä»¥å¿½ç•¥ä¸è®¡ï¼›åˆè€ƒè™‘åˆ°é•¿è¿æ¥çš„æ‰©å±•æ€§ä¸å¦‚çŸ­è¿æ¥å¥½ã€ä¿®æ”¹nginxå’Œtomcatçš„é…ç½®ä»£ä»·å¾ˆå¤§ï¼ˆæ‰€æœ‰åå°æœåŠ¡éƒ½éœ€è¦ä¿®æ”¹ï¼‰ï¼›æ‰€ä»¥è¿™é‡Œå¹¶æ²¡æœ‰ä½¿ç”¨é•¿è¿æ¥ã€‚\nå°ç»“\nConnection resetï¼Œè¿œç¨‹ä¸»æœºæ²¡æœ‰ç›‘å¬è¿™ä¸ªç«¯å£ã€è¿æ¥ï¼Œå¯ä»¥æ˜¯ï¼š æœåŠ¡ç«¯å·²å…³é—­ï¼Œå®¢æˆ·ç«¯ä»æ—§è¯·æ±‚ï¼ŒæœåŠ¡ç«¯è¿”å›Rstï¼› æœåŠ¡ç«¯æœªç›‘å¬è¯¥ç«¯å£ï¼Œå®¢æˆ·ç«¯è¯·æ±‚ï¼ŒæœåŠ¡ç«¯è¿”å›Rstï¼› Connection reset by peerï¼Œæ˜¯è¿œç¨‹ä¸»æœºå¼ºè¿«å…³é—­äº†ä¸€ä¸ªç°æœ‰çš„è¿æ¥ï¼Œå¯ä»¥æ˜¯ï¼š å®¢æˆ·ç«¯æ–­ç½‘é‡è¿ï¼ŒæœåŠ¡ç«¯è¿”å›Rstï¼› æœåŠ¡ç«¯è¿›ç¨‹å´©æºƒåé‡å¯ï¼Œå‘å…ˆå‰çš„å®¢æˆ·ç«¯è¿”å›Rstï¼Œå¹¶ç­‰å¾…ä¸‹æ¬¡é‡æ–°ä¸å®¢æˆ·ç«¯å»ºè¿ï¼› ","permalink":"https://reid00.github.io/en/posts/os_network/%E6%8B%94%E6%8E%89%E7%BD%91%E7%BA%BF%E5%90%8E%E5%8E%9F%E6%9C%AC%E7%9A%84tcp%E8%BF%9E%E6%8E%A5%E8%BF%98%E5%AD%98%E5%9C%A8%E5%90%97/","summary":"èƒŒæ™¯ ä»Šå¤©ï¼ŒèŠä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼šæ‹”æ‰ç½‘çº¿å‡ ç§’ï¼Œå†æ’å›å»ï¼ŒåŸæœ¬çš„ TCP è¿æ¥è¿˜å­˜åœ¨å—ï¼Ÿ\nå¯èƒ½æœ‰çš„åŒå­¦ä¼šè¯´ï¼Œç½‘çº¿éƒ½è¢«æ‹”æ‰äº†ï¼Œé‚£è¯´æ˜ç‰©ç†å±‚è¢«æ–­å¼€äº†ï¼Œé‚£åœ¨ä¸Šå±‚çš„ä¼ è¾“å±‚ç†åº”ä¹Ÿä¼šæ–­å¼€ï¼Œæ‰€ä»¥åŸæœ¬çš„ TCP è¿æ¥å°±ä¸ä¼šå­˜åœ¨äº†ã€‚å°±å¥½åƒï¼Œ æˆ‘ä»¬æ‹¨æ‰“æœ‰çº¿ç”µè¯çš„æ—¶å€™ï¼Œå¦‚æœæŸä¸€æ–¹çš„ç”µè¯çº¿è¢«æ‹”äº†ï¼Œé‚£ä¹ˆæœ¬æ¬¡é€šè¯å°±å½»åº•æ–­äº†ã€‚\nçœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿ\nä¸Šé¢è¿™ä¸ªé€»è¾‘å°±æœ‰é—®é¢˜ã€‚é—®é¢˜åœ¨äºï¼Œé”™è¯¯åœ°è®¤ä¸ºæ‹”æ‰ç½‘çº¿è¿™ä¸ªåŠ¨ä½œä¼šå½±å“ä¼ è¾“å±‚ï¼Œäº‹å®ä¸Šå¹¶ä¸ä¼šå½±å“ã€‚\nå®é™…ä¸Šï¼ŒTCP è¿æ¥åœ¨ Linux å†…æ ¸ä¸­æ˜¯ä¸€ä¸ªåä¸º struct socket çš„ç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“çš„å†…å®¹åŒ…å« TCP è¿æ¥çš„çŠ¶æ€ç­‰ä¿¡æ¯ã€‚å½“æ‹”æ‰ç½‘çº¿çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿå¹¶ä¸ä¼šå˜æ›´è¯¥ç»“æ„ä½“çš„ä»»ä½•å†…å®¹ï¼Œæ‰€ä»¥ TCP è¿æ¥çš„çŠ¶æ€ä¹Ÿä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚\næˆ‘åœ¨æˆ‘çš„ç”µè„‘ä¸Šåšäº†ä¸ªå°å®éªŒï¼Œæˆ‘ç”¨ ssh ç»ˆç«¯è¿æ¥äº†æˆ‘çš„äº‘æœåŠ¡å™¨ï¼Œç„¶åæˆ‘é€šè¿‡æ–­å¼€ wifi çš„æ–¹å¼æ¥æ¨¡æ‹Ÿæ‹”æ‰ç½‘çº¿çš„åœºæ™¯ï¼Œæ­¤æ—¶æŸ¥çœ‹ TCP è¿æ¥çš„çŠ¶æ€æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œè¿˜æ˜¯å¤„äº ESTABLISHED çŠ¶æ€ã€‚ é€šè¿‡ä¸Šé¢è¿™ä¸ªå®éªŒç»“æœï¼Œæˆ‘ä»¬çŸ¥é“äº†ï¼Œæ‹”æ‰ç½‘çº¿è¿™ä¸ªåŠ¨ä½œå¹¶ä¸ä¼šå½±å“ TCP è¿æ¥çš„çŠ¶æ€ã€‚ æ¥ä¸‹æ¥ï¼Œè¦çœ‹æ‹”æ‰ç½‘çº¿åï¼ŒåŒæ–¹åšäº†ä»€ä¹ˆåŠ¨ä½œã€‚ é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œè¦åˆ†åœºæ™¯æ¥è®¨è®ºï¼š\næ‹”æ‰ç½‘çº¿åï¼Œæœ‰æ•°æ®ä¼ è¾“ï¼› æ‹”æ‰ç½‘çº¿åï¼Œæ²¡æœ‰æ•°æ®ä¼ è¾“ã€‚ æ‹”æ‰ç½‘çº¿åï¼Œæœ‰æ•°æ®ä¼ è¾“ åœ¨å®¢æˆ·ç«¯æ‹”æ‰ç½‘çº¿åï¼ŒæœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€çš„æ•°æ®æŠ¥æ–‡ä¼šå¾—ä¸åˆ°ä»»ä½•çš„å“åº”ï¼Œåœ¨ç­‰å¾…ä¸€å®šæ—¶é•¿åï¼ŒæœåŠ¡ç«¯å°±ä¼šè§¦å‘è¶…æ—¶é‡ä¼ æœºåˆ¶ï¼Œé‡ä¼ æœªå¾—åˆ°å“åº”çš„æ•°æ®æŠ¥æ–‡ã€‚\nå¦‚æœåœ¨æœåŠ¡ç«¯é‡ä¼ æŠ¥æ–‡çš„è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯åˆšå¥½æŠŠç½‘çº¿æ’å›å»äº†ï¼Œç”±äºæ‹”æ‰ç½‘çº¿å¹¶ä¸ä¼šæ”¹å˜å®¢æˆ·ç«¯çš„ TCP è¿æ¥çŠ¶æ€ï¼Œå¹¶ä¸”è¿˜æ˜¯å¤„äº ESTABLISHED çŠ¶æ€ï¼Œæ‰€ä»¥è¿™æ—¶å®¢æˆ·ç«¯æ˜¯å¯ä»¥æ­£å¸¸æ¥æ”¶æœåŠ¡ç«¯å‘æ¥çš„æ•°æ®æŠ¥æ–‡çš„ï¼Œç„¶åå®¢æˆ·ç«¯å°±ä¼šå› ACK å“åº”æŠ¥æ–‡ã€‚\næ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ TCP è¿æ¥ä¾ç„¶å­˜åœ¨ï¼Œå°±æ„Ÿè§‰ä»€ä¹ˆäº‹æƒ…éƒ½æ²¡æœ‰å‘ç”Ÿã€‚\nä½†æ˜¯ï¼Œå¦‚æœåœ¨æœåŠ¡ç«¯é‡ä¼ æŠ¥æ–‡çš„è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯ä¸€ç›´æ²¡æœ‰å°†ç½‘çº¿æ’å›å»ï¼ŒæœåŠ¡ç«¯è¶…æ—¶é‡ä¼ æŠ¥æ–‡çš„æ¬¡æ•°è¾¾åˆ°ä¸€å®šé˜ˆå€¼åï¼Œå†…æ ¸å°±ä¼šåˆ¤å®šå‡ºè¯¥ TCP æœ‰é—®é¢˜ï¼Œç„¶åé€šè¿‡ Socket æ¥å£å‘Šè¯‰åº”ç”¨ç¨‹åºè¯¥ TCP è¿æ¥å‡ºé—®é¢˜äº†ï¼Œäºæ˜¯æœåŠ¡ç«¯çš„ TCP è¿æ¥å°±ä¼šæ–­å¼€ã€‚\nè€Œç­‰å®¢æˆ·ç«¯æ’å›ç½‘çº¿åï¼Œå¦‚æœå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€äº†æ•°æ®ï¼Œç”±äºæœåŠ¡ç«¯å·²ç»æ²¡æœ‰ä¸å®¢æˆ·ç«¯ç›¸åŒå››å…ƒç»„çš„ TCP è¿æ¥äº†ï¼Œå› æ­¤æœåŠ¡ç«¯å†…æ ¸å°±ä¼šå›å¤ RST æŠ¥æ–‡ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°åå°±ä¼šé‡Šæ”¾è¯¥ TCP è¿æ¥ã€‚\næ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ TCP è¿æ¥éƒ½å·²ç»æ–­å¼€äº†ã€‚\né‚£ TCP çš„æ•°æ®æŠ¥æ–‡å…·ä½“é‡ä¼ å‡ æ¬¡å‘¢ï¼Ÿ åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œæä¾›äº†ä¸€ä¸ªå« tcp_retries2 é…ç½®é¡¹ï¼Œé»˜è®¤å€¼æ˜¯ 15ï¼Œå¦‚ä¸‹ï¼š","title":"æ‹”æ‰ç½‘çº¿å,åŸæœ¬çš„TCPè¿æ¥è¿˜å­˜åœ¨å—ï¼Ÿ"},{"content":"å®‰è£… Utterances é¦–å…ˆè¦æœ‰ä¸€ä¸ª GitHub ä»“åº“ã€‚å¦‚æœæ˜¯ç”¨ GitHub Page æ‰˜ç®¡ç½‘ç«™å°±å¯ä»¥ä¸éœ€è¦é¢å¤–åˆ›å»ºï¼Œå°±ç”¨ä½ çš„GitHub Page repositroy å¦‚:.github.io ä»“åº“, å½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±é‡æ–°åˆ›å»ºä¸€ä¸ªï¼Œç”¨æ¥å­˜æ”¾è¯„è®ºã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªä»“åº“å¿…é¡»æ˜¯Public çš„ã€‚ æ¯”å¦‚æˆ‘çš„ä¸ºhttps://github.com/Reid00/hugo-blog-talks\nç„¶åå» https://github.com/apps/utterances å®‰è£… utterancesã€‚\nåœ¨æ‰“å¼€çš„é¡µé¢ä¸­é€‰æ‹©Only select repositoriesï¼Œå¹¶åœ¨ä¸‹æ‹‰æ¡†ä¸­é€‰æ‹©è‡ªå·±çš„åšå®¢ä»“åº“ï¼ˆæ¯”å¦‚æˆ‘å°±æ˜¯ Reid00/hugo-blog-talksï¼Œä¹Ÿå¯ä»¥å®‰è£…åˆ°å…¶ä»–ä»“åº“, ä¹Ÿå¯ä»¥æ‰€æœ‰ä»“åº“ï¼Œä½†æ˜¯ä¸æ¨èï¼‰ï¼Œç„¶åç‚¹å‡» Installã€‚ é…ç½®Hugo å¤åˆ¶ä»¥ä¸‹ä»£ç ï¼Œrepo è¦ä¿®æ”¹æˆè‡ªå·±çš„ä»“åº“ï¼Œrepo ä¸ºä½ å­˜æ”¾è¯„è®ºçš„ä»“åº“ã€‚\n1 2 3 4 5 6 7 8 \u0026lt;script src=\u0026#34;https://utteranc.es/client.js\u0026#34; repo=\u0026#34;Reid00/hugo-blog-talks\u0026#34; issue-term=\u0026#34;pathname\u0026#34; label=\u0026#34;Comment\u0026#34; theme=\u0026#34;github-light\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; async\u0026gt; \u0026lt;/script\u0026gt; åœ¨ä¸»é¢˜é…ç½®ç›®å½•ä¸‹åˆ›å»º layouts/partials/comments.html æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä¸Šè¿°å†…å®¹\n1 2 3 4 5 6 7 8 9 10 11 {{- /* Comments area start */ -}} {{- /* to add comments read =\u0026gt; https://gohugo.io/content-management/comments/ */ -}} \u0026lt;script src=\u0026#34;https://utteranc.es/client.js\u0026#34; repo=\u0026#34;Reid00/hugo-blog-talks\u0026#34; issue-term=\u0026#34;pathname\u0026#34; label=\u0026#34;Comment\u0026#34; theme=\u0026#34;github-light\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; async\u0026gt; \u0026lt;/script\u0026gt; {{- /* Comments area end */ -}} ç„¶åæ ¹æ® PaperMod æ–‡æ¡£ï¼Œæ‰“å¼€ config.yml æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹\n1 2 params: comments: true é—®é¢˜ å¦‚æœä½ ç”¨GitHub Action éƒ¨ç½²çš„GitHub Page, å¹¶ä¸”ä½ çš„workflow é‡Œé¢å†™äº†\n1 2 3 4 5 - name: Check out repository code uses: actions/checkout@v3 with: submodules: recursive # Fetch Hugo themes (true OR recursive) fetch-depth: 0 è¿™ä¸ªæ—¶å€™ï¼Œtheme ä¸»é¢˜ä¼šè‡ªåŠ¨pull æºä¸»é¢˜çš„repoï¼Œè¦†ç›–layouts/partials/comments.html æ–‡ä»¶ï¼Œ æ­¤æ—¶ï¼Œä½ å¯ä»¥åœ¨é¡¹ç›®çš„layouts åˆ›å»ºæ”¹æ–‡ä»¶å’Œå†…å®¹å³å¯ã€‚\n","permalink":"https://reid00.github.io/en/posts/other/utterances-%E7%BB%99-hugo-papermod-%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F/","summary":"å®‰è£… Utterances é¦–å…ˆè¦æœ‰ä¸€ä¸ª GitHub ä»“åº“ã€‚å¦‚æœæ˜¯ç”¨ GitHub Page æ‰˜ç®¡ç½‘ç«™å°±å¯ä»¥ä¸éœ€è¦é¢å¤–åˆ›å»ºï¼Œå°±ç”¨ä½ çš„GitHub Page repositroy å¦‚:.github.io ä»“åº“, å½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±é‡æ–°åˆ›å»ºä¸€ä¸ªï¼Œç”¨æ¥å­˜æ”¾è¯„è®ºã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªä»“åº“å¿…é¡»æ˜¯Public çš„ã€‚ æ¯”å¦‚æˆ‘çš„ä¸ºhttps://github.com/Reid00/hugo-blog-talks\nç„¶åå» https://github.com/apps/utterances å®‰è£… utterancesã€‚\nåœ¨æ‰“å¼€çš„é¡µé¢ä¸­é€‰æ‹©Only select repositoriesï¼Œå¹¶åœ¨ä¸‹æ‹‰æ¡†ä¸­é€‰æ‹©è‡ªå·±çš„åšå®¢ä»“åº“ï¼ˆæ¯”å¦‚æˆ‘å°±æ˜¯ Reid00/hugo-blog-talksï¼Œä¹Ÿå¯ä»¥å®‰è£…åˆ°å…¶ä»–ä»“åº“, ä¹Ÿå¯ä»¥æ‰€æœ‰ä»“åº“ï¼Œä½†æ˜¯ä¸æ¨èï¼‰ï¼Œç„¶åç‚¹å‡» Installã€‚ é…ç½®Hugo å¤åˆ¶ä»¥ä¸‹ä»£ç ï¼Œrepo è¦ä¿®æ”¹æˆè‡ªå·±çš„ä»“åº“ï¼Œrepo ä¸ºä½ å­˜æ”¾è¯„è®ºçš„ä»“åº“ã€‚\n1 2 3 4 5 6 7 8 \u0026lt;script src=\u0026#34;https://utteranc.es/client.js\u0026#34; repo=\u0026#34;Reid00/hugo-blog-talks\u0026#34; issue-term=\u0026#34;pathname\u0026#34; label=\u0026#34;Comment\u0026#34; theme=\u0026#34;github-light\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; async\u0026gt; \u0026lt;/script\u0026gt; åœ¨ä¸»é¢˜é…ç½®ç›®å½•ä¸‹åˆ›å»º layouts/partials/comments.html æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä¸Šè¿°å†…å®¹\n1 2 3 4 5 6 7 8 9 10 11 {{- /* Comments area start */ -}} {{- /* to add comments read =\u0026gt; https://gohugo.","title":"Utterances ç»™ Hugo PaperMod ä¸»é¢˜æ·»åŠ è¯„è®ºç³»ç»Ÿ"},{"content":"å‡†å¤‡vscode æ’ä»¶ åœ¨vs codeçš„æ‰©å±•å•†åº—ä¸­æœç´¢remote-ssh, install é…ç½®remmote-ssh æ’ä»¶ ä½¿ç”¨å¿«æ·ç‚¹, ctrl + shift + P è¾“å…¥config é€‰æ‹©ç¬¬ä¸€ä¸ªï¼Œåœ¨.ssh ç›®å½•çš„configæ–‡ä»¶ æŒ‰ç…§ä»¥ä¸‹æ ¼å¼é…ç½®\n1 2 3 4 5 Host Personal HostName 172.16.1.1 User root Port 22 IdentityFile C:\\Users\\ld\\.ssh\\id_rsa Host: è‡ªå®šä¹‰çš„æœåŠ¡å™¨åç§°ï¼Œç”¨äºä¸ªäººåŒºåˆ† HostName: éœ€è¦è¿œç¨‹çš„æœåŠ¡å™¨çš„IP åœ°å€ User: è¿œç¨‹æœåŠ¡å™¨ç”¨çš„è´¦å· Port: é»˜è®¤ssh ç«¯å£22 IdentityFile: å…ç™»å½•çš„id_rsaè·¯å¾„ æ³¨æ„: å¤šæ¬¡å®éªŒåŠ å…¥IdentityFile éƒ½ä¸èƒ½åšåˆ°é€šè¿‡è·³æ¿æœºå…å¯†ç ï¼Œæœ€åæŠŠå®¢æˆ·æœºçš„id_rsa.pubæ·»åŠ åˆ°target æ‰å…å¯†ï¼Œ ç›¸å½“äºç›´æ¥å¯ä»¥è¿æ¥targetæœºå™¨äº†ã€‚\nå¦‚æœé€šè¿‡è·³æ¿æœºè¿æ¥æœåŠ¡å™¨ æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦è·³æ¿æœºæ¥è¿æ¥æœåŠ¡å™¨ï¼Œä¹Ÿå³å…ˆè¿æ¥ä¸€å°è·³æ¿æœºæœåŠ¡å™¨ï¼Œç„¶åé€šè¿‡è¿™å°è·³æ¿æœºæ‰€åœ¨çš„å†…ç½‘å†æ¬¡è·³è½¬åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚ æœ€ç®€å•çš„åšæ³•å°±æ˜¯æŒ‰ä¸Šè¿°æ–¹æ³•è¿æ¥åˆ°è·³æ¿æœºï¼Œç„¶ååœ¨è·³æ¿æœºçš„ç»ˆç«¯ç”¨sshæŒ‡ä»¤è·³è½¬åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä½†è¿™æ ·è·³è½¬åï¼Œæˆ‘ä»¬æ— æ³•åœ¨VScodeä¸­æ‰“å¼€æœåŠ¡å™¨çš„æ–‡ä»¶ç›®å½•ï¼Œæ“ä½œèµ·æ¥å¾ˆä¸æ–¹ä¾¿ã€‚æˆ‘ä»¬å¯ä»¥æŠŠconfigçš„è®¾ç½®æ”¹æˆå¦‚ä¸‹ï¼Œå°±å¯ä»¥é€šè¿‡c00è·³æ¿æœºè·³è½¬åˆ°c01äº†\n1 2 3 4 5 6 Host BackupCluster HostName 1.16.1.1 User root Port 22 ProxyCommand C:\\Windows\\System32\\OpenSSH\\ssh.exe -W %h:%p -q Personal IdentityFile C:\\Users\\ld\\.ssh\\id_rsa ProxyCommand: opensshçš„å®‰è£…ç›®å½•ï¼ˆæˆ‘è¿™é‡Œæ˜¯C:\\Windows\\System32\\OpenSSH\\ssh.exeï¼‰ -Wè¡¨ç¤ºstdio forwardingæ¨¡å¼ æ¥ç€åé¢çš„%hæ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œè¡¨ç¤ºè¦è¿æ¥çš„ç›®æ ‡æœº,ä¹Ÿå°±æ˜¯HostnameæŒ‡å®šçš„ipæˆ–è€…ä¸»æœºå %påŒæ ·ä¹Ÿæ˜¯å ä½ç¬¦ï¼Œè¡¨ç¤ºè¦è¿æ¥åˆ°ç›®æ ‡æœºçš„ç«¯å£ã€‚ %h, %pè¿™é‡Œå¯ä»¥ç›´æ¥å†™æ­»å›ºå®šå€¼ï¼Œä½†æ˜¯ä½¿ç”¨%hå’Œ%på¯ä»¥ä¿è¯åœ¨Hostnameå’ŒPortå˜åŒ–çš„æƒ…å†µä¸‹ProxyCommandè¿™è¡Œä¸ç”¨è·Ÿç€å˜åŒ– openssh çš„å®‰è£…æ–¹æ³•\nä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œwindow Powershellï¼Œç„¶åé”®å…¥å¦‚ä¸‹ä¸¤æ¡å‘½ä»¤\n1 Get-WindowsCapability -Online | ? Name -like \u0026#39;OpenSSH*\u0026#39; è¿™æ¡æ˜¯ç”¨æ¥æ£€æµ‹æ˜¯å¦æœ‰é€‚åˆå®‰è£…çš„opensshè½¯ä»¶ï¼Œæ­£å¸¸æƒ…å†µä¸‹åº”æœ‰å¦‚ä¸‹è¿”å›ï¼š\n1 2 3 4 Name : OpenSSH.Client~~~~0.0.1.0 State : NotPresent Name : OpenSSH.Server~~~~0.0.1.0 State : NotPresent ç¬¬äºŒæ¡å‘½ä»¤ï¼š\n1 Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0 å¦‚æœå®‰è£…å®Œæˆåº”æœ‰å¦‚ä¸‹è¿”å›ï¼š\n1 2 3 Path : Online : True RestartNeeded : False å…å¯†ç ç™»å½• å¦‚ä»Aç™»å½•Bï¼ŒA=\u0026gt;B æœ¬æœºåˆ›å»ºsshå¯†é’¥, ç”Ÿæˆåœ¨~/.sshç›®å½•ä¸‹\n1 ssh-keygen -t rsa è¯´æ˜ï¼š\nauthorized_keysï¼šå…¶å®å°±æ˜¯å­˜æ”¾å„ä¸ªæœºå™¨å…¬é’¥çš„åœ°æ–¹ï¼Œ id_rsa : ç”Ÿæˆçš„ç§é’¥æ–‡ä»¶ï¼Œ id_rsa.pub ï¼š ç”Ÿæˆçš„å…¬é’¥æ–‡ä»¶ï¼Œ know_hosts : å·²çŸ¥çš„ä¸»æœºå…¬é’¥æ¸…å•ï¼Œ è®¾ç½®äº’ä¿¡å…¶å®å°±æ˜¯å°†id_rsa.pubå…¬é’¥ä¿¡æ¯å‘é€åˆ°éœ€è¦è¢«ä¿¡ä»»çš„æœºå™¨ä¸Šçš„authorized_keysæ–‡ä»¶ä¸­å³å¯ï¼Œä¹Ÿå°±æ˜¯Aå‘é€åˆ°Bä¸Šauthorized_keysæ–‡ä»¶ä¸­\nå‘é€å¯†é’¥ åœ¨A æœºä¸Šè¿è¡Œ\n1 ssh-copy-id root@192.168.x.x å¦‚æœssh-copy-idæ‰§è¡Œä¸äº†çš„è¯(æ²¡æœ‰sshé»˜è®¤åº“çš„æƒ…å†µ)ï¼Œå¯ä»¥ä½¿ç”¨scpè¿›è¡Œå‘é€ï¼Œå³ï¼š\n1 scp -p ~/.ssh/id_rsa.pub root@192.168.x.x:/root/.ssh/authorized_keys é€šè¿‡ä»¥ä¸Šå‘½ä»¤, å³å¯å°†å…¬é’¥å‘é€è¿‡å»ï¼Œå‘é€è¿‡å»ä¹‹åå¯ä»¥ç™»å½•Bæœºå™¨æŸ¥çœ‹authorized_keysæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°äº†æœºå™¨Açš„å…¬é’¥ä¿¡æ¯ï¼Œå¦‚è¿‡æ˜¯å¤šä¸ªæœºå™¨å‘é€ç»™Bçš„è¯åˆ™ä¿å­˜å¤šä¸ªå…¬é’¥ä¿¡æ¯ï¼Œå¦‚ä¸‹ å‘é€æˆåŠŸä¹‹åï¼Œå†æ¬¡sshç™»å½•ï¼Œä»Aæœºå™¨ç™»å½•åˆ°B æœºå™¨ã€‚\n","permalink":"https://reid00.github.io/en/posts/other/vscode%E8%BF%9C%E7%A8%8B%E5%BC%80%E5%8F%91%E9%85%8D%E7%BD%AE/","summary":"å‡†å¤‡vscode æ’ä»¶ åœ¨vs codeçš„æ‰©å±•å•†åº—ä¸­æœç´¢remote-ssh, install é…ç½®remmote-ssh æ’ä»¶ ä½¿ç”¨å¿«æ·ç‚¹, ctrl + shift + P è¾“å…¥config é€‰æ‹©ç¬¬ä¸€ä¸ªï¼Œåœ¨.ssh ç›®å½•çš„configæ–‡ä»¶ æŒ‰ç…§ä»¥ä¸‹æ ¼å¼é…ç½®\n1 2 3 4 5 Host Personal HostName 172.16.1.1 User root Port 22 IdentityFile C:\\Users\\ld\\.ssh\\id_rsa Host: è‡ªå®šä¹‰çš„æœåŠ¡å™¨åç§°ï¼Œç”¨äºä¸ªäººåŒºåˆ† HostName: éœ€è¦è¿œç¨‹çš„æœåŠ¡å™¨çš„IP åœ°å€ User: è¿œç¨‹æœåŠ¡å™¨ç”¨çš„è´¦å· Port: é»˜è®¤ssh ç«¯å£22 IdentityFile: å…ç™»å½•çš„id_rsaè·¯å¾„ æ³¨æ„: å¤šæ¬¡å®éªŒåŠ å…¥IdentityFile éƒ½ä¸èƒ½åšåˆ°é€šè¿‡è·³æ¿æœºå…å¯†ç ï¼Œæœ€åæŠŠå®¢æˆ·æœºçš„id_rsa.pubæ·»åŠ åˆ°target æ‰å…å¯†ï¼Œ ç›¸å½“äºç›´æ¥å¯ä»¥è¿æ¥targetæœºå™¨äº†ã€‚\nå¦‚æœé€šè¿‡è·³æ¿æœºè¿æ¥æœåŠ¡å™¨ æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦è·³æ¿æœºæ¥è¿æ¥æœåŠ¡å™¨ï¼Œä¹Ÿå³å…ˆè¿æ¥ä¸€å°è·³æ¿æœºæœåŠ¡å™¨ï¼Œç„¶åé€šè¿‡è¿™å°è·³æ¿æœºæ‰€åœ¨çš„å†…ç½‘å†æ¬¡è·³è½¬åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚ æœ€ç®€å•çš„åšæ³•å°±æ˜¯æŒ‰ä¸Šè¿°æ–¹æ³•è¿æ¥åˆ°è·³æ¿æœºï¼Œç„¶ååœ¨è·³æ¿æœºçš„ç»ˆç«¯ç”¨sshæŒ‡ä»¤è·³è½¬åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œä½†è¿™æ ·è·³è½¬åï¼Œæˆ‘ä»¬æ— æ³•åœ¨VScodeä¸­æ‰“å¼€æœåŠ¡å™¨çš„æ–‡ä»¶ç›®å½•ï¼Œæ“ä½œèµ·æ¥å¾ˆä¸æ–¹ä¾¿ã€‚æˆ‘ä»¬å¯ä»¥æŠŠconfigçš„è®¾ç½®æ”¹æˆå¦‚ä¸‹ï¼Œå°±å¯ä»¥é€šè¿‡c00è·³æ¿æœºè·³è½¬åˆ°c01äº†\n1 2 3 4 5 6 Host BackupCluster HostName 1.16.1.1 User root Port 22 ProxyCommand C:\\Windows\\System32\\OpenSSH\\ssh.exe -W %h:%p -q Personal IdentityFile C:\\Users\\ld\\.","title":"Vscodeè¿œç¨‹å¼€å‘é…ç½®"},{"content":"åœ¨åšæ¥å£æµ‹è¯•æ—¶ï¼Œç»å¸¸ä¼šç¢°åˆ°è¯·æ±‚å‚æ•°ä¸ºtokençš„ç±»å‹ï¼Œä½†æ˜¯å¯èƒ½å¤§éƒ¨åˆ†æµ‹è¯•äººå‘˜å¯¹tokenï¼Œcookieï¼Œsessionçš„åŒºåˆ«è¿˜æ˜¯ä¸€çŸ¥åŠè§£ã€‚\nCookie cookie æ˜¯ä¸€ä¸ªéå¸¸å…·ä½“çš„ä¸œè¥¿ï¼ŒæŒ‡çš„å°±æ˜¯æµè§ˆå™¨é‡Œé¢èƒ½æ°¸ä¹…å­˜å‚¨çš„ä¸€ç§æ•°æ®ï¼Œä»…ä»…æ˜¯æµè§ˆå™¨å®ç°çš„ä¸€ç§æ•°æ®å­˜å‚¨åŠŸèƒ½ã€‚\ncookieç”±æœåŠ¡å™¨ç”Ÿæˆï¼Œå‘é€ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨æŠŠcookieä»¥kvå½¢å¼ä¿å­˜åˆ°æŸä¸ªç›®å½•ä¸‹çš„æ–‡æœ¬æ–‡ä»¶å†…ï¼Œä¸‹ä¸€æ¬¡è¯·æ±‚åŒä¸€ç½‘ç«™æ—¶ä¼šæŠŠè¯¥cookieå‘é€ç»™æœåŠ¡å™¨ã€‚ç”±äºcookieæ˜¯å­˜åœ¨å®¢æˆ·ç«¯ä¸Šçš„ï¼Œæ‰€ä»¥æµè§ˆå™¨åŠ å…¥äº†ä¸€äº›é™åˆ¶ç¡®ä¿cookieä¸ä¼šè¢«æ¶æ„ä½¿ç”¨ï¼ŒåŒæ—¶ä¸ä¼šå æ®å¤ªå¤šç£ç›˜ç©ºé—´ï¼Œæ‰€ä»¥æ¯ä¸ªåŸŸçš„cookieæ•°é‡æ˜¯æœ‰é™çš„ã€‚\nSession session ä»å­—é¢ä¸Šè®²ï¼Œå°±æ˜¯ä¼šè¯ã€‚è¿™ä¸ªå°±ç±»ä¼¼äºä½ å’Œä¸€ä¸ªäººäº¤è°ˆï¼Œä½ æ€ä¹ˆçŸ¥é“å½“å‰å’Œä½ äº¤è°ˆçš„æ˜¯å¼ ä¸‰è€Œä¸æ˜¯æå››å‘¢ï¼Ÿå¯¹æ–¹è‚¯å®šæœ‰æŸç§ç‰¹å¾ï¼ˆé•¿ç›¸ç­‰ï¼‰è¡¨æ˜ä»–å°±æ˜¯å¼ ä¸‰ã€‚\nsession ä¹Ÿæ˜¯ç±»ä¼¼çš„é“ç†ï¼ŒæœåŠ¡å™¨è¦çŸ¥é“å½“å‰å‘è¯·æ±‚ç»™è‡ªå·±çš„æ˜¯è°ã€‚ä¸ºäº†åšè¿™ç§åŒºåˆ†ï¼ŒæœåŠ¡å™¨å°±è¦ç»™æ¯ä¸ªå®¢æˆ·ç«¯åˆ†é…ä¸åŒçš„â€œèº«ä»½æ ‡è¯†â€ï¼Œç„¶åå®¢æˆ·ç«¯æ¯æ¬¡å‘æœåŠ¡å™¨å‘è¯·æ±‚çš„æ—¶å€™ï¼Œéƒ½å¸¦ä¸Šè¿™ä¸ªâ€œèº«ä»½æ ‡è¯†â€ï¼ŒæœåŠ¡å™¨å°±çŸ¥é“è¿™ä¸ªè¯·æ±‚æ¥è‡ªäºè°äº†ã€‚è‡³äºå®¢æˆ·ç«¯æ€ä¹ˆä¿å­˜è¿™ä¸ªâ€œèº«ä»½æ ‡è¯†â€ï¼Œå¯ä»¥æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œå¯¹äºæµè§ˆå™¨å®¢æˆ·ç«¯ï¼Œå¤§å®¶éƒ½é»˜è®¤é‡‡ç”¨ cookie çš„æ–¹å¼ã€‚\næœåŠ¡å™¨ä½¿ç”¨sessionæŠŠç”¨æˆ·çš„ä¿¡æ¯ä¸´æ—¶ä¿å­˜åœ¨äº†æœåŠ¡å™¨ä¸Šï¼Œç”¨æˆ·ç¦»å¼€ç½‘ç«™åsessionä¼šè¢«é”€æ¯ã€‚è¿™ç§ç”¨æˆ·ä¿¡æ¯å­˜å‚¨æ–¹å¼ç›¸å¯¹cookieæ¥è¯´æ›´å®‰å…¨ï¼Œå¯æ˜¯sessionæœ‰ä¸€ä¸ªç¼ºé™·ï¼šå¦‚æœwebæœåŠ¡å™¨åšäº†è´Ÿè½½å‡è¡¡ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªæ“ä½œè¯·æ±‚åˆ°äº†å¦ä¸€å°æœåŠ¡å™¨çš„æ—¶å€™sessionä¼šä¸¢å¤±ã€‚\nToken Tokençš„å¼•å…¥ï¼šTokenæ˜¯åœ¨å®¢æˆ·ç«¯é¢‘ç¹å‘æœåŠ¡ç«¯è¯·æ±‚æ•°æ®ï¼ŒæœåŠ¡ç«¯é¢‘ç¹çš„å»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·åå’Œå¯†ç å¹¶è¿›è¡Œå¯¹æ¯”ï¼Œåˆ¤æ–­ç”¨æˆ·åå’Œå¯†ç æ­£ç¡®ä¸å¦ï¼Œå¹¶ä½œå‡ºç›¸åº”æç¤ºï¼Œåœ¨è¿™æ ·çš„èƒŒæ™¯ä¸‹ï¼ŒTokenä¾¿åº”è¿è€Œç”Ÿã€‚\nTokençš„å®šä¹‰ï¼šTokenæ˜¯æœåŠ¡ç«¯ç”Ÿæˆçš„ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œä»¥ä½œå®¢æˆ·ç«¯è¿›è¡Œè¯·æ±‚çš„ä¸€ä¸ªä»¤ç‰Œï¼Œå½“ç¬¬ä¸€æ¬¡ç™»å½•åï¼ŒæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªTokenä¾¿å°†æ­¤Tokenè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä»¥åå®¢æˆ·ç«¯åªéœ€å¸¦ä¸Šè¿™ä¸ªTokenå‰æ¥è¯·æ±‚æ•°æ®å³å¯ï¼Œæ— éœ€å†æ¬¡å¸¦ä¸Šç”¨æˆ·åå’Œå¯†ç ã€‚æœ€ç®€å•çš„tokenç»„æˆ:uid(ç”¨æˆ·å”¯ä¸€çš„èº«ä»½æ ‡è¯†)ã€time(å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³)ã€sign(ç­¾åï¼Œç”±tokençš„å‰å‡ ä½+ç›ä»¥å“ˆå¸Œç®—æ³•å‹ç¼©æˆä¸€å®šé•¿çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå¯ä»¥é˜²æ­¢æ¶æ„ç¬¬ä¸‰æ–¹æ‹¼æ¥tokenè¯·æ±‚æœåŠ¡å™¨)ã€‚\nä½¿ç”¨Tokençš„ç›®çš„ï¼šTokençš„ç›®çš„æ˜¯ä¸ºäº†å‡è½»æœåŠ¡å™¨çš„å‹åŠ›ï¼Œå‡å°‘é¢‘ç¹çš„æŸ¥è¯¢æ•°æ®åº“ï¼Œä½¿æœåŠ¡å™¨æ›´åŠ å¥å£®ã€‚\nä¼ ç»Ÿèº«ä»½éªŒè¯ HTTP æ˜¯ä¸€ç§æ²¡æœ‰çŠ¶æ€çš„åè®®ï¼Œä¹Ÿå°±æ˜¯å®ƒå¹¶ä¸çŸ¥é“æ˜¯è°æ˜¯è®¿é—®åº”ç”¨ã€‚è¿™é‡Œæˆ‘ä»¬æŠŠç”¨æˆ·çœ‹æˆæ˜¯å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨ç”¨æˆ·åè¿˜æœ‰å¯†ç é€šè¿‡äº†èº«ä»½éªŒè¯ï¼Œä¸è¿‡ä¸‹å›è¿™ä¸ªå®¢æˆ·ç«¯å†å‘é€è¯·æ±‚æ—¶å€™ï¼Œè¿˜å¾—å†éªŒè¯ä¸€ä¸‹ã€‚\nè§£å†³çš„æ–¹æ³•å°±æ˜¯ï¼Œå½“ç”¨æˆ·è¯·æ±‚ç™»å½•çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡ç«¯ç”Ÿæˆä¸€æ¡è®°å½•ï¼Œè¿™ä¸ªè®°å½•é‡Œå¯ä»¥è¯´æ˜ä¸€ä¸‹ç™»å½•çš„ç”¨æˆ·æ˜¯è°ï¼Œç„¶åæŠŠè¿™æ¡è®°å½•çš„ ID å·å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°ä»¥åæŠŠè¿™ä¸ª ID å·å­˜å‚¨åœ¨ Cookie é‡Œï¼Œä¸‹æ¬¡è¿™ä¸ªç”¨æˆ·å†å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œå¯ä»¥å¸¦ç€è¿™ä¸ª Cookie ï¼Œè¿™æ ·æœåŠ¡ç«¯ä¼šéªŒè¯ä¸€ä¸ªè¿™ä¸ª Cookie é‡Œçš„ä¿¡æ¯ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½åœ¨æœåŠ¡ç«¯è¿™é‡Œæ‰¾åˆ°å¯¹åº”çš„è®°å½•ï¼Œå¦‚æœå¯ä»¥ï¼Œè¯´æ˜ç”¨æˆ·å·²ç»é€šè¿‡äº†èº«ä»½éªŒè¯ï¼Œå°±æŠŠç”¨æˆ·è¯·æ±‚çš„æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\nä¸Šé¢è¯´çš„å°±æ˜¯ Sessionï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡ç«¯å­˜å‚¨ä¸ºç™»å½•çš„ç”¨æˆ·ç”Ÿæˆçš„ Session ï¼Œè¿™äº› Session å¯èƒ½ä¼šå­˜å‚¨åœ¨å†…å­˜ï¼Œç£ç›˜ï¼Œæˆ–è€…æ•°æ®åº“é‡Œã€‚æˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨æœåŠ¡ç«¯å®šæœŸçš„å»æ¸…ç†è¿‡æœŸçš„ Session ã€‚\nåŸºäº Token çš„èº«ä»½éªŒè¯ ä½¿ç”¨åŸºäº Token çš„èº«ä»½éªŒè¯æ–¹æ³•ï¼Œåœ¨æœåŠ¡ç«¯ä¸éœ€è¦å­˜å‚¨ç”¨æˆ·çš„ç™»å½•è®°å½•ã€‚å¤§æ¦‚çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š\nå®¢æˆ·ç«¯ä½¿ç”¨ç”¨æˆ·åè·Ÿå¯†ç è¯·æ±‚ç™»å½• æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œå»éªŒè¯ç”¨æˆ·åä¸å¯†ç  éªŒè¯æˆåŠŸåï¼ŒæœåŠ¡ç«¯ä¼šç­¾å‘ä¸€ä¸ª Tokenï¼Œå†æŠŠè¿™ä¸ª Token å‘é€ç»™å®¢æˆ·ç«¯ å®¢æˆ·ç«¯æ”¶åˆ° Token ä»¥åå¯ä»¥æŠŠå®ƒå­˜å‚¨èµ·æ¥ï¼Œæ¯”å¦‚æ”¾åœ¨ Cookie é‡Œæˆ–è€… Local Storage é‡Œ å®¢æˆ·ç«¯æ¯æ¬¡å‘æœåŠ¡ç«¯è¯·æ±‚èµ„æºçš„æ—¶å€™éœ€è¦å¸¦ç€æœåŠ¡ç«¯ç­¾å‘çš„ Token æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œç„¶åå»éªŒè¯å®¢æˆ·ç«¯è¯·æ±‚é‡Œé¢å¸¦ç€çš„ Tokenï¼Œå¦‚æœéªŒè¯æˆåŠŸï¼Œå°±å‘å®¢æˆ·ç«¯è¿”å›è¯·æ±‚çš„æ•°æ® APPç™»å½•çš„æ—¶å€™å‘é€åŠ å¯†çš„ç”¨æˆ·åå’Œå¯†ç åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨éªŒè¯ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœæˆåŠŸï¼Œä»¥æŸç§æ–¹å¼æ¯”å¦‚éšæœºç”Ÿæˆ32ä½çš„å­—ç¬¦ä¸²ä½œä¸ºtokenï¼Œå­˜å‚¨åˆ°æœåŠ¡å™¨ä¸­ï¼Œå¹¶è¿”å›tokenåˆ°APPï¼Œä»¥åAPPè¯·æ±‚æ—¶ï¼Œå‡¡æ˜¯éœ€è¦éªŒè¯çš„åœ°æ–¹éƒ½è¦å¸¦ä¸Šè¯¥tokenï¼Œç„¶åæœåŠ¡å™¨ç«¯éªŒè¯tokenï¼ŒæˆåŠŸè¿”å›æ‰€éœ€è¦çš„ç»“æœï¼Œå¤±è´¥è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œè®©ä»–é‡æ–°ç™»å½•ã€‚å…¶ä¸­æœåŠ¡å™¨ä¸Štokenè®¾ç½®ä¸€ä¸ªæœ‰æ•ˆæœŸï¼Œæ¯æ¬¡APPè¯·æ±‚çš„æ—¶å€™éƒ½éªŒè¯tokenå’Œæœ‰æ•ˆæœŸã€‚\né‚£ä¹ˆæˆ‘çš„é—®é¢˜æ¥äº†ï¼š1.æœåŠ¡å™¨ä¸Šçš„tokenå­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œæ¯æ¬¡æŸ¥è¯¢ä¼šä¸ä¼šå¾ˆè´¹æ—¶ã€‚å¦‚æœä¸å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œåº”è¯¥å­˜å‚¨åˆ°å“ªé‡Œå‘¢ã€‚2.å®¢æˆ·ç«¯å¾—åˆ°çš„tokenè‚¯å®šè¦åŠ å¯†å­˜å‚¨çš„ï¼Œå‘é€tokençš„æ—¶å€™å†è§£å¯†ã€‚å­˜å‚¨åˆ°æ•°æ®åº“è¿˜æ˜¯é…ç½®æ–‡ä»¶å‘¢ï¼Ÿ\ntokenæ˜¯ä¸ªæ˜“å¤±æ•°æ®ï¼Œä¸¢äº†æ— éè®©ç”¨æˆ·é‡æ–°ç™»å½•ä¸€ä¸‹ï¼Œæ–°æµªå¾®åšåŠ¨ä¸åŠ¨å°±è®©æˆ‘é‡æ–°ç™»å½•ï¼Œåæ­£è¿™äº‹å„¿æˆ‘æ˜¯æ— æ‰€è°“å•¦ã€‚ æ‰€ä»¥å¦‚æœä½ è§‰å¾—æ™®é€šçš„æ•°æ®åº“è¡¨æ’‘ä¸ä½äº†ï¼Œå¯ä»¥æ”¾åˆ° MSSQL/MySQL çš„å†…å­˜è¡¨é‡Œï¼ˆä¸è¿‡æ®è¯´mysqlçš„å†…å­˜è¡¨æ€§èƒ½æå‡æœ‰é™ï¼‰ï¼Œå¯ä»¥æ”¾åˆ° Memcacheé‡Œï¼ˆè®²çœŸï¼Œè¿™ä¸ªæ˜¯æŒºå¸¸è§çš„ç­–ç•¥ï¼‰ï¼Œå¯ä»¥æ”¾åˆ°redisé‡Œï¼ˆæˆ‘åšè¿‡è¿™æ ·çš„å®ç°ï¼‰ï¼Œç”šè‡³å¯ä»¥æ”¾åˆ° OpenResty çš„å˜é‡å­—å…¸é‡Œï¼ˆåªè¦ä½ æœ‰ä¿¡å¿ƒä¸çˆ†å†…å­˜ï¼‰ã€‚\ntokenæ˜¯ä¸ªå‡­æ¡ï¼Œä¸è¿‡å®ƒæ¯”é—¨ç¥¨æ¸©æŸ”å¤šäº†ï¼Œé—¨ç¥¨ä¸¢äº†é‡æ–°èŠ±é’±ä¹°ï¼Œtokenä¸¢äº†é‡æ–°æ“ä½œä¸‹è®¤è¯ä¸€ä¸ªå°±å¯ä»¥äº†ï¼Œå› æ­¤tokenä¸¢å¤±çš„ä»£ä»·æ˜¯å¯ä»¥å¿å—çš„â€”â€”å‰ææ˜¯ä½ åˆ«ä¸¢å¤ªé¢‘ç¹ï¼Œè¦æ˜¯è®©ç”¨æˆ·éš”ä¸‰å·®äº”å°±è®¤è¯ä¸€æ¬¡é‚£å°±æŸå¤±ç”¨æˆ·ä½“éªŒäº†ã€‚\nåŸºäºè¿™ä¸ªå‡ºå‘ç‚¹ï¼Œå¦‚æœä½ è®¤ä¸ºç”¨æ•°æ®åº“æ¥ä¿æŒtokenæŸ¥è¯¢æ—¶é—´å¤ªé•¿ï¼Œä¼šæˆä¸ºä½ ç³»ç»Ÿçš„ç“¶é¢ˆæˆ–è€…éšæ‚£ï¼Œå¯ä»¥æ”¾åœ¨å†…å­˜å½“ä¸­ã€‚ æ¯”å¦‚memcachedã€redisï¼ŒKVæ–¹å¼å¾ˆé€‚åˆä½ å¯¹tokenæŸ¥è¯¢çš„éœ€æ±‚ã€‚ è¿™ä¸ªä¸ä¼šå¤ªå å†…å­˜ï¼Œæ¯”å¦‚ä½ çš„tokenæ˜¯32ä½å­—ç¬¦ä¸²ï¼Œè¦æ˜¯ä½ çš„ç”¨æˆ·é‡åœ¨ç™¾ä¸‡çº§æˆ–è€…åƒä¸‡çº§ï¼Œé‚£æ‰å¤šå°‘å†…å­˜ã€‚ è¦æ˜¯æ•°æ®é‡çœŸçš„å¤§åˆ°å•æœºå†…å­˜æ‰›ä¸ä½ï¼Œæˆ–è€…è§‰å¾—ä¸€å®•æœºå…¨ä¸¢é£é™©å¤§ï¼Œåªè¦è¿™ä¸ªtokenç”Ÿæˆæ˜¯è¶³å¤Ÿå‡åŒ€çš„ï¼Œé«˜ä½ä½åˆ‡ä¸€ä¸‹åˆ†åˆ°ä¸åŒæœºå™¨ä¸Šå°±è¡Œï¼Œå†…å­˜ç»å¯¹ä¸ä¼šæ˜¯é—®é¢˜ã€‚\nå®¢æˆ·ç«¯æ–¹é¢è¿™ä¸ªé™¤éä½ æœ‰ä¸€ä¸ªéå¸¸å®‰å…¨çš„åŠæ³•ï¼Œæ¯”å¦‚æ“ä½œç³»ç»Ÿæä¾›çš„éšç§æ•°æ®å­˜å‚¨ï¼Œé‚£tokenè‚¯å®šä¼šå­˜åœ¨æ³„éœ²çš„é—®é¢˜ã€‚æ¯”å¦‚æˆ‘æ‹¿åˆ°ä½ çš„æ‰‹æœºï¼ŒæŠŠä½ çš„tokenæ‹·å‡ºæ¥ï¼Œåœ¨è¿‡æœŸä¹‹å‰å°±éƒ½å¯ä»¥ä»¥ä½ çš„èº«ä»½åœ¨åˆ«çš„åœ°æ–¹ç™»å½•ã€‚ è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ä¸ªç®€å•åŠæ³• 1ã€åœ¨å­˜å‚¨çš„æ—¶å€™æŠŠtokenè¿›è¡Œå¯¹ç§°åŠ å¯†å­˜å‚¨ï¼Œç”¨æ—¶è§£å¼€ã€‚ 2ã€å°†è¯·æ±‚URLã€æ—¶é—´æˆ³ã€tokenä¸‰è€…è¿›è¡Œåˆå¹¶åŠ ç›ç­¾åï¼ŒæœåŠ¡ç«¯æ ¡éªŒæœ‰æ•ˆæ€§ã€‚ è¿™ä¸¤ç§åŠæ³•çš„å‡ºå‘ç‚¹éƒ½æ˜¯ï¼šçªƒå–ä½ å­˜å‚¨çš„æ•°æ®è¾ƒä¸ºå®¹æ˜“ï¼Œè€Œåæ±‡ç¼–ä½ çš„ç¨‹åºhackä½ çš„åŠ å¯†è§£å¯†å’Œç­¾åç®—æ³•æ˜¯æ¯”è¾ƒéš¾çš„ã€‚ç„¶è€Œå…¶å®è¯´éš¾ä¹Ÿä¸éš¾ï¼Œæ‰€ä»¥ç»ˆç©¶æ˜¯é˜²å›å­ä¸é˜²å°äººçš„åšæ³•ã€‚è¯è¯´åŠ å¯†å­˜å‚¨ä¸€ä¸ªä½ è¦æ˜¯è¢«äººæ‰’å¼€å®¢æˆ·ç«¯çœ‹ä¹Ÿä¸ä¼šè¢«å–·æ˜æ–‡å­˜å‚¨â€¦â€¦ æ–¹æ³•1å®ƒæ‹¿åˆ°å­˜å‚¨çš„å¯†æ–‡è§£ä¸å¼€ã€æ–¹æ³•2å®ƒä¸çŸ¥é“ä½ çš„ç­¾åç®—æ³•å’Œç›ï¼Œä¸¤è€…å¯ä»¥ç»“åˆé£Ÿç”¨ã€‚ ä½†æ˜¯å¦‚æœtokenè¢«äººæ‹·èµ°ï¼Œä»–è‡ªç„¶ä¹Ÿèƒ½æ¤å…¥åˆ°è‡ªå·±çš„æ‰‹æœºé‡Œé¢ï¼Œé‚£åˆ°æ—¶å€™ä»–çš„æ‰‹æœºä¹Ÿå¯ä»¥ä»¥ä½ çš„èº«ä»½æ¥ç”¨ç€ï¼Œè¿™ä½ å°±çäº†ã€‚ äºæ˜¯å¯ä»¥æä¾›ä¸€ä¸ªè®©ç”¨æˆ·å¯ä»¥ä¸»åŠ¨expireä¸€ä¸ªè¿‡å»çš„tokenç±»ä¼¼çš„æœºåˆ¶ï¼Œåœ¨è¢«ç›—çš„æ—¶å€™èƒ½è¿œç¨‹æ­¢æŸã€‚\nåœ¨ç½‘ç»œå±‚é¢ä¸Štokenæ˜æ–‡ä¼ è¾“çš„è¯ä¼šéå¸¸çš„å±é™©ï¼Œæ‰€ä»¥å»ºè®®ä¸€å®šè¦ä½¿ç”¨HTTPSï¼Œå¹¶ä¸”æŠŠtokenæ”¾åœ¨post bodyé‡Œã€‚\nè¡¥å…… cookieä¸sessionçš„åŒºåˆ« 1ã€cookieæ•°æ®å­˜æ”¾åœ¨å®¢æˆ·ç«¯ä¸Šï¼Œsessionæ•°æ®æ”¾åœ¨æœåŠ¡å™¨ä¸Šã€‚\n2ã€cookieä¸æ˜¯å¾ˆå®‰å…¨ï¼Œåˆ«äººå¯ä»¥åˆ†æå­˜æ”¾åœ¨æœ¬åœ°çš„COOKIEå¹¶è¿›è¡ŒCOOKIEæ¬ºéª— è€ƒè™‘åˆ°å®‰å…¨åº”å½“ä½¿ç”¨sessionã€‚\n3ã€sessionä¼šåœ¨ä¸€å®šæ—¶é—´å†…ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šã€‚å½“è®¿é—®å¢å¤šï¼Œä¼šæ¯”è¾ƒå ç”¨ä½ æœåŠ¡å™¨çš„æ€§èƒ½ è€ƒè™‘åˆ°å‡è½»æœåŠ¡å™¨æ€§èƒ½æ–¹é¢ï¼Œåº”å½“ä½¿ç”¨COOKIEã€‚\n4ã€å•ä¸ªcookieä¿å­˜çš„æ•°æ®ä¸èƒ½è¶…è¿‡4Kï¼Œå¾ˆå¤šæµè§ˆå™¨éƒ½é™åˆ¶ä¸€ä¸ªç«™ç‚¹æœ€å¤šä¿å­˜20ä¸ªcookieã€‚\n5ã€æ‰€ä»¥ä¸ªäººå»ºè®®ï¼š å°†ç™»é™†ä¿¡æ¯ç­‰é‡è¦ä¿¡æ¯å­˜æ”¾ä¸ºSESSION å…¶ä»–ä¿¡æ¯å¦‚æœéœ€è¦ä¿ç•™ï¼Œå¯ä»¥æ”¾åœ¨COOKIEä¸­\nsessionä¸tokençš„åŒºåˆ« session å’Œ oauth tokenå¹¶ä¸çŸ›ç›¾ï¼Œä½œä¸ºèº«ä»½è®¤è¯ tokenå®‰å…¨æ€§æ¯”sessionå¥½ï¼Œå› ä¸ºæ¯ä¸ªè¯·æ±‚éƒ½æœ‰ç­¾åè¿˜èƒ½é˜²æ­¢ç›‘å¬ä»¥åŠé‡æ”¾æ”»å‡»ï¼Œè€Œsessionå°±å¿…é¡»é é“¾è·¯å±‚æ¥ä¿éšœé€šè®¯å®‰å…¨äº†ã€‚å¦‚ä¸Šæ‰€è¯´ï¼Œå¦‚æœä½ éœ€è¦å®ç°æœ‰çŠ¶æ€çš„ä¼šè¯ï¼Œä»ç„¶å¯ä»¥å¢åŠ sessionæ¥åœ¨æœåŠ¡å™¨ç«¯ä¿å­˜ä¸€äº›çŠ¶æ€\nAppé€šå¸¸ç”¨restful apiè·Ÿserveræ‰“äº¤é“ã€‚Restæ˜¯statelessçš„ï¼Œä¹Ÿå°±æ˜¯appä¸éœ€è¦åƒbrowseré‚£æ ·ç”¨cookieæ¥ä¿å­˜session,å› æ­¤ç”¨session tokenæ¥æ ‡ç¤ºè‡ªå·±å°±å¤Ÿäº†ï¼Œsession/stateç”±api serverçš„é€»è¾‘å¤„ç†ã€‚ å¦‚æœä½ çš„åç«¯ä¸æ˜¯statelessçš„rest api, é‚£ä¹ˆä½ å¯èƒ½éœ€è¦åœ¨appé‡Œä¿å­˜session.å¯ä»¥åœ¨appé‡ŒåµŒå…¥webkit,ç”¨ä¸€ä¸ªéšè—çš„browseræ¥ç®¡ç†cookie session.\nSession æ˜¯ä¸€ç§HTTPå­˜å‚¨æœºåˆ¶ï¼Œç›®çš„æ˜¯ä¸ºæ— çŠ¶æ€çš„HTTPæä¾›çš„æŒä¹…æœºåˆ¶ã€‚æ‰€è°“Session è®¤è¯åªæ˜¯ç®€å•çš„æŠŠUser ä¿¡æ¯å­˜å‚¨åˆ°Session é‡Œï¼Œå› ä¸ºSID çš„ä¸å¯é¢„æµ‹æ€§ï¼Œæš‚ä¸”è®¤ä¸ºæ˜¯å®‰å…¨çš„ã€‚è¿™æ˜¯ä¸€ç§è®¤è¯æ‰‹æ®µã€‚ è€ŒToken ï¼Œå¦‚æœæŒ‡çš„æ˜¯OAuth Token æˆ–ç±»ä¼¼çš„æœºåˆ¶çš„è¯ï¼Œæä¾›çš„æ˜¯ è®¤è¯ å’Œ æˆæƒ ï¼Œè®¤è¯æ˜¯é’ˆå¯¹ç”¨æˆ·ï¼Œæˆæƒæ˜¯é’ˆå¯¹App ã€‚å…¶ç›®çš„æ˜¯è®© æŸAppæœ‰æƒåˆ©è®¿é—® æŸç”¨æˆ· çš„ä¿¡æ¯ã€‚è¿™é‡Œçš„ Tokenæ˜¯å”¯ä¸€çš„ã€‚ä¸å¯ä»¥è½¬ç§»åˆ°å…¶å®ƒ Appä¸Šï¼Œä¹Ÿä¸å¯ä»¥è½¬åˆ°å…¶å®ƒ ç”¨æˆ· ä¸Šã€‚ è½¬è¿‡æ¥è¯´Session ã€‚Sessionåªæä¾›ä¸€ç§ç®€å•çš„è®¤è¯ï¼Œå³æœ‰æ­¤ SIDï¼Œå³è®¤ä¸ºæœ‰æ­¤ Userçš„å…¨éƒ¨æƒåˆ©ã€‚æ˜¯éœ€è¦ä¸¥æ ¼ä¿å¯†çš„ï¼Œè¿™ä¸ªæ•°æ®åº”è¯¥åªä¿å­˜åœ¨ç«™æ–¹ï¼Œä¸åº”è¯¥å…±äº«ç»™å…¶å®ƒç½‘ç«™æˆ–è€…ç¬¬ä¸‰æ–¹Appã€‚ æ‰€ä»¥ç®€å•æ¥è¯´ï¼Œå¦‚æœä½ çš„ç”¨æˆ·æ•°æ®å¯èƒ½éœ€è¦å’Œç¬¬ä¸‰æ–¹å…±äº«ï¼Œæˆ–è€…å…è®¸ç¬¬ä¸‰æ–¹è°ƒç”¨ API æ¥å£ï¼Œç”¨ Token ã€‚å¦‚æœæ°¸è¿œåªæ˜¯è‡ªå·±çš„ç½‘ç«™ï¼Œè‡ªå·±çš„ Appï¼Œç”¨ä»€ä¹ˆå°±æ— æ‰€è°“äº†ã€‚\næ‰“ç ´è¯¯è§£ï¼š â€œåªè¦å…³é—­æµè§ˆå™¨ ï¼Œsessionå°±æ¶ˆå¤±äº†ï¼Ÿâ€\nä¸å¯¹ã€‚å¯¹sessionæ¥è¯´ï¼Œé™¤éç¨‹åºé€šçŸ¥æœåŠ¡å™¨åˆ é™¤ä¸€ä¸ªsessionï¼Œå¦åˆ™æœåŠ¡å™¨ä¼šä¸€ç›´ä¿ç•™ï¼Œç¨‹åºä¸€èˆ¬éƒ½æ˜¯åœ¨ç”¨æˆ·åšlog offçš„æ—¶å€™å‘ä¸ªæŒ‡ä»¤å»åˆ é™¤sessionã€‚\nç„¶è€Œæµè§ˆå™¨ä»æ¥ä¸ä¼šä¸»åŠ¨åœ¨å…³é—­ä¹‹å‰é€šçŸ¥æœåŠ¡å™¨å®ƒå°†è¦å…³é—­ï¼Œå› æ­¤æœåŠ¡å™¨æ ¹æœ¬ä¸ä¼šæœ‰æœºä¼šçŸ¥é“æµè§ˆå™¨å·²ç»å…³é—­ï¼Œä¹‹æ‰€ä»¥ä¼šæœ‰è¿™ç§é”™è§‰ï¼Œæ˜¯å¤§éƒ¨åˆ†sessionæœºåˆ¶éƒ½ä½¿ç”¨ä¼šè¯cookieæ¥ä¿å­˜session idï¼Œè€Œå…³é—­æµè§ˆå™¨åè¿™ä¸ªsession idå°±æ¶ˆå¤±äº†ï¼Œå†æ¬¡è¿æ¥æœåŠ¡å™¨æ—¶ä¹Ÿå°±æ— æ³•æ‰¾åˆ°åŸæ¥çš„sessionã€‚å¦‚æœæœåŠ¡å™¨è®¾ç½®çš„cookieè¢«ä¿å­˜åœ¨ç¡¬ç›˜ä¸Šï¼Œæˆ–è€…ä½¿ç”¨æŸç§æ‰‹æ®µæ”¹å†™æµè§ˆå™¨å‘å‡ºçš„HTTPè¯·æ±‚å¤´ï¼ŒæŠŠåŸæ¥çš„session idå‘é€ç»™æœåŠ¡å™¨ï¼Œåˆ™å†æ¬¡æ‰“å¼€æµè§ˆå™¨ä»ç„¶èƒ½å¤Ÿæ‰“å¼€åŸæ¥çš„session.\næ°æ°æ˜¯**ç”±äºå…³é—­æµè§ˆå™¨ä¸ä¼šå¯¼è‡´sessionè¢«åˆ é™¤ï¼Œè¿«ä½¿æœåŠ¡å™¨ä¸ºsessionè®¾ç½®äº†ä¸€ä¸ªå¤±æ•ˆæ—¶é—´ï¼Œå½“è·ç¦»å®¢æˆ·ç«¯ä¸Šä¸€æ¬¡ä½¿ç”¨sessionçš„æ—¶é—´è¶…è¿‡è¿™ä¸ªå¤±æ•ˆæ—¶é—´æ—¶ï¼ŒæœåŠ¡å™¨å°±å¯ä»¥ä»¥ä¸ºå®¢æˆ·ç«¯å·²ç»åœæ­¢äº†æ´»åŠ¨ï¼Œæ‰ä¼šæŠŠsessionåˆ é™¤ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´ã€‚**\n","permalink":"https://reid00.github.io/en/posts/os_network/token-cookie-session%E5%8C%BA%E5%88%AB/","summary":"åœ¨åšæ¥å£æµ‹è¯•æ—¶ï¼Œç»å¸¸ä¼šç¢°åˆ°è¯·æ±‚å‚æ•°ä¸ºtokençš„ç±»å‹ï¼Œä½†æ˜¯å¯èƒ½å¤§éƒ¨åˆ†æµ‹è¯•äººå‘˜å¯¹tokenï¼Œcookieï¼Œsessionçš„åŒºåˆ«è¿˜æ˜¯ä¸€çŸ¥åŠè§£ã€‚\nCookie cookie æ˜¯ä¸€ä¸ªéå¸¸å…·ä½“çš„ä¸œè¥¿ï¼ŒæŒ‡çš„å°±æ˜¯æµè§ˆå™¨é‡Œé¢èƒ½æ°¸ä¹…å­˜å‚¨çš„ä¸€ç§æ•°æ®ï¼Œä»…ä»…æ˜¯æµè§ˆå™¨å®ç°çš„ä¸€ç§æ•°æ®å­˜å‚¨åŠŸèƒ½ã€‚\ncookieç”±æœåŠ¡å™¨ç”Ÿæˆï¼Œå‘é€ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨æŠŠcookieä»¥kvå½¢å¼ä¿å­˜åˆ°æŸä¸ªç›®å½•ä¸‹çš„æ–‡æœ¬æ–‡ä»¶å†…ï¼Œä¸‹ä¸€æ¬¡è¯·æ±‚åŒä¸€ç½‘ç«™æ—¶ä¼šæŠŠè¯¥cookieå‘é€ç»™æœåŠ¡å™¨ã€‚ç”±äºcookieæ˜¯å­˜åœ¨å®¢æˆ·ç«¯ä¸Šçš„ï¼Œæ‰€ä»¥æµè§ˆå™¨åŠ å…¥äº†ä¸€äº›é™åˆ¶ç¡®ä¿cookieä¸ä¼šè¢«æ¶æ„ä½¿ç”¨ï¼ŒåŒæ—¶ä¸ä¼šå æ®å¤ªå¤šç£ç›˜ç©ºé—´ï¼Œæ‰€ä»¥æ¯ä¸ªåŸŸçš„cookieæ•°é‡æ˜¯æœ‰é™çš„ã€‚\nSession session ä»å­—é¢ä¸Šè®²ï¼Œå°±æ˜¯ä¼šè¯ã€‚è¿™ä¸ªå°±ç±»ä¼¼äºä½ å’Œä¸€ä¸ªäººäº¤è°ˆï¼Œä½ æ€ä¹ˆçŸ¥é“å½“å‰å’Œä½ äº¤è°ˆçš„æ˜¯å¼ ä¸‰è€Œä¸æ˜¯æå››å‘¢ï¼Ÿå¯¹æ–¹è‚¯å®šæœ‰æŸç§ç‰¹å¾ï¼ˆé•¿ç›¸ç­‰ï¼‰è¡¨æ˜ä»–å°±æ˜¯å¼ ä¸‰ã€‚\nsession ä¹Ÿæ˜¯ç±»ä¼¼çš„é“ç†ï¼ŒæœåŠ¡å™¨è¦çŸ¥é“å½“å‰å‘è¯·æ±‚ç»™è‡ªå·±çš„æ˜¯è°ã€‚ä¸ºäº†åšè¿™ç§åŒºåˆ†ï¼ŒæœåŠ¡å™¨å°±è¦ç»™æ¯ä¸ªå®¢æˆ·ç«¯åˆ†é…ä¸åŒçš„â€œèº«ä»½æ ‡è¯†â€ï¼Œç„¶åå®¢æˆ·ç«¯æ¯æ¬¡å‘æœåŠ¡å™¨å‘è¯·æ±‚çš„æ—¶å€™ï¼Œéƒ½å¸¦ä¸Šè¿™ä¸ªâ€œèº«ä»½æ ‡è¯†â€ï¼ŒæœåŠ¡å™¨å°±çŸ¥é“è¿™ä¸ªè¯·æ±‚æ¥è‡ªäºè°äº†ã€‚è‡³äºå®¢æˆ·ç«¯æ€ä¹ˆä¿å­˜è¿™ä¸ªâ€œèº«ä»½æ ‡è¯†â€ï¼Œå¯ä»¥æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œå¯¹äºæµè§ˆå™¨å®¢æˆ·ç«¯ï¼Œå¤§å®¶éƒ½é»˜è®¤é‡‡ç”¨ cookie çš„æ–¹å¼ã€‚\næœåŠ¡å™¨ä½¿ç”¨sessionæŠŠç”¨æˆ·çš„ä¿¡æ¯ä¸´æ—¶ä¿å­˜åœ¨äº†æœåŠ¡å™¨ä¸Šï¼Œç”¨æˆ·ç¦»å¼€ç½‘ç«™åsessionä¼šè¢«é”€æ¯ã€‚è¿™ç§ç”¨æˆ·ä¿¡æ¯å­˜å‚¨æ–¹å¼ç›¸å¯¹cookieæ¥è¯´æ›´å®‰å…¨ï¼Œå¯æ˜¯sessionæœ‰ä¸€ä¸ªç¼ºé™·ï¼šå¦‚æœwebæœåŠ¡å™¨åšäº†è´Ÿè½½å‡è¡¡ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªæ“ä½œè¯·æ±‚åˆ°äº†å¦ä¸€å°æœåŠ¡å™¨çš„æ—¶å€™sessionä¼šä¸¢å¤±ã€‚\nToken Tokençš„å¼•å…¥ï¼šTokenæ˜¯åœ¨å®¢æˆ·ç«¯é¢‘ç¹å‘æœåŠ¡ç«¯è¯·æ±‚æ•°æ®ï¼ŒæœåŠ¡ç«¯é¢‘ç¹çš„å»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·åå’Œå¯†ç å¹¶è¿›è¡Œå¯¹æ¯”ï¼Œåˆ¤æ–­ç”¨æˆ·åå’Œå¯†ç æ­£ç¡®ä¸å¦ï¼Œå¹¶ä½œå‡ºç›¸åº”æç¤ºï¼Œåœ¨è¿™æ ·çš„èƒŒæ™¯ä¸‹ï¼ŒTokenä¾¿åº”è¿è€Œç”Ÿã€‚\nTokençš„å®šä¹‰ï¼šTokenæ˜¯æœåŠ¡ç«¯ç”Ÿæˆçš„ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œä»¥ä½œå®¢æˆ·ç«¯è¿›è¡Œè¯·æ±‚çš„ä¸€ä¸ªä»¤ç‰Œï¼Œå½“ç¬¬ä¸€æ¬¡ç™»å½•åï¼ŒæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªTokenä¾¿å°†æ­¤Tokenè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä»¥åå®¢æˆ·ç«¯åªéœ€å¸¦ä¸Šè¿™ä¸ªTokenå‰æ¥è¯·æ±‚æ•°æ®å³å¯ï¼Œæ— éœ€å†æ¬¡å¸¦ä¸Šç”¨æˆ·åå’Œå¯†ç ã€‚æœ€ç®€å•çš„tokenç»„æˆ:uid(ç”¨æˆ·å”¯ä¸€çš„èº«ä»½æ ‡è¯†)ã€time(å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³)ã€sign(ç­¾åï¼Œç”±tokençš„å‰å‡ ä½+ç›ä»¥å“ˆå¸Œç®—æ³•å‹ç¼©æˆä¸€å®šé•¿çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå¯ä»¥é˜²æ­¢æ¶æ„ç¬¬ä¸‰æ–¹æ‹¼æ¥tokenè¯·æ±‚æœåŠ¡å™¨)ã€‚\nä½¿ç”¨Tokençš„ç›®çš„ï¼šTokençš„ç›®çš„æ˜¯ä¸ºäº†å‡è½»æœåŠ¡å™¨çš„å‹åŠ›ï¼Œå‡å°‘é¢‘ç¹çš„æŸ¥è¯¢æ•°æ®åº“ï¼Œä½¿æœåŠ¡å™¨æ›´åŠ å¥å£®ã€‚\nä¼ ç»Ÿèº«ä»½éªŒè¯ HTTP æ˜¯ä¸€ç§æ²¡æœ‰çŠ¶æ€çš„åè®®ï¼Œä¹Ÿå°±æ˜¯å®ƒå¹¶ä¸çŸ¥é“æ˜¯è°æ˜¯è®¿é—®åº”ç”¨ã€‚è¿™é‡Œæˆ‘ä»¬æŠŠç”¨æˆ·çœ‹æˆæ˜¯å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨ç”¨æˆ·åè¿˜æœ‰å¯†ç é€šè¿‡äº†èº«ä»½éªŒè¯ï¼Œä¸è¿‡ä¸‹å›è¿™ä¸ªå®¢æˆ·ç«¯å†å‘é€è¯·æ±‚æ—¶å€™ï¼Œè¿˜å¾—å†éªŒè¯ä¸€ä¸‹ã€‚\nè§£å†³çš„æ–¹æ³•å°±æ˜¯ï¼Œå½“ç”¨æˆ·è¯·æ±‚ç™»å½•çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡ç«¯ç”Ÿæˆä¸€æ¡è®°å½•ï¼Œè¿™ä¸ªè®°å½•é‡Œå¯ä»¥è¯´æ˜ä¸€ä¸‹ç™»å½•çš„ç”¨æˆ·æ˜¯è°ï¼Œç„¶åæŠŠè¿™æ¡è®°å½•çš„ ID å·å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°ä»¥åæŠŠè¿™ä¸ª ID å·å­˜å‚¨åœ¨ Cookie é‡Œï¼Œä¸‹æ¬¡è¿™ä¸ªç”¨æˆ·å†å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œå¯ä»¥å¸¦ç€è¿™ä¸ª Cookie ï¼Œè¿™æ ·æœåŠ¡ç«¯ä¼šéªŒè¯ä¸€ä¸ªè¿™ä¸ª Cookie é‡Œçš„ä¿¡æ¯ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½åœ¨æœåŠ¡ç«¯è¿™é‡Œæ‰¾åˆ°å¯¹åº”çš„è®°å½•ï¼Œå¦‚æœå¯ä»¥ï¼Œè¯´æ˜ç”¨æˆ·å·²ç»é€šè¿‡äº†èº«ä»½éªŒè¯ï¼Œå°±æŠŠç”¨æˆ·è¯·æ±‚çš„æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\nä¸Šé¢è¯´çš„å°±æ˜¯ Sessionï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡ç«¯å­˜å‚¨ä¸ºç™»å½•çš„ç”¨æˆ·ç”Ÿæˆçš„ Session ï¼Œè¿™äº› Session å¯èƒ½ä¼šå­˜å‚¨åœ¨å†…å­˜ï¼Œç£ç›˜ï¼Œæˆ–è€…æ•°æ®åº“é‡Œã€‚æˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨æœåŠ¡ç«¯å®šæœŸçš„å»æ¸…ç†è¿‡æœŸçš„ Session ã€‚\nåŸºäº Token çš„èº«ä»½éªŒè¯ ä½¿ç”¨åŸºäº Token çš„èº«ä»½éªŒè¯æ–¹æ³•ï¼Œåœ¨æœåŠ¡ç«¯ä¸éœ€è¦å­˜å‚¨ç”¨æˆ·çš„ç™»å½•è®°å½•ã€‚å¤§æ¦‚çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š\nå®¢æˆ·ç«¯ä½¿ç”¨ç”¨æˆ·åè·Ÿå¯†ç è¯·æ±‚ç™»å½• æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œå»éªŒè¯ç”¨æˆ·åä¸å¯†ç  éªŒè¯æˆåŠŸåï¼ŒæœåŠ¡ç«¯ä¼šç­¾å‘ä¸€ä¸ª Tokenï¼Œå†æŠŠè¿™ä¸ª Token å‘é€ç»™å®¢æˆ·ç«¯ å®¢æˆ·ç«¯æ”¶åˆ° Token ä»¥åå¯ä»¥æŠŠå®ƒå­˜å‚¨èµ·æ¥ï¼Œæ¯”å¦‚æ”¾åœ¨ Cookie é‡Œæˆ–è€… Local Storage é‡Œ å®¢æˆ·ç«¯æ¯æ¬¡å‘æœåŠ¡ç«¯è¯·æ±‚èµ„æºçš„æ—¶å€™éœ€è¦å¸¦ç€æœåŠ¡ç«¯ç­¾å‘çš„ Token æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚ï¼Œç„¶åå»éªŒè¯å®¢æˆ·ç«¯è¯·æ±‚é‡Œé¢å¸¦ç€çš„ Tokenï¼Œå¦‚æœéªŒè¯æˆåŠŸï¼Œå°±å‘å®¢æˆ·ç«¯è¿”å›è¯·æ±‚çš„æ•°æ® APPç™»å½•çš„æ—¶å€™å‘é€åŠ å¯†çš„ç”¨æˆ·åå’Œå¯†ç åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨éªŒè¯ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœæˆåŠŸï¼Œä»¥æŸç§æ–¹å¼æ¯”å¦‚éšæœºç”Ÿæˆ32ä½çš„å­—ç¬¦ä¸²ä½œä¸ºtokenï¼Œå­˜å‚¨åˆ°æœåŠ¡å™¨ä¸­ï¼Œå¹¶è¿”å›tokenåˆ°APPï¼Œä»¥åAPPè¯·æ±‚æ—¶ï¼Œå‡¡æ˜¯éœ€è¦éªŒè¯çš„åœ°æ–¹éƒ½è¦å¸¦ä¸Šè¯¥tokenï¼Œç„¶åæœåŠ¡å™¨ç«¯éªŒè¯tokenï¼ŒæˆåŠŸè¿”å›æ‰€éœ€è¦çš„ç»“æœï¼Œå¤±è´¥è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œè®©ä»–é‡æ–°ç™»å½•ã€‚å…¶ä¸­æœåŠ¡å™¨ä¸Štokenè®¾ç½®ä¸€ä¸ªæœ‰æ•ˆæœŸï¼Œæ¯æ¬¡APPè¯·æ±‚çš„æ—¶å€™éƒ½éªŒè¯tokenå’Œæœ‰æ•ˆæœŸã€‚\né‚£ä¹ˆæˆ‘çš„é—®é¢˜æ¥äº†ï¼š1.æœåŠ¡å™¨ä¸Šçš„tokenå­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œæ¯æ¬¡æŸ¥è¯¢ä¼šä¸ä¼šå¾ˆè´¹æ—¶ã€‚å¦‚æœä¸å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œåº”è¯¥å­˜å‚¨åˆ°å“ªé‡Œå‘¢ã€‚2.å®¢æˆ·ç«¯å¾—åˆ°çš„tokenè‚¯å®šè¦åŠ å¯†å­˜å‚¨çš„ï¼Œå‘é€tokençš„æ—¶å€™å†è§£å¯†ã€‚å­˜å‚¨åˆ°æ•°æ®åº“è¿˜æ˜¯é…ç½®æ–‡ä»¶å‘¢ï¼Ÿ\ntokenæ˜¯ä¸ªæ˜“å¤±æ•°æ®ï¼Œä¸¢äº†æ— éè®©ç”¨æˆ·é‡æ–°ç™»å½•ä¸€ä¸‹ï¼Œæ–°æµªå¾®åšåŠ¨ä¸åŠ¨å°±è®©æˆ‘é‡æ–°ç™»å½•ï¼Œåæ­£è¿™äº‹å„¿æˆ‘æ˜¯æ— æ‰€è°“å•¦ã€‚ æ‰€ä»¥å¦‚æœä½ è§‰å¾—æ™®é€šçš„æ•°æ®åº“è¡¨æ’‘ä¸ä½äº†ï¼Œå¯ä»¥æ”¾åˆ° MSSQL/MySQL çš„å†…å­˜è¡¨é‡Œï¼ˆä¸è¿‡æ®è¯´mysqlçš„å†…å­˜è¡¨æ€§èƒ½æå‡æœ‰é™ï¼‰ï¼Œå¯ä»¥æ”¾åˆ° Memcacheé‡Œï¼ˆè®²çœŸï¼Œè¿™ä¸ªæ˜¯æŒºå¸¸è§çš„ç­–ç•¥ï¼‰ï¼Œå¯ä»¥æ”¾åˆ°redisé‡Œï¼ˆæˆ‘åšè¿‡è¿™æ ·çš„å®ç°ï¼‰ï¼Œç”šè‡³å¯ä»¥æ”¾åˆ° OpenResty çš„å˜é‡å­—å…¸é‡Œï¼ˆåªè¦ä½ æœ‰ä¿¡å¿ƒä¸çˆ†å†…å­˜ï¼‰ã€‚","title":"Token Cookie SessionåŒºåˆ«"},{"content":"ç®€ä»‹ è¿™æœ‰ç¯‡å¾ˆå¥½çš„æ–‡ç« ï¼Œå¯ä»¥æ˜ç™½è¿™ä¸ªé—®é¢˜:\nä¸ºä»€ä¹ˆä¼šæŠ¥é”™â€œUnicodeEncodeError: 'ascii' codec can't encode characters in position 0-1: ordinal not in range(128)â€ï¼Ÿæœ¬æ–‡å°±æ¥ç ”ç©¶ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚\nå­—ç¬¦ä¸²åœ¨Pythonå†…éƒ¨çš„è¡¨ç¤ºæ˜¯unicodeç¼–ç ï¼Œå› æ­¤ï¼Œåœ¨åšç¼–ç è½¬æ¢æ—¶ï¼Œé€šå¸¸éœ€è¦ä»¥unicodeä½œä¸ºä¸­é—´ç¼–ç ï¼Œå³å…ˆå°†å…¶ä»–ç¼–ç çš„å­—ç¬¦ä¸²è§£ç ï¼ˆdecodeï¼‰æˆunicodeï¼Œå†ä»unicodeç¼–ç ï¼ˆencodeï¼‰æˆå¦ä¸€ç§ç¼–ç ã€‚\ndecodeçš„ä½œç”¨æ˜¯å°†å…¶ä»–ç¼–ç çš„å­—ç¬¦ä¸²è½¬æ¢æˆunicodeç¼–ç ï¼Œå¦‚str1.decode('gb2312')ï¼Œè¡¨ç¤ºå°†gb2312ç¼–ç çš„å­—ç¬¦ä¸²str1è½¬æ¢æˆunicodeç¼–ç ã€‚\nencodeçš„ä½œç”¨æ˜¯å°†unicodeç¼–ç è½¬æ¢æˆå…¶ä»–ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œå¦‚str2.encode('gb2312')ï¼Œè¡¨ç¤ºå°†unicodeç¼–ç çš„å­—ç¬¦ä¸²str2è½¬æ¢æˆgb2312ç¼–ç ã€‚\nå› æ­¤ï¼Œè½¬ç çš„æ—¶å€™ä¸€å®šè¦å…ˆææ˜ç™½ï¼Œå­—ç¬¦ä¸²stræ˜¯ä»€ä¹ˆç¼–ç ï¼Œç„¶ådecodeæˆunicodeï¼Œç„¶åå†encodeæˆå…¶ä»–ç¼–ç \nä»£ç ä¸­å­—ç¬¦ä¸²çš„é»˜è®¤ç¼–ç ä¸ä»£ç æ–‡ä»¶æœ¬èº«çš„ç¼–ç ä¸€è‡´ã€‚\nå¦‚ï¼šs=\u0026lsquo;ä¸­æ–‡\u0026rsquo;\nå¦‚æœæ˜¯åœ¨utf8çš„æ–‡ä»¶ä¸­ï¼Œè¯¥å­—ç¬¦ä¸²å°±æ˜¯utf8ç¼–ç ï¼Œå¦‚æœæ˜¯åœ¨gb2312çš„æ–‡ä»¶ä¸­ï¼Œåˆ™å…¶ç¼–ç ä¸ºgb2312ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè¦è¿›è¡Œç¼–ç è½¬æ¢ï¼Œéƒ½éœ€ è¦å…ˆç”¨decodeæ–¹æ³•å°†å…¶è½¬æ¢æˆunicodeç¼–ç ï¼Œå†ä½¿ç”¨encodeæ–¹æ³•å°†å…¶è½¬æ¢æˆå…¶ä»–ç¼–ç ã€‚é€šå¸¸ï¼Œåœ¨æ²¡æœ‰æŒ‡å®šç‰¹å®šçš„ç¼–ç æ–¹å¼æ—¶ï¼Œéƒ½æ˜¯ä½¿ç”¨çš„ç³»ç»Ÿé»˜ è®¤ç¼–ç åˆ›å»ºçš„ä»£ç æ–‡ä»¶ã€‚\nå¦‚æœå­—ç¬¦ä¸²æ˜¯è¿™æ ·å®šä¹‰ï¼šs=u\u0026rsquo;ä¸­æ–‡'\nåˆ™è¯¥å­—ç¬¦ä¸²çš„ç¼–ç å°±è¢«æŒ‡å®šä¸ºunicodeäº†ï¼Œå³pythonçš„å†…éƒ¨ç¼–ç ï¼Œè€Œä¸ä»£ç æ–‡ä»¶æœ¬èº«çš„ç¼–ç æ— å…³ã€‚å› æ­¤ï¼Œå¯¹äºè¿™ç§æƒ…å†µåšç¼–ç è½¬æ¢ï¼Œåªéœ€è¦ç›´æ¥ä½¿ç”¨encodeæ–¹æ³•å°†å…¶è½¬æ¢æˆæŒ‡å®šç¼–ç å³å¯ã€‚\nå¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²å·²ç»æ˜¯unicodeäº†ï¼Œå†è¿›è¡Œè§£ç åˆ™å°†å‡ºé”™ï¼Œå› æ­¤é€šå¸¸è¦å¯¹å…¶ç¼–ç æ–¹å¼æ˜¯å¦ä¸ºunicodeè¿›è¡Œåˆ¤æ–­ï¼š\nisinstance(s, unicode) #ç”¨æ¥åˆ¤æ–­æ˜¯å¦ä¸ºunicode\nç”¨éunicodeç¼–ç å½¢å¼çš„stræ¥encodeä¼šæŠ¥é”™\nå¦‚ä½•è·å¾—ç³»ç»Ÿçš„é»˜è®¤ç¼–ç ï¼Ÿ\n1 2 3 4 5 6 7 #!/usr/bin/env python #coding=utf-8 import sys print sys.getdefaultencoding() è¯¥æ®µç¨‹åºåœ¨è‹±æ–‡WindowsXPä¸Šè¾“å‡ºä¸ºï¼šascii\nåœ¨æŸäº›IDEä¸­ï¼Œå­—ç¬¦ä¸²çš„è¾“å‡ºæ€»æ˜¯å‡ºç°ä¹±ç ï¼Œç”šè‡³é”™è¯¯ï¼Œå…¶å®æ˜¯ç”±äºIDEçš„ç»“æœè¾“å‡ºæ§åˆ¶å°è‡ªèº«ä¸èƒ½æ˜¾ç¤ºå­—ç¬¦ä¸²çš„ç¼–ç ï¼Œè€Œä¸æ˜¯ç¨‹åºæœ¬èº«çš„é—®é¢˜ã€‚\nå¦‚åœ¨UliPadä¸­è¿è¡Œå¦‚ä¸‹ä»£ç ï¼š\n1 2 3 s=u\u0026#34;ä¸­æ–‡\u0026#34; print s ä¼šæç¤ºï¼šUnicodeEncodeError: 'ascii' codec can't encode characters in position 0-1: ordinal not in range(128)ã€‚è¿™æ˜¯å› ä¸ºUliPadåœ¨è‹±æ–‡WindowsXPä¸Šçš„æ§åˆ¶å°ä¿¡æ¯è¾“å‡ºçª—å£æ˜¯æŒ‰ç…§asciiç¼–ç è¾“å‡ºçš„ï¼ˆè‹±æ–‡ç³»ç»Ÿçš„é»˜è®¤ç¼–ç æ˜¯ asciiï¼‰ï¼Œè€Œä¸Šé¢ä»£ç ä¸­çš„å­—ç¬¦ä¸²æ˜¯Unicodeç¼–ç çš„ï¼Œæ‰€ä»¥è¾“å‡ºæ—¶äº§ç”Ÿäº†é”™è¯¯ã€‚\nå°†æœ€åä¸€å¥æ”¹ä¸ºï¼šprint s.encode('gb2312')\nåˆ™èƒ½æ­£ç¡®è¾“å‡ºâ€œä¸­æ–‡â€ä¸¤ä¸ªå­—ã€‚\nè‹¥æœ€åä¸€å¥æ”¹ä¸ºï¼šprint s.encode('utf8')\nåˆ™è¾“å‡ºï¼š\\xe4\\xb8\\xad\\xe6\\x96\\x87ï¼Œè¿™æ˜¯æ§åˆ¶å°ä¿¡æ¯è¾“å‡ºçª—å£æŒ‰ç…§asciiç¼–ç è¾“å‡ºutf8ç¼–ç çš„å­—ç¬¦ä¸²çš„ç»“æœã€‚\nunicode(str,'gb2312')ä¸str.decode('gb2312')æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å°†gb2312ç¼–ç çš„strè½¬ä¸ºunicodeç¼–ç \nä½¿ç”¨str.__class__å¯ä»¥æŸ¥çœ‹strçš„ç¼–ç å½¢å¼\n1 2 3 4 5 \u0026gt;\u0026gt;\u0026gt;\u0026gt;\u0026gt; groups.google.com/group/python-cn/browse_thread/thread/be4e4e0d4c3272dd ----- pythonæ˜¯ä¸ªå®¹æ˜“å‡ºç°ç¼–ç é—®é¢˜çš„è¯­è¨€ã€‚æ‰€ä»¥ï¼Œæˆ‘æŒ‰ç…§æˆ‘çš„ç†è§£å†™ä¸‹ä¸‹é¢è¿™äº›æ–‡å­—ã€‚\n1. é¦–å…ˆï¼Œè¦äº†è§£å‡ ä¸ªæ¦‚å¿µã€‚ å­—èŠ‚ï¼šè®¡ç®—æœºæ•°æ®çš„è¡¨ç¤ºã€‚8ä½äºŒè¿›åˆ¶ã€‚å¯ä»¥è¡¨ç¤ºæ— ç¬¦å·æ•´æ•°ï¼š0-255ã€‚ä¸‹æ–‡ï¼Œç”¨â€œå­—èŠ‚æµâ€è¡¨ç¤ºâ€œå­—èŠ‚â€ç»„æˆçš„ä¸²ã€‚\nå­—ç¬¦ï¼šè‹±æ–‡å­—ç¬¦â€œabcâ€ï¼Œæˆ–è€…ä¸­æ–‡å­—ç¬¦â€œä½ æˆ‘ä»–â€ã€‚å­—ç¬¦æœ¬èº«ä¸çŸ¥é“å¦‚ä½•åœ¨è®¡ç®—æœºä¸­ä¿å­˜ã€‚ä¸‹æ–‡ä¸­ï¼Œä¼šé¿å…ä½¿ç”¨â€œå­—ç¬¦ä¸²â€è¿™ä¸ªè¯ï¼Œè€Œç”¨â€œæ–‡æœ¬â€æ¥è¡¨\nç¤ºâ€œå­—ç¬¦â€ç»„æˆçš„ä¸²ã€‚\nç¼–ç ï¼ˆåŠ¨è¯ï¼‰ï¼šæŒ‰ç…§æŸç§è§„åˆ™ï¼ˆè¿™ä¸ªè§„åˆ™ç§°ä¸ºï¼šç¼–ç ï¼ˆåè¯ï¼‰ï¼‰å°†â€œæ–‡æœ¬â€è½¬æ¢ä¸ºâ€œå­—èŠ‚æµâ€ã€‚ï¼ˆåœ¨pythonä¸­ï¼šunicodeå˜æˆstrï¼‰\nè§£ç ï¼ˆåŠ¨è¯ï¼‰ï¼šå°†â€œå­—èŠ‚æµâ€æŒ‰ç…§æŸç§è§„åˆ™è½¬æ¢æˆâ€œæ–‡æœ¬â€ã€‚ï¼ˆåœ¨Pythonä¸­ï¼šstrå˜æˆunicodeï¼‰\nå®é™…ä¸Šï¼Œä»»ä½•ä¸œè¥¿åœ¨è®¡ç®—æœºä¸­è¡¨ç¤ºï¼Œéƒ½éœ€è¦ç¼–ç ã€‚ä¾‹å¦‚ï¼Œè§†é¢‘è¦ç¼–ç ç„¶åä¿å­˜åœ¨æ–‡ä»¶ä¸­ï¼Œæ’­æ”¾çš„æ—¶å€™éœ€è¦è§£ç æ‰èƒ½è§‚çœ‹ã€‚\nunicodeï¼šunicodeå®šä¹‰äº†ï¼Œä¸€ä¸ªâ€œå­—ç¬¦â€å’Œä¸€ä¸ªâ€œæ•°å­—â€çš„å¯¹åº”ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è§„å®šè¿™ä¸ªâ€œæ•°å­—â€åœ¨è®¡ç®—æœºä¸­æ€ä¹ˆä¿å­˜ã€‚ï¼ˆå°±åƒåœ¨Cä¸­ï¼Œä¸€ä¸ªæ•´æ•°æ—¢\nå¯ä»¥æ˜¯intï¼Œä¹Ÿå¯ä»¥æ˜¯shortã€‚unicodeæ²¡æœ‰è§„å®šç”¨intè¿˜æ˜¯ç”¨shortæ¥è¡¨ç¤ºä¸€ä¸ªâ€œå­—ç¬¦â€ï¼‰\nutf8ï¼šunicodeå®ç°ã€‚å®ƒä½¿ç”¨unicodeå®šä¹‰çš„â€œå­—ç¬¦â€â€œæ•°å­—â€æ˜ å°„ï¼Œè¿›è€Œè§„å®šäº†ï¼Œå¦‚ä½•åœ¨è®¡ç®—æœºä¸­ä¿å­˜è¿™ä¸ªæ•°å­—ã€‚å…¶å®ƒçš„utf16ç­‰éƒ½æ˜¯ unicodeå®ç°ã€‚\ngbkï¼šç±»ä¼¼utf8è¿™æ ·çš„â€œç¼–ç â€ã€‚ä½†æ˜¯å®ƒæ²¡æœ‰ä½¿ç”¨unicodeå®šä¹‰çš„â€œå­—ç¬¦â€â€œæ•°å­—â€æ˜ å°„ï¼Œè€Œæ˜¯ä½¿ç”¨äº†å¦ä¸€å¥—çš„æ˜ å°„æ–¹æ³•ã€‚è€Œä¸”ï¼Œå®ƒè¿˜å®šä¹‰äº†å¦‚ä½•åœ¨è®¡ç®—æœºä¸­ä¿å­˜ã€‚\n2. pythonä¸­çš„encodeï¼Œdecodeæ–¹æ³• é¦–å…ˆï¼Œè¦çŸ¥é“encodeæ˜¯ unicodeè½¬æ¢æˆstrã€‚decodeæ˜¯strè½¬æ¢æˆunicodeã€‚\nä¸‹æ–‡ä¸­ï¼Œuä»£è¡¨unicodeç±»å‹çš„å˜é‡ï¼Œsä»£è¡¨strç±»å‹çš„å˜é‡ã€‚\nu.encode('...')åŸºæœ¬ä¸Šæ€»æ˜¯èƒ½æˆåŠŸçš„ï¼Œåªè¦ä½ å¡«å†™äº†æ­£ç¡®çš„ç¼–ç ã€‚å°±åƒä»»ä½•æ–‡ä»¶éƒ½å¯ä»¥å‹ç¼©æˆzipæ–‡ä»¶ã€‚\ns.decode('...')ç»å¸¸æ˜¯ä¼šå‡ºé”™çš„ï¼Œå› ä¸ºstræ˜¯ä»€ä¹ˆâ€œç¼–ç â€å–å†³äºä¸Šä¸‹æ–‡ï¼Œå½“ä½ è§£ç çš„æ—¶å€™éœ€è¦ç¡®ä¿sæ˜¯ç”¨ä»€ä¹ˆç¼–ç çš„ã€‚å°±åƒï¼Œæ‰“å¼€zipæ–‡ä»¶çš„æ—¶å€™ï¼Œä½ è¦ç¡®ä¿å®ƒç¡®å®æ˜¯zipæ–‡ä»¶ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¼ªé€ äº†æ‰©å±•åçš„zipæ–‡ä»¶ã€‚\nu.decode(),s.encode()ä¸å»ºè®®ä½¿ç”¨ï¼Œs.encodeç›¸å½“äºs.decode().encode()é¦–å…ˆç”¨é»˜è®¤ç¼–ç ï¼ˆä¸€èˆ¬æ˜¯asciiï¼‰è½¬æ¢æˆunicodeåœ¨è¿›è¡Œencodeã€‚\n3. å…³äº#coding=utf8= å½“ä½ åœ¨pyæ–‡ä»¶çš„ç¬¬ä¸€è¡Œä¸­ï¼Œå†™äº†è¿™å¥è¯ï¼Œå¹¶ç¡®å®æŒ‰ç…§è¿™ä¸ªç¼–ç ä¿å­˜äº†æ–‡æœ¬çš„è¯ï¼Œé‚£ä¹ˆè¿™å¥è¯æœ‰ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ã€‚\n1.ä½¿å¾—è¯æ³•åˆ†æå™¨èƒ½æ­£å¸¸è¿ä½œï¼Œå¯¹äºæ³¨é‡Šä¸­çš„ä¸­æ–‡ä¸æŠ¥é”™äº†ã€‚\n2.å¯¹äºu\u0026quot;ä¸­æ–‡\u0026quot;è¿™æ ·literal stringèƒ½çŸ¥é“ä¸¤ä¸ªå¼•å·ä¸­çš„å†…å®¹æ˜¯utf8ç¼–ç çš„ï¼Œç„¶åèƒ½æ­£ç¡®è½¬æ¢æˆunicode\n3.\u0026ldquo;ä¸­æ–‡\u0026quot;å¯¹äºè¿™æ ·çš„literal stringä½ ä¼šçŸ¥é“ï¼Œè¿™ä¸­é—´çš„å†…å®¹æ˜¯utf8ç¼–ç ï¼Œç„¶åå°±å¯ä»¥æ­£ç¡®è½¬æ¢æˆå…¶å®ƒç¼–ç æˆ–unicodeäº†ã€‚\n4. Pythonç¼–ç å’ŒWindowsæ§åˆ¶å° æˆ‘å‘ç°ï¼Œå¾ˆå¤šåˆå­¦è€…å‡ºé”™çš„åœ°æ–¹éƒ½åœ¨printè¯­å¥ï¼Œè¿™ç‰µæ¶‰åˆ°æ§åˆ¶å°çš„è¾“å‡ºã€‚æˆ‘ä¸äº†è§£linuxï¼Œæ‰€ä»¥åªè¯´æ§åˆ¶å°çš„ã€‚\né¦–å…ˆï¼ŒWindowsçš„æ§åˆ¶å°ç¡®å®æ˜¯unicodeï¼ˆutf16_leç¼–ç ï¼‰çš„ï¼Œæˆ–è€…æ›´å‡†ç¡®çš„è¯´ä½¿ç”¨å­—ç¬¦ä¸ºå•ä½è¾“å‡ºæ–‡æœ¬çš„ã€‚\nä½†æ˜¯ï¼Œç¨‹åºçš„æ‰§è¡Œæ˜¯å¯ä»¥è¢«é‡å®šå‘åˆ°æ–‡ä»¶çš„ï¼Œè€Œæ–‡ä»¶çš„å•ä½æ˜¯â€œå­—èŠ‚â€ã€‚\næ‰€ä»¥ï¼Œå¯¹äºCè¿è¡Œæ—¶çš„å‡½æ•°printfä¹‹ç±»çš„ï¼Œè¾“å‡ºå¿…é¡»æœ‰ä¸€ä¸ªç¼–ç ï¼ŒæŠŠæ–‡æœ¬è½¬æ¢æˆå­—èŠ‚ã€‚å¯èƒ½æ˜¯ä¸ºäº†å…¼å®¹95ï¼Œ98ï¼Œ\næ²¡æœ‰ä½¿ç”¨unicodeçš„ç¼–ç ï¼Œè€Œæ˜¯mbcsï¼ˆä¸æ˜¯gbkä¹‹ç±»çš„ï¼‰ã€‚\nwindowsçš„mbcsï¼Œä¹Ÿå°±æ˜¯ansiï¼Œå®ƒä¼šåœ¨ä¸åŒè¯­è¨€çš„windowsä¸­ä½¿ç”¨ä¸åŒçš„ç¼–ç ï¼Œåœ¨ä¸­æ–‡çš„windowsä¸­å°±æ˜¯gbç³»åˆ—çš„ç¼–ç ã€‚\nè¿™é€ æˆäº†åŒä¸€ä¸ªæ–‡æœ¬ï¼Œåœ¨ä¸åŒè¯­è¨€çš„windowsä¸­æ˜¯ä¸å…¼å®¹çš„ã€‚\nç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ï¼Œå¦‚æœä½ è¦åœ¨windowsçš„æ§åˆ¶å°ä¸­è¾“å‡ºæ–‡æœ¬ï¼Œå®ƒçš„ç¼–ç ä¸€å®šè¦æ˜¯â€œmbcsâ€ã€‚\nå¯¹äºpythonçš„unicodeå˜é‡ï¼Œä½¿ç”¨printè¾“å‡ºçš„è¯ï¼Œä¼šä½¿ç”¨sys.getfilesystemencoding()è¿”å›çš„ç¼–ç ï¼ŒæŠŠå®ƒå˜æˆstrã€‚\nå¦‚æœæ˜¯ä¸€ä¸ªutf8ç¼–ç strå˜é‡ï¼Œé‚£ä¹ˆå°±éœ€è¦ print s.decode(\u0026lsquo;utf8\u0026rsquo;).encode(\u0026lsquo;mbcs\u0026rsquo;)\næœ€åï¼Œå¯¹äºstrå˜é‡ï¼Œfileæ–‡ä»¶è¯»å–çš„å†…å®¹ï¼Œurllibå¾—åˆ°çš„ç½‘ç»œä¸Šçš„å†…å®¹ï¼Œéƒ½æ˜¯ä»¥â€œå­—èŠ‚â€å½¢å¼çš„ã€‚\nå®ƒä»¬å¦‚æœç¡®å®æ˜¯ä¸€æ®µâ€œæ–‡æœ¬â€ï¼Œæ¯”å¦‚ä½ æƒ³printå‡ºæ¥çœ‹çœ‹ã€‚é‚£ä¹ˆä½ å¿…é¡»çŸ¥é“å®ƒä»¬çš„ç¼–ç ã€‚ç„¶ådecodeæˆunicodeã€‚\nå¦‚ä½•çŸ¥é“å®ƒä»¬çš„ç¼–ç ï¼š\näº‹å…ˆçº¦å®šã€‚ï¼ˆæ¯”å¦‚è¿™ä¸ªæ–‡æœ¬æ–‡ä»¶å°±æ˜¯ä½ è‡ªå·±ç”¨utf8ç¼–ç ä¿å­˜çš„ï¼‰ åè®®ã€‚ï¼ˆpythonæ–‡ä»¶ç¬¬ä¸€è¡Œçš„#coding=utf8ï¼Œhtmlä¸­çš„ç­‰ï¼‰ çŒœã€‚ è¿™ä¸ªéå¸¸å¥½ï¼Œä½†è¿˜ä¸æ˜¯å¾ˆæ˜ç™½å°†â€œæ–‡æœ¬â€è½¬æ¢ä¸ºâ€œå­—èŠ‚æµâ€ã€‚ï¼ˆåœ¨pythonä¸­ï¼šunicodeå˜æˆstrï¼‰\n\u0026ldquo;æœ€åï¼Œå¯¹äºstrå˜é‡ï¼Œfileæ–‡ä»¶è¯»å–çš„å†…å®¹ï¼Œurllibå¾—åˆ°çš„ç½‘ç»œä¸Šçš„å†…å®¹ï¼Œéƒ½æ˜¯ä»¥â€œå­—èŠ‚â€å½¢å¼çš„ã€‚\u0026rdquo;\nè™½ç„¶æ–‡ä»¶æˆ–è€…ç½‘é¡µæ˜¯æ–‡æœ¬çš„,ä½†æ˜¯åœ¨ä¿å­˜æˆ–è€…ä¼ è¾“æ—¶å·²ç»è¢«ç¼–ç æˆbytesäº†,æ‰€ä»¥ç”¨\u0026quot;rb\u0026quot;æ‰“å¼€çš„fileå’Œä»socketè¯»å–çš„æµæ˜¯åŸºäºå­—èŠ‚çš„.\n\u0026ldquo;å®ƒä»¬å¦‚æœç¡®å®æ˜¯ä¸€æ®µâ€œæ–‡æœ¬â€ï¼Œæ¯”å¦‚ä½ æƒ³printå‡ºæ¥çœ‹çœ‹ã€‚é‚£ä¹ˆä½ å¿…é¡»çŸ¥é“å®ƒä»¬çš„ç¼–ç ã€‚ç„¶ådecodeæˆunicodeã€‚\u0026rdquo;\nè¿™é‡Œçš„åŠ å¼•å·çš„\u0026quot;æ–‡æœ¬\u0026rdquo;,å…¶å®è¿˜æ˜¯å­—èŠ‚æµ(bytes),è€Œä¸æ˜¯çœŸæ­£çš„æ–‡æœ¬(unicode),åªæ˜¯è¯´æ˜æˆ‘ä»¬çŸ¥é“ä»–æ˜¯å¯ä»¥è§£ç æˆæ–‡æœ¬çš„.\nåœ¨è§£ç çš„æ—¶å€™,å¦‚æœæ˜¯åŸºäºçº¦å®šçš„,é‚£å°±å¯ä»¥ç›´æ¥ä»æŒ‡å®šåœ°æ–¹è¯»å–å¦‚BOMæˆ–è€…pythonæ–‡ä»¶çš„æŒ‡å®šcodingæˆ–è€…ç½‘é¡µçš„meta,å°±å¯ä»¥æ­£ç¡®è§£ç ,\nä½†æ˜¯ç°åœ¨å¾ˆå¤šæ–‡ä»¶/ç½‘é¡µè™½ç„¶æŒ‡å®šäº†ç¼–ç ,ä½†æ˜¯æ–‡ä»¶æ ¼å¼å®é™…å´ä½¿ç”¨äº†å…¶ä»–çš„ç¼–ç (æ¯”å¦‚pyæ–‡ä»¶æŒ‡å®šäº†coding=utf8,ä½†æ˜¯ä½ è¿˜æ˜¯å¯ä»¥ä¿å­˜æˆansi\u0026ndash;è®°äº‹æœ¬çš„é»˜è®¤ç¼–ç ),è¿™ç§æƒ…å†µä¸‹çœŸå®çš„ç¼–ç å°±éœ€è¦å»çŒœäº†\nè§£ç äº†çš„æ–‡æœ¬åªå­˜åœ¨è¿è¡Œç¯å¢ƒä¸­,å¦‚æœä½ éœ€è¦æ‰“å°/ä¿å­˜/è¾“å‡ºç»™æ•°æ®åº“/ç½‘ç»œä¼ é€’,å°±åˆéœ€è¦ä¸€æ¬¡ç¼–ç è¿‡ç¨‹,è¿™ä¸ªç¼–ç ä¸ä¸Šé¢çš„ç¼–ç æ²¡æœ‰å…³ç³»,åªæ˜¯ä¾èµ–äºä½ çš„é€‰æ‹©,ä½†æ˜¯è¿™ä¸ªç¼–ç ä¹Ÿä¸æ˜¯å¯ä»¥éšä¾¿é€‰æ‹©çš„,å› ä¸ºç¼–ç åçš„byteså¦‚æœåˆéœ€è¦ä¼ é€’ç»™å…¶ä»–äºº/ç¯å¢ƒ,é‚£ä¹ˆå¦‚æœä½ çš„ç¼–ç ä¹Ÿä¸éµå¾ªçº¦å®š,åˆç»™ä¸‹ä¸€ä¸ªäºº/ç¯å¢ƒé€ æˆäº†å›°æ‰°,äºæ˜¯é€’å½’ä¹‹~~~~\nä¸»è¦æœ‰ä¸€æ¡éå¸¸å®¹æ˜“è¯¯è§£ï¼š\nä¸€èˆ¬äººä¼šè®¤ä¸ºUnicodeï¼ˆå¹¿ä¹‰ï¼‰ç»Ÿä¸€äº†ç¼–ç ï¼Œå…¶å®ä¸ç„¶ã€‚Unicodeä¸æ˜¯å”¯ä¸€çš„ç¼–ç ï¼Œè€Œä¸€å¤§å †ç¼–ç çš„ç»Ÿç§°ã€‚ä½†æ˜¯Windowsä¸‹Unicodeï¼ˆç‹­ä¹‰ï¼‰ä¸€èˆ¬ç‰¹æŒ‡UCS2ï¼Œä¹Ÿå°±æ˜¯UTF-16/LE\nunicodeä½œä¸ºå­—ç¬¦é›†(ucs)æ˜¯å”¯ä¸€çš„,ç¼–ç æ–¹æ¡ˆ(utf)æ‰æ˜¯æœ‰å¾ˆå¤šç§\nå°†å­—ç¬¦ä¸å­—èŠ‚çš„æ¦‚å¿µåŒºåˆ†å¼€æ¥æ˜¯å¾ˆé‡è¦çš„ã€‚Java ä¸€ç›´å°±æ˜¯è¿™æ ·ï¼ŒPythonä¹Ÿå¼€å§‹è¿™ä¹ˆåšäº†ï¼ŒRuby è²Œä¼¼è¿˜åœ¨æ··ä¹±å½“ä¸­ã€‚\næˆ‘ä¹Ÿè¯´ä¸¤å¥ã€‚æˆ‘å¯¹ç¼–ç çš„ç ”ç©¶ç›¸å¯¹æ¯”è¾ƒæ·±ä¸€äº›ã€‚å› ä¸ºå·¥ä½œä¸­ä¹Ÿç»å¸¸é‡åˆ°ä¹±ç ï¼Œäºæ˜¯åœ¨05å¹´ï¼Œå¯¹ç¼–ç ä¸“é—¨åšè¿‡ç ”ç©¶ï¼Œå¹¶åœ¨å…¬å¸åˆŠç‰©ä¸Šå‘è¿‡æ–‡ç« ï¼Œæœ€åå½¢æˆäº†ä¸€ä¸ªæ•™æï¼Œæ¯å¹´åœ¨å…¬å¸ç»™æ–°å‘˜å·¥éƒ½è®²ä¸€éã€‚äºæ˜¯é¡¹ç›®ä¸­é‡åˆ°ä¹±ç çš„é—®é¢˜å°±èƒ½å¾ˆå¿«çš„å®šä½å¹¶è§£å†³äº†ã€‚\nç†è®ºä¸Šï¼Œä»ä¸€ä¸ªå­—ç¬¦åˆ°å…·ä½“çš„ç¼–ç ï¼Œä¼šç»è¿‡ä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µã€‚\nå­—ç¬¦é›†ï¼ˆAbstract character repertoireï¼‰ ç¼–ç å­—ç¬¦é›†ï¼ˆCoded character setï¼‰ å­—ç¬¦ç¼–ç æ–¹å¼ï¼ˆCharacter encoding formï¼‰ å­—ç¬¦ç¼–ç æ–¹æ¡ˆï¼ˆCharacter encoding schemeï¼‰ å­—ç¬¦é›†ï¼šå°±ç®—ä¸€å †æŠ½è±¡çš„å­—ç¬¦ï¼Œå¦‚æ‰€æœ‰ä¸­æ–‡ã€‚å­—ç¬¦é›†çš„å®šä¹‰æ˜¯æŠ½è±¡çš„ï¼Œä¸è®¡ç®—æœºæ— å…³ã€‚ ç¼–ç å­—ç¬¦é›†ï¼šæ˜¯ä¸€ä¸ªä»æ•´æ•°é›†å­é›†åˆ°å­—ç¬¦é›†æŠ½è±¡å…ƒç´ çš„æ˜ å°„ã€‚å³ç»™æŠ½è±¡çš„å­—ç¬¦ç¼–ä¸Šæ•°å­—ã€‚å¦‚gb2312ä¸­çš„å®šä¹‰çš„å­—ç¬¦ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½æœ‰ä¸ªæ•´æ•°å’Œå®ƒå¯¹åº”ã€‚ä¸€ä¸ªæ•´æ•°åªå¯¹åº”ç€ä¸€ä¸ªå­—ç¬¦ã€‚åè¿‡æ¥ï¼Œåˆ™ä¸ä¸€å®šæ˜¯ã€‚è¿™é‡Œæ‰€è¯´çš„æ˜ å°„å…³ç³»ï¼Œæ˜¯æ•°å­¦æ„ä¹‰ä¸Šçš„æ˜ å°„å…³ç³»ã€‚ç¼–ç å­—ç¬¦é›†ä¹Ÿæ˜¯ä¸è®¡ç®—æœºæ— å…³çš„ã€‚unicodeå­—ç¬¦é›†ä¹Ÿåœ¨è¿™ä¸€å±‚ã€‚ å­—ç¬¦ç¼–ç æ–¹å¼ï¼šè¿™ä¸ªå¼€å§‹ä¸è®¡ç®—æœºæœ‰å…³äº†ã€‚ç¼–ç å­—ç¬¦é›†çš„ç¼–ç ç‚¹åœ¨è®¡ç®—æœºé‡Œçš„å…·ä½“è¡¨ç°å½¢å¼ã€‚é€šä¿—çš„è¯´ï¼Œæ„æ€å°±æ˜¯æ€ä¹ˆæ ·æ‰èƒ½å°†å­—ç¬¦æ‰€å¯¹åº”çš„æ•´æ•°çš„æ”¾è¿›è®¡ç®—æœºå†…å­˜ï¼Œæˆ–æ–‡ä»¶ã€æˆ–ç½‘ç»œä¸­ã€‚äºæ˜¯ï¼Œä¸åŒäººæœ‰ä¸åŒçš„å®ç°æ–¹å¼ï¼Œæ‰€è°“çš„ä¸‡ç å¥”è…¾ï¼Œå°±æ˜¯æŒ‡è¿™ä¸ªã€‚gb2312ï¼Œutf-8,utf-16,utf-32ç­‰éƒ½åœ¨è¿™ä¸€å±‚ã€‚ å­—ç¬¦ç¼–ç æ–¹æ¡ˆï¼šè¿™ä¸ªæ›´åŠ ä¸è®¡ç®—æœºå¯†åˆ‡ç›¸å…³ã€‚å…·ä½“æ˜¯ä¸æ“ä½œç³»ç»Ÿå¯†åˆ‡ç›¸å…³ã€‚ä¸»è¦æ˜¯è§£å†³å¤§å°å­—èŠ‚åºçš„é—®é¢˜ã€‚å¯¹äºUTF-16å’ŒUTF-32 ç¼–ç ï¼ŒUnicodeéƒ½æ”¯æŒbig-endianå’Œlittle-endianä¸¤ç§ç¼–ç æ–¹æ¡ˆã€‚\nä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬æ‰€è¯´çš„ç¼–ç ï¼Œéƒ½åœ¨ç¬¬ä¸‰å±‚å®Œæˆã€‚å…·ä½“åˆ°ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿä¸­ï¼Œåˆ™å¾ˆå¤æ‚ã€‚\næµè§ˆå™¨ï¼apacheï¼tomcatï¼ˆåŒ…æ‹¬tomcatå†…éƒ¨çš„jspç¼–ç ã€ç¼–è¯‘ï¼Œæ–‡ä»¶è¯»å–ï¼‰ï¼æ•°æ®åº“ä¹‹é—´ï¼Œåªè¦å­˜åœ¨æ•°æ®äº¤äº’ï¼Œå°±æœ‰å¯èƒ½å‘ç”Ÿç¼–ç ä¸ä¸€è‡´ï¼Œå¦‚æœåœ¨è¯»å–æ•°æ®æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®çš„decodeå’Œencodeï¼Œå‡ºç°ä¹±ç å°±æ˜¯å®¶å¸¸ä¾¿é¥­äº†ã€‚\n","permalink":"https://reid00.github.io/en/posts/langs_linux/unicode%E7%BC%96%E7%A0%81%E4%B8%8Epython/","summary":"ç®€ä»‹ è¿™æœ‰ç¯‡å¾ˆå¥½çš„æ–‡ç« ï¼Œå¯ä»¥æ˜ç™½è¿™ä¸ªé—®é¢˜:\nä¸ºä»€ä¹ˆä¼šæŠ¥é”™â€œUnicodeEncodeError: 'ascii' codec can't encode characters in position 0-1: ordinal not in range(128)â€ï¼Ÿæœ¬æ–‡å°±æ¥ç ”ç©¶ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚\nå­—ç¬¦ä¸²åœ¨Pythonå†…éƒ¨çš„è¡¨ç¤ºæ˜¯unicodeç¼–ç ï¼Œå› æ­¤ï¼Œåœ¨åšç¼–ç è½¬æ¢æ—¶ï¼Œé€šå¸¸éœ€è¦ä»¥unicodeä½œä¸ºä¸­é—´ç¼–ç ï¼Œå³å…ˆå°†å…¶ä»–ç¼–ç çš„å­—ç¬¦ä¸²è§£ç ï¼ˆdecodeï¼‰æˆunicodeï¼Œå†ä»unicodeç¼–ç ï¼ˆencodeï¼‰æˆå¦ä¸€ç§ç¼–ç ã€‚\ndecodeçš„ä½œç”¨æ˜¯å°†å…¶ä»–ç¼–ç çš„å­—ç¬¦ä¸²è½¬æ¢æˆunicodeç¼–ç ï¼Œå¦‚str1.decode('gb2312')ï¼Œè¡¨ç¤ºå°†gb2312ç¼–ç çš„å­—ç¬¦ä¸²str1è½¬æ¢æˆunicodeç¼–ç ã€‚\nencodeçš„ä½œç”¨æ˜¯å°†unicodeç¼–ç è½¬æ¢æˆå…¶ä»–ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œå¦‚str2.encode('gb2312')ï¼Œè¡¨ç¤ºå°†unicodeç¼–ç çš„å­—ç¬¦ä¸²str2è½¬æ¢æˆgb2312ç¼–ç ã€‚\nå› æ­¤ï¼Œè½¬ç çš„æ—¶å€™ä¸€å®šè¦å…ˆææ˜ç™½ï¼Œå­—ç¬¦ä¸²stræ˜¯ä»€ä¹ˆç¼–ç ï¼Œç„¶ådecodeæˆunicodeï¼Œç„¶åå†encodeæˆå…¶ä»–ç¼–ç \nä»£ç ä¸­å­—ç¬¦ä¸²çš„é»˜è®¤ç¼–ç ä¸ä»£ç æ–‡ä»¶æœ¬èº«çš„ç¼–ç ä¸€è‡´ã€‚\nå¦‚ï¼šs=\u0026lsquo;ä¸­æ–‡\u0026rsquo;\nå¦‚æœæ˜¯åœ¨utf8çš„æ–‡ä»¶ä¸­ï¼Œè¯¥å­—ç¬¦ä¸²å°±æ˜¯utf8ç¼–ç ï¼Œå¦‚æœæ˜¯åœ¨gb2312çš„æ–‡ä»¶ä¸­ï¼Œåˆ™å…¶ç¼–ç ä¸ºgb2312ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè¦è¿›è¡Œç¼–ç è½¬æ¢ï¼Œéƒ½éœ€ è¦å…ˆç”¨decodeæ–¹æ³•å°†å…¶è½¬æ¢æˆunicodeç¼–ç ï¼Œå†ä½¿ç”¨encodeæ–¹æ³•å°†å…¶è½¬æ¢æˆå…¶ä»–ç¼–ç ã€‚é€šå¸¸ï¼Œåœ¨æ²¡æœ‰æŒ‡å®šç‰¹å®šçš„ç¼–ç æ–¹å¼æ—¶ï¼Œéƒ½æ˜¯ä½¿ç”¨çš„ç³»ç»Ÿé»˜ è®¤ç¼–ç åˆ›å»ºçš„ä»£ç æ–‡ä»¶ã€‚\nå¦‚æœå­—ç¬¦ä¸²æ˜¯è¿™æ ·å®šä¹‰ï¼šs=u\u0026rsquo;ä¸­æ–‡'\nåˆ™è¯¥å­—ç¬¦ä¸²çš„ç¼–ç å°±è¢«æŒ‡å®šä¸ºunicodeäº†ï¼Œå³pythonçš„å†…éƒ¨ç¼–ç ï¼Œè€Œä¸ä»£ç æ–‡ä»¶æœ¬èº«çš„ç¼–ç æ— å…³ã€‚å› æ­¤ï¼Œå¯¹äºè¿™ç§æƒ…å†µåšç¼–ç è½¬æ¢ï¼Œåªéœ€è¦ç›´æ¥ä½¿ç”¨encodeæ–¹æ³•å°†å…¶è½¬æ¢æˆæŒ‡å®šç¼–ç å³å¯ã€‚\nå¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²å·²ç»æ˜¯unicodeäº†ï¼Œå†è¿›è¡Œè§£ç åˆ™å°†å‡ºé”™ï¼Œå› æ­¤é€šå¸¸è¦å¯¹å…¶ç¼–ç æ–¹å¼æ˜¯å¦ä¸ºunicodeè¿›è¡Œåˆ¤æ–­ï¼š\nisinstance(s, unicode) #ç”¨æ¥åˆ¤æ–­æ˜¯å¦ä¸ºunicode\nç”¨éunicodeç¼–ç å½¢å¼çš„stræ¥encodeä¼šæŠ¥é”™\nå¦‚ä½•è·å¾—ç³»ç»Ÿçš„é»˜è®¤ç¼–ç ï¼Ÿ\n1 2 3 4 5 6 7 #!/usr/bin/env python #coding=utf-8 import sys print sys.getdefaultencoding() è¯¥æ®µç¨‹åºåœ¨è‹±æ–‡WindowsXPä¸Šè¾“å‡ºä¸ºï¼šascii\nåœ¨æŸäº›IDEä¸­ï¼Œå­—ç¬¦ä¸²çš„è¾“å‡ºæ€»æ˜¯å‡ºç°ä¹±ç ï¼Œç”šè‡³é”™è¯¯ï¼Œå…¶å®æ˜¯ç”±äºIDEçš„ç»“æœè¾“å‡ºæ§åˆ¶å°è‡ªèº«ä¸èƒ½æ˜¾ç¤ºå­—ç¬¦ä¸²çš„ç¼–ç ï¼Œè€Œä¸æ˜¯ç¨‹åºæœ¬èº«çš„é—®é¢˜ã€‚\nå¦‚åœ¨UliPadä¸­è¿è¡Œå¦‚ä¸‹ä»£ç ï¼š\n1 2 3 s=u\u0026#34;ä¸­æ–‡\u0026#34; print s ä¼šæç¤ºï¼šUnicodeEncodeError: 'ascii' codec can't encode characters in position 0-1: ordinal not in range(128)ã€‚è¿™æ˜¯å› ä¸ºUliPadåœ¨è‹±æ–‡WindowsXPä¸Šçš„æ§åˆ¶å°ä¿¡æ¯è¾“å‡ºçª—å£æ˜¯æŒ‰ç…§asciiç¼–ç è¾“å‡ºçš„ï¼ˆè‹±æ–‡ç³»ç»Ÿçš„é»˜è®¤ç¼–ç æ˜¯ asciiï¼‰ï¼Œè€Œä¸Šé¢ä»£ç ä¸­çš„å­—ç¬¦ä¸²æ˜¯Unicodeç¼–ç çš„ï¼Œæ‰€ä»¥è¾“å‡ºæ—¶äº§ç”Ÿäº†é”™è¯¯ã€‚\nå°†æœ€åä¸€å¥æ”¹ä¸ºï¼šprint s.","title":"Unicodeç¼–ç ä¸Python"},{"content":"æ¦‚è¿° å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ï¼Œleveldbæ˜¯å…¸å‹çš„LSMæ ‘(Log Structured-Merge Tree)å®ç°ï¼Œå³ä¸€æ¬¡leveldbçš„å†™å…¥è¿‡ç¨‹å¹¶ä¸æ˜¯ç›´æ¥å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯å°†å†™æ“ä½œé¦–å…ˆå†™å…¥æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå…¶æ¬¡å°†å†™æ“ä½œåº”ç”¨åœ¨memtableä¸Šã€‚\nå½“leveldbè¾¾åˆ°checkpointç‚¹ï¼ˆmemtableä¸­çš„æ•°æ®é‡è¶…è¿‡äº†é¢„è®¾çš„é˜ˆå€¼ï¼‰ï¼Œä¼šå°†å½“å‰memtableå†»ç»“æˆä¸€ä¸ªä¸å¯æ›´æ”¹çš„å†…å­˜æ•°æ®åº“ï¼ˆimmutable memory dbï¼‰ï¼Œå¹¶ä¸”åˆ›å»ºä¸€ä¸ªæ–°çš„memtableä¾›ç³»ç»Ÿç»§ç»­ä½¿ç”¨ã€‚\nimmutable memory dbä¼šåœ¨åå°è¿›è¡Œä¸€æ¬¡minor compactionï¼Œå³å°†å†…å­˜æ•°æ®åº“ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜æ–‡ä»¶ä¸­ã€‚\nåœ¨è¿™é‡Œæˆ‘ä»¬æš‚æ—¶ä¸å±•å¼€è®¨è®ºminor compactionç›¸å…³çš„å†…å®¹ï¼Œè¯»è€…å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºå°†å†…å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°æ–‡ä»¶\nleveldbï¼ˆæˆ–è€…è¯´LSMæ ‘ï¼‰è®¾è®¡Minor Compactionçš„ç›®çš„æ˜¯ä¸ºäº†ï¼š\næœ‰æ•ˆåœ°é™ä½å†…å­˜çš„ä½¿ç”¨ç‡ï¼› é¿å…æ—¥å¿—æ–‡ä»¶è¿‡å¤§ï¼Œç³»ç»Ÿæ¢å¤æ—¶é—´è¿‡é•¿ï¼› å½“memory dbçš„æ•°æ®è¢«æŒä¹…åŒ–åˆ°æ–‡ä»¶ä¸­æ—¶ï¼Œleveldbå°†ä»¥ä¸€å®šè§„åˆ™è¿›è¡Œæ–‡ä»¶ç»„ç»‡ï¼Œè¿™ç§æ–‡ä»¶æ ¼å¼æˆä¸ºsstableã€‚åœ¨æœ¬æ–‡ä¸­å°†è¯¦ç»†åœ°ä»‹ç»sstableçš„æ–‡ä»¶æ ¼å¼ä»¥åŠç›¸å…³è¯»å†™æ“ä½œã€‚\nSStableæ–‡ä»¶æ ¼å¼ ç‰©ç†ç»“æ„ ä¸ºäº†æé«˜æ•´ä½“çš„è¯»å†™æ•ˆç‡ï¼Œä¸€ä¸ªsstableæ–‡ä»¶æŒ‰ç…§å›ºå®šå¤§å°è¿›è¡Œå—åˆ’åˆ†ï¼Œé»˜è®¤æ¯ä¸ªå—çš„å¤§å°ä¸º4KiBã€‚æ¯ä¸ªBlockä¸­ï¼Œé™¤äº†å­˜å‚¨æ•°æ®ä»¥å¤–ï¼Œè¿˜ä¼šå­˜å‚¨ä¸¤ä¸ªé¢å¤–çš„è¾…åŠ©å­—æ®µï¼š\nå‹ç¼©ç±»å‹ CRCæ ¡éªŒç  å‹ç¼©ç±»å‹è¯´æ˜äº†Blockä¸­å­˜å‚¨çš„æ•°æ®æ˜¯å¦è¿›è¡Œäº†æ•°æ®å‹ç¼©ï¼Œè‹¥æ˜¯ï¼Œé‡‡ç”¨äº†å“ªç§ç®—æ³•è¿›è¡Œå‹ç¼©ã€‚leveldbä¸­é»˜è®¤é‡‡ç”¨Snappyç®—æ³•è¿›è¡Œå‹ç¼©ã€‚ CRCæ ¡éªŒç æ˜¯å¾ªç¯å†—ä½™æ ¡éªŒæ ¡éªŒç ï¼Œæ ¡éªŒèŒƒå›´åŒ…æ‹¬æ•°æ®ä»¥åŠå‹ç¼©ç±»å‹ã€‚ é€»è¾‘ç»“æ„ åœ¨é€»è¾‘ä¸Šï¼Œæ ¹æ®åŠŸèƒ½ä¸åŒï¼Œleveldbåœ¨é€»è¾‘ä¸Šåˆå°†sstableåˆ†ä¸ºï¼š\ndata block: ç”¨æ¥å­˜å‚¨key valueæ•°æ®å¯¹ï¼› filter block: ç”¨æ¥å­˜å‚¨ä¸€äº›è¿‡æ»¤å™¨ç›¸å…³çš„æ•°æ®ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰ï¼Œä½†æ˜¯è‹¥ç”¨æˆ·ä¸æŒ‡å®šleveldbä½¿ç”¨è¿‡æ»¤å™¨ï¼Œleveldbåœ¨è¯¥blockä¸­ä¸ä¼šå­˜å‚¨ä»»ä½•å†…å®¹ï¼› meta Index block: ç”¨æ¥å­˜å‚¨filter blockçš„ç´¢å¼•ä¿¡æ¯ï¼ˆç´¢å¼•ä¿¡æ¯æŒ‡åœ¨è¯¥sstableæ–‡ä»¶ä¸­çš„åç§»é‡ä»¥åŠæ•°æ®é•¿åº¦ï¼‰ï¼› index blockï¼šindex blockä¸­ç”¨æ¥å­˜å‚¨æ¯ä¸ªdata blockçš„ç´¢å¼•ä¿¡æ¯ï¼› footer: ç”¨æ¥å­˜å‚¨meta index blockåŠindex blockçš„ç´¢å¼•ä¿¡æ¯ï¼› æ³¨æ„ï¼Œ1-4ç±»å‹çš„åŒºå—ï¼Œå…¶ç‰©ç†ç»“æ„éƒ½æ˜¯å¦‚1.1èŠ‚æ‰€ç¤ºï¼Œæ¯ä¸ªåŒºå—éƒ½ä¼šæœ‰è‡ªå·±çš„å‹ç¼©ä¿¡æ¯ä»¥åŠCRCæ ¡éªŒç ä¿¡æ¯ã€‚\ndata blockç»“æ„ data blockä¸­å­˜å‚¨çš„æ•°æ®æ˜¯leveldbä¸­çš„keyvalueé”®å€¼å¯¹ã€‚å…¶ä¸­ä¸€ä¸ªdata blockä¸­çš„æ•°æ®éƒ¨åˆ†ï¼ˆä¸åŒ…æ‹¬å‹ç¼©ç±»å‹ã€CRCæ ¡éªŒç ï¼‰æŒ‰é€»è¾‘åˆä»¥ä¸‹å›¾è¿›è¡Œåˆ’åˆ†ï¼š ç¬¬ä¸€éƒ¨åˆ†ç”¨æ¥å­˜å‚¨keyvalueæ•°æ®ã€‚ç”±äºsstableä¸­æ‰€æœ‰çš„keyvalueå¯¹éƒ½æ˜¯ä¸¥æ ¼æŒ‰åºå­˜å‚¨çš„ï¼Œä¸ºäº†èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œleveldbå¹¶ä¸ä¼šä¸ºæ¯ä¸€å¯¹keyvalueå¯¹éƒ½å­˜å‚¨å®Œæ•´çš„keyå€¼ï¼Œè€Œæ˜¯å­˜å‚¨ä¸ä¸Šä¸€ä¸ªkeyéå…±äº«çš„éƒ¨åˆ†ï¼Œé¿å…äº†keyé‡å¤å†…å®¹çš„å­˜å‚¨ã€‚\næ¯é—´éš”è‹¥å¹²ä¸ªkeyvalueå¯¹ï¼Œå°†ä¸ºè¯¥æ¡è®°å½•é‡æ–°å­˜å‚¨ä¸€ä¸ªå®Œæ•´çš„keyã€‚é‡å¤è¯¥è¿‡ç¨‹ï¼ˆé»˜è®¤é—´éš”å€¼ä¸º16ï¼‰ï¼Œæ¯ä¸ªé‡æ–°å­˜å‚¨å®Œæ•´keyçš„ç‚¹ç§°ä¹‹ä¸ºRestart pointã€‚\næ¯é—´éš”è‹¥å¹²ä¸ªkeyvalueå¯¹ï¼Œå°†ä¸ºè¯¥æ¡è®°å½•é‡æ–°å­˜å‚¨ä¸€ä¸ªå®Œæ•´çš„keyã€‚é‡å¤è¯¥è¿‡ç¨‹ï¼ˆé»˜è®¤é—´éš”å€¼ä¸º16ï¼‰ï¼Œæ¯ä¸ªé‡æ–°å­˜å‚¨å®Œæ•´keyçš„ç‚¹ç§°ä¹‹ä¸ºRestart pointã€‚\næ¯ä¸ªæ•°æ®é¡¹çš„æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸€ä¸ªentryåˆ†ä¸º5éƒ¨åˆ†å†…å®¹ï¼š\nä¸å‰ä¸€æ¡è®°å½•keyå…±äº«éƒ¨åˆ†çš„é•¿åº¦ï¼› ä¸å‰ä¸€æ¡è®°å½•keyä¸å…±äº«éƒ¨åˆ†çš„é•¿åº¦ï¼› valueé•¿åº¦ï¼› ä¸å‰ä¸€æ¡è®°å½•keyéå…±äº«çš„å†…å®¹ï¼› valueå†…å®¹ï¼› ä¾‹å¦‚ï¼š\n1 2 3 4 restart_interval=2 entry one : key=deck,value=v1 entry two : key=dock,value=v2 entry three: key=duck,value=v3 ä¸‰ç»„entryæŒ‰ä¸Šå›¾çš„æ ¼å¼è¿›è¡Œå­˜å‚¨ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯restart_intervalä¸º2ï¼Œå› æ­¤æ¯éš”ä¸¤ä¸ªentryéƒ½ä¼šæœ‰ä¸€æ¡æ•°æ®ä½œä¸ºrestart pointç‚¹çš„æ•°æ®é¡¹ï¼Œå­˜å‚¨å®Œæ•´keyå€¼ã€‚å› æ­¤entry3å­˜å‚¨äº†å®Œæ•´çš„keyã€‚\næ­¤å¤–ï¼Œç¬¬ä¸€ä¸ªrestart pointä¸º0ï¼ˆåç§»é‡ï¼‰ï¼Œç¬¬äºŒä¸ªrestart pointä¸º16ï¼Œrestart pointå…±æœ‰ä¸¤ä¸ªï¼Œå› æ­¤ä¸€ä¸ªdatablockæ•°æ®æ®µçš„æœ«å°¾æ·»åŠ äº†ä¸‹å›¾æ‰€ç¤ºçš„æ•°æ®ï¼š å°¾éƒ¨æ•°æ®è®°å½•äº†æ¯ä¸€ä¸ªrestart pointçš„å€¼ï¼Œä»¥åŠæ‰€æœ‰restart pointçš„ä¸ªæ•°ã€‚\nfilter blockç»“æ„ è®²å®Œäº†data blockï¼Œåœ¨è¿™ä¸€ç« èŠ‚å°†å±•å¼€è®²è¿°filter blockçš„ç»“æ„ã€‚\nä¸ºäº†åŠ å¿«sstableä¸­æ•°æ®æŸ¥è¯¢çš„æ•ˆç‡ï¼Œåœ¨ç›´æ¥æŸ¥è¯¢datablockä¸­çš„å†…å®¹ä¹‹å‰ï¼Œleveldbé¦–å…ˆæ ¹æ®filter blockä¸­çš„è¿‡æ»¤æ•°æ®åˆ¤æ–­æŒ‡å®šçš„datablockä¸­æ˜¯å¦æœ‰éœ€è¦æŸ¥è¯¢çš„æ•°æ®ï¼Œè‹¥åˆ¤æ–­ä¸å­˜åœ¨ï¼Œåˆ™æ— éœ€å¯¹è¿™ä¸ªdatablockè¿›è¡Œæ•°æ®æŸ¥æ‰¾ã€‚\nfilter blockå­˜å‚¨çš„æ˜¯data blockæ•°æ®çš„ä¸€äº›è¿‡æ»¤ä¿¡æ¯ã€‚è¿™äº›è¿‡æ»¤æ•°æ®ä¸€èˆ¬æŒ‡ä»£å¸ƒéš†è¿‡æ»¤å™¨çš„æ•°æ®ï¼Œç”¨äºåŠ å¿«æŸ¥è¯¢çš„é€Ÿåº¦ï¼Œå…³äºå¸ƒéš†è¿‡æ»¤å™¨çš„è¯¦ç»†å†…å®¹ï¼Œå¯ä»¥è§ã€ŠLeveldbæºç åˆ†æ - å¸ƒéš†è¿‡æ»¤å™¨ã€‹ã€‚ filter blockå­˜å‚¨çš„æ•°æ®ä¸»è¦å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šï¼ˆ1ï¼‰è¿‡æ»¤æ•°æ®ï¼ˆ2ï¼‰ç´¢å¼•æ•°æ®ã€‚\nå…¶ä¸­ç´¢å¼•æ•°æ®ä¸­ï¼Œfilter i offsetè¡¨ç¤ºç¬¬iä¸ªfilter dataåœ¨æ•´ä¸ªfilter blockä¸­çš„èµ·å§‹åç§»é‡ï¼Œfilter offset\u0026rsquo;s offsetè¡¨ç¤ºfilter blockçš„ç´¢å¼•æ•°æ®åœ¨filter blockä¸­çš„åç§»é‡ã€‚\nåœ¨è¯»å–filter blockä¸­çš„å†…å®¹æ—¶ï¼Œå¯ä»¥é¦–å…ˆè¯»å‡ºfilter offset\u0026rsquo;s offsetçš„å€¼ï¼Œç„¶åä¾æ¬¡è¯»å–filter i offsetï¼Œæ ¹æ®è¿™äº›offsetåˆ†åˆ«è¯»å‡ºfilter dataã€‚\nBase Lgé»˜è®¤å€¼ä¸º11ï¼Œè¡¨ç¤ºæ¯2KBçš„æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„è¿‡æ»¤å™¨æ¥å­˜æ”¾è¿‡æ»¤æ•°æ®ã€‚\nä¸€ä¸ªsstableåªæœ‰ä¸€ä¸ªfilter blockï¼Œå…¶å†…å­˜å‚¨äº†æ‰€æœ‰blockçš„filteræ•°æ®. å…·ä½“æ¥è¯´ï¼Œfilter_data_k åŒ…å«äº†æ‰€æœ‰èµ·å§‹ä½ç½®å¤„äº [basek, base(k+1)]èŒƒå›´å†…çš„blockçš„keyçš„é›†åˆçš„filteræ•°æ®ï¼ŒæŒ‰æ•°æ®å¤§å°è€Œéblockåˆ‡åˆ†ä¸»è¦æ˜¯ä¸ºäº†å°½é‡å‡åŒ€ï¼Œä»¥åº”å¯¹å­˜åœ¨ä¸€äº›blockçš„keyå¾ˆå¤šï¼Œå¦ä¸€äº›blockçš„keyå¾ˆå°‘çš„æƒ…å†µã€‚\nleveldbä¸­ï¼Œç‰¹æ®Šçš„sstableæ–‡ä»¶æ ¼å¼è®¾è®¡ç®€åŒ–äº†è®¸å¤šæ“ä½œï¼Œä¾‹å¦‚ï¼š ç´¢å¼•å’ŒBloomFilterç­‰å…ƒæ•°æ®å¯éšæ–‡ä»¶ä¸€èµ·åˆ›å»ºå’Œé”€æ¯ï¼Œå³ç›´æ¥å­˜åœ¨æ–‡ä»¶é‡Œï¼Œä¸ç”¨åŠ è½½æ—¶åŠ¨æ€è®¡ç®—ï¼Œä¸ç”¨ç»´æŠ¤æ›´æ–°\nmeta index blockç»“æ„ meta index blockç”¨æ¥å­˜å‚¨filter blockåœ¨æ•´ä¸ªsstableä¸­çš„ç´¢å¼•ä¿¡æ¯ã€‚\nmeta index blockåªå­˜å‚¨ä¸€æ¡è®°å½•ï¼š\nè¯¥è®°å½•çš„keyä¸ºï¼š\u0026ldquo;filter.\u0026ldquo;ä¸è¿‡æ»¤å™¨åå­—ç»„æˆçš„å¸¸é‡å­—ç¬¦ä¸²\nè¯¥è®°å½•çš„valueä¸ºï¼šfilter blockåœ¨sstableä¸­çš„ç´¢å¼•ä¿¡æ¯åºåˆ—åŒ–åçš„å†…å®¹ï¼Œç´¢å¼•ä¿¡æ¯åŒ…æ‹¬ï¼šï¼ˆ1ï¼‰åœ¨sstableä¸­çš„åç§»é‡ï¼ˆ2ï¼‰æ•°æ®é•¿åº¦ã€‚\nindex blockç»“æ„ ä¸meta index blockç±»ä¼¼ï¼Œindex blockç”¨æ¥å­˜å‚¨æ‰€æœ‰data blockçš„ç›¸å…³ç´¢å¼•ä¿¡æ¯ã€‚\nindexblockåŒ…å«è‹¥å¹²æ¡è®°å½•ï¼Œæ¯ä¸€æ¡è®°å½•ä»£è¡¨ä¸€ä¸ªdata blockçš„ç´¢å¼•ä¿¡æ¯ã€‚\nä¸€æ¡ç´¢å¼•åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š\ndata block i ä¸­æœ€å¤§çš„keyå€¼ï¼› è¯¥data blockèµ·å§‹åœ°å€åœ¨sstableä¸­çš„åç§»é‡ï¼› è¯¥data blockçš„å¤§å°ï¼› å…¶ä¸­ï¼Œdata block iæœ€å¤§çš„keyå€¼è¿˜æ˜¯index blockä¸­è¯¥æ¡è®°å½•çš„keyå€¼ã€‚ å¦‚æ­¤è®¾è®¡çš„ç›®çš„æ˜¯ï¼Œä¾æ¬¡æ¯”è¾ƒindex blockä¸­è®°å½•ä¿¡æ¯çš„keyå€¼å³å¯å®ç°å¿«é€Ÿå®šä½ç›®æ ‡æ•°æ®åœ¨å“ªä¸ªdata blockä¸­ã€‚\nfooterç»“æ„ footerå¤§å°å›ºå®šï¼Œä¸º48å­—èŠ‚ï¼Œç”¨æ¥å­˜å‚¨meta index blockä¸index blockåœ¨sstableä¸­çš„ç´¢å¼•ä¿¡æ¯ï¼Œå¦å¤–å°¾éƒ¨è¿˜ä¼šå­˜å‚¨ä¸€ä¸ªmagic wordï¼Œå†…å®¹ä¸ºï¼š\u0026ldquo;http://code.google.com/p/leveldb/\u0026quot;å­—ç¬¦ä¸²sha1å“ˆå¸Œçš„å‰8ä¸ªå­—èŠ‚ã€‚ è¯»å†™æ“ä½œ åœ¨ä»‹ç»å®Œsstableæ–‡ä»¶å…·ä½“çš„ç»„ç»‡æ–¹å¼ä¹‹åï¼Œæˆ‘ä»¬å†æ¥ä»‹ç»ä¸€ä¸‹ç›¸å…³çš„è¯»å†™æ“ä½œã€‚ä¸ºäº†ä¾¿äºè¯»è€…ç†è§£ï¼Œå°†é¦–å…ˆä»‹ç»å†™æ“ä½œã€‚\nå†™æ“ä½œ sstableçš„å†™æ“ä½œé€šå¸¸å‘ç”Ÿåœ¨ï¼š\nmemory dbå°†å†…å®¹æŒä¹…åŒ–åˆ°ç£ç›˜æ–‡ä»¶ä¸­æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªsstableè¿›è¡Œå†™å…¥ï¼› leveldbåå°è¿›è¡Œæ–‡ä»¶compactionæ—¶ï¼Œä¼šå°†è‹¥å¹²ä¸ªsstableæ–‡ä»¶çš„å†…å®¹é‡æ–°ç»„ç»‡ï¼Œè¾“å‡ºåˆ°è‹¥å¹²ä¸ªæ–°çš„sstableæ–‡ä»¶ä¸­ï¼› å¯¹sstableè¿›è¡Œå†™æ“ä½œçš„æ•°æ®ç»“æ„ä¸ºtWriterï¼Œå…·ä½“å®šä¹‰å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 // tWriter wraps the table writer. It keep track of file descriptor // and added key range. type tWriter struct { t *tOps fd storage.FileDesc // æ–‡ä»¶æè¿°ç¬¦ w storage.Writer // æ–‡ä»¶ç³»ç»Ÿwriter tw *table.Writer first, last []byte } ä¸»è¦åŒ…æ‹¬äº†ä¸€ä¸ªsstableçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œåº•å±‚æ–‡ä»¶ç³»ç»Ÿçš„writerï¼Œè¯¥sstableä¸­æ‰€æœ‰æ•°æ®é¡¹æœ€å¤§æœ€å°çš„keyå€¼ä»¥åŠä¸€ä¸ªå†…åµŒçš„tableWriterã€‚\nä¸€æ¬¡sstableçš„å†™å…¥ä¸ºä¸€æ¬¡ä¸æ–­åˆ©ç”¨è¿­ä»£å™¨è¯»å–éœ€è¦å†™å…¥çš„æ•°æ®ï¼Œå¹¶ä¸æ–­è°ƒç”¨tableWriterçš„Appendå‡½æ•°ï¼Œç›´è‡³æ‰€æœ‰æœ‰æ•ˆæ•°æ®è¯»å–å®Œæ¯•ï¼Œä¸ºè¯¥sstableæ–‡ä»¶é™„ä¸Šå…ƒæ•°æ®çš„è¿‡ç¨‹ã€‚\nè¯¥è¿­ä»£å™¨å¯ä»¥æ˜¯ä¸€ä¸ªå†…å­˜æ•°æ®åº“çš„è¿­ä»£å™¨ï¼Œå†™å…¥æƒ…æ™¯å¯¹åº”ç€ä¸Šè¿°çš„ç¬¬ä¸€ç§æƒ…å†µï¼›\nè¯¥è¿­ä»£å™¨ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªsstableæ–‡ä»¶çš„è¿­ä»£å™¨ï¼Œå†™å…¥æƒ…æ™¯å¯¹åº”ç€ä¸Šè¿°çš„ç¬¬äºŒç§æƒ…å†µï¼›\nsstableçš„å…ƒæ•°æ®åŒ…æ‹¬ï¼šï¼ˆ1ï¼‰æ–‡ä»¶ç¼–ç ï¼ˆ2ï¼‰å¤§å°ï¼ˆ3ï¼‰æœ€å¤§keyå€¼ï¼ˆ4ï¼‰æœ€å°keyå€¼\næ•…ï¼Œç†è§£tableWriterçš„Appendå‡½æ•°æ˜¯ç†è§£æ•´ä¸ªå†™å…¥è¿‡ç¨‹çš„å…³é”®ã€‚\ntableWriter åœ¨ä»‹ç»appendå‡½æ•°ä¹‹å‰ï¼Œé¦–å…ˆä»‹ç»ä¸€ä¸‹tableWriterè¿™ä¸ªæ•°æ®ç»“æ„ã€‚ä¸»è¦çš„å®šä¹‰å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 // Writer is a table writer. type Writer struct { writer io.Writer // Options blockSize int // é»˜è®¤æ˜¯4KiB dataBlock blockWriter // dataå—Writer indexBlock blockWriter // indexBlockå—Writer filterBlock filterWriter // filterå—Writer pendingBH blockHandle offset uint64 nEntries int // key-valueé”®å€¼å¯¹ä¸ªæ•° } å…¶ä¸­blockWriterä¸filterWriterè¡¨ç¤ºåº•å±‚çš„ä¸¤ç§ä¸åŒçš„writerï¼ŒblockWriterè´Ÿè´£å†™å…¥dataæ•°æ®çš„å†™å…¥ï¼Œè€ŒfilterWriterè´Ÿè´£å†™å…¥è¿‡æ»¤æ•°æ®ã€‚\npendingBHè®°å½•äº†ä¸Šä¸€ä¸ªdataBlockçš„ç´¢å¼•ä¿¡æ¯ï¼Œå½“ä¸‹ä¸€ä¸ªdataBlockçš„æ•°æ®å¼€å§‹å†™å…¥æ—¶ï¼Œå°†è¯¥ç´¢å¼•ä¿¡æ¯å†™å…¥indexBlockä¸­ã€‚\nAppend ä¸€æ¬¡appendå‡½æ•°çš„ä¸»è¦é€»è¾‘å¦‚ä¸‹ï¼š\nè‹¥æœ¬æ¬¡å†™å…¥ä¸ºæ–°dataBlockçš„ç¬¬ä¸€æ¬¡å†™å…¥ï¼Œåˆ™å°†ä¸Šä¸€ä¸ªdataBlockçš„ç´¢å¼•ä¿¡æ¯å†™å…¥ï¼› å°†keyvalueæ•°æ®å†™å…¥datablock; å°†è¿‡æ»¤ä¿¡æ¯å†™å…¥filterBlockï¼› è‹¥datablockä¸­çš„æ•°æ®è¶…è¿‡é¢„å®šä¸Šé™ï¼Œåˆ™æ ‡å¿—ç€æœ¬æ¬¡datablockå†™å…¥ç»“æŸï¼Œå°†å†…å®¹åˆ·æ–°åˆ°ç£ç›˜æ–‡ä»¶ä¸­ï¼› 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 func (w *Writer) Append(key, value []byte) error { w.flushPendingBH(key) // Append key/value pair to the data block. w.dataBlock.append(key, value) // Add key to the filter block. w.filterBlock.add(key) // Finish the data block if block size target reached. if w.dataBlock.bytesLen() \u0026gt;= w.blockSize { if err := w.finishBlock(); err != nil { w.err = err return w.err } } w.nEntries++ return nil } dataBlock.append è¯¥å‡½æ•°å°†ç¼–ç åçš„kvæ•°æ®å†™å…¥åˆ°dataBlockå¯¹åº”çš„bufferä¸­ï¼Œç¼–ç çš„æ ¼å¼å¦‚ä¸Šæ–‡ä¸­æåˆ°çš„æ•°æ®é¡¹çš„æ ¼å¼ã€‚æ­¤å¤–ï¼Œåœ¨å†™å…¥çš„è¿‡ç¨‹ä¸­ï¼Œè‹¥è¯¥æ•°æ®é¡¹ä¸ºrestartç‚¹ï¼Œåˆ™ä¼šæ·»åŠ ç›¸åº”çš„restart pointä¿¡æ¯ã€‚\nfilterBlock.append è¯¥å‡½æ•°å°†kvæ•°æ®é¡¹çš„keyå€¼åŠ å…¥åˆ°è¿‡æ»¤ä¿¡æ¯ä¸­ï¼Œå…·ä½“å¯è§ã€ŠLeveldbæºç è§£æ - å¸ƒéš†è¿‡æ»¤å™¨ã€‹\nfinishBlock è‹¥ä¸€ä¸ªdatablockä¸­çš„æ•°æ®è¶…è¿‡äº†å›ºå®šä¸Šé™ï¼Œåˆ™éœ€è¦å°†ç›¸å…³æ•°æ®å†™å…¥åˆ°ç£ç›˜æ–‡ä»¶ä¸­ã€‚\nåœ¨å†™å…¥æ—¶ï¼Œéœ€è¦åšä»¥ä¸‹å·¥ä½œï¼š\nå°è£…dataBlockï¼Œè®°å½•restart pointçš„ä¸ªæ•°ï¼› è‹¥dataBlockçš„æ•°æ®éœ€è¦è¿›è¡Œå‹ç¼©ï¼ˆä¾‹å¦‚snappyå‹ç¼©ç®—æ³•ï¼‰ï¼Œåˆ™å¯¹dataBlockä¸­çš„æ•°æ®è¿›è¡Œå‹ç¼©ï¼› è®¡ç®—checksumï¼› å°è£…dataBlockç´¢å¼•ä¿¡æ¯ï¼ˆoffsetï¼Œlengthï¼‰ï¼› å°†datablockçš„bufferä¸­çš„æ•°æ®å†™å…¥ç£ç›˜æ–‡ä»¶ï¼› åˆ©ç”¨è¿™æ®µæ—¶é—´é‡Œç»´æŠ¤çš„è¿‡æ»¤ä¿¡æ¯ç”Ÿæˆè¿‡æ»¤æ•°æ®ï¼Œæ”¾å…¥filterBlockå¯¹ç”¨çš„bufferä¸­ï¼› Close å½“è¿­ä»£å™¨å–å‡ºæ‰€æœ‰æ•°æ®å¹¶å®Œæˆå†™å…¥åï¼Œè°ƒç”¨tableWriterçš„Closeå‡½æ•°å®Œæˆæœ€åçš„æ”¶å°¾å·¥ä½œï¼š\nè‹¥bufferä¸­ä»æœ‰æœªå†™å…¥çš„æ•°æ®ï¼Œå°è£…æˆä¸€ä¸ªdatablockå†™å…¥ï¼› å°†filterBlockçš„å†…å®¹å†™å…¥ç£ç›˜æ–‡ä»¶ï¼› å°†filterBlockçš„ç´¢å¼•ä¿¡æ¯å†™å…¥metaIndexBlockä¸­ï¼Œå†™å…¥åˆ°ç£ç›˜æ–‡ä»¶ï¼› å†™å…¥indexBlockçš„æ•°æ®ï¼› å†™å…¥footeræ•°æ®ï¼› è‡³æ­¤ä¸ºæ­¢ï¼Œæ‰€æœ‰çš„æ•°æ®å·²ç»è¢«å†™å…¥åˆ°ä¸€ä¸ªsstableä¸­äº†ï¼Œç”±äºä¸€ä¸ªsstableæ˜¯ä½œä¸ºä¸€ä¸ªmemory dbæˆ–è€…Compactionçš„ç»“æœåŸå­æ€§è½åœ°çš„ï¼Œå› æ­¤åœ¨sstableå†™å…¥å®Œæˆä¹‹åï¼Œå°†è¿›è¡Œæ›´ä¸ºå¤æ‚çš„leveldbçš„ç‰ˆæœ¬æ›´æ–°ï¼Œå°†åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­ç»§ç»­ä»‹ç»ã€‚\nè¯»æ“ä½œ è¯»æ“ä½œä½œä¸ºå†™æ“ä½œçš„é€†è¿‡ç¨‹ï¼Œå……åˆ†ç†è§£äº†å†™æ“ä½œï¼Œå°†ä¼šå¸®åŠ©ç†è§£è¯»æ“ä½œã€‚\nä¸‹å›¾ä¸ºåœ¨ä¸€ä¸ªsstableä¸­æŸ¥æ‰¾æŸä¸ªæ•°æ®é¡¹çš„æµç¨‹å›¾ï¼š å¤§è‡´æµç¨‹ä¸ºï¼š\né¦–å…ˆåˆ¤æ–­â€œæ–‡ä»¶å¥æŸ„â€cacheä¸­æ˜¯å¦æœ‰æŒ‡å®šsstableæ–‡ä»¶çš„æ–‡ä»¶å¥æŸ„ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™ç›´æ¥ä½¿ç”¨cacheä¸­çš„å¥æŸ„ï¼›å¦åˆ™æ‰“å¼€è¯¥sstableæ–‡ä»¶ï¼ŒæŒ‰è§„åˆ™è¯»å–è¯¥æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œå°†æ–°æ‰“å¼€çš„å¥æŸ„å­˜å‚¨è‡³cacheä¸­ï¼› åˆ©ç”¨sstableä¸­çš„index blockè¿›è¡Œå¿«é€Ÿçš„æ•°æ®é¡¹ä½ç½®å®šä½ï¼Œå¾—åˆ°è¯¥æ•°æ®é¡¹æœ‰å¯èƒ½å­˜åœ¨çš„ä¸¤ä¸ªdata blockï¼› åˆ©ç”¨index blockä¸­çš„ç´¢å¼•ä¿¡æ¯ï¼Œé¦–å…ˆæ‰“å¼€ç¬¬ä¸€ä¸ªå¯èƒ½çš„data blockï¼› åˆ©ç”¨filter blockä¸­çš„è¿‡æ»¤ä¿¡æ¯ï¼Œåˆ¤æ–­æŒ‡å®šçš„æ•°æ®é¡¹æ˜¯å¦å­˜åœ¨äºè¯¥data blockä¸­ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨å¯¹data blockä¸­çš„æ•°æ®è¿›è¡Œè¿­ä»£éå†ï¼Œå¯»æ‰¾æ•°æ®é¡¹ï¼›è‹¥ä¸å­˜åœ¨ï¼Œåˆ™ç»“æŸè¯¥data blockçš„æŸ¥æ‰¾ï¼› è‹¥åœ¨ç¬¬ä¸€ä¸ªdata blockä¸­æ‰¾åˆ°äº†ç›®æ ‡æ•°æ®ï¼Œåˆ™è¿”å›ç»“æœï¼›è‹¥æœªæŸ¥æ‰¾æˆåŠŸï¼Œåˆ™æ‰“å¼€ç¬¬äºŒä¸ªdata blockï¼Œé‡å¤æ­¥éª¤4ï¼› è‹¥åœ¨ç¬¬äºŒä¸ªdata blockä¸­æ‰¾åˆ°äº†ç›®æ ‡æ•°æ®ï¼Œåˆ™è¿”å›ç»“æœï¼›è‹¥æœªæŸ¥æ‰¾æˆåŠŸï¼Œåˆ™è¿”å›Not Foundé”™è¯¯ä¿¡æ¯ï¼› ç¼“å­˜ åœ¨leveldbä¸­ï¼Œä½¿ç”¨cacheæ¥ç¼“å­˜ä¸¤ç±»æ•°æ®ï¼š\nsstableæ–‡ä»¶å¥æŸ„åŠå…¶å…ƒæ•°æ®ï¼› data blockä¸­çš„æ•°æ®ï¼› å› æ­¤åœ¨æ‰“å¼€æ–‡ä»¶ä¹‹å‰ï¼Œé¦–å…ˆåˆ¤æ–­èƒ½å¤Ÿåœ¨cacheä¸­å‘½ä¸­sstableçš„æ–‡ä»¶å¥æŸ„ï¼Œé¿å…é‡å¤è¯»å–çš„å¼€é”€ã€‚ å…ƒæ•°æ®è¯»å– ç”±äºsstableå¤æ‚çš„æ–‡ä»¶ç»„ç»‡æ ¼å¼ï¼Œå› æ­¤åœ¨æ‰“å¼€æ–‡ä»¶åï¼Œéœ€è¦è¯»å–å¿…è¦çš„å…ƒæ•°æ®ï¼Œæ‰èƒ½è®¿é—®sstableä¸­çš„æ•°æ®ã€‚\nå…ƒæ•°æ®è¯»å–çš„è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\nè¯»å–æ–‡ä»¶çš„æœ€å48å­—èŠ‚çš„åˆ©ç”¨ï¼Œå³Footeræ•°æ®ï¼› è¯»å–Footeræ•°æ®ä¸­ç»´æŠ¤çš„(1) Meta Index Block(2) Index Blockä¸¤ä¸ªéƒ¨åˆ†çš„ç´¢å¼•ä¿¡æ¯å¹¶è®°å½•ï¼Œä»¥æé«˜æ•´ä½“çš„æŸ¥è¯¢æ•ˆç‡ï¼› åˆ©ç”¨meta index blockçš„ç´¢å¼•ä¿¡æ¯è¯»å–è¯¥éƒ¨åˆ†çš„å†…å®¹ï¼› éå†meta index blockï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨â€œæœ‰ç”¨â€çš„filter blockçš„ç´¢å¼•ä¿¡æ¯ï¼Œè‹¥æœ‰ï¼Œåˆ™è®°å½•è¯¥ç´¢å¼•ä¿¡æ¯ï¼›è‹¥æ²¡æœ‰ï¼Œåˆ™è¡¨ç¤ºå½“å‰sstableä¸­ä¸å­˜åœ¨ä»»ä½•è¿‡æ»¤ä¿¡æ¯æ¥æé«˜æŸ¥è¯¢æ•ˆç‡ï¼› æ•°æ®é¡¹çš„å¿«é€Ÿå®šä½ sstableä¸­å­˜åœ¨å¤šä¸ªdata blockï¼Œå€˜è‹¥ä¾æ¬¡è¿›è¡Œâ€œéå†â€æ˜¾ç„¶æ˜¯ä¸å¯å–çš„ã€‚ä½†æ˜¯ç”±äºä¸€ä¸ªsstableä¸­æ‰€æœ‰çš„æ•°æ®é¡¹éƒ½æ˜¯æŒ‰åºæ’åˆ—çš„ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨æœ‰åºæ€§å·²ç»index blockä¸­ç»´æŠ¤çš„ç´¢å¼•ä¿¡æ¯å¿«é€Ÿå®šä½ç›®æ ‡æ•°æ®é¡¹å¯èƒ½å­˜åœ¨çš„data blockã€‚\nä¸€ä¸ªindex blockçš„æ–‡ä»¶ç»“æ„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š index blockæ˜¯ç”±ä¸€ç³»åˆ—çš„é”®å€¼å¯¹ç»„æˆï¼Œæ¯ä¸€ä¸ªé”®å€¼å¯¹è¡¨ç¤ºä¸€ä¸ªdata blockçš„ç´¢å¼•ä¿¡æ¯ã€‚\né”®å€¼å¯¹çš„keyä¸ºè¯¥data blockä¸­æ•°æ®é¡¹keyçš„æœ€å¤§å€¼ï¼Œvalueä¸ºè¯¥data blockçš„ç´¢å¼•ä¿¡æ¯ï¼ˆoffset, lengthï¼‰ã€‚\nå› æ­¤è‹¥éœ€è¦æŸ¥æ‰¾ç›®æ ‡æ•°æ®é¡¹ï¼Œä»…ä»…éœ€è¦ä¾æ¬¡æ¯”è¾ƒindex blockä¸­çš„è¿™äº›ç´¢å¼•ä¿¡æ¯ï¼Œå€˜è‹¥ç›®æ ‡æ•°æ®é¡¹çš„keyå¤§äºæŸä¸ªdata blockä¸­æœ€å¤§çš„keyå€¼ï¼Œåˆ™è¯¥data blockä¸­å¿…ç„¶ä¸å­˜åœ¨ç›®æ ‡æ•°æ®é¡¹ã€‚æ•…é€šè¿‡è¿™ä¸ªæ­¥éª¤çš„ä¼˜åŒ–ï¼Œå¯ä»¥ç›´æ¥ç¡®å®šç›®æ ‡æ•°æ®é¡¹è½åœ¨å“ªä¸ªdata blockçš„èŒƒå›´åŒºé—´å†…ã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸data blockä¸€æ ·ï¼Œindex blockä¸­çš„ç´¢å¼•ä¿¡æ¯åŒæ ·ä¹Ÿè¿›è¡Œäº†keyå€¼æˆªå–ï¼Œå³ç¬¬äºŒä¸ªç´¢å¼•ä¿¡æ¯çš„keyå¹¶ä¸æ˜¯å­˜å‚¨å®Œæ•´çš„keyï¼Œè€Œæ˜¯å­˜å‚¨ä¸å‰ä¸€ä¸ªç´¢å¼•ä¿¡æ¯çš„keyä¸å…±äº«çš„éƒ¨åˆ†ï¼ŒåŒºåˆ«åœ¨äºdata blockä¸­è¿™ç§èŒƒå›´çš„åˆ’åˆ†ç²’åº¦ä¸º16ï¼Œè€Œindex blockä¸­ä¸º2 ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œindex blockè¿ç»­ä¸¤æ¡ç´¢å¼•ä¿¡æ¯ä¼šè¢«ä½œä¸ºä¸€ä¸ªæœ€å°çš„â€œæ¯”è¾ƒå•å…ƒâ€œï¼Œåœ¨æŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­ï¼Œè‹¥ç¬¬ä¸€ä¸ªç´¢å¼•ä¿¡æ¯çš„keyå°äºç›®æ ‡æ•°æ®é¡¹çš„keyï¼Œåˆ™ç´§æ¥ç€ä¼šæ¯”è¾ƒç¬¬ä¸‰æ¡ç´¢å¼•ä¿¡æ¯çš„keyã€‚ è¿™å°±å¯¼è‡´æœ€ç»ˆç›®æ ‡æ•°æ®é¡¹çš„èŒƒå›´åŒºé—´ä¸ºæŸâ€ä¸¤ä¸ªâ€œdata blockã€‚\nè¿‡æ»¤data block è‹¥sstableå­˜æœ‰æ¯ä¸€ä¸ªdata blockçš„è¿‡æ»¤æ•°æ®ï¼Œåˆ™å¯ä»¥åˆ©ç”¨è¿™äº›è¿‡æ»¤æ•°æ®å¯¹data blockä¸­çš„å†…å®¹è¿›è¡Œåˆ¤æ–­ï¼Œâ€œç¡®å®šâ€ç›®æ ‡æ•°æ®æ˜¯å¦å­˜åœ¨äºdata blockä¸­ã€‚\nè¿‡æ»¤çš„åŸç†ä¸ºï¼š\nè‹¥è¿‡æ»¤æ•°æ®æ˜¾ç¤ºç›®æ ‡æ•°æ®ä¸å­˜åœ¨äºdata blockä¸­ï¼Œåˆ™ç›®æ ‡æ•°æ®ä¸€å®šä¸å­˜åœ¨äºdata blockä¸­ï¼› è‹¥è¿‡æ»¤æ•°æ®æ˜¾ç¤ºç›®æ ‡æ•°æ®å­˜åœ¨äºdata blockä¸­ï¼Œåˆ™ç›®æ ‡æ•°æ®å¯èƒ½å­˜åœ¨äºdata blockä¸­ï¼› å…·ä½“çš„åŸç†å¯èƒ½å‚è§ã€Šå¸ƒéš†è¿‡æ»¤å™¨ã€‹ã€‚ å› æ­¤åˆ©ç”¨è¿‡æ»¤æ•°æ®å¯ä»¥è¿‡æ»¤æ‰éƒ¨åˆ†data blockï¼Œé¿å…å‘ç”Ÿæ— è°“çš„æŸ¥æ‰¾ã€‚\næŸ¥æ‰¾data block åœ¨data blockä¸­æŸ¥æ‰¾ç›®æ ‡æ•°æ®é¡¹æ˜¯ä¸€ä¸ªç®€å•çš„è¿­ä»£éå†è¿‡ç¨‹ã€‚è™½ç„¶data blockä¸­æ‰€æœ‰æ•°æ®é¡¹éƒ½æ˜¯æŒ‰åºæ’åºçš„ï¼Œä½†æ˜¯ä½œè€…å¹¶æ²¡æœ‰é‡‡ç”¨â€œäºŒåˆ†æŸ¥æ‰¾â€æ¥æé«˜æŸ¥æ‰¾çš„æ•ˆç‡ï¼Œè€Œæ˜¯ä½¿ç”¨äº†æ›´å¤§çš„æŸ¥æ‰¾å•å…ƒè¿›è¡Œå¿«é€Ÿå®šä½ã€‚\nä¸index blockçš„æŸ¥æ‰¾ç±»ä¼¼ï¼Œdata blockä¸­ï¼Œä»¥16æ¡è®°å½•ä¸ºä¸€ä¸ªæŸ¥æ‰¾å•å…ƒï¼Œè‹¥entry 1çš„keyå°äºç›®æ ‡æ•°æ®é¡¹çš„keyï¼Œåˆ™ä¸‹ä¸€æ¡æ¯”è¾ƒçš„æ˜¯entry 17ã€‚\nå› æ­¤æŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­ï¼Œåˆ©ç”¨æ›´å¤§çš„æŸ¥æ‰¾å•å…ƒå¿«é€Ÿå®šä½ç›®æ ‡æ•°æ®é¡¹å¯èƒ½å­˜åœ¨äºå“ªä¸ªåŒºé—´å†…ï¼Œä¹‹åä¾æ¬¡æ¯”è¾ƒåˆ¤æ–­å…¶æ˜¯å¦å­˜åœ¨ä¸data blockä¸­ã€‚\nå¯ä»¥çœ‹åˆ°ï¼Œsstableå¾ˆå¤šæ–‡ä»¶æ ¼å¼è®¾è®¡ï¼ˆä¾‹å¦‚restart pointï¼Œ index blockï¼Œfilter blockï¼Œmax keyï¼‰åœ¨æŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½æå¤§åœ°æå‡äº†æ•´ä½“çš„æŸ¥æ‰¾æ•ˆç‡ã€‚\næ–‡ä»¶ç‰¹ç‚¹ åªè¯»æ€§ sstableæ–‡ä»¶ä¸ºcompactionçš„ç»“æœåŸå­æ€§çš„äº§ç”Ÿï¼Œåœ¨å…¶ä½™æ—¶é—´æ˜¯åªè¯»çš„ã€‚\nå®Œæ•´æ€§ ä¸€ä¸ªsstableæ–‡ä»¶ï¼Œå…¶è¾…åŠ©æ•°æ®ï¼š\nç´¢å¼•æ•°æ® è¿‡æ»¤æ•°æ® éƒ½ç›´æ¥å­˜å‚¨äºåŒä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚å½“è¯»å–æ˜¯éœ€è¦ä½¿ç”¨è¿™äº›è¾…åŠ©æ•°æ®æ—¶ï¼Œæ— é¡»é¢å¤–çš„ç£ç›˜è¯»å–ï¼›å½“sstableæ–‡ä»¶éœ€è¦åˆ é™¤æ—¶ï¼Œæ— é¡»é¢å¤–çš„æ•°æ®åˆ é™¤ã€‚ç®€è¦åœ°è¯´ï¼Œè¾…åŠ©æ•°æ®éšç€æ–‡ä»¶ä¸€èµ·åˆ›å»ºå’Œé”€æ¯ã€‚\nå¹¶å‘è®¿é—®å‹å¥½æ€§ ç”±äºsstableæ–‡ä»¶å…·æœ‰åªè¯»æ€§ï¼Œå› æ­¤ä¸å­˜åœ¨åŒä¸€ä¸ªæ–‡ä»¶çš„è¯»å†™å†²çªã€‚\nleveldbé‡‡ç”¨å¼•ç”¨è®¡æ•°ç»´æŠ¤æ¯ä¸ªæ–‡ä»¶çš„å¼•ç”¨æƒ…å†µï¼Œå½“ä¸€ä¸ªæ–‡ä»¶çš„è®¡æ•°å€¼å¤§äº0æ—¶ï¼Œå¯¹æ­¤æ–‡ä»¶çš„åˆ é™¤åŠ¨ä½œä¼šç­‰åˆ°è¯¥æ–‡ä»¶è¢«é‡Šæ”¾æ—¶æ‰è¿›è¡Œï¼Œå› æ­¤å®ç°äº†æ— é”æƒ…å†µä¸‹çš„å¹¶å‘è®¿é—®ã€‚\nCacheä¸€è‡´æ€§ sstableæ–‡ä»¶ä¸ºåªè¯»çš„ï¼Œå› æ­¤cacheä¸­çš„æ•°æ®æ°¸è¿œäºsstableæ–‡ä»¶ä¸­çš„æ•°æ®ä¿æŒä¸€è‡´ã€‚\nå‚è€ƒ: https://leveldb-handbook.readthedocs.io/zh/latest/sstable.html\n","permalink":"https://reid00.github.io/en/posts/storage/rocksdb-sstable/","summary":"æ¦‚è¿° å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ï¼Œleveldbæ˜¯å…¸å‹çš„LSMæ ‘(Log Structured-Merge Tree)å®ç°ï¼Œå³ä¸€æ¬¡leveldbçš„å†™å…¥è¿‡ç¨‹å¹¶ä¸æ˜¯ç›´æ¥å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯å°†å†™æ“ä½œé¦–å…ˆå†™å…¥æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå…¶æ¬¡å°†å†™æ“ä½œåº”ç”¨åœ¨memtableä¸Šã€‚\nå½“leveldbè¾¾åˆ°checkpointç‚¹ï¼ˆmemtableä¸­çš„æ•°æ®é‡è¶…è¿‡äº†é¢„è®¾çš„é˜ˆå€¼ï¼‰ï¼Œä¼šå°†å½“å‰memtableå†»ç»“æˆä¸€ä¸ªä¸å¯æ›´æ”¹çš„å†…å­˜æ•°æ®åº“ï¼ˆimmutable memory dbï¼‰ï¼Œå¹¶ä¸”åˆ›å»ºä¸€ä¸ªæ–°çš„memtableä¾›ç³»ç»Ÿç»§ç»­ä½¿ç”¨ã€‚\nimmutable memory dbä¼šåœ¨åå°è¿›è¡Œä¸€æ¬¡minor compactionï¼Œå³å°†å†…å­˜æ•°æ®åº“ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜æ–‡ä»¶ä¸­ã€‚\nåœ¨è¿™é‡Œæˆ‘ä»¬æš‚æ—¶ä¸å±•å¼€è®¨è®ºminor compactionç›¸å…³çš„å†…å®¹ï¼Œè¯»è€…å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºå°†å†…å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°æ–‡ä»¶\nleveldbï¼ˆæˆ–è€…è¯´LSMæ ‘ï¼‰è®¾è®¡Minor Compactionçš„ç›®çš„æ˜¯ä¸ºäº†ï¼š\næœ‰æ•ˆåœ°é™ä½å†…å­˜çš„ä½¿ç”¨ç‡ï¼› é¿å…æ—¥å¿—æ–‡ä»¶è¿‡å¤§ï¼Œç³»ç»Ÿæ¢å¤æ—¶é—´è¿‡é•¿ï¼› å½“memory dbçš„æ•°æ®è¢«æŒä¹…åŒ–åˆ°æ–‡ä»¶ä¸­æ—¶ï¼Œleveldbå°†ä»¥ä¸€å®šè§„åˆ™è¿›è¡Œæ–‡ä»¶ç»„ç»‡ï¼Œè¿™ç§æ–‡ä»¶æ ¼å¼æˆä¸ºsstableã€‚åœ¨æœ¬æ–‡ä¸­å°†è¯¦ç»†åœ°ä»‹ç»sstableçš„æ–‡ä»¶æ ¼å¼ä»¥åŠç›¸å…³è¯»å†™æ“ä½œã€‚\nSStableæ–‡ä»¶æ ¼å¼ ç‰©ç†ç»“æ„ ä¸ºäº†æé«˜æ•´ä½“çš„è¯»å†™æ•ˆç‡ï¼Œä¸€ä¸ªsstableæ–‡ä»¶æŒ‰ç…§å›ºå®šå¤§å°è¿›è¡Œå—åˆ’åˆ†ï¼Œé»˜è®¤æ¯ä¸ªå—çš„å¤§å°ä¸º4KiBã€‚æ¯ä¸ªBlockä¸­ï¼Œé™¤äº†å­˜å‚¨æ•°æ®ä»¥å¤–ï¼Œè¿˜ä¼šå­˜å‚¨ä¸¤ä¸ªé¢å¤–çš„è¾…åŠ©å­—æ®µï¼š\nå‹ç¼©ç±»å‹ CRCæ ¡éªŒç  å‹ç¼©ç±»å‹è¯´æ˜äº†Blockä¸­å­˜å‚¨çš„æ•°æ®æ˜¯å¦è¿›è¡Œäº†æ•°æ®å‹ç¼©ï¼Œè‹¥æ˜¯ï¼Œé‡‡ç”¨äº†å“ªç§ç®—æ³•è¿›è¡Œå‹ç¼©ã€‚leveldbä¸­é»˜è®¤é‡‡ç”¨Snappyç®—æ³•è¿›è¡Œå‹ç¼©ã€‚ CRCæ ¡éªŒç æ˜¯å¾ªç¯å†—ä½™æ ¡éªŒæ ¡éªŒç ï¼Œæ ¡éªŒèŒƒå›´åŒ…æ‹¬æ•°æ®ä»¥åŠå‹ç¼©ç±»å‹ã€‚ é€»è¾‘ç»“æ„ åœ¨é€»è¾‘ä¸Šï¼Œæ ¹æ®åŠŸèƒ½ä¸åŒï¼Œleveldbåœ¨é€»è¾‘ä¸Šåˆå°†sstableåˆ†ä¸ºï¼š\ndata block: ç”¨æ¥å­˜å‚¨key valueæ•°æ®å¯¹ï¼› filter block: ç”¨æ¥å­˜å‚¨ä¸€äº›è¿‡æ»¤å™¨ç›¸å…³çš„æ•°æ®ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰ï¼Œä½†æ˜¯è‹¥ç”¨æˆ·ä¸æŒ‡å®šleveldbä½¿ç”¨è¿‡æ»¤å™¨ï¼Œleveldbåœ¨è¯¥blockä¸­ä¸ä¼šå­˜å‚¨ä»»ä½•å†…å®¹ï¼› meta Index block: ç”¨æ¥å­˜å‚¨filter blockçš„ç´¢å¼•ä¿¡æ¯ï¼ˆç´¢å¼•ä¿¡æ¯æŒ‡åœ¨è¯¥sstableæ–‡ä»¶ä¸­çš„åç§»é‡ä»¥åŠæ•°æ®é•¿åº¦ï¼‰ï¼› index blockï¼šindex blockä¸­ç”¨æ¥å­˜å‚¨æ¯ä¸ªdata blockçš„ç´¢å¼•ä¿¡æ¯ï¼› footer: ç”¨æ¥å­˜å‚¨meta index blockåŠindex blockçš„ç´¢å¼•ä¿¡æ¯ï¼› æ³¨æ„ï¼Œ1-4ç±»å‹çš„åŒºå—ï¼Œå…¶ç‰©ç†ç»“æ„éƒ½æ˜¯å¦‚1.1èŠ‚æ‰€ç¤ºï¼Œæ¯ä¸ªåŒºå—éƒ½ä¼šæœ‰è‡ªå·±çš„å‹ç¼©ä¿¡æ¯ä»¥åŠCRCæ ¡éªŒç ä¿¡æ¯ã€‚\ndata blockç»“æ„ data blockä¸­å­˜å‚¨çš„æ•°æ®æ˜¯leveldbä¸­çš„keyvalueé”®å€¼å¯¹ã€‚å…¶ä¸­ä¸€ä¸ªdata blockä¸­çš„æ•°æ®éƒ¨åˆ†ï¼ˆä¸åŒ…æ‹¬å‹ç¼©ç±»å‹ã€CRCæ ¡éªŒç ï¼‰æŒ‰é€»è¾‘åˆä»¥ä¸‹å›¾è¿›è¡Œåˆ’åˆ†ï¼š ç¬¬ä¸€éƒ¨åˆ†ç”¨æ¥å­˜å‚¨keyvalueæ•°æ®ã€‚ç”±äºsstableä¸­æ‰€æœ‰çš„keyvalueå¯¹éƒ½æ˜¯ä¸¥æ ¼æŒ‰åºå­˜å‚¨çš„ï¼Œä¸ºäº†èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œleveldbå¹¶ä¸ä¼šä¸ºæ¯ä¸€å¯¹keyvalueå¯¹éƒ½å­˜å‚¨å®Œæ•´çš„keyå€¼ï¼Œè€Œæ˜¯å­˜å‚¨ä¸ä¸Šä¸€ä¸ªkeyéå…±äº«çš„éƒ¨åˆ†ï¼Œé¿å…äº†keyé‡å¤å†…å®¹çš„å­˜å‚¨ã€‚\næ¯é—´éš”è‹¥å¹²ä¸ªkeyvalueå¯¹ï¼Œå°†ä¸ºè¯¥æ¡è®°å½•é‡æ–°å­˜å‚¨ä¸€ä¸ªå®Œæ•´çš„keyã€‚é‡å¤è¯¥è¿‡ç¨‹ï¼ˆé»˜è®¤é—´éš”å€¼ä¸º16ï¼‰ï¼Œæ¯ä¸ªé‡æ–°å­˜å‚¨å®Œæ•´keyçš„ç‚¹ç§°ä¹‹ä¸ºRestart pointã€‚\næ¯é—´éš”è‹¥å¹²ä¸ªkeyvalueå¯¹ï¼Œå°†ä¸ºè¯¥æ¡è®°å½•é‡æ–°å­˜å‚¨ä¸€ä¸ªå®Œæ•´çš„keyã€‚é‡å¤è¯¥è¿‡ç¨‹ï¼ˆé»˜è®¤é—´éš”å€¼ä¸º16ï¼‰ï¼Œæ¯ä¸ªé‡æ–°å­˜å‚¨å®Œæ•´keyçš„ç‚¹ç§°ä¹‹ä¸ºRestart pointã€‚\næ¯ä¸ªæ•°æ®é¡¹çš„æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸€ä¸ªentryåˆ†ä¸º5éƒ¨åˆ†å†…å®¹ï¼š\nä¸å‰ä¸€æ¡è®°å½•keyå…±äº«éƒ¨åˆ†çš„é•¿åº¦ï¼› ä¸å‰ä¸€æ¡è®°å½•keyä¸å…±äº«éƒ¨åˆ†çš„é•¿åº¦ï¼› valueé•¿åº¦ï¼› ä¸å‰ä¸€æ¡è®°å½•keyéå…±äº«çš„å†…å®¹ï¼› valueå†…å®¹ï¼› ä¾‹å¦‚ï¼š\n1 2 3 4 restart_interval=2 entry one : key=deck,value=v1 entry two : key=dock,value=v2 entry three: key=duck,value=v3 ä¸‰ç»„entryæŒ‰ä¸Šå›¾çš„æ ¼å¼è¿›è¡Œå­˜å‚¨ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯restart_intervalä¸º2ï¼Œå› æ­¤æ¯éš”ä¸¤ä¸ªentryéƒ½ä¼šæœ‰ä¸€æ¡æ•°æ®ä½œä¸ºrestart pointç‚¹çš„æ•°æ®é¡¹ï¼Œå­˜å‚¨å®Œæ•´keyå€¼ã€‚å› æ­¤entry3å­˜å‚¨äº†å®Œæ•´çš„keyã€‚","title":"RocksDB Sstable"},{"content":"TCP/IP åè®®æ— é€šå¸¸æˆ‘è¯´ TCP/IP æ˜¯æŒ‡ TCP/IP åè®®æ—ã€‚å®ƒæ˜¯åŸºäº TCP å’Œ IP è¿™ä¸¤ä¸ªæœ€åˆçš„åè®®ä¹‹ä¸Šçš„ä¸åŒçš„é€šä¿¡åè®®çš„å¤§é›†åˆã€‚ ä¾‹å¦‚ï¼šhttpã€httpsã€ftpã€icmpã€arpã€rarpã€smtpï¼ˆç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼‰\nå½“è¾“å…¥ xxxxHub åï¼Œåˆ°ç½‘é¡µæ˜¾ç¤ºï¼Œå…¶é—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿè¿™é—®é¢˜è¢«é¢è¯•å®˜é—®äº†äº”å…­åæ¬¡ï¼Œç†¬å¤œèµ¶å‡ºè¿™ç¯‡æ–‡ç« \nhttps://mp.weixin.qq.com/s/ESJ8Zt0GBVXHKj3KICoqjg\nä¸€ä¸ªç½‘ç»œè¯·æ±‚æ˜¯æ€ä¹ˆä¼ è¾“çš„ï¼Ÿ æˆ‘ä»¬æ‹¿è®¿é—®æµè§ˆå™¨ä¸¾ä¸ªæ —å­ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š\nTCPã€UDPæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå„æœ‰ä»€ä¹ˆä¼˜åŠ£ï¼Ÿ TCP é¢å‘è¿æ¥ï¼Œæä¾›å¯é äº¤ä»˜ã€‚é€šè¿‡ TCP è¿æ¥ä¼ è¾“çš„æ•°æ®ï¼Œæ— å·®é”™ã€ä¸ä¸¢å¤±ã€ä¸é‡å¤ã€å¹¶ä¸”æŒ‰åºåˆ°è¾¾ã€‚ç›¸å¯¹ UDP å¼€é”€å¤§ UDP é¢å‘æ— è¿æ¥ï¼Œä¸ä¿è¯å¯é äº¤ä»˜ã€‚æ— æ‹¥å¡æ§åˆ¶ï¼Œæ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šï¼Œå¼€é”€å°ã€‚\nå…³äº TCP åè®® ç¡®è®¤ ACK - ACKnowledgement ä»…å½“ACK = 1 æ—¶ï¼Œç¡®è®¤æ‰æœ‰æ•ˆã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç¡®è®¤æ”¶åˆ°æ•°æ®ã€‚ å¤ä½ RST - ReSet æ ‡æ˜ TCP å‡ºç°ä¸¥é‡å·®é”™æ—¶ï¼Œå¿…é¡»é‡Šæ”¾è¿æ¥ï¼Œé‡æ–°å»ºç«‹è¿æ¥ã€‚ åŒæ­¥ SYN - SYNchronization åœ¨å»ºç«‹è¿æ¥æ—¶ï¼Œç”¨æ¥åŒæ­¥åºå·ã€‚å½“ SYN = 1ï¼ŒACK = 0 æ—¶ï¼Œè¡¨åè¿™æ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚æŠ¥æ–‡ã€‚SYN = 1ï¼ŒACK = 1 è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåŒæ„è¯·æ±‚æŠ¥æ–‡ã€‚ ç»ˆæ­¢ FNI - FINisï¼ˆè¡¨ç¤ºç»ˆã€å®Œï¼‰ç”¨æ¥é‡Šæ”¾è¿æ¥ã€‚å½“ FNI = 1 è¡¨ç¤ºæ­¤æ®µæŠ¥æ–‡å‘é€æ–¹å·²å‘é€å®Œæ¯•ã€‚ å…³äº UDP åè®® è§£é‡Šä¸‰æ¬¡æ¡æ‰‹ ç¡®è®¤å· ack æœŸæœ›æ”¶åˆ°å¯¹æ–¹ä¸‹ä¸€ä¸ªæŠ¥æ–‡çš„åºåˆ—å·\nåºåˆ—å· seq\nSYN = 1 è¯·æ±‚åŒæ­¥åºåˆ—å·ï¼ŒA çš„åºåˆ—å·ä¸ºï¼šx SYN = 1 ACK = 1ï¼Œè¡¨ç¤ºç¡®è®¤è¯·æ±‚ã€‚B å‘é€çš„æ•°æ®çš„åºåˆ—å·ä¸ºï¼šyï¼ŒæœŸæœ›æ”¶åˆ° ä¸‹ä¸€ä¸ª A çš„æ•°æ®çš„åºåˆ—å·ä¸ºï¼šx + 1 ACK = 1 ï¼Œè¡¨ç¤ºç¡®è®¤è¯·æ±‚ã€‚A å‘é€çš„æ•°æ®çš„åºåˆ—å·ä¸ºï¼šx + 1ï¼ŒæœŸæœ›æ”¶åˆ°ä¸‹ä¸€ä¸ª B çš„æ•°æ®çš„åºåˆ—å·ä¸ºï¼šy + 1 è¯´è¯´TCPä¸‰æ¬¡æ¡æ‰‹ï¼Ÿä¸ºä»€ä¹ˆä¸ä¸¤æ¬¡ï¼Ÿ å¦‚æœå‘é€ä¸¤æ¬¡å°±å¯ä»¥å»ºç«‹è¿æ¥è¯ï¼Œé‚£ä¹ˆåªè¦å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¿æ¥è¯·æ±‚ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°å¹¶å‘é€äº†ç¡®è®¤ï¼Œå°±ä¼šå»ºç«‹ä¸€ä¸ªè¿æ¥ã€‚\nå¯èƒ½å‡ºç°çš„é—®é¢˜ï¼šå¦‚æœä¸€ä¸ªè¿æ¥è¯·æ±‚åœ¨ç½‘ç»œä¸­è·‘çš„æ…¢ï¼Œè¶…æ—¶äº†ï¼Œè¿™æ—¶å®¢æˆ·ç«¯ä¼šä»å‘è¯·æ±‚ï¼Œä½†æ˜¯è¿™ä¸ªè·‘çš„æ…¢çš„è¯·æ±‚æœ€åè¿˜æ˜¯è·‘åˆ°äº†ï¼Œç„¶åæœåŠ¡ç«¯å°±æ¥æ”¶äº†ä¸¤ä¸ªè¿æ¥è¯·æ±‚ï¼Œç„¶åå…¨éƒ¨å›åº”å°±ä¼šåˆ›å»ºä¸¤ä¸ªè¿æ¥ï¼Œæµªè´¹èµ„æºï¼\nå¦‚æœåŠ äº†ç¬¬ä¸‰æ¬¡å®¢æˆ·ç«¯ç¡®è®¤ï¼Œå®¢æˆ·ç«¯åœ¨æ¥å—åˆ°ä¸€ä¸ªæœåŠ¡ç«¯è¿æ¥ç¡®è®¤è¯·æ±‚åï¼Œåé¢å†æ¥æ”¶åˆ°çš„è¿æ¥ç¡®è®¤è¯·æ±‚å°±å¯ä»¥æŠ›å¼ƒä¸ç®¡äº†ã€‚\nè¯´è¯´TCPå››æ¬¡æŒ¥æ‰‹ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯ä¸‰æ¬¡ï¼Ÿ æ®ä¼ è¾“ç»“æŸåï¼Œé€šä¿¡çš„åŒæ–¹éƒ½å¯ä»¥é‡Šæ”¾è¿æ¥ã€‚ç°åœ¨ A å’Œ B éƒ½å¤„äº ESTABLISHED çŠ¶æ€ã€‚\nç¬¬ä¸€æ¬¡æŒ¥æ‰‹ï¼šA çš„åº”ç”¨è¿›ç¨‹å…ˆå‘å…¶ TCP å‘å‡ºè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µï¼Œå¹¶åœæ­¢å†å‘é€æ•°æ®ï¼Œä¸»åŠ¨å…³é—­ TCP è¿æ¥ã€‚A æŠŠè¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µé¦–éƒ¨çš„ç»ˆæ­¢æ§åˆ¶ä½ FIN ç½® 1ï¼Œå…¶åºå· seq = uï¼ˆç­‰äºå‰é¢å·²ä¼ é€è¿‡çš„æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ  1ï¼‰ï¼Œè¿™æ—¶ A è¿›å…¥ FIN-WAIT-1ï¼ˆç»ˆæ­¢ç­‰å¾…1ï¼‰çŠ¶æ€ï¼Œç­‰å¾… B çš„ç¡®è®¤ã€‚è¯·æ³¨æ„ï¼šTCP è§„å®šï¼ŒFIN æŠ¥æ–‡æ®µå³ä½¿ä¸æºå¸¦æ•°æ®ï¼Œä¹Ÿå°†æ¶ˆè€—æ‰ä¸€ä¸ªåºå·ã€‚\nç¬¬äºŒæ¬¡æŒ¥æ‰‹ï¼šB æ”¶åˆ°è¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µåç«‹å³å‘å‡ºç¡®è®¤ï¼Œç¡®è®¤å·æ˜¯ ack = u + 1ï¼Œè€Œè¿™ä¸ªæŠ¥æ–‡æ®µè‡ªå·±çš„åºå·æ˜¯ vï¼ˆç­‰äº B å‰é¢å·²ç»ä¼ é€è¿‡çš„æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ 1ï¼‰ï¼Œç„¶å B å°±è¿›å…¥ CLOSE-WAITï¼ˆå…³é—­ç­‰å¾…ï¼‰çŠ¶æ€ã€‚TCP æœåŠ¡ç«¯è¿›ç¨‹è¿™æ—¶åº”é€šçŸ¥é«˜å±‚åº”ç”¨è¿›ç¨‹ï¼Œå› è€Œä» A åˆ° B è¿™ä¸ªæ–¹å‘çš„è¿æ¥å°±é‡Šæ”¾äº†ï¼Œè¿™æ—¶çš„ TCP è¿æ¥å¤„äºåŠå…³é—­ï¼ˆhalf-closeï¼‰çŠ¶æ€ï¼Œå³ A å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä½† B è‹¥å‘é€æ•°æ®ï¼ŒA ä»è¦æ¥æ”¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä» B åˆ° A è¿™ä¸ªæ–¹å‘çš„è¿æ¥å¹¶æœªå…³é—­ï¼Œè¿™ä¸ªçŠ¶æ€å¯èƒ½ä¼šæŒç»­ä¸€æ®µæ—¶é—´ã€‚A æ”¶åˆ°æ¥è‡ª B çš„ç¡®è®¤åï¼Œå°±è¿›å…¥ FIN-WAIT-2(ç»ˆæ­¢ç­‰å¾…2)çŠ¶æ€ï¼Œç­‰å¾… B å‘å‡ºçš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µã€‚\nç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ï¼šè‹¥ B å·²ç»æ²¡æœ‰è¦å‘ A å‘é€çš„æ•°æ®ï¼Œå…¶åº”ç”¨è¿›ç¨‹å°±é€šçŸ¥ TCP é‡Šæ”¾è¿æ¥ã€‚è¿™æ—¶ B å‘å‡ºçš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡æ®µå¿…é¡»ä½¿ FIN = 1ã€‚å‡å®š B çš„åºå·ä¸º wï¼ˆåœ¨åŠå…³é—­çŠ¶æ€ï¼ŒB å¯èƒ½åˆå‘é€äº†ä¸€äº›æ•°æ®ï¼‰ã€‚B è¿˜å¿…é¡»é‡å¤ä¸Šæ¬¡å·²å‘é€è¿‡çš„ç¡®è®¤å· ack = u + 1ã€‚è¿™æ—¶ B å°±è¿›å…¥ LAST-ACK(æœ€åç¡®è®¤)çŠ¶æ€ï¼Œç­‰å¾… A çš„ç¡®è®¤ã€‚\nç¬¬å››æ¬¡æŒ¥æ‰‹ï¼šA åœ¨æ”¶åˆ° B çš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡åï¼Œå¿…é¡»å¯¹æ­¤å‘å‡ºç¡®è®¤ã€‚åœ¨ç¡®è®¤æŠ¥æ–‡æ®µä¸­æŠŠ ACK ç½® 1ï¼Œç¡®è®¤å· ack = w + 1ï¼Œè€Œè‡ªå·±çš„åºå· seq = u + 1ï¼ˆå‰é¢å‘é€çš„ FIN æŠ¥æ–‡æ®µè¦æ¶ˆè€—ä¸€ä¸ªåºå·ï¼‰ã€‚ç„¶åè¿›å…¥ TIME-WAIT(æ—¶é—´ç­‰å¾…) çŠ¶æ€ã€‚è¯·æ³¨æ„ï¼Œç°åœ¨ TCP è¿æ¥è¿˜æ²¡æœ‰é‡Šæ”¾æ‰ã€‚å¿…é¡»ç»è¿‡æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨è®¾ç½®çš„æ—¶é—´ 2MSLï¼ˆMSLï¼šæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ï¼‰åï¼ŒA æ‰èƒ½è¿›å…¥åˆ° CLOSED çŠ¶æ€ï¼Œç„¶åæ’¤é”€ä¼ è¾“æ§åˆ¶å—ï¼Œç»“æŸè¿™æ¬¡ TCP è¿æ¥ã€‚å½“ç„¶å¦‚æœ B ä¸€æ”¶åˆ° A çš„ç¡®è®¤å°±è¿›å…¥ CLOSED çŠ¶æ€ï¼Œç„¶åæ’¤é”€ä¼ è¾“æ§åˆ¶å—ã€‚æ‰€ä»¥åœ¨é‡Šæ”¾è¿æ¥æ—¶ï¼ŒB ç»“æŸ TCP è¿æ¥çš„æ—¶é—´è¦æ—©äº Aã€‚\nä»€ä¹ˆæ˜¯æ‹¥å¡æ§åˆ¶ï¼Ÿ ç®€å•æ¥è¯´ï¼Œå°±æ˜¯é€šè¿‡ç½‘ç»œçš„æ‹¥å¡æƒ…å†µæ¥è°ƒæ•´ TCP å‘é€ç«¯å‘é€çš„æ•°æ®é‡ã€‚å‘é€é‡å…ˆç”± 1 æŒ‡æ•°çº§é€’å¢ï¼Œåˆ°ä¸€å®šé‡æ—¶ï¼ˆ65535 ä¸ªå­—èŠ‚ï¼‰å¼€å§‹æ…¢ä¸‹æ¥ï¼Œè¿™ä¸ªæ—¶å€™è¿˜æ˜¯é€’å¢çš„ã€‚ç­‰åˆ°å¼€å§‹ä¸¢åŒ…æ—¶ï¼Œåˆå¼€å§‹é™ä½å‘é€é€Ÿåº¦ã€‚\nä»€ä¹ˆæ˜¯æµé‡æ§åˆ¶ï¼Ÿ ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ TCP çš„æ¥å—ç«¯å¤„ç†ä¸è¿‡æ¥ï¼Œè®© TCP çš„å‘é€ç«¯å‘é€æ…¢ä¸€ç‚¹ã€‚æ¥æ”¶ç«¯ä¼šç»´æŠ¤ä¸€ä¸ªå¤„ç†çª—å£ï¼Œå³æ˜¯æ¥æ”¶ç«¯æ‰€èƒ½å¤„ç†æ•°æ®çš„èƒ½åŠ›ã€‚æ¥æ”¶ç«¯å°†è¿™ä¸ªå¤„ç†èƒ½åŠ›ä¸æ–­åé¦ˆç»™å‘é€ç«¯ï¼Œä»¥æ­¤æ¥è®©å‘é€ç«¯è°ƒæ•´å‘é€çš„æ•°æ®é‡çš„å¤šå°‘ã€‚\nå‚è€ƒ: https://mp.weixin.qq.com/s/xe3dEu17mGTqM46LRFxzhg\n","permalink":"https://reid00.github.io/en/posts/os_network/tcp-ip%E5%8D%8F%E8%AE%AE/","summary":"TCP/IP åè®®æ— é€šå¸¸æˆ‘è¯´ TCP/IP æ˜¯æŒ‡ TCP/IP åè®®æ—ã€‚å®ƒæ˜¯åŸºäº TCP å’Œ IP è¿™ä¸¤ä¸ªæœ€åˆçš„åè®®ä¹‹ä¸Šçš„ä¸åŒçš„é€šä¿¡åè®®çš„å¤§é›†åˆã€‚ ä¾‹å¦‚ï¼šhttpã€httpsã€ftpã€icmpã€arpã€rarpã€smtpï¼ˆç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼‰\nå½“è¾“å…¥ xxxxHub åï¼Œåˆ°ç½‘é¡µæ˜¾ç¤ºï¼Œå…¶é—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿè¿™é—®é¢˜è¢«é¢è¯•å®˜é—®äº†äº”å…­åæ¬¡ï¼Œç†¬å¤œèµ¶å‡ºè¿™ç¯‡æ–‡ç« \nhttps://mp.weixin.qq.com/s/ESJ8Zt0GBVXHKj3KICoqjg\nä¸€ä¸ªç½‘ç»œè¯·æ±‚æ˜¯æ€ä¹ˆä¼ è¾“çš„ï¼Ÿ æˆ‘ä»¬æ‹¿è®¿é—®æµè§ˆå™¨ä¸¾ä¸ªæ —å­ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š\nTCPã€UDPæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå„æœ‰ä»€ä¹ˆä¼˜åŠ£ï¼Ÿ TCP é¢å‘è¿æ¥ï¼Œæä¾›å¯é äº¤ä»˜ã€‚é€šè¿‡ TCP è¿æ¥ä¼ è¾“çš„æ•°æ®ï¼Œæ— å·®é”™ã€ä¸ä¸¢å¤±ã€ä¸é‡å¤ã€å¹¶ä¸”æŒ‰åºåˆ°è¾¾ã€‚ç›¸å¯¹ UDP å¼€é”€å¤§ UDP é¢å‘æ— è¿æ¥ï¼Œä¸ä¿è¯å¯é äº¤ä»˜ã€‚æ— æ‹¥å¡æ§åˆ¶ï¼Œæ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šï¼Œå¼€é”€å°ã€‚\nå…³äº TCP åè®® ç¡®è®¤ ACK - ACKnowledgement ä»…å½“ACK = 1 æ—¶ï¼Œç¡®è®¤æ‰æœ‰æ•ˆã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç¡®è®¤æ”¶åˆ°æ•°æ®ã€‚ å¤ä½ RST - ReSet æ ‡æ˜ TCP å‡ºç°ä¸¥é‡å·®é”™æ—¶ï¼Œå¿…é¡»é‡Šæ”¾è¿æ¥ï¼Œé‡æ–°å»ºç«‹è¿æ¥ã€‚ åŒæ­¥ SYN - SYNchronization åœ¨å»ºç«‹è¿æ¥æ—¶ï¼Œç”¨æ¥åŒæ­¥åºå·ã€‚å½“ SYN = 1ï¼ŒACK = 0 æ—¶ï¼Œè¡¨åè¿™æ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚æŠ¥æ–‡ã€‚SYN = 1ï¼ŒACK = 1 è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªåŒæ„è¯·æ±‚æŠ¥æ–‡ã€‚ ç»ˆæ­¢ FNI - FINisï¼ˆè¡¨ç¤ºç»ˆã€å®Œï¼‰ç”¨æ¥é‡Šæ”¾è¿æ¥ã€‚å½“ FNI = 1 è¡¨ç¤ºæ­¤æ®µæŠ¥æ–‡å‘é€æ–¹å·²å‘é€å®Œæ¯•ã€‚ å…³äº UDP åè®® è§£é‡Šä¸‰æ¬¡æ¡æ‰‹ ç¡®è®¤å· ack æœŸæœ›æ”¶åˆ°å¯¹æ–¹ä¸‹ä¸€ä¸ªæŠ¥æ–‡çš„åºåˆ—å·","title":"TCP IPåè®®"},{"content":"ä¸€ã€ python çš„å¤šçº¿ç¨‹ä¸èƒ½åˆ©ç”¨å¤šæ ¸CPU å› ä¸ºGIL (å…¨å±€è§£é‡Šå™¨é”), Pyhton åªæœ‰ä¸€ä¸ªGILï¼Œ åœ¨è¿è¡ŒPython æ—¶ï¼Œ å°±è¦æ‹¿åˆ°è¿™ä¸ªé”ï¼Œæ‰èƒ½è¿è¡Œï¼Œåœ¨é‡åˆ°I/O æ“ä½œæ—¶ï¼Œä¼šé‡Šæ”¾è¿™æŠŠé”ã€‚\nå¦‚æœæ˜¯çº¯è®¡ç®—å‹çš„ç¨‹åºï¼Œæ²¡æœ‰I/O æ“ä½œï¼Œè§£é‡Šå™¨ä¼šæ¯éš”100 æ¬¡æ“ä½œå°±é‡Šæ”¾è¿™æŠŠé”ï¼Œè®©åˆ«çš„çº¿ç¨‹æœ‰æœºä¼šæ‰§è¡Œ(è¿™ä¸ªæ¬¡æ•°å¯ä»¥é€šsys.setcheckintervalæ¥è°ƒæ•´), åŒä¸€æ—¶é—´å†…ï¼Œæœ‰ä¸”ä»…ä¼šåªæœ‰ä¸€ä¸ªçº¿ç¨‹è·å¾—GIL åœ¨è¿è¡Œï¼Œå…¶ä»–çº¿ç¨‹éƒ½å¤„äºç­‰å¾…çŠ¶æ€ã€‚\nå¦‚æœæ˜¯CPU å¯†é›†å‹çš„ä»£ç æ¯”å¦‚ï¼Œå¾ªç¯ï¼Œè®¡ç®—ç­‰ï¼Œç”±äºè®¡ç®—é‡å¤šå’Œå¤§ï¼Œè®¡ç®—å¾ˆå¿«å°±ä¼šè¾¾åˆ°100æ¬¡ï¼Œç„¶åè§¦å‘GIL çš„é‡Šæ”¾ä¸ç«äº‰ï¼Œå¤šä¸ªçº¿ç¨‹æ¥å›åˆ‡æ¢æŸè€—èµ„æºï¼Œæ‰€ä»¥åœ¨å¤šçº¿ç¨‹é‡åˆ°CPUå¯†é›†å‹çš„ä»£ç æ—¶ï¼Œæ•ˆç‡è¿œè¿œä¸å¦‚å•çº¿ç¨‹é«˜ å¦‚æœæ˜¯I/O å¯†é›†å‹ä»£ç (æ–‡ä»¶å¤„ç†ï¼Œç½‘ç»œçˆ¬è™«), å¼€å¯å¤šçº¿ç¨‹å®é™…ä¸Šæ˜¯å¹¶å‘ï¼ŒIOæ“ä½œä¼šè¿›è¡ŒIOç­‰å¾…ï¼Œåœ¨çº¿ç¨‹Aç­‰å¾…æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°çº¿ç¨‹Bï¼Œè¿™æ ·å°±æå‡äº†æ•ˆç‡ã€‚ é¢å‘I/Oçš„ï¼ˆä¼šè°ƒç”¨å†…å»ºçš„æ“ä½œç³»ç»ŸCä»£ç çš„ï¼‰ç¨‹åºæ¥è¯´ï¼ŒGILä¼šåœ¨è¿™ä¸ªI/Oè°ƒç”¨ä¹‹å‰è¢«é‡Šæ”¾ï¼Œä»¥å…è®¸å…¶ä»–çº¿ç¨‹åœ¨è¿™ä¸ªçº¿ç¨‹ç­‰å¾…I/Oçš„æ—¶å€™è¿è¡Œã€‚å¦‚æœæŸçº¿ç¨‹å¹¶æœªä½¿ç”¨å¾ˆå¤šI/Oæ“ä½œï¼Œå®ƒä¼šåœ¨è‡ªå·±çš„æ—¶é—´ç‰‡å†…ä¸€ç›´å ç”¨å¤„ç†å™¨å’ŒGILã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒI/Oå¯†é›†å‹çš„Pythonç¨‹åºæ¯”è®¡ç®—å¯†é›†å‹çš„Pythonç¨‹åºæ›´èƒ½å……åˆ†åˆ©ç”¨å¤šçº¿ç¨‹çš„å¥½å¤„ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ¯”æ–¹æˆ‘æœ‰ä¸€ä¸ª4æ ¸çš„CPUï¼Œé‚£ä¹ˆè¿™æ ·ä¸€æ¥ï¼Œåœ¨å•ä½æ—¶é—´å†…æ¯ä¸ªæ ¸åªèƒ½è·‘ä¸€ä¸ªçº¿ç¨‹ï¼Œç„¶åæ—¶é—´ç‰‡è½®è½¬åˆ‡æ¢ã€‚ ä½†æ˜¯Pythonä¸ä¸€æ ·ï¼Œå®ƒä¸ç®¡ä½ æœ‰å‡ ä¸ªæ ¸ï¼Œå•ä½æ—¶é—´å¤šä¸ªæ ¸åªèƒ½è·‘ä¸€ä¸ªçº¿ç¨‹ï¼Œç„¶åæ—¶é—´ç‰‡è½®è½¬ã€‚çœ‹èµ·æ¥å¾ˆä¸å¯æ€è®®ï¼Ÿä½†æ˜¯è¿™å°±æ˜¯GILæçš„é¬¼ã€‚ä»»ä½•Pythonçº¿ç¨‹æ‰§è¡Œå‰ï¼Œå¿…é¡»å…ˆè·å¾—GILé”ï¼Œç„¶åï¼Œæ¯æ‰§è¡Œ100æ¡å­—èŠ‚ç ï¼Œè§£é‡Šå™¨å°±è‡ªåŠ¨é‡Šæ”¾GILé”ï¼Œ è®©åˆ«çš„çº¿ç¨‹æœ‰æœºä¼šæ‰§è¡Œã€‚è¿™ä¸ªGILå…¨å±€é”å®é™…ä¸ŠæŠŠæ‰€æœ‰çº¿ç¨‹çš„æ‰§è¡Œä»£ç éƒ½ç»™ä¸Šäº†é”ï¼Œæ‰€ä»¥ï¼Œå¤šçº¿ç¨‹åœ¨Pythonä¸­åªèƒ½äº¤æ›¿æ‰§è¡Œï¼Œå³ä½¿100ä¸ªçº¿ç¨‹è·‘åœ¨100æ ¸CPUä¸Šï¼Œä¹Ÿåªèƒ½ç”¨åˆ°1ä¸ªæ ¸ã€‚é€šå¸¸æˆ‘ä»¬ç”¨çš„è§£é‡Šå™¨æ˜¯å®˜æ–¹å®ç°çš„CPythonï¼Œè¦çœŸæ­£åˆ©ç”¨å¤šæ ¸ï¼Œé™¤éé‡å†™ä¸€ä¸ªä¸å¸¦GILçš„è§£é‡Šå™¨ã€‚\näºŒã€è§£å†³åŠæ³• å°±å¦‚æ­¤ï¼Ÿæˆ‘ä»¬æ²¡æœ‰åŠæ³•åœ¨Pythonä¸­åˆ©ç”¨å¤šæ ¸ï¼Ÿå½“ç„¶å¯ä»¥ï¼åˆšæ‰çš„å¤šè¿›ç¨‹ç®—æ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œè¿˜æœ‰ä¸€ç§å°±æ˜¯è°ƒç”¨Cè¯­è¨€çš„é“¾æ¥åº“ã€‚å¯¹æ‰€æœ‰é¢å‘I/Oçš„ï¼ˆä¼šè°ƒç”¨å†…å»ºçš„æ“ä½œç³»ç»ŸCä»£ç çš„ï¼‰ç¨‹åºæ¥è¯´ï¼ŒGILä¼šåœ¨è¿™ä¸ªI/Oè°ƒç”¨ä¹‹å‰è¢«é‡Šæ”¾ï¼Œä»¥å…è®¸å…¶ä»–çº¿ç¨‹åœ¨è¿™ä¸ªçº¿ç¨‹ç­‰å¾…I/Oçš„æ—¶å€™è¿è¡Œã€‚æˆ‘ä»¬å¯ä»¥æŠŠä¸€äº› è®¡ç®—å¯†é›†å‹ä»»åŠ¡ç”¨Cè¯­è¨€ç¼–å†™ï¼Œç„¶åæŠŠ.soé“¾æ¥åº“å†…å®¹åŠ è½½åˆ°Pythonä¸­ï¼Œå› ä¸ºæ‰§è¡ŒCä»£ç ï¼ŒGILé”ä¼šé‡Šæ”¾ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå°±å¯ä»¥åšåˆ°æ¯ä¸ªæ ¸éƒ½è·‘ä¸€ä¸ªçº¿ç¨‹çš„ç›®çš„ï¼ å¯èƒ½æœ‰çš„å°ä¼™ä¼´ä¸å¤ªç†è§£ä»€ä¹ˆæ˜¯è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œä»€ä¹ˆæ˜¯I/Oå¯†é›†å‹ä»»åŠ¡ï¼Ÿ\nè®¡ç®—å¯†é›†å‹ä»»åŠ¡çš„ç‰¹ç‚¹æ˜¯è¦è¿›è¡Œå¤§é‡çš„è®¡ç®—ï¼Œæ¶ˆè€—CPUèµ„æºï¼Œæ¯”å¦‚è®¡ç®—åœ†å‘¨ç‡ã€å¯¹è§†é¢‘è¿›è¡Œé«˜æ¸…è§£ç ç­‰ç­‰ï¼Œå…¨é CPUçš„è¿ç®—èƒ½åŠ›ã€‚è¿™ç§è®¡ç®—å¯†é›†å‹ä»»åŠ¡è™½ç„¶ä¹Ÿå¯ä»¥ç”¨å¤šä»»åŠ¡å®Œæˆï¼Œä½†æ˜¯ä»»åŠ¡è¶Šå¤šï¼ŒèŠ±åœ¨ä»»åŠ¡åˆ‡æ¢çš„æ—¶é—´å°±è¶Šå¤šï¼ŒCPUæ‰§è¡Œä»»åŠ¡çš„æ•ˆç‡å°±è¶Šä½ï¼Œæ‰€ä»¥ï¼Œè¦æœ€é«˜æ•ˆåœ°åˆ©ç”¨CPUï¼Œè®¡ç®—å¯†é›†å‹ä»»åŠ¡åŒæ—¶è¿›è¡Œçš„æ•°é‡åº”å½“ç­‰äºCPUçš„æ ¸å¿ƒæ•°ã€‚\nè®¡ç®—å¯†é›†å‹ä»»åŠ¡ç”±äºä¸»è¦æ¶ˆè€—CPUèµ„æºï¼Œå› æ­¤ï¼Œä»£ç è¿è¡Œæ•ˆç‡è‡³å…³é‡è¦ã€‚Pythonè¿™æ ·çš„è„šæœ¬è¯­è¨€è¿è¡Œæ•ˆç‡å¾ˆä½ï¼Œå®Œå…¨ä¸é€‚åˆè®¡ç®—å¯†é›†å‹ä»»åŠ¡ã€‚å¯¹äºè®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œæœ€å¥½ç”¨Cè¯­è¨€ç¼–å†™ã€‚\nç¬¬äºŒç§ä»»åŠ¡çš„ç±»å‹æ˜¯IOå¯†é›†å‹ï¼Œæ¶‰åŠåˆ°ç½‘ç»œã€ç£ç›˜IOçš„ä»»åŠ¡éƒ½æ˜¯IOå¯†é›†å‹ä»»åŠ¡ï¼Œè¿™ç±»ä»»åŠ¡çš„ç‰¹ç‚¹æ˜¯CPUæ¶ˆè€—å¾ˆå°‘ï¼Œä»»åŠ¡çš„å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ç­‰å¾…IOæ“ä½œå®Œæˆï¼ˆå› ä¸ºIOçš„é€Ÿåº¦è¿œè¿œä½äºCPUå’Œå†…å­˜çš„é€Ÿåº¦ï¼‰ã€‚å¯¹äºIOå¯†é›†å‹ä»»åŠ¡ï¼Œä»»åŠ¡è¶Šå¤šï¼ŒCPUæ•ˆç‡è¶Šé«˜ï¼Œä½†ä¹Ÿæœ‰ä¸€ä¸ªé™åº¦ã€‚å¸¸è§çš„å¤§éƒ¨åˆ†ä»»åŠ¡éƒ½æ˜¯IOå¯†é›†å‹ä»»åŠ¡ï¼Œæ¯”å¦‚Webåº”ç”¨ã€‚\nIOå¯†é›†å‹ä»»åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œ99%çš„æ—¶é—´éƒ½èŠ±åœ¨IOä¸Šï¼ŒèŠ±åœ¨CPUä¸Šçš„æ—¶é—´å¾ˆå°‘ï¼Œå› æ­¤ï¼Œç”¨è¿è¡Œé€Ÿåº¦æå¿«çš„Cè¯­è¨€æ›¿æ¢ç”¨Pythonè¿™æ ·è¿è¡Œé€Ÿåº¦æä½çš„è„šæœ¬è¯­è¨€ï¼Œå®Œå…¨æ— æ³•æå‡è¿è¡Œæ•ˆç‡ã€‚å¯¹äºIOå¯†é›†å‹ä»»åŠ¡ï¼Œæœ€åˆé€‚çš„è¯­è¨€å°±æ˜¯å¼€å‘æ•ˆç‡æœ€é«˜ï¼ˆä»£ç é‡æœ€å°‘ï¼‰çš„è¯­è¨€ï¼Œè„šæœ¬è¯­è¨€æ˜¯é¦–é€‰ï¼ŒCè¯­è¨€æœ€å·®ã€‚\nç»¼ä¸Šï¼ŒPythonå¤šçº¿ç¨‹ç›¸å½“äºå•æ ¸å¤šçº¿ç¨‹ï¼Œå¤šçº¿ç¨‹æœ‰ä¸¤ä¸ªå¥½å¤„ï¼šCPUå¹¶è¡Œï¼ŒIOå¹¶è¡Œï¼Œå•æ ¸å¤šçº¿ç¨‹ç›¸å½“äºè‡ªæ–­ä¸€è‡‚ã€‚æ‰€ä»¥ï¼Œåœ¨Pythonä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œä½†ä¸è¦æŒ‡æœ›èƒ½æœ‰æ•ˆåˆ©ç”¨å¤šæ ¸ã€‚å¦‚æœä¸€å®šè¦é€šè¿‡å¤šçº¿ç¨‹åˆ©ç”¨å¤šæ ¸ï¼Œé‚£åªèƒ½é€šè¿‡Cæ‰©å±•æ¥å®ç°ï¼Œä¸è¿‡è¿™æ ·å°±å¤±å»äº†Pythonç®€å•æ˜“ç”¨çš„ç‰¹ç‚¹ã€‚ä¸è¿‡ï¼Œä¹Ÿä¸ç”¨è¿‡äºæ‹…å¿ƒï¼ŒPythonè™½ç„¶ä¸èƒ½åˆ©ç”¨å¤šçº¿ç¨‹å®ç°å¤šæ ¸ä»»åŠ¡ï¼Œä½†å¯ä»¥é€šè¿‡å¤šè¿›ç¨‹å®ç°å¤šæ ¸ä»»åŠ¡ã€‚å¤šä¸ªPythonè¿›ç¨‹æœ‰å„è‡ªç‹¬ç«‹çš„GILé”ï¼Œäº’ä¸å½±å“ã€‚\nä¸‰ã€å…¶ä»–è§£é‡Š åœ¨æˆ‘ä»¬å›è¿‡å¤´çœ‹ä¸‹é‚£å¥ç»å…¸çš„è¯\u0026quot;å› ä¸ºGILçš„å­˜åœ¨ï¼Œpythonçš„å¤šçº¿ç¨‹ä¸èƒ½åˆ©ç”¨å¤šæ ¸CPU\u0026quot;ï¼Œè¿™å¥è¯å¾ˆå®¹æ˜“è®©äººç†è§£æˆGILä¼šè®©pythonåœ¨ä¸€ä¸ªæ ¸å¿ƒä¸Šè¿è¡Œï¼Œæœ‰äº†ä»Šå¤©çš„ä¾‹å­æˆ‘ä»¬å†æ¥é‡æ–°ç†è§£è¿™å¥è¯ï¼ŒGILçš„å­˜åœ¨è®©pythonåœ¨åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è¿è¡Œï¼Œè¿™æ¯‹åº¸ç½®ç–‘ï¼Œä½†æ˜¯å®ƒå¹¶æ²¡æœ‰ç»™çº¿ç¨‹é”æ­»æˆ–è€…è¯´æŒ‡å®šåªèƒ½åœ¨æŸä¸ªcpuä¸Šè¿è¡Œï¼Œå¦å¤–æˆ‘éœ€è¦è¯´æ˜ä¸€ç‚¹çš„æ˜¯GILæ˜¯ä¸è¿›ç¨‹å¯¹åº”çš„ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªGILã€‚pythonçº¿ç¨‹çš„æ‰§è¡Œæµç¨‹æˆ‘çš„ç†è§£æ˜¯è¿™æ ·çš„ çº¿ç¨‹ â€”â€”\u0026gt;æŠ¢GILâ€”â€”\u0026gt;CPU è¿™ç§æ‰§è¡Œæµç¨‹å¯¼è‡´äº†CPUå¯†é›†å‹çš„å¤šçº¿ç¨‹ç¨‹åºè™½ç„¶èƒ½å¤Ÿåˆ©ç”¨å¤šæ ¸cpuæ—¶è·Ÿå•æ ¸cpuæ˜¯å·®ä¸å¤šçš„ï¼Œå¹¶ä¸”ç”±äºå¤šä¸ªçº¿ç¨‹æŠ¢GILè¿™ä¸ªç¯èŠ‚å¯¼è‡´è¿è¡Œæ•ˆç‡\u0026lt;=å•çº¿ç¨‹ã€‚çœ‹åˆ°è¿™å¯èƒ½ä¼šè®©äººäº§ç”Ÿä¸€ç§é”™è§‰ï¼Œæœ‰äº†GILåpythonæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¥½åƒæ ¹æœ¬ä¸éœ€è¦çº¿ç¨‹é”ï¼Œè€Œå®é™…æƒ…å†µæ˜¯çº¿ç¨‹æ‹¿åˆ°CPUèµ„æºåå¹¶ä¸æ˜¯ä¸€ç›´æ‰§è¡Œçš„ï¼Œpythonè§£é‡Šå™¨åœ¨æ‰§è¡Œäº†è¯¥çº¿ç¨‹100æ¡å­—èŠ‚ç (æ³¨æ„æ˜¯å­—èŠ‚ç ä¸æ˜¯ä»£ç )æ—¶ä¼šé‡Šæ”¾æ‰è¯¥çº¿ç¨‹çš„GILï¼Œå¦‚æœè¿™æ—¶å€™æ²¡æœ‰åŠ é”é‚£ä¹ˆå…¶ä»–çº¿ç¨‹å°±å¯èƒ½ä¿®æ”¹è¯¥çº¿ç¨‹ç”¨åˆ°çš„èµ„æº; å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯é‡åˆ°IOä¹Ÿä¼šé‡Šæ”¾GIL\næœ€åç»“è®ºæ˜¯ï¼Œå› ä¸ºGILçš„å­˜åœ¨ï¼Œpythonçš„å¤šçº¿ç¨‹è™½ç„¶å¯ä»¥åˆ©ç”¨å¤šæ ¸CPUï¼Œä½†å¹¶ä¸èƒ½è®©å¤šä¸ªæ ¸åŒæ—¶å·¥ä½œã€‚\n","permalink":"https://reid00.github.io/en/posts/langs_linux/python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%9A%E8%BF%9B%E7%A8%8B/","summary":"ä¸€ã€ python çš„å¤šçº¿ç¨‹ä¸èƒ½åˆ©ç”¨å¤šæ ¸CPU å› ä¸ºGIL (å…¨å±€è§£é‡Šå™¨é”), Pyhton åªæœ‰ä¸€ä¸ªGILï¼Œ åœ¨è¿è¡ŒPython æ—¶ï¼Œ å°±è¦æ‹¿åˆ°è¿™ä¸ªé”ï¼Œæ‰èƒ½è¿è¡Œï¼Œåœ¨é‡åˆ°I/O æ“ä½œæ—¶ï¼Œä¼šé‡Šæ”¾è¿™æŠŠé”ã€‚\nå¦‚æœæ˜¯çº¯è®¡ç®—å‹çš„ç¨‹åºï¼Œæ²¡æœ‰I/O æ“ä½œï¼Œè§£é‡Šå™¨ä¼šæ¯éš”100 æ¬¡æ“ä½œå°±é‡Šæ”¾è¿™æŠŠé”ï¼Œè®©åˆ«çš„çº¿ç¨‹æœ‰æœºä¼šæ‰§è¡Œ(è¿™ä¸ªæ¬¡æ•°å¯ä»¥é€šsys.setcheckintervalæ¥è°ƒæ•´), åŒä¸€æ—¶é—´å†…ï¼Œæœ‰ä¸”ä»…ä¼šåªæœ‰ä¸€ä¸ªçº¿ç¨‹è·å¾—GIL åœ¨è¿è¡Œï¼Œå…¶ä»–çº¿ç¨‹éƒ½å¤„äºç­‰å¾…çŠ¶æ€ã€‚\nå¦‚æœæ˜¯CPU å¯†é›†å‹çš„ä»£ç æ¯”å¦‚ï¼Œå¾ªç¯ï¼Œè®¡ç®—ç­‰ï¼Œç”±äºè®¡ç®—é‡å¤šå’Œå¤§ï¼Œè®¡ç®—å¾ˆå¿«å°±ä¼šè¾¾åˆ°100æ¬¡ï¼Œç„¶åè§¦å‘GIL çš„é‡Šæ”¾ä¸ç«äº‰ï¼Œå¤šä¸ªçº¿ç¨‹æ¥å›åˆ‡æ¢æŸè€—èµ„æºï¼Œæ‰€ä»¥åœ¨å¤šçº¿ç¨‹é‡åˆ°CPUå¯†é›†å‹çš„ä»£ç æ—¶ï¼Œæ•ˆç‡è¿œè¿œä¸å¦‚å•çº¿ç¨‹é«˜ å¦‚æœæ˜¯I/O å¯†é›†å‹ä»£ç (æ–‡ä»¶å¤„ç†ï¼Œç½‘ç»œçˆ¬è™«), å¼€å¯å¤šçº¿ç¨‹å®é™…ä¸Šæ˜¯å¹¶å‘ï¼ŒIOæ“ä½œä¼šè¿›è¡ŒIOç­‰å¾…ï¼Œåœ¨çº¿ç¨‹Aç­‰å¾…æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°çº¿ç¨‹Bï¼Œè¿™æ ·å°±æå‡äº†æ•ˆç‡ã€‚ é¢å‘I/Oçš„ï¼ˆä¼šè°ƒç”¨å†…å»ºçš„æ“ä½œç³»ç»ŸCä»£ç çš„ï¼‰ç¨‹åºæ¥è¯´ï¼ŒGILä¼šåœ¨è¿™ä¸ªI/Oè°ƒç”¨ä¹‹å‰è¢«é‡Šæ”¾ï¼Œä»¥å…è®¸å…¶ä»–çº¿ç¨‹åœ¨è¿™ä¸ªçº¿ç¨‹ç­‰å¾…I/Oçš„æ—¶å€™è¿è¡Œã€‚å¦‚æœæŸçº¿ç¨‹å¹¶æœªä½¿ç”¨å¾ˆå¤šI/Oæ“ä½œï¼Œå®ƒä¼šåœ¨è‡ªå·±çš„æ—¶é—´ç‰‡å†…ä¸€ç›´å ç”¨å¤„ç†å™¨å’ŒGILã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒI/Oå¯†é›†å‹çš„Pythonç¨‹åºæ¯”è®¡ç®—å¯†é›†å‹çš„Pythonç¨‹åºæ›´èƒ½å……åˆ†åˆ©ç”¨å¤šçº¿ç¨‹çš„å¥½å¤„ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ¯”æ–¹æˆ‘æœ‰ä¸€ä¸ª4æ ¸çš„CPUï¼Œé‚£ä¹ˆè¿™æ ·ä¸€æ¥ï¼Œåœ¨å•ä½æ—¶é—´å†…æ¯ä¸ªæ ¸åªèƒ½è·‘ä¸€ä¸ªçº¿ç¨‹ï¼Œç„¶åæ—¶é—´ç‰‡è½®è½¬åˆ‡æ¢ã€‚ ä½†æ˜¯Pythonä¸ä¸€æ ·ï¼Œå®ƒä¸ç®¡ä½ æœ‰å‡ ä¸ªæ ¸ï¼Œå•ä½æ—¶é—´å¤šä¸ªæ ¸åªèƒ½è·‘ä¸€ä¸ªçº¿ç¨‹ï¼Œç„¶åæ—¶é—´ç‰‡è½®è½¬ã€‚çœ‹èµ·æ¥å¾ˆä¸å¯æ€è®®ï¼Ÿä½†æ˜¯è¿™å°±æ˜¯GILæçš„é¬¼ã€‚ä»»ä½•Pythonçº¿ç¨‹æ‰§è¡Œå‰ï¼Œå¿…é¡»å…ˆè·å¾—GILé”ï¼Œç„¶åï¼Œæ¯æ‰§è¡Œ100æ¡å­—èŠ‚ç ï¼Œè§£é‡Šå™¨å°±è‡ªåŠ¨é‡Šæ”¾GILé”ï¼Œ è®©åˆ«çš„çº¿ç¨‹æœ‰æœºä¼šæ‰§è¡Œã€‚è¿™ä¸ªGILå…¨å±€é”å®é™…ä¸ŠæŠŠæ‰€æœ‰çº¿ç¨‹çš„æ‰§è¡Œä»£ç éƒ½ç»™ä¸Šäº†é”ï¼Œæ‰€ä»¥ï¼Œå¤šçº¿ç¨‹åœ¨Pythonä¸­åªèƒ½äº¤æ›¿æ‰§è¡Œï¼Œå³ä½¿100ä¸ªçº¿ç¨‹è·‘åœ¨100æ ¸CPUä¸Šï¼Œä¹Ÿåªèƒ½ç”¨åˆ°1ä¸ªæ ¸ã€‚é€šå¸¸æˆ‘ä»¬ç”¨çš„è§£é‡Šå™¨æ˜¯å®˜æ–¹å®ç°çš„CPythonï¼Œè¦çœŸæ­£åˆ©ç”¨å¤šæ ¸ï¼Œé™¤éé‡å†™ä¸€ä¸ªä¸å¸¦GILçš„è§£é‡Šå™¨ã€‚\näºŒã€è§£å†³åŠæ³• å°±å¦‚æ­¤ï¼Ÿæˆ‘ä»¬æ²¡æœ‰åŠæ³•åœ¨Pythonä¸­åˆ©ç”¨å¤šæ ¸ï¼Ÿå½“ç„¶å¯ä»¥ï¼åˆšæ‰çš„å¤šè¿›ç¨‹ç®—æ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œè¿˜æœ‰ä¸€ç§å°±æ˜¯è°ƒç”¨Cè¯­è¨€çš„é“¾æ¥åº“ã€‚å¯¹æ‰€æœ‰é¢å‘I/Oçš„ï¼ˆä¼šè°ƒç”¨å†…å»ºçš„æ“ä½œç³»ç»ŸCä»£ç çš„ï¼‰ç¨‹åºæ¥è¯´ï¼ŒGILä¼šåœ¨è¿™ä¸ªI/Oè°ƒç”¨ä¹‹å‰è¢«é‡Šæ”¾ï¼Œä»¥å…è®¸å…¶ä»–çº¿ç¨‹åœ¨è¿™ä¸ªçº¿ç¨‹ç­‰å¾…I/Oçš„æ—¶å€™è¿è¡Œã€‚æˆ‘ä»¬å¯ä»¥æŠŠä¸€äº› è®¡ç®—å¯†é›†å‹ä»»åŠ¡ç”¨Cè¯­è¨€ç¼–å†™ï¼Œç„¶åæŠŠ.soé“¾æ¥åº“å†…å®¹åŠ è½½åˆ°Pythonä¸­ï¼Œå› ä¸ºæ‰§è¡ŒCä»£ç ï¼ŒGILé”ä¼šé‡Šæ”¾ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå°±å¯ä»¥åšåˆ°æ¯ä¸ªæ ¸éƒ½è·‘ä¸€ä¸ªçº¿ç¨‹çš„ç›®çš„ï¼ å¯èƒ½æœ‰çš„å°ä¼™ä¼´ä¸å¤ªç†è§£ä»€ä¹ˆæ˜¯è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œä»€ä¹ˆæ˜¯I/Oå¯†é›†å‹ä»»åŠ¡ï¼Ÿ\nè®¡ç®—å¯†é›†å‹ä»»åŠ¡çš„ç‰¹ç‚¹æ˜¯è¦è¿›è¡Œå¤§é‡çš„è®¡ç®—ï¼Œæ¶ˆè€—CPUèµ„æºï¼Œæ¯”å¦‚è®¡ç®—åœ†å‘¨ç‡ã€å¯¹è§†é¢‘è¿›è¡Œé«˜æ¸…è§£ç ç­‰ç­‰ï¼Œå…¨é CPUçš„è¿ç®—èƒ½åŠ›ã€‚è¿™ç§è®¡ç®—å¯†é›†å‹ä»»åŠ¡è™½ç„¶ä¹Ÿå¯ä»¥ç”¨å¤šä»»åŠ¡å®Œæˆï¼Œä½†æ˜¯ä»»åŠ¡è¶Šå¤šï¼ŒèŠ±åœ¨ä»»åŠ¡åˆ‡æ¢çš„æ—¶é—´å°±è¶Šå¤šï¼ŒCPUæ‰§è¡Œä»»åŠ¡çš„æ•ˆç‡å°±è¶Šä½ï¼Œæ‰€ä»¥ï¼Œè¦æœ€é«˜æ•ˆåœ°åˆ©ç”¨CPUï¼Œè®¡ç®—å¯†é›†å‹ä»»åŠ¡åŒæ—¶è¿›è¡Œçš„æ•°é‡åº”å½“ç­‰äºCPUçš„æ ¸å¿ƒæ•°ã€‚\nè®¡ç®—å¯†é›†å‹ä»»åŠ¡ç”±äºä¸»è¦æ¶ˆè€—CPUèµ„æºï¼Œå› æ­¤ï¼Œä»£ç è¿è¡Œæ•ˆç‡è‡³å…³é‡è¦ã€‚Pythonè¿™æ ·çš„è„šæœ¬è¯­è¨€è¿è¡Œæ•ˆç‡å¾ˆä½ï¼Œå®Œå…¨ä¸é€‚åˆè®¡ç®—å¯†é›†å‹ä»»åŠ¡ã€‚å¯¹äºè®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œæœ€å¥½ç”¨Cè¯­è¨€ç¼–å†™ã€‚\nç¬¬äºŒç§ä»»åŠ¡çš„ç±»å‹æ˜¯IOå¯†é›†å‹ï¼Œæ¶‰åŠåˆ°ç½‘ç»œã€ç£ç›˜IOçš„ä»»åŠ¡éƒ½æ˜¯IOå¯†é›†å‹ä»»åŠ¡ï¼Œè¿™ç±»ä»»åŠ¡çš„ç‰¹ç‚¹æ˜¯CPUæ¶ˆè€—å¾ˆå°‘ï¼Œä»»åŠ¡çš„å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ç­‰å¾…IOæ“ä½œå®Œæˆï¼ˆå› ä¸ºIOçš„é€Ÿåº¦è¿œè¿œä½äºCPUå’Œå†…å­˜çš„é€Ÿåº¦ï¼‰ã€‚å¯¹äºIOå¯†é›†å‹ä»»åŠ¡ï¼Œä»»åŠ¡è¶Šå¤šï¼ŒCPUæ•ˆç‡è¶Šé«˜ï¼Œä½†ä¹Ÿæœ‰ä¸€ä¸ªé™åº¦ã€‚å¸¸è§çš„å¤§éƒ¨åˆ†ä»»åŠ¡éƒ½æ˜¯IOå¯†é›†å‹ä»»åŠ¡ï¼Œæ¯”å¦‚Webåº”ç”¨ã€‚\nIOå¯†é›†å‹ä»»åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œ99%çš„æ—¶é—´éƒ½èŠ±åœ¨IOä¸Šï¼ŒèŠ±åœ¨CPUä¸Šçš„æ—¶é—´å¾ˆå°‘ï¼Œå› æ­¤ï¼Œç”¨è¿è¡Œé€Ÿåº¦æå¿«çš„Cè¯­è¨€æ›¿æ¢ç”¨Pythonè¿™æ ·è¿è¡Œé€Ÿåº¦æä½çš„è„šæœ¬è¯­è¨€ï¼Œå®Œå…¨æ— æ³•æå‡è¿è¡Œæ•ˆç‡ã€‚å¯¹äºIOå¯†é›†å‹ä»»åŠ¡ï¼Œæœ€åˆé€‚çš„è¯­è¨€å°±æ˜¯å¼€å‘æ•ˆç‡æœ€é«˜ï¼ˆä»£ç é‡æœ€å°‘ï¼‰çš„è¯­è¨€ï¼Œè„šæœ¬è¯­è¨€æ˜¯é¦–é€‰ï¼ŒCè¯­è¨€æœ€å·®ã€‚\nç»¼ä¸Šï¼ŒPythonå¤šçº¿ç¨‹ç›¸å½“äºå•æ ¸å¤šçº¿ç¨‹ï¼Œå¤šçº¿ç¨‹æœ‰ä¸¤ä¸ªå¥½å¤„ï¼šCPUå¹¶è¡Œï¼ŒIOå¹¶è¡Œï¼Œå•æ ¸å¤šçº¿ç¨‹ç›¸å½“äºè‡ªæ–­ä¸€è‡‚ã€‚æ‰€ä»¥ï¼Œåœ¨Pythonä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œä½†ä¸è¦æŒ‡æœ›èƒ½æœ‰æ•ˆåˆ©ç”¨å¤šæ ¸ã€‚å¦‚æœä¸€å®šè¦é€šè¿‡å¤šçº¿ç¨‹åˆ©ç”¨å¤šæ ¸ï¼Œé‚£åªèƒ½é€šè¿‡Cæ‰©å±•æ¥å®ç°ï¼Œä¸è¿‡è¿™æ ·å°±å¤±å»äº†Pythonç®€å•æ˜“ç”¨çš„ç‰¹ç‚¹ã€‚ä¸è¿‡ï¼Œä¹Ÿä¸ç”¨è¿‡äºæ‹…å¿ƒï¼ŒPythonè™½ç„¶ä¸èƒ½åˆ©ç”¨å¤šçº¿ç¨‹å®ç°å¤šæ ¸ä»»åŠ¡ï¼Œä½†å¯ä»¥é€šè¿‡å¤šè¿›ç¨‹å®ç°å¤šæ ¸ä»»åŠ¡ã€‚å¤šä¸ªPythonè¿›ç¨‹æœ‰å„è‡ªç‹¬ç«‹çš„GILé”ï¼Œäº’ä¸å½±å“ã€‚\nä¸‰ã€å…¶ä»–è§£é‡Š åœ¨æˆ‘ä»¬å›è¿‡å¤´çœ‹ä¸‹é‚£å¥ç»å…¸çš„è¯\u0026quot;å› ä¸ºGILçš„å­˜åœ¨ï¼Œpythonçš„å¤šçº¿ç¨‹ä¸èƒ½åˆ©ç”¨å¤šæ ¸CPU\u0026quot;ï¼Œè¿™å¥è¯å¾ˆå®¹æ˜“è®©äººç†è§£æˆGILä¼šè®©pythonåœ¨ä¸€ä¸ªæ ¸å¿ƒä¸Šè¿è¡Œï¼Œæœ‰äº†ä»Šå¤©çš„ä¾‹å­æˆ‘ä»¬å†æ¥é‡æ–°ç†è§£è¿™å¥è¯ï¼ŒGILçš„å­˜åœ¨è®©pythonåœ¨åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è¿è¡Œï¼Œè¿™æ¯‹åº¸ç½®ç–‘ï¼Œä½†æ˜¯å®ƒå¹¶æ²¡æœ‰ç»™çº¿ç¨‹é”æ­»æˆ–è€…è¯´æŒ‡å®šåªèƒ½åœ¨æŸä¸ªcpuä¸Šè¿è¡Œï¼Œå¦å¤–æˆ‘éœ€è¦è¯´æ˜ä¸€ç‚¹çš„æ˜¯GILæ˜¯ä¸è¿›ç¨‹å¯¹åº”çš„ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªGILã€‚pythonçº¿ç¨‹çš„æ‰§è¡Œæµç¨‹æˆ‘çš„ç†è§£æ˜¯è¿™æ ·çš„ çº¿ç¨‹ â€”â€”\u0026gt;æŠ¢GILâ€”â€”\u0026gt;CPU è¿™ç§æ‰§è¡Œæµç¨‹å¯¼è‡´äº†CPUå¯†é›†å‹çš„å¤šçº¿ç¨‹ç¨‹åºè™½ç„¶èƒ½å¤Ÿåˆ©ç”¨å¤šæ ¸cpuæ—¶è·Ÿå•æ ¸cpuæ˜¯å·®ä¸å¤šçš„ï¼Œå¹¶ä¸”ç”±äºå¤šä¸ªçº¿ç¨‹æŠ¢GILè¿™ä¸ªç¯èŠ‚å¯¼è‡´è¿è¡Œæ•ˆç‡\u0026lt;=å•çº¿ç¨‹ã€‚çœ‹åˆ°è¿™å¯èƒ½ä¼šè®©äººäº§ç”Ÿä¸€ç§é”™è§‰ï¼Œæœ‰äº†GILåpythonæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¥½åƒæ ¹æœ¬ä¸éœ€è¦çº¿ç¨‹é”ï¼Œè€Œå®é™…æƒ…å†µæ˜¯çº¿ç¨‹æ‹¿åˆ°CPUèµ„æºåå¹¶ä¸æ˜¯ä¸€ç›´æ‰§è¡Œçš„ï¼Œpythonè§£é‡Šå™¨åœ¨æ‰§è¡Œäº†è¯¥çº¿ç¨‹100æ¡å­—èŠ‚ç (æ³¨æ„æ˜¯å­—èŠ‚ç ä¸æ˜¯ä»£ç )æ—¶ä¼šé‡Šæ”¾æ‰è¯¥çº¿ç¨‹çš„GILï¼Œå¦‚æœè¿™æ—¶å€™æ²¡æœ‰åŠ é”é‚£ä¹ˆå…¶ä»–çº¿ç¨‹å°±å¯èƒ½ä¿®æ”¹è¯¥çº¿ç¨‹ç”¨åˆ°çš„èµ„æº; å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯é‡åˆ°IOä¹Ÿä¼šé‡Šæ”¾GIL\næœ€åç»“è®ºæ˜¯ï¼Œå› ä¸ºGILçš„å­˜åœ¨ï¼Œpythonçš„å¤šçº¿ç¨‹è™½ç„¶å¯ä»¥åˆ©ç”¨å¤šæ ¸CPUï¼Œä½†å¹¶ä¸èƒ½è®©å¤šä¸ªæ ¸åŒæ—¶å·¥ä½œã€‚","title":"Pythonå¤šçº¿ç¨‹å¤šè¿›ç¨‹"},{"content":"ç®€ä»‹ RocksDB æ˜¯ç”± Facebook åŸºäº LevelDB å¼€å‘çš„ä¸€æ¬¾æä¾›é”®å€¼å­˜å‚¨ä¸è¯»å†™åŠŸèƒ½çš„ LSM-tree æ¶æ„å¼•æ“ã€‚ç”¨æˆ·å†™å…¥çš„é”®å€¼å¯¹ä¼šå…ˆå†™å…¥ç£ç›˜ä¸Šçš„ WAL (Write Ahead Log)ï¼Œç„¶åå†å†™å…¥å†…å­˜ä¸­çš„è·³è¡¨ï¼ˆSkipListï¼Œè¿™éƒ¨åˆ†ç»“æ„åˆè¢«ç§°ä½œ MemTableï¼‰ã€‚LSM-tree å¼•æ“ç”±äºå°†ç”¨æˆ·çš„éšæœºä¿®æ”¹ï¼ˆæ’å…¥ï¼‰è½¬åŒ–ä¸ºäº†å¯¹ WAL æ–‡ä»¶çš„é¡ºåºå†™ï¼Œå› æ­¤å…·æœ‰æ¯” B æ ‘ç±»å­˜å‚¨å¼•æ“æ›´é«˜çš„å†™ååã€‚\nå†…å­˜ä¸­çš„æ•°æ®è¾¾åˆ°ä¸€å®šé˜ˆå€¼åï¼Œä¼šåˆ·åˆ°ç£ç›˜ä¸Šç”Ÿæˆ SST æ–‡ä»¶ (Sorted String Table)ï¼ŒSST åˆåˆ†ä¸ºå¤šå±‚ï¼ˆé»˜è®¤è‡³å¤š 6 å±‚ï¼‰ï¼Œæ¯ä¸€å±‚çš„æ•°æ®è¾¾åˆ°ä¸€å®šé˜ˆå€¼åä¼šæŒ‘é€‰ä¸€éƒ¨åˆ† SST åˆå¹¶åˆ°ä¸‹ä¸€å±‚ï¼Œæ¯ä¸€å±‚çš„æ•°æ®æ˜¯ä¸Šä¸€å±‚çš„ 10 å€ï¼ˆå› æ­¤ 90% çš„æ•°æ®å­˜å‚¨åœ¨æœ€åä¸€å±‚ï¼‰ã€‚\nRocksDB å…è®¸ç”¨æˆ·åˆ›å»ºå¤šä¸ª ColumnFamily ï¼Œè¿™äº› ColumnFamily å„è‡ªæ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜è·³è¡¨ä»¥åŠ SST æ–‡ä»¶ï¼Œä½†æ˜¯å…±äº«åŒä¸€ä¸ª WAL æ–‡ä»¶ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å¯ä»¥æ ¹æ®åº”ç”¨ç‰¹ç‚¹ä¸ºä¸åŒçš„ ColumnFamily é€‰æ‹©ä¸åŒçš„é…ç½®ï¼Œä½†æ˜¯åˆæ²¡æœ‰å¢åŠ å¯¹ WAL çš„å†™æ¬¡æ•°ã€‚\nrocksdb å’Œ leveldbå¯¹æ¯”ä¼˜åŠ¿ Leveldbæ˜¯å•çº¿ç¨‹åˆå¹¶æ–‡ä»¶ï¼ŒRocksdbå¯ä»¥æ”¯æŒå¤šçº¿ç¨‹åˆå¹¶æ–‡ä»¶ï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸çš„ç‰¹æ€§ï¼ŒåŠ å¿«æ–‡ä»¶åˆå¹¶çš„é€Ÿåº¦ï¼Œé¿å…æ–‡ä»¶åˆå¹¶æœŸé—´å¼•èµ·ç³»ç»Ÿåœé¡¿ Leveldbåªæœ‰ä¸€ä¸ªMemtableï¼Œè‹¥Memtableæ»¡äº†è¿˜æ²¡æœ‰æ¥å¾—åŠæŒä¹…åŒ–ï¼Œåˆ™ä¼šå¼•èµ·ç³»ç»Ÿåœé¡¿ï¼ŒRocksdbå¯ä»¥æ ¹æ®éœ€è¦å¼€è¾Ÿå¤šä¸ªMemtableï¼› Leveldbåªèƒ½è·å–å•ä¸ªK-Vï¼ŒRocksdbæ”¯æŒä¸€æ¬¡è·å–å¤šä¸ªK-Vã€‚ Levledbä¸æ”¯æŒå¤‡ä»½ï¼ŒRocksdbæ”¯æŒå…¨é‡å’Œå¤‡ä»½ã€‚ æ¶æ„ RocksDB æ˜¯åŸºäº LSM-Tree çš„ã€‚Rocksdbç»“æ„å›¾å¦‚ä¸‹: LSM-Tree èƒ½å°†ç¦»æ•£çš„éšæœºå†™è¯·æ±‚éƒ½è½¬æ¢æˆæ‰¹é‡çš„é¡ºåºå†™è¯·æ±‚ï¼ˆWAL + Compactionï¼‰ï¼Œä»¥æ­¤æé«˜å†™æ€§èƒ½ã€‚ sstæ–‡ä»¶æ˜¯åœ¨ç¡¬ç›˜ä¸Šçš„ã€‚SST filesæŒ‰ç…§key æ’åºï¼Œä¸”æ¯ä¸ªæ–‡ä»¶çš„key rangeäº’ç›¸ä¸é‡å ã€‚ä¸ºäº†checkä¸€ä¸ªkeyå¯èƒ½å­˜åœ¨äºå“ªä¸€ä¸ªä¸€ä¸ªSST fileä¸­ï¼ŒRocksDBå¹¶æ²¡æœ‰ä¾æ¬¡éå†æ¯ä¸€ä¸ªSST fileï¼Œç„¶åå»æ£€æŸ¥keyæ˜¯å¦åœ¨è¿™ä¸ªfileçš„key range å†…ï¼Œè€Œæ˜¯æ‰§è¡ŒäºŒåˆ†æœç´¢ç®—æ³•ï¼ˆFileMetaData.largest ï¼‰å»å®šä½è¿™ä¸ªSST fileã€‚ ä»»ä½•çš„å†™å…¥éƒ½ä¼šå…ˆå†™åˆ° WALï¼Œç„¶ååœ¨å†™å…¥ Memory Table(Memtable)ã€‚å½“ç„¶ä¸ºäº†æ€§èƒ½ï¼Œä¹Ÿå¯ä»¥ä¸å†™å…¥ WALï¼Œä½†è¿™æ ·å°±å¯èƒ½é¢ä¸´å´©æºƒä¸¢å¤±æ•°æ®çš„é£é™©ã€‚ å½“ä¸€ä¸ª Memtable å†™æ»¡äº†ä¹‹åï¼Œå°±ä¼šå˜æˆ immutable çš„ Memtableï¼ŒRocksDB åœ¨åå°ä¼šé€šè¿‡ä¸€ä¸ª flush çº¿ç¨‹å°†è¿™ä¸ª Memtable flush åˆ°ç£ç›˜ï¼Œç”Ÿæˆä¸€ä¸ª Sorted String Table(SST) æ–‡ä»¶ï¼Œæ”¾åœ¨ Level 0 å±‚ã€‚å½“ Level 0 å±‚çš„ SST æ–‡ä»¶ä¸ªæ•°è¶…è¿‡é˜ˆå€¼ä¹‹åï¼Œå°±ä¼šé€šè¿‡ Compaction ç­–ç•¥å°†å…¶æ”¾åˆ° Level 1 å±‚ï¼Œä»¥æ­¤ç±»æ¨ã€‚ è¿™é‡Œå…³é”®å°±æ˜¯ Compactionï¼Œå¦‚æœæ²¡æœ‰ Compactionï¼Œé‚£ä¹ˆå†™å…¥æ˜¯éå¸¸å¿«çš„ï¼Œä½†ä¼šé€ æˆè¯»æ€§èƒ½é™ä½ï¼ŒåŒæ ·ä¹Ÿä¼šé€ æˆå¾ˆä¸¥é‡çš„ç©ºé—´æ”¾å¤§é—®é¢˜ã€‚å¯¹äº RocksDB æ¥è¯´ï¼Œä»–æœ‰ä¸‰ç§ Compaction ç­–ç•¥ï¼Œä¸€ç§å°±æ˜¯é»˜è®¤çš„ Leveled Compactionï¼Œå¦ä¸€ç§å°±æ˜¯ Universal Compactionï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ Size-Tired Compactionï¼Œè¿˜æœ‰ä¸€ç§å°±æ˜¯ FIFO Compactionã€‚å¯¹äº FIFO æ¥è¯´ï¼Œå®ƒçš„ç­–ç•¥éå¸¸çš„ç®€å•ï¼Œæ‰€æœ‰çš„ SST éƒ½åœ¨ Level 0ï¼Œå¦‚æœè¶…è¿‡äº†é˜ˆå€¼ï¼Œå°±ä»æœ€è€çš„ SST å¼€å§‹åˆ é™¤ï¼Œå…¶å®å¯ä»¥çœ‹åˆ°ï¼Œè¿™å¥—æœºåˆ¶éå¸¸é€‚åˆäºå­˜å‚¨æ—¶åºæ•°æ®ã€‚ å®é™…å¯¹äº RocksDB æ¥è¯´ï¼Œå®ƒå…¶å®ç”¨çš„æ˜¯ä¸€ç§ Hybrid çš„ç­–ç•¥ï¼Œåœ¨ Level 0 å±‚ï¼Œå®ƒå…¶å®æ˜¯ä¸€ä¸ª Size-Tired çš„ï¼Œè€Œåœ¨å…¶ä»–å±‚å°±æ˜¯ Leveled çš„ã€‚ RocksDBæ”¶åˆ°å†™å…¥è¯·æ±‚æ—¶ï¼Œä¼šç›´æ¥å°†æ•°æ®å†™å…¥å†…å­˜å³RocksDBå®šä¹‰çš„åŒºåŸŸMemtableï¼Œä»¥åŠWALï¼ˆWrite Ahead Loggingï¼Œé˜²æ­¢æœåŠ¡é‡ç½®å¯¼è‡´çš„æ•°æ®ä¸¢å¤±ï¼‰ä¸­ï¼Œå½“å†™å…¥Memtableçš„æ•°æ®è¾¾åˆ°é˜ˆå€¼ï¼Œåˆ™è½¬ä¸ºä¸å¯å†™å…¥çŠ¶æ€Immutableï¼ŒåŒæ—¶ç”³è¯·æ–°çš„Memtableä¾›ä¸Šå±‚åº”ç”¨ç»§ç»­å†™å…¥ã€‚RocksDBä¼šé€šè¿‡å¼‚æ­¥çš„æ–¹å¼å°†æ•°æ®Flushåˆ°SSTæ•°æ®æ–‡ä»¶ä¸­ï¼ŒRocksDBå¯¹SSTæ–‡ä»¶çš„ç¼–æ’å°±é‡‡ç”¨äº†LSMæ ‘çš„ç®¡ç†æ–¹å¼ï¼Œæ¯å±‚SSTåˆ°è¾¾é˜ˆå€¼ï¼ŒRocksDBä¼šå¯åŠ¨å¼‚æ­¥çº¿ç¨‹è¿›è¡ŒCompactionæ“ä½œï¼Œå°†æ–‡ä»¶å†…çš„æœ«ç«¯èŠ‚ç‚¹æ•°æ®è¿›è¡Œåˆå¹¶åˆ°ä¸‹ä¸€å±‚SSTçš„æ–‡ä»¶ä¸­ã€‚ å†™å…¥æµç¨‹ é¦–å…ˆå½“ä¸€æ¡æ•°æ®å†™å…¥rocksdbæ—¶ï¼Œ ä¼šå°†è¿™æ¡è®°å½•å°è£…æˆä¸€ä¸ªbatch, ä¹Ÿå¯ä»¥æ˜¯å¤šæ¡è®°å½•ä¸€ä¸ªbatchï¼Œç”±batchæ¥ä¿è¯åŸå­æ“ä½œã€‚å°±æ˜¯ä¸€ä¸ªbatché‡Œçš„æ•°æ®è¦ä¹ˆå…¨éƒ¨æˆåŠŸè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚ ç¬¬ä¸€æ­¥å…ˆä»¥æ—¥å¿—çš„å½¢å¼è½åœ°ç£ç›˜ï¼Œè®°write ahead log -\u0026gt; .wal æ–‡ä»¶ã€‚ è½åœ°æˆåŠŸåå†å†™å…¥memtableã€‚ 1.è¿™é‡Œè®°å½•walçš„åŸå› å°±æ˜¯é˜²æ­¢é‡å¯æ—¶å†…å­˜ä¸­çš„æ•°æ®ä¸¢å¤±ã€‚æ‰€ä»¥åœ¨dbé‡æ–°æ‰“å¼€æ—¶ä¼šå…ˆä»walæ¢å¤å†…å­˜ä¸­çš„memtable. å¯é…ç½®WALä¿å­˜åœ¨å¯é çš„å­˜å‚¨é‡Œã€‚ 2.è¿™é‡Œçš„memtableæ˜¯åœ¨å†…å­˜ä¸­çš„ä¸€ä¸ªè·³è¡¨ç»“æ„ï¼ˆskiplistï¼‰ã€‚æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å­˜å‚¨ç€ä¸€ä¸ªkey, value. è·³è¡¨å¯ä½¿æŸ¥æ‰¾çš„å¤æ‚åº¦ä¸ºlogn, åŒæ—¶æ’å…¥æ•°æ®éå¸¸ç®€å•ã€‚æ¯ä¸ªbatchç‹¬å memtableçš„å†™é”ã€‚è¿™ä¸ªæ˜¯ä¸ºäº†é¿å…å¤šçº¿ç¨‹å†™é€ æˆçš„æ•°æ®é”™ä¹±ã€‚\nå½“memtableçš„æ•°æ®å¤§å°è¶…è¿‡é˜ˆå€¼(write_buffer_size)åï¼Œä¼šæ–°ç”Ÿæˆä¸€ä¸ªmemtableç»§ç»­å†™ï¼Œå°†å‰ä¸€ä¸ªmemtableä¿å­˜ä¸ºåªè¯»memtable -\u0026gt; immutabel. å½“åªè¯»memtableçš„æ•°é‡è¶…è¿‡é˜ˆå€¼åï¼Œä¼šå°†æ‰€æœ‰çš„åªè¯»memtableåˆå¹¶å¹¶flushåˆ°ç£ç›˜ç”Ÿæˆä¸€ä¸ªSSTæ–‡ä»¶ã€‚è¿™é‡Œçš„SSTå±äºlevel0, level0ä¸­çš„æ¯ä¸ªSSTæœ‰åºï¼Œæ•´ä¸ªlevel0ä¸ä¸€å®šæœ‰åºã€‚ å½“level0çš„sstæ–‡ä»¶æ•°è¶…è¿‡é˜ˆå€¼æˆ–è€…æ€»å¤§å°è¶…è¿‡é˜ˆå€¼ï¼Œä¼šè§¦å‘compactionæ“ä½œï¼Œå°†level0ä¸­çš„æ•°æ®åˆå¹¶åˆ°level1ä¸­ã€‚åŒæ ·level1çš„æ–‡ä»¶æ•°è¶…è¿‡é˜ˆå€¼æˆ–è€…æ€»å¤§å°è¶…è¿‡é˜ˆå€¼ï¼Œä¹Ÿä¼šè§¦å‘compactionæ“ä½œï¼Œ è¿™æ—¶å€™éšæœºé€‰æ‹©ä¸€ä¸ªsståˆå¹¶åˆ°æ›´é«˜å±‚çš„levelä¸­ã€‚ 1ï¼šlevel1 åŠå…¶ä»¥ä¸Šçš„leveléƒ½æ•´ä½“æœ‰åºã€‚æ¯ä¸ªsstå­˜å‚¨ä¸€ä¸ªèŒƒå›´çš„æ•°æ®äº’ä¸äº¤å‰äº’ä¸é‡åˆï¼› 2: level1 ä»¥ä¸Šçš„ compactionæ“ä½œå¯ä»¥å¤šçº¿ç¨‹æ‰§è¡Œï¼Œå‰ææ˜¯æ¯ä¸ªçº¿ç¨‹æ‰€æ“ä½œçš„æ•°æ®äº’ä¸äº¤å‰ã€‚\nè¯»å–æµç¨‹ RocksDBä¸­çš„æ¯ä¸€æ¡è®°å½•(KeyValue)éƒ½æœ‰ä¸€ä¸ªlsn(LogSequenceNumber)ï¼Œä»æœ€åˆçš„0å¼€å§‹ï¼Œæ¯æ¬¡å†™å…¥åŠ 1ã€‚lsnåœ¨memtableä¸­å•è°ƒé€’å¢ã€‚\né¦–å…ˆè¯»æ“ä½œå…ˆè®¿é—®memtableã€‚è·³è¡¨çš„æ—¶é—´å¤æ‚åº¦å¯è¾¾åˆ°lognã€‚ å¦‚æœä¸å­˜åœ¨ä¼šè®¿é—®level0, è€Œlevel0æ•´ä½“ä¸æ˜¯æœ‰åºçš„ï¼Œ æ‰€ä»¥ä¼šæŒ‰åˆ›å»ºæ—¶é—´ç”±æ–°åˆ°è€ä¾æ¬¡è®¿é—®æ¯ä¸€ä¸ªsstæ–‡ä»¶ã€‚æ‰€ä»¥æ—¶é—´å¤æ‚åº¦ä¸ºm*lognã€‚ å¦‚æœä»ä¸å­˜åœ¨ï¼Œåˆ™ç»§ç»­è®¿é—®level1ï¼Œç”±äºlevel1åŠå…¶ä»¥ä¸Šçš„leveléƒ½æ•´ä½“æœ‰åºï¼Œæ‰€ä»¥åªéœ€è¦è®¿é—®ä¸€ä¸ªsstæ–‡ä»¶å³å¯ã€‚ ç›´åˆ°æŸ¥æ‰¾åˆ°æœ€é«˜å±‚æˆ–è€…æ‰¾åˆ°è¿™ä¸ªkeyã€‚æ‰€ä»¥è¯»æ“ä½œå¯èƒ½ä¼šè¢«æ”¾å¤§å¥½å¤šå€ã€‚ æ€»ç»“: è¯»å–çš„é¡ºåºä¸ºmemtable-\u0026gt;immutable memtable-\u0026gt;level 0 SST-\u0026gt;â€¦-\u0026gt;level n SSTã€‚å…¶ä¸­ï¼Œmemtableå’Œimmutable memtableé‡‡ç”¨äº†è·³è¡¨ç‰¹æ€§è¿›è¡ŒæŸ¥è¯¢ï¼ŒSSTæ–‡ä»¶ä¸­æœ‰è¿‡æ»¤å™¨ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰å†³å®šæ˜¯å¦åŒ…å«æŸä¸ªkeyå†åŠ è½½è‡³å†…å­˜ï¼ŒåŸºäºæœ‰åºKVè¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ã€‚åŒæ—¶ï¼Œåœ¨memtableå’ŒSSTä¹‹ä¸Šè¿˜è®¾ç½®äº†Block Cacheï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚\nrocksdbçš„compaction è¯»æ”¾å¤§ï¼ˆRead Amplificationï¼‰ã€‚è¯»å–æ•°æ®æ—¶å®é™…è¯»å–çš„æ•°æ®é‡å¤§äºçœŸæ­£çš„æ•°æ®é‡ã€‚LSM-Tree çš„è¯»æ“ä½œéœ€è¦ä»æ–°åˆ°æ—§ï¼ˆä»ä¸Šåˆ°ä¸‹ï¼‰ä¸€å±‚ä¸€å±‚æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°æƒ³è¦çš„æ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦ä¸æ­¢ä¸€æ¬¡ I/Oã€‚ç‰¹åˆ«æ˜¯ range query çš„æƒ…å†µï¼Œå½±å“å¾ˆæ˜æ˜¾ã€‚ ç©ºé—´æ”¾å¤§ï¼ˆSpace Amplificationï¼‰ã€‚æ•°æ®å®é™…å ç”¨çš„ç£ç›˜ç©ºé—´æ¯”æ•°æ®çš„çœŸæ­£å¤§å°æ›´å¤šã€‚å› ä¸ºæ‰€æœ‰çš„å†™å…¥éƒ½æ˜¯é¡ºåºå†™ï¼ˆappend-onlyï¼‰çš„ï¼Œä¸æ˜¯ in-place update ï¼Œæ‰€ä»¥è¿‡æœŸæ•°æ®ä¸ä¼šé©¬ä¸Šè¢«æ¸…ç†æ‰ã€‚ å†™æ”¾å¤§ã€‚å†™å…¥æ•°æ®æ—¶å®é™…å†™å…¥çš„æ•°æ®é‡å¤§äºçœŸæ­£çš„æ•°æ®é‡ã€‚å®é™…å†™å…¥ HDD/SSD çš„æ•°æ®å¤§å°å’Œç¨‹åºè¦æ±‚å†™å…¥æ•°æ®å¤§å°ä¹‹æ¯”ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼ŒHDD/SSD è§‚å¯Ÿåˆ°çš„å†™å…¥æ•°æ®å¤šäºä¸Šå±‚ç¨‹åºå†™å…¥çš„æ•°æ®ã€‚ compactionç‰¹æ€§ï¼š RocksDB å’Œ LevelDB é€šè¿‡åå°çš„ compaction æ¥å‡å°‘è¯»æ”¾å¤§ï¼ˆå‡å°‘ SST æ–‡ä»¶æ•°é‡ï¼‰å’Œç©ºé—´æ”¾å¤§ï¼ˆæ¸…ç†è¿‡æœŸæ•°æ®ï¼‰ã€‚ å†™æ”¾å¤§ï¼ˆWrite Amplificationï¼‰ çš„é—®é¢˜ã€‚compactionå…¶å®å°±æ˜¯ä»¥å†™æ”¾å¤§ä½œä¸ºä»£ä»·ï¼Œæ¢å–æ›´å¥½çš„è¯»å–æ€§èƒ½ã€‚\nåœ¨ HDD ä½œä¸ºä¸»æµå­˜å‚¨çš„æ—¶ä»£ï¼ŒRocksDB çš„ compaction å¸¦æ¥çš„å†™æ”¾å¤§é—®é¢˜å¹¶æ²¡æœ‰éå¸¸æ˜æ˜¾ã€‚è¿™æ˜¯å› ä¸ºï¼š\nHDD é¡ºåºè¯»å†™æ€§èƒ½è¿œè¿œä¼˜äºéšæœºè¯»å†™æ€§èƒ½ï¼Œè¶³ä»¥æŠµæ¶ˆå†™æ”¾å¤§å¸¦æ¥çš„å¼€é”€ã€‚ HDD çš„å†™å…¥é‡åŸºæœ¬ä¸å½±å“å…¶ä½¿ç”¨å¯¿å‘½ã€‚ ç°åœ¨ SSD é€æ¸æˆä¸ºä¸»æµå­˜å‚¨ï¼Œcompaction å¸¦æ¥çš„å†™æ”¾å¤§é—®é¢˜æ˜¾å¾—è¶Šæ¥è¶Šä¸¥é‡ï¼š\nSSD é¡ºåºè¯»å†™æ€§èƒ½æ¯”éšæœºè¯»å†™æ€§èƒ½å¥½ä¸€äº›ï¼Œä½†æ˜¯å·®è·å¹¶æ²¡æœ‰ HDD é‚£ä¹ˆå¤§ã€‚æ‰€ä»¥ï¼Œé¡ºåºå†™ç›¸æ¯”éšæœºå†™å¸¦æ¥çš„å¥½å¤„ï¼Œèƒ½ä¸èƒ½æŠµæ¶ˆå†™æ”¾å¤§å¸¦æ¥çš„å¼€é”€ï¼Œè¿™æ˜¯ä¸ªé—®é¢˜ã€‚ SSD çš„ä½¿ç”¨å¯¿å‘½å’Œå…¶å†™å…¥é‡æœ‰å…³ï¼Œå†™æ”¾å¤§å¤ªä¸¥é‡ä¼šå¤§å¤§ç¼©çŸ­ SSD çš„ä½¿ç”¨å¯¿å‘½ã€‚å› ä¸º SSD ä¸æ”¯æŒè¦†ç›–å†™ï¼Œå¿…é¡»å…ˆæ“¦é™¤ï¼ˆeraseï¼‰å†å†™å…¥ã€‚è€Œæ¯ä¸ª SSD blockï¼ˆblock æ˜¯ SSD æ“¦é™¤æ“ä½œçš„åŸºæœ¬å•ä½ï¼‰ çš„å¹³å‡æ“¦é™¤æ¬¡æ•°æ˜¯æœ‰é™çš„ã€‚\nrocksdbåšäº†å‡ ç‚¹ä¼˜åŒ–: ä¸€ç‚¹æ˜¯ä¸ºæ¯ä¸ªSSTæä¾›ä¸€ä¸ªå¯é…ç½®çš„bloomfilter. æ¯ä¸ªlevelçš„é…ç½®ä¸ä¸€æ ·ã€‚è¿™æ ·å¯ä»¥å¿«é€Ÿçš„ç¡®è®¤ä¸€ä¸ªkeyåœ¨ä¸åœ¨æŸä¸ªSSTä¸­ï¼Œè¿™ç‚¹ä»¥ç‰ºç‰²ç£ç›˜ç©ºé—´æ¥æ¢å–æ—¶é—´ã€‚ å¦ä¸€ç‚¹æ˜¯æä¾›å¯é…ç½®çš„cache, ç”¨äºä¿å­˜è®¿é—®è¿‡çš„keyåœ¨å†…å­˜ä¸­, å®ƒç¼“å­˜çš„æ˜¯æŸä¸ªkeyåœ¨SSTæ–‡ä»¶ä¸­çš„æ•´ä¸ªblocké‡Œçš„è®°å½•ã€‚ ","permalink":"https://reid00.github.io/en/posts/storage/rocksdb/","summary":"ç®€ä»‹ RocksDB æ˜¯ç”± Facebook åŸºäº LevelDB å¼€å‘çš„ä¸€æ¬¾æä¾›é”®å€¼å­˜å‚¨ä¸è¯»å†™åŠŸèƒ½çš„ LSM-tree æ¶æ„å¼•æ“ã€‚ç”¨æˆ·å†™å…¥çš„é”®å€¼å¯¹ä¼šå…ˆå†™å…¥ç£ç›˜ä¸Šçš„ WAL (Write Ahead Log)ï¼Œç„¶åå†å†™å…¥å†…å­˜ä¸­çš„è·³è¡¨ï¼ˆSkipListï¼Œè¿™éƒ¨åˆ†ç»“æ„åˆè¢«ç§°ä½œ MemTableï¼‰ã€‚LSM-tree å¼•æ“ç”±äºå°†ç”¨æˆ·çš„éšæœºä¿®æ”¹ï¼ˆæ’å…¥ï¼‰è½¬åŒ–ä¸ºäº†å¯¹ WAL æ–‡ä»¶çš„é¡ºåºå†™ï¼Œå› æ­¤å…·æœ‰æ¯” B æ ‘ç±»å­˜å‚¨å¼•æ“æ›´é«˜çš„å†™ååã€‚\nå†…å­˜ä¸­çš„æ•°æ®è¾¾åˆ°ä¸€å®šé˜ˆå€¼åï¼Œä¼šåˆ·åˆ°ç£ç›˜ä¸Šç”Ÿæˆ SST æ–‡ä»¶ (Sorted String Table)ï¼ŒSST åˆåˆ†ä¸ºå¤šå±‚ï¼ˆé»˜è®¤è‡³å¤š 6 å±‚ï¼‰ï¼Œæ¯ä¸€å±‚çš„æ•°æ®è¾¾åˆ°ä¸€å®šé˜ˆå€¼åä¼šæŒ‘é€‰ä¸€éƒ¨åˆ† SST åˆå¹¶åˆ°ä¸‹ä¸€å±‚ï¼Œæ¯ä¸€å±‚çš„æ•°æ®æ˜¯ä¸Šä¸€å±‚çš„ 10 å€ï¼ˆå› æ­¤ 90% çš„æ•°æ®å­˜å‚¨åœ¨æœ€åä¸€å±‚ï¼‰ã€‚\nRocksDB å…è®¸ç”¨æˆ·åˆ›å»ºå¤šä¸ª ColumnFamily ï¼Œè¿™äº› ColumnFamily å„è‡ªæ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜è·³è¡¨ä»¥åŠ SST æ–‡ä»¶ï¼Œä½†æ˜¯å…±äº«åŒä¸€ä¸ª WAL æ–‡ä»¶ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å¯ä»¥æ ¹æ®åº”ç”¨ç‰¹ç‚¹ä¸ºä¸åŒçš„ ColumnFamily é€‰æ‹©ä¸åŒçš„é…ç½®ï¼Œä½†æ˜¯åˆæ²¡æœ‰å¢åŠ å¯¹ WAL çš„å†™æ¬¡æ•°ã€‚\nrocksdb å’Œ leveldbå¯¹æ¯”ä¼˜åŠ¿ Leveldbæ˜¯å•çº¿ç¨‹åˆå¹¶æ–‡ä»¶ï¼ŒRocksdbå¯ä»¥æ”¯æŒå¤šçº¿ç¨‹åˆå¹¶æ–‡ä»¶ï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸çš„ç‰¹æ€§ï¼ŒåŠ å¿«æ–‡ä»¶åˆå¹¶çš„é€Ÿåº¦ï¼Œé¿å…æ–‡ä»¶åˆå¹¶æœŸé—´å¼•èµ·ç³»ç»Ÿåœé¡¿ Leveldbåªæœ‰ä¸€ä¸ªMemtableï¼Œè‹¥Memtableæ»¡äº†è¿˜æ²¡æœ‰æ¥å¾—åŠæŒä¹…åŒ–ï¼Œåˆ™ä¼šå¼•èµ·ç³»ç»Ÿåœé¡¿ï¼ŒRocksdbå¯ä»¥æ ¹æ®éœ€è¦å¼€è¾Ÿå¤šä¸ªMemtableï¼› Leveldbåªèƒ½è·å–å•ä¸ªK-Vï¼ŒRocksdbæ”¯æŒä¸€æ¬¡è·å–å¤šä¸ªK-Vã€‚ Levledbä¸æ”¯æŒå¤‡ä»½ï¼ŒRocksdbæ”¯æŒå…¨é‡å’Œå¤‡ä»½ã€‚ æ¶æ„ RocksDB æ˜¯åŸºäº LSM-Tree çš„ã€‚Rocksdbç»“æ„å›¾å¦‚ä¸‹: LSM-Tree èƒ½å°†ç¦»æ•£çš„éšæœºå†™è¯·æ±‚éƒ½è½¬æ¢æˆæ‰¹é‡çš„é¡ºåºå†™è¯·æ±‚ï¼ˆWAL + Compactionï¼‰ï¼Œä»¥æ­¤æé«˜å†™æ€§èƒ½ã€‚ sstæ–‡ä»¶æ˜¯åœ¨ç¡¬ç›˜ä¸Šçš„ã€‚SST filesæŒ‰ç…§key æ’åºï¼Œä¸”æ¯ä¸ªæ–‡ä»¶çš„key rangeäº’ç›¸ä¸é‡å ã€‚ä¸ºäº†checkä¸€ä¸ªkeyå¯èƒ½å­˜åœ¨äºå“ªä¸€ä¸ªä¸€ä¸ªSST fileä¸­ï¼ŒRocksDBå¹¶æ²¡æœ‰ä¾æ¬¡éå†æ¯ä¸€ä¸ªSST fileï¼Œç„¶åå»æ£€æŸ¥keyæ˜¯å¦åœ¨è¿™ä¸ªfileçš„key range å†…ï¼Œè€Œæ˜¯æ‰§è¡ŒäºŒåˆ†æœç´¢ç®—æ³•ï¼ˆFileMetaData.","title":"RocksDB"},{"content":"æœ¬æ–‡ä¸»è¦å—ä¼—ä¸ºå¼€å‘äººå‘˜,æ‰€ä»¥ä¸æ¶‰åŠåˆ°MySQLçš„æœåŠ¡éƒ¨ç½²ç­‰æ“ä½œ,ä¸”å†…å®¹è¾ƒå¤š,å¤§å®¶å‡†å¤‡å¥½è€å¿ƒå’Œç“œå­çŸ¿æ³‰æ°´ã€‚\nå‰ä¸€é˜µç³»ç»Ÿçš„å­¦ä¹ äº†ä¸€ä¸‹MySQL,ä¹Ÿæœ‰ä¸€äº›å®é™…æ“ä½œç»éªŒ,å¶ç„¶çœ‹åˆ°ä¸€ç¯‡å’ŒMySQLç›¸å…³çš„é¢è¯•æ–‡ç« ,å‘ç°å…¶ä¸­çš„ä¸€äº›é—®é¢˜è‡ªå·±ä¹Ÿå›ç­”ä¸å¥½,è™½ç„¶çŸ¥è¯†ç‚¹å¤§éƒ¨åˆ†éƒ½çŸ¥é“,ä½†æ˜¯æ— æ³•å°†çŸ¥è¯†ä¸²è”èµ·æ¥ã€‚\nå› æ­¤å†³å®šæä¸€ä¸ªMySQLçµé­‚100é—®,è¯•ç€ç”¨å›ç­”é—®é¢˜çš„æ–¹å¼,è®©è‡ªå·±å¯¹çŸ¥è¯†ç‚¹çš„ç†è§£æ›´åŠ æ·±å…¥ä¸€ç‚¹ã€‚\næ­¤æ–‡ä¸ä¼šäº‹æ— å·¨ç»†çš„ä»selectçš„ç”¨æ³•å¼€å§‹è®²è§£mysql,ä¸»è¦é’ˆå¯¹çš„æ˜¯å¼€å‘äººå‘˜éœ€è¦çŸ¥é“çš„ä¸€äº›MySQLçš„çŸ¥è¯†ç‚¹\nä¸»è¦åŒ…æ‹¬ç´¢å¼•,äº‹åŠ¡,ä¼˜åŒ–ç­‰æ–¹é¢,ä»¥åœ¨é¢è¯•ä¸­é«˜é¢‘çš„é—®å¥å½¢å¼ç»™å‡ºç­”æ¡ˆã€‚\nMySQL é‡è¦ç¬”è®° ä¸‰ä¸‡å­—ã€91é“MySQLé¢è¯•é¢˜ï¼ˆæ”¶è—ç‰ˆï¼‰\nhttps://mp.weixin.qq.com/s/KRWyl-zU1Cd6sxbya4dP_g\nä¹¦å†™é«˜è´¨é‡SQLçš„30æ¡å»ºè®®\nhttps://mp.weixin.qq.com/s/nM6fwEyi2VZeRMWtdZGpGQ\næ•°æ®åˆ†æé¢è¯•å¿…å¤‡SQLè¯­å¥+è¯­æ³•\nhttps://mp.weixin.qq.com/s/8UZAaDyB38gsZANPLxNKgg\nç´¢å¼•ç›¸å…³ å…³äºMySQLçš„ç´¢å¼•,æ›¾ç»è¿›è¡Œè¿‡ä¸€æ¬¡æ€»ç»“,æ–‡ç« é“¾æ¥åœ¨è¿™é‡Œ Mysqlç´¢å¼•åŸç†åŠå…¶ä¼˜åŒ–.\n1. ä»€ä¹ˆæ˜¯ç´¢å¼•?\nç´¢å¼•æ˜¯ä¸€ç§æ•°æ®ç»“æ„,å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„è¿›è¡Œæ•°æ®çš„æŸ¥æ‰¾.\n2. ç´¢å¼•æ˜¯ä¸ªä»€ä¹ˆæ ·çš„æ•°æ®ç»“æ„å‘¢?\nç´¢å¼•çš„æ•°æ®ç»“æ„å’Œå…·ä½“å­˜å‚¨å¼•æ“çš„å®ç°æœ‰å…³, åœ¨MySQLä¸­ä½¿ç”¨è¾ƒå¤šçš„ç´¢å¼•æœ‰Hashç´¢å¼•,B+æ ‘ç´¢å¼•ç­‰,è€Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„InnoDBå­˜å‚¨å¼•æ“çš„é»˜è®¤ç´¢å¼•å®ç°ä¸º:B+æ ‘ç´¢å¼•.\n3. Hashç´¢å¼•å’ŒB+æ ‘æ‰€æœ‰æœ‰ä»€ä¹ˆåŒºåˆ«æˆ–è€…è¯´ä¼˜åŠ£å‘¢?\né¦–å…ˆè¦çŸ¥é“Hashç´¢å¼•å’ŒB+æ ‘ç´¢å¼•çš„åº•å±‚å®ç°åŸç†:\nhashç´¢å¼•åº•å±‚å°±æ˜¯hashè¡¨,è¿›è¡ŒæŸ¥æ‰¾æ—¶,è°ƒç”¨ä¸€æ¬¡hashå‡½æ•°å°±å¯ä»¥è·å–åˆ°ç›¸åº”çš„é”®å€¼,ä¹‹åè¿›è¡Œå›è¡¨æŸ¥è¯¢è·å¾—å®é™…æ•°æ®.B+æ ‘åº•å±‚å®ç°æ˜¯å¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘.\nå¯¹äºæ¯ä¸€æ¬¡çš„æŸ¥è¯¢éƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹å‡ºå‘,æŸ¥æ‰¾åˆ°å¶å­èŠ‚ç‚¹æ–¹å¯ä»¥è·å¾—æ‰€æŸ¥é”®å€¼,ç„¶åæ ¹æ®æŸ¥è¯¢åˆ¤æ–­æ˜¯å¦éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®.\né‚£ä¹ˆå¯ä»¥çœ‹å‡ºä»–ä»¬æœ‰ä»¥ä¸‹çš„ä¸åŒ:\nhashç´¢å¼•è¿›è¡Œç­‰å€¼æŸ¥è¯¢æ›´å¿«(ä¸€èˆ¬æƒ…å†µä¸‹),ä½†æ˜¯å´æ— æ³•è¿›è¡ŒèŒƒå›´æŸ¥è¯¢. å› ä¸ºåœ¨hashç´¢å¼•ä¸­ç»è¿‡hashå‡½æ•°å»ºç«‹ç´¢å¼•ä¹‹å,ç´¢å¼•çš„é¡ºåºä¸åŸé¡ºåºæ— æ³•ä¿æŒä¸€è‡´,ä¸èƒ½æ”¯æŒèŒƒå›´æŸ¥è¯¢.\nè€ŒB+æ ‘çš„çš„æ‰€æœ‰èŠ‚ç‚¹çš†éµå¾ª(å·¦èŠ‚ç‚¹å°äºçˆ¶èŠ‚ç‚¹,å³èŠ‚ç‚¹å¤§äºçˆ¶èŠ‚ç‚¹,å¤šå‰æ ‘ä¹Ÿç±»ä¼¼),å¤©ç„¶æ”¯æŒèŒƒå›´.\nhashç´¢å¼•ä¸æ”¯æŒä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åº,åŸç†åŒä¸Š.\nhashç´¢å¼•ä¸æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢ä»¥åŠå¤šåˆ—ç´¢å¼•çš„æœ€å·¦å‰ç¼€åŒ¹é….åŸç†ä¹Ÿæ˜¯å› ä¸ºhashå‡½æ•°çš„ä¸å¯é¢„æµ‹.AAAAå’ŒAAAABçš„ç´¢å¼•æ²¡æœ‰ç›¸å…³æ€§.\nhashç´¢å¼•ä»»ä½•æ—¶å€™éƒ½é¿å…ä¸äº†å›è¡¨æŸ¥è¯¢æ•°æ®,è€ŒB+æ ‘åœ¨ç¬¦åˆæŸäº›æ¡ä»¶(èšç°‡ç´¢å¼•,è¦†ç›–ç´¢å¼•ç­‰)çš„æ—¶å€™å¯ä»¥åªé€šè¿‡ç´¢å¼•å®ŒæˆæŸ¥è¯¢.\nhashç´¢å¼•è™½ç„¶åœ¨ç­‰å€¼æŸ¥è¯¢ä¸Šè¾ƒå¿«,ä½†æ˜¯ä¸ç¨³å®š.æ€§èƒ½ä¸å¯é¢„æµ‹,å½“æŸä¸ªé”®å€¼å­˜åœ¨å¤§é‡é‡å¤çš„æ—¶å€™,å‘ç”Ÿhashç¢°æ’,æ­¤æ—¶æ•ˆç‡å¯èƒ½æå·®.è€ŒB+æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ¯”è¾ƒç¨³å®š,å¯¹äºæ‰€æœ‰çš„æŸ¥è¯¢éƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹,ä¸”æ ‘çš„é«˜åº¦è¾ƒä½.\nå› æ­¤,åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹,ç›´æ¥é€‰æ‹©B+æ ‘ç´¢å¼•å¯ä»¥è·å¾—ç¨³å®šä¸”è¾ƒå¥½çš„æŸ¥è¯¢é€Ÿåº¦.è€Œä¸éœ€è¦ä½¿ç”¨hashç´¢å¼•.\n4. ä¸Šé¢æåˆ°äº†B+æ ‘åœ¨æ»¡è¶³èšç°‡ç´¢å¼•å’Œè¦†ç›–ç´¢å¼•çš„æ—¶å€™ä¸éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®,ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•?\nåœ¨B+æ ‘çš„ç´¢å¼•ä¸­,å¶å­èŠ‚ç‚¹å¯èƒ½å­˜å‚¨äº†å½“å‰çš„keyå€¼,ä¹Ÿå¯èƒ½å­˜å‚¨äº†å½“å‰çš„keyå€¼ä»¥åŠæ•´è¡Œçš„æ•°æ®,è¿™å°±æ˜¯èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•.\nåœ¨InnoDBä¸­,åªæœ‰ä¸»é”®ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•,å¦‚æœæ²¡æœ‰ä¸»é”®,åˆ™æŒ‘é€‰ä¸€ä¸ªå”¯ä¸€é”®å»ºç«‹èšç°‡ç´¢å¼•.å¦‚æœæ²¡æœ‰å”¯ä¸€é”®,åˆ™éšå¼çš„ç”Ÿæˆä¸€ä¸ªé”®æ¥å»ºç«‹èšç°‡ç´¢å¼•.\nå½“æŸ¥è¯¢ä½¿ç”¨èšç°‡ç´¢å¼•æ—¶,åœ¨å¯¹åº”çš„å¶å­èŠ‚ç‚¹,å¯ä»¥è·å–åˆ°æ•´è¡Œæ•°æ®,å› æ­¤ä¸ç”¨å†æ¬¡è¿›è¡Œå›è¡¨æŸ¥è¯¢.\n5. éèšç°‡ç´¢å¼•ä¸€å®šä¼šå›è¡¨æŸ¥è¯¢å—?\nä¸ä¸€å®š,è¿™æ¶‰åŠåˆ°æŸ¥è¯¢è¯­å¥æ‰€è¦æ±‚çš„å­—æ®µæ˜¯å¦å…¨éƒ¨å‘½ä¸­äº†ç´¢å¼•,å¦‚æœå…¨éƒ¨å‘½ä¸­äº†ç´¢å¼•,é‚£ä¹ˆå°±ä¸å¿…å†è¿›è¡Œå›è¡¨æŸ¥è¯¢.\nä¸¾ä¸ªç®€å•çš„ä¾‹å­,å‡è®¾æˆ‘ä»¬åœ¨å‘˜å·¥è¡¨çš„å¹´é¾„ä¸Šå»ºç«‹äº†ç´¢å¼•,é‚£ä¹ˆå½“è¿›è¡Œselect age from employee where age \u0026lt; 20çš„æŸ¥è¯¢æ—¶,åœ¨ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸Š,å·²ç»åŒ…å«äº†ageä¿¡æ¯,ä¸ä¼šå†æ¬¡è¿›è¡Œå›è¡¨æŸ¥è¯¢.\n6. åœ¨å»ºç«‹ç´¢å¼•çš„æ—¶å€™,éƒ½æœ‰å“ªäº›éœ€è¦è€ƒè™‘çš„å› ç´ å‘¢?\nå»ºç«‹ç´¢å¼•çš„æ—¶å€™ä¸€èˆ¬è¦è€ƒè™‘åˆ°å­—æ®µçš„ä½¿ç”¨é¢‘ç‡,ç»å¸¸ä½œä¸ºæ¡ä»¶è¿›è¡ŒæŸ¥è¯¢çš„å­—æ®µæ¯”è¾ƒé€‚åˆ.å¦‚æœéœ€è¦å»ºç«‹è”åˆç´¢å¼•çš„è¯,è¿˜éœ€è¦è€ƒè™‘è”åˆç´¢å¼•ä¸­çš„é¡ºåº.\næ­¤å¤–ä¹Ÿè¦è€ƒè™‘å…¶ä»–æ–¹é¢,æ¯”å¦‚é˜²æ­¢è¿‡å¤šçš„æ‰€æœ‰å¯¹è¡¨é€ æˆå¤ªå¤§çš„å‹åŠ›.è¿™äº›éƒ½å’Œå®é™…çš„è¡¨ç»“æ„ä»¥åŠæŸ¥è¯¢æ–¹å¼æœ‰å…³.\n7. è”åˆç´¢å¼•æ˜¯ä»€ä¹ˆ?ä¸ºä»€ä¹ˆéœ€è¦æ³¨æ„è”åˆç´¢å¼•ä¸­çš„é¡ºåº?\nMySQLå¯ä»¥ä½¿ç”¨å¤šä¸ªå­—æ®µåŒæ—¶å»ºç«‹ä¸€ä¸ªç´¢å¼•,å«åšè”åˆç´¢å¼•.åœ¨è”åˆç´¢å¼•ä¸­,å¦‚æœæƒ³è¦å‘½ä¸­ç´¢å¼•,éœ€è¦æŒ‰ç…§å»ºç«‹ç´¢å¼•æ—¶çš„å­—æ®µé¡ºåºæŒ¨ä¸ªä½¿ç”¨,å¦åˆ™æ— æ³•å‘½ä¸­ç´¢å¼•.\nå…·ä½“åŸå› ä¸º:\nMySQLä½¿ç”¨ç´¢å¼•æ—¶éœ€è¦ç´¢å¼•æœ‰åº,å‡è®¾ç°åœ¨å»ºç«‹äº†\u0026quot;name,age,school\u0026quot;çš„è”åˆç´¢å¼•\né‚£ä¹ˆç´¢å¼•çš„æ’åºä¸º: å…ˆæŒ‰ç…§nameæ’åº,å¦‚æœnameç›¸åŒ,åˆ™æŒ‰ç…§ageæ’åº,å¦‚æœageçš„å€¼ä¹Ÿç›¸ç­‰,åˆ™æŒ‰ç…§schoolè¿›è¡Œæ’åº.\nå½“è¿›è¡ŒæŸ¥è¯¢æ—¶,æ­¤æ—¶ç´¢å¼•ä»…ä»…æŒ‰ç…§nameä¸¥æ ¼æœ‰åº,å› æ­¤å¿…é¡»é¦–å…ˆä½¿ç”¨nameå­—æ®µè¿›è¡Œç­‰å€¼æŸ¥è¯¢,ä¹‹åå¯¹äºåŒ¹é…åˆ°çš„åˆ—è€Œè¨€,å…¶æŒ‰ç…§ageå­—æ®µä¸¥æ ¼æœ‰åº,æ­¤æ—¶å¯ä»¥ä½¿ç”¨ageå­—æ®µç”¨åšç´¢å¼•æŸ¥æ‰¾,ä»¥æ­¤ç±»æ¨.\nå› æ­¤åœ¨å»ºç«‹è”åˆç´¢å¼•çš„æ—¶å€™åº”è¯¥æ³¨æ„ç´¢å¼•åˆ—çš„é¡ºåº,ä¸€èˆ¬æƒ…å†µä¸‹,å°†æŸ¥è¯¢éœ€æ±‚é¢‘ç¹æˆ–è€…å­—æ®µé€‰æ‹©æ€§é«˜çš„åˆ—æ”¾åœ¨å‰é¢.æ­¤å¤–å¯ä»¥æ ¹æ®ç‰¹ä¾‹çš„æŸ¥è¯¢æˆ–è€…è¡¨ç»“æ„è¿›è¡Œå•ç‹¬çš„è°ƒæ•´.\n8. åˆ›å»ºçš„ç´¢å¼•æœ‰æ²¡æœ‰è¢«ä½¿ç”¨åˆ°?æˆ–è€…è¯´æ€ä¹ˆæ‰å¯ä»¥çŸ¥é“è¿™æ¡è¯­å¥è¿è¡Œå¾ˆæ…¢çš„åŸå› ?\nMySQLæä¾›äº†explainå‘½ä»¤æ¥æŸ¥çœ‹è¯­å¥çš„æ‰§è¡Œè®¡åˆ’,MySQLåœ¨æ‰§è¡ŒæŸä¸ªè¯­å¥ä¹‹å‰,ä¼šå°†è¯¥è¯­å¥è¿‡ä¸€éæŸ¥è¯¢ä¼˜åŒ–å™¨,ä¹‹åä¼šæ‹¿åˆ°å¯¹è¯­å¥çš„åˆ†æ,ä¹Ÿå°±æ˜¯æ‰§è¡Œè®¡åˆ’,å…¶ä¸­åŒ…å«äº†è®¸å¤šä¿¡æ¯.\nå¯ä»¥é€šè¿‡å…¶ä¸­å’Œç´¢å¼•æœ‰å…³çš„ä¿¡æ¯æ¥åˆ†ææ˜¯å¦å‘½ä¸­äº†ç´¢å¼•,ä¾‹å¦‚possilbe_key,key,key_lenç­‰å­—æ®µ,åˆ†åˆ«è¯´æ˜äº†æ­¤è¯­å¥å¯èƒ½ä¼šä½¿ç”¨çš„ç´¢å¼•,å®é™…ä½¿ç”¨çš„ç´¢å¼•ä»¥åŠä½¿ç”¨çš„ç´¢å¼•é•¿åº¦.\n9. é‚£ä¹ˆåœ¨å“ªäº›æƒ…å†µä¸‹ä¼šå‘ç”Ÿé’ˆå¯¹è¯¥åˆ—åˆ›å»ºäº†ç´¢å¼•ä½†æ˜¯åœ¨æŸ¥è¯¢çš„æ—¶å€™å¹¶æ²¡æœ‰ä½¿ç”¨å‘¢?\nä½¿ç”¨ä¸ç­‰äºæŸ¥è¯¢\nåˆ—å‚ä¸äº†æ•°å­¦è¿ç®—æˆ–è€…å‡½æ•°\nåœ¨å­—ç¬¦ä¸²likeæ—¶å·¦è¾¹æ˜¯é€šé…ç¬¦.ç±»ä¼¼äº\u0026rsquo;%aaa'.\nå½“mysqlåˆ†æå…¨è¡¨æ‰«ææ¯”ä½¿ç”¨ç´¢å¼•å¿«çš„æ—¶å€™ä¸ä½¿ç”¨ç´¢å¼•.\nå½“ä½¿ç”¨è”åˆç´¢å¼•,å‰é¢ä¸€ä¸ªæ¡ä»¶ä¸ºèŒƒå›´æŸ¥è¯¢,åé¢çš„å³ä½¿ç¬¦åˆæœ€å·¦å‰ç¼€åŸåˆ™,ä¹Ÿæ— æ³•ä½¿ç”¨ç´¢å¼•.\nä»¥ä¸Šæƒ…å†µ,MySQLæ— æ³•ä½¿ç”¨ç´¢å¼•.\n9. é‚£MySQLç´¢å¼•ä½¿ç”¨æœ‰å“ªäº›æ³¨æ„äº‹é¡¹å‘¢ï¼Ÿ\nç´¢å¼•å“ªäº›æƒ…å†µä¼šå¤±æ•ˆ\næŸ¥è¯¢æ¡ä»¶åŒ…å«orï¼Œå¯èƒ½å¯¼è‡´ç´¢å¼•å¤±æ•ˆ å¦‚ä½•å­—æ®µç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œwhereæ—¶ä¸€å®šç”¨å¼•å·æ‹¬èµ·æ¥ï¼Œå¦åˆ™ç´¢å¼•å¤±æ•ˆ likeé€šé…ç¬¦å¯èƒ½å¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚ è”åˆç´¢å¼•ï¼ŒæŸ¥è¯¢æ—¶çš„æ¡ä»¶åˆ—ä¸æ˜¯è”åˆç´¢å¼•ä¸­çš„ç¬¬ä¸€ä¸ªåˆ—ï¼Œç´¢å¼•å¤±æ•ˆã€‚ åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨mysqlçš„å†…ç½®å‡½æ•°ï¼Œç´¢å¼•å¤±æ•ˆã€‚ å¯¹ç´¢å¼•åˆ—è¿ç®—ï¼ˆå¦‚ï¼Œ+ã€-ã€*ã€/ï¼‰ï¼Œç´¢å¼•å¤±æ•ˆã€‚ ç´¢å¼•å­—æ®µä¸Šä½¿ç”¨ï¼ˆï¼= æˆ–è€… \u0026lt; \u0026gt;ï¼Œnot inï¼‰æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚ ç´¢å¼•å­—æ®µä¸Šä½¿ç”¨is nullï¼Œ is not nullï¼Œå¯èƒ½å¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚ å·¦è¿æ¥æŸ¥è¯¢æˆ–è€…å³è¿æ¥æŸ¥è¯¢æŸ¥è¯¢å…³è”çš„å­—æ®µç¼–ç æ ¼å¼ä¸ä¸€æ ·ï¼Œå¯èƒ½å¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚ mysqlä¼°è®¡ä½¿ç”¨å…¨è¡¨æ‰«æè¦æ¯”ä½¿ç”¨ç´¢å¼•å¿«,åˆ™ä¸ä½¿ç”¨ç´¢å¼•ã€‚ åç«¯ç¨‹åºå‘˜å¿…å¤‡ï¼šç´¢å¼•å¤±æ•ˆçš„åå¤§æ‚ç—‡\nç´¢å¼•ä¸é€‚åˆå“ªäº›åœºæ™¯\næ•°æ®é‡å°‘çš„ä¸é€‚åˆåŠ ç´¢å¼• æ›´æ–°æ¯”è¾ƒé¢‘ç¹çš„ä¹Ÿä¸é€‚åˆåŠ ç´¢å¼• åŒºåˆ†åº¦ä½çš„å­—æ®µä¸é€‚åˆåŠ ç´¢å¼•ï¼ˆå¦‚æ€§åˆ«ï¼‰ ç´¢å¼•çš„ä¸€äº›æ½œè§„åˆ™\nè¦†ç›–ç´¢å¼• å›è¡¨ ç´¢å¼•æ•°æ®ç»“æ„ï¼ˆB+æ ‘ï¼‰ æœ€å·¦å‰ç¼€åŸåˆ™ ç´¢å¼•ä¸‹æ¨ MySQLé‡åˆ°è¿‡æ­»é”é—®é¢˜å—ï¼Œä½ æ˜¯å¦‚ä½•è§£å†³çš„ï¼Ÿ\næˆ‘æ’æŸ¥æ­»é”çš„ä¸€èˆ¬æ­¥éª¤æ˜¯é…±ç´«çš„ï¼š\næŸ¥çœ‹æ­»é”æ—¥å¿—show engine innodb status; æ‰¾å‡ºæ­»é”Sql åˆ†æsqlåŠ é”æƒ…å†µ æ¨¡æ‹Ÿæ­»é”æ¡ˆå‘ åˆ†ææ­»é”æ—¥å¿— åˆ†ææ­»é”ç»“æœ å¯ä»¥çœ‹æˆ‘è¿™ä¸¤ç¯‡æ–‡ç« å“ˆï¼š\næ‰‹æŠŠæ‰‹æ•™ä½ åˆ†æMysqlæ­»é”é—®é¢˜ Mysqlæ­»é”å¦‚ä½•æ’æŸ¥ï¼šinsert on duplicateæ­»é”ä¸€æ¬¡æ’æŸ¥åˆ†æè¿‡ç¨‹ æ—¥å¸¸å·¥ä½œä¸­ä½ æ˜¯æ€ä¹ˆä¼˜åŒ–SQLçš„ï¼Ÿ\nå¯ä»¥ä»è¿™å‡ ä¸ªç»´åº¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼š\nåŠ ç´¢å¼• é¿å…è¿”å›ä¸å¿…è¦çš„æ•°æ® é€‚å½“åˆ†æ‰¹é‡è¿›è¡Œ ä¼˜åŒ–sqlç»“æ„ åˆ†åº“åˆ†è¡¨ è¯»å†™åˆ†ç¦» å¯ä»¥çœ‹æˆ‘è¿™ç¯‡æ–‡ç« å“ˆï¼šåç«¯ç¨‹åºå‘˜å¿…å¤‡ï¼šä¹¦å†™é«˜è´¨é‡SQLçš„30æ¡å»ºè®®\næ•°æ®åº“ç´¢å¼•çš„åŸç†ï¼Œä¸ºä»€ä¹ˆè¦ç”¨B+æ ‘ï¼Œä¸ºä»€ä¹ˆä¸ç”¨äºŒå‰æ ‘ï¼Ÿ\nå¯ä»¥ä»å‡ ä¸ªç»´åº¦å»çœ‹è¿™ä¸ªé—®é¢˜ï¼ŒæŸ¥è¯¢æ˜¯å¦å¤Ÿå¿«ï¼Œæ•ˆç‡æ˜¯å¦ç¨³å®šï¼Œå­˜å‚¨æ•°æ®å¤šå°‘ï¼Œä»¥åŠæŸ¥æ‰¾ç£ç›˜æ¬¡æ•°ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯äºŒå‰æ ‘ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯Bæ ‘ï¼Œè€Œååæ˜¯B+æ ‘å‘¢ï¼Ÿ\nä¸ºä»€ä¹ˆä¸æ˜¯ä¸€èˆ¬äºŒå‰æ ‘ï¼Ÿ\nå¦‚æœäºŒå‰æ ‘ç‰¹æ®ŠåŒ–ä¸ºä¸€ä¸ªé“¾è¡¨ï¼Œç›¸å½“äºå…¨è¡¨æ‰«æã€‚å¹³è¡¡äºŒå‰æ ‘ç›¸æ¯”äºäºŒå‰æŸ¥æ‰¾æ ‘æ¥è¯´ï¼ŒæŸ¥æ‰¾æ•ˆç‡æ›´ç¨³å®šï¼Œæ€»ä½“çš„æŸ¥æ‰¾é€Ÿåº¦ä¹Ÿæ›´å¿«ã€‚\nä¸ºä»€ä¹ˆä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘å‘¢ï¼Ÿ\næˆ‘ä»¬çŸ¥é“ï¼Œåœ¨å†…å­˜æ¯”åœ¨ç£ç›˜çš„æ•°æ®ï¼ŒæŸ¥è¯¢æ•ˆç‡å¿«å¾—å¤šã€‚å¦‚æœæ ‘è¿™ç§æ•°æ®ç»“æ„ä½œä¸ºç´¢å¼•ï¼Œé‚£æˆ‘ä»¬æ¯æŸ¥æ‰¾ä¸€æ¬¡æ•°æ®å°±éœ€è¦ä»ç£ç›˜ä¸­è¯»å–ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„ä¸€ä¸ªç£ç›˜å—ï¼Œä½†æ˜¯å¹³è¡¡äºŒå‰æ ‘å¯æ˜¯æ¯ä¸ªèŠ‚ç‚¹åªå­˜å‚¨ä¸€ä¸ªé”®å€¼å’Œæ•°æ®çš„ï¼Œå¦‚æœæ˜¯Bæ ‘ï¼Œå¯ä»¥å­˜å‚¨æ›´å¤šçš„èŠ‚ç‚¹æ•°æ®ï¼Œæ ‘çš„é«˜åº¦ä¹Ÿä¼šé™ä½ï¼Œå› æ­¤è¯»å–ç£ç›˜çš„æ¬¡æ•°å°±é™ä¸‹æ¥å•¦ï¼ŒæŸ¥è¯¢æ•ˆç‡å°±å¿«å•¦ã€‚\né‚£ä¸ºä»€ä¹ˆä¸æ˜¯Bæ ‘è€Œæ˜¯B+æ ‘å‘¢ï¼Ÿ\n1ï¼‰B+æ ‘éå¶å­èŠ‚ç‚¹ä¸Šæ˜¯ä¸å­˜å‚¨æ•°æ®çš„ï¼Œä»…å­˜å‚¨é”®å€¼ï¼Œè€ŒBæ ‘èŠ‚ç‚¹ä¸­ä¸ä»…å­˜å‚¨é”®å€¼ï¼Œä¹Ÿä¼šå­˜å‚¨æ•°æ®ã€‚innodbä¸­é¡µçš„é»˜è®¤å¤§å°æ˜¯16KBï¼Œå¦‚æœä¸å­˜å‚¨æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¼šå­˜å‚¨æ›´å¤šçš„é”®å€¼ï¼Œç›¸åº”çš„æ ‘çš„é˜¶æ•°ï¼ˆèŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ ‘ï¼‰å°±ä¼šæ›´å¤§ï¼Œæ ‘å°±ä¼šæ›´çŸ®æ›´èƒ–ï¼Œå¦‚æ­¤ä¸€æ¥æˆ‘ä»¬æŸ¥æ‰¾æ•°æ®è¿›è¡Œç£ç›˜çš„IOæ¬¡æ•°æœ‰ä¼šå†æ¬¡å‡å°‘ï¼Œæ•°æ®æŸ¥è¯¢çš„æ•ˆç‡ä¹Ÿä¼šæ›´å¿«ã€‚\n2ï¼‰B+æ ‘ç´¢å¼•çš„æ‰€æœ‰æ•°æ®å‡å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ï¼Œè€Œä¸”æ•°æ®æ˜¯æŒ‰ç…§é¡ºåºæ’åˆ—çš„ï¼Œé“¾è¡¨è¿ç€çš„ã€‚é‚£ä¹ˆB+æ ‘ä½¿å¾—èŒƒå›´æŸ¥æ‰¾ï¼Œæ’åºæŸ¥æ‰¾ï¼Œåˆ†ç»„æŸ¥æ‰¾ä»¥åŠå»é‡æŸ¥æ‰¾å˜å¾—å¼‚å¸¸ç®€å•ã€‚\nå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« å“ˆï¼šå†æœ‰äººé—®ä½ ä¸ºä»€ä¹ˆMySQLç”¨B+æ ‘åšç´¢å¼•ï¼Œå°±æŠŠè¿™ç¯‡æ–‡ç« å‘ç»™å¥¹\ndetails link : https://mp.weixin.qq.com/s/Ctz6yB2131ZIzCOFrsgfMw\näº‹åŠ¡ç›¸å…³ 1. ä»€ä¹ˆæ˜¯äº‹åŠ¡?\nç†è§£ä»€ä¹ˆæ˜¯äº‹åŠ¡æœ€ç»å…¸çš„å°±æ˜¯è½¬è´¦çš„æ —å­,ç›¸ä¿¡å¤§å®¶ä¹Ÿéƒ½äº†è§£,è¿™é‡Œå°±ä¸å†è¯´ä¸€è¾¹äº†.\näº‹åŠ¡æ˜¯ä¸€ç³»åˆ—çš„æ“ä½œ,ä»–ä»¬è¦ç¬¦åˆACIDç‰¹æ€§.æœ€å¸¸è§çš„ç†è§£å°±æ˜¯:äº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸ,è¦ä¹ˆå…¨éƒ¨å¤±è´¥.ä½†æ˜¯åªæ˜¯è¿™æ ·è¿˜ä¸å¤Ÿçš„.\n2. ACIDæ˜¯ä»€ä¹ˆ?å¯ä»¥è¯¦ç»†è¯´ä¸€ä¸‹å—?\nA=Atomicity\nåŸå­æ€§,å°±æ˜¯ä¸Šé¢è¯´çš„,è¦ä¹ˆå…¨éƒ¨æˆåŠŸ,è¦ä¹ˆå…¨éƒ¨å¤±è´¥.ä¸å¯èƒ½åªæ‰§è¡Œä¸€éƒ¨åˆ†æ“ä½œ.\nC=Consistency\nç³»ç»Ÿ(æ•°æ®åº“)æ€»æ˜¯ä»ä¸€ä¸ªä¸€è‡´æ€§çš„çŠ¶æ€è½¬ç§»åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çš„çŠ¶æ€,ä¸ä¼šå­˜åœ¨ä¸­é—´çŠ¶æ€.\nI=Isolation\néš”ç¦»æ€§: é€šå¸¸æ¥è¯´:ä¸€ä¸ªäº‹åŠ¡åœ¨å®Œå…¨æäº¤ä¹‹å‰,å¯¹å…¶ä»–äº‹åŠ¡æ˜¯ä¸å¯è§çš„.æ³¨æ„å‰é¢çš„é€šå¸¸æ¥è¯´åŠ äº†çº¢è‰²,æ„å‘³ç€æœ‰ä¾‹å¤–æƒ…å†µ.\nD=Durability\næŒä¹…æ€§,ä¸€æ—¦äº‹åŠ¡æäº¤,é‚£ä¹ˆå°±æ°¸è¿œæ˜¯è¿™æ ·å­äº†,å“ªæ€•ç³»ç»Ÿå´©æºƒä¹Ÿä¸ä¼šå½±å“åˆ°è¿™ä¸ªäº‹åŠ¡çš„ç»“æœ.\n3. åŒæ—¶æœ‰å¤šä¸ªäº‹åŠ¡åœ¨è¿›è¡Œä¼šæ€ä¹ˆæ ·å‘¢?\nå¤šäº‹åŠ¡çš„å¹¶å‘è¿›è¡Œä¸€èˆ¬ä¼šé€ æˆä»¥ä¸‹å‡ ä¸ªé—®é¢˜:\nè„è¯»: Aäº‹åŠ¡è¯»å–åˆ°äº†Bäº‹åŠ¡æœªæäº¤çš„å†…å®¹,è€ŒBäº‹åŠ¡åé¢è¿›è¡Œäº†å›æ»š.\nä¸å¯é‡å¤è¯»: å½“è®¾ç½®Aäº‹åŠ¡åªèƒ½è¯»å–Bäº‹åŠ¡å·²ç»æäº¤çš„éƒ¨åˆ†,ä¼šé€ æˆåœ¨Aäº‹åŠ¡å†…çš„ä¸¤æ¬¡æŸ¥è¯¢,ç»“æœç«Ÿç„¶ä¸ä¸€æ ·,å› ä¸ºåœ¨æ­¤æœŸé—´Bäº‹åŠ¡è¿›è¡Œäº†æäº¤æ“ä½œ.\nå¹»è¯»: Aäº‹åŠ¡è¯»å–äº†ä¸€ä¸ªèŒƒå›´çš„å†…å®¹,è€ŒåŒæ—¶Bäº‹åŠ¡åœ¨æ­¤æœŸé—´æ’å…¥äº†ä¸€æ¡æ•°æ®.é€ æˆ\u0026quot;å¹»è§‰\u0026quot;.\n4. æ€ä¹ˆè§£å†³è¿™äº›é—®é¢˜å‘¢?MySQLçš„äº‹åŠ¡éš”ç¦»çº§åˆ«äº†è§£å—?\nMySQLçš„å››ç§éš”ç¦»çº§åˆ«å¦‚ä¸‹:\næœªæäº¤è¯»(READ UNCOMMITTED) è¿™å°±æ˜¯ä¸Šé¢æ‰€è¯´çš„ä¾‹å¤–æƒ…å†µäº†,è¿™ä¸ªéš”ç¦»çº§åˆ«ä¸‹,å…¶ä»–äº‹åŠ¡å¯ä»¥çœ‹åˆ°æœ¬äº‹åŠ¡æ²¡æœ‰æäº¤çš„éƒ¨åˆ†ä¿®æ”¹.å› æ­¤ä¼šé€ æˆè„è¯»çš„é—®é¢˜(è¯»å–åˆ°äº†å…¶ä»–äº‹åŠ¡æœªæäº¤çš„éƒ¨åˆ†,è€Œä¹‹åè¯¥äº‹åŠ¡è¿›è¡Œäº†å›æ»š).\nè¿™ä¸ªçº§åˆ«çš„æ€§èƒ½æ²¡æœ‰è¶³å¤Ÿå¤§çš„ä¼˜åŠ¿,ä½†æ˜¯åˆæœ‰å¾ˆå¤šçš„é—®é¢˜,å› æ­¤å¾ˆå°‘ä½¿ç”¨.\nå·²æäº¤è¯»(READ COMMITTED) å…¶ä»–äº‹åŠ¡åªèƒ½è¯»å–åˆ°æœ¬äº‹åŠ¡å·²ç»æäº¤çš„éƒ¨åˆ†.è¿™ä¸ªéš”ç¦»çº§åˆ«æœ‰ ä¸å¯é‡å¤è¯»çš„é—®é¢˜,åœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…çš„ä¸¤æ¬¡è¯»å–,æ‹¿åˆ°çš„ç»“æœç«Ÿç„¶ä¸ä¸€æ ·,å› ä¸ºå¦å¤–ä¸€ä¸ªäº‹åŠ¡å¯¹æ•°æ®è¿›è¡Œäº†ä¿®æ”¹.\nREPEATABLE READ(å¯é‡å¤è¯») å¯é‡å¤è¯»éš”ç¦»çº§åˆ«è§£å†³äº†ä¸Šé¢ä¸å¯é‡å¤è¯»çš„é—®é¢˜(çœ‹åå­—ä¹ŸçŸ¥é“),ä½†æ˜¯ä»ç„¶æœ‰ä¸€ä¸ªæ–°é—®é¢˜,å°±æ˜¯å¹»è¯»\nå½“ä½ è¯»å–id\u0026gt; 10 çš„æ•°æ®è¡Œæ—¶,å¯¹æ¶‰åŠåˆ°çš„æ‰€æœ‰è¡ŒåŠ ä¸Šäº†è¯»é”,æ­¤æ—¶ä¾‹å¤–ä¸€ä¸ªäº‹åŠ¡æ–°æ’å…¥äº†ä¸€æ¡id=11çš„æ•°æ®,å› ä¸ºæ˜¯æ–°æ’å…¥çš„,æ‰€ä»¥ä¸ä¼šè§¦å‘ä¸Šé¢çš„é”çš„æ’æ–¥\né‚£ä¹ˆè¿›è¡Œæœ¬äº‹åŠ¡è¿›è¡Œä¸‹ä¸€æ¬¡çš„æŸ¥è¯¢æ—¶ä¼šå‘ç°æœ‰ä¸€æ¡id=11çš„æ•°æ®,è€Œä¸Šæ¬¡çš„æŸ¥è¯¢æ“ä½œå¹¶æ²¡æœ‰è·å–åˆ°,å†è¿›è¡Œæ’å…¥å°±ä¼šæœ‰ä¸»é”®å†²çªçš„é—®é¢˜.\nSERIALIZABLE(å¯ä¸²è¡ŒåŒ–) è¿™æ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«,å¯ä»¥è§£å†³ä¸Šé¢æåˆ°çš„æ‰€æœ‰é—®é¢˜,å› ä¸ºä»–å¼ºåˆ¶å°†æ‰€ä»¥çš„æ“ä½œä¸²è¡Œæ‰§è¡Œ,è¿™ä¼šå¯¼è‡´å¹¶å‘æ€§èƒ½æé€Ÿä¸‹é™,å› æ­¤ä¹Ÿä¸æ˜¯å¾ˆå¸¸ç”¨.\n5. Innodbä½¿ç”¨çš„æ˜¯å“ªç§éš”ç¦»çº§åˆ«å‘¢?\nInnoDBé»˜è®¤ä½¿ç”¨çš„æ˜¯å¯é‡å¤è¯»éš”ç¦»çº§åˆ«.\n6. å¯¹MySQLçš„é”äº†è§£å—?\nå½“æ•°æ®åº“æœ‰å¹¶å‘äº‹åŠ¡çš„æ—¶å€™,å¯èƒ½ä¼šäº§ç”Ÿæ•°æ®çš„ä¸ä¸€è‡´,è¿™æ—¶å€™éœ€è¦ä¸€äº›æœºåˆ¶æ¥ä¿è¯è®¿é—®çš„æ¬¡åº,é”æœºåˆ¶å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªæœºåˆ¶.\nå°±åƒé…’åº—çš„æˆ¿é—´,å¦‚æœå¤§å®¶éšæ„è¿›å‡º,å°±ä¼šå‡ºç°å¤šäººæŠ¢å¤ºåŒä¸€ä¸ªæˆ¿é—´çš„æƒ…å†µ,è€Œåœ¨æˆ¿é—´ä¸Šè£…ä¸Šé”,ç”³è¯·åˆ°é’¥åŒ™çš„äººæ‰å¯ä»¥å…¥ä½å¹¶ä¸”å°†æˆ¿é—´é”èµ·æ¥,å…¶ä»–äººåªæœ‰ç­‰ä»–ä½¿ç”¨å®Œæ¯•æ‰å¯ä»¥å†æ¬¡ä½¿ç”¨.\n7. MySQLéƒ½æœ‰å“ªäº›é”å‘¢?åƒä¸Šé¢é‚£æ ·å­è¿›è¡Œé”å®šå²‚ä¸æ˜¯æœ‰ç‚¹é˜»ç¢å¹¶å‘æ•ˆç‡äº†?\nä»é”çš„ç±»åˆ«ä¸Šæ¥è®²,æœ‰å…±äº«é”å’Œæ’ä»–é”.\nå…±äº«é”: åˆå«åšè¯»é”. å½“ç”¨æˆ·è¦è¿›è¡Œæ•°æ®çš„è¯»å–æ—¶,å¯¹æ•°æ®åŠ ä¸Šå…±äº«é”.å…±äº«é”å¯ä»¥åŒæ—¶åŠ ä¸Šå¤šä¸ª.\næ’ä»–é”: åˆå«åšå†™é”. å½“ç”¨æˆ·è¦è¿›è¡Œæ•°æ®çš„å†™å…¥æ—¶,å¯¹æ•°æ®åŠ ä¸Šæ’ä»–é”.æ’ä»–é”åªå¯ä»¥åŠ ä¸€ä¸ª,ä»–å’Œå…¶ä»–çš„æ’ä»–é”,å…±äº«é”éƒ½ç›¸æ–¥.\nç”¨ä¸Šé¢çš„ä¾‹å­æ¥è¯´å°±æ˜¯ç”¨æˆ·çš„è¡Œä¸ºæœ‰ä¸¤ç§,ä¸€ç§æ˜¯æ¥çœ‹æˆ¿,å¤šä¸ªç”¨æˆ·ä¸€èµ·çœ‹æˆ¿æ˜¯å¯ä»¥æ¥å—çš„. ä¸€ç§æ˜¯çœŸæ­£çš„å…¥ä½ä¸€æ™š,åœ¨è¿™æœŸé—´,æ— è®ºæ˜¯æƒ³å…¥ä½çš„è¿˜æ˜¯æƒ³çœ‹æˆ¿çš„éƒ½ä¸å¯ä»¥.\né”çš„ç²’åº¦å–å†³äºå…·ä½“çš„å­˜å‚¨å¼•æ“,InnoDBå®ç°äº†è¡Œçº§é”,é¡µçº§é”,è¡¨çº§é”.\nä»–ä»¬çš„åŠ é”å¼€é”€ä»å¤§å¤§å°,å¹¶å‘èƒ½åŠ›ä¹Ÿæ˜¯ä»å¤§åˆ°å°.\nè¡¨ç»“æ„è®¾è®¡ è¯´è¯´åˆ†åº“ä¸åˆ†è¡¨çš„è®¾è®¡\nåˆ†åº“åˆ†è¡¨æ–¹æ¡ˆï¼Œåˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶ï¼Œåˆ†åº“åˆ†è¡¨å¯èƒ½é‡åˆ°çš„é—®é¢˜\nåˆ†åº“åˆ†è¡¨æ–¹æ¡ˆ:\næ°´å¹³åˆ†åº“ï¼šä»¥å­—æ®µä¸ºä¾æ®ï¼ŒæŒ‰ç…§ä¸€å®šç­–ç•¥ï¼ˆhashã€rangeç­‰ï¼‰ï¼Œå°†ä¸€ä¸ªåº“ä¸­çš„æ•°æ®æ‹†åˆ†åˆ°å¤šä¸ªåº“ä¸­ã€‚ æ°´å¹³åˆ†è¡¨ï¼šä»¥å­—æ®µä¸ºä¾æ®ï¼ŒæŒ‰ç…§ä¸€å®šç­–ç•¥ï¼ˆhashã€rangeç­‰ï¼‰ï¼Œå°†ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®æ‹†åˆ†åˆ°å¤šä¸ªè¡¨ä¸­ã€‚ å‚ç›´åˆ†åº“ï¼šä»¥è¡¨ä¸ºä¾æ®ï¼ŒæŒ‰ç…§ä¸šåŠ¡å½’å±ä¸åŒï¼Œå°†ä¸åŒçš„è¡¨æ‹†åˆ†åˆ°ä¸åŒçš„åº“ä¸­ã€‚ å‚ç›´åˆ†è¡¨ï¼šä»¥å­—æ®µä¸ºä¾æ®ï¼ŒæŒ‰ç…§å­—æ®µçš„æ´»è·ƒæ€§ï¼Œå°†è¡¨ä¸­å­—æ®µæ‹†åˆ°ä¸åŒçš„è¡¨ï¼ˆä¸»è¡¨å’Œæ‰©å±•è¡¨ï¼‰ä¸­ã€‚ å¸¸ç”¨çš„åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶ï¼š\nsharding-jdbcï¼ˆå½“å½“ï¼‰ Mycat TDDLï¼ˆæ·˜å®ï¼‰ Oceanus(58åŒåŸæ•°æ®åº“ä¸­é—´ä»¶) vitessï¼ˆè°·æ­Œå¼€å‘çš„æ•°æ®åº“ä¸­é—´ä»¶ï¼‰ Atlas(Qihoo 360) InnoDBä¸MyISAMçš„åŒºåˆ«\nInnoDBæ”¯æŒäº‹åŠ¡ï¼ŒMyISAMä¸æ”¯æŒäº‹åŠ¡ InnoDBæ”¯æŒå¤–é”®ï¼ŒMyISAMä¸æ”¯æŒå¤–é”® InnoDB æ”¯æŒ MVCC(å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)ï¼ŒMyISAM ä¸æ”¯æŒ select count(*) from tableæ—¶ï¼ŒMyISAMæ›´å¿«ï¼Œå› ä¸ºå®ƒæœ‰ä¸€ä¸ªå˜é‡ä¿å­˜äº†æ•´ä¸ªè¡¨çš„æ€»è¡Œæ•°ï¼Œå¯ä»¥ç›´æ¥è¯»å–ï¼ŒInnoDBå°±éœ€è¦å…¨è¡¨æ‰«æã€‚ Innodbä¸æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œè€ŒMyISAMæ”¯æŒå…¨æ–‡ç´¢å¼•ï¼ˆ5.7ä»¥åçš„InnoDBä¹Ÿæ”¯æŒå…¨æ–‡ç´¢å¼•ï¼‰ InnoDBæ”¯æŒè¡¨ã€è¡Œçº§é”ï¼Œè€ŒMyISAMæ”¯æŒè¡¨çº§é”ã€‚ InnoDBè¡¨å¿…é¡»æœ‰ä¸»é”®ï¼Œè€ŒMyISAMå¯ä»¥æ²¡æœ‰ä¸»é”® Innodbè¡¨éœ€è¦æ›´å¤šçš„å†…å­˜å’Œå­˜å‚¨ï¼Œè€ŒMyISAMå¯è¢«å‹ç¼©ï¼Œå­˜å‚¨ç©ºé—´è¾ƒå°ï¼Œã€‚ InnodbæŒ‰ä¸»é”®å¤§å°æœ‰åºæ’å…¥ï¼ŒMyISAMè®°å½•æ’å…¥é¡ºåºæ˜¯ï¼ŒæŒ‰è®°å½•æ’å…¥é¡ºåºä¿å­˜ã€‚ InnoDB å­˜å‚¨å¼•æ“æä¾›äº†å…·æœ‰æäº¤ã€å›æ»šã€å´©æºƒæ¢å¤èƒ½åŠ›çš„äº‹åŠ¡å®‰å…¨ï¼Œä¸ MyISAM æ¯” InnoDB å†™çš„æ•ˆç‡å·®ä¸€äº›ï¼Œå¹¶ä¸”ä¼šå ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ä»¥ä¿ç•™æ•°æ®å’Œç´¢å¼• 1. ä¸ºä»€ä¹ˆè¦å°½é‡è®¾å®šä¸€ä¸ªä¸»é”®?\nä¸»é”®æ˜¯æ•°æ®åº“ç¡®ä¿æ•°æ®è¡Œåœ¨æ•´å¼ è¡¨å”¯ä¸€æ€§çš„ä¿éšœ,å³ä½¿ä¸šåŠ¡ä¸Šæœ¬å¼ è¡¨æ²¡æœ‰ä¸»é”®,ä¹Ÿå»ºè®®æ·»åŠ ä¸€ä¸ªè‡ªå¢é•¿çš„IDåˆ—ä½œä¸ºä¸»é”®.\nè®¾å®šäº†ä¸»é”®ä¹‹å,åœ¨åç»­çš„åˆ æ”¹æŸ¥çš„æ—¶å€™å¯èƒ½æ›´åŠ å¿«é€Ÿä»¥åŠç¡®ä¿æ“ä½œæ•°æ®èŒƒå›´å®‰å…¨.\n2. ä¸»é”®ä½¿ç”¨è‡ªå¢IDè¿˜æ˜¯UUID?\næ¨èä½¿ç”¨è‡ªå¢ID,ä¸è¦ä½¿ç”¨UUID.\nå› ä¸ºåœ¨InnoDBå­˜å‚¨å¼•æ“ä¸­,ä¸»é”®ç´¢å¼•æ˜¯ä½œä¸ºèšç°‡ç´¢å¼•å­˜åœ¨çš„\nä¹Ÿå°±æ˜¯è¯´,ä¸»é”®ç´¢å¼•çš„B+æ ‘å¶å­èŠ‚ç‚¹ä¸Šå­˜å‚¨äº†ä¸»é”®ç´¢å¼•ä»¥åŠå…¨éƒ¨çš„æ•°æ®(æŒ‰ç…§é¡ºåº)\nå¦‚æœä¸»é”®ç´¢å¼•æ˜¯è‡ªå¢ID,é‚£ä¹ˆåªéœ€è¦ä¸æ–­å‘åæ’åˆ—å³å¯,å¦‚æœæ˜¯UUID,ç”±äºåˆ°æ¥çš„IDä¸åŸæ¥çš„å¤§å°ä¸ç¡®å®š,ä¼šé€ æˆéå¸¸å¤šçš„æ•°æ®æ’å…¥,æ•°æ®ç§»åŠ¨,ç„¶åå¯¼è‡´äº§ç”Ÿå¾ˆå¤šçš„å†…å­˜ç¢ç‰‡,è¿›è€Œé€ æˆæ’å…¥æ€§èƒ½çš„ä¸‹é™.\næ€»ä¹‹,åœ¨æ•°æ®é‡å¤§ä¸€äº›çš„æƒ…å†µä¸‹,ç”¨è‡ªå¢ä¸»é”®æ€§èƒ½ä¼šå¥½ä¸€äº›.\nå›¾ç‰‡æ¥æºäºã€Šé«˜æ€§èƒ½MySQLã€‹: å…¶ä¸­é»˜è®¤åç¼€ä¸ºä½¿ç”¨è‡ªå¢ID,_uuidä¸ºä½¿ç”¨UUIDä¸ºä¸»é”®çš„æµ‹è¯•,æµ‹è¯•äº†æ’å…¥100wè¡Œå’Œ300wè¡Œçš„æ€§èƒ½.\nå…³äºä¸»é”®æ˜¯èšç°‡ç´¢å¼•,å¦‚æœæ²¡æœ‰ä¸»é”®,InnoDBä¼šé€‰æ‹©ä¸€ä¸ªå”¯ä¸€é”®æ¥ä½œä¸ºèšç°‡ç´¢å¼•,å¦‚æœæ²¡æœ‰å”¯ä¸€é”®,ä¼šç”Ÿæˆä¸€ä¸ªéšå¼çš„ä¸»é”®.\nIf you define a PRIMARY KEY on your table, InnoDB uses it as the clustered index.\nIf you do not define a PRIMARY KEY for your table, MySQL picks the first UNIQUE index that has only NOT NULL columns as the primary key and InnoDB uses it as the clustered index.\n3. å­—æ®µä¸ºä»€ä¹ˆè¦æ±‚å®šä¹‰ä¸ºnot null?\nMySQLå®˜ç½‘è¿™æ ·ä»‹ç»:\nNULL columns require additional space in the rowto record whether their values are NULL. For MyISAM tables, each NULL columntakes one bit extra, rounded up to the nearest byte.\nnullå€¼ä¼šå ç”¨æ›´å¤šçš„å­—èŠ‚,ä¸”ä¼šåœ¨ç¨‹åºä¸­é€ æˆå¾ˆå¤šä¸é¢„æœŸä¸ç¬¦çš„æƒ…å†µ.\n4. å¦‚æœè¦å­˜å‚¨ç”¨æˆ·çš„å¯†ç æ•£åˆ—,åº”è¯¥ä½¿ç”¨ä»€ä¹ˆå­—æ®µè¿›è¡Œå­˜å‚¨?\nå¯†ç æ•£åˆ—,ç›,ç”¨æˆ·èº«ä»½è¯å·ç­‰å›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²åº”è¯¥ä½¿ç”¨charè€Œä¸æ˜¯varcharæ¥å­˜å‚¨,è¿™æ ·å¯ä»¥èŠ‚çœç©ºé—´ä¸”æé«˜æ£€ç´¢æ•ˆç‡.\nå­˜å‚¨å¼•æ“ç›¸å…³ 1. MySQLæ”¯æŒå“ªäº›å­˜å‚¨å¼•æ“?\nMySQLæ”¯æŒå¤šç§å­˜å‚¨å¼•æ“,æ¯”å¦‚InnoDB,MyISAM,Memory,Archiveç­‰ç­‰.\nåœ¨å¤§å¤šæ•°çš„æƒ…å†µä¸‹,ç›´æ¥é€‰æ‹©ä½¿ç”¨InnoDBå¼•æ“éƒ½æ˜¯æœ€åˆé€‚çš„,InnoDBä¹Ÿæ˜¯MySQLçš„é»˜è®¤å­˜å‚¨å¼•æ“.\nInnoDBå’ŒMyISAMæœ‰ä»€ä¹ˆåŒºåˆ«? InnoDBæ”¯æŒäº‹ç‰©ï¼Œè€ŒMyISAMä¸æ”¯æŒäº‹ç‰©\nInnoDBæ”¯æŒè¡Œçº§é”ï¼Œè€ŒMyISAMæ”¯æŒè¡¨çº§é”\nInnoDBæ”¯æŒMVCC, è€ŒMyISAMä¸æ”¯æŒ\nInnoDBæ”¯æŒå¤–é”®ï¼Œè€ŒMyISAMä¸æ”¯æŒ\nInnoDBä¸æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œè€ŒMyISAMæ”¯æŒã€‚\né›¶æ•£é—®é¢˜ 1. MySQLä¸­çš„varcharå’Œcharæœ‰ä»€ä¹ˆåŒºåˆ«.\ncharæ˜¯ä¸€ä¸ªå®šé•¿å­—æ®µ,å‡å¦‚ç”³è¯·äº†char(10)çš„ç©ºé—´,é‚£ä¹ˆæ— è®ºå®é™…å­˜å‚¨å¤šå°‘å†…å®¹.è¯¥å­—æ®µéƒ½å ç”¨10ä¸ªå­—ç¬¦,è€Œvarcharæ˜¯å˜é•¿çš„\nä¹Ÿå°±æ˜¯è¯´ç”³è¯·çš„åªæ˜¯æœ€å¤§é•¿åº¦,å ç”¨çš„ç©ºé—´ä¸ºå®é™…å­—ç¬¦é•¿åº¦+1,æœ€åä¸€ä¸ªå­—ç¬¦å­˜å‚¨ä½¿ç”¨äº†å¤šé•¿çš„ç©ºé—´.\nåœ¨æ£€ç´¢æ•ˆç‡ä¸Šæ¥è®²,char \u0026gt; varchar,å› æ­¤åœ¨ä½¿ç”¨ä¸­,å¦‚æœç¡®å®šæŸä¸ªå­—æ®µçš„å€¼çš„é•¿åº¦,å¯ä»¥ä½¿ç”¨char,å¦åˆ™åº”è¯¥å°½é‡ä½¿ç”¨varchar.ä¾‹å¦‚å­˜å‚¨ç”¨æˆ·MD5åŠ å¯†åçš„å¯†ç ,åˆ™åº”è¯¥ä½¿ç”¨char.\n2. varchar(10)å’Œint(10)ä»£è¡¨ä»€ä¹ˆå«ä¹‰?\nvarcharçš„10ä»£è¡¨äº†ç”³è¯·çš„ç©ºé—´é•¿åº¦,ä¹Ÿæ˜¯å¯ä»¥å­˜å‚¨çš„æ•°æ®çš„æœ€å¤§é•¿åº¦,è€Œintçš„10åªæ˜¯ä»£è¡¨äº†å±•ç¤ºçš„é•¿åº¦,ä¸è¶³10ä½ä»¥0å¡«å…….\nä¹Ÿå°±æ˜¯è¯´,int(1)å’Œint(10)æ‰€èƒ½å­˜å‚¨çš„æ•°å­—å¤§å°ä»¥åŠå ç”¨çš„ç©ºé—´éƒ½æ˜¯ç›¸åŒçš„,åªæ˜¯åœ¨å±•ç¤ºæ—¶æŒ‰ç…§é•¿åº¦å±•ç¤º.\n3. MySQLçš„binlogæœ‰æœ‰å‡ ç§å½•å…¥æ ¼å¼?åˆ†åˆ«æœ‰ä»€ä¹ˆåŒºåˆ«?\næœ‰ä¸‰ç§æ ¼å¼,statement,rowå’Œmixed.\nstatementæ¨¡å¼ä¸‹,è®°å½•å•å…ƒä¸ºè¯­å¥.å³æ¯ä¸€ä¸ªsqlé€ æˆçš„å½±å“ä¼šè®°å½•.ç”±äºsqlçš„æ‰§è¡Œæ˜¯æœ‰ä¸Šä¸‹æ–‡çš„,å› æ­¤åœ¨ä¿å­˜çš„æ—¶å€™éœ€è¦ä¿å­˜ç›¸å…³çš„ä¿¡æ¯,åŒæ—¶è¿˜æœ‰ä¸€äº›ä½¿ç”¨äº†å‡½æ•°ä¹‹ç±»çš„è¯­å¥æ— æ³•è¢«è®°å½•å¤åˆ¶.\nrowçº§åˆ«ä¸‹,è®°å½•å•å…ƒä¸ºæ¯ä¸€è¡Œçš„æ”¹åŠ¨,åŸºæœ¬æ˜¯å¯ä»¥å…¨éƒ¨è®°ä¸‹æ¥ä½†æ˜¯ç”±äºå¾ˆå¤šæ“ä½œ,ä¼šå¯¼è‡´å¤§é‡è¡Œçš„æ”¹åŠ¨(æ¯”å¦‚alter table),å› æ­¤è¿™ç§æ¨¡å¼çš„æ–‡ä»¶ä¿å­˜çš„ä¿¡æ¯å¤ªå¤š,æ—¥å¿—é‡å¤ªå¤§.\nmixed. ä¸€ç§æŠ˜ä¸­çš„æ–¹æ¡ˆ,æ™®é€šæ“ä½œä½¿ç”¨statementè®°å½•,å½“æ— æ³•ä½¿ç”¨statementçš„æ—¶å€™ä½¿ç”¨row.\næ­¤å¤–,æ–°ç‰ˆçš„MySQLä¸­å¯¹rowçº§åˆ«ä¹Ÿåšäº†ä¸€äº›ä¼˜åŒ–,å½“è¡¨ç»“æ„å‘ç”Ÿå˜åŒ–çš„æ—¶å€™,ä¼šè®°å½•è¯­å¥è€Œä¸æ˜¯é€è¡Œè®°å½•.\n4. è¶…å¤§åˆ†é¡µæ€ä¹ˆå¤„ç†?\nè¶…å¤§çš„åˆ†é¡µä¸€èˆ¬ä»ä¸¤ä¸ªæ–¹å‘ä¸Šæ¥è§£å†³.\næ•°æ®åº“å±‚é¢,è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸»è¦é›†ä¸­å…³æ³¨çš„(è™½ç„¶æ”¶æ•ˆæ²¡é‚£ä¹ˆå¤§)\nç±»ä¼¼äºselect * from table where age \u0026gt; 20 limit 1000000,10è¿™ç§æŸ¥è¯¢å…¶å®ä¹Ÿæ˜¯æœ‰å¯ä»¥ä¼˜åŒ–çš„ä½™åœ°çš„.\nè¿™æ¡è¯­å¥éœ€è¦load1000000æ•°æ®ç„¶ååŸºæœ¬ä¸Šå…¨éƒ¨ä¸¢å¼ƒ,åªå–10æ¡å½“ç„¶æ¯”è¾ƒæ…¢.\næˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸ºselect * from table where id in (select id from table where age \u0026gt; 20 limit 1000000,10)\nè¿™æ ·è™½ç„¶ä¹Ÿloadäº†ä¸€ç™¾ä¸‡çš„æ•°æ®,ä½†æ˜¯ç”±äºç´¢å¼•è¦†ç›–,è¦æŸ¥è¯¢çš„æ‰€æœ‰å­—æ®µéƒ½åœ¨ç´¢å¼•ä¸­,æ‰€ä»¥é€Ÿåº¦ä¼šå¾ˆå¿«.\nåŒæ—¶å¦‚æœIDè¿ç»­çš„å¥½,æˆ‘ä»¬è¿˜å¯ä»¥select * from table where id \u0026gt; 1000000 limit 10,æ•ˆç‡ä¹Ÿæ˜¯ä¸é”™çš„\nä¼˜åŒ–çš„å¯èƒ½æ€§æœ‰è®¸å¤šç§,ä½†æ˜¯æ ¸å¿ƒæ€æƒ³éƒ½ä¸€æ ·,å°±æ˜¯å‡å°‘loadçš„æ•°æ®.\nä»éœ€æ±‚çš„è§’åº¦å‡å°‘è¿™ç§è¯·æ±‚â€¦.ä¸»è¦æ˜¯ä¸åšç±»ä¼¼çš„éœ€æ±‚(ç›´æ¥è·³è½¬åˆ°å‡ ç™¾ä¸‡é¡µä¹‹åçš„å…·ä½“æŸä¸€é¡µ.åªå…è®¸é€é¡µæŸ¥çœ‹æˆ–è€…æŒ‰ç…§ç»™å®šçš„è·¯çº¿èµ°,è¿™æ ·å¯é¢„æµ‹,å¯ç¼“å­˜)ä»¥åŠé˜²æ­¢IDæ³„æ¼ä¸”è¿ç»­è¢«äººæ¶æ„æ”»å‡».\nè§£å†³è¶…å¤§åˆ†é¡µ,å…¶å®ä¸»è¦æ˜¯é ç¼“å­˜,å¯é¢„æµ‹æ€§çš„æå‰æŸ¥åˆ°å†…å®¹,ç¼“å­˜è‡³redisç­‰k-Væ•°æ®åº“ä¸­,ç›´æ¥è¿”å›å³å¯.\nåœ¨é˜¿é‡Œå·´å·´ã€ŠJavaå¼€å‘æ‰‹å†Œã€‹ä¸­,å¯¹è¶…å¤§åˆ†é¡µçš„è§£å†³åŠæ³•æ˜¯ç±»ä¼¼äºä¸Šé¢æåˆ°çš„ç¬¬ä¸€ç§.\n5. å…³å¿ƒè¿‡ä¸šåŠ¡ç³»ç»Ÿé‡Œé¢çš„sqlè€—æ—¶å—?ç»Ÿè®¡è¿‡æ…¢æŸ¥è¯¢å—?å¯¹æ…¢æŸ¥è¯¢éƒ½æ€ä¹ˆä¼˜åŒ–è¿‡?\nåœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­,é™¤äº†ä½¿ç”¨ä¸»é”®è¿›è¡Œçš„æŸ¥è¯¢,å…¶ä»–çš„æˆ‘éƒ½ä¼šåœ¨æµ‹è¯•åº“ä¸Šæµ‹è¯•å…¶è€—æ—¶,æ…¢æŸ¥è¯¢çš„ç»Ÿè®¡ä¸»è¦ç”±è¿ç»´åœ¨åš,ä¼šå®šæœŸå°†ä¸šåŠ¡ä¸­çš„æ…¢æŸ¥è¯¢åé¦ˆç»™æˆ‘ä»¬.\næ…¢æŸ¥è¯¢çš„ä¼˜åŒ–é¦–å…ˆè¦ææ˜ç™½æ…¢çš„åŸå› æ˜¯ä»€ä¹ˆ? æ˜¯æŸ¥è¯¢æ¡ä»¶æ²¡æœ‰å‘½ä¸­ç´¢å¼•?æ˜¯loadäº†ä¸éœ€è¦çš„æ•°æ®åˆ—?è¿˜æ˜¯æ•°æ®é‡å¤ªå¤§?\næ‰€ä»¥ä¼˜åŒ–ä¹Ÿæ˜¯é’ˆå¯¹è¿™ä¸‰ä¸ªæ–¹å‘æ¥çš„,\né¦–å…ˆåˆ†æè¯­å¥,çœ‹çœ‹æ˜¯å¦loadäº†é¢å¤–çš„æ•°æ®,å¯èƒ½æ˜¯æŸ¥è¯¢äº†å¤šä½™çš„è¡Œå¹¶ä¸”æŠ›å¼ƒæ‰äº†,å¯èƒ½æ˜¯åŠ è½½äº†è®¸å¤šç»“æœä¸­å¹¶ä¸éœ€è¦çš„åˆ—,å¯¹è¯­å¥è¿›è¡Œåˆ†æä»¥åŠé‡å†™.\nåˆ†æè¯­å¥çš„æ‰§è¡Œè®¡åˆ’,ç„¶åè·å¾—å…¶ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µ,ä¹‹åä¿®æ”¹è¯­å¥æˆ–è€…ä¿®æ”¹ç´¢å¼•,ä½¿å¾—è¯­å¥å¯ä»¥å°½å¯èƒ½çš„å‘½ä¸­ç´¢å¼•.\nå¦‚æœå¯¹è¯­å¥çš„ä¼˜åŒ–å·²ç»æ— æ³•è¿›è¡Œ,å¯ä»¥è€ƒè™‘è¡¨ä¸­çš„æ•°æ®é‡æ˜¯å¦å¤ªå¤§,å¦‚æœæ˜¯çš„è¯å¯ä»¥è¿›è¡Œæ¨ªå‘æˆ–è€…çºµå‘çš„åˆ†è¡¨.\n6. ä¸Šé¢æåˆ°æ¨ªå‘åˆ†è¡¨å’Œçºµå‘åˆ†è¡¨,å¯ä»¥åˆ†åˆ«ä¸¾ä¸€ä¸ªé€‚åˆä»–ä»¬çš„ä¾‹å­å—?\næ¨ªå‘åˆ†è¡¨æ˜¯æŒ‰è¡Œåˆ†è¡¨.å‡è®¾æˆ‘ä»¬æœ‰ä¸€å¼ ç”¨æˆ·è¡¨,ä¸»é”®æ˜¯è‡ªå¢IDä¸”åŒæ—¶æ˜¯ç”¨æˆ·çš„ID.æ•°æ®é‡è¾ƒå¤§,æœ‰1äº¿å¤šæ¡,é‚£ä¹ˆæ­¤æ—¶æ”¾åœ¨ä¸€å¼ è¡¨é‡Œçš„æŸ¥è¯¢æ•ˆæœå°±ä¸å¤ªç†æƒ³.\næˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸»é”®IDè¿›è¡Œåˆ†è¡¨,æ— è®ºæ˜¯æŒ‰å°¾å·åˆ†,æˆ–è€…æŒ‰IDçš„åŒºé—´åˆ†éƒ½æ˜¯å¯ä»¥çš„.\nå‡è®¾æŒ‰ç…§å°¾å·0-99åˆ†ä¸º100ä¸ªè¡¨,é‚£ä¹ˆæ¯å¼ è¡¨ä¸­çš„æ•°æ®å°±ä»…æœ‰100w.è¿™æ—¶çš„æŸ¥è¯¢æ•ˆç‡æ— ç–‘æ˜¯å¯ä»¥æ»¡è¶³è¦æ±‚çš„.\nçºµå‘åˆ†è¡¨æ˜¯æŒ‰åˆ—åˆ†è¡¨.å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸€å¼ æ–‡ç« è¡¨.åŒ…å«å­—æ®µid-æ‘˜è¦-å†…å®¹.è€Œç³»ç»Ÿä¸­çš„å±•ç¤ºå½¢å¼æ˜¯åˆ·æ–°å‡ºä¸€ä¸ªåˆ—è¡¨,åˆ—è¡¨ä¸­ä»…åŒ…å«æ ‡é¢˜å’Œæ‘˜è¦\nå½“ç”¨æˆ·ç‚¹å‡»æŸç¯‡æ–‡ç« è¿›å…¥è¯¦æƒ…æ—¶æ‰éœ€è¦æ­£æ–‡å†…å®¹.æ­¤æ—¶,å¦‚æœæ•°æ®é‡å¤§,å°†å†…å®¹è¿™ä¸ªå¾ˆå¤§ä¸”ä¸ç»å¸¸ä½¿ç”¨çš„åˆ—æ”¾åœ¨ä¸€èµ·ä¼šæ‹–æ…¢åŸè¡¨çš„æŸ¥è¯¢é€Ÿåº¦.\næˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„è¡¨åˆ†ä¸ºä¸¤å¼ .id-æ‘˜è¦,id-å†…å®¹.å½“ç”¨æˆ·ç‚¹å‡»è¯¦æƒ…,é‚£ä¸»é”®å†æ¥å–ä¸€æ¬¡å†…å®¹å³å¯.è€Œå¢åŠ çš„å­˜å‚¨é‡åªæ˜¯å¾ˆå°çš„ä¸»é”®å­—æ®µ.ä»£ä»·å¾ˆå°.\nå½“ç„¶,åˆ†è¡¨å…¶å®å’Œä¸šåŠ¡çš„å…³è”åº¦å¾ˆé«˜,åœ¨åˆ†è¡¨ä¹‹å‰ä¸€å®šè¦åšå¥½è°ƒç ”ä»¥åŠbenchmark.ä¸è¦æŒ‰ç…§è‡ªå·±çš„çŒœæƒ³ç›²ç›®æ“ä½œ.\n**7. ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹ï¼Ÿ**æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ\nå­˜å‚¨è¿‡ç¨‹æ˜¯ä¸€äº›é¢„ç¼–è¯‘çš„SQLè¯­å¥ã€‚\n1ã€æ›´åŠ ç›´ç™½çš„ç†è§£ï¼šå­˜å‚¨è¿‡ç¨‹å¯ä»¥è¯´æ˜¯ä¸€ä¸ªè®°å½•é›†ï¼Œå®ƒæ˜¯ç”±ä¸€äº›T-SQLè¯­å¥ç»„æˆçš„ä»£ç å—\nè¿™äº›T-SQLè¯­å¥ä»£ç åƒä¸€ä¸ªæ–¹æ³•ä¸€æ ·å®ç°ä¸€äº›åŠŸèƒ½ï¼ˆå¯¹å•è¡¨æˆ–å¤šè¡¨çš„å¢åˆ æ”¹æŸ¥ï¼‰ï¼Œç„¶åå†ç»™è¿™ä¸ªä»£ç å—å–ä¸€ä¸ªåå­—ï¼Œåœ¨ç”¨åˆ°è¿™ä¸ªåŠŸèƒ½çš„æ—¶å€™è°ƒç”¨ä»–å°±è¡Œäº†ã€‚\n2ã€å­˜å‚¨è¿‡ç¨‹æ˜¯ä¸€ä¸ªé¢„ç¼–è¯‘çš„ä»£ç å—ï¼Œæ‰§è¡Œæ•ˆç‡æ¯”è¾ƒé«˜,ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹æ›¿ä»£å¤§é‡T_SQLè¯­å¥ ï¼Œå¯ä»¥é™ä½ç½‘ç»œé€šä¿¡é‡ï¼Œæé«˜é€šä¿¡é€Ÿç‡,å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šç¡®ä¿æ•°æ®å®‰å…¨\nä½†æ˜¯,åœ¨äº’è”ç½‘é¡¹ç›®ä¸­,å…¶å®æ˜¯ä¸å¤ªæ¨èå­˜å‚¨è¿‡ç¨‹çš„,æ¯”è¾ƒå‡ºåçš„å°±æ˜¯é˜¿é‡Œçš„ã€ŠJavaå¼€å‘æ‰‹å†Œã€‹ä¸­ç¦æ­¢ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹\næˆ‘ä¸ªäººçš„ç†è§£æ˜¯,åœ¨äº’è”ç½‘é¡¹ç›®ä¸­,è¿­ä»£å¤ªå¿«,é¡¹ç›®çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿæ¯”è¾ƒçŸ­,äººå‘˜æµåŠ¨ç›¸æ¯”äºä¼ ç»Ÿçš„é¡¹ç›®ä¹Ÿæ›´åŠ é¢‘ç¹\nåœ¨è¿™æ ·çš„æƒ…å†µä¸‹,å­˜å‚¨è¿‡ç¨‹çš„ç®¡ç†ç¡®å®æ˜¯æ²¡æœ‰é‚£ä¹ˆæ–¹ä¾¿,åŒæ—¶,å¤ç”¨æ€§ä¹Ÿæ²¡æœ‰å†™åœ¨æœåŠ¡å±‚é‚£ä¹ˆå¥½.\n8. è¯´ä¸€è¯´ä¸‰ä¸ªèŒƒå¼\nç¬¬ä¸€èŒƒå¼: æ¯ä¸ªåˆ—éƒ½ä¸å¯ä»¥å†æ‹†åˆ†.\nç¬¬äºŒèŒƒå¼: éä¸»é”®åˆ—å®Œå…¨ä¾èµ–äºä¸»é”®,è€Œä¸èƒ½æ˜¯ä¾èµ–äºä¸»é”®çš„ä¸€éƒ¨åˆ†.\nç¬¬ä¸‰èŒƒå¼: éä¸»é”®åˆ—åªä¾èµ–äºä¸»é”®,ä¸ä¾èµ–äºå…¶ä»–éä¸»é”®.\nåœ¨è®¾è®¡æ•°æ®åº“ç»“æ„çš„æ—¶å€™,è¦å°½é‡éµå®ˆä¸‰èŒƒå¼,å¦‚æœä¸éµå®ˆ,å¿…é¡»æœ‰è¶³å¤Ÿçš„ç†ç”±.æ¯”å¦‚æ€§èƒ½. äº‹å®ä¸Šæˆ‘ä»¬ç»å¸¸ä¼šä¸ºäº†æ€§èƒ½è€Œå¦¥åæ•°æ®åº“çš„è®¾è®¡.\n9. MyBatis ä¸­çš„ #\nä¹±å…¥äº†ä¸€ä¸ªå¥‡æ€ªçš„é—®é¢˜â€¦..æˆ‘åªæ˜¯æƒ³å•ç‹¬è®°å½•ä¸€ä¸‹è¿™ä¸ªé—®é¢˜,å› ä¸ºå‡ºç°é¢‘ç‡å¤ªé«˜äº†.\n# ä¼šå°†ä¼ å…¥çš„å†…å®¹å½“åšå­—ç¬¦ä¸²,è€Œ$ä¼šç›´æ¥å°†ä¼ å…¥å€¼æ‹¼æ¥åœ¨sqlè¯­å¥ä¸­.\næ‰€ä»¥#å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¢„é˜²sqlæ³¨å…¥æ”»å‡»ã€‚\nä¸ºä»€ä¹ˆä¸è¦ç”¨ SELECT * ä¸éœ€è¦çš„åˆ—ä¼šå¢åŠ æ•°æ®ä¼ è¾“æ—¶é—´å’Œç½‘ç»œå¼€é”€ ç”¨â€œSELECT * â€æ•°æ®åº“éœ€è¦è§£ææ›´å¤šçš„å¯¹è±¡ã€å­—æ®µã€æƒé™ã€å±æ€§ç­‰ç›¸å…³å†…å®¹ï¼Œåœ¨ SQL è¯­å¥å¤æ‚ï¼Œç¡¬è§£æè¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œä¼šå¯¹æ•°æ®åº“é€ æˆæ²‰é‡çš„è´Ÿæ‹…ã€‚ å¢å¤§ç½‘ç»œå¼€é”€ï¼›* æœ‰æ—¶ä¼šè¯¯å¸¦ä¸Šå¦‚logã€IconMD5ä¹‹ç±»çš„æ— ç”¨ä¸”å¤§æ–‡æœ¬å­—æ®µï¼Œæ•°æ®ä¼ è¾“sizeä¼šå‡ ä½•å¢æ¶¨ã€‚å¦‚æœDBå’Œåº”ç”¨ç¨‹åºä¸åœ¨åŒä¸€å°æœºå™¨ï¼Œè¿™ç§å¼€é”€éå¸¸æ˜æ˜¾\nå³ä½¿ mysql æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ˜¯åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œä½¿ç”¨çš„åè®®è¿˜æ˜¯ tcpï¼Œé€šä¿¡ä¹Ÿæ˜¯éœ€è¦é¢å¤–çš„æ—¶é—´ã€‚\nå¯¹äºæ— ç”¨çš„å¤§å­—æ®µï¼Œå¦‚ varcharã€blobã€textï¼Œä¼šå¢åŠ  io æ“ä½œ å‡†ç¡®æ¥è¯´ï¼Œé•¿åº¦è¶…è¿‡ 728 å­—èŠ‚çš„æ—¶å€™ï¼Œä¼šå…ˆæŠŠè¶…å‡ºçš„æ•°æ®åºåˆ—åŒ–åˆ°å¦å¤–ä¸€ä¸ªåœ°æ–¹ï¼Œå› æ­¤è¯»å–è¿™æ¡è®°å½•ä¼šå¢åŠ ä¸€æ¬¡ io æ“ä½œã€‚ï¼ˆMySQL InnoDBï¼‰\nå¤±å»MySQLä¼˜åŒ–å™¨â€œè¦†ç›–ç´¢å¼•â€ç­–ç•¥ä¼˜åŒ–çš„å¯èƒ½æ€§ SELECT * æœç»äº†è¦†ç›–ç´¢å¼•çš„å¯èƒ½æ€§ï¼Œè€ŒåŸºäºMySQLä¼˜åŒ–å™¨çš„â€œè¦†ç›–ç´¢å¼•â€ç­–ç•¥åˆæ˜¯é€Ÿåº¦æå¿«ï¼Œæ•ˆç‡æé«˜ï¼Œä¸šç•Œæä¸ºæ¨èçš„æŸ¥è¯¢ä¼˜åŒ–æ–¹å¼ã€‚\n","permalink":"https://reid00.github.io/en/posts/storage/mysql%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/","summary":"æœ¬æ–‡ä¸»è¦å—ä¼—ä¸ºå¼€å‘äººå‘˜,æ‰€ä»¥ä¸æ¶‰åŠåˆ°MySQLçš„æœåŠ¡éƒ¨ç½²ç­‰æ“ä½œ,ä¸”å†…å®¹è¾ƒå¤š,å¤§å®¶å‡†å¤‡å¥½è€å¿ƒå’Œç“œå­çŸ¿æ³‰æ°´ã€‚\nå‰ä¸€é˜µç³»ç»Ÿçš„å­¦ä¹ äº†ä¸€ä¸‹MySQL,ä¹Ÿæœ‰ä¸€äº›å®é™…æ“ä½œç»éªŒ,å¶ç„¶çœ‹åˆ°ä¸€ç¯‡å’ŒMySQLç›¸å…³çš„é¢è¯•æ–‡ç« ,å‘ç°å…¶ä¸­çš„ä¸€äº›é—®é¢˜è‡ªå·±ä¹Ÿå›ç­”ä¸å¥½,è™½ç„¶çŸ¥è¯†ç‚¹å¤§éƒ¨åˆ†éƒ½çŸ¥é“,ä½†æ˜¯æ— æ³•å°†çŸ¥è¯†ä¸²è”èµ·æ¥ã€‚\nå› æ­¤å†³å®šæä¸€ä¸ªMySQLçµé­‚100é—®,è¯•ç€ç”¨å›ç­”é—®é¢˜çš„æ–¹å¼,è®©è‡ªå·±å¯¹çŸ¥è¯†ç‚¹çš„ç†è§£æ›´åŠ æ·±å…¥ä¸€ç‚¹ã€‚\næ­¤æ–‡ä¸ä¼šäº‹æ— å·¨ç»†çš„ä»selectçš„ç”¨æ³•å¼€å§‹è®²è§£mysql,ä¸»è¦é’ˆå¯¹çš„æ˜¯å¼€å‘äººå‘˜éœ€è¦çŸ¥é“çš„ä¸€äº›MySQLçš„çŸ¥è¯†ç‚¹\nä¸»è¦åŒ…æ‹¬ç´¢å¼•,äº‹åŠ¡,ä¼˜åŒ–ç­‰æ–¹é¢,ä»¥åœ¨é¢è¯•ä¸­é«˜é¢‘çš„é—®å¥å½¢å¼ç»™å‡ºç­”æ¡ˆã€‚\nMySQL é‡è¦ç¬”è®° ä¸‰ä¸‡å­—ã€91é“MySQLé¢è¯•é¢˜ï¼ˆæ”¶è—ç‰ˆï¼‰\nhttps://mp.weixin.qq.com/s/KRWyl-zU1Cd6sxbya4dP_g\nä¹¦å†™é«˜è´¨é‡SQLçš„30æ¡å»ºè®®\nhttps://mp.weixin.qq.com/s/nM6fwEyi2VZeRMWtdZGpGQ\næ•°æ®åˆ†æé¢è¯•å¿…å¤‡SQLè¯­å¥+è¯­æ³•\nhttps://mp.weixin.qq.com/s/8UZAaDyB38gsZANPLxNKgg\nç´¢å¼•ç›¸å…³ å…³äºMySQLçš„ç´¢å¼•,æ›¾ç»è¿›è¡Œè¿‡ä¸€æ¬¡æ€»ç»“,æ–‡ç« é“¾æ¥åœ¨è¿™é‡Œ Mysqlç´¢å¼•åŸç†åŠå…¶ä¼˜åŒ–.\n1. ä»€ä¹ˆæ˜¯ç´¢å¼•?\nç´¢å¼•æ˜¯ä¸€ç§æ•°æ®ç»“æ„,å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„è¿›è¡Œæ•°æ®çš„æŸ¥æ‰¾.\n2. ç´¢å¼•æ˜¯ä¸ªä»€ä¹ˆæ ·çš„æ•°æ®ç»“æ„å‘¢?\nç´¢å¼•çš„æ•°æ®ç»“æ„å’Œå…·ä½“å­˜å‚¨å¼•æ“çš„å®ç°æœ‰å…³, åœ¨MySQLä¸­ä½¿ç”¨è¾ƒå¤šçš„ç´¢å¼•æœ‰Hashç´¢å¼•,B+æ ‘ç´¢å¼•ç­‰,è€Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„InnoDBå­˜å‚¨å¼•æ“çš„é»˜è®¤ç´¢å¼•å®ç°ä¸º:B+æ ‘ç´¢å¼•.\n3. Hashç´¢å¼•å’ŒB+æ ‘æ‰€æœ‰æœ‰ä»€ä¹ˆåŒºåˆ«æˆ–è€…è¯´ä¼˜åŠ£å‘¢?\né¦–å…ˆè¦çŸ¥é“Hashç´¢å¼•å’ŒB+æ ‘ç´¢å¼•çš„åº•å±‚å®ç°åŸç†:\nhashç´¢å¼•åº•å±‚å°±æ˜¯hashè¡¨,è¿›è¡ŒæŸ¥æ‰¾æ—¶,è°ƒç”¨ä¸€æ¬¡hashå‡½æ•°å°±å¯ä»¥è·å–åˆ°ç›¸åº”çš„é”®å€¼,ä¹‹åè¿›è¡Œå›è¡¨æŸ¥è¯¢è·å¾—å®é™…æ•°æ®.B+æ ‘åº•å±‚å®ç°æ˜¯å¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘.\nå¯¹äºæ¯ä¸€æ¬¡çš„æŸ¥è¯¢éƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹å‡ºå‘,æŸ¥æ‰¾åˆ°å¶å­èŠ‚ç‚¹æ–¹å¯ä»¥è·å¾—æ‰€æŸ¥é”®å€¼,ç„¶åæ ¹æ®æŸ¥è¯¢åˆ¤æ–­æ˜¯å¦éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®.\né‚£ä¹ˆå¯ä»¥çœ‹å‡ºä»–ä»¬æœ‰ä»¥ä¸‹çš„ä¸åŒ:\nhashç´¢å¼•è¿›è¡Œç­‰å€¼æŸ¥è¯¢æ›´å¿«(ä¸€èˆ¬æƒ…å†µä¸‹),ä½†æ˜¯å´æ— æ³•è¿›è¡ŒèŒƒå›´æŸ¥è¯¢. å› ä¸ºåœ¨hashç´¢å¼•ä¸­ç»è¿‡hashå‡½æ•°å»ºç«‹ç´¢å¼•ä¹‹å,ç´¢å¼•çš„é¡ºåºä¸åŸé¡ºåºæ— æ³•ä¿æŒä¸€è‡´,ä¸èƒ½æ”¯æŒèŒƒå›´æŸ¥è¯¢.\nè€ŒB+æ ‘çš„çš„æ‰€æœ‰èŠ‚ç‚¹çš†éµå¾ª(å·¦èŠ‚ç‚¹å°äºçˆ¶èŠ‚ç‚¹,å³èŠ‚ç‚¹å¤§äºçˆ¶èŠ‚ç‚¹,å¤šå‰æ ‘ä¹Ÿç±»ä¼¼),å¤©ç„¶æ”¯æŒèŒƒå›´.\nhashç´¢å¼•ä¸æ”¯æŒä½¿ç”¨ç´¢å¼•è¿›è¡Œæ’åº,åŸç†åŒä¸Š.\nhashç´¢å¼•ä¸æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢ä»¥åŠå¤šåˆ—ç´¢å¼•çš„æœ€å·¦å‰ç¼€åŒ¹é….åŸç†ä¹Ÿæ˜¯å› ä¸ºhashå‡½æ•°çš„ä¸å¯é¢„æµ‹.AAAAå’ŒAAAABçš„ç´¢å¼•æ²¡æœ‰ç›¸å…³æ€§.\nhashç´¢å¼•ä»»ä½•æ—¶å€™éƒ½é¿å…ä¸äº†å›è¡¨æŸ¥è¯¢æ•°æ®,è€ŒB+æ ‘åœ¨ç¬¦åˆæŸäº›æ¡ä»¶(èšç°‡ç´¢å¼•,è¦†ç›–ç´¢å¼•ç­‰)çš„æ—¶å€™å¯ä»¥åªé€šè¿‡ç´¢å¼•å®ŒæˆæŸ¥è¯¢.\nhashç´¢å¼•è™½ç„¶åœ¨ç­‰å€¼æŸ¥è¯¢ä¸Šè¾ƒå¿«,ä½†æ˜¯ä¸ç¨³å®š.æ€§èƒ½ä¸å¯é¢„æµ‹,å½“æŸä¸ªé”®å€¼å­˜åœ¨å¤§é‡é‡å¤çš„æ—¶å€™,å‘ç”Ÿhashç¢°æ’,æ­¤æ—¶æ•ˆç‡å¯èƒ½æå·®.è€ŒB+æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ¯”è¾ƒç¨³å®š,å¯¹äºæ‰€æœ‰çš„æŸ¥è¯¢éƒ½æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹,ä¸”æ ‘çš„é«˜åº¦è¾ƒä½.\nå› æ­¤,åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹,ç›´æ¥é€‰æ‹©B+æ ‘ç´¢å¼•å¯ä»¥è·å¾—ç¨³å®šä¸”è¾ƒå¥½çš„æŸ¥è¯¢é€Ÿåº¦.è€Œä¸éœ€è¦ä½¿ç”¨hashç´¢å¼•.\n4. ä¸Šé¢æåˆ°äº†B+æ ‘åœ¨æ»¡è¶³èšç°‡ç´¢å¼•å’Œè¦†ç›–ç´¢å¼•çš„æ—¶å€™ä¸éœ€è¦å›è¡¨æŸ¥è¯¢æ•°æ®,ä»€ä¹ˆæ˜¯èšç°‡ç´¢å¼•?\nåœ¨B+æ ‘çš„ç´¢å¼•ä¸­,å¶å­èŠ‚ç‚¹å¯èƒ½å­˜å‚¨äº†å½“å‰çš„keyå€¼,ä¹Ÿå¯èƒ½å­˜å‚¨äº†å½“å‰çš„keyå€¼ä»¥åŠæ•´è¡Œçš„æ•°æ®,è¿™å°±æ˜¯èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•.\nåœ¨InnoDBä¸­,åªæœ‰ä¸»é”®ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•,å¦‚æœæ²¡æœ‰ä¸»é”®,åˆ™æŒ‘é€‰ä¸€ä¸ªå”¯ä¸€é”®å»ºç«‹èšç°‡ç´¢å¼•.å¦‚æœæ²¡æœ‰å”¯ä¸€é”®,åˆ™éšå¼çš„ç”Ÿæˆä¸€ä¸ªé”®æ¥å»ºç«‹èšç°‡ç´¢å¼•.\nå½“æŸ¥è¯¢ä½¿ç”¨èšç°‡ç´¢å¼•æ—¶,åœ¨å¯¹åº”çš„å¶å­èŠ‚ç‚¹,å¯ä»¥è·å–åˆ°æ•´è¡Œæ•°æ®,å› æ­¤ä¸ç”¨å†æ¬¡è¿›è¡Œå›è¡¨æŸ¥è¯¢.\n5. éèšç°‡ç´¢å¼•ä¸€å®šä¼šå›è¡¨æŸ¥è¯¢å—?\nä¸ä¸€å®š,è¿™æ¶‰åŠåˆ°æŸ¥è¯¢è¯­å¥æ‰€è¦æ±‚çš„å­—æ®µæ˜¯å¦å…¨éƒ¨å‘½ä¸­äº†ç´¢å¼•,å¦‚æœå…¨éƒ¨å‘½ä¸­äº†ç´¢å¼•,é‚£ä¹ˆå°±ä¸å¿…å†è¿›è¡Œå›è¡¨æŸ¥è¯¢.\nä¸¾ä¸ªç®€å•çš„ä¾‹å­,å‡è®¾æˆ‘ä»¬åœ¨å‘˜å·¥è¡¨çš„å¹´é¾„ä¸Šå»ºç«‹äº†ç´¢å¼•,é‚£ä¹ˆå½“è¿›è¡Œselect age from employee where age \u0026lt; 20çš„æŸ¥è¯¢æ—¶,åœ¨ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸Š,å·²ç»åŒ…å«äº†ageä¿¡æ¯,ä¸ä¼šå†æ¬¡è¿›è¡Œå›è¡¨æŸ¥è¯¢.\n6. åœ¨å»ºç«‹ç´¢å¼•çš„æ—¶å€™,éƒ½æœ‰å“ªäº›éœ€è¦è€ƒè™‘çš„å› ç´ å‘¢?\nå»ºç«‹ç´¢å¼•çš„æ—¶å€™ä¸€èˆ¬è¦è€ƒè™‘åˆ°å­—æ®µçš„ä½¿ç”¨é¢‘ç‡,ç»å¸¸ä½œä¸ºæ¡ä»¶è¿›è¡ŒæŸ¥è¯¢çš„å­—æ®µæ¯”è¾ƒé€‚åˆ.å¦‚æœéœ€è¦å»ºç«‹è”åˆç´¢å¼•çš„è¯,è¿˜éœ€è¦è€ƒè™‘è”åˆç´¢å¼•ä¸­çš„é¡ºåº.\næ­¤å¤–ä¹Ÿè¦è€ƒè™‘å…¶ä»–æ–¹é¢,æ¯”å¦‚é˜²æ­¢è¿‡å¤šçš„æ‰€æœ‰å¯¹è¡¨é€ æˆå¤ªå¤§çš„å‹åŠ›.è¿™äº›éƒ½å’Œå®é™…çš„è¡¨ç»“æ„ä»¥åŠæŸ¥è¯¢æ–¹å¼æœ‰å…³.\n7. è”åˆç´¢å¼•æ˜¯ä»€ä¹ˆ?ä¸ºä»€ä¹ˆéœ€è¦æ³¨æ„è”åˆç´¢å¼•ä¸­çš„é¡ºåº?\nMySQLå¯ä»¥ä½¿ç”¨å¤šä¸ªå­—æ®µåŒæ—¶å»ºç«‹ä¸€ä¸ªç´¢å¼•,å«åšè”åˆç´¢å¼•.åœ¨è”åˆç´¢å¼•ä¸­,å¦‚æœæƒ³è¦å‘½ä¸­ç´¢å¼•,éœ€è¦æŒ‰ç…§å»ºç«‹ç´¢å¼•æ—¶çš„å­—æ®µé¡ºåºæŒ¨ä¸ªä½¿ç”¨,å¦åˆ™æ— æ³•å‘½ä¸­ç´¢å¼•.\nå…·ä½“åŸå› ä¸º:\nMySQLä½¿ç”¨ç´¢å¼•æ—¶éœ€è¦ç´¢å¼•æœ‰åº,å‡è®¾ç°åœ¨å»ºç«‹äº†\u0026quot;name,age,school\u0026quot;çš„è”åˆç´¢å¼•\né‚£ä¹ˆç´¢å¼•çš„æ’åºä¸º: å…ˆæŒ‰ç…§nameæ’åº,å¦‚æœnameç›¸åŒ,åˆ™æŒ‰ç…§ageæ’åº,å¦‚æœageçš„å€¼ä¹Ÿç›¸ç­‰,åˆ™æŒ‰ç…§schoolè¿›è¡Œæ’åº.\nå½“è¿›è¡ŒæŸ¥è¯¢æ—¶,æ­¤æ—¶ç´¢å¼•ä»…ä»…æŒ‰ç…§nameä¸¥æ ¼æœ‰åº,å› æ­¤å¿…é¡»é¦–å…ˆä½¿ç”¨nameå­—æ®µè¿›è¡Œç­‰å€¼æŸ¥è¯¢,ä¹‹åå¯¹äºåŒ¹é…åˆ°çš„åˆ—è€Œè¨€,å…¶æŒ‰ç…§ageå­—æ®µä¸¥æ ¼æœ‰åº,æ­¤æ—¶å¯ä»¥ä½¿ç”¨ageå­—æ®µç”¨åšç´¢å¼•æŸ¥æ‰¾,ä»¥æ­¤ç±»æ¨.\nå› æ­¤åœ¨å»ºç«‹è”åˆç´¢å¼•çš„æ—¶å€™åº”è¯¥æ³¨æ„ç´¢å¼•åˆ—çš„é¡ºåº,ä¸€èˆ¬æƒ…å†µä¸‹,å°†æŸ¥è¯¢éœ€æ±‚é¢‘ç¹æˆ–è€…å­—æ®µé€‰æ‹©æ€§é«˜çš„åˆ—æ”¾åœ¨å‰é¢.æ­¤å¤–å¯ä»¥æ ¹æ®ç‰¹ä¾‹çš„æŸ¥è¯¢æˆ–è€…è¡¨ç»“æ„è¿›è¡Œå•ç‹¬çš„è°ƒæ•´.\n8. åˆ›å»ºçš„ç´¢å¼•æœ‰æ²¡æœ‰è¢«ä½¿ç”¨åˆ°?æˆ–è€…è¯´æ€ä¹ˆæ‰å¯ä»¥çŸ¥é“è¿™æ¡è¯­å¥è¿è¡Œå¾ˆæ…¢çš„åŸå› ?\nMySQLæä¾›äº†explainå‘½ä»¤æ¥æŸ¥çœ‹è¯­å¥çš„æ‰§è¡Œè®¡åˆ’,MySQLåœ¨æ‰§è¡ŒæŸä¸ªè¯­å¥ä¹‹å‰,ä¼šå°†è¯¥è¯­å¥è¿‡ä¸€éæŸ¥è¯¢ä¼˜åŒ–å™¨,ä¹‹åä¼šæ‹¿åˆ°å¯¹è¯­å¥çš„åˆ†æ,ä¹Ÿå°±æ˜¯æ‰§è¡Œè®¡åˆ’,å…¶ä¸­åŒ…å«äº†è®¸å¤šä¿¡æ¯.\nå¯ä»¥é€šè¿‡å…¶ä¸­å’Œç´¢å¼•æœ‰å…³çš„ä¿¡æ¯æ¥åˆ†ææ˜¯å¦å‘½ä¸­äº†ç´¢å¼•,ä¾‹å¦‚possilbe_key,key,key_lenç­‰å­—æ®µ,åˆ†åˆ«è¯´æ˜äº†æ­¤è¯­å¥å¯èƒ½ä¼šä½¿ç”¨çš„ç´¢å¼•,å®é™…ä½¿ç”¨çš„ç´¢å¼•ä»¥åŠä½¿ç”¨çš„ç´¢å¼•é•¿åº¦.","title":"MySqlé«˜é¢‘é¢è¯•é—®é¢˜"},{"content":"å‡è®¾æœ‰å¦‚ä¸‹ç›®å½•ç»“æ„ï¼š\n1 2 3 4 5 6 7 -- dir0 | file1.py | file2.py | dir3 | file3.py | dir4 | file4.py dir0æ–‡ä»¶å¤¹ä¸‹æœ‰file1.pyã€file2.pyä¸¤ä¸ªæ–‡ä»¶å’Œdir3ã€dir4ä¸¤ä¸ªå­æ–‡ä»¶å¤¹ï¼Œdir3ä¸­æœ‰file3.pyæ–‡ä»¶ï¼Œdir4ä¸­æœ‰file4.pyæ–‡ä»¶ã€‚\n1.å¯¼å…¥åŒçº§æ¨¡å— pythonå¯¼å…¥åŒçº§æ¨¡å—ï¼ˆåœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­çš„pyæ–‡ä»¶ï¼‰ç›´æ¥å¯¼å…¥å³å¯ã€‚\n1 import xxx å¦‚åœ¨file1.pyä¸­æƒ³å¯¼å…¥file2.pyï¼Œæ³¨æ„æ— éœ€åŠ åç¼€\u0026quot;.py\u0026quot;ï¼š\n1 2 3 import file2 # ä½¿ç”¨file2ä¸­å‡½æ•°æ—¶éœ€åŠ ä¸Šå‰ç¼€\u0026#34;file2.\u0026#34;ï¼Œå³ï¼š # file2.fuction_name() 2.å¯¼å…¥ä¸‹çº§æ¨¡å— å¯¼å…¥ä¸‹çº§ç›®å½•æ¨¡å—ä¹Ÿå¾ˆå®¹æ˜“ï¼Œéœ€åœ¨ä¸‹çº§ç›®å½•ä¸­æ–°å»ºä¸€ä¸ªç©ºç™½çš„__init__.pyæ–‡ä»¶å†å¯¼å…¥ï¼š\n1 from dirname import xxx å¦‚åœ¨file1.pyä¸­æƒ³å¯¼å…¥dir3ä¸‹çš„file3.pyï¼Œé¦–å…ˆè¦åœ¨dir3ä¸­æ–°å»ºä¸€ä¸ªç©ºç™½çš„__init__.pyæ–‡ä»¶ã€‚\n1 2 3 4 5 6 7 8 -- dir0 | file1.py | file2.py | dir3 | __init__.py | file3.py | dir4 | file4.py å†ä½¿ç”¨å¦‚ä¸‹è¯­å¥ï¼š\n1 2 #plan A from dir3 import file3 æˆ–è€…\n1 2 3 4 #plan B import dir3.file3 #or # import dir3.file3 as df3 ä½†ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼åˆ™ä¸‹æ–‡éœ€è¦ä¸€ç›´å¸¦ç€è·¯å¾„dir3ä¹¦å†™ï¼Œè¾ƒä¸ºç´¯èµ˜ï¼Œå»ºè®®å¯ä»¥å¦èµ·ä¸€ä¸ªåˆ«åã€‚\n3.å¯¼å…¥ä¸Šçº§æ¨¡å— è¦å¯¼å…¥ä¸Šçº§ç›®å½•ä¸‹æ¨¡å—ï¼Œå¯ä»¥ä½¿ç”¨sys.pathï¼š 1 2 3 import sys sys.path.append(\u0026#39;..\u0026#39;) import xxx å¦‚åœ¨file4.pyä¸­æƒ³å¼•å…¥importä¸Šçº§ç›®å½•ä¸‹çš„file1.pyï¼š\n1 2 3 import sys sys.path.append(\u0026#34;..\u0026#34;) import file1 **sys.pathçš„ä½œç”¨ï¼š**å½“ä½¿ç”¨importè¯­å¥å¯¼å…¥æ¨¡å—æ—¶ï¼Œè§£é‡Šå™¨ä¼šæœç´¢å½“å‰æ¨¡å—æ‰€åœ¨ç›®å½•ä»¥åŠsys.pathæŒ‡å®šçš„è·¯å¾„å»æ‰¾éœ€è¦importçš„æ¨¡å—ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ç›´æ¥æŠŠä¸Šçº§ç›®å½•åŠ åˆ°äº†sys.pathé‡Œã€‚\n**â€œ..â€çš„å«ä¹‰ï¼š**ç­‰åŒäºlinuxé‡Œçš„â€˜..â€™ï¼Œè¡¨ç¤ºå½“å‰å·¥ä½œç›®å½•çš„ä¸Šçº§ç›®å½•ã€‚å®é™…ä¸Špythonä¸­çš„â€˜.â€™ä¹Ÿå’Œlinuxä¸­ä¸€è‡´ï¼Œè¡¨ç¤ºå½“å‰ç›®å½•ã€‚\n4.å¯¼å…¥éš”å£æ–‡ä»¶å¤¹ä¸‹çš„æ¨¡å— å¦‚åœ¨file4.pyä¸­æƒ³å¼•å…¥importåœ¨dir3ç›®å½•ä¸‹çš„file3.pyã€‚\nè¿™å…¶å®æ˜¯å‰é¢ä¸¤ä¸ªæ“ä½œçš„ç»„åˆï¼Œå…¶æ€è·¯æœ¬è´¨ä¸Šæ˜¯å°†ä¸Šçº§ç›®å½•åŠ åˆ°sys.pathé‡Œï¼Œå†æŒ‰ç…§å¯¹ä¸‹çº§ç›®å½•æ¨¡å—çš„æ–¹å¼å¯¼å…¥ã€‚\nåŒæ ·éœ€è¦è¢«å¼•æ–‡ä»¶å¤¹ä¹Ÿå°±æ˜¯dir3ä¸‹æœ‰ç©ºçš„__init__.pyæ–‡ä»¶ã€‚\n1 2 3 4 5 6 7 8 -- dir | file1.py | file2.py | dir3 | __init__.py | file3.py | dir4 | file4.py åŒæ—¶ä¹Ÿè¦å°†ä¸Šçº§ç›®å½•åŠ åˆ°sys.pathé‡Œï¼š\n1 2 3 import sys sys.path.append(\u0026#34;..\u0026#34;) from dir3 import file3 æ–‡ä»¶å¤¹ä½œä¸ºpackageéœ€è¦æ»¡è¶³å¦‚ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š\næ–‡ä»¶å¤¹ä¸­å¿…é¡»å­˜åœ¨æœ‰__init__.pyæ–‡ä»¶ï¼Œå¯ä»¥ä¸ºç©ºã€‚ ä¸èƒ½ä½œä¸ºé¡¶å±‚æ¨¡å—æ¥æ‰§è¡Œè¯¥æ–‡ä»¶å¤¹ä¸­çš„pyæ–‡ä»¶ã€‚ ","permalink":"https://reid00.github.io/en/posts/langs_linux/python-import%E5%AF%BC%E5%85%A5%E4%B8%8A%E7%BA%A7%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6/","summary":"å‡è®¾æœ‰å¦‚ä¸‹ç›®å½•ç»“æ„ï¼š\n1 2 3 4 5 6 7 -- dir0 | file1.py | file2.py | dir3 | file3.py | dir4 | file4.py dir0æ–‡ä»¶å¤¹ä¸‹æœ‰file1.pyã€file2.pyä¸¤ä¸ªæ–‡ä»¶å’Œdir3ã€dir4ä¸¤ä¸ªå­æ–‡ä»¶å¤¹ï¼Œdir3ä¸­æœ‰file3.pyæ–‡ä»¶ï¼Œdir4ä¸­æœ‰file4.pyæ–‡ä»¶ã€‚\n1.å¯¼å…¥åŒçº§æ¨¡å— pythonå¯¼å…¥åŒçº§æ¨¡å—ï¼ˆåœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­çš„pyæ–‡ä»¶ï¼‰ç›´æ¥å¯¼å…¥å³å¯ã€‚\n1 import xxx å¦‚åœ¨file1.pyä¸­æƒ³å¯¼å…¥file2.pyï¼Œæ³¨æ„æ— éœ€åŠ åç¼€\u0026quot;.py\u0026quot;ï¼š\n1 2 3 import file2 # ä½¿ç”¨file2ä¸­å‡½æ•°æ—¶éœ€åŠ ä¸Šå‰ç¼€\u0026#34;file2.\u0026#34;ï¼Œå³ï¼š # file2.fuction_name() 2.å¯¼å…¥ä¸‹çº§æ¨¡å— å¯¼å…¥ä¸‹çº§ç›®å½•æ¨¡å—ä¹Ÿå¾ˆå®¹æ˜“ï¼Œéœ€åœ¨ä¸‹çº§ç›®å½•ä¸­æ–°å»ºä¸€ä¸ªç©ºç™½çš„__init__.pyæ–‡ä»¶å†å¯¼å…¥ï¼š\n1 from dirname import xxx å¦‚åœ¨file1.pyä¸­æƒ³å¯¼å…¥dir3ä¸‹çš„file3.pyï¼Œé¦–å…ˆè¦åœ¨dir3ä¸­æ–°å»ºä¸€ä¸ªç©ºç™½çš„__init__.pyæ–‡ä»¶ã€‚\n1 2 3 4 5 6 7 8 -- dir0 | file1.py | file2.py | dir3 | __init__.py | file3.py | dir4 | file4.py å†ä½¿ç”¨å¦‚ä¸‹è¯­å¥ï¼š","title":"Python Importå¯¼å…¥ä¸Šçº§ç›®å½•æ–‡ä»¶"},{"content":"ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Œç´¢å¼•çš„ä½œç”¨ å½“æˆ‘ä»¬è¦åœ¨æ–°åå­—å…¸é‡ŒæŸ¥æŸä¸ªå­—ï¼ˆå¦‚ã€Œå…ˆã€ï¼‰å…·ä½“å«ä¹‰çš„æ—¶å€™ï¼Œé€šå¸¸éƒ½ä¼šæ‹¿èµ·ä¸€æœ¬æ–°åå­—å…¸æ¥æŸ¥ï¼Œä½ å¯ä»¥å…ˆä»å¤´åˆ°å°¾æŸ¥è¯¢æ¯ä¸€é¡µæ˜¯å¦æœ‰ã€Œå…ˆã€è¿™ä¸ªå­—ï¼Œè¿™æ ·åšï¼ˆå¯¹åº”æ•°æ®åº“ä¸­çš„å…¨è¡¨æ‰«æï¼‰ç¡®å®èƒ½æ‰¾åˆ°ï¼Œä½†æ•ˆç‡æ— ç–‘æ˜¯éå¸¸ä½ä¸‹çš„ï¼Œæ›´é«˜æ•ˆçš„æ–¹ç›¸ä¿¡å¤§å®¶ä¹Ÿéƒ½çŸ¥é“ï¼Œå°±æ˜¯åœ¨é¦–é¡µçš„ç´¢å¼•é‡Œå…ˆæŸ¥æ‰¾ã€Œå…ˆã€å¯¹åº”çš„é¡µæ•°ï¼Œç„¶åç›´æ¥è·³åˆ°ç›¸åº”çš„é¡µé¢æŸ¥æ‰¾ï¼Œè¿™æ ·æŸ¥è¯¢æ—¶å€™å¤§å¤§å‡å°‘äº†ï¼Œå¯ä»¥ä¸ºæ˜¯ O(1)ã€‚\næ•°æ®åº“ä¸­çš„ç´¢å¼•ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œé€šè¿‡ç´¢å¼•å®šä½åˆ°è¦è¯»å–çš„é¡µï¼Œå¤§å¤§å‡å°‘äº†éœ€è¦æ‰«æçš„è¡Œæ•°ï¼Œèƒ½æå¤§çš„æå‡æ•ˆç‡ï¼Œç®€è€Œè¨€ä¹‹ï¼Œç´¢å¼•ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªä½œç”¨:\nå³ä¸Šè¿°æ‰€è¯´ï¼Œç´¢å¼•èƒ½æå¤§åœ°å‡å°‘æ‰«æè¡Œæ•° ç´¢å¼•å¯ä»¥å¸®åŠ©æœåŠ¡å™¨é¿å…æ’åºå’Œä¸´æ—¶è¡¨ ç´¢å¼•å¯ä»¥å°†éšæœº IO å˜æˆé¡ºåº IO MySQLä¸­ç´¢å¼•çš„å­˜å‚¨ç±»å‹æœ‰ä¸¤ç§ï¼šBTREEå’ŒHASHï¼Œå…·ä½“å’Œè¡¨çš„å­˜å‚¨å¼•æ“ç›¸å…³ï¼›\nMyISAMå’ŒInnoDBå­˜å‚¨å¼•æ“åªæ”¯æŒBTREEç´¢å¼•ï¼ŒMEMORY/HEAPå­˜å‚¨å¼•æ“å¯ä»¥æ”¯æŒHASHå’ŒBTREEç´¢å¼•ã€‚\nç¬¬ä¸€ç‚¹ä¸Šæ–‡å·²ç»è§£é‡Šäº†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ç¬¬äºŒç‚¹å’Œç¬¬ä¸‰ç‚¹\nå…ˆæ¥çœ‹ç¬¬äºŒç‚¹ï¼Œå‡è®¾æˆ‘ä»¬ä¸ç”¨ç´¢å¼•ï¼Œè¯•æƒ³è¿è¡Œå¦‚ä¸‹è¯­å¥\n1 select * from user order by age desc åˆ™ MySQL çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼Œæ‰«ææ‰€æœ‰è¡Œï¼ŒæŠŠæ‰€æœ‰è¡ŒåŠ è½½åˆ°å†…å­˜åï¼Œå†æŒ‰ age æ’åºç”Ÿæˆä¸€å¼ ä¸´æ—¶è¡¨ï¼Œå†æŠŠè¿™è¡¨æ’åºåå°†ç›¸åº”è¡Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ›´ç³Ÿçš„ï¼Œå¦‚æœè¿™å¼ ä¸´æ—¶è¡¨çš„å¤§å°å¤§äº tmp_table_size çš„å€¼ï¼ˆé»˜è®¤ä¸º 16 Mï¼‰ï¼Œå†…å­˜ä¸´æ—¶è¡¨ä¼šè½¬ä¸ºç£ç›˜ä¸´æ—¶è¡¨ï¼Œæ€§èƒ½ä¼šæ›´å·®ï¼Œå¦‚æœåŠ äº†ç´¢å¼•ï¼Œç´¢å¼•æœ¬èº«æ˜¯æœ‰åºçš„ ï¼Œæ‰€ä»¥ä»ç£ç›˜è¯»çš„è¡Œæ•°æœ¬èº«å°±æ˜¯æŒ‰ age æ’åºå¥½çš„ï¼Œä¹Ÿå°±ä¸ä¼šç”Ÿæˆä¸´æ—¶è¡¨ï¼Œå°±ä¸ç”¨å†é¢å¤–æ’åº ï¼Œæ— ç–‘æå‡äº†æ€§èƒ½ã€‚\nå†æ¥çœ‹éšæœº IO å’Œé¡ºåº IOã€‚å…ˆæ¥è§£é‡Šä¸‹è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚\nç›¸ä¿¡ä¸å°‘äººåº”è¯¥åƒè¿‡æ—‹è½¬ç«é”…ï¼ŒæœåŠ¡å‘˜æŠŠä¸€ç›˜ç›˜çš„èœæ”¾åœ¨æ—‹è½¬ä¼ è¾“å¸¦ä¸Šï¼Œç„¶åç­‰åˆ°è¿™äº›èœè½¬åˆ°æˆ‘ä»¬é¢å‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°èœäº†ï¼Œå‡è®¾è£…ä¸€åœˆéœ€è¦ 4 åˆ†é’Ÿï¼Œåˆ™æœ€çŸ­ç­‰å¾…æ—¶é—´æ˜¯ 0ï¼ˆå³èœå°±åœ¨ä½ è·Ÿå‰ï¼‰ï¼Œæœ€é•¿ç­‰å¾…æ—¶é—´æ˜¯ 4 åˆ†é’Ÿï¼ˆèœåˆšå¥½åœ¨ä½ è·Ÿå‰é”™è¿‡ï¼‰ï¼Œé‚£ä¹ˆå¹³å‡ç­‰å¾…æ—¶é—´å³ä¸º 2 åˆ†é’Ÿï¼Œå‡è®¾æˆ‘ä»¬ç°åœ¨è¦æ‹¿å››ç›˜èœï¼Œè¿™å››ç›˜èœéšæœºåˆ†é…åœ¨ä¼ è¾“å¸¦ä¸Šï¼Œåˆ™å¯çŸ¥æ‹¿åˆ°è¿™å››ç›˜èœçš„å¹³å‡ç­‰å¾…æ—¶é—´æ˜¯ 8 åˆ†é’Ÿï¼ˆéšæœº IOï¼‰ï¼Œå¦‚æœè¿™å››ç›˜èœåˆšå¥½ç´§é‚»ç€æ’åœ¨ä¸€èµ·ï¼Œåˆ™ç­‰å¾…æ—¶é—´åªéœ€ 2 åˆ†é’Ÿï¼ˆé¡ºåº IOï¼‰ã€‚\nä¸Šè¿°ä¸­ä¼ è¾“å¸¦å°±ç±»æ¯”ç£é“ï¼Œç£é“ä¸Šçš„èœå°±ç±»æ¯”æ‰‡åŒºï¼ˆsectorï¼‰ä¸­çš„ä¿¡æ¯ï¼Œç£ç›˜å—ï¼ˆblockï¼‰æ˜¯ç”±å¤šä¸ªç›¸é‚»çš„æ‰‡åŒºç»„æˆçš„ï¼Œæ˜¯æ“ä½œç³»ç»Ÿè¯»å–çš„æœ€å°å•å…ƒï¼Œè¿™æ ·å¦‚æœä¿¡æ¯èƒ½ä»¥ block çš„å½¢å¼èšé›†åœ¨ä¸€èµ·ï¼Œå°±èƒ½æå¤§å‡å°‘ç£ç›˜ IO æ—¶é—´,è¿™å°±æ˜¯é¡ºåº IO å¸¦æ¥çš„æ€§èƒ½æå‡ï¼Œä¸‹æ–‡ä¸­æˆ‘ä»¬å°†ä¼šçœ‹åˆ° B+ æ ‘ç´¢å¼•å°±èµ·åˆ°è¿™æ ·çš„ä½œç”¨ã€‚\nå¦‚å›¾ç¤ºï¼šå¤šä¸ªæ‰‡åŒºç»„æˆäº†ä¸€ä¸ª blockï¼Œå¦‚æœè¦è¯»çš„ä¿¡æ¯éƒ½åœ¨è¿™ä¸ª block ä¸­ï¼Œåˆ™åªéœ€ä¸€æ¬¡ IO è¯»\nè€Œå¦‚æœä¿¡æ¯åœ¨ä¸€ä¸ªç£é“ä¸­, åˆ†æ•£åœ°åˆ†å¸ƒåœ¨å„ä¸ªæ‰‡åŒºä¸­ï¼Œæˆ–è€…åˆ†å¸ƒåœ¨ä¸åŒç£é“çš„æ‰‡åŒºä¸Šï¼ˆå¯»é“æ—¶é—´æ˜¯éšæœºIOä¸»è¦ç“¶é¢ˆæ‰€åœ¨ï¼‰ï¼Œå°†ä¼šé€ æˆéšæœº IOï¼Œå½±å“æ€§èƒ½ã€‚\næˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸€ä¸ªéšæœº IO çš„æ—¶é—´åˆ†å¸ƒï¼š\nseek Time: å¯»é“æ—¶é—´ï¼Œç£å¤´ç§»åŠ¨åˆ°æ‰‡åŒºæ‰€åœ¨çš„ç£é“ Rotational Latencyï¼šå®Œæˆæ­¥éª¤ 1 åï¼Œç£å¤´ç§»åŠ¨åˆ°åŒä¸€ç£é“æ‰‡åŒºå¯¹åº”çš„ä½ç½®æ‰€éœ€æ±‚æ—¶é—´ Transfer Time ä»ç£ç›˜è¯»å–ä¿¡æ¯ä¼ å…¥å†…å­˜æ—¶é—´ è¿™å…¶ä¸­å¯»é“æ—¶é—´å æ®äº†ç»å¤§å¤šæ•°çš„æ—¶é—´ï¼ˆå¤§æ¦‚å æ®éšæœº IO æ—¶é—´çš„å  40%ï¼‰ã€‚\néšæœº IO å’Œé¡ºåº IO å¤§æ¦‚ç›¸å·®ç™¾å€ (éšæœº IOï¼š10 ms/ page, é¡ºåº IO 0.1ms / page)ï¼Œå¯è§é¡ºåº IO æ€§èƒ½ä¹‹é«˜ï¼Œç´¢å¼•å¸¦æ¥çš„æ€§èƒ½æå‡æ˜¾è€Œæ˜“è§ï¼\nç´¢å¼•çš„ç§ç±» ç´¢å¼•ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç±»\nB+æ ‘ç´¢å¼• å“ˆå¸Œç´¢å¼• B+æ ‘ç´¢å¼• B+ æ ‘ç´¢å¼•ä¹‹å‰åœ¨æ­¤æ–‡ä¸­è¯¦ç»†é˜è¿°è¿‡ï¼Œå¼ºçƒˆå»ºè®®å¤§å®¶çœ‹ä¸€éï¼Œå¯¹ç†è§£ B+ æ ‘æœ‰å¾ˆå¤§çš„å¸®åŠ©ï¼Œç®€å•å›é¡¾ä¸€ä¸‹å§\nB+ æ ‘æ˜¯ä»¥ N å‰æ ‘çš„å½¢å¼å­˜åœ¨çš„ï¼Œè¿™æ ·æœ‰æ•ˆé™ä½äº†æ ‘çš„é«˜åº¦ï¼ŒæŸ¥æ‰¾æ•°æ®ä¹Ÿä¸éœ€è¦å…¨è¡¨æ‰«æäº†ï¼Œé¡ºç€æ ¹èŠ‚ç‚¹å±‚å±‚å¾€ä¸‹æŸ¥æ‰¾èƒ½å¾ˆå¿«åœ°æ‰¾åˆ°æˆ‘ä»¬çš„ç›®æ ‡æ•°æ®ã€‚ æ¯ä¸ªèŠ‚ç‚¹çš„å¤§å°å³ä¸€ä¸ªé¡µçš„å¤§å°ï¼Œä¸€æ¬¡ IO ä¼šå°†ä¸€ä¸ªé¡µï¼ˆæ¯é¡µåŒ…å«å¤šä¸ªç£ç›˜å—ï¼‰çš„æ•°æ®éƒ½è¯»å…¥ï¼ˆå³ç£ç›˜é¢„è¯»ï¼Œç¨‹åºå±€éƒ¨æ€§åŸç†:è¯»åˆ°äº†æŸä¸ªå€¼ï¼Œå¾ˆå¤§å¯èƒ½è¿™ä¸ªå€¼å‘¨å›´çš„æ•°æ®ä¹Ÿä¼šè¢«ç”¨åˆ°ï¼Œå¹²è„†ä¸€èµ·è¯»å…¥å†…å­˜ï¼‰ï¼Œå¶å­èŠ‚ç‚¹é€šè¿‡æŒ‡é’ˆçš„ç›¸äº’æŒ‡å‘è¿æ¥ï¼Œèƒ½æœ‰æ•ˆå‡å°‘é¡ºåºéå†æ—¶çš„éšæœº IOï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œå¶å­èŠ‚ç‚¹éƒ½æ˜¯æŒ‰ç´¢å¼•çš„é¡ºåºæ’åºå¥½çš„ï¼Œè¿™ä¹Ÿæ„å‘³ç€æ ¹æ®ç´¢å¼•æŸ¥æ‰¾æˆ–æ’åºéƒ½æ˜¯æ’åºå¥½äº†çš„ï¼Œä¸ä¼šå†åœ¨å†…å­˜ä¸­å½¢æˆä¸´æ—¶è¡¨ã€‚\nè¯¦è§£ï¼šMysqlè®¾è®¡åˆ©ç”¨äº†ç£ç›˜é¢„è¯»åŸç†ï¼Œå°†ä¸€ä¸ªB+TreeèŠ‚ç‚¹å¤§å°è®¾ä¸ºä¸€ä¸ªé¡µå¤§å°ï¼Œåœ¨æ–°å»ºèŠ‚ç‚¹æ—¶ç›´æ¥ç”³è¯·ä¸€ä¸ªé¡µçš„ç©ºé—´ï¼Œè¿™æ ·å°±èƒ½ä¿è¯ä¸€ä¸ªèŠ‚ç‚¹ç‰©ç†ä¸Šå­˜å‚¨åœ¨ä¸€ä¸ªé¡µé‡Œï¼ŒåŠ ä¹‹è®¡ç®—æœºå­˜å‚¨åˆ†é…éƒ½æ˜¯æŒ‰é¡µå¯¹é½çš„ï¼Œè¿™æ ·å°±å®ç°äº†æ¯ä¸ªNodeèŠ‚ç‚¹åªéœ€è¦ä¸€æ¬¡I/Oæ“ä½œã€‚\nä¸€èˆ¬æ¥è¯´B+Treeæ¯”BTreeæ›´é€‚åˆå®ç°å¤–å­˜çš„ç´¢å¼•ç»“æ„ï¼Œå› ä¸ºå­˜å‚¨å¼•æ“çš„è®¾è®¡ä¸“å®¶å·§å¦™çš„åˆ©ç”¨äº†å¤–å­˜ï¼ˆç£ç›˜ï¼‰çš„å­˜å‚¨ç»“æ„ï¼Œå³ç£ç›˜çš„æœ€å°å­˜å‚¨å•ä½æ˜¯æ‰‡åŒºï¼ˆsectorï¼‰ï¼Œè€Œæ“ä½œç³»ç»Ÿçš„å—ï¼ˆblockï¼‰é€šå¸¸æ˜¯æ•´æ•°å€çš„sectorï¼Œæ“ä½œç³»ç»Ÿä»¥é¡µï¼ˆpageï¼‰ä¸ºå•ä½ç®¡ç†å†…å­˜ï¼Œä¸€é¡µï¼ˆpageï¼‰é€šå¸¸é»˜è®¤ä¸º4Kï¼Œæ•°æ®åº“çš„é¡µé€šå¸¸è®¾ç½®ä¸ºæ“ä½œç³»ç»Ÿé¡µçš„æ•´æ•°å€16Kï¼Œå› æ­¤ç´¢å¼•ç»“æ„çš„èŠ‚ç‚¹è¢«è®¾è®¡ä¸ºä¸€ä¸ªé¡µçš„å¤§å°ï¼Œç„¶ååˆ©ç”¨å¤–å­˜çš„â€œé¢„è¯»å–â€åŸåˆ™ï¼Œæ¯æ¬¡è¯»å–çš„æ—¶å€™ï¼ŒæŠŠæ•´ä¸ªèŠ‚ç‚¹çš„æ•°æ®è¯»å–åˆ°å†…å­˜ä¸­ï¼Œç„¶ååœ¨å†…å­˜ä¸­æŸ¥æ‰¾ï¼Œå·²çŸ¥å†…å­˜çš„è¯»å–é€Ÿåº¦æ˜¯å¤–å­˜è¯»å–I/Oé€Ÿåº¦çš„å‡ ç™¾å€ï¼Œé‚£ä¹ˆæå‡æŸ¥æ‰¾é€Ÿåº¦çš„å…³é”®å°±åœ¨äºå°½å¯èƒ½å°‘çš„ç£ç›˜I/Oï¼Œé‚£ä¹ˆå¯ä»¥çŸ¥é“ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸­çš„keyä¸ªæ•°è¶Šå¤šï¼Œé‚£ä¹ˆæ ‘çš„é«˜åº¦è¶Šå°ï¼Œéœ€è¦I/Oçš„æ¬¡æ•°è¶Šå°‘ï¼Œå› æ­¤ä¸€èˆ¬æ¥è¯´B+Treeæ¯”BTreeæ›´å¿«ï¼Œå› ä¸ºB+Treeçš„éå¶èŠ‚ç‚¹ä¸­ä¸å­˜å‚¨dataï¼Œå°±å¯ä»¥å­˜å‚¨æ›´å¤šçš„keyã€‚\nBæ ‘å’ŒB+æ ‘çš„åŒºåˆ«ï¼Œæ•°æ®åº“ä¸ºä»€ä¹ˆä½¿ç”¨B+æ ‘è€Œä¸æ˜¯Bæ ‘ï¼Ÿ åœ¨Bæ ‘ä¸­ï¼Œé”®å’Œå€¼å³å­˜æ”¾åœ¨å†…éƒ¨èŠ‚ç‚¹åˆå­˜æ”¾åœ¨å¶å­èŠ‚ç‚¹ï¼›åœ¨B+æ ‘ä¸­ï¼Œå†…éƒ¨èŠ‚ç‚¹åªå­˜é”®ï¼Œå¶å­èŠ‚ç‚¹åˆ™åŒæ—¶å­˜æ”¾é”®å’Œå€¼ã€‚ B+æ ‘çš„å¶å­èŠ‚ç‚¹æœ‰ä¸€æ¡é“¾ç›¸è¿ï¼Œè€ŒBæ ‘çš„å¶å­èŠ‚ç‚¹å„è‡ªç‹¬ç«‹çš„ã€‚ B+æ ‘ç´¢å¼•çš„æ‰€æœ‰æ•°æ®å‡å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ï¼Œè€Œä¸”æ•°æ®æ˜¯æŒ‰ç…§é¡ºåºæ’åˆ—çš„ï¼Œé“¾è¡¨è¿ç€çš„ã€‚é‚£ä¹ˆB+æ ‘ä½¿å¾—èŒƒå›´æŸ¥æ‰¾ï¼Œæ’åºæŸ¥æ‰¾ï¼Œåˆ†ç»„æŸ¥æ‰¾ä»¥åŠå»é‡æŸ¥æ‰¾å˜å¾—å¼‚å¸¸ç®€å•ã€‚ B+æ ‘éå¶å­èŠ‚ç‚¹ä¸Šæ˜¯ä¸å­˜å‚¨æ•°æ®çš„ï¼Œä»…å­˜å‚¨é”®å€¼ï¼Œè€ŒBæ ‘èŠ‚ç‚¹ä¸­ä¸ä»…å­˜å‚¨é”®å€¼ï¼Œä¹Ÿä¼šå­˜å‚¨æ•°æ®ã€‚innodbä¸­é¡µçš„é»˜è®¤å¤§å°æ˜¯16KBï¼Œå¦‚æœä¸å­˜å‚¨æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¼šå­˜å‚¨æ›´å¤šçš„é”®å€¼ï¼Œç›¸åº”çš„æ ‘çš„é˜¶æ•°ï¼ˆèŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ ‘ï¼‰å°±ä¼šæ›´å¤§ï¼Œæ ‘å°±ä¼šæ›´çŸ®æ›´èƒ–ï¼Œå¦‚æ­¤ä¸€æ¥æˆ‘ä»¬æŸ¥æ‰¾æ•°æ®è¿›è¡Œç£ç›˜çš„IOæ¬¡æ•°æœ‰ä¼šå†æ¬¡å‡å°‘ï¼Œæ•°æ®æŸ¥è¯¢çš„æ•ˆç‡ä¹Ÿä¼šæ›´å¿«. å› ä¸ºBæ ‘ä¸ç®¡å¶å­èŠ‚ç‚¹è¿˜æ˜¯éå¶å­èŠ‚ç‚¹ï¼Œéƒ½ä¼šä¿å­˜æ•°æ®ï¼Œè¿™æ ·å¯¼è‡´åœ¨éå¶å­èŠ‚ç‚¹ä¸­èƒ½ä¿å­˜çš„æŒ‡é’ˆæ•°é‡å˜å°‘ï¼ˆæœ‰äº›èµ„æ–™ä¹Ÿç§°ä¸ºæ‰‡å‡ºï¼‰ï¼ŒæŒ‡é’ˆå°‘çš„æƒ…å†µä¸‹è¦ä¿å­˜å¤§é‡æ•°æ®ï¼Œåªèƒ½å¢åŠ æ ‘çš„é«˜åº¦ï¼Œå¯¼è‡´IOæ“ä½œå˜å¤šï¼ŒæŸ¥è¯¢æ€§èƒ½å˜ä½ï¼›B æ ‘è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œä¼šäº§ç”Ÿå¤§é‡éšæœºIO åœ¨B+æ ‘ä¸­å¶å­èŠ‚ç‚¹å­˜æ”¾æ•°æ®ï¼Œéå¶å­èŠ‚ç‚¹å­˜æ”¾é”®å€¼+æŒ‡é’ˆã€‚ å“ˆå¸Œç´¢å¼• å“ˆå¸Œç´¢å¼•åŸºæœ¬æ•£åˆ—è¡¨å®ç°ï¼Œæ•£åˆ—è¡¨ï¼ˆä¹Ÿç§°å“ˆå¸Œè¡¨ï¼‰æ˜¯æ ¹æ®å…³é”®ç å€¼(Key value)è€Œç›´æ¥è¿›è¡Œè®¿é—®çš„æ•°æ®ç»“æ„ï¼Œå®ƒè®©ç å€¼ç»è¿‡å“ˆå¸Œå‡½æ•°çš„è½¬æ¢æ˜ å°„åˆ°æ•£åˆ—è¡¨å¯¹åº”çš„ä½ç½®ä¸Šï¼ŒæŸ¥æ‰¾æ•ˆç‡éå¸¸é«˜ã€‚å‡è®¾æˆ‘ä»¬å¯¹åå­—å»ºç«‹äº†å“ˆå¸Œç´¢å¼•ï¼Œåˆ™æŸ¥æ‰¾è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nå¯¹äºæ¯ä¸€è¡Œæ•°æ®ï¼Œå­˜å‚¨å¼•æ“éƒ½ä¼šå¯¹æ‰€æœ‰çš„ç´¢å¼•åˆ—ï¼ˆä¸Šå›¾ä¸­çš„ name åˆ—ï¼‰è®¡ç®—ä¸€ä¸ªå“ˆå¸Œç ï¼ˆä¸Šå›¾æ•£åˆ—è¡¨çš„ä½ç½®ï¼‰ï¼Œæ•£åˆ—è¡¨é‡Œçš„æ¯ä¸ªå…ƒç´ æŒ‡å‘æ•°æ®è¡Œçš„æŒ‡é’ˆï¼Œç”±äºç´¢å¼•è‡ªèº«åªå­˜å‚¨å¯¹åº”çš„å“ˆå¸Œå€¼ï¼Œæ‰€ä»¥ç´¢å¼•çš„ç»“æ„ååˆ†ç´§å‡‘ï¼Œè¿™è®©å“ˆå¸Œç´¢å¼•æŸ¥æ‰¾é€Ÿåº¦éå¸¸å¿«ï¼\nå½“ç„¶äº†å“ˆå¸Œè¡¨çš„åŠ£åŠ¿ä¹Ÿæ˜¯æ¯”è¾ƒæ˜æ˜¾çš„ï¼Œä¸æ”¯æŒåŒºé—´æŸ¥æ‰¾ï¼Œä¸æ”¯æŒæ’åºï¼Œæ‰€ä»¥æ›´å¤šçš„æ—¶å€™å“ˆå¸Œè¡¨æ˜¯ä¸ B Treeç­‰ä¸€èµ·ä½¿ç”¨çš„ï¼Œåœ¨ InnoDB å¼•æ“ä¸­å°±æœ‰ä¸€ç§åä¸ºã€Œè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ã€çš„ç‰¹æ®Šç´¢å¼•ï¼Œå½“ innoDB æ³¨æ„åˆ°æŸäº›ç´¢å¼•å€¼ä½¿ç”¨éå¸¸é¢‘ç¹æ—¶ï¼Œå°±ä¼šå†…å­˜ä¸­åŸºäº B-Tree ç´¢å¼•ä¹‹ä¸Šå†åˆ›å»ºå“ˆå¸Œç´¢å¼•ï¼Œè¿™æ ·ä¹Ÿå°±è®© B+ æ ‘ç´¢å¼•ä¹Ÿæœ‰äº†å“ˆå¸Œç´¢å¼•çš„å¿«é€ŸæŸ¥æ‰¾ç­‰ä¼˜ç‚¹ï¼Œè¿™æ˜¯å®Œå…¨è‡ªåŠ¨ï¼Œå†…éƒ¨çš„è¡Œä¸ºï¼Œç”¨æˆ·æ— æ³•æ§åˆ¶æˆ–é…ç½®ï¼Œä¸è¿‡å¦‚æœæœ‰å¿…è¦ï¼Œå¯ä»¥å…³é—­è¯¥åŠŸèƒ½ã€‚\ninnoDB å¼•æ“æœ¬èº«æ˜¯ä¸æ”¯æŒæ˜¾å¼åˆ›å»ºå“ˆå¸Œç´¢å¼•çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ B+ æ ‘çš„åŸºç¡€ä¸Šåˆ›å»ºä¸€ä¸ªä¼ªå“ˆå¸Œç´¢å¼•ï¼Œå®ƒä¸çœŸæ­£çš„å“ˆå¸Œç´¢å¼•ä¸æ˜¯ä¸€å›äº‹ï¼Œå®ƒæ˜¯ä»¥å“ˆå¸Œå€¼è€Œéé”®æœ¬èº«æ¥è¿›è¡Œç´¢å¼•æŸ¥æ‰¾çš„ï¼Œè¿™ç§ä¼ªå“ˆå¸Œç´¢å¼•çš„ä½¿ç”¨åœºæ™¯æ˜¯æ€æ ·çš„å‘¢ï¼Œå‡è®¾æˆ‘ä»¬åœ¨ db æŸå¼ è¡¨ä¸­æœ‰ä¸ª url å­—æ®µï¼Œæˆ‘ä»¬çŸ¥é“æ¯ä¸ª url çš„é•¿åº¦éƒ½å¾ˆé•¿ï¼Œå¦‚æœä»¥ url è¿™ä¸ªå­—æ®µåˆ›å»ºç´¢å¼•ï¼Œæ— ç–‘è¦å ç”¨å¾ˆå¤§çš„å­˜å‚¨ç©ºé—´ï¼Œå¦‚æœèƒ½é€šè¿‡å“ˆå¸Œï¼ˆæ¯”å¦‚CRC32ï¼‰æŠŠæ­¤ url æ˜ å°„æˆ 4 ä¸ªå­—èŠ‚ï¼Œå†ä»¥æ­¤å“ˆå¸Œå€¼ä½œç´¢å¼• ï¼Œç´¢å¼•å ç”¨æ— ç–‘å¤§å¤§ç¼©çŸ­ï¼ä¸è¿‡åœ¨æŸ¥è¯¢çš„æ—¶å€™è¦è®°å¾—åŒæ—¶å¸¦ä¸Š url å’Œ url_crc,ä¸»è¦æ˜¯ä¸ºäº†é¿å…å“ˆå¸Œå†²çªï¼Œå¯¼è‡´ url_crc çš„å€¼å¯èƒ½ä¸€æ ·\n1 SELECT id FROM url WHERE url = \u0026#34;http://www.baidu.com\u0026#34; AND url_crc = CRC32(\u0026#34;http://www.baidu.com\u0026#34;) è¿™æ ·åšæŠŠåŸºäº url çš„å­—ç¬¦ä¸²ç´¢å¼•æ”¹æˆäº†åŸºäº url_crc çš„æ•´å‹ç´¢å¼•ï¼Œæ•ˆç‡æ›´é«˜ï¼ŒåŒæ—¶ç´¢å¼•å ç”¨çš„ç©ºé—´ä¹Ÿå¤§å¤§å‡å°‘ï¼Œä¸€ä¸¾ä¸¤å¾—ï¼Œå½“ç„¶äººå¯èƒ½ä¼šè¯´éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ç´¢å¼•å¤ªéº»çƒ¦äº†ï¼Œé‚£å¯ä»¥æ”¹è¿›è§¦å‘å™¨å®ç°ã€‚\né™¤äº†ä¸Šæ–‡è¯´çš„ä¸¤ä¸ªç´¢å¼• ï¼Œè¿˜æœ‰ç©ºé—´ç´¢å¼•ï¼ˆR-Treeï¼‰ï¼Œå…¨æ–‡ç´¢å¼•ç­‰ï¼Œç”±ç”Ÿäº§ä¸­ä¸æ˜¯å¾ˆå¸¸ç”¨ï¼Œè¿™é‡Œä¸ä½œè¿‡å¤šé˜è¿°\né«˜æ€§èƒ½ç´¢å¼•ç­–ç•¥ ä¸åŒçš„ç´¢å¼•è®¾è®¡é€‰æ‹©èƒ½å¯¹æ€§èƒ½äº§ç”Ÿå¾ˆå¤§çš„å½±å“ï¼Œæœ‰äººå¯èƒ½ä¼šå‘ç°ç”Ÿäº§ä¸­æ˜æ˜åŠ äº†ç´¢å¼•å´ä¸ç”Ÿæ•ˆï¼Œæœ‰æ—¶å€™åŠ äº†è™½ç„¶ç”Ÿæ•ˆä½†å¯¹æœç´¢æ€§èƒ½å¹¶æ²¡æœ‰æå‡å¤šå°‘ï¼Œå¯¹äºå¤šåˆ—è”åˆç´¢å¼•ï¼Œå“ªåˆ—åœ¨å‰ï¼Œå“ªåˆ—åœ¨åä¹Ÿæ˜¯æœ‰è®²ç©¶çš„ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹\nåŠ äº†ç´¢å¼•ï¼Œä¸ºä½•å´ä¸ç”Ÿæ•ˆ åŠ äº†ç´¢å¼•å´ä¸ç”Ÿæ•ˆå¯èƒ½ä¼šæœ‰ä»¥ä¸‹å‡ ç§åŸå› \n1ã€ç´¢å¼•åˆ—æ˜¯è¡¨ç¤ºå¼çš„ä¸€éƒ¨åˆ†ï¼Œæˆ–æ˜¯å‡½æ•°çš„ä¸€éƒ¨åˆ† 1 SELECT book_id FROM BOOK WHERE book_id + 1 = 5; æˆ–è€…\n1 SELECT book_id FROM BOOK WHERE TO_DAYS(CURRENT_DATE) - TO_DAYS(gmt_create) \u0026lt;= 10 ä¸Šè¿°ä¸¤ä¸ª SQL è™½ç„¶åœ¨åˆ— book_id å’Œ gmt_create è®¾ç½®äº†ç´¢å¼• ï¼Œä½†ç”±äºå®ƒä»¬æ˜¯è¡¨è¾¾å¼æˆ–å‡½æ•°çš„ä¸€éƒ¨åˆ†ï¼Œå¯¼è‡´ç´¢å¼•æ— æ³•ç”Ÿæ•ˆï¼Œæœ€ç»ˆå¯¼è‡´å…¨è¡¨æ‰«æã€‚\n2ã€éšå¼ç±»å‹è½¬æ¢ ä»¥ä¸Šä¸¤ç§æƒ…å†µç›¸ä¿¡ä¸å°‘äººéƒ½çŸ¥é“ç´¢å¼•ä¸èƒ½ç”Ÿæ•ˆï¼Œä½†ä¸‹é¢è¿™ç§éšå¼ç±»å‹è½¬æ¢ä¼°è®¡ä¼šè®©ä¸å°‘äººæ ½è·Ÿå¤´ï¼Œæ¥çœ‹ä¸‹ä¸‹é¢è¿™ä¸ªä¾‹å­:\nå‡è®¾æœ‰ä»¥ä¸‹è¡¨:\n1 2 3 4 5 6 7 8 9 CREATE TABLE `tradelog` ( `id` int(11) NOT NULL, `tradeid` varchar(32) DEFAULT NULL, `operator` int(11) DEFAULT NULL, `t_modified` datetime DEFAULT NULL, PRIMARY KEY (`id`), KEY `tradeid` (`tradeid`), KEY `t_modified` (`t_modified`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; æ‰§è¡Œ SQL è¯­å¥\n1 SELECT * FROM tradelog WHERE tradeid=110717; äº¤æ˜“ç¼–å· tradeid ä¸Šæœ‰ç´¢å¼•ï¼Œä½†ç”¨ EXPLAIN æ‰§è¡Œå´å‘ç°ä½¿ç”¨äº†å…¨è¡¨æ‰«æï¼Œä¸ºå•¥å‘¢ï¼ŒtradeId çš„ç±»å‹æ˜¯ varchar(32), è€Œæ­¤ SQL ç”¨ tradeid ä¸€ä¸ªæ•°å­—ç±»å‹è¿›è¡Œæ¯”è¾ƒï¼Œå‘ç”Ÿäº†éšå½¢è½¬æ¢ï¼Œä¼šéšå¼åœ°å°†å­—ç¬¦ä¸²è½¬æˆæ•´å‹ï¼Œå¦‚ä¸‹:\n1 SELECT * FROM tradelog WHERE CAST(tradid AS signed int) = 110717; è¿™æ ·ä¹Ÿå°±è§¦å‘äº†ä¸Šæ–‡ä¸­ç¬¬ä¸€æ¡çš„è§„åˆ™ ï¼Œå³ï¼šç´¢å¼•åˆ—ä¸èƒ½æ˜¯å‡½æ•°çš„ä¸€éƒ¨åˆ†ã€‚\n3ã€éšå¼ç¼–ç è½¬æ¢ è¿™ç§æƒ…å†µéå¸¸éšè”½ï¼Œæ¥çœ‹ä¸‹è¿™ä¸ªä¾‹å­\n1 2 3 4 5 6 7 CREATE TABLE `trade_detail` ( `id` int(11) NOT NULL, `tradeid` varchar(32) DEFAULT NULL, `trade_step` int(11) DEFAULT NULL, /*æ“ä½œæ­¥éª¤*/ `step_info` varchar(32) DEFAULT NULL, /*æ­¥éª¤ä¿¡æ¯*/ PRIMARY KEY (`id`), KEY `tradeid` (`tradeid`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; trade_detail æ˜¯äº¤æ˜“è¯¦æƒ…ï¼Œ tradelog æ˜¯æ“ä½œæ­¤äº¤æ˜“è¯¦æƒ…çš„è®°å½•ï¼Œç°åœ¨è¦æŸ¥è¯¢ id=2 çš„äº¤æ˜“çš„æ‰€æœ‰æ“ä½œæ­¥éª¤ä¿¡æ¯ï¼Œåˆ™æˆ‘ä»¬ä¼šé‡‡ç”¨å¦‚ä¸‹æ–¹å¼\n1 SELECT d.* FROM tradelog l, trade_detail d WHERE d.tradeid=l.tradeid AND l.id=2; ç”±äº tradelog ä¸ trade_detail è¿™ä¸¤ä¸ªè¡¨çš„å­—ç¬¦é›†ä¸åŒï¼Œä¸” tradelog çš„å­—ç¬¦é›†æ˜¯ utf8mb4ï¼Œè€Œ trade_detail å­—ç¬¦é›†æ˜¯ utf8, utf8mb4 æ˜¯ utf8 çš„è¶…é›†ï¼Œæ‰€ä»¥ä¼šè‡ªåŠ¨å°† utf8 è½¬æˆ utf8mb4ã€‚å³ä¸Šè¿°è¯­å¥ä¼šå‘ç”Ÿå¦‚ä¸‹è½¬æ¢:\n1 SELECT d.* FROM tradelog l, trade_detail d WHERE (CONVERT(d.traideid USING utf8mb4)))=l.tradeid AND l.id=2; è‡ªç„¶ä¹Ÿå°±è§¦å‘äº† ã€Œç´¢å¼•åˆ—ä¸èƒ½æ˜¯å‡½æ•°çš„ä¸€éƒ¨åˆ†ã€è¿™æ¡è§„åˆ™ã€‚æ€ä¹ˆè§£å†³å‘¢ï¼Œç¬¬ä¸€ç§æ–¹æ¡ˆå½“ç„¶æ˜¯æŠŠä¸¤ä¸ªè¡¨çš„å­—ç¬¦é›†æ”¹æˆä¸€æ ·ï¼Œå¦‚æœä¸šåŠ¡é‡æ¯”è¾ƒå¤§ï¼Œç”Ÿäº§ä¸Šä¸æ–¹ä¾¿æ”¹çš„è¯ï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ¡ˆæ˜¯æŠŠ utf8mb4 è½¬æˆ utf8ï¼Œå¦‚ä¸‹\n1 SELECT d.* FROM tradelog l , trade_detail d WHERE d.tradeid=CONVERT(l.tradeid USING utf8) AND l.id=2; è¿™æ ·ç´¢å¼•åˆ—å°±ç”Ÿæ•ˆäº†ã€‚\n4ã€ä½¿ç”¨ order by é€ æˆçš„å…¨è¡¨æ‰«æ 1 SELECT * FROM user ORDER BY age DESC ä¸Šè¿°è¯­å¥åœ¨ age ä¸ŠåŠ äº†ç´¢å¼•ï¼Œä½†ä¾ç„¶é€ æˆäº†å…¨è¡¨æ‰«æï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº† SELECT *,å¯¼è‡´å›è¡¨æŸ¥è¯¢ï¼ŒMySQL è®¤ä¸ºå›è¡¨çš„ä»£ä»·æ¯”å…¨è¡¨æ‰«ææ›´å¤§ï¼Œæ‰€ä»¥ä¸é€‰æ‹©ä½¿ç”¨ç´¢å¼•ï¼Œå¦‚æœæƒ³ä½¿ç”¨åˆ° age çš„ç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¦†ç›–ç´¢å¼•æ¥ä»£æ›¿:\n1 SELECT age FROM user ORDER BY age DESC æˆ–è€…åŠ ä¸Š limit çš„æ¡ä»¶ï¼ˆæ•°æ®æ¯”è¾ƒå°ï¼‰\n1 SELECT * FROM user ORDER BY age DESC limit 10 è¿™æ ·å°±èƒ½åˆ©ç”¨åˆ°ç´¢å¼•ã€‚\næ— æ³•é¿å…å¯¹ç´¢å¼•åˆ—ä½¿ç”¨å‡½æ•°ï¼Œæ€ä¹ˆä½¿ç”¨ç´¢å¼• æ—¶å€™æˆ‘ä»¬æ— æ³•é¿å…å¯¹ç´¢å¼•åˆ—ä½¿ç”¨å‡½æ•°ï¼Œä½†è¿™æ ·åšä¼šå¯¼è‡´å…¨è¡¨ç´¢å¼•ï¼Œæ˜¯å¦æœ‰æ›´å¥½çš„æ–¹å¼å‘¢ã€‚\næ¯”å¦‚æˆ‘ç°åœ¨å°±æ˜¯æƒ³è®°å½• 2016 ~ 2018 æ‰€æœ‰å¹´ä»½ 7æœˆä»½çš„äº¤æ˜“è®°å½•æ€»æ•°\n1 SELECT count(*) FROM tradelog WHERE month(t_modified)=7; ç”±äºç´¢å¼•åˆ—æ˜¯å‡½æ•°çš„å‚æ•°ï¼Œæ‰€ä»¥æ˜¾ç„¶æ— æ³•ç”¨åˆ°ç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒæ”¹é€ æˆåŸºæœ¬å­—æ®µåŒºé—´çš„æŸ¥æ‰¾å¦‚ä¸‹\n1 2 3 4 SELECT count(*) FROM tradelog WHERE -\u0026gt; (t_modified \u0026gt;= \u0026#39;2016-7-1\u0026#39; AND t_modified\u0026lt;\u0026#39;2016-8-1\u0026#39;) or -\u0026gt; (t_modified \u0026gt;= \u0026#39;2017-7-1\u0026#39; AND t_modified\u0026lt;\u0026#39;2017-8-1\u0026#39;) or -\u0026gt; (t_modified \u0026gt;= \u0026#39;2018-7-1\u0026#39; AND t_modified\u0026lt;\u0026#39;2018-8-1\u0026#39;); å‰ç¼€ç´¢å¼•ä¸ç´¢å¼•é€‰æ‹©æ€§ ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œå¦‚äºé•¿å­—ç¬¦ä¸²çš„å­—æ®µï¼ˆå¦‚ urlï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¼ªå“ˆå¸Œç´¢å¼•çš„å½¢å¼æ¥åˆ›å»ºç´¢å¼•ï¼Œä»¥é¿å…ç´¢å¼•å˜å¾—æ—¢å¤§åˆæ…¢ï¼Œé™¤æ­¤ä¹‹å¤–å…¶å®è¿˜å¯ä»¥ç”¨å‰ç¼€ç´¢å¼•ï¼ˆå­—ç¬¦ä¸²çš„éƒ¨åˆ†å­—ç¬¦ï¼‰çš„å½¢å¼æ¥è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªå‰ç¼€ç´¢å¼•åº”è¯¥å¦‚ä½•é€‰å–å‘¢ï¼Œè¿™å«æ¶‰åŠåˆ°ä¸€ä¸ªå«ç´¢å¼•é€‰æ‹©æ€§çš„æ¦‚å¿µ\nç´¢å¼•é€‰æ‹©æ€§ï¼šä¸é‡å¤çš„ç´¢å¼•å€¼ï¼ˆä¹Ÿç§°ä¸ºåŸºæ•°ï¼Œcardinalityï¼‰å’Œæ•°æ®è¡¨çš„è®°å½•æ€»æ•°çš„æ¯”å€¼ï¼Œæ¯”å€¼è¶Šé«˜ï¼Œä»£è¡¨ç´¢å¼•çš„é€‰æ‹©æ€§è¶Šå¥½ï¼Œå”¯ä¸€ç´¢å¼•çš„é€‰æ‹©æ€§æ˜¯æœ€å¥½çš„ï¼Œæ¯”å€¼æ˜¯ 1ã€‚\nç”»å¤–éŸ³ï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡ SHOW INDEXES FROM table æ¥æŸ¥çœ‹æ¯ä¸ªç´¢å¼• cardinality çš„å€¼ä»¥è¯„ä¼°ç´¢å¼•è®¾è®¡çš„åˆç†æ€§\næ€ä¹ˆé€‰æ‹©è¿™ä¸ªæ¯”ä¾‹å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†åˆ«å–å‰ 3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7 çš„å‰ç¼€ç´¢å¼•ï¼Œç„¶åå†æ¯”è¾ƒä¸‹é€‰æ‹©è¿™å‡ ä¸ªå‰ç¼€ç´¢å¼•çš„é€‰æ‹©æ€§ï¼Œæ‰§è¡Œä»¥ä¸‹è¯­å¥\n1 2 3 4 5 6 7 SELECT COUNT(DISTINCT LEFT(city,3))/COUNT(*) as sel3, COUNT(DISTINCT LEFT(city,4))/COUNT(*) as sel4, COUNT(DISTINCT LEFT(city,5))/COUNT(*) as sel5, COUNT(DISTINCT LEFT(city,6))/COUNT(*) as sel6, COUNT(DISTINCT LEFT(city,7))/COUNT(*) as sel7 FROM city_demo å¾—ç»“æœå¦‚ä¸‹\nsel3 sel4 sel5 sel6 sel7 0.0239 0.0293 0.0305 0.0309 0.0310 å¯ä»¥çœ‹åˆ°å½“å‰ç¼€é•¿åº¦ä¸º 7 æ—¶ï¼Œç´¢å¼•é€‰æ‹©æ€§æå‡çš„æ¯”ä¾‹å·²ç»å¾ˆå°äº†ï¼Œä¹Ÿå°±æ˜¯è¯´åº”è¯¥é€‰æ‹© city çš„å‰å…­ä¸ªå­—ç¬¦ä½œä¸ºå‰ç¼€ç´¢å¼•ï¼Œå¦‚ä¸‹\n1 ALTER TABLE city_demo ADD KEY(city(6)) æˆ‘ä»¬å½“å‰æ˜¯ä»¥å¹³å‡é€‰æ‹©æ€§ä¸ºæŒ‡æ ‡çš„ï¼Œæœ‰æ—¶å€™è¿™æ ·æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜å¾—è€ƒè™‘æœ€åæƒ…å†µä¸‹çš„é€‰æ‹©æ€§ï¼Œä»¥è¿™ä¸ª demo ä¸ºä¾‹ï¼Œå¯èƒ½ä¸€äº›äººçœ‹åˆ°é€‰æ‹© 4ï¼Œ5 çš„å‰ç¼€ç´¢å¼•ä¸é€‰æ‹© 6ï¼Œ7 çš„é€‰æ‹©æ€§ç›¸å·®ä¸å¤§ï¼Œé‚£å°±å¾—çœ‹ä¸‹é€‰æ‹© 4ï¼Œ5 çš„å‰ç¼€ç´¢å¼•åˆ†å¸ƒæ˜¯å¦å‡åŒ€äº†\n1 2 3 4 SELECT COUNT(*) AS cnt, LEFT(city, 4) AS pref FROM city_demo GROUP BY pref ORDER BY cnt DESC LIMIT 5 å¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹ç»“æœ\ncnt pref 305 Sant 200 Toul 90 Chic 20 Chan å¯ä»¥çœ‹åˆ°åˆ†å¸ƒæä¸å‡åŒ€ï¼Œä»¥ Santï¼ŒToul ä¸ºå‰ç¼€ç´¢å¼•çš„æ•°é‡æå¤šï¼Œè¿™ä¸¤è€…çš„é€‰æ‹©æ€§éƒ½ä¸æ˜¯å¾ˆç†æƒ³ï¼Œæ‰€ä»¥è¦é€‰æ‹©å‰ç¼€ç´¢å¼•æ—¶ä¹Ÿè¦è€ƒè™‘æœ€å·®çš„é€‰æ‹©æ€§çš„æƒ…å†µã€‚\nå‰ç¼€ç´¢å¼•è™½ç„¶èƒ½å®ç°ç´¢å¼•å ç”¨ç©ºé—´å°ä¸”å¿«çš„æ•ˆæœï¼Œä½†å®ƒä¹Ÿæœ‰æ˜æ˜¾çš„å¼±ç‚¹ï¼ŒMySQL æ— æ³•ä½¿ç”¨å‰ç¼€ç´¢å¼•åš ORDER BY å’Œ GROUP BY ï¼Œè€Œä¸”ä¹Ÿæ— æ³•ä½¿ç”¨å‰ç¼€ç´¢å¼•åšè¦†ç›–æ‰«æï¼Œå‰ç¼€ç´¢å¼•ä¹Ÿæœ‰å¯èƒ½å¢åŠ æ‰«æè¡Œæ•°ã€‚\nå‡è®¾æœ‰ä»¥ä¸‹è¡¨æ•°æ®åŠè¦æ‰§è¡Œçš„ SQL\nd email 1 zhangssxyz@163.com 2 zhangs1@163.com 3 zhangs1@163.com 4 zhangs1@163.com 1 SELECT id,email FROM user WHERE email=\u0026#39;zhangssxyz@xxx.com\u0026#39;; å¦‚æœæˆ‘ä»¬é’ˆå¯¹ email è®¾ç½®çš„æ˜¯æ•´ä¸ªå­—æ®µçš„ç´¢å¼•ï¼Œåˆ™ä¸Šè¡¨ä¸­æ ¹æ® ã€Œzhangssxyz@163.comã€æŸ¥è¯¢åˆ°ç›¸å…³è®°è®°å½•å,å†æŸ¥è¯¢æ­¤è®°å½•çš„ä¸‹ä¸€æ¡è®°å½•ï¼Œå‘ç°æ²¡æœ‰ï¼Œåœæ­¢æ‰«æã€‚æ­¤æ—¶å¯çŸ¥åªæ‰«æä¸€è¡Œè®°å½•ï¼Œå¦‚æœæˆ‘ä»¬ä»¥å‰å…­ä¸ªå­—ç¬¦ï¼ˆå³ email(6)ï¼‰ä½œä¸ºå‰ç¼€ç´¢å¼•ï¼Œåˆ™æ˜¾ç„¶è¦æ‰«æå››è¡Œè®°å½•ï¼Œå¹¶ä¸”è·å¾—è¡Œè®°å½•åä¸å¾—ä¸å›åˆ°ä¸»é”®ç´¢å¼•å†åˆ¤æ–­ email å­—æ®µçš„å€¼ï¼Œæ‰€ä»¥ä½¿ç”¨å‰ç¼€ç´¢å¼•è¦è¯„ä¼°å®ƒå¸¦æ¥çš„è¿™äº›å¼€é”€ã€‚\nå¦å¤–æœ‰ä¸€ç§æƒ…å†µæˆ‘ä»¬å¯èƒ½éœ€è¦è€ƒè™‘ä¸€ä¸‹ï¼Œå¦‚æœå‰ç¼€åŸºæœ¬éƒ½æ˜¯ç›¸åŒçš„è¯¥æ€ä¹ˆåŠï¼Œæ¯”å¦‚ç°åœ¨æˆ‘ä»¬ä¸ºæŸå¸‚çš„å¸‚æ°‘å»ºç«‹ä¸€ä¸ªäººå£ä¿¡æ¯è¡¨ï¼Œåˆ™è¿™ä¸ªå¸‚äººå£çš„èº«ä»½è¯è™½ç„¶ä¸åŒï¼Œä½†èº«ä»½è¯å‰é¢çš„å‡ ä½æ•°éƒ½æ˜¯ç›¸åŒçš„ï¼Œè¿™ç§æƒ…å†µè¯¥æ€ä¹ˆå»ºç«‹å‰ç¼€ç´¢å¼•å‘¢ã€‚\nä¸€ç§æ–¹å¼å°±æ˜¯æˆ‘ä»¬ä¸Šæ–‡è¯´çš„ï¼Œé’ˆå¯¹èº«ä»½è¯å»ºç«‹å“ˆå¸Œç´¢å¼•ï¼Œå¦ä¸€ç§æ–¹å¼æ¯”è¾ƒå·§å¦™ï¼Œå°†èº«ä»½è¯å€’åºå­˜å‚¨ï¼ŒæŸ¥çš„æ—¶å€™å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼æŸ¥è¯¢:\n1 SELECT field_list FROM t WHERE id_card = reverse(\u0026#39;input_id_card_string\u0026#39;); è¿™æ ·å°±å¯ä»¥ç”¨èº«ä»½è¯çš„åå…­ä½ä½œå‰ç¼€ç´¢å¼•äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆå·§å¦™ ^_^\nå®é™…ä¸Šä¸Šæ–‡æ‰€è¿°çš„ç´¢å¼•é€‰æ‹©æ€§åŒæ ·é€‚ç”¨äºè”åˆç´¢å¼•çš„è®¾è®¡ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šæƒ…å†µï¼Œæˆ‘ä»¬ä¸€èˆ¬å»ºè®®åœ¨å»ºç«‹è”åˆç´¢å¼•æ—¶ï¼ŒæŠŠé€‰æ‹©æ€§æœ€é«˜çš„åˆ—æ”¾åœ¨æœ€å‰é¢ï¼Œæ¯”å¦‚ï¼Œå¯¹äºä»¥ä¸‹è¯­å¥ï¼š\n1 SELECT * FROM payment WHERE staff_id = xxx AND customer_id = xxx; å•å°±è¿™ä¸ªè¯­å¥è€Œè¨€ï¼Œ (staff_idï¼Œcustomer_id) å’Œ (customer_id, staff_id) è¿™ä¸¤ä¸ªè”åˆç´¢å¼•æˆ‘ä»¬åº”è¯¥å»ºå“ªä¸€ä¸ªå‘¢ï¼Œå¯ä»¥ç»Ÿè®¡ä¸‹è¿™ä¸¤è€…çš„é€‰æ‹©æ€§ã€‚\n1 2 3 4 5 SELECT COUNT(DISTINCT staff_id)/COUNT(*) as staff_id_selectivity, COUNT(DISTINCT customer_id)/COUNT(*) as customer_id_selectivity, COUNT(*) FROM payment ç»“æœä¸º:\n1 2 3 staff_id_selectivity: 0.0001 customer_id_selectivity: 0.0373 COUNT(*): 16049 ä»ä¸­å¯ä»¥çœ‹å‡º customer_id çš„é€‰æ‹©æ€§æ›´é«˜ï¼Œæ‰€ä»¥åº”è¯¥é€‰æ‹© customer_id ä½œä¸ºç¬¬ä¸€åˆ—ã€‚\nç´¢å¼•è®¾è®¡å‡†åˆ™ï¼šä¸‰æ˜Ÿç´¢å¼• ä¸Šæ–‡æˆ‘ä»¬å¾—å‡ºäº†ä¸€ä¸ªç´¢å¼•åˆ—é¡ºåºçš„ç»éªŒ æ³•åˆ™ï¼šå°†é€‰æ‹©æ€§æœ€é«˜çš„åˆ—æ”¾åœ¨ç´¢å¼•çš„æœ€å‰åˆ—ï¼Œè¿™ç§å»ºç«‹åœ¨æŸäº›åœºæ™¯å¯èƒ½æœ‰ç”¨ï¼Œä½†é€šå¸¸ä¸å¦‚é¿å…éšæœº IO å’Œ æ’åºé‚£ä¹ˆé‡è¦ï¼Œè¿™é‡Œå¼•å…¥ç´¢å¼•è®¾è®¡ä¸­éå¸¸è‘—åçš„ä¸€ä¸ªå‡†åˆ™ï¼šä¸‰æ˜Ÿç´¢å¼•ã€‚\nå¦‚æœä¸€ä¸ªæŸ¥è¯¢æ»¡è¶³ä¸‰æ˜Ÿç´¢å¼•ä¸­ä¸‰é¢—æ˜Ÿçš„æ‰€æœ‰ç´¢å¼•æ¡ä»¶ï¼Œç†è®ºä¸Šå¯ä»¥è®¤ä¸ºæˆ‘ä»¬è®¾è®¡çš„ç´¢å¼•æ˜¯æœ€å¥½çš„ç´¢å¼•ã€‚ä»€ä¹ˆæ˜¯ä¸‰æ˜Ÿç´¢å¼•\nç¬¬ä¸€é¢—æ˜Ÿï¼šWHERE åé¢å‚ä¸æŸ¥è¯¢çš„åˆ—å¯ä»¥ç»„æˆäº†å•åˆ—ç´¢å¼•æˆ–è”åˆç´¢å¼• ç¬¬äºŒé¢—æ˜Ÿï¼šé¿å…æ’åºï¼Œå³å¦‚æœ SQL è¯­å¥ä¸­å‡ºç° order by colulmnï¼Œé‚£ä¹ˆå–å‡ºçš„ç»“æœé›†å°±å·²ç»æ˜¯æŒ‰ç…§ column æ’åºå¥½çš„ï¼Œä¸éœ€è¦å†ç”Ÿæˆä¸´æ—¶è¡¨ ç¬¬ä¸‰é¢—æ˜Ÿï¼šSELECT å¯¹åº”çš„åˆ—åº”è¯¥å°½é‡æ˜¯ç´¢å¼•åˆ—ï¼Œå³å°½é‡é¿å…å›è¡¨æŸ¥è¯¢ã€‚ æ‰€ä»¥å¯¹äºå¦‚ä¸‹è¯­å¥:\n1 SELECT age, name, city where age = xxx and name = xxx order by age è®¾è®¡çš„ç´¢å¼•åº”è¯¥æ˜¯ (age, name,city) æˆ–è€… (name, age,city)\nå½“ç„¶ äº†ä¸‰æ˜Ÿç´¢å¼•æ˜¯ä¸€ä¸ªæ¯”è¾ƒç†æƒ³åŒ–çš„æ ‡å‡†ï¼Œå®é™…æ“ä½œå¾€å¾€åªèƒ½æ»¡è¶³æœŸæœ›ä¸­çš„ä¸€é¢—æˆ–ä¸¤é¢—æ˜Ÿï¼Œè€ƒè™‘å¦‚ä¸‹è¯­å¥:\n1 SELECT age, name, city where age \u0026gt;= 10 AND age \u0026lt;= 20 and city = xxx order by name desc å‡è®¾æˆ‘ä»¬åˆ†åˆ«ä¸ºè¿™ä¸‰åˆ—å»ºäº†è”åˆç´¢å¼•ï¼Œåˆ™æ˜¾ç„¶å®ƒç¬¦åˆç¬¬ä¸‰é¢—æ˜Ÿï¼ˆä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼‰ï¼Œå¦‚æœç´¢å¼•æ˜¯ï¼ˆcity, age, name)ï¼Œåˆ™è™½ç„¶æ»¡è¶³äº†ç¬¬ä¸€é¢—æ˜Ÿï¼Œä½†æ’åºæ— æ³•ç”¨åˆ°ç´¢å¼•ï¼Œä¸æ»¡è¶³ç¬¬äºŒé¢—æ˜Ÿï¼Œå¦‚æœç´¢å¼•æ˜¯ (city, name, age)ï¼Œåˆ™ç¬¬äºŒé¢—æ˜Ÿæ»¡è¶³äº†ï¼Œä½†æ­¤æ—¶ age åœ¨ WHERE ä¸­çš„æœç´¢æ¡ä»¶åˆæ— æ³•æ»¡è¶³ç¬¬ä¸€æ˜Ÿï¼Œ\nå¦å¤–ç¬¬ä¸‰é¢—æ˜Ÿï¼ˆå°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼‰ä¹Ÿæ— æ³•å®Œå…¨æ»¡è¶³ï¼Œè¯•æƒ³æˆ‘è¦ SELECT å¤šåˆ—ï¼Œè¦æŠŠè¿™å¤šåˆ—éƒ½è®¾ç½®ä¸ºè”åˆç´¢å¼•å—ï¼Œè¿™å¯¹ç´¢å¼•çš„ç»´æŠ¤æ˜¯ä¸ªé—®é¢˜ï¼Œå› ä¸ºæ¯ä¸€æ¬¡è¡¨çš„ CURD éƒ½ä¼´éšç€ç´¢å¼•çš„æ›´æ–°ï¼Œå¾ˆå¯èƒ½é¢‘ç¹ä¼´éšç€é¡µåˆ†è£‚ä¸é¡µåˆå¹¶ã€‚\nç»¼ä¸Šæ‰€è¿°ï¼Œä¸‰æ˜Ÿç´¢å¼•åªæ˜¯ç»™æˆ‘ä»¬æ„å»ºç´¢å¼•æä¾›äº†ä¸€ä¸ªå‚è€ƒï¼Œç´¢å¼•è®¾è®¡åº”è¯¥å°½é‡é è¿‘ä¸‰æ˜Ÿç´¢å¼•çš„æ ‡å‡†ï¼Œä½†å®é™…åœºæ™¯æˆ‘ä»¬ä¸€èˆ¬æ— æ³•åŒæ—¶æ»¡è¶³ä¸‰æ˜Ÿç´¢å¼•ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šä¼˜å…ˆé€‰æ‹©æ»¡è¶³ç¬¬ä¸‰é¢—æ˜Ÿï¼ˆå› ä¸ºå›è¡¨ä»£ä»·è¾ƒå¤§ï¼‰è‡³äºç¬¬ä¸€ï¼ŒäºŒé¢—æ˜Ÿå°±è¦ä¾èµ–äºå®é™…çš„æˆæœ¬åŠå®é™…çš„ä¸šåŠ¡åœºæ™¯è€ƒè™‘ã€‚\nä¸ºä»€ä¹ˆè¦ä¸€å®šè¦è®¾ç½®ä¸»é”®? from: https://zhuanlan.zhihu.com/p/116866170\nå…¶å®è¿™ä¸ªä¸æ˜¯ä¸€å®šçš„ï¼Œæœ‰äº›åœºæ™¯ä¸‹ï¼Œå°ç³»ç»Ÿæˆ–è€…æ²¡ä»€ä¹ˆç”¨çš„è¡¨ï¼Œä¸è®¾ç½®ä¸»é”®ä¹Ÿæ²¡å…³ç³»ï¼Œmysqlæœ€å¥½æ˜¯ç”¨è‡ªå¢ä¸»é”®ï¼Œä¸»è¦æ˜¯ä»¥ä¸‹ä¸¤ä¸ªåŸå› ï¼šæœå®šä¹‰äº†ä¸»é”®ï¼Œé‚£ä¹ˆInnoDBä¼šé€‰æ‹©ä¸»é”®ä½œä¸ºèšé›†ç´¢å¼•ã€å¦‚æœæ²¡æœ‰æ˜¾å¼å®šä¹‰ä¸»é”®ï¼Œåˆ™innodb ä¼šé€‰æ‹©ç¬¬ä¸€ä¸ªä¸åŒ…å«æœ‰NULLå€¼çš„å”¯ä¸€ç´¢å¼•ä½œä¸ºä¸»é”®ç´¢å¼•ã€å¦‚æœä¹Ÿæ²¡æœ‰è¿™æ ·çš„å”¯ä¸€ç´¢å¼•ï¼Œåˆ™innodb ä¼šé€‰æ‹©å†…ç½®6å­—èŠ‚é•¿çš„ROWIDä½œä¸ºéšå«çš„èšé›†ç´¢å¼•ã€‚æ‰€ä»¥ï¼Œåæ­£éƒ½è¦ç”Ÿæˆä¸€ä¸ªä¸»é”®ï¼Œé‚£ä½ è¿˜ä¸å¦‚è‡ªå·±æŒ‡å®šä¸€ä¸ªä¸»é”®ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ï¼\nå‰é¢æˆ‘å†™äº†å‡ ç¯‡å…³äº mysql ç´¢å¼•çš„æ–‡ç« ï¼Œç´¢å¼•æ˜¯ mysql éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ã€‚ä½ ä¹Ÿå¯èƒ½ç»å¸¸ä¼šçœ‹åˆ°ä¸€äº›å…³äº mysql å†›è§„ã€mysql æŸ¥è¯¢ä¼˜åŒ–çš„æ–‡ç« ï¼Œå…¶å®è¿™äº›æ“ä½œçš„èƒŒåéƒ½æ˜¯åŸºäºä¸€å®šçš„åŸç†çš„ï¼Œä½ è¦æƒ³æ˜ç™½è¿™äº›åŸç†ï¼Œé¦–å…ˆå°±å¾—çŸ¥é“ mysql åº•å±‚çš„ä¸€äº›ä¸œè¥¿ã€‚\næˆ‘åœ¨è¿™é‡Œä¸¾å‡ ä¸ªä¾‹å­å§ã€‚\næˆ‘ä»¬éƒ½çŸ¥é“è¡¨çš„ä¸»é”®ä¸€èˆ¬éƒ½è¦ä½¿ç”¨è‡ªå¢ idï¼Œä¸å»ºè®®ä½¿ç”¨ä¸šåŠ¡ id ï¼Œæ˜¯å› ä¸ºä½¿ç”¨è‡ªå¢ id å¯ä»¥é¿å…é¡µåˆ†è£‚ã€‚è¿™ä¸ªå…¶å®å¯ä»¥ç›¸å½“äºä¸€ä¸ªç»“è®ºï¼Œä½ éƒ½å¯ä»¥ç›´æ¥è®°ä½è¿™ä¸ªç»“è®ºå°±å¯ä»¥äº†ã€‚\nä½†æ˜¯å¦‚æœä½ è¦å¼„æ˜ç™½ä»€ä¹ˆæ˜¯é¡µåˆ†è£‚ï¼Œæˆ–è€…ä»€ä¹ˆæƒ…å†µä¸‹ä¼šé¡µåˆ†è£‚ï¼Œè¿™ä¸ªæ—¶å€™ä½ å°±éœ€è¦å¯¹ mysql çš„åº•å±‚æ•°æ®ç»“æ„è¦æœ‰ä¸€å®šçš„ç†è§£äº†ã€‚\næˆ‘è¿™é‡Œä¹Ÿç¨å¾®è§£é‡Šä¸€ä¸‹é¡µåˆ†è£‚ï¼Œmysql ï¼ˆæ³¨æ„æœ¬æ–‡è®²çš„ mysql é»˜è®¤ä¸ºInnoDB å¼•æ“ï¼‰åº•å±‚æ•°æ®ç»“æ„æ˜¯ B+ æ ‘ï¼Œæ‰€è°“çš„ç´¢å¼•å…¶å®å°±æ˜¯ä¸€é¢— B+ æ ‘ï¼Œä¸€ä¸ªè¡¨æœ‰å¤šå°‘ä¸ªç´¢å¼•å°±ä¼šæœ‰å¤šå°‘é¢— B+ æ ‘ï¼Œmysql ä¸­çš„æ•°æ®éƒ½æ˜¯æŒ‰é¡ºåºä¿å­˜åœ¨ B+ æ ‘ä¸Šçš„ï¼ˆæ‰€ä»¥è¯´ç´¢å¼•æœ¬èº«æ˜¯æœ‰åºçš„ï¼‰ã€‚\nç„¶å mysql åœ¨åº•å±‚åˆæ˜¯ä»¥æ•°æ®é¡µä¸ºå•ä½æ¥å­˜å‚¨æ•°æ®çš„ï¼Œä¸€ä¸ªæ•°æ®é¡µå¤§å°é»˜è®¤ä¸º 16kï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å¤§å°ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸€ä¸ªæ•°æ®é¡µå­˜æ»¡äº†ï¼Œmysql å°±ä¼šå»ç”³è¯·ä¸€ä¸ªæ–°çš„æ•°æ®é¡µæ¥å­˜å‚¨æ•°æ®ã€‚\nå¦‚æœä¸»é”®ä¸ºè‡ªå¢ id çš„è¯ï¼Œmysql åœ¨å†™æ»¡ä¸€ä¸ªæ•°æ®é¡µçš„æ—¶å€™ï¼Œç›´æ¥ç”³è¯·å¦ä¸€ä¸ªæ–°æ•°æ®é¡µæ¥ç€å†™å°±å¯ä»¥äº†ã€‚\nå¦‚æœä¸»é”®æ˜¯éè‡ªå¢ idï¼Œä¸ºäº†ç¡®ä¿ç´¢å¼•æœ‰åºï¼Œmysql å°±éœ€è¦å°†æ¯æ¬¡æ’å…¥çš„æ•°æ®éƒ½æ”¾åˆ°åˆé€‚çš„ä½ç½®ä¸Šã€‚\nå½“å¾€ä¸€ä¸ªå¿«æ»¡æˆ–å·²æ»¡çš„æ•°æ®é¡µä¸­æ’å…¥æ•°æ®æ—¶ï¼Œæ–°æ’å…¥çš„æ•°æ®ä¼šå°†æ•°æ®é¡µå†™æ»¡ï¼Œmysql å°±éœ€è¦ç”³è¯·æ–°çš„æ•°æ®é¡µï¼Œå¹¶ä¸”æŠŠä¸Šä¸ªæ•°æ®é¡µä¸­çš„éƒ¨åˆ†æ•°æ®æŒªåˆ°æ–°çš„æ•°æ®é¡µä¸Šã€‚\nè¿™å°±é€ æˆäº†é¡µåˆ†è£‚ï¼Œè¿™ä¸ªå¤§é‡ç§»åŠ¨æ•°æ®çš„è¿‡ç¨‹æ˜¯ä¼šä¸¥é‡å½±å“æ’å…¥æ•ˆç‡çš„ã€‚\nå…¶å®å¯¹ä¸»é”® id è¿˜æœ‰ä¸€ä¸ªå°å°çš„è¦æ±‚ï¼Œåœ¨æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½é‡ä½¿ç”¨å ç©ºé—´æ›´å°çš„ä¸»é”® idï¼Œå› ä¸ºæ™®é€šç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸Šä¿å­˜çš„æ˜¯ä¸»é”® id çš„å€¼ï¼Œå¦‚æœä¸»é”® id å ç©ºé—´è¾ƒå¤§çš„è¯ï¼Œé‚£å°†ä¼šæˆå€å¢åŠ  mysql ç©ºé—´å ç”¨å¤§å°ã€‚\nä¸»é”®æ˜¯ç”¨è‡ªå¢è¿˜æ˜¯UUID æœ€å¥½æ˜¯ç”¨è‡ªå¢ä¸»é”®ï¼Œä¸»è¦æ˜¯ä»¥ä¸‹ä¸¤ä¸ªåŸå› ï¼š\n1. å¦‚æœè¡¨ä½¿ç”¨è‡ªå¢ä¸»é”®ï¼Œé‚£ä¹ˆæ¯æ¬¡æ’å…¥æ–°çš„è®°å½•ï¼Œè®°å½•å°±ä¼šé¡ºåºæ·»åŠ åˆ°å½“å‰ç´¢å¼•èŠ‚ç‚¹çš„åç»­ä½ç½®ï¼Œå½“ä¸€é¡µå†™æ»¡ï¼Œå°±ä¼šè‡ªåŠ¨å¼€è¾Ÿä¸€ä¸ªæ–°çš„é¡µã€‚ 2. å¦‚æœä½¿ç”¨éè‡ªå¢ä¸»é”®ï¼ˆå¦‚uuidï¼‰ï¼Œç”±äºæ¯æ¬¡æ’å…¥ä¸»é”®çš„å€¼è¿‘ä¼¼äºéšæœºï¼Œå› æ­¤æ¯æ¬¡æ–°çºªå½•éƒ½è¦è¢«æ’åˆ°ç´¢å¼•é¡µçš„éšæœºæŸä¸ªä½ç½®ï¼Œæ­¤æ—¶MySQLä¸ºäº†å°†æ–°è®°å½•æ’åˆ°åˆé€‚ä½ç½®è€Œç§»åŠ¨æ•°æ®ï¼Œç”šè‡³ç›®æ ‡é¡µé¢å¯èƒ½å·²ç»è¢«å›å†™åˆ°ç£ç›˜ä¸Šè€Œä»ç¼“å­˜ä¸­æ¸…æ‰ï¼Œæ­¤æ—¶åˆè¦ä»ç£ç›˜ä¸Šè¯»å›æ¥ï¼Œè¿™å¢åŠ äº†å¾ˆå¤šå¼€é”€ï¼ŒåŒæ—¶é¢‘ç¹çš„ç§»åŠ¨ã€åˆ†é¡µæ“ä½œé€ æˆç´¢å¼•ç¢ç‰‡ï¼Œå¾—åˆ°äº†ä¸å¤Ÿç´§å‡‘çš„ç´¢å¼•ç»“æ„ï¼Œåç»­ä¸å¾—ä¸é€šè¿‡OPTIMIZE TABLEæ¥é‡å»ºè¡¨å¹¶ä¼˜åŒ–å¡«å……é¡µé¢ã€‚\nä¸è¿‡ï¼Œä¹Ÿä¸æ˜¯æ‰€æœ‰çš„åœºæ™¯ä¸‹éƒ½å¾—ä½¿ç”¨è‡ªå¢ä¸»é”®ï¼Œå¯èƒ½åœºæ™¯ä¸‹ï¼Œä¸»é”®å¿…é¡»è‡ªå·±ç”Ÿæˆï¼Œä¸åœ¨ä¹é‚£äº›æ€§èƒ½çš„å¼€é”€ã€‚é‚£ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚\nè‡ªå¢ä¸»é”®ç”¨å®Œäº†æ€ä¹ˆåŠ? åœ¨mysqlä¸­ï¼ŒIntæ•´å‹çš„èŒƒå›´ï¼ˆ-2147483648~2147483648ï¼‰ï¼Œçº¦20äº¿ï¼å› æ­¤ä¸ç”¨è€ƒè™‘è‡ªå¢IDè¾¾åˆ°æœ€å¤§å€¼è¿™ä¸ªé—®é¢˜ã€‚è€Œä¸”æ•°æ®è¾¾åˆ°åƒä¸‡çº§çš„æ—¶å€™å°±åº”è¯¥è€ƒè™‘åˆ†åº“åˆ†è¡¨äº†ã€‚\nä¸»é”®ä¸ºä»€ä¹ˆä¸æ¨èæœ‰ä¸šåŠ¡å«ä¹‰? æœ€å¥½æ˜¯ä¸»é”®æ˜¯æ— æ„ä¹‰çš„è‡ªå¢IDï¼Œç„¶åå¦å¤–åˆ›å»ºä¸€ä¸ªä¸šåŠ¡ä¸»é”®IDï¼Œ\nå› ä¸ºä»»ä½•æœ‰ä¸šåŠ¡å«ä¹‰çš„åˆ—éƒ½æœ‰æ”¹å˜çš„å¯èƒ½æ€§,ä¸»é”®ä¸€æ—¦å¸¦ä¸Šäº†ä¸šåŠ¡å«ä¹‰ï¼Œé‚£ä¹ˆä¸»é”®å°±æœ‰å¯èƒ½å‘ç”Ÿå˜æ›´ã€‚ä¸»é”®ä¸€æ—¦å‘ç”Ÿå˜æ›´ï¼Œè¯¥æ•°æ®åœ¨ç£ç›˜ä¸Šçš„å­˜å‚¨ä½ç½®å°±ä¼šå‘ç”Ÿå˜æ›´ï¼Œæœ‰å¯èƒ½ä¼šå¼•å‘é¡µåˆ†è£‚ï¼Œäº§ç”Ÿç©ºé—´ç¢ç‰‡ã€‚\nè¿˜æœ‰å°±æ˜¯ï¼Œå¸¦æœ‰ä¸šåŠ¡å«ä¹‰çš„ä¸»é”®ï¼Œä¸ä¸€å®šæ˜¯é¡ºåºè‡ªå¢çš„ã€‚é‚£ä¹ˆå°±ä¼šå¯¼è‡´æ•°æ®çš„æ’å…¥é¡ºåºï¼Œå¹¶ä¸èƒ½ä¿è¯åé¢æ’å…¥æ•°æ®çš„ä¸»é”®ä¸€å®šæ¯”å‰é¢çš„æ•°æ®å¤§ã€‚å¦‚æœå‡ºç°äº†ï¼Œåé¢æ’å…¥æ•°æ®çš„ä¸»é”®æ¯”å‰é¢çš„å°ï¼Œå°±æœ‰å¯èƒ½å¼•å‘é¡µåˆ†è£‚ï¼Œäº§ç”Ÿç©ºé—´ç¢ç‰‡ã€‚\nè´§å¸å­—æ®µç”¨ä»€ä¹ˆç±»å‹ è´§å¸å­—æ®µä¸€èˆ¬éƒ½ç”¨ Decimalç±»å‹ï¼Œ floatå’Œdoubleæ˜¯ä»¥äºŒè¿›åˆ¶å­˜å‚¨çš„ï¼Œæ•°æ®å¤§çš„æ—¶å€™ï¼Œå¯èƒ½å­˜åœ¨è¯¯å·®ã€‚\nä»¥ä¸‹æ˜¯FLOATå’ŒDOUBLEçš„åŒºåˆ«ï¼š\næµ®ç‚¹æ•°ä»¥8ä½ç²¾åº¦å­˜å‚¨åœ¨FLOATä¸­ï¼Œå¹¶ä¸”æœ‰å››ä¸ªå­—èŠ‚ã€‚\næµ®ç‚¹æ•°å­˜å‚¨åœ¨DOUBLEä¸­ï¼Œç²¾åº¦ä¸º18ä½ï¼Œæœ‰å…«ä¸ªå­—èŠ‚ã€‚\nè¡¨ä¸­æœ‰å¤§å­—æ®µX(ä¾‹å¦‚ï¼štextç±»å‹)ï¼Œä¸”å­—æ®µXä¸ä¼šç»å¸¸æ›´æ–°ï¼Œä»¥è¯»ä¸ºä¸»ï¼Œé‚£ä¹ˆæ˜¯æ‹†æˆå­è¡¨å¥½ï¼Ÿè¿˜æ˜¯æ”¾ä¸€èµ·å¥½ï¼Ÿ å…¶å®å„æœ‰åˆ©å¼Šï¼Œæ‹†å¼€å¸¦æ¥çš„é—®é¢˜ï¼šè¿æ¥æ¶ˆè€—ï¼›ä¸æ‹†å¯èƒ½å¸¦æ¥çš„é—®é¢˜ï¼šæŸ¥è¯¢æ€§èƒ½ï¼Œæ‰€ä»¥è¦çœ‹ä½ çš„å®é™…æƒ…å†µï¼Œå¦‚æœè¡¨æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œæœ€å¥½è¿˜æ˜¯æ‹†å¼€ä¸ºå¥½ã€‚è¿™æ ·æŸ¥è¯¢é€Ÿåº¦æ›´å¿«ã€‚\nå­—æ®µä¸ºä»€ä¹ˆè¦å®šä¹‰ä¸ºNOT NULL? ä¸€èˆ¬æƒ…å†µï¼Œéƒ½ä¼šè®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼ï¼Œä¸ä¼šå‡ºç°å­—æ®µé‡Œé¢æœ‰nullï¼Œåˆæœ‰ç©ºçš„æƒ…å†µã€‚ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š\nç´¢å¼•æ€§èƒ½ä¸å¥½ï¼ŒMysqléš¾ä»¥ä¼˜åŒ–å¼•ç”¨å¯ç©ºåˆ—æŸ¥è¯¢ï¼Œå®ƒä¼šä½¿ç´¢å¼•ã€ç´¢å¼•ç»Ÿè®¡å’Œå€¼æ›´åŠ å¤æ‚ã€‚å¯ç©ºåˆ—éœ€è¦æ›´å¤šçš„å­˜å‚¨ç©ºé—´ï¼Œè¿˜éœ€è¦mysqlå†…éƒ¨è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚å¯ç©ºåˆ—è¢«ç´¢å¼•åï¼Œæ¯æ¡è®°å½•éƒ½éœ€è¦ä¸€ä¸ªé¢å¤–çš„å­—èŠ‚ï¼Œè¿˜èƒ½å¯¼è‡´MYisam ä¸­å›ºå®šå¤§å°çš„ç´¢å¼•å˜æˆå¯å˜å¤§å°çš„ç´¢å¼•ã€‚\nå¦‚æœæŸåˆ—å­˜åœ¨nullçš„æƒ…å†µï¼Œå¯èƒ½å¯¼è‡´count() ç­‰å‡½æ•°æ‰§è¡Œä¸å¯¹çš„æƒ…å†µã€‚\nsql è¯­å¥å†™ç€ä¹Ÿéº»çƒ¦ï¼Œæ—¢è¦åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œåˆè¦åˆ¤æ–­æ˜¯å¦ä¸ºnullç­‰ã€‚\næ€»ç»“ æœ¬æ–‡ç®€è¿°äº†ç´¢å¼•çš„åŸºæœ¬åŸç†ï¼Œç´¢å¼•çš„å‡ ç§ç±»å‹ï¼Œä»¥åŠåˆ†æäº†ä¸€ä¸‹è®¾è®¡ç´¢å¼•å°½é‡åº”è¯¥éµå¾ªçš„ä¸€äº›å‡†åˆ™ï¼Œç›¸ä¿¡æˆ‘ä»¬å¯¹ç´¢å¼•çš„ç†è§£åˆæ›´æ·±äº†ä¸€æ­¥ã€‚å¦å¤–å¼ºçƒˆå»ºè®®å¤§å®¶å»å­¦ä¹ ä¸€ä¸‹é™„å½•ä¸­çš„å‡ æœ¬ä¹¦ã€‚æ–‡ä¸­çš„æŒºå¤šä¾‹å­éƒ½æ˜¯åœ¨æ–‡æœ«çš„å‚è€ƒèµ„æ–™ä¸­æ€»ç»“å‡ºæ¥çš„ï¼Œè¯»ç»å…¸ä¹¦ç±ï¼Œç›¸ä¿¡å¤§å®¶ä¼šå—ç›ŠåŒªæµ…ï¼\n","permalink":"https://reid00.github.io/en/posts/storage/mysql%E7%B4%A2%E5%BC%95%E4%BB%8B%E7%BB%8D/","summary":"ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Œç´¢å¼•çš„ä½œç”¨ å½“æˆ‘ä»¬è¦åœ¨æ–°åå­—å…¸é‡ŒæŸ¥æŸä¸ªå­—ï¼ˆå¦‚ã€Œå…ˆã€ï¼‰å…·ä½“å«ä¹‰çš„æ—¶å€™ï¼Œé€šå¸¸éƒ½ä¼šæ‹¿èµ·ä¸€æœ¬æ–°åå­—å…¸æ¥æŸ¥ï¼Œä½ å¯ä»¥å…ˆä»å¤´åˆ°å°¾æŸ¥è¯¢æ¯ä¸€é¡µæ˜¯å¦æœ‰ã€Œå…ˆã€è¿™ä¸ªå­—ï¼Œè¿™æ ·åšï¼ˆå¯¹åº”æ•°æ®åº“ä¸­çš„å…¨è¡¨æ‰«æï¼‰ç¡®å®èƒ½æ‰¾åˆ°ï¼Œä½†æ•ˆç‡æ— ç–‘æ˜¯éå¸¸ä½ä¸‹çš„ï¼Œæ›´é«˜æ•ˆçš„æ–¹ç›¸ä¿¡å¤§å®¶ä¹Ÿéƒ½çŸ¥é“ï¼Œå°±æ˜¯åœ¨é¦–é¡µçš„ç´¢å¼•é‡Œå…ˆæŸ¥æ‰¾ã€Œå…ˆã€å¯¹åº”çš„é¡µæ•°ï¼Œç„¶åç›´æ¥è·³åˆ°ç›¸åº”çš„é¡µé¢æŸ¥æ‰¾ï¼Œè¿™æ ·æŸ¥è¯¢æ—¶å€™å¤§å¤§å‡å°‘äº†ï¼Œå¯ä»¥ä¸ºæ˜¯ O(1)ã€‚\næ•°æ®åº“ä¸­çš„ç´¢å¼•ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œé€šè¿‡ç´¢å¼•å®šä½åˆ°è¦è¯»å–çš„é¡µï¼Œå¤§å¤§å‡å°‘äº†éœ€è¦æ‰«æçš„è¡Œæ•°ï¼Œèƒ½æå¤§çš„æå‡æ•ˆç‡ï¼Œç®€è€Œè¨€ä¹‹ï¼Œç´¢å¼•ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªä½œç”¨:\nå³ä¸Šè¿°æ‰€è¯´ï¼Œç´¢å¼•èƒ½æå¤§åœ°å‡å°‘æ‰«æè¡Œæ•° ç´¢å¼•å¯ä»¥å¸®åŠ©æœåŠ¡å™¨é¿å…æ’åºå’Œä¸´æ—¶è¡¨ ç´¢å¼•å¯ä»¥å°†éšæœº IO å˜æˆé¡ºåº IO MySQLä¸­ç´¢å¼•çš„å­˜å‚¨ç±»å‹æœ‰ä¸¤ç§ï¼šBTREEå’ŒHASHï¼Œå…·ä½“å’Œè¡¨çš„å­˜å‚¨å¼•æ“ç›¸å…³ï¼›\nMyISAMå’ŒInnoDBå­˜å‚¨å¼•æ“åªæ”¯æŒBTREEç´¢å¼•ï¼ŒMEMORY/HEAPå­˜å‚¨å¼•æ“å¯ä»¥æ”¯æŒHASHå’ŒBTREEç´¢å¼•ã€‚\nç¬¬ä¸€ç‚¹ä¸Šæ–‡å·²ç»è§£é‡Šäº†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ç¬¬äºŒç‚¹å’Œç¬¬ä¸‰ç‚¹\nå…ˆæ¥çœ‹ç¬¬äºŒç‚¹ï¼Œå‡è®¾æˆ‘ä»¬ä¸ç”¨ç´¢å¼•ï¼Œè¯•æƒ³è¿è¡Œå¦‚ä¸‹è¯­å¥\n1 select * from user order by age desc åˆ™ MySQL çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼Œæ‰«ææ‰€æœ‰è¡Œï¼ŒæŠŠæ‰€æœ‰è¡ŒåŠ è½½åˆ°å†…å­˜åï¼Œå†æŒ‰ age æ’åºç”Ÿæˆä¸€å¼ ä¸´æ—¶è¡¨ï¼Œå†æŠŠè¿™è¡¨æ’åºåå°†ç›¸åº”è¡Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ›´ç³Ÿçš„ï¼Œå¦‚æœè¿™å¼ ä¸´æ—¶è¡¨çš„å¤§å°å¤§äº tmp_table_size çš„å€¼ï¼ˆé»˜è®¤ä¸º 16 Mï¼‰ï¼Œå†…å­˜ä¸´æ—¶è¡¨ä¼šè½¬ä¸ºç£ç›˜ä¸´æ—¶è¡¨ï¼Œæ€§èƒ½ä¼šæ›´å·®ï¼Œå¦‚æœåŠ äº†ç´¢å¼•ï¼Œç´¢å¼•æœ¬èº«æ˜¯æœ‰åºçš„ ï¼Œæ‰€ä»¥ä»ç£ç›˜è¯»çš„è¡Œæ•°æœ¬èº«å°±æ˜¯æŒ‰ age æ’åºå¥½çš„ï¼Œä¹Ÿå°±ä¸ä¼šç”Ÿæˆä¸´æ—¶è¡¨ï¼Œå°±ä¸ç”¨å†é¢å¤–æ’åº ï¼Œæ— ç–‘æå‡äº†æ€§èƒ½ã€‚\nå†æ¥çœ‹éšæœº IO å’Œé¡ºåº IOã€‚å…ˆæ¥è§£é‡Šä¸‹è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚\nç›¸ä¿¡ä¸å°‘äººåº”è¯¥åƒè¿‡æ—‹è½¬ç«é”…ï¼ŒæœåŠ¡å‘˜æŠŠä¸€ç›˜ç›˜çš„èœæ”¾åœ¨æ—‹è½¬ä¼ è¾“å¸¦ä¸Šï¼Œç„¶åç­‰åˆ°è¿™äº›èœè½¬åˆ°æˆ‘ä»¬é¢å‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°èœäº†ï¼Œå‡è®¾è£…ä¸€åœˆéœ€è¦ 4 åˆ†é’Ÿï¼Œåˆ™æœ€çŸ­ç­‰å¾…æ—¶é—´æ˜¯ 0ï¼ˆå³èœå°±åœ¨ä½ è·Ÿå‰ï¼‰ï¼Œæœ€é•¿ç­‰å¾…æ—¶é—´æ˜¯ 4 åˆ†é’Ÿï¼ˆèœåˆšå¥½åœ¨ä½ è·Ÿå‰é”™è¿‡ï¼‰ï¼Œé‚£ä¹ˆå¹³å‡ç­‰å¾…æ—¶é—´å³ä¸º 2 åˆ†é’Ÿï¼Œå‡è®¾æˆ‘ä»¬ç°åœ¨è¦æ‹¿å››ç›˜èœï¼Œè¿™å››ç›˜èœéšæœºåˆ†é…åœ¨ä¼ è¾“å¸¦ä¸Šï¼Œåˆ™å¯çŸ¥æ‹¿åˆ°è¿™å››ç›˜èœçš„å¹³å‡ç­‰å¾…æ—¶é—´æ˜¯ 8 åˆ†é’Ÿï¼ˆéšæœº IOï¼‰ï¼Œå¦‚æœè¿™å››ç›˜èœåˆšå¥½ç´§é‚»ç€æ’åœ¨ä¸€èµ·ï¼Œåˆ™ç­‰å¾…æ—¶é—´åªéœ€ 2 åˆ†é’Ÿï¼ˆé¡ºåº IOï¼‰ã€‚\nä¸Šè¿°ä¸­ä¼ è¾“å¸¦å°±ç±»æ¯”ç£é“ï¼Œç£é“ä¸Šçš„èœå°±ç±»æ¯”æ‰‡åŒºï¼ˆsectorï¼‰ä¸­çš„ä¿¡æ¯ï¼Œç£ç›˜å—ï¼ˆblockï¼‰æ˜¯ç”±å¤šä¸ªç›¸é‚»çš„æ‰‡åŒºç»„æˆçš„ï¼Œæ˜¯æ“ä½œç³»ç»Ÿè¯»å–çš„æœ€å°å•å…ƒï¼Œè¿™æ ·å¦‚æœä¿¡æ¯èƒ½ä»¥ block çš„å½¢å¼èšé›†åœ¨ä¸€èµ·ï¼Œå°±èƒ½æå¤§å‡å°‘ç£ç›˜ IO æ—¶é—´,è¿™å°±æ˜¯é¡ºåº IO å¸¦æ¥çš„æ€§èƒ½æå‡ï¼Œä¸‹æ–‡ä¸­æˆ‘ä»¬å°†ä¼šçœ‹åˆ° B+ æ ‘ç´¢å¼•å°±èµ·åˆ°è¿™æ ·çš„ä½œç”¨ã€‚\nå¦‚å›¾ç¤ºï¼šå¤šä¸ªæ‰‡åŒºç»„æˆäº†ä¸€ä¸ª blockï¼Œå¦‚æœè¦è¯»çš„ä¿¡æ¯éƒ½åœ¨è¿™ä¸ª block ä¸­ï¼Œåˆ™åªéœ€ä¸€æ¬¡ IO è¯»\nè€Œå¦‚æœä¿¡æ¯åœ¨ä¸€ä¸ªç£é“ä¸­, åˆ†æ•£åœ°åˆ†å¸ƒåœ¨å„ä¸ªæ‰‡åŒºä¸­ï¼Œæˆ–è€…åˆ†å¸ƒåœ¨ä¸åŒç£é“çš„æ‰‡åŒºä¸Šï¼ˆå¯»é“æ—¶é—´æ˜¯éšæœºIOä¸»è¦ç“¶é¢ˆæ‰€åœ¨ï¼‰ï¼Œå°†ä¼šé€ æˆéšæœº IOï¼Œå½±å“æ€§èƒ½ã€‚","title":"MySqlç´¢å¼•ä»‹ç»"},{"content":"æ•°æ®åº“è¡¨ç»“æ„ï¼š\n1 2 3 4 5 6 7 8 9 create table user ( id int primary key, name varchar(20), sex varchar(5), index(name) )engine=innodb; select id,name where name=\u0026#39;shenjian\u0026#39; select id,name,sex where name=\u0026#39;shenjian\u0026#39; å¤šæŸ¥è¯¢äº†ä¸€ä¸ªå±æ€§ï¼Œä¸ºä½•æ£€ç´¢è¿‡ç¨‹å®Œå…¨ä¸åŒï¼Ÿ\nä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢ï¼Ÿ\nä»€ä¹ˆæ˜¯ç´¢å¼•è¦†ç›–ï¼Ÿ\nå¦‚ä½•å®ç°ç´¢å¼•è¦†ç›–ï¼Ÿ\nå“ªäº›åœºæ™¯ï¼Œå¯ä»¥åˆ©ç”¨ç´¢å¼•è¦†ç›–æ¥ä¼˜åŒ–SQLï¼Ÿ\nä¸€ã€ä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢ï¼Ÿ è¿™å…ˆè¦ä»InnoDBçš„ç´¢å¼•å®ç°è¯´èµ·ï¼ŒInnoDBæœ‰ä¸¤å¤§ç±»ç´¢å¼•ï¼š\nèšé›†ç´¢å¼•(clustered index) æ™®é€šç´¢å¼•(secondary index) **InnoDBèšé›†ç´¢å¼•å’Œæ™®é€šç´¢å¼•æœ‰ä»€ä¹ˆå·®å¼‚ï¼Ÿ\n**\nInnoDBèšé›†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨è¡Œè®°å½•ï¼Œå› æ­¤ï¼Œ InnoDBå¿…é¡»è¦æœ‰ï¼Œä¸”åªæœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ï¼š\nï¼ˆ1ï¼‰å¦‚æœè¡¨å®šä¹‰äº†PKï¼Œåˆ™PKå°±æ˜¯èšé›†ç´¢å¼•ï¼›\nï¼ˆ2ï¼‰å¦‚æœè¡¨æ²¡æœ‰å®šä¹‰PKï¼Œåˆ™ç¬¬ä¸€ä¸ªnot NULL uniqueåˆ—æ˜¯èšé›†ç´¢å¼•ï¼›\nï¼ˆ3ï¼‰å¦åˆ™ï¼ŒInnoDBä¼šåˆ›å»ºä¸€ä¸ªéšè—çš„row-idä½œä¸ºèšé›†ç´¢å¼•ï¼›\nç”»å¤–éŸ³ï¼šæ‰€ä»¥PKæŸ¥è¯¢éå¸¸å¿«ï¼Œç›´æ¥å®šä½è¡Œè®°å½•ã€‚\nInnoDBæ™®é€šç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨ä¸»é”®å€¼ã€‚\nç”»å¤–éŸ³ï¼šæ³¨æ„ï¼Œä¸æ˜¯å­˜å‚¨è¡Œè®°å½•å¤´æŒ‡é’ˆï¼ŒMyISAMçš„ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨è®°å½•æŒ‡é’ˆã€‚\nä¸¾ä¸ªæ —å­ï¼Œä¸å¦¨è®¾æœ‰è¡¨ï¼š\nt(id PK, name KEY, sex, flag);\nç”»å¤–éŸ³ï¼šidæ˜¯èšé›†ç´¢å¼•ï¼Œnameæ˜¯æ™®é€šç´¢å¼•ã€‚\nè¡¨ä¸­æœ‰å››æ¡è®°å½•ï¼š\n1, shenjian, m, A\n3, zhangsan, m, A\n5, lisi, m, A\n9, wangwu, f, B\nä¸¤ä¸ªB+æ ‘ç´¢å¼•åˆ†åˆ«å¦‚ä¸Šå›¾ï¼š\nï¼ˆ1ï¼‰idä¸ºPKï¼Œèšé›†ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨è¡Œè®°å½•ï¼›\nï¼ˆ2ï¼‰nameä¸ºKEYï¼Œæ™®é€šç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨PKå€¼ï¼Œå³idï¼›\næ—¢ç„¶ä»æ™®é€šç´¢å¼•æ— æ³•ç›´æ¥å®šä½è¡Œè®°å½•ï¼Œé‚£æ™®é€šç´¢å¼•çš„æŸ¥è¯¢è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ\né€šå¸¸æƒ…å†µä¸‹ï¼Œéœ€è¦æ‰«æä¸¤éç´¢å¼•æ ‘ã€‚\nä¾‹å¦‚ï¼š\n1 select` `* ``from` `t ``where` `name``=``\u0026#39;lisi\u0026#39;``;ã€€æ˜¯å¦‚ä½•æ‰§è¡Œçš„å‘¢ï¼Ÿ\nå¦‚ç²‰çº¢è‰²è·¯å¾„ï¼Œéœ€è¦æ‰«ç ä¸¤éç´¢å¼•æ ‘ï¼š\nï¼ˆ1ï¼‰å…ˆé€šè¿‡æ™®é€šç´¢å¼•å®šä½åˆ°ä¸»é”®å€¼id=5ï¼›\nï¼ˆ2ï¼‰åœ¨é€šè¿‡èšé›†ç´¢å¼•å®šä½åˆ°è¡Œè®°å½•ï¼›\nè¿™å°±æ˜¯æ‰€è°“çš„å›è¡¨æŸ¥è¯¢ï¼Œå…ˆå®šä½ä¸»é”®å€¼ï¼Œå†å®šä½è¡Œè®°å½•ï¼Œå®ƒçš„æ€§èƒ½è¾ƒæ‰«ä¸€éç´¢å¼•æ ‘æ›´ä½ã€‚\näºŒã€ä»€ä¹ˆæ˜¯ç´¢å¼•è¦†ç›–Covering index)ï¼Ÿ MySQLå®˜ç½‘ï¼Œç±»ä¼¼çš„è¯´æ³•å‡ºç°åœ¨explainæŸ¥è¯¢è®¡åˆ’ä¼˜åŒ–ç« èŠ‚ï¼Œå³explainçš„è¾“å‡ºç»“æœExtraå­—æ®µä¸ºUsing indexæ—¶ï¼Œèƒ½å¤Ÿè§¦å‘ç´¢å¼•è¦†ç›–ã€‚\nä¸ç®¡æ˜¯SQL-Serverå®˜ç½‘ï¼Œè¿˜æ˜¯MySQLå®˜ç½‘ï¼Œéƒ½è¡¨è¾¾äº†ï¼šåªéœ€è¦åœ¨ä¸€æ£µç´¢å¼•æ ‘ä¸Šå°±èƒ½è·å–SQLæ‰€éœ€çš„æ‰€æœ‰åˆ—æ•°æ®ï¼Œæ— éœ€å›è¡¨ï¼Œé€Ÿåº¦æ›´å¿«ã€‚\nä¸‰ã€å¦‚ä½•å®ç°ç´¢å¼•è¦†ç›–ï¼Ÿ å¸¸è§çš„æ–¹æ³•æ˜¯ï¼šå°†è¢«æŸ¥è¯¢çš„å­—æ®µï¼Œå»ºç«‹åˆ°è”åˆç´¢å¼•é‡Œå»ã€‚\nä»æ˜¯ä¹‹å‰ä¸­çš„ä¾‹å­ï¼š\n1 2 3 4 5 6 create table user ( id int primary key, name varchar(20), sex varchar(5), index(name) )engine=innodb; ç¬¬ä¸€ä¸ªSQLè¯­å¥:\n1 select id, name from user where name=\u0026#39;shenjian\u0026#39; èƒ½å¤Ÿå‘½ä¸­nameç´¢å¼•ï¼Œç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨äº†ä¸»é”®idï¼Œé€šè¿‡nameçš„ç´¢å¼•æ ‘å³å¯è·å–idå’Œnameï¼Œæ— éœ€å›è¡¨ï¼Œç¬¦åˆç´¢å¼•è¦†ç›–ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚\nç”»å¤–éŸ³ï¼ŒExtraï¼šUsing indexã€‚\nç¬¬äºŒä¸ªSQLè¯­å¥ï¼š\n1 select id, name from user where name=\u0026#39;shenjian\u0026#39; èƒ½å¤Ÿå‘½ä¸­nameç´¢å¼•ï¼Œç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨äº†ä¸»é”®idï¼Œä½†sexå­—æ®µå¿…é¡»å›è¡¨æŸ¥è¯¢æ‰èƒ½è·å–åˆ°ï¼Œä¸ç¬¦åˆç´¢å¼•è¦†ç›–ï¼Œéœ€è¦å†æ¬¡é€šè¿‡idå€¼æ‰«ç èšé›†ç´¢å¼•è·å–sexå­—æ®µï¼Œæ•ˆç‡ä¼šé™ä½ã€‚\nç”»å¤–éŸ³ï¼ŒExtraï¼šUsing index conditionã€‚\nå¦‚æœæŠŠ(name)å•åˆ—ç´¢å¼•å‡çº§ä¸º**è”åˆç´¢å¼•(name, sex)**å°±ä¸åŒäº†ã€‚\n1 2 3 4 5 6 create table user ( id int primary key, name varchar(20), sex varchar(5), index(name, sex) )engine=innodb; å¯ä»¥çœ‹åˆ°ï¼š\n1 2 3 select id,name ... where name=\u0026#39;shenjian\u0026#39;; select id,name,sex ... where name=\u0026#39;shenjian\u0026#39;; éƒ½èƒ½å¤Ÿå‘½ä¸­ç´¢å¼•è¦†ç›–ï¼Œæ— éœ€å›è¡¨ã€‚\nç”»å¤–éŸ³ï¼ŒExtraï¼šUsing indexã€‚\nå››ã€å“ªäº›åœºæ™¯å¯ä»¥åˆ©ç”¨ç´¢å¼•è¦†ç›–æ¥ä¼˜åŒ–SQLï¼Ÿ åœºæ™¯1ï¼šå…¨è¡¨countæŸ¥è¯¢ä¼˜åŒ– åŸè¡¨ä¸ºï¼š\nuser(PK id, name, sex)ï¼›\n1 select count(name) from user; ä¸èƒ½åˆ©ç”¨ç´¢å¼•è¦†ç›–ã€‚\næ·»åŠ ç´¢å¼•ï¼š\n1 alter table user add key(name); å°±èƒ½å¤Ÿåˆ©ç”¨ç´¢å¼•è¦†ç›–ææ•ˆã€‚\ncount(1)ã€count(*) ä¸ count(åˆ—å) çš„åŒºåˆ«ï¼Ÿ\ncount(*)åŒ…æ‹¬äº†æ‰€æœ‰çš„åˆ—ï¼Œç›¸å½“äºè¡Œæ•°ï¼Œåœ¨ç»Ÿè®¡ç»“æœçš„æ—¶å€™ï¼Œä¸ä¼šå¿½ç•¥åˆ—å€¼ä¸ºNULL count(1)åŒ…æ‹¬äº†å¿½ç•¥æ‰€æœ‰åˆ—ï¼Œç”¨1ä»£è¡¨ä»£ç è¡Œï¼Œåœ¨ç»Ÿè®¡ç»“æœçš„æ—¶å€™ï¼Œä¸ä¼šå¿½ç•¥åˆ—å€¼ä¸ºNULL count(åˆ—å)åªåŒ…æ‹¬åˆ—åé‚£ä¸€åˆ—ï¼Œåœ¨ç»Ÿè®¡ç»“æœçš„æ—¶å€™ï¼Œä¼šå¿½ç•¥åˆ—å€¼ä¸ºç©ºï¼ˆè¿™é‡Œçš„ç©ºä¸æ˜¯åªç©ºå­—ç¬¦ä¸²æˆ–è€…0ï¼Œè€Œæ˜¯è¡¨ç¤ºnullï¼‰çš„è®¡æ•°ï¼Œå³æŸä¸ªå­—æ®µå€¼ä¸ºNULLæ—¶ï¼Œä¸ç»Ÿè®¡ã€‚ åœºæ™¯2ï¼šåˆ—æŸ¥è¯¢å›è¡¨ä¼˜åŒ– 1 select id,name,sex ... where name=\u0026#39;shenjian\u0026#39;; è¿™ä¸ªä¾‹å­ä¸å†èµ˜è¿°ï¼Œå°†å•åˆ—ç´¢å¼•(name)å‡çº§ä¸ºè”åˆç´¢å¼•(name, sex)ï¼Œå³å¯é¿å…å›è¡¨ã€‚\nåœºæ™¯3ï¼šåˆ†é¡µæŸ¥è¯¢ 1 select id,name,sex ... order by name limit 500,100; å°†å•åˆ—ç´¢å¼•(name)å‡çº§ä¸ºè”åˆç´¢å¼•(name, sex)ï¼Œä¹Ÿå¯ä»¥é¿å…å›è¡¨ã€‚\nå‚è€ƒ: https://mp.weixin.qq.com/s/T7LnqldlD9sCH37gWUHVfQ\n","permalink":"https://reid00.github.io/en/posts/storage/mysql%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96/","summary":"æ•°æ®åº“è¡¨ç»“æ„ï¼š\n1 2 3 4 5 6 7 8 9 create table user ( id int primary key, name varchar(20), sex varchar(5), index(name) )engine=innodb; select id,name where name=\u0026#39;shenjian\u0026#39; select id,name,sex where name=\u0026#39;shenjian\u0026#39; å¤šæŸ¥è¯¢äº†ä¸€ä¸ªå±æ€§ï¼Œä¸ºä½•æ£€ç´¢è¿‡ç¨‹å®Œå…¨ä¸åŒï¼Ÿ\nä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢ï¼Ÿ\nä»€ä¹ˆæ˜¯ç´¢å¼•è¦†ç›–ï¼Ÿ\nå¦‚ä½•å®ç°ç´¢å¼•è¦†ç›–ï¼Ÿ\nå“ªäº›åœºæ™¯ï¼Œå¯ä»¥åˆ©ç”¨ç´¢å¼•è¦†ç›–æ¥ä¼˜åŒ–SQLï¼Ÿ\nä¸€ã€ä»€ä¹ˆæ˜¯å›è¡¨æŸ¥è¯¢ï¼Ÿ è¿™å…ˆè¦ä»InnoDBçš„ç´¢å¼•å®ç°è¯´èµ·ï¼ŒInnoDBæœ‰ä¸¤å¤§ç±»ç´¢å¼•ï¼š\nèšé›†ç´¢å¼•(clustered index) æ™®é€šç´¢å¼•(secondary index) **InnoDBèšé›†ç´¢å¼•å’Œæ™®é€šç´¢å¼•æœ‰ä»€ä¹ˆå·®å¼‚ï¼Ÿ\n**\nInnoDBèšé›†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨è¡Œè®°å½•ï¼Œå› æ­¤ï¼Œ InnoDBå¿…é¡»è¦æœ‰ï¼Œä¸”åªæœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ï¼š\nï¼ˆ1ï¼‰å¦‚æœè¡¨å®šä¹‰äº†PKï¼Œåˆ™PKå°±æ˜¯èšé›†ç´¢å¼•ï¼›\nï¼ˆ2ï¼‰å¦‚æœè¡¨æ²¡æœ‰å®šä¹‰PKï¼Œåˆ™ç¬¬ä¸€ä¸ªnot NULL uniqueåˆ—æ˜¯èšé›†ç´¢å¼•ï¼›\nï¼ˆ3ï¼‰å¦åˆ™ï¼ŒInnoDBä¼šåˆ›å»ºä¸€ä¸ªéšè—çš„row-idä½œä¸ºèšé›†ç´¢å¼•ï¼›\nç”»å¤–éŸ³ï¼šæ‰€ä»¥PKæŸ¥è¯¢éå¸¸å¿«ï¼Œç›´æ¥å®šä½è¡Œè®°å½•ã€‚\nInnoDBæ™®é€šç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜å‚¨ä¸»é”®å€¼ã€‚\nç”»å¤–éŸ³ï¼šæ³¨æ„ï¼Œä¸æ˜¯å­˜å‚¨è¡Œè®°å½•å¤´æŒ‡é’ˆï¼ŒMyISAMçš„ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨è®°å½•æŒ‡é’ˆã€‚\nä¸¾ä¸ªæ —å­ï¼Œä¸å¦¨è®¾æœ‰è¡¨ï¼š\nt(id PK, name KEY, sex, flag);\nç”»å¤–éŸ³ï¼šidæ˜¯èšé›†ç´¢å¼•ï¼Œnameæ˜¯æ™®é€šç´¢å¼•ã€‚\nè¡¨ä¸­æœ‰å››æ¡è®°å½•ï¼š\n1, shenjian, m, A\n3, zhangsan, m, A","title":"MySqlç´¢å¼•ä¼˜åŒ–"},{"content":"ã€æµ…å…¥æ·±å‡ºã€MySQL ä¸­äº‹åŠ¡çš„å®ç° https://draveness.me/mysql-transaction/\nMySQL ä¸­å¦‚ä½•å®ç°äº‹åŠ¡éš”ç¦» https://www.cnblogs.com/fengzheng/p/12557762.html\nè¯¦è§£ä¸€æ¡ SQL çš„æ‰§è¡Œè¿‡ç¨‹\nhttps://juejin.cn/post/6931606328129355790\né¦–å…ˆè¯´è¯»æœªæäº¤ï¼Œå®ƒæ˜¯æ€§èƒ½æœ€å¥½ï¼Œä¹Ÿå¯ä»¥è¯´å®ƒæ˜¯æœ€é‡è›®çš„æ–¹å¼ï¼Œå› ä¸ºå®ƒå‹æ ¹å„¿å°±ä¸åŠ é”ï¼Œæ‰€ä»¥æ ¹æœ¬è°ˆä¸ä¸Šä»€ä¹ˆéš”ç¦»æ•ˆæœï¼Œå¯ä»¥ç†è§£ä¸ºæ²¡æœ‰éš”ç¦»ã€‚\nå†æ¥è¯´ä¸²è¡ŒåŒ–ã€‚è¯»çš„æ—¶å€™åŠ å…±äº«é”ï¼Œä¹Ÿå°±æ˜¯å…¶ä»–äº‹åŠ¡å¯ä»¥å¹¶å‘è¯»ï¼Œä½†æ˜¯ä¸èƒ½å†™ã€‚å†™çš„æ—¶å€™åŠ æ’å®ƒé”ï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½å¹¶å‘å†™ä¹Ÿä¸èƒ½å¹¶å‘è¯»ã€‚\næœ€åè¯´è¯»æäº¤å’Œå¯é‡å¤è¯»ã€‚è¿™ä¸¤ç§éš”ç¦»çº§åˆ«æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œæ—¢è¦å…è®¸ä¸€å®šçš„å¹¶å‘ï¼Œåˆæƒ³è¦å…¼é¡¾çš„è§£å†³é—®é¢˜ã€‚\nå®ç°å¯é‡å¤è¯» ä¸ºäº†è§£å†³ä¸å¯é‡å¤è¯»ï¼Œæˆ–è€…ä¸ºäº†å®ç°å¯é‡å¤è¯»ï¼ŒMySQL é‡‡ç”¨äº† MVVC (å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶) çš„æ–¹å¼ã€‚\næˆ‘ä»¬åœ¨æ•°æ®åº“è¡¨ä¸­çœ‹åˆ°çš„ä¸€è¡Œè®°å½•å¯èƒ½å®é™…ä¸Šæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸ªç‰ˆæœ¬çš„è®°å½•é™¤äº†æœ‰æ•°æ®æœ¬èº«å¤–ï¼Œè¿˜è¦æœ‰ä¸€ä¸ªè¡¨ç¤ºç‰ˆæœ¬çš„å­—æ®µï¼Œè®°ä¸º row trx_idï¼Œè€Œè¿™ä¸ªå­—æ®µå°±æ˜¯ä½¿å…¶äº§ç”Ÿçš„äº‹åŠ¡çš„ idï¼Œäº‹åŠ¡ ID è®°ä¸º transaction idï¼Œå®ƒåœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™å‘äº‹åŠ¡ç³»ç»Ÿç”³è¯·ï¼ŒæŒ‰æ—¶é—´å…ˆåé¡ºåºé€’å¢ã€‚\næŒ‰ç…§ä¸Šé¢è¿™å¼ å›¾ç†è§£ï¼Œä¸€è¡Œè®°å½•ç°åœ¨æœ‰ 3 ä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸€ä¸ªç‰ˆæœ¬éƒ½è®°å½•è¿™ä½¿å…¶äº§ç”Ÿçš„äº‹åŠ¡ IDï¼Œæ¯”å¦‚äº‹åŠ¡Açš„transaction id æ˜¯100ï¼Œé‚£ä¹ˆç‰ˆæœ¬1çš„row trx_id å°±æ˜¯ 100ï¼ŒåŒç†ç‰ˆæœ¬2å’Œç‰ˆæœ¬3ã€‚\nåœ¨ä¸Šé¢ä»‹ç»è¯»æäº¤å’Œå¯é‡å¤è¯»çš„æ—¶å€™éƒ½æåˆ°äº†ä¸€ä¸ªè¯ï¼Œå«åšå¿«ç…§ï¼Œå­¦åå«åšä¸€è‡´æ€§è§†å›¾ï¼Œè¿™ä¹Ÿæ˜¯å¯é‡å¤è¯»å’Œä¸å¯é‡å¤è¯»çš„å…³é”®ï¼Œå¯é‡å¤è¯»æ˜¯åœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™ç”Ÿæˆä¸€ä¸ªå½“å‰äº‹åŠ¡å…¨å±€æ€§çš„å¿«ç…§ï¼Œè€Œè¯»æäº¤åˆ™æ˜¯æ¯æ¬¡æ‰§è¡Œè¯­å¥çš„æ—¶å€™éƒ½é‡æ–°ç”Ÿæˆä¸€æ¬¡å¿«ç…§ã€‚\nå¯¹äºä¸€ä¸ªå¿«ç…§æ¥è¯´ï¼Œå®ƒèƒ½å¤Ÿè¯»åˆ°é‚£äº›ç‰ˆæœ¬æ•°æ®ï¼Œè¦éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š\nå½“å‰äº‹åŠ¡å†…çš„æ›´æ–°ï¼Œå¯ä»¥è¯»åˆ°ï¼› ç‰ˆæœ¬æœªæäº¤ï¼Œä¸èƒ½è¯»åˆ°ï¼› ç‰ˆæœ¬å·²æäº¤ï¼Œä½†æ˜¯å´åœ¨å¿«ç…§åˆ›å»ºåæäº¤çš„ï¼Œä¸èƒ½è¯»åˆ°ï¼› ç‰ˆæœ¬å·²æäº¤ï¼Œä¸”æ˜¯åœ¨å¿«ç…§åˆ›å»ºå‰æäº¤çš„ï¼Œå¯ä»¥è¯»åˆ°ï¼› åˆ©ç”¨ä¸Šé¢çš„è§„åˆ™ï¼Œå†è¿”å›å»å¥—ç”¨åˆ°è¯»æäº¤å’Œå¯é‡å¤è¯»çš„é‚£ä¸¤å¼ å›¾ä¸Šå°±å¾ˆæ¸…æ™°äº†ã€‚è¿˜æ˜¯è¦å¼ºè°ƒï¼Œä¸¤è€…ä¸»è¦çš„åŒºåˆ«å°±æ˜¯åœ¨å¿«ç…§çš„åˆ›å»ºä¸Šï¼Œå¯é‡å¤è¯»ä»…åœ¨äº‹åŠ¡å¼€å§‹æ˜¯åˆ›å»ºä¸€æ¬¡ï¼Œè€Œè¯»æäº¤æ¯æ¬¡æ‰§è¡Œè¯­å¥çš„æ—¶å€™éƒ½è¦é‡æ–°åˆ›å»ºä¸€æ¬¡ã€‚\nå¹¶å‘å†™é—®é¢˜ å­˜åœ¨è¿™çš„æƒ…å†µï¼Œä¸¤ä¸ªäº‹åŠ¡ï¼Œå¯¹åŒä¸€æ¡æ•°æ®åšä¿®æ”¹ã€‚æœ€åç»“æœåº”è¯¥æ˜¯å“ªä¸ªäº‹åŠ¡çš„ç»“æœå‘¢ï¼Œè‚¯å®šè¦æ˜¯æ—¶é—´é åçš„é‚£ä¸ªå¯¹ä¸å¯¹ã€‚å¹¶ä¸”æ›´æ–°ä¹‹å‰è¦å…ˆè¯»æ•°æ®ï¼Œè¿™é‡Œæ‰€è¯´çš„è¯»å’Œä¸Šé¢è¯´åˆ°çš„è¯»ä¸ä¸€æ ·ï¼Œæ›´æ–°ä¹‹å‰çš„è¯»å«åšâ€œå½“å‰è¯»â€ï¼Œæ€»æ˜¯å½“å‰ç‰ˆæœ¬çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯å¤šç‰ˆæœ¬ä¸­æœ€æ–°ä¸€æ¬¡æäº¤çš„é‚£ç‰ˆã€‚\nå‡è®¾äº‹åŠ¡Aæ‰§è¡Œ update æ“ä½œï¼Œ update çš„æ—¶å€™è¦å¯¹æ‰€ä¿®æ”¹çš„è¡ŒåŠ è¡Œé”ï¼Œè¿™ä¸ªè¡Œé”ä¼šåœ¨æäº¤ä¹‹åæ‰é‡Šæ”¾ã€‚è€Œåœ¨äº‹åŠ¡Aæäº¤ä¹‹å‰ï¼Œäº‹åŠ¡Bä¹Ÿæƒ³ update è¿™è¡Œæ•°æ®ï¼Œäºæ˜¯ç”³è¯·è¡Œé”ï¼Œä½†æ˜¯ç”±äºå·²ç»è¢«äº‹åŠ¡Aå æœ‰ï¼Œäº‹åŠ¡Bæ˜¯ç”³è¯·ä¸åˆ°çš„ï¼Œæ­¤æ—¶ï¼Œäº‹åŠ¡Bå°±ä¼šä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°äº‹åŠ¡Aæäº¤ï¼Œäº‹åŠ¡Bæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œå¦‚æœäº‹åŠ¡Açš„æ—¶é—´å¤ªé•¿ï¼Œé‚£ä¹ˆäº‹åŠ¡Bå¾ˆæœ‰å¯èƒ½å‡ºç°è¶…æ—¶å¼‚å¸¸ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\nåŠ é”çš„è¿‡ç¨‹è¦åˆ†æœ‰ç´¢å¼•å’Œæ— ç´¢å¼•ä¸¤ç§æƒ…å†µï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ¡è¯­å¥\n1 update user set age=11 where id = 1 id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ï¼Œæ˜¯æœ‰ç´¢å¼•çš„æƒ…å†µï¼Œé‚£ä¹ˆ MySQL ç›´æ¥å°±åœ¨ç´¢å¼•æ•°ä¸­æ‰¾åˆ°äº†è¿™è¡Œæ•°æ®ï¼Œç„¶åå¹²å‡€åˆ©è½çš„åŠ ä¸Šè¡Œé”å°±å¯ä»¥äº†ã€‚\nè€Œä¸‹é¢è¿™æ¡è¯­å¥\n1 update user set age=11 where age=10 è¡¨ä¸­å¹¶æ²¡æœ‰ä¸º age å­—æ®µè®¾ç½®ç´¢å¼•ï¼Œæ‰€ä»¥ï¼Œ MySQL æ— æ³•ç›´æ¥å®šä½åˆ°è¿™è¡Œæ•°æ®ã€‚é‚£æ€ä¹ˆåŠå‘¢ï¼Œå½“ç„¶ä¹Ÿä¸æ˜¯åŠ è¡¨é”äº†ã€‚MySQL ä¼šä¸ºè¿™å¼ è¡¨ä¸­æ‰€æœ‰è¡ŒåŠ è¡Œé”ï¼Œæ²¡é”™ï¼Œæ˜¯æ‰€æœ‰è¡Œã€‚ä½†æ˜¯å‘¢ï¼Œåœ¨åŠ ä¸Šè¡Œé”åï¼ŒMySQL ä¼šè¿›è¡Œä¸€éè¿‡æ»¤ï¼Œå‘ç°ä¸æ»¡è¶³çš„è¡Œå°±é‡Šæ”¾é”ï¼Œæœ€ç»ˆåªç•™ä¸‹ç¬¦åˆæ¡ä»¶çš„è¡Œã€‚è™½ç„¶æœ€ç»ˆåªä¸ºç¬¦åˆæ¡ä»¶çš„è¡ŒåŠ äº†é”ï¼Œä½†æ˜¯è¿™ä¸€é”ä¸€é‡Šæ”¾çš„è¿‡ç¨‹å¯¹æ€§èƒ½ä¹Ÿæ˜¯å½±å“æå¤§çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ˜¯å¤§è¡¨çš„è¯ï¼Œå»ºè®®åˆç†è®¾è®¡ç´¢å¼•ï¼Œå¦‚æœçœŸçš„å‡ºç°è¿™ç§æƒ…å†µï¼Œé‚£å¾ˆéš¾ä¿è¯å¹¶å‘åº¦ã€‚\nè§£å†³å¹»è¯» ä¸Šé¢ä»‹ç»å¯é‡å¤è¯»çš„æ—¶å€™ï¼Œé‚£å¼ å›¾é‡Œæ ‡ç¤ºç€å‡ºç°å¹»è¯»çš„åœ°æ–¹å®é™…ä¸Šåœ¨ MySQL ä¸­å¹¶ä¸ä¼šå‡ºç°ï¼ŒMySQL å·²ç»åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹è§£å†³äº†å¹»è¯»çš„é—®é¢˜ã€‚\nå‰é¢åˆšè¯´äº†å¹¶å‘å†™é—®é¢˜çš„è§£å†³æ–¹å¼å°±æ˜¯è¡Œé”ï¼Œè€Œè§£å†³å¹»è¯»ç”¨çš„ä¹Ÿæ˜¯é”ï¼Œå«åšé—´éš™é”ï¼ŒMySQL æŠŠè¡Œé”å’Œé—´éš™é”åˆå¹¶åœ¨ä¸€èµ·ï¼Œè§£å†³äº†å¹¶å‘å†™å’Œå¹»è¯»çš„é—®é¢˜ï¼Œè¿™ä¸ªé”å«åš Next-Keyé”ã€‚\nå‡è®¾ç°åœ¨è¡¨ä¸­æœ‰ä¸¤æ¡è®°å½•ï¼Œå¹¶ä¸” age å­—æ®µå·²ç»æ·»åŠ äº†ç´¢å¼•ï¼Œä¸¤æ¡è®°å½• age çš„å€¼åˆ†åˆ«ä¸º 10 å’Œ 30ã€‚\næ­¤æ—¶ï¼Œåœ¨æ•°æ®åº“ä¸­ä¼šä¸ºç´¢å¼•ç»´æŠ¤ä¸€å¥—B+æ ‘ï¼Œç”¨æ¥å¿«é€Ÿå®šä½è¡Œè®°å½•ã€‚B+ç´¢å¼•æ ‘æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥ä¼šæŠŠè¿™å¼ è¡¨çš„ç´¢å¼•åˆ†å‰²æˆå‡ ä¸ªåŒºé—´ã€‚\nå¦‚å›¾æ‰€ç¤ºï¼Œåˆ†æˆäº†3 ä¸ªåŒºé—´ï¼Œ(è´Ÿæ— ç©·,10]ã€(10,30]ã€(30,æ­£æ— ç©·]ï¼Œåœ¨è¿™3ä¸ªåŒºé—´æ˜¯å¯ä»¥åŠ é—´éš™é”çš„ã€‚\nä¹‹åï¼Œæˆ‘ç”¨ä¸‹é¢çš„ä¸¤ä¸ªäº‹åŠ¡æ¼”ç¤ºä¸€ä¸‹åŠ é”è¿‡ç¨‹ã€‚\nåœ¨äº‹åŠ¡Aæäº¤ä¹‹å‰ï¼Œäº‹åŠ¡Bçš„æ’å…¥æ“ä½œåªèƒ½ç­‰å¾…ï¼Œè¿™å°±æ˜¯é—´éš™é”èµ·å¾—ä½œç”¨ã€‚å½“äº‹åŠ¡Aæ‰§è¡Œupdate user set name='é£ç­2å·â€™ where age = 10; çš„æ—¶å€™ï¼Œç”±äºæ¡ä»¶ where age = 10 ï¼Œæ•°æ®åº“ä¸ä»…åœ¨ age =10 çš„è¡Œä¸Šæ·»åŠ äº†è¡Œé”ï¼Œè€Œä¸”åœ¨è¿™æ¡è®°å½•çš„ä¸¤è¾¹ï¼Œä¹Ÿå°±æ˜¯(è´Ÿæ— ç©·,10]ã€(10,30]è¿™ä¸¤ä¸ªåŒºé—´åŠ äº†é—´éš™é”ï¼Œä»è€Œå¯¼è‡´äº‹åŠ¡Bæ’å…¥æ“ä½œæ— æ³•å®Œæˆï¼Œåªèƒ½ç­‰å¾…äº‹åŠ¡Aæäº¤ã€‚ä¸ä»…æ’å…¥ age = 10 çš„è®°å½•éœ€è¦ç­‰å¾…äº‹åŠ¡Aæäº¤ï¼Œage\u0026lt;10ã€10\u0026lt;age\u0026lt;30 çš„è®°å½•é¡µæ— æ³•å®Œæˆï¼Œè€Œå¤§äºç­‰äº30çš„è®°å½•åˆ™ä¸å—å½±å“ï¼Œè¿™è¶³ä»¥è§£å†³å¹»è¯»é—®é¢˜äº†ã€‚\nè¿™æ˜¯æœ‰ç´¢å¼•çš„æƒ…å†µï¼Œå¦‚æœ age ä¸æ˜¯ç´¢å¼•åˆ—ï¼Œé‚£ä¹ˆæ•°æ®åº“ä¼šä¸ºæ•´ä¸ªè¡¨åŠ ä¸Šé—´éš™é”ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ˜¯æ²¡æœ‰ç´¢å¼•çš„è¯ï¼Œä¸ç®¡ age æ˜¯å¦å¤§äºç­‰äº30ï¼Œéƒ½è¦ç­‰å¾…äº‹åŠ¡Aæäº¤æ‰å¯ä»¥æˆåŠŸæ’å…¥ã€‚\næ€»ç»“ MySQL çš„ InnoDB å¼•æ“æ‰æ”¯æŒäº‹åŠ¡ï¼Œå…¶ä¸­å¯é‡å¤è¯»æ˜¯é»˜è®¤çš„éš”ç¦»çº§åˆ«ã€‚\nè¯»æœªæäº¤å’Œä¸²è¡ŒåŒ–åŸºæœ¬ä¸Šæ˜¯ä¸éœ€è¦è€ƒè™‘çš„éš”ç¦»çº§åˆ«ï¼Œå‰è€…ä¸åŠ é”é™åˆ¶ï¼Œåè€…ç›¸å½“äºå•çº¿ç¨‹æ‰§è¡Œï¼Œæ•ˆç‡å¤ªå·®ã€‚\nè¯»æäº¤è§£å†³äº†è„è¯»é—®é¢˜ï¼Œè¡Œé”è§£å†³äº†å¹¶å‘æ›´æ–°çš„é—®é¢˜ã€‚å¹¶ä¸” MySQL åœ¨å¯é‡å¤è¯»çº§åˆ«è§£å†³äº†å¹»è¯»é—®é¢˜ï¼Œæ˜¯é€šè¿‡è¡Œé”å’Œé—´éš™é”çš„ç»„åˆ Next-Key é”å®ç°çš„ã€‚\n","permalink":"https://reid00.github.io/en/posts/storage/mysql%E4%BA%8B%E5%8A%A1/","summary":"ã€æµ…å…¥æ·±å‡ºã€MySQL ä¸­äº‹åŠ¡çš„å®ç° https://draveness.me/mysql-transaction/\nMySQL ä¸­å¦‚ä½•å®ç°äº‹åŠ¡éš”ç¦» https://www.cnblogs.com/fengzheng/p/12557762.html\nè¯¦è§£ä¸€æ¡ SQL çš„æ‰§è¡Œè¿‡ç¨‹\nhttps://juejin.cn/post/6931606328129355790\né¦–å…ˆè¯´è¯»æœªæäº¤ï¼Œå®ƒæ˜¯æ€§èƒ½æœ€å¥½ï¼Œä¹Ÿå¯ä»¥è¯´å®ƒæ˜¯æœ€é‡è›®çš„æ–¹å¼ï¼Œå› ä¸ºå®ƒå‹æ ¹å„¿å°±ä¸åŠ é”ï¼Œæ‰€ä»¥æ ¹æœ¬è°ˆä¸ä¸Šä»€ä¹ˆéš”ç¦»æ•ˆæœï¼Œå¯ä»¥ç†è§£ä¸ºæ²¡æœ‰éš”ç¦»ã€‚\nå†æ¥è¯´ä¸²è¡ŒåŒ–ã€‚è¯»çš„æ—¶å€™åŠ å…±äº«é”ï¼Œä¹Ÿå°±æ˜¯å…¶ä»–äº‹åŠ¡å¯ä»¥å¹¶å‘è¯»ï¼Œä½†æ˜¯ä¸èƒ½å†™ã€‚å†™çš„æ—¶å€™åŠ æ’å®ƒé”ï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½å¹¶å‘å†™ä¹Ÿä¸èƒ½å¹¶å‘è¯»ã€‚\næœ€åè¯´è¯»æäº¤å’Œå¯é‡å¤è¯»ã€‚è¿™ä¸¤ç§éš”ç¦»çº§åˆ«æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œæ—¢è¦å…è®¸ä¸€å®šçš„å¹¶å‘ï¼Œåˆæƒ³è¦å…¼é¡¾çš„è§£å†³é—®é¢˜ã€‚\nå®ç°å¯é‡å¤è¯» ä¸ºäº†è§£å†³ä¸å¯é‡å¤è¯»ï¼Œæˆ–è€…ä¸ºäº†å®ç°å¯é‡å¤è¯»ï¼ŒMySQL é‡‡ç”¨äº† MVVC (å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶) çš„æ–¹å¼ã€‚\næˆ‘ä»¬åœ¨æ•°æ®åº“è¡¨ä¸­çœ‹åˆ°çš„ä¸€è¡Œè®°å½•å¯èƒ½å®é™…ä¸Šæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸ªç‰ˆæœ¬çš„è®°å½•é™¤äº†æœ‰æ•°æ®æœ¬èº«å¤–ï¼Œè¿˜è¦æœ‰ä¸€ä¸ªè¡¨ç¤ºç‰ˆæœ¬çš„å­—æ®µï¼Œè®°ä¸º row trx_idï¼Œè€Œè¿™ä¸ªå­—æ®µå°±æ˜¯ä½¿å…¶äº§ç”Ÿçš„äº‹åŠ¡çš„ idï¼Œäº‹åŠ¡ ID è®°ä¸º transaction idï¼Œå®ƒåœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™å‘äº‹åŠ¡ç³»ç»Ÿç”³è¯·ï¼ŒæŒ‰æ—¶é—´å…ˆåé¡ºåºé€’å¢ã€‚\næŒ‰ç…§ä¸Šé¢è¿™å¼ å›¾ç†è§£ï¼Œä¸€è¡Œè®°å½•ç°åœ¨æœ‰ 3 ä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸€ä¸ªç‰ˆæœ¬éƒ½è®°å½•è¿™ä½¿å…¶äº§ç”Ÿçš„äº‹åŠ¡ IDï¼Œæ¯”å¦‚äº‹åŠ¡Açš„transaction id æ˜¯100ï¼Œé‚£ä¹ˆç‰ˆæœ¬1çš„row trx_id å°±æ˜¯ 100ï¼ŒåŒç†ç‰ˆæœ¬2å’Œç‰ˆæœ¬3ã€‚\nåœ¨ä¸Šé¢ä»‹ç»è¯»æäº¤å’Œå¯é‡å¤è¯»çš„æ—¶å€™éƒ½æåˆ°äº†ä¸€ä¸ªè¯ï¼Œå«åšå¿«ç…§ï¼Œå­¦åå«åšä¸€è‡´æ€§è§†å›¾ï¼Œè¿™ä¹Ÿæ˜¯å¯é‡å¤è¯»å’Œä¸å¯é‡å¤è¯»çš„å…³é”®ï¼Œå¯é‡å¤è¯»æ˜¯åœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™ç”Ÿæˆä¸€ä¸ªå½“å‰äº‹åŠ¡å…¨å±€æ€§çš„å¿«ç…§ï¼Œè€Œè¯»æäº¤åˆ™æ˜¯æ¯æ¬¡æ‰§è¡Œè¯­å¥çš„æ—¶å€™éƒ½é‡æ–°ç”Ÿæˆä¸€æ¬¡å¿«ç…§ã€‚\nå¯¹äºä¸€ä¸ªå¿«ç…§æ¥è¯´ï¼Œå®ƒèƒ½å¤Ÿè¯»åˆ°é‚£äº›ç‰ˆæœ¬æ•°æ®ï¼Œè¦éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š\nå½“å‰äº‹åŠ¡å†…çš„æ›´æ–°ï¼Œå¯ä»¥è¯»åˆ°ï¼› ç‰ˆæœ¬æœªæäº¤ï¼Œä¸èƒ½è¯»åˆ°ï¼› ç‰ˆæœ¬å·²æäº¤ï¼Œä½†æ˜¯å´åœ¨å¿«ç…§åˆ›å»ºåæäº¤çš„ï¼Œä¸èƒ½è¯»åˆ°ï¼› ç‰ˆæœ¬å·²æäº¤ï¼Œä¸”æ˜¯åœ¨å¿«ç…§åˆ›å»ºå‰æäº¤çš„ï¼Œå¯ä»¥è¯»åˆ°ï¼› åˆ©ç”¨ä¸Šé¢çš„è§„åˆ™ï¼Œå†è¿”å›å»å¥—ç”¨åˆ°è¯»æäº¤å’Œå¯é‡å¤è¯»çš„é‚£ä¸¤å¼ å›¾ä¸Šå°±å¾ˆæ¸…æ™°äº†ã€‚è¿˜æ˜¯è¦å¼ºè°ƒï¼Œä¸¤è€…ä¸»è¦çš„åŒºåˆ«å°±æ˜¯åœ¨å¿«ç…§çš„åˆ›å»ºä¸Šï¼Œå¯é‡å¤è¯»ä»…åœ¨äº‹åŠ¡å¼€å§‹æ˜¯åˆ›å»ºä¸€æ¬¡ï¼Œè€Œè¯»æäº¤æ¯æ¬¡æ‰§è¡Œè¯­å¥çš„æ—¶å€™éƒ½è¦é‡æ–°åˆ›å»ºä¸€æ¬¡ã€‚\nå¹¶å‘å†™é—®é¢˜ å­˜åœ¨è¿™çš„æƒ…å†µï¼Œä¸¤ä¸ªäº‹åŠ¡ï¼Œå¯¹åŒä¸€æ¡æ•°æ®åšä¿®æ”¹ã€‚æœ€åç»“æœåº”è¯¥æ˜¯å“ªä¸ªäº‹åŠ¡çš„ç»“æœå‘¢ï¼Œè‚¯å®šè¦æ˜¯æ—¶é—´é åçš„é‚£ä¸ªå¯¹ä¸å¯¹ã€‚å¹¶ä¸”æ›´æ–°ä¹‹å‰è¦å…ˆè¯»æ•°æ®ï¼Œè¿™é‡Œæ‰€è¯´çš„è¯»å’Œä¸Šé¢è¯´åˆ°çš„è¯»ä¸ä¸€æ ·ï¼Œæ›´æ–°ä¹‹å‰çš„è¯»å«åšâ€œå½“å‰è¯»â€ï¼Œæ€»æ˜¯å½“å‰ç‰ˆæœ¬çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯å¤šç‰ˆæœ¬ä¸­æœ€æ–°ä¸€æ¬¡æäº¤çš„é‚£ç‰ˆã€‚\nå‡è®¾äº‹åŠ¡Aæ‰§è¡Œ update æ“ä½œï¼Œ update çš„æ—¶å€™è¦å¯¹æ‰€ä¿®æ”¹çš„è¡ŒåŠ è¡Œé”ï¼Œè¿™ä¸ªè¡Œé”ä¼šåœ¨æäº¤ä¹‹åæ‰é‡Šæ”¾ã€‚è€Œåœ¨äº‹åŠ¡Aæäº¤ä¹‹å‰ï¼Œäº‹åŠ¡Bä¹Ÿæƒ³ update è¿™è¡Œæ•°æ®ï¼Œäºæ˜¯ç”³è¯·è¡Œé”ï¼Œä½†æ˜¯ç”±äºå·²ç»è¢«äº‹åŠ¡Aå æœ‰ï¼Œäº‹åŠ¡Bæ˜¯ç”³è¯·ä¸åˆ°çš„ï¼Œæ­¤æ—¶ï¼Œäº‹åŠ¡Bå°±ä¼šä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°äº‹åŠ¡Aæäº¤ï¼Œäº‹åŠ¡Bæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œå¦‚æœäº‹åŠ¡Açš„æ—¶é—´å¤ªé•¿ï¼Œé‚£ä¹ˆäº‹åŠ¡Bå¾ˆæœ‰å¯èƒ½å‡ºç°è¶…æ—¶å¼‚å¸¸ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\nåŠ é”çš„è¿‡ç¨‹è¦åˆ†æœ‰ç´¢å¼•å’Œæ— ç´¢å¼•ä¸¤ç§æƒ…å†µï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ¡è¯­å¥\n1 update user set age=11 where id = 1 id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ï¼Œæ˜¯æœ‰ç´¢å¼•çš„æƒ…å†µï¼Œé‚£ä¹ˆ MySQL ç›´æ¥å°±åœ¨ç´¢å¼•æ•°ä¸­æ‰¾åˆ°äº†è¿™è¡Œæ•°æ®ï¼Œç„¶åå¹²å‡€åˆ©è½çš„åŠ ä¸Šè¡Œé”å°±å¯ä»¥äº†ã€‚\nè€Œä¸‹é¢è¿™æ¡è¯­å¥\n1 update user set age=11 where age=10 è¡¨ä¸­å¹¶æ²¡æœ‰ä¸º age å­—æ®µè®¾ç½®ç´¢å¼•ï¼Œæ‰€ä»¥ï¼Œ MySQL æ— æ³•ç›´æ¥å®šä½åˆ°è¿™è¡Œæ•°æ®ã€‚é‚£æ€ä¹ˆåŠå‘¢ï¼Œå½“ç„¶ä¹Ÿä¸æ˜¯åŠ è¡¨é”äº†ã€‚MySQL ä¼šä¸ºè¿™å¼ è¡¨ä¸­æ‰€æœ‰è¡ŒåŠ è¡Œé”ï¼Œæ²¡é”™ï¼Œæ˜¯æ‰€æœ‰è¡Œã€‚ä½†æ˜¯å‘¢ï¼Œåœ¨åŠ ä¸Šè¡Œé”åï¼ŒMySQL ä¼šè¿›è¡Œä¸€éè¿‡æ»¤ï¼Œå‘ç°ä¸æ»¡è¶³çš„è¡Œå°±é‡Šæ”¾é”ï¼Œæœ€ç»ˆåªç•™ä¸‹ç¬¦åˆæ¡ä»¶çš„è¡Œã€‚è™½ç„¶æœ€ç»ˆåªä¸ºç¬¦åˆæ¡ä»¶çš„è¡ŒåŠ äº†é”ï¼Œä½†æ˜¯è¿™ä¸€é”ä¸€é‡Šæ”¾çš„è¿‡ç¨‹å¯¹æ€§èƒ½ä¹Ÿæ˜¯å½±å“æå¤§çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ˜¯å¤§è¡¨çš„è¯ï¼Œå»ºè®®åˆç†è®¾è®¡ç´¢å¼•ï¼Œå¦‚æœçœŸçš„å‡ºç°è¿™ç§æƒ…å†µï¼Œé‚£å¾ˆéš¾ä¿è¯å¹¶å‘åº¦ã€‚","title":"MySqläº‹åŠ¡"},{"content":"ä¸€ï¼ŒSQLè¯­å¥æ€§èƒ½ä¼˜åŒ– å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œåº”å°½é‡é¿å…å…¨è¡¨æ‰«æï¼Œé¦–å…ˆåº”è€ƒè™‘åœ¨ where åŠ order by æ¶‰åŠçš„åˆ—ä¸Šå»ºç«‹ç´¢å¼•ã€‚\nåº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œ null å€¼åˆ¤æ–­ï¼Œåˆ›å»ºè¡¨æ—¶NULLæ˜¯é»˜è®¤å€¼ï¼Œä½†å¤§å¤šæ•°æ—¶å€™åº”è¯¥ä½¿ç”¨NOT NULLï¼Œæˆ–è€…ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„å€¼ï¼Œå¦‚0ï¼Œ-1ä½œä¸ºé»˜ è®¤å€¼ã€‚\nåº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨!=æˆ–\u0026lt;\u0026gt;æ“ä½œç¬¦ï¼Œ MySQLåªæœ‰å¯¹ä»¥ä¸‹æ“ä½œç¬¦æ‰ä½¿ç”¨ç´¢å¼•ï¼š\u0026lt;ï¼Œ\u0026lt;=ï¼Œ=ï¼Œ\u0026gt;ï¼Œ\u0026gt;=ï¼ŒBETWEENï¼ŒINï¼Œä»¥åŠæŸäº›æ—¶å€™çš„LIKE\nåº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨ or æ¥è¿æ¥æ¡ä»¶ï¼Œ å¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œ å¯ä»¥ ä½¿ç”¨UNIONåˆå¹¶æŸ¥è¯¢ï¼š select id from t where num=10 union all select id from t where num=20\nin å’Œ not in ä¹Ÿè¦æ…ç”¨ï¼Œå¦åˆ™ä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼Œå¯¹äºè¿ç»­çš„æ•°å€¼ï¼Œèƒ½ç”¨ between å°±ä¸è¦ç”¨ in äº†ï¼šSelect id from t where num between 1 and 3\nä¸‹é¢çš„æŸ¥è¯¢ä¹Ÿå°†å¯¼è‡´å…¨è¡¨æ‰«æï¼šselect id from t where name like â€˜%abc%â€™ æˆ–è€…select id from t where name like â€˜%abcâ€™è‹¥è¦æé«˜æ•ˆç‡ï¼Œå¯ä»¥è€ƒè™‘å…¨æ–‡æ£€ç´¢ã€‚è€Œselect id from t where name like â€˜abc%â€™ æ‰ç”¨åˆ°ç´¢å¼•\nå¦‚æœåœ¨ where å­å¥ä¸­ä½¿ç”¨å‚æ•°ï¼Œä¹Ÿä¼šå¯¼è‡´å…¨è¡¨æ‰«æã€‚\nåº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œè¡¨è¾¾å¼æ“ä½œï¼Œåº”å°½é‡é¿å…åœ¨whereå­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œå‡½æ•°æ“ä½œ\nå¾ˆå¤šæ—¶å€™ç”¨ exists ä»£æ›¿ in æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ï¼š select num from a where num in(select num from b).ç”¨ä¸‹é¢çš„è¯­å¥æ›¿æ¢ï¼š select num from a where exists(select 1 from b where num=a.num)\nç´¢å¼•å›ºç„¶å¯ä»¥æé«˜ç›¸åº”çš„ select çš„æ•ˆç‡ï¼Œä½†åŒæ—¶ä¹Ÿé™ä½äº† insert åŠ update çš„æ•ˆç‡ï¼Œå› ä¸º insert æˆ– update æ—¶æœ‰å¯èƒ½ä¼šé‡å»ºç´¢å¼•ï¼Œæ‰€ä»¥æ€æ ·å»ºç´¢å¼•éœ€è¦æ…é‡è€ƒè™‘ï¼Œè§†å…·ä½“æƒ…å†µè€Œå®šã€‚ä¸€ä¸ªè¡¨çš„ç´¢å¼•æ•°æœ€å¥½ä¸è¦è¶…è¿‡6ä¸ªï¼Œè‹¥å¤ªå¤šåˆ™åº”è€ƒè™‘ä¸€äº›ä¸å¸¸ä½¿ç”¨åˆ°çš„åˆ—ä¸Šå»ºçš„ç´¢å¼•æ˜¯å¦æœ‰å¿…è¦\nåº”å°½å¯èƒ½çš„é¿å…æ›´æ–° clustered ç´¢å¼•æ•°æ®åˆ—ï¼Œ å› ä¸º clustered ç´¢å¼•æ•°æ®åˆ—çš„é¡ºåºå°±æ˜¯è¡¨è®°å½•çš„ç‰©ç†å­˜å‚¨é¡ºåºï¼Œä¸€æ—¦è¯¥åˆ—å€¼æ”¹å˜å°†å¯¼è‡´æ•´ä¸ªè¡¨è®°å½•çš„é¡ºåºçš„è°ƒæ•´ï¼Œä¼šè€—è´¹ç›¸å½“å¤§çš„èµ„æºã€‚è‹¥åº”ç”¨ç³»ç»Ÿéœ€è¦é¢‘ç¹æ›´æ–° clustered ç´¢å¼•æ•°æ®åˆ—ï¼Œé‚£ä¹ˆéœ€è¦è€ƒè™‘æ˜¯å¦åº”å°†è¯¥ç´¢å¼•å»ºä¸º clustered ç´¢å¼•ã€‚\nå°½é‡ä½¿ç”¨æ•°å­—å‹å­—æ®µï¼Œè‹¥åªå«æ•°å€¼ä¿¡æ¯çš„å­—æ®µå°½é‡ä¸è¦è®¾è®¡ä¸ºå­—ç¬¦å‹ï¼Œè¿™ä¼šé™ä½æŸ¥è¯¢å’Œè¿æ¥çš„æ€§èƒ½ï¼Œå¹¶ä¼šå¢åŠ å­˜å‚¨å¼€é”€ã€‚\nå°½å¯èƒ½çš„ä½¿ç”¨ varchar/nvarchar ä»£æ›¿ char/nchar ï¼Œ å› ä¸ºé¦–å…ˆå˜é•¿å­—æ®µå­˜å‚¨ç©ºé—´å°ï¼Œå¯ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œå…¶æ¬¡å¯¹äºæŸ¥è¯¢æ¥è¯´ï¼Œåœ¨ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„å­—æ®µå†…æœç´¢æ•ˆç‡æ˜¾ç„¶è¦é«˜äº›ã€‚\næœ€å¥½ä¸è¦ä½¿ç”¨â€â€œè¿”å›æ‰€æœ‰ï¼š select * from t ï¼Œç”¨å…·ä½“çš„å­—æ®µåˆ—è¡¨ä»£æ›¿â€œ*â€ï¼Œä¸è¦è¿”å›ç”¨ä¸åˆ°çš„ä»»ä½•å­—æ®µã€‚\nå°½é‡é¿å…å‘å®¢æˆ·ç«¯è¿”å›å¤§æ•°æ®é‡ï¼Œè‹¥æ•°æ®é‡è¿‡å¤§ï¼Œåº”è¯¥è€ƒè™‘ç›¸åº”éœ€æ±‚æ˜¯å¦åˆç†ã€‚\nä½¿ç”¨è¡¨çš„åˆ«å(Alias)ï¼šå½“åœ¨SQLè¯­å¥ä¸­è¿æ¥å¤šä¸ªè¡¨æ—¶,è¯·ä½¿ç”¨è¡¨çš„åˆ«åå¹¶æŠŠåˆ«åå‰ç¼€äºæ¯ä¸ªColumnä¸Š.è¿™æ ·ä¸€æ¥,å°±å¯ä»¥å‡å°‘è§£æçš„æ—¶é—´å¹¶å‡å°‘é‚£äº›ç”±Columnæ­§ä¹‰å¼•èµ·çš„è¯­æ³•é”™è¯¯ã€‚\nä½¿ç”¨â€œä¸´æ—¶è¡¨â€æš‚å­˜ä¸­é—´ç»“æœ ç®€åŒ–SQLè¯­å¥çš„é‡è¦æ–¹æ³•å°±æ˜¯é‡‡ç”¨ä¸´æ—¶è¡¨æš‚å­˜ä¸­é—´ç»“æœï¼Œä½†æ˜¯ï¼Œä¸´æ—¶è¡¨çš„å¥½å¤„è¿œè¿œä¸æ­¢è¿™äº›ï¼Œå°†ä¸´æ—¶ç»“æœæš‚å­˜åœ¨ä¸´æ—¶è¡¨ï¼Œåé¢çš„æŸ¥è¯¢å°±åœ¨tempdbä¸­äº†ï¼Œè¿™å¯ä»¥é¿å…ç¨‹åºä¸­å¤šæ¬¡æ‰«æä¸»è¡¨ï¼Œä¹Ÿå¤§å¤§å‡å°‘äº†ç¨‹åºæ‰§è¡Œä¸­â€œå…±äº«é”â€é˜»å¡â€œæ›´æ–°é”â€ï¼Œå‡å°‘äº†é˜»å¡ï¼Œæé«˜äº†å¹¶å‘æ€§èƒ½ã€‚\nä¸€äº›SQLæŸ¥è¯¢è¯­å¥åº”åŠ ä¸Šnolockï¼Œè¯»ã€å†™æ˜¯ä¼šç›¸äº’é˜»å¡çš„ï¼Œä¸ºäº†æé«˜å¹¶å‘æ€§èƒ½ï¼Œå¯¹äºä¸€äº›æŸ¥è¯¢ï¼Œå¯ä»¥åŠ ä¸Šnolockï¼Œè¿™æ ·è¯»çš„æ—¶å€™å¯ä»¥å…è®¸å†™ï¼Œä½†ç¼ºç‚¹æ˜¯å¯èƒ½è¯»åˆ°æœªæäº¤çš„è„æ•°æ®ã€‚ä½¿ç”¨ nolockæœ‰3æ¡åŸåˆ™ã€‚æŸ¥è¯¢çš„ç»“æœç”¨äºâ€œæ’ã€åˆ ã€æ”¹â€çš„ä¸èƒ½åŠ nolock ï¼æŸ¥è¯¢çš„è¡¨å±äºé¢‘ç¹å‘ç”Ÿé¡µåˆ†è£‚çš„ï¼Œæ…ç”¨nolock ï¼ä½¿ç”¨ä¸´æ—¶è¡¨ä¸€æ ·å¯ä»¥ä¿å­˜â€œæ•°æ®å‰å½±â€ï¼Œèµ·åˆ°ç±»ä¼¼Oracleçš„undoè¡¨ç©ºé—´çš„åŠŸèƒ½ï¼Œèƒ½é‡‡ç”¨ä¸´æ—¶è¡¨æé«˜å¹¶å‘æ€§èƒ½çš„ï¼Œä¸è¦ç”¨nolock ã€‚\nå¸¸è§çš„ç®€åŒ–è§„åˆ™å¦‚ä¸‹ï¼šä¸è¦æœ‰è¶…è¿‡5ä¸ªä»¥ä¸Šçš„è¡¨è¿æ¥ï¼ˆJOINï¼‰ï¼Œè€ƒè™‘ä½¿ç”¨ä¸´æ—¶è¡¨æˆ–è¡¨å˜é‡å­˜æ”¾ä¸­é—´ç»“æœã€‚å°‘ç”¨å­æŸ¥è¯¢ï¼Œè§†å›¾åµŒå¥—ä¸è¦è¿‡æ·±,ä¸€èˆ¬è§†å›¾åµŒå¥—ä¸è¦è¶…è¿‡2ä¸ªä¸ºå®œã€‚\nå°†éœ€è¦æŸ¥è¯¢çš„ç»“æœé¢„å…ˆè®¡ç®—å¥½æ”¾åœ¨è¡¨ä¸­ï¼ŒæŸ¥è¯¢çš„æ—¶å€™å†Selectã€‚è¿™åœ¨SQL7.0ä»¥å‰æ˜¯æœ€é‡è¦çš„æ‰‹æ®µã€‚ä¾‹å¦‚åŒ»é™¢çš„ä½é™¢è´¹è®¡ç®—ã€‚\nå°½é‡ä½¿ç”¨existsä»£æ›¿select count(1)æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨è®°å½•ï¼Œcountå‡½æ•°åªæœ‰åœ¨ç»Ÿè®¡è¡¨ä¸­æ‰€æœ‰è¡Œæ•°æ—¶ä½¿ç”¨ï¼Œè€Œä¸”count(1)æ¯”count(*)æ›´æœ‰æ•ˆç‡ã€‚\nå°½é‡ä½¿ç”¨â€œ\u0026gt;=â€ï¼Œä¸è¦ä½¿ç”¨â€œ\u0026gt;â€\nç´¢å¼•çš„ä½¿ç”¨è§„èŒƒï¼šç´¢å¼•çš„åˆ›å»ºè¦ä¸åº”ç”¨ç»“åˆè€ƒè™‘ï¼Œå»ºè®®å¤§çš„OLTPè¡¨ä¸è¦è¶…è¿‡6ä¸ªç´¢å¼•ï¼›å°½å¯èƒ½çš„ä½¿ç”¨ç´¢å¼•å­—æ®µä½œä¸ºæŸ¥è¯¢æ¡ä»¶ï¼Œå°¤å…¶æ˜¯èšç°‡ç´¢å¼•ï¼Œå¿…è¦æ—¶å¯ä»¥é€šè¿‡index index_nameæ¥å¼ºåˆ¶æŒ‡å®šç´¢å¼•ï¼›é¿å…å¯¹å¤§è¡¨æŸ¥è¯¢æ—¶è¿›è¡Œtable scanï¼Œå¿…è¦æ—¶è€ƒè™‘æ–°å»ºç´¢å¼•ï¼›åœ¨ä½¿ç”¨ç´¢å¼•å­—æ®µä½œä¸ºæ¡ä»¶æ—¶ï¼Œå¦‚æœè¯¥ç´¢å¼•æ˜¯è”åˆç´¢å¼•ï¼Œé‚£ä¹ˆå¿…é¡»ä½¿ç”¨åˆ°è¯¥ç´¢å¼•ä¸­çš„ç¬¬ä¸€ä¸ªå­—æ®µä½œä¸ºæ¡ä»¶æ—¶æ‰èƒ½ä¿è¯ç³»ç»Ÿä½¿ç”¨è¯¥ç´¢å¼•ï¼Œå¦åˆ™è¯¥ç´¢å¼•å°†ä¸ä¼šè¢«ä½¿ç”¨ï¼›è¦æ³¨æ„ç´¢å¼•çš„ç»´æŠ¤ï¼Œå‘¨æœŸæ€§é‡å»ºç´¢å¼•ï¼Œé‡æ–°ç¼–è¯‘å­˜å‚¨è¿‡ç¨‹ã€‚\näºŒã€ç´¢å¼•é—®é¢˜ æ³•åˆ™ï¼šä¸è¦åœ¨å»ºç«‹çš„ç´¢å¼•çš„æ•°æ®åˆ—ä¸Šè¿›è¡Œä¸‹åˆ—æ“ä½œ:\nâ€‹\tâ—†é¿å…å¯¹ç´¢å¼•å­—æ®µè¿›è¡Œè®¡ç®—æ“ä½œ\nâ€‹\tâ—†é¿å…åœ¨ç´¢å¼•å­—æ®µä¸Šä½¿ç”¨notï¼Œ\u0026lt;\u0026gt;ï¼Œ!=\nâ€‹\tâ—†é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨IS NULLå’ŒIS NOT NULL\nâ€‹\tâ—†é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šå‡ºç°æ•°æ®ç±»å‹è½¬æ¢\nâ€‹\tâ—†é¿å…åœ¨ç´¢å¼•å­—æ®µä¸Šä½¿ç”¨å‡½æ•°\nâ€‹\tâ—†é¿å…å»ºç«‹ç´¢å¼•çš„åˆ—ä¸­ä½¿ç”¨ç©ºå€¼ã€‚\n1. ä»€ä¹ˆæ˜¯æœ€å·¦å‰ç¼€åŸåˆ™ï¼Ÿ å¦‚æœæˆ‘ä»¬æŒ‰ç…§ name å­—æ®µæ¥å»ºç«‹ç´¢å¼•çš„è¯ï¼Œé‡‡ç”¨B+æ ‘çš„ç»“æ„ï¼Œå¤§æ¦‚çš„ç´¢å¼•ç»“æ„å¦‚ä¸‹ï¼š\nå¦‚æœæˆ‘ä»¬è¦è¿›è¡Œæ¨¡ç³ŠæŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾name ä»¥â€œå¼ \u0026quot;å¼€å¤´çš„æ‰€æœ‰äººçš„IDï¼Œå³ sql è¯­å¥ä¸º\n1 select ID from table where name like \u0026#39;å¼ %\u0026#39; ç”±äºåœ¨B+æ ‘ç»“æ„çš„ç´¢å¼•ä¸­ï¼Œç´¢å¼•é¡¹æ˜¯æŒ‰ç…§ç´¢å¼•å®šä¹‰é‡Œé¢å‡ºç°çš„å­—æ®µé¡ºåºæ’åºçš„ï¼Œç´¢å¼•åœ¨æŸ¥æ‰¾çš„æ—¶å€™ï¼Œå¯ä»¥å¿«é€Ÿå®šä½åˆ° ID ä¸º 100çš„å¼ ä¸€ï¼Œç„¶åç›´æ¥å‘å³éå†æ‰€æœ‰å¼ å¼€å¤´çš„äººï¼Œç›´åˆ°æ¡ä»¶ä¸æ»¡è¶³ä¸ºæ­¢ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„äººä¹‹åï¼Œç›´æ¥å‘å³éå†å°±å¯ä»¥äº†ï¼Œç”±äºç´¢å¼•æ˜¯æœ‰åºçš„ï¼Œæ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„äººéƒ½ä¼šèšé›†åœ¨ä¸€èµ·ã€‚\nè€Œè¿™ç§å®šä½åˆ°æœ€å·¦è¾¹ï¼Œç„¶åå‘å³éå†å¯»æ‰¾ï¼Œå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„æœ€å·¦å‰ç¼€åŸåˆ™ã€‚\n2. ä¸ºä»€ä¹ˆç”¨ B+ æ ‘åšç´¢å¼•è€Œä¸ç”¨å“ˆå¸Œè¡¨åšç´¢å¼•? 1ã€å“ˆå¸Œè¡¨æ˜¯æŠŠç´¢å¼•å­—æ®µæ˜ å°„æˆå¯¹åº”çš„å“ˆå¸Œç ç„¶åå†å­˜æ”¾åœ¨å¯¹åº”çš„ä½ç½®ï¼Œè¿™æ ·çš„è¯ï¼Œå¦‚æœæˆ‘ä»¬è¦è¿›è¡Œæ¨¡ç³ŠæŸ¥æ‰¾çš„è¯ï¼Œæ˜¾ç„¶å“ˆå¸Œè¡¨è¿™ç§ç»“æ„æ˜¯ä¸æ”¯æŒçš„ï¼Œåªèƒ½éå†è¿™ä¸ªè¡¨ã€‚è€ŒB+æ ‘åˆ™å¯ä»¥é€šè¿‡æœ€å·¦å‰ç¼€åŸåˆ™å¿«é€Ÿæ‰¾åˆ°å¯¹åº”çš„æ•°æ®\n2ã€å¦‚æœæˆ‘ä»¬è¦è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾ï¼Œä¾‹å¦‚æŸ¥æ‰¾IDä¸º100 ~ 400çš„äººï¼Œå“ˆå¸Œè¡¨åŒæ ·ä¸æ”¯æŒï¼Œåªèƒ½éå†å…¨è¡¨ã€‚\n3ã€ç´¢å¼•å­—æ®µé€šè¿‡å“ˆå¸Œæ˜ å°„æˆå“ˆå¸Œç ï¼Œå¦‚æœå¾ˆå¤šå­—æ®µéƒ½åˆšå¥½æ˜ å°„åˆ°ç›¸åŒå€¼çš„å“ˆå¸Œç çš„è¯ï¼Œé‚£ä¹ˆå½¢æˆçš„ç´¢å¼•ç»“æ„å°†ä¼šæ˜¯ä¸€æ¡å¾ˆé•¿çš„é“¾è¡¨ï¼Œè¿™æ ·çš„è¯ï¼ŒæŸ¥æ‰¾çš„æ—¶é—´å°±ä¼šå¤§å¤§å¢åŠ ã€‚\n3. ä¸»é”®ç´¢å¼•å’Œéä¸»é”®ç´¢å¼•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ä¾‹å¦‚å¯¹äºä¸‹é¢è¿™ä¸ªè¡¨(å…¶å®å°±æ˜¯ä¸Šé¢çš„è¡¨ä¸­å¢åŠ äº†ä¸€ä¸ªkå­—æ®µ),ä¸”IDæ˜¯ä¸»é”®ã€‚\nä¸»é”®ç´¢å¼•å’Œéä¸»é”®ç´¢å¼•çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š\nä»å›¾ä¸­ä¸éš¾çœ‹å‡ºï¼Œä¸»é”®ç´¢å¼•å’Œéä¸»é”®ç´¢å¼•çš„åŒºåˆ«æ˜¯ï¼šéä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®çš„å€¼ï¼Œè€Œä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯æ•´è¡Œæ•°æ®ï¼Œå…¶ä¸­éä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸ºäºŒçº§ç´¢å¼•ï¼Œè€Œä¸»é”®ç´¢å¼•ä¹Ÿè¢«ç§°ä¸ºèšç°‡ç´¢å¼•ã€‚\nå›¾ä¸­å·¦è¾¹è¡¨ç¤ºä¸»é”®ç´¢å¼•ï¼Œå³è¾¹è¡¨ç¤ºéä¸»é”®ç´¢å¼•ï¼Œå›¾ä¸­çš„R1,R2ç­‰éƒ½è¡¨ç¤ºæ•´è¡Œçš„æ•°æ®å†…å®¹ã€‚ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œä¸»é”®ç´¢å¼•ä¿å­˜çš„éƒ½æ˜¯æ•´è¡Œçš„æ•°æ®å†…å®¹ï¼Œè€Œéä¸»é”®ç´¢å¼•åˆ™ä¿å­˜çš„éƒ½æ˜¯æ‰€åœ¨è¡Œçš„è¡Œidã€‚ è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æŸ¥è¯¢æ—¶ï¼Œä»¥ä¸»é”®ç´¢å¼•æŸ¥è¯¢ï¼Œä¼šç›´æ¥è¿”å›ä¸»é”®ç´¢å¼•å¯¹åº”çš„æ•´è¡Œæ•°æ®ï¼›è€Œä»¥éä¸»é”®ç´¢å¼•æŸ¥è¯¢æ—¶ï¼Œä¼šå…ˆè¿”å›å½“å‰ç´¢å¼•å¯¹åº”çš„è¡Œidï¼Œç„¶åæ ¹æ®è¡Œidå»æŸ¥è¯¢å¯¹åº”çš„æ•´è¡Œæ•°æ®ã€‚ æ‰€ä»¥ä»¥ä¸»é”®ç´¢å¼•å½“æŸ¥è¯¢æ¡ä»¶ä¼šæ¯”æ¯”éä¸»é”®ç´¢å¼•å½“æŸ¥è¯¢æ¡ä»¶å¿«ã€‚æœ€åæ— è®ºæ˜¯ä¸»é”®ç´¢å¼•è¿˜æ˜¯éä¸»é”®ç´¢å¼•ï¼ŒæŸ¥è¯¢é€Ÿåº¦éƒ½ä¼šæ¯”ç”¨æ™®é€šå­—æ®µå¿«ã€‚\næ ¹æ®è¿™ä¸¤ç§ç»“æ„æˆ‘ä»¬æ¥è¿›è¡Œä¸‹æŸ¥è¯¢ï¼Œçœ‹çœ‹ä»–ä»¬åœ¨æŸ¥è¯¢ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«ã€‚\n1ã€å¦‚æœæŸ¥è¯¢è¯­å¥æ˜¯ select * from table where ID = 100,å³ä¸»é”®æŸ¥è¯¢çš„æ–¹å¼ï¼Œåˆ™åªéœ€è¦æœç´¢ ID è¿™æ£µ B+æ ‘ã€‚\n2ã€å¦‚æœæŸ¥è¯¢è¯­å¥æ˜¯ select * from table where k = 1ï¼Œå³éä¸»é”®çš„æŸ¥è¯¢æ–¹å¼ï¼Œåˆ™å…ˆæœç´¢kç´¢å¼•æ ‘ï¼Œå¾—åˆ°ID=100,å†åˆ°IDç´¢å¼•æ ‘æœç´¢ä¸€æ¬¡ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿè¢«ç§°ä¸ºå›è¡¨ã€‚\n4. ä¸ºä»€ä¹ˆå»ºè®®ä½¿ç”¨ä¸»é”®è‡ªå¢çš„ç´¢å¼•ï¼Ÿ å¯¹äºè¿™é¢—ä¸»é”®ç´¢å¼•çš„æ ‘\nå¦‚æœæˆ‘ä»¬æ’å…¥ ID = 650 çš„ä¸€è¡Œæ•°æ®ï¼Œé‚£ä¹ˆç›´æ¥åœ¨æœ€å³è¾¹æ’å…¥å°±å¯ä»¥äº†\nä½†æ˜¯å¦‚æœæ’å…¥çš„æ˜¯ ID = 350 çš„ä¸€è¡Œæ•°æ®ï¼Œç”±äº B+ æ ‘æ˜¯æœ‰åºçš„ï¼Œé‚£ä¹ˆéœ€è¦å°†ä¸‹é¢çš„å¶å­èŠ‚ç‚¹è¿›è¡Œç§»åŠ¨ï¼Œè…¾å‡ºä½ç½®æ¥æ’å…¥ ID = 350 çš„æ•°æ®ï¼Œè¿™æ ·å°±ä¼šæ¯”è¾ƒæ¶ˆè€—æ—¶é—´ï¼Œå¦‚æœåˆšå¥½ R4 æ‰€åœ¨çš„æ•°æ®é¡µå·²ç»æ»¡äº†ï¼Œéœ€è¦è¿›è¡Œé¡µåˆ†è£‚æ“ä½œï¼Œè¿™æ ·ä¼šæ›´åŠ ç³Ÿç³•ã€‚\nä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„ä¸»é”®æ˜¯è‡ªå¢çš„ï¼Œæ¯æ¬¡æ’å…¥çš„ ID éƒ½ä¼šæ¯”å‰é¢çš„å¤§ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¯æ¬¡åªéœ€è¦åœ¨åé¢æ’å…¥å°±è¡Œï¼Œ ä¸éœ€è¦ç§»åŠ¨ä½ç½®ã€åˆ†è£‚ç­‰æ“ä½œï¼Œè¿™æ ·å¯ä»¥æé«˜æ€§èƒ½ã€‚ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå»ºè®®ä½¿ç”¨ä¸»é”®è‡ªå¢çš„ç´¢å¼•ã€‚\nä¸‰ã€è¡¨çš„è®¾è®¡ 0ã€å¿…é¡»ä½¿ç”¨é»˜è®¤çš„InnoDBå­˜å‚¨å¼•æ“\u0026ndash;æ”¯æŒäº‹åŠ¡ã€è¡Œçº§é”ã€å¹¶å‘æ€§èƒ½å¥½ã€CPUåŠå†…å­˜ç¼“å­˜é¡µä¼˜åŒ–ä½¿å¾—èµ„æºåˆ©ç”¨ç‡é«˜ 1ã€è¡¨å’Œå­—æ®µä½¿ç”¨ä¸­æ–‡æ³¨é‡Š\u0026ndash;ä¾¿äºåäººç†è§£ 2ã€ä½¿ç”¨é»˜è®¤utf8mb4å­—ç¬¦é›†\u0026ndash;æ ‡å‡†ã€ä¸‡å›½ç ã€æ— ä¹±ç é£é™©ã€æ— éœ€è½¬ç  3ã€ç¦æ­¢ä½¿ç”¨è§¦å‘å™¨ã€è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹å’Œevent 4ã€ç¦æ­¢ä½¿ç”¨å¤–é”®\u0026ndash;å¤–é”®å¯¼è‡´è¡¨ä¹‹é—´çš„è€¦åˆï¼Œupdateå’Œdeleteæ“ä½œéƒ½ä¼šæ¶‰åŠç›¸å…³è¡¨ï¼Œå½±å“æ€§èƒ½ \u0026ndash;æ¶æ„æ–¹å‘ï¼šå¯¹æ•°æ®åº“æ€§èƒ½å½±å“è¾ƒå¤§çš„ç‰¹æ€§å°‘ç”¨ï¼›åº”å°†è®¡ç®—é›†ä¸­åœ¨æœåŠ¡å±‚ï¼Œè§£æ”¾æ•°æ®åº“CPUï¼›æ•°æ®åº“æ“…é•¿ç´¢å¼•å’Œå­˜å‚¨ï¼Œå‹¿è®©æ•°æ®åº“èƒŒè´Ÿé‡è´Ÿ 5ã€ç¦æ­¢å­˜å¤§æ–‡ä»¶æˆ–è€…ç…§ç‰‡\u0026ndash;åœ¨æ•°æ®åº“é‡Œå­˜å‚¨URI å­—æ®µï¼š 6ã€å¿…é¡»æŠŠå­—æ®µå®šä¹‰ä¸ºNOT NULLå¹¶è®¾ç½®é»˜è®¤å€¼\u0026ndash;nullå€¼éœ€è¦æ›´å¤šçš„å­˜å‚¨ç©ºé—´ï¼› å­—æ®µä¸­æœ‰nullå€¼çš„è¯,name != \u0026lsquo;san\u0026rsquo; æŸ¥è¯¢ç»“æœä¸­ä¸åŒ…å«name is nullçš„è®°å½• 7ã€ç¦æ­¢ä½¿ç”¨TEXT/BOLBå­—æ®µç±»å‹\u0026ndash;æµªè´¹ç£ç›˜å’Œå†…å­˜ç©ºé—´ï¼Œéå¿…è¦çš„å¤§é‡çš„å¤§å­—æ®µæŸ¥è¯¢å¯¼è‡´å†…å­˜å‘½ä¸­ç‡é™ä½ï¼Œå½±å“æ•°æ®åº“æ€§èƒ½ ç´¢å¼•ï¼š 8ã€å•è¡¨ç´¢å¼•æ§åˆ¶åœ¨5ä¸ªä»¥å†… 9ã€å•ç´¢å¼•ä¸è¶…è¿‡5ä¸ªå­—æ®µ\u0026ndash;è¶…è¿‡5ä¸ªä»¥åŠèµ·ä¸åˆ°æœ‰æ•ˆè¿‡æ»¤æ•°æ®çš„æ•ˆæœ 10ã€å»ºç«‹ç»„åˆç´¢å¼•ï¼Œå¿…é¡»æŠŠåŒºåˆ†åº¦é«˜çš„å­—æ®µæ”¾åœ¨å‰è¾¹\u0026ndash;æ›´åŠ æœ‰æ•ˆçš„è¿‡æ»¤æ•°æ® 11ã€æ•°æ®åŒºåˆ†åº¦ä¸å¤§çš„å­—æ®µä¸æ˜“ä½¿ç”¨ç´¢å¼•\u0026ndash;ä¾‹å¦‚ï¼šæ€§åˆ«åªæœ‰ç”·ï¼Œå¥³ï¼Œè®¢å•çŠ¶æ€ï¼Œæ¯æ¬¡è¿‡æ»¤æ•°æ®å¾ˆå°‘\nå››ã€SQLæŸ¥è¯¢è§„èŒƒï¼š 1ã€ç¦æ­¢ä½¿ç”¨select *ï¼Œåªè·å–éœ€è¦çš„å­—æ®µ\u0026ndash;æŸ¥è¯¢å¾ˆå¤šæ— ç”¨å­—æ®µï¼Œå¢åŠ CPU/IO/NETæ¶ˆè€—ï¼›ä¸èƒ½æœ‰æ•ˆçš„åˆ©ç”¨è¦†ç›–ç´¢å¼•ï¼›å¢åˆ å­—æ®µæ˜“å‡ºbug 2ã€ç¦æ­¢ä½¿ç”¨å±æ€§çš„éšå¼è½¬æ¢select * from customer where phone=123123\u0026ndash;ä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼Œä¸èƒ½å‘½ä¸­ç´¢å¼• 3ã€ç¦æ­¢åœ¨whereæ¡ä»¶ä¸Šä½¿ç”¨å‡½æ•°å’Œè®¡ç®— 4ã€ç¦æ­¢è´Ÿå‘æŸ¥è¯¢ï¼ˆNOT != \u0026lt;\u0026gt; !\u0026lt; !\u0026gt; MOT IN NOT LIKEï¼‰å’Œ%å¼€å¤´çš„likeï¼ˆå‰å¯¼æ¨¡ç³ŠæŸ¥è¯¢ï¼‰\u0026ndash;ä¼šå¯¼è‡´å…¨è¡¨æ‰«æ 5ã€ç¦æ­¢å¤§è¡¨ä½¿ç”¨JOINæŸ¥è¯¢å’Œå­æŸ¥è¯¢\u0026ndash;ä¼šäº§ç”Ÿä¸´æ—¶è¡¨ï¼Œæ¶ˆè€—è¾ƒå¤šCPUå’Œå†…å­˜ï¼Œå½±å“æ•°æ®åº“æ€§èƒ½ 6ã€åœ¨å±æ€§ä¸Šè¿›è¡Œè®¡ç®—ä¸èƒ½å‘½ä¸­ç´¢å¼•\u0026ndash;å¦‚ select * from order where YEAR(date) \u0026lt;= \u0026lsquo;2017\u0026rsquo;ä¸èƒ½å‘½ä¸­ç´¢å¼•å¯¼è‡´å…¨è¡¨æ‰«æ 7ã€å¤åˆç´¢å¼•æœ€å·¦å‰ç¼€\u0026ndash;ä¾‹å¦‚user è¡¨å»ºç«‹äº†ï¼ˆuserid,phoneï¼‰çš„è”åˆç´¢å¼• æœ‰å¦‚ä¸‹å‡ ç§å†™æ³•ï¼š ï¼ˆ1ï¼‰select * from user where userid = ? and phone = ? (2)select * from user where phone=? and userid= ? (3)select * from user where phone = ? (4)select * from user where userid = ? å…¶ä¸­ï¼ˆ1ï¼‰ï¼ˆ2ï¼‰ï¼ˆ4ï¼‰å¯ä»¥å‘½ä¸­ç´¢å¼•ï¼Œï¼ˆ3ï¼‰ä¼šå¯¼è‡´å…¨è¡¨æ‰«æ\n","permalink":"https://reid00.github.io/en/posts/storage/mysql%E8%AF%AD%E5%8F%A5%E4%BC%98%E5%8C%96/","summary":"ä¸€ï¼ŒSQLè¯­å¥æ€§èƒ½ä¼˜åŒ– å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œåº”å°½é‡é¿å…å…¨è¡¨æ‰«æï¼Œé¦–å…ˆåº”è€ƒè™‘åœ¨ where åŠ order by æ¶‰åŠçš„åˆ—ä¸Šå»ºç«‹ç´¢å¼•ã€‚\nåº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œ null å€¼åˆ¤æ–­ï¼Œåˆ›å»ºè¡¨æ—¶NULLæ˜¯é»˜è®¤å€¼ï¼Œä½†å¤§å¤šæ•°æ—¶å€™åº”è¯¥ä½¿ç”¨NOT NULLï¼Œæˆ–è€…ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„å€¼ï¼Œå¦‚0ï¼Œ-1ä½œä¸ºé»˜ è®¤å€¼ã€‚\nåº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨!=æˆ–\u0026lt;\u0026gt;æ“ä½œç¬¦ï¼Œ MySQLåªæœ‰å¯¹ä»¥ä¸‹æ“ä½œç¬¦æ‰ä½¿ç”¨ç´¢å¼•ï¼š\u0026lt;ï¼Œ\u0026lt;=ï¼Œ=ï¼Œ\u0026gt;ï¼Œ\u0026gt;=ï¼ŒBETWEENï¼ŒINï¼Œä»¥åŠæŸäº›æ—¶å€™çš„LIKE\nåº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨ or æ¥è¿æ¥æ¡ä»¶ï¼Œ å¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œ å¯ä»¥ ä½¿ç”¨UNIONåˆå¹¶æŸ¥è¯¢ï¼š select id from t where num=10 union all select id from t where num=20\nin å’Œ not in ä¹Ÿè¦æ…ç”¨ï¼Œå¦åˆ™ä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼Œå¯¹äºè¿ç»­çš„æ•°å€¼ï¼Œèƒ½ç”¨ between å°±ä¸è¦ç”¨ in äº†ï¼šSelect id from t where num between 1 and 3\nä¸‹é¢çš„æŸ¥è¯¢ä¹Ÿå°†å¯¼è‡´å…¨è¡¨æ‰«æï¼šselect id from t where name like â€˜%abc%â€™ æˆ–è€…select id from t where name like â€˜%abcâ€™è‹¥è¦æé«˜æ•ˆç‡ï¼Œå¯ä»¥è€ƒè™‘å…¨æ–‡æ£€ç´¢ã€‚è€Œselect id from t where name like â€˜abc%â€™ æ‰ç”¨åˆ°ç´¢å¼•","title":"MySqlè¯­å¥ä¼˜åŒ–"},{"content":"å¸¸è§çš„æ€§èƒ½æ£€æµ‹å·¥å…· TOP topæ˜¯æœ€å¸¸ç”¨çš„Linuxæ€§èƒ½ç›‘æµ‹å·¥å…·ä¹‹ä¸€ã€‚é€šè¿‡topå·¥å…·å¯ä»¥ç›‘è§†è¿›ç¨‹å’Œç³»ç»Ÿæ•´ä½“æ€§èƒ½ã€‚\nå¸¸è§å‘½ä»¤ä¸€è§ˆ å®‰è£…æ–¹å¼ ç³»ç»Ÿè‡ªå¸¦ï¼Œæ— éœ€å®‰è£…\nä½¿ç”¨æ–¹æ³• ä½¿ç”¨topå‘½ä»¤ç»Ÿè®¡æ•´ä½“CPUã€å†…å­˜èµ„æºæ¶ˆè€—ã€‚ CPUé¡¹ï¼šæ˜¾ç¤ºå½“å‰æ€»çš„CPUæ—¶é—´ä½¿ç”¨åˆ†å¸ƒã€‚ usè¡¨ç¤ºç”¨æˆ·æ€ç¨‹åºå ç”¨çš„CPUæ—¶é—´ç™¾åˆ†æ¯”ã€‚ syè¡¨ç¤ºå†…æ ¸æ€ç¨‹åºæ‰€å ç”¨çš„CPUæ—¶é—´ç™¾åˆ†æ¯”ã€‚ waè¡¨ç¤ºç­‰å¾…IOç­‰å¾…å ç”¨çš„CPUæ—¶é—´ç™¾åˆ†æ¯”ã€‚ hiè¡¨ç¤ºç¡¬ä¸­æ–­æ‰€å ç”¨çš„CPUæ—¶é—´ç™¾åˆ†æ¯”ã€‚ siè¡¨ç¤ºè½¯ä¸­æ–­æ‰€å ç”¨çš„CPUæ—¶é—´ç™¾åˆ†æ¯”ã€‚ é€šè¿‡è¿™äº›å‚æ•°æˆ‘ä»¬å¯ä»¥åˆ†æCPUæ—¶é—´çš„åˆ†å¸ƒï¼Œæ˜¯å¦æœ‰è¾ƒå¤šçš„IOç­‰å¾…ã€‚åœ¨æ‰§è¡Œå®Œè°ƒä¼˜æ­¥éª¤åï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹CPUä½¿ç”¨æ—¶é—´è¿›è¡Œå‰åå¯¹æ¯”ã€‚å¦‚æœåœ¨è¿è¡Œç›¸åŒç¨‹åºã€ä¸šåŠ¡æƒ…å†µä¸‹CPUä½¿ç”¨æ—¶é—´é™ä½ï¼Œè¯´æ˜æ€§èƒ½æœ‰æå‡ã€‚\nKiB Memï¼šè¡¨ç¤ºæœåŠ¡å™¨çš„æ€»å†…å­˜å¤§å°ä»¥åŠä½¿ç”¨æƒ…å†µã€‚ KiB Swapï¼šè¡¨ç¤ºå½“å‰æ‰€ä½¿ç”¨çš„Swapç©ºé—´çš„å¤§å°ã€‚Swapç©ºé—´å³å½“å†…å­˜ä¸è¶³çš„æ—¶å€™ï¼ŒæŠŠä¸€éƒ¨åˆ†ç¡¬ç›˜ç©ºé—´è™šæ‹Ÿæˆå†…å­˜ä½¿ç”¨ã€‚å¦‚æœå½“å‰æ‰€ä½¿ç”¨çš„Swapç©ºé—´å¤§äº0ï¼Œå¯ä»¥è€ƒè™‘ä¼˜åŒ–åº”ç”¨çš„å†…å­˜å ç”¨æˆ–å¢åŠ ç‰©ç†å†…å­˜ã€‚ åœ¨topå‘½ä»¤æ‰§è¡ŒåæŒ‰1ï¼ŒæŸ¥çœ‹æ¯ä¸ªCPU coreçš„ä½¿ç”¨æƒ…å†µã€‚ é€šè¿‡è¯¥å‘½ä»¤å¯ä»¥æŸ¥çœ‹å•ä¸ªCPU coreçš„ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœCPUå ç”¨é›†ä¸­åœ¨æŸå‡ ä¸ªCPU coreä¸Šï¼Œå¯ä»¥ç»“åˆä¸šåŠ¡åˆ†æè§¦å‘åŸå› ï¼Œä»è€Œæ‰¾åˆ°ä¼˜åŒ–æ€è·¯ã€‚ é€‰ä¸­topå‘½ä»¤çš„Pé€‰é¡¹ï¼ŒæŸ¥çœ‹çº¿ç¨‹è¿è¡Œåœ¨å“ªäº› CPU coreä¸Šã€‚ åœ¨topå‘½ä»¤æ‰§è¡ŒåæŒ‰Fï¼Œå¯ä»¥è¿›å…¥topå‘½ä»¤ç®¡ç†ç•Œé¢ã€‚åœ¨è¯¥ç•Œé¢é€šè¿‡ä¸Šä¸‹é”®ç§»åŠ¨å…‰æ ‡åˆ°Pé€‰é¡¹ï¼Œé€šè¿‡ç©ºæ ¼é”®é€‰ä¸­åæŒ‰Escé€€å‡ºï¼Œå³å¯æ˜¾ç¤ºå‡ºçº¿ç¨‹è¿è¡Œçš„CPUæ ¸ã€‚è§‚å¯Ÿä¸€æ®µæ—¶é—´ï¼Œè‹¥ä¸šåŠ¡çº¿ç¨‹åœ¨ä¸åŒNUMAèŠ‚ç‚¹å†…çš„CPU coreä¸Šè¿è¡Œï¼Œåˆ™è¯´æ˜å­˜åœ¨è¾ƒå¤šçš„è·¨NUMAè®¿é—®ï¼Œå¯é€šè¿‡NUMAç»‘æ ¸è¿›è¡Œä¼˜åŒ–ã€‚(top -\u0026gt; F -\u0026gt; up/down -\u0026gt; ç©ºæ ¼ -\u0026gt; ESC) ä½¿ç”¨top -p $PID -Hå‘½ä»¤è§‚å¯Ÿè¿›ç¨‹ä¸­æ¯ä¸ªçº¿ç¨‹çš„CPUèµ„æºä½¿ç”¨ã€‚ â€œ-pâ€åæ¥çš„å‚æ•°ä¸ºå¾…è§‚å¯Ÿçš„è¿›ç¨‹IDã€‚é€šè¿‡è¯¥å‘½ä»¤å¯ä»¥æ‰¾å‡ºæ¶ˆè€—èµ„æºå¤šçš„çº¿ç¨‹ï¼Œéšåå¯æ ¹æ®çº¿ç¨‹å·åˆ†æçº¿ç¨‹ä¸­çš„çƒ­ç‚¹å‡½æ•°ã€è°ƒç”¨è¿‡ç¨‹ç­‰æƒ…å†µã€‚ Perf Perfå·¥å…·æ˜¯éå¸¸å¼ºå¤§çš„Linuxæ€§èƒ½åˆ†æå·¥å…·ï¼Œå¯ä»¥é€šè¿‡è¯¥å·¥å…·è·å¾—è¿›ç¨‹å†…çš„è°ƒç”¨æƒ…å†µã€èµ„æºæ¶ˆè€—æƒ…å†µå¹¶æŸ¥æ‰¾åˆ†æçƒ­ç‚¹å‡½æ•°ã€‚\nå¸¸è§å‘½ä»¤ä¸€è§ˆ å®‰è£…æ–¹å¼ centos ä¸ºä¾‹\n1 yum -y install perf ä½¿ç”¨æ–¹å¼ é€šè¿‡perf topå‘½ä»¤æŸ¥æ‰¾çƒ­ç‚¹å‡½æ•°ã€‚ è¯¥å‘½ä»¤ç»Ÿè®¡å„ä¸ªå‡½æ•°åœ¨æŸä¸ªæ€§èƒ½äº‹ä»¶ä¸Šçš„çƒ­åº¦ï¼Œé»˜è®¤æ˜¾ç¤ºCPUå ç”¨ç‡ï¼Œå¯ä»¥é€šè¿‡â€œ-eâ€ç›‘æ§å…¶å®ƒäº‹ä»¶ã€‚ Overheadè¡¨ç¤ºå½“å‰äº‹ä»¶åœ¨å…¨éƒ¨äº‹ä»¶ä¸­å çš„æ¯”ä¾‹ã€‚ Shared Objectè¡¨ç¤ºå½“å‰äº‹ä»¶ç”Ÿäº§è€…ï¼Œå¦‚kernelã€perfå‘½ä»¤ã€Cè¯­è¨€åº“å‡½æ•°ç­‰ã€‚ Symbolåˆ™è¡¨ç¤ºçƒ­ç‚¹äº‹ä»¶å¯¹åº”çš„å‡½æ•°åç§°ã€‚ é€šè¿‡çƒ­ç‚¹å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æ¶ˆè€—èµ„æºè¾ƒå¤šçš„è¡Œä¸ºï¼Œä»è€Œæœ‰é’ˆå¯¹æ€§çš„è¿›è¡Œä¼˜åŒ–ã€‚ æ”¶é›†ä¸€æ®µæ—¶é—´å†…çš„çº¿ç¨‹è°ƒç”¨. perf sched recordå‘½ä»¤ç”¨äºè®°å½•ä¸€æ®µæ—¶é—´å†…ï¼Œè¿›ç¨‹çš„è°ƒç”¨æƒ…å†µã€‚â€œ-pâ€åæ¥è¿›ç¨‹å·ï¼Œâ€œsleepâ€åæ¥ç»Ÿè®¡æ—¶é•¿ï¼Œå•ä½ä¸ºç§’ã€‚æ”¶é›†åˆ°çš„ä¿¡æ¯è‡ªåŠ¨å­˜æ”¾åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åä¸ºperf.dataã€‚ è§£ææ”¶é›†åˆ°çš„çº¿ç¨‹è°ƒåº¦ä¿¡æ¯ã€‚ perf sched latencyå‘½ä»¤å¯ä»¥è§£æå½“å‰ç›®å½•ä¸‹çš„perf.dataæ–‡ä»¶ã€‚â€œ-sâ€è¡¨ç¤ºè¿›è¡Œæ’åºï¼Œåæ¥å‚æ•°â€œmaxâ€è¡¨ç¤ºæŒ‰ç…§æœ€å¤§å»¶è¿Ÿæ—¶é—´å¤§å°æ’åºã€‚ numactl numactlå·¥å…·å¯ç”¨äºæŸ¥çœ‹å½“å‰æœåŠ¡å™¨çš„NUMAèŠ‚ç‚¹é…ç½®ã€çŠ¶æ€ï¼Œå¯é€šè¿‡è¯¥å·¥å…·å°†è¿›ç¨‹ç»‘å®šåˆ°æŒ‡å®šCPU coreï¼Œç”±æŒ‡å®šCPU coreæ¥è¿è¡Œå¯¹åº”è¿›ç¨‹ã€‚\nå¸¸è§å‘½ä»¤ä¸€è§ˆ å®‰è£…æ–¹å¼ ä»¥centos ä¸ºä¾‹\n1 yum -y install numactl numastat ä½¿ç”¨æ–¹æ³• é€šè¿‡numactlæŸ¥çœ‹å½“å‰æœåŠ¡å™¨çš„NUMAé…ç½®ã€‚ ä»numactlæ‰§è¡Œç»“æœå¯ä»¥çœ‹åˆ°ï¼Œç¤ºä¾‹æœåŠ¡å™¨å…±åˆ’åˆ†ä¸º4ä¸ªNUMAèŠ‚ç‚¹ã€‚æ¯ä¸ªèŠ‚ç‚¹åŒ…å«16ä¸ªCPU coreï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å†…å­˜å¤§å°çº¦ä¸º64GBã€‚åŒæ—¶ï¼Œè¯¥å‘½ä»¤è¿˜ç»™å‡ºäº†ä¸åŒèŠ‚ç‚¹é—´çš„è·ç¦»ï¼Œè·ç¦»è¶Šè¿œï¼Œè·¨NUMAå†…å­˜è®¿é—®çš„å»¶æ—¶è¶Šå¤§ã€‚åº”ç”¨ç¨‹åºè¿è¡Œæ—¶åº”å‡å°‘è·¨NUMAè®¿é—®å†…å­˜ã€‚ é€šè¿‡numactlå°†è¿›ç¨‹ç»‘å®šåˆ°æŒ‡å®šCPU coreã€‚ é€šè¿‡ numactl -C 0-15 top å‘½ä»¤å³æ˜¯å°†è¿›ç¨‹â€œtopâ€ç»‘å®šåˆ°0~15 CPU coreä¸Šæ‰§è¡Œã€‚ é€šè¿‡numastatæŸ¥çœ‹å½“å‰NUMAèŠ‚ç‚¹çš„å†…å­˜è®¿é—®å‘½ä¸­ç‡ã€‚ numa_hitè¡¨ç¤ºèŠ‚ç‚¹å†…CPUæ ¸è®¿é—®æœ¬åœ°å†…å­˜çš„æ¬¡æ•°ã€‚ numa_missè¡¨ç¤ºèŠ‚ç‚¹å†…æ ¸è®¿é—®å…¶ä»–èŠ‚ç‚¹å†…å­˜çš„æ¬¡æ•°ã€‚è·¨èŠ‚ç‚¹çš„å†…å­˜è®¿é—®ä¼šå­˜åœ¨é«˜å»¶è¿Ÿä»è€Œé™ä½æ€§èƒ½ï¼Œå› æ­¤ï¼Œnuma_missçš„å€¼åº”å½“è¶Šä½è¶Šå¥½ï¼Œå¦‚æœè¿‡é«˜ï¼Œåˆ™åº”å½“è€ƒè™‘ç»‘æ ¸ã€‚ ","permalink":"https://reid00.github.io/en/posts/langs_linux/linux%E6%80%A7%E8%83%BD%E6%A3%80%E6%B5%8B/","summary":"å¸¸è§çš„æ€§èƒ½æ£€æµ‹å·¥å…· TOP topæ˜¯æœ€å¸¸ç”¨çš„Linuxæ€§èƒ½ç›‘æµ‹å·¥å…·ä¹‹ä¸€ã€‚é€šè¿‡topå·¥å…·å¯ä»¥ç›‘è§†è¿›ç¨‹å’Œç³»ç»Ÿæ•´ä½“æ€§èƒ½ã€‚\nå¸¸è§å‘½ä»¤ä¸€è§ˆ å®‰è£…æ–¹å¼ ç³»ç»Ÿè‡ªå¸¦ï¼Œæ— éœ€å®‰è£…\nä½¿ç”¨æ–¹æ³• ä½¿ç”¨topå‘½ä»¤ç»Ÿè®¡æ•´ä½“CPUã€å†…å­˜èµ„æºæ¶ˆè€—ã€‚ CPUé¡¹ï¼šæ˜¾ç¤ºå½“å‰æ€»çš„CPUæ—¶é—´ä½¿ç”¨åˆ†å¸ƒã€‚ usè¡¨ç¤ºç”¨æˆ·æ€ç¨‹åºå ç”¨çš„CPUæ—¶é—´ç™¾åˆ†æ¯”ã€‚ syè¡¨ç¤ºå†…æ ¸æ€ç¨‹åºæ‰€å ç”¨çš„CPUæ—¶é—´ç™¾åˆ†æ¯”ã€‚ waè¡¨ç¤ºç­‰å¾…IOç­‰å¾…å ç”¨çš„CPUæ—¶é—´ç™¾åˆ†æ¯”ã€‚ hiè¡¨ç¤ºç¡¬ä¸­æ–­æ‰€å ç”¨çš„CPUæ—¶é—´ç™¾åˆ†æ¯”ã€‚ siè¡¨ç¤ºè½¯ä¸­æ–­æ‰€å ç”¨çš„CPUæ—¶é—´ç™¾åˆ†æ¯”ã€‚ é€šè¿‡è¿™äº›å‚æ•°æˆ‘ä»¬å¯ä»¥åˆ†æCPUæ—¶é—´çš„åˆ†å¸ƒï¼Œæ˜¯å¦æœ‰è¾ƒå¤šçš„IOç­‰å¾…ã€‚åœ¨æ‰§è¡Œå®Œè°ƒä¼˜æ­¥éª¤åï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹CPUä½¿ç”¨æ—¶é—´è¿›è¡Œå‰åå¯¹æ¯”ã€‚å¦‚æœåœ¨è¿è¡Œç›¸åŒç¨‹åºã€ä¸šåŠ¡æƒ…å†µä¸‹CPUä½¿ç”¨æ—¶é—´é™ä½ï¼Œè¯´æ˜æ€§èƒ½æœ‰æå‡ã€‚\nKiB Memï¼šè¡¨ç¤ºæœåŠ¡å™¨çš„æ€»å†…å­˜å¤§å°ä»¥åŠä½¿ç”¨æƒ…å†µã€‚ KiB Swapï¼šè¡¨ç¤ºå½“å‰æ‰€ä½¿ç”¨çš„Swapç©ºé—´çš„å¤§å°ã€‚Swapç©ºé—´å³å½“å†…å­˜ä¸è¶³çš„æ—¶å€™ï¼ŒæŠŠä¸€éƒ¨åˆ†ç¡¬ç›˜ç©ºé—´è™šæ‹Ÿæˆå†…å­˜ä½¿ç”¨ã€‚å¦‚æœå½“å‰æ‰€ä½¿ç”¨çš„Swapç©ºé—´å¤§äº0ï¼Œå¯ä»¥è€ƒè™‘ä¼˜åŒ–åº”ç”¨çš„å†…å­˜å ç”¨æˆ–å¢åŠ ç‰©ç†å†…å­˜ã€‚ åœ¨topå‘½ä»¤æ‰§è¡ŒåæŒ‰1ï¼ŒæŸ¥çœ‹æ¯ä¸ªCPU coreçš„ä½¿ç”¨æƒ…å†µã€‚ é€šè¿‡è¯¥å‘½ä»¤å¯ä»¥æŸ¥çœ‹å•ä¸ªCPU coreçš„ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœCPUå ç”¨é›†ä¸­åœ¨æŸå‡ ä¸ªCPU coreä¸Šï¼Œå¯ä»¥ç»“åˆä¸šåŠ¡åˆ†æè§¦å‘åŸå› ï¼Œä»è€Œæ‰¾åˆ°ä¼˜åŒ–æ€è·¯ã€‚ é€‰ä¸­topå‘½ä»¤çš„Pé€‰é¡¹ï¼ŒæŸ¥çœ‹çº¿ç¨‹è¿è¡Œåœ¨å“ªäº› CPU coreä¸Šã€‚ åœ¨topå‘½ä»¤æ‰§è¡ŒåæŒ‰Fï¼Œå¯ä»¥è¿›å…¥topå‘½ä»¤ç®¡ç†ç•Œé¢ã€‚åœ¨è¯¥ç•Œé¢é€šè¿‡ä¸Šä¸‹é”®ç§»åŠ¨å…‰æ ‡åˆ°Pé€‰é¡¹ï¼Œé€šè¿‡ç©ºæ ¼é”®é€‰ä¸­åæŒ‰Escé€€å‡ºï¼Œå³å¯æ˜¾ç¤ºå‡ºçº¿ç¨‹è¿è¡Œçš„CPUæ ¸ã€‚è§‚å¯Ÿä¸€æ®µæ—¶é—´ï¼Œè‹¥ä¸šåŠ¡çº¿ç¨‹åœ¨ä¸åŒNUMAèŠ‚ç‚¹å†…çš„CPU coreä¸Šè¿è¡Œï¼Œåˆ™è¯´æ˜å­˜åœ¨è¾ƒå¤šçš„è·¨NUMAè®¿é—®ï¼Œå¯é€šè¿‡NUMAç»‘æ ¸è¿›è¡Œä¼˜åŒ–ã€‚(top -\u0026gt; F -\u0026gt; up/down -\u0026gt; ç©ºæ ¼ -\u0026gt; ESC) ä½¿ç”¨top -p $PID -Hå‘½ä»¤è§‚å¯Ÿè¿›ç¨‹ä¸­æ¯ä¸ªçº¿ç¨‹çš„CPUèµ„æºä½¿ç”¨ã€‚ â€œ-pâ€åæ¥çš„å‚æ•°ä¸ºå¾…è§‚å¯Ÿçš„è¿›ç¨‹IDã€‚é€šè¿‡è¯¥å‘½ä»¤å¯ä»¥æ‰¾å‡ºæ¶ˆè€—èµ„æºå¤šçš„çº¿ç¨‹ï¼Œéšåå¯æ ¹æ®çº¿ç¨‹å·åˆ†æçº¿ç¨‹ä¸­çš„çƒ­ç‚¹å‡½æ•°ã€è°ƒç”¨è¿‡ç¨‹ç­‰æƒ…å†µã€‚ Perf Perfå·¥å…·æ˜¯éå¸¸å¼ºå¤§çš„Linuxæ€§èƒ½åˆ†æå·¥å…·ï¼Œå¯ä»¥é€šè¿‡è¯¥å·¥å…·è·å¾—è¿›ç¨‹å†…çš„è°ƒç”¨æƒ…å†µã€èµ„æºæ¶ˆè€—æƒ…å†µå¹¶æŸ¥æ‰¾åˆ†æçƒ­ç‚¹å‡½æ•°ã€‚\nå¸¸è§å‘½ä»¤ä¸€è§ˆ å®‰è£…æ–¹å¼ centos ä¸ºä¾‹\n1 yum -y install perf ä½¿ç”¨æ–¹å¼ é€šè¿‡perf topå‘½ä»¤æŸ¥æ‰¾çƒ­ç‚¹å‡½æ•°ã€‚ è¯¥å‘½ä»¤ç»Ÿè®¡å„ä¸ªå‡½æ•°åœ¨æŸä¸ªæ€§èƒ½äº‹ä»¶ä¸Šçš„çƒ­åº¦ï¼Œé»˜è®¤æ˜¾ç¤ºCPUå ç”¨ç‡ï¼Œå¯ä»¥é€šè¿‡â€œ-eâ€ç›‘æ§å…¶å®ƒäº‹ä»¶ã€‚ Overheadè¡¨ç¤ºå½“å‰äº‹ä»¶åœ¨å…¨éƒ¨äº‹ä»¶ä¸­å çš„æ¯”ä¾‹ã€‚ Shared Objectè¡¨ç¤ºå½“å‰äº‹ä»¶ç”Ÿäº§è€…ï¼Œå¦‚kernelã€perfå‘½ä»¤ã€Cè¯­è¨€åº“å‡½æ•°ç­‰ã€‚ Symbolåˆ™è¡¨ç¤ºçƒ­ç‚¹äº‹ä»¶å¯¹åº”çš„å‡½æ•°åç§°ã€‚ é€šè¿‡çƒ­ç‚¹å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æ¶ˆè€—èµ„æºè¾ƒå¤šçš„è¡Œä¸ºï¼Œä»è€Œæœ‰é’ˆå¯¹æ€§çš„è¿›è¡Œä¼˜åŒ–ã€‚ æ”¶é›†ä¸€æ®µæ—¶é—´å†…çš„çº¿ç¨‹è°ƒç”¨. perf sched recordå‘½ä»¤ç”¨äºè®°å½•ä¸€æ®µæ—¶é—´å†…ï¼Œè¿›ç¨‹çš„è°ƒç”¨æƒ…å†µã€‚â€œ-pâ€åæ¥è¿›ç¨‹å·ï¼Œâ€œsleepâ€åæ¥ç»Ÿè®¡æ—¶é•¿ï¼Œå•ä½ä¸ºç§’ã€‚æ”¶é›†åˆ°çš„ä¿¡æ¯è‡ªåŠ¨å­˜æ”¾åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åä¸ºperf.dataã€‚ è§£ææ”¶é›†åˆ°çš„çº¿ç¨‹è°ƒåº¦ä¿¡æ¯ã€‚ perf sched latencyå‘½ä»¤å¯ä»¥è§£æå½“å‰ç›®å½•ä¸‹çš„perf.dataæ–‡ä»¶ã€‚â€œ-sâ€è¡¨ç¤ºè¿›è¡Œæ’åºï¼Œåæ¥å‚æ•°â€œmaxâ€è¡¨ç¤ºæŒ‰ç…§æœ€å¤§å»¶è¿Ÿæ—¶é—´å¤§å°æ’åºã€‚ numactl numactlå·¥å…·å¯ç”¨äºæŸ¥çœ‹å½“å‰æœåŠ¡å™¨çš„NUMAèŠ‚ç‚¹é…ç½®ã€çŠ¶æ€ï¼Œå¯é€šè¿‡è¯¥å·¥å…·å°†è¿›ç¨‹ç»‘å®šåˆ°æŒ‡å®šCPU coreï¼Œç”±æŒ‡å®šCPU coreæ¥è¿è¡Œå¯¹åº”è¿›ç¨‹ã€‚","title":"Linuxæ€§èƒ½æ£€æµ‹"},{"content":"ç®€ä»‹LSM Tree MySQLã€etcd ç­‰å­˜å‚¨ç³»ç»Ÿéƒ½æ˜¯é¢å‘è¯»å¤šå†™å°‘åœºæ™¯çš„ï¼Œå…¶åº•å±‚å¤§éƒ½é‡‡ç”¨ B-Tree åŠå…¶å˜ç§æ•°æ®ç»“æ„ã€‚è€Œ LSM-Tree åˆ™è§£å†³äº†å¦ä¸€ä¸ªåº”ç”¨åœºæ™¯â€”â€”å†™å¤šè¯»å°‘æ—¶é¢ä¸´çš„é—®é¢˜ã€‚åœ¨é¢å¯¹äº¿çº§çš„æµ·é‡æ•°æ®çš„å­˜å‚¨å’Œæ£€ç´¢çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬é€šå¸¸é€‰æ‹©å¼ºåŠ›çš„ NoSQL æ•°æ®åº“ï¼Œå¦‚ Hbaseã€RocksDB ç­‰ï¼Œå®ƒä»¬çš„æ–‡ä»¶ç»„ç»‡æ–¹å¼ï¼Œéƒ½æ˜¯ä»¿ç…§ LSM-Tree å®ç°çš„ã€‚ reference\nLSM-Tree å…¨ç§°æ˜¯ Log Structured Merge Treeï¼Œæ˜¯ä¸€ç§åˆ†å±‚ã€æœ‰åºã€é¢å‘ç£ç›˜çš„æ•°æ®ç»“æ„ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯å……åˆ†åˆ©ç”¨ç£ç›˜çš„é¡ºåºå†™æ€§èƒ½è¦è¿œé«˜äºéšæœºå†™æ€§èƒ½è¿™ä¸€ç‰¹æ€§ï¼Œå°†æ‰¹é‡çš„éšæœºå†™è½¬åŒ–ä¸ºä¸€æ¬¡æ€§çš„é¡ºåºå†™ã€‚\nä»ä¸Šå›¾å¯ä»¥ç›´è§‚åœ°çœ‹å‡ºï¼Œç£ç›˜çš„é¡ºåºè®¿é—®é€Ÿåº¦è‡³å°‘æ¯”éšæœº I/O å¿«ä¸‰ä¸ªæ•°é‡çº§ï¼Œç”šè‡³é¡ºåºè®¿é—®ç£ç›˜æ¯”éšæœºè®¿é—®ä¸»å†…å­˜è¿˜è¦å¿«ã€‚è¿™æ„å‘³ç€è¦å°½å¯èƒ½é¿å…éšæœº I/O æ“ä½œï¼Œé¡ºåºè®¿é—®éå¸¸å€¼å¾—æˆ‘ä»¬å»æ¢è®¨ä¸è®¾è®¡ã€‚\nLSM-Tree å›´ç»•è¿™ä¸€åŸç†è¿›è¡Œè®¾è®¡å’Œä¼˜åŒ–ï¼Œé€šè¿‡æ¶ˆå»éšæœºçš„æ›´æ–°æ“ä½œæ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œä»¥æ­¤è®©å†™æ€§èƒ½è¾¾åˆ°æœ€ä¼˜ï¼ŒåŒæ—¶ä¸ºé‚£äº›é•¿æœŸå…·æœ‰é«˜æ›´æ–°é¢‘ç‡çš„æ–‡ä»¶æä¾›ä½æˆæœ¬çš„ç´¢å¼•æœºåˆ¶ï¼Œå‡å°‘æŸ¥è¯¢æ—¶çš„å¼€é”€ã€‚\nTwo-Component LSM-Tree LSM-Tree å¯ä»¥ç”±ä¸¤ä¸ªæˆ–å¤šä¸ªç±»æ ‘çš„æ•°æ®ç»“æ„ç»„ä»¶æ„æˆï¼Œæœ¬å°èŠ‚æˆ‘ä»¬å…ˆä»‹ç»è¾ƒä¸ºç®€å•çš„ä¸¤ç»„ä»¶æƒ…å†µã€‚ ä¸¤ç»„ä»¶ LSM-Treeï¼ˆTwo-Component LSM-Treeï¼‰åœ¨å†…å­˜ä¸­æœ‰ä¸€ä¸ª C0 ç»„ä»¶ï¼Œå®ƒå¯ä»¥æ˜¯ AVL æˆ– SkipList ç­‰ç»“æ„ï¼Œæ‰€æœ‰å†™å…¥é¦–å…ˆå†™åˆ° C0 ä¸­ã€‚è€Œç£ç›˜ä¸Šæœ‰ä¸€ä¸ª C1 ç»„ä»¶ï¼Œå½“ C0 ç»„ä»¶çš„å¤§å°è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±éœ€è¦è¿›è¡Œ Rolling Mergeï¼Œå°†å†…å­˜ä¸­çš„å†…å®¹åˆå¹¶åˆ° C1 ä¸­ã€‚ä¸¤ç»„ä»¶ LSM-Tree çš„å†™æ“ä½œæµç¨‹å¦‚ä¸‹ï¼š\nå½“æœ‰å†™æ“ä½œæ—¶ï¼Œä¼šå…ˆå°†æ•°æ®è¿½åŠ å†™åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œä»¥å¤‡å¿…è¦æ—¶æ¢å¤ï¼› ç„¶åå°†æ•°æ®å†™å…¥ä½äºå†…å­˜çš„ C0 ç»„ä»¶ï¼Œé€šè¿‡æŸç§æ•°æ®ç»“æ„ä¿æŒ Key æœ‰åºï¼› å†…å­˜ä¸­çš„æ•°æ®å®šæ—¶æˆ–æŒ‰å›ºå®šå¤§å°åˆ·æ–°åˆ°ç£ç›˜ï¼Œæ›´æ–°æ“ä½œåªå†™åˆ°å†…å­˜ï¼Œå¹¶ä¸æ›´æ–°ç£ç›˜ä¸Šå·²æœ‰æ–‡ä»¶ï¼› éšç€å†™æ“ä½œè¶Šæ¥è¶Šå¤šï¼Œç£ç›˜ä¸Šç§¯ç´¯çš„æ–‡ä»¶ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œè¿™äº›æ–‡ä»¶ä¸å¯å†™ä½†æœ‰åºï¼Œæ‰€ä»¥æˆ‘ä»¬å®šæ—¶å¯¹æ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼ˆCompactionï¼‰æ“ä½œï¼Œæ¶ˆé™¤å†—ä½™æ•°æ®ï¼Œå‡å°‘æ–‡ä»¶æ•°é‡ã€‚ ç±»ä¼¼äºæ™®é€šçš„æ—¥å¿—å†™å…¥æ–¹å¼ï¼Œè¿™ç§æ•°æ®ç»“æ„çš„å†™å…¥ï¼Œå…¨éƒ¨éƒ½æ˜¯ä»¥Appendçš„æ¨¡å¼è¿½åŠ ï¼Œä¸å­˜åœ¨åˆ é™¤å’Œä¿®æ”¹ã€‚å¯¹äºä»»ä½•åº”ç”¨æ¥è¯´ï¼Œé‚£äº›ä¼šå¯¼è‡´ç´¢å¼•å€¼å‘ç”Ÿå˜åŒ–çš„æ•°æ®æ›´æ–°éƒ½æ˜¯ç¹çä¸”è€—æ—¶çš„ï¼Œä½†æ˜¯è¿™æ ·çš„æ›´æ–°å´å¯ä»¥è¢« LSM-Tree è½»æ¾åœ°è§£å†³ï¼Œå°†è¯¥æ›´æ–°æ“ä½œçœ‹åšæ˜¯ä¸€ä¸ªåˆ é™¤æ“ä½œåŠ ä¸Šä¸€ä¸ªæ’å…¥æ“ä½œã€‚\nC1 ç»„ä»¶æ˜¯ä¸ºé¡ºåºæ€§çš„ç£ç›˜è®¿é—®ä¼˜åŒ–è¿‡çš„ï¼Œå¯ä»¥æ˜¯ B-Tree ä¸€ç±»çš„æ•°æ®ç»“æ„ï¼ˆLevelDB ä¸­çš„å®ç°æ˜¯ SSTableï¼‰ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯ 100% å¡«å……ï¼Œä¸ºäº†æœ‰æ•ˆåˆ©ç”¨ç£ç›˜ï¼Œåœ¨æ ¹èŠ‚ç‚¹ä¹‹ä¸‹çš„æ‰€æœ‰çš„å•é¡µé¢èŠ‚ç‚¹éƒ½ä¼šè¢«æ‰“åŒ…æ”¾åˆ°è¿ç»­çš„å¤šé¡µé¢ç£ç›˜å—ï¼ˆMulti-Page Blockï¼‰ä¸Šã€‚å¯¹äº Rolling Merge å’Œé•¿åŒºé—´æ£€ç´¢çš„æƒ…å†µå°†ä¼šä½¿ç”¨ Multi-Page Block I/Oï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆå‡å°‘ç£ç›˜æ—‹è‡‚çš„ç§»åŠ¨ï¼›è€Œåœ¨åŒ¹é…æ€§çš„æŸ¥æ‰¾ä¸­ä¼šä½¿ç”¨ Single-Page I/Oï¼Œä»¥æœ€å°åŒ–ç¼“å­˜é‡ã€‚é€šå¸¸æ ¹èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå•é¡µé¢ï¼Œè€Œå…¶å®ƒèŠ‚ç‚¹ä½¿ç”¨ 256KB çš„ Multi-Page Blockã€‚\nåœ¨ä¸€ä¸ªä¸¤ç»„ä»¶ LSM-Tree ä¸­ï¼Œåªè¦ C0 ç»„ä»¶è¶³å¤Ÿå¤§ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ä¸€ä¸ªæ‰¹é‡å¤„ç†æ•ˆæœã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€æ¡æ•°æ®è®°å½•çš„å¤§å°æ˜¯ 16Bytesï¼Œåœ¨ä¸€ä¸ª 4KB çš„èŠ‚ç‚¹ä¸­å°†ä¼šæœ‰ 250 æ¡è®°å½•ï¼›å¦‚æœ C0 ç»„ä»¶çš„å¤§å°æ˜¯ C1 çš„ 1/25ï¼Œé‚£ä¹ˆåœ¨æ¯ä¸ªåˆå¹¶æ“ä½œæ–°äº§ç”Ÿçš„å…·æœ‰ 250 æ¡è®°å½•çš„ C1 èŠ‚ç‚¹ä¸­ï¼Œå°†ä¼šæœ‰ 10 æ¡æ˜¯ä» C0 åˆå¹¶è€Œæ¥çš„æ–°è®°å½•ã€‚ä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·æ–°å†™å…¥çš„æ•°æ®æš‚æ—¶å­˜å‚¨åˆ°å†…å­˜çš„ C0 ä¸­ï¼Œç„¶åå†æ‰¹é‡å»¶è¿Ÿå†™å…¥ç£ç›˜ï¼Œç›¸å½“äºå°†ç”¨æˆ·ä¹‹å‰çš„ 10 æ¬¡å†™å…¥åˆå¹¶ä¸ºä¸€æ¬¡å†™å…¥ã€‚æ˜¾ç„¶åœ°ï¼Œç”±äºåªéœ€è¦ä¸€æ¬¡éšæœºå†™å°±å¯ä»¥å†™å…¥å¤šæ¡æ•°æ®ï¼ŒLSM-Tree çš„å†™æ•ˆç‡æ¯” B-Tree ç­‰æ•°æ®ç»“æ„æ›´é«˜ï¼Œè€Œ Rolling Merge è¿‡ç¨‹åˆ™æ˜¯å…¶ä¸­çš„å…³é”®ã€‚\nRolling Merge æˆ‘ä»¬å¯ä»¥æŠŠä¸¤ç»„ä»¶ LSM-Tree çš„ Rolling Merge è¿‡ç¨‹ç±»æ¯”ä¸ºä¸€ä¸ªå…·æœ‰ä¸€å®šæ­¥é•¿çš„æ¸¸æ ‡å¾ªç¯å¾€å¤åœ°ç©¿è¶Šåœ¨ C0 å’Œ C1 çš„é”®å€¼å¯¹ä¸Šï¼Œä¸æ–­åœ°ä»C0 ä¸­å–å‡ºæ•°æ®æ”¾å…¥åˆ°ç£ç›˜ä¸Šçš„ C1 ä¸­ã€‚ è¯¥æ¸¸æ ‡åœ¨ C1æ ‘çš„å¶å­èŠ‚ç‚¹å’Œç´¢å¼•èŠ‚ç‚¹ä¸Šéƒ½æœ‰ä¸€ä¸ªé€»è¾‘ä½ç½®ï¼Œåœ¨æ¯ä¸ªå±‚çº§ä¸Šï¼Œæ‰€æœ‰æ­£åœ¨å‚ä¸åˆå¹¶çš„ Multi-Page Blocks å°†ä¼šè¢«åˆ†æˆä¸¤ç§ç±»å‹ï¼šEmptying Blockçš„å†…éƒ¨è®°å½•æ­£åœ¨è¢«ç§»å‡ºï¼Œä½†æ˜¯è¿˜æœ‰ä¸€äº›æ•°æ®æ˜¯æ¸¸æ ‡æ‰€æœªåˆ°è¾¾çš„ï¼ŒFilling Blockåˆ™å­˜å‚¨ç€åˆå¹¶åçš„ç»“æœã€‚ç±»ä¼¼åœ°ï¼Œè¯¥æ¸¸æ ‡ä¹Ÿä¼šå®šä¹‰å‡ºEmptying Nodeå’ŒFilling Nodeï¼Œè¿™ä¸¤ä¸ªèŠ‚ç‚¹éƒ½è¢«ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚ä¸ºäº†å¯ä»¥è¿›è¡Œå¹¶å‘è®¿é—®ï¼Œæ¯ä¸ªå±‚çº§ä¸Šçš„ Block åŒ…å«æ•´æ•°ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ ·åœ¨å¯¹æ‰§è¡ŒèŠ‚ç‚¹è¿›è¡Œé‡ç»„åˆå¹¶è¿‡ç¨‹ä¸­ï¼Œé’ˆå¯¹è¿™äº›èŠ‚ç‚¹å†…éƒ¨è®°å½•çš„è®¿é—®å°†ä¼šè¢«é˜»å¡ï¼Œä½†æ˜¯åŒä¸€ Block ä¸­å…¶å®ƒèŠ‚ç‚¹ä¾ç„¶å¯ä»¥æ­£å¸¸è®¿é—®ã€‚ åˆå¹¶åçš„æ–° Blocks ä¼šè¢«å†™å…¥åˆ°æ–°çš„ç£ç›˜ä½ç½®ä¸Šï¼Œè¿™æ ·æ—§çš„ Blocks å°±ä¸ä¼šè¢«è¦†ç›–ï¼Œåœ¨å‘ç”Ÿ crash åä¾ç„¶å¯ä»¥è¿›è¡Œæ•°æ®æ¢å¤ã€‚åŒæ—¶éœ€è¦åœ¨ç´¢å¼•èŠ‚ç‚¹ä¸­å»ºç«‹æ–°çš„ç´¢å¼•ä¿¡æ¯ï¼Œä¸ºäº†è¿›è¡Œæ¢å¤è¿˜éœ€è¦äº§ç”Ÿä¸€æ¡æ—¥å¿—è®°å½•ã€‚é‚£äº›å¯èƒ½åœ¨æ¢å¤è¿‡ç¨‹ä¸­éœ€è¦çš„æ—§çš„ Block æš‚æ—¶è¿˜ä¸ä¼šè¢«åˆ é™¤ï¼Œåªæœ‰å½“åç»­çš„å†™å…¥æä¾›äº†è¶³å¤Ÿä¿¡æ¯æ—¶å®ƒä»¬æ‰å¯ä»¥å®£å‘Šå¤±æ•ˆã€‚\nC1ä¸­çš„çˆ¶ç›®å½•èŠ‚ç‚¹ä¹Ÿä¼šè¢«ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œå®æ—¶æ›´æ–°ä»¥åæ˜ å‡ºå¶å­èŠ‚ç‚¹çš„å˜åŠ¨ï¼ŒåŒæ—¶çˆ¶èŠ‚ç‚¹è¿˜ä¼šåœ¨å†…å­˜ä¸­åœç•™ä¸€æ®µæ—¶é—´ä»¥æœ€å°åŒ– I/Oã€‚å½“åˆå¹¶æ­¥éª¤å®Œæˆåï¼ŒC1 ä¸­çš„æ—§å¶å­èŠ‚ç‚¹å°±ä¼šå˜ä¸ºæ— æ•ˆçŠ¶æ€ï¼Œéšåä¼šè¢«ä» C1 ç›®å½•ç»“æ„ä¸­åˆ é™¤ã€‚ä¸ºäº†å‡å°‘å´©æºƒåçš„æ•°æ®æ¢å¤æ—¶é—´ï¼Œåˆå¹¶è¿‡ç¨‹éœ€è¦è¿›è¡Œå‘¨æœŸæ€§çš„ checkpointï¼Œå¼ºåˆ¶å°†ç¼“å­˜ä¿¡æ¯å†™å…¥ç£ç›˜ã€‚\nä¸ºäº†è®© LSM è¯»å–é€Ÿåº¦ç›¸å¯¹è¾ƒå¿«ï¼Œç®¡ç†æ–‡ä»¶æ•°é‡éå¸¸é‡è¦ï¼Œå› æ­¤æˆ‘ä»¬è¦å¯¹æ–‡ä»¶è¿›è¡Œåˆå¹¶å‹ç¼©ã€‚åœ¨ LevelDB ä¸­ï¼Œåˆå¹¶åçš„å¤§æ–‡ä»¶ä¼šè¿›å…¥ä¸‹ä¸€ä¸ª Level ä¸­ã€‚ ä¾‹å¦‚æˆ‘ä»¬çš„ Level-0 ä¸­æ¯ä¸ªæ–‡ä»¶æœ‰ 10 æ¡æ•°æ®ï¼Œæ¯ 5 ä¸ª Level-0 æ–‡ä»¶åˆå¹¶åˆ° 1 ä¸ª Level1 æ–‡ä»¶ä¸­ï¼Œæ¯å•ä¸ª Level1 æ–‡ä»¶ä¸­æœ‰ 50 æ¡æ•°æ®ï¼ˆå¯èƒ½ä¼šç•¥å°‘ä¸€äº›ï¼‰ã€‚è€Œæ¯ 5 ä¸ª Level1 æ–‡ä»¶åˆå¹¶åˆ° 1 ä¸ª Level2 æ–‡ä»¶ä¸­ï¼Œè¯¥è¿‡ç¨‹ä¼šæŒç»­åˆ›å»ºè¶Šæ¥è¶Šå¤§çš„æ–‡ä»¶ï¼Œè¶Šæ—§çš„æ•°æ® Level çº§æ•°ä¹Ÿä¼šè¶Šæ¥è¶Šé«˜ã€‚\nç”±äºæ–‡ä»¶å·²æ’åºï¼Œå› æ­¤åˆå¹¶æ–‡ä»¶çš„è¿‡ç¨‹éå¸¸å¿«é€Ÿï¼Œä½†æ˜¯åœ¨ç­‰çº§è¶Šé«˜çš„æ•°æ®æŸ¥è¯¢é€Ÿåº¦ä¹Ÿè¶Šæ…¢ã€‚åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å•ç‹¬æœç´¢æ‰€æœ‰æ–‡ä»¶æ‰èƒ½è¯»å–ç»“æœã€‚\næ•°æ®è¯»å– å½“åœ¨ LSM-Tree ä¸Šæ‰§è¡Œä¸€ä¸ªç²¾ç¡®åŒ¹é…æŸ¥è¯¢æˆ–è€…èŒƒå›´æŸ¥è¯¢æ—¶ï¼Œé¦–å…ˆä¼šåˆ° C0 ä¸­æŸ¥æ‰¾æ‰€éœ€çš„å€¼ï¼Œå¦‚æœåœ¨ C0 ä¸­æ²¡æœ‰æ‰¾åˆ°ï¼Œå†å» C1 ä¸­æŸ¥æ‰¾ã€‚è¿™æ„å‘³ç€ä¸ B-Tree ç›¸æ¯”ï¼Œä¼šæœ‰ä¸€äº›é¢å¤–çš„ CPU å¼€é”€ï¼Œå› ä¸ºç°åœ¨éœ€è¦å»ä¸¤ä¸ªç›®å½•ä¸­æœç´¢ã€‚è™½ç„¶æ¯ä¸ªæ–‡ä»¶éƒ½ä¿æŒæ’åºï¼Œå¯ä»¥é€šè¿‡æ¯”è¾ƒè¯¥æ–‡ä»¶çš„æœ€å¤§/æœ€å°é”®å€¼å¯¹æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œæœç´¢ã€‚ä½†æ˜¯ï¼Œéšç€æ–‡ä»¶æ•°é‡çš„å¢åŠ ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½éœ€è¦æ£€æŸ¥ï¼Œè¯»å–è¿˜æ˜¯ä¼šå˜å¾—è¶Šæ¥è¶Šæ…¢ã€‚\nå› æ­¤ï¼ŒLSM-Tree çš„è¯»å–é€Ÿåº¦æ¯”å…¶å®ƒæ•°æ®ç»“æ„æ›´æ…¢ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›ç´¢å¼•æŠ€å·§è¿›è¡Œä¼˜åŒ–ã€‚LevelDB ä¼šåœ¨æ¯ä¸ªæ–‡ä»¶æœ«å°¾ä¿ç•™å—ç´¢å¼•æ¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ï¼Œè¿™æ¯”ç›´æ¥äºŒè¿›åˆ¶æœç´¢æ›´å¥½ï¼Œå› ä¸ºå®ƒå…è®¸ä½¿ç”¨å˜é•¿å­—æ®µï¼Œå¹¶ä¸”æ›´é€‚åˆå‹ç¼©æ•°æ®ã€‚è¯¦ç»†çš„å†…å®¹ä¼šåœ¨ SSTable å°èŠ‚ä¸­ä»‹ç»ã€‚\næˆ‘ä»¬è¿˜å¯ä»¥é’ˆå¯¹åˆ é™¤æ“ä½œè¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼Œé«˜æ•ˆåœ°æ›´æ–°ç´¢å¼•ã€‚ä¾‹å¦‚é€šè¿‡æ–­è¨€å¼åˆ é™¤ï¼ˆPredicate Deletionï¼‰è¿‡ç¨‹ï¼Œåªè¦ç®€å•åœ°å£°æ˜ä¸€ä¸ªæ–­è¨€ï¼Œå°±å¯ä»¥æ‰§è¡Œæ‰¹é‡åˆ é™¤çš„æ“ä½œæ–¹å¼ã€‚ä¾‹å¦‚åˆ é™¤é‚£äº›æ—¶é—´æˆ³åœ¨ 20 å¤©å‰çš„æ‰€æœ‰çš„ç´¢å¼•å€¼ï¼Œå½“ä½äº C1 ç»„ä»¶çš„è®°å½•é€šè¿‡æ­£å¸¸è¿‡çš„æ•°æ®åˆå¹¶è¿‡ç¨‹è¢«åŠ è½½åˆ°å†…å­˜ä¸­æ—¶ï¼Œå°±å¯ä»¥å®ƒä»¬ç›´æ¥ä¸¢å¼ƒæ¥å®ç°åˆ é™¤ã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œè€ƒè™‘åˆ°å„ç§å› ç´ ï¼Œé’ˆå¯¹ LSM-Tree çš„å¹¶å‘è®¿é—®æ–¹æ³•å¿…é¡»è§£å†³å¦‚ä¸‹ä¸‰ç§ç±»å‹çš„ç‰©ç†å†²çªï¼š\næŸ¥è¯¢æ“ä½œä¸èƒ½åŒæ—¶å»è®¿é—®å¦ä¸€ä¸ªè¿›ç¨‹çš„ Rolling Merge æ­£åœ¨ä¿®æ”¹çš„ç£ç›˜ç»„ä»¶çš„èŠ‚ç‚¹å†…å®¹ï¼› é’ˆå¯¹ C0 ç»„ä»¶çš„æŸ¥è¯¢å’Œæ’å…¥æ“ä½œä¹Ÿä¸èƒ½ä¸æ­£åœ¨è¿›è¡Œçš„ Rolling Merge çš„åŒæ—¶å¯¹æ ‘çš„ç›¸åŒéƒ¨åˆ†è¿›è¡Œè®¿é—®ï¼› åœ¨å¤šç»„ä»¶ LSM-Tree ä¸­ï¼Œä» Ci-1 åˆ° Ci çš„ Rolling Merge æ¸¸æ ‡æœ‰æ—¶éœ€è¦è¶Šè¿‡ä» Ci åˆ° Ci+1 çš„ Rolling Merge æ¸¸æ ‡ï¼Œå› ä¸ºæ•°æ®ä» Ci-1 ç§»å‡ºé€Ÿç‡ \u0026gt;= ä» Ci ç§»å‡ºçš„é€Ÿç‡ï¼Œè¿™æ„å‘³ç€ Ci-1 æ‰€å…³è”çš„æ¸¸æ ‡çš„å¾ªç¯å‘¨æœŸè¦æ›´å¿«ã€‚å› æ­¤æ— è®ºå¦‚ä½•ï¼Œæ‰€é‡‡ç”¨çš„å¹¶å‘è®¿é—®æœºåˆ¶å¿…é¡»å…è®¸è¿™ç§äº¤é”™å‘ç”Ÿï¼Œè€Œä¸èƒ½å¼ºåˆ¶è¦æ±‚åœ¨äº¤ä¼šç‚¹ï¼Œç§»å…¥æ•°æ®åˆ° Ci çš„çº¿ç¨‹å¿…é¡»é˜»å¡åœ¨ä» Ci ç§»å‡ºæ•°æ®çš„çº¿ç¨‹ä¹‹åã€‚ Multi-Component LSM-Tree ä¸ºäº†ä¿è¯ C0 çš„å¤§å°ç»´æŒåœ¨åœ¨é˜ˆå€¼èŒƒå›´å†…ï¼Œè¿™è¦æ±‚ Rolling Merge å°†æ•°æ®åˆå¹¶åˆ° C1 çš„é€Ÿåº¦å¿…é¡»ä¸ä½äºç”¨æˆ·çš„å†™å…¥é€Ÿåº¦ï¼Œæ­¤æ—¶ C0 çš„ä¸åŒå¤§å°ä¼šå¯¹æ•´ä½“æ€§èƒ½é€ æˆä¸åŒçš„ç»“æœï¼š\nC0 éå¸¸å°ï¼šæ­¤æ—¶ä¸€æ¡æ•°æ®çš„æ’å…¥éƒ½ä¼šä½¿ C0 å˜æ»¡ï¼Œä»è€Œè§¦å‘ Rolling Mergeï¼Œæœ€åçš„æƒ…å†µä¸‹ï¼ŒC0 çš„æ¯ä¸€æ¬¡æ’å…¥éƒ½ä¼šå¯¼è‡´ C1 çš„å…¨éƒ¨å¶å­èŠ‚ç‚¹è¢«è¯»è¿›å†…å­˜åˆå†™å›ç£ç›˜ï¼ŒI/O å¼€é”€éå¸¸é«˜ï¼› C0 éå¸¸å¤§ï¼šæ­¤æ—¶åŸºæœ¬æ²¡æœ‰ I/O å¼€é”€ï¼Œä½†éœ€è¦å¾ˆå¤§çš„å†…å­˜ç©ºé—´ï¼Œä¹Ÿä¸æ˜“è¿›è¡Œæ•°æ®æ¢å¤ã€‚ ä¸ºäº†è¿›ä¸€æ­¥ç¼©å°ä¸¤ç»„ä»¶ LSM-Tree çš„å¼€é”€å¹³è¡¡ç‚¹ï¼Œå¤šç»„ä»¶ LSM-Tree åœ¨ C0 å’Œ C1 ä¹‹é—´å¼•å…¥ä¸€ç»„æ–°çš„ Componentï¼Œå¤§å°ä»‹äºä¸¤è€…ä¹‹é—´ï¼Œé€çº§å¢é•¿ï¼Œè¿™æ · C0 å°±ä¸ç”¨æ¯æ¬¡å’Œ C1 è¿›è¡Œ Rolling Mergeï¼Œè€Œæ˜¯å…ˆå’Œä¸­é—´çš„ç»„ä»¶è¿›è¡Œåˆå¹¶ï¼Œå½“ä¸­é—´çš„ç»„ä»¶åˆ°è¾¾å…¶å¤§å°é™åˆ¶åå†å’Œ C1 åš Rolling Mergeï¼Œè¿™æ ·å°±å¯ä»¥åœ¨å‡å°‘ C0 å†…å­˜å¼€é”€çš„åŒæ—¶å‡å°‘ç£ç›˜ I/O å¼€é”€ã€‚æœ‰äº›ç±»ä¼¼äºæˆ‘ä»¬çš„å¤šçº§ç¼“å­˜ç»“æ„ã€‚\nå°èŠ‚ LSM-Tree çš„å®ç°æ€è·¯ä¸å¸¸è§„å­˜å‚¨ç³»ç»Ÿé‡‡å–çš„æªæ–½ä¸å¤ªç›¸åŒï¼Œå…¶å°†éšæœºå†™è½¬åŒ–ä¸ºé¡ºåºå†™ï¼Œå°½é‡ä¿æŒæ—¥å¿—å‹æ•°æ®åº“çš„å†™æ€§èƒ½ä¼˜åŠ¿ï¼Œå¹¶æä¾›ç›¸å¯¹è¾ƒå¥½çš„è¯»æ€§èƒ½ã€‚åœ¨å¤§é‡å†™å…¥åœºæ™¯ä¸‹ LSM-Tree ä¹‹æ‰€ä»¥æ¯” B-Treeã€Hash è¦å¥½ï¼Œå¾—ç›Šäºä»¥ä¸‹ä¸¤ä¸ªåŸå› ï¼š\nBatch Writeï¼šç”±äºé‡‡ç”¨å»¶è¿Ÿå†™ï¼ŒLSM-Tree å¯ä»¥åœ¨ Rolling Merge è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ä¸€æ¬¡ I/O æ‰¹é‡å‘ C1 å†™å…¥å¤šæ¡æ•°æ®ï¼Œé‚£ä¹ˆè¿™å¤šæ¡æ•°æ®å°±å‡æ‘Šäº†è¿™ä¸€æ¬¡ I/Oï¼Œå‡å°‘ç£ç›˜çš„ I/O å¼€é”€ï¼› Multi-Page Blockï¼šLSM-Tree çš„æ‰¹é‡å†™å¯ä»¥æœ‰æ•ˆåœ°åˆ©ç”¨ Multi-Page Blockï¼Œåœ¨ Rolling Merge çš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ¬¡ä» C1 ä¸­è¯»å‡ºå¤šä¸ªè¿ç»­çš„æ•°æ®é¡µä¸ C0 åˆå¹¶ï¼Œç„¶åä¸€æ¬¡å‘ C1 å†™å›è¿™äº›è¿ç»­é¡µé¢ï¼Œè¿™æ ·åªéœ€è¦å•æ¬¡ I/O å°±å¯ä»¥å®Œæˆå¤šä¸ª Pages çš„è¯»å†™ã€‚ LSM Tree ç»„ä»¶ä»‹ç» å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒLSMæ ‘æœ‰ä»¥ä¸‹ä¸‰ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼š\nMemTable MemTableæ˜¯åœ¨å†…å­˜ä¸­çš„æ•°æ®ç»“æ„ï¼Œç”¨äºä¿å­˜æœ€è¿‘æ›´æ–°çš„æ•°æ®ï¼Œä¼šæŒ‰ç…§Keyæœ‰åºåœ°ç»„ç»‡è¿™äº›æ•°æ®ï¼ŒLSMæ ‘å¯¹äºå…·ä½“å¦‚ä½•ç»„ç»‡æœ‰åºåœ°ç»„ç»‡æ•°æ®å¹¶æ²¡æœ‰æ˜ç¡®çš„æ•°æ®ç»“æ„å®šä¹‰ï¼Œä¾‹å¦‚Hbaseä½¿è·³è·ƒè¡¨æ¥ä¿è¯å†…å­˜ä¸­keyçš„æœ‰åºã€‚å› ä¸ºæ•°æ®æš‚æ—¶ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå†…å­˜å¹¶ä¸æ˜¯å¯é å­˜å‚¨ï¼Œå¦‚æœæ–­ç”µä¼šä¸¢å¤±æ•°æ®ï¼Œå› æ­¤é€šå¸¸ä¼šé€šè¿‡WAL(Write-ahead loggingï¼Œé¢„å†™å¼æ—¥å¿—)çš„æ–¹å¼æ¥ä¿è¯æ•°æ®çš„å¯é æ€§ã€‚\nImmutable MemTable å½“ MemTableè¾¾åˆ°ä¸€å®šå¤§å°åï¼Œä¼šè½¬åŒ–æˆImmutable MemTableã€‚Immutable MemTableæ˜¯å°†è½¬MemTableå˜ä¸ºSSTableçš„ä¸€ç§ä¸­é—´çŠ¶æ€ã€‚å†™æ“ä½œç”±æ–°çš„MemTableå¤„ç†ï¼Œåœ¨è½¬å­˜è¿‡ç¨‹ä¸­ä¸é˜»å¡æ•°æ®æ›´æ–°æ“ä½œã€‚\nSSTable(Sorted String Table) æœ‰åºé”®å€¼å¯¹é›†åˆï¼Œæ˜¯LSMæ ‘ç»„åœ¨ç£ç›˜ä¸­çš„æ•°æ®ç»“æ„ã€‚ä¸ºäº†åŠ å¿«SSTableçš„è¯»å–ï¼Œå¯ä»¥é€šè¿‡å»ºç«‹keyçš„ç´¢å¼•ä»¥åŠå¸ƒéš†è¿‡æ»¤å™¨æ¥åŠ å¿«keyçš„æŸ¥æ‰¾ã€‚ è¿™é‡Œéœ€è¦å…³æ³¨ä¸€ä¸ªé‡ç‚¹ï¼ŒLSMæ ‘(Log-Structured-Merge-Tree)æ­£å¦‚å®ƒçš„åå­—ä¸€æ ·ï¼ŒLSMæ ‘ä¼šå°†æ‰€æœ‰çš„æ•°æ®æ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤ç­‰æ“ä½œè®°å½•(æ³¨æ„æ˜¯æ“ä½œè®°å½•)ä¿å­˜åœ¨å†…å­˜ä¹‹ä¸­ï¼Œå½“æ­¤ç±»æ“ä½œè¾¾åˆ°ä¸€å®šçš„æ•°æ®é‡åï¼Œå†æ‰¹é‡åœ°é¡ºåºå†™å…¥åˆ°ç£ç›˜å½“ä¸­ã€‚è¿™ä¸B+æ ‘ä¸åŒï¼ŒB+æ ‘æ•°æ®çš„æ›´æ–°ä¼šç›´æ¥åœ¨åŸæ•°æ®æ‰€åœ¨å¤„ä¿®æ”¹å¯¹åº”çš„å€¼ï¼Œä½†æ˜¯LSMæ•°çš„æ•°æ®æ›´æ–°æ˜¯æ—¥å¿—å¼çš„ï¼Œå½“ä¸€æ¡æ•°æ®æ›´æ–°æ˜¯ç›´æ¥appendä¸€æ¡æ›´æ–°è®°å½•å®Œæˆçš„ã€‚è¿™æ ·è®¾è®¡çš„ç›®çš„å°±æ˜¯ä¸ºäº†é¡ºåºå†™ï¼Œä¸æ–­åœ°å°†Immutable MemTable flushåˆ°æŒä¹…åŒ–å­˜å‚¨å³å¯ï¼Œè€Œä¸ç”¨å»ä¿®æ”¹ä¹‹å‰çš„SSTableä¸­çš„keyï¼Œä¿è¯äº†é¡ºåºå†™ã€‚\nå› æ­¤å½“MemTableè¾¾åˆ°ä¸€å®šå¤§å°flushåˆ°æŒä¹…åŒ–å­˜å‚¨å˜æˆSSTableåï¼Œåœ¨ä¸åŒçš„SSTableä¸­ï¼Œå¯èƒ½å­˜åœ¨ç›¸åŒKeyçš„è®°å½•ï¼Œå½“ç„¶æœ€æ–°çš„é‚£æ¡è®°å½•æ‰æ˜¯å‡†ç¡®çš„ã€‚è¿™æ ·è®¾è®¡çš„è™½ç„¶å¤§å¤§æé«˜äº†å†™æ€§èƒ½ï¼Œä½†åŒæ—¶ä¹Ÿä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼š\n1 å†—ä½™å­˜å‚¨ï¼Œå¯¹äºæŸä¸ªkeyï¼Œå®é™…ä¸Šé™¤äº†æœ€æ–°çš„é‚£æ¡è®°å½•å¤–ï¼Œå…¶ä»–çš„è®°å½•éƒ½æ˜¯å†—ä½™æ— ç”¨çš„ï¼Œä½†æ˜¯ä»ç„¶å ç”¨äº†å­˜å‚¨ç©ºé—´ã€‚å› æ­¤éœ€è¦è¿›è¡ŒCompactæ“ä½œ(åˆå¹¶å¤šä¸ªSSTable)æ¥æ¸…é™¤å†—ä½™çš„è®°å½•ã€‚ 2 è¯»å–æ—¶éœ€è¦ä»æœ€æ–°çš„å€’ç€æŸ¥è¯¢ï¼Œç›´åˆ°æ‰¾åˆ°æŸä¸ªkeyçš„è®°å½•ã€‚æœ€åæƒ…å†µéœ€è¦æŸ¥è¯¢å®Œæ‰€æœ‰çš„SSTableï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡å‰é¢æåˆ°çš„ç´¢å¼•/å¸ƒéš†è¿‡æ»¤å™¨æ¥ä¼˜åŒ–æŸ¥æ‰¾é€Ÿåº¦ã€‚\nLSMæ ‘çš„Compactç­–ç•¥ ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼ŒCompactæ“ä½œæ˜¯ååˆ†å…³é”®çš„æ“ä½œï¼Œå¦åˆ™SSTableæ•°é‡ä¼šä¸æ–­è†¨èƒ€ã€‚åœ¨Compactç­–ç•¥ä¸Šï¼Œä¸»è¦ä»‹ç»ä¸¤ç§åŸºæœ¬ç­–ç•¥ï¼šsize-tieredå’Œleveledã€‚ ä¸è¿‡åœ¨ä»‹ç»è¿™ä¸¤ç§ç­–ç•¥ä¹‹å‰ï¼Œå…ˆä»‹ç»ä¸‰ä¸ªæ¯”è¾ƒé‡è¦çš„æ¦‚å¿µï¼Œäº‹å®ä¸Šä¸åŒçš„ç­–ç•¥å°±æ˜¯å›´ç»•è¿™ä¸‰ä¸ªæ¦‚å¿µä¹‹é—´åšå‡ºæƒè¡¡å’Œå–èˆã€‚\nè¯»æ”¾å¤§:è¯»å–æ•°æ®æ—¶å®é™…è¯»å–çš„æ•°æ®é‡å¤§äºçœŸæ­£çš„æ•°æ®é‡ã€‚ä¾‹å¦‚åœ¨LSMæ ‘ä¸­éœ€è¦å…ˆåœ¨MemTableæŸ¥çœ‹å½“å‰keyæ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨ç»§ç»­ä»SSTableä¸­å¯»æ‰¾ã€‚ å†™æ”¾å¤§:å†™å…¥æ•°æ®æ—¶å®é™…å†™å…¥çš„æ•°æ®é‡å¤§äºçœŸæ­£çš„æ•°æ®é‡ã€‚ä¾‹å¦‚åœ¨LSMæ ‘ä¸­å†™å…¥æ—¶å¯èƒ½è§¦å‘Compactæ“ä½œï¼Œå¯¼è‡´å®é™…å†™å…¥çš„æ•°æ®é‡è¿œå¤§äºè¯¥keyçš„æ•°æ®é‡ã€‚ ç©ºé—´æ”¾å¤§:æ•°æ®å®é™…å ç”¨çš„ç£ç›˜ç©ºé—´æ¯”æ•°æ®çš„çœŸæ­£å¤§å°æ›´å¤šã€‚ä¸Šé¢æåˆ°çš„å†—ä½™å­˜å‚¨ï¼Œå¯¹äºä¸€ä¸ªkeyæ¥è¯´ï¼Œåªæœ‰æœ€æ–°çš„é‚£æ¡è®°å½•æ˜¯æœ‰æ•ˆçš„ï¼Œè€Œä¹‹å‰çš„è®°å½•éƒ½æ˜¯å¯ä»¥è¢«æ¸…ç†å›æ”¶çš„ã€‚\n1) size-tiered ç­–ç•¥ size-tieredç­–ç•¥ä¿è¯æ¯å±‚SSTableçš„å¤§å°ç›¸è¿‘ï¼ŒåŒæ—¶é™åˆ¶æ¯ä¸€å±‚SSTableçš„æ•°é‡ã€‚å¦‚ä¸Šå›¾ï¼Œæ¯å±‚é™åˆ¶SSTableä¸ºNï¼Œå½“æ¯å±‚SSTableè¾¾åˆ°Nåï¼Œåˆ™è§¦å‘Compactæ“ä½œåˆå¹¶è¿™äº›SSTableï¼Œå¹¶å°†åˆå¹¶åçš„ç»“æœå†™å…¥åˆ°ä¸‹ä¸€å±‚æˆä¸ºä¸€ä¸ªæ›´å¤§çš„sstableã€‚ ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œå½“å±‚æ•°è¾¾åˆ°ä¸€å®šæ•°é‡æ—¶ï¼Œæœ€åº•å±‚çš„å•ä¸ªSSTableçš„å¤§å°ä¼šå˜å¾—éå¸¸å¤§ã€‚å¹¶ä¸”size-tieredç­–ç•¥ä¼šå¯¼è‡´ç©ºé—´æ”¾å¤§æ¯”è¾ƒä¸¥é‡ã€‚å³ä½¿å¯¹äºåŒä¸€å±‚çš„SSTableï¼Œæ¯ä¸ªkeyçš„è®°å½•æ˜¯å¯èƒ½å­˜åœ¨å¤šä»½çš„ï¼Œåªæœ‰å½“è¯¥å±‚çš„SSTableæ‰§è¡Œcompactæ“ä½œæ‰ä¼šæ¶ˆé™¤è¿™äº›keyçš„å†—ä½™è®°å½•ã€‚\n2) leveledç­–ç•¥ leveledç­–ç•¥ä¹Ÿæ˜¯é‡‡ç”¨åˆ†å±‚çš„æ€æƒ³ï¼Œæ¯ä¸€å±‚é™åˆ¶æ€»æ–‡ä»¶çš„å¤§å°ã€‚ ä½†æ˜¯è·Ÿsize-tieredç­–ç•¥ä¸åŒçš„æ˜¯ï¼Œleveledä¼šå°†æ¯ä¸€å±‚åˆ‡åˆ†æˆå¤šä¸ªå¤§å°ç›¸è¿‘çš„SSTableã€‚è¿™äº›SSTableæ˜¯è¿™ä¸€å±‚æ˜¯å…¨å±€æœ‰åºçš„ï¼Œæ„å‘³ç€ä¸€ä¸ªkeyåœ¨æ¯ä¸€å±‚è‡³å¤šåªæœ‰1æ¡è®°å½•ï¼Œä¸å­˜åœ¨å†—ä½™è®°å½•ã€‚ä¹‹æ‰€ä»¥å¯ä»¥ä¿è¯å…¨å±€æœ‰åºï¼Œæ˜¯å› ä¸ºåˆå¹¶ç­–ç•¥å’Œsize-tieredä¸åŒï¼Œæ¥ä¸‹æ¥ä¼šè¯¦ç»†æåˆ°ã€‚\nå‡è®¾å­˜åœ¨ä»¥ä¸‹è¿™æ ·çš„åœºæ™¯:\nL1çš„æ€»å¤§å°è¶…è¿‡L1æœ¬èº«å¤§å°é™åˆ¶ï¼š æ­¤æ—¶ä¼šä»L1ä¸­é€‰æ‹©è‡³å°‘ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åæŠŠå®ƒè·ŸL2æœ‰äº¤é›†çš„éƒ¨åˆ†(éå¸¸å…³é”®)è¿›è¡Œåˆå¹¶ã€‚ç”Ÿæˆçš„æ–‡ä»¶ä¼šæ”¾åœ¨L2: å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ­¤æ—¶L1ç¬¬äºŒSSTableçš„keyçš„èŒƒå›´è¦†ç›–äº†L2ä¸­å‰ä¸‰ä¸ªSSTableï¼Œé‚£ä¹ˆå°±éœ€è¦å°†L1ä¸­ç¬¬äºŒä¸ªSSTableä¸L2ä¸­å‰ä¸‰ä¸ªSSTableæ‰§è¡ŒCompactæ“ä½œã€‚\nå¦‚æœL2åˆå¹¶åçš„ç»“æœä»æ—§è¶…å‡ºL2çš„é˜ˆå€¼å¤§å°ï¼Œéœ€è¦é‡å¤ä¹‹å‰çš„æ“ä½œ â€”â€” é€‰è‡³å°‘ä¸€ä¸ªæ–‡ä»¶ç„¶åæŠŠå®ƒåˆå¹¶åˆ°ä¸‹ä¸€å±‚: éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¤šä¸ªä¸ç›¸å¹²çš„åˆå¹¶æ˜¯å¯ä»¥å¹¶å‘è¿›è¡Œçš„ï¼š leveledç­–ç•¥ç›¸è¾ƒäºsize-tieredç­–ç•¥æ¥è¯´ï¼Œæ¯å±‚å†…keyæ˜¯ä¸ä¼šé‡å¤çš„ï¼Œå³ä½¿æ˜¯æœ€åçš„æƒ…å†µï¼Œé™¤å¼€æœ€åº•å±‚å¤–ï¼Œå…¶ä½™å±‚éƒ½æ˜¯é‡å¤keyï¼ŒæŒ‰ç…§ç›¸é‚»å±‚å¤§å°æ¯”ä¾‹ä¸º10æ¥ç®—ï¼Œå†—ä½™å æ¯”ä¹Ÿå¾ˆå°ã€‚å› æ­¤ç©ºé—´æ”¾å¤§é—®é¢˜å¾—åˆ°ç¼“è§£ã€‚ä½†æ˜¯å†™æ”¾å¤§é—®é¢˜ä¼šæ›´åŠ çªå‡ºã€‚ä¸¾ä¸€ä¸ªæœ€ååœºæ™¯ï¼Œå¦‚æœLevelNå±‚æŸä¸ªSSTableçš„keyçš„èŒƒå›´è·¨åº¦éå¸¸å¤§ï¼Œè¦†ç›–äº†LevelN+1å±‚æ‰€æœ‰keyçš„èŒƒå›´ï¼Œé‚£ä¹ˆè¿›è¡ŒCompactæ—¶å°†æ¶‰åŠLevelN+1å±‚çš„å…¨éƒ¨æ•°æ®ã€‚\n","permalink":"https://reid00.github.io/en/posts/storage/lsm-tree/","summary":"ç®€ä»‹LSM Tree MySQLã€etcd ç­‰å­˜å‚¨ç³»ç»Ÿéƒ½æ˜¯é¢å‘è¯»å¤šå†™å°‘åœºæ™¯çš„ï¼Œå…¶åº•å±‚å¤§éƒ½é‡‡ç”¨ B-Tree åŠå…¶å˜ç§æ•°æ®ç»“æ„ã€‚è€Œ LSM-Tree åˆ™è§£å†³äº†å¦ä¸€ä¸ªåº”ç”¨åœºæ™¯â€”â€”å†™å¤šè¯»å°‘æ—¶é¢ä¸´çš„é—®é¢˜ã€‚åœ¨é¢å¯¹äº¿çº§çš„æµ·é‡æ•°æ®çš„å­˜å‚¨å’Œæ£€ç´¢çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬é€šå¸¸é€‰æ‹©å¼ºåŠ›çš„ NoSQL æ•°æ®åº“ï¼Œå¦‚ Hbaseã€RocksDB ç­‰ï¼Œå®ƒä»¬çš„æ–‡ä»¶ç»„ç»‡æ–¹å¼ï¼Œéƒ½æ˜¯ä»¿ç…§ LSM-Tree å®ç°çš„ã€‚ reference\nLSM-Tree å…¨ç§°æ˜¯ Log Structured Merge Treeï¼Œæ˜¯ä¸€ç§åˆ†å±‚ã€æœ‰åºã€é¢å‘ç£ç›˜çš„æ•°æ®ç»“æ„ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯å……åˆ†åˆ©ç”¨ç£ç›˜çš„é¡ºåºå†™æ€§èƒ½è¦è¿œé«˜äºéšæœºå†™æ€§èƒ½è¿™ä¸€ç‰¹æ€§ï¼Œå°†æ‰¹é‡çš„éšæœºå†™è½¬åŒ–ä¸ºä¸€æ¬¡æ€§çš„é¡ºåºå†™ã€‚\nä»ä¸Šå›¾å¯ä»¥ç›´è§‚åœ°çœ‹å‡ºï¼Œç£ç›˜çš„é¡ºåºè®¿é—®é€Ÿåº¦è‡³å°‘æ¯”éšæœº I/O å¿«ä¸‰ä¸ªæ•°é‡çº§ï¼Œç”šè‡³é¡ºåºè®¿é—®ç£ç›˜æ¯”éšæœºè®¿é—®ä¸»å†…å­˜è¿˜è¦å¿«ã€‚è¿™æ„å‘³ç€è¦å°½å¯èƒ½é¿å…éšæœº I/O æ“ä½œï¼Œé¡ºåºè®¿é—®éå¸¸å€¼å¾—æˆ‘ä»¬å»æ¢è®¨ä¸è®¾è®¡ã€‚\nLSM-Tree å›´ç»•è¿™ä¸€åŸç†è¿›è¡Œè®¾è®¡å’Œä¼˜åŒ–ï¼Œé€šè¿‡æ¶ˆå»éšæœºçš„æ›´æ–°æ“ä½œæ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œä»¥æ­¤è®©å†™æ€§èƒ½è¾¾åˆ°æœ€ä¼˜ï¼ŒåŒæ—¶ä¸ºé‚£äº›é•¿æœŸå…·æœ‰é«˜æ›´æ–°é¢‘ç‡çš„æ–‡ä»¶æä¾›ä½æˆæœ¬çš„ç´¢å¼•æœºåˆ¶ï¼Œå‡å°‘æŸ¥è¯¢æ—¶çš„å¼€é”€ã€‚\nTwo-Component LSM-Tree LSM-Tree å¯ä»¥ç”±ä¸¤ä¸ªæˆ–å¤šä¸ªç±»æ ‘çš„æ•°æ®ç»“æ„ç»„ä»¶æ„æˆï¼Œæœ¬å°èŠ‚æˆ‘ä»¬å…ˆä»‹ç»è¾ƒä¸ºç®€å•çš„ä¸¤ç»„ä»¶æƒ…å†µã€‚ ä¸¤ç»„ä»¶ LSM-Treeï¼ˆTwo-Component LSM-Treeï¼‰åœ¨å†…å­˜ä¸­æœ‰ä¸€ä¸ª C0 ç»„ä»¶ï¼Œå®ƒå¯ä»¥æ˜¯ AVL æˆ– SkipList ç­‰ç»“æ„ï¼Œæ‰€æœ‰å†™å…¥é¦–å…ˆå†™åˆ° C0 ä¸­ã€‚è€Œç£ç›˜ä¸Šæœ‰ä¸€ä¸ª C1 ç»„ä»¶ï¼Œå½“ C0 ç»„ä»¶çš„å¤§å°è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±éœ€è¦è¿›è¡Œ Rolling Mergeï¼Œå°†å†…å­˜ä¸­çš„å†…å®¹åˆå¹¶åˆ° C1 ä¸­ã€‚ä¸¤ç»„ä»¶ LSM-Tree çš„å†™æ“ä½œæµç¨‹å¦‚ä¸‹ï¼š\nå½“æœ‰å†™æ“ä½œæ—¶ï¼Œä¼šå…ˆå°†æ•°æ®è¿½åŠ å†™åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œä»¥å¤‡å¿…è¦æ—¶æ¢å¤ï¼› ç„¶åå°†æ•°æ®å†™å…¥ä½äºå†…å­˜çš„ C0 ç»„ä»¶ï¼Œé€šè¿‡æŸç§æ•°æ®ç»“æ„ä¿æŒ Key æœ‰åºï¼› å†…å­˜ä¸­çš„æ•°æ®å®šæ—¶æˆ–æŒ‰å›ºå®šå¤§å°åˆ·æ–°åˆ°ç£ç›˜ï¼Œæ›´æ–°æ“ä½œåªå†™åˆ°å†…å­˜ï¼Œå¹¶ä¸æ›´æ–°ç£ç›˜ä¸Šå·²æœ‰æ–‡ä»¶ï¼› éšç€å†™æ“ä½œè¶Šæ¥è¶Šå¤šï¼Œç£ç›˜ä¸Šç§¯ç´¯çš„æ–‡ä»¶ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œè¿™äº›æ–‡ä»¶ä¸å¯å†™ä½†æœ‰åºï¼Œæ‰€ä»¥æˆ‘ä»¬å®šæ—¶å¯¹æ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼ˆCompactionï¼‰æ“ä½œï¼Œæ¶ˆé™¤å†—ä½™æ•°æ®ï¼Œå‡å°‘æ–‡ä»¶æ•°é‡ã€‚ ç±»ä¼¼äºæ™®é€šçš„æ—¥å¿—å†™å…¥æ–¹å¼ï¼Œè¿™ç§æ•°æ®ç»“æ„çš„å†™å…¥ï¼Œå…¨éƒ¨éƒ½æ˜¯ä»¥Appendçš„æ¨¡å¼è¿½åŠ ï¼Œä¸å­˜åœ¨åˆ é™¤å’Œä¿®æ”¹ã€‚å¯¹äºä»»ä½•åº”ç”¨æ¥è¯´ï¼Œé‚£äº›ä¼šå¯¼è‡´ç´¢å¼•å€¼å‘ç”Ÿå˜åŒ–çš„æ•°æ®æ›´æ–°éƒ½æ˜¯ç¹çä¸”è€—æ—¶çš„ï¼Œä½†æ˜¯è¿™æ ·çš„æ›´æ–°å´å¯ä»¥è¢« LSM-Tree è½»æ¾åœ°è§£å†³ï¼Œå°†è¯¥æ›´æ–°æ“ä½œçœ‹åšæ˜¯ä¸€ä¸ªåˆ é™¤æ“ä½œåŠ ä¸Šä¸€ä¸ªæ’å…¥æ“ä½œã€‚\nC1 ç»„ä»¶æ˜¯ä¸ºé¡ºåºæ€§çš„ç£ç›˜è®¿é—®ä¼˜åŒ–è¿‡çš„ï¼Œå¯ä»¥æ˜¯ B-Tree ä¸€ç±»çš„æ•°æ®ç»“æ„ï¼ˆLevelDB ä¸­çš„å®ç°æ˜¯ SSTableï¼‰ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯ 100% å¡«å……ï¼Œä¸ºäº†æœ‰æ•ˆåˆ©ç”¨ç£ç›˜ï¼Œåœ¨æ ¹èŠ‚ç‚¹ä¹‹ä¸‹çš„æ‰€æœ‰çš„å•é¡µé¢èŠ‚ç‚¹éƒ½ä¼šè¢«æ‰“åŒ…æ”¾åˆ°è¿ç»­çš„å¤šé¡µé¢ç£ç›˜å—ï¼ˆMulti-Page Blockï¼‰ä¸Šã€‚å¯¹äº Rolling Merge å’Œé•¿åŒºé—´æ£€ç´¢çš„æƒ…å†µå°†ä¼šä½¿ç”¨ Multi-Page Block I/Oï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆå‡å°‘ç£ç›˜æ—‹è‡‚çš„ç§»åŠ¨ï¼›è€Œåœ¨åŒ¹é…æ€§çš„æŸ¥æ‰¾ä¸­ä¼šä½¿ç”¨ Single-Page I/Oï¼Œä»¥æœ€å°åŒ–ç¼“å­˜é‡ã€‚é€šå¸¸æ ¹èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå•é¡µé¢ï¼Œè€Œå…¶å®ƒèŠ‚ç‚¹ä½¿ç”¨ 256KB çš„ Multi-Page Blockã€‚","title":"LSM Tree"},{"content":"ä¸€ã€æ¦‚è¿° 1.1 åŸºæœ¬æ¦‚å¿µï¼š Dockeræ˜¯ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒå®¹å™¨ï¼Œå¯ä»¥å°†ä½ çš„å¼€å‘ç¯å¢ƒã€ä»£ç ã€é…ç½®æ–‡ä»¶ç­‰ä¸€å¹¶æ‰“åŒ…åˆ°è¿™ä¸ªå®¹å™¨ä¸­ï¼Œå¹¶å‘å¸ƒå’Œåº”ç”¨åˆ°ä»»æ„å¹³å°ä¸­ã€‚æ¯”å¦‚ï¼Œä½ åœ¨æœ¬åœ°ç”¨Pythonå¼€å‘ç½‘ç«™åå°ï¼Œå¼€å‘æµ‹è¯•å®Œæˆåï¼Œå°±å¯ä»¥å°†Python3åŠå…¶ä¾èµ–åŒ…ã€FlaskåŠå…¶å„ç§æ’ä»¶ã€Mysqlã€Nginxç­‰æ‰“åŒ…åˆ°ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œç„¶åéƒ¨ç½²åˆ°ä»»æ„ä½ æƒ³éƒ¨ç½²åˆ°çš„ç¯å¢ƒã€‚\n1.2 å¯¹æ¯”è™šæ‹Ÿæœºä¸Docker Dockerå®ˆæŠ¤è¿›ç¨‹å¯ä»¥ç›´æ¥ä¸ä¸»æ“ä½œç³»ç»Ÿè¿›è¡Œé€šä¿¡ï¼Œä¸ºå„ä¸ªDockerå®¹å™¨åˆ†é…èµ„æºï¼›å®ƒè¿˜å¯ä»¥å°†å®¹å™¨ä¸ä¸»æ“ä½œç³»ç»Ÿéš”ç¦»ï¼Œå¹¶å°†å„ä¸ªå®¹å™¨äº’ç›¸éš”ç¦»ã€‚è™šæ‹Ÿæœºå¯åŠ¨éœ€è¦æ•°åˆ†é’Ÿï¼Œè€ŒDockerå®¹å™¨å¯ä»¥åœ¨æ•°æ¯«ç§’å†…å¯åŠ¨ã€‚ç”±äºæ²¡æœ‰è‡ƒè‚¿çš„ä»æ“ä½œç³»ç»Ÿï¼ŒDockerå¯ä»¥èŠ‚çœå¤§é‡çš„ç£ç›˜ç©ºé—´ä»¥åŠå…¶ä»–ç³»ç»Ÿèµ„æºã€‚\nè¯´äº†è¿™ä¹ˆå¤šDockerçš„ä¼˜åŠ¿ï¼Œå¤§å®¶ä¹Ÿæ²¡æœ‰å¿…è¦å®Œå…¨å¦å®šè™šæ‹ŸæœºæŠ€æœ¯ï¼Œå› ä¸ºä¸¤è€…æœ‰ä¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚è™šæ‹Ÿæœºæ›´æ“…é•¿äºå½»åº•éš”ç¦»æ•´ä¸ªè¿è¡Œç¯å¢ƒã€‚ä¾‹å¦‚ï¼Œäº‘æœåŠ¡æä¾›å•†é€šå¸¸é‡‡ç”¨è™šæ‹ŸæœºæŠ€æœ¯éš”ç¦»ä¸åŒçš„ç”¨æˆ·ã€‚è€ŒDockeré€šå¸¸ç”¨äºéš”ç¦»ä¸åŒçš„åº”ç”¨ï¼Œä¾‹å¦‚å‰ç«¯ï¼Œåç«¯ä»¥åŠæ•°æ®åº“ã€‚\n1.3 ä¸ä¼ ç»ŸVMç‰¹æ€§å¯¹æ¯”ï¼š ç‰¹æ€§ å®¹å™¨ è™šæ‹Ÿæœº å¯åŠ¨é€Ÿåº¦ ç§’çº§ åˆ†é’Ÿçº§ ç¡¬ç›˜ä½¿ç”¨ ä¸€èˆ¬ä¸ºMB ä¸€èˆ¬ä¸ºGB æ€§èƒ½ æ¥è¿‘åŸç”Ÿ å¼±äºåŸç”Ÿ ç³»ç»Ÿæ”¯æŒé‡ å•æœºæ”¯æŒä¸Šåƒä¸ªå®¹å™¨ ä¸€èˆ¬å‡ åä¸ª éš”ç¦»æ€§ å®‰å…¨éš”ç¦» å®Œå…¨éš”ç¦» 1.4 Dockerç»„ä»¶ docker Clientå®¢æˆ·ç«¯â€”â€”â€”â€”\u0026gt;å‘dockeræœåŠ¡å™¨è¿›ç¨‹å‘èµ·è¯·æ±‚ï¼Œå¦‚:åˆ›å»ºã€åœæ­¢ã€é”€æ¯å®¹å™¨ç­‰æ“ä½œ\ndocker ServeræœåŠ¡å™¨è¿›ç¨‹â€”â€“\u0026gt;å¤„ç†æ‰€æœ‰dockerçš„è¯·æ±‚ï¼Œç®¡ç†æ‰€æœ‰å®¹å™¨\ndocker Registryé•œåƒä»“åº“â€”â€”\u0026gt;é•œåƒå­˜æ”¾çš„ä¸­å¤®ä»“åº“ï¼Œå¯çœ‹ä½œæ˜¯å­˜æ”¾äºŒè¿›åˆ¶çš„scm\n1.5 Dockerçš„ä¸‰ä¸ªæ¦‚å¿µ é•œåƒï¼ˆImageï¼‰ï¼šç±»ä¼¼äºè™šæ‹Ÿæœºä¸­çš„é•œåƒï¼Œæ˜¯ä¸€ä¸ªåŒ…å«æœ‰æ–‡ä»¶ç³»ç»Ÿçš„é¢å‘Dockerå¼•æ“çš„åªè¯»æ¨¡æ¿ã€‚ä»»ä½•åº”ç”¨ç¨‹åºè¿è¡Œéƒ½éœ€è¦ç¯å¢ƒï¼Œè€Œé•œåƒå°±æ˜¯ç”¨æ¥æä¾›è¿™ç§è¿è¡Œç¯å¢ƒçš„ã€‚ä¾‹å¦‚ä¸€ä¸ªUbuntué•œåƒå°±æ˜¯ä¸€ä¸ªåŒ…å«Ubuntuæ“ä½œç³»ç»Ÿç¯å¢ƒçš„æ¨¡æ¿ï¼ŒåŒç†åœ¨è¯¥é•œåƒä¸Šè£…ä¸ŠApacheè½¯ä»¶ï¼Œå°±å¯ä»¥ç§°ä¸ºApacheé•œåƒã€‚ å®¹å™¨ï¼ˆContainerï¼‰ï¼šç±»ä¼¼äºä¸€ä¸ªè½»é‡çº§çš„æ²™ç›’ï¼Œå¯ä»¥å°†å…¶çœ‹ä½œä¸€ä¸ªæç®€çš„Linuxç³»ç»Ÿç¯å¢ƒï¼ˆåŒ…æ‹¬rootæƒé™ã€è¿›ç¨‹ç©ºé—´ã€ç”¨æˆ·ç©ºé—´å’Œç½‘ç»œç©ºé—´ç­‰ï¼‰ï¼Œä»¥åŠè¿è¡Œåœ¨å…¶ä¸­çš„åº”ç”¨ç¨‹åºã€‚Dockerå¼•æ“åˆ©ç”¨å®¹å™¨æ¥è¿è¡Œã€éš”ç¦»å„ä¸ªåº”ç”¨ã€‚å®¹å™¨æ˜¯é•œåƒåˆ›å»ºçš„åº”ç”¨å®ä¾‹ï¼Œå¯ä»¥åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤å®¹å™¨ï¼Œå„ä¸ªå®¹å™¨ä¹‹é—´æ˜¯æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œäº’ä¸å½±å“ã€‚æ³¨æ„ï¼šé•œåƒæœ¬èº«æ˜¯åªè¯»çš„ï¼Œå®¹å™¨ä»é•œåƒå¯åŠ¨æ—¶ï¼ŒDockeråœ¨é•œåƒçš„ä¸Šå±‚åˆ›å»ºä¸€ä¸ªå¯å†™å±‚ï¼Œé•œåƒæœ¬èº«ä¸å˜ã€‚ ä»“åº“ï¼ˆRepositoryï¼‰ï¼šç±»ä¼¼äºä»£ç ä»“åº“ï¼Œè¿™é‡Œæ˜¯é•œåƒä»“åº“ï¼Œæ˜¯Dockerç”¨æ¥é›†ä¸­å­˜æ”¾é•œåƒæ–‡ä»¶çš„åœ°æ–¹ã€‚æ³¨æ„ä¸æ³¨å†ŒæœåŠ¡å™¨ï¼ˆRegistryï¼‰çš„åŒºåˆ«ï¼šæ³¨å†ŒæœåŠ¡å™¨æ˜¯å­˜æ”¾ä»“åº“çš„åœ°æ–¹ï¼Œä¸€èˆ¬ä¼šæœ‰å¤šä¸ªä»“åº“ï¼›è€Œä»“åº“æ˜¯å­˜æ”¾é•œåƒçš„åœ°æ–¹ï¼Œä¸€èˆ¬æ¯ä¸ªä»“åº“å­˜æ”¾ä¸€ç±»é•œåƒï¼Œæ¯ä¸ªé•œåƒåˆ©ç”¨tagè¿›è¡ŒåŒºåˆ†ï¼Œæ¯”å¦‚Ubuntuä»“åº“å­˜æ”¾æœ‰å¤šä¸ªç‰ˆæœ¬ï¼ˆ12.04ã€14.04ç­‰ï¼‰çš„Ubuntué•œåƒã€‚ äºŒã€å®‰è£…Docker 2.1 Ubuntu æ—§ç‰ˆæœ¬çš„ Docker ç§°ä¸º docker æˆ–è€… docker-engineï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¸è½½æ—§ç‰ˆæœ¬ï¼š\n1 $ sudo apt-get remove docker docker-engine docker.io ä½¿ç”¨ APT å®‰è£… 1 2 3 $ sudo apt-get update $ sudo apt-get install apt-transport-https ca-certificates curl software-properties-common Docker CE é•œåƒæºç«™ ä½¿ç”¨å®˜æ–¹å®‰è£…è„šæœ¬è‡ªåŠ¨å®‰è£… ï¼ˆä»…é€‚ç”¨äºå…¬ç½‘ç¯å¢ƒï¼‰ 1 curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun æ‰‹åŠ¨å®‰è£…å¸®åŠ© (é˜¿é‡Œäº‘ECSå¯ä»¥é€šè¿‡å†…ç½‘å®‰è£…ï¼Œè§æ³¨é‡Šéƒ¨åˆ†å†…å®¹) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # step 1: å®‰è£…å¿…è¦çš„ä¸€äº›ç³»ç»Ÿå·¥å…· sudo apt-get update sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common # step 2: å®‰è£…GPGè¯ä¹¦ curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add - # Step 3: å†™å…¥è½¯ä»¶æºä¿¡æ¯ sudo add-apt-repository \u0026#34;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable\u0026#34; # Step 4: æ›´æ–°å¹¶å®‰è£… Docker-CE sudo apt-get -y update sudo apt-get -y install docker-ce æ³¨æ„ï¼šå…¶ä»–æ³¨æ„äº‹é¡¹åœ¨ä¸‹é¢çš„æ³¨é‡Šä¸­ # å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Docker-CE: # Step 1: æŸ¥æ‰¾Docker-CEçš„ç‰ˆæœ¬: # apt-cache madison docker-ce # docker-ce | 17.03.1~ce-0~ubuntu-xenial | http://mirrors.aliyun.com/docker-ce/linux/ubuntu xenial/stable amd64 Packages # docker-ce | 17.03.0~ce-0~ubuntu-xenial | http://mirrors.aliyun.com/docker-ce/linux/ubuntu xenial/stable amd64 Packages # Step 2: å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Docker-CE: (VERSION ä¾‹å¦‚ä¸Šé¢çš„ 17.03.1~ce-0~ubuntu-xenial) # sudo apt-get -y install docker-ce=[VERSION] # é€šè¿‡ç»å…¸ç½‘ç»œã€VPCç½‘ç»œå†…ç½‘å®‰è£…æ—¶ï¼Œç”¨ä»¥ä¸‹å‘½ä»¤æ›¿æ¢Step 2ã€Step 3ä¸­çš„å‘½ä»¤ # ç»å…¸ç½‘ç»œï¼š # curl -fsSL http://mirrors.aliyuncs.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add - # sudo add-apt-repository \u0026#34;deb [arch=amd64] http://mirrors.aliyuncs.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable\u0026#34; # VPCç½‘ç»œï¼š # curl -fsSL http://mirrors.cloud.aliyuncs.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add - # sudo add-apt-repository \u0026#34;deb [arch=amd64] http://mirrors.cloud.aliyuncs.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable\u0026#34;\t2.2 CentOS 7 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 # step 1: å®‰è£…å¿…è¦çš„ä¸€äº›ç³»ç»Ÿå·¥å…· sudo yum install -y yum-utils device-mapper-persistent-data lvm2 # Step 2: æ·»åŠ è½¯ä»¶æºä¿¡æ¯ sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo # Step 3: æ›´æ–°å¹¶å®‰è£… Docker-CE sudo yum makecache fast sudo yum -y install docker-ce # Step 4: å¼€å¯DockeræœåŠ¡ sudo service docker start æ³¨æ„ï¼šå…¶ä»–æ³¨æ„äº‹é¡¹åœ¨ä¸‹é¢çš„æ³¨é‡Šä¸­ # å®˜æ–¹è½¯ä»¶æºé»˜è®¤å¯ç”¨äº†æœ€æ–°çš„è½¯ä»¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡ç¼–è¾‘è½¯ä»¶æºçš„æ–¹å¼è·å–å„ä¸ªç‰ˆæœ¬çš„è½¯ä»¶åŒ…ã€‚ä¾‹å¦‚å®˜æ–¹å¹¶æ²¡æœ‰å°†æµ‹è¯•ç‰ˆæœ¬çš„è½¯ä»¶æºç½®ä¸ºå¯ç”¨ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¼€å¯ã€‚åŒç†å¯ä»¥å¼€å¯å„ç§æµ‹è¯•ç‰ˆæœ¬ç­‰ã€‚ # vim /etc/yum.repos.d/docker-ce.repo # å°† [docker-ce-test] ä¸‹æ–¹çš„ enabled=0 ä¿®æ”¹ä¸º enabled=1 # # å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Docker-CE: # Step 1: æŸ¥æ‰¾Docker-CEçš„ç‰ˆæœ¬: # yum list docker-ce.x86_64 --showduplicates | sort -r # Loading mirror speeds from cached hostfile # Loaded plugins: branch, fastestmirror, langpacks # docker-ce.x86_64 17.03.1.ce-1.el7.centos docker-ce-stable # docker-ce.x86_64 17.03.1.ce-1.el7.centos @docker-ce-stable # docker-ce.x86_64 17.03.0.ce-1.el7.centos docker-ce-stable # Available Packages # Step2 : å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Docker-CE: (VERSION ä¾‹å¦‚ä¸Šé¢çš„ 17.03.0.ce.1-1.el7.centos) # sudo yum -y install docker-ce-[VERSION] # æ³¨æ„ï¼šåœ¨æŸäº›ç‰ˆæœ¬ä¹‹åï¼Œdocker-ceå®‰è£…å‡ºç°äº†å…¶ä»–ä¾èµ–åŒ…ï¼Œå¦‚æœå®‰è£…å¤±è´¥çš„è¯è¯·å…³æ³¨é”™è¯¯ä¿¡æ¯ã€‚ä¾‹å¦‚ docker-ce 17.03 ä¹‹åï¼Œéœ€è¦å…ˆå®‰è£… docker-ce-selinuxã€‚ # yum list docker-ce-selinux- --showduplicates | sort -r # sudo yum -y install docker-ce-selinux-[VERSION] # é€šè¿‡ç»å…¸ç½‘ç»œã€VPCç½‘ç»œå†…ç½‘å®‰è£…æ—¶ï¼Œç”¨ä»¥ä¸‹å‘½ä»¤æ›¿æ¢Step 2ä¸­çš„å‘½ä»¤ # ç»å…¸ç½‘ç»œï¼š # sudo yum-config-manager --add-repo http://mirrors.aliyuncs.com/docker-ce/linux/centos/docker-ce.repo # VPCç½‘ç»œï¼š # sudo yum-config-manager --add-repo http://mirrors.could.aliyuncs.com/docker-ce/linux/centos/docker-ce.repo 2.3 å®‰è£…æ ¡éªŒ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 root@iZbp12adskpuoxodbkqzjfZ:$ docker version Client: Version: 17.03.0-ce API version: 1.26 Go version: go1.7.5 Git commit: 3a232c8 Built: Tue Feb 28 07:52:04 2017 OS/Arch: linux/amd64 Server: Version: 17.03.0-ce API version: 1.26 (minimum version 1.12) Go version: go1.7.5 Git commit: 3a232c8 Built: Tue Feb 28 07:52:04 2017 OS/Arch: linux/amd64 Experimental: false ä¸‰ã€é•œåƒåŠ é€Ÿå™¨ ç½‘æ˜“äº‘åŠ é€Ÿå™¨ https://hub-mirror.c.163.com\nç™¾åº¦äº‘åŠ é€Ÿå™¨ https://mirror.baidubce.com\né˜¿é‡Œäº‘åŠ é€Ÿå™¨(éœ€ç™»å½•è´¦å·è·å–)\n3.1 Ubuntu 16.04+ã€Debian 8+ã€CentOS 7 å¯¹äºä½¿ç”¨ systemd çš„ç³»ç»Ÿï¼Œè¯·åœ¨ /etc/docker/daemon.json ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼ˆå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨è¯·æ–°å»ºè¯¥æ–‡ä»¶ï¼‰\n1 2 3 4 5 6 { \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;https://hub-mirror.c.163.com\u0026#34;, \u0026#34;https://mirror.baidubce.com\u0026#34; ] } ä¹‹åé‡æ–°å¯åŠ¨æœåŠ¡ã€‚\n1 2 $ sudo systemctl daemon-reload $ sudo systemctl restart docker å››ã€å‘½ä»¤æ•´ç† 4.1 å®¹å™¨æ“ä½œ 1 2 3 4 5 6 7 8 9 docker create # åˆ›å»ºä¸€ä¸ªå®¹å™¨ä½†æ˜¯ä¸å¯åŠ¨å®ƒ docker run # åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨ docker stop # åœæ­¢å®¹å™¨è¿è¡Œï¼Œå‘é€ä¿¡å·SIGTERM docker start # å¯åŠ¨ä¸€ä¸ªåœæ­¢çŠ¶æ€çš„å®¹å™¨ docker restart # é‡å¯ä¸€ä¸ªå®¹å™¨ docker rm # åˆ é™¤ä¸€ä¸ªå®¹å™¨ docker kill # å‘é€ä¿¡å·ç»™å®¹å™¨ï¼Œé»˜è®¤SIGKILL docker attach # è¿æ¥(è¿›å…¥)åˆ°ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨ docker wait # é˜»å¡ä¸€ä¸ªå®¹å™¨ï¼Œç›´åˆ°å®¹å™¨åœæ­¢è¿è¡Œ 4.2 è·å–å®¹å™¨ä¿¡æ¯ 1 2 3 4 5 6 7 8 docker ps # æ˜¾ç¤ºçŠ¶æ€ä¸ºè¿è¡Œï¼ˆUpï¼‰çš„å®¹å™¨ docker ps -a # æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨,åŒ…æ‹¬è¿è¡Œä¸­ï¼ˆUpï¼‰çš„å’Œé€€å‡ºçš„(Exited) docker inspect # æ·±å…¥å®¹å™¨å†…éƒ¨è·å–å®¹å™¨æ‰€æœ‰ä¿¡æ¯ docker logs # æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—(stdout/stderr) docker events # å¾—åˆ°dockeræœåŠ¡å™¨çš„å®æ—¶çš„äº‹ä»¶ docker port # æ˜¾ç¤ºå®¹å™¨çš„ç«¯å£æ˜ å°„ docker top # æ˜¾ç¤ºå®¹å™¨çš„è¿›ç¨‹ä¿¡æ¯ docker diff # æ˜¾ç¤ºå®¹å™¨æ–‡ä»¶ç³»ç»Ÿçš„å‰åå˜åŒ– 4.3 å¯¼å‡ºå®¹å™¨ 1 2 docker cp # ä»å®¹å™¨é‡Œå‘å¤–æ‹·è´æ–‡ä»¶æˆ–ç›®å½• docker export # å°†å®¹å™¨æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿå¯¼å‡ºä¸ºä¸€ä¸ªtaråŒ…ï¼Œä¸å¸¦layersã€tagç­‰ä¿¡æ¯ 4.4 æ‰§è¡Œ 1 docker exec # åœ¨å®¹å™¨é‡Œæ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œå¯ä»¥æ‰§è¡Œbashè¿›å…¥äº¤äº’å¼ 4.5 é•œåƒæ“ä½œ 1 2 3 4 5 6 7 8 9 docker images # æ˜¾ç¤ºæœ¬åœ°æ‰€æœ‰çš„é•œåƒåˆ—è¡¨ docker import # ä»ä¸€ä¸ªtaråŒ…åˆ›å»ºä¸€ä¸ªé•œåƒï¼Œå¾€å¾€å’Œexportç»“åˆä½¿ç”¨ docker build # ä½¿ç”¨Dockerfileåˆ›å»ºé•œåƒï¼ˆæ¨èï¼‰ docker commit # ä»å®¹å™¨åˆ›å»ºé•œåƒ docker rmi or docker image rm [name:tag] # åˆ é™¤ä¸€ä¸ªé•œåƒ docker load # ä»ä¸€ä¸ªtaråŒ…åˆ›å»ºä¸€ä¸ªé•œåƒï¼Œå’Œsaveé…åˆä½¿ç”¨ docker save # å°†ä¸€ä¸ªé•œåƒä¿å­˜ä¸ºä¸€ä¸ªtaråŒ…ï¼Œå¸¦layerså’Œtagä¿¡æ¯ docker history # æ˜¾ç¤ºç”Ÿæˆä¸€ä¸ªé•œåƒçš„å†å²å‘½ä»¤ docker tag # ä¸ºé•œåƒèµ·ä¸€ä¸ªåˆ«å 4.6 é•œåƒä»“åº“(registry)æ“ä½œ 1 2 3 4 docker login # ç™»å½•åˆ°ä¸€ä¸ªregistry docker search # ä»registryä»“åº“æœç´¢é•œåƒ docker pull # ä»ä»“åº“ä¸‹è½½é•œåƒåˆ°æœ¬åœ° docker push # å°†ä¸€ä¸ªé•œåƒpushåˆ°registryä»“åº“ä¸­ 4.7 æ•°æ®åˆ¸æ“ä½œ 1 2 3 4 5 # docker -it -v /å®¿ä¸»æœºç»å¯¹è·¯å¾„:/å®¹å™¨å†…çš„ç›®å½• é•œåƒåç§° docker run -it -v /myDataVolume:/dataVolumeContainter centos # docker -it -v /å®¿ä¸»æœºç»å¯¹è·¯å¾„:/å®¹å™¨å†…çš„ç›®å½•:ro é•œåƒåç§° å®¹å™¨å†…çš„æ–‡ä»¶åªè¯»æƒé™, ä¸å¯ä»¥å†™æ–‡ä»¶ docker run -it -v /myDataVolume:/dataVolumeContainter:ro centos äº”ã€å®ä¾‹æ“ä½œ sourceï¼šhttps://yeasy.gitbook.io/docker_practice/install/mirror\nç°åœ¨è®©æˆ‘ä»¬ä»¥å®šåˆ¶ä¸€ä¸ª Web æœåŠ¡å™¨ä¸ºä¾‹å­ï¼Œæ¥è®²è§£é•œåƒæ˜¯å¦‚ä½•æ„å»ºçš„ã€‚\n1 docker run --name webserver -d -p 80:80 nginx è¿™æ¡å‘½ä»¤ä¼šç”¨ nginx é•œåƒå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå‘½åä¸º webserverï¼Œå¹¶ä¸”æ˜ å°„äº† 80 ç«¯å£ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ç”¨æµè§ˆå™¨å»è®¿é—®è¿™ä¸ª nginx æœåŠ¡å™¨ã€‚\nå¦‚æœæ˜¯åœ¨ Linux æœ¬æœºè¿è¡Œçš„ Dockerï¼Œæˆ–è€…å¦‚æœä½¿ç”¨çš„æ˜¯ Docker Desktop for Mac/Windowsï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è®¿é—®ï¼šhttp://localhostï¼›å¦‚æœä½¿ç”¨çš„æ˜¯ Docker Toolboxï¼Œæˆ–è€…æ˜¯åœ¨è™šæ‹Ÿæœºã€äº‘æœåŠ¡å™¨ä¸Šå®‰è£…çš„ Dockerï¼Œåˆ™éœ€è¦å°† localhost æ¢ä¸ºè™šæ‹Ÿæœºåœ°å€æˆ–è€…å®é™…äº‘æœåŠ¡å™¨åœ°å€ã€‚\nç›´æ¥ç”¨æµè§ˆå™¨è®¿é—®çš„è¯ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°é»˜è®¤çš„ Nginx æ¬¢è¿é¡µé¢ã€‚\nç°åœ¨ï¼Œå‡è®¾æˆ‘ä»¬éå¸¸ä¸å–œæ¬¢è¿™ä¸ªæ¬¢è¿é¡µé¢ï¼Œæˆ‘ä»¬å¸Œæœ›æ”¹æˆæ¬¢è¿ Docker çš„æ–‡å­—ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ docker exec å‘½ä»¤è¿›å…¥å®¹å™¨ï¼Œä¿®æ”¹å…¶å†…å®¹ã€‚\n1 2 3 4 $ docker exec -it webserver bash root@3729b97e8226:/# echo \u0026#39;\u0026lt;h1\u0026gt;Hello, Docker!\u0026lt;/h1\u0026gt;\u0026#39; \u0026gt; /usr/share/nginx/html/index.html root@3729b97e8226:/# exit exit æˆ‘ä»¬ä»¥äº¤äº’å¼ç»ˆç«¯æ–¹å¼è¿›å…¥ webserver å®¹å™¨ï¼Œå¹¶æ‰§è¡Œäº† bash å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯è·å¾—ä¸€ä¸ªå¯æ“ä½œçš„ Shellã€‚\nç„¶åï¼Œæˆ‘ä»¬ç”¨ Hello, Docker! è¦†ç›–äº† /usr/share/nginx/html/index.html çš„å†…å®¹ã€‚\nç°åœ¨æˆ‘ä»¬å†åˆ·æ–°æµè§ˆå™¨çš„è¯ï¼Œä¼šå‘ç°å†…å®¹è¢«æ”¹å˜äº†ã€‚\næˆ‘ä»¬ä¿®æ”¹äº†å®¹å™¨çš„æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ”¹åŠ¨äº†å®¹å™¨çš„å­˜å‚¨å±‚ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ docker diff å‘½ä»¤çœ‹åˆ°å…·ä½“çš„æ”¹åŠ¨ã€‚\n1 docker diff webserver ç°åœ¨æˆ‘ä»¬å®šåˆ¶å¥½äº†å˜åŒ–ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å°†å…¶ä¿å­˜ä¸‹æ¥å½¢æˆé•œåƒã€‚\nè¦çŸ¥é“ï¼Œå½“æˆ‘ä»¬è¿è¡Œä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ï¼ˆå¦‚æœä¸ä½¿ç”¨å·çš„è¯ï¼‰ï¼Œæˆ‘ä»¬åšçš„ä»»ä½•æ–‡ä»¶ä¿®æ”¹éƒ½ä¼šè¢«è®°å½•äºå®¹å™¨å­˜å‚¨å±‚é‡Œã€‚è€Œ Docker æä¾›äº†ä¸€ä¸ª docker commit å‘½ä»¤ï¼Œå¯ä»¥å°†å®¹å™¨çš„å­˜å‚¨å±‚ä¿å­˜ä¸‹æ¥æˆä¸ºé•œåƒã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯åœ¨åŸæœ‰é•œåƒçš„åŸºç¡€ä¸Šï¼Œå†å åŠ ä¸Šå®¹å™¨çš„å­˜å‚¨å±‚ï¼Œå¹¶æ„æˆæ–°çš„é•œåƒã€‚ä»¥åæˆ‘ä»¬è¿è¡Œè¿™ä¸ªæ–°é•œåƒçš„æ—¶å€™ï¼Œå°±ä¼šæ‹¥æœ‰åŸæœ‰å®¹å™¨æœ€åçš„æ–‡ä»¶å˜åŒ–ã€‚\ndocker commit çš„è¯­æ³•æ ¼å¼ä¸ºï¼š\n1 docker commit [é€‰é¡¹] \u0026lt;å®¹å™¨IDæˆ–å®¹å™¨å\u0026gt; [\u0026lt;ä»“åº“å\u0026gt;[:\u0026lt;æ ‡ç­¾\u0026gt;]] æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤å°†å®¹å™¨ä¿å­˜ä¸ºé•œåƒï¼š\n1 2 3 4 5 6 $ docker commit \\ --author \u0026#34;Tao Wang \u0026lt;twang2218@gmail.com\u0026gt;\u0026#34; \\ --message \u0026#34;ä¿®æ”¹äº†é»˜è®¤ç½‘é¡µ\u0026#34; \\ webserver \\ nginx:v2 sha256:07e33465974800ce65751acc279adc6ed2dc5ed4e0838f8b86f0c87aa1795214 å…¶ä¸­ --author æ˜¯æŒ‡å®šä¿®æ”¹çš„ä½œè€…ï¼Œè€Œ --message åˆ™æ˜¯è®°å½•æœ¬æ¬¡ä¿®æ”¹çš„å†…å®¹ã€‚è¿™ç‚¹å’Œ git ç‰ˆæœ¬æ§åˆ¶ç›¸ä¼¼ï¼Œä¸è¿‡è¿™é‡Œè¿™äº›ä¿¡æ¯å¯ä»¥çœç•¥ç•™ç©ºã€‚\næˆ‘ä»¬å¯ä»¥åœ¨ docker image ls ä¸­çœ‹åˆ°è¿™ä¸ªæ–°å®šåˆ¶çš„é•œåƒï¼š\n1 docker images or docker image ls æˆ‘ä»¬è¿˜å¯ä»¥ç”¨ docker history å…·ä½“æŸ¥çœ‹é•œåƒå†…çš„å†å²è®°å½•ï¼Œå¦‚æœæ¯”è¾ƒ nginx:latest çš„å†å²è®°å½•ï¼Œæˆ‘ä»¬ä¼šå‘ç°æ–°å¢äº†æˆ‘ä»¬åˆšåˆšæäº¤çš„è¿™ä¸€å±‚.\n1 2 3 4 5 6 7 8 9 10 11 $ docker history nginx:v2 IMAGE CREATED CREATED BY SIZE COMMENT 07e334659748 54 seconds ago nginx -g daemon off; 95 B ä¿®æ”¹äº†é»˜è®¤ç½‘é¡µ e43d811ce2f4 4 weeks ago /bin/sh -c #(nop) CMD [\u0026#34;nginx\u0026#34; \u0026#34;-g\u0026#34; \u0026#34;daemon 0 B \u0026lt;missing\u0026gt; 4 weeks ago /bin/sh -c #(nop) EXPOSE 443/tcp 80/tcp 0 B \u0026lt;missing\u0026gt; 4 weeks ago /bin/sh -c ln -sf /dev/stdout /var/log/nginx/ 22 B \u0026lt;missing\u0026gt; 4 weeks ago /bin/sh -c apt-key adv --keyserver hkp://pgp. 58.46 MB \u0026lt;missing\u0026gt; 4 weeks ago /bin/sh -c #(nop) ENV NGINX_VERSION=1.11.5-1 0 B \u0026lt;missing\u0026gt; 4 weeks ago /bin/sh -c #(nop) MAINTAINER NGINX Docker Ma 0 B \u0026lt;missing\u0026gt; 4 weeks ago /bin/sh -c #(nop) CMD [\u0026#34;/bin/bash\u0026#34;] 0 B \u0026lt;missing\u0026gt; 4 weeks ago /bin/sh -c #(nop) ADD file:23aa4f893e3288698c 123 MB æ–°çš„é•œåƒå®šåˆ¶å¥½åï¼Œæˆ‘ä»¬å¯ä»¥æ¥è¿è¡Œè¿™ä¸ªé•œåƒã€‚\n1 docker run --name web2 -d -p 81:80 nginx:v2 è¿™é‡Œæˆ‘ä»¬å‘½åä¸ºæ–°çš„æœåŠ¡ä¸º web2ï¼Œå¹¶ä¸”æ˜ å°„åˆ° 81 ç«¯å£ã€‚å¦‚æœæ˜¯ Docker Desktop for Mac/Windows æˆ– Linux æ¡Œé¢çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è®¿é—® http://localhost:81 çœ‹åˆ°ç»“æœï¼Œå…¶å†…å®¹åº”è¯¥å’Œä¹‹å‰ä¿®æ”¹åçš„ webserver ä¸€æ ·ã€‚\nè‡³æ­¤ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡å®Œæˆäº†å®šåˆ¶é•œåƒï¼Œä½¿ç”¨çš„æ˜¯ docker commit å‘½ä»¤ï¼Œæ‰‹åŠ¨æ“ä½œç»™æ—§çš„é•œåƒæ·»åŠ äº†æ–°çš„ä¸€å±‚ï¼Œå½¢æˆæ–°çš„é•œåƒï¼Œå¯¹é•œåƒå¤šå±‚å­˜å‚¨åº”è¯¥æœ‰äº†æ›´ç›´è§‚çš„æ„Ÿè§‰ã€‚\næ…ç”¨ docker commit ä½¿ç”¨ docker commit å‘½ä»¤è™½ç„¶å¯ä»¥æ¯”è¾ƒç›´è§‚çš„å¸®åŠ©ç†è§£é•œåƒåˆ†å±‚å­˜å‚¨çš„æ¦‚å¿µï¼Œä½†æ˜¯å®é™…ç¯å¢ƒä¸­å¹¶ä¸ä¼šè¿™æ ·ä½¿ç”¨ã€‚\né¦–å…ˆï¼Œå¦‚æœä»”ç»†è§‚å¯Ÿä¹‹å‰çš„ docker diff webserver çš„ç»“æœï¼Œä½ ä¼šå‘ç°é™¤äº†çœŸæ­£æƒ³è¦ä¿®æ”¹çš„ /usr/share/nginx/html/index.html æ–‡ä»¶å¤–ï¼Œç”±äºå‘½ä»¤çš„æ‰§è¡Œï¼Œè¿˜æœ‰å¾ˆå¤šæ–‡ä»¶è¢«æ”¹åŠ¨æˆ–æ·»åŠ äº†ã€‚è¿™è¿˜ä»…ä»…æ˜¯æœ€ç®€å•çš„æ“ä½œï¼Œå¦‚æœæ˜¯å®‰è£…è½¯ä»¶åŒ…ã€ç¼–è¯‘æ„å»ºï¼Œé‚£ä¼šæœ‰å¤§é‡çš„æ— å…³å†…å®¹è¢«æ·»åŠ è¿›æ¥ï¼Œå¦‚æœä¸å°å¿ƒæ¸…ç†ï¼Œå°†ä¼šå¯¼è‡´é•œåƒæä¸ºè‡ƒè‚¿ã€‚\næ­¤å¤–ï¼Œä½¿ç”¨ docker commit æ„å‘³ç€æ‰€æœ‰å¯¹é•œåƒçš„æ“ä½œéƒ½æ˜¯é»‘ç®±æ“ä½œï¼Œç”Ÿæˆçš„é•œåƒä¹Ÿè¢«ç§°ä¸º é»‘ç®±é•œåƒï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯é™¤äº†åˆ¶ä½œé•œåƒçš„äººçŸ¥é“æ‰§è¡Œè¿‡ä»€ä¹ˆå‘½ä»¤ã€æ€ä¹ˆç”Ÿæˆçš„é•œåƒï¼Œåˆ«äººæ ¹æœ¬æ— ä»å¾—çŸ¥ã€‚è€Œä¸”ï¼Œå³ä½¿æ˜¯è¿™ä¸ªåˆ¶ä½œé•œåƒçš„äººï¼Œè¿‡ä¸€æ®µæ—¶é—´åä¹Ÿæ— æ³•è®°æ¸…å…·ä½“çš„æ“ä½œã€‚è¿™ç§é»‘ç®±é•œåƒçš„ç»´æŠ¤å·¥ä½œæ˜¯éå¸¸ç—›è‹¦çš„ã€‚\nè€Œä¸”ï¼Œå›é¡¾ä¹‹å‰æåŠçš„é•œåƒæ‰€ä½¿ç”¨çš„åˆ†å±‚å­˜å‚¨çš„æ¦‚å¿µï¼Œé™¤å½“å‰å±‚å¤–ï¼Œä¹‹å‰çš„æ¯ä¸€å±‚éƒ½æ˜¯ä¸ä¼šå‘ç”Ÿæ”¹å˜çš„ï¼Œæ¢å¥è¯è¯´ï¼Œä»»ä½•ä¿®æ”¹çš„ç»“æœä»…ä»…æ˜¯åœ¨å½“å‰å±‚è¿›è¡Œæ ‡è®°ã€æ·»åŠ ã€ä¿®æ”¹ï¼Œè€Œä¸ä¼šæ”¹åŠ¨ä¸Šä¸€å±‚ã€‚å¦‚æœä½¿ç”¨ docker commit åˆ¶ä½œé•œåƒï¼Œä»¥åŠåæœŸä¿®æ”¹çš„è¯ï¼Œæ¯ä¸€æ¬¡ä¿®æ”¹éƒ½ä¼šè®©é•œåƒæ›´åŠ è‡ƒè‚¿ä¸€æ¬¡ï¼Œæ‰€åˆ é™¤çš„ä¸Šä¸€å±‚çš„ä¸œè¥¿å¹¶ä¸ä¼šä¸¢å¤±ï¼Œä¼šä¸€ç›´å¦‚å½±éšå½¢çš„è·Ÿç€è¿™ä¸ªé•œåƒï¼Œå³ä½¿æ ¹æœ¬æ— æ³•è®¿é—®åˆ°ã€‚è¿™ä¼šè®©é•œåƒæ›´åŠ è‡ƒè‚¿ã€‚\n","permalink":"https://reid00.github.io/en/posts/langs_linux/docker%E7%AC%94%E8%AE%B0/","summary":"ä¸€ã€æ¦‚è¿° 1.1 åŸºæœ¬æ¦‚å¿µï¼š Dockeræ˜¯ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒå®¹å™¨ï¼Œå¯ä»¥å°†ä½ çš„å¼€å‘ç¯å¢ƒã€ä»£ç ã€é…ç½®æ–‡ä»¶ç­‰ä¸€å¹¶æ‰“åŒ…åˆ°è¿™ä¸ªå®¹å™¨ä¸­ï¼Œå¹¶å‘å¸ƒå’Œåº”ç”¨åˆ°ä»»æ„å¹³å°ä¸­ã€‚æ¯”å¦‚ï¼Œä½ åœ¨æœ¬åœ°ç”¨Pythonå¼€å‘ç½‘ç«™åå°ï¼Œå¼€å‘æµ‹è¯•å®Œæˆåï¼Œå°±å¯ä»¥å°†Python3åŠå…¶ä¾èµ–åŒ…ã€FlaskåŠå…¶å„ç§æ’ä»¶ã€Mysqlã€Nginxç­‰æ‰“åŒ…åˆ°ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œç„¶åéƒ¨ç½²åˆ°ä»»æ„ä½ æƒ³éƒ¨ç½²åˆ°çš„ç¯å¢ƒã€‚\n1.2 å¯¹æ¯”è™šæ‹Ÿæœºä¸Docker Dockerå®ˆæŠ¤è¿›ç¨‹å¯ä»¥ç›´æ¥ä¸ä¸»æ“ä½œç³»ç»Ÿè¿›è¡Œé€šä¿¡ï¼Œä¸ºå„ä¸ªDockerå®¹å™¨åˆ†é…èµ„æºï¼›å®ƒè¿˜å¯ä»¥å°†å®¹å™¨ä¸ä¸»æ“ä½œç³»ç»Ÿéš”ç¦»ï¼Œå¹¶å°†å„ä¸ªå®¹å™¨äº’ç›¸éš”ç¦»ã€‚è™šæ‹Ÿæœºå¯åŠ¨éœ€è¦æ•°åˆ†é’Ÿï¼Œè€ŒDockerå®¹å™¨å¯ä»¥åœ¨æ•°æ¯«ç§’å†…å¯åŠ¨ã€‚ç”±äºæ²¡æœ‰è‡ƒè‚¿çš„ä»æ“ä½œç³»ç»Ÿï¼ŒDockerå¯ä»¥èŠ‚çœå¤§é‡çš„ç£ç›˜ç©ºé—´ä»¥åŠå…¶ä»–ç³»ç»Ÿèµ„æºã€‚\nè¯´äº†è¿™ä¹ˆå¤šDockerçš„ä¼˜åŠ¿ï¼Œå¤§å®¶ä¹Ÿæ²¡æœ‰å¿…è¦å®Œå…¨å¦å®šè™šæ‹ŸæœºæŠ€æœ¯ï¼Œå› ä¸ºä¸¤è€…æœ‰ä¸åŒçš„ä½¿ç”¨åœºæ™¯ã€‚è™šæ‹Ÿæœºæ›´æ“…é•¿äºå½»åº•éš”ç¦»æ•´ä¸ªè¿è¡Œç¯å¢ƒã€‚ä¾‹å¦‚ï¼Œäº‘æœåŠ¡æä¾›å•†é€šå¸¸é‡‡ç”¨è™šæ‹ŸæœºæŠ€æœ¯éš”ç¦»ä¸åŒçš„ç”¨æˆ·ã€‚è€ŒDockeré€šå¸¸ç”¨äºéš”ç¦»ä¸åŒçš„åº”ç”¨ï¼Œä¾‹å¦‚å‰ç«¯ï¼Œåç«¯ä»¥åŠæ•°æ®åº“ã€‚\n1.3 ä¸ä¼ ç»ŸVMç‰¹æ€§å¯¹æ¯”ï¼š ç‰¹æ€§ å®¹å™¨ è™šæ‹Ÿæœº å¯åŠ¨é€Ÿåº¦ ç§’çº§ åˆ†é’Ÿçº§ ç¡¬ç›˜ä½¿ç”¨ ä¸€èˆ¬ä¸ºMB ä¸€èˆ¬ä¸ºGB æ€§èƒ½ æ¥è¿‘åŸç”Ÿ å¼±äºåŸç”Ÿ ç³»ç»Ÿæ”¯æŒé‡ å•æœºæ”¯æŒä¸Šåƒä¸ªå®¹å™¨ ä¸€èˆ¬å‡ åä¸ª éš”ç¦»æ€§ å®‰å…¨éš”ç¦» å®Œå…¨éš”ç¦» 1.4 Dockerç»„ä»¶ docker Clientå®¢æˆ·ç«¯â€”â€”â€”â€”\u0026gt;å‘dockeræœåŠ¡å™¨è¿›ç¨‹å‘èµ·è¯·æ±‚ï¼Œå¦‚:åˆ›å»ºã€åœæ­¢ã€é”€æ¯å®¹å™¨ç­‰æ“ä½œ\ndocker ServeræœåŠ¡å™¨è¿›ç¨‹â€”â€“\u0026gt;å¤„ç†æ‰€æœ‰dockerçš„è¯·æ±‚ï¼Œç®¡ç†æ‰€æœ‰å®¹å™¨\ndocker Registryé•œåƒä»“åº“â€”â€”\u0026gt;é•œåƒå­˜æ”¾çš„ä¸­å¤®ä»“åº“ï¼Œå¯çœ‹ä½œæ˜¯å­˜æ”¾äºŒè¿›åˆ¶çš„scm\n1.5 Dockerçš„ä¸‰ä¸ªæ¦‚å¿µ é•œåƒï¼ˆImageï¼‰ï¼šç±»ä¼¼äºè™šæ‹Ÿæœºä¸­çš„é•œåƒï¼Œæ˜¯ä¸€ä¸ªåŒ…å«æœ‰æ–‡ä»¶ç³»ç»Ÿçš„é¢å‘Dockerå¼•æ“çš„åªè¯»æ¨¡æ¿ã€‚ä»»ä½•åº”ç”¨ç¨‹åºè¿è¡Œéƒ½éœ€è¦ç¯å¢ƒï¼Œè€Œé•œåƒå°±æ˜¯ç”¨æ¥æä¾›è¿™ç§è¿è¡Œç¯å¢ƒçš„ã€‚ä¾‹å¦‚ä¸€ä¸ªUbuntué•œåƒå°±æ˜¯ä¸€ä¸ªåŒ…å«Ubuntuæ“ä½œç³»ç»Ÿç¯å¢ƒçš„æ¨¡æ¿ï¼ŒåŒç†åœ¨è¯¥é•œåƒä¸Šè£…ä¸ŠApacheè½¯ä»¶ï¼Œå°±å¯ä»¥ç§°ä¸ºApacheé•œåƒã€‚ å®¹å™¨ï¼ˆContainerï¼‰ï¼šç±»ä¼¼äºä¸€ä¸ªè½»é‡çº§çš„æ²™ç›’ï¼Œå¯ä»¥å°†å…¶çœ‹ä½œä¸€ä¸ªæç®€çš„Linuxç³»ç»Ÿç¯å¢ƒï¼ˆåŒ…æ‹¬rootæƒé™ã€è¿›ç¨‹ç©ºé—´ã€ç”¨æˆ·ç©ºé—´å’Œç½‘ç»œç©ºé—´ç­‰ï¼‰ï¼Œä»¥åŠè¿è¡Œåœ¨å…¶ä¸­çš„åº”ç”¨ç¨‹åºã€‚Dockerå¼•æ“åˆ©ç”¨å®¹å™¨æ¥è¿è¡Œã€éš”ç¦»å„ä¸ªåº”ç”¨ã€‚å®¹å™¨æ˜¯é•œåƒåˆ›å»ºçš„åº”ç”¨å®ä¾‹ï¼Œå¯ä»¥åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤å®¹å™¨ï¼Œå„ä¸ªå®¹å™¨ä¹‹é—´æ˜¯æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œäº’ä¸å½±å“ã€‚æ³¨æ„ï¼šé•œåƒæœ¬èº«æ˜¯åªè¯»çš„ï¼Œå®¹å™¨ä»é•œåƒå¯åŠ¨æ—¶ï¼ŒDockeråœ¨é•œåƒçš„ä¸Šå±‚åˆ›å»ºä¸€ä¸ªå¯å†™å±‚ï¼Œé•œåƒæœ¬èº«ä¸å˜ã€‚ ä»“åº“ï¼ˆRepositoryï¼‰ï¼šç±»ä¼¼äºä»£ç ä»“åº“ï¼Œè¿™é‡Œæ˜¯é•œåƒä»“åº“ï¼Œæ˜¯Dockerç”¨æ¥é›†ä¸­å­˜æ”¾é•œåƒæ–‡ä»¶çš„åœ°æ–¹ã€‚æ³¨æ„ä¸æ³¨å†ŒæœåŠ¡å™¨ï¼ˆRegistryï¼‰çš„åŒºåˆ«ï¼šæ³¨å†ŒæœåŠ¡å™¨æ˜¯å­˜æ”¾ä»“åº“çš„åœ°æ–¹ï¼Œä¸€èˆ¬ä¼šæœ‰å¤šä¸ªä»“åº“ï¼›è€Œä»“åº“æ˜¯å­˜æ”¾é•œåƒçš„åœ°æ–¹ï¼Œä¸€èˆ¬æ¯ä¸ªä»“åº“å­˜æ”¾ä¸€ç±»é•œåƒï¼Œæ¯ä¸ªé•œåƒåˆ©ç”¨tagè¿›è¡ŒåŒºåˆ†ï¼Œæ¯”å¦‚Ubuntuä»“åº“å­˜æ”¾æœ‰å¤šä¸ªç‰ˆæœ¬ï¼ˆ12.04ã€14.04ç­‰ï¼‰çš„Ubuntué•œåƒã€‚ äºŒã€å®‰è£…Docker 2.1 Ubuntu æ—§ç‰ˆæœ¬çš„ Docker ç§°ä¸º docker æˆ–è€… docker-engineï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¸è½½æ—§ç‰ˆæœ¬ï¼š\n1 $ sudo apt-get remove docker docker-engine docker.io ä½¿ç”¨ APT å®‰è£… 1 2 3 $ sudo apt-get update $ sudo apt-get install apt-transport-https ca-certificates curl software-properties-common Docker CE é•œåƒæºç«™ ä½¿ç”¨å®˜æ–¹å®‰è£…è„šæœ¬è‡ªåŠ¨å®‰è£… ï¼ˆä»…é€‚ç”¨äºå…¬ç½‘ç¯å¢ƒï¼‰ 1 curl -fsSL https://get.","title":"Dockerç¬”è®°"},{"content":"ElasticSearché¢è¯•é¢˜ 1.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Elasticsearch? å› ä¸ºåœ¨æˆ‘ä»¬å•†åŸä¸­çš„æ•°æ®ï¼Œå°†æ¥ä¼šéå¸¸å¤šï¼Œæ‰€ä»¥é‡‡ç”¨ä»¥å¾€çš„æ¨¡ç³ŠæŸ¥è¯¢ï¼Œæ¨¡ç³ŠæŸ¥è¯¢å‰ç½®é…ç½®ï¼Œä¼šæ”¾å¼ƒç´¢å¼•ï¼Œå¯¼è‡´å•†å“æŸ¥è¯¢æ˜¯å…¨è¡¨æ‰«é¢ï¼Œåœ¨ç™¾ä¸‡çº§åˆ«çš„æ•°æ®åº“ä¸­ï¼Œæ•ˆç‡éå¸¸ä½ä¸‹ï¼Œè€Œæˆ‘ä»¬ä½¿ç”¨ESåšä¸€ä¸ªå…¨æ–‡ç´¢å¼•ï¼Œæˆ‘ä»¬å°†ç»å¸¸æŸ¥è¯¢çš„å•†å“çš„æŸäº›å­—æ®µï¼Œæ¯”å¦‚è¯´å•†å“åï¼Œæè¿°ã€ä»·æ ¼è¿˜æœ‰idè¿™äº›å­—æ®µæˆ‘ä»¬æ”¾å…¥æˆ‘ä»¬ç´¢å¼•åº“é‡Œï¼Œå¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚\n2.Elasticsearchæ˜¯å¦‚ä½•å®ç°Masteré€‰ä¸¾çš„ï¼Ÿ Elasticsearchçš„é€‰ä¸»æ˜¯ZenDiscoveryæ¨¡å—è´Ÿè´£çš„ï¼Œä¸»è¦åŒ…å«Pingï¼ˆèŠ‚ç‚¹ä¹‹é—´é€šè¿‡è¿™ä¸ªRPCæ¥å‘ç°å½¼æ­¤ï¼‰å’ŒUnicastï¼ˆå•æ’­æ¨¡å—åŒ…å«ä¸€ä¸ªä¸»æœºåˆ—è¡¨ä»¥æ§åˆ¶å“ªäº›èŠ‚ç‚¹éœ€è¦pingé€šï¼‰è¿™ä¸¤éƒ¨åˆ†ï¼›\nå¯¹æ‰€æœ‰å¯ä»¥æˆä¸ºmasterçš„èŠ‚ç‚¹ï¼ˆnode.master: trueï¼‰æ ¹æ®nodeIdå­—å…¸æ’åºï¼Œæ¯æ¬¡é€‰ä¸¾æ¯ä¸ªèŠ‚ç‚¹éƒ½æŠŠè‡ªå·±æ‰€çŸ¥é“èŠ‚ç‚¹æ’ä¸€æ¬¡åºï¼Œç„¶åé€‰å‡ºç¬¬ä¸€ä¸ªï¼ˆç¬¬0ä½ï¼‰èŠ‚ç‚¹ï¼Œæš‚ä¸”è®¤ä¸ºå®ƒæ˜¯masterèŠ‚ç‚¹ã€‚ å¦‚æœå¯¹æŸä¸ªèŠ‚ç‚¹çš„æŠ•ç¥¨æ•°è¾¾åˆ°ä¸€å®šçš„å€¼ï¼ˆå¯ä»¥æˆä¸ºmasterèŠ‚ç‚¹æ•°n/2+1ï¼‰å¹¶ä¸”è¯¥èŠ‚ç‚¹è‡ªå·±ä¹Ÿé€‰ä¸¾è‡ªå·±ï¼Œé‚£è¿™ä¸ªèŠ‚ç‚¹å°±æ˜¯masterã€‚å¦åˆ™é‡æ–°é€‰ä¸¾ä¸€ç›´åˆ°æ»¡è¶³ä¸Šè¿°æ¡ä»¶ã€‚ è¡¥å……ï¼šmasterèŠ‚ç‚¹çš„èŒè´£ä¸»è¦åŒ…æ‹¬é›†ç¾¤ã€èŠ‚ç‚¹å’Œç´¢å¼•çš„ç®¡ç†ï¼Œä¸è´Ÿè´£æ–‡æ¡£çº§åˆ«çš„ç®¡ç†ï¼›dataèŠ‚ç‚¹å¯ä»¥å…³é—­httpåŠŸèƒ½ã€‚ 3.Elasticsearchä¸­çš„èŠ‚ç‚¹ï¼ˆæ¯”å¦‚å…±20ä¸ªï¼‰ï¼Œå…¶ä¸­çš„10ä¸ªé€‰äº†ä¸€ä¸ªmasterï¼Œå¦å¤–10ä¸ªé€‰äº†å¦ä¸€ä¸ªmasterï¼Œæ€ä¹ˆåŠï¼Ÿ å½“é›†ç¾¤masterå€™é€‰æ•°é‡ä¸å°äº3ä¸ªæ—¶ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®æœ€å°‘æŠ•ç¥¨é€šè¿‡æ•°é‡ï¼ˆdiscovery.zen.minimum_master_nodesï¼‰è¶…è¿‡æ‰€æœ‰å€™é€‰èŠ‚ç‚¹ä¸€åŠä»¥ä¸Šæ¥è§£å†³è„‘è£‚é—®é¢˜ï¼› å½“å€™é€‰æ•°é‡ä¸ºä¸¤ä¸ªæ—¶ï¼Œåªèƒ½ä¿®æ”¹ä¸ºå”¯ä¸€çš„ä¸€ä¸ªmasterå€™é€‰ï¼Œå…¶ä»–ä½œä¸ºdataèŠ‚ç‚¹ï¼Œé¿å…è„‘è£‚é—®é¢˜ã€‚\n4.è¯¦ç»†æè¿°ä¸€ä¸‹Elasticsearchç´¢å¼•æ–‡æ¡£çš„è¿‡ç¨‹ã€‚ åè°ƒèŠ‚ç‚¹é»˜è®¤ä½¿ç”¨æ–‡æ¡£IDå‚ä¸è®¡ç®—ï¼ˆä¹Ÿæ”¯æŒé€šè¿‡routingï¼‰ï¼Œä»¥ä¾¿ä¸ºè·¯ç”±æä¾›åˆé€‚çš„åˆ†ç‰‡ã€‚ shard = hash(document_id) % (num_of_primary_shards) å½“åˆ†ç‰‡æ‰€åœ¨çš„èŠ‚ç‚¹æ¥æ”¶åˆ°æ¥è‡ªåè°ƒèŠ‚ç‚¹çš„è¯·æ±‚åï¼Œä¼šå°†è¯·æ±‚å†™å…¥åˆ°Memory Bufferï¼Œç„¶åå®šæ—¶ï¼ˆé»˜è®¤æ˜¯æ¯éš”1ç§’ï¼‰å†™å…¥åˆ°Filesystem Cacheï¼Œè¿™ä¸ªä»Momery Bufferåˆ°Filesystem Cacheçš„è¿‡ç¨‹å°±å«åšrefreshï¼› å½“ç„¶åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå­˜åœ¨Momery Bufferå’ŒFilesystem Cacheçš„æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ï¼ŒESæ˜¯é€šè¿‡translogçš„æœºåˆ¶æ¥ä¿è¯æ•°æ®çš„å¯é æ€§çš„ã€‚å…¶å®ç°æœºåˆ¶æ˜¯æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒåŒæ—¶ä¹Ÿä¼šå†™å…¥åˆ°translogä¸­ï¼Œå½“Filesystem cacheä¸­çš„æ•°æ®å†™å…¥åˆ°ç£ç›˜ä¸­æ—¶ï¼Œæ‰ä¼šæ¸…é™¤æ‰ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšflushï¼› åœ¨flushè¿‡ç¨‹ä¸­ï¼Œå†…å­˜ä¸­çš„ç¼“å†²å°†è¢«æ¸…é™¤ï¼Œå†…å®¹è¢«å†™å…¥ä¸€ä¸ªæ–°æ®µï¼Œæ®µçš„fsyncå°†åˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤ç‚¹ï¼Œå¹¶å°†å†…å®¹åˆ·æ–°åˆ°ç£ç›˜ï¼Œæ—§çš„translogå°†è¢«åˆ é™¤å¹¶å¼€å§‹ä¸€ä¸ªæ–°çš„translogã€‚ flushè§¦å‘çš„æ—¶æœºæ˜¯å®šæ—¶è§¦å‘ï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰æˆ–è€…translogå˜å¾—å¤ªå¤§ï¼ˆé»˜è®¤ä¸º512Mï¼‰æ—¶ï¼›\n5.è¯¦ç»†æè¿°ä¸€ä¸‹Elasticsearchæ›´æ–°å’Œåˆ é™¤æ–‡æ¡£çš„è¿‡ç¨‹ åˆ é™¤å’Œæ›´æ–°ä¹Ÿéƒ½æ˜¯å†™æ“ä½œï¼Œä½†æ˜¯Elasticsearchä¸­çš„æ–‡æ¡£æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤ä¸èƒ½è¢«åˆ é™¤æˆ–è€…æ”¹åŠ¨ä»¥å±•ç¤ºå…¶å˜æ›´ï¼› ç£ç›˜ä¸Šçš„æ¯ä¸ªæ®µéƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„.delæ–‡ä»¶ã€‚å½“åˆ é™¤è¯·æ±‚å‘é€åï¼Œæ–‡æ¡£å¹¶æ²¡æœ‰çœŸçš„è¢«åˆ é™¤ï¼Œè€Œæ˜¯åœ¨.delæ–‡ä»¶ä¸­è¢«æ ‡è®°ä¸ºåˆ é™¤ã€‚è¯¥æ–‡æ¡£ä¾ç„¶èƒ½åŒ¹é…æŸ¥è¯¢ï¼Œä½†æ˜¯ä¼šåœ¨ç»“æœä¸­è¢«è¿‡æ»¤æ‰ã€‚å½“æ®µåˆå¹¶æ—¶ï¼Œåœ¨.delæ–‡ä»¶ä¸­è¢«æ ‡è®°ä¸ºåˆ é™¤çš„æ–‡æ¡£å°†ä¸ä¼šè¢«å†™å…¥æ–°æ®µã€‚ åœ¨æ–°çš„æ–‡æ¡£è¢«åˆ›å»ºæ—¶ï¼ŒElasticsearchä¼šä¸ºè¯¥æ–‡æ¡£æŒ‡å®šä¸€ä¸ªç‰ˆæœ¬å·ï¼Œå½“æ‰§è¡Œæ›´æ–°æ—¶ï¼Œæ—§ç‰ˆæœ¬çš„æ–‡æ¡£åœ¨.delæ–‡ä»¶ä¸­è¢«æ ‡è®°ä¸ºåˆ é™¤ï¼Œæ–°ç‰ˆæœ¬çš„æ–‡æ¡£è¢«ç´¢å¼•åˆ°ä¸€ä¸ªæ–°æ®µã€‚æ—§ç‰ˆæœ¬çš„æ–‡æ¡£ä¾ç„¶èƒ½åŒ¹é…æŸ¥è¯¢ï¼Œä½†æ˜¯ä¼šåœ¨ç»“æœä¸­è¢«è¿‡æ»¤æ‰ã€‚\n6.è¯¦ç»†æè¿°ä¸€ä¸‹Elasticsearchæœç´¢çš„è¿‡ç¨‹ æœç´¢è¢«æ‰§è¡Œæˆä¸€ä¸ªä¸¤é˜¶æ®µè¿‡ç¨‹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º Query Then Fetchï¼› åœ¨åˆå§‹æŸ¥è¯¢é˜¶æ®µæ—¶ï¼ŒæŸ¥è¯¢ä¼šå¹¿æ’­åˆ°ç´¢å¼•ä¸­æ¯ä¸€ä¸ªåˆ†ç‰‡æ‹·è´ï¼ˆä¸»åˆ†ç‰‡æˆ–è€…å‰¯æœ¬åˆ†ç‰‡ï¼‰ã€‚ æ¯ä¸ªåˆ†ç‰‡åœ¨æœ¬åœ°æ‰§è¡Œæœç´¢å¹¶æ„å»ºä¸€ä¸ªåŒ¹é…æ–‡æ¡£çš„å¤§å°ä¸º from + size çš„ä¼˜å…ˆé˜Ÿåˆ—ã€‚PSï¼šåœ¨æœç´¢çš„æ—¶å€™æ˜¯ä¼šæŸ¥è¯¢Filesystem Cacheçš„ï¼Œä½†æ˜¯æœ‰éƒ¨åˆ†æ•°æ®è¿˜åœ¨Memory Bufferï¼Œæ‰€ä»¥æœç´¢æ˜¯è¿‘å®æ—¶çš„ã€‚ æ¯ä¸ªåˆ†ç‰‡è¿”å›å„è‡ªä¼˜å…ˆé˜Ÿåˆ—ä¸­ æ‰€æœ‰æ–‡æ¡£çš„ ID å’Œæ’åºå€¼ ç»™åè°ƒèŠ‚ç‚¹ï¼Œå®ƒåˆå¹¶è¿™äº›å€¼åˆ°è‡ªå·±çš„ä¼˜å…ˆé˜Ÿåˆ—ä¸­æ¥äº§ç”Ÿä¸€ä¸ªå…¨å±€æ’åºåçš„ç»“æœåˆ—è¡¨ã€‚ æ¥ä¸‹æ¥å°±æ˜¯ å–å›é˜¶æ®µï¼Œåè°ƒèŠ‚ç‚¹è¾¨åˆ«å‡ºå“ªäº›æ–‡æ¡£éœ€è¦è¢«å–å›å¹¶å‘ç›¸å…³çš„åˆ†ç‰‡æäº¤å¤šä¸ª GET è¯·æ±‚ã€‚æ¯ä¸ªåˆ†ç‰‡åŠ è½½å¹¶ ä¸°å¯Œ æ–‡æ¡£ï¼Œå¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œæ¥ç€è¿”å›æ–‡æ¡£ç»™åè°ƒèŠ‚ç‚¹ã€‚ä¸€æ—¦æ‰€æœ‰çš„æ–‡æ¡£éƒ½è¢«å–å›äº†ï¼Œåè°ƒèŠ‚ç‚¹è¿”å›ç»“æœç»™å®¢æˆ·ç«¯ã€‚ è¡¥å……ï¼šQuery Then Fetchçš„æœç´¢ç±»å‹åœ¨æ–‡æ¡£ç›¸å…³æ€§æ‰“åˆ†çš„æ—¶å€™å‚è€ƒçš„æ˜¯æœ¬åˆ†ç‰‡çš„æ•°æ®ï¼Œè¿™æ ·åœ¨æ–‡æ¡£æ•°é‡è¾ƒå°‘çš„æ—¶å€™å¯èƒ½ä¸å¤Ÿå‡†ç¡®ï¼ŒDFS Query Then Fetchå¢åŠ äº†ä¸€ä¸ªé¢„æŸ¥è¯¢çš„å¤„ç†ï¼Œè¯¢é—®Termå’ŒDocument frequencyï¼Œè¿™ä¸ªè¯„åˆ†æ›´å‡†ç¡®ï¼Œä½†æ˜¯æ€§èƒ½ä¼šå˜å·®ã€‚\n9.Elasticsearchå¯¹äºå¤§æ•°æ®é‡ï¼ˆä¸Šäº¿é‡çº§ï¼‰çš„èšåˆå¦‚ä½•å®ç°ï¼Ÿ Elasticsearch æä¾›çš„é¦–ä¸ªè¿‘ä¼¼èšåˆæ˜¯cardinality åº¦é‡ã€‚å®ƒæä¾›ä¸€ä¸ªå­—æ®µçš„åŸºæ•°ï¼Œå³è¯¥å­—æ®µçš„distinctæˆ–è€…uniqueå€¼çš„æ•°ç›®ã€‚å®ƒæ˜¯åŸºäºHLLç®—æ³•çš„ã€‚HLL ä¼šå…ˆå¯¹æˆ‘ä»¬çš„è¾“å…¥ä½œå“ˆå¸Œè¿ç®—ï¼Œç„¶åæ ¹æ®å“ˆå¸Œè¿ç®—çš„ç»“æœä¸­çš„ bits åšæ¦‚ç‡ä¼°ç®—ä»è€Œå¾—åˆ°åŸºæ•°ã€‚å…¶ç‰¹ç‚¹æ˜¯ï¼šå¯é…ç½®çš„ç²¾åº¦ï¼Œç”¨æ¥æ§åˆ¶å†…å­˜çš„ä½¿ç”¨ï¼ˆæ›´ç²¾ç¡® ï¼ æ›´å¤šå†…å­˜ï¼‰ï¼›å°çš„æ•°æ®é›†ç²¾åº¦æ˜¯éå¸¸é«˜çš„ï¼›æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®å‚æ•°ï¼Œæ¥è®¾ç½®å»é‡éœ€è¦çš„å›ºå®šå†…å­˜ä½¿ç”¨é‡ã€‚æ— è®ºæ•°åƒè¿˜æ˜¯æ•°åäº¿çš„å”¯ä¸€å€¼ï¼Œå†…å­˜ä½¿ç”¨é‡åªä¸ä½ é…ç½®çš„ç²¾ç¡®åº¦ç›¸å…³ .\n10.åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼ŒElasticsearchå¦‚æœä¿è¯è¯»å†™ä¸€è‡´ï¼Ÿ å¯ä»¥é€šè¿‡ç‰ˆæœ¬å·ä½¿ç”¨ä¹è§‚å¹¶å‘æ§åˆ¶ï¼Œä»¥ç¡®ä¿æ–°ç‰ˆæœ¬ä¸ä¼šè¢«æ—§ç‰ˆæœ¬è¦†ç›–ï¼Œç”±åº”ç”¨å±‚æ¥å¤„ç†å…·ä½“çš„å†²çªï¼› å¦å¤–å¯¹äºå†™æ“ä½œï¼Œä¸€è‡´æ€§çº§åˆ«æ”¯æŒquorum/one/allï¼Œé»˜è®¤ä¸ºquorumï¼Œå³åªæœ‰å½“å¤§å¤šæ•°åˆ†ç‰‡å¯ç”¨æ—¶æ‰å…è®¸å†™æ“ä½œã€‚ä½†å³ä½¿å¤§å¤šæ•°å¯ç”¨ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨å› ä¸ºç½‘ç»œç­‰åŸå› å¯¼è‡´å†™å…¥å‰¯æœ¬å¤±è´¥ï¼Œè¿™æ ·è¯¥å‰¯æœ¬è¢«è®¤ä¸ºæ•…éšœï¼Œåˆ†ç‰‡å°†ä¼šåœ¨ä¸€ä¸ªä¸åŒçš„èŠ‚ç‚¹ä¸Šé‡å»ºã€‚ å¯¹äºè¯»æ“ä½œï¼Œå¯ä»¥è®¾ç½®replicationä¸ºsync(é»˜è®¤)ï¼Œè¿™ä½¿å¾—æ“ä½œåœ¨ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡éƒ½å®Œæˆåæ‰ä¼šè¿”å›ï¼›å¦‚æœè®¾ç½®replicationä¸ºasyncæ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®æœç´¢è¯·æ±‚å‚æ•°_preferenceä¸ºprimaryæ¥æŸ¥è¯¢ä¸»åˆ†ç‰‡ï¼Œç¡®ä¿æ–‡æ¡£æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚\n14.ElasticSearchä¸­çš„é›†ç¾¤ã€èŠ‚ç‚¹ã€ç´¢å¼•ã€æ–‡æ¡£ã€ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿ ç¾¤é›†æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ï¼ˆæœåŠ¡å™¨ï¼‰çš„é›†åˆï¼Œå®ƒä»¬å…±åŒä¿å­˜æ‚¨çš„æ•´ä¸ªæ•°æ®ï¼Œå¹¶æä¾›è·¨æ‰€æœ‰èŠ‚ç‚¹çš„è”åˆç´¢å¼•å’Œæœç´¢åŠŸèƒ½ã€‚ç¾¤é›†ç”±å”¯ä¸€åç§°æ ‡è¯†ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ºâ€œelasticsearchâ€ã€‚æ­¤åç§°å¾ˆé‡è¦ï¼Œå› ä¸ºå¦‚æœèŠ‚ç‚¹è®¾ç½®ä¸ºæŒ‰åç§°åŠ å…¥ç¾¤é›†ï¼Œåˆ™è¯¥èŠ‚ç‚¹åªèƒ½æ˜¯ç¾¤é›†çš„ä¸€éƒ¨åˆ†ã€‚ èŠ‚ç‚¹æ˜¯å±äºé›†ç¾¤ä¸€éƒ¨åˆ†çš„å•ä¸ªæœåŠ¡å™¨ã€‚å®ƒå­˜å‚¨æ•°æ®å¹¶å‚ä¸ç¾¤é›†ç´¢å¼•å’Œæœç´¢åŠŸèƒ½ã€‚ ç´¢å¼•å°±åƒå…³ç³»æ•°æ®åº“ä¸­çš„â€œæ•°æ®åº“â€ã€‚å®ƒæœ‰ä¸€ä¸ªå®šä¹‰å¤šç§ç±»å‹çš„æ˜ å°„ã€‚ç´¢å¼•æ˜¯é€»è¾‘åç§°ç©ºé—´ï¼Œæ˜ å°„åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªä¸»åˆ†ç‰‡ï¼Œå¹¶ä¸”å¯ä»¥æœ‰é›¶ä¸ªæˆ–å¤šä¸ªå‰¯æœ¬åˆ†ç‰‡ã€‚ MySQL =\u0026gt;æ•°æ®åº“ ElasticSearch =\u0026gt;ç´¢å¼• æ–‡æ¡£ç±»ä¼¼äºå…³ç³»æ•°æ®åº“ä¸­çš„ä¸€è¡Œã€‚ä¸åŒä¹‹å¤„åœ¨äºç´¢å¼•ä¸­çš„æ¯ä¸ªæ–‡æ¡£å¯ä»¥å…·æœ‰ä¸åŒçš„ç»“æ„ï¼ˆå­—æ®µï¼‰ï¼Œä½†æ˜¯å¯¹äºé€šç”¨å­—æ®µåº”è¯¥å…·æœ‰ç›¸åŒçš„æ•°æ®ç±»å‹ã€‚ MySQL =\u0026gt; Databases =\u0026gt; Tables =\u0026gt; Columns / Rows ElasticSearch =\u0026gt; Indices =\u0026gt; Types =\u0026gt;å…·æœ‰å±æ€§çš„æ–‡æ¡£ ç±»å‹æ˜¯ç´¢å¼•çš„é€»è¾‘ç±»åˆ«/åˆ†åŒºï¼Œå…¶è¯­ä¹‰å®Œå…¨å–å†³äºç”¨æˆ·ã€‚\n15.ElasticSearchä¸­çš„åˆ†ç‰‡æ˜¯ä»€ä¹ˆ? åœ¨å¤§å¤šæ•°ç¯å¢ƒä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åœ¨å•ç‹¬çš„ç›’å­æˆ–è™šæ‹Ÿæœºä¸Šè¿è¡Œã€‚\nç´¢å¼• - åœ¨Elasticsearchä¸­ï¼Œç´¢å¼•æ˜¯æ–‡æ¡£çš„é›†åˆã€‚ åˆ†ç‰‡ -å› ä¸ºElasticsearchæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œæ‰€ä»¥ç´¢å¼•é€šå¸¸è¢«åˆ†å‰²æˆåˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šçš„è¢«ç§°ä¸ºåˆ†ç‰‡çš„å…ƒç´ ã€‚\né—®é¢˜å››ï¼š\nElasticSearchä¸­çš„é›†ç¾¤ã€èŠ‚ç‚¹ã€ç´¢å¼•ã€æ–‡æ¡£ã€ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿ\nç¾¤é›†æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ï¼ˆæœåŠ¡å™¨ï¼‰çš„é›†åˆï¼Œå®ƒä»¬å…±åŒä¿å­˜æ‚¨çš„æ•´ä¸ªæ•°æ®ï¼Œå¹¶æä¾›è·¨æ‰€æœ‰èŠ‚ç‚¹çš„è”åˆç´¢å¼•å’Œæœç´¢åŠŸèƒ½ã€‚ç¾¤é›†ç”±å”¯ä¸€åç§°æ ‡è¯†ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ºâ€œelasticsearchâ€ã€‚æ­¤åç§°å¾ˆé‡è¦ï¼Œå› ä¸ºå¦‚æœèŠ‚ç‚¹è®¾ç½®ä¸ºæŒ‰åç§°åŠ å…¥ç¾¤é›†ï¼Œåˆ™è¯¥èŠ‚ç‚¹åªèƒ½æ˜¯ç¾¤é›†çš„ä¸€éƒ¨åˆ†ã€‚ èŠ‚ç‚¹æ˜¯å±äºé›†ç¾¤ä¸€éƒ¨åˆ†çš„å•ä¸ªæœåŠ¡å™¨ã€‚å®ƒå­˜å‚¨æ•°æ®å¹¶å‚ä¸ç¾¤é›†ç´¢å¼•å’Œæœç´¢åŠŸèƒ½ã€‚ ç´¢å¼•å°±åƒå…³ç³»æ•°æ®åº“ä¸­çš„â€œæ•°æ®åº“â€ã€‚å®ƒæœ‰ä¸€ä¸ªå®šä¹‰å¤šç§ç±»å‹çš„æ˜ å°„ã€‚ç´¢å¼•æ˜¯é€»è¾‘åç§°ç©ºé—´ï¼Œæ˜ å°„åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªä¸»åˆ†ç‰‡ï¼Œå¹¶ä¸”å¯ä»¥æœ‰é›¶ä¸ªæˆ–å¤šä¸ªå‰¯æœ¬åˆ†ç‰‡ã€‚ MySQL =\u0026gt;æ•°æ®åº“ ElasticSearch =\u0026gt;ç´¢å¼• æ–‡æ¡£ç±»ä¼¼äºå…³ç³»æ•°æ®åº“ä¸­çš„ä¸€è¡Œã€‚ä¸åŒä¹‹å¤„åœ¨äºç´¢å¼•ä¸­çš„æ¯ä¸ªæ–‡æ¡£å¯ä»¥å…·æœ‰ä¸åŒçš„ç»“æ„ï¼ˆå­—æ®µï¼‰ï¼Œä½†æ˜¯å¯¹äºé€šç”¨å­—æ®µåº”è¯¥å…·æœ‰ç›¸åŒçš„æ•°æ®ç±»å‹ã€‚ MySQL =\u0026gt; Databases =\u0026gt; Tables =\u0026gt; Columns / Rows ElasticSearch =\u0026gt; Indices =\u0026gt; Types =\u0026gt;å…·æœ‰å±æ€§çš„æ–‡æ¡£ ç±»å‹æ˜¯ç´¢å¼•çš„é€»è¾‘ç±»åˆ«/åˆ†åŒºï¼Œå…¶è¯­ä¹‰å®Œå…¨å–å†³äºç”¨æˆ·ã€‚ é—®é¢˜äº”ï¼š\nElasticSearchæ˜¯å¦æœ‰æ¶æ„ï¼Ÿ\nElasticSearchå¯ä»¥æœ‰ä¸€ä¸ªæ¶æ„ã€‚æ¶æ„æ˜¯æè¿°æ–‡æ¡£ç±»å‹ä»¥åŠå¦‚ä½•å¤„ç†æ–‡æ¡£çš„ä¸åŒå­—æ®µçš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µçš„æè¿°ã€‚Elasticsearchä¸­çš„æ¶æ„æ˜¯ä¸€ç§æ˜ å°„ï¼Œå®ƒæè¿°äº†JSONæ–‡æ¡£ä¸­çš„å­—æ®µåŠå…¶æ•°æ®ç±»å‹ï¼Œä»¥åŠå®ƒä»¬åº”è¯¥å¦‚ä½•åœ¨Luceneç´¢å¼•ä¸­è¿›è¡Œç´¢å¼•ã€‚å› æ­¤ï¼Œåœ¨Elasticsearchæœ¯è¯­ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸å°†æ­¤æ¨¡å¼ç§°ä¸ºâ€œæ˜ å°„â€ã€‚\nElasticsearchå…·æœ‰æ¶æ„çµæ´»çš„èƒ½åŠ›ï¼Œè¿™æ„å‘³ç€å¯ä»¥åœ¨ä¸æ˜ç¡®æä¾›æ¶æ„çš„æƒ…å†µä¸‹ç´¢å¼•æ–‡æ¡£ã€‚å¦‚æœæœªæŒ‡å®šæ˜ å°„ï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchä¼šåœ¨ç´¢å¼•æœŸé—´æ£€æµ‹æ–‡æ¡£ä¸­çš„æ–°å­—æ®µæ—¶åŠ¨æ€ç”Ÿæˆä¸€ä¸ªæ˜ å°„ã€‚\né—®é¢˜å…­ï¼š\nElasticSearchä¸­çš„åˆ†ç‰‡æ˜¯ä»€ä¹ˆï¼Ÿ\nåœ¨å¤§å¤šæ•°ç¯å¢ƒä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åœ¨å•ç‹¬çš„ç›’å­æˆ–è™šæ‹Ÿæœºä¸Šè¿è¡Œã€‚\nç´¢å¼• - åœ¨Elasticsearchä¸­ï¼Œç´¢å¼•æ˜¯æ–‡æ¡£çš„é›†åˆã€‚ åˆ†ç‰‡ -å› ä¸ºElasticsearchæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œæ‰€ä»¥ç´¢å¼•é€šå¸¸è¢«åˆ†å‰²æˆåˆ†å¸ƒåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šçš„è¢«ç§°ä¸ºåˆ†ç‰‡çš„å…ƒç´ ã€‚ é—®é¢˜ä¸ƒï¼š\nElasticSearchä¸­çš„å‰¯æœ¬æ˜¯ä»€ä¹ˆï¼Ÿ\nä¸€ä¸ªç´¢å¼•è¢«åˆ†è§£æˆç¢ç‰‡ä»¥ä¾¿äºåˆ†å‘å’Œæ‰©å±•ã€‚å‰¯æœ¬æ˜¯åˆ†ç‰‡çš„å‰¯æœ¬ã€‚ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªå±äºä¸€ä¸ªé›†ç¾¤çš„ElasticSearchçš„è¿è¡Œå®ä¾‹ã€‚ä¸€ä¸ªé›†ç¾¤ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå…±äº«ç›¸åŒé›†ç¾¤åç§°çš„èŠ‚ç‚¹ç»„æˆã€‚\né—®é¢˜å…«ï¼š\nElasticSearchä¸­çš„åˆ†æå™¨æ˜¯ä»€ä¹ˆï¼Ÿ\nåœ¨ElasticSearchä¸­ç´¢å¼•æ•°æ®æ—¶ï¼Œæ•°æ®ç”±ä¸ºç´¢å¼•å®šä¹‰çš„Analyzeråœ¨å†…éƒ¨è¿›è¡Œè½¬æ¢ã€‚ åˆ†æå™¨ç”±ä¸€ä¸ªTokenizerå’Œé›¶ä¸ªæˆ–å¤šä¸ªTokenFilterç»„æˆã€‚ç¼–è¯‘å™¨å¯ä»¥åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªCharFilterä¹‹å‰ã€‚åˆ†ææ¨¡å—å…è®¸æ‚¨åœ¨é€»è¾‘åç§°ä¸‹æ³¨å†Œåˆ†æå™¨ï¼Œç„¶åå¯ä»¥åœ¨æ˜ å°„å®šä¹‰æˆ–æŸäº›APIä¸­å¼•ç”¨å®ƒä»¬ã€‚\nElasticsearché™„å¸¦äº†è®¸å¤šå¯ä»¥éšæ—¶ä½¿ç”¨çš„é¢„å»ºåˆ†æå™¨ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥ç»„åˆå†…ç½®çš„å­—ç¬¦è¿‡æ»¤å™¨ï¼Œç¼–è¯‘å™¨å’Œè¿‡æ»¤å™¨å™¨æ¥åˆ›å»ºè‡ªå®šä¹‰åˆ†æå™¨ã€‚\né—®é¢˜ä¹ï¼š\nä»€ä¹ˆæ˜¯ElasticSearchä¸­çš„ç¼–è¯‘å™¨ï¼Ÿ\nç¼–è¯‘å™¨ç”¨äºå°†å­—ç¬¦ä¸²åˆ†è§£ä¸ºæœ¯è¯­æˆ–æ ‡è®°æµã€‚ä¸€ä¸ªç®€å•çš„ç¼–è¯‘å™¨å¯èƒ½ä¼šå°†å­—ç¬¦ä¸²æ‹†åˆ†ä¸ºä»»ä½•é‡åˆ°ç©ºæ ¼æˆ–æ ‡ç‚¹çš„åœ°æ–¹ã€‚Elasticsearchæœ‰è®¸å¤šå†…ç½®æ ‡è®°å™¨ï¼Œå¯ç”¨äºæ„å»ºè‡ªå®šä¹‰åˆ†æå™¨ã€‚\né—®é¢˜åä¸€ï¼š\nå¯ç”¨å±æ€§ï¼Œç´¢å¼•å’Œå­˜å‚¨çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ\nenabledå±æ€§é€‚ç”¨äºå„ç±»ElasticSearchç‰¹å®š/åˆ›å»ºé¢†åŸŸï¼Œå¦‚indexå’Œsizeã€‚ç”¨æˆ·æä¾›çš„å­—æ®µæ²¡æœ‰â€œå·²å¯ç”¨â€å±æ€§ã€‚ å­˜å‚¨æ„å‘³ç€æ•°æ®ç”±Luceneå­˜å‚¨ï¼Œå¦‚æœè¯¢é—®ï¼Œå°†è¿”å›è¿™äº›æ•°æ®ã€‚\nå­˜å‚¨å­—æ®µä¸ä¸€å®šæ˜¯å¯æœç´¢çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå­—æ®µä¸å­˜å‚¨ï¼Œä½†æºæ–‡ä»¶æ˜¯å®Œæ•´çš„ã€‚å› ä¸ºæ‚¨å¸Œæœ›ä½¿ç”¨é»˜è®¤å€¼(è¿™æ˜¯æœ‰æ„ä¹‰çš„)ï¼Œæ‰€ä»¥ä¸è¦è®¾ç½®storeå±æ€§ è¯¥æŒ‡æ•°å±æ€§ç”¨äºæœç´¢ã€‚\nç´¢å¼•å±æ€§åªèƒ½ç”¨äºæœç´¢ã€‚åªæœ‰ç´¢å¼•åŸŸå¯ä»¥è¿›è¡Œæœç´¢ã€‚å·®å¼‚çš„åŸå› æ˜¯åœ¨åˆ†ææœŸé—´å¯¹ç´¢å¼•å­—æ®µè¿›è¡Œäº†è½¬æ¢ï¼Œå› æ­¤å¦‚æœéœ€è¦çš„è¯ï¼Œæ‚¨ä¸èƒ½æ£€ç´¢åŸå§‹æ•°æ®ã€‚\nï¼ˆç½‘ç»œæœé›†-åšå®¢å›­ï¼‰\nç¬¬äºŒéƒ¨åˆ†é¢è¯•é¢˜ es å†™å…¥æ•°æ®çš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆå•Šï¼Ÿes æŸ¥è¯¢æ•°æ®çš„å·¥ä½œåŸç†æ˜¯ä»€ä¹ˆå•Šï¼Ÿåº•å±‚çš„ lucene ä»‹ç»ä¸€ä¸‹å‘—ï¼Ÿå€’æ’ç´¢å¼•äº†è§£å—ï¼Ÿ\né¢è¯•å®˜å¿ƒç†åˆ†æ é—®è¿™ä¸ªï¼Œå…¶å®é¢è¯•å®˜å°±æ˜¯è¦çœ‹çœ‹ä½ äº†è§£ä¸äº†è§£ es çš„ä¸€äº›åŸºæœ¬åŸç†ï¼Œå› ä¸ºç”¨ es æ— éå°±æ˜¯å†™å…¥æ•°æ®ï¼Œæœç´¢æ•°æ®ã€‚ä½ è¦æ˜¯ä¸æ˜ç™½ä½ å‘èµ·ä¸€ä¸ªå†™å…¥å’Œæœç´¢è¯·æ±‚çš„æ—¶å€™ï¼Œes åœ¨å¹²ä»€ä¹ˆï¼Œé‚£ä½ çœŸçš„æ˜¯\u0026hellip;\u0026hellip;å¯¹ es åŸºæœ¬å°±æ˜¯ä¸ªé»‘ç›’ï¼Œä½ è¿˜èƒ½å¹²å•¥ï¼Ÿä½ å”¯ä¸€èƒ½å¹²çš„å°±æ˜¯ç”¨ es çš„ api è¯»å†™æ•°æ®äº†ã€‚è¦æ˜¯å‡ºç‚¹ä»€ä¹ˆé—®é¢˜ï¼Œä½ å•¥éƒ½ä¸çŸ¥é“ï¼Œé‚£è¿˜èƒ½æŒ‡æœ›ä½ ä»€ä¹ˆå‘¢ï¼Ÿ\nes å†™æ•°æ®è¿‡ç¨‹ å®¢æˆ·ç«¯é€‰æ‹©ä¸€ä¸ª node å‘é€è¯·æ±‚è¿‡å»ï¼Œè¿™ä¸ª node å°±æ˜¯ coordinating nodeï¼ˆåè°ƒèŠ‚ç‚¹ï¼‰ã€‚ coordinating node å¯¹ document è¿›è¡Œè·¯ç”±ï¼Œå°†è¯·æ±‚è½¬å‘ç»™å¯¹åº”çš„ nodeï¼ˆæœ‰ primary shardï¼‰ã€‚[è·¯ç”±çš„ç®—æ³•æ˜¯ï¼Ÿ] å®é™…çš„ node ä¸Šçš„ primary shard å¤„ç†è¯·æ±‚ï¼Œç„¶åå°†æ•°æ®åŒæ­¥åˆ° replica nodeã€‚ coordinating node å¦‚æœå‘ç° primary node å’Œæ‰€æœ‰ replica node éƒ½æå®šä¹‹åï¼Œå°±è¿”å›å“åº”ç»“æœç»™å®¢æˆ·ç«¯ã€‚ es è¯»æ•°æ®è¿‡ç¨‹ å¯ä»¥é€šè¿‡ doc id æ¥æŸ¥è¯¢ï¼Œä¼šæ ¹æ® doc id è¿›è¡Œ hashï¼Œåˆ¤æ–­å‡ºæ¥å½“æ—¶æŠŠ doc id åˆ†é…åˆ°äº†å“ªä¸ª shard ä¸Šé¢å»ï¼Œä»é‚£ä¸ª shard å»æŸ¥è¯¢ã€‚\nå®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°ä»»æ„ä¸€ä¸ª nodeï¼Œæˆä¸º coordinate nodeã€‚ coordinate node å¯¹ doc id è¿›è¡Œå“ˆå¸Œè·¯ç”±ï¼Œå°†è¯·æ±‚è½¬å‘åˆ°å¯¹åº”çš„ nodeï¼Œæ­¤æ—¶ä¼šä½¿ç”¨ round-robinéšæœºè½®è¯¢ç®—æ³•ï¼Œåœ¨ primary shard ä»¥åŠå…¶æ‰€æœ‰ replica ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªï¼Œè®©è¯»è¯·æ±‚è´Ÿè½½å‡è¡¡ã€‚ æ¥æ”¶è¯·æ±‚çš„ node è¿”å› document ç»™ coordinate nodeã€‚ coordinate node è¿”å› document ç»™å®¢æˆ·ç«¯ã€‚ å†™è¯·æ±‚æ˜¯å†™å…¥ primary shardï¼Œç„¶ååŒæ­¥ç»™æ‰€æœ‰çš„ replica shardï¼›è¯»è¯·æ±‚å¯ä»¥ä» primary shard æˆ– replica shard è¯»å–ï¼Œé‡‡ç”¨çš„æ˜¯éšæœºè½®è¯¢ç®—æ³•ã€‚\nes æœç´¢æ•°æ®è¿‡ç¨‹[æ˜¯æŒ‡search?searchå’Œæ™®é€šdocid getçš„èƒŒåé€»è¾‘ä¸ä¸€æ ·ï¼Ÿ] es æœ€å¼ºå¤§çš„æ˜¯åšå…¨æ–‡æ£€ç´¢ï¼Œå°±æ˜¯æ¯”å¦‚ä½ æœ‰ä¸‰æ¡æ•°æ®ï¼š\njavaçœŸå¥½ç©å„¿å•Š javaå¥½éš¾å­¦å•Š j2eeç‰¹åˆ«ç‰› ä½ æ ¹æ® java å…³é”®è¯æ¥æœç´¢ï¼Œå°†åŒ…å« javaçš„ document ç»™æœç´¢å‡ºæ¥ã€‚es å°±ä¼šç»™ä½ è¿”å›ï¼šjavaçœŸå¥½ç©å„¿å•Šï¼Œjavaå¥½éš¾å­¦å•Šã€‚\nå®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°ä¸€ä¸ª coordinate nodeã€‚ åè°ƒèŠ‚ç‚¹å°†æœç´¢è¯·æ±‚è½¬å‘åˆ°æ‰€æœ‰çš„ shard å¯¹åº”çš„ primary shard æˆ– replica shardï¼Œéƒ½å¯ä»¥ã€‚ query phaseï¼šæ¯ä¸ª shard å°†è‡ªå·±çš„æœç´¢ç»“æœï¼ˆå…¶å®å°±æ˜¯ä¸€äº› doc idï¼‰è¿”å›ç»™åè°ƒèŠ‚ç‚¹ï¼Œç”±åè°ƒèŠ‚ç‚¹è¿›è¡Œæ•°æ®çš„åˆå¹¶ã€æ’åºã€åˆ†é¡µç­‰æ“ä½œï¼Œäº§å‡ºæœ€ç»ˆç»“æœã€‚ fetch phaseï¼šæ¥ç€ç”±åè°ƒèŠ‚ç‚¹æ ¹æ® doc id å»å„ä¸ªèŠ‚ç‚¹ä¸Šæ‹‰å–å®é™…çš„ document æ•°æ®ï¼Œæœ€ç»ˆè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ å†™æ•°æ®åº•å±‚åŸç† 1ï¼‰documentå…ˆå†™å…¥å¯¼å†…å­˜bufferä¸­ï¼ŒåŒæ—¶å†™translogæ—¥å¿—\n2)ï¼‰https://www.elastic.co/guide/cn/elasticsearch/guide/current/near-real-time.html\nrefreshæ“ä½œæ‰€ä»¥è¿‘å®æ—¶æœç´¢ï¼šå†™å…¥å’Œæ‰“å¼€ä¸€ä¸ªæ–°æ®µ(ä¸€ä¸ªè¿½åŠ çš„å€’æ’ç´¢å¼•)çš„è½»é‡çš„è¿‡ç¨‹å«åš *refresh* ã€‚æ¯éš”ä¸€ç§’é’ŸæŠŠbufferä¸­çš„æ•°æ®åˆ›å»ºä¸€ä¸ªæ–°çš„segmentï¼Œè¿™é‡Œæ–°æ®µä¼šè¢«å…ˆå†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿç¼“å­˜\u0026ndash;è¿™ä¸€æ­¥ä»£ä»·ä¼šæ¯”è¾ƒä½ï¼Œç¨åå†è¢«åˆ·æ–°åˆ°ç£ç›˜\u0026ndash;è¿™ä¸€æ­¥ä»£ä»·æ¯”è¾ƒé«˜ã€‚ä¸è¿‡åªè¦æ–‡ä»¶å·²ç»åœ¨ç¼“å­˜ä¸­ï¼Œ å°±å¯ä»¥åƒå…¶å®ƒæ–‡ä»¶ä¸€æ ·è¢«æ‰“å¼€å’Œè¯»å–äº†ï¼Œå†…å­˜bufferè¢«æ¸…ç©ºã€‚æ­¤æ—¶ï¼Œæ–°segment ä¸­çš„æ–‡ä»¶å°±å¯ä»¥è¢«æœç´¢äº†ï¼Œè¿™å°±æ„å‘³ç€documentä»è¢«å†™å…¥åˆ°å¯ä»¥è¢«æœç´¢éœ€è¦ä¸€ç§’ç§ï¼Œå¦‚æœè¦æ›´æ”¹è¿™ä¸ªå±æ€§ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œ\nPUT /my_index { \u0026ldquo;settings\u0026rdquo;: { \u0026ldquo;refresh_interval\u0026rdquo;: \u0026ldquo;30s\u0026rdquo; } } 3ï¼‰https://www.elastic.co/guide/cn/elasticsearch/guide/current/translog.html\nflushæ“ä½œå¯¼è‡´æŒä¹…åŒ–å˜æ›´ï¼šæ‰§è¡Œä¸€ä¸ªæäº¤å¹¶ä¸”æˆªæ–­ translog çš„è¡Œä¸ºåœ¨ Elasticsearch è¢«ç§°ä½œä¸€æ¬¡ *flushã€‚*åˆ·æ–°ï¼ˆrefreshï¼‰å®Œæˆå, ç¼“å­˜è¢«æ¸…ç©ºä½†æ˜¯äº‹åŠ¡æ—¥å¿—ä¸ä¼šã€‚translogæ—¥å¿—ä¹Ÿä¼šè¶Šæ¥è¶Šå¤šï¼Œå½“translogæ—¥å¿—å¤§å°å¤§äºä¸€ä¸ªé˜€å€¼æ—¶å€™æˆ–30åˆ†é’Ÿï¼Œä¼šå‡ºå‘flushæ“ä½œã€‚\næ‰€æœ‰åœ¨å†…å­˜ç¼“å†²åŒºçš„æ–‡æ¡£éƒ½è¢«å†™å…¥ä¸€ä¸ªæ–°çš„æ®µã€‚ ç¼“å†²åŒºè¢«æ¸…ç©ºã€‚ ä¸€ä¸ªæäº¤ç‚¹è¢«å†™å…¥ç¡¬ç›˜ã€‚ï¼ˆè¡¨æ˜æœ‰å“ªäº›segment commitäº†ï¼‰ æ–‡ä»¶ç³»ç»Ÿç¼“å­˜é€šè¿‡ fsync åˆ°ç£ç›˜ã€‚ è€çš„ translog è¢«åˆ é™¤ã€‚ åˆ†ç‰‡æ¯30åˆ†é’Ÿè¢«è‡ªåŠ¨åˆ·æ–°ï¼ˆflushï¼‰ï¼Œæˆ–è€…åœ¨ translog å¤ªå¤§çš„æ—¶å€™ä¹Ÿä¼šåˆ·æ–°ã€‚ä¹Ÿå¯ä»¥ç”¨_flushå‘½ä»¤æ‰‹åŠ¨æ‰§è¡Œã€‚\ntranslogæ¯éš”5ç§’ä¼šè¢«å†™å…¥ç£ç›˜ï¼ˆæ‰€ä»¥å¦‚æœè¿™5sï¼Œæ•°æ®åœ¨cacheè€Œä¸”logæ²¡æŒä¹…åŒ–ä¼šä¸¢å¤±ï¼‰ã€‚åœ¨ä¸€æ¬¡å¢åˆ æ”¹æ“ä½œä¹‹åtranslogåªæœ‰åœ¨replicaå’Œprimary shardéƒ½æˆåŠŸæ‰ä¼šæˆåŠŸï¼Œå¦‚æœè¦æé«˜æ“ä½œé€Ÿåº¦ï¼Œå¯ä»¥è®¾ç½®æˆå¼‚æ­¥çš„\nPUT /my_index { \u0026ldquo;settings\u0026rdquo;: { \u0026ldquo;index.translog.durability\u0026rdquo;: \u0026ldquo;async\u0026rdquo; ,\n\u0026ldquo;index.translog.sync_interval\u0026rdquo;:\u0026ldquo;5s\u0026rdquo; } }\næ‰€ä»¥æ€»ç»“æ˜¯æœ‰ä¸‰ä¸ªæ‰¹æ¬¡æ“ä½œï¼Œä¸€ç§’åšä¸€æ¬¡refreshä¿è¯è¿‘å®æ—¶æœç´¢ï¼Œ5ç§’åšä¸€æ¬¡translogæŒä¹…åŒ–ä¿è¯æ•°æ®æœªæŒä¹…åŒ–å‰ç•™åº•ï¼Œ30åˆ†é’Ÿåšä¸€æ¬¡æ•°æ®æŒä¹…åŒ–ã€‚\n2.åŸºäºtranslogå’Œcommit pointçš„æ•°æ®æ¢å¤\nåœ¨ç£ç›˜ä¸Šä¼šæœ‰ä¸€ä¸ªä¸Šæ¬¡æŒä¹…åŒ–çš„commit pointï¼Œtranslogä¸Šæœ‰ä¸€ä¸ªcommit pointï¼Œæ ¹æ®è¿™ä¸¤ä¸ªcommit pointï¼Œä¼šæŠŠtranslogä¸­çš„å˜æ›´è®°å½•è¿›è¡Œå›æ”¾ï¼Œé‡æ–°æ‰§è¡Œä¹‹å‰çš„æ“ä½œ\n3.ä¸å˜å½¢ä¸‹çš„åˆ é™¤å’Œæ›´æ–°åŸç†\nhttps://www.elastic.co/guide/cn/elasticsearch/guide/current/dynamic-indices.html#deletes-and-updates\nä¸€ä¸ªæ–‡æ¡£è¢« â€œåˆ é™¤â€ æ—¶ï¼Œå®ƒå®é™…ä¸Šåªæ˜¯åœ¨ .del æ–‡ä»¶ä¸­è¢« æ ‡è®° åˆ é™¤ã€‚ä¸€ä¸ªè¢«æ ‡è®°åˆ é™¤çš„æ–‡æ¡£ä»ç„¶å¯ä»¥è¢«æŸ¥è¯¢åŒ¹é…åˆ°ï¼Œ ä½†å®ƒä¼šåœ¨æœ€ç»ˆç»“æœè¢«è¿”å›å‰ä»ç»“æœé›†ä¸­ç§»é™¤ã€‚\næ–‡æ¡£æ›´æ–°ä¹Ÿæ˜¯ç±»ä¼¼çš„æ“ä½œæ–¹å¼ï¼šå½“ä¸€ä¸ªæ–‡æ¡£è¢«æ›´æ–°æ—¶ï¼Œæ—§ç‰ˆæœ¬æ–‡æ¡£è¢«æ ‡è®°åˆ é™¤ï¼Œæ–‡æ¡£çš„æ–°ç‰ˆæœ¬è¢«ç´¢å¼•åˆ°ä¸€ä¸ªæ–°çš„æ®µä¸­ã€‚ å¯èƒ½ä¸¤ä¸ªç‰ˆæœ¬çš„æ–‡æ¡£éƒ½ä¼šè¢«ä¸€ä¸ªæŸ¥è¯¢åŒ¹é…åˆ°ï¼Œä½†è¢«åˆ é™¤çš„é‚£ä¸ªæ—§ç‰ˆæœ¬æ–‡æ¡£åœ¨ç»“æœé›†è¿”å›å‰å°±å·²ç»è¢«ç§»é™¤ã€‚\næ®µåˆå¹¶çš„æ—¶å€™ä¼šå°†é‚£äº›æ—§çš„å·²åˆ é™¤æ–‡æ¡£ ä»æ–‡ä»¶ç³»ç»Ÿä¸­æ¸…é™¤ã€‚ è¢«åˆ é™¤çš„æ–‡æ¡£ï¼ˆæˆ–è¢«æ›´æ–°æ–‡æ¡£çš„æ—§ç‰ˆæœ¬ï¼‰ä¸ä¼šè¢«æ‹·è´åˆ°æ–°çš„å¤§æ®µä¸­ã€‚\n4.mergeæ“ä½œï¼Œæ®µåˆå¹¶\nhttps://www.elastic.co/guide/cn/elasticsearch/guide/current/merge-process.html\nç”±äºæ¯ç§’ä¼šæŠŠbufferåˆ·åˆ°segmentä¸­ï¼Œæ‰€ä»¥segmentä¼šå¾ˆå¤šï¼Œä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µå‡ºç°ï¼Œeså†…éƒ¨ä¼šä¸æ–­æŠŠä¸€äº›ç›¸ä¼¼å¤§å°çš„segmentåˆå¹¶ï¼Œå¹¶ä¸”ç‰©ç†åˆ é™¤delçš„segmentã€‚\nå½“ç„¶ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œ\nPOST /my_index/_optimize?max_num_segments=1ï¼Œå°½é‡ä¸è¦æ‰‹åŠ¨æ‰§è¡Œï¼Œè®©å®ƒè‡ªåŠ¨é»˜è®¤æ‰§è¡Œå°±å¯ä»¥äº†\n5.å½“ä½ æ­£åœ¨å»ºç«‹ä¸€ä¸ªå¤§çš„æ–°ç´¢å¼•æ—¶ï¼ˆç›¸å½“äºç›´æ¥å…¨éƒ¨å†™å…¥bufferï¼Œå…ˆä¸refreshï¼Œå†™å®Œå†refreshï¼‰ï¼Œå¯ä»¥å…ˆå…³é—­è‡ªåŠ¨åˆ·æ–°ï¼Œå¾…å¼€å§‹ä½¿ç”¨è¯¥ç´¢å¼•æ—¶ï¼Œå†æŠŠå®ƒä»¬è°ƒå›æ¥ï¼š\n1 2 3 4 5 PUT /my_logs/_settings { \u0026#34;refresh_interval\u0026#34;: -1 } PUT /my_logs/_settings { \u0026#34;refresh_interval\u0026#34;: \u0026#34;1s\u0026#34; } åº•å±‚ lucene ç®€å•æ¥è¯´ï¼Œlucene å°±æ˜¯ä¸€ä¸ª jar åŒ…ï¼Œé‡Œé¢åŒ…å«äº†å°è£…å¥½çš„å„ç§å»ºç«‹å€’æ’ç´¢å¼•çš„ç®—æ³•ä»£ç ã€‚æˆ‘ä»¬ç”¨ Java å¼€å‘çš„æ—¶å€™ï¼Œå¼•å…¥ lucene jarï¼Œç„¶ååŸºäº lucene çš„ api å»å¼€å‘å°±å¯ä»¥äº†ã€‚\né€šè¿‡ luceneï¼Œæˆ‘ä»¬å¯ä»¥å°†å·²æœ‰çš„æ•°æ®å»ºç«‹ç´¢å¼•ï¼Œlucene ä¼šåœ¨æœ¬åœ°ç£ç›˜ä¸Šé¢ï¼Œç»™æˆ‘ä»¬ç»„ç»‡ç´¢å¼•çš„æ•°æ®ç»“æ„ã€‚\nå€’æ’ç´¢å¼• åœ¨æœç´¢å¼•æ“ä¸­ï¼Œæ¯ä¸ªæ–‡æ¡£éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„æ–‡æ¡£ IDï¼Œæ–‡æ¡£å†…å®¹è¢«è¡¨ç¤ºä¸ºä¸€ç³»åˆ—å…³é”®è¯çš„é›†åˆã€‚ä¾‹å¦‚ï¼Œæ–‡æ¡£ 1 ç»è¿‡åˆ†è¯ï¼Œæå–äº† 20 ä¸ªå…³é”®è¯ï¼Œæ¯ä¸ªå…³é”®è¯éƒ½ä¼šè®°å½•å®ƒåœ¨æ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°å’Œå‡ºç°ä½ç½®ã€‚\né‚£ä¹ˆï¼Œå€’æ’ç´¢å¼•å°±æ˜¯å…³é”®è¯åˆ°æ–‡æ¡£ ID çš„æ˜ å°„ï¼Œæ¯ä¸ªå…³é”®è¯éƒ½å¯¹åº”ç€ä¸€ç³»åˆ—çš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä¸­éƒ½å‡ºç°äº†å…³é”®è¯ã€‚\nä¸¾ä¸ªæ —å­ã€‚\næœ‰ä»¥ä¸‹æ–‡æ¡£ï¼š\nå¯¹æ–‡æ¡£è¿›è¡Œåˆ†è¯ä¹‹åï¼Œå¾—åˆ°ä»¥ä¸‹å€’æ’ç´¢å¼•ã€‚\nå¦å¤–ï¼Œå®ç”¨çš„å€’æ’ç´¢å¼•è¿˜å¯ä»¥è®°å½•æ›´å¤šçš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ–‡æ¡£é¢‘ç‡ä¿¡æ¯ï¼Œè¡¨ç¤ºåœ¨æ–‡æ¡£é›†åˆä¸­æœ‰å¤šå°‘ä¸ªæ–‡æ¡£åŒ…å«æŸä¸ªå•è¯ã€‚\né‚£ä¹ˆï¼Œæœ‰äº†å€’æ’ç´¢å¼•ï¼Œæœç´¢å¼•æ“å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å“åº”ç”¨æˆ·çš„æŸ¥è¯¢ã€‚æ¯”å¦‚ç”¨æˆ·è¾“å…¥æŸ¥è¯¢ Facebookï¼Œæœç´¢ç³»ç»ŸæŸ¥æ‰¾å€’æ’ç´¢å¼•ï¼Œä»ä¸­è¯»å‡ºåŒ…å«è¿™ä¸ªå•è¯çš„æ–‡æ¡£ï¼Œè¿™äº›æ–‡æ¡£å°±æ˜¯æä¾›ç»™ç”¨æˆ·çš„æœç´¢ç»“æœã€‚\nè¦æ³¨æ„å€’æ’ç´¢å¼•çš„ä¸¤ä¸ªé‡è¦ç»†èŠ‚ï¼š\nå€’æ’ç´¢å¼•ä¸­çš„æ‰€æœ‰è¯é¡¹å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡æ¡£ å€’æ’ç´¢å¼•ä¸­çš„è¯é¡¹æ ¹æ®å­—å…¸é¡ºåºå‡åºæ’åˆ— ä¸Šé¢åªæ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¹¶æ²¡æœ‰ä¸¥æ ¼æŒ‰ç…§å­—å…¸é¡ºåºå‡åºæ’åˆ—ã€‚\nå‚è€ƒ:\nhttps://zhuanlan.zhihu.com/p/139762008 https://zhuanlan.zhihu.com/p/102500311 ","permalink":"https://reid00.github.io/en/posts/storage/es%E9%9D%A2%E8%AF%95%E9%A2%98/","summary":"ElasticSearché¢è¯•é¢˜ 1.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨Elasticsearch? å› ä¸ºåœ¨æˆ‘ä»¬å•†åŸä¸­çš„æ•°æ®ï¼Œå°†æ¥ä¼šéå¸¸å¤šï¼Œæ‰€ä»¥é‡‡ç”¨ä»¥å¾€çš„æ¨¡ç³ŠæŸ¥è¯¢ï¼Œæ¨¡ç³ŠæŸ¥è¯¢å‰ç½®é…ç½®ï¼Œä¼šæ”¾å¼ƒç´¢å¼•ï¼Œå¯¼è‡´å•†å“æŸ¥è¯¢æ˜¯å…¨è¡¨æ‰«é¢ï¼Œåœ¨ç™¾ä¸‡çº§åˆ«çš„æ•°æ®åº“ä¸­ï¼Œæ•ˆç‡éå¸¸ä½ä¸‹ï¼Œè€Œæˆ‘ä»¬ä½¿ç”¨ESåšä¸€ä¸ªå…¨æ–‡ç´¢å¼•ï¼Œæˆ‘ä»¬å°†ç»å¸¸æŸ¥è¯¢çš„å•†å“çš„æŸäº›å­—æ®µï¼Œæ¯”å¦‚è¯´å•†å“åï¼Œæè¿°ã€ä»·æ ¼è¿˜æœ‰idè¿™äº›å­—æ®µæˆ‘ä»¬æ”¾å…¥æˆ‘ä»¬ç´¢å¼•åº“é‡Œï¼Œå¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ã€‚\n2.Elasticsearchæ˜¯å¦‚ä½•å®ç°Masteré€‰ä¸¾çš„ï¼Ÿ Elasticsearchçš„é€‰ä¸»æ˜¯ZenDiscoveryæ¨¡å—è´Ÿè´£çš„ï¼Œä¸»è¦åŒ…å«Pingï¼ˆèŠ‚ç‚¹ä¹‹é—´é€šè¿‡è¿™ä¸ªRPCæ¥å‘ç°å½¼æ­¤ï¼‰å’ŒUnicastï¼ˆå•æ’­æ¨¡å—åŒ…å«ä¸€ä¸ªä¸»æœºåˆ—è¡¨ä»¥æ§åˆ¶å“ªäº›èŠ‚ç‚¹éœ€è¦pingé€šï¼‰è¿™ä¸¤éƒ¨åˆ†ï¼›\nå¯¹æ‰€æœ‰å¯ä»¥æˆä¸ºmasterçš„èŠ‚ç‚¹ï¼ˆnode.master: trueï¼‰æ ¹æ®nodeIdå­—å…¸æ’åºï¼Œæ¯æ¬¡é€‰ä¸¾æ¯ä¸ªèŠ‚ç‚¹éƒ½æŠŠè‡ªå·±æ‰€çŸ¥é“èŠ‚ç‚¹æ’ä¸€æ¬¡åºï¼Œç„¶åé€‰å‡ºç¬¬ä¸€ä¸ªï¼ˆç¬¬0ä½ï¼‰èŠ‚ç‚¹ï¼Œæš‚ä¸”è®¤ä¸ºå®ƒæ˜¯masterèŠ‚ç‚¹ã€‚ å¦‚æœå¯¹æŸä¸ªèŠ‚ç‚¹çš„æŠ•ç¥¨æ•°è¾¾åˆ°ä¸€å®šçš„å€¼ï¼ˆå¯ä»¥æˆä¸ºmasterèŠ‚ç‚¹æ•°n/2+1ï¼‰å¹¶ä¸”è¯¥èŠ‚ç‚¹è‡ªå·±ä¹Ÿé€‰ä¸¾è‡ªå·±ï¼Œé‚£è¿™ä¸ªèŠ‚ç‚¹å°±æ˜¯masterã€‚å¦åˆ™é‡æ–°é€‰ä¸¾ä¸€ç›´åˆ°æ»¡è¶³ä¸Šè¿°æ¡ä»¶ã€‚ è¡¥å……ï¼šmasterèŠ‚ç‚¹çš„èŒè´£ä¸»è¦åŒ…æ‹¬é›†ç¾¤ã€èŠ‚ç‚¹å’Œç´¢å¼•çš„ç®¡ç†ï¼Œä¸è´Ÿè´£æ–‡æ¡£çº§åˆ«çš„ç®¡ç†ï¼›dataèŠ‚ç‚¹å¯ä»¥å…³é—­httpåŠŸèƒ½ã€‚ 3.Elasticsearchä¸­çš„èŠ‚ç‚¹ï¼ˆæ¯”å¦‚å…±20ä¸ªï¼‰ï¼Œå…¶ä¸­çš„10ä¸ªé€‰äº†ä¸€ä¸ªmasterï¼Œå¦å¤–10ä¸ªé€‰äº†å¦ä¸€ä¸ªmasterï¼Œæ€ä¹ˆåŠï¼Ÿ å½“é›†ç¾¤masterå€™é€‰æ•°é‡ä¸å°äº3ä¸ªæ—¶ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®æœ€å°‘æŠ•ç¥¨é€šè¿‡æ•°é‡ï¼ˆdiscovery.zen.minimum_master_nodesï¼‰è¶…è¿‡æ‰€æœ‰å€™é€‰èŠ‚ç‚¹ä¸€åŠä»¥ä¸Šæ¥è§£å†³è„‘è£‚é—®é¢˜ï¼› å½“å€™é€‰æ•°é‡ä¸ºä¸¤ä¸ªæ—¶ï¼Œåªèƒ½ä¿®æ”¹ä¸ºå”¯ä¸€çš„ä¸€ä¸ªmasterå€™é€‰ï¼Œå…¶ä»–ä½œä¸ºdataèŠ‚ç‚¹ï¼Œé¿å…è„‘è£‚é—®é¢˜ã€‚\n4.è¯¦ç»†æè¿°ä¸€ä¸‹Elasticsearchç´¢å¼•æ–‡æ¡£çš„è¿‡ç¨‹ã€‚ åè°ƒèŠ‚ç‚¹é»˜è®¤ä½¿ç”¨æ–‡æ¡£IDå‚ä¸è®¡ç®—ï¼ˆä¹Ÿæ”¯æŒé€šè¿‡routingï¼‰ï¼Œä»¥ä¾¿ä¸ºè·¯ç”±æä¾›åˆé€‚çš„åˆ†ç‰‡ã€‚ shard = hash(document_id) % (num_of_primary_shards) å½“åˆ†ç‰‡æ‰€åœ¨çš„èŠ‚ç‚¹æ¥æ”¶åˆ°æ¥è‡ªåè°ƒèŠ‚ç‚¹çš„è¯·æ±‚åï¼Œä¼šå°†è¯·æ±‚å†™å…¥åˆ°Memory Bufferï¼Œç„¶åå®šæ—¶ï¼ˆé»˜è®¤æ˜¯æ¯éš”1ç§’ï¼‰å†™å…¥åˆ°Filesystem Cacheï¼Œè¿™ä¸ªä»Momery Bufferåˆ°Filesystem Cacheçš„è¿‡ç¨‹å°±å«åšrefreshï¼› å½“ç„¶åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå­˜åœ¨Momery Bufferå’ŒFilesystem Cacheçš„æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ï¼ŒESæ˜¯é€šè¿‡translogçš„æœºåˆ¶æ¥ä¿è¯æ•°æ®çš„å¯é æ€§çš„ã€‚å…¶å®ç°æœºåˆ¶æ˜¯æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒåŒæ—¶ä¹Ÿä¼šå†™å…¥åˆ°translogä¸­ï¼Œå½“Filesystem cacheä¸­çš„æ•°æ®å†™å…¥åˆ°ç£ç›˜ä¸­æ—¶ï¼Œæ‰ä¼šæ¸…é™¤æ‰ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšflushï¼› åœ¨flushè¿‡ç¨‹ä¸­ï¼Œå†…å­˜ä¸­çš„ç¼“å†²å°†è¢«æ¸…é™¤ï¼Œå†…å®¹è¢«å†™å…¥ä¸€ä¸ªæ–°æ®µï¼Œæ®µçš„fsyncå°†åˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤ç‚¹ï¼Œå¹¶å°†å†…å®¹åˆ·æ–°åˆ°ç£ç›˜ï¼Œæ—§çš„translogå°†è¢«åˆ é™¤å¹¶å¼€å§‹ä¸€ä¸ªæ–°çš„translogã€‚ flushè§¦å‘çš„æ—¶æœºæ˜¯å®šæ—¶è§¦å‘ï¼ˆé»˜è®¤30åˆ†é’Ÿï¼‰æˆ–è€…translogå˜å¾—å¤ªå¤§ï¼ˆé»˜è®¤ä¸º512Mï¼‰æ—¶ï¼›\n5.è¯¦ç»†æè¿°ä¸€ä¸‹Elasticsearchæ›´æ–°å’Œåˆ é™¤æ–‡æ¡£çš„è¿‡ç¨‹ åˆ é™¤å’Œæ›´æ–°ä¹Ÿéƒ½æ˜¯å†™æ“ä½œï¼Œä½†æ˜¯Elasticsearchä¸­çš„æ–‡æ¡£æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤ä¸èƒ½è¢«åˆ é™¤æˆ–è€…æ”¹åŠ¨ä»¥å±•ç¤ºå…¶å˜æ›´ï¼› ç£ç›˜ä¸Šçš„æ¯ä¸ªæ®µéƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„.delæ–‡ä»¶ã€‚å½“åˆ é™¤è¯·æ±‚å‘é€åï¼Œæ–‡æ¡£å¹¶æ²¡æœ‰çœŸçš„è¢«åˆ é™¤ï¼Œè€Œæ˜¯åœ¨.delæ–‡ä»¶ä¸­è¢«æ ‡è®°ä¸ºåˆ é™¤ã€‚è¯¥æ–‡æ¡£ä¾ç„¶èƒ½åŒ¹é…æŸ¥è¯¢ï¼Œä½†æ˜¯ä¼šåœ¨ç»“æœä¸­è¢«è¿‡æ»¤æ‰ã€‚å½“æ®µåˆå¹¶æ—¶ï¼Œåœ¨.delæ–‡ä»¶ä¸­è¢«æ ‡è®°ä¸ºåˆ é™¤çš„æ–‡æ¡£å°†ä¸ä¼šè¢«å†™å…¥æ–°æ®µã€‚ åœ¨æ–°çš„æ–‡æ¡£è¢«åˆ›å»ºæ—¶ï¼ŒElasticsearchä¼šä¸ºè¯¥æ–‡æ¡£æŒ‡å®šä¸€ä¸ªç‰ˆæœ¬å·ï¼Œå½“æ‰§è¡Œæ›´æ–°æ—¶ï¼Œæ—§ç‰ˆæœ¬çš„æ–‡æ¡£åœ¨.delæ–‡ä»¶ä¸­è¢«æ ‡è®°ä¸ºåˆ é™¤ï¼Œæ–°ç‰ˆæœ¬çš„æ–‡æ¡£è¢«ç´¢å¼•åˆ°ä¸€ä¸ªæ–°æ®µã€‚æ—§ç‰ˆæœ¬çš„æ–‡æ¡£ä¾ç„¶èƒ½åŒ¹é…æŸ¥è¯¢ï¼Œä½†æ˜¯ä¼šåœ¨ç»“æœä¸­è¢«è¿‡æ»¤æ‰ã€‚\n6.è¯¦ç»†æè¿°ä¸€ä¸‹Elasticsearchæœç´¢çš„è¿‡ç¨‹ æœç´¢è¢«æ‰§è¡Œæˆä¸€ä¸ªä¸¤é˜¶æ®µè¿‡ç¨‹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º Query Then Fetchï¼› åœ¨åˆå§‹æŸ¥è¯¢é˜¶æ®µæ—¶ï¼ŒæŸ¥è¯¢ä¼šå¹¿æ’­åˆ°ç´¢å¼•ä¸­æ¯ä¸€ä¸ªåˆ†ç‰‡æ‹·è´ï¼ˆä¸»åˆ†ç‰‡æˆ–è€…å‰¯æœ¬åˆ†ç‰‡ï¼‰ã€‚ æ¯ä¸ªåˆ†ç‰‡åœ¨æœ¬åœ°æ‰§è¡Œæœç´¢å¹¶æ„å»ºä¸€ä¸ªåŒ¹é…æ–‡æ¡£çš„å¤§å°ä¸º from + size çš„ä¼˜å…ˆé˜Ÿåˆ—ã€‚PSï¼šåœ¨æœç´¢çš„æ—¶å€™æ˜¯ä¼šæŸ¥è¯¢Filesystem Cacheçš„ï¼Œä½†æ˜¯æœ‰éƒ¨åˆ†æ•°æ®è¿˜åœ¨Memory Bufferï¼Œæ‰€ä»¥æœç´¢æ˜¯è¿‘å®æ—¶çš„ã€‚ æ¯ä¸ªåˆ†ç‰‡è¿”å›å„è‡ªä¼˜å…ˆé˜Ÿåˆ—ä¸­ æ‰€æœ‰æ–‡æ¡£çš„ ID å’Œæ’åºå€¼ ç»™åè°ƒèŠ‚ç‚¹ï¼Œå®ƒåˆå¹¶è¿™äº›å€¼åˆ°è‡ªå·±çš„ä¼˜å…ˆé˜Ÿåˆ—ä¸­æ¥äº§ç”Ÿä¸€ä¸ªå…¨å±€æ’åºåçš„ç»“æœåˆ—è¡¨ã€‚ æ¥ä¸‹æ¥å°±æ˜¯ å–å›é˜¶æ®µï¼Œåè°ƒèŠ‚ç‚¹è¾¨åˆ«å‡ºå“ªäº›æ–‡æ¡£éœ€è¦è¢«å–å›å¹¶å‘ç›¸å…³çš„åˆ†ç‰‡æäº¤å¤šä¸ª GET è¯·æ±‚ã€‚æ¯ä¸ªåˆ†ç‰‡åŠ è½½å¹¶ ä¸°å¯Œ æ–‡æ¡£ï¼Œå¦‚æœæœ‰éœ€è¦çš„è¯ï¼Œæ¥ç€è¿”å›æ–‡æ¡£ç»™åè°ƒèŠ‚ç‚¹ã€‚ä¸€æ—¦æ‰€æœ‰çš„æ–‡æ¡£éƒ½è¢«å–å›äº†ï¼Œåè°ƒèŠ‚ç‚¹è¿”å›ç»“æœç»™å®¢æˆ·ç«¯ã€‚ è¡¥å……ï¼šQuery Then Fetchçš„æœç´¢ç±»å‹åœ¨æ–‡æ¡£ç›¸å…³æ€§æ‰“åˆ†çš„æ—¶å€™å‚è€ƒçš„æ˜¯æœ¬åˆ†ç‰‡çš„æ•°æ®ï¼Œè¿™æ ·åœ¨æ–‡æ¡£æ•°é‡è¾ƒå°‘çš„æ—¶å€™å¯èƒ½ä¸å¤Ÿå‡†ç¡®ï¼ŒDFS Query Then Fetchå¢åŠ äº†ä¸€ä¸ªé¢„æŸ¥è¯¢çš„å¤„ç†ï¼Œè¯¢é—®Termå’ŒDocument frequencyï¼Œè¿™ä¸ªè¯„åˆ†æ›´å‡†ç¡®ï¼Œä½†æ˜¯æ€§èƒ½ä¼šå˜å·®ã€‚\n9.Elasticsearchå¯¹äºå¤§æ•°æ®é‡ï¼ˆä¸Šäº¿é‡çº§ï¼‰çš„èšåˆå¦‚ä½•å®ç°ï¼Ÿ Elasticsearch æä¾›çš„é¦–ä¸ªè¿‘ä¼¼èšåˆæ˜¯cardinality åº¦é‡ã€‚å®ƒæä¾›ä¸€ä¸ªå­—æ®µçš„åŸºæ•°ï¼Œå³è¯¥å­—æ®µçš„distinctæˆ–è€…uniqueå€¼çš„æ•°ç›®ã€‚å®ƒæ˜¯åŸºäºHLLç®—æ³•çš„ã€‚HLL ä¼šå…ˆå¯¹æˆ‘ä»¬çš„è¾“å…¥ä½œå“ˆå¸Œè¿ç®—ï¼Œç„¶åæ ¹æ®å“ˆå¸Œè¿ç®—çš„ç»“æœä¸­çš„ bits åšæ¦‚ç‡ä¼°ç®—ä»è€Œå¾—åˆ°åŸºæ•°ã€‚å…¶ç‰¹ç‚¹æ˜¯ï¼šå¯é…ç½®çš„ç²¾åº¦ï¼Œç”¨æ¥æ§åˆ¶å†…å­˜çš„ä½¿ç”¨ï¼ˆæ›´ç²¾ç¡® ï¼ æ›´å¤šå†…å­˜ï¼‰ï¼›å°çš„æ•°æ®é›†ç²¾åº¦æ˜¯éå¸¸é«˜çš„ï¼›æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®å‚æ•°ï¼Œæ¥è®¾ç½®å»é‡éœ€è¦çš„å›ºå®šå†…å­˜ä½¿ç”¨é‡ã€‚æ— è®ºæ•°åƒè¿˜æ˜¯æ•°åäº¿çš„å”¯ä¸€å€¼ï¼Œå†…å­˜ä½¿ç”¨é‡åªä¸ä½ é…ç½®çš„ç²¾ç¡®åº¦ç›¸å…³ .","title":"ESé¢è¯•é¢˜"},{"content":"ä¸€ã€DockerHub å®˜ç½‘é“¾æ¥ https://hub.docker.com/\näºŒã€Dockerfile å…³é”®å­— æ³¨æ„: dockerfile çš„å…³é”®å­—å¿…é¡»éƒ½æ˜¯å¤§å†™æ‰èƒ½ä½¿ç”¨\nFROM\næŒ‡å®šåŸºç¡€é•œåƒï¼Œå½“å‰æ–°é•œåƒæ˜¯åŸºäºå“ªä¸ªé•œåƒçš„ã€‚å…¶ä¸­ï¼Œscratchæ˜¯ä¸ªç©ºé•œåƒï¼Œè¿™ä¸ªé•œåƒæ˜¯è™šæ‹Ÿçš„æ¦‚å¿µ,å¹¶ä¸å®é™…å­˜åœ¨,å®ƒè¡¨ç¤ºä¸€ä¸ªç©ºç™½çš„é•œåƒï¼Œå½“å‰é•œåƒæ²¡æœ‰ä¾èµ–äºå…¶ä»–é•œåƒ\n1 FROM scratch MAINTAINTER\né•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±åœ°å€\n1 MAINTAINER Sixah \u0026lt;sixah@163.com\u0026gt; RUN\nå®¹å™¨æ„å»ºæ—¶éœ€è¦è¿è¡Œçš„å‘½ä»¤\n1 RUN echo \u0026#39;Hello, Docker!\u0026#39; EXPOSE\nå½“å‰å®¹å™¨å¯¹å¤–æš´éœ²å‡ºçš„ç«¯å£\n1 EXPOSE 8080 æ³¨æ„ï¼š\n-p å’Œ expose åŒºåˆ«\n-p 80:8080\nå¤–éƒ¨80 ç«¯å£è½¬å‘ å‘å¤–æš´éœ²æ˜¯ 8080 ç«¯å£çš„ Docker å®¹å™¨ã€‚å¦‚æœåªå†™ -p 80 ï¼Œé‚£ä¹ˆå½“ä½œæ˜¯ -p 80:80ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¹å™¨ä¹‹é—´å¯ä»¥è®¿é—®è¯¥ æš´éœ²8080ç«¯å£çš„å®¹å™¨ï¼Œå…¶ä»–ç”¨æˆ·ä¹Ÿå¯ä»¥è®¿é—®\nexposes 80\nâ€‹ è¡¨ç¤º å®¹å™¨ä¹‹é—´å¯ä»¥è®¿é—®è¯¥ æš´éœ²80ç«¯å£çš„å®¹å™¨ï¼Œä½†æ˜¯å…¶ä»–ç”¨æˆ·ä¸å¯ä»¥å¯ä»¥è®¿é—®ã€‚è¿™æ ·å…¶å®å°±æ˜¯åšåˆ°äº† å°é—­ã€‚\nWORKDIR\næŒ‡å®šåœ¨åˆ›å»ºå®¹å™¨åï¼Œç»ˆç«¯é»˜è®¤ç™»é™†è¿›æ¥çš„å·¥ä½œç›®å½•ï¼Œä¸€ä¸ªè½è„šç‚¹\n1 WORKDIR /home/ ENV\nç”¨æ¥åœ¨æ„å»ºé•œåƒè¿‡ç¨‹ä¸­è®¾ç½®ç¯å¢ƒå˜é‡\n1 ENV MY_PATH /usr/mytest è¿™ä¸ªç¯å¢ƒå˜é‡å¯ä»¥åœ¨åç»­çš„ä»»ä½•RUNæŒ‡ä»¤ä¸­ä½¿ç”¨ï¼Œè¿™å°±å¦‚åŒåœ¨å‘½ä»¤å‰é¢æŒ‡å®šäº†ç¯å¢ƒå˜é‡å‰ç¼€ä¸€æ ·;å½“ç„¶ï¼Œä¹Ÿå¯ä»¥åœ¨å…¶ä»–æŒ‡ä»¤ä¸­ç›´æ¥ä½¿ç”¨è¿™äº›ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚ï¼šWORKDIR $MY_PATH\nADD\nå°†å®¿ä¸»æœºç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´è¿›é•œåƒä¸”ADDå‘½ä»¤ä¼šè‡ªåŠ¨å¤„ç†URLå’Œè§£å‹tarå‹ç¼©åŒ…\n1 ADD Linux_amd64.tar.gz COPY\nç±»ä¼¼äºADDï¼Œæ‹·è´æ–‡ä»¶å’Œç›®å½•åˆ°é•œåƒä¸­ï¼Œå°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­\u0026lt;æºè·¯å¾„\u0026gt;çš„æ–‡ä»¶/ç›®å½•å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚é•œåƒå†…çš„\u0026lt;ç›®æ ‡è·¯å¾„\u0026gt;ä½ç½®\nCOPY èƒ½å®ç°çš„ADD éƒ½å¯ä»¥å®ç°ï¼ŒADD å¯ä»¥å¤„ç†URLï¼Œ è¿˜å¯ä»¥è‡ªåŠ¨è§£å‹ï¼ŒCOPYä¸å¯ä»¥\n1 COPY . /go/src/app VOLUME\nå®¹å™¨æ•°æ®å·ï¼Œç”¨äºæ•°æ®ä¿å­˜å’ŒæŒä¹…åŒ–å·¥ä½œ\n1 VOLUMEã€€/data CMD\næŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ã€‚Dockerfileä¸­å¯ä»¥æœ‰å¤šä¸ªCMDæŒ‡ä»¤ï¼Œä½†åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆï¼ŒCMDä¼šè¢«docker runä¹‹åçš„å‚æ•°æ›¿æ¢\n1 CMD [\u0026#34;/bin/bash\u0026#34;] æ³¨æ„:\n1 CMD -i å°†ä»£æ›¿ CMD [\u0026#34;/bin/bash\u0026#34;] è€ŒCMD -i æ— æ„ä¹‰ è€ŒENTRYPOINT ï¼Œå¯ä»¥åœ¨åé¢è¿½åŠ å‚æ•°\nå¦‚æœdockerfile æœ€åæ˜¯\nENTRYPOINT curl [\u0026ldquo;s\u0026rdquo;,\u0026ldquo;baidu.com\u0026rdquo;]\n1 DOCKER run centos -i æ„å‘³ç€ ENTRYPOINT curl [\u0026#34;s\u0026#34;,\u0026#34;-i\u0026#34;,\u0026#34;baidu.com\u0026#34;] ENTRYPOINT\næŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ˜¯è¦è¿è¡Œçš„å‘½ä»¤ã€‚ENTRYPOINTçš„ç›®çš„å’ŒCMDä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨æŒ‡å®šå®¹å™¨å¯åŠ¨ç¨‹åºåŠå‚æ•° ONBUILD\nå½“æ„å»ºä¸€ä¸ªè¢«ç»§æ‰¿çš„Dockerfileæ—¶è¿è¡Œçš„å‘½ä»¤ï¼Œçˆ¶é•œåƒåœ¨è¢«å­é•œåƒç»§æ‰¿åï¼Œçˆ¶é•œåƒçš„ONBUILDæŒ‡ä»¤è¢«è§¦å‘ ä¸‰ã€ ç»™åŸºç¡€çš„CentOS æ·»åŠ åŸºç¡€åŠŸèƒ½ ç¼–å†™dockerfile 1 2 3 4 5 6 7 8 9 10 11 12 13 FROMã€€CENTOS MAINTAINER zzz zzz@163.com ENV MYPATH /usr/local WORKDIR $MYPATH RUN yum -y install vim RUN yum -y install net-tools EXPOSE 80 CMD echo $MYPATH CMD echo \u0026#34;success -----ok\u0026#34; CMD /bin/bash æ„å»º build æ³¨æ„ï¼š æœ€åé¢æœ‰ä¸ªpath æ­¤å¤„ç”¨çš„. ä»£è¡¨å½“å‰è·¯å¾„ 1 docker build -f dockerfileè·¯å¾„ -t mycentos:v1.3 . Push 1 2 docker push registryä»“åº“ä¸­/name:version docker push harbor.ld-hadoop.com/nebula/supply:v7 å¦‚æœdocker push å‡ºç°Auth ç›¸å…³çš„é”™è¯¯ï¼Œå®‰è£…ä¸‹é¢æ–¹å¼è§£å†³:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 âœ contact_radar_space_incre git:(master) âœ— docker push harbor.ld-hadoop.com/nebula/backup_radar_incre:v1 The push refers to a repository [harbor.ld-hadoop.com/nebula/backup_radar_incre] 770f8dde0bf3: Preparing de824f01aabe: Preparing e68ba2bf9675: Preparing aa4c808c19f6: Preparing 8ba9f690e8ba: Preparing 3e607d59ef9f: Waiting 1e18e7e1fcc2: Waiting c3a0d593ed24: Waiting 26a504e63be4: Waiting 8bf42db0de72: Waiting 31892cc314cb: Waiting 11936051f93b: Waiting unauthorized: unauthorized to access repository: nebula/backup_radar_incre, action: push: unauthorized to access repository: nebula/backup_radar_incre, action: push âœ contact_radar_space_incre git:(master) âœ— mkdir /root/.docker âœ contact_radar_space_incre git:(master) âœ— vim /root/.docker/config.json # æ·»åŠ ä¸‹é¢çš„è®¤çœŸjson # { # \u0026#34;auths\u0026#34;: { # \u0026#34;harbor.ld-hadoop.com\u0026#34;: { # \u0026#34;auth\u0026#34;: \u0026#34;bGVvbjpraWxsanVoZQ==\u0026#34; # } # } # } âœ contact_radar_space_incre git:(master) âœ— docker push harbor.ld-hadoop.com/nebula/backup_radar_incre:v1 The push refers to a repository [harbor.ld-hadoop.com/nebula/backup_radar_incre] 770f8dde0bf3: Pushed de824f01aabe: Pushed e68ba2bf9675: Pushed aa4c808c19f6: Pushed 8ba9f690e8ba: Pushed 3e607d59ef9f: Pushed 1e18e7e1fcc2: Pushed c3a0d593ed24: Pushed 26a504e63be4: Pushed 8bf42db0de72: Pushed 31892cc314cb: Pushed 11936051f93b: Pushed v1: digest: sha256:2cb5bf1b68e635556f27a4c2371f513c41fe0d89de06d9898fb0e47cef036cc4 size: 2846 è¿è¡Œ\n1 docker run -it æ–°é•œåƒå:TAG åˆ—å‡ºé•œåƒçš„å˜æ›´å†å²\n1 docker history é•œåƒå ","permalink":"https://reid00.github.io/en/posts/langs_linux/dockerfile%E6%A1%88%E4%BE%8B/","summary":"ä¸€ã€DockerHub å®˜ç½‘é“¾æ¥ https://hub.docker.com/\näºŒã€Dockerfile å…³é”®å­— æ³¨æ„: dockerfile çš„å…³é”®å­—å¿…é¡»éƒ½æ˜¯å¤§å†™æ‰èƒ½ä½¿ç”¨\nFROM\næŒ‡å®šåŸºç¡€é•œåƒï¼Œå½“å‰æ–°é•œåƒæ˜¯åŸºäºå“ªä¸ªé•œåƒçš„ã€‚å…¶ä¸­ï¼Œscratchæ˜¯ä¸ªç©ºé•œåƒï¼Œè¿™ä¸ªé•œåƒæ˜¯è™šæ‹Ÿçš„æ¦‚å¿µ,å¹¶ä¸å®é™…å­˜åœ¨,å®ƒè¡¨ç¤ºä¸€ä¸ªç©ºç™½çš„é•œåƒï¼Œå½“å‰é•œåƒæ²¡æœ‰ä¾èµ–äºå…¶ä»–é•œåƒ\n1 FROM scratch MAINTAINTER\né•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±åœ°å€\n1 MAINTAINER Sixah \u0026lt;sixah@163.com\u0026gt; RUN\nå®¹å™¨æ„å»ºæ—¶éœ€è¦è¿è¡Œçš„å‘½ä»¤\n1 RUN echo \u0026#39;Hello, Docker!\u0026#39; EXPOSE\nå½“å‰å®¹å™¨å¯¹å¤–æš´éœ²å‡ºçš„ç«¯å£\n1 EXPOSE 8080 æ³¨æ„ï¼š\n-p å’Œ expose åŒºåˆ«\n-p 80:8080\nå¤–éƒ¨80 ç«¯å£è½¬å‘ å‘å¤–æš´éœ²æ˜¯ 8080 ç«¯å£çš„ Docker å®¹å™¨ã€‚å¦‚æœåªå†™ -p 80 ï¼Œé‚£ä¹ˆå½“ä½œæ˜¯ -p 80:80ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¹å™¨ä¹‹é—´å¯ä»¥è®¿é—®è¯¥ æš´éœ²8080ç«¯å£çš„å®¹å™¨ï¼Œå…¶ä»–ç”¨æˆ·ä¹Ÿå¯ä»¥è®¿é—®\nexposes 80\nâ€‹ è¡¨ç¤º å®¹å™¨ä¹‹é—´å¯ä»¥è®¿é—®è¯¥ æš´éœ²80ç«¯å£çš„å®¹å™¨ï¼Œä½†æ˜¯å…¶ä»–ç”¨æˆ·ä¸å¯ä»¥å¯ä»¥è®¿é—®ã€‚è¿™æ ·å…¶å®å°±æ˜¯åšåˆ°äº† å°é—­ã€‚\nWORKDIR\næŒ‡å®šåœ¨åˆ›å»ºå®¹å™¨åï¼Œç»ˆç«¯é»˜è®¤ç™»é™†è¿›æ¥çš„å·¥ä½œç›®å½•ï¼Œä¸€ä¸ªè½è„šç‚¹\n1 WORKDIR /home/ ENV\nç”¨æ¥åœ¨æ„å»ºé•œåƒè¿‡ç¨‹ä¸­è®¾ç½®ç¯å¢ƒå˜é‡\n1 ENV MY_PATH /usr/mytest è¿™ä¸ªç¯å¢ƒå˜é‡å¯ä»¥åœ¨åç»­çš„ä»»ä½•RUNæŒ‡ä»¤ä¸­ä½¿ç”¨ï¼Œè¿™å°±å¦‚åŒåœ¨å‘½ä»¤å‰é¢æŒ‡å®šäº†ç¯å¢ƒå˜é‡å‰ç¼€ä¸€æ ·;å½“ç„¶ï¼Œä¹Ÿå¯ä»¥åœ¨å…¶ä»–æŒ‡ä»¤ä¸­ç›´æ¥ä½¿ç”¨è¿™äº›ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚ï¼šWORKDIR $MY_PATH","title":"Dockerfileæ¡ˆä¾‹"},{"content":"å®‰è£… Windows æ­¤å¤„ä¸‹è½½ åŒå‡»exe ä¸€ç›´ä¸‹ä¸€æ­¥å®‰è£…\nLinux Linux é»˜è®¤å®‰è£…çš„Git ç‰ˆæœ¬ä¸€èˆ¬ä¸º1.8*, å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å‡çº§\né¦–å…ˆï¼ŒæŠŠè€ç‰ˆæœ¬çš„ Git å¸æ‰ã€‚ 1 2 sudo yum -y remove git sudo yum -y remove git-* æ·»åŠ  End Point åˆ° CentOS 7 ä»“åº“ yum -y install https://packages.endpointdev.com/rhel/7/os/x86_64/endpoint-repo.x86_64.rpm yum -y install git check version git version é…ç½®Git Set your name. git config --global user.name \u0026quot;Your Name\u0026quot; Set your email address. git config --global user.email \u0026quot;user@exmample.com\u0026quot; Verify the settings. git config --list Git é…ç½®SSH key è¿æ¥Github HTTPS URL å’Œ SSH URL åœ¨ä½¿ç”¨ git clone é¡¹ç›®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»“åº“çš„ HTTPS URL ä¹Ÿå¯ä»¥ ä½¿ç”¨ SSH URL HTTPS URLï¼Œä¾‹å¦‚ï¼šhttps://github.com/\u0026lt;username\u0026gt;/\u0026lt;repo name\u0026gt;.git SSH URLï¼Œä¾‹å¦‚ï¼šgit@github.com:\u0026lt;username\u0026gt;/\u0026lt;repo name\u0026gt;.git\nè¿™ä¸¤ç§æ–¹å¼çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼šä½¿ç”¨ HTTPS URL å…‹éš†æ—¶ï¼Œæ¯æ¬¡ fetch å’Œ push ä»£ç éƒ½éœ€è¦è¾“å…¥è´¦å·å’Œå¯†ç ï¼ˆå¯ä»¥é€šè¿‡ä¸‹é¢ç¼“å­˜çš„æ–¹å¼é¿å…ï¼‰ï¼Œè€Œä½¿ç”¨ SSH URL åœ¨é…ç½®å¥½ SSH Key åï¼Œæ¯æ¬¡ fetch å’Œ push ä»£ç éƒ½ä¸éœ€è¦è¾“å…¥è´¦å·å’Œå¯†ç ã€‚\nåˆæ¬¡è¿è¡Œ Git å‰çš„é…ç½® Git ç¯å¢ƒå˜é‡ Git æä¾›äº†ä¸€ä¸ªå«åš git config çš„å·¥å…·ï¼Œä¸“é—¨ç”¨æ¥é…ç½®æˆ–è¯»å–ç›¸åº”çš„å·¥ä½œç¯å¢ƒå˜é‡ã€‚è€Œæ­£æ˜¯ç”±è¿™äº›ç¯å¢ƒå˜é‡ï¼Œå†³å®šäº† Git åœ¨å„ä¸ªç¯èŠ‚çš„å…·ä½“å·¥ä½œæ–¹å¼å’Œè¡Œä¸ºã€‚è¿™äº›å˜é‡å¯ä»¥å­˜æ”¾åœ¨ä»¥ä¸‹ä¸‰ä¸ªä¸åŒçš„åœ°æ–¹ï¼š\n/etc/gitconfig æ–‡ä»¶ï¼šç³»ç»Ÿä¸­å¯¹æ‰€æœ‰ç”¨æˆ·éƒ½æ™®éé€‚ç”¨çš„é…ç½®ã€‚è‹¥ä½¿ç”¨ git config æ—¶ç”¨ \u0026ndash;system é€‰é¡¹ï¼Œè¯»å†™çš„å°±æ˜¯è¿™ä¸ªæ–‡ä»¶ã€‚ ~/.gitconfig æ–‡ä»¶ï¼šç”¨æˆ·ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶åªé€‚ç”¨äºè¯¥ç”¨æˆ·ã€‚è‹¥ä½¿ç”¨ git config æ—¶ç”¨ \u0026ndash;global é€‰é¡¹ï¼Œè¯»å†™çš„å°±æ˜¯è¿™ä¸ªæ–‡ä»¶ã€‚ å½“å‰é¡¹ç›®çš„ Git ç›®å½•ä¸­çš„é…ç½®æ–‡ä»¶ï¼ˆä¹Ÿå°±æ˜¯å·¥ä½œç›®å½•ä¸­çš„ .git/config æ–‡ä»¶ï¼‰ï¼šè¿™é‡Œçš„é…ç½®ä»…ä»…é’ˆå¯¹å½“å‰é¡¹ç›®æœ‰æ•ˆã€‚æ¯ä¸€ä¸ªçº§åˆ«çš„é…ç½®éƒ½ä¼šè¦†ç›–ä¸Šå±‚çš„ç›¸åŒé…ç½®ï¼Œæ‰€ä»¥ .git/config é‡Œçš„é…ç½®ä¼šè¦†ç›– /etc/gitconfig ä¸­çš„åŒåå˜é‡ é…ç½®ç”¨æˆ·ä¿¡æ¯ åˆæ¬¡è¿è¡Œ Git å‰éœ€è¦é…ç½®ç”¨æˆ·ä¿¡æ¯ï¼Œä¸€ä¸ªæ˜¯ä½ ä¸ªäººçš„ç”¨æˆ·åç§°ï¼Œä¸€ä¸ªæ˜¯ä½ çš„ç”µå­é‚®ä»¶åœ°å€ã€‚è¿™ä¸¤æ¡é…ç½®å¾ˆé‡è¦ï¼Œæ¯æ¬¡ Git æäº¤æ—¶éƒ½ä¼šå¼•ç”¨è¿™ä¸¤æ¡ä¿¡æ¯ï¼Œè¯´æ˜æ˜¯è°æäº¤äº†æ›´æ–°ï¼Œæ‰€ä»¥ä¼šéšæ›´æ–°å†…å®¹ä¸€èµ·è¢«æ°¸ä¹…çº³å…¥å†å²è®°å½•ï¼š\n1 2 $ git config --global user.name \u0026#34;Reid\u0026#34; $ git config --global user.email reid@example.com å¦‚æœç”¨äº† \u0026ndash;global é€‰é¡¹ï¼Œé‚£ä¹ˆæ›´æ”¹çš„é…ç½®æ–‡ä»¶å°±æ˜¯ä½äºä½ ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„ ~/.gitconfig æ–‡ä»¶ï¼Œä»¥åä½ æ‰€æœ‰çš„é¡¹ç›®éƒ½ä¼šé»˜è®¤ä½¿ç”¨è¿™é‡Œé…ç½®çš„ç”¨æˆ·ä¿¡æ¯ã€‚å¦‚æœè¦åœ¨æŸä¸ªç‰¹å®šçš„é¡¹ç›®ä¸­ä½¿ç”¨å…¶ä»–åå­—æˆ–è€…é‚®ç®±ï¼Œåªè¦å»æ‰ \u0026ndash;global é€‰é¡¹é‡æ–°é…ç½®å³å¯ï¼Œæ–°çš„è®¾å®šä¿å­˜åœ¨å½“å‰é¡¹ç›®çš„ .git/config æ–‡ä»¶é‡Œã€‚\næŸ¥çœ‹é…ç½®ä¿¡æ¯ è¦æ£€æŸ¥å·²æœ‰çš„é…ç½®ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ git config \u0026ndash;list å‘½ä»¤ï¼š\n1 2 3 4 5 6 7 8 (base) [root@zhangbl-c7 .git]# git config --list user.name=Reid user.email=reid@example.com core.repositoryformatversion=0 core.filemode=true core.bare=false core.logallrefupdates=true ... æœ‰æ—¶å€™ä¼šçœ‹åˆ°é‡å¤çš„å˜é‡åï¼Œé‚£å°±è¯´æ˜å®ƒä»¬æ¥è‡ªä¸åŒçš„é…ç½®æ–‡ä»¶ï¼ˆæ¯”å¦‚ /etc/gitconfig å’Œ ~/.gitconfig ï¼‰ï¼Œä¸è¿‡æœ€ç»ˆ Git å®é™…é‡‡ç”¨çš„æ˜¯æœ€åä¸€ä¸ªã€‚\nä¹Ÿå¯ä»¥ç›´æ¥æŸ¥é˜…æŸä¸ªç¯å¢ƒå˜é‡çš„è®¾å®šï¼Œåªè¦æŠŠç‰¹å®šçš„ç¯å¢ƒå˜é‡åç§°è·Ÿåœ¨åé¢å³å¯ï¼Œä¾‹å¦‚ï¼š git config user.name\næ£€æŸ¥æ˜¯å¦å·²æœ‰ SSH Key çœ‹æ˜¯å¦å­˜åœ¨ id_rsa å’Œ id_rsa.pub æ–‡ä»¶ï¼ˆæˆ–è€…æ˜¯å…¶å®ƒæ–‡ä»¶åï¼‰ï¼Œå¦‚æœå­˜åœ¨è¯´æ˜å·²æœ‰ ssh keyï¼Œå¯ä»¥ç›´æ¥è·³è¿‡ç”Ÿæˆå¯†é’¥ï¼Œå…¶ä¸­ id_rsa ä¸ºç§é’¥ï¼Œid_rsa.pub ä¸ºå…¬é’¥ã€‚ ls ~/.ssh/\nç”Ÿæˆ SSH key ssh-keygen -t rsa -C \u0026quot;reid@example.com\u0026quot;\n-t : æŒ‡å®šå¯†é’¥ç±»å‹ï¼Œé»˜è®¤æ˜¯rsaï¼Œå¯ä»¥çœç•¥\n-C: è®¾ç½®æ³¨é‡Šæ–‡å­—ï¼Œæ¯”å¦‚é‚®ç®±\n-f: æŒ‡å®šå¯†é’¥æ–‡ä»¶å­˜å‚¨æ–‡ä»¶å\nä»¥ä¸Šä»£ç çœç•¥äº† -f å‚æ•°ï¼Œå› æ­¤åœ¨è¿è¡Œä¸Šé¢é‚£æ¡å‘½ä»¤åä¼šè®©ä½ è¾“å…¥ä¸€ä¸ªæ–‡ä»¶åï¼Œç”¨äºä¿å­˜åˆšæ‰ç”Ÿæˆçš„ SSH keyï¼Œä¾‹å¦‚ï¼š\n1 2 3 $ ssh-keygen -t rsa -C \u0026#34;reid@example.com\u0026#34; Generating public/private rsa key pair. Enter file in which to save the key (~/.ssh/id_rsa): å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä¸è¾“å…¥æ–‡ä»¶åï¼Œç›´æ¥å›è½¦ä½¿ç”¨é»˜è®¤æ–‡ä»¶åï¼ˆæ¨èï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šç”Ÿæˆ id_rsa å’Œ id_rsa.pub ä¸¤ä¸ªå¯†é’¥æ–‡ä»¶ã€‚åç»­çš„ä¸€äº›é…ç½®ä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤å‚æ•°ã€‚\næ·»åŠ SSHåˆ°Github ç™»å½• githubï¼Œç‚¹å‡»å¤´åƒï¼Œç‚¹å‡» Settings è¿›å…¥è®¾ç½®é¡µé¢ã€‚\nç„¶åç‚¹å‡»èœå•æ çš„ SSH and GPG keys è¿›å…¥é¡µé¢æ·»åŠ  SSH Keyã€‚ ç‚¹å‡» New SSH Key æŒ‰é’®åè¿›è¡Œ Key çš„å¡«å†™ï¼Œå…¶ä¸­ Title éšæ„ï¼Œ Key ä¸ºåˆšåˆšç”Ÿæˆçš„å…¬é’¥ï¼Œå…¬é’¥åœ¨æ–‡ä»¶ id_rsa.pub æ–‡ä»¶ä¸­ï¼Œç›´æ¥ copy æ–‡ä»¶ä¸­çš„å†…å®¹ç²˜è´´å³å¯ã€‚\næµ‹è¯• SSH key åœ¨ç»ˆç«¯ è¾“å…¥ ssh -T git@github.com, å‡ºç°\n1 2 3 The authenticity of host \u0026#39;github.com (207.97.227.239)\u0026#39; can\u0026#39;t be established. # RSA key fingerprint is 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48. # Are you sure you want to continue connecting (yes/no)? è¿™æ˜¯æ­£å¸¸çš„ï¼Œç›´æ¥è¾“å…¥ yes å›è½¦æ—¢å¯ã€‚å¦‚æœä½ åˆ›å»º SSH key çš„æ—¶å€™è®¾ç½®äº†å¯†ç ï¼Œæ¥ä¸‹æ¥å°±ä¼šæç¤ºä½ è¾“å…¥å¯†ç ï¼Œå¦‚ï¼šEnter passphrase for key '~/.ssh/id_rsa': æˆåŠŸæ˜¾ç¤º: Hi username! You've successfully authenticated, but GitHub does not provide shell access.\nå¦‚æœç”¨æˆ·åæ˜¯æ­£ç¡®çš„ï¼Œä½ å·²ç»æˆåŠŸè®¾ç½® SSH å¯†é’¥ã€‚å¦‚æœä½ çœ‹åˆ° \u0026ldquo;access denied\u0026rdquo; ï¼Œè€…è¡¨ç¤ºæ‹’ç»è®¿é—®ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦ä½¿ç”¨ HTTPS å»è®¿é—®ï¼Œè€Œä¸æ˜¯ SSH ã€‚\nGit å¤šç”¨æˆ·é…ç½®(ä¸ªäººå’Œå…¬å¸) å…¬å¸å’Œgithub,ç»å¸¸ä¼šé‡åˆ°è¦å¤šç”¨æˆ·ä½¿ç”¨gitçš„æƒ…å†µ,ä»¥ä¸‹ä¸ºé…ç½®ä¿¡æ¯,ä»¥ä¸‹æ‹¿ zhangs \u0026amp; zhangs2 ä¸¾ä¾‹\nè®¾ç½®ssh-key ssh-keygen -t rsa -C \u0026quot;zhangs@mail.com\u0026quot;\nä¼šæç¤ºå­˜å‚¨çš„æ–‡ä»¶åï¼Œè¾“å…¥, ç¬¬äºŒä»½ssh-key ç”Ÿæˆæ˜¯ä¸€å®šä¸€å®šè¦è¾“å…¥ é˜²æ­¢è¦†ç›– å¦‚æœéœ€è¦pushæ—¶ç¡®è®¤çš„å¯†ç ï¼Œå¯åœ¨è¯¥æ­¥éª¤è¾“å…¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 (base) [root@-c7 go-project]# ssh-keygen -t rsa -C \u0026#34;zhangs@mail.com\u0026#34; Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): /root/.ssh/zhangs_id_rsa # æ³¨æ„æ­¤å¤„é‡å‘½å é˜²æ­¢è¦†ç›– Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /root/.ssh/zhangs_id_rsa. Your public key has been saved in /root/.ssh/zhangs_id_rsa.pub. The key fingerprint is: SHA256:t/XljH8zYCLFcDgTxzrAjUQ7VwSobCPobUhB6ImBcvA zhangs@mail.com The key\u0026#39;s randomart image is: +---[RSA 2048]----+ |=o +o+o*+ | |=o. =.*oo | |+oE . .o..B | |.= . = oo o | |o o o . S + . .| | o o o + + = | | . o o + o| | +.| | =| +----[SHA256]-----+ ä¸Šä¼ åˆ°GitHubæˆ–è€…GitLabå‚è€ƒä¸Šé¢æµ‹è¯•æ·»åŠ SSH-Keyåˆ°Github SSH é…ç½®æ–‡ä»¶ ä½¿ç”¨ ~/.ssh/config ä½œä¸ºæˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å°±åˆ›å»ºå®ƒã€‚ vim ~/.ssh/config\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # github email address Host github # åˆ«åï¼Œç”¨äºåŒºåˆ†å¤šä¸ª git è´¦å·ï¼Œå¯éšæ„ HostName github.com # è¦è¿æ¥çš„æœåŠ¡å™¨çš„ä¸»æœºå, å¯ä»¥ä¸ºIP ä¹Ÿå¯ä»¥ä¸ºåŸŸå User zhangs PreferredAuthentications publickey IdentityFile ~/.ssh/zhangs_id_rsa # ssh è¿æ¥ä½¿ç”¨çš„ç§é’¥ # gitlab email address # # å…¬å¸å†…ç½‘åœ°å€ Host gitlab HostName gitlab.xx.com User zhangs2 PreferredAuthentications publickey IdentityFile ~/.ssh/zhangs2_id_rsa é…ç½®æ–‡ä»¶ä¸­çš„ HostName æ˜¯è¿œç¨‹ä»“åº“çš„è®¿é—®åœ°å€ï¼Œè¿™é‡Œå¯ä»¥æ˜¯ IPï¼Œä¹Ÿå¯ä»¥æ˜¯åŸŸåã€‚Host æ˜¯ç”¨æ¥æ‹‰å–çš„ä»“åº“çš„åˆ«åï¼Œé…ä¸é…ç½®éƒ½è¡Œã€‚å¦‚æœ HostName æ²¡é…ç½®çš„è¯ï¼Œé‚£å°±å¿…é¡»æŠŠ Host é…ç½®ä¸ºä»“åº“ IP åœ°å€æˆ–è€…åŸŸåï¼Œè€Œéåˆ«åã€‚\nå…¶å®è¿™é‡Œçš„Userå¹¶ä¸ä¼šæœ‰æˆ‘ä»¬é¢„æœŸçš„æ•ˆæœï¼Œæ¯”å¦‚ä½ åœ¨å…¬å¸çš„gitlabç”¨æˆ·åä¸€èˆ¬ä¼šå–å®åçš„åå­—ï¼Œè€Œgithubæ˜¯ä¸€ä¸ªéšæ„çš„æ˜µç§°ã€‚è¿™é‡Œå¹¶ä¸ä¼šè®©ä½ ä»¥åæ¨é€ä»£ç åˆ°gitlabæ—¶å– ä½ åœ¨è¿™é‡Œé…ç½®çš„ gitlabç”¨æˆ·åï¼ŒåŒæ ·ä¹Ÿä¸ä¼šæ¨é€åˆ°githubæ—¶å–ä½ åœ¨è¿™é‡Œé…ç½®çš„ githubç”¨æˆ·åã€‚å› ä¸ºè¿™ä¸ªå…¶å®åªæ˜¯é’ˆå¯¹ssh keyçš„é…ç½®çš„Userï¼Œå¹¶ä¸ä¼šå½±å“ä½ ä¹‹å‰é€šè¿‡ git config --global user.name \u0026ldquo;å…¬å¸gitlabç”¨æˆ·å\u0026rdquo; è®¾ç½®çš„gitè´¦æˆ·å\nå¯ä»¥åˆ†åˆ«æµ‹è¯•ä¸€ä¸‹äº†ä½ çš„ssh æ˜¯å¦èƒ½è¿é€šäº†\n1 2 3 4 5 6 7 8 9 10 11 ssh -T git@gitlab # @åé¢å¯ä»¥æ˜¯Host åç§° ä¹Ÿå¯ä»¥æ˜¯HostName ssh -T git@github.com ssh -T git@github Hi Reid00! You\u0026#39;ve successfully authenticated, but GitHub does not provide shell access. ssh -T git@github.com Hi Reid00! You\u0026#39;ve successfully authenticated, but GitHub does not provide shell access. æ¯”å¦‚æŠŠgithub.com çš„Host è®¾ç½®æˆ`Personal` ä¹ŸæˆåŠŸ ssh -T git@personal Hi Reid00! You\u0026#39;ve successfully authenticated, but GitHub does not provide shell access. è®¾ç½®user.name å‰é¢æåˆ° ~/.ssh/config æ–‡ä»¶ä¸­çš„User å¹¶ä¸ç­‰åŒäºæˆ‘ä»¬çš„gitè´¦æˆ·åã€‚ æœ‰å¯èƒ½ä½ ä¹‹å‰è®¾ç½®è¿‡ git config --global user.name \u0026quot;å…¬å¸gitlabå®å\u0026quot; ç„¶åä½ å‘ç°ä½ ä¼ ä»£ç åˆ°githubçš„æ—¶å€™ï¼Œä¹Ÿæ˜¯æ˜¾ç¤ºçš„è¿™ä¸ªå®åï¼Œè®©ä½ è§‰å¾—æœ‰ç‚¹ä¸çˆ½ã€‚\nä½ å¯ä»¥ç»§ç»­åˆ°ä½ æœ¬åœ°çš„githubä»“åº“é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹å»è®¾ç½®ä¸€ä¸ªæœ¬åœ°çš„ç”¨æˆ·å git config --local user.name \u0026quot;githubç”¨æˆ·å\u0026quot; å†æ¨é€ï¼Œå°±å¯ä»¥æ˜¾ç¤ºå¯¹åº”çš„ç”¨æˆ·åäº†ã€‚ é‚®ç®±åŒæ ·git config --local user.email \u0026quot;github é‚®ç®±\u0026quot;\nè¿™é‡Œä»€ä¹ˆæ—¶å€™ç”¨global ä»€ä¹ˆæ—¶å€™ç”¨local å…¶å®å–å†³äºä½ è‡ªå·±ç”¨å“ªä¸ªè´¦æˆ·ç”¨å¾—å¤šä¸€ç‚¹ï¼Œæ¯”å¦‚ä½ åœ¨å…¬å¸çš„ç”µè„‘ä¸Šï¼Œä½ å°±å¯ä»¥æŠŠå…¬å¸çš„gitlabç”¨æˆ·ååŠ  \u0026ndash;global é…ç½®ï¼Œè€Œè‡ªå·±ä¸ªäººçš„githubåŠ  \u0026ndash;localã€‚å¦‚æœä½ æ˜¯åœ¨ä½ è‡ªå·±å®¶é‡Œçš„ç”µè„‘ä¸Šï¼Œå°±å¯ä»¥æ˜¯ç›¸åçš„æ“ä½œäº†ã€‚\né—®é¢˜ ç”±äºå…¬å¸Gitlab ä¸æ˜¯èµ°æ ‡å‡†çš„21ç«¯å£ è€Œæ˜¯èµ°18888 ç«¯å£ï¼Œå¯¼è‡´ç”¨ä¸Šè¿°æ–¹å¼é…ç½®å¥½ä¹‹åï¼Œåœ¨æµ‹è¯•SSH Key çš„æ—¶å€™æ— æ•ˆã€‚ 1 2 âœ .ssh ssh -T git@gitlab ssh: Could not resolve hostname gitlab.****.com:18888: Name or service not known æ­¤æ—¶éœ€è¦è”ç³»è¿ç»´åšåŸŸåæ˜ å°„ï¼Œå¦‚ä¸‹æŠŠ gitlab.xx.com:18888 æ˜ å°„åˆ°21 ç«¯å£ï¼Œæ¯”å¦‚proxygitlab.xx.comï¼Œ æŠŠ~/.ssh/configä¸‹é¢çš„HostName æ”¹ä¸ºæ˜ å°„åçš„å³å¯ã€‚\n1 2 3 4 5 Host gitlab HostName proxygitlab.xx.com User zhangs2 PreferredAuthentications publickey IdentityFile ~/.ssh/zhangs2_id_rsa 1 2 3 4 5 âœ .ssh ssh -T git@gitlab The authenticity of host \u0026#39;proxygitlab.xx.com (172.16.51.198)\u0026#39; can\u0026#39;t be established. ECDSA key fingerprint is SHA256:AWmWq+kB2GUSTuPORU4hvRHTc1vhaFwvdNVBNXTMxbk. ECDSA key fingerprint is MD5:cb:b3:95:61:20:05:aa:8e:51:61:68:c0:14:bb:f2:e7. Are you sure you want to continue connecting (yes/no)? yes ç”¨httpsæ–¹å¼ git clone é¡¹ç›®ä»£ç æ—¶ç”¨æˆ·åå’Œå¯†ç çš„é—®é¢˜ æ¢äº†æ–°çš„å¼€å‘æœºï¼Œé€šè¿‡ä¸Šè¿°æ–¹å¼é…ç½®å¥½ä¹‹åï¼Œclone github ä¸Šé¡¹ç›®æ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥clone å…¬å¸çš„é¡¹ç›®æ—¶ï¼Œå‘ç°ç”±äºssh url ä¸èƒ½ç”¨(ç«¯å£ä¸æ ‡å‡†)ï¼Œä½¿ç”¨https url çš„æ—¶å€™ ä¸€ç›´éœ€è¦è¾“å…¥è´¦å·å¯†ç å¾ˆçƒ¦ã€‚\nå¬åŒäº‹è¯´è¦æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼šgit credential-manager uninstallï¼Œè¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯ æ¸…é™¤æ‰ç¼“å­˜åœ¨gitä¸­çš„ç”¨æˆ·åå’Œå¯†ç ã€‚\nåœ¨æˆ‘æœºå™¨ä¸Šæ²¡æœ‰ä½œç”¨ï¼Œå‡ºç°äº† git: \u0026lsquo;credential-manager\u0026rsquo; is not a git command. See \u0026lsquo;git \u0026ndash;help\u0026rsquo;. çš„é”™è¯¯\næ¸…é™¤æ‰ç¼“å­˜åœ¨gitä¸­çš„ç”¨æˆ·åå’Œå¯†ç åï¼Œä»¥åæ¯æ¬¡ç”¨ https æ–¹å¼æ‹‰å–ä»£ç éƒ½éœ€è¦è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n1 2 git config --system --unset credential.helper # æˆ–è€… git config --global --unset credential.helper git config --global credential.helper store ç¬¬ä¸€ä¸ªå‘½ä»¤æ¸…é™¤å‡­è¯åŠ©æ‰‹ï¼Œä½¿ç”¨ git config \u0026ndash;list å‘½ä»¤è¿™æ˜¯å±•ç¤ºé…ç½®å±æ€§ï¼Œåªè¦ä¸å­˜åœ¨credential.helperè¡¨ç¤ºæ¸…é™¤æˆåŠŸ ç¬¬äºŒä¸ªé…ç½®å‡­è¯åŠ©æ‰‹(å‘½ä»¤å°†å¯†ç æ˜æ–‡ä¿å­˜åœ¨~/.git-credentials)\nGithub é…ç½®å¤šç”¨æˆ· å‚è€ƒæ­¤å¤„\nClone æ–°çš„ä»“åº“ 1 2 3 4 5 6 7 8 9 10 11 12 # github: wylu, email: wylu@gmail.com # the default config Host github.com HostName github.com User git IdentityFile ~/.ssh/id_rsa # github: 15wylu, email: 15wylu@gmail.com Host 15wylu.github.com HostName github.com User git IdentityFile ~/.ssh/15wylu_id_rsa è¿™é‡Œä»¥ä¸Šé¢çš„é…ç½®ä¸ºä¾‹ï¼Œå‡è®¾è¦å…‹éš† 15wylu è´¦å·çš„ä¸€ä¸ªé¡¹ç›®ï¼ŒåŸæ¥ä½¿ç”¨çš„å‘½ä»¤å¦‚ä¸‹ï¼š git@github.com:15wylu/15wylu.github.io.git ä½†æ˜¯ç»è¿‡é…ç½®ï¼Œæˆ‘ä»¬å·²ç»å°† 15wylu çš„ Host è®¾ä¸ºäº† 15wylu.github.comï¼Œè€Œä¸å†æ˜¯åŸæ¥çš„ github.comï¼Œæ‰€ä»¥ç›¸åº”åœ° clone çš„å‘½ä»¤ä¹Ÿå˜æˆå¦‚ä¸‹ï¼š git@15wylu.github.com:15wylu/15wylu.github.io.git\nå·²ç»Clone ä¸‹æ¥çš„ä»“åº“ é¦–å…ˆä½¿ç”¨ git remote -v åˆ—å‡ºæœ¬åœ°ä»“åº“å¯¹åº”çš„è¿œç¨‹åº“ï¼Œæ£€æŸ¥è¯¥ URL æ˜¯å¦ä¸è¦ä½¿ç”¨çš„ GitHub ä¸»æœºåŒ¹é…ï¼Œå¦åˆ™æ›´æ–°è¿œç¨‹åŸå§‹ URL, ä»¥ 15wylu è´¦å·çš„ä»“åº“ä¸ºä¾‹ï¼š git remote set-url origin git@15wylu.github.com:15wylu/15wylu.github.io.git\nå¯¹äºæœ¬åœ°åˆ›å»ºæ–°çš„ä»“åº“ åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨ git init ä¸­åˆå§‹åŒ–ç›®å½•ä¸ºä¸€ä¸ª Git ä»“åº“ã€‚ç„¶ååœ¨ GitHub å¸æˆ·ä¸­åˆ›å»ºæ–°çš„ä»“åº“ï¼Œå°†å…¶ä½œä¸ºè¿œç¨‹åº“æ·»åŠ åˆ°æœ¬åœ°ä»“åº“ä¸­ï¼š åŒæ ·ä»¥ 15wylu è´¦å·ä¸ºä¾‹ï¼š git remote add origin git@15wylu.github.com:15wylu/remote_repo_name.git ç¡®ä¿ @ å’Œ : ä¹‹é—´çš„å­—ç¬¦ä¸²ä¸æˆ‘ä»¬åœ¨ SSH é…ç½®ä¸­æŒ‡å®šçš„ä¸»æœºï¼ˆHostï¼‰åŒ¹é…ã€‚å°†åˆå§‹æäº¤æ¨é€åˆ° GitHub ä»“åº“ã€‚\nGit å¸¸è§æ“ä½œè®°å½• git remote ç›¸å…³ git remote add \u0026lt;repo name\u0026gt; \u0026lt;repo url\u0026gt; repo name ä¸ºè¿œç¨‹ä»“åº“çš„æœ¬åœ°åç§°ï¼Œå¯è‡ªå®šä¹‰ï¼Œç›¸å½“äºç»™ url å¯¹åº”çš„ä»“åº“èµ·äº†ä¸ªåˆ«åï¼Œå¯¹äº git clone çš„ä»“åº“åœ¨æœ¬åœ°çš„åç§°é»˜è®¤ä¸º origin git remote -v æŸ¥çœ‹ä¸Šä¼ åè®®æ˜¯ SSH/HTTPS git remote æŸ¥çœ‹è¿œç¨‹ä»“åº“åç§° git remote show origin æŸ¥çœ‹è¿œç¨‹ä»“åº“åä¸ºorigin çš„è¯¦æƒ… git remote rm \u0026lt;repo name\u0026gt; åˆ é™¤è¿œç¨‹ä»“åº“ git remote set-url [--push|--add|--delete] \u0026lt;repo name\u0026gt; \u0026lt;new url\u0026gt; [\u0026lt;old url\u0026gt;] ä¿®æ”¹è¿œç¨‹ä»“åº“, ä¾‹å¦‚ git remote set-url origin git@github.com:username/reponame.git 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 $ git remote -v origin https://github.com/Reid00/git-test.git (fetch) origin https://github.com/Reid00/git-test.git (push) (base) zhangbl@DESKTOP-8NHU8UF MINGW64 /c/test (main) $ git remote origin (base) zhangbl@DESKTOP-8NHU8UF MINGW64 /c/test (main) $ git remote show origin * remote origin Fetch URL: https://github.com/Reid00/git-test.git Push URL: https://github.com/Reid00/git-test.git HEAD branch: dev Remote branches: dev tracked main tracked Local branch configured for \u0026#39;git pull\u0026#39;: main merges with remote main Local ref configured for \u0026#39;git push\u0026#39;: main pushes to main (up to date) (base) git merge git merge dev æŠŠdev åˆ†æ”¯åˆå¹¶åˆ°å½“å‰æ‰€åœ¨åˆ†æ”¯ã€‚æ³¨æ„ï¼Œéœ€è¦å…ˆcheckout åˆ°æŸä¸ªåˆ†æ”¯ä¸Šåœ¨æ‰§è¡Œã€‚\ngit submodule (å­æ¨¡å—) æ·»åŠ Submodule Git å­æ¨¡å—(Git submodules)å…è®¸ä½ å°† git repo ä¿ç•™ä¸ºå¦ä¸€ä¸ª git repo çš„å­ç›®å½•ã€‚Git å­æ¨¡å—åªæ˜¯åœ¨ç‰¹å®šæ—¶é—´å¿«ç…§ä¸Šå¯¹å¦ä¸€ä¸ª repo çš„å¼•ç”¨ã€‚Git å­æ¨¡å—ä½¿ Git repo èƒ½å¤Ÿåˆå¹¶å’Œè·Ÿè¸ªå¤–éƒ¨ä»£ç çš„ç‰ˆæœ¬å†å²ã€‚\nå‘½ä»¤ git submodule add \u0026lt;repo url\u0026gt; [submodule path] =\u0026gt; git submodule add https://github.com/****/hugo-PaperMod themes/PaperMod\né»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šå­æ¨¡å—å­˜æ”¾è·¯å¾„ï¼Œå­æ¨¡å—å°†ä¼šæ”¾åˆ°ä¸€ä¸ªä¸ä»“åº“åŒåçš„ç›®å½•ä¸­ã€‚å¦‚æœä½ æƒ³è¦æ”¾åˆ°å…¶ä»–åœ°æ–¹ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨å‘½ä»¤ç»“å°¾æ·»åŠ ä¸€ä¸ªä¸åŒçš„è·¯å¾„ï¼Œæœ¬ä¾‹ä¸­å­æ¨¡å—å°†ä¼š clone åˆ° \u0026ldquo;themes/next\u0026rdquo; ç›®å½•ä¸‹ã€‚\nå‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œä¼šåœ¨å½“å‰å·¥ä½œä»“åº“æ ¹ç›®å½•ä¸‹ç”Ÿæˆ .gitmodules æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 [submodule \u0026#34;themes/PaperMod\u0026#34;] path = themes/PaperMod url = https://github.com/adityatelange/hugo-PaperMod.git ignore = dirty è¯¥æ–‡ä»¶ä¿å­˜äº†é¡¹ç›® URL ä¸å·²ç»æ‹‰å–çš„æœ¬åœ°ç›®å½•ä¹‹é—´çš„æ˜ å°„ï¼Œå¦‚æœæœ‰å¤šä¸ªå­æ¨¡å—ï¼Œè¯¥æ–‡ä»¶ä¸­å°±ä¼šæœ‰å¤šæ¡è®°å½•ã€‚ è¦é‡ç‚¹æ³¨æ„çš„æ˜¯ï¼Œè¯¥æ–‡ä»¶åº”åƒ .gitignore æ–‡ä»¶ä¸€æ ·å—åˆ°ï¼ˆé€šè¿‡ï¼‰ç‰ˆæœ¬æ§åˆ¶ï¼Œå’Œè¯¥é¡¹ç›®çš„å…¶ä»–éƒ¨åˆ†ä¸€åŒè¢«æ‹‰å–æ¨é€ã€‚æœ‰äº†æ˜ å°„å…³ç³»ï¼Œå…‹éš†è¯¥é¡¹ç›®çš„äººå°±çŸ¥é“å»å“ªè·å¾—å­æ¨¡å—äº†ã€‚\næ·»åŠ å­æ¨¡å—å®Œæˆåï¼Œå½“åœ¨çˆ¶ä»“åº“æ—¶ï¼ŒGit ä»ç„¶ä¸ä¼šè·Ÿè¸ª submodule çš„æ–‡ä»¶ï¼Œ è€Œæ˜¯å°†å®ƒçœ‹ä½œè¯¥ä»“åº“ä¸­çš„ä¸€ä¸ªç‰¹æ®Šæäº¤ã€‚\næ¨é€åˆ°è¿œç¨‹ä»“åº“åï¼Œè¿œç¨‹ä»“åº“ä¸­ submodule ä¼šå’ŒæŒ‡å®šçš„ commit å…³è”èµ·æ¥ã€‚å¦‚æœéœ€è¦æŒ‡å®šåˆ†æ”¯ï¼Œå¯ä»¥åœ¨ \u0026ldquo;.gitmodules\u0026rdquo; æ–‡ä»¶ä¸­åŠ ä¸Š branch é…ç½®ï¼Œå¦‚ branch = developã€‚\nå…‹éš†å«æœ‰submoduleçš„é¡¹ç›® æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä¼šå…‹éš†ï¼ˆcloneï¼‰ä¸€ä¸ªå«æœ‰å­æ¨¡å—çš„é¡¹ç›®ã€‚ å½“ä½ åœ¨å…‹éš†è¿™æ ·çš„é¡¹ç›®æ—¶ï¼Œé»˜è®¤ä¼šåŒ…å«è¯¥å­æ¨¡å—ç›®å½•ï¼Œä½†å…¶ä¸­è¿˜æ²¡æœ‰ä»»ä½•æ–‡ä»¶ï¼Œä½ éœ€è¦æ‰§è¡Œä¸¤ä¸ªå‘½ä»¤ä»¥æ‹‰å–å­æ¨¡å—ï¼š\n1 2 git submodule init git submodule update git submodule init ç”¨æ¥åˆå§‹åŒ–æœ¬åœ°é…ç½®æ–‡ä»¶ï¼Œè€Œ git submodule update åˆ™ä»å­é¡¹ç›®ä¸­æŠ“å–æ‰€æœ‰æ•°æ®å¹¶æ£€å‡ºçˆ¶é¡¹ç›®ä¸­åˆ—å‡ºçš„åˆé€‚çš„æäº¤ã€‚\næˆ–è€…:\n1 git clone --recursive \u0026lt;parent repo url\u0026gt; åˆ é™¤å­æ¨¡å— æŠŠå­æ¨¡å—ä»ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ç§»é™¤ git rm --cached \u0026lt;submodule path\u0026gt; åˆ é™¤å­æ¨¡å—ç›®å½• rm -rf \u0026lt;submodule path\u0026gt; ç¼–è¾‘ \u0026ldquo;.gitmodules\u0026rdquo;ï¼Œç§»é™¤ç›¸åº” submodule èŠ‚ç‚¹å†…å®¹ ç¼–è¾‘ \u0026ldquo;.git/config\u0026rdquo;ï¼Œç§»é™¤ç›¸åº” submodule é…ç½® å¦‚æœæœ‰ \u0026ldquo;.git/modules\u0026rdquo; ç›®å½•ï¼Œè¿˜åº”åˆ é™¤å…¶ä¸‹çš„ç›¸åº”å­æ¨¡å—çš„ç›®å½• ä¾‹å­:\n1 2 git rm --cached themes/PaperMod rm -rf themes/PaperMod ç„¶ååˆ é™¤ \u0026ldquo;.gitmodules\u0026rdquo; ä¸­å¦‚ä¸‹å†…å®¹ï¼š\n1 2 3 4 [submodule \u0026#34;themes/PaperMod\u0026#34;] path = themes/PaperMod url = https://github.com/adityatelange/hugo-PaperMod.git ignore = dirty æœ€ååˆ é™¤ \u0026ldquo;.git/config\u0026rdquo; ä¸­å¦‚ä¸‹å†…å®¹ï¼š\n1 2 3 [submodule \u0026#34;themes/next\u0026#34;] url = https://github.com/wylu/hexo-theme-next active = true è¦æŠŠæ­¤æ¬¡ä¿®æ”¹åŒæ­¥åˆ°è¿œç¨‹åº“ï¼Œè¿˜éœ€è¦ push ä¸€ä¸‹ã€‚\n","permalink":"https://reid00.github.io/en/posts/other/git-%E5%AE%89%E8%A3%85%E5%92%8C%E5%A4%9A%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE/","summary":"å®‰è£… Windows æ­¤å¤„ä¸‹è½½ åŒå‡»exe ä¸€ç›´ä¸‹ä¸€æ­¥å®‰è£…\nLinux Linux é»˜è®¤å®‰è£…çš„Git ç‰ˆæœ¬ä¸€èˆ¬ä¸º1.8*, å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å‡çº§\né¦–å…ˆï¼ŒæŠŠè€ç‰ˆæœ¬çš„ Git å¸æ‰ã€‚ 1 2 sudo yum -y remove git sudo yum -y remove git-* æ·»åŠ  End Point åˆ° CentOS 7 ä»“åº“ yum -y install https://packages.endpointdev.com/rhel/7/os/x86_64/endpoint-repo.x86_64.rpm yum -y install git check version git version é…ç½®Git Set your name. git config --global user.name \u0026quot;Your Name\u0026quot; Set your email address. git config --global user.email \u0026quot;user@exmample.com\u0026quot; Verify the settings. git config --list Git é…ç½®SSH key è¿æ¥Github HTTPS URL å’Œ SSH URL åœ¨ä½¿ç”¨ git clone é¡¹ç›®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»“åº“çš„ HTTPS URL ä¹Ÿå¯ä»¥ ä½¿ç”¨ SSH URL HTTPS URLï¼Œä¾‹å¦‚ï¼šhttps://github.","title":"Git å®‰è£…å’Œå¤šç”¨æˆ·é…ç½®"},{"content":"å“ˆå¸Œ å“ˆå¸Œï¼ˆHashï¼‰ä¹Ÿç§°ä¸ºæ•£åˆ—ï¼Œæ˜¯æŠŠä»»æ„é•¿åº¦çš„è¾“å…¥é€šè¿‡å“ˆå¸Œç®—æ³•å˜æ¢ä¸ºå›ºå®šé•¿åº¦çš„è¾“å‡ºï¼Œè¿™ä¸ªè¾“å‡ºå€¼ä¹Ÿå°±æ˜¯æ•£åˆ—å€¼ã€‚\nå“ˆå¸Œè¡¨æ˜¯æ ¹æ®é”®å€¼å¯¹ï¼ˆkey valueï¼‰è€Œç›´æ¥è¿›è¡Œè®¿é—®çš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡å°†é”®å€¼å¯¹æ˜ å°„åˆ°è¡¨ä¸­ä¸€ä¸ªä½ç½®æ¥è®¿é—®è®°å½•ï¼Œä»¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚æ˜ å°„å‡½æ•°åˆç§°ä¸ºæ•£åˆ—å‡½æ•°ï¼Œå­˜æ”¾è®°å½•çš„æ•°ç»„å«åšå“ˆå¸Œè¡¨ã€‚\nå¦‚æœä¸¤ä¸ªè¾“å…¥ä¸²çš„å“ˆå¸Œå‡½æ•°çš„å€¼ç›¸åŒåˆ™å‘ç”Ÿäº†ç¢°æ’ï¼ˆCollisionï¼‰ï¼Œæ—¢ç„¶æŠŠä»»æ„è¾ƒé•¿å­—ç¬¦ä¸²è½¬åŒ–ä¸ºå›ºå®šé•¿åº¦ä¸”è¾ƒçŸ­çš„å­—ç¬¦ä¸²ï¼Œå› æ­¤å¿…æœ‰ä¸€ä¸ªè¾“å‡ºä¸²å¯¹åº”å¤šä¸ªè¾“å…¥ä¸²ï¼Œç¢°æ’æ˜¯å¿…ç„¶å­˜åœ¨çš„ã€‚è¿™ç§ç¢°æ’åˆç§°ä¸ºå“ˆå¸Œå†²çªã€‚\næ•£åˆ—å‡½æ•° å“ˆå¸Œç®—æ³•æ˜¯ä¸€ç§å¹¿ä¹‰çš„ç®—æ³•ï¼Œä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§æ€æƒ³ï¼Œä½¿ç”¨å“ˆå¸Œç®—æ³•å¯æé«˜å­˜å‚¨ç©ºé—´çš„åˆ©ç”¨ç‡å’Œæ•°æ®æŸ¥è¯¢æ•ˆç‡ã€‚\nå“ˆå¸Œå‡½æ•°åˆç§°ä¸ºæ•£åˆ—å‡½æ•°ï¼Œé‡‡ç”¨æ•£åˆ—ç®—æ³•ã€‚ å“ˆå¸Œå‡½æ•°æ˜¯ä¸€ç§ä»ä»»ä½•ä¸€ç§æ•°æ®ä¸­åˆ›å»ºå°çš„æ•°å­—â€œæŒ‡çº¹â€çš„æ–¹æ³•ã€‚ å“ˆå¸Œå‡½æ•°å°†æ•°æ®æ‰“ä¹±æ··åˆï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ªå«åšæ•£åˆ—å€¼çš„â€œæŒ‡çº¹â€ã€‚ å“ˆå¸Œå‡½æ•°ä¼šå°†æ¶ˆæ¯æˆ–æ•°æ®å‹ç¼©æˆæ‘˜è¦ï¼Œä½¿å¾—æ•°æ®é‡å˜å°ï¼Œå°†æ•°æ®çš„æ ¼å¼å›ºå®šä¸‹æ¥ã€‚ Go æ¥å£ Golangçš„hashåŒ…æä¾›å¤šç§æ•£åˆ—ç®—æ³•ï¼Œæ¯”å¦‚crc32/64, adler32, fnv\u0026hellip;\n1 2 3 4 5 6 7 type Hash interface{ io.Writer //åµŒå…¥io.Writeræ¥å£ï¼Œå‘æ‰§è¡Œä¸­çš„hashåŠ å…¥æ›´å¤šæ•°æ®ã€‚ Sum(b []byte) []byte//å°†å½“å‰hashè¿½åŠ åˆ°å­—èŠ‚æ•°ç»„båé¢ï¼Œä¸ä¼šæ”¹å˜å½“å‰hashçŠ¶æ€ã€‚ Reset()//é‡ç½®hashåˆ°åˆå§‹åŒ–çŠ¶æ€ Size() int//è¿”å›hashç»“æœè¿”å›çš„å­—èŠ‚æ•° BlockSize() int//è¿”å›hashçš„é›†æˆå—å¤§å°ï¼Œä¸ºæé«˜æ•ˆç‡ï¼ŒWriteæ–¹æ³•ä¼ å…¥çš„å­—èŠ‚æ•°æœ€å¥½æ˜¯block sizeçš„å€æ•°ã€‚ } MD5 MD5æ¶ˆæ¯æ‘˜è¦ç®—æ³•ï¼Œæ˜¯ä¸€ç§è¢«å¹¿æ³›ä½¿ç”¨çš„å¯†ç æ•£åˆ—å‡½æ•°ï¼Œå¯ä»¥äº§å‡ºä¸€ä¸ª128ä½ï¼ˆ16å­èŠ‚ï¼‰çš„æ•£åˆ—å€¼ã€‚\nMD5å·²è¢«è¯å®æ— æ³•é˜²æ­¢ç¢°æ’ï¼Œå·²ç»ä¸ç®—æ˜¯å¾ˆå®‰å…¨çš„ç®—æ³•ï¼Œå› æ­¤ä¸é€‚ç”¨äºå®‰å…¨æ€§è®¤è¯ï¼Œæ¯”å¦‚SSLå…¬å¼€å¯†é’¥è®¤è¯æˆ–æ•°å­—ç­¾åç­‰ç”¨é€”ã€‚\nå¯¹äºéœ€è¦é«˜åº¦å®‰å…¨æ€§çš„æ•°æ®ï¼Œä¸€èˆ¬å»ºè®®æ”¹ç”¨å…¶ä»–ç®—æ³•ï¼Œæ¯”å¦‚SHA256ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 input := \u0026#34;123456\u0026#34; hash := md5.New() //åˆ›å»ºæ•£åˆ—å€¼ n, err := hash.Write([]byte(input)) //å†™å…¥å¾…å¤„ç†å­—èŠ‚ if err != nil { fmt.Println(err, n) os.Exit(-1) } //bytes := hash.Sum([]byte(\u0026#34;\u0026#34;)) bytes := hash.Sum(nil) //è·å–æœ€ç»ˆæ•£åˆ—å€¼çš„å­—ç¬¦åˆ‡ç‰‡ fmt.Printf(\u0026#34;%v\\n\u0026#34;, bytes) //[225 10 220 57 73 186 89 171 190 86 224 87 242 15 136 62] fmt.Printf(\u0026#34;%x\\n\u0026#34;, bytes) //ä»¥16è¿›åˆ¶å­—ç¬¦ä¸²æ ¼å¼åŒ–å­—ç¬¦åˆ‡ç‰‡ //e10adc3949ba59abbe56e057f20f883e MD5å’ŒSHA256æ˜¯éå¸¸å¸¸ç”¨çš„ä¸¤ç§å•å‘æ•£åˆ—å‡½æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 import ( \u0026#34;crypto/md5\u0026#34; \u0026#34;encoding/hex\u0026#34; \u0026#34;testing\u0026#34; ) func MD5(input string) string { c := md5.New() c.Write([]byte(input)) bytes := c.Sum(nil) return hex.EncodeToString(bytes) } SHA-1 1 2 3 4 5 6 7 password := \u0026#34;123456\u0026#34; ins := sha1.New() ins.Write([]byte(password)) result := ins.Sum([]byte(\u0026#34;\u0026#34;)) fmt.Printf(\u0026#34;%x\\n\u0026#34;, result) //7c4a8d09ca3762af61e59520943dc26494f8941b 1 2 3 4 5 6 7 8 9 10 11 12 import ( \u0026#34;crypto/sha1\u0026#34; \u0026#34;encoding/hex\u0026#34; \u0026#34;testing\u0026#34; ) func SHA1(input string) string { c := sha1.New() c.Write([]byte(input)) bytes := c.Sum(nil) return hex.EncodeToString(bytes) } CRC32 CRCå³Cyclic Redundancy Checkå¾ªç¯å†—ä½™æ ¡éªŒç  CRCæ˜¯å®ç°32ä½å¾ªç¯å†—ä½™æ ¡éªŒæˆ–CRC-32æ ¡éªŒå’Œ åœ¨è¿œè·ç¦»æ•°æ®é€šä¿¡ä¸­ï¼Œä¸ºç¡®ä¿é«˜æ•ˆè€Œæ— å·®é”™åœ°ä¼ é€æ•°æ®ï¼Œå¿…é¡»å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒå³å·®é”™æ§åˆ¶ã€‚ CRCï¼ˆCyclic Redundancy Check/Codeï¼‰å¾ªç¯å†—ä½™æ ¡éªŒæ˜¯å¯¹ä¸€ä¸ªä¼ é€æ•°æ®å—è¿›è¡Œæ ¡éªŒï¼Œæ˜¯ä¸€ç§é«˜æ•ˆçš„å·®é”™æ§åˆ¶æ–¹æ³•ã€‚ ChecksumIEEEä½¿ç”¨IEEEå¤šé¡¹å¼è¿”å›æ•°æ®çš„CRC-32æ ¡éªŒå’Œ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 package test import ( \u0026#34;hash/crc32\u0026#34; \u0026#34;testing\u0026#34; ) func CRC32(input string) uint32 { bytes := []byte(input) return crc32.ChecksumIEEE(bytes) } func TestHash(t *testing.T) { input := \u0026#34;123456\u0026#34; t.Log(CRC32(input)) //158520161 } MurMur æˆ‘ä»¬æœ‰æ—¶å€™æƒ³å°†ä¸€æ®µå†…å®¹ï¼ˆæ¯”å¦‚å­—ç¬¦ä¸²ï¼‰è½¬æ¢æˆä¸€ä¸ªéšæœºæ•´æ•°å€¼ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨murmur3 hashç®—æ³•å¯ä»¥è¾¾åˆ°è¿™ä¸ªç›®çš„ 1ï¼‰hashç®—æ³•æœ‰å¯èƒ½å‘ç”Ÿç¢°æ’ï¼Œå³ä¸åŒçš„è¾“å…¥è½¬æ¢å‡ºçš„hashå€¼æ˜¯ä¸€æ ·çš„ï¼Œå¥½çš„ç®—æ³•å½“ç„¶å‘ç”Ÿç¢°æ’çš„æ¦‚ç‡ä¼šå¾ˆå°ã€‚ 2ï¼‰murmur3ç®—æ³•æ˜¯éåŠ å¯†å“ˆå¸Œç®—æ³•\nåŠ å¯†å“ˆå¸Œå‡½æ•°æ—¨åœ¨ä¿è¯å®‰å…¨æ€§ï¼Œå¾ˆéš¾æ‰¾åˆ°ç¢°æ’ã€‚å³ï¼šç»™å®šçš„æ•£åˆ—hå¾ˆéš¾æ‰¾åˆ°çš„æ¶ˆæ¯mï¼›å¾ˆéš¾æ‰¾åˆ°äº§ç”Ÿç›¸åŒçš„å“ˆå¸Œå€¼çš„æ¶ˆæ¯m1å’Œm2ã€‚ éåŠ å¯†å“ˆå¸Œå‡½æ•°åªæ˜¯è¯•å›¾é¿å…éæ¶æ„è¾“å…¥çš„å†²çªã€‚ä½œä¸ºè¾ƒå¼±æ‹…ä¿çš„äº¤æ¢ï¼Œå®ƒä»¬é€šå¸¸æ›´å¿«ã€‚å¦‚æœæ•°æ®é‡å°ï¼Œæˆ–è€…ä¸å¤ªåœ¨æ„å“ˆå¸Œç¢°æ’çš„é¢‘ç‡ï¼Œç”šè‡³å¯ä»¥é€‰æ‹©ç”Ÿæˆå“ˆå¸Œå€¼å°çš„å“ˆå¸Œç®—æ³•ï¼Œå ç”¨æ›´å°çš„ç©ºé—´ã€‚ ç¤ºä¾‹ä»£ç :\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 package main import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/spaolacci/murmur3\u0026#34; ) func main() { originalStr := \u0026#34;pwww.google.com\u0026#34; // æ³¨æ„ï¼šç”Ÿæˆçš„hashå€¼æœ‰ä¸‰ç§å–å€¼ï¼Œuint32ï¼Œuint64ï¼Œuint128ï¼Œåˆ†åˆ«å¯¹åº”æ–¹æ³•Sum32ï¼ŒSum64ï¼ŒSum128 // ä¸‹é¢ä¾‹å­ä»¥Sum64ä¸ºä¾‹ // 1ã€ä½¿ç”¨é»˜è®¤ç§å­ï¼Œç”Ÿæˆå“ˆå¸Œå€¼ // é»˜è®¤ç§å­ï¼Œå…¶å®æ˜¯seed=0 hValue1 := murmur3.Sum64([]byte(originalStr)) fmt.Printf(\u0026#34;hValue1 is %d\\n\u0026#34;, hValue1) // hValue1 is 13092418635223121727 // é»˜è®¤è¿”å›å€¼æ˜¯uint64, è½¬åŒ–ä¸ºint64 hValue1 := murmur3.Sum64([]byte(originalStr)) fmt.Printf(\u0026#34;hValue1 is %d\\n\u0026#34;, hValue1) // hValue1 is -5354325438486429889 // 2ã€ä½¿ç”¨æŒ‡å®šç§å­ï¼Œç”Ÿæˆå“ˆå¸Œå€¼ seed := uint32(0000) hValue2 := murmur3.Sum64WithSeed([]byte(originalStr), seed) fmt.Printf(\u0026#34;hValue2 is %d\\n\u0026#34;, hValue2) // hValue2 is 13092418635223121727 // 3ã€ä½¿ç”¨æŒ‡å®šç§å­ï¼Œç”Ÿæˆå“ˆå¸Œå€¼ï¼Œ2çš„å¦ä¸€ç§å†™æ³• h := murmur3.New64WithSeed(seed) h.Write([]byte(originalStr)) hValue3 := h.Sum64() fmt.Printf(\u0026#34;hValue3 is %d\\n\u0026#34;, hValue3) // hValue3 is 13092418635223121727 // å¦‚æœä½¿ç”¨hç»§ç»­è®¡ç®—å…¶ä»–å€¼ï¼Œåˆ™éœ€è¦é¦–å…ˆè°ƒç”¨Resetï¼Œå¼•ä¸ºwriteè¿™é‡Œæ˜¯è¿½åŠ å†™ h.Reset() h.Write([]byte(originalStr)) hValue4 := h.Sum64() fmt.Printf(\u0026#34;hValue4 is %d\\n\u0026#34;, hValue4) // hValue4 is 13092418635223121727 } ","permalink":"https://reid00.github.io/en/posts/langs_linux/golang-murmur3/","summary":"å“ˆå¸Œ å“ˆå¸Œï¼ˆHashï¼‰ä¹Ÿç§°ä¸ºæ•£åˆ—ï¼Œæ˜¯æŠŠä»»æ„é•¿åº¦çš„è¾“å…¥é€šè¿‡å“ˆå¸Œç®—æ³•å˜æ¢ä¸ºå›ºå®šé•¿åº¦çš„è¾“å‡ºï¼Œè¿™ä¸ªè¾“å‡ºå€¼ä¹Ÿå°±æ˜¯æ•£åˆ—å€¼ã€‚\nå“ˆå¸Œè¡¨æ˜¯æ ¹æ®é”®å€¼å¯¹ï¼ˆkey valueï¼‰è€Œç›´æ¥è¿›è¡Œè®¿é—®çš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡å°†é”®å€¼å¯¹æ˜ å°„åˆ°è¡¨ä¸­ä¸€ä¸ªä½ç½®æ¥è®¿é—®è®°å½•ï¼Œä»¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚æ˜ å°„å‡½æ•°åˆç§°ä¸ºæ•£åˆ—å‡½æ•°ï¼Œå­˜æ”¾è®°å½•çš„æ•°ç»„å«åšå“ˆå¸Œè¡¨ã€‚\nå¦‚æœä¸¤ä¸ªè¾“å…¥ä¸²çš„å“ˆå¸Œå‡½æ•°çš„å€¼ç›¸åŒåˆ™å‘ç”Ÿäº†ç¢°æ’ï¼ˆCollisionï¼‰ï¼Œæ—¢ç„¶æŠŠä»»æ„è¾ƒé•¿å­—ç¬¦ä¸²è½¬åŒ–ä¸ºå›ºå®šé•¿åº¦ä¸”è¾ƒçŸ­çš„å­—ç¬¦ä¸²ï¼Œå› æ­¤å¿…æœ‰ä¸€ä¸ªè¾“å‡ºä¸²å¯¹åº”å¤šä¸ªè¾“å…¥ä¸²ï¼Œç¢°æ’æ˜¯å¿…ç„¶å­˜åœ¨çš„ã€‚è¿™ç§ç¢°æ’åˆç§°ä¸ºå“ˆå¸Œå†²çªã€‚\næ•£åˆ—å‡½æ•° å“ˆå¸Œç®—æ³•æ˜¯ä¸€ç§å¹¿ä¹‰çš„ç®—æ³•ï¼Œä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§æ€æƒ³ï¼Œä½¿ç”¨å“ˆå¸Œç®—æ³•å¯æé«˜å­˜å‚¨ç©ºé—´çš„åˆ©ç”¨ç‡å’Œæ•°æ®æŸ¥è¯¢æ•ˆç‡ã€‚\nå“ˆå¸Œå‡½æ•°åˆç§°ä¸ºæ•£åˆ—å‡½æ•°ï¼Œé‡‡ç”¨æ•£åˆ—ç®—æ³•ã€‚ å“ˆå¸Œå‡½æ•°æ˜¯ä¸€ç§ä»ä»»ä½•ä¸€ç§æ•°æ®ä¸­åˆ›å»ºå°çš„æ•°å­—â€œæŒ‡çº¹â€çš„æ–¹æ³•ã€‚ å“ˆå¸Œå‡½æ•°å°†æ•°æ®æ‰“ä¹±æ··åˆï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ªå«åšæ•£åˆ—å€¼çš„â€œæŒ‡çº¹â€ã€‚ å“ˆå¸Œå‡½æ•°ä¼šå°†æ¶ˆæ¯æˆ–æ•°æ®å‹ç¼©æˆæ‘˜è¦ï¼Œä½¿å¾—æ•°æ®é‡å˜å°ï¼Œå°†æ•°æ®çš„æ ¼å¼å›ºå®šä¸‹æ¥ã€‚ Go æ¥å£ Golangçš„hashåŒ…æä¾›å¤šç§æ•£åˆ—ç®—æ³•ï¼Œæ¯”å¦‚crc32/64, adler32, fnv\u0026hellip;\n1 2 3 4 5 6 7 type Hash interface{ io.Writer //åµŒå…¥io.Writeræ¥å£ï¼Œå‘æ‰§è¡Œä¸­çš„hashåŠ å…¥æ›´å¤šæ•°æ®ã€‚ Sum(b []byte) []byte//å°†å½“å‰hashè¿½åŠ åˆ°å­—èŠ‚æ•°ç»„båé¢ï¼Œä¸ä¼šæ”¹å˜å½“å‰hashçŠ¶æ€ã€‚ Reset()//é‡ç½®hashåˆ°åˆå§‹åŒ–çŠ¶æ€ Size() int//è¿”å›hashç»“æœè¿”å›çš„å­—èŠ‚æ•° BlockSize() int//è¿”å›hashçš„é›†æˆå—å¤§å°ï¼Œä¸ºæé«˜æ•ˆç‡ï¼ŒWriteæ–¹æ³•ä¼ å…¥çš„å­—èŠ‚æ•°æœ€å¥½æ˜¯block sizeçš„å€æ•°ã€‚ } MD5 MD5æ¶ˆæ¯æ‘˜è¦ç®—æ³•ï¼Œæ˜¯ä¸€ç§è¢«å¹¿æ³›ä½¿ç”¨çš„å¯†ç æ•£åˆ—å‡½æ•°ï¼Œå¯ä»¥äº§å‡ºä¸€ä¸ª128ä½ï¼ˆ16å­èŠ‚ï¼‰çš„æ•£åˆ—å€¼ã€‚\nMD5å·²è¢«è¯å®æ— æ³•é˜²æ­¢ç¢°æ’ï¼Œå·²ç»ä¸ç®—æ˜¯å¾ˆå®‰å…¨çš„ç®—æ³•ï¼Œå› æ­¤ä¸é€‚ç”¨äºå®‰å…¨æ€§è®¤è¯ï¼Œæ¯”å¦‚SSLå…¬å¼€å¯†é’¥è®¤è¯æˆ–æ•°å­—ç­¾åç­‰ç”¨é€”ã€‚\nå¯¹äºéœ€è¦é«˜åº¦å®‰å…¨æ€§çš„æ•°æ®ï¼Œä¸€èˆ¬å»ºè®®æ”¹ç”¨å…¶ä»–ç®—æ³•ï¼Œæ¯”å¦‚SHA256ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 input := \u0026#34;123456\u0026#34; hash := md5.New() //åˆ›å»ºæ•£åˆ—å€¼ n, err := hash.Write([]byte(input)) //å†™å…¥å¾…å¤„ç†å­—èŠ‚ if err !","title":"Golang MurMur3"},{"content":"Linuxä¿®æ”¹ä¸»æœºåä¿®æ”¹hostnameçš„æ–¹æ³• ä¸´æ—¶ä¿®æ”¹Linuxä¸»æœºåçš„æ–¹æ³• hostname newname æ‰§è¡Œå‘½ä»¤åå‘ç°æ²¡æœ‰å˜åŒ–ã€‚é‡æ–°å¼€ç»ˆç«¯å³å¯æ˜¾ç¤ºï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡uname -nå‘½ä»¤æ¥æŸ¥çœ‹å½“å‰çš„ä¸»æœºåã€‚\næ°¸ä¹…ä¿®æ”¹Linuxä¸»æœºåçš„æ–¹æ³•\nä½¿ç”¨ hostnamectl æ¥æ”¹å˜ä¸»æœºåç§° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 [root@nebula3-01 ~]# hostnamectl Static hostname: nebula3-01 Icon name: computer-vm Chassis: vm Machine ID: 1d8987d66da0c7cd7960ca4e5aefe30f Boot ID: 717058195e934eb88f4631adf25ab163 Virtualization: kvm Operating System: CentOS Linux 7 (Core) CPE OS Name: cpe:/o:centos:centos:7 Kernel: Linux 3.10.0-1160.el7.x86_64 Architecture: x86-64 [root@nebula-test02 ~]# hostnamectl set-hostname nebula3-02 [root@nebula-test02 ~]# hostnamectl Static hostname: nebula3-02 Icon name: computer-vm Chassis: vm Machine ID: 1d8987d66da0c7cd7960ca4e5aefe30f Boot ID: 6b836dcf9c274ef48f334e6b53f8e296 Virtualization: kvm Operating System: CentOS Linux 7 (Core) CPE OS Name: cpe:/o:centos:centos:7 Kernel: Linux 3.10.0-1160.el7.x86_64 Architecture: x86-64 [root@nebula-test02 ~]# é€€å‡ºåï¼Œé‡æ–°ç™»å½•å³å¯\né€šè¿‡ä¿®æ”¹/etc/hostname æ–‡ä»¶ï¼Œæœ¬è´¨å’Œä¸Šé¢ä¸€æ · 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 [root@nebula-test03 ~]# hostnamectl Static hostname: nebula-test03.novalocal Icon name: computer-vm Chassis: vm Machine ID: 1d8987d66da0c7cd7960ca4e5aefe30f Boot ID: 683f9e34bce149659226bcdfc0dce6ed Virtualization: kvm Operating System: CentOS Linux 7 (Core) CPE OS Name: cpe:/o:centos:centos:7 Kernel: Linux 3.10.0-1160.el7.x86_64 Architecture: x86-64 [root@nebula-test03 ~]# cat /etc/hostname nebula-test03.novalocal [root@nebula-test03 ~]# echo \u0026#34;nebula3-03\u0026#34; \u0026gt; /etc/hostname [root@nebula-test03 ~]# hostnamectl Static hostname: nebula3-03 Transient hostname: nebula-test03.novalocal Icon name: computer-vm Chassis: vm Machine ID: 1d8987d66da0c7cd7960ca4e5aefe30f Boot ID: 683f9e34bce149659226bcdfc0dce6ed Virtualization: kvm Operating System: CentOS Linux 7 (Core) CPE OS Name: cpe:/o:centos:centos:7 Kernel: Linux 3.10.0-1160.el7.x86_64 Architecture: x86-64 é€šè¿‡æœºå™¨åping é€šå½¼æ­¤ ä¿®æ”¹/etc/hosts æ–‡ä»¶ï¼Œæ·»åŠ  ip åŸŸå å³å¯ã€‚ vim /etc/hosts\n1 2 3 4 172.18.163.124 test-server-01 172.18.163.115 test-server-02 172.18.163.114 test-server-03 172.18.163.85 test-server-04 æŸ¥çœ‹æœåŠ¡å™¨æ˜¯å¦ä¸ºSSD æ–¹æ³•ä¸€ åˆ¤æ–­cat /sys/block/*/queue/rotational çš„è¿”å›å€¼ï¼ˆå…¶ä¸­*ä¸ºä½ çš„ç¡¬ç›˜è®¾å¤‡åç§°ï¼Œä¾‹å¦‚sdaç­‰ç­‰ï¼‰ï¼Œå¦‚æœè¿”å›1åˆ™è¡¨ç¤ºç£ç›˜å¯æ—‹è½¬ï¼Œé‚£ä¹ˆå°±æ˜¯HDDäº†ï¼›åä¹‹ï¼Œå¦‚æœè¿”å›0ï¼Œåˆ™è¡¨ç¤ºç£ç›˜ä¸å¯ä»¥æ—‹è½¬ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½æ˜¯SSDäº†ã€‚\næ–¹æ³•äºŒ lsblk -d -o name,rota å‘½ä»¤\n1 2 3 [root@nebula3-04 ~]# lsblk -d -o name,rota NAME ROTA vda 1 åˆ’åˆ†åˆ†åŒºå¹¶æŒ‚è½½ç£ç›˜ æœ¬æ“ä½œä»¥è¯¥åœºæ™¯ä¸ºä¾‹ï¼Œå½“äº‘æœåŠ¡å™¨æŒ‚è½½äº†ä¸€å—æ–°çš„æ•°æ®ç›˜æ—¶ï¼Œä½¿ç”¨fdiskåˆ†åŒºå·¥å…·å°†è¯¥æ•°æ®ç›˜è®¾ä¸ºä¸»åˆ†åŒºï¼Œåˆ†åŒºå½¢å¼é»˜è®¤è®¾ç½®ä¸ºMBRï¼Œæ–‡ä»¶ç³»ç»Ÿè®¾ä¸ºext4æ ¼å¼ï¼ŒæŒ‚è½½åœ¨â€œ/mnt/sdcâ€ä¸‹ï¼Œå¹¶è®¾ç½®å¼€æœºå¯åŠ¨è‡ªåŠ¨æŒ‚è½½ã€‚\nfdisk -l æ˜¾ç¤ºä¿¡æ¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 [root@ecs-test-0001 ~]# fdisk -l Disk /dev/vda: 42.9 GB, 42949672960 bytes, 83886080 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk label type: dos Disk identifier: 0x000bcb4e Device Boot Start End Blocks Id System /dev/vda1 * 2048 83886079 41942016 83 Linux Disk /dev/vdb: 107.4 GB, 107374182400 bytes, 209715200 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes è¡¨ç¤ºå½“å‰çš„äº‘æœåŠ¡å™¨æœ‰ä¸¤å—ç£ç›˜ï¼Œâ€œ/dev/vdaâ€æ˜¯ç³»ç»Ÿç›˜ï¼Œâ€œ/dev/vdbâ€æ˜¯æ–°å¢æ•°æ®ç›˜ã€‚\næ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè¿›å…¥fdiskåˆ†åŒºå·¥å…·ï¼Œå¼€å§‹å¯¹æ–°å¢æ•°æ®ç›˜æ‰§è¡Œåˆ†åŒºæ“ä½œã€‚ fdisk æ–°å¢æ•°æ®ç›˜ ä»¥æ–°æŒ‚è½½çš„æ•°æ®ç›˜â€œ/dev/vdbâ€ä¸ºä¾‹ï¼š fdisk /dev/vdb 1 2 3 4 5 6 7 8 9 10 [root@ecs-test-0001 ~]# fdisk /dev/vdb Welcome to fdisk (util-linux 2.23.2). Changes will remain in memory only, until you decide to write them. Be careful before using the write command. Device does not contain a recognized partition table Building a new DOS disklabel with disk identifier 0x38717fc1. Command (m for help): è¾“å…¥â€œnâ€ï¼ŒæŒ‰â€œEnterâ€ï¼Œå¼€å§‹æ–°å»ºåˆ†åŒºã€‚ 1 2 3 4 Command (m for help): n Partition type: p primary (0 primary, 0 extended, 4 free) e extended è¡¨ç¤ºç£ç›˜æœ‰ä¸¤ç§åˆ†åŒºç±»å‹ï¼š\nâ€œpâ€è¡¨ç¤ºä¸»åˆ†åŒºã€‚ â€œeâ€è¡¨ç¤ºæ‰©å±•åˆ†åŒºã€‚ ç£ç›˜ä½¿ç”¨MBRåˆ†åŒºå½¢å¼ï¼Œæœ€å¤šå¯ä»¥åˆ›å»º4ä¸ªä¸»åˆ†åŒºï¼Œæˆ–è€…3ä¸ªä¸»åˆ†åŒºåŠ 1ä¸ªæ‰©å±•åˆ†åŒºï¼Œæ‰©å±•åˆ†åŒºä¸å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œéœ€è¦åˆ’åˆ†æˆè‹¥å¹²ä¸ªé€»è¾‘åˆ†åŒºæ‰å¯ä»¥ä½¿ç”¨ã€‚ ç£ç›˜ä½¿ç”¨GPTåˆ†åŒºå½¢å¼æ—¶ï¼Œæ²¡æœ‰ä¸»åˆ†åŒºã€æ‰©å±•åˆ†åŒºä»¥åŠé€»è¾‘åˆ†åŒºä¹‹åˆ†ã€‚\nä»¥åˆ›å»ºä¸€ä¸ªä¸»è¦åˆ†åŒºä¸ºä¾‹ï¼Œè¾“å…¥â€œpâ€ï¼ŒæŒ‰â€œEnterâ€ï¼Œå¼€å§‹åˆ›å»ºä¸€ä¸ªä¸»åˆ†åŒºã€‚ 1 2 Select (default p): p Partition number (1-4, default 1): â€œPartition numberâ€è¡¨ç¤ºä¸»åˆ†åŒºç¼–å·ï¼Œå¯ä»¥é€‰æ‹©1-4ã€‚\nä»¥åˆ†åŒºç¼–å·é€‰æ‹©â€œ1â€ä¸ºä¾‹ï¼Œè¾“å…¥ä¸»åˆ†åŒºç¼–å·â€œ1â€ï¼ŒæŒ‰â€œEnterâ€ã€‚ 1 2 Partition number (1-4, default 1): 1 First sector (2048-209715199, default 2048): â€œFirst sectorâ€è¡¨ç¤ºèµ·å§‹ç£æŸ±å€¼ï¼Œå¯ä»¥é€‰æ‹©2048-209715199ï¼Œé»˜è®¤ä¸º2048ã€‚\nä»¥é€‰æ‹©é»˜è®¤èµ·å§‹ç£æŸ±å€¼2048ä¸ºä¾‹ï¼ŒæŒ‰â€œEnterâ€ ç³»ç»Ÿä¼šè‡ªåŠ¨æç¤ºåˆ†åŒºå¯ç”¨ç©ºé—´çš„èµ·å§‹ç£æŸ±å€¼å’Œæˆªæ­¢ç£æŸ±å€¼ï¼Œå¯ä»¥åœ¨è¯¥åŒºé—´å†…è‡ªå®šä¹‰ï¼Œæˆ–è€…ä½¿ç”¨é»˜è®¤å€¼ã€‚èµ·å§‹ç£æŸ±å€¼å¿…é¡»å°äºåˆ†åŒºçš„æˆªæ­¢ç£æŸ±å€¼ã€‚ 1 2 3 First sector (2048-209715199, default 2048): Using default value 2048 Last sector, +sectors or +size{K,M,G} (2048-209715199, default 209715199): â€œLast sectorâ€è¡¨ç¤ºæˆªæ­¢ç£æŸ±å€¼ï¼Œå¯ä»¥é€‰æ‹©2048-209715199ï¼Œé»˜è®¤ä¸º209715199ã€‚\nä»¥é€‰æ‹©é»˜è®¤æˆªæ­¢ç£æŸ±å€¼209715199ä¸ºä¾‹ï¼ŒæŒ‰â€œEnterâ€ã€‚ ç³»ç»Ÿä¼šè‡ªåŠ¨æç¤ºåˆ†åŒºå¯ç”¨ç©ºé—´çš„èµ·å§‹ç£æŸ±å€¼å’Œæˆªæ­¢ç£æŸ±å€¼ï¼Œå¯ä»¥åœ¨è¯¥åŒºé—´å†…è‡ªå®šä¹‰ï¼Œæˆ–è€…ä½¿ç”¨é»˜è®¤å€¼ã€‚èµ·å§‹ç£æŸ±å€¼å¿…é¡»å°äºåˆ†åŒºçš„æˆªæ­¢ç£æŸ±å€¼ã€‚ 1 2 3 4 5 Last sector, +sectors or +size{K,M,G} (2048-209715199, default 209715199): Using default value 209715199 Partition 1 of type Linux and of size 100 GiB is set Command (m for help): è¡¨ç¤ºåˆ†åŒºå®Œæˆï¼Œå³ä¸ºæ•°æ®ç›˜æ–°å»ºäº†1ä¸ªåˆ†åŒºã€‚\nè¾“å…¥â€œpâ€ï¼ŒæŒ‰â€œEnterâ€ï¼ŒæŸ¥çœ‹æ–°å»ºåˆ†åŒºçš„è¯¦ç»†ä¿¡æ¯ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 Command (m for help): p Disk /dev/vdb: 107.4 GB, 107374182400 bytes, 209715200 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk label type: dos Disk identifier: 0x38717fc1 Device Boot Start End Blocks Id System /dev/vdb1 2048 209715199 104856576 83 Linux Command (m for help): è¡¨ç¤ºæ–°å»ºåˆ†åŒºâ€œ/dev/vdb1â€çš„è¯¦ç»†ä¿¡æ¯ã€‚\nè¾“å…¥â€œwâ€ï¼ŒæŒ‰â€œEnterâ€ï¼Œå°†åˆ†åŒºç»“æœå†™å…¥åˆ†åŒºè¡¨ä¸­ã€‚ 1 2 3 4 5 Command (m for help): w The partition table has been altered! Calling ioctl() to re-read partition table. Syncing disks. è¡¨ç¤ºåˆ†åŒºåˆ›å»ºå®Œæˆã€‚ å¦‚æœä¹‹å‰åˆ†åŒºæ“ä½œæœ‰è¯¯ï¼Œè¯·è¾“å…¥â€œqâ€ï¼Œåˆ™ä¼šé€€å‡ºfdiskåˆ†åŒºå·¥å…·ï¼Œä¹‹å‰çš„åˆ†åŒºç»“æœå°†ä¸ä¼šè¢«ä¿ç•™ã€‚\næ‰§è¡Œpartprobeå‘½ä»¤ï¼Œå°†æ–°çš„åˆ†åŒºè¡¨å˜æ›´åŒæ­¥è‡³æ“ä½œç³»ç»Ÿã€‚\næ‰§è¡Œmkfs -t ext4 /dev/vdb1å‘½ä»¤ï¼Œå°†æ–°å»ºåˆ†åŒºæ–‡ä»¶ç³»ç»Ÿè®¾ä¸ºç³»ç»Ÿæ‰€éœ€æ ¼å¼ã€‚\næ‰§è¡Œmkdir æŒ‚è½½ç›®å½• =\u0026gt; mkdir /mnt/sdc å‘½ä»¤ï¼Œæ–°å»ºæŒ‚è½½ç›®å½•ã€‚\næ‰§è¡Œmount /dev/vdb1 /mnt/sdcå‘½ä»¤ï¼Œå°†æ–°å»ºåˆ†åŒºæŒ‚è½½åˆ°12ä¸­åˆ›å»ºçš„ç›®å½•ä¸‹\næŸ¥çœ‹æŒ‚è½½ç»“æœ df -TH\n1 2 3 4 5 6 7 8 9 [root@ecs-test-0001 ~]# df -TH Filesystem Type Size Used Avail Use% Mounted on /dev/vda1 ext4 43G 1.9G 39G 5% / devtmpfs devtmpfs 2.0G 0 2.0G 0% /dev tmpfs tmpfs 2.0G 0 2.0G 0% /dev/shm tmpfs tmpfs 2.0G 9.1M 2.0G 1% /run tmpfs tmpfs 2.0G 0 2.0G 0% /sys/fs/cgroup tmpfs tmpfs 398M 0 398M 0% /run/user/0 /dev/vdb1 ext4 106G 63M 101G 1% /mnt/sdc è¡¨ç¤ºæ–°å»ºåˆ†åŒºâ€œ/dev/vdb1â€å·²æŒ‚è½½è‡³â€œ/mnt/sdcâ€ã€‚\nè®¾ç½®ç³»ç»Ÿç»™æœåŠ¡Systemd ä»¥å‰ä½¿ç”¨Ubuntuå’ŒCentOSï¼Œä¸€èˆ¬ä½¿ç”¨SysV initï¼ˆå°±æ˜¯ä»¥å‰ä½¿ç”¨çš„serviceï¼‰è¿›è¡Œè¿›ç¨‹çš„å¼€æœºè‡ªå¯å’Œè¿›ç¨‹å®ˆæŠ¤ã€‚ ä½†æ˜¯ï¼Œç°åœ¨æ›´å¤šåœ°ä½¿ç”¨systemdæ¥å®ç°è¿›ç¨‹çš„ç®¡ç†ã€‚\nSystemd Systemdï¼ˆç³»ç»Ÿç®¡ç†å®ˆæŠ¤è¿›ç¨‹ï¼‰ï¼Œæœ€å¼€å§‹ä»¥GNU GPLåè®®æˆæƒå¼€å‘ï¼Œç°åœ¨å·²è½¬ä¸ºä½¿ç”¨GNU LGPLåè®®ã€‚å­—æ¯dæ˜¯daemonçš„ç¼©å†™ å®ƒå–æ›¿å¹¶å…¼å®¹ä¼ ç»Ÿçš„SysV initã€‚äº‹å®ä¸Šï¼ŒCentOSå’ŒDebianï¼Œç°åœ¨é»˜è®¤éƒ½æ˜¯ä½¿ç”¨Systemdï¼š\nCentOS 7å¼€å§‹é¢„è®¾å¹¶ä½¿ç”¨Systemd Ubuntu 15.04å¼€å§‹å¹¶é¢„è®¾ä½¿ç”¨Systemd\nä½¿ç”¨Systemdçš„ä¼˜ç‚¹ï¼š\næŒ‰éœ€å¯åŠ¨è¿›ç¨‹ï¼Œå‡å°‘ç³»ç»Ÿèµ„æºæ¶ˆè€— å¹¶è¡Œå¯åŠ¨è¿›ç¨‹ï¼Œæé«˜ç³»ç»Ÿå¯åŠ¨é€Ÿåº¦ æŸ¥çœ‹systemdå’Œsystemctlç¨‹åºç›¸å…³çš„ç›®å½•ï¼š\n1 2 3 4 [root@nebula3-01 node_exporter]# whereis systemd systemd: /usr/lib/systemd /etc/systemd /usr/share/systemd /usr/share/man/man1/systemd.1.gz [root@nebula3-01 node_exporter]# whereis systemctl systemctl: /usr/bin/systemctl /usr/share/man/man1/systemctl.1.gz Systemctl Unit Systemdå¼•å…¥äº†ä¸€ä¸ªæ ¸å¿ƒé…ç½®ï¼šUnitï¼ˆå•å…ƒé…ç½®ï¼‰ã€‚äº‹å®ä¸Šï¼ŒSystemdç®¡ç†çš„æ¯ä¸ªè¿›ç¨‹ï¼Œéƒ½æ˜¯ä¸€ä¸ªUnitã€‚ç›¸å½“äºä»»åŠ¡å—ã€‚ä¸€ä¸ªæœ‰12ç§æ¨¡å¼ï¼š\nService unitï¼šç³»ç»ŸæœåŠ¡ Target unitï¼šå¤šä¸ªUnitæ„æˆçš„ä¸€ä¸ªç»„ Device Unitï¼šç¡¬ä»¶è®¾å¤‡ Mount Unitï¼šæ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½ç‚¹ Automount Unitï¼šè‡ªåŠ¨æŒ‚è½½ç‚¹ Path Unitï¼šæ–‡ä»¶æˆ–è·¯å¾„ Scope Unitï¼šä¸æ˜¯ç”± Systemd å¯åŠ¨çš„å¤–éƒ¨è¿›ç¨‹ Slice Unitï¼šè¿›ç¨‹ç»„ Snapshot Unitï¼šSystemd å¿«ç…§ï¼Œå¯ä»¥åˆ‡å›æŸä¸ªå¿«ç…§ Socket Unitï¼šè¿›ç¨‹é—´é€šä¿¡çš„ socket Swap Unitï¼šswap æ–‡ä»¶ Timer Unitï¼šå®šæ—¶å™¨ åˆ›å»ºé…ç½®æ–‡ä»¶ å¦‚æœæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªUnitæœåŠ¡ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•åˆ›å»ºé…ç½®æ–‡ä»¶å‘¢ï¼Ÿ æˆ‘ä»¬è‡ªå·±é…ç½®UnitæœåŠ¡ï¼ˆåç»­ä½¿ç”¨Systemctlè¿›è¡Œå¯åŠ¨å’Œç®¡ç†ï¼‰ï¼Œå¯ä»¥é…ç½®åˆ°ï¼š\n/usr/lib/systemd/system/ï¼šæ¨èåœ°å€ã€‚ /run/systemd/system/ï¼šç³»ç»Ÿæ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€äº§ç”Ÿçš„æœåŠ¡è„šæœ¬,è¿™äº›è„šæœ¬çš„ä¼˜å…ˆçº§æ¯”ä¸Šé¢çš„é«˜ã€‚ /etc/systemd/system/ï¼šç®¡ç†å‘˜æ ¹æ®ä¸»æœºç³»ç»Ÿçš„éœ€æ±‚æ‰€å»ºç«‹çš„æ‰§è¡Œè„šæœ¬ï¼Œä¼˜å…ˆçº§æ¯”ä¸Šé¢çš„é«˜ã€‚ åˆ›å»ºç¼–å†™é…ç½®æ–‡ä»¶ vim /usr/lib/systemd/system/node_exporter.service æ–°å¢\n1 2 3 4 5 6 7 8 9 10 11 12 [Unit] Description=node_exporter After=network.target [Service] User=root Type=simple ExecStart=/root/node_exporter/node_exporter PrivateTmp=true [Install] WantedBy=multi-user.target ä¸€äº›è§£é‡Š:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 - Unit - Descriptionï¼ŒæœåŠ¡çš„æè¿° - Documentationï¼Œæ–‡æ¡£ä»‹ç» - Afterï¼Œè¯¥æœåŠ¡è¦åœ¨ä»€ä¹ˆæœåŠ¡å¯åŠ¨ä¹‹åå¯åŠ¨ï¼Œæ¯”å¦‚Mysqléœ€è¦åœ¨networkå’Œsyslogå¯åŠ¨ä¹‹åå†å¯åŠ¨ - Install - WantedByï¼Œå€¼æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªTargetï¼Œå½“å‰Unitæ¿€æ´»æ—¶(enable)ç¬¦å·é“¾æ¥ä¼šæ”¾å…¥/etc/systemd/systemç›®å½•ä¸‹é¢ä»¥Targetå+.wantsåç¼€æ„æˆçš„å­ç›®å½•ä¸­ - RequiredByï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªTargetï¼Œå½“å‰Unitæ¿€æ´»(enable)æ—¶ï¼Œç¬¦å·é“¾æ¥ä¼šæ”¾å…¥/etc/systemd/systemç›®å½•ä¸‹é¢ä»¥Targetå+.requiredåç¼€æ„æˆçš„å­ç›®å½•ä¸­ - Aliasï¼Œå½“å‰Unitå¯ç”¨äºå¯åŠ¨çš„åˆ«å - Alsoï¼Œå½“å‰Unitæ¿€æ´»(enable)æ—¶ï¼Œä¼šè¢«åŒæ—¶æ¿€æ´»çš„å…¶ä»–Unit - Service - Typeï¼Œå®šä¹‰å¯åŠ¨æ—¶çš„è¿›ç¨‹è¡Œä¸ºã€‚å®ƒæœ‰ä»¥ä¸‹å‡ ç§å€¼ã€‚ - Type=simpleï¼Œé»˜è®¤å€¼ï¼Œæ‰§è¡ŒExecStartæŒ‡å®šçš„å‘½ä»¤ï¼Œå¯åŠ¨ä¸»è¿›ç¨‹ - Type=forkingï¼Œä»¥ fork æ–¹å¼ä»çˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹ï¼Œåˆ›å»ºåçˆ¶è¿›ç¨‹ä¼šç«‹å³é€€å‡º - Type=oneshotï¼Œä¸€æ¬¡æ€§è¿›ç¨‹ï¼ŒSystemd ä¼šç­‰å½“å‰æœåŠ¡é€€å‡ºï¼Œå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œ - Type=dbusï¼Œå½“å‰æœåŠ¡é€šè¿‡D-Buså¯åŠ¨ - Type=notifyï¼Œå½“å‰æœåŠ¡å¯åŠ¨å®Œæ¯•ï¼Œä¼šé€šçŸ¥Systemdï¼Œå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œ - Type=idleï¼Œè‹¥æœ‰å…¶ä»–ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå½“å‰æœåŠ¡æ‰ä¼šè¿è¡Œ - ExecStartï¼Œå¯åŠ¨å½“å‰æœåŠ¡çš„å‘½ä»¤ - ExecStartPreï¼Œå¯åŠ¨å½“å‰æœåŠ¡ä¹‹å‰æ‰§è¡Œçš„å‘½ä»¤ - ExecStartPostï¼Œå¯åŠ¨å½“å‰æœåŠ¡ä¹‹åæ‰§è¡Œçš„å‘½ä»¤ - ExecReloadï¼Œé‡å¯å½“å‰æœåŠ¡æ—¶æ‰§è¡Œçš„å‘½ä»¤ - ExecStopï¼Œåœæ­¢å½“å‰æœåŠ¡æ—¶æ‰§è¡Œçš„å‘½ä»¤ - ExecStopPostï¼Œåœæ­¢å½“å…¶æœåŠ¡ä¹‹åæ‰§è¡Œçš„å‘½ä»¤ - RestartSecï¼Œè‡ªåŠ¨é‡å¯å½“å‰æœåŠ¡é—´éš”çš„ç§’æ•° - Restartï¼Œå®šä¹‰ä½•ç§æƒ…å†µ Systemd ä¼šè‡ªåŠ¨é‡å¯å½“å‰æœåŠ¡ï¼Œå¯èƒ½çš„å€¼åŒ…æ‹¬alwaysï¼ˆæ€»æ˜¯é‡å¯ï¼‰ã€on-successã€on-failureã€on-abnormalã€on-abortã€on-watchdog - TimeoutSecï¼Œå®šä¹‰ Systemd åœæ­¢å½“å‰æœåŠ¡ä¹‹å‰ç­‰å¾…çš„ç§’æ•° - Environmentï¼ŒæŒ‡å®šç¯å¢ƒå˜é‡ é‡è½½é…ç½® 1 systemctl daemon-reload å¯åŠ¨æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 root@nebula3-01 node_exporter]# systemctl daemon-reload [root@nebula3-01 node_exporter]# systemctl status node_exporter â— node_exporter.service - node_exporter Loaded: loaded (/usr/lib/systemd/system/node_exporter.service; disabled; vendor preset: disabled) Active: inactive (dead) [root@nebula3-01 node_exporter]# systemctl start node_exporter [root@nebula3-01 node_exporter]# systemctl status node_exporter â— node_exporter.service - node_exporter Loaded: loaded (/usr/lib/systemd/system/node_exporter.service; disabled; vendor preset: disabled) Active: active (running) since Thu 2023-03-02 14:04:43 CST; 2s ago Main PID: 15015 (node_exporter) CGroup: /system.slice/node_exporter.service â””â”€15015 /root/node_exporter/node_exporter Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.268Z caller=node_exporter.go:117 level=info collector=thermal_zone Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.268Z caller=node_exporter.go:117 level=info collector=time Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.268Z caller=node_exporter.go:117 level=info collector=timex Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.268Z caller=node_exporter.go:117 level=info collector=udp_queues Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.268Z caller=node_exporter.go:117 level=info collector=uname Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.268Z caller=node_exporter.go:117 level=info collector=vmstat Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.268Z caller=node_exporter.go:117 level=info collector=xfs Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.268Z caller=node_exporter.go:117 level=info collector=zfs Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.269Z caller=tls_config.go:232 level=info msg=\u0026#34;Listening on\u0026#34; address=[::]:9100 Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.269Z caller=tls_config.go:235 level=info msg=\u0026#34;TLS is disabled.\u0026#34; http2=false ...::]:9100 Hint: Some lines were ellipsized, use -l to show in full. å¼€æœºè‡ªå¯ 1 2 [root@nebula3-01 node_exporter]# systemctl enable node_exporter Created symlink from /etc/systemd/system/multi-user.target.wants/node_exporter.service to /usr/lib/systemd/system/node_exporter.service. æŸ¥çœ‹æ˜¯å¦å¼€æœºè‡ªå¯, æ¯”ä¸Šé¢å¤šäº† enabled; vendor preset: disabled\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 [root@nebula3-01 node_exporter]# systemctl status node_exporter â— node_exporter.service - node_exporter Loaded: loaded (/usr/lib/systemd/system/node_exporter.service; enabled; vendor preset: disabled) Active: active (running) since Thu 2023-03-02 14:04:43 CST; 11min ago Main PID: 15015 (node_exporter) CGroup: /system.slice/node_exporter.service â””â”€15015 /root/node_exporter/node_exporter Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.268Z caller=node_exporter.go:117 level=info collector=thermal_zone Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.268Z caller=node_exporter.go:117 level=info collector=time Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.268Z caller=node_exporter.go:117 level=info collector=timex Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.268Z caller=node_exporter.go:117 level=info collector=udp_queues Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.268Z caller=node_exporter.go:117 level=info collector=uname Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.268Z caller=node_exporter.go:117 level=info collector=vmstat Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.268Z caller=node_exporter.go:117 level=info collector=xfs Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.268Z caller=node_exporter.go:117 level=info collector=zfs Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.269Z caller=tls_config.go:232 level=info msg=\u0026#34;Listening on\u0026#34; address=[::]:9100 Mar 02 14:04:43 nebula3-01 node_exporter[15015]: ts=2023-03-02T06:04:43.269Z caller=tls_config.go:235 level=info msg=\u0026#34;TLS is disabled.\u0026#34; http2=false ...::]:9100 Hint: Some lines were ellipsized, use -l to show in full. æŸ¥çœ‹Systemd æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 [root@nebula3-01 node_exporter]# systemctl UNIT LOAD ACTIVE SUB DESCRIPTION proc-sys-fs-binfmt_misc.automount loaded active running Arbitrary Executable File Formats File System Automount Point sys-devices-pci0000:00-0000:00:03.0-virtio0-net-eth0.device loaded active plugged Virtio network device sys-devices-pci0000:00-0000:00:04.0-virtio1-virtio\\x2dports-vport1p1.device loaded active plugged /sys/devices/pci0000:00/0000:00:04.0/virtio1/virtio-ports/v sys-devices-pci0000:00-0000:00:05.0-virtio2-block-vda-vda1.device loaded active plugged /sys/devices/pci0000:00/0000:00:05.0/virtio2/block/vda/vda1 sys-devices-pci0000:00-0000:00:05.0-virtio2-block-vda-vda2.device loaded active plugged /sys/devices/pci0000:00/0000:00:05.0/virtio2/block/vda/vda2 sys-devices-pci0000:00-0000:00:05.0-virtio2-block-vda.device loaded active plugged /sys/devices/pci0000:00/0000:00:05.0/virtio2/block/vda sys-devices-platform-serial8250-tty-ttyS1.device loaded active plugged /sys/devices/platform/serial8250/tty/ttyS1 sys-devices-platform-serial8250-tty-ttyS2.device loaded active plugged /sys/devices/platform/serial8250/tty/ttyS2 sys-devices-platform-serial8250-tty-ttyS3.device loaded active plugged /sys/devices/platform/serial8250/tty/ttyS3 sys-devices-pnp0-00:00-tty-ttyS0.device loaded active plugged /sys/devices/pnp0/00:00/tty/ttyS0 sys-module-configfs.device loaded active plugged /sys/module/configfs sys-subsystem-net-devices-eth0.device loaded active plugged Virtio network device -.mount loaded active mounted / boot.mount loaded active mounted /boot dev-hugepages.mount loaded active mounted Huge Pages File System dev-mqueue.mount loaded active mounted POSIX Message Queue File System ... ä½ å¯ä»¥é…åˆgrepå‘½ä»¤æ“ä½œ\n1 2 3 [root@nebula3-01 node_exporter]# systemctl | grep node kmod-static-nodes.service loaded active exited Create list of required static device nodes for the current kernel node_exporter.service loaded active running node_exporter æŸ¥çœ‹Linux çš„åŸºæœ¬ä¿¡æ¯ ç¡¬ä»¶ uname -a æŸ¥çœ‹å†…æ ¸/æ“ä½œç³»ç»Ÿ/CPUä¿¡æ¯ head -n 1 /etc/issue æŸ¥çœ‹æ“ä½œç³»ç»Ÿç‰ˆæœ¬ cat /proc/cpuinfo æŸ¥çœ‹CPUä¿¡æ¯ hostname æŸ¥çœ‹è®¡ç®—æœºå lspci -tv åˆ—å‡ºæ‰€æœ‰PCIè®¾å¤‡ lsusb -tv åˆ—å‡ºæ‰€æœ‰USBè®¾å¤‡ lsmod åˆ—å‡ºåŠ è½½çš„å†…æ ¸æ¨¡å— env æŸ¥çœ‹ç¯å¢ƒå˜é‡ èµ„æº free -m æŸ¥çœ‹å†…å­˜ä½¿ç”¨é‡å’Œäº¤æ¢åŒºä½¿ç”¨é‡ df -h æŸ¥çœ‹å„åˆ†åŒºä½¿ç”¨æƒ…å†µ du -sh \u0026lt;ç›®å½•å\u0026gt; æŸ¥çœ‹æŒ‡å®šç›®å½•çš„å¤§å° grep MemTotal /proc/meminfo æŸ¥çœ‹å†…å­˜æ€»é‡ grep MemFree /proc/meminfo `æŸ¥çœ‹ç©ºé—²å†…å­˜é‡ uptime æŸ¥çœ‹ç³»ç»Ÿè¿è¡Œæ—¶é—´ã€ç”¨æˆ·æ•°ã€è´Ÿè½½ cat /proc/loadavg æŸ¥çœ‹ç³»ç»Ÿè´Ÿè½½ ç£ç›˜å’Œåˆ†åŒº mount | column -t æŸ¥çœ‹æŒ‚æ¥çš„åˆ†åŒºçŠ¶æ€` fdisk -l æŸ¥çœ‹æ‰€æœ‰åˆ†åŒºï¼Œæ‰‡åŒºå¤§å° swapon -s æŸ¥çœ‹æ‰€æœ‰äº¤æ¢åˆ†åŒº hdparm -i /dev/hda æŸ¥çœ‹ç£ç›˜å‚æ•°ï¼ˆä»…é€‚ç”¨äºIDEè®¾å¤‡ï¼‰ dmesg | grep IDE æŸ¥çœ‹å¯åŠ¨æ—¶IDEè®¾å¤‡æ£€æµ‹çŠ¶å†µ stat /boot/ æŸ¥çœ‹ç¡¬ç›˜å—æƒ…å†µï¼Œå—å¤§å° getconf PAGE_SIZE æŸ¥çœ‹é¡µå¤§å° ç½‘ç»œ ifconfig æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œæ¥å£çš„å±æ€§ iptables -L æŸ¥çœ‹é˜²ç«å¢™è®¾ç½® route -n æŸ¥çœ‹è·¯ç”±è¡¨ netstat -lntp æŸ¥çœ‹æ‰€æœ‰ç›‘å¬ç«¯å£ netstat -antp æŸ¥çœ‹æ‰€æœ‰å·²ç»å»ºç«‹çš„è¿æ¥ netstat -s æŸ¥çœ‹ç½‘ç»œç»Ÿè®¡ä¿¡æ¯ è¿›ç¨‹ ps -ef æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹ top å®æ—¶æ˜¾ç¤ºè¿›ç¨‹çŠ¶æ€ ç”¨æˆ· w æŸ¥çœ‹æ´»åŠ¨ç”¨æˆ· id \u0026lt;ç”¨æˆ·å\u0026gt; æŸ¥çœ‹æŒ‡å®šç”¨æˆ·ä¿¡æ¯ last æŸ¥çœ‹ç”¨æˆ·ç™»å½•æ—¥å¿— cut -d: -f1 /etc/passwd æŸ¥çœ‹ç³»ç»Ÿæ‰€æœ‰ç”¨æˆ· cut -d: -f1 /etc/group æŸ¥çœ‹ç³»ç»Ÿæ‰€æœ‰ç»„ crontab -l æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„è®¡åˆ’ä»»åŠ¡ æœåŠ¡ chkconfig --list åˆ—å‡ºæ‰€æœ‰ç³»ç»ŸæœåŠ¡ chkconfig --list | grep on åˆ—å‡ºæ‰€æœ‰å¯åŠ¨çš„ç³»ç»ŸæœåŠ¡ ç¨‹åº rpm -qa æŸ¥çœ‹æ‰€æœ‰å®‰è£…çš„è½¯ä»¶åŒ… å®‰è£…Golang, Minicoda, Git Golang ä¸‹è½½åˆé€‚çš„ç‰ˆæœ¬ è¾“å…¥tar -C /usr/local/ -xzf go1.20.2.linux-amd64.tar.gz è§£å‹åˆ°åˆé€‚çš„ä½ç½®ï¼Œ -C æŒ‡å®šä½ç½® è®¾ç½®GOPATH echo $PATH å…ˆæŸ¥çœ‹$PATH ç”¨vim æˆ–è€…å…¶ä»–å·¥å…·æ‰“å¼€$HOME/.profile, è¾“å…¥export PATH=$PATH:/usr/local/go/bin è¾“å…¥ source $HOME/.profile æ˜¯ä¸Šé¢profile ç”Ÿæ•ˆ è¾“å…¥ go version æ£€æŸ¥æ˜¯å¦æˆåŠŸ ä¿®æ”¹go proxy ä¸ºåŠŸèƒ½é•œåƒ go env -w GOPROXY=https://goproxy.cn,direct è¾“å…¥ go env ç¡®è®¤ GOPROXY Minicode ä»æ­¤å¤„ä¸‹è½½Minicoda run bash Miniconda3-latest-Linux-x86_64.sh æ ¹æ®æç¤ºå®‰è£…ï¼Œå¯ä»¥éƒ½é€‰æ‹©é»˜è®¤ ä¸ºäº†ä½¿é…ç½®ç”Ÿæ•ˆï¼Œå…³é—­Terminal é‡æ–°æ‰“å¼€ è¾“å…¥conda list æˆ–è€… æœºå™¨åå‰é¢æœ‰ä¸ªbase æ„å‘³ç€Terminal è¾“å…¥python é»˜è®¤ä¸ºPython3ï¼Œæƒ³è¦ä½¿ç”¨Python2ï¼Œ è¾“å…¥Python2 å³å¯ å¦‚æœconda æ²¡æœ‰è¢«è¯†åˆ«ï¼Œéœ€è¦æŠŠconda åŠ å…¥ç¯å¢ƒå˜é‡ã€‚ 1 2 3 4 vim /etc/profile # è¾“å…¥ åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä¸€è¡Œï¼šexport PATH=/root/miniconda3/bin:$PATHï¼Œ /root/miniconda3 æ˜¯miniconda å®‰è£…çš„è·¯å¾„ # :wq ä¿å­˜é€€å‡ºã€‚ç„¶å source /etc/profile æ¿€æ´»é…ç½® Git é¦–å…ˆï¼ŒæŠŠè€ç‰ˆæœ¬çš„ Git å¸æ‰ã€‚ 1 2 sudo yum -y remove git sudo yum -y remove git-* æ·»åŠ  End Point åˆ° CentOS 7 ä»“åº“ yum -y install https://packages.endpointdev.com/rhel/7/os/x86_64/endpoint-repo.x86_64.rpm yum -y install git check version git version é…ç½®Git Set your name. git config --global user.name \u0026quot;Your Name\u0026quot; Set your email address. git config --global user.email \u0026quot;user@exmample.com\u0026quot; Verify the settings. git config --list ","permalink":"https://reid00.github.io/en/posts/langs_linux/linux-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%99%BB%E5%BD%95%E5%90%8E%E7%9A%84%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C/","summary":"Linuxä¿®æ”¹ä¸»æœºåä¿®æ”¹hostnameçš„æ–¹æ³• ä¸´æ—¶ä¿®æ”¹Linuxä¸»æœºåçš„æ–¹æ³• hostname newname æ‰§è¡Œå‘½ä»¤åå‘ç°æ²¡æœ‰å˜åŒ–ã€‚é‡æ–°å¼€ç»ˆç«¯å³å¯æ˜¾ç¤ºï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡uname -nå‘½ä»¤æ¥æŸ¥çœ‹å½“å‰çš„ä¸»æœºåã€‚\næ°¸ä¹…ä¿®æ”¹Linuxä¸»æœºåçš„æ–¹æ³•\nä½¿ç”¨ hostnamectl æ¥æ”¹å˜ä¸»æœºåç§° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 [root@nebula3-01 ~]# hostnamectl Static hostname: nebula3-01 Icon name: computer-vm Chassis: vm Machine ID: 1d8987d66da0c7cd7960ca4e5aefe30f Boot ID: 717058195e934eb88f4631adf25ab163 Virtualization: kvm Operating System: CentOS Linux 7 (Core) CPE OS Name: cpe:/o:centos:centos:7 Kernel: Linux 3.10.0-1160.el7.x86_64 Architecture: x86-64 [root@nebula-test02 ~]# hostnamectl set-hostname nebula3-02 [root@nebula-test02 ~]# hostnamectl Static hostname: nebula3-02 Icon name: computer-vm Chassis: vm Machine ID: 1d8987d66da0c7cd7960ca4e5aefe30f Boot ID: 6b836dcf9c274ef48f334e6b53f8e296 Virtualization: kvm Operating System: CentOS Linux 7 (Core) CPE OS Name: cpe:/o:centos:centos:7 Kernel: Linux 3.","title":"Linux æœåŠ¡å™¨ç™»å½•åçš„å¸¸è§æ“ä½œ"},{"content":"ShardedKV ä»‹ç» æœ‰å…³ shardkvï¼Œå…¶å¯ä»¥ç®—æ˜¯ä¸€ä¸ª multi-raft çš„å®ç°ï¼Œåªæ˜¯ç¼ºå°‘äº†ç‰©ç†èŠ‚ç‚¹çš„æŠ½è±¡æ¦‚å¿µã€‚åœ¨å®é™…çš„ç”Ÿäº§ç³»ç»Ÿä¸­ï¼Œä¸åŒ raft ç»„çš„æˆå‘˜å¯èƒ½å­˜åœ¨äºä¸€ä¸ªç‰©ç†èŠ‚ç‚¹ä¸Šï¼Œè€Œä¸”ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯ä¸€ä¸ªç‰©ç†èŠ‚ç‚¹æ‹¥æœ‰ä¸€ä¸ªçŠ¶æ€æœºï¼Œä¸åŒ raft ç»„ä½¿ç”¨ä¸åŒåœ°å‘½åç©ºé—´æˆ–å‰ç¼€æ¥æ“ä½œåŒä¸€ä¸ªçŠ¶æ€æœºã€‚åŸºäºæ­¤ï¼Œä¸‹æ–‡æ‰€æåˆ°çš„çš„èŠ‚ç‚¹éƒ½ä»£æŒ‡ raft ç»„çš„æŸä¸ªæˆå‘˜ï¼Œè€Œä¸ä»£æŒ‡æŸä¸ªç‰©ç†èŠ‚ç‚¹ã€‚æ¯”å¦‚èŠ‚ç‚¹å®•æœºä»£æŒ‡ raft ç»„çš„æŸä¸ªæˆå‘˜è¢« kill æ‰ï¼Œè€Œä¸æ˜¯æŒ‡æŸä¸ªç‰©ç†èŠ‚ç‚¹å®•æœºï¼Œä»è€Œå¯èƒ½å½±å“å¤šä¸ª raft çš„æˆå‘˜ã€‚\nåœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªå¸¦åˆ†ç‰‡çš„KVå­˜å‚¨ç³»ç»Ÿï¼Œå³ä¸€ç»„å‰¯æœ¬ç»„ä¸Šçš„é”®ã€‚æ¯ä¸€ä¸ªåˆ†ç‰‡éƒ½æ˜¯KVå¯¹çš„å­é›†ï¼Œä¾‹å¦‚ï¼Œæ‰€æœ‰ä»¥â€œaâ€å¼€å¤´çš„é”®å¯èƒ½æ˜¯ä¸€ä¸ªåˆ†ç‰‡ï¼Œæ‰€æœ‰ä»¥â€œbâ€å¼€å¤´çš„é”®å¯èƒ½æ˜¯å¦ä¸€ä¸ªåˆ†ç‰‡ã€‚ ä¹Ÿå¯ä»¥ç”¨range æˆ–è€…Hash ä¹‹ååˆ†åŒºã€‚ åˆ†ç‰‡çš„åŸå› æ˜¯æ€§èƒ½ã€‚æ¯ä¸ªreplica groupåªå¤„ç†å‡ ä¸ªåˆ†ç‰‡çš„ put å’Œ getï¼Œå¹¶ä¸”è¿™äº›ç»„å¹¶è¡Œæ“ä½œï¼›å› æ­¤ï¼Œç³»ç»Ÿæ€»ååé‡ï¼ˆæ¯å•ä½æ—¶é—´çš„æŠ•å…¥å’Œè·å–ï¼‰ä¸ç»„æ•°æˆæ¯”ä¾‹å¢åŠ ã€‚\næˆ‘ä»¬çš„æ•´ä¸ªç³»ç»Ÿæœ‰ä¸¤ä¸ªåŸºæœ¬ç»„ä»¶ï¼šshard controller å’Œ shard groupã€‚æ•´ä¸ªç³»ç»Ÿæœ‰ä¸€ä¸ª controller å’Œå¤šä¸ª groupï¼Œcontroller å•ç‹¬ä¸€ä¸ª raft é›†ç¾¤ï¼Œæ¯ä¸€ä¸ª shard group æ˜¯ç”± kvraft å®ä¾‹æ„æˆçš„é›†ç¾¤ã€‚shard controller è´Ÿè´£è°ƒåº¦ï¼Œå®¢æˆ·ç«¯å‘ shard controller å‘é€è¯·æ±‚ï¼Œcontroller ä¼šæ ¹æ®é…ç½®(config)æ¥å‘ŠçŸ¥å®¢æˆ·ç«¯æœåŠ¡è¿™ä¸ª key çš„æ˜¯å“ªä¸ª groupã€‚ æ¯ä¸ª group è´Ÿè´£éƒ¨åˆ† shardã€‚\n1 2 3 4 5 type Config struct { Num int // config number, version also Shards [NShards]int // shard -\u0026gt; gid Groups map[int][]string // gid -\u0026gt; servers[] } ä¸‰ä¸ªå‚æ•°åˆ†åˆ«å¯¹åº”çš„ç‰ˆæœ¬çš„é…ç½®å·ï¼Œåˆ†ç‰‡æ‰€å¯¹åº”çš„ç»„(Group)ä¿¡æ¯ï¼ˆå®éªŒä¸­çš„åˆ†ç‰‡ä¸º10ä¸ªï¼‰ï¼Œæ¯ä¸ªç»„å¯¹åº”çš„æœåŠ¡å™¨æ˜ å°„åç§°åˆ—è¡¨ï¼ˆä¹Ÿå°±æ˜¯ç»„ä¿¡æ¯ï¼‰ã€‚\nGroupè¡¨ç¤ºä¸€ä¸ªLeader-Followersé›†ç¾¤ï¼ŒGidä¸ºå®ƒçš„æ ‡è¯†ï¼ŒShardè¡¨ç¤ºæ‰€æœ‰æ•°æ®çš„ä¸€ä¸ªå­é›†ï¼ŒConfigè¡¨ç¤ºä¸€ä¸ªåˆ’åˆ†æ–¹æ¡ˆã€‚æ­¤æ¬¡å®éªŒä¸­ï¼Œæ‰€æœ‰æ•°æ®åˆ†ä¸ºNShards = 10ä»½ï¼ŒServerç»™æµ‹è¯•ç¨‹åºæä¾›å››ä¸ªæ¥å£ã€‚ ä¸‹å›¾ä¸­æ¯ä¸ªShard éƒ½æœ‰å…¶ä»–å¯¹åº”çš„å‰¯æœ¬æœªç”»å‡ºã€‚å¯¹Client ä»¥Group ä¸ºå•ä½è¿›è¡ŒæœåŠ¡ã€‚ç›¸å½“äºä¸€ä¸ªç‰©ç†èŠ‚ç‚¹ä¸Š æœ‰è‹¥å¹²ä¸ªGroup å¯ä»¥å¯¹å¤–æœåŠ¡ã€‚\nåˆ†ç‰‡å­˜å‚¨ç³»ç»Ÿå¿…é¡»èƒ½å¤Ÿåœ¨replica groupä¹‹é—´ç§»åŠ¨åˆ†ç‰‡ï¼Œå› ä¸ºæŸäº›ç»„å¯èƒ½æ¯”å…¶ä»–ç»„è´Ÿè½½æ›´å¤šï¼Œå› æ­¤éœ€è¦ç§»åŠ¨åˆ†ç‰‡ä»¥å¹³è¡¡è´Ÿè½½ï¼›è€Œä¸”replica groupå¯èƒ½ä¼šåŠ å…¥å’Œç¦»å¼€ç³»ç»Ÿï¼Œå¯èƒ½ä¼šæ·»åŠ æ–°çš„å‰¯æœ¬ç»„ä»¥å¢åŠ å®¹é‡ï¼Œæˆ–è€…å¯èƒ½ä¼šä½¿ç°æœ‰çš„å‰¯æœ¬ç»„è„±æœºä»¥è¿›è¡Œä¿®å¤æˆ–æŠ¥åºŸã€‚\nLab4A å®ç° æœ¬å®éªŒçš„ä¸»è¦æŒ‘æˆ˜æ˜¯å¤„ç†é‡æ–°é…ç½®â€”â€”ç§»åŠ¨åˆ†ç‰‡æ‰€å±ã€‚åœ¨å•ä¸ªå‰¯æœ¬ç»„ä¸­ï¼Œæ‰€æœ‰ç»„æˆå‘˜å¿…é¡»å°±ä½•æ—¶å‘ç”Ÿä¸å®¢æˆ·ç«¯ Put/Append/Get è¯·æ±‚ç›¸å…³çš„é‡æ–°é…ç½®è¾¾æˆä¸€è‡´ã€‚ä¾‹å¦‚ï¼ŒPut å¯èƒ½ä¸é‡æ–°é…ç½®å¤§çº¦åŒæ—¶åˆ°è¾¾ï¼Œå¯¼è‡´å‰¯æœ¬ç»„åœæ­¢å¯¹è¯¥PutåŒ…å«çš„keyçš„åˆ†ç‰‡è´Ÿè´£ã€‚ç»„ä¸­çš„æ‰€æœ‰å‰¯æœ¬å¿…é¡»å°± Put å‘ç”Ÿåœ¨é‡æ–°é…ç½®ä¹‹å‰è¿˜æ˜¯ä¹‹åè¾¾æˆä¸€è‡´ã€‚å¦‚æœä¹‹å‰ï¼ŒPut åº”è¯¥ç”Ÿæ•ˆï¼Œåˆ†ç‰‡çš„æ–°æ‰€æœ‰è€…å°†çœ‹åˆ°å®ƒçš„æ•ˆæœï¼›å¦‚æœä¹‹åï¼ŒPut å°†ä¸ä¼šç”Ÿæ•ˆï¼Œå®¢æˆ·ç«¯å¿…é¡»åœ¨æ–°æ‰€æœ‰è€…å¤„é‡æ–°å°è¯•ã€‚æ¨èçš„æ–¹æ³•æ˜¯è®©æ¯ä¸ªå‰¯æœ¬ç»„ä½¿ç”¨ Raft ä¸ä»…è®°å½• Putsã€Appends å’Œ Gets çš„é¡ºåºï¼Œè¿˜è®°å½•é‡æ–°é…ç½®çš„é¡ºåºã€‚æ‚¨éœ€è¦ç¡®ä¿åœ¨ä»»ä½•æ—¶å€™æœ€å¤šæœ‰ä¸€ä¸ªå‰¯æœ¬ç»„ä¸ºæ¯ä¸ªåˆ†ç‰‡æä¾›è¯·æ±‚ã€‚\né‡æ–°é…ç½®è¿˜éœ€è¦å‰¯æœ¬ç»„ä¹‹é—´çš„äº¤äº’ã€‚ä¾‹å¦‚ï¼Œåœ¨é…ç½® 10 ä¸­ï¼Œç»„ G1 å¯èƒ½è´Ÿè´£åˆ†ç‰‡ S1ã€‚åœ¨é…ç½® 11 ä¸­ï¼Œç»„ G2 å¯èƒ½è´Ÿè´£åˆ†ç‰‡ S1ã€‚åœ¨ä» 10 åˆ° 11 çš„é‡æ–°é…ç½®è¿‡ç¨‹ä¸­ï¼ŒG1 å’Œ G2 å¿…é¡»ä½¿ç”¨ RPC å°†åˆ†ç‰‡ S1ï¼ˆé”®/å€¼å¯¹ï¼‰çš„å†…å®¹ä» G1 ç§»åŠ¨åˆ° G2ã€‚\nLab4çš„å†…å®¹å°±æ˜¯å°†æ•°æ®æŒ‰ç…§æŸç§æ–¹å¼åˆ†å¼€å­˜å‚¨åˆ°ä¸åŒçš„RAFTé›†ç¾¤(Group)ä¸Šçš„åˆ†ç‰‡(shard)ä¸Šã€‚ä¿è¯ç›¸åº”æ•°æ®è¯·æ±‚å¼•æµåˆ°å¯¹åº”çš„é›†ç¾¤ï¼Œé™ä½å•ä¸€é›†ç¾¤çš„å‹åŠ›ï¼Œæä¾›æ›´ä¸ºé«˜æ•ˆã€æ›´ä¸ºå¥å£®çš„æœåŠ¡ã€‚ å…·ä½“çš„lab4è¦å®ç°ä¸€ä¸ªæ”¯æŒ multi-raftåˆ†ç‰‡ ã€åˆ†ç‰‡æ•°æ®åŠ¨æ€è¿ç§»çš„çº¿æ€§ä¸€è‡´æ€§åˆ†å¸ƒå¼ KV å­˜å‚¨æœåŠ¡ã€‚ shardè¡¨ç¤ºäº’ä¸ç›¸äº¤å¹¶ä¸”ç»„æˆå®Œæ•´æ•°æ®åº“çš„æ¯ä¸€ä¸ªæ•°æ®åº“å­é›†ã€‚groupè¡¨ç¤ºshardçš„é›†åˆï¼ŒåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªshardã€‚ä¸€ä¸ªshardåªå¯å±äºä¸€ä¸ªgroupï¼Œä¸€ä¸ªgroupå¯åŒ…å«(ç®¡ç†)å¤šä¸ªshardã€‚ lab4Aå®ç°ShardCtrleræœåŠ¡ï¼Œä½œç”¨ï¼šæä¾›é«˜å¯ç”¨çš„é›†ç¾¤é…ç½®ç®¡ç†æœåŠ¡ï¼Œå®ç°åˆ†ç‰‡çš„è´Ÿè½½å‡è¡¡ï¼Œå¹¶å°½å¯èƒ½å°‘åœ°ç§»åŠ¨åˆ†ç‰‡ã€‚è®°å½•äº†æ¯ç»„ï¼ˆGroupï¼‰ ShardKVServer çš„é›†ç¾¤ä¿¡æ¯å’Œæ¯ä¸ªåˆ†ç‰‡ï¼ˆshardï¼‰æœåŠ¡äºå“ªç»„ï¼ˆGroupï¼‰ShardKVServerã€‚ å…·ä½“å®ç°é€šè¿‡Raftç»´æŠ¤ ä¸€ä¸ªConfigsæ•°ç»„ï¼Œå•ä¸ªconfigå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š Numï¼šconfig numberï¼ŒNum=0è¡¨ç¤ºconfigurationæ— æ•ˆï¼Œè¾¹ç•Œæ¡ä»¶ï¼Œ å³æ˜¯version çš„ä½œç”¨ Shardsï¼šshard -\u0026gt; gidï¼Œåˆ†ç‰‡ä½ç½®ä¿¡æ¯ï¼ŒShards[3]=2ï¼Œè¯´æ˜åˆ†ç‰‡åºå·ä¸º3çš„åˆ†ç‰‡è´Ÿè´µçš„é›†ç¾¤æ˜¯Group2ï¼ˆgid=2ï¼‰ Groupsï¼šgid -\u0026gt; servers[], é›†ç¾¤æˆå‘˜ä¿¡æ¯ï¼ŒGroup[3]=[\u0026lsquo;server1\u0026rsquo;,\u0026lsquo;server2\u0026rsquo;],è¯´æ˜gid = 3çš„é›†ç¾¤Group3åŒ…å«ä¸¤å°åç§°ä¸ºserver1 \u0026amp; server2çš„æœºå™¨ RPC Query RPCã€‚æŸ¥è¯¢é…ç½®ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªé…ç½®å·ï¼Œ shardctrler å›å¤å…·æœ‰è¯¥ç¼–å·çš„é…ç½®ã€‚å¦‚æœè¯¥æ•°å­—ä¸º -1 æˆ–å¤§äºå·²çŸ¥çš„æœ€å¤§é…ç½®æ•°å­—ï¼Œåˆ™ shardctrler åº”å›å¤æœ€æ–°é…ç½®ã€‚ Query(-1) çš„ç»“æœåº”è¯¥åæ˜  shardctrler åœ¨æ”¶åˆ° Query(-1) RPC ä¹‹å‰å®Œæˆå¤„ç†çš„æ¯ä¸ª Joinã€Leave æˆ– Move RPCï¼›\nJoin RPC ã€‚æ·»åŠ æ–°çš„replica groupï¼Œå®ƒçš„å‚æ•°æ˜¯ä¸€ç»„ä»å”¯ä¸€çš„éé›¶å‰¯æœ¬ç»„æ ‡è¯†ç¬¦ (GID) åˆ°æœåŠ¡å™¨åç§°åˆ—è¡¨çš„æ˜ å°„ã€‚ shardctrler åº”è¯¥é€šè¿‡åˆ›å»ºä¸€ä¸ªåŒ…å«æ–°å‰¯æœ¬ç»„çš„æ–°é…ç½®æ¥åšå‡ºååº”ã€‚æ–°é…ç½®åº”åœ¨æ‰€æœ‰ç»„ä¸­å°½å¯èƒ½å‡åŒ€åœ°åˆ†é…åˆ†ç‰‡ï¼Œå¹¶åº”ç§»åŠ¨å°½å¯èƒ½å°‘çš„åˆ†ç‰‡ä»¥å®ç°è¯¥ç›®æ ‡ã€‚å¦‚æœ GID ä¸æ˜¯å½“å‰é…ç½®çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™ shardctrler åº”è¯¥å…è®¸é‡æ–°ä½¿ç”¨å®ƒï¼ˆå³ï¼Œåº”è¯¥å…è®¸ GID åŠ å…¥ï¼Œç„¶åç¦»å¼€ï¼Œç„¶åå†æ¬¡åŠ å…¥ï¼‰\næ–°åŠ å…¥çš„Groupä¿¡æ¯ï¼Œè¦æ±‚åœ¨æ¯ä¸€ä¸ªgroupå¹³è¡¡åˆ†å¸ƒshardï¼Œå³ä»»æ„ä¸¤ä¸ªgroupä¹‹é—´çš„shardæ•°ç›®ç›¸å·®ä¸èƒ½ä¸º1ï¼Œå…·ä½“å®ç°æ¯ä¸€æ¬¡æ‰¾å‡ºå«æœ‰shardæ•°ç›®æœ€å¤šçš„å’Œæœ€å°‘çš„ï¼Œæœ€å¤šçš„ç»™æœ€å°‘çš„ä¸€ä¸ªï¼Œå¾ªç¯ç›´åˆ°æ»¡è¶³æ¡ä»¶ä¸ºæ­¢ã€‚å‘ä¸ºï¼šGID = 0 æ˜¯æ— æ•ˆé…ç½®ï¼Œä¸€å¼€å§‹æ‰€æœ‰åˆ†ç‰‡åˆ†é…ç»™GID=0ï¼Œéœ€è¦ä¼˜å…ˆåˆ†é…ï¼›mapçš„è¿­ä»£æ—¶æ— åºçš„ï¼Œä¸ç¡®å®šé¡ºåºçš„è¯ï¼ŒåŒä¸€ä¸ªå‘½ä»¤åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šè®¡ç®—å‡ºæ¥çš„æ–°é…ç½®ä¸ä¸€è‡´ï¼ŒæŒ‰sortæ’åºä¹‹åéå†å³å¯ã€‚ä¸” map æ˜¯å¼•ç”¨å¯¹è±¡ï¼Œéœ€è¦ç”¨æ·±æ‹·è´åšå¤åˆ¶ã€‚\nå¯¹äº Joinï¼Œå¯ä»¥é€šè¿‡å¤šæ¬¡å¹³å‡åœ°æ–¹å¼æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼šæ¯æ¬¡é€‰æ‹©ä¸€ä¸ªæ‹¥æœ‰ shard æ•°æœ€å¤šçš„ raft ç»„å’Œä¸€ä¸ªæ‹¥æœ‰ shard æ•°æœ€å°‘çš„ raftï¼Œå°†å‰è€…ç®¡ç†çš„ä¸€ä¸ª shard åˆ†ç»™åè€…ï¼Œå‘¨è€Œå¤å§‹ï¼Œç›´åˆ°å®ƒä»¬ä¹‹å‰çš„å·®å€¼å°äºç­‰äº 1 ä¸” 0 raft ç»„æ—  shard ä¸ºæ­¢ã€‚å¯¹äº Leaveï¼Œå¦‚æœ Leave åé›†ç¾¤ä¸­æ—  raft ç»„ï¼Œåˆ™å°†åˆ†ç‰‡æ‰€å± raft ç»„éƒ½ç½®ä¸ºæ— æ•ˆçš„ 0ï¼›å¦åˆ™å°†åˆ é™¤ raft ç»„çš„åˆ†ç‰‡å‡åŒ€åœ°åˆ†é…ç»™ä»ç„¶å­˜åœ¨çš„ raft ç»„ã€‚é€šè¿‡è¿™æ ·çš„åˆ†é…ï¼Œå¯ä»¥å°† shard åˆ†é…åœ°ååˆ†å‡åŒ€ä¸”äº§ç”Ÿäº†å‡ ä¹æœ€å°‘çš„è¿ç§»ä»»åŠ¡ã€‚\nLeave RPCã€‚åˆ é™¤æŒ‡å®šreplica groupï¼Œ å‚æ•°æ˜¯ä»¥å‰åŠ å…¥çš„ç»„çš„ GID åˆ—è¡¨ã€‚ shardctrler åº”è¯¥åˆ›å»ºä¸€ä¸ªä¸åŒ…æ‹¬è¿™äº›ç»„çš„æ–°é…ç½®ï¼Œå¹¶å°†è¿™äº›ç»„çš„åˆ†ç‰‡åˆ†é…ç»™å‰©ä½™çš„ç»„ã€‚æ–°é…ç½®åº”åœ¨ç»„ä¹‹é—´å°½å¯èƒ½å‡åŒ€åœ°åˆ’åˆ†åˆ†ç‰‡ï¼Œå¹¶åº”ç§»åŠ¨å°½å¯èƒ½å°‘çš„åˆ†ç‰‡ä»¥å®ç°è¯¥ç›®æ ‡ï¼›\nMove RPCã€‚ç§»åŠ¨åˆ†ç‰‡ï¼Œçš„å‚æ•°æ˜¯ä¸€ä¸ªåˆ†ç‰‡å·å’Œä¸€ä¸ª GIDã€‚ shardctrler åº”è¯¥åˆ›å»ºä¸€ä¸ªæ–°é…ç½®ï¼Œå…¶ä¸­å°†åˆ†ç‰‡åˆ†é…ç»™ç»„ã€‚ Move çš„ç›®çš„æ˜¯è®©æˆ‘ä»¬èƒ½å¤Ÿæµ‹è¯•æ‚¨çš„è½¯ä»¶ã€‚ç§»åŠ¨åçš„åŠ å…¥æˆ–ç¦»å¼€å¯èƒ½ä¼šå–æ¶ˆç§»åŠ¨ï¼Œå› ä¸ºåŠ å…¥å’Œç¦»å¼€ä¼šé‡æ–°å¹³è¡¡ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 // Join according to new Group(gid -\u0026gt; servers) to change the Config func (cf *MemoryConfigStateMachine) Join(groups map[int][]string) Err { lastConfig := cf.Configs[len(cf.Configs)-1] newConfig := Config{ Num: len(cf.Configs), Shards: lastConfig.Shards, Groups: deepCopy(lastConfig.Groups), } for gid, servers := range groups { if _, ok := newConfig.Groups[gid]; !ok { newServers := make([]string, len(servers)) copy(newServers, servers) newConfig.Groups[gid] = newServers } } // æ‰¾åˆ°group ä¸­shard æœ€å¤§å’Œæœ€å°çš„ç»„ï¼Œå°†æ•°æ®è¿›è¡Œmove =\u0026gt; reblance g2s := Group2Shards(newConfig) for { src, dst := GetGIDWIthMaxShards(g2s), GetGIDWithMinShards(g2s) if src != 0 \u0026amp;\u0026amp; len(g2s[src])-len(g2s[dst]) \u0026lt;= 1 { break } g2s[dst] = append(g2s[dst], g2s[src][0]) g2s[src] = g2s[src][1:] } var newShards [NShards]int for gid, shards := range g2s { for _, shard := range shards { newShards[shard] = gid } } newConfig.Shards = newShards cf.Configs = append(cf.Configs, newConfig) return OK } // Leave some group leave the cluster func (cf *MemoryConfigStateMachine) Leave(gids []int) Err { lastConfig := cf.Configs[len(cf.Configs)-1] newConfig := Config{ Num: len(cf.Configs), Shards: lastConfig.Shards, Groups: deepCopy(lastConfig.Groups), } g2s := Group2Shards(newConfig) orphanShards := make([]int, 0) for _, gid := range gids { delete(newConfig.Groups, gid) if shards, ok := g2s[gid]; ok { orphanShards = append(orphanShards, shards...) delete(g2s, gid) } } var newShards [NShards]int if len(newConfig.Groups) != 0 { // reblance for _, shard := range orphanShards { target := GetGIDWithMinShards(g2s) g2s[target] = append(g2s[target], shard) } // update Shards: share -\u0026gt; gid for gid, shards := range g2s { for _, shard := range shards { newShards[shard] = gid } } } newConfig.Shards = newShards cf.Configs = append(cf.Configs, newConfig) return OK } // Move move No.shard to No.gid func (cf *MemoryConfigStateMachine) Move(shard, gid int) Err { lastConfig := cf.Configs[len(cf.Configs)-1] newConfig := Config{ Num: len(cf.Configs), Shards: lastConfig.Shards, Groups: lastConfig.Groups, } newConfig.Shards[shard] = gid cf.Configs = append(cf.Configs, newConfig) return OK } // Query return the version of num config func (cf *MemoryConfigStateMachine) Query(num int) (Config, Err) { if num \u0026lt; 0 || num \u0026gt;= len(cf.Configs) { return cf.Configs[len(cf.Configs)-1], OK } return cf.Configs[num], OK } Lab4B ShardKV å®éªŒæç¤º:\næœåŠ¡å™¨ä¸éœ€è¦è°ƒç”¨åˆ†ç‰‡æ§åˆ¶å™¨çš„Join()ï¼Œtester æ‰ä¼šå»è°ƒç”¨ï¼› æœåŠ¡å™¨å°†éœ€è¦å®šæœŸè½®è¯¢ shardctrler ä»¥ç›‘å¬æ–°çš„é…ç½®ã€‚é¢„æœŸå¤§çº¦æ¯100æ¯«ç§’è½®è¯¢ä¸€æ¬¡ï¼›å¯ä»¥æ›´é¢‘ç¹ï¼Œä½†è¿‡å°‘å¯èƒ½ä¼šå¯¼è‡´ bugã€‚ æœåŠ¡å™¨éœ€è¦äº’ç›¸å‘é€rpcï¼Œä»¥ä¾¿åœ¨é…ç½®æ›´æ”¹æœŸé—´ä¼ è¾“åˆ†ç‰‡ã€‚shardctrlerçš„Configç»“æ„åŒ…å«æœåŠ¡å™¨åï¼Œä¸€ä¸ª Server éœ€è¦ä¸€ä¸ªlabrpc.ClientEndï¼Œä»¥ä¾¿å‘é€RPCã€‚ä½¿ç”¨make_end()å‡½æ•°ä¼ ç»™StartServer()å‡½æ•°å°†æœåŠ¡å™¨åè½¬æ¢ä¸ºClientEndã€‚shardkv /client.goéœ€è¦å®ç°è¿™äº›é€»è¾‘ã€‚ åœ¨server.goä¸­æ·»åŠ ä»£ç å»å‘¨æœŸæ€§ä» shardctrler æ‹‰å–æœ€æ–°çš„é…ç½®ï¼Œå¹¶ä¸”å½“è¯·æ±‚åˆ†ç‰‡ä¸å±äºè‡ªèº«æ—¶ï¼Œæ‹’ç»è¯·æ±‚ å½“è¢«è¯·æ±‚åˆ°é”™è¯¯åˆ†ç‰‡æ—¶ï¼Œéœ€è¦è¿”å›ErrWrongGroupç»™å®¢æˆ·ç«¯ï¼Œå¹¶ç¡®ä¿Get, Put, Appendåœ¨é¢ä¸´å¹¶å‘é‡é…ç½®æ—¶èƒ½æ­£ç¡®ä½œå‡ºå†³å®š é‡é…ç½®éœ€è¦æŒ‰æµç¨‹æ‰§è¡Œå”¯ä¸€ä¸€æ¬¡ labgob çš„æç¤ºé”™è¯¯ä¸èƒ½å¿½è§†ï¼Œå®ƒå¯èƒ½å¯¼è‡´å®éªŒä¸è¿‡ åˆ†ç‰‡é‡åˆ†é…çš„è¯·æ±‚ä¹Ÿéœ€è¦åšé‡å¤è¯·æ±‚æ£€æµ‹ è‹¥å®¢æˆ·ç«¯æ”¶åˆ°ErrWrongGroupï¼Œæ˜¯å¦æ›´æ”¹è¯·æ±‚åºåˆ—å·? è‹¥æœåŠ¡å™¨æ‰§è¡Œè¯·æ±‚æ—¶è¿”å›ErrWrongGroupï¼Œæ˜¯å¦æ›´æ–°å®¢æˆ·ç«¯ä¿¡æ¯ï¼Ÿ å½“æœåŠ¡å™¨è½¬ç§»åˆ°æ–°é…ç½®åï¼Œå®ƒå¯ä»¥ç»§ç»­å­˜å‚¨å®ƒä¸å†è´Ÿè´£çš„åˆ†ç‰‡ï¼ˆç”Ÿäº§ç¯å¢ƒä¸­è¿™æ˜¯ä¸å…è®¸çš„ï¼‰ï¼Œä½†è¿™ä¸ªå¯ä»¥ç®€åŒ–å®ç° å½“ G1 åœ¨é…ç½®å˜æ›´æ—¶éœ€è¦æ¥è‡ª G2 çš„åˆ†ç‰‡æ•°æ®ï¼ŒG2 å¤„ç†æ—¥å¿—æ¡ç›®çš„å“ªä¸ªæ—¶é—´ç‚¹å°†åˆ†ç‰‡å‘é€ç»™ G1 æ˜¯æœ€å¥½çš„? ä½ å¯ä»¥åœ¨æ•´ä¸ª rpc è¯·æ±‚æˆ–å›å¤ä¸­å‘é€æ•´ä¸ª mapï¼Œè¿™å¯ä»¥ç®€åŒ–åˆ†ç‰‡ä¼ è¾“ map æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‰€ä»¥åœ¨å‘é€ map çš„æ—¶å€™ï¼Œå»ºè®®å…ˆæ‹·è´ä¸€æ¬¡ï¼Œé¿å… data raceï¼ˆåœ¨ labrpc æ¡†æ¶ä¸‹ï¼Œæ¥æ”¶ map æ—¶ä¹Ÿéœ€è¦æ‹·è´ï¼‰ åœ¨é…ç½®æ›´æ”¹æœŸé—´ï¼Œä¸€å¯¹ç»„å¯èƒ½éœ€è¦äº’ç›¸ä¼ é€åˆ†ç‰‡ï¼Œè¿™å¯èƒ½ä¼šå‘ç”Ÿæ­»é” Challenge å¦‚æœæƒ³è¾¾åˆ°ç”Ÿäº§ç¯å¢ƒç³»ç»Ÿçº§åˆ«ï¼Œå¦‚ä¸‹ä¸¤ä¸ªæŒ‘æˆ˜æ˜¯éœ€è¦å®ç°çš„ Challenge1ï¼šGarbage collection of state å½“ä¸€ä¸ªå‰¯æœ¬ç»„å¤±å»ä¸€ä¸ªåˆ†ç‰‡çš„æ‰€æœ‰æƒæ—¶ï¼Œå‰¯æœ¬ç»„éœ€è¦åˆ é™¤è¯¥åˆ†ç‰‡æ•°æ®ã€‚ä½†è¿™ç»™è¿ç§»å¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œè€ƒè™‘ä¸¤ä¸ªç»„G1 å’Œ G2ï¼Œå¹¶ä¸”æ–°é…ç½®C å°†åˆ†ç‰‡ä» G1 ç§»åŠ¨åˆ° G2ï¼Œè‹¥ G1 åœ¨è½¬æ¢é…ç½®åˆ°Cæ—¶åˆ é™¤äº†æ•°æ®åº“ä¸­çš„åˆ†ç‰‡ï¼Œå½“G2 è½¬æ¢åˆ°Cæ—¶ï¼Œå¦‚ä½•è·å– G1 çš„æ•°æ® å®éªŒè¦æ±‚ ä½¿æ¯ä¸ªå‰¯æœ¬ç»„ä¿ç•™æ—§åˆ†ç‰‡çš„æ—¶é•¿ä¸å†æ˜¯æ— é™æ—¶é•¿ï¼Œå³ä½¿å‰¯æœ¬ç»„(å¦‚ä¸Šé¢çš„G1)ä¸­çš„æ‰€æœ‰æœåŠ¡å™¨å´©æºƒå¹¶æ¢å¤æ­£å¸¸ï¼Œè§£å†³æ–¹æ¡ˆä¹Ÿå¿…é¡»å·¥ä½œã€‚å¦‚æœæ‚¨é€šè¿‡TestChallenge1Deleteï¼Œæ‚¨å°±å®Œæˆäº†è¿™ä¸ªæŒ‘æˆ˜ã€‚ è§£å†³æ–¹æ¡ˆ åˆ†ç‰‡è¿ç§»æˆåŠŸä¹‹åï¼Œç«‹é©¬è¿›è¡Œåˆ†ç‰‡ GC äº†ï¼ŒGC å®Œæ¯•åå†è¿›å…¥åˆ°é…ç½®æ›´æ–°é˜¶æ®µã€‚ chanllenge2ï¼šClient requests during configuration changes é…ç½®æ›´æ”¹æœŸé—´æœ€ç®€å•çš„æ–¹å¼æ˜¯ç¦æ­¢æ‰€æœ‰å®¢æˆ·ç«¯æ“ä½œç›´åˆ°è½¬æ¢å®Œæˆï¼Œè™½ç„¶ç®€å•ä½†æ˜¯ä¸æ»¡è¶³äºç”Ÿäº§ç¯å¢ƒè¦æ±‚ï¼Œè¿™å°†å¯¼è‡´å®¢æˆ·ç«¯é•¿æ—¶é—´åœæ»ï¼Œæœ€å¥½å¯ä»¥ç»§ç»­ä¸ºä¸å—å½“å‰é…ç½®æ›´æ”¹çš„åˆ†ç‰‡æä¾›æœåŠ¡ ä¸Šè¿°ä¼˜åŒ–è¿˜èƒ½æ›´å¥½ï¼Œè‹¥ G3 åœ¨è¿‡æ¸¡åˆ°é…ç½®Cæ—¶ï¼Œéœ€è¦æ¥è‡ªG1 çš„åˆ†ç‰‡S1 å’Œ G2 çš„åˆ†ç‰‡S2ã€‚å¸Œæœ› G3 èƒ½åœ¨æ”¶åˆ°å…¶ä¸­ä¸€ä¸ªåˆ†ç‰‡åå¯ä»¥ç«‹å³å¼€å§‹æ¥æ”¶é’ˆå¯¹è¯¥åˆ†ç‰‡çš„è¯·æ±‚ã€‚å¦‚G1å®•æœºäº†ï¼ŒG3åœ¨æ”¶åˆ°G2çš„åˆ†ç‰‡æ•°æ®åï¼Œå¯ä»¥ç«‹å³ä¸º S2 åˆ†ç‰‡æä¾›æœåŠ¡ï¼Œè€Œä¸éœ€è¦ç­‰å¾… C é…ç½®è½¬æ¢å®Œå…¨å®Œæˆ å®éªŒè¦æ±‚ ä¿®æ”¹æ‚¨çš„è§£å†³æ–¹æ¡ˆï¼Œä»¥ä¾¿åœ¨é…ç½®æ›´æ”¹æœŸé—´ç»§ç»­æ‰§è¡Œä¸å—å½±å“çš„åˆ†ç‰‡ä¸­çš„ key çš„å®¢æˆ·ç«¯æ“ä½œã€‚å½“æ‚¨é€šè¿‡ TestChallenge2Unaffected æµ‹è¯•æ—¶ï¼Œæ‚¨å·²ç»å®Œæˆäº†è¿™ä¸ªæŒ‘æˆ˜ã€‚ ä¿®æ”¹æ‚¨çš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨é…ç½®è½¬æ¢è¿›è¡Œä¸­ï¼Œå‰¯æœ¬ç»„ä¹Ÿå¯ä»¥ç«‹å³å¼€å§‹æä¾›åˆ†ç‰‡æœåŠ¡ã€‚å½“æ‚¨é€šè¿‡TestChallenge2Partialæµ‹è¯•æ—¶ï¼Œæ‚¨å·²ç»å®Œæˆäº†è¿™ä¸ªæŒ‘æˆ˜ã€‚ è§£å†³æ–¹æ¡ˆ åˆ†ç‰‡è¿ç§»ä»¥ group ä¸ºå•ä½ï¼Œè¿™æ ·å³ä½¿ä¸€ä¸ª groupæŒ‚äº†ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°å¦ä¸€ä¸ª groupä¸­çš„åˆ†ç‰‡è¿ç§»ã€‚ ä¸Šé¢çš„å®éªŒShardCtrler é›†ç¾¤ç»„å®ç°äº†é…ç½®æ›´æ–°ï¼Œåˆ†ç‰‡å‡åŒ€åˆ†é…ç­‰ä»»åŠ¡ï¼ŒShardKVServeråˆ™éœ€è¦æ‰¿è½½æ‰€æœ‰åˆ†ç‰‡çš„è¯»å†™ä»»åŠ¡ï¼Œç›¸æ¯”äºMIT 6.824 Lab3 RaftKVçš„æä¾›åŸºç¡€çš„è¯»å†™æœåŠ¡ï¼Œè¿˜éœ€è¦åŠŸèƒ½ä¸ºé…ç½®æ›´æ–°ï¼Œåˆ†ç‰‡æ•°æ®è¿ç§»ï¼Œåˆ†ç‰‡æ•°æ®æ¸…ç†ï¼Œç©ºæ—¥å¿—æ£€æµ‹ã€‚\nå®éªŒé€»è¾‘ æˆ‘ä»¬å¯ä»¥é¦–å…ˆæ˜ç¡®ç³»ç»Ÿçš„è¿è¡Œæ–¹å¼ï¼šä¸€å¼€å§‹ç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ª shardctrler ç»„æ¥è´Ÿè´£é…ç½®æ›´æ–°ï¼Œåˆ†ç‰‡åˆ†é…ç­‰ä»»åŠ¡ï¼Œæ¥ç€ç³»ç»Ÿä¼šåˆ›å»ºå¤šä¸ª raft ç»„æ¥æ‰¿è½½æ‰€æœ‰åˆ†ç‰‡çš„è¯»å†™ä»»åŠ¡ã€‚æ­¤å¤–ï¼Œraft ç»„å¢åˆ ï¼ŒèŠ‚ç‚¹å®•æœºï¼ŒèŠ‚ç‚¹é‡å¯ï¼Œç½‘ç»œåˆ†åŒºç­‰å„ç§æƒ…å†µéƒ½å¯èƒ½ä¼šå‡ºç°ã€‚\nå¯¹äºé›†ç¾¤å†…éƒ¨ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯æ‰€æœ‰åˆ†ç‰‡èƒ½å¤Ÿè¾ƒä¸ºå‡åŒ€çš„åˆ†é…åœ¨æ‰€æœ‰ raft ç»„ä¸Šï¼Œè¿˜éœ€è¦èƒ½å¤Ÿæ”¯æŒåŠ¨æ€è¿ç§»å’Œå®¹é”™ã€‚\nå¯¹äºé›†ç¾¤å¤–éƒ¨ï¼Œæˆ‘ä»¬éœ€è¦å‘ç”¨æˆ·ä¿è¯æ•´ä¸ªé›†ç¾¤è¡¨ç°çš„åƒä¸€ä¸ªæ°¸è¿œä¸ä¼šæŒ‚çš„å•èŠ‚ç‚¹ KV æœåŠ¡ä¸€æ ·ï¼Œå³å…·æœ‰çº¿æ€§ä¸€è‡´æ€§ã€‚\nlab4b çš„åŸºæœ¬æµ‹è¯•è¦æ±‚äº†ä¸Šè¿°å±æ€§ï¼Œchallenge1 è¦æ±‚åŠæ—¶æ¸…ç†ä¸å†å±äºæœ¬åˆ†ç‰‡çš„æ•°æ®ï¼Œchallenge2 ä¸ä»…è¦æ±‚åˆ†ç‰‡è¿ç§»æ—¶ä¸å½±å“æœªè¿ç§»åˆ†ç‰‡çš„è¯»å†™æœåŠ¡ï¼Œè¿˜è¦æ±‚ä¸åŒåœ°åˆ†ç‰‡æ•°æ®èƒ½å¤Ÿç‹¬ç«‹è¿ç§»ï¼Œå³å¦‚æœä¸€ä¸ªé…ç½®å¯¼è‡´å½“å‰ raft ç»„éœ€è¦å‘å…¶ä»–ä¸¤ä¸ª raft ç»„æ‹‰å–æ•°æ®æ—¶ï¼Œå³ä½¿ä¸€ä¸ªè¢«æ‹‰å–æ•°æ®çš„ raft ç»„å…¨æŒ‚äº†ï¼Œä¹Ÿä¸èƒ½å¯¼è‡´å¦ä¸€ä¸ªæœªæŒ‚çš„è¢«æ‹‰å–æ•°æ®çš„ raft ç»„åˆ†ç‰‡å§‹ç»ˆä¸èƒ½åœ¨å½“å‰ raft ç»„æä¾›æœåŠ¡ã€‚\nStartServer: å¯åŠ¨Raft èŠ‚ç‚¹å’Œ Group configureAction: ç›‘å¬æ˜¯å¦ç”±é…ç½®å˜åŒ–ï¼Œ é…ç½®ç¬¦åˆè¦æ±‚åæ‰§è¡ŒNewConfigurationCommand RPC Apply æ“ä½œè®°å½•åˆ°æ—¥å¿—ä¸­ migrationAction: ç›‘å¬configureAction ç»“æŸå æ ¹æ®æœ€æ–°é…ç½®è¿›è¡Œæ•°æ®è¿ç§»ã€‚ä¼šå‘é€GetShardsData RPC pull shard æ•°æ®åˆ°resp *ShardOperationResponse ä¸­ï¼Œç›¸å½“äºæ‹‰åˆ°æœ¬åœ°èŠ‚ç‚¹çš„æŸä¸ªå˜é‡ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šæœ‰å¤§é‡æ•°æ®çš„ä¼ è¾“ã€‚æ­¤RPC ç»“æŸä¹‹åï¼Œå‘é€InsertShardsCommand RPC è¿›è¡ŒçœŸå®çš„æ•°æ®è¿ç§», åŒæ ·ç»è¿‡Raft å±‚å¤šæ•°èŠ‚ç‚¹åŒæ„åï¼Œåº”ç”¨åˆ°æœ¬åœ°çš„çŠ¶æ€æœºä¸Šã€‚å¹¶æŠŠ éœ€è¦Shard çŠ¶æ€ä¿®æ”¹å¥½ã€‚Pulling æ”¹ä¸ºGCing ä¸ºä¸‹éƒ¨åšå‡†å¤‡ gcAction: åœ¨ä¸Šé¢ä¸€æ­¥çš„applyInsertShards ä¸­ä¼šæŠŠå·²ç»Pulling çš„è¿œç¨‹çš„Shard æ”¹ä¸ºGcingã€‚ åœ¨è¿™ä¸ªGoroutine ä¸­ï¼Œè°ƒç”¨DeleteShardsData RPC, ä¼šæŠŠShardOperationRequest ä¸­çš„Shard é€šè¿‡å‘é€ NewDeleteShardsCommand RPC æŠŠçŠ¶æ€ä¸ºGCing çš„Shards æ”¹ä¸ºServerï¼ŒçŠ¶æ€ä¸ºBePulling çš„é‡ç½®ã€‚ä¸æ­¤åŒæ—¶ï¼ŒDeleteShardsData RPC ç»“æŸOK åï¼Œæœ¬èŠ‚ç‚¹ä¹Ÿéœ€è¦å‘é€ä¸€éNewDeleteShardsCommand RPC Commandï¼ŒæŠŠGCing çš„Shards æ”¹ä¸ºé»˜è®¤çŠ¶æ€ã€‚ æ¶æ„å›¾ 1 2 3 4 5 6 7 8 9 2023/03/03 19:58:49 [StartServer]-{Node: 0}-{Group: 100} has started 2023/03/03 19:58:49 [StartServer]-{Node: 1}-{Group: 100} has started 2023/03/03 19:58:49 [StartServer]-{Node: 2}-{Group: 100} has started 2023/03/03 19:58:49 [StartServer]-{Node: 0}-{Group: 101} has started 2023/03/03 19:58:49 [StartServer]-{Node: 1}-{Group: 101} has started 2023/03/03 19:58:49 [StartServer]-{Node: 2}-{Group: 101} has started 2023/03/03 19:58:49 [StartServer]-{Node: 0}-{Group: 102} has started 2023/03/03 19:58:49 [StartServer]-{Node: 1}-{Group: 102} has started 2023/03/03 19:58:49 [StartServer]-{Node: 2}-{Group: 102} has started æ ¹æ®Log å¯ä»¥çœ‹å‡ºï¼Œé›†ç¾¤ä»¥Group ä¸ºå•ä½ï¼Œåˆå§‹åŒ–ä¸‰ä¸ªGroup ç®¡ç†åä¸ªShardå’Œä¸‰å°èŠ‚ç‚¹ã€‚Shard æ˜¯çœŸå®å­˜å‚¨æ•°æ®çš„å•ä½ã€‚ æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªRaft å…±è¯†å±‚ï¼ŒåŒä¸€ä¸ªGroup æ„æˆä¸€ä¸ªRaft Groupï¼Œ æ•´ä½“å½¢æˆMulti Raft Group, ä»¥Group ä¸ºå•ä½å¯¹åº”ç”¨å±‚æä¾›æœåŠ¡ã€‚Group å†…éƒ¨ç”¨Raft ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚æ¯ä¸ªGroup æœ‰å¤šå°‘ä¸ªShard ç”±ShardCtrller å†³å®šã€‚Shardå¦‚æœç”±å‰¯æœ¬ä¹Ÿåœ¨å„è‡ªGroup çš„å„ä¸ªèŠ‚ç‚¹ä¸Šç®¡ç†ã€‚\nNebula Graph ä¸­ æ¯ä¸ªShardåŠå…¶å‰¯æœ¬æ„æˆä¸€ä¸ªRaft Groupï¼ŒShard çš„æ•°é‡å†³å®šäº†Group çš„æ•°é‡ã€‚ æœ¬å®éªŒä¸­ï¼Œç¡®å®šäº†åªæœ‰æœ€å¤šä¸‰ä¸ªGroup\nå®¢æˆ·ç«¯Clerk ä¸»è¦è¯·æ±‚é€»è¾‘:\nä½¿ç”¨key2shard()å»æ‰¾åˆ°ä¸€ä¸ª key å¯¹åº”å“ªä¸ªShardShardï¼› æ ¹æ®Shardä»å½“å‰é…ç½®configä¸­è·å–çš„ gidï¼› æ ¹æ®gidä»å½“å‰é…ç½®configä¸­è·å– group ä¿¡æ¯ï¼› åœ¨groupå¾ªç¯æŸ¥æ‰¾leaderIdï¼Œç›´åˆ°è¿”å›è¯·æ±‚æˆåŠŸã€ErrWrongGroupæˆ–æ•´ä¸ª group éƒ½éå†è¯·æ±‚è¿‡ï¼› Query æœ€æ–°çš„é…ç½®ï¼Œå›åˆ°æ­¥éª¤1å¾ªç¯é‡å¤ï¼› 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 type Clerk struct { sc *shardctrler.Clerk config shardctrler.Config makeEnd func(string) *labrpc.ClientEnd // You will have to modify this struct. leaderIds map[int]int // {groupid: leader if hardid of this groupid} clientId int64 commandId int64 //clientId + commandId define unique operation } // çœç•¥ä¸€äº›æ–¹æ³• func (ck *Clerk) Command(req *CommandRequest) string { req.ClientId, req.CommandId = ck.clientId, ck.commandId for { shard := key2shard(req.Key) gid := ck.config.Shards[shard] if servers, ok := ck.config.Groups[gid]; ok { // æ‰¾åˆ°Group å¯¹åº”çš„LeaderId, å¦‚æœæ²¡æœ‰ä»Id 0 å¼€å§‹è½®è¯¢ if _, ok := ck.leaderIds[gid]; !ok { ck.leaderIds[gid] = 0 } oldLeaderId := ck.leaderIds[gid] newLeaderId := oldLeaderId for { var resp CommandResponse ok := ck.makeEnd(servers[newLeaderId]).Call(\u0026#34;ShardKV.Command\u0026#34;, req, \u0026amp;resp) if ok \u0026amp;\u0026amp; (resp.Err == OK || resp.Err == ErrNoKey) { ck.commandId++ return resp.Value } else if ok \u0026amp;\u0026amp; resp.Err == ErrWrongGroup { break } else { // Err is ErrWrongLeader ErrOutDated ErrTimeout ErrNotReady newLeaderId = (newLeaderId + 1) % len(servers) if newLeaderId == oldLeaderId { // æ‰€æœ‰server è½®è¯¢ä¸€éä¹‹åé€€å‡ºï¼Œé¿å…raft é›†ç¾¤å¤„äºæ— leader çŠ¶æ€ä¸­ä¸€ç›´é‡è¯• break } continue } } } time.Sleep(100 * time.Millisecond) ck.config = ck.sc.Query(-1) } } æœåŠ¡ç«¯Server ä¸»è¦é€»è¾‘:\nå®¢æˆ·ç«¯é¦–å…ˆå’ŒShardCtrleräº¤äº’ï¼Œè·å–æœ€æ–°çš„é…ç½®ï¼Œæ ¹æ®æœ€æ–°é…ç½®æ‰¾åˆ°å¯¹åº”keyçš„shardï¼Œè¯·æ±‚è¯¥shardçš„groupã€‚ æœåŠ¡ç«¯ShardKVServerä¼šåˆ›å»ºå¤šä¸ª raft ç»„æ¥æ‰¿è½½æ‰€æœ‰åˆ†ç‰‡çš„è¯»å†™ä»»åŠ¡ã€‚ æœåŠ¡ç«¯ShardKVServeréœ€è¦å®šæœŸå’ŒShardCtrleräº¤äº’ï¼Œä¿è¯æ›´æ–°åˆ°æœ€æ–°é…ç½®(monitor)ã€‚ æœåŠ¡ç«¯ShardKVServeréœ€è¦æ ¹æ®æœ€æ–°é…ç½®å®Œæˆé…ç½®æ›´æ–°ï¼Œåˆ†ç‰‡æ•°æ®è¿ç§»ï¼Œåˆ†ç‰‡æ•°æ®æ¸…ç†ï¼Œç©ºæ—¥å¿—æ£€æµ‹ç­‰åŠŸ- èƒ½ã€‚ ç»“æ„ä½“ é¦–å…ˆShardKVServerç»™å‡ºç»“æ„ä½“ï¼Œç›¸æ¯”äºMIT 6.824 Lab3 RaftKVçš„å¤šäº†currentConfigå’ŒlastConfigæ•°æ®ï¼Œè¿™æ ·å…¶ä»–åç¨‹ä¾¿èƒ½å¤Ÿé€šè¿‡å…¶è®¡ç®—éœ€è¦éœ€è¦å‘è°æ‹‰å–åˆ†ç‰‡æˆ–è€…éœ€è¦è®©è°å»åˆ åˆ†ç‰‡ã€‚ åŒæ—¶åº•å±‚çš„StateMachine ä¹Ÿç”±MemeoryKV å˜ä¸ºShard æ‰¿æ¥ã€‚å¹¶ç»™Shard æ·»åŠ äº†çŠ¶æ€ä¿¡æ¯ã€‚\nå¯åŠ¨äº†äº”ä¸ªåç¨‹ï¼šapply åç¨‹ï¼Œé…ç½®æ›´æ–°åç¨‹ï¼Œæ•°æ®è¿ç§»åç¨‹ï¼Œæ•°æ®æ¸…ç†åç¨‹ï¼Œç©ºæ—¥å¿—æ£€æµ‹åç¨‹æ¥å®ç°åŠŸèƒ½ã€‚å››ä¸ªåç¨‹éƒ½éœ€è¦ leader æ¥æ‰§è¡Œï¼Œå› æ­¤æŠ½è±¡å‡ºäº†ä¸€ä¸ªç®€å•åœ°å‘¨æœŸæ‰§è¡Œå‡½æ•° Monitorã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 type Shard struct { KV map[string]string Status ShardStatus } type ShardKV struct { mu sync.RWMutex me int rf *raft.Raft dead int32 applyCh chan raft.ApplyMsg makeEnd func(string) *labrpc.ClientEnd gid int sc *shardctrler.Clerk maxRaftState int // snapshot if log grows this big lastApplied int // è®°å½•applied Index é˜²æ­¢çŠ¶æ€æœºapply å°çš„index lastConfig shardctrler.Config currentConfig shardctrler.Config stateMachine map[int]*Shard // {shardId: shard of KV} lastOperations map[int64]OperationContext // {clientId: ctx} notifyChans map[int]chan *CommandResponse // {commitIndex: commandResp} } func StartServer(servers []*labrpc.ClientEnd, me int, persister *raft.Persister, maxraftstate int, gid int, ctrlers []*labrpc.ClientEnd, make_end func(string) *labrpc.ClientEnd) *ShardKV { // call labgob.Register on structures you want // Go\u0026#39;s RPC library to marshall/unmarshall. labgob.Register(Command{}) labgob.Register(CommandRequest{}) labgob.Register(shardctrler.Config{}) labgob.Register(ShardOperationRequest{}) labgob.Register(ShardOperationResponse{}) applyCh := make(chan raft.ApplyMsg) kv := \u0026amp;ShardKV{ me: me, rf: raft.Make(servers, me, persister, applyCh), dead: 0, applyCh: applyCh, makeEnd: make_end, gid: gid, sc: shardctrler.MakeClerk(ctrlers), maxRaftState: maxraftstate, lastApplied: 0, lastConfig: shardctrler.DefaultConfig(), currentConfig: shardctrler.DefaultConfig(), stateMachine: make(map[int]*Shard), lastOperations: make(map[int64]OperationContext), notifyChans: make(map[int]chan *CommandResponse), } kv.restoreSnapshot(persister.ReadSnapshot()) // start applier goroutine to apply committed logs to stateMachine go kv.applier() // start configuration monitor goroutine to fetch latest configuration go kv.Monitor(kv.configureAction, ConfigureMonitorTimeout) // start migration monitor goroutine to pull related shards go kv.Monitor(kv.migrationAction, MigrationMonitorTimeout) // start gc monitor goroutine to delete useless shards in remote groups go kv.Monitor(kv.gcAction, GCMonitorTimeout) // start entry-in-currentTerm monitor goroutine to advance commitIndex by // appending empty entries in current term periodically to avoid live locks go kv.Monitor(kv.checkEntryIncurrentTermAction, EmptyEntryDetectorTimeout) DPrintf(\u0026#34;[StartServer]-{Node: %v}-{Group: %v} has started\u0026#34;, kv.me, kv.gid) return kv } åˆ†ç‰‡çŠ¶æ€ æ¯ä¸ªåˆ†ç‰‡å…±æœ‰ 4 ç§çŠ¶æ€ï¼š\nServingï¼šåˆ†ç‰‡çš„é»˜è®¤çŠ¶æ€ï¼Œå¦‚æœå½“å‰ raft ç»„åœ¨å½“å‰ config ä¸‹è´Ÿè´£ç®¡ç†æ­¤åˆ†ç‰‡ï¼Œåˆ™è¯¥åˆ†ç‰‡å¯ä»¥æä¾›è¯»å†™æœåŠ¡ï¼Œå¦åˆ™è¯¥åˆ†ç‰‡æš‚ä¸å¯ä»¥æä¾›è¯»å†™æœåŠ¡ï¼Œä½†ä¸ä¼šé˜»å¡é…ç½®æ›´æ–°åç¨‹æ‹‰å–æ–°é…ç½®ã€‚\nPullingï¼šè¡¨ç¤ºå½“å‰ raft ç»„åœ¨å½“å‰ config ä¸‹è´Ÿè´£ç®¡ç†æ­¤åˆ†ç‰‡ï¼Œæš‚ä¸å¯ä»¥æä¾›è¯»å†™æœåŠ¡ï¼Œéœ€è¦å½“å‰ raft ç»„ä»ä¸Šä¸€ä¸ªé…ç½®è¯¥åˆ†ç‰‡æ‰€å± raft ç»„æ‹‰æ•°æ®è¿‡æ¥ä¹‹åæ‰å¯ä»¥æä¾›è¯»å†™æœåŠ¡ï¼Œç³»ç»Ÿä¼šæœ‰ä¸€ä¸ªåˆ†ç‰‡è¿ç§»åç¨‹æ£€æµ‹æ‰€æœ‰åˆ†ç‰‡çš„ Pulling çŠ¶æ€ï¼Œæ¥ç€ä»¥ raft ç»„ä¸ºå•ä½å»å¯¹åº”è¿œç«¯ raft ç»„æ‹‰å–æ•°æ®ï¼Œæ¥ç€å°è¯•é‡æ”¾è¯¥åˆ†ç‰‡çš„æ‰€æœ‰æ•°æ®åˆ°æœ¬åœ°å¹¶å°†åˆ†ç‰‡çŠ¶æ€ç½®ä¸º Servingï¼Œä»¥ç»§ç»­æä¾›æœåŠ¡ã€‚\nBePullingï¼šè¡¨ç¤ºå½“å‰ raft ç»„åœ¨å½“å‰ config ä¸‹ä¸è´Ÿè´£ç®¡ç†æ­¤åˆ†ç‰‡ï¼Œä¸å¯ä»¥æä¾›è¯»å†™æœåŠ¡ï¼Œä½†å½“å‰ raft ç»„åœ¨ä¸Šä¸€ä¸ª config æ—¶è´Ÿè´£ç®¡ç†æ­¤åˆ†ç‰‡ï¼Œå› æ­¤å½“å‰ config ä¸‹è´Ÿè´£ç®¡ç†æ­¤åˆ†ç‰‡çš„ raft ç»„æ‹‰å–å®Œæ•°æ®åä¼šå‘æœ¬ raft ç»„å‘é€åˆ†ç‰‡æ¸…ç†çš„ rpcï¼Œæ¥ç€æœ¬ raft ç»„å°†æ•°æ®æ¸…ç©ºå¹¶é‡ç½®ä¸º serving çŠ¶æ€å³å¯ã€‚\nGCingï¼šè¡¨ç¤ºå½“å‰ raft ç»„åœ¨å½“å‰ config ä¸‹è´Ÿè´£ç®¡ç†æ­¤åˆ†ç‰‡ï¼Œå¯ä»¥æä¾›è¯»å†™æœåŠ¡ï¼Œä½†éœ€è¦æ¸…ç†æ‰ä¸Šä¸€ä¸ªé…ç½®è¯¥åˆ†ç‰‡æ‰€å± raft ç»„çš„æ•°æ®ã€‚ç³»ç»Ÿä¼šæœ‰ä¸€ä¸ªåˆ†ç‰‡æ¸…ç†åç¨‹æ£€æµ‹æ‰€æœ‰åˆ†ç‰‡çš„ GCing çŠ¶æ€ï¼Œæ¥ç€ä»¥ raft ç»„ä¸ºå•ä½å»å¯¹åº”è¿œç«¯ raft ç»„åˆ é™¤æ•°æ®ï¼Œä¸€æ—¦è¿œç¨‹ raft ç»„åˆ é™¤æ•°æ®æˆåŠŸï¼Œåˆ™æœ¬åœ°ä¼šå°è¯•å°†ç›¸å…³åˆ†ç‰‡çš„çŠ¶æ€ç½®ä¸º Servingã€‚\næ—¥å¿—ç±»å‹ åœ¨ lab3 ä¸­ï¼Œå®¢æˆ·ç«¯çš„è¯·æ±‚ä¼šè¢«åŒ…è£…æˆä¸€ä¸ª Op ä¼ ç»™ Raft å±‚ï¼Œåˆ™åœ¨ lab4 ä¸­ï¼Œä¸éš¾æƒ³åˆ°ï¼ŒServers ä¹‹é—´çš„äº¤äº’ï¼Œä¹Ÿå¯ä»¥çœ‹åšæ˜¯åŒ…è£…æˆ Op ä¼ ç»™ Raft å±‚ï¼›å®šä¹‰äº†äº”ç§ç±»å‹çš„æ—¥å¿—ï¼š\nOperationï¼šå®¢æˆ·ç«¯ä¼ æ¥çš„è¯»å†™æ“ä½œæ—¥å¿—ï¼Œæœ‰ Putï¼ŒGetï¼ŒAppend ç­‰è¯·æ±‚ã€‚\nConfigurationï¼šé…ç½®æ›´æ–°æ—¥å¿—ï¼ŒåŒ…å«ä¸€ä¸ªé…ç½®ã€‚\nInsertShardsï¼šåˆ†ç‰‡æ›´æ–°æ—¥å¿—ï¼ŒåŒ…å«è‡³å°‘ä¸€ä¸ªåˆ†ç‰‡çš„æ•°æ®å’Œé…ç½®ç‰ˆæœ¬ã€‚\nDeleteShardsï¼šåˆ†ç‰‡åˆ é™¤æ—¥å¿—ï¼ŒåŒ…å«è‡³å°‘ä¸€ä¸ªåˆ†ç‰‡çš„ id å’Œé…ç½®ç‰ˆæœ¬ã€‚\nEmptyEntryï¼šç©ºæ—¥å¿—ï¼ŒData ä¸ºç©ºï¼Œä½¿å¾—çŠ¶æ€æœºè¾¾åˆ°æœ€æ–°ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 type Command struct { Op CommandType Data interface{} } func (cmd Command) String() string { return fmt.Sprintf(\u0026#34;{Op: %v, Data: %v}\u0026#34;, cmd.Op, cmd.Data) } func NewOperationCommand(req *CommandRequest) Command { return Command{ Op: Operation, Data: *req, } } func NewConfigurationCommand(config *shardctrler.Config) Command { return Command{ Op: Configuration, Data: *config, } } func NewInsertShardsCommand(response *ShardOperationResponse) Command { return Command{InsertShards, *response} } func NewDeleteShardsCommand(request *ShardOperationRequest) Command { return Command{DeleteShards, *request} } func NewEmptyEntryCommand() Command { return Command{EmptyEntry, nil} } // ------------------------------------------------------------- type CommandType uint8 const ( Operation CommandType = iota Configuration InsertShards DeleteShards EmptyEntry ) var ctmap = [...]string{ \u0026#34;Operation\u0026#34;, \u0026#34;Configuration\u0026#34;, \u0026#34;InsertShards\u0026#34;, \u0026#34;DeleteShards\u0026#34;, \u0026#34;EmptyEntry\u0026#34;, } func (ct CommandType) String() string { return ctmap[ct] } è¯»å†™æœåŠ¡ è¯»å†™æ“ä½œçš„åŸºæœ¬é€»è¾‘ç›¸æ¯”äºMIT 6.824 Lab3 RaftKVåŸºæœ¬ä¸€è‡´ï¼Œéœ€è¦å¢åŠ åˆ†ç‰‡çŠ¶æ€åˆ¤æ–­ã€‚æ ¹æ®ä¸Šè¿°å®šä¹‰ï¼Œåˆ†ç‰‡çš„çŠ¶æ€ä¸º Serving æˆ– GCingï¼Œå½“å‰ raft ç»„åœ¨å½“å‰ config ä¸‹è´Ÿè´£ç®¡ç†æ­¤åˆ†ç‰‡ï¼Œæœ¬ raft ç»„æ‰å¯ä»¥ä¸ºè¯¥åˆ†ç‰‡æä¾›è¯»å†™æœåŠ¡ï¼Œå¦åˆ™è¿”å› ErrWrongGroup è®©å®¢æˆ·ç«¯é‡æ–°æ‹‰å–æœ€æ–°çš„ config å¹¶é‡è¯•å³å¯ã€‚\ncanServe çš„åˆ¤æ–­éœ€è¦åœ¨å‘ raft æäº¤å‰å’Œ apply æ—¶éƒ½æ£€æµ‹ä¸€éä»¥ä¿è¯æ­£ç¡®æ€§å¹¶å°½å¯èƒ½æå‡æ€§èƒ½ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 // canServe åˆ¤æ–­shard çš„çŠ¶æ€æ˜¯å¦å¯ä»¥å¯¹å¤–æœåŠ¡ // Serving é»˜è®¤åˆå§‹çŠ¶æ€, GCing è¡¨ç¤ºè¯¥shard çš„æ•°æ®åˆšåˆšæ‹‰å–å®Œæ¯•ï¼Œä½†æ˜¯éœ€è¦æ¸…é™¤ // è¿œç«¯ è¯¥shardId æ•°æ® func (kv *ShardKV) canServe(ShardId int) bool { return kv.currentConfig.Shards[ShardId] == kv.gid \u0026amp;\u0026amp; (kv.stateMachine[ShardId].Status == Serving || kv.stateMachine[ShardId].Status == GCing) } func (kv *ShardKV) Command(req *CommandRequest, resp *CommandResponse) { kv.mu.RLock() if req.Op != OpGet \u0026amp;\u0026amp; kv.isDuplicateRequest(req.ClientId, req.CommandId) { lastResp := kv.lastOperations[req.ClientId].LastResponse resp.Err = lastResp.Err resp.Value = lastResp.Value kv.mu.RUnlock() return } // return ErrWrongGroup directly to let client fetch latest configuration // and perform a retry if this key can\u0026#39;t be served by this shard at present if !kv.canServe(key2shard(req.Key)) { resp.Err = ErrWrongGroup resp.Value = \u0026#34;\u0026#34; kv.mu.RUnlock() return } kv.mu.RUnlock() kv.Execute(NewOperationCommand(req), resp) } // Execute shardKV æ‰§è¡Œç›¸å…³çš„RPC req func (kv *ShardKV) Execute(command Command, resp *CommandResponse) { // do not hold lock to improve throughput // when KVServer holds the lock to take snapshot, underlying raft can still commit raft logs index, _, isLeader := kv.rf.Start(command) if !isLeader { resp.Err = ErrWrongLeader return } defer DPrintf(\u0026#34;[Execute]-{Node: %v}-{Group: %v} process Command %v with CommandResponse %v\u0026#34;, kv.me, kv.gid, command, resp) kv.mu.Lock() ch := kv.getNotifyChan(index) kv.mu.Unlock() select { case res := \u0026lt;-ch: resp.Value, resp.Err = res.Value, res.Err case \u0026lt;-time.After(ExecuteTimeout): resp.Err = ErrTimeout } go func() { kv.mu.Lock() kv.deleteOutdatedNotifyChan(index) kv.mu.Unlock() }() } // applyOperation å¯¹çŠ¶æ€æœºçš„æ“ä½œ, Get, Put, Append func (kv *ShardKV) applyOperation(msg *raft.ApplyMsg, req *CommandRequest) *CommandResponse { var resp *CommandResponse shardId := key2shard(req.Key) if kv.canServe(shardId) { if req.Op != OpGet \u0026amp;\u0026amp; kv.isDuplicateRequest(req.ClientId, req.CommandId) { DPrintf(\u0026#34;[applyOperation]-{Node: %v}-{Group: %v} doesn\u0026#39;t apply duplicated message %v to stateMachine because maxAppliedCommandId is %v for client %v\u0026#34;, kv.me, kv.gid, kv.lastOperations[req.ClientId], kv.lastApplied, req.ClientId) lastResp := kv.lastOperations[req.ClientId].LastResponse return lastResp } resp = kv.applyLogToStateMachines(req, shardId) if req.Op != OpGet { // save max command resp kv.lastOperations[req.ClientId] = OperationContext{ MaxAppliedCommandId: req.CommandId, LastResponse: resp, } } return resp } return \u0026amp;CommandResponse{ErrWrongGroup, \u0026#34;\u0026#34;} } é…ç½®æ›´æ–° é…ç½®æ›´æ–°åç¨‹è´Ÿè´£å®šæ—¶æ£€æµ‹æ‰€æœ‰åˆ†ç‰‡çš„çŠ¶æ€ï¼Œä¸€æ—¦å­˜åœ¨è‡³å°‘ä¸€ä¸ªåˆ†ç‰‡çš„çŠ¶æ€ä¸ä¸ºé»˜è®¤çŠ¶æ€ï¼Œåˆ™é¢„ç¤ºå…¶ä»–åç¨‹ä»ç„¶è¿˜æ²¡æœ‰å®Œæˆä»»åŠ¡ï¼Œé‚£ä¹ˆæ­¤æ—¶éœ€è¦é˜»å¡æ–°é…ç½®çš„æ‹‰å–å’Œæäº¤ã€‚\nåœ¨ apply é…ç½®æ›´æ–°æ—¥å¿—æ—¶éœ€è¦ä¿è¯å¹‚ç­‰æ€§ï¼š\nä¸åŒç‰ˆæœ¬çš„é…ç½®æ›´æ–°æ—¥å¿—ï¼šapply æ—¶ä»…å¯é€æ­¥é€’å¢çš„å»æ›´æ–°é…ç½®ï¼Œå¦åˆ™è¿”å›å¤±è´¥ã€‚ ç›¸åŒç‰ˆæœ¬çš„é…ç½®æ›´æ–°æ—¥å¿—ï¼šç”±äºé…ç½®æ›´æ–°æ—¥å¿—ä»…ç”±é…ç½®æ›´æ–°åç¨‹æäº¤ï¼Œè€Œé…ç½®æ›´æ–°åç¨‹åªæœ‰æ£€æµ‹åˆ°æ¯”æœ¬åœ°æ›´å¤§åœ°é…ç½®æ—¶æ‰ä¼šæäº¤é…ç½®æ›´æ–°æ—¥å¿—ï¼Œæ‰€ä»¥è¯¥æƒ…å½¢ä¸ä¼šå‡ºç°ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 // configureAction kvctrller execute apply configuration func (kv *ShardKV) configureAction() { canPerformNextConfig := true kv.mu.RLock() for _, shard := range kv.stateMachine { if shard.Status != Serving { canPerformNextConfig = false DPrintf(\u0026#34;[configureAction]-{Node: %v}-{Group: %v} will not try to fetch latest configuration because shards status are %v when currentConfig is %v\u0026#34;, kv.me, kv.gid, kv.getShardStatus(), kv.currentConfig) break } } currentConfigNum := kv.currentConfig.Num kv.mu.RUnlock() if canPerformNextConfig { nextConfig := kv.sc.Query(currentConfigNum + 1) if nextConfig.Num == currentConfigNum+1 { DPrintf(\u0026#34;[configureAction]-{Node: %v}-{Group: %v} fetches latest configuration %v when currentConfigNum is %v\u0026#34;, kv.me, kv.gid, nextConfig, currentConfigNum) kv.Execute(NewConfigurationCommand(\u0026amp;nextConfig), \u0026amp;CommandResponse{}) } } } // applyConfiguration å¯¹kv controller çš„é…ç½®è¿›è¡Œæ›´æ–° func (kv *ShardKV) applyConfiguration(conf *shardctrler.Config) *CommandResponse { if conf.Num == kv.currentConfig.Num+1 { DPrintf(\u0026#34;[applyConfiguration]-{Node: %v}-{Group: %v} updates currentConfig from %v to %v\u0026#34;, kv.me, kv.gid, kv.currentConfig, conf) kv.updateShardStatus(conf) kv.lastConfig = kv.currentConfig kv.currentConfig = *conf return \u0026amp;CommandResponse{OK, \u0026#34;\u0026#34;} } DPrintf(\u0026#34;[applyConfiguration]-{Node: %v}-{Group: %v} rejects outdated config %v when currentConfig is %v\u0026#34;, kv.me, kv.gid, conf, kv.currentConfig) return \u0026amp;CommandResponse{ErrOutDated, \u0026#34;\u0026#34;} } åˆ†ç‰‡è¿ç§» åˆ†ç‰‡è¿ç§»åç¨‹è´Ÿè´£å®šæ—¶æ£€æµ‹åˆ†ç‰‡çš„ Pulling çŠ¶æ€ï¼Œåˆ©ç”¨ lastConfig è®¡ç®—å‡ºå¯¹åº” raft ç»„çš„ gid å’Œè¦æ‹‰å–çš„åˆ†ç‰‡ï¼Œç„¶åå¹¶è¡Œåœ°å»æ‹‰å–æ•°æ®ã€‚\næ³¨æ„è¿™é‡Œä½¿ç”¨äº† waitGroup æ¥ä¿è¯æ‰€æœ‰ç‹¬ç«‹åœ°ä»»åŠ¡å®Œæˆåæ‰ä¼šè¿›è¡Œä¸‹ä¸€æ¬¡ä»»åŠ¡ã€‚æ­¤å¤– wg.Wait() ä¸€å®šè¦åœ¨é‡Šæ”¾è¯»é”ä¹‹åï¼Œå¦åˆ™æ— æ³•æ»¡è¶³ challenge2 çš„è¦æ±‚ã€‚\nåœ¨æ‹‰å–åˆ†ç‰‡çš„ handler ä¸­ï¼Œé¦–å…ˆä»…å¯ç”± leader å¤„ç†è¯¥è¯·æ±‚ï¼Œå…¶æ¬¡å¦‚æœå‘ç°è¯·æ±‚ä¸­çš„é…ç½®ç‰ˆæœ¬å¤§äºæœ¬åœ°çš„ç‰ˆæœ¬ï¼Œé‚£è¯´æ˜è¯·æ±‚æ‹‰å–çš„æ˜¯æœªæ¥çš„æ•°æ®ï¼Œåˆ™è¿”å› ErrNotReady è®©å…¶ç¨åé‡è¯•ï¼Œå¦åˆ™å°†åˆ†ç‰‡æ•°æ®å’Œå»é‡è¡¨éƒ½æ·±åº¦æ‹·è´åˆ° response å³å¯ã€‚\nåœ¨ apply åˆ†ç‰‡æ›´æ–°æ—¥å¿—æ—¶éœ€è¦ä¿è¯å¹‚ç­‰æ€§ï¼š\nä¸åŒç‰ˆæœ¬çš„é…ç½®æ›´æ–°æ—¥å¿—ï¼šä»…å¯æ‰§è¡Œä¸å½“å‰é…ç½®ç‰ˆæœ¬ç›¸åŒåœ°åˆ†ç‰‡æ›´æ–°æ—¥å¿—ï¼Œå¦åˆ™è¿”å› ErrOutDatedã€‚ ç›¸åŒç‰ˆæœ¬çš„é…ç½®æ›´æ–°æ—¥å¿—ï¼šä»…åœ¨å¯¹åº”åˆ†ç‰‡çŠ¶æ€ä¸º Pulling æ—¶ä¸ºç¬¬ä¸€æ¬¡åº”ç”¨ï¼Œæ­¤æ—¶è¦†ç›–çŠ¶æ€æœºå³å¯å¹¶ä¿®æ”¹çŠ¶æ€ä¸º GCingï¼Œä»¥è®©åˆ†ç‰‡æ¸…ç†åç¨‹æ£€æµ‹åˆ° GCing çŠ¶æ€å¹¶å°è¯•åˆ é™¤è¿œç«¯çš„åˆ†ç‰‡ã€‚å¦åˆ™è¯´æ˜å·²ç»åº”ç”¨è¿‡ï¼Œç›´æ¥ break å³å¯ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 // migrationAction shard migration data when in Pulling status func (kv *ShardKV) migrationAction() { kv.mu.RLock() gid2shardIds := kv.getShardIdsByStatus(Pulling) var wg sync.WaitGroup for gid, shardIds := range gid2shardIds { DPrintf(\u0026#34;[migrationAction]-{Node: %v}-{Group: %v} starts a PullTask to get shards %v from group %v when config is %v\u0026#34;, kv.me, kv.gid, shardIds, gid, kv.currentConfig) wg.Add(1) go func(servers []string, configNum int, shardIds []int) { defer wg.Done() PullTaskRequest := ShardOperationRequest{ ConfigNum: configNum, ShardIDs: shardIds, } // æœ¬Node å‘Pulling Status çš„Shard æ‰€åœ¨Group çš„å…¨éƒ¨Server // å‘é€RPC ä½†æ˜¯åªæœ‰Leader æœ‰å“åº”ï¼Œå…¶ä»–å¿½ç•¥ for _, server := range servers { var pullTaskResp ShardOperationResponse srv := kv.makeEnd(server) DPrintf(\u0026#34;[migrationAction]-{Node: %v}-{Group: %v} server call %v\u0026#34;, kv.me, kv.gid, server) if srv.Call(\u0026#34;ShardKV.GetShardsData\u0026#34;, \u0026amp;PullTaskRequest, \u0026amp;pullTaskResp) \u0026amp;\u0026amp; pullTaskResp.Err == OK { DPrintf(\u0026#34;[migrationAction]-{Node: %v}-{Group: %v} gets a PullTaskResponse %v and tries to commit it when currentConfigNum is %v\u0026#34;, kv.me, kv.gid, pullTaskResp, configNum) kv.Execute(NewInsertShardsCommand(\u0026amp;pullTaskResp), \u0026amp;CommandResponse{}) } } }(kv.lastConfig.Groups[gid], kv.currentConfig.Num, shardIds) } kv.mu.RUnlock() wg.Wait() } // RPC GetShardsData ConfigOperation ç”Ÿæ•ˆä¹‹åæ•°æ®è¿ç§»ï¼Œ å°†request ä¸­shardIdçš„æ•°æ®ï¼Œè¿ç§»åˆ°respä¸­ è¿”å›ç»™è°ƒç”¨æ–¹ func (kv *ShardKV) GetShardsData(req *ShardOperationRequest, resp *ShardOperationResponse) { // ... } func (kv *ShardKV) applyInsertShards(shardsInfo *ShardOperationResponse) *CommandResponse { // ... } åˆ†ç‰‡æ¸…ç† åˆ†ç‰‡æ¸…ç†åç¨‹è´Ÿè´£å®šæ—¶æ£€æµ‹åˆ†ç‰‡çš„ GCing çŠ¶æ€ï¼Œåˆ©ç”¨ lastConfig è®¡ç®—å‡ºå¯¹åº” raft ç»„çš„ gid å’Œè¦æ‹‰å–çš„åˆ†ç‰‡ï¼Œç„¶åå¹¶è¡Œåœ°å»åˆ é™¤åˆ†ç‰‡ã€‚\næ³¨æ„è¿™é‡Œä½¿ç”¨äº† waitGroup æ¥ä¿è¯æ‰€æœ‰ç‹¬ç«‹åœ°ä»»åŠ¡å®Œæˆåæ‰ä¼šè¿›è¡Œä¸‹ä¸€æ¬¡ä»»åŠ¡ã€‚æ­¤å¤– wg.Wait() ä¸€å®šè¦åœ¨é‡Šæ”¾è¯»é”ä¹‹åï¼Œå¦åˆ™æ— æ³•æ»¡è¶³ challenge2 çš„è¦æ±‚ã€‚\nåœ¨åˆ é™¤åˆ†ç‰‡çš„ handler ä¸­ï¼Œé¦–å…ˆä»…å¯ç”± leader å¤„ç†è¯¥è¯·æ±‚ï¼Œå…¶æ¬¡å¦‚æœå‘ç°è¯·æ±‚ä¸­çš„é…ç½®ç‰ˆæœ¬å°äºæœ¬åœ°çš„ç‰ˆæœ¬ï¼Œé‚£è¯´æ˜è¯¥è¯·æ±‚å·²ç»æ‰§è¡Œè¿‡ï¼Œå¦åˆ™æœ¬åœ°çš„ config ä¹Ÿæ— æ³•å¢å¤§ï¼Œæ­¤æ—¶ç›´æ¥è¿”å› OK å³å¯ï¼Œå¦åˆ™åœ¨æœ¬åœ°æäº¤ä¸€ä¸ªåˆ é™¤åˆ†ç‰‡çš„æ—¥å¿—ã€‚\nåœ¨ apply åˆ†ç‰‡åˆ é™¤æ—¥å¿—æ—¶éœ€è¦ä¿è¯å¹‚ç­‰æ€§ï¼š\nä¸åŒç‰ˆæœ¬çš„é…ç½®æ›´æ–°æ—¥å¿—ï¼šä»…å¯æ‰§è¡Œä¸å½“å‰é…ç½®ç‰ˆæœ¬ç›¸åŒåœ°åˆ†ç‰‡åˆ é™¤æ—¥å¿—ï¼Œå¦åˆ™å·²ç»åˆ é™¤è¿‡ï¼Œç›´æ¥è¿”å› OK å³å¯ã€‚ ç›¸åŒç‰ˆæœ¬çš„é…ç½®æ›´æ–°æ—¥å¿—ï¼šå¦‚æœåˆ†ç‰‡çŠ¶æ€ä¸º GCingï¼Œè¯´æ˜æ˜¯æœ¬ raft ç»„å·²æˆåŠŸåˆ é™¤è¿œç«¯ raft ç»„çš„æ•°æ®ï¼Œç°éœ€è¦æ›´æ–°åˆ†ç‰‡çŠ¶æ€ä¸ºé»˜è®¤çŠ¶æ€ä»¥æ”¯æŒé…ç½®çš„è¿›ä¸€æ­¥æ›´æ–°ï¼›å¦åˆ™å¦‚æœåˆ†ç‰‡çŠ¶æ€ä¸º BePullingï¼Œåˆ™è¯´æ˜æœ¬ raft ç»„ç¬¬ä¸€æ¬¡åˆ é™¤è¯¥åˆ†ç‰‡çš„æ•°æ®ï¼Œæ­¤æ—¶ç›´æ¥é‡ç½®åˆ†ç‰‡å³å¯ã€‚å¦åˆ™è¯´æ˜è¯¥è¯·æ±‚å·²ç»åº”ç”¨è¿‡ï¼Œç›´æ¥ break è¿”å› OK å³å¯ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 // gcAction Pulling æ•°æ®ä¹‹åæŠŠçŠ¶æ€æ”¹ä¸ºGCingï¼Œè°ƒç”¨RPC åˆ é™¤è¿œç«¯çš„è¯¥ShardId çš„æ•°æ® func (kv *ShardKV) gcAction() { kv.mu.RLock() gid2shardIds := kv.getShardIdsByStatus(GCing) var wg sync.WaitGroup for gid, shardIds := range gid2shardIds { DPrintf(\u0026#34;[gcAction]-{Node: %v}-{Group: %v} starts a GCTask to delete shards %v in group %v when config is %v\u0026#34;, kv.me, kv.gid, shardIds, gid, kv.currentConfig) wg.Add(1) go func(servers []string, configNum int, shardIds []int) { defer wg.Done() gcTaskReq := ShardOperationRequest{ConfigNum: configNum, ShardIDs: shardIds} for _, server := range servers { var gcTaskResp ShardOperationResponse srv := kv.makeEnd(server) // è¿œç«¯æ‰§è¡Œåˆ é™¤æ•°æ®çš„é€»è¾‘ if srv.Call(\u0026#34;ShardKV.DeleteShardsData\u0026#34;, \u0026amp;gcTaskReq, \u0026amp;gcTaskResp) \u0026amp;\u0026amp; gcTaskResp.Err == OK { DPrintf(\u0026#34;[gcAction]-{Node: %v}-{Group: %v} deletes shards %v in remote group successfully when currentConfigNum is %v\u0026#34;, kv.me, kv.gid, shardIds, configNum) // è¿œç«¯åˆ é™¤å®Œæ•°æ®ä¹‹åï¼ŒRaft æœ¬èŠ‚ç‚¹åŒæ ·éœ€è¦ æŠŠGCing çŠ¶æ€æ¢å¤ä¸ºServer çŠ¶æ€ kv.Execute(NewDeleteShardsCommand(\u0026amp;gcTaskReq), \u0026amp;CommandResponse{}) } } }(kv.lastConfig.Groups[gid], kv.currentConfig.Num, shardIds) } kv.mu.RUnlock() wg.Wait() } // RPC DeleteShardsData åˆ é™¤è¿ç§»ä¹‹åçš„ shard ä¸­çš„æ•°æ® func (kv *ShardKV) DeleteShardsData(req *ShardOperationRequest, resp *ShardOperationResponse) { if _, isLeader := kv.rf.GetState(); !isLeader { resp.Err = ErrWrongLeader return } defer DPrintf(\u0026#34;[DeleteShardsData]-{Node: %v}-{Group: %v} processes GCTaskRequest %v with response %v\u0026#34;, kv.me, kv.gid, req, resp) kv.mu.RLock() if kv.currentConfig.Num \u0026gt; req.ConfigNum { DPrintf(\u0026#34;[DeleteShardsData]-{Node: %v}-{Group: %v} encounters duplicated shards deletions %v when currentConfig is %v\u0026#34;, kv.me, kv.gid, req, kv.currentConfig) resp.Err = OK kv.mu.RUnlock() return } kv.mu.RUnlock() var commandResp CommandResponse kv.Execute(NewDeleteShardsCommand(req), \u0026amp;commandResp) resp.Err = commandResp.Err } ç©ºæ—¥å¿—æ£€æµ‹ åˆ†ç‰‡æ¸…ç†åç¨‹è´Ÿè´£å®šæ—¶æ£€æµ‹ raft å±‚çš„ leader æ˜¯å¦æ‹¥æœ‰å½“å‰ term çš„æ—¥å¿—ï¼Œå¦‚æœæ²¡æœ‰åˆ™æäº¤ä¸€æ¡ç©ºæ—¥å¿—ï¼Œè¿™ä½¿å¾—æ–° leader çš„çŠ¶æ€æœºèƒ½å¤Ÿè¿…é€Ÿè¾¾åˆ°æœ€æ–°çŠ¶æ€ï¼Œä»è€Œé¿å…å¤š raft ç»„é—´çš„æ´»é”çŠ¶æ€ã€‚\n1 2 3 4 5 6 7 8 9 10 func (kv *ShardKV) checkEntryIncurrentTermAction() { if !kv.rf.HasLogInCurrentTerm() { kv.Execute(NewEmptyEntryCommand(), \u0026amp;CommandResponse{}) } } func (kv *ShardKV) applyEmptyEntry() *CommandResponse { return \u0026amp;CommandResponse{OK, \u0026#34;\u0026#34;} } é—®é¢˜ å‡ºç°éšæœºçš„get(x) != expect(x)è¿™ç§é”™è¯¯ï¼Œå¹¶ä¸”å‘ç”Ÿæƒ…å†µåœ¨raft stopåï¼ŒapplyInsertShardsä¹‹åï¼Œçœ‹èµ·æ¥åƒapplyä¸€ä¸ªduplicatedçš„msgï¼Œä»è€Œäº§ç”Ÿäº†get(x)=\u0026ldquo;xabbâ€ != expect(x)=\u0026ldquo;xabâ€ è¿™ä¸ªåˆ†æäº†å¾ˆä¹…ï¼Œå¹¶ä¸”é‡æ„äº†æ—¥å¿—ï¼Œè®©æ¯ä¸ªgidåœ¨ä¸€ä¸ªlogfileé‡Œã€‚æœ€åå‘ç°åŸå› ï¼šrafté‡å¯åï¼Œä¼šé‡æ–°applyæ‰€æœ‰logsï¼Œè¿™æ—¶config changeï¼Œå¼€å§‹pull shardsï¼Œå¾…insertShardså®Œæˆåã€‚raftæ”¶åˆ°è½åçš„commandï¼Œå¯¼è‡´åˆapplyäº†duplicateçš„æ•°æ®ã€‚\nè§£å†³æ–¹æ¡ˆï¼Œåœ¨applyInsertShardsåŒæ—¶ï¼Œå°†replyä¸­çš„lastOperationæ¥æ›´æ–°è‡ªå·±çš„sessionã€‚å› æ­¤ï¼Œå½“ä¸‹æ¬¡applyMsgæ¥çš„æ—¶å€™ï¼Œå°±å¯ä»¥æ ¹æ®clientçš„SequenceNumæ¥åˆ¤æ–­ æ˜¯å¦æ¥å—è¿™ä¸ªapplyMsgï¼Œé˜²æ­¢äº†duplicatedçš„msgã€‚\n","permalink":"https://reid00.github.io/en/posts/storage/20230214-mit6.824-2022-lab4-shardedkv/","summary":"ShardedKV ä»‹ç» æœ‰å…³ shardkvï¼Œå…¶å¯ä»¥ç®—æ˜¯ä¸€ä¸ª multi-raft çš„å®ç°ï¼Œåªæ˜¯ç¼ºå°‘äº†ç‰©ç†èŠ‚ç‚¹çš„æŠ½è±¡æ¦‚å¿µã€‚åœ¨å®é™…çš„ç”Ÿäº§ç³»ç»Ÿä¸­ï¼Œä¸åŒ raft ç»„çš„æˆå‘˜å¯èƒ½å­˜åœ¨äºä¸€ä¸ªç‰©ç†èŠ‚ç‚¹ä¸Šï¼Œè€Œä¸”ä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯ä¸€ä¸ªç‰©ç†èŠ‚ç‚¹æ‹¥æœ‰ä¸€ä¸ªçŠ¶æ€æœºï¼Œä¸åŒ raft ç»„ä½¿ç”¨ä¸åŒåœ°å‘½åç©ºé—´æˆ–å‰ç¼€æ¥æ“ä½œåŒä¸€ä¸ªçŠ¶æ€æœºã€‚åŸºäºæ­¤ï¼Œä¸‹æ–‡æ‰€æåˆ°çš„çš„èŠ‚ç‚¹éƒ½ä»£æŒ‡ raft ç»„çš„æŸä¸ªæˆå‘˜ï¼Œè€Œä¸ä»£æŒ‡æŸä¸ªç‰©ç†èŠ‚ç‚¹ã€‚æ¯”å¦‚èŠ‚ç‚¹å®•æœºä»£æŒ‡ raft ç»„çš„æŸä¸ªæˆå‘˜è¢« kill æ‰ï¼Œè€Œä¸æ˜¯æŒ‡æŸä¸ªç‰©ç†èŠ‚ç‚¹å®•æœºï¼Œä»è€Œå¯èƒ½å½±å“å¤šä¸ª raft çš„æˆå‘˜ã€‚\nåœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªå¸¦åˆ†ç‰‡çš„KVå­˜å‚¨ç³»ç»Ÿï¼Œå³ä¸€ç»„å‰¯æœ¬ç»„ä¸Šçš„é”®ã€‚æ¯ä¸€ä¸ªåˆ†ç‰‡éƒ½æ˜¯KVå¯¹çš„å­é›†ï¼Œä¾‹å¦‚ï¼Œæ‰€æœ‰ä»¥â€œaâ€å¼€å¤´çš„é”®å¯èƒ½æ˜¯ä¸€ä¸ªåˆ†ç‰‡ï¼Œæ‰€æœ‰ä»¥â€œbâ€å¼€å¤´çš„é”®å¯èƒ½æ˜¯å¦ä¸€ä¸ªåˆ†ç‰‡ã€‚ ä¹Ÿå¯ä»¥ç”¨range æˆ–è€…Hash ä¹‹ååˆ†åŒºã€‚ åˆ†ç‰‡çš„åŸå› æ˜¯æ€§èƒ½ã€‚æ¯ä¸ªreplica groupåªå¤„ç†å‡ ä¸ªåˆ†ç‰‡çš„ put å’Œ getï¼Œå¹¶ä¸”è¿™äº›ç»„å¹¶è¡Œæ“ä½œï¼›å› æ­¤ï¼Œç³»ç»Ÿæ€»ååé‡ï¼ˆæ¯å•ä½æ—¶é—´çš„æŠ•å…¥å’Œè·å–ï¼‰ä¸ç»„æ•°æˆæ¯”ä¾‹å¢åŠ ã€‚\næˆ‘ä»¬çš„æ•´ä¸ªç³»ç»Ÿæœ‰ä¸¤ä¸ªåŸºæœ¬ç»„ä»¶ï¼šshard controller å’Œ shard groupã€‚æ•´ä¸ªç³»ç»Ÿæœ‰ä¸€ä¸ª controller å’Œå¤šä¸ª groupï¼Œcontroller å•ç‹¬ä¸€ä¸ª raft é›†ç¾¤ï¼Œæ¯ä¸€ä¸ª shard group æ˜¯ç”± kvraft å®ä¾‹æ„æˆçš„é›†ç¾¤ã€‚shard controller è´Ÿè´£è°ƒåº¦ï¼Œå®¢æˆ·ç«¯å‘ shard controller å‘é€è¯·æ±‚ï¼Œcontroller ä¼šæ ¹æ®é…ç½®(config)æ¥å‘ŠçŸ¥å®¢æˆ·ç«¯æœåŠ¡è¿™ä¸ª key çš„æ˜¯å“ªä¸ª groupã€‚ æ¯ä¸ª group è´Ÿè´£éƒ¨åˆ† shardã€‚\n1 2 3 4 5 type Config struct { Num int // config number, version also Shards [NShards]int // shard -\u0026gt; gid Groups map[int][]string // gid -\u0026gt; servers[] } ä¸‰ä¸ªå‚æ•°åˆ†åˆ«å¯¹åº”çš„ç‰ˆæœ¬çš„é…ç½®å·ï¼Œåˆ†ç‰‡æ‰€å¯¹åº”çš„ç»„(Group)ä¿¡æ¯ï¼ˆå®éªŒä¸­çš„åˆ†ç‰‡ä¸º10ä¸ªï¼‰ï¼Œæ¯ä¸ªç»„å¯¹åº”çš„æœåŠ¡å™¨æ˜ å°„åç§°åˆ—è¡¨ï¼ˆä¹Ÿå°±æ˜¯ç»„ä¿¡æ¯ï¼‰ã€‚","title":"20230214 MIT6.824 2022 Lab4 ShardedKV"},{"content":"ä»‹ç» åœ¨lab2çš„Raftå‡½æ•°åº“ä¹‹ä¸Šï¼Œæ­å»ºä¸€ä¸ªèƒ½å¤Ÿå®¹é”™çš„key/valueå­˜å‚¨æœåŠ¡ï¼Œéœ€è¦æä¾›å¼ºä¸€è‡´æ€§ä¿è¯ã€‚\nå¼ºä¸€è‡´æ€§ä»‹ç» å¯¹äºå•ä¸ªè¯·æ±‚ï¼Œæ•´ä¸ªæœåŠ¡éœ€è¦è¡¨ç°å¾—åƒä¸ªå•æœºæœåŠ¡ï¼Œå¹¶ä¸”å¯¹çŠ¶æ€æœºçš„ä¿®æ”¹åŸºäºä¹‹å‰æ‰€æœ‰çš„è¯·æ±‚ã€‚å¯¹äºå¹¶å‘çš„è¯·æ±‚ï¼Œè¿”å›çš„å€¼å’Œæœ€ç»ˆçš„çŠ¶æ€å¿…é¡»ç›¸åŒï¼Œå°±å¥½åƒæ‰€æœ‰è¯·æ±‚éƒ½æ˜¯ä¸²è¡Œçš„ä¸€æ ·ã€‚å³ä½¿æœ‰äº›è¯·æ±‚å‘ç”Ÿåœ¨äº†åŒä¸€æ—¶é—´ï¼Œé‚£ä¹ˆä¹Ÿåº”å½“ä¸€ä¸ªä¸€ä¸ªå“åº”ã€‚æ­¤å¤–ï¼Œåœ¨ä¸€ä¸ªè¯·æ±‚è¢«æ‰§è¡Œä¹‹å‰ï¼Œè¿™ä¹‹å‰çš„è¯·æ±‚éƒ½å¿…é¡»å·²ç»è¢«å®Œæˆï¼ˆåœ¨æŠ€æœ¯ä¸Šæˆ‘ä»¬ä¹Ÿå«ç€çº¿æ€§åŒ–ï¼ˆlinearizabilityï¼‰ï¼‰ã€‚ kvæœåŠ¡æ”¯æŒä¸‰ç§æ“ä½œï¼šPut, Append, Getã€‚é€šè¿‡åœ¨å†…å­˜ç»´æŠ¤ä¸€ä¸ªç®€å•çš„é”®/å€¼å¯¹æ•°æ®åº“ï¼Œé”®å’Œå€¼éƒ½æ˜¯å­—ç¬¦ä¸²ï¼›\næ•´ä½“æ¶æ„ ç®€åŒ–æ¥çœ‹ åœ¨æ­£å¼å¼€å§‹å‰ï¼Œè¦äº†è§£è®ºæ–‡-extend-versionä¸­section 7å’Œ8çš„å†…å®¹ã€‚\nç›¸å…³çš„RPC åœ¨Raft ä½œè€…çš„åšå£«è®ºæ–‡ä¸­çš„6.3- Implementing linearizable semantics å°ç»“æœ‰å¾ˆè¯¦ç»†çš„ä»‹ç»ï¼Œå»ºè®®å…ˆé˜…è¯»ã€‚\nRPC Lab3A - ä¸éœ€è¦æ—¥å¿—å‹ç¼©çš„Key/ValueæœåŠ¡ è€ƒè™‘è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯æäº¤äº†ä¸€æ¡æ—¥å¿—ï¼ŒæœåŠ¡ç«¯å°†å…¶åœ¨ raft ç»„ä¸­è¿›è¡Œäº†åŒæ­¥å¹¶æˆåŠŸ commitï¼Œæ¥ç€åœ¨ apply åè¿”å›ç»™å®¢æˆ·ç«¯æ‰§è¡Œç»“æœã€‚ç„¶è€Œä¸å¹¸çš„æ˜¯ï¼Œè¯¥ rpc åœ¨ä¼ è¾“ä¸­å‘ç”Ÿäº†ä¸¢å¤±ï¼Œå®¢æˆ·ç«¯å¹¶æ²¡æœ‰æ”¶åˆ°å†™å…¥æˆåŠŸçš„å›å¤ã€‚å› æ­¤ï¼Œå®¢æˆ·ç«¯åªèƒ½è¿›è¡Œé‡è¯•ç›´åˆ°æ˜ç¡®åœ°å†™å…¥æˆåŠŸæˆ–å¤±è´¥ä¸ºæ­¢ï¼Œè¿™å°±å¯èƒ½ä¼šå¯¼è‡´ç›¸åŒåœ°å‘½ä»¤è¢«æ‰§è¡Œå¤šæ¬¡ï¼Œä»è€Œè¿èƒŒçº¿æ€§ä¸€è‡´æ€§ã€‚\næœ‰äººå¯èƒ½è®¤ä¸ºï¼Œåªè¦å†™è¯·æ±‚æ˜¯å¹‚ç­‰çš„ï¼Œé‚£é‡å¤æ‰§è¡Œå¤šæ¬¡ä¹Ÿæ˜¯å¯ä»¥æ»¡è¶³çº¿æ€§ä¸€è‡´æ€§çš„ï¼Œå®é™…ä¸Šåˆ™ä¸ç„¶ã€‚è€ƒè™‘è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼šå¯¹äºä¸€ä¸ªä»…æ”¯æŒ put å’Œ get æ¥å£çš„ raftKV ç³»ç»Ÿï¼Œå…¶æ¯ä¸ªè¯·æ±‚éƒ½å…·æœ‰å¹‚ç­‰æ€§ã€‚è®¾ x çš„åˆå§‹å€¼ä¸º 0ï¼Œæ­¤æ—¶æœ‰ä¸¤ä¸ªå¹¶å‘å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ 1 æ‰§è¡Œ put(x,1)ï¼Œå®¢æˆ·ç«¯ 2 æ‰§è¡Œ get(x) å†æ‰§è¡Œ put(x,2)ï¼Œé—®ï¼ˆå®¢æˆ·ç«¯ 2 è¯»åˆ°çš„å€¼ï¼Œx çš„æœ€ç»ˆå€¼ï¼‰æ˜¯å¤šå°‘ã€‚å¯¹äºçº¿æ€§ä¸€è‡´çš„ç³»ç»Ÿï¼Œç­”æ¡ˆå¯ä»¥æ˜¯ (0,1)ï¼Œ(0,2) æˆ– (1,2)ã€‚ç„¶è€Œï¼Œå¦‚æœå®¢æˆ·ç«¯ 1 æ‰§è¡Œ put è¯·æ±‚æ—¶å‘ç”Ÿäº†ä¸Šæ®µæè¿°çš„æƒ…å†µï¼Œç„¶åå®¢æˆ·ç«¯ 2 è¯»åˆ° x çš„å€¼ä¸º 1 å¹¶å°† x ç½®ä¸ºäº† 2ï¼Œæœ€åå®¢æˆ·ç«¯ 1 è¶…æ—¶é‡è¯•ä¸”å†æ¬¡å°† x ç½®ä¸º 1ã€‚å¯¹äºè¿™ç§åœºæ™¯ï¼Œç­”æ¡ˆæ˜¯ (1,1)ï¼Œè¿™å°±è¿èƒŒäº†çº¿æ€§ä¸€è‡´æ€§ã€‚å½’æ ¹ç©¶åº•è¿˜æ˜¯ç”±äºå¹‚ç­‰çš„ put(x,1) è¯·æ±‚åœ¨çŠ¶æ€æœºä¸Šæ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œæœ‰ä¸¤ä¸ª LZ ç‚¹ã€‚å› æ­¤ï¼Œå³ä½¿å†™è¯·æ±‚çš„ä¸šåŠ¡è¯­ä¹‰èƒ½å¤Ÿä¿è¯å¹‚ç­‰ï¼Œä¸è¿›è¡Œé¢å¤–çš„å¤„ç†è®©å…¶é‡å¤æ‰§è¡Œå¤šæ¬¡ä¹Ÿä¼šç ´åçº¿æ€§ä¸€è‡´æ€§ã€‚å½“ç„¶ï¼Œè¯»è¯·æ±‚ç”±äºä¸æ”¹å˜ç³»ç»Ÿçš„çŠ¶æ€ï¼Œé‡å¤æ‰§è¡Œå¤šæ¬¡æ˜¯æ²¡é—®é¢˜çš„ã€‚\nå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œraft ä½œè€…ä»‹ç»äº†æƒ³è¦å®ç°çº¿æ€§åŒ–è¯­ä¹‰ï¼Œå°±éœ€è¦ä¿è¯æ—¥å¿—ä»…è¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå³å®ƒå¯ä»¥è¢« commit å¤šæ¬¡ï¼Œä½†ä¸€å®šåªèƒ½ apply ä¸€æ¬¡ã€‚å…¶è§£å†³æ–¹æ¡ˆåŸæ–‡å¦‚ä¸‹ï¼š\nThe solution is for clients to assign unique serial numbers to every command. Then, the state machine tracks the latest serial number processed for each client, along with the associated response. If it receives a command whose serial number has already been executed, it responds immediately without re-executing the request.\næ€è·¯å¯ä»¥æ˜¯ï¼š\næ¯ä¸ª client éƒ½éœ€è¦ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå®ƒçš„æ¯ä¸ªä¸åŒå‘½ä»¤éœ€è¦æœ‰ä¸€ä¸ªé¡ºåºé€’å¢çš„ commandIdï¼ŒclientId å’Œè¿™ä¸ª commandIdï¼ŒclientId å¯ä»¥å”¯ä¸€ç¡®å®šä¸€ä¸ªä¸åŒçš„å‘½ä»¤ï¼Œä»è€Œä½¿å¾—å„ä¸ª raft èŠ‚ç‚¹å¯ä»¥è®°å½•ä¿å­˜å„å‘½ä»¤æ˜¯å¦å·²åº”ç”¨ä»¥åŠåº”ç”¨ä»¥åçš„ç»“æœã€‚ ä¹Ÿå¯ä»¥å‚è€ƒæ­¤å¤„dragonboat ä½œè€…è®¨è®º\nä¸ºä»€ä¹ˆè¦è®°å½•åº”ç”¨çš„ç»“æœï¼Ÿå› ä¸ºé€šè¿‡è¿™ç§æ–¹å¼åŒä¸€ä¸ªå‘½ä»¤çš„å¤šæ¬¡ apply æœ€ç»ˆåªä¼šå®é™…åº”ç”¨åˆ°çŠ¶æ€æœºä¸Šä¸€æ¬¡ï¼Œä¹‹åç›¸åŒå‘½ä»¤ apply çš„æ—¶å€™å®é™…ä¸Šæ˜¯ä¸åº”ç”¨åˆ°çŠ¶æ€æœºä¸Šçš„è€Œæ˜¯ç›´æ¥ä»ä¿å­˜çš„ç»“æœä¸­è¿”å›çš„ã€‚\nå¦‚æœé»˜è®¤ä¸€ä¸ªå®¢æˆ·ç«¯åªèƒ½ä¸²è¡Œæ‰§è¡Œè¯·æ±‚çš„è¯ï¼ŒæœåŠ¡ç«¯è¿™è¾¹åªéœ€è¦è®°å½•ä¸€ä¸ª mapï¼Œå…¶ key æ˜¯ clientIdï¼Œå…¶ value æ˜¯è¯¥ clientId æ‰§è¡Œçš„æœ€åä¸€æ¡æ—¥å¿—çš„ commandId å’ŒçŠ¶æ€æœºçš„è¾“å‡ºå³å¯CommandResponseã€‚\nå®¢æˆ·ç«¯ ä¸€ä¸ª client å¯ä»¥é€šè¿‡ä¸ºå…¶å¤„ç†çš„æ¯æ¡å‘½ä»¤é€’å¢ commandId çš„æ–¹å¼æ¥ç¡®ä¿ä¸åŒçš„å‘½ä»¤ä¸€å®šæœ‰ä¸åŒçš„ commandIdï¼Œå½“ç„¶ï¼ŒåŒä¸€æ¡å‘½ä»¤çš„ commandId åœ¨æ²¡æœ‰å¤„ç†å®Œæ¯•ä¹‹å‰ï¼Œå³æ˜ç¡®æ”¶åˆ°æœåŠ¡ç«¯çš„å†™å…¥æˆåŠŸæˆ–å¤±è´¥ä¹‹å‰æ˜¯ä¸èƒ½æ”¹å˜çš„ã€‚\nä»£ç å¦‚ä¸‹:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 package kvraft import ( \u0026#34;crypto/rand\u0026#34; \u0026#34;math/big\u0026#34; \u0026#34;6.824/labrpc\u0026#34; ) type Clerk struct { servers []*labrpc.ClientEnd // You will have to modify this struct. leaderId int64 // generated by nrand(), it would be better to use some distributed ID // generation algorithm that guarantees no conflicts clientId int64 commandId int64 // (clientId, commandId) defines a operation uniquely } func nrand() int64 { max := big.NewInt(int64(1) \u0026lt;\u0026lt; 62) bigx, _ := rand.Int(rand.Reader, max) x := bigx.Int64() return x } func MakeClerk(servers []*labrpc.ClientEnd) *Clerk { return \u0026amp;Clerk{ servers: servers, leaderId: 0, clientId: nrand(), commandId: 0, } } // fetch the current value for a key. // returns \u0026#34;\u0026#34; if the key does not exist. // keeps trying forever in the face of all other errors. // // you can send an RPC with code like this: // ok := ck.servers[i].Call(\u0026#34;KVServer.Get\u0026#34;, \u0026amp;args, \u0026amp;reply) // // the types of args and reply (including whether they are pointers) // must match the declared types of the RPC handler function\u0026#39;s // arguments. and reply must be passed as a pointer. func (ck *Clerk) Get(key string) string { // You will have to modify this function. return ck.Command(\u0026amp;CommandRequest{ Key: key, Op: OpGet, ClientId: ck.clientId, CommandId: ck.commandId, }) } func (ck *Clerk) Put(key string, value string) { ck.Command(\u0026amp;CommandRequest{ Key: key, Value: value, Op: OpPut, ClientId: ck.clientId, CommandId: ck.commandId, }) } func (ck *Clerk) Append(key string, value string) { ck.Command(\u0026amp;CommandRequest{ Key: key, Value: value, Op: OpAppend, ClientId: ck.clientId, CommandId: ck.commandId, }) } func (ck *Clerk) Command(req *CommandRequest) string { // req.ClientId, req.CommandId = ck.clientId, ck.commandId for { var resp CommandResponse if !ck.servers[ck.leaderId].Call(\u0026#34;KVServer.Command\u0026#34;, req, \u0026amp;resp) || resp.Err == ErrWrongLeader || resp.Err == ErrTimeout { // ä¸çŸ¥leader è½®è¯¢æ‰€æœ‰çš„server å°è¯•å‘å‡ºè¯·æ±‚ ck.leaderId = (ck.leaderId + 1) % int64(len(ck.servers)) continue } ck.commandId++ return resp.Value } } æœåŠ¡ç«¯ æ•´ä½“è¯·æ±‚é€»è¾‘å¦‚ä¸‹ï¼š Serverç»“æ„ä½“ä¸åˆå§‹åŒ–ä»£ç å®ç°ï¼š\nä¸€ä¸ªå­˜å‚¨kvçš„mapï¼Œå³çŠ¶æ€æœºï¼Œä½†è¿™é‡Œå®ç°ä¸€ä¸ªåŸºäºå†…å­˜ç‰ˆæœ¬KVå³å¯çš„ï¼Œä½†å®é™…ç”Ÿäº§ç¯å¢ƒä¸‹å¿…ç„¶ä¸å¯èƒ½æŠŠæ•°æ®å…¨éƒ¨å­˜åœ¨å†…å­˜å½“ä¸­ï¼Œç³»ç»Ÿå¾€å¾€é‡‡ç”¨çš„æ˜¯ LSM çš„æ¶æ„ï¼Œä¾‹å¦‚ RocksDB ç­‰ï¼ŒæŠ½è±¡æˆKVStateMachine çš„æ¥å£ã€‚ ä¸€ä¸ªèƒ½è®°å½•æŸä¸€ä¸ªå®¢æˆ·ç«¯æœ€åä¸€æ¬¡æ“ä½œåºå·å’Œåº”ç”¨ç»“æœçš„map lastOperations (ç±»æ¯”Nebula ä¸­çš„session ä½œç”¨) ä¸€ä¸ªèƒ½è®°å½•æ¯ä¸ªraftåŒæ­¥æ“ä½œç»“æœçš„map notifyChans 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 type KVServer struct { mu sync.RWMutex me int rf *raft.Raft applyCh chan raft.ApplyMsg dead int32 // set by Kill() maxRaftState int // snapshot if log grows this big // Your definitions here. lastApplied int // record the lastApplied index to prevent stateMachine from rollback stateMachine KVStateMachine // KV stateMachine // å®¢æˆ·ç«¯idæœ€åçš„å‘½ä»¤idå’Œå›å¤å†…å®¹ ï¼ˆclientIdï¼Œ{æœ€åçš„commdIdï¼Œæœ€åçš„LastReply}ï¼‰ lastOperations map[int64]OperationContext // Leaderå›å¤ç»™å®¢æˆ·ç«¯çš„å“åº”ï¼ˆLogIndexï¼Œ CommandResponse notifyChans map[int]chan *CommandResponse } åº”ç”¨åˆ°çŠ¶æ€æœºçš„æµç¨‹ kv.applieråç¨‹ï¼šå•ç‹¬å¼€ä¸€ä¸ªgoroutineæ¥è¿œç¨‹ç›‘å¬ Raft çš„apply channelï¼Œä¸€æ—¦åº•å±‚çš„Raft commitä¸€ä¸ªåˆ°apply channelï¼ŒçŠ¶æ€æœºå°±ç«‹é©¬æ‰§è¡Œä¸”é€šè¿‡ commandIndex(å³raft ä¸­çš„CommitIndex) é€šçŸ¥åˆ°è¯¥å®¢æˆ·ç«¯çš„NotifyChan, Commandå‡½æ•°å–æ¶ˆé˜»å¡è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\nè¦ç‚¹:\nraftåŒæ­¥å®Œæˆåï¼Œä¹Ÿéœ€è¦åˆ¤æ–­è¯·æ±‚æ˜¯å¦ä¸ºé‡å¤è¯·æ±‚ã€‚å› ä¸ºåŒä¸€è¯·æ±‚å¯èƒ½ç”±äºé‡è¯•ä¼šè¢«åŒæ­¥å¤šæ¬¡ã€‚ å¯¹äºå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œrpc æ¡†æ¶ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªåç¨‹å»å¤„ç†é€»è¾‘ã€‚å› æ­¤ï¼Œéœ€è¦è€ƒè™‘æ¸…æ¥šè¿™äº›åç¨‹ä¹‹é—´çš„é€šä¿¡å…³ç³»ã€‚ä¸ºæ­¤ï¼Œæˆ‘çš„å®ç°æ˜¯å®¢æˆ·ç«¯åç¨‹å°†æ—¥å¿—æ”¾å…¥ raft å±‚å»åŒæ­¥åå³æ³¨å†Œä¸€ä¸ª channel å»é˜»å¡ç­‰å¾…ï¼Œæ¥ç€ apply åç¨‹ç›‘æ§ applyChï¼Œåœ¨å¾—åˆ° raft å±‚å·²ç» commit çš„æ—¥å¿—åï¼Œapply åç¨‹é¦–å…ˆå°†å…¶ apply åˆ°çŠ¶æ€æœºä¸­ï¼Œæ¥ç€æ ¹æ® index å¾—åˆ°å¯¹åº”çš„ channel ï¼Œæœ€åå°†çŠ¶æ€æœºæ‰§è¡Œçš„ç»“æœ push åˆ° channel ä¸­ï¼Œè¿™ä½¿å¾—å®¢æˆ·ç«¯åç¨‹èƒ½å¤Ÿè§£é™¤é˜»å¡å¹¶å›å¤ç»“æœç»™å®¢æˆ·ç«¯ ä¸ºäº†ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œä»…å¯¹å½“å‰ term æ—¥å¿—çš„ notifyChan è¿›è¡Œé€šçŸ¥ï¼Œè®©ä¹‹å‰ term çš„å®¢æˆ·ç«¯åç¨‹éƒ½è¶…æ—¶é‡è¯•ã€‚é¿å…leader é™çº§ä¸º follower ååˆè¿…é€Ÿé‡æ–°å½“é€‰äº† leaderï¼Œè€Œæ­¤æ—¶ä¾ç„¶æœ‰å®¢æˆ·ç«¯åç¨‹æœªè¶…æ—¶åœ¨é˜»å¡ç­‰å¾…ï¼Œé‚£ä¹ˆæ­¤æ—¶ apply æ—¥å¿—åï¼Œæ ¹æ® index è·å¾— channel å¹¶å‘å…¶ä¸­ push æ‰§è¡Œç»“æœå°±å¯èƒ½å‡ºé”™ï¼Œå› ä¸ºå¯èƒ½å¹¶ä¸å¯¹åº”ã€‚ åœ¨ç›®å‰çš„å®ç°ä¸­ï¼Œè¯»ï¼ˆGetï¼‰è¯·æ±‚ä¹Ÿä¼šç”Ÿæˆä¸€æ¡ raft æ—¥å¿—å»åŒæ­¥ï¼Œæœ€ç®€å•ç²—æš´çš„æ–¹å¼ä¿è¯çº¿æ€§ä¸€è‡´æ€§ï¼Œå³LogReadæ–¹æ³•ã€‚ä½†æ˜¯ï¼Œè¿™æ ·å­å®ç°çš„è¯»æ€§èƒ½ä¼šç›¸å½“çš„å·®ï¼Œå®é™…ç”Ÿäº§çº§åˆ«çš„ raft è¯»è¯·æ±‚å®ç°ä¸€èˆ¬éƒ½é‡‡ç”¨äº† Read Index æˆ–è€… Lease Read çš„æ–¹å¼ï¼Œå…·ä½“åŸç†å¯ä»¥å‚è€ƒæ­¤çº¿æ€§ä¸€è‡´æ€§åšå®¢ï¼Œå…·ä½“å®ç°å¯ä»¥å‚ç…§ SOFAJRaft çš„å®ç°åšå®¢ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 func (kv *KVServer) applier() { for !kv.killed() { for msg := range kv.applyCh { DPrintf(\u0026#34;[applier] - {Node: %v} tries to apply message %v\u0026#34;, kv.rf.Me(), msg) if msg.CommandValid { kv.mu.Lock() if msg.CommandIndex \u0026lt;= kv.lastApplied { DPrintf(\u0026#34;[applier] - {Node: %v} discards outdated message %v since a newer snapshot which lastapplied is %v has been restored\u0026#34;, kv.rf.Me(), msg, kv.lastApplied) kv.mu.Unlock() continue } kv.lastApplied = msg.CommandIndex var resp = new(CommandResponse) command := msg.Command.(Command) if command.Op != OpGet \u0026amp;\u0026amp; kv.isDuplicatedReq(command.ClientId, command.CommandId) { DPrintf(\u0026#34;[applier] - {Node: %v} doesn\u0026#39;t apply duplicated message %v to state machine since maxAppliedCommandId is %v for client %v\u0026#34;, kv.rf.Me(), msg, kv.lastOperations[command.ClientId], command.ClientId) resp = kv.lastOperations[command.ClientId].LastResponse } else { resp = kv.applyLogToStateMachine(command) if command.Op != OpGet { kv.lastOperations[command.ClientId] = OperationContext{ MaxAppliedCommandId: command.CommandId, LastResponse: resp, } } } // è®°å½•æ¯ä¸ªidx apply åˆ°state machine çš„ CommandResponse // ä¸ºäº†ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œä»…å¯¹å½“å‰ term æ—¥å¿—çš„ notifyChan è¿›è¡Œé€šçŸ¥ï¼Œ // è®©ä¹‹å‰ term çš„å®¢æˆ·ç«¯åç¨‹éƒ½è¶…æ—¶é‡è¯•ã€‚é¿å…leader é™çº§ä¸º follower // ååˆè¿…é€Ÿé‡æ–°å½“é€‰äº† leaderï¼Œè€Œæ­¤æ—¶ä¾ç„¶æœ‰å®¢æˆ·ç«¯åç¨‹æœªè¶…æ—¶åœ¨é˜»å¡ç­‰å¾…ï¼Œ // é‚£ä¹ˆæ­¤æ—¶ apply æ—¥å¿—åï¼Œæ ¹æ® index è·å¾— channel å¹¶å‘å…¶ä¸­ push æ‰§è¡Œç»“æœå°±å¯èƒ½å‡ºé”™ï¼Œå› ä¸ºå¯èƒ½å¹¶ä¸å¯¹åº” if currentTerm, isLeader := kv.rf.GetState(); isLeader \u0026amp;\u0026amp; msg.CommandTerm == currentTerm { ch := kv.getNotifyChan(msg.CommandIndex) ch \u0026lt;- resp } // part 2 needSnapshot := kv.needSnapshot() if needSnapshot { kv.takeSnapshot(msg.CommandIndex) } kv.mu.Unlock() } else if msg.SnapshotValid { kv.mu.Lock() if kv.rf.CondInstallSnapshot(msg.SnapshotTerm, msg.SnapshotIndex, msg.Snapshot) { kv.restoreSnapshot(msg.Snapshot) kv.lastApplied = msg.SnapshotIndex } kv.mu.Unlock() } else { panic(fmt.Sprintf(\u0026#34;unexpected Message: %v\u0026#34;, msg)) } } } } leader æ¯” follower å¤šå‡ºä¸€ä¸ª notifyChan ç¯èŠ‚ï¼Œæ˜¯å› ä¸º leader éœ€è¦å¤„ç† rpc è¯·æ±‚å“åº”ï¼Œè€Œ follower ä¸ç”¨ï¼Œä¸€ä¸ªå¾ˆç®€å•çš„æµç¨‹å…¶å®å°±æ˜¯ client -\u0026gt; kvservice -\u0026gt; Start() -\u0026gt; applyCh -\u0026gt; kvservice -\u0026gt; clientï¼Œä½†æ˜¯applyChæ˜¯é€ä¸ª commit ä¸€ä¸ªä¸€ä¸ªè¿”å›ï¼Œæ‰€ä»¥éœ€è¦æ˜ç¡®è¿”å›çš„ commit å¯¹åº”çš„æ˜¯å“ªä¸€ä¸ªè¯·æ±‚ï¼Œå³é€šè¿‡ commitIndexå”¯ä¸€ç¡®å®šä¸€ä¸ªè¯·æ±‚ï¼Œç„¶åé€šçŸ¥è¯¥è¯·æ±‚æ‰§è¡Œæµç¨‹å¯ä»¥è¿”å›äº†ã€‚\nå¯¹äºè¯»è¯·æ±‚ï¼Œç”±äºå…¶ä¸å½±å“ç³»ç»ŸçŠ¶æ€ï¼Œæ‰€ä»¥ç›´æ¥å»çŠ¶æ€æœºæ‰§è¡Œå³å¯ï¼Œå½“ç„¶ï¼Œå…¶ç»“æœä¹Ÿä¸éœ€è¦å†è®°å½•åˆ°å»é‡çš„æ•°æ®ç»“æ„ä¸­ã€‚\nCommandRPC é€»è¾‘ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 // Command å®¢æˆ·ç«¯è°ƒç”¨çš„RPCæ–¹æ³• func (kv *KVServer) Command(req *CommandRequest, resp *CommandResponse) { defer DPrintf(\u0026#34;[Command]- {Node: %v} processes CommandReq %v with CommandResp %v\u0026#34;, kv.rf.Me(), req, resp) // å¦‚æœè¯·æ±‚æ˜¯é‡å¤çš„ï¼Œç›´æ¥åœ¨ OperationContext ä¸­æ‹¿åˆ°ä¹‹å‰çš„ç»“æœè¿”å› kv.mu.RLock() if req.Op != OpGet \u0026amp;\u0026amp; kv.isDuplicatedReq(req.ClientId, req.CommandId) { lastResp := kv.lastOperations[req.ClientId].LastResponse resp.Value, resp.Err = lastResp.Value, lastResp.Err kv.mu.RUnlock() return } kv.mu.RUnlock() idx, _, isLeader := kv.rf.Start(Command{req}) if !isLeader { resp.Err = ErrWrongLeader return } kv.mu.Lock() ch := kv.getNotifyChan(idx) kv.mu.Unlock() select { case result := \u0026lt;-ch: resp.Value, resp.Err = result.Value, result.Err case \u0026lt;-time.After(ExecuteTimeOut): resp.Err = ErrTimeout } go func() { kv.mu.Lock() kv.removeOutdatedNotifyChan(idx) kv.mu.Unlock() }() } Lab3B - æ—¥å¿—å‹ç¼© é¦–å…ˆï¼Œæ—¥å¿—çš„ snapshot ä¸ä»…éœ€è¦åŒ…å«çŠ¶æ€æœºçš„çŠ¶æ€ï¼Œè¿˜éœ€è¦åŒ…å«ç”¨æ¥å»é‡çš„ lastOperations å“ˆå¸Œè¡¨ã€‚\nå…¶æ¬¡ï¼Œapply åç¨‹è´Ÿè´£æŒé”é˜»å¡å¼çš„å»ç”Ÿæˆ snapshotï¼Œå¹¸è¿çš„æ˜¯ï¼Œæ­¤æ—¶ raft æ¡†æ¶æ˜¯ä¸é˜»å¡çš„ï¼Œä¾ç„¶å¯ä»¥åŒæ­¥å¹¶æäº¤æ—¥å¿—ï¼Œåªæ˜¯ä¸ apply è€Œå·²ã€‚å¦‚æœè¿™é‡Œè¿˜æƒ³è¿›ä¸€æ­¥ä¼˜åŒ–çš„è¯ï¼Œå¯ä»¥å°†çŠ¶æ€æœºææˆ MVCC ç­‰èƒ½å¤Ÿ COW çš„æœºåˆ¶ï¼Œè¿™æ ·åº”è¯¥å°±å¯ä»¥ä¸é˜»å¡çŠ¶æ€æœºçš„æ›´æ–°äº†\nä¼˜åŒ–: é¡¹ç›®ä¸­ LastOperations å’Œ NotifyChan éƒ½æ˜¯ä½¿ç”¨map ä¸èƒ½å¹¶å‘å®‰å…¨ï¼Œç”¨äº†ä¸€å¼ å¤§é”ä¿å¹³å®‰ã€‚ å®é™…ä¸Šå¯ä»¥ä½¿ç”¨Sync.Map ç„¶åå°†é”çš„ç²’åº¦ç»†åŒ–æ¥ä¼˜åŒ–è¿™å—\n","permalink":"https://reid00.github.io/en/posts/storage/mit6.824-2022-lab3-raftkv/","summary":"ä»‹ç» åœ¨lab2çš„Raftå‡½æ•°åº“ä¹‹ä¸Šï¼Œæ­å»ºä¸€ä¸ªèƒ½å¤Ÿå®¹é”™çš„key/valueå­˜å‚¨æœåŠ¡ï¼Œéœ€è¦æä¾›å¼ºä¸€è‡´æ€§ä¿è¯ã€‚\nå¼ºä¸€è‡´æ€§ä»‹ç» å¯¹äºå•ä¸ªè¯·æ±‚ï¼Œæ•´ä¸ªæœåŠ¡éœ€è¦è¡¨ç°å¾—åƒä¸ªå•æœºæœåŠ¡ï¼Œå¹¶ä¸”å¯¹çŠ¶æ€æœºçš„ä¿®æ”¹åŸºäºä¹‹å‰æ‰€æœ‰çš„è¯·æ±‚ã€‚å¯¹äºå¹¶å‘çš„è¯·æ±‚ï¼Œè¿”å›çš„å€¼å’Œæœ€ç»ˆçš„çŠ¶æ€å¿…é¡»ç›¸åŒï¼Œå°±å¥½åƒæ‰€æœ‰è¯·æ±‚éƒ½æ˜¯ä¸²è¡Œçš„ä¸€æ ·ã€‚å³ä½¿æœ‰äº›è¯·æ±‚å‘ç”Ÿåœ¨äº†åŒä¸€æ—¶é—´ï¼Œé‚£ä¹ˆä¹Ÿåº”å½“ä¸€ä¸ªä¸€ä¸ªå“åº”ã€‚æ­¤å¤–ï¼Œåœ¨ä¸€ä¸ªè¯·æ±‚è¢«æ‰§è¡Œä¹‹å‰ï¼Œè¿™ä¹‹å‰çš„è¯·æ±‚éƒ½å¿…é¡»å·²ç»è¢«å®Œæˆï¼ˆåœ¨æŠ€æœ¯ä¸Šæˆ‘ä»¬ä¹Ÿå«ç€çº¿æ€§åŒ–ï¼ˆlinearizabilityï¼‰ï¼‰ã€‚ kvæœåŠ¡æ”¯æŒä¸‰ç§æ“ä½œï¼šPut, Append, Getã€‚é€šè¿‡åœ¨å†…å­˜ç»´æŠ¤ä¸€ä¸ªç®€å•çš„é”®/å€¼å¯¹æ•°æ®åº“ï¼Œé”®å’Œå€¼éƒ½æ˜¯å­—ç¬¦ä¸²ï¼›\næ•´ä½“æ¶æ„ ç®€åŒ–æ¥çœ‹ åœ¨æ­£å¼å¼€å§‹å‰ï¼Œè¦äº†è§£è®ºæ–‡-extend-versionä¸­section 7å’Œ8çš„å†…å®¹ã€‚\nç›¸å…³çš„RPC åœ¨Raft ä½œè€…çš„åšå£«è®ºæ–‡ä¸­çš„6.3- Implementing linearizable semantics å°ç»“æœ‰å¾ˆè¯¦ç»†çš„ä»‹ç»ï¼Œå»ºè®®å…ˆé˜…è¯»ã€‚\nRPC Lab3A - ä¸éœ€è¦æ—¥å¿—å‹ç¼©çš„Key/ValueæœåŠ¡ è€ƒè™‘è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯æäº¤äº†ä¸€æ¡æ—¥å¿—ï¼ŒæœåŠ¡ç«¯å°†å…¶åœ¨ raft ç»„ä¸­è¿›è¡Œäº†åŒæ­¥å¹¶æˆåŠŸ commitï¼Œæ¥ç€åœ¨ apply åè¿”å›ç»™å®¢æˆ·ç«¯æ‰§è¡Œç»“æœã€‚ç„¶è€Œä¸å¹¸çš„æ˜¯ï¼Œè¯¥ rpc åœ¨ä¼ è¾“ä¸­å‘ç”Ÿäº†ä¸¢å¤±ï¼Œå®¢æˆ·ç«¯å¹¶æ²¡æœ‰æ”¶åˆ°å†™å…¥æˆåŠŸçš„å›å¤ã€‚å› æ­¤ï¼Œå®¢æˆ·ç«¯åªèƒ½è¿›è¡Œé‡è¯•ç›´åˆ°æ˜ç¡®åœ°å†™å…¥æˆåŠŸæˆ–å¤±è´¥ä¸ºæ­¢ï¼Œè¿™å°±å¯èƒ½ä¼šå¯¼è‡´ç›¸åŒåœ°å‘½ä»¤è¢«æ‰§è¡Œå¤šæ¬¡ï¼Œä»è€Œè¿èƒŒçº¿æ€§ä¸€è‡´æ€§ã€‚\næœ‰äººå¯èƒ½è®¤ä¸ºï¼Œåªè¦å†™è¯·æ±‚æ˜¯å¹‚ç­‰çš„ï¼Œé‚£é‡å¤æ‰§è¡Œå¤šæ¬¡ä¹Ÿæ˜¯å¯ä»¥æ»¡è¶³çº¿æ€§ä¸€è‡´æ€§çš„ï¼Œå®é™…ä¸Šåˆ™ä¸ç„¶ã€‚è€ƒè™‘è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼šå¯¹äºä¸€ä¸ªä»…æ”¯æŒ put å’Œ get æ¥å£çš„ raftKV ç³»ç»Ÿï¼Œå…¶æ¯ä¸ªè¯·æ±‚éƒ½å…·æœ‰å¹‚ç­‰æ€§ã€‚è®¾ x çš„åˆå§‹å€¼ä¸º 0ï¼Œæ­¤æ—¶æœ‰ä¸¤ä¸ªå¹¶å‘å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ 1 æ‰§è¡Œ put(x,1)ï¼Œå®¢æˆ·ç«¯ 2 æ‰§è¡Œ get(x) å†æ‰§è¡Œ put(x,2)ï¼Œé—®ï¼ˆå®¢æˆ·ç«¯ 2 è¯»åˆ°çš„å€¼ï¼Œx çš„æœ€ç»ˆå€¼ï¼‰æ˜¯å¤šå°‘ã€‚å¯¹äºçº¿æ€§ä¸€è‡´çš„ç³»ç»Ÿï¼Œç­”æ¡ˆå¯ä»¥æ˜¯ (0,1)ï¼Œ(0,2) æˆ– (1,2)ã€‚ç„¶è€Œï¼Œå¦‚æœå®¢æˆ·ç«¯ 1 æ‰§è¡Œ put è¯·æ±‚æ—¶å‘ç”Ÿäº†ä¸Šæ®µæè¿°çš„æƒ…å†µï¼Œç„¶åå®¢æˆ·ç«¯ 2 è¯»åˆ° x çš„å€¼ä¸º 1 å¹¶å°† x ç½®ä¸ºäº† 2ï¼Œæœ€åå®¢æˆ·ç«¯ 1 è¶…æ—¶é‡è¯•ä¸”å†æ¬¡å°† x ç½®ä¸º 1ã€‚å¯¹äºè¿™ç§åœºæ™¯ï¼Œç­”æ¡ˆæ˜¯ (1,1)ï¼Œè¿™å°±è¿èƒŒäº†çº¿æ€§ä¸€è‡´æ€§ã€‚å½’æ ¹ç©¶åº•è¿˜æ˜¯ç”±äºå¹‚ç­‰çš„ put(x,1) è¯·æ±‚åœ¨çŠ¶æ€æœºä¸Šæ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œæœ‰ä¸¤ä¸ª LZ ç‚¹ã€‚å› æ­¤ï¼Œå³ä½¿å†™è¯·æ±‚çš„ä¸šåŠ¡è¯­ä¹‰èƒ½å¤Ÿä¿è¯å¹‚ç­‰ï¼Œä¸è¿›è¡Œé¢å¤–çš„å¤„ç†è®©å…¶é‡å¤æ‰§è¡Œå¤šæ¬¡ä¹Ÿä¼šç ´åçº¿æ€§ä¸€è‡´æ€§ã€‚å½“ç„¶ï¼Œè¯»è¯·æ±‚ç”±äºä¸æ”¹å˜ç³»ç»Ÿçš„çŠ¶æ€ï¼Œé‡å¤æ‰§è¡Œå¤šæ¬¡æ˜¯æ²¡é—®é¢˜çš„ã€‚","title":"MIT6.824 2022 Lab3 RaftKV"},{"content":"ä»‹ç» linearizable read ç®€å•çš„è¯´å°±æ˜¯ä¸è¿”å› stale æ•°æ®ï¼Œå…·ä½“å¯ä»¥å‚è€ƒStrong consistency models\nRead Index æœºåˆ¶å°±æ˜¯ Leader åœ¨æ”¶åˆ°è¯»è¯·æ±‚æ—¶è¿›è¡Œå¦‚ä¸‹å‡ æ­¥ï¼š\nå¦‚æœ Leader åœ¨å½“å‰ä»»æœŸè¿˜æ²¡æœ‰æäº¤è¿‡æ—¥å¿—ï¼Œå…ˆæäº¤ä¸€æ¡ç©ºæ—¥å¿— Leader ä¿å­˜è®°å½•å½“å‰ commit index ä½œä¸º readIndex é€šè¿‡å¿ƒè·³ï¼Œè¯¢é—®æˆå‘˜è‡ªå·±è¿˜æ˜¯ä¸æ˜¯ Leaderï¼Œå¦‚æœæ”¶åˆ°è¿‡åŠçš„ç¡®è®¤ï¼Œåˆ™å¯ç¡®ä¿¡è‡ªå·±ä»æ˜¯ Leader ç­‰å¾… Apply Index è¶…è¿‡ readIndex è¯»å–æ•°æ®ï¼Œå“åº” Client etcdä¸ä»…å®ç°äº†leaderä¸Šçš„read only queryï¼ŒåŒæ—¶ä¹Ÿå®ç°äº†followerä¸Šçš„read only queryï¼ŒåŸç†æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡è¯»è¯·æ±‚åˆ°è¾¾followeræ—¶ï¼Œcommit indexæ˜¯éœ€è¦å‘leaderå»è¦çš„ï¼Œleaderè¿”å›commit indexç»™followerä¹‹å‰ï¼ŒåŒæ ·ï¼Œéœ€è¦èµ°ä¸Šé¢çš„ReadIndexæµç¨‹ï¼Œå› ä¸ºleaderåŒæ ·éœ€è¦checkè‡ªå·±åˆ°åº•è¿˜æ˜¯ä¸æ˜¯leader\nReadIndex æ€è·¯ åœ¨è®ºæ–‡ä¸­ ç¬¬å…«èŠ‚ï¼Œpage13 æœ‰æåˆ°è¿‡å¤§æ¦‚æ€è·¯:\nRead-only operations can be handled without writing anything into the log. However, with no additional measures, this would run the risk of returning stale data, since the leader responding to the request might have been superseded by a newer leader of which it is unaware. Linearizable reads must not return stale data, and Raft needs two extra precautions to guarantee this without using the log. First, a leader must have the latest information on which entries are committed. The Leader Completeness Property guarantees that a leader has all committed entries, but at the start of its term, it may not know which those are. To find out, it needs to commit an entry from its term. Raft handles this by having each leader commit a blank no-op entry into the log at the start of its term. Second, a leader must check whether it has been deposed before processing a read-only request (its information may be stale if a more recent leader has been elected). Raft handles this by having the leader exchange heartbeat messages with a majority of the cluster before responding to read-only requests. Alternatively, the leader could rely on the heartbeat mechanism to provide a form of lease [9], but this would rely on timing for safety (it assumes bounded clock skew).\nåœ¨æ”¶åˆ°è¯»è¯·æ±‚æ—¶ï¼Œleader èŠ‚ç‚¹ä¿å­˜ä¸‹å½“å‰çš„ commit indexï¼Œå¹¶å¾€ peers å‘é€å¿ƒè·³ã€‚å¦‚æœç¡®å®šè¯¥èŠ‚ç‚¹ä¾ç„¶æ˜¯ leaderï¼Œåˆ™åªéœ€è¦ç­‰åˆ°è¯¥ commit index çš„ log entry è¢« apply åˆ°çŠ¶æ€æœºæ—¶å°±å¯ä»¥è¿”å›å®¢æˆ·ç«¯ç»“æœã€‚\nLeaseRead æ€è·¯ LeaseRead ä¸ ReadIndex ç±»ä¼¼ï¼Œä½†æ›´è¿›ä¸€æ­¥ï¼Œä¸ä»…çœå»äº† Logï¼Œè¿˜çœå»äº†ç½‘ç»œäº¤äº’ã€‚å®ƒå¯ä»¥å¤§å¹…æå‡è¯»çš„ååä¹Ÿèƒ½æ˜¾è‘—é™ä½å»¶æ—¶ã€‚åŸºæœ¬çš„æ€è·¯æ˜¯ Leader å–ä¸€ä¸ªæ¯” Election Timeout å°çš„ç§ŸæœŸï¼Œåœ¨ç§ŸæœŸä¸ä¼šå‘ç”Ÿé€‰ä¸¾ï¼Œç¡®ä¿ Leader ä¸ä¼šå˜ï¼Œæ‰€ä»¥å¯ä»¥è·³è¿‡ ReadIndex çš„ç¬¬äºŒæ­¥ï¼Œä¹Ÿå°±é™ä½äº†å»¶æ—¶ã€‚ LeaseRead çš„æ­£ç¡®æ€§å’Œæ—¶é—´æŒ‚é’©ï¼Œå› æ­¤æ—¶é—´çš„å®ç°è‡³å…³é‡è¦ï¼Œå¦‚æœæ¼‚ç§»ä¸¥é‡ï¼Œè¿™å¥—æœºåˆ¶å°±ä¼šæœ‰é—®é¢˜ã€‚\nWait Free åˆ°æ­¤ä¸ºæ­¢ Lease çœå»äº† ReadIndex çš„ç¬¬äºŒæ­¥ï¼Œå®é™…èƒ½å†è¿›ä¸€æ­¥ï¼Œçœå»ç¬¬ 3 æ­¥ã€‚è¿™æ ·çš„ LeaseRead åœ¨æ”¶åˆ°è¯·æ±‚åä¼šç«‹åˆ»è¿›è¡Œè¯»è¯·æ±‚ï¼Œä¸å– commit index ä¹Ÿä¸ç­‰çŠ¶æ€æœºã€‚ç”±äº Raft çš„å¼º Leader ç‰¹æ€§ï¼Œåœ¨ç§ŸæœŸå†…çš„ Client æ”¶åˆ°çš„ Resp ç”± Leader çš„çŠ¶æ€æœºäº§ç”Ÿï¼Œæ‰€ä»¥åªè¦çŠ¶æ€æœºæ»¡è¶³çº¿æ€§ä¸€è‡´ï¼Œé‚£ä¹ˆåœ¨ Lease å†…ï¼Œä¸ç®¡ä½•æ—¶å‘ç”Ÿè¯»éƒ½èƒ½æ»¡è¶³çº¿æ€§ä¸€è‡´æ€§ã€‚æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œåªæœ‰åœ¨ Leader çš„çŠ¶æ€æœºåº”ç”¨äº†å½“å‰ term çš„ç¬¬ä¸€ä¸ª Log åæ‰èƒ½è¿›è¡Œ LeaseReadã€‚å› ä¸ºæ–°é€‰ä¸¾äº§ç”Ÿçš„ Leaderï¼Œå®ƒè™½ç„¶æœ‰å…¨éƒ¨ committed Logï¼Œä½†å®ƒçš„çŠ¶æ€æœºå¯èƒ½è½åäºä¹‹å‰çš„ Leaderï¼ŒçŠ¶æ€æœºåº”ç”¨åˆ°å½“å‰ term çš„ Log å°±ä¿è¯äº†æ–° Leader çš„çŠ¶æ€æœºä¸€å®šæ–°äºæ—§ Leaderï¼Œä¹‹åè‚¯å®šä¸ä¼šå‡ºç° stale readã€‚ å¯ä»¥å‚è€ƒpost\nEtcd æºç å®ç° å…ˆç•™ä¸ªå‘ï¼Œæš‚æ—¶æ²¡æ—¶é—´ï¼Œåç»­æœ‰æ—¶é—´å†åˆ†æã€‚\n","permalink":"https://reid00.github.io/en/posts/storage/raft-etcd-%E4%B9%8B-linearizable-read/","summary":"ä»‹ç» linearizable read ç®€å•çš„è¯´å°±æ˜¯ä¸è¿”å› stale æ•°æ®ï¼Œå…·ä½“å¯ä»¥å‚è€ƒStrong consistency models\nRead Index æœºåˆ¶å°±æ˜¯ Leader åœ¨æ”¶åˆ°è¯»è¯·æ±‚æ—¶è¿›è¡Œå¦‚ä¸‹å‡ æ­¥ï¼š\nå¦‚æœ Leader åœ¨å½“å‰ä»»æœŸè¿˜æ²¡æœ‰æäº¤è¿‡æ—¥å¿—ï¼Œå…ˆæäº¤ä¸€æ¡ç©ºæ—¥å¿— Leader ä¿å­˜è®°å½•å½“å‰ commit index ä½œä¸º readIndex é€šè¿‡å¿ƒè·³ï¼Œè¯¢é—®æˆå‘˜è‡ªå·±è¿˜æ˜¯ä¸æ˜¯ Leaderï¼Œå¦‚æœæ”¶åˆ°è¿‡åŠçš„ç¡®è®¤ï¼Œåˆ™å¯ç¡®ä¿¡è‡ªå·±ä»æ˜¯ Leader ç­‰å¾… Apply Index è¶…è¿‡ readIndex è¯»å–æ•°æ®ï¼Œå“åº” Client etcdä¸ä»…å®ç°äº†leaderä¸Šçš„read only queryï¼ŒåŒæ—¶ä¹Ÿå®ç°äº†followerä¸Šçš„read only queryï¼ŒåŸç†æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡è¯»è¯·æ±‚åˆ°è¾¾followeræ—¶ï¼Œcommit indexæ˜¯éœ€è¦å‘leaderå»è¦çš„ï¼Œleaderè¿”å›commit indexç»™followerä¹‹å‰ï¼ŒåŒæ ·ï¼Œéœ€è¦èµ°ä¸Šé¢çš„ReadIndexæµç¨‹ï¼Œå› ä¸ºleaderåŒæ ·éœ€è¦checkè‡ªå·±åˆ°åº•è¿˜æ˜¯ä¸æ˜¯leader\nReadIndex æ€è·¯ åœ¨è®ºæ–‡ä¸­ ç¬¬å…«èŠ‚ï¼Œpage13 æœ‰æåˆ°è¿‡å¤§æ¦‚æ€è·¯:\nRead-only operations can be handled without writing anything into the log. However, with no additional measures, this would run the risk of returning stale data, since the leader responding to the request might have been superseded by a newer leader of which it is unaware.","title":"Raft Etcd ä¹‹ Linearizable Read"},{"content":"å¦‚æœå…è®¸æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—ï¼Œå°†å¯¼è‡´ä»€ä¹ˆé—®é¢˜? æˆ‘ä»¬å°†è®ºæ–‡ä¸­çš„ä¸Šå›¾å±•å¼€:\n(a): S1 æ˜¯leaderï¼Œå°†é»„è‰²çš„æ—¥å¿—2åŒæ­¥åˆ°äº†S2ï¼Œç„¶åS1å´©æºƒã€‚ (b): S5 åœ¨ä»»æœŸ 3 é‡Œé€šè¿‡ S3ã€S4 å’Œè‡ªå·±çš„é€‰ç¥¨èµ¢å¾—é€‰ä¸¾ï¼Œå°†è“è‰²æ—¥å¿—3å­˜å‚¨åˆ°æœ¬åœ°ï¼Œç„¶åå´©æºƒäº†ã€‚ (c): S1é‡æ–°å¯åŠ¨ï¼Œé€‰ä¸¾æˆåŠŸã€‚æ³¨æ„åœ¨è¿™æ—¶ï¼Œå¦‚æœå…è®¸æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—ï¼Œå°†é¦–å…ˆå¼€å§‹åŒæ­¥è¿‡å¾€ä»»æœŸçš„æ—¥å¿—ï¼Œå³å°†S1ä¸Šçš„æœ¬åœ°é»„è‰²çš„æ—¥å¿—2åŒæ­¥åˆ°äº†S3ã€‚è¿™æ—¶é»„è‰²çš„èŠ‚ç‚¹2å·²ç»åŒæ­¥åˆ°äº†é›†ç¾¤å¤šæ•°èŠ‚ç‚¹ï¼Œç„¶åS1å†™äº†ä¸€æ¡æ–°æ—¥å¿—4ï¼Œç„¶åS1åˆå´©æºƒäº†ã€‚ æ¥ä¸‹æ¥ä¼šå‡ºç°ä¸¤ç§ä¸åŒçš„æƒ…å†µ: (d1): S5é‡æ–°å½“é€‰ï¼Œå¦‚æœå…è®¸æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—ï¼Œå°±å¼€å§‹åŒæ­¥å¾€æœŸæ—¥å¿—ï¼Œå°†æœ¬åœ°çš„è“è‰²æ—¥å¿—3åŒæ­¥åˆ°æ‰€æœ‰çš„èŠ‚ç‚¹ã€‚ç»“æœå·²ç»è¢«åŒæ­¥åˆ°åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹çš„é»„è‰²æ—¥å¿—2è¢«è¦†ç›–äº†ã€‚è¿™è¯´æ˜ï¼Œå¦‚æœå…è®¸â€œæäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—â€ï¼Œä¼šå¯èƒ½å‡ºç°å³ä¾¿å·²ç»åŒæ­¥åˆ°åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹çš„æ—¥å¿—è¢«è¦†ç›–ï¼Œè¿™æ˜¯ä¸å…è®¸çš„ã€‚ (d2): åä¹‹ï¼Œå¦‚æœåœ¨å´©æºƒä¹‹å‰ï¼ŒS1ä¸å»åŒæ­¥å¾€æœŸçš„æ—¥å¿—ï¼Œè€Œæ˜¯é¦–å…ˆåŒæ­¥è‡ªå·±ä»»æœŸå†…çš„æ—¥å¿—4åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼Œå°±ä¸ä¼šå¯¼è‡´é»„è‰²æ—¥å¿—2è¢«è¦†ç›–ã€‚å› ä¸ºleaderåŒæ­¥æ—¥å¿—çš„æµç¨‹ä¸­ï¼Œä¼šé€šè¿‡ä¸æ–­çš„å‘åé‡è¯•çš„æ–¹å¼ï¼Œå°†æ—¥å¿—åŒæ­¥åˆ°å…¶ä»–æ‰€æœ‰followerï¼Œåªè¦æ—¥å¿—4è¢«å¤åˆ¶æˆåŠŸï¼Œåœ¨å®ƒä¹‹å‰çš„æ—¥å¿—2å°±ä¼šè¢«å¤åˆ¶æˆåŠŸã€‚ï¼ˆd2ï¼‰æ˜¯æƒ³è¯´æ˜ï¼šä¸èƒ½ç›´æ¥æäº¤è¿‡å¾€ä»»æœŸçš„æ—¥å¿—ï¼Œå³ä¾¿å·²ç»è¢«å¤šæ•°é€šè¿‡ï¼Œä½†æ˜¯å¯ä»¥å…ˆåŒæ­¥ä¸€æ¡è‡ªå·±ä»»å†…çš„æ—¥å¿—ï¼Œå¦‚æœè¿™æ¡æ—¥å¿—é€šè¿‡ï¼Œå°±èƒ½å¸¦ç€å‰é¢çš„æ—¥å¿—ä¸€èµ·é€šè¿‡ï¼Œè¿™æ˜¯ï¼ˆcï¼‰å’Œï¼ˆd2ï¼‰ä¸¤ä¸ªå›¾çš„åŒºåˆ«ã€‚å›¾ï¼ˆcï¼‰ä¸­ï¼ŒS1å…ˆå»æäº¤è¿‡å¾€ä»»æœŸçš„æ—¥å¿—2ï¼Œå›¾ï¼ˆd2ï¼‰ä¸­ï¼ŒS1å…ˆå»æäº¤è‡ªå·±ä»»å†…çš„æ—¥å¿—4ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°çš„æ˜¯ï¼Œå¦‚æœå…è®¸æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—è¿™ä¹ˆåšï¼Œé‚£ä¹ˆï¼š\n(c)ä¸­, S1æ¢å¤ä¹‹åï¼Œåˆå†æ¬¡æäº¤åœ¨ä»»æœŸ2ä¸­çš„é»„è‰²æ—¥å¿—2ã€‚ä½†æ˜¯ï¼Œä»åé¢å¯ä»¥çœ‹åˆ°ï¼Œå³ä¾¿è¿™ä¸ªä¹‹å‰ä»»æœŸä¸­çš„é»„è‰²æ—¥å¿—2ï¼Œæäº¤åˆ°å¤§éƒ¨åˆ†èŠ‚ç‚¹ï¼Œå¦‚æœå…è®¸æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—ï¼Œä»ç„¶å­˜åœ¨è¢«è¦†ç›–çš„å¯èƒ½æ€§ï¼Œå› ä¸ºï¼š (d1)ä¸­ï¼ŒS5æ¢å¤ä¹‹åï¼Œä¹Ÿä¼šæäº¤åœ¨è‡ªå·±æœ¬åœ°ä¸Šä¿å­˜çš„ä¹‹å‰ä»»æœŸ3çš„è“è‰²æ—¥å¿—ï¼Œè¿™ä¼šå¯¼è‡´è¦†ç›–äº†å‰é¢å·²ç»åˆ°åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹çš„é»„è‰²æ—¥å¿—2ã€‚ æ‰€ä»¥ï¼Œå¦‚æœå…è®¸æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—ï¼Œå³å¦‚åŒ(c)å’Œ(d1)æ¼”ç¤ºçš„é‚£æ ·ï¼šé‡æ–°å½“é€‰ä¹‹åï¼Œé©¬ä¸Šæäº¤è‡ªå·±æœ¬åœ°ä¿å­˜çš„ã€ä¹‹å‰ä»»æœŸçš„æ—¥å¿—ï¼Œå°±ä¼šå¯èƒ½å¯¼è‡´å³ä¾¿å·²ç»åŒæ­¥åˆ°åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹çš„æ—¥å¿—ï¼Œè¢«è¦†ç›–çš„æƒ…å†µã€‚\nè€Œå·²åŒæ­¥åˆ°åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹çš„æ—¥å¿—ï¼Œä¸€å®šåœ¨æ–°å½“é€‰leaderä¸Šï¼ˆå¦åˆ™è¿™ä¸ªèŠ‚ç‚¹ä¸å¯èƒ½æˆä¸ºæ–°leaderï¼‰ä¸”è¾¾æˆäº†ä¸€è‡´å¯æäº¤ï¼Œå³ä¸å…è®¸è¢«è¦†ç›–ã€‚\nè¿™å°±æ˜¯çŸ›ç›¾çš„åœ°æ–¹ï¼Œå³å…è®¸æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—ï¼Œæœ€ç»ˆå¯¼è‡´äº†è¿ååè®®è§„åˆ™çš„æƒ…å†µã€‚\né‚£ä¹ˆï¼Œå¦‚ä½•ç¡®ä¿æ–°å½“é€‰çš„leaderèŠ‚ç‚¹ï¼Œå…¶æœ¬åœ°çš„æœªæäº¤æ—¥å¿—è¢«æ­£ç¡®æäº¤å‘¢ï¼Ÿå›¾(d2)å±•ç¤ºäº†æ­£å¸¸çš„æƒ…å†µï¼šå³å½“é€‰ä¹‹åï¼Œä¸è¦é¦–å…ˆæäº¤æœ¬åœ°å·²æœ‰çš„é»„è‰²æ—¥å¿—2ï¼Œè€Œæ˜¯é¦–å…ˆæäº¤ä¸€æ¡æ–°æ—¥å¿—4ï¼Œå¦‚æœè¿™æ¡æ–°æ—¥å¿—è¢«æäº¤æˆåŠŸï¼Œé‚£ä¹ˆæŒ‰ç…§Raftæ—¥å¿—çš„åŒ¹é…è§„åˆ™ï¼ˆlog matching propertyï¼‰ï¼šæ—¥å¿—4å¦‚æœèƒ½æäº¤ï¼Œå®ƒå‰é¢çš„æ—¥å¿—ä¹Ÿæäº¤äº†ã€‚\nå¯æ˜¯ï¼Œæ–°çš„é—®é¢˜åˆå‡ºç°äº†ï¼Œå¦‚æœåœ¨(d2)ä¸­ï¼ŒS1é‡æ–°å½“é€‰ä¹‹åï¼Œå®¢æˆ·ç«¯å†™å…¥æ²¡æœ‰è¿™æ¡æ–°çš„æ—¥å¿—4ï¼Œé‚£ä¹ˆå‰é¢çš„æ—¥å¿—2æ˜¯ä¸æ˜¯æ°¸è¿œæ— æ³•æäº¤äº†ï¼Ÿä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œraftè¦æ±‚æ¯ä¸ªleaderæ–°å½“é€‰ä¹‹åï¼Œé©¬ä¸Šå†™å…¥ä¸€æ¡åªæœ‰ä»»æœŸå·å’Œç´¢å¼•ã€è€Œæ²¡æœ‰å†…å®¹çš„æ‰€è°“â€œno-opâ€æ—¥å¿—ï¼Œä»¥è¿™æ¡æ—¥å¿—æ¥é©±åŠ¨åœ¨å®ƒä¹‹å‰çš„æ—¥å¿—è¾¾æˆä¸€è‡´ã€‚\nè¿™å°±æ˜¯è®ºæ–‡ä¸­è¿™éƒ¨åˆ†å†…å®¹æƒ³è¦è¡¨è¾¾çš„ã€‚è¿™éƒ¨åˆ†å†…å®¹ä¹‹æ‰€ä»¥æ¯”è¾ƒéš¾ç†è§£ï¼Œæ˜¯å› ä¸ºç»å¸¸å¿½ç•¥äº†è¿™ä¸ªå›¾ç¤ºå±•ç¤ºçš„æ˜¯é”™è¯¯çš„æƒ…å†µï¼Œå…è®¸æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—å¯èƒ½å¯¼è‡´çš„é—®é¢˜ã€‚\n(c)å’Œ(d2) æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ çœ‹èµ·æ¥ï¼Œ(c)å’Œ(d2)ä¸€æ ·ï¼ŒS1å½“é€‰åéƒ½æäº¤äº†æ—¥å¿—1ã€2ã€4ï¼Œé‚£ä¹ˆä¸¤è€…çš„åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ è™½ç„¶ä¸¤ä¸ªåœºæ™¯ä¸­ï¼Œæäº¤çš„æ—¥å¿—éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æ—¥å¿—è¾¾æˆä¸€è‡´çš„é¡ºåºå¹¶ä¸ä¸€è‡´ï¼š\n(c)ï¼šS1æˆä¸ºleaderä¹‹åï¼Œå…ˆæäº¤è¿‡å¾€ä»»æœŸã€æœ¬åœ°çš„æ—¥å¿—2ï¼Œå†æäº¤æ—¥å¿—4ã€‚è¿™å°±æ˜¯æäº¤ä¹‹å‰ä»»æœŸæ—¥å¿—çš„æƒ…å†µã€‚ (d2)ï¼šS1æˆä¸ºleaderä¹‹åï¼Œå…ˆæäº¤æœ¬æ¬¡ä»»æœŸçš„æ—¥å¿—4ï¼Œå¦‚æœæ—¥å¿—4èƒ½æäº¤æˆåŠŸï¼Œé‚£ä¹ˆå®ƒå‰é¢çš„æ—¥å¿—2å°±èƒ½æäº¤æˆåŠŸäº†ã€‚ å…³äº(d2)çš„è¿™ä¸ªåœºæ™¯ï¼Œæœ‰å¯èƒ½åˆå­˜åœ¨ç€ä¸‹ä¸€ä¸ªç–‘é—®ï¼š å¦‚ä½•ç†è§£(d2)ä¸­ï¼Œâ€œæœ¬ä»»æœŸçš„æ—¥å¿—4æäº¤æˆåŠŸï¼Œé‚£ä¹ˆå®ƒå‰é¢çš„æ—¥å¿—2ä¹Ÿèƒ½æäº¤æˆåŠŸäº†â€ï¼Ÿ\nè¿™æ˜¯ç”±raftæ—¥å¿—çš„Log Matching Propertyå†³å®šçš„:\nIf two entries in different logs have the same index and term, then they store the same command. If two entries in different logs have the same index and term, then the logs are identical in all preceding entries.\nIf two entries in different logs have the same index and term, then the logs are identical in all preceding entries\nç¬¬ä¸€æ¡æ€§è´¨ï¼Œè¯´æ˜çš„æ˜¯åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šçš„å·²æäº¤çš„æ—¥å¿—ï¼Œå¦‚æœä»»æœŸå·ã€ç´¢å¼•ä¸€æ ·ï¼Œé‚£ä¹ˆå®ƒä»¬çš„å†…å®¹è‚¯å®šä¸€æ ·ã€‚è¿™æ˜¯ç”±leaderèŠ‚ç‚¹çš„å®‰å…¨æ€§å’Œleaderä¸Šçš„æ—¥å¿—åªèƒ½æ·»åŠ ä¸èƒ½è¦†ç›–æ¥ä¿è¯çš„ï¼Œè¿™æ ·leaderå°±æ°¸è¿œä¸ä¼šåœ¨åŒä¸€ä¸ªä»»æœŸï¼Œåˆ›å»ºä¸¤ä¸ªç›¸åŒç´¢å¼•çš„æ—¥å¿—ã€‚\nç¬¬äºŒæ¡æ€§è´¨ï¼Œè¯´æ˜çš„æ˜¯åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šçš„æ—¥å¿—ä¸­ï¼Œå¦‚æœå…¶ä¸­æœ‰åŒæ ·çš„ä¸€æ¡æ—¥å¿—ï¼ˆå³ç›¸åŒä»»æœŸå’Œç´¢å¼•ï¼‰å·²ç»è¾¾æˆäº†ä¸€è‡´ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸åŒèŠ‚ç‚¹ä¸Šåœ¨è¿™æ¡æ—¥å¿—ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—éƒ½æ˜¯ä¸€æ ·çš„ã€‚\nç¬¬äºŒæ¡æ€§è´¨æ˜¯ç”±leaderèŠ‚ç‚¹å‘followerèŠ‚ç‚¹ä¸Šæ ¹æ®AppendEntriesæ¶ˆæ¯åŒæ­¥æ—¥å¿—ä¸Šä¿è¯çš„ã€‚leaderåœ¨AppendEntriesæ¶ˆæ¯ä¸­ä¼šæºå¸¦æ–°æ·»åŠ entriesä¹‹å‰æ—¥å¿—çš„termå’Œindex å³PrevLogTerm, PrevLogIndexï¼Œfollowerä¼šåˆ¤æ–­åœ¨logä¸­æ˜¯å¦å­˜åœ¨æ‹¥æœ‰æ­¤termå’Œindexçš„æ¶ˆæ¯ï¼Œå¦‚æœæ²¡æœ‰å°±ä¼šæ‹’ç»ã€‚\nleaderä¸ºæ¯ä¸€ä¸ªfollowerç»´æŠ¤ä¸€ä¸ªnextIndexï¼Œè¡¨ç¤ºå¾…å‘é€çš„ä¸‹ä¸€ä¸ªæ—¥å¿—çš„indexã€‚åˆå§‹åŒ–ä¸ºæ—¥å¿—é•¿åº¦ã€‚ leaderåœ¨followeræ‹’ç»AppendEntriesä¹‹åä¼šå¯¹nextIndexå‡ä¸€ï¼Œç„¶åç»§ç»­é‡è¯•AppendEntriesç›´åˆ°ä¸¤è€…ä¸€è‡´ã€‚ äºæ˜¯ï¼Œå›åˆ°æˆ‘ä»¬å¼€å§‹çš„é—®é¢˜ï¼Œ(d2)åœºæ™¯ä¸­ï¼Œåœ¨æ·»åŠ æœ¬ä»»æœŸæ—¥å¿—4çš„æ—¶å€™ï¼Œä¼šå‘ç°æœ‰ä¸€äº›èŠ‚ç‚¹ä¸Šå¹¶ä¸å­˜åœ¨è¿‡å¾€ä»»æœŸçš„æ—¥å¿—2ï¼Œè¿™æ—¶å€™å°±ä¼šç›¸åº”åœ°è®¡ç®—ä¸åŒèŠ‚ç‚¹çš„nextIndexç´¢å¼•ï¼Œæ¥é©±åŠ¨åŒæ­¥æ—¥å¿—2åˆ°è¿™äº›èŠ‚ç‚¹ä¸Šã€‚\næ€»è€Œè¨€ä¹‹ï¼Œæ ¹æ®æ—¥å¿—çš„æ€§è´¨ï¼Œåªè¦æœ¬ä»»æœŸçš„æ—¥å¿—4èƒ½è¾¾æˆä¸€è‡´ï¼Œä¸Šä¸€æ¡æ—¥å¿—2å°±èƒ½è¾¾æˆä¸€è‡´ã€‚\n","permalink":"https://reid00.github.io/en/posts/storage/mit6.824-2022-raft-%E4%B8%BA%E4%BB%80%E4%B9%88raft%E5%8D%8F%E8%AE%AE%E4%B8%8D%E8%83%BD%E6%8F%90%E4%BA%A4%E4%B9%8B%E5%89%8D%E4%BB%BB%E6%9C%9F%E7%9A%84%E6%97%A5%E5%BF%97/","summary":"å¦‚æœå…è®¸æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—ï¼Œå°†å¯¼è‡´ä»€ä¹ˆé—®é¢˜? æˆ‘ä»¬å°†è®ºæ–‡ä¸­çš„ä¸Šå›¾å±•å¼€:\n(a): S1 æ˜¯leaderï¼Œå°†é»„è‰²çš„æ—¥å¿—2åŒæ­¥åˆ°äº†S2ï¼Œç„¶åS1å´©æºƒã€‚ (b): S5 åœ¨ä»»æœŸ 3 é‡Œé€šè¿‡ S3ã€S4 å’Œè‡ªå·±çš„é€‰ç¥¨èµ¢å¾—é€‰ä¸¾ï¼Œå°†è“è‰²æ—¥å¿—3å­˜å‚¨åˆ°æœ¬åœ°ï¼Œç„¶åå´©æºƒäº†ã€‚ (c): S1é‡æ–°å¯åŠ¨ï¼Œé€‰ä¸¾æˆåŠŸã€‚æ³¨æ„åœ¨è¿™æ—¶ï¼Œå¦‚æœå…è®¸æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—ï¼Œå°†é¦–å…ˆå¼€å§‹åŒæ­¥è¿‡å¾€ä»»æœŸçš„æ—¥å¿—ï¼Œå³å°†S1ä¸Šçš„æœ¬åœ°é»„è‰²çš„æ—¥å¿—2åŒæ­¥åˆ°äº†S3ã€‚è¿™æ—¶é»„è‰²çš„èŠ‚ç‚¹2å·²ç»åŒæ­¥åˆ°äº†é›†ç¾¤å¤šæ•°èŠ‚ç‚¹ï¼Œç„¶åS1å†™äº†ä¸€æ¡æ–°æ—¥å¿—4ï¼Œç„¶åS1åˆå´©æºƒäº†ã€‚ æ¥ä¸‹æ¥ä¼šå‡ºç°ä¸¤ç§ä¸åŒçš„æƒ…å†µ: (d1): S5é‡æ–°å½“é€‰ï¼Œå¦‚æœå…è®¸æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—ï¼Œå°±å¼€å§‹åŒæ­¥å¾€æœŸæ—¥å¿—ï¼Œå°†æœ¬åœ°çš„è“è‰²æ—¥å¿—3åŒæ­¥åˆ°æ‰€æœ‰çš„èŠ‚ç‚¹ã€‚ç»“æœå·²ç»è¢«åŒæ­¥åˆ°åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹çš„é»„è‰²æ—¥å¿—2è¢«è¦†ç›–äº†ã€‚è¿™è¯´æ˜ï¼Œå¦‚æœå…è®¸â€œæäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—â€ï¼Œä¼šå¯èƒ½å‡ºç°å³ä¾¿å·²ç»åŒæ­¥åˆ°åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹çš„æ—¥å¿—è¢«è¦†ç›–ï¼Œè¿™æ˜¯ä¸å…è®¸çš„ã€‚ (d2): åä¹‹ï¼Œå¦‚æœåœ¨å´©æºƒä¹‹å‰ï¼ŒS1ä¸å»åŒæ­¥å¾€æœŸçš„æ—¥å¿—ï¼Œè€Œæ˜¯é¦–å…ˆåŒæ­¥è‡ªå·±ä»»æœŸå†…çš„æ—¥å¿—4åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼Œå°±ä¸ä¼šå¯¼è‡´é»„è‰²æ—¥å¿—2è¢«è¦†ç›–ã€‚å› ä¸ºleaderåŒæ­¥æ—¥å¿—çš„æµç¨‹ä¸­ï¼Œä¼šé€šè¿‡ä¸æ–­çš„å‘åé‡è¯•çš„æ–¹å¼ï¼Œå°†æ—¥å¿—åŒæ­¥åˆ°å…¶ä»–æ‰€æœ‰followerï¼Œåªè¦æ—¥å¿—4è¢«å¤åˆ¶æˆåŠŸï¼Œåœ¨å®ƒä¹‹å‰çš„æ—¥å¿—2å°±ä¼šè¢«å¤åˆ¶æˆåŠŸã€‚ï¼ˆd2ï¼‰æ˜¯æƒ³è¯´æ˜ï¼šä¸èƒ½ç›´æ¥æäº¤è¿‡å¾€ä»»æœŸçš„æ—¥å¿—ï¼Œå³ä¾¿å·²ç»è¢«å¤šæ•°é€šè¿‡ï¼Œä½†æ˜¯å¯ä»¥å…ˆåŒæ­¥ä¸€æ¡è‡ªå·±ä»»å†…çš„æ—¥å¿—ï¼Œå¦‚æœè¿™æ¡æ—¥å¿—é€šè¿‡ï¼Œå°±èƒ½å¸¦ç€å‰é¢çš„æ—¥å¿—ä¸€èµ·é€šè¿‡ï¼Œè¿™æ˜¯ï¼ˆcï¼‰å’Œï¼ˆd2ï¼‰ä¸¤ä¸ªå›¾çš„åŒºåˆ«ã€‚å›¾ï¼ˆcï¼‰ä¸­ï¼ŒS1å…ˆå»æäº¤è¿‡å¾€ä»»æœŸçš„æ—¥å¿—2ï¼Œå›¾ï¼ˆd2ï¼‰ä¸­ï¼ŒS1å…ˆå»æäº¤è‡ªå·±ä»»å†…çš„æ—¥å¿—4ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°çš„æ˜¯ï¼Œå¦‚æœå…è®¸æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—è¿™ä¹ˆåšï¼Œé‚£ä¹ˆï¼š\n(c)ä¸­, S1æ¢å¤ä¹‹åï¼Œåˆå†æ¬¡æäº¤åœ¨ä»»æœŸ2ä¸­çš„é»„è‰²æ—¥å¿—2ã€‚ä½†æ˜¯ï¼Œä»åé¢å¯ä»¥çœ‹åˆ°ï¼Œå³ä¾¿è¿™ä¸ªä¹‹å‰ä»»æœŸä¸­çš„é»„è‰²æ—¥å¿—2ï¼Œæäº¤åˆ°å¤§éƒ¨åˆ†èŠ‚ç‚¹ï¼Œå¦‚æœå…è®¸æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—ï¼Œä»ç„¶å­˜åœ¨è¢«è¦†ç›–çš„å¯èƒ½æ€§ï¼Œå› ä¸ºï¼š (d1)ä¸­ï¼ŒS5æ¢å¤ä¹‹åï¼Œä¹Ÿä¼šæäº¤åœ¨è‡ªå·±æœ¬åœ°ä¸Šä¿å­˜çš„ä¹‹å‰ä»»æœŸ3çš„è“è‰²æ—¥å¿—ï¼Œè¿™ä¼šå¯¼è‡´è¦†ç›–äº†å‰é¢å·²ç»åˆ°åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹çš„é»„è‰²æ—¥å¿—2ã€‚ æ‰€ä»¥ï¼Œå¦‚æœå…è®¸æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—ï¼Œå³å¦‚åŒ(c)å’Œ(d1)æ¼”ç¤ºçš„é‚£æ ·ï¼šé‡æ–°å½“é€‰ä¹‹åï¼Œé©¬ä¸Šæäº¤è‡ªå·±æœ¬åœ°ä¿å­˜çš„ã€ä¹‹å‰ä»»æœŸçš„æ—¥å¿—ï¼Œå°±ä¼šå¯èƒ½å¯¼è‡´å³ä¾¿å·²ç»åŒæ­¥åˆ°åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹çš„æ—¥å¿—ï¼Œè¢«è¦†ç›–çš„æƒ…å†µã€‚\nè€Œå·²åŒæ­¥åˆ°åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹çš„æ—¥å¿—ï¼Œä¸€å®šåœ¨æ–°å½“é€‰leaderä¸Šï¼ˆå¦åˆ™è¿™ä¸ªèŠ‚ç‚¹ä¸å¯èƒ½æˆä¸ºæ–°leaderï¼‰ä¸”è¾¾æˆäº†ä¸€è‡´å¯æäº¤ï¼Œå³ä¸å…è®¸è¢«è¦†ç›–ã€‚\nè¿™å°±æ˜¯çŸ›ç›¾çš„åœ°æ–¹ï¼Œå³å…è®¸æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—ï¼Œæœ€ç»ˆå¯¼è‡´äº†è¿ååè®®è§„åˆ™çš„æƒ…å†µã€‚\né‚£ä¹ˆï¼Œå¦‚ä½•ç¡®ä¿æ–°å½“é€‰çš„leaderèŠ‚ç‚¹ï¼Œå…¶æœ¬åœ°çš„æœªæäº¤æ—¥å¿—è¢«æ­£ç¡®æäº¤å‘¢ï¼Ÿå›¾(d2)å±•ç¤ºäº†æ­£å¸¸çš„æƒ…å†µï¼šå³å½“é€‰ä¹‹åï¼Œä¸è¦é¦–å…ˆæäº¤æœ¬åœ°å·²æœ‰çš„é»„è‰²æ—¥å¿—2ï¼Œè€Œæ˜¯é¦–å…ˆæäº¤ä¸€æ¡æ–°æ—¥å¿—4ï¼Œå¦‚æœè¿™æ¡æ–°æ—¥å¿—è¢«æäº¤æˆåŠŸï¼Œé‚£ä¹ˆæŒ‰ç…§Raftæ—¥å¿—çš„åŒ¹é…è§„åˆ™ï¼ˆlog matching propertyï¼‰ï¼šæ—¥å¿—4å¦‚æœèƒ½æäº¤ï¼Œå®ƒå‰é¢çš„æ—¥å¿—ä¹Ÿæäº¤äº†ã€‚\nå¯æ˜¯ï¼Œæ–°çš„é—®é¢˜åˆå‡ºç°äº†ï¼Œå¦‚æœåœ¨(d2)ä¸­ï¼ŒS1é‡æ–°å½“é€‰ä¹‹åï¼Œå®¢æˆ·ç«¯å†™å…¥æ²¡æœ‰è¿™æ¡æ–°çš„æ—¥å¿—4ï¼Œé‚£ä¹ˆå‰é¢çš„æ—¥å¿—2æ˜¯ä¸æ˜¯æ°¸è¿œæ— æ³•æäº¤äº†ï¼Ÿä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œraftè¦æ±‚æ¯ä¸ªleaderæ–°å½“é€‰ä¹‹åï¼Œé©¬ä¸Šå†™å…¥ä¸€æ¡åªæœ‰ä»»æœŸå·å’Œç´¢å¼•ã€è€Œæ²¡æœ‰å†…å®¹çš„æ‰€è°“â€œno-opâ€æ—¥å¿—ï¼Œä»¥è¿™æ¡æ—¥å¿—æ¥é©±åŠ¨åœ¨å®ƒä¹‹å‰çš„æ—¥å¿—è¾¾æˆä¸€è‡´ã€‚\nè¿™å°±æ˜¯è®ºæ–‡ä¸­è¿™éƒ¨åˆ†å†…å®¹æƒ³è¦è¡¨è¾¾çš„ã€‚è¿™éƒ¨åˆ†å†…å®¹ä¹‹æ‰€ä»¥æ¯”è¾ƒéš¾ç†è§£ï¼Œæ˜¯å› ä¸ºç»å¸¸å¿½ç•¥äº†è¿™ä¸ªå›¾ç¤ºå±•ç¤ºçš„æ˜¯é”™è¯¯çš„æƒ…å†µï¼Œå…è®¸æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—å¯èƒ½å¯¼è‡´çš„é—®é¢˜ã€‚\n(c)å’Œ(d2) æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ çœ‹èµ·æ¥ï¼Œ(c)å’Œ(d2)ä¸€æ ·ï¼ŒS1å½“é€‰åéƒ½æäº¤äº†æ—¥å¿—1ã€2ã€4ï¼Œé‚£ä¹ˆä¸¤è€…çš„åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ è™½ç„¶ä¸¤ä¸ªåœºæ™¯ä¸­ï¼Œæäº¤çš„æ—¥å¿—éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æ—¥å¿—è¾¾æˆä¸€è‡´çš„é¡ºåºå¹¶ä¸ä¸€è‡´ï¼š\n(c)ï¼šS1æˆä¸ºleaderä¹‹åï¼Œå…ˆæäº¤è¿‡å¾€ä»»æœŸã€æœ¬åœ°çš„æ—¥å¿—2ï¼Œå†æäº¤æ—¥å¿—4ã€‚è¿™å°±æ˜¯æäº¤ä¹‹å‰ä»»æœŸæ—¥å¿—çš„æƒ…å†µã€‚ (d2)ï¼šS1æˆä¸ºleaderä¹‹åï¼Œå…ˆæäº¤æœ¬æ¬¡ä»»æœŸçš„æ—¥å¿—4ï¼Œå¦‚æœæ—¥å¿—4èƒ½æäº¤æˆåŠŸï¼Œé‚£ä¹ˆå®ƒå‰é¢çš„æ—¥å¿—2å°±èƒ½æäº¤æˆåŠŸäº†ã€‚ å…³äº(d2)çš„è¿™ä¸ªåœºæ™¯ï¼Œæœ‰å¯èƒ½åˆå­˜åœ¨ç€ä¸‹ä¸€ä¸ªç–‘é—®ï¼š å¦‚ä½•ç†è§£(d2)ä¸­ï¼Œâ€œæœ¬ä»»æœŸçš„æ—¥å¿—4æäº¤æˆåŠŸï¼Œé‚£ä¹ˆå®ƒå‰é¢çš„æ—¥å¿—2ä¹Ÿèƒ½æäº¤æˆåŠŸäº†â€ï¼Ÿ\nè¿™æ˜¯ç”±raftæ—¥å¿—çš„Log Matching Propertyå†³å®šçš„:\nIf two entries in different logs have the same index and term, then they store the same command. If two entries in different logs have the same index and term, then the logs are identical in all preceding entries.","title":"MIT6.824 2022 Raft ä¸ºä»€ä¹ˆRaftåè®®ä¸èƒ½æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—"},{"content":"Mulit Raft Group é€šè¿‡å¯¹ Raft åè®®çš„æè¿°æˆ‘ä»¬çŸ¥é“ï¼šç”¨æˆ·åœ¨å¯¹ä¸€ç»„ Raft ç³»ç»Ÿè¿›è¡Œæ›´æ–°æ“ä½œæ—¶å¿…é¡»å…ˆç»è¿‡ Leaderï¼Œå†ç”± Leader åŒæ­¥ç»™å¤§å¤šæ•° Followerã€‚è€Œåœ¨å®é™…è¿ç”¨ä¸­ï¼Œä¸€ç»„ Raft çš„ Leader å¾€å¾€å­˜åœ¨å•ç‚¹çš„æµé‡ç“¶é¢ˆï¼Œæµé‡é«˜ä¾¿æ— æ³•æ‰¿è½½ï¼ŒåŒæ—¶æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å…¨é‡æ•°æ®ï¼Œæ‰€ä»¥ä¼šå—åˆ°èŠ‚ç‚¹çš„å­˜å‚¨é™åˆ¶è€Œå¯¼è‡´å®¹é‡ç“¶é¢ˆï¼Œæ— æ³•æ‰©å±•ã€‚\nMulit Raft Group æ­£æ˜¯é€šè¿‡æŠŠæ•´ä¸ªæ•°æ®ä»æ¨ªå‘åšåˆ‡åˆ†ï¼Œåˆ†ä¸ºå¤šä¸ª Region æ¥è§£å†³ç£ç›˜ç“¶é¢ˆï¼Œç„¶åæ¯ä¸ª Region éƒ½å¯¹åº”æœ‰ç‹¬ç«‹çš„ Leader å’Œä¸€ä¸ªæˆ–å¤šä¸ª Follower çš„ Raft ç»„è¿›è¡Œæ¨ªå‘æ‰©å±•ï¼Œæ­¤æ—¶ç³»ç»Ÿä¾¿æœ‰å¤šä¸ªå†™å…¥çš„èŠ‚ç‚¹ï¼Œä»è€Œåˆ†æ‹…å†™å…¥å‹åŠ›ï¼Œå›¾å¦‚ä¸‹ï¼š å…·ä½“ç»†èŠ‚å¯ä»¥å‚è€ƒTiKV çš„æ–‡ç« \nMulti-Raftéœ€è¦è§£å†³çš„ä¸€äº›æ ¸å¿ƒé—®é¢˜ï¼š æ•°æ®ä½•å¦‚åˆ†ç‰‡ åˆ†ç‰‡ä¸­çš„æ•°æ®è¶Šæ¥è¶Šå¤§ï¼Œéœ€è¦åˆ†è£‚äº§ç”Ÿæ›´å¤šçš„åˆ†ç‰‡ï¼Œç»„æˆæ›´å¤šRaft-Group åˆ†ç‰‡çš„è°ƒåº¦ï¼Œè®©è´Ÿè½½åœ¨ç³»ç»Ÿä¸­æ›´å¹³å‡ï¼ˆåˆ†ç‰‡å‰¯æœ¬çš„è¿ç§»ï¼Œè¡¥å…¨ï¼ŒLeaderåˆ‡æ¢ç­‰ç­‰ï¼‰ ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ‰€æœ‰çš„Raft-Groupå¤ç”¨é“¾æ¥ï¼ˆå¦åˆ™Raftå‰¯æœ¬ä¹‹é—´ä¸¤ä¸¤å»ºé“¾ï¼Œé“¾æ¥çˆ†ç‚¸äº†ï¼‰ å¦‚ä½•å¤„ç†staleçš„è¯·æ±‚ï¼ˆä¾‹å¦‚Proposalå’ŒApplyçš„æ—¶å€™ï¼Œå½“å‰çš„å‰¯æœ¬ä¸æ˜¯Leaderã€åˆ†è£‚äº†ã€è¢«é”€æ¯äº†ç­‰ç­‰ï¼‰ Snapshotå¦‚ä½•ç®¡ç†ï¼ˆé™åˆ¶Snapshotï¼Œé¿å…å¸¦å®½ã€CPUã€IOèµ„æºè¢«è¿‡åº¦å ç”¨ï¼‰ æ•°æ®ä½•å¦‚åˆ†ç‰‡ é€šå¸¸çš„æ•°æ®åˆ†ç‰‡ç®—æ³•å°±æ˜¯ Hash å’Œ Rangeï¼ŒTiKV ä½¿ç”¨çš„ Range æ¥å¯¹æ•°æ®è¿›è¡Œæ•°æ®åˆ†ç‰‡ã€‚ä¸ºä»€ä¹ˆä½¿ç”¨ Rangeï¼Œä¸»è¦åŸå› æ˜¯èƒ½æ›´å¥½çš„å°†ç›¸åŒå‰ç¼€çš„ key èšåˆåœ¨ä¸€èµ·ï¼Œä¾¿äº scan ç­‰æ“ä½œï¼Œè¿™ä¸ª Hash æ˜¯æ²¡æ³•æ”¯æŒçš„ï¼Œå½“ç„¶ï¼Œåœ¨ split/merge ä¸Šé¢ Range ä¹Ÿæ¯” Hash å¥½å¤„ç†å¾ˆå¤šï¼Œå¾ˆå¤šæ—¶å€™åªä¼šæ¶‰åŠåˆ°å…ƒä¿¡æ¯çš„ä¿®æ”¹ï¼Œéƒ½ä¸ç”¨å¤§èŒƒå›´çš„æŒªåŠ¨æ•°æ®ã€‚\nå½“ç„¶ï¼ŒRange æœ‰ä¸€ä¸ªé—®é¢˜åœ¨äºå¾ˆæœ‰å¯èƒ½æŸä¸€ä¸ª Region ä¼šå› ä¸ºé¢‘ç¹çš„æ“ä½œæˆä¸ºæ€§èƒ½çƒ­ç‚¹ï¼Œå½“ç„¶ä¹Ÿæœ‰ä¸€äº›ä¼˜åŒ–çš„æ–¹å¼ï¼Œè­¬å¦‚é€šè¿‡ PD å°†è¿™äº› Region è°ƒåº¦åˆ°æ›´å¥½çš„æœºå™¨ä¸Šé¢ï¼Œæä¾› Follower åˆ†æ‹…è¯»å‹åŠ›ç­‰ã€‚\næ€»ä¹‹ï¼Œåœ¨ TiKV é‡Œé¢ï¼Œæˆ‘ä»¬ä½¿ç”¨ Range æ¥å¯¹æ•°æ®è¿›è¡Œåˆ‡åˆ†ï¼Œå°†å…¶åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„ Raft Groupï¼Œæ¯ä¸€ä¸ª Raft Groupï¼Œæˆ‘ä»¬ä½¿ç”¨ Region æ¥è¡¨ç¤ºã€‚\nåˆ†ç‰‡å¦‚ä½•è°ƒåº¦ Elasticellå®ç°ç»†èŠ‚ ä½œä¸ºå‚è€ƒ: è¿™éƒ¨åˆ†çš„æ€è·¯å°±å’ŒTiKVå®Œå…¨ä¸€è‡´äº†ã€‚PDè´Ÿè´£è°ƒåº¦æŒ‡ä»¤çš„ä¸‹å‘ï¼ŒPDé€šè¿‡å¿ƒè·³æ”¶é›†è°ƒåº¦éœ€è¦çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®åŒ…æ‹¬ï¼šèŠ‚ç‚¹ä¸Šçš„åˆ†ç‰‡çš„ä¸ªæ•°ï¼Œåˆ†ç‰‡ä¸­leaderçš„ä¸ªæ•°ï¼ŒèŠ‚ç‚¹çš„å­˜å‚¨ç©ºé—´ï¼Œå‰©ä½™å­˜å‚¨ç©ºé—´ç­‰ç­‰ã€‚ä¸€äº›æœ€åŸºæœ¬çš„è°ƒåº¦:\nPDå‘ç°åˆ†ç‰‡çš„å‰¯æœ¬æ•°ç›®ç¼ºå°‘äº†ï¼Œå¯»æ‰¾ä¸€ä¸ªåˆé€‚çš„èŠ‚ç‚¹ï¼ŒæŠŠå‰¯æœ¬è¡¥å…¨ PDå‘ç°ç³»ç»Ÿä¸­èŠ‚ç‚¹ä¹‹é—´çš„åˆ†ç‰‡æ•°ç›¸å·®è¾ƒå¤šï¼Œå°±ä¼šè½¬ç§»ä¸€äº›åˆ†ç‰‡çš„å‰¯æœ¬ï¼Œä¿æŒç³»ç»Ÿä¸­æ‰€æœ‰èŠ‚ç‚¹çš„åˆ†ç‰‡æ•°ç›®å¤§è‡´ç›¸åŒï¼ˆå­˜å‚¨å‡è¡¡ï¼‰ PDå‘ç°ç³»ç»Ÿä¸­èŠ‚ç‚¹ä¹‹é—´åˆ†ç‰‡çš„Leaderæ•°ç›®ä¸å¤ªä¸€è‡´ï¼Œå°±ä¼šè½¬ç§»ä¸€äº›å‰¯æœ¬çš„Leaderï¼Œä¿æŒç³»ç»Ÿä¸­æ‰€æœ‰èŠ‚ç‚¹çš„åˆ†ç‰‡å‰¯æœ¬çš„Leaderæ•°ç›®å¤§è‡´ç›¸åŒï¼ˆè¯»å†™è¯·æ±‚å‡è¡¡ï¼‰ æ–°çš„åˆ†ç‰‡å¦‚ä½•å½¢æˆRaft-Group å‡è®¾è¿™ä¸ªåˆ†ç‰‡1æœ‰ä¸‰ä¸ªå‰¯æœ¬åˆ†åˆ«è¿è¡Œåœ¨Node1,Node2,Node3ä¸‰å°æœºå™¨ä¸Šï¼Œå…¶ä¸­Node1æœºå™¨ä¸Šçš„å‰¯æœ¬æ˜¯Leaderï¼Œåˆ†ç‰‡çš„å¤§å°é™åˆ¶æ˜¯1GBã€‚\nå½“åˆ†ç‰‡1ç®¡ç†çš„æ•°æ®é‡è¶…è¿‡1GBçš„æ—¶å€™ï¼Œåˆ†ç‰‡1å°±ä¼šåˆ†è£‚æˆ2ä¸ªåˆ†ç‰‡ï¼Œåˆ†è£‚åï¼Œåˆ†ç‰‡1ä¿®æ”¹æ•°æ®èŒƒå›´ï¼Œæ›´æ–°Epochï¼Œç»§ç»­æœåŠ¡ã€‚\nåˆ†ç‰‡2å½¢ä¹Ÿæœ‰ä¸‰ä¸ªå‰¯æœ¬ï¼Œåˆ†åˆ«ä¹Ÿåœ¨Node1ï¼ŒNode2ï¼ŒNode3ä¸Šï¼Œè¿™äº›æ˜¯å…ƒä¿¡æ¯ï¼Œä½†æ˜¯åªæœ‰åœ¨Node1ä¸Šå­˜åœ¨çœŸæ­£è¢«åˆ›å»ºçš„å‰¯æœ¬å®ä¾‹ï¼ŒNode2ï¼ŒNode3å¹¶ä¸çŸ¥é“è¿™ä¸ªä¿¡æ¯ã€‚è¿™ä¸ªæ—¶å€™Node1ä¸Šçš„å‰¯æœ¬ä¼šç«‹å³è¿›è¡ŒCampaign Leaderçš„æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒNode2å’ŒNode3ä¼šæ”¶åˆ°æ¥è‡ªåˆ†ç‰‡2çš„Voteçš„Raftæ¶ˆæ¯(æ•´ä¸ªæè¿°æŒ‡çš„æ˜¯Leader Election)ï¼ŒNode2ï¼ŒNode3å‘ç°åˆ†ç‰‡2åœ¨è‡ªå·±çš„èŠ‚ç‚¹ä¸Šå¹¶æ²¡æœ‰å‰¯æœ¬ï¼Œé‚£ä¹ˆå°±ä¼šæ£€æŸ¥è¿™ä¸ªæ¶ˆæ¯çš„åˆæ³•æ€§å’Œæ­£ç¡®æ€§ï¼Œé€šè¿‡åï¼Œç«‹å³åˆ›å»ºåˆ†ç‰‡2çš„å‰¯æœ¬ï¼Œåˆšåˆ›å»ºçš„å‰¯æœ¬æ²¡æœ‰ä»»ä½•æ•°æ®ï¼Œåˆ›å»ºå®Œæˆåä¼šå“åº”è¿™ä¸ªVoteæ¶ˆæ¯ï¼Œä¹Ÿä¸€å®šä¼šé€‰æ‹©Node1çš„å‰¯æœ¬ä¸ºLeaderï¼Œé€‰ä¸¾å®Œæˆåï¼ŒNode1çš„åˆ†ç‰‡2çš„Leaderä¼šç»™Node2ï¼ŒNode3çš„å‰¯æœ¬ç›´æ¥å‘é€Snapshotï¼Œæœ€ç»ˆè¿™ä¸ªæ–°çš„Raft-Groupå½¢æˆå¹¶ä¸”å¯¹å¤–æœåŠ¡ã€‚\næŒ‰ç…§Raftçš„åè®®ï¼Œåˆ†ç‰‡2åœ¨Node1 çš„å‰¯æœ¬æˆä¸ºLeaderåä¸åº”è¯¥ç›´æ¥ç»™Node2ï¼ŒNode3å‘é€snapshotï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬æ²¿ç”¨äº†TiKVçš„è®¾è®¡ï¼ŒRaftåˆå§‹åŒ–çš„Log Indexæ˜¯5ï¼Œé‚£ä¹ˆæŒ‰ç…§Raftåè®®ï¼ŒNode1ä¸Šçš„å‰¯æœ¬éœ€è¦ç»™Node2ï¼ŒNode3å‘é€AppendEntriesï¼Œè¿™ä¸ªæ—¶å€™Node1ä¸Šçš„å‰¯æœ¬å‘ç°Log Indexå°äº5çš„Raft Logä¸å­˜åœ¨ï¼Œæ‰€ä»¥å°±ä¼šè½¬ä¸ºç›´æ¥å‘é€Snapshotã€‚\nSnapshotå¦‚ä½•ç®¡ç† æˆ‘ä»¬çš„åº•å±‚å­˜å‚¨å¼•æ“ä½¿ç”¨çš„æ˜¯RocksDBï¼Œè¿™æ˜¯ä¸€ä¸ªLSMçš„å®ç°ï¼Œæ”¯æŒå¯¹ä¸€ä¸ªèŒƒå›´çš„æ•°æ®è¿›è¡ŒSnapshotå’ŒApply Snapshotï¼Œæˆ‘ä»¬åŸºäºè¿™ä¸ªç‰¹æ€§æ¥åšã€‚Raftä¸­æœ‰ä¸€ä¸ªRPCç”¨äºå‘é€Snapshotæ•°æ®ï¼Œä½†æ˜¯å¦‚æœæŠŠæ‰€æœ‰çš„æ•°æ®æ”¾åœ¨è¿™ä¸ªRPCé‡Œé¢ï¼Œé‚£ä¹ˆä¼šæœ‰å¾ˆå¤šé—®é¢˜ï¼š\nä¸€ä¸ªRPCçš„æ•°æ®é‡å¤ªå¤§ï¼ˆå–å†³äºä¸€ä¸ªåˆ†ç‰‡ç®¡ç†çš„æ•°æ®ï¼Œå¯èƒ½ä¸ŠGBï¼Œå†…å­˜åƒä¸æ¶ˆï¼‰ å¦‚æœå¤±è´¥ï¼Œæ•´ä½“é‡è¯•ä»£ä»·å¤ªå¤§ éš¾ä»¥æµæ§ æˆ‘ä»¬ä¿®æ”¹ä¸ºè¿™æ ·ï¼š\nRaftçš„snapshot RPCä¸­çš„æ•°æ®å­˜æ”¾ï¼Œsnapshotæ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼ˆåŒ…æ‹¬åˆ†ç‰‡çš„IDï¼Œå½“å‰Raftçš„Termï¼ŒIndexï¼ŒEpochç­‰ä¿¡æ¯ï¼‰ å‘é€Raft snapshotçš„RPCåï¼Œå¼‚æ­¥å‘é€å…·ä½“æ•°æ®æ–‡ä»¶ æ•°æ®æ–‡ä»¶åˆ†Chunkå‘é€ï¼Œé‡è¯•çš„ä»£ä»·å° å‘é€ Chunkçš„é“¾æ¥å’ŒRaft RPCçš„é“¾æ¥ä¸å¤ç”¨ é™åˆ¶å¹¶è¡Œå‘é€çš„Chunkä¸ªæ•°ï¼Œé¿å…snapshotæ–‡ä»¶å‘é€å½±å“æ­£å¸¸çš„Raft RPC æ¥æ”¶Raft snapshotçš„åˆ†ç‰‡å‰¯æœ¬é˜»å¡ï¼Œç›´åˆ°æ¥æ”¶å®Œæ¯•å®Œæ•´çš„snapshotæ•°æ®æ–‡ä»¶ å¦‚ä½•å¤„ç†staleçš„è¯·æ±‚ ç”±äºåˆ†ç‰‡çš„å‰¯æœ¬ä¼šè¢«è°ƒåº¦ï¼ˆè½¬ç§»ï¼Œé”€æ¯ï¼‰ï¼Œåˆ†ç‰‡è‡ªèº«ä¹Ÿä¼šåˆ†è£‚ï¼ˆåˆ†è£‚ååˆ†ç‰‡æ‰€ç®¡ç†çš„æ•°æ®èŒƒå›´å‘ç”Ÿäº†å˜åŒ–ï¼‰ï¼Œæ‰€ä»¥åœ¨Raftçš„Proposalå’ŒApplyçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥Staleè¯·æ±‚ï¼Œå¦‚ä½•åšå‘¢ï¼Ÿå…¶å®è¿˜æ˜¯è›®ç®€å•çš„ï¼ŒTiKVä½¿ç”¨Epochçš„æ¦‚å¿µï¼Œæˆ‘ä»¬æ²¿ç”¨äº†ä¸‹æ¥ã€‚ä¸€ä¸ªåˆ†ç‰‡çš„å‰¯æœ¬æœ‰2ä¸ªEpochï¼Œä¸€ä¸ªåœ¨åˆ†ç‰‡çš„å‰¯æœ¬æˆå‘˜å‘ç”Ÿå˜åŒ–çš„æ—¶å€™é€’å¢ï¼Œä¸€ä¸ªåœ¨åˆ†ç‰‡æ•°æ®èŒƒå›´å‘ç”Ÿå˜åŒ–çš„æ—¶å€™é€’å¢ï¼Œåœ¨è¯·æ±‚åˆ°æ¥çš„æ—¶å€™è®°å½•å½“å‰çš„Epochï¼Œåœ¨Proposalå’ŒApplyçš„é˜¶æ®µæ£€æŸ¥Epochï¼Œè®©å®¢æˆ·ç«¯é‡è¯•Staleçš„è¯·æ±‚ã€‚\n","permalink":"https://reid00.github.io/en/posts/storage/multi-raft/","summary":"Mulit Raft Group é€šè¿‡å¯¹ Raft åè®®çš„æè¿°æˆ‘ä»¬çŸ¥é“ï¼šç”¨æˆ·åœ¨å¯¹ä¸€ç»„ Raft ç³»ç»Ÿè¿›è¡Œæ›´æ–°æ“ä½œæ—¶å¿…é¡»å…ˆç»è¿‡ Leaderï¼Œå†ç”± Leader åŒæ­¥ç»™å¤§å¤šæ•° Followerã€‚è€Œåœ¨å®é™…è¿ç”¨ä¸­ï¼Œä¸€ç»„ Raft çš„ Leader å¾€å¾€å­˜åœ¨å•ç‚¹çš„æµé‡ç“¶é¢ˆï¼Œæµé‡é«˜ä¾¿æ— æ³•æ‰¿è½½ï¼ŒåŒæ—¶æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å…¨é‡æ•°æ®ï¼Œæ‰€ä»¥ä¼šå—åˆ°èŠ‚ç‚¹çš„å­˜å‚¨é™åˆ¶è€Œå¯¼è‡´å®¹é‡ç“¶é¢ˆï¼Œæ— æ³•æ‰©å±•ã€‚\nMulit Raft Group æ­£æ˜¯é€šè¿‡æŠŠæ•´ä¸ªæ•°æ®ä»æ¨ªå‘åšåˆ‡åˆ†ï¼Œåˆ†ä¸ºå¤šä¸ª Region æ¥è§£å†³ç£ç›˜ç“¶é¢ˆï¼Œç„¶åæ¯ä¸ª Region éƒ½å¯¹åº”æœ‰ç‹¬ç«‹çš„ Leader å’Œä¸€ä¸ªæˆ–å¤šä¸ª Follower çš„ Raft ç»„è¿›è¡Œæ¨ªå‘æ‰©å±•ï¼Œæ­¤æ—¶ç³»ç»Ÿä¾¿æœ‰å¤šä¸ªå†™å…¥çš„èŠ‚ç‚¹ï¼Œä»è€Œåˆ†æ‹…å†™å…¥å‹åŠ›ï¼Œå›¾å¦‚ä¸‹ï¼š å…·ä½“ç»†èŠ‚å¯ä»¥å‚è€ƒTiKV çš„æ–‡ç« \nMulti-Raftéœ€è¦è§£å†³çš„ä¸€äº›æ ¸å¿ƒé—®é¢˜ï¼š æ•°æ®ä½•å¦‚åˆ†ç‰‡ åˆ†ç‰‡ä¸­çš„æ•°æ®è¶Šæ¥è¶Šå¤§ï¼Œéœ€è¦åˆ†è£‚äº§ç”Ÿæ›´å¤šçš„åˆ†ç‰‡ï¼Œç»„æˆæ›´å¤šRaft-Group åˆ†ç‰‡çš„è°ƒåº¦ï¼Œè®©è´Ÿè½½åœ¨ç³»ç»Ÿä¸­æ›´å¹³å‡ï¼ˆåˆ†ç‰‡å‰¯æœ¬çš„è¿ç§»ï¼Œè¡¥å…¨ï¼ŒLeaderåˆ‡æ¢ç­‰ç­‰ï¼‰ ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ‰€æœ‰çš„Raft-Groupå¤ç”¨é“¾æ¥ï¼ˆå¦åˆ™Raftå‰¯æœ¬ä¹‹é—´ä¸¤ä¸¤å»ºé“¾ï¼Œé“¾æ¥çˆ†ç‚¸äº†ï¼‰ å¦‚ä½•å¤„ç†staleçš„è¯·æ±‚ï¼ˆä¾‹å¦‚Proposalå’ŒApplyçš„æ—¶å€™ï¼Œå½“å‰çš„å‰¯æœ¬ä¸æ˜¯Leaderã€åˆ†è£‚äº†ã€è¢«é”€æ¯äº†ç­‰ç­‰ï¼‰ Snapshotå¦‚ä½•ç®¡ç†ï¼ˆé™åˆ¶Snapshotï¼Œé¿å…å¸¦å®½ã€CPUã€IOèµ„æºè¢«è¿‡åº¦å ç”¨ï¼‰ æ•°æ®ä½•å¦‚åˆ†ç‰‡ é€šå¸¸çš„æ•°æ®åˆ†ç‰‡ç®—æ³•å°±æ˜¯ Hash å’Œ Rangeï¼ŒTiKV ä½¿ç”¨çš„ Range æ¥å¯¹æ•°æ®è¿›è¡Œæ•°æ®åˆ†ç‰‡ã€‚ä¸ºä»€ä¹ˆä½¿ç”¨ Rangeï¼Œä¸»è¦åŸå› æ˜¯èƒ½æ›´å¥½çš„å°†ç›¸åŒå‰ç¼€çš„ key èšåˆåœ¨ä¸€èµ·ï¼Œä¾¿äº scan ç­‰æ“ä½œï¼Œè¿™ä¸ª Hash æ˜¯æ²¡æ³•æ”¯æŒçš„ï¼Œå½“ç„¶ï¼Œåœ¨ split/merge ä¸Šé¢ Range ä¹Ÿæ¯” Hash å¥½å¤„ç†å¾ˆå¤šï¼Œå¾ˆå¤šæ—¶å€™åªä¼šæ¶‰åŠåˆ°å…ƒä¿¡æ¯çš„ä¿®æ”¹ï¼Œéƒ½ä¸ç”¨å¤§èŒƒå›´çš„æŒªåŠ¨æ•°æ®ã€‚\nå½“ç„¶ï¼ŒRange æœ‰ä¸€ä¸ªé—®é¢˜åœ¨äºå¾ˆæœ‰å¯èƒ½æŸä¸€ä¸ª Region ä¼šå› ä¸ºé¢‘ç¹çš„æ“ä½œæˆä¸ºæ€§èƒ½çƒ­ç‚¹ï¼Œå½“ç„¶ä¹Ÿæœ‰ä¸€äº›ä¼˜åŒ–çš„æ–¹å¼ï¼Œè­¬å¦‚é€šè¿‡ PD å°†è¿™äº› Region è°ƒåº¦åˆ°æ›´å¥½çš„æœºå™¨ä¸Šé¢ï¼Œæä¾› Follower åˆ†æ‹…è¯»å‹åŠ›ç­‰ã€‚","title":"Multi Raft"},{"content":"ä»‹ç» å¯¹Raft Figure2 ä¸­éœ€è¦æŒä¹…åŒ–çš„å­—æ®µè¿›è¡Œä¿å­˜ã€‚\nå®Œæˆpersist()å’ŒreadPersist()å‡½æ•°ï¼Œç¼–ç æ–¹å¼å‚ç…§æ³¨é‡Š ä¼˜åŒ–nextIndex[]å›é€€æ–¹å¼ï¼Œå¦åˆ™æ— æ³•é€šè¿‡æ‰€æœ‰æµ‹è¯• æç¤º:\néœ€è¦æŒä¹…åŒ–çš„éƒ¨åˆ†åŒ…æ‹¬currentTermã€votedForã€logã€‚ æœ‰å…³nextIndex[]å›é€€ä¼˜åŒ– é€»è¾‘å¦‚ä¸‹ï¼š è‹¥ follower æ²¡æœ‰ prevLogIndex å¤„çš„æ—¥å¿—ï¼Œåˆ™ç›´æ¥ç½® conflictIndex = len(log)ï¼ŒconflictTerm = Noneï¼› leader æ”¶åˆ°è¿”å›ä½“åï¼Œè‚¯å®šæ‰¾ä¸åˆ°å¯¹åº”çš„ termï¼Œåˆ™è®¾ç½®nextIndex = conflictIndexï¼› å…¶å®å°±æ˜¯ leader å¯¹åº”çš„ nextIndex ç›´æ¥å›é€€åˆ°è¯¥ follower çš„æ—¥å¿—æ¡ç›®æœ«å°¾å¤„ï¼Œå› ä¸º prevLogIndex è¶…å‰äº† è‹¥ follower æœ‰ prevLogIndex å¤„çš„æ—¥å¿—ï¼Œä½†æ˜¯ term ä¸åŒ¹é…ï¼›åˆ™è®¾ç½® conlictTermä¸º prevLogIndex å¤„çš„ termï¼Œä¸”è‚¯å®šå¯ä»¥æ‰¾åˆ°æ—¥å¿—ä¸­è¯¥ termå‡ºç°çš„ç¬¬ä¸€ä¸ªæ—¥å¿—æ¡ç›®çš„ä¸‹æ ‡ï¼Œå¹¶ç½®conflictIndex = firstIndexWithTermï¼› leader æ”¶åˆ°è¿”å›ä½“åï¼Œæœ‰å¯èƒ½æ‰¾ä¸åˆ°å¯¹åº”çš„ termï¼Œå³ leader å’Œ follower åœ¨conflictIndexå¤„ä»¥åŠä¹‹åçš„æ—¥å¿—éƒ½æœ‰å†²çªï¼Œéƒ½ä¸èƒ½è¦äº†ï¼Œç›´æ¥ç½®nextIndex = conflictIndex è‹¥æ‰¾åˆ°äº†å¯¹åº”çš„termï¼Œåˆ™æ‰¾åˆ°å¯¹åº”termå‡ºç°çš„æœ€åä¸€ä¸ªæ—¥å¿—æ¡ç›®çš„ä¸‹ä¸€ä¸ªæ—¥å¿—æ¡ç›®ï¼Œå³ç½®nextIndex = lastIndexWithTerm+1ï¼›è¿™é‡Œå…¶å®æ˜¯é»˜è®¤äº†è‹¥ leader å’Œ follower åŒæ—¶æ‹¥æœ‰è¯¥ term çš„æ—¥å¿—ï¼Œåˆ™ä¸ä¼šæœ‰å†²çªï¼Œç›´æ¥å–ä¸‹ä¸€ä¸ª term ä½œä¸ºæ—¥å¿—å‘èµ·å°±å¥½ï¼Œæ˜¯æºè‡ªäº 5.4 safety çš„å®‰å…¨æ€§ä¿è¯ å¦‚æœè¿˜æœ‰å†²çªï¼Œleader å’Œ follower ä¼šä¸€ç›´æ ¹æ®ä»¥ä¸Šè§„åˆ™å›æº¯ nextIndex\næŒä¹…åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 func (rf *Raft) persist() { // Your code here (2C). // Example: // w := new(bytes.Buffer) // e := labgob.NewEncoder(w) // e.Encode(rf.xxx) // e.Encode(rf.yyy) // data := w.Bytes() // rf.persister.SaveRaftState(data) rf.persister.SaveRaftState(rf.encodeState()) } func (rf *Raft) encodeState() []byte { buf := new(bytes.Buffer) enc := labgob.NewEncoder(buf) // figure2 Persistent state on all servers enc.Encode(rf.currentTerm) enc.Encode(rf.votedFor) enc.Encode(rf.logs) return buf.Bytes() } // restore previously persisted state. func (rf *Raft) readPersist(data []byte) { if len(data) \u0026lt; 1 { return } buf := bytes.NewBuffer(data) dec := labgob.NewDecoder(buf) var currentTerm, votedFor int var logs []Entry if dec.Decode(\u0026amp;currentTerm) != nil || dec.Decode(\u0026amp;votedFor) != nil || dec.Decode(\u0026amp;logs) != nil { DPrintf(\u0026#34;[readPersist] - {Node: %v} restore persisted data failed\u0026#34;, rf.me) } rf.currentTerm, rf.votedFor, rf.logs = currentTerm, votedFor, logs rf.lastApplied, rf.commitIndex = rf.logs[0].Index, rf.logs[0].Index // Your code here (2C). // Example: // r := bytes.NewBuffer(data) // d := labgob.NewDecoder(r) // var xxx // var yyy // if d.Decode(\u0026amp;xxx) != nil || // d.Decode(\u0026amp;yyy) != nil { // error... // } else { // rf.xxx = xxx // rf.yyy = yyy // } } nextIndex ä¼˜åŒ– Lab 2B ä¸­å¯¹äºå¤±è´¥çš„AppendEntriesè¯·æ±‚ï¼Œè®©nextIndexè‡ªå‡ï¼Œè¿™æ ·æ•ˆç‡æ˜¯æ¯”è¾ƒæ…¢çš„ã€‚æ–¹æ³•ä¸Šå¯ä»¥ä»¥Term ä¸ºå•ä½è¿”å›ï¼Œä¸åœ¨ä¸€ä¸ªä¸€ä¸ªIndex è‡ªå‡ã€‚ è¿™éœ€è¦æ·»åŠ  ConflicTerm, ConflictIndex å­—æ®µ å»è®°å½•å‡ºç°å†²çªçš„ä½ç½®å’Œä»»æœŸã€‚ç„¶ååœ¨ HanleAppendEntries RPC ä¸­ï¼Œåœ¨ Leader çš„log ä¸­æ£€æŸ¥ ConflictIndex ä½ç½®çš„æ—¥å¿—ä¸€è‡´æ€§ã€‚\nä¼˜åŒ–ç‚¹1 å¦‚æœfollower.logä¸å­˜åœ¨prevLogï¼Œè®©Leaderä¸‹ä¸€æ¬¡ä»follower.logçš„æœ«å°¾å¼€å§‹åŒæ­¥æ—¥å¿—ã€‚ ä¼˜åŒ–ç‚¹2 å¦‚æœæ˜¯å› ä¸ºprevLog.Termä¸åŒ¹é…ï¼Œè®°follower.prevLog.Termä¸ºconflictTermã€‚ å¦‚æœleader.logæ‰¾ä¸åˆ°Termä¸ºconflictTermçš„æ—¥å¿—ï¼Œåˆ™ä¸‹ä¸€æ¬¡ä»follower.logä¸­conflictTermçš„ç¬¬ä¸€ä¸ªlogçš„ä½ç½®å¼€å§‹åŒæ­¥æ—¥å¿—ã€‚ å¦‚æœleader.logæ‰¾åˆ°äº†Termä¸ºconflictTermçš„æ—¥å¿—ï¼Œåˆ™ä¸‹ä¸€æ¬¡ä»leader.logä¸­conflictTermçš„æœ€åä¸€ä¸ªlogçš„ä¸‹ä¸€ä¸ªä½ç½®å¼€å§‹åŒæ­¥æ—¥å¿—ã€‚ nextIndexçš„æ­£ç¡®ä½ç½®å¯èƒ½ä¾æ—§éœ€è¦å¤šæ¬¡RPCæ‰èƒ½æ‰¾åˆ°ï¼Œæ”¹è¿›çš„æµç¨‹åªæ˜¯åŠ å¿«äº†æ‰¾åˆ°æ­£ç¡®nextIndexçš„é€Ÿåº¦ã€‚\n","permalink":"https://reid00.github.io/en/posts/storage/mit6.824-2022-raft-lab2c-log-compaction/","summary":"ä»‹ç» å¯¹Raft Figure2 ä¸­éœ€è¦æŒä¹…åŒ–çš„å­—æ®µè¿›è¡Œä¿å­˜ã€‚\nå®Œæˆpersist()å’ŒreadPersist()å‡½æ•°ï¼Œç¼–ç æ–¹å¼å‚ç…§æ³¨é‡Š ä¼˜åŒ–nextIndex[]å›é€€æ–¹å¼ï¼Œå¦åˆ™æ— æ³•é€šè¿‡æ‰€æœ‰æµ‹è¯• æç¤º:\néœ€è¦æŒä¹…åŒ–çš„éƒ¨åˆ†åŒ…æ‹¬currentTermã€votedForã€logã€‚ æœ‰å…³nextIndex[]å›é€€ä¼˜åŒ– é€»è¾‘å¦‚ä¸‹ï¼š è‹¥ follower æ²¡æœ‰ prevLogIndex å¤„çš„æ—¥å¿—ï¼Œåˆ™ç›´æ¥ç½® conflictIndex = len(log)ï¼ŒconflictTerm = Noneï¼› leader æ”¶åˆ°è¿”å›ä½“åï¼Œè‚¯å®šæ‰¾ä¸åˆ°å¯¹åº”çš„ termï¼Œåˆ™è®¾ç½®nextIndex = conflictIndexï¼› å…¶å®å°±æ˜¯ leader å¯¹åº”çš„ nextIndex ç›´æ¥å›é€€åˆ°è¯¥ follower çš„æ—¥å¿—æ¡ç›®æœ«å°¾å¤„ï¼Œå› ä¸º prevLogIndex è¶…å‰äº† è‹¥ follower æœ‰ prevLogIndex å¤„çš„æ—¥å¿—ï¼Œä½†æ˜¯ term ä¸åŒ¹é…ï¼›åˆ™è®¾ç½® conlictTermä¸º prevLogIndex å¤„çš„ termï¼Œä¸”è‚¯å®šå¯ä»¥æ‰¾åˆ°æ—¥å¿—ä¸­è¯¥ termå‡ºç°çš„ç¬¬ä¸€ä¸ªæ—¥å¿—æ¡ç›®çš„ä¸‹æ ‡ï¼Œå¹¶ç½®conflictIndex = firstIndexWithTermï¼› leader æ”¶åˆ°è¿”å›ä½“åï¼Œæœ‰å¯èƒ½æ‰¾ä¸åˆ°å¯¹åº”çš„ termï¼Œå³ leader å’Œ follower åœ¨conflictIndexå¤„ä»¥åŠä¹‹åçš„æ—¥å¿—éƒ½æœ‰å†²çªï¼Œéƒ½ä¸èƒ½è¦äº†ï¼Œç›´æ¥ç½®nextIndex = conflictIndex è‹¥æ‰¾åˆ°äº†å¯¹åº”çš„termï¼Œåˆ™æ‰¾åˆ°å¯¹åº”termå‡ºç°çš„æœ€åä¸€ä¸ªæ—¥å¿—æ¡ç›®çš„ä¸‹ä¸€ä¸ªæ—¥å¿—æ¡ç›®ï¼Œå³ç½®nextIndex = lastIndexWithTerm+1ï¼›è¿™é‡Œå…¶å®æ˜¯é»˜è®¤äº†è‹¥ leader å’Œ follower åŒæ—¶æ‹¥æœ‰è¯¥ term çš„æ—¥å¿—ï¼Œåˆ™ä¸ä¼šæœ‰å†²çªï¼Œç›´æ¥å–ä¸‹ä¸€ä¸ª term ä½œä¸ºæ—¥å¿—å‘èµ·å°±å¥½ï¼Œæ˜¯æºè‡ªäº 5.4 safety çš„å®‰å…¨æ€§ä¿è¯ å¦‚æœè¿˜æœ‰å†²çªï¼Œleader å’Œ follower ä¼šä¸€ç›´æ ¹æ®ä»¥ä¸Šè§„åˆ™å›æº¯ nextIndex","title":"MIT6.824 2022 Raft Lab2C Log Compaction"},{"content":"ä»‹ç» snapshotæ˜¯çŠ¶æ€æœºæŸä¸€æ—¶åˆ»çš„å‰¯æœ¬ï¼Œå…·ä½“æ ¼å¼ä¾èµ–å­˜å‚¨å¼•æ“çš„å®ç°ï¼Œæ¯”å¦‚è¯´ï¼šB+æ ‘ã€LSMã€å“ˆå¸Œè¡¨ç­‰ï¼Œ6.824æ˜¯å®ç°ä¸€ä¸ªé”®å€¼æ•°æ®åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨çš„æ˜¯å“ˆå¸Œè¡¨ï¼Œåœ¨Lab 3å¯ä»¥çœ‹åˆ°å®ç°ã€‚\nrafté€šè¿‡æ—¥å¿—æ¥å®ç°å¤šå‰¯æœ¬çš„æ•°æ®ä¸€è‡´ï¼Œä½†æ˜¯æ—¥å¿—ä¼šä¸æ–­è†¨èƒ€ï¼Œå¸¦æ¥ä¸¤ä¸ªç¼ºç‚¹ï¼šæ•°æ®é‡å¤§ã€æ¢å¤æ—¶é—´é•¿ï¼Œå› æ­¤éœ€è¦å®šæœŸå‹ç¼©ä¸€ä¸‹ï¼Œç”Ÿæˆsnapshotã€‚\nå¿«ç…§ç”±ä¸Šå±‚åº”ç”¨è§¦å‘ã€‚å½“ä¸Šå±‚åº”ç”¨è®¤ä¸ºå¯ä»¥å°†ä¸€äº›å·²æäº¤çš„ entry å‹ç¼©æˆ snapshot æ—¶ï¼Œå…¶ä¼šè°ƒç”¨èŠ‚ç‚¹çš„ Snapshot()å‡½æ•°ï¼Œå°†éœ€è¦å‹ç¼©çš„çŠ¶æ€æœºçš„çŠ¶æ€æ•°æ®ä¼ é€’ç»™èŠ‚ç‚¹ï¼Œä½œä¸ºå¿«ç…§ã€‚\nåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œä»…ç”±ä¸Šå±‚åº”ç”¨å‘½ä»¤èŠ‚ç‚¹è¿›è¡Œå¿«ç…§å³å¯ã€‚ä½†å¦‚æœèŠ‚ç‚¹å‡ºç°è½åæˆ–è€…å´©æºƒï¼Œæƒ…å†µåˆ™å˜å¾—æ›´åŠ å¤æ‚ã€‚è€ƒè™‘ä¸€ä¸ªæ—¥å¿—éå¸¸è½åçš„èŠ‚ç‚¹ iï¼Œå½“ Leader å‘å…¶å‘é€ AppendEntries RPC æ—¶ï¼ŒnextIndex[i] å¯¹åº”çš„ entry å·²è¢«ä¸¢å¼ƒï¼Œå‹ç¼©åœ¨å¿«ç…§ä¸­ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œ Leader å°±æ— æ³•å¯¹å…¶è¿›è¡Œ AppendEntriesã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œè¿™é‡Œæˆ‘ä»¬åº”è¯¥å®ç°ä¸€ä¸ªæ–°çš„ InstallSnapshot RPCï¼Œå°† Leader å½“å‰çš„å¿«ç…§ç›´æ¥å‘é€ç»™éå¸¸è½åçš„ Followerã€‚\nä½•æ—¶å¿«ç…§ï¼Ÿ\næœåŠ¡ç«¯è§¦å‘çš„æ—¥å¿—å‹ç¼©:ä¸Šå±‚åº”ç”¨å‘é€å¿«ç…§æ•°æ®ç»™Raftå®ä¾‹ã€‚ leader å‘é€æ¥çš„ InstallSnapshot:é¢†å¯¼è€…å‘é€å¿«ç…§RPCè¯·æ±‚ç»™è¿½éšè€…ã€‚å½“raftæ”¶åˆ°å…¶ä»–èŠ‚ç‚¹çš„å‹ç¼©è¯·æ±‚åï¼Œå…ˆæŠŠè¯·æ±‚ä¸ŠæŠ¥ç»™ä¸Šå±‚åº”ç”¨ï¼Œç„¶åä¸Šå±‚åº”ç”¨è°ƒç”¨rf.CondInstallSnapshot()æ¥å†³å®šæ˜¯å¦å®‰è£…å¿«ç…§ æµç¨‹æ¢³ç† å¿«ç…§æ˜¯çŠ¶æ€æœºä¸­çš„æ¦‚å¿µï¼Œéœ€è¦åœ¨çŠ¶æ€æœºä¸­åŠ è½½å¿«ç…§ï¼Œå› æ­¤è¦é€šè¿‡applyChå°†å¿«ç…§å‘é€ç»™çŠ¶æ€æœºï¼Œä½†æ˜¯å‘é€åRaftå¹¶ä¸ç«‹å³ä¿å­˜å¿«ç…§ï¼Œè€Œæ˜¯ç­‰å¾…çŠ¶æ€æœºè°ƒç”¨ CondInstallSnapshot()ï¼Œå¦‚æœä»æ”¶åˆ°InstallSnapshot()ååˆ°æ”¶åˆ°CondInstallSnapshot()å‰ï¼Œæ²¡æœ‰æ–°çš„æ—¥å¿—æäº¤åˆ°çŠ¶æ€æœºï¼Œåˆ™Raftè¿”å›Trueï¼ŒRaftå’ŒçŠ¶æ€æœºä¿å­˜å¿«ç…§ï¼Œå¦åˆ™Raftè¿”å›Falseï¼Œä¸¤è€…éƒ½ä¸ä¿å­˜å¿«ç…§ã€‚\nå¦‚æ­¤ä¿è¯äº†Raftå’ŒçŠ¶æ€æœºä¿å­˜å¿«ç…§æ˜¯ä¸€ä¸ªåŸå­æ“ä½œ(SaveStateAndSnapshot)ã€‚å½“ç„¶åœ¨InstallSnapshot()å°†å¿«ç…§å‘é€ç»™çŠ¶æ€æœºåå†å°†å¿«ç…§ä¿å­˜åˆ°Raftï¼Œä»¤CondInstallSnap()æ°¸è¿œè¿”å›Trueï¼Œä¹Ÿå¯ä»¥ä¿è¯åŸå­æ“ä½œï¼Œä½†æ˜¯è¿™æ ·åšå¿…é¡»ç­‰å¾…å¿«ç…§å‘é€ç»™çŠ¶æ€æœºå®Œæˆï¼Œä½†æ˜¯rf.applyCh \u0026lt;- ApplyMsgæ˜¯æœ‰å¯èƒ½é˜»å¡çš„ï¼Œç”±äºInstallSnapshot()éœ€è¦æŒæœ‰å…¨å±€çš„äº’æ–¥é”ï¼Œè¿™å¯èƒ½å¯¼è‡´æ•´ä¸ªèŠ‚ç‚¹æ— æ³•å·¥ä½œã€‚\næœåŠ¡ç«¯è§¦å‘çš„æ—¥å¿—å‹ç¼©: ä¸Šå±‚åº”ç”¨å‘é€å¿«ç…§æ•°æ®ç»™Raftå®ä¾‹ã€‚ leader å‘é€æ¥çš„ InstallSnapshot: Leaderå‘é€å¿«ç…§RPCè¯·æ±‚ç»™Followerã€‚å½“raftæ”¶åˆ°å…¶ä»–èŠ‚ç‚¹çš„å‹ç¼©è¯·æ±‚åï¼Œå…ˆæŠŠè¯·æ±‚ä¸ŠæŠ¥ç»™ä¸Šå±‚åº”ç”¨ï¼Œç„¶åä¸Šå±‚åº”ç”¨è°ƒç”¨rf.CondInstallSnapshot()æ¥å†³å®šæ˜¯å¦å®‰è£…å¿«ç…§(SaveStateAndSnapshot) ç›¸å…³å‡½æ•°è§£æ æœåŠ¡ç«¯è§¦å‘çš„Log Compact func (rf *Raft) Snapshot(index int, snapshot []byte) åº”ç”¨ç¨‹åºå°†indexï¼ˆåŒ…æ‹¬ï¼‰ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—éƒ½æ‰“åŒ…ä¸ºäº†å¿«ç…§ï¼Œå³å‚æ•°snapshot [] byteã€‚é‚£ä¹ˆå¯¹äºRaftè¦åšçš„å°±æ˜¯ï¼Œå°†æ‰“åŒ…ä¸ºå¿«ç…§çš„æ—¥å¿—ç›´æ¥åˆ é™¤ï¼Œå¹¶ä¸”è¦å°†å¿«ç…§ä¿å­˜èµ·æ¥ï¼Œå› ä¸ºå°†æ¥å¯èƒ½ä¼šå‘ç°æŸäº›èŠ‚ç‚¹å¤§å¹…åº¦è½åäºleaderçš„æ—¥å¿—ï¼Œé‚£ä¹ˆleaderå°±ç›´æ¥å‘é€å¿«ç…§ç»™å®ƒï¼Œè®©ä»–çš„æ—¥å¿—â€œè·Ÿä¸Šæ¥â€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 func (rf *Raft) Snapshot(index int, snapshot []byte) { // Your code here (2D). rf.mu.Lock() defer rf.mu.Unlock() lastSnapshotIndex := rf.getFirstLog().Index // å½“å‰èŠ‚ç‚¹çš„firstLogIndex æ¯”è¦æ·»åŠ çš„Snapshot LastIncludedIndex å¤§ï¼Œè¯´æ˜å·²ç»å­˜åœ¨äº†Snapshot åŒ…å«äº†æ›´å¤šçš„log if index \u0026lt;= lastSnapshotIndex { DPrintf(\u0026#34;[Snapshot] - {Node %v} rejects replacing log with snapshotIndex %v as current lastSnapshotIndex %v is larger in term %v\u0026#34;, rf.me, index, lastSnapshotIndex, rf.currentTerm) return } // æ–°çš„æ—¥å¿—ç´¢å¼•åŒ…å«äº† LastIncludedIndex è¿™ä¸ªä½ç½®ï¼Œå› ä¸ºè¦æŠŠå®ƒä½œä¸ºdummpy index rf.logs = shrinkEntriesArray(rf.logs[index-lastSnapshotIndex:]) rf.logs[0].Command = nil rf.persister.SaveStateAndSnapshot(rf.encodeState(), snapshot) DPrintf(\u0026#34;[Snapshot] - {Node: %v}\u0026#39;s state is {state %v, term %v, commitIndex %v, lastApplied %v, firstLog %v, lastLogLog %v} after replacing log with snapshotIndex %v as lastSnapshotIndex %v is smaller\u0026#34;, rf.me, rf.state, rf.currentTerm, rf.commitIndex, rf.lastApplied, rf.getFirstLog(), rf.getLastLog(), index, lastSnapshotIndex) } ç”± Leader å‘é€æ¥çš„ InstallSnapshot func (rf *Raft) InstallSnapshot(req *InstallSnapshotReq, resp *InstallSnapshotResp)\nå¯¹äº leader å‘è¿‡æ¥çš„ InstallSnapshotï¼Œåªéœ€è¦åˆ¤æ–­ term æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœæ— è¯¯åˆ™ follower åªèƒ½æ— æ¡ä»¶æ¥å—ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 func (rf *Raft) InstallSnapshot(req *InstallSnapshotReq, resp *InstallSnapshotResp) { rf.mu.Lock() defer rf.mu.Unlock() defer DPrintf(\u0026#34;[InstallSnapshot] - {Node %v}\u0026#39;s state is {state %v,term %v,commitIndex %v,lastApplied %v,firstLog %v,lastLog %v} before processing InstallSnapshotRequest %v and reply InstallSnapshotResponse %v\u0026#34;, rf.me, rf.state, rf.currentTerm, rf.commitIndex, rf.lastApplied, rf.getFirstLog(), rf.getLastLog(), req, resp) resp.Term = rf.currentTerm if req.Term \u0026lt; rf.currentTerm { return } if req.Term \u0026gt; rf.currentTerm { rf.currentTerm, rf.votedFor = req.Term, -1 rf.persist() } rf.ChangeState(StateFollower) rf.electionTimer.Reset(RandomizedElectionTimeout()) // outdated snapshot // snapshot çš„ lastIncludedIndex å°äºç­‰äºæœ¬åœ°çš„ commitIndexï¼Œ // é‚£è¯´æ˜æœ¬åœ°å·²ç»åŒ…å«äº†è¯¥ snapshot æ‰€æœ‰çš„æ•°æ®ä¿¡æ¯ï¼Œå°½ç®¡å¯èƒ½çŠ¶æ€æœºè¿˜æ²¡æœ‰è¿™ä¸ª snapshot æ–°ï¼Œ // å³ lastApplied è¿˜æ²¡æ›´æ–°åˆ° commitIndexï¼Œä½†æ˜¯ applier åç¨‹ä¹Ÿä¸€å®šå°è¯•åœ¨ apply äº†ï¼Œ // æ­¤æ—¶ä¾¿æ²¡å¿…è¦å†å»ç”¨ snapshot æ›´æ¢çŠ¶æ€æœºäº†ã€‚å¯¹äºæ›´æ–°çš„ snapshotï¼Œè¿™é‡Œé€šè¿‡å¼‚æ­¥çš„æ–¹å¼å°†å…¶ // push åˆ° applyCh ä¸­ã€‚ if req.LastIncludedIndex \u0026lt;= rf.commitIndex { return } go func() { rf.applyCh \u0026lt;- ApplyMsg{ SnapshotValid: true, Snapshot: req.Data, SnapshotTerm: req.LastIncludedTerm, SnapshotIndex: req.LastIncludedIndex, } }() } Follower æ”¶åˆ° InstallSnapshot RPC å func (rf *Raft) CondInstallSnapshot(lastIncludedTerm int, lastIncludedIndex int, snapshot []byte) bool\nFolloweræ¥æ”¶åˆ°snapshotåä¸èƒ½å¤Ÿç«‹åˆ»åº”ç”¨å¹¶æˆªæ–­æ—¥å¿—ï¼Œraftå’ŒçŠ¶æ€æœºéƒ½éœ€è¦åº”ç”¨snapshotï¼Œè¿™éœ€è¦è€ƒè™‘åŸå­æ€§ã€‚å¦‚æœraftåº”ç”¨æˆåŠŸä½†çŠ¶æ€æœºåº”ç”¨snapshotå¤±è´¥ï¼Œé‚£ä¹ˆåœ¨æ¥ä¸‹æ¥çš„æ—¶é—´é‡Œå®¢æˆ·ç«¯è¯»åˆ°çš„æ•°æ®æ˜¯ä¸å®Œæ•´çš„ã€‚å¦‚æœçŠ¶æ€æœºåº”ç”¨snapshotæˆåŠŸä½†raftåº”ç”¨å¤±è´¥ï¼Œé‚£ä¹ˆraftä¼šè¦æ±‚é‡ä¼ ï¼ŒçŠ¶æ€æœºåº”ç”¨æˆåŠŸä¹Ÿæ²¡å•¥æ„ä¹‰ã€‚å› æ­¤CondInstallSnapshotæ˜¯å¼‚æ­¥äºraftçš„ï¼Œå¹¶ç”±åº”ç”¨å±‚è°ƒç”¨ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 func (rf *Raft) CondInstallSnapshot(lastIncludedTerm int, lastIncludedIndex int, snapshot []byte) bool { // Your code here (2D). rf.mu.Lock() defer rf.mu.Unlock() DPrintf(\u0026#34;[CondInstallSnapshot] - {Node %v} service calls CondInstallSnapshot with lastIncludedTerm %v and lastIncludedIndex %v to check whether snapshot is still valid in term %v\u0026#34;, rf.me, lastIncludedTerm, lastIncludedIndex, rf.currentTerm) // outdated snapshot if lastIncludedIndex \u0026lt;= rf.commitIndex { DPrintf(\u0026#34;[CondInstallSnapshot] - {Node %v} rejects the snapshot which lastIncludedIndex is %v because commitIndex %v is larger\u0026#34;, rf.me, lastIncludedIndex, rf.commitIndex) return false } if lastIncludedIndex \u0026gt; rf.getLastLog().Index { rf.logs = make([]Entry, 1) } else { rf.logs = shrinkEntriesArray(rf.logs[lastIncludedIndex-rf.getFirstLog().Index:]) rf.logs[0].Command = nil } rf.logs[0].Term, rf.logs[0].Index = lastIncludedTerm, lastIncludedIndex rf.lastApplied, rf.commitIndex = lastIncludedIndex, lastIncludedIndex rf.persister.SaveStateAndSnapshot(rf.encodeState(), snapshot) DPrintf(\u0026#34;[CondInstallSnapshot] - {Node %v}\u0026#39;s state is {state %v,term %v,commitIndex %v,lastApplied %v,firstLog %v,lastLog %v} after accepting the snapshot which lastIncludedTerm is %v, lastIncludedIndex is %v\u0026#34;, rf.me, rf.state, rf.currentTerm, rf.commitIndex, rf.lastApplied, rf.getFirstLog(), rf.getLastLog(), lastIncludedTerm, lastIncludedIndex) return true } å‡è®¾æœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¸€ç›´æ˜¯ crash çš„ï¼Œç„¶åå¤æ´»äº†ï¼Œleader å‘ç°å…¶è½åçš„å¤ªå¤šï¼Œäºæ˜¯å‘é€ InstallSnapshot() RPC åˆ°è½åçš„èŠ‚ç‚¹ä¸Šé¢ã€‚è½åèŠ‚ç‚¹æ”¶åˆ° InstallSnapshot() ä¸­çš„ snapshot åï¼Œé€šè¿‡ rf.applyCh å‘é€ç»™ä¸Šå±‚ service ã€‚ä¸Šå±‚çš„ service æ”¶åˆ° snapshot æ—¶ï¼Œè°ƒç”¨èŠ‚ç‚¹çš„ CondInstallSnapshot() æ–¹æ³•ã€‚èŠ‚ç‚¹å¦‚æœåœ¨è¯¥ snapshot ä¹‹åæœ‰æ–°çš„ commitï¼Œåˆ™æ‹’ç»å®‰è£…æ­¤ snapshot CondInstallSnapshot ä¸­çš„ lastIncludedIndex \u0026lt;= rf.commitIndexï¼Œservice ä¹Ÿä¼šæ”¾å¼ƒæœ¬æ¬¡å®‰è£…ã€‚åä¹‹å¦‚æœåœ¨è¯¥ snapshot ä¹‹åæ²¡æœ‰æ–°çš„ commitï¼Œé‚£ä¹ˆèŠ‚ç‚¹ä¼šå®‰è£…æ­¤ snapshot å¹¶è¿”å› trueï¼Œservice æ”¶åˆ°åä¹ŸåŒæ­¥å®‰è£…ã€‚ åœ¨å®éªŒå¤§çº²ä¸­æŒ‡å‡ºä¸èƒ½ç›´æ¥é€šè¿‡rf.logs[idx:] çš„æ–¹å¼å»åšæ—¥å¿—çš„æˆªå–ä¿å­˜ï¼Œé˜²æ­¢GC ä¸èƒ½åŠæ—¶å›æ”¶ã€‚\nRaft must discard old log entries in a way that allows the Go garbage collector to free and re-use the memory; this requires that there be no reachable references (pointers) to the discarded log entries.\n","permalink":"https://reid00.github.io/en/posts/storage/mit6.824-2022-raft-lab2d-log-persistence/","summary":"ä»‹ç» snapshotæ˜¯çŠ¶æ€æœºæŸä¸€æ—¶åˆ»çš„å‰¯æœ¬ï¼Œå…·ä½“æ ¼å¼ä¾èµ–å­˜å‚¨å¼•æ“çš„å®ç°ï¼Œæ¯”å¦‚è¯´ï¼šB+æ ‘ã€LSMã€å“ˆå¸Œè¡¨ç­‰ï¼Œ6.824æ˜¯å®ç°ä¸€ä¸ªé”®å€¼æ•°æ®åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨çš„æ˜¯å“ˆå¸Œè¡¨ï¼Œåœ¨Lab 3å¯ä»¥çœ‹åˆ°å®ç°ã€‚\nrafté€šè¿‡æ—¥å¿—æ¥å®ç°å¤šå‰¯æœ¬çš„æ•°æ®ä¸€è‡´ï¼Œä½†æ˜¯æ—¥å¿—ä¼šä¸æ–­è†¨èƒ€ï¼Œå¸¦æ¥ä¸¤ä¸ªç¼ºç‚¹ï¼šæ•°æ®é‡å¤§ã€æ¢å¤æ—¶é—´é•¿ï¼Œå› æ­¤éœ€è¦å®šæœŸå‹ç¼©ä¸€ä¸‹ï¼Œç”Ÿæˆsnapshotã€‚\nå¿«ç…§ç”±ä¸Šå±‚åº”ç”¨è§¦å‘ã€‚å½“ä¸Šå±‚åº”ç”¨è®¤ä¸ºå¯ä»¥å°†ä¸€äº›å·²æäº¤çš„ entry å‹ç¼©æˆ snapshot æ—¶ï¼Œå…¶ä¼šè°ƒç”¨èŠ‚ç‚¹çš„ Snapshot()å‡½æ•°ï¼Œå°†éœ€è¦å‹ç¼©çš„çŠ¶æ€æœºçš„çŠ¶æ€æ•°æ®ä¼ é€’ç»™èŠ‚ç‚¹ï¼Œä½œä¸ºå¿«ç…§ã€‚\nåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œä»…ç”±ä¸Šå±‚åº”ç”¨å‘½ä»¤èŠ‚ç‚¹è¿›è¡Œå¿«ç…§å³å¯ã€‚ä½†å¦‚æœèŠ‚ç‚¹å‡ºç°è½åæˆ–è€…å´©æºƒï¼Œæƒ…å†µåˆ™å˜å¾—æ›´åŠ å¤æ‚ã€‚è€ƒè™‘ä¸€ä¸ªæ—¥å¿—éå¸¸è½åçš„èŠ‚ç‚¹ iï¼Œå½“ Leader å‘å…¶å‘é€ AppendEntries RPC æ—¶ï¼ŒnextIndex[i] å¯¹åº”çš„ entry å·²è¢«ä¸¢å¼ƒï¼Œå‹ç¼©åœ¨å¿«ç…§ä¸­ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œ Leader å°±æ— æ³•å¯¹å…¶è¿›è¡Œ AppendEntriesã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œè¿™é‡Œæˆ‘ä»¬åº”è¯¥å®ç°ä¸€ä¸ªæ–°çš„ InstallSnapshot RPCï¼Œå°† Leader å½“å‰çš„å¿«ç…§ç›´æ¥å‘é€ç»™éå¸¸è½åçš„ Followerã€‚\nä½•æ—¶å¿«ç…§ï¼Ÿ\næœåŠ¡ç«¯è§¦å‘çš„æ—¥å¿—å‹ç¼©:ä¸Šå±‚åº”ç”¨å‘é€å¿«ç…§æ•°æ®ç»™Raftå®ä¾‹ã€‚ leader å‘é€æ¥çš„ InstallSnapshot:é¢†å¯¼è€…å‘é€å¿«ç…§RPCè¯·æ±‚ç»™è¿½éšè€…ã€‚å½“raftæ”¶åˆ°å…¶ä»–èŠ‚ç‚¹çš„å‹ç¼©è¯·æ±‚åï¼Œå…ˆæŠŠè¯·æ±‚ä¸ŠæŠ¥ç»™ä¸Šå±‚åº”ç”¨ï¼Œç„¶åä¸Šå±‚åº”ç”¨è°ƒç”¨rf.CondInstallSnapshot()æ¥å†³å®šæ˜¯å¦å®‰è£…å¿«ç…§ æµç¨‹æ¢³ç† å¿«ç…§æ˜¯çŠ¶æ€æœºä¸­çš„æ¦‚å¿µï¼Œéœ€è¦åœ¨çŠ¶æ€æœºä¸­åŠ è½½å¿«ç…§ï¼Œå› æ­¤è¦é€šè¿‡applyChå°†å¿«ç…§å‘é€ç»™çŠ¶æ€æœºï¼Œä½†æ˜¯å‘é€åRaftå¹¶ä¸ç«‹å³ä¿å­˜å¿«ç…§ï¼Œè€Œæ˜¯ç­‰å¾…çŠ¶æ€æœºè°ƒç”¨ CondInstallSnapshot()ï¼Œå¦‚æœä»æ”¶åˆ°InstallSnapshot()ååˆ°æ”¶åˆ°CondInstallSnapshot()å‰ï¼Œæ²¡æœ‰æ–°çš„æ—¥å¿—æäº¤åˆ°çŠ¶æ€æœºï¼Œåˆ™Raftè¿”å›Trueï¼ŒRaftå’ŒçŠ¶æ€æœºä¿å­˜å¿«ç…§ï¼Œå¦åˆ™Raftè¿”å›Falseï¼Œä¸¤è€…éƒ½ä¸ä¿å­˜å¿«ç…§ã€‚\nå¦‚æ­¤ä¿è¯äº†Raftå’ŒçŠ¶æ€æœºä¿å­˜å¿«ç…§æ˜¯ä¸€ä¸ªåŸå­æ“ä½œ(SaveStateAndSnapshot)ã€‚å½“ç„¶åœ¨InstallSnapshot()å°†å¿«ç…§å‘é€ç»™çŠ¶æ€æœºåå†å°†å¿«ç…§ä¿å­˜åˆ°Raftï¼Œä»¤CondInstallSnap()æ°¸è¿œè¿”å›Trueï¼Œä¹Ÿå¯ä»¥ä¿è¯åŸå­æ“ä½œï¼Œä½†æ˜¯è¿™æ ·åšå¿…é¡»ç­‰å¾…å¿«ç…§å‘é€ç»™çŠ¶æ€æœºå®Œæˆï¼Œä½†æ˜¯rf.applyCh \u0026lt;- ApplyMsgæ˜¯æœ‰å¯èƒ½é˜»å¡çš„ï¼Œç”±äºInstallSnapshot()éœ€è¦æŒæœ‰å…¨å±€çš„äº’æ–¥é”ï¼Œè¿™å¯èƒ½å¯¼è‡´æ•´ä¸ªèŠ‚ç‚¹æ— æ³•å·¥ä½œã€‚\næœåŠ¡ç«¯è§¦å‘çš„æ—¥å¿—å‹ç¼©: ä¸Šå±‚åº”ç”¨å‘é€å¿«ç…§æ•°æ®ç»™Raftå®ä¾‹ã€‚ leader å‘é€æ¥çš„ InstallSnapshot: Leaderå‘é€å¿«ç…§RPCè¯·æ±‚ç»™Followerã€‚å½“raftæ”¶åˆ°å…¶ä»–èŠ‚ç‚¹çš„å‹ç¼©è¯·æ±‚åï¼Œå…ˆæŠŠè¯·æ±‚ä¸ŠæŠ¥ç»™ä¸Šå±‚åº”ç”¨ï¼Œç„¶åä¸Šå±‚åº”ç”¨è°ƒç”¨rf.CondInstallSnapshot()æ¥å†³å®šæ˜¯å¦å®‰è£…å¿«ç…§(SaveStateAndSnapshot) ç›¸å…³å‡½æ•°è§£æ æœåŠ¡ç«¯è§¦å‘çš„Log Compact func (rf *Raft) Snapshot(index int, snapshot []byte) åº”ç”¨ç¨‹åºå°†indexï¼ˆåŒ…æ‹¬ï¼‰ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—éƒ½æ‰“åŒ…ä¸ºäº†å¿«ç…§ï¼Œå³å‚æ•°snapshot [] byteã€‚é‚£ä¹ˆå¯¹äºRaftè¦åšçš„å°±æ˜¯ï¼Œå°†æ‰“åŒ…ä¸ºå¿«ç…§çš„æ—¥å¿—ç›´æ¥åˆ é™¤ï¼Œå¹¶ä¸”è¦å°†å¿«ç…§ä¿å­˜èµ·æ¥ï¼Œå› ä¸ºå°†æ¥å¯èƒ½ä¼šå‘ç°æŸäº›èŠ‚ç‚¹å¤§å¹…åº¦è½åäºleaderçš„æ—¥å¿—ï¼Œé‚£ä¹ˆleaderå°±ç›´æ¥å‘é€å¿«ç…§ç»™å®ƒï¼Œè®©ä»–çš„æ—¥å¿—â€œè·Ÿä¸Šæ¥â€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 func (rf *Raft) Snapshot(index int, snapshot []byte) { // Your code here (2D).","title":"MIT6.824 2022 Raft Lab2D Log Persistence"},{"content":"å‰è¨€ è®ºæ–‡ åšå£«è®ºæ–‡ åšå£«è®ºæ–‡ç¿»è¯‘ å®˜ç½‘ åŠ¨ç”»å±•ç¤º Students\u0026rsquo; Guide to Raft ï¼ˆé‡è¦ï¼‰ MIT6.824 æœ¬ç¯‡æ˜¯å®éªŒçš„å‰è¨€, å…ˆå¯¹è®ºæ–‡é‡Œé¢æåˆ°çš„RPCåšä¸ªå¤§æ¦‚çš„æ¢³ç†å’Œä»‹ç»ã€‚ Raft åŸç†å¯ä»¥å‚è€ƒè¿™ç¯‡Raft\nFigure2 Raft å®ç°çš„æ ¸å¿ƒåœ¨è¿™ä¸ªå›¾ï¼Œæƒ³è¦æ­£ç¡®å®ç°Raft å¿…é¡»å¯¹è¿™ä¸ªå›¾æœ‰æ·±åˆ»ç†è§£ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯¹å›¾ä¸Šçš„å„ä¸ªRPC è¿›è¡Œä»‹ç»å’Œé˜è¿°ã€‚\nState Persistent state for all servers æ‰€æœ‰Raft èŠ‚ç‚¹éƒ½éœ€è¦ç»´æŠ¤çš„æŒä¹…åŒ–çŠ¶æ€: currentTerm: æ­¤èŠ‚ç‚¹å½“å‰çš„ä»»æœŸã€‚ä¿è¯é‡å¯åä»»æœŸä¸ä¸¢å¤±ã€‚å¯åŠ¨æ—¶åˆå§‹å€¼ä¸º0(æ— æ„ä¹‰çŠ¶æ€)ï¼Œå•è°ƒé€’å¢ (Lab 2A) votedFor: å½“å‰ä»»æœŸå†…,æ­¤èŠ‚ç‚¹å°†é€‰ç¥¨ç»™äº†è°ã€‚ ä¸€ä¸ªä»»æœŸå†…,èŠ‚ç‚¹åªèƒ½å°†é€‰ç¥¨æŠ•ç»™æŸä¸ªèŠ‚ç‚¹ã€‚éœ€è¦æŒä¹…åŒ–ï¼Œä»è€Œé¿å…èŠ‚ç‚¹é‡å¯åé‡å¤æŠ•ç¥¨ã€‚(Lab 2A) logs: æ—¥å¿—æ¡ç›®, æ¯æ¡ Entry åŒ…å«ä¸€æ¡å¾…æ–½åŠ è‡³çŠ¶æ€æœºçš„å‘½ä»¤ã€‚Entry ä¹Ÿè¦è®°å½•å…¶è¢«å‘é€è‡³ Leader æ—¶ï¼ŒLeader å½“æ—¶çš„ä»»æœŸã€‚Lab2B ä¸­ï¼Œåœ¨å†…å­˜å­˜å‚¨æ—¥å¿—å³å¯ï¼Œä¸ç”¨æ‹…å¿ƒ server ä¼š down æ‰ï¼Œæµ‹è¯•ä¸­ä»…ä¼šæ¨¡æ‹Ÿç½‘ç»œæŒ‚æ‰çš„æƒ…æ™¯ã€‚åˆå§‹Indexä»1å¼€å§‹ï¼Œ0ä¸ºdummy indexã€‚ ä¸ºä»€ä¹ˆ currentTerm å’Œ votedFor éœ€è¦æŒä¹…åŒ–?\nvotedFor ä¿è¯æ¯ä¸ªä»»æœŸæœ€å¤šåªæœ‰ä¸€ä¸ªLeaderï¼\nè€ƒè™‘å¦‚ä¸‹ä¸€ç§åœºæ™¯ï¼š å› ä¸ºåœ¨Raftåè®®ä¸­æ¯ä¸ªä»»æœŸå†…æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªLeaderã€‚ç°å‡è®¾æœ‰å‡ ä¸ªRaftèŠ‚ç‚¹åœ¨å½“å‰ä»»æœŸä¸‹æŠ•ç¥¨ç»™äº†RaftèŠ‚ç‚¹Aï¼Œå¹¶ä¸”Raft Aé¡ºåˆ©æˆä¸ºäº†Leaderã€‚ç°æ•…éšœç³»ç»Ÿè¢«é‡å¯ï¼Œé‡å¯åå¦‚æœæ”¶åˆ°ä¸€ä¸ªç›¸åŒä»»æœŸçš„RaftèŠ‚ç‚¹Bçš„æŠ•ç¥¨è¯·æ±‚ï¼Œç”±äºæ¯ä¸ªèŠ‚ç‚¹å¹¶æ²¡æœ‰è®°å½•å…¶æŠ•ç¥¨çŠ¶æ€ï¼Œé‚£ä¹ˆè¿™äº›èŠ‚ç‚¹å°±æœ‰å¯èƒ½æŠ•ç¥¨ç»™Raft Bï¼Œå¹¶ä½¿Bæˆä¸ºLeaderã€‚æ­¤æ—¶ï¼Œåœ¨åŒä¸€ä¸ªä»»æœŸå†…å°±ä¼šå­˜åœ¨ä¸¤ä¸ªLeaderï¼Œä¸Raftçš„è¦æ±‚ä¸ç¬¦ã€‚\nä¿è¯æ¯ä¸ªIndexä½ç½®åªä¼šæœ‰ä¸€ä¸ªTerm! (ä¹Ÿç­‰ä»·äºæ¯ä¸ªä»»æœŸå†…æœ€å¤šæœ‰ä¸€ä¸ªLeader)\nåœ¨è¿™é‡Œä¾‹å­ä¸­ï¼ŒS1å…³æœºäº†ï¼ŒS2å’ŒS3ä¼šå°è¯•é€‰ä¸¾ä¸€ä¸ªæ–°çš„Leaderã€‚å®ƒä»¬éœ€è¦è¯æ®è¯æ˜ï¼Œæ­£ç¡®çš„ä»»æœŸå·æ˜¯8ï¼Œè€Œä¸æ˜¯6ã€‚å¦‚æœä»…ä»…æ˜¯S2å’ŒS3ä¸ºå½¼æ­¤æŠ•ç¥¨ï¼Œå®ƒä»¬ä¸çŸ¥é“å½“å‰çš„ä»»æœŸå·ï¼Œå®ƒä»¬åªèƒ½æŸ¥çœ‹è‡ªå·±çš„Logï¼Œå®ƒä»¬æˆ–è®¸ä¼šè®¤ä¸ºä¸‹ä¸€ä¸ªä»»æœŸæ˜¯6ï¼ˆå› ä¸ºLogé‡Œçš„ä¸Šä¸€ä¸ªä»»æœŸæ˜¯5ï¼‰ã€‚å¦‚æœå®ƒä»¬è¿™ä¹ˆåšäº†ï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šä»ä»»æœŸ6å¼€å§‹æ·»åŠ Logã€‚ä½†æ˜¯æ¥ä¸‹æ¥ï¼Œå°±ä¼šæœ‰é—®é¢˜äº†ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰äº†ä¸¤ä¸ªä¸åŒçš„ä»»æœŸ6ï¼ˆå¦ä¸€ä¸ªåœ¨S1ä¸­ï¼‰ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆcurrentTerméœ€è¦è¢«æŒä¹…åŒ–å­˜å‚¨çš„åŸå› ï¼Œå› ä¸ºå®ƒéœ€è¦ç”¨æ¥ä¿å­˜å·²ç»è¢«ä½¿ç”¨è¿‡çš„ä»»æœŸå·ã€‚\nè¿™äº›æ•°æ®éœ€è¦åœ¨æ¯æ¬¡ä½ ä¿®æ”¹å®ƒä»¬çš„æ—¶å€™å­˜å‚¨èµ·æ¥ã€‚æ‰€ä»¥å¯ä»¥ç¡®å®šçš„æ˜¯ï¼Œå®‰å…¨çš„åšæ³•æ˜¯æ¯æ¬¡ä½ æ·»åŠ ä¸€ä¸ªLogæ¡ç›®ï¼Œæ›´æ–°currentTermæˆ–è€…æ›´æ–°votedForï¼Œä½ æˆ–è®¸éƒ½éœ€è¦æŒä¹…åŒ–å­˜å‚¨è¿™äº›æ•°æ®ã€‚åœ¨ä¸€ä¸ªçœŸå®çš„RaftæœåŠ¡å™¨ä¸Šï¼Œè¿™æ„å‘³ç€å°†æ•°æ®å†™å…¥ç£ç›˜ï¼Œæ‰€ä»¥ä½ éœ€è¦ä¸€äº›æ–‡ä»¶æ¥è®°å½•è¿™äº›æ•°æ®ã€‚å¦‚æœä½ å‘ç°ï¼Œç›´åˆ°æœåŠ¡å™¨ä¸å¤–ç•Œé€šä¿¡æ—¶ï¼Œæ‰æœ‰å¯èƒ½æŒä¹…åŒ–å­˜å‚¨æ•°æ®ï¼Œé‚£ä¹ˆä½ å¯ä»¥é€šè¿‡ä¸€äº›æ‰¹é‡æ“ä½œæ¥æå‡æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œåªåœ¨æœåŠ¡å™¨å›å¤ä¸€ä¸ªRPCæˆ–è€…å‘é€ä¸€ä¸ªRPCæ—¶ï¼ŒæœåŠ¡å™¨æ‰è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœä¸€äº›æŒä¹…åŒ–å­˜å‚¨çš„æ“ä½œã€‚\nVolatile state on all servers æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åº”è¯¥æœ‰çš„éæŒä¹…åŒ–çŠ¶æ€ï¼š commitIndex: å·²æäº¤çš„æœ€å¤§ indexã€‚è¢«æäº¤çš„å®šä¹‰ä¸ºï¼Œå½“ Leader æˆåŠŸåœ¨å¤§éƒ¨åˆ† server ä¸Šå¤åˆ¶äº†ä¸€æ¡ Entryï¼Œé‚£ä¹ˆè¿™æ¡ Entry å°±æ˜¯ä¸€æ¡å·²æäº¤çš„ Entryã€‚leader èŠ‚ç‚¹é‡å¯åå¯ä»¥é€šè¿‡ appendEntries rpc é€æ¸å¾—åˆ°ä¸åŒèŠ‚ç‚¹çš„ matchIndexï¼Œä»è€Œç¡®è®¤ commitIndexï¼Œfollower åªéœ€ç­‰å¾… leader ä¼ é€’è¿‡æ¥çš„ commitIndex å³å¯ã€‚ï¼ˆåˆå§‹å€¼ä¸º0ï¼Œå•è°ƒé€’å¢ï¼‰ lastApplied: å·²è¢«çŠ¶æ€æœºåº”ç”¨çš„æœ€å¤§ indexã€‚å·²æäº¤å’Œå·²åº”ç”¨æ˜¯ä¸åŒçš„æ¦‚å¿µï¼Œå·²åº”ç”¨æŒ‡è¿™æ¡ Entry å·²ç»è¢«è¿ç”¨åˆ°çŠ¶æ€æœºä¸Šã€‚å·²æäº¤å…ˆäºå·²åº”ç”¨ã€‚åŒæ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRaft ä¿è¯äº†å·²æäº¤çš„ Entry ä¸€å®šä¼šè¢«åº”ç”¨ï¼ˆé€šè¿‡å¯¹é€‰ä¸¾è¿‡ç¨‹å¢åŠ ä¸€äº›é™åˆ¶ï¼Œä¸‹é¢ä¼šæåˆ°ï¼‰ã€‚raft ç®—æ³•å‡è®¾äº†çŠ¶æ€æœºæœ¬èº«æ˜¯æ˜“å¤±çš„ï¼Œæ‰€ä»¥é‡å¯åçŠ¶æ€æœºçš„çŠ¶æ€å¯ä»¥é€šè¿‡ log[] ï¼ˆéƒ¨åˆ† log å¯ä»¥å‹ç¼©ä¸º snapshot) æ¥æ¢å¤ã€‚ï¼ˆåˆå§‹å€¼ä¸º0ï¼Œå•è°ƒé€’å¢ï¼‰ commitIndex å’Œ lastApplied åˆ†åˆ«ç»´æŠ¤ log å·²æäº¤å’Œå·²åº”ç”¨çš„çŠ¶æ€ï¼Œå½“èŠ‚ç‚¹å‘ç° commitIndex \u0026gt; lastApplied æ—¶ï¼Œä»£è¡¨ç€ commitIndex å’Œ lastApplied é—´çš„ entries å¤„äºå·²æäº¤ï¼Œæœªåº”ç”¨çš„çŠ¶æ€ã€‚å› æ­¤åº”å°†å…¶é—´çš„ entries æŒ‰åºåº”ç”¨è‡³çŠ¶æ€æœºã€‚\nå¯¹äº Followerï¼ŒcommitIndex é€šè¿‡ Leader AppendEntries RPC çš„å‚æ•° leaderCommit æ›´æ–°ã€‚å¯¹äº Leaderï¼ŒcommitIndex é€šè¿‡å…¶ç»´æŠ¤çš„ matchIndex æ•°ç»„æ›´æ–°ã€‚\nVolatile state on leaders leader çš„éæŒä¹…åŒ–çŠ¶æ€ï¼š nextIndex[]: ç”± Leader ç»´æŠ¤ï¼ŒnextIndex[i] ä»£è¡¨éœ€è¦åŒæ­¥ç»™ peer[i] çš„ä¸‹ä¸€ä¸ª entry çš„ indexã€‚åœ¨ Leader å½“é€‰åï¼Œé‡æ–°åˆå§‹åŒ–ä¸º Leader çš„ lastLogIndex + 1ã€‚ matchIndex[]: ç”± Leader ç»´æŠ¤ï¼ŒmatchIndex[i] ä»£è¡¨ Leader å·²çŸ¥çš„å·²åœ¨ peer[i] ä¸ŠæˆåŠŸå¤åˆ¶çš„æœ€é«˜ entry indexã€‚åœ¨ Leader å½“é€‰åï¼Œé‡æ–°åˆå§‹åŒ–ä¸º 0ã€‚ æ¯æ¬¡é€‰ä¸¾åï¼Œleader çš„æ­¤ä¸¤ä¸ªæ•°ç»„éƒ½åº”è¯¥ç«‹åˆ»é‡æ–°åˆå§‹åŒ–å¹¶å¼€å§‹æ¢æµ‹ã€‚\nä¸èƒ½ç®€å•åœ°è®¤ä¸º matchIndex = nextIndex - 1ã€‚\nnextIndex æ˜¯å¯¹è¿½åŠ ä½ç½®çš„ä¸€ç§çŒœæµ‹ï¼Œæ˜¯ä¹è§‚çš„ä¼°è®¡ã€‚å› æ­¤ï¼Œå½“ Leader ä¸Šä»»æ—¶ï¼Œä¼šå°† nextIndex å…¨éƒ¨åˆå§‹åŒ–ä¸º lastLogIndex + 1ï¼Œå³ä¹è§‚åœ°ä¼°è®¡æ‰€æœ‰ Follower çš„ log å·²ç»ä¸è‡ªèº«ç›¸åŒã€‚AppendEntries PRC ä¸­ï¼ŒLeader ä¼šæ ¹æ® nextIndex æ¥å†³å®šå‘ Follower å‘é€å“ªäº› entryã€‚å½“è¿”å›å¤±è´¥æ—¶ï¼Œåˆ™ä¼šå°† nextIndex å‡ä¸€ï¼ŒçŒœæµ‹ä»…æœ‰ä¸€æ¡ entry ä¸ä¸€è‡´ï¼Œå†æ¬¡ä¹è§‚åœ°å°è¯•ã€‚å®é™…ä¸Šï¼Œä½¿ç”¨ nextIndex æ˜¯ä¸ºäº†æå‡æ€§èƒ½ï¼Œä»…å‘ Follower å‘é€ä¸ä¸€è‡´çš„ entryï¼Œå‡å° RPC ä¼ è¾“é‡ã€‚\nmatchIndex åˆ™æ˜¯å¯¹åŒæ­¥æƒ…å†µçš„ä¿å®ˆç¡®è®¤ï¼Œä¸ºäº†ä¿è¯å®‰å…¨æ€§ã€‚matchIndex åŠæ­¤å‰çš„ entry ä¸€å®šéƒ½æˆåŠŸåœ°åŒæ­¥ã€‚matchIndex çš„ä½œç”¨æ˜¯å¸®åŠ© Leader æ›´æ–°è‡ªèº«çš„ commitIndexã€‚å½“ Leader å‘ç°ä¸€ä¸ª Index N å€¼ï¼ŒN å¤§äºè¿‡åŠæ•°çš„ matchIndexï¼Œåˆ™å¯å°†å…¶ commitIndex æ›´æ–°ä¸º Nï¼ˆéœ€è¦æ³¨æ„ä»»æœŸå·çš„é—®é¢˜ï¼Œåæ–‡ä¼šæåˆ°ï¼‰ã€‚matchIndex åœ¨ Leader ä¸Šä»»æ—¶è¢«åˆå§‹åŒ–ä¸º 0ã€‚\nnextIndex æ˜¯æœ€ä¹è§‚çš„ä¼°è®¡ï¼Œè¢«åˆå§‹åŒ–ä¸ºæœ€å¤§å¯èƒ½å€¼ï¼›matchIndex æ˜¯æœ€æ‚²è§‚çš„ä¼°è®¡ï¼Œè¢«åˆå§‹åŒ–ä¸ºæœ€å°å¯èƒ½å€¼ã€‚åœ¨ä¸€æ¬¡æ¬¡å¿ƒè·³ä¸­ï¼ŒnextIndex ä¸æ–­å‡å°ï¼ŒmatchIndex ä¸æ–­å¢å¤§ï¼Œç›´è‡³ matchIndex = nextIndex - 1ï¼Œåˆ™ä»£è¡¨è¯¥ Follower å·²ç»ä¸ Leader æˆåŠŸåŒæ­¥ã€‚\nRequestVote RPC Invoked by candidates to gather votes (Â§5.2). ä¼šè¢« Candidate è°ƒç”¨ï¼Œä»¥æ­¤è·å–é€‰ç¥¨ã€‚\nArgs\nterm: Candidate çš„ä»»æœŸ (Lab 2A) candidateId: å‘èµ·æŠ•ç¥¨è¯·æ±‚çš„å€™é€‰äººid (Lab 2A) lastLogIndex: å€™é€‰äººæœ€æ–°çš„æ—¥å¿—æ¡ç›®ç´¢å¼•ï¼Œ Candidate æœ€åä¸€ä¸ª entry çš„ indexï¼Œæ˜¯æŠ•ç¥¨çš„é¢å¤–åˆ¤æ® lastLogTerm: å€™é€‰äººæœ€æ–°æ—¥å¿—æ¡ç›®å¯¹åº”çš„ä»»æœŸå· Reply\nterm: æ”¶åˆ°RequestVote RPC RaftèŠ‚ç‚¹çš„ä»»æœŸã€‚å‡å¦‚ Candidate å‘ç° Follower çš„ä»»æœŸé«˜äºè‡ªå·±ï¼Œåˆ™ä¼šæ”¾å¼ƒ Candidate èº«ä»½å¹¶æ›´æ–°è‡ªå·±çš„ä»»æœŸ voteGranted: æ˜¯å¦åŒæ„ Candidate å½“é€‰ã€‚ Receiver Implementation æ¥æ”¶æ—¥å¿—çš„followeréœ€è¦å®ç°çš„\nå½“ Candidate ä»»æœŸå°äºå½“å‰èŠ‚ç‚¹ä»»æœŸæ—¶ï¼Œè¿”å› falseã€‚ å¦‚æœ votedFor ä¸º nullï¼ˆå³å½“å‰ä»»æœŸå†…æ­¤èŠ‚ç‚¹è¿˜æœªæŠ•ç¥¨, Go ä»£ç ä¸­ç”¨-1ï¼‰æˆ–è€… votedForä¸º candidateIdï¼ˆå³å½“å‰ä»»æœŸå†…æ­¤èŠ‚ç‚¹å·²ç»å‘æ­¤ Candidate æŠ•è¿‡ç¥¨ï¼‰ï¼Œåˆ™åŒæ„æŠ•ç¥¨ï¼›å¦åˆ™æ‹’ç»æŠ•ç¥¨ï¼ˆLab 2A åªéœ€è¦å®ç°åˆ°è¿™ä¸ªç¨‹åº¦ï¼‰ã€‚ äº‹å®ä¸Šè¿˜è¦: åªæœ‰ Candidate çš„ log è‡³å°‘ä¸ Receiver çš„ log ä¸€æ ·æ–°ï¼ˆup-to-dateï¼‰æ—¶ï¼Œæ‰åŒæ„æŠ•ç¥¨ã€‚Raft é€šè¿‡ä¸¤ä¸ªæ—¥å¿—çš„æœ€åä¸€ä¸ª entry æ¥åˆ¤æ–­å“ªä¸ªæ—¥å¿—æ›´ up-to-dateã€‚å‡å¦‚ä¸¤ä¸ª entry çš„ term ä¸åŒï¼Œterm æ›´å¤§çš„æ›´æ–°ã€‚term ç›¸åŒæ—¶ï¼Œindex æ›´å¤§çš„æ›´æ–°ã€‚ è¿™é‡ŒæŠ•ç¥¨çš„é¢å¤–é™åˆ¶(up-to-date)æ˜¯ä¸ºäº†ä¿è¯å·²ç»è¢« commit çš„ entry ä¸€å®šä¸ä¼šè¢«è¦†ç›–ã€‚ä»…æœ‰å½“ Candidate çš„ log åŒ…å«æ‰€æœ‰å·²æäº¤çš„ entryï¼Œæ‰æœ‰å¯èƒ½å½“é€‰ä¸º Leaderã€‚\nAppendEntries RPC Invoked by leader to replicate log entries (Â§5.3); also used as heartbeat (Â§5.2). åœ¨é¢†å¯¼é€‰ä¸¾çš„è¿‡ç¨‹ä¸­ï¼ŒAppendEntries RPC ç”¨æ¥å®ç° Leader çš„å¿ƒè·³æœºåˆ¶ã€‚èŠ‚ç‚¹çš„ AppendEntries RPC ä¼šè¢« Leader å®šæœŸè°ƒç”¨ã€‚æ­£å¸¸å­˜åœ¨Leader æ—¶ï¼Œç”¨æ¥è¿›è¡ŒLog Replacationã€‚\nArgs\nterm: Leader ä»»æœŸ (Lab 2A) leadId: Client å¯èƒ½å°†è¯·æ±‚å‘é€è‡³ Follower èŠ‚ç‚¹ï¼Œå¾—çŸ¥ leaderId å Follower å¯å°† Client çš„è¯·æ±‚é‡å®šä½è‡³ Leader èŠ‚ç‚¹ã€‚å› ä¸º Raft çš„è¯·æ±‚ä¿¡æ¯å¿…é¡»å…ˆç»è¿‡ Leader èŠ‚ç‚¹ï¼Œå†ç”± Leader èŠ‚ç‚¹æµå‘å…¶ä»–èŠ‚ç‚¹è¿›è¡ŒåŒæ­¥ï¼Œä¿¡æ¯æ˜¯å•å‘æµåŠ¨çš„ã€‚åœ¨é€‰ä¸»è¿‡ç¨‹ä¸­ï¼ŒleaderIdæš‚æ—¶åªæœ‰ debug çš„ä½œç”¨ (Lab 2A) prevLogIndex: æ·»åŠ  Entries çš„å‰ä¸€æ¡ Entry çš„ index prevLogTerm: prevLogIndex å¯¹åº” entry çš„ term entries[]: éœ€è¦åŒæ­¥çš„ entriesã€‚è‹¥ä¸ºç©ºï¼Œåˆ™ä»£è¡¨æ˜¯ä¸€æ¬¡ heartbeatã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸éœ€è¦ç‰¹åˆ«åˆ¤æ–­æ˜¯å¦ä¸º heartbeatï¼Œå³ä½¿æ˜¯ heartbeatï¼Œä¹Ÿéœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„æ£€æŸ¥ã€‚å› æ­¤æœ¬æ–‡ä¹Ÿä¸å†åŒºåˆ†å¿ƒè·³å’Œ AppendEntries RPC leaderCommit: Leader çš„ commitIndexï¼Œå¸®åŠ© Follower æ›´æ–°è‡ªèº«çš„ commitIndex Reply\nterm: æ­¤èŠ‚ç‚¹çš„ä»»æœŸã€‚å‡å¦‚ Leader å‘ç° Follower çš„ä»»æœŸé«˜äºè‡ªå·±ï¼Œåˆ™ä¼šæ”¾å¼ƒ Leader èº«ä»½å¹¶æ›´æ–°è‡ªå·±çš„ä»»æœŸã€‚ success: æ­¤èŠ‚ç‚¹æ˜¯å¦è®¤åŒ Leader å‘é€çš„RPCã€‚ Receiver Implementation æ¥æ”¶æ—¥å¿—çš„followeréœ€è¦å®ç°çš„\nå½“ Leader ä»»æœŸå°äºå½“å‰èŠ‚ç‚¹ä»»æœŸæ—¶ï¼Œè¿”å› falseã€‚ è‹¥ Follower åœ¨ prevLogIndex ä½ç½®çš„ entry çš„ term ä¸ Args ä¸­çš„ prevLogTerm ä¸åŒï¼ˆæˆ–è€… prevLogIndex çš„ä½ç½®æ²¡æœ‰ entryï¼‰ï¼Œè¿”å› falseã€‚ å¦‚æœ Follower çš„æŸä¸€ä¸ª entry ä¸éœ€è¦åŒæ­¥çš„ entries ä¸­çš„ä¸€ä¸ª entry å†²çªï¼Œåˆ™éœ€è¦åˆ é™¤å†²çª entry åŠå…¶ä¹‹åçš„æ‰€æœ‰ entryã€‚éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œå‡å¦‚æ²¡æœ‰å†²çªï¼Œä¸èƒ½åˆ é™¤ä»»ä½• entryã€‚å› ä¸ºå­˜åœ¨ Follower çš„ log æ›´ up-to-date çš„å¯èƒ½ã€‚ æ·»åŠ  Log ä¸­ä¸å­˜åœ¨çš„æ–° entryã€‚ å¦‚æœ leaderCommit \u0026gt; commitIndexï¼Œä»¤ commitIndex = min(leaderCommit, index of last new entry)ã€‚æ­¤å³ Follower æ›´æ–° commitIndex çš„æ–¹å¼ã€‚ Rules for Servers All Servers å¦‚æœcommitIndex \u0026gt; lastApplied, é‚£ä¹ˆå°†lastAppliedè‡ªå¢, å¹¶æŠŠå¯¹åº”æ—¥å¿—log[lastApplied]åº”ç”¨åˆ°çŠ¶æ€æœº å¦‚æœæ¥è‡ªå…¶ä»–èŠ‚ç‚¹çš„ RPC è¯·æ±‚(RequestVote, AppendEntries, InstallSnapshot)ä¸­ï¼Œæˆ–å‘ç»™å…¶ä»–èŠ‚ç‚¹çš„ RPC çš„å›å¤ä¸­ï¼ŒåŒ…å«ä¸€ä¸ªterm Tå¤§äºcurrentTerm, é‚£ä¹ˆå°†currentTermèµ‹å€¼ä¸ºTå¹¶ç«‹å³åˆ‡æ¢çŠ¶æ€ä¸º Followerã€‚(Lab 2A) Followers å“åº”æ¥è‡ª Candidate å’Œ Leader çš„ RPC è¯·æ±‚ã€‚(Lab 2A) å¦‚æœåœ¨ election timeout åˆ°æœŸæ—¶ï¼ŒFollower æœªæ”¶åˆ°æ¥è‡ªå½“å‰ Leader çš„ AppendEntries RPCï¼Œä¹Ÿæ²¡æœ‰æ”¶åˆ°æ¥è‡ª Candidate çš„ RequestVote RPCï¼Œåˆ™è½¬å˜ä¸º Candidateã€‚(Lab 2A) Candidate è½¬å˜ Candidateæ—¶ï¼Œå¼€å§‹ä¸€è½®é€‰ä¸¾ï¼š(Lab 2A) currentTerm ++ ä¸ºè‡ªå·±æŠ•ç¥¨, votedFor = me é‡ç½® election timer å‘å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹å¹¶è¡Œå‘é€ RequestVote RPC å¦‚æœæ”¶åˆ°äº†å¤§å¤šæ•°èŠ‚ç‚¹çš„é€‰ç¥¨ï¼ˆvoteCnt \u0026gt; n/2ï¼‰ï¼Œå½“é€‰ Leaderã€‚(Lab 2A) åœ¨é€‰ä¸¾è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ”¶åˆ°äº†æ¥è‡ªæ–° Leader çš„ AppendEntries RPCï¼Œåœæ­¢é€‰ä¸¾ï¼Œè½¬å˜ä¸º Followerã€‚(Lab 2A) å¦‚æœ election timer è¶…æ—¶æ—¶ï¼Œè¿˜æœªå½“é€‰ Leaderï¼Œåˆ™æ”¾å¼ƒæ­¤è½®é€‰ä¸¾ï¼Œå¼€å¯æ–°ä¸€è½®é€‰ä¸¾ã€‚(Lab 2A) Leader åˆšä¸Šä»»æ—¶ï¼Œå‘æ‰€æœ‰èŠ‚ç‚¹å‘é€ä¸€è½®å¿ƒè·³ä¿¡æ¯(empty AppendEntries)ã€‚æ­¤åï¼Œæ¯éš”ä¸€æ®µå›ºå®šæ—¶é—´ï¼Œå‘æ‰€æœ‰èŠ‚ç‚¹å‘é€ä¸€è½®å¿ƒè·³ä¿¡æ¯ï¼Œé‡ç½®å…¶ä»–èŠ‚ç‚¹çš„ election timerï¼Œä»¥ç»´æŒè‡ªå·± Leader çš„èº«ä»½ã€‚(Lab 2A) å¦‚æœæ”¶åˆ°äº†æ¥è‡ª client çš„ commandï¼Œå°† command ä»¥ entry çš„å½¢å¼æ·»åŠ åˆ°æ—¥å¿—ã€‚åœ¨æ”¶åˆ°å¤§å¤šæ•°å“åº”åå°†è¯¥æ¡ç›®åº”ç”¨åˆ°çŠ¶æ€æœºå¹¶å›å¤å“åº”ç»™å®¢æˆ·ç«¯ã€‚åœ¨ lab2B ä¸­ï¼Œclient é€šè¿‡ Start() å‡½æ•°ä¼ å…¥ commandã€‚ å¦‚æœ lastLogIndex \u0026gt;= nextIndex[i]ï¼Œå‘ peer[i] å‘é€ AppendEntries RPCï¼ŒRPC ä¸­åŒ…å«ä» nextIndex[i] å¼€å§‹çš„æ—¥å¿—ã€‚ å¦‚æœè¿”å›å€¼ä¸º trueï¼Œæ›´æ–° nextIndex[i] å’Œ matchIndex[i]ã€‚ å¦‚æœå› ä¸º entry å†²çªï¼ŒRPC è¿”å›å€¼ä¸º falseï¼Œåˆ™å°† nextIndex[i] å‡1å¹¶é‡è¯•ã€‚è¿™é‡Œçš„é‡è¯•ä¸ä¸€å®šä»£è¡¨éœ€è¦ç«‹å³é‡è¯•ï¼Œå®é™…ä¸Šå¯ä»¥ä»…å°† nextIndex[i] å‡1ï¼Œä¸‹æ¬¡å¿ƒè·³æ—¶åˆ™æ˜¯ä»¥æ–°å€¼é‡è¯•ã€‚ å¦‚æœå­˜åœ¨ index å€¼ N æ»¡è¶³ï¼šN \u0026gt; commitIndex \u0026amp;\u0026amp; è¿‡åŠæ•° matchIndex[i] \u0026gt;= N \u0026amp;\u0026amp; log[N].term == currentTerm, åˆ™ä»¤commitIndex = Nã€‚ è¿™é‡Œæœ€åä¸€æ¡æ˜¯ Leader æ›´æ–° commitIndex çš„æ–¹å¼ã€‚å‰ä¸¤ä¸ªè¦æ±‚éƒ½æ¯”è¾ƒå¥½ç†è§£ï¼Œç¬¬ä¸‰ä¸ªè¦æ±‚æ˜¯ Raft çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå³ Leader ä»…ä¼šç›´æ¥æäº¤å…¶ä»»æœŸå†…çš„ entryã€‚å­˜åœ¨è¿™æ ·ä¸€ç§æƒ…å†µï¼ŒLeader ä¸Šä»»æ—¶ï¼Œå…¶æœ€æ–°çš„ä¸€äº›æ¡ç›®å¯èƒ½è¢«è®¤ä¸ºå¤„äºæœªè¢«æäº¤çš„çŠ¶æ€ï¼ˆä½†è¿™äº›æ¡ç›®å®é™…å·²ç»æˆåŠŸåŒæ­¥åˆ°äº†å¤§éƒ¨åˆ†èŠ‚ç‚¹ä¸Šï¼‰ã€‚Leader åœ¨ä¸Šä»»æ—¶å¹¶ä¸ä¼šæ£€æŸ¥è¿™äº› entry æ˜¯ä¸æ˜¯å®é™…ä¸Šå·²ç»å¯ä»¥è¢«æäº¤ï¼Œè€Œæ˜¯é€šè¿‡æäº¤æ­¤åçš„ entry æ¥é—´æ¥åœ°æäº¤è¿™äº› entryã€‚è¿™ç§åšæ³•èƒ½å¤Ÿ work çš„åŸºç¡€æ˜¯ Log Matching Propertyï¼š\nLog Matching: if two logs contain an entry with the same index and term, then the logs are identical in all entries up through the given index.\nInstallSnapshot PRC invoked by leader to send chunks of a snapshot to a follower.Leaders always send chunks in order. è™½ç„¶å¤šæ•°æƒ…å†µéƒ½æ˜¯æ¯ä¸ªæœåŠ¡å™¨ç‹¬ç«‹åˆ›å»ºå¿«ç…§, ä½†æ˜¯leaderæœ‰æ—¶å€™å¿…é¡»å‘é€å¿«ç…§ç»™ä¸€äº›è½åå¤ªå¤šçš„follower, è¿™é€šå¸¸å‘ç”Ÿåœ¨leaderå·²ç»ä¸¢å¼ƒäº†ä¸‹ä¸€æ¡è¦å‘ç»™è¯¥followerçš„æ—¥å¿—æ¡ç›®(Log Compactionæ—¶æ¸…é™¤æ‰äº†)çš„æƒ…å†µä¸‹ã€‚\nArgs\nterm: Leader ä»»æœŸã€‚åŒæ ·ï¼ŒInstallSnapshot RPC ä¹Ÿè¦éµå¾ª Figure 2 ä¸­çš„è§„åˆ™ã€‚å¦‚æœèŠ‚ç‚¹å‘ç°è‡ªå·±çš„ä»»æœŸå°äº Leader çš„ä»»æœŸï¼Œå°±è¦åŠæ—¶æ›´æ–° leaderId: ç”¨äºé‡å®šå‘ client lastIncludedIndex: å¿«ç…§ä¸­åŒ…å«çš„æœ€åä¸€ä¸ª entry çš„ index lastIncludedTerm: å¿«ç…§ä¸­åŒ…å«çš„æœ€åä¸€ä¸ª entry çš„ index å¯¹åº”çš„ term offset: åˆ†å—åœ¨å¿«ç…§ä¸­çš„åç§»é‡ data[]: å¿«ç…§æ•°æ® done: å¦‚æœæ˜¯æœ€åä¸€å—æ•°æ®åˆ™ä¸ºçœŸ Reply\nterm: èŠ‚ç‚¹çš„ä»»æœŸã€‚Leader å‘ç°é«˜äºè‡ªå·±ä»»æœŸçš„èŠ‚ç‚¹æ—¶ï¼Œæ›´æ–°ä»»æœŸå¹¶è½¬å˜ä¸º Follower Receiver Implementation æ¥æ”¶æ—¥å¿—çš„followeréœ€è¦å®ç°çš„\nå¦‚æœ term \u0026lt; currentTermï¼Œç›´æ¥è¿”å› å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªåˆ†å— (offsetä¸º0) åˆ™åˆ›å»ºæ–°çš„å¿«ç…§ åœ¨æŒ‡å®šçš„åç§»é‡å†™å…¥æ•°æ® å¦‚æœdoneä¸ºfalse, åˆ™å›å¤å¹¶ç»§ç»­ç­‰å¾…ä¹‹åçš„æ•°æ® ä¿å­˜å¿«ç…§æ–‡ä»¶, ä¸¢å¼ƒæ‰€æœ‰å·²å­˜åœ¨çš„æˆ–è€…éƒ¨åˆ†æœ‰ç€æ›´å°ç´¢å¼•å·çš„å¿«ç…§ å¦‚æœç°å­˜çš„æ—¥å¿—æ‹¥æœ‰ç›¸åŒçš„æœ€åä»»æœŸå·å’Œç´¢å¼•å€¼, åˆ™åé¢çš„æ•°æ®ç»§ç»­ä¿ç•™å¹¶ä¸”å›å¤ ä¸¢å¼ƒå…¨éƒ¨æ—¥å¿— èƒ½å¤Ÿä½¿ç”¨å¿«ç…§æ¥æ¢å¤çŠ¶æ€æœº (å¹¶ä¸”è£…è½½å¿«ç…§ä¸­çš„é›†ç¾¤é…ç½®) ä¸€æ¬¡è¯·æ±‚ Raft éœ€è¦åšå¦‚ä¸‹æµç¨‹ï¼š Leader (Follower æ”¶åˆ°ä¼šå®šå‘ç»™Leader)æ”¶åˆ° client çš„è¯·æ±‚ï¼› Leader æŠŠ entry å†™å…¥æŒä¹…å­˜å‚¨ï¼› Leader å‘é€ log replication message(AppendEntries RPC) ç»™ Followerï¼› Follower æ¥æ”¶ä¹‹åï¼ŒæŠŠ entry å†™å…¥æŒä¹…å­˜å‚¨ï¼Œç„¶åç»™ Leader å‘é€å“åº”ï¼› Leader ç­‰å¾… Follower çš„å“åº”ï¼Œè‹¥ majority èŠ‚ç‚¹æ¥æ”¶äº†ï¼Œåˆ™ applyï¼› Leader å°†ç»“æœè¿”å›ç»™ clientã€‚ ","permalink":"https://reid00.github.io/en/posts/storage/mit6.824-2022-raft-0-%E4%BB%8B%E7%BB%8D/","summary":"å‰è¨€ è®ºæ–‡ åšå£«è®ºæ–‡ åšå£«è®ºæ–‡ç¿»è¯‘ å®˜ç½‘ åŠ¨ç”»å±•ç¤º Students\u0026rsquo; Guide to Raft ï¼ˆé‡è¦ï¼‰ MIT6.824 æœ¬ç¯‡æ˜¯å®éªŒçš„å‰è¨€, å…ˆå¯¹è®ºæ–‡é‡Œé¢æåˆ°çš„RPCåšä¸ªå¤§æ¦‚çš„æ¢³ç†å’Œä»‹ç»ã€‚ Raft åŸç†å¯ä»¥å‚è€ƒè¿™ç¯‡Raft\nFigure2 Raft å®ç°çš„æ ¸å¿ƒåœ¨è¿™ä¸ªå›¾ï¼Œæƒ³è¦æ­£ç¡®å®ç°Raft å¿…é¡»å¯¹è¿™ä¸ªå›¾æœ‰æ·±åˆ»ç†è§£ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯¹å›¾ä¸Šçš„å„ä¸ªRPC è¿›è¡Œä»‹ç»å’Œé˜è¿°ã€‚\nState Persistent state for all servers æ‰€æœ‰Raft èŠ‚ç‚¹éƒ½éœ€è¦ç»´æŠ¤çš„æŒä¹…åŒ–çŠ¶æ€: currentTerm: æ­¤èŠ‚ç‚¹å½“å‰çš„ä»»æœŸã€‚ä¿è¯é‡å¯åä»»æœŸä¸ä¸¢å¤±ã€‚å¯åŠ¨æ—¶åˆå§‹å€¼ä¸º0(æ— æ„ä¹‰çŠ¶æ€)ï¼Œå•è°ƒé€’å¢ (Lab 2A) votedFor: å½“å‰ä»»æœŸå†…,æ­¤èŠ‚ç‚¹å°†é€‰ç¥¨ç»™äº†è°ã€‚ ä¸€ä¸ªä»»æœŸå†…,èŠ‚ç‚¹åªèƒ½å°†é€‰ç¥¨æŠ•ç»™æŸä¸ªèŠ‚ç‚¹ã€‚éœ€è¦æŒä¹…åŒ–ï¼Œä»è€Œé¿å…èŠ‚ç‚¹é‡å¯åé‡å¤æŠ•ç¥¨ã€‚(Lab 2A) logs: æ—¥å¿—æ¡ç›®, æ¯æ¡ Entry åŒ…å«ä¸€æ¡å¾…æ–½åŠ è‡³çŠ¶æ€æœºçš„å‘½ä»¤ã€‚Entry ä¹Ÿè¦è®°å½•å…¶è¢«å‘é€è‡³ Leader æ—¶ï¼ŒLeader å½“æ—¶çš„ä»»æœŸã€‚Lab2B ä¸­ï¼Œåœ¨å†…å­˜å­˜å‚¨æ—¥å¿—å³å¯ï¼Œä¸ç”¨æ‹…å¿ƒ server ä¼š down æ‰ï¼Œæµ‹è¯•ä¸­ä»…ä¼šæ¨¡æ‹Ÿç½‘ç»œæŒ‚æ‰çš„æƒ…æ™¯ã€‚åˆå§‹Indexä»1å¼€å§‹ï¼Œ0ä¸ºdummy indexã€‚ ä¸ºä»€ä¹ˆ currentTerm å’Œ votedFor éœ€è¦æŒä¹…åŒ–?\nvotedFor ä¿è¯æ¯ä¸ªä»»æœŸæœ€å¤šåªæœ‰ä¸€ä¸ªLeaderï¼\nè€ƒè™‘å¦‚ä¸‹ä¸€ç§åœºæ™¯ï¼š å› ä¸ºåœ¨Raftåè®®ä¸­æ¯ä¸ªä»»æœŸå†…æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªLeaderã€‚ç°å‡è®¾æœ‰å‡ ä¸ªRaftèŠ‚ç‚¹åœ¨å½“å‰ä»»æœŸä¸‹æŠ•ç¥¨ç»™äº†RaftèŠ‚ç‚¹Aï¼Œå¹¶ä¸”Raft Aé¡ºåˆ©æˆä¸ºäº†Leaderã€‚ç°æ•…éšœç³»ç»Ÿè¢«é‡å¯ï¼Œé‡å¯åå¦‚æœæ”¶åˆ°ä¸€ä¸ªç›¸åŒä»»æœŸçš„RaftèŠ‚ç‚¹Bçš„æŠ•ç¥¨è¯·æ±‚ï¼Œç”±äºæ¯ä¸ªèŠ‚ç‚¹å¹¶æ²¡æœ‰è®°å½•å…¶æŠ•ç¥¨çŠ¶æ€ï¼Œé‚£ä¹ˆè¿™äº›èŠ‚ç‚¹å°±æœ‰å¯èƒ½æŠ•ç¥¨ç»™Raft Bï¼Œå¹¶ä½¿Bæˆä¸ºLeaderã€‚æ­¤æ—¶ï¼Œåœ¨åŒä¸€ä¸ªä»»æœŸå†…å°±ä¼šå­˜åœ¨ä¸¤ä¸ªLeaderï¼Œä¸Raftçš„è¦æ±‚ä¸ç¬¦ã€‚\nä¿è¯æ¯ä¸ªIndexä½ç½®åªä¼šæœ‰ä¸€ä¸ªTerm! (ä¹Ÿç­‰ä»·äºæ¯ä¸ªä»»æœŸå†…æœ€å¤šæœ‰ä¸€ä¸ªLeader)\nåœ¨è¿™é‡Œä¾‹å­ä¸­ï¼ŒS1å…³æœºäº†ï¼ŒS2å’ŒS3ä¼šå°è¯•é€‰ä¸¾ä¸€ä¸ªæ–°çš„Leaderã€‚å®ƒä»¬éœ€è¦è¯æ®è¯æ˜ï¼Œæ­£ç¡®çš„ä»»æœŸå·æ˜¯8ï¼Œè€Œä¸æ˜¯6ã€‚å¦‚æœä»…ä»…æ˜¯S2å’ŒS3ä¸ºå½¼æ­¤æŠ•ç¥¨ï¼Œå®ƒä»¬ä¸çŸ¥é“å½“å‰çš„ä»»æœŸå·ï¼Œå®ƒä»¬åªèƒ½æŸ¥çœ‹è‡ªå·±çš„Logï¼Œå®ƒä»¬æˆ–è®¸ä¼šè®¤ä¸ºä¸‹ä¸€ä¸ªä»»æœŸæ˜¯6ï¼ˆå› ä¸ºLogé‡Œçš„ä¸Šä¸€ä¸ªä»»æœŸæ˜¯5ï¼‰ã€‚å¦‚æœå®ƒä»¬è¿™ä¹ˆåšäº†ï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šä»ä»»æœŸ6å¼€å§‹æ·»åŠ Logã€‚ä½†æ˜¯æ¥ä¸‹æ¥ï¼Œå°±ä¼šæœ‰é—®é¢˜äº†ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰äº†ä¸¤ä¸ªä¸åŒçš„ä»»æœŸ6ï¼ˆå¦ä¸€ä¸ªåœ¨S1ä¸­ï¼‰ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆcurrentTerméœ€è¦è¢«æŒä¹…åŒ–å­˜å‚¨çš„åŸå› ï¼Œå› ä¸ºå®ƒéœ€è¦ç”¨æ¥ä¿å­˜å·²ç»è¢«ä½¿ç”¨è¿‡çš„ä»»æœŸå·ã€‚\nè¿™äº›æ•°æ®éœ€è¦åœ¨æ¯æ¬¡ä½ ä¿®æ”¹å®ƒä»¬çš„æ—¶å€™å­˜å‚¨èµ·æ¥ã€‚æ‰€ä»¥å¯ä»¥ç¡®å®šçš„æ˜¯ï¼Œå®‰å…¨çš„åšæ³•æ˜¯æ¯æ¬¡ä½ æ·»åŠ ä¸€ä¸ªLogæ¡ç›®ï¼Œæ›´æ–°currentTermæˆ–è€…æ›´æ–°votedForï¼Œä½ æˆ–è®¸éƒ½éœ€è¦æŒä¹…åŒ–å­˜å‚¨è¿™äº›æ•°æ®ã€‚åœ¨ä¸€ä¸ªçœŸå®çš„RaftæœåŠ¡å™¨ä¸Šï¼Œè¿™æ„å‘³ç€å°†æ•°æ®å†™å…¥ç£ç›˜ï¼Œæ‰€ä»¥ä½ éœ€è¦ä¸€äº›æ–‡ä»¶æ¥è®°å½•è¿™äº›æ•°æ®ã€‚å¦‚æœä½ å‘ç°ï¼Œç›´åˆ°æœåŠ¡å™¨ä¸å¤–ç•Œé€šä¿¡æ—¶ï¼Œæ‰æœ‰å¯èƒ½æŒä¹…åŒ–å­˜å‚¨æ•°æ®ï¼Œé‚£ä¹ˆä½ å¯ä»¥é€šè¿‡ä¸€äº›æ‰¹é‡æ“ä½œæ¥æå‡æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œåªåœ¨æœåŠ¡å™¨å›å¤ä¸€ä¸ªRPCæˆ–è€…å‘é€ä¸€ä¸ªRPCæ—¶ï¼ŒæœåŠ¡å™¨æ‰è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœä¸€äº›æŒä¹…åŒ–å­˜å‚¨çš„æ“ä½œã€‚\nVolatile state on all servers æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åº”è¯¥æœ‰çš„éæŒä¹…åŒ–çŠ¶æ€ï¼š commitIndex: å·²æäº¤çš„æœ€å¤§ indexã€‚è¢«æäº¤çš„å®šä¹‰ä¸ºï¼Œå½“ Leader æˆåŠŸåœ¨å¤§éƒ¨åˆ† server ä¸Šå¤åˆ¶äº†ä¸€æ¡ Entryï¼Œé‚£ä¹ˆè¿™æ¡ Entry å°±æ˜¯ä¸€æ¡å·²æäº¤çš„ Entryã€‚leader èŠ‚ç‚¹é‡å¯åå¯ä»¥é€šè¿‡ appendEntries rpc é€æ¸å¾—åˆ°ä¸åŒèŠ‚ç‚¹çš„ matchIndexï¼Œä»è€Œç¡®è®¤ commitIndexï¼Œfollower åªéœ€ç­‰å¾… leader ä¼ é€’è¿‡æ¥çš„ commitIndex å³å¯ã€‚ï¼ˆåˆå§‹å€¼ä¸º0ï¼Œå•è°ƒé€’å¢ï¼‰ lastApplied: å·²è¢«çŠ¶æ€æœºåº”ç”¨çš„æœ€å¤§ indexã€‚å·²æäº¤å’Œå·²åº”ç”¨æ˜¯ä¸åŒçš„æ¦‚å¿µï¼Œå·²åº”ç”¨æŒ‡è¿™æ¡ Entry å·²ç»è¢«è¿ç”¨åˆ°çŠ¶æ€æœºä¸Šã€‚å·²æäº¤å…ˆäºå·²åº”ç”¨ã€‚åŒæ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRaft ä¿è¯äº†å·²æäº¤çš„ Entry ä¸€å®šä¼šè¢«åº”ç”¨ï¼ˆé€šè¿‡å¯¹é€‰ä¸¾è¿‡ç¨‹å¢åŠ ä¸€äº›é™åˆ¶ï¼Œä¸‹é¢ä¼šæåˆ°ï¼‰ã€‚raft ç®—æ³•å‡è®¾äº†çŠ¶æ€æœºæœ¬èº«æ˜¯æ˜“å¤±çš„ï¼Œæ‰€ä»¥é‡å¯åçŠ¶æ€æœºçš„çŠ¶æ€å¯ä»¥é€šè¿‡ log[] ï¼ˆéƒ¨åˆ† log å¯ä»¥å‹ç¼©ä¸º snapshot) æ¥æ¢å¤ã€‚ï¼ˆåˆå§‹å€¼ä¸º0ï¼Œå•è°ƒé€’å¢ï¼‰ commitIndex å’Œ lastApplied åˆ†åˆ«ç»´æŠ¤ log å·²æäº¤å’Œå·²åº”ç”¨çš„çŠ¶æ€ï¼Œå½“èŠ‚ç‚¹å‘ç° commitIndex \u0026gt; lastApplied æ—¶ï¼Œä»£è¡¨ç€ commitIndex å’Œ lastApplied é—´çš„ entries å¤„äºå·²æäº¤ï¼Œæœªåº”ç”¨çš„çŠ¶æ€ã€‚å› æ­¤åº”å°†å…¶é—´çš„ entries æŒ‰åºåº”ç”¨è‡³çŠ¶æ€æœºã€‚","title":"MIT6.824 2022 Raft 0 ä»‹ç»"},{"content":"ä»‹ç» æŸ¥çœ‹Raft0 æµç¨‹æ¢³ç† æ•´ä½“é€»è¾‘, ä» ticker goroutine å¼€å§‹, é›†ç¾¤å¼€å§‹çš„æ—¶å€™ï¼Œæ‰€æœ‰èŠ‚ç‚¹å‡ä¸ºFollowerï¼Œ å®ƒä»¬ä¾é ticker()æˆä¸ºCandidateã€‚ticker åç¨‹ä¼šå®šæœŸæ”¶åˆ°ä¸¤ä¸ª timer çš„åˆ°æœŸäº‹ä»¶ï¼Œå¦‚æœæ˜¯ election timer åˆ°æœŸï¼Œåˆ™å‘èµ·ä¸€è½®é€‰ä¸¾ï¼›å¦‚æœæ˜¯ heartbeat timer åˆ°æœŸä¸”èŠ‚ç‚¹æ˜¯ leaderï¼Œåˆ™å‘èµ·ä¸€è½®å¿ƒè·³ã€‚\nElectionTimer å’Œ HeartbeatTimer. å¦‚æœæŸä¸ªraft èŠ‚ç‚¹election timeout,åˆ™ä¼šè§¦å‘leader election, è°ƒç”¨StartElection æ–¹æ³•ã€‚ StartElection ä¸­å‘é€ RequestVote RPC, æ ¹æ®ReqestVote Response åˆ¤æ–­æ˜¯å¦æ”¶åˆ°é€‰ç¥¨,å†³å®šæ˜¯å¦æˆä¸ºLeaderã€‚\nå¦‚æœæŸä¸ªèŠ‚ç‚¹,æ”¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹çš„é€‰ç¥¨,æˆä¸ºLeader è¦é€šè¿‡å‘é€Heartbeat å³ç©ºLogEntry çš„AppendEntries RPC æ¥å‘Šè¯‰å…¶ä»–èŠ‚ç‚¹è‡ªå·±çš„ Leader åœ°ä½ã€‚\næ‰€ä»¥Lab2A ä¸­,ä¸»è¦å®ç° RequestVote, AppendEntries çš„é€»è¾‘ã€‚\næœåŠ¡å™¨çŠ¶æ€ æœåŠ¡å™¨åœ¨ä»»æ„æ—¶é—´åªèƒ½å¤„äºä»¥ä¸‹ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼š\nLeaderï¼šå¤„ç†æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚ã€æ—¥å¿—åŒæ­¥ã€å¿ƒè·³ç»´æŒé¢†å¯¼æƒã€‚åŒä¸€æ—¶åˆ»æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªå¯è¡Œçš„ Leader Followerï¼šæ‰€æœ‰æœåŠ¡å™¨çš„åˆå§‹çŠ¶æ€ï¼ŒåŠŸèƒ½ä¸ºï¼šè¿½éšé¢†å¯¼è€…ï¼Œæ¥æ”¶é¢†å¯¼è€…æ—¥å¿—å¹¶å®æ—¶åŒæ­¥ï¼Œç‰¹æ€§ï¼šå®Œå…¨è¢«åŠ¨çš„ï¼ˆä¸å‘é€ RPCï¼Œåªå“åº”æ”¶åˆ°çš„ RPCï¼‰ Candidateï¼šç”¨æ¥é€‰ä¸¾æ–°çš„ Leaderï¼Œå¤„äº Leader å’Œ Follower ä¹‹é—´çš„æš‚æ—¶çŠ¶æ€ï¼Œå¦‚Follower ä¸€å®šæ—¶é—´å†…æœªæ”¶åˆ°æ¥è‡ªLeaderçš„å¿ƒè·³åŒ…ï¼ŒFollowerä¼šè‡ªåŠ¨åˆ‡æ¢ä¸ºCandidateï¼Œå¹¶å¼€å§‹é€‰ä¸¾æ“ä½œï¼Œå‘é›†ç¾¤ä¸­çš„å…¶å®ƒèŠ‚ç‚¹å‘é€æŠ•ç¥¨è¯·æ±‚ï¼Œå¾…æ”¶åˆ°åŠæ•°ä»¥ä¸Šçš„é€‰ç¥¨æ—¶ï¼Œåè°ƒè€…å‡çº§æˆä¸ºé¢†å¯¼è€…ã€‚ ç³»ç»Ÿæ­£å¸¸è¿è¡Œæ—¶ï¼Œåªæœ‰ä¸€ä¸ª Leaderï¼Œå…¶ä½™éƒ½æ˜¯ Followersã€‚Leaderæ‹¥æœ‰ç»å¯¹çš„é¢†å¯¼åŠ›ï¼Œä¸æ–­å‘FollowersåŒæ­¥æ—¥å¿—ä¸”å‘é€å¿ƒè·³çŠ¶æ€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 type Raft struct { mu sync.RWMutex // Lock to protect shared access to this peer\u0026#39;s state peers []*labrpc.ClientEnd // RPC end points of all peers persister *Persister // Object to hold this peer\u0026#39;s persisted state me int // this peer\u0026#39;s index into peers[] dead int32 // set by Kill() // Your data here (2A, 2B, 2C). // Look at the paper\u0026#39;s Figure 2 for a description of what // state a Raft server must maintain. // 2A state NodeState currentTerm int votedFor int electionTimer *time.Timer heartbeatTimer *time.Timer // 2B logs []Entry // the first is dummy entry which contains LastSnapshotTerm, LastSnapshotIndex and nil Command commitIndex int lastApplied int nextIndex []int matchIndex []int applyCh chan ApplyMsg applyCond *sync.Cond // used to wakeup applier goroutine after committing new entries replicatorCond []*sync.Cond // used to signal replicator goroutine to batch replicating entries } å¯åŠ¨ é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹åˆå§‹çŠ¶æ€å‡ä¸ºFollower Follower è¢«åŠ¨åœ°æ¥å— Leader æˆ– Candidate çš„ RPCï¼› æ‰€ä»¥ï¼Œå¦‚æœ Leader æƒ³è¦ä¿æŒæƒå¨ï¼Œå¿…é¡»å‘é›†ç¾¤ä¸­çš„å…¶å®ƒèŠ‚ç‚¹å‘é€å¿ƒè·³åŒ…ï¼ˆç©ºçš„ AppendEntries RPCï¼‰ ç­‰å¾…é€‰ä¸¾è¶…æ—¶(electionTimeoutï¼Œä¸€èˆ¬åœ¨ 100~500ms)åï¼ŒFollower æ²¡æœ‰æ”¶åˆ°ä»»ä½• RPC Follower è®¤ä¸ºé›†ç¾¤ä¸­æ²¡æœ‰ Leader å¼€å§‹æ–°çš„ä¸€è½®é€‰ä¸¾ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 func Make(peers []*labrpc.ClientEnd, me int, persister *Persister, applyCh chan ApplyMsg) *Raft { rf := \u0026amp;Raft{ peers: peers, persister: persister, me: me, dead: 0, applyCh: applyCh, replicatorCond: make([]*sync.Cond, len(peers)), state: StateFollower, currentTerm: 0, votedFor: -1, logs: make([]Entry, 1), nextIndex: make([]int, len(peers)), matchIndex: make([]int, len(peers)), heartbeatTimer: time.NewTimer(StableHeartbeatTimeout()), electionTimer: time.NewTimer(RandomizedElectionTimeout()), } // Your initialization code here (2A, 2B, 2C). // initialize from state persisted before a crash rf.readPersist(persister.ReadRaftState()) rf.applyCond = sync.NewCond(\u0026amp;rf.mu) lastLog := rf.getLastLog() for i := 0; i \u0026lt; len(peers); i++ { rf.matchIndex[i], rf.nextIndex[i] = 0, lastLog.Index+1 if i != rf.me { rf.replicatorCond[i] = sync.NewCond(\u0026amp;sync.Mutex{}) // start replicator goroutine to replicate entries in batch go rf.replicator(i) } } // start ticker goroutine to start elections go rf.ticker() // start applier goroutine to push committed logs into applyCh exactly once go rf.applier() return rf } é›†ç¾¤å¼€å§‹çš„æ—¶å€™ï¼Œæ‰€æœ‰èŠ‚ç‚¹å‡ä¸ºFollowerï¼Œ å®ƒä»¬ä¾é ticker()æˆä¸ºCandidateã€‚ticker åç¨‹ä¼šå®šæœŸæ”¶åˆ°ä¸¤ä¸ª timer çš„åˆ°æœŸäº‹ä»¶ï¼Œå¦‚æœæ˜¯ election timer åˆ°æœŸï¼Œåˆ™å‘èµ·ä¸€è½®é€‰ä¸¾ï¼›å¦‚æœæ˜¯ heartbeat timer åˆ°æœŸä¸”èŠ‚ç‚¹æ˜¯ leaderï¼Œåˆ™å‘èµ·ä¸€è½®å¿ƒè·³ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 // ticker The ticker go routine starts a new election if this peer hasn\u0026#39;t received // heartsbeats recently. func (rf *Raft) ticker() { // for rf.killed() == false { for !rf.killed() { // Your code here to check if a leader election should // be started and to randomize sleeping time using // time.Sleep(). select { case \u0026lt;-rf.electionTimer.C: // start election DPrintf(\u0026#34;{Node: %v} election timeout\u0026#34;, rf.me) rf.mu.Lock() rf.ChangeState(StateCandidate) rf.currentTerm += 1 rf.StartElection() rf.electionTimer.Reset(RandomizedElectionTimeout()) rf.mu.Unlock() case \u0026lt;-rf.heartbeatTimer.C: // é¢†å¯¼è€…å‘é€å¿ƒè·³ç»´æŒé¢†å¯¼åŠ›, 2A å¯ä»¥å…ˆä¸å®ç° rf.mu.Lock() if rf.state == StateLeader { rf.BroadcastHeartbeat(true) rf.heartbeatTimer.Reset(StableHeartbeatTimeout()) } rf.mu.Unlock() } } } é€‰ä¸¾ä¸æŠ•ç¥¨ å½“ä¸€ä¸ªèŠ‚ç‚¹å¼€å§‹ç«é€‰ï¼š\nå¢åŠ è‡ªå·±çš„ currentTerm è½¬ä¸º Candidate çŠ¶æ€ï¼Œå…¶ç›®æ ‡æ˜¯è·å–è¶…è¿‡åŠæ•°èŠ‚ç‚¹çš„é€‰ç¥¨ï¼Œè®©è‡ªå·±æˆä¸º Leader å…ˆç»™è‡ªå·±æŠ•ä¸€ç¥¨ å¹¶è¡Œåœ°å‘é›†ç¾¤ä¸­å…¶å®ƒèŠ‚ç‚¹å‘é€ RequestVote RPC ç´¢è¦é€‰ç¥¨ï¼Œå¦‚æœæ²¡æœ‰æ”¶åˆ°æŒ‡å®šèŠ‚ç‚¹çš„å“åº”ï¼Œå®ƒä¼šåå¤å°è¯•ï¼Œç›´åˆ°å‘ç”Ÿä»¥ä¸‹ä¸‰ç§æƒ…å†µä¹‹ä¸€: è·å¾—è¶…è¿‡åŠæ•°çš„é€‰ç¥¨ï¼šæˆä¸º Leaderï¼Œå¹¶å‘å…¶å®ƒèŠ‚ç‚¹å‘é€ AppendEntries å¿ƒè·³ï¼› æ”¶åˆ°æ¥è‡ª Leader çš„ RPCï¼šè½¬ä¸º Followerï¼› å…¶å®ƒä¸¤ç§æƒ…å†µéƒ½æ²¡å‘ç”Ÿï¼Œæ²¡äººèƒ½å¤Ÿè·èƒœ(electionTimeout å·²è¿‡)ï¼šå¢åŠ  currentTermï¼Œå¼€å§‹æ–°ä¸€è½®é€‰ä¸¾ï¼› Candidate é€‰ä¸¾ç¨‹åºä¸æŠ•ç¥¨ç»Ÿè®¡\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 unc (rf *Raft) StartElection() { req := rf.genRequestVoteReq() DPrintf(\u0026#34;{Note: %v} starts election with RequestVoteReq: %v\u0026#34;, rf.me, req) // Closure grantedVote := 1 // elect for itself rf.votedFor = rf.me rf.persist() for peer := range rf.peers { if peer == rf.me { continue } go func(peer int) { resp := new(RequestVoteResponse) if rf.sendRequestVote(peer, req, resp) { rf.mu.Lock() defer rf.mu.Unlock() DPrintf(\u0026#34;[RequestVoteResp]-{Node: %v} receives RequestVoteResponse %v from {Node: %v} after sending RequestVoteRequest %v in term %v\u0026#34;, rf.me, resp, peer, req, rf.currentTerm) // rf.currentTerm == req.Term ä¸ºäº†æŠ›å¼ƒè¿‡æœŸçš„RequestVote RPC if rf.currentTerm == req.Term \u0026amp;\u0026amp; rf.state == StateCandidate { // Candidate node if resp.VoteGranted { grantedVote += 1 if grantedVote \u0026gt; len(rf.peers)/2 { DPrintf(\u0026#34;{Node: %v} receives majority votes in term %v\u0026#34;, rf.me, rf.currentTerm) rf.ChangeState(StateLeader) rf.BroadcastHeartbeat(true) } } else if resp.Term \u0026gt; rf.currentTerm { // candidate å‘ç°æœ‰term æ¯”è‡ªå·±å¤§çš„ï¼Œç«‹åˆ»è½¬ä¸ºfollower DPrintf(\u0026#34;{Node %v} finds a new leader {Node %v} with term %v and steps down in term %v\u0026#34;, rf.me, peer, resp.Term, rf.currentTerm) rf.ChangeState(StateFollower) rf.currentTerm, rf.votedFor = resp.Term, -1 rf.persist() } } } }(peer) } } å‘èµ·æŠ•ç¥¨éœ€è¦å¼‚æ­¥è¿›è¡Œï¼Œä»è€Œä¸é˜»å¡tickerçº¿ç¨‹ï¼Œè¿™æ ·candidate å†æ¬¡ election timeout ä¹‹åæ‰èƒ½è‡ªå¢ term ç»§ç»­å‘èµ·æ–°ä¸€è½®é€‰ä¸¾ã€‚ æŠ•ç¥¨ç»Ÿè®¡ï¼šå¯ä»¥åœ¨å‡½æ•°å†…å®šä¹‰ä¸€ä¸ªå˜é‡å¹¶åˆ©ç”¨ go çš„é—­åŒ…æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥åœ¨ç»“æ„ä½“ä¸­ç»´æŠ¤ä¸€ä¸ª votes å˜é‡æ¥å®ç°ã€‚ä¸ºäº† raft ç»“æ„ä½“æ›´å¹²å‡€ï¼Œæˆ‘é€‰æ‹©äº†å‰è€…ã€‚ æŠ›å¼ƒè¿‡æœŸè¯·æ±‚çš„å›å¤ï¼šå¯¹äºè¿‡æœŸè¯·æ±‚çš„å›å¤ï¼Œç›´æ¥æŠ›å¼ƒå°±è¡Œï¼Œä¸è¦åšä»»ä½•å¤„ç†ï¼Œè¿™ä¸€ç‚¹ guidance é‡Œé¢ä¹Ÿæœ‰ä»‹ç»åˆ° RequestVote 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 func (rf *Raft) RequestVote(req *RequestVoteRequest, resp *RequestVoteResponse) { // Your code here (2A, 2B). // 2A rf.mu.Lock() defer rf.mu.Unlock() defer rf.persist() defer DPrintf(\u0026#34;[RequestVote]-{Node %v}\u0026#39;s state is {state %v,term %v,commitIndex %v,lastApplied %v,firstLog %v,lastLog %v} before processing requestVoteRequest %v and reply requestVoteResponse %v\u0026#34;, rf.me, rf.state, rf.currentTerm, rf.commitIndex, rf.lastApplied, rf.getFirstLog(), rf.getLastLog(), req, resp) if req.Term \u0026lt; rf.currentTerm || (req.Term == rf.currentTerm \u0026amp;\u0026amp; rf.votedFor != -1 \u0026amp;\u0026amp; rf.votedFor != req.CandidateId) { resp.Term, resp.VoteGranted = rf.currentTerm, false return } if req.Term \u0026gt; rf.currentTerm { rf.ChangeState(StateFollower) rf.currentTerm, rf.votedFor = req.Term, -1 } // 2A å¯ä»¥å…ˆä¸å®ç° if !rf.isLogUpToDate(req.LastLogTerm, req.LastLogIndex) { resp.Term, resp.VoteGranted = rf.currentTerm, false return } rf.votedFor = req.CandidateId rf.electionTimer.Reset(RandomizedElectionTimeout()) resp.Term, resp.VoteGranted = rf.currentTerm, true } ã€Œä»»æœŸã€è¡¨ç¤ºèŠ‚ç‚¹çš„é€»è¾‘æ—¶é’Ÿï¼Œä»»æœŸé«˜çš„èŠ‚ç‚¹æ‹¥æœ‰æ›´é«˜çš„è¯è¯­æƒã€‚åœ¨RequestVoteè¿™ä¸ªå‡½æ•°ä¸­ï¼Œå¦‚æœè¯·æ±‚è€…çš„ä»»æœŸå°äºå½“å‰èŠ‚ç‚¹ä»»æœŸï¼Œåˆ™æ‹’ç»æŠ•ç¥¨ï¼›å¦‚æœè¯·æ±‚è€…ä»»æœŸå¤§äºå½“å‰èŠ‚ç‚¹äººæ°”ï¼Œé‚£ä¹ˆå½“å‰èŠ‚ç‚¹ç«‹é©¬æˆä¸ºè¿½éšè€…ã€‚å³ä»»æœŸå¤§çš„èŠ‚ç‚¹å¯¹ä»»æœŸå°çš„æ‹¥æœ‰ç»å¯¹çš„è¯è¯­æƒï¼Œä¸€æ—¦å‘ç°ä»»æœŸå¤§çš„èŠ‚ç‚¹ï¼Œç«‹é©¬æˆä¸ºå…¶è¿½éšè€…ã€‚\næ³¨æ„ï¼ŒèŠ‚ç‚¹çš„é€‰ä¸¾éšæœºæ—¶é—´å’Œå¿ƒè·³æ—¶é—´çš„é€‰æ‹©å¾ˆé‡è¦\nèŠ‚ç‚¹éšæœºé€‰æ‹©è¶…æ—¶æ—¶é—´ï¼Œé€šå¸¸åœ¨ [T, 2T] ä¹‹é—´ï¼ˆT = electionTimeoutï¼‰ è¿™æ ·ï¼ŒèŠ‚ç‚¹ä¸å¤ªå¯èƒ½å†åŒæ—¶å¼€å§‹ç«é€‰ï¼Œå…ˆç«é€‰çš„èŠ‚ç‚¹æœ‰è¶³å¤Ÿçš„æ—¶é—´æ¥ç´¢è¦å…¶ä»–èŠ‚ç‚¹çš„é€‰ç¥¨ T \u0026raquo; broadcast time(T è¿œå¤§äºå¹¿æ’­æ—¶é—´)æ—¶æ•ˆæœæ›´ä½³ 1 2 3 4 5 6 7 8 9 10 11 12 13 const ( HeartbeatTimeout = 125 ElectionTimeout = 1000 ) func StableHeartbeatTimeout() time.Duration { // return time.Duration(HeartbeatTimeout) * time.Millisecond return HeartbeatTimeout * time.Millisecond } func RandomizedElectionTimeout() time.Duration { return time.Duration(ElectionTimeout+globalRand.Intn(ElectionTimeout)) * time.Millisecond } æ€»ç»“ é¢†å¯¼è€…é€‰ä¸¾ä¸»è¦å·¥ä½œå¯æ€»ç»“å¦‚ä¸‹ï¼š\nä¸‰ä¸ªçŠ¶æ€ï¼Œä¸‰ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬æ¢ã€‚ 1ä¸ªloopâ€”â€”tickerã€‚ 1ä¸ªRPCè¯·æ±‚å’Œå¤„ç†ï¼Œç”¨äºæŠ•ç¥¨ã€‚ å¦å¤–ï¼Œtickerä¼šä¸€ç›´è¿è¡Œï¼Œç›´åˆ°èŠ‚ç‚¹è¢«killï¼Œå› æ­¤é›†ç¾¤é¢†å¯¼è€…å¹¶éå”¯ä¸€ï¼Œä¸€æ—¦é¢†å¯¼è€…å‡ºç°äº†å®•æœºã€ç½‘ç»œæ•…éšœç­‰é—®é¢˜ï¼Œå…¶å®ƒèŠ‚ç‚¹éƒ½èƒ½ç¬¬ä¸€æ—¶é—´æ„ŸçŸ¥ï¼Œå¹¶è¿…é€Ÿåšå‡ºé‡æ–°é€‰ä¸¾çš„ååº”ï¼Œä»è€Œç»´æŒé›†ç¾¤çš„æ­£å¸¸è¿è¡Œï¼Œæ¯•ç«ŸRafté›†ç¾¤ä¸€æ—¦å¤±å»äº†é¢†å¯¼è€…ï¼Œå°±æ— æ³•å·¥ä½œã€‚\n","permalink":"https://reid00.github.io/en/posts/storage/mit6.824-2022-raft-lab2a-leader-election/","summary":"ä»‹ç» æŸ¥çœ‹Raft0 æµç¨‹æ¢³ç† æ•´ä½“é€»è¾‘, ä» ticker goroutine å¼€å§‹, é›†ç¾¤å¼€å§‹çš„æ—¶å€™ï¼Œæ‰€æœ‰èŠ‚ç‚¹å‡ä¸ºFollowerï¼Œ å®ƒä»¬ä¾é ticker()æˆä¸ºCandidateã€‚ticker åç¨‹ä¼šå®šæœŸæ”¶åˆ°ä¸¤ä¸ª timer çš„åˆ°æœŸäº‹ä»¶ï¼Œå¦‚æœæ˜¯ election timer åˆ°æœŸï¼Œåˆ™å‘èµ·ä¸€è½®é€‰ä¸¾ï¼›å¦‚æœæ˜¯ heartbeat timer åˆ°æœŸä¸”èŠ‚ç‚¹æ˜¯ leaderï¼Œåˆ™å‘èµ·ä¸€è½®å¿ƒè·³ã€‚\nElectionTimer å’Œ HeartbeatTimer. å¦‚æœæŸä¸ªraft èŠ‚ç‚¹election timeout,åˆ™ä¼šè§¦å‘leader election, è°ƒç”¨StartElection æ–¹æ³•ã€‚ StartElection ä¸­å‘é€ RequestVote RPC, æ ¹æ®ReqestVote Response åˆ¤æ–­æ˜¯å¦æ”¶åˆ°é€‰ç¥¨,å†³å®šæ˜¯å¦æˆä¸ºLeaderã€‚\nå¦‚æœæŸä¸ªèŠ‚ç‚¹,æ”¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹çš„é€‰ç¥¨,æˆä¸ºLeader è¦é€šè¿‡å‘é€Heartbeat å³ç©ºLogEntry çš„AppendEntries RPC æ¥å‘Šè¯‰å…¶ä»–èŠ‚ç‚¹è‡ªå·±çš„ Leader åœ°ä½ã€‚\næ‰€ä»¥Lab2A ä¸­,ä¸»è¦å®ç° RequestVote, AppendEntries çš„é€»è¾‘ã€‚\næœåŠ¡å™¨çŠ¶æ€ æœåŠ¡å™¨åœ¨ä»»æ„æ—¶é—´åªèƒ½å¤„äºä»¥ä¸‹ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼š\nLeaderï¼šå¤„ç†æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚ã€æ—¥å¿—åŒæ­¥ã€å¿ƒè·³ç»´æŒé¢†å¯¼æƒã€‚åŒä¸€æ—¶åˆ»æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªå¯è¡Œçš„ Leader Followerï¼šæ‰€æœ‰æœåŠ¡å™¨çš„åˆå§‹çŠ¶æ€ï¼ŒåŠŸèƒ½ä¸ºï¼šè¿½éšé¢†å¯¼è€…ï¼Œæ¥æ”¶é¢†å¯¼è€…æ—¥å¿—å¹¶å®æ—¶åŒæ­¥ï¼Œç‰¹æ€§ï¼šå®Œå…¨è¢«åŠ¨çš„ï¼ˆä¸å‘é€ RPCï¼Œåªå“åº”æ”¶åˆ°çš„ RPCï¼‰ Candidateï¼šç”¨æ¥é€‰ä¸¾æ–°çš„ Leaderï¼Œå¤„äº Leader å’Œ Follower ä¹‹é—´çš„æš‚æ—¶çŠ¶æ€ï¼Œå¦‚Follower ä¸€å®šæ—¶é—´å†…æœªæ”¶åˆ°æ¥è‡ªLeaderçš„å¿ƒè·³åŒ…ï¼ŒFollowerä¼šè‡ªåŠ¨åˆ‡æ¢ä¸ºCandidateï¼Œå¹¶å¼€å§‹é€‰ä¸¾æ“ä½œï¼Œå‘é›†ç¾¤ä¸­çš„å…¶å®ƒèŠ‚ç‚¹å‘é€æŠ•ç¥¨è¯·æ±‚ï¼Œå¾…æ”¶åˆ°åŠæ•°ä»¥ä¸Šçš„é€‰ç¥¨æ—¶ï¼Œåè°ƒè€…å‡çº§æˆä¸ºé¢†å¯¼è€…ã€‚ ç³»ç»Ÿæ­£å¸¸è¿è¡Œæ—¶ï¼Œåªæœ‰ä¸€ä¸ª Leaderï¼Œå…¶ä½™éƒ½æ˜¯ Followersã€‚Leaderæ‹¥æœ‰ç»å¯¹çš„é¢†å¯¼åŠ›ï¼Œä¸æ–­å‘FollowersåŒæ­¥æ—¥å¿—ä¸”å‘é€å¿ƒè·³çŠ¶æ€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 type Raft struct { mu sync.","title":"MIT6.824 2022 Raft Lab2A Leader Election"},{"content":"æµç¨‹æ¢³ç† ç›¸å…³çš„RPC åœ¨Raft0 ä¸­å·²ç»ä»‹ç», è¿™é‡Œä¸å†èµ˜è¿°ã€‚ å¯åŠ¨çš„Goroutineï¼š\nticker ä¸€ä¸ªï¼Œç”¨äºç›‘å¬ Election Timeout æˆ–è€…Heartbeat Timeout applier ä¸€ä¸ªï¼Œç›‘å¬ leader commit ä¹‹åï¼ŒæŠŠlog å‘é€åˆ°ApplyChï¼Œç„¶åä»applyCh ä¸­æŒä¹…åŒ–åˆ°æœ¬åœ° replicator n-1 ä¸ªï¼Œæ¯ä¸€ä¸ªå¯¹åº”ä¸€ä¸ª peerã€‚ç›‘å¬å¿ƒè·³å¹¿æ’­å‘½ä»¤ï¼Œä»…åœ¨èŠ‚ç‚¹ä¸º Leader æ—¶å·¥ä½œ, å”¤é†’æ¡ä»¶å˜é‡ã€‚æ¥æ”¶åˆ°å‘½ä»¤åï¼Œå‘å¯¹åº”çš„ peer å‘é€ AppendEntries RPCã€‚ æ—¥å¿—ç»“æ„ æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨è‡ªå·±çš„æ—¥å¿—å‰¯æœ¬(log[])ï¼Œæ¯æ¡æ—¥å¿—è®°å½•åŒ…å«ï¼š\nç´¢å¼•ï¼šè¯¥è®°å½•åœ¨æ—¥å¿—ä¸­çš„ä½ç½® ä»»æœŸå·ï¼šè¯¥è®°å½•é¦–æ¬¡è¢«åˆ›å»ºæ—¶çš„ä»»æœŸå· å‘½ä»¤ 1 2 3 4 5 type Entry struct { Index int Term int Command interface{} } æ—¥å¿—ã€Œå·²æäº¤ã€ä¸ã€Œå·²åº”ç”¨ã€æ¦‚å¿µï¼š\nå·²æäº¤ï¼šcommitted, æ•°æ®åœ¨æœ¬åœ°raft æ—¥å¿—ä¸­è®°å½•ï¼Œæ²¡æœ‰åº”ç”¨åˆ°çŠ¶æ€æœº å·²åº”ç”¨ï¼šçœŸæ­£çš„æ•°æ®å˜åŒ–ã€‚æäº¤åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¹‹åï¼Œåº”ç”¨åˆ°å„è‡ªæœ¬åœ°çš„çŠ¶æ€æœºä¸­ã€‚ å·²æäº¤çš„æ—¥å¿—è¢«åº”ç”¨åæ‰ä¼šç”Ÿæ•ˆ\næ—¥å¿—åŒæ­¥ï¼š æ—¥å¿—åŒæ­¥æ˜¯Leaderç‹¬æœ‰çš„æƒåˆ©ï¼ŒLeaderå‘Followerå‘é€æ—¥å¿—ï¼ŒFolloweråŒæ­¥æ—¥å¿—ã€‚\næ—¥å¿—åŒæ­¥è¦è§£å†³å¦‚ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š\nLeaderå‘é€å¿ƒè·³å®£ç¤ºè‡ªå·±çš„ä¸»æƒï¼ŒFollowerä¸ä¼šå‘èµ·é€‰ä¸¾ã€‚ Leaderå°†è‡ªå·±çš„æ—¥å¿—æ•°æ®åŒæ­¥åˆ°Followerï¼Œè¾¾åˆ°æ•°æ®å¤‡ä»½çš„æ•ˆæœã€‚ è¿è¡Œæµç¨‹ å®¢æˆ·ç«¯å‘ Leader å‘é€å‘½ä»¤ï¼Œå¸Œæœ›è¯¥å‘½ä»¤è¢«æ‰€æœ‰çŠ¶æ€æœºæ‰§è¡Œï¼›\nLeader å…ˆå°†è¯¥å‘½ä»¤è¿½åŠ åˆ°è‡ªå·±çš„æ—¥å¿—ä¸­ï¼› Leader å¹¶è¡Œåœ°å‘å…¶å®ƒèŠ‚ç‚¹å‘é€ AppendEntries RPCï¼Œç­‰å¾…å“åº”ï¼› æ”¶åˆ°è¶…è¿‡åŠæ•°èŠ‚ç‚¹çš„å“åº”ï¼Œåˆ™è®¤ä¸ºæ–°çš„æ—¥å¿—è®°å½•æ˜¯è¢«æäº¤çš„ï¼š Leader å°†å‘½ä»¤ä¼ ç»™è‡ªå·±çš„çŠ¶æ€æœºï¼Œç„¶åå‘å®¢æˆ·ç«¯è¿”å›å“åº” ä¸€æ—¦ Leader çŸ¥é“ä¸€æ¡è®°å½•è¢«æäº¤äº†ï¼Œå°†åœ¨åç»­çš„ AppendEntries RPC ä¸­é€šçŸ¥å·²ç»æäº¤è®°å½•çš„ Followers Follower å°†å·²æäº¤çš„å‘½ä»¤ä¼ ç»™è‡ªå·±çš„çŠ¶æ€æœº å¦‚æœ Follower å®•æœº/è¶…æ—¶ï¼šLeader å°†åå¤å°è¯•å‘é€ RPCï¼› æ€§èƒ½ä¼˜åŒ–ï¼šLeader ä¸å¿…ç­‰å¾…æ¯ä¸ª Follower åšå‡ºå“åº”ï¼Œåªéœ€è¦è¶…è¿‡åŠæ•°çš„æˆåŠŸå“åº”ï¼ˆç¡®ä¿æ—¥å¿—è®°å½•å·²ç»å­˜å‚¨åœ¨è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹ä¸Šï¼‰â€”â€”ä¸€ä¸ªå¾ˆæ…¢çš„èŠ‚ç‚¹ä¸ä¼šä½¿ç³»ç»Ÿå˜æ…¢ï¼Œå› ä¸º Leader ä¸å¿…ç­‰ä»–ï¼›\nAppendEntries RPC å…·ä½“ä»‹ç»å‚è€ƒæ­¤å¤„æ–‡ç« \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 type AppendEntriesReq struct { Term int LeaderId int PrevLogIndex int PrevLogTerm int LeaderComment int Entries []Entry } func (req AppendEntriesReq) String() string { return fmt.Sprintf(\u0026#34;{Term: %d, LeaderId: %v, PreVoteLogIndex: %v, PreVoteLogTerm: %v, LeaderComment: %v, Entries: %v}\u0026#34;, req.Term, req.LeaderId, req.PrevLogIndex, req.PrevLogTerm, req.LeaderComment, req.Entries) } type AppendEntriesResp struct { Term int Success bool // for fast backup https://mit-public-courses-cn-translatio.gitbook.io/mit6-824/lecture-07-raft2/7.3-hui-fu-jia-su-backup-acceleration ConflictIndex int ConflictTerm int ConflictLen int } func (resp AppendEntriesResp) String() string { return fmt.Sprintf(\u0026#34;{Term:%v,Success:%v,ConflictIndex:%v,ConflictTerm:%v}\u0026#34;, resp.Term, resp.Success, resp.ConflictIndex, resp.ConflictTerm) } AppendEntries RPC\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 func (rf *Raft) AppendEntries(req *AppendEntriesReq, resp *AppendEntriesResp) { rf.mu.Lock() defer rf.mu.Unlock() defer rf.persist() defer DPrintf(\u0026#34;[AppendEntries]- {Node: %v}\u0026#39;s state is {state %v, term %v, commitIndex %v, lastApplied %v, firstLog %v, lastLog %v} before processing AppendEntriesRequest %v and reply AppendEntries %v\u0026#34;, rf.me, rf.state, rf.currentTerm, rf.commitIndex, rf.lastApplied, rf.getFirstLog(), rf.getLastLog(), req, resp) // å¦‚æœå‘ç°æ¥è‡ªleaderçš„rpcä¸­çš„termæ¯”å½“å‰peerè¦å°, // è¯´æ˜æ˜¯è¯¥RPC æ¥è‡ªæ—§çš„term(leader)ï¼Œ|| æˆ–è€… å½“å‰leader éœ€è¦æ›´æ–° ä¸å¤„ç† if req.Term \u0026lt; rf.currentTerm { resp.Term, resp.Success = rf.currentTerm, false return } // ä¸€èˆ¬æ¥è®²,åœ¨voteçš„æ—¶å€™å·²ç»å°†currentTermå’ŒleaderåŒæ­¥ // ä¸è¿‡,æœ‰äº›peeræš‚æ—¶çš„æ‰çº¿æˆ–è€…å…¶ä»–ä¸€äº›æƒ…å†µé‡è¿ä»¥å,ä¼šå‘ç°termå’Œleaderä¸ä¸€æ · // ä»¥æ”¶åˆ°å¤§äºè‡ªå·±çš„termçš„rpcä¹Ÿæ˜¯ç¬¬ä¸€æ—¶é—´åŒæ­¥.è€Œä¸”è¦å°†voteforé‡æ–°è®¾ç½®ä¸º-1 // ç­‰å¾…å°†æ¥é€‰ä¸¾ (è¯´æ˜è¿™ä¸ªpeer ä¸æ˜¯ä¹‹å‰election ä¸­æŠ•çš„çš„marjority) if req.Term \u0026gt; rf.currentTerm { rf.currentTerm, rf.votedFor = req.Term, -1 } rf.ChangeState(StateFollower) rf.electionTimer.Reset(RandomizedElectionTimeout()) // PrevLogIndex æ¯”rf å½“å‰çš„ç¬¬ä¸€ä¸ªLog index è¿˜è¦å° if req.PrevLogIndex \u0026lt; rf.getFirstLog().Index { resp.Term, resp.Success = 0, false DPrintf(\u0026#34;[AppendEntries] - {Node: %v} receives unexpected AppendEntriesRequest %v from {Node: %v} because prevLogIndex %v \u0026lt; firstLogIndex %v\u0026#34;, rf.me, req, req.LeaderId, req.PrevLogIndex, rf.getFirstLog().Index) return } if !rf.matchLog(req.PrevLogTerm, req.PrevLogIndex) { // æ—¥å¿—çš„ä¸€è‡´æ€§æ£€æŸ¥å¤±è´¥åï¼Œé€’å½’æ‰¾åˆ°éœ€è¦è¿½åŠ æ—¥å¿—çš„ä½ç½® resp.Term, resp.Success = rf.currentTerm, false lastIndex := rf.getLastLog().Index if lastIndex \u0026lt; req.PrevLogIndex { // lastIndex å’Œ nextIndex[peer] ä¹‹é—´æœ‰ç©ºæ´ scenario3 // follower åœ¨nextIndex[peer] æ²¡æœ‰log resp.ConflictTerm = -1 resp.ConflictIndex = lastIndex + 1 } else { // scenario2, 1 // ä»¥ä»»æœŸä¸ºå•ä½è¿›è¡Œå›é€€ firstIndex := rf.getFirstLog().Index resp.ConflictTerm = rf.logs[req.PrevLogIndex-firstIndex].Term index := req.PrevLogIndex - 1 for index \u0026gt;= firstIndex \u0026amp;\u0026amp; rf.logs[index-firstIndex].Term == resp.ConflictTerm { index-- } resp.ConflictIndex = index } return } firstIndex := rf.getFirstLog().Index for i, entry := range req.Entries { // mergeLog // æ·»åŠ çš„æ—¥å¿—ç´¢å¼•ä½ç½® æ¯”Follower æ—¥å¿—ç›¸åŒ ç›´æ¥æ·»åŠ  æ­¤å¤„ç”¨å¤§äºç­‰äºï¼Œå®é™…åªæœ‰== // || è¦æ·»åŠ çš„æ—¥å¿—ç´¢å¼•ä½ç½®åœ¨ Follower ä¸­çš„ä»»æœŸå’ŒAE RPC ä¸­çš„Term å†²çª if entry.Index-firstIndex \u0026gt;= len(rf.logs) || rf.logs[entry.Index-firstIndex].Term != entry.Term { rf.logs = shrinkEntriesArray(append(rf.logs[:entry.Index-firstIndex], req.Entries[i:]...)) break } } rf.advanceCommitIndexForFollower(req.LeaderComment) resp.Term, resp.Success = rf.currentTerm, true } å¤åˆ¶æ¨¡å‹(log replication) å¯¹äºå¤åˆ¶æ¨¡å‹ï¼Œå¾ˆç›´è§‚çš„æ–¹å¼æ˜¯ï¼šåŒ…è£…ä¸€ä¸ª BroadcastHeartbeat() å‡½æ•°ï¼Œå…¶è´Ÿè´£å‘æ‰€æœ‰ follower å‘é€ä¸€è½®åŒæ­¥ã€‚ä¸è®ºæ˜¯å¿ƒè·³è¶…æ—¶è¿˜æ˜¯ä¸Šå±‚æœåŠ¡ä¼ è¿›æ¥ä¸€ä¸ªæ–° commandï¼Œéƒ½å»è°ƒä¸€æ¬¡è¿™ä¸ªå‡½æ•°æ¥å‘èµ·ä¸€è½®åŒæ­¥ã€‚\nä»¥ä¸Šæ–¹å¼æ˜¯å¯ä»¥ work çš„ï¼Œæˆ‘æœ€å¼€å§‹çš„å®ç°ä¹Ÿæ˜¯è¿™æ ·çš„ï¼Œç„¶è€Œåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç°è¿™ç§æ–¹å¼æœ‰å¾ˆå¤§çš„èµ„æºæµªè´¹ã€‚æ¯”å¦‚ä¸Šå±‚æœåŠ¡è¿ç»­è°ƒç”¨äº†å‡ åæ¬¡ Start() å‡½æ•°ï¼Œç”±äºæ¯ä¸€æ¬¡è°ƒç”¨ Start() å‡½æ•°éƒ½ä¼šè§¦å‘ä¸€è½®æ—¥å¿—åŒæ­¥ï¼Œåˆ™æœ€ç»ˆå¯¼è‡´å‘é€äº†å‡ åæ¬¡æ—¥å¿—åŒæ­¥ã€‚ä¸€æ–¹é¢ï¼Œè¿™äº›è¯·æ±‚åŒ…å«çš„ entries åŸºæœ¬éƒ½ä¸€æ ·ï¼Œç”šè‡³æœ‰ entry è¿ç»­å‡ºç°åœ¨å‡ åæ¬¡ rpc ä¸­ï¼Œè¿™æ ·çš„å®ç°å¤šä¼ è¾“äº†ä¸€äº›æ•°æ®ï¼Œå­˜åœ¨ä¸€å®šæµªè´¹ï¼›å¦ä¸€æ–¹é¢ï¼Œæ¯æ¬¡å‘é€ rpc éƒ½ä¸è®ºæ˜¯å‘é€ç«¯è¿˜æ˜¯æ¥æ”¶ç«¯éƒ½éœ€è¦è‹¥å¹²æ¬¡ç³»ç»Ÿè°ƒç”¨å’Œå†…å­˜æ‹·è´ï¼Œrpc æ¬¡æ•°è¿‡å¤šä¹Ÿä¼šå¯¹ CPU é€ æˆä¸å¿…è¦çš„å‹åŠ›ã€‚æ€»ä¹‹ï¼Œè¿™ç§èµ„æºæµªè´¹çš„æ ¹æœ¬åŸå› å°±åœ¨äºï¼šå°†æ—¥å¿—åŒæ­¥çš„è§¦å‘ä¸ä¸Šå±‚æœåŠ¡æäº¤æ–°æŒ‡ä»¤å¼ºç»‘å®šï¼Œä»è€Œå¯¼è‡´å‘é€äº†å¾ˆå¤šé‡å¤çš„ rpcã€‚\nä¸ºæ­¤ï¼Œå‚è€ƒäº† sofajraft çš„æ—¥å¿—å¤åˆ¶å®ç° ã€‚æ¯ä¸ª peer åœ¨å¯åŠ¨æ—¶ä¼šä¸ºé™¤è‡ªå·±ä¹‹å¤–çš„æ¯ä¸ª peer éƒ½åˆ†é…ä¸€ä¸ª replicator åç¨‹ã€‚å¯¹äº follower èŠ‚ç‚¹ï¼Œè¯¥åç¨‹åˆ©ç”¨æ¡ä»¶å˜é‡æ‰§è¡Œ wait æ¥é¿å…è€—è´¹ cpuï¼Œå¹¶ç­‰å¾…å˜æˆ leader æ—¶å†è¢«å”¤é†’ï¼›å¯¹äº leader èŠ‚ç‚¹ï¼Œè¯¥åç¨‹è´Ÿè´£å°½æœ€å¤§åœ°åŠªåŠ›å»å‘å¯¹åº” follower å‘é€æ—¥å¿—ä½¿å…¶åŒæ­¥ï¼Œç›´åˆ°è¯¥èŠ‚ç‚¹ä¸å†æ˜¯ leader æˆ–è€…è¯¥ follower èŠ‚ç‚¹çš„ matchIndex å¤§äºç­‰äºæœ¬åœ°çš„ lastIndexã€‚\nè¿™æ ·çš„å®ç°æ–¹å¼èƒ½å¤Ÿå°†æ—¥å¿—åŒæ­¥çš„è§¦å‘å’Œä¸Šå±‚æœåŠ¡æäº¤æ–°æŒ‡ä»¤è§£è€¦ï¼Œèƒ½å¤Ÿå¤§å¹…åº¦å‡å°‘ä¼ è¾“çš„æ•°æ®é‡ï¼Œrpc æ¬¡æ•°å’Œç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ã€‚ç”±äº 6.824 çš„æµ‹è¯•èƒ½å¤Ÿå±•ç¤ºæµ‹è¯•è¿‡ç¨‹ä¸­çš„ä¼ è¾“ rpc æ¬¡æ•°å’Œæ•°æ®é‡ï¼Œå› æ­¤æˆ‘è¿›è¡Œäº†å‰åçš„å¯¹æ¯”æµ‹è¯•ï¼Œç»“æœæ˜¾ç¤ºï¼šè¿™æ ·çš„å®ç°æ–¹å¼ç›¸æ¯”ç›´è§‚æ–¹å¼çš„å®ç°ï¼Œä¸åŒæµ‹è¯•æ•°æ®ä¼ è¾“é‡çš„å‡å°‘å€æ•°åœ¨ 1-20 å€ä¹‹é—´ã€‚å½“ç„¶ï¼Œè¿™æ ·çš„å®ç°ä¹Ÿåªæ˜¯å®ç°äº†ç²—ç²’åº¦çš„ batchingï¼Œå¹¶æ²¡æœ‰æµé‡æ§åˆ¶ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰å®ç° pipelineï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å»äº†è§£ sofajraft, etcd æˆ–è€… tikv çš„å®ç°ï¼Œä»–ä»¬å¯¹äºå¤åˆ¶è¿‡ç¨‹è¿›è¡Œäº†æ›´ç»†ç²’åº¦çš„æ§åˆ¶ã€‚\næ­¤å¤–ï¼Œè™½ç„¶ leader å¯¹äºæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ª replicator åç¨‹å»åŒæ­¥æ—¥å¿—ï¼Œä½†å…¶ç›®å‰åŒæ—¶æœ€å¤šåªèƒ½å‘é€ä¸€ä¸ª rpcï¼Œè€Œè¿™ä¸ª rpc å¾ˆå¯èƒ½è¶…æ—¶æˆ–ä¸¢å¤±ä»è€Œè§¦å‘é›†ç¾¤æ¢ä¸»ã€‚å› æ­¤ï¼Œå¯¹äº heartbeat timeout è§¦å‘çš„ BroadcastHeartbeatï¼Œæˆ‘ä»¬éœ€è¦ç«‹å³å‘å‡ºæ—¥å¿—åŒæ­¥è¯·æ±‚è€Œä¸æ˜¯è®© replicator å»å‘ã€‚è¿™ä¹Ÿå°±æ˜¯æˆ‘çš„ BroadcastHeartbeat å‡½æ•°æœ‰ä¸¤ç§è¡Œä¸ºçš„çœŸæ­£åŸå› ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 // handleAppendEntriesResponse peer handle AppendEntries RPC func (rf *Raft) handleAppendEntriesResponse(peer int, req *AppendEntriesReq, resp *AppendEntriesResp) { defer DPrintf(\u0026#34;[handleAppendEntriesResponse]-{Node %v}\u0026#39;s state is {state %v,term %v,commitIndex %v,lastApplied %v,firstLog %v,lastLog %v} after handling AppendEntriesResponse %v for AppendEntriesRequest %v\u0026#34;, rf.me, rf.state, rf.currentTerm, rf.commitIndex, rf.lastApplied, rf.getFirstLog(), rf.getLastLog(), resp, req) if rf.state == StateLeader \u0026amp;\u0026amp; rf.currentTerm == req.Term { if resp.Success { // æ›´æ–°matchIndex, nextIndex rf.matchIndex[peer] = req.PrevLogIndex + len(req.Entries) rf.nextIndex[peer] = rf.matchIndex[peer] + 1 rf.advanceCommitIndexForLeader() } else { // term å¤ªå°è€Œå¤±è´¥ if resp.Term \u0026gt; rf.currentTerm { rf.ChangeState(StateFollower) rf.currentTerm, rf.votedFor = resp.Term, -1 rf.persist() } else if resp.Term == rf.currentTerm { // æ—¥å¿—ä¸åŒ¹é…è€Œå¤±è´¥ rf.nextIndex[peer] = resp.ConflictIndex // 1. å¦‚æœåœ¨Leader ä¸­èƒ½æ‰¾åˆ°å’ŒFollower æœ‰ç›¸åŒçš„ConflictTermï¼Œ // è¿”å›è¯¥Leader Term çš„æœ€åä¸€ä¸ªLog ä½œä¸ºnextIndex[peer] // 2. å¦‚æœæ‰¾ä¸åˆ°ç›¸åŒçš„Termï¼Œè¿”å›Follower ä¸­çš„ConflictTerm çš„ç¬¬ä¸€ä¸ªæ—¥å¿—ï¼Œå³ConflictIndex if resp.ConflictTerm != -1 { firstIndex := rf.getFirstLog().Index for i := req.PrevLogIndex; i \u0026gt;= firstIndex; i-- { if rf.logs[i-firstIndex].Term == resp.ConflictTerm { rf.nextIndex[peer] = i break } } } } } } } func (rf *Raft) replicator(peer int) { rf.replicatorCond[peer].L.Lock() defer rf.replicatorCond[peer].L.Unlock() for !rf.killed() { // if there is no need to replicate entries for this peer, // just release CPU and wait other goroutine\u0026#39;s signal if service adds new Command // if this peer needs replicating entries, this goroutine will call // replicateOneRound(peer) multiple times until this peer catches up, and then wait // Only Leader å¯ä»¥Invoke è¿™ä¸ªæ–¹æ³•ï¼Œé€šè¿‡.Singal å”¤é†’å„ä¸ªpeer, ä¸æ˜¯Leader ä¸ç”Ÿæ•ˆ for !rf.needReplicating(peer) { rf.replicatorCond[peer].Wait() } // maybe a pipeline mechanism is better to trade-off the memory usage and catch up time rf.replicateOneRound(peer) } } æ—¥å¿—åº”ç”¨ å¼‚æ­¥ applier çš„ exactly once Raftè®ºæ–‡çš„è¯´è¯ï¼Œä¸€æ—¦å‘ç°commitIndexå¤§äºlastAppliedï¼Œåº”è¯¥ç«‹é©¬å°†å¯åº”ç”¨çš„æ—¥å¿—åº”ç”¨åˆ°çŠ¶æ€æœºä¸­ã€‚RaftèŠ‚ç‚¹æœ¬èº«æ˜¯æ²¡æœ‰çŠ¶æ€æœºå®ç°çš„ï¼ŒçŠ¶æ€æœºåº”è¯¥ç”±Raftçš„ä¸Šå±‚åº”ç”¨æ¥å®ç°ï¼Œå› æ­¤æˆ‘ä»¬ä¸ä¼šè°ˆè®ºå¦‚ä½•å®ç°çŠ¶æ€æœºï¼Œåªéœ€å°†æ—¥å¿—å‘é€ç»™applyChè¿™ä¸ªé€šé“å³å¯ã€‚\nå¯¹äºå¼‚æ­¥ applyï¼Œå…¶è§¦å‘æ–¹å¼æ— éä¸¤ç§ï¼Œleader æäº¤äº†æ–°çš„æ—¥å¿—æˆ–è€… follower é€šè¿‡ leader å‘æ¥çš„ leaderCommit æ¥æ›´æ–° commitIndexã€‚å¾ˆå¤šäººå®ç°çš„æ—¶å€™å¯èƒ½é¡ºæ‰‹å°±åœ¨è¿™ä¸¤å¤„å¼‚æ­¥å¯ä¸€ä¸ªåç¨‹æŠŠ [lastApplied + 1, commitIndex] çš„ entry push åˆ° applyCh ä¸­ï¼Œä½†å…¶å®è¿™æ ·å­æ˜¯å¯èƒ½é‡å¤å‘é€ entry çš„ï¼ŒåŸå› æ˜¯ push applyCh çš„è¿‡ç¨‹ä¸èƒ½å¤ŸæŒé”ï¼Œé‚£ä¹ˆè¿™ä¸ª lastApplied åœ¨æ²¡æœ‰ push å®Œä¹‹å‰å°±æ— æ³•å¾—åˆ°æ›´æ–°ï¼Œä»è€Œå¯èƒ½è¢«å¤šæ¬¡è°ƒç”¨ã€‚è™½ç„¶åªè¦ä¸Šå±‚æœåŠ¡å¯ä»¥ä¿è¯ä¸é‡å¤ apply ç›¸åŒ index çš„æ—¥å¿—åˆ°çŠ¶æ€æœºå°±ä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æˆ‘ä¸ªäººè®¤ä¸ºè¿™æ ·çš„åšæ³•æ˜¯ä¸ä¼˜é›…çš„ã€‚è€ƒè™‘åˆ°å¼‚æ­¥ apply æ—¶æœ€è€—æ—¶çš„æ­¥éª¤æ˜¯ apply channel å’Œ apply æ—¥å¿—åˆ°çŠ¶æ€æœºï¼Œå…¶ä»–çš„éƒ½ä¸æ€ä¹ˆè€—è´¹æ—¶é—´ã€‚å› æ­¤æˆ‘ä»¬å®Œå…¨å¯ä»¥åªç”¨ä¸€ä¸ª applier åç¨‹ï¼Œè®©å…¶ä¸æ–­çš„æŠŠ [lastApplied + 1, commitIndex] åŒºé—´çš„æ—¥å¿— push åˆ° applyCh ä¸­å»ã€‚è¿™æ ·æ—¢å¯ä¿è¯æ¯ä¸€æ¡æ—¥å¿—åªä¼šè¢« exactly once åœ° push åˆ° applyCh ä¸­ï¼Œä¹Ÿå¯ä»¥ä½¿å¾—æ—¥å¿— apply åˆ°çŠ¶æ€æœºå’Œ raft æäº¤æ–°æ—¥å¿—å¯ä»¥çœŸæ­£çš„å¹¶è¡Œã€‚æˆ‘è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªè¾ƒä¸ºä¼˜é›…çš„å¼‚æ­¥ apply å®ç°ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 // applier a dedicated applier goroutine to guarantee that each log will be push into // applyCh exactly once, ensuring that service\u0026#39;s applying entries and raft\u0026#39;s // committing entries can be parallel func (rf *Raft) applier() { for !rf.killed() { rf.mu.Lock() // if there is no need to apply entries, // just release CPU and wait other goroutine\u0026#39;s signal if they commit new entries for rf.lastApplied \u0026gt;= rf.commitIndex { rf.applyCond.Wait() } firstIndex, commitIndex, lastApplied := rf.getFirstLog().Index, rf.commitIndex, rf.lastApplied entries := make([]Entry, commitIndex-lastApplied) copy(entries, rf.logs[lastApplied+1-firstIndex:commitIndex+1-firstIndex]) rf.mu.Unlock() for _, entry := range entries { rf.applyCh \u0026lt;- ApplyMsg{ CommandValid: true, Command: entry.Command, CommandTerm: entry.Term, CommandIndex: entry.Index, } } rf.mu.Lock() DPrintf(\u0026#34;{Node %v} applies entries %v-%v in term %v\u0026#34;, rf.me, rf.lastApplied, commitIndex, rf.currentTerm) rf.lastApplied = Max(rf.lastApplied, commitIndex) rf.mu.Unlock() } } éœ€è¦æ³¨æ„ä»¥ä¸‹ä¸¤ç‚¹ï¼š\nå¼•ç”¨ä¹‹å‰çš„ commitIndexï¼špush applyCh ç»“æŸä¹‹åæ›´æ–° lastApplied çš„æ—¶å€™ä¸€å®šå¾—ç”¨ä¹‹å‰çš„ commitIndex è€Œä¸æ˜¯ rf.commitIndexï¼Œå› ä¸ºåè€…å¾ˆå¯èƒ½åœ¨ push channel æœŸé—´å‘ç”Ÿäº†æ”¹å˜ã€‚ é˜²æ­¢ä¸ installSnapshot å¹¶å‘å¯¼è‡´ lastApplied å›é€€ï¼šéœ€è¦æ³¨æ„åˆ°ï¼Œapplier åç¨‹åœ¨ push channel æ—¶ï¼Œä¸­é—´å¯èƒ½å¤¹æ‚æœ‰ snapshot ä¹Ÿåœ¨ push channelã€‚å¦‚æœè¯¥ snapshot æœ‰æ•ˆï¼Œé‚£ä¹ˆåœ¨ CondInstallSnapshot å‡½æ•°é‡Œä¸Šå±‚çŠ¶æ€æœºå’Œ raft æ¨¡å—å°±ä¼šåŸå­æ€§çš„å‘ç”Ÿæ›¿æ¢ï¼Œå³ä¸Šå±‚çŠ¶æ€æœºæ›´æ–°ä¸º snapshot çš„çŠ¶æ€ï¼Œraft æ¨¡å—æ›´æ–° log, commitIndex, lastApplied ç­‰ç­‰ï¼Œæ­¤æ—¶å¦‚æœè¿™ä¸ª snapshot ä¹‹åè¿˜æœ‰ä¸€æ‰¹æ—§çš„ entry åœ¨ push channelï¼Œé‚£ä¸Šå±‚æœåŠ¡éœ€è¦èƒ½å¤ŸçŸ¥é“è¿™äº› entry å·²ç»è¿‡æ—¶ï¼Œä¸èƒ½å† applyï¼ŒåŒæ—¶ applier è¿™é‡Œä¹Ÿåº”è¯¥åŠ ä¸€ä¸ª Max è‡ªèº«çš„å‡½æ•°æ¥é˜²æ­¢ lastApplied å‡ºç°å›é€€ã€‚ å¿«é€Ÿæ¢å¤(Fast Backup) åœ¨å‰é¢ï¼ˆ7.1ï¼‰ä»‹ç»çš„æ—¥å¿—æ¢å¤æœºåˆ¶ä¸­ï¼Œå¦‚æœLogæœ‰å†²çªï¼ŒLeaderæ¯æ¬¡ä¼šå›é€€ä¸€æ¡Logæ¡ç›®ã€‚ è¿™åœ¨è®¸å¤šåœºæ™¯ä¸‹éƒ½æ²¡æœ‰é—®é¢˜ã€‚ä½†æ˜¯åœ¨æŸäº›ç°å®çš„åœºæ™¯ä¸­ï¼Œè‡³å°‘åœ¨Lab2çš„æµ‹è¯•ç”¨ä¾‹ä¸­ï¼Œæ¯æ¬¡åªå›é€€ä¸€æ¡Logæ¡ç›®ä¼šèŠ±è´¹å¾ˆé•¿å¾ˆé•¿çš„æ—¶é—´ã€‚æ‰€ä»¥ï¼Œç°å®çš„åœºæ™¯ä¸­ï¼Œå¯èƒ½ä¸€ä¸ªFollowerå…³æœºäº†å¾ˆé•¿æ—¶é—´ï¼Œé”™è¿‡äº†å¤§é‡çš„AppendEntriesæ¶ˆæ¯ã€‚è¿™æ—¶ï¼ŒLeaderé‡å¯äº†ã€‚æŒ‰ç…§Raftè®ºæ–‡ä¸­çš„å›¾2ï¼Œå¦‚æœä¸€ä¸ªLeaderé‡å¯äº†ï¼Œå®ƒä¼šå°†æ‰€æœ‰Followerçš„nextIndexè®¾ç½®ä¸ºLeaderæœ¬åœ°Logè®°å½•çš„ä¸‹ä¸€ä¸ªæ§½ä½ï¼ˆ7.1æœ‰è¯´æ˜ï¼‰ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªFollowerå…³æœºå¹¶é”™è¿‡äº†1000æ¡Logæ¡ç›®ï¼ŒLeaderé‡å¯ä¹‹åï¼Œéœ€è¦æ¯æ¬¡é€šè¿‡ä¸€æ¡RPCæ¥å›é€€ä¸€æ¡Logæ¡ç›®æ¥éå†1000æ¡Followeré”™è¿‡çš„Logè®°å½•ã€‚è¿™ç§æƒ…å†µåœ¨ç°å®ä¸­å¹¶éä¸å¯èƒ½å‘ç”Ÿã€‚åœ¨ä¸€äº›ä¸æ­£å¸¸çš„åœºæ™¯ä¸­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰5ä¸ªæœåŠ¡å™¨ï¼Œæœ‰1ä¸ªLeaderï¼Œè¿™ä¸ªLeaderå’Œå¦ä¸€ä¸ªFollowerå›°åœ¨ä¸€ä¸ªç½‘ç»œåˆ†åŒºã€‚ä½†æ˜¯è¿™ä¸ªLeaderå¹¶ä¸çŸ¥é“å®ƒå·²ç»ä¸å†æ˜¯Leaderäº†ã€‚å®ƒè¿˜æ˜¯ä¼šå‘å®ƒå”¯ä¸€çš„Followerå‘é€AppendEntriesï¼Œå› ä¸ºè¿™é‡Œæ²¡æœ‰è¿‡åŠæœåŠ¡å™¨ï¼Œæ‰€ä»¥æ²¡æœ‰ä¸€æ¡Logä¼šcommitã€‚åœ¨å¦ä¸€ä¸ªæœ‰å¤šæ•°æœåŠ¡å™¨çš„ç½‘ç»œåˆ†åŒºä¸­ï¼Œç³»ç»Ÿé€‰å‡ºäº†æ–°çš„Leaderå¹¶ç»§ç»­è¿è¡Œã€‚æ—§çš„Leaderå’Œå®ƒçš„Followerå¯èƒ½ä¼šè®°å½•æ— é™å¤šçš„æ—§çš„ä»»æœŸçš„æœªcommitçš„Logã€‚å½“æ—§çš„Leaderå’Œå®ƒçš„Followeré‡æ–°åŠ å…¥åˆ°é›†ç¾¤ä¸­æ—¶ï¼Œè¿™äº›Logéœ€è¦è¢«åˆ é™¤å¹¶è¦†ç›–ã€‚å¯èƒ½åœ¨ç°å®ä¸­ï¼Œè¿™ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“å‘ç”Ÿï¼Œä½†æ˜¯ä½ ä¼šåœ¨Lab2çš„æµ‹è¯•ç”¨ä¾‹ä¸­å‘ç°è¿™ä¸ªåœºæ™¯ã€‚\næ‰€ä»¥ï¼Œä¸ºäº†æ›´å¿«çš„æ¢å¤æ—¥å¿—ï¼ŒRaftè®ºæ–‡åœ¨5.3ç»“å°¾å¤„ï¼Œå¯¹è¿™ç§æ–¹æ³•æœ‰äº†ä¸€äº›æ¨¡ç³Šçš„æè¿°ã€‚åŸæ–‡æœ‰äº›æ™¦æ¶©ï¼Œåœ¨è¿™é‡Œæˆ‘ä¼šä»¥ä¸€ç§æ›´å¥½çš„æ–¹å¼ï¼Œå°è¯•è§£é‡Šè®ºæ–‡ä¸­æœ‰å…³å¿«é€Ÿæ¢å¤çš„æ–¹æ³•ã€‚å¤§è‡´æ€æƒ³æ˜¯ï¼Œè®©Followerè¿”å›è¶³å¤Ÿå¤šçš„ä¿¡æ¯ç»™Leaderï¼Œè¿™æ ·Leaderå¯ä»¥ä»¥ä»»æœŸï¼ˆTermï¼‰ä¸ºå•ä½æ¥å›é€€ï¼Œè€Œä¸ç”¨æ¯æ¬¡åªå›é€€ä¸€æ¡Logæ¡ç›®ã€‚æ‰€ä»¥ç°åœ¨ï¼Œåœ¨æ¢å¤Followerçš„Logæ—¶ï¼Œå¦‚æœLeaderå’ŒFollowerçš„Logä¸åŒ¹é…ï¼ŒLeaderåªéœ€è¦å¯¹ä¸åŒä»»æœŸå‘ç”Ÿä¸€æ¡AEsï¼Œè€Œä¸éœ€è¦å¯¹æ¯ä¸ªä¸é€šLogæ¡ç›®å‘é€ä¸€æ¡AEsã€‚è¿™æ˜¯ä¸€ç§åŠ é€Ÿç­–ç•¥ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æœ‰åˆ«çš„æ—¥å¿—æ¢å¤çš„åŠ é€Ÿç­–ç•¥ã€‚\næˆ‘å°†å¯èƒ½å‡ºç°çš„åœºæ™¯åˆ†æˆ3ç±»ï¼Œä¸ºäº†ç®€åŒ–ï¼Œè¿™é‡Œåªç”»å‡ºä¸€ä¸ªLeaderï¼ˆS2ï¼‰å’Œä¸€ä¸ªFollowerï¼ˆS1ï¼‰ï¼ŒS2å°†è¦å‘é€ä¸€æ¡ä»»æœŸå·ä¸º6çš„AppendEntriesæ¶ˆæ¯ç»™Followerã€‚\nåœºæ™¯1ï¼šS1(Follower)æ²¡æœ‰ä»»æœŸ6çš„ä»»ä½•Logï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å›é€€ä¸€æ•´ä¸ªä»»æœŸçš„Logã€‚ åœºæ™¯2ï¼šS1æ”¶åˆ°äº†ä»»æœŸ4çš„æ—§Leaderçš„å¤šæ¡Logï¼Œä½†æ˜¯ä½œä¸ºæ–°Leaderï¼ŒS2åªæ”¶åˆ°äº†ä¸€æ¡ä»»æœŸ4çš„Logã€‚æ‰€ä»¥è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦è¦†ç›–S1ä¸­æœ‰å…³æ—§Leaderçš„ä¸€äº›Logã€‚ åœºæ™¯3: S1ä¸S2çš„Logä¸å†²çªï¼Œä½†æ˜¯S1ç¼ºå¤±äº†éƒ¨åˆ†S2ä¸­çš„Log å¯ä»¥è®©Followeråœ¨å›å¤Leaderçš„AppendEntriesæ¶ˆæ¯ä¸­ï¼Œæºå¸¦3ä¸ªé¢å¤–çš„ä¿¡æ¯ï¼Œæ¥åŠ é€Ÿæ—¥å¿—çš„æ¢å¤ã€‚è¿™é‡Œçš„å›å¤æ˜¯æŒ‡ï¼ŒFollowerå› ä¸ºLogä¿¡æ¯ä¸åŒ¹é…ï¼Œæ‹’ç»äº†Leaderçš„AppendEntriesä¹‹åçš„å›å¤ã€‚è¿™é‡Œçš„ä¸‰ä¸ªä¿¡æ¯æ˜¯æŒ‡ï¼š\nXTerm: è¿™ä¸ªæ˜¯Followerä¸­ä¸Leaderå†²çªçš„Logå¯¹åº”çš„ä»»æœŸå·ã€‚åœ¨ä¹‹å‰ï¼ˆ7.1ï¼‰æœ‰ä»‹ç»Leaderä¼šåœ¨prevLogTermä¸­å¸¦ä¸Šæœ¬åœ°Logè®°å½•ä¸­ï¼Œå‰ä¸€æ¡Logçš„ä»»æœŸå·ã€‚å¦‚æœFolloweråœ¨å¯¹åº”ä½ç½®çš„ä»»æœŸå·ä¸åŒ¹é…ï¼Œå®ƒä¼šæ‹’ç»Leaderçš„AppendEntriesæ¶ˆæ¯ï¼Œå¹¶å°†è‡ªå·±çš„ä»»æœŸå·æ”¾åœ¨XTermä¸­ã€‚å¦‚æœFolloweråœ¨å¯¹åº”ä½ç½®æ²¡æœ‰Logï¼Œé‚£ä¹ˆè¿™é‡Œä¼šè¿”å› -1ã€‚ XIndex: è¿™ä¸ªæ˜¯Followerä¸­ï¼Œå¯¹åº”ä»»æœŸå·ä¸ºXTermçš„ç¬¬ä¸€æ¡Logæ¡ç›®çš„æ§½ä½å·ã€‚ XLen: å¦‚æœFolloweråœ¨å¯¹åº”ä½ç½®æ²¡æœ‰Logï¼Œé‚£ä¹ˆXTermä¼šè¿”å›-1ï¼ŒXLenè¡¨ç¤ºç©ºç™½çš„Logæ§½ä½æ•°ã€‚ æˆ‘ä»¬å†æ¥çœ‹è¿™äº›ä¿¡æ¯æ˜¯å¦‚ä½•åœ¨ä¸Šé¢3ä¸ªåœºæ™¯ä¸­ï¼Œå¸®åŠ©Leaderå¿«é€Ÿå›é€€åˆ°é€‚å½“çš„Logæ¡ç›®ä½ç½®ã€‚\nåœºæ™¯1: Followerï¼ˆS1ï¼‰ä¼šè¿”å›XTerm=5ï¼ŒXIndex=2ã€‚Leaderï¼ˆS2ï¼‰å‘ç°è‡ªå·±æ²¡æœ‰ä»»æœŸ5çš„æ—¥å¿—ï¼Œå®ƒä¼šå°†è‡ªå·±æœ¬åœ°è®°å½•çš„ï¼ŒS1çš„nextIndexè®¾ç½®åˆ°XIndexï¼Œä¹Ÿå°±æ˜¯S1ä¸­ï¼Œä»»æœŸ5çš„ç¬¬ä¸€æ¡Logå¯¹åº”çš„æ§½ä½å·ã€‚æ‰€ä»¥ï¼Œå¦‚æœLeaderå®Œå…¨æ²¡æœ‰XTermçš„ä»»ä½•Logï¼Œé‚£ä¹ˆå®ƒåº”è¯¥å›é€€åˆ°XIndexå¯¹åº”çš„ä½ç½®ï¼ˆè¿™æ ·ï¼ŒLeaderå‘å‡ºçš„ä¸‹ä¸€æ¡AppendEntrieså°±å¯ä»¥ä¸€æ¬¡è¦†ç›–S1ä¸­æ‰€æœ‰XTermå¯¹åº”çš„Logï¼‰ åœºæ™¯2ï¼š Followerï¼ˆS1ï¼‰ä¼šè¿”å›XTerm=4ï¼ŒXIndex=1ã€‚Leaderï¼ˆS2ï¼‰å‘ç°è‡ªå·±å…¶å®æœ‰ä»»æœŸ4çš„æ—¥å¿—ï¼Œå®ƒä¼šå°†è‡ªå·±æœ¬åœ°è®°å½•çš„S1çš„nextIndexè®¾ç½®åˆ°æœ¬åœ°åœ¨XTermä½ç½®çš„Logæ¡ç›®åé¢ï¼Œä¹Ÿå°±æ˜¯æ§½ä½2ã€‚ä¸‹ä¸€æ¬¡Leaderå‘å‡ºä¸‹ä¸€æ¡AppendEntriesæ—¶ï¼Œå°±å¯ä»¥ä¸€æ¬¡è¦†ç›–S1ä¸­æ§½ä½2å’Œæ§½ä½3å¯¹åº”çš„Logã€‚ åœºæ™¯3: Followerï¼ˆS1ï¼‰ä¼šè¿”å›XTerm=-1ï¼ŒXLen=2ã€‚è¿™è¡¨ç¤ºS1ä¸­æ—¥å¿—å¤ªçŸ­äº†ï¼Œä»¥è‡³äºåœ¨å†²çªçš„ä½ç½®æ²¡æœ‰Logæ¡ç›®ï¼ŒLeaderåº”è¯¥å›é€€åˆ°Followeræœ€åä¸€æ¡Logæ¡ç›®çš„ä¸‹ä¸€æ¡ï¼Œä¹Ÿå°±æ˜¯æ§½ä½2ï¼Œå¹¶ä»è¿™å¼€å§‹å‘é€AppendEntriesæ¶ˆæ¯ã€‚æ§½ä½2å¯ä»¥ä»XLenä¸­çš„æ•°å€¼è®¡ç®—å¾—åˆ°ã€‚ åœ¨æœ¬æ¬¡çš„å®ç°ä¸­ä»¥Term ä¸ºå•ä½è¿”å›ï¼Œä¸åœ¨ä¸€ä¸ªä¸€ä¸ªIndex è‡ªå‡ã€‚è¿™éœ€è¦æ·»åŠ  ConflicTerm, ConflictIndex å­—æ®µ å»è®°å½•å‡ºç°å†²çªçš„ä½ç½®å’Œä»»æœŸã€‚ç„¶ååœ¨ HanleAppendEntries RPC ä¸­ï¼Œåœ¨ Leader çš„log ä¸­æ£€æŸ¥ ConflictIndex ä½ç½®çš„æ—¥å¿—ä¸€è‡´æ€§ã€‚\nä¸ºä»€ä¹ˆRaftåè®®ä¸èƒ½æäº¤ä¹‹å‰ä»»æœŸçš„æ—¥å¿—ï¼Ÿ æŸ¥çœ‹\nå‡½æ•°è§£æ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 func (rf *Raft) AppendEntries(req *AppendEntriesReq, resp *AppendEntriesResp) { rf.mu.Lock() defer rf.mu.Unlock() defer rf.persist() defer DPrintf(\u0026#34;[AppendEntries]- {Node: %v}\u0026#39;s state is {state %v, term %v, commitIndex %v, lastApplied %v, firstLog %v, lastLog %v} before processing AppendEntriesRequest %v and reply AppendEntries %v\u0026#34;, rf.me, rf.state, rf.currentTerm, rf.commitIndex, rf.lastApplied, rf.getFirstLog(), rf.getLastLog(), req, resp) // å¦‚æœå‘ç°æ¥è‡ªleaderçš„rpcä¸­çš„termæ¯”å½“å‰peerè¦å°, // è¯´æ˜æ˜¯è¯¥RPC æ¥è‡ªæ—§çš„term(leader)ï¼Œ|| æˆ–è€… å½“å‰leader éœ€è¦æ›´æ–° ä¸å¤„ç† if req.Term \u0026lt; rf.currentTerm { resp.Term, resp.Success = rf.currentTerm, false return } // ä¸€èˆ¬æ¥è®²,åœ¨voteçš„æ—¶å€™å·²ç»å°†currentTermå’ŒleaderåŒæ­¥ // ä¸è¿‡,æœ‰äº›peeræš‚æ—¶çš„æ‰çº¿æˆ–è€…å…¶ä»–ä¸€äº›æƒ…å†µé‡è¿ä»¥å,ä¼šå‘ç°termå’Œleaderä¸ä¸€æ · // ä»¥æ”¶åˆ°å¤§äºè‡ªå·±çš„termçš„rpcä¹Ÿæ˜¯ç¬¬ä¸€æ—¶é—´åŒæ­¥.è€Œä¸”è¦å°†voteforé‡æ–°è®¾ç½®ä¸º-1 // ç­‰å¾…å°†æ¥é€‰ä¸¾ (è¯´æ˜è¿™ä¸ªpeer ä¸æ˜¯ä¹‹å‰election ä¸­æŠ•çš„çš„marjority) if req.Term \u0026gt; rf.currentTerm { rf.currentTerm, rf.votedFor = req.Term, -1 } rf.ChangeState(StateFollower) rf.electionTimer.Reset(RandomizedElectionTimeout()) // PrevLogIndex æ¯”rf å½“å‰çš„ç¬¬ä¸€ä¸ªLog index è¿˜è¦å° if req.PrevLogIndex \u0026lt; rf.getFirstLog().Index { resp.Term, resp.Success = 0, false DPrintf(\u0026#34;[AppendEntries] - {Node: %v} receives unexpected AppendEntriesRequest %v from {Node: %v} because prevLogIndex %v \u0026lt; firstLogIndex %v\u0026#34;, rf.me, req, req.LeaderId, req.PrevLogIndex, rf.getFirstLog().Index) return } if !rf.matchLog(req.PrevLogTerm, req.PrevLogIndex) { // æ—¥å¿—çš„ä¸€è‡´æ€§æ£€æŸ¥å¤±è´¥åï¼Œé€’å½’æ‰¾åˆ°éœ€è¦è¿½åŠ æ—¥å¿—çš„ä½ç½® resp.Term, resp.Success = rf.currentTerm, false lastIndex := rf.getLastLog().Index if lastIndex \u0026lt; req.PrevLogIndex { // lastIndex å’Œ nextIndex[peer] ä¹‹é—´æœ‰ç©ºæ´ scenario3 // follower åœ¨nextIndex[peer] æ²¡æœ‰log resp.ConflictTerm = -1 resp.ConflictIndex = lastIndex + 1 } else { // scenario2, 1 // ä»¥ä»»æœŸä¸ºå•ä½è¿›è¡Œå›é€€ firstIndex := rf.getFirstLog().Index resp.ConflictTerm = rf.logs[req.PrevLogIndex-firstIndex].Term index := req.PrevLogIndex - 1 for index \u0026gt;= firstIndex \u0026amp;\u0026amp; rf.logs[index-firstIndex].Term == resp.ConflictTerm { index-- } resp.ConflictIndex = index } return } firstIndex := rf.getFirstLog().Index for i, entry := range req.Entries { // mergeLog // æ·»åŠ çš„æ—¥å¿—ç´¢å¼•ä½ç½® æ¯”Follower æ—¥å¿—ç›¸åŒ ç›´æ¥æ·»åŠ  æ­¤å¤„ç”¨å¤§äºç­‰äºï¼Œå®é™…åªæœ‰== // || è¦æ·»åŠ çš„æ—¥å¿—ç´¢å¼•ä½ç½®åœ¨ Follower ä¸­çš„ä»»æœŸå’ŒAE RPC ä¸­çš„Term å†²çª if entry.Index-firstIndex \u0026gt;= len(rf.logs) || rf.logs[entry.Index-firstIndex].Term != entry.Term { rf.logs = shrinkEntriesArray(append(rf.logs[:entry.Index-firstIndex], req.Entries[i:]...)) break } } rf.advanceCommitIndexForFollower(req.LeaderComment) resp.Term, resp.Success = rf.currentTerm, true } ","permalink":"https://reid00.github.io/en/posts/storage/mit6.824-2022-raft-lab2b-log-replication/","summary":"æµç¨‹æ¢³ç† ç›¸å…³çš„RPC åœ¨Raft0 ä¸­å·²ç»ä»‹ç», è¿™é‡Œä¸å†èµ˜è¿°ã€‚ å¯åŠ¨çš„Goroutineï¼š\nticker ä¸€ä¸ªï¼Œç”¨äºç›‘å¬ Election Timeout æˆ–è€…Heartbeat Timeout applier ä¸€ä¸ªï¼Œç›‘å¬ leader commit ä¹‹åï¼ŒæŠŠlog å‘é€åˆ°ApplyChï¼Œç„¶åä»applyCh ä¸­æŒä¹…åŒ–åˆ°æœ¬åœ° replicator n-1 ä¸ªï¼Œæ¯ä¸€ä¸ªå¯¹åº”ä¸€ä¸ª peerã€‚ç›‘å¬å¿ƒè·³å¹¿æ’­å‘½ä»¤ï¼Œä»…åœ¨èŠ‚ç‚¹ä¸º Leader æ—¶å·¥ä½œ, å”¤é†’æ¡ä»¶å˜é‡ã€‚æ¥æ”¶åˆ°å‘½ä»¤åï¼Œå‘å¯¹åº”çš„ peer å‘é€ AppendEntries RPCã€‚ æ—¥å¿—ç»“æ„ æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨è‡ªå·±çš„æ—¥å¿—å‰¯æœ¬(log[])ï¼Œæ¯æ¡æ—¥å¿—è®°å½•åŒ…å«ï¼š\nç´¢å¼•ï¼šè¯¥è®°å½•åœ¨æ—¥å¿—ä¸­çš„ä½ç½® ä»»æœŸå·ï¼šè¯¥è®°å½•é¦–æ¬¡è¢«åˆ›å»ºæ—¶çš„ä»»æœŸå· å‘½ä»¤ 1 2 3 4 5 type Entry struct { Index int Term int Command interface{} } æ—¥å¿—ã€Œå·²æäº¤ã€ä¸ã€Œå·²åº”ç”¨ã€æ¦‚å¿µï¼š\nå·²æäº¤ï¼šcommitted, æ•°æ®åœ¨æœ¬åœ°raft æ—¥å¿—ä¸­è®°å½•ï¼Œæ²¡æœ‰åº”ç”¨åˆ°çŠ¶æ€æœº å·²åº”ç”¨ï¼šçœŸæ­£çš„æ•°æ®å˜åŒ–ã€‚æäº¤åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¹‹åï¼Œåº”ç”¨åˆ°å„è‡ªæœ¬åœ°çš„çŠ¶æ€æœºä¸­ã€‚ å·²æäº¤çš„æ—¥å¿—è¢«åº”ç”¨åæ‰ä¼šç”Ÿæ•ˆ\næ—¥å¿—åŒæ­¥ï¼š æ—¥å¿—åŒæ­¥æ˜¯Leaderç‹¬æœ‰çš„æƒåˆ©ï¼ŒLeaderå‘Followerå‘é€æ—¥å¿—ï¼ŒFolloweråŒæ­¥æ—¥å¿—ã€‚\næ—¥å¿—åŒæ­¥è¦è§£å†³å¦‚ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š\nLeaderå‘é€å¿ƒè·³å®£ç¤ºè‡ªå·±çš„ä¸»æƒï¼ŒFollowerä¸ä¼šå‘èµ·é€‰ä¸¾ã€‚ Leaderå°†è‡ªå·±çš„æ—¥å¿—æ•°æ®åŒæ­¥åˆ°Followerï¼Œè¾¾åˆ°æ•°æ®å¤‡ä»½çš„æ•ˆæœã€‚ è¿è¡Œæµç¨‹ å®¢æˆ·ç«¯å‘ Leader å‘é€å‘½ä»¤ï¼Œå¸Œæœ›è¯¥å‘½ä»¤è¢«æ‰€æœ‰çŠ¶æ€æœºæ‰§è¡Œï¼›\nLeader å…ˆå°†è¯¥å‘½ä»¤è¿½åŠ åˆ°è‡ªå·±çš„æ—¥å¿—ä¸­ï¼› Leader å¹¶è¡Œåœ°å‘å…¶å®ƒèŠ‚ç‚¹å‘é€ AppendEntries RPCï¼Œç­‰å¾…å“åº”ï¼› æ”¶åˆ°è¶…è¿‡åŠæ•°èŠ‚ç‚¹çš„å“åº”ï¼Œåˆ™è®¤ä¸ºæ–°çš„æ—¥å¿—è®°å½•æ˜¯è¢«æäº¤çš„ï¼š Leader å°†å‘½ä»¤ä¼ ç»™è‡ªå·±çš„çŠ¶æ€æœºï¼Œç„¶åå‘å®¢æˆ·ç«¯è¿”å›å“åº” ä¸€æ—¦ Leader çŸ¥é“ä¸€æ¡è®°å½•è¢«æäº¤äº†ï¼Œå°†åœ¨åç»­çš„ AppendEntries RPC ä¸­é€šçŸ¥å·²ç»æäº¤è®°å½•çš„ Followers Follower å°†å·²æäº¤çš„å‘½ä»¤ä¼ ç»™è‡ªå·±çš„çŠ¶æ€æœº å¦‚æœ Follower å®•æœº/è¶…æ—¶ï¼šLeader å°†åå¤å°è¯•å‘é€ RPCï¼› æ€§èƒ½ä¼˜åŒ–ï¼šLeader ä¸å¿…ç­‰å¾…æ¯ä¸ª Follower åšå‡ºå“åº”ï¼Œåªéœ€è¦è¶…è¿‡åŠæ•°çš„æˆåŠŸå“åº”ï¼ˆç¡®ä¿æ—¥å¿—è®°å½•å·²ç»å­˜å‚¨åœ¨è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹ä¸Šï¼‰â€”â€”ä¸€ä¸ªå¾ˆæ…¢çš„èŠ‚ç‚¹ä¸ä¼šä½¿ç³»ç»Ÿå˜æ…¢ï¼Œå› ä¸º Leader ä¸å¿…ç­‰ä»–ï¼›","title":"MIT6.824 2022 Raft Lab2B Log Replication"},{"content":"ä»‹ç» Go è¯­è¨€æ²¡æœ‰æ„é€ å‡½æ•°ï¼Œä¸€èˆ¬é€šè¿‡å®šä¹‰ New å‡½æ•°æ¥å……å½“æ„é€ å‡½æ•°ã€‚ç„¶è€Œï¼Œå¦‚æœç»“æ„æœ‰è¾ƒå¤šå­—æ®µï¼Œè¦åˆå§‹åŒ–è¿™äº›å­—æ®µï¼Œæœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œä½†æœ‰ä¸€ç§æ–¹å¼è®¤ä¸ºæ˜¯æœ€å¥½çš„ï¼Œè¿™å°±æ˜¯å‡½æ•°å¼é€‰é¡¹æ¨¡å¼ï¼ˆFunctional Options Patternï¼‰ã€‚\nå‡½æ•°å¼é€‰é¡¹æ¨¡å¼æ˜¯ä¸€ç§åœ¨ Go ä¸­æ„é€ ç»“æ„ä½“çš„æ¨¡å¼ï¼Œå®ƒé€šè¿‡è®¾è®¡ä¸€ç»„éå¸¸æœ‰è¡¨ç°åŠ›å’Œçµæ´»çš„ API æ¥å¸®åŠ©é…ç½®å’Œåˆå§‹åŒ–ç»“æ„ä½“ã€‚\nåœ¨ Uber çš„ Go è¯­è¨€è§„èŒƒ ä¸­æåˆ°äº†è¯¥æ¨¡å¼ï¼š\nFunctional options æ˜¯ä¸€ç§æ¨¡å¼ï¼Œåœ¨è¯¥æ¨¡å¼ä¸­ï¼Œä½ å¯ä»¥å£°æ˜ä¸€ä¸ªä¸é€æ˜çš„ Option ç±»å‹ï¼Œè¯¥ç±»å‹åœ¨æŸäº›å†…éƒ¨ç»“æ„ä¸­è®°å½•ä¿¡æ¯ã€‚ä½ æ¥å—è¿™äº›å¯å˜æ•°é‡çš„é€‰é¡¹ï¼Œå¹¶æ ¹æ®å†…éƒ¨ç»“æ„ä¸Šçš„é€‰é¡¹è®°å½•çš„å®Œæ•´ä¿¡æ¯è¿›è¡Œæ“ä½œã€‚ å°†æ­¤æ¨¡å¼ç”¨äºæ„é€ å‡½æ•°å’Œå…¶ä»–å…¬å…± API ä¸­çš„å¯é€‰å‚æ•°ï¼Œä½ é¢„è®¡è¿™äº›å‚æ•°éœ€è¦æ‰©å±•ï¼Œå°¤å…¶æ˜¯åœ¨è¿™äº›å‡½æ•°ä¸Šå·²ç»æœ‰ä¸‰ä¸ªæˆ–æ›´å¤šå‚æ•°çš„æƒ…å†µä¸‹ã€‚\nDemo ä¸ºäº†æ›´å¥½çš„ç†è§£è¯¥æ¨¡å¼ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è®²è§£ã€‚\nå®šä¹‰ä¸€ä¸ª Server ç»“æ„ä½“\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 package main type Server struct { host string port int } func New(host string, port int) *Server { return \u0026amp;Server{host, port} } func (s *Server) Start() error { } ä½¿ç”¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 package main import ( \u0026#34;log\u0026#34; \u0026#34;server\u0026#34; ) func main() { svr := New(\u0026#34;localhost\u0026#34;, 1234) if err := svr.Start(); err != nil { log.Fatal(err) } } ä½†å¦‚æœè¦æ‰©å±• Server çš„é…ç½®é€‰é¡¹ï¼Œå¦‚ä½•åšï¼Ÿé€šå¸¸æœ‰ä¸‰ç§åšæ³•ï¼š\nä¸ºæ¯ä¸ªä¸åŒçš„é…ç½®é€‰é¡¹å£°æ˜ä¸€ä¸ªæ–°çš„æ„é€ å‡½æ•° å®šä¹‰ä¸€ä¸ªæ–°çš„ Config ç»“æ„ä½“æ¥ä¿å­˜é…ç½®ä¿¡æ¯ ä½¿ç”¨ Functional Option Pattern åšæ³• 1ï¼šä¸ºæ¯ä¸ªä¸åŒçš„é…ç½®é€‰é¡¹å£°æ˜ä¸€ä¸ªæ–°çš„æ„é€ å‡½æ•° 1 2 3 4 5 6 type Server struct { host string port int timeout time.Duration maxConn int } ä¸€èˆ¬æ¥è¯´ï¼Œhost å’Œ port æ˜¯å¿…é¡»çš„å­—æ®µï¼Œè€Œ timeout å’Œ maxConn æ˜¯å¯é€‰çš„ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥ä¿ç•™åŸæ¥çš„æ„é€ å‡½æ•°ï¼Œè€Œè¿™ä¸¤ä¸ªå­—æ®µç»™é»˜è®¤å€¼ï¼š\n1 2 3 func New(host string, port int) *Server { return \u0026amp;Server{host, port, time.Minute, 100} } ç„¶åé’ˆå¯¹ timeout å’Œ maxConn é¢å¤–æä¾›ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼š\n1 2 3 4 5 6 7 func NewWithTimeout(host string, port int, timeout time.Duration) *Server { return \u0026amp;Server{host, port, timeout} } func NewWithTimeoutAndMaxConn(host string, port int, timeout time.Duration, maxConn int) *Server { return \u0026amp;Server{host, port, timeout, maxConn} } è¿™ç§æ–¹å¼é…ç½®è¾ƒå°‘ä¸”ä¸å¤ªä¼šå˜åŒ–çš„æƒ…å†µï¼Œå¦åˆ™æ¯æ¬¡ä½ éœ€è¦ä¸ºæ–°é…ç½®åˆ›å»ºæ–°çš„æ„é€ å‡½æ•°ã€‚åœ¨ Go è¯­è¨€æ ‡å‡†åº“ä¸­ï¼Œæœ‰è¿™ç§æ–¹å¼çš„åº”ç”¨ã€‚æ¯”å¦‚ net åŒ…ä¸­çš„ Dial å’Œ DialTimeoutï¼š\n1 2 func Dial(network, address string) (Conn, error) func DialTimeout(network, address string, timeout time.Duration) (Conn, error) åšæ³• 2ï¼šä½¿ç”¨ä¸“é—¨çš„é…ç½®ç»“æ„ä½“ è¿™ç§æ–¹å¼ä¹Ÿæ˜¯å¾ˆå¸¸è§çš„ï¼Œç‰¹åˆ«æ˜¯å½“é…ç½®é€‰é¡¹å¾ˆå¤šæ—¶ã€‚é€šå¸¸å¯ä»¥åˆ›å»ºä¸€ä¸ª Config ç»“æ„ä½“ï¼Œå…¶ä¸­åŒ…å« Server çš„æ‰€æœ‰é…ç½®é€‰é¡¹ã€‚è¿™ç§åšæ³•ï¼Œå³ä½¿å°†æ¥å¢åŠ æ›´å¤šé…ç½®é€‰é¡¹ï¼Œä¹Ÿå¯ä»¥è½»æ¾çš„å®Œæˆæ‰©å±•ï¼Œä¸ä¼šç ´å Server çš„ APIã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 type Server struct { cfg Config } type Config struct { Host string Port int Timeout time.Duration MaxConn int } func New(cfg Config) *Server { return \u0026amp;Server{cfg} } åœ¨ä½¿ç”¨æ—¶ï¼Œéœ€è¦å…ˆæ„é€  Config å®ä¾‹ï¼Œå¯¹è¿™ä¸ªå®ä¾‹ï¼Œåˆå›åˆ°äº†å‰é¢ Server çš„é—®é¢˜ä¸Šï¼Œå› ä¸ºå¢åŠ æˆ–åˆ é™¤é€‰é¡¹ï¼Œéœ€è¦å¯¹ Config æœ‰è¾ƒå¤§çš„ä¿®æ”¹ã€‚å¦‚æœå°† Config ä¸­çš„å­—æ®µæ”¹ä¸ºç§æœ‰ï¼Œå¯èƒ½éœ€è¦å®šä¹‰ Config çš„æ„é€ å‡½æ•°ã€‚ã€‚ã€‚\nåšæ³• 3ï¼šä½¿ç”¨ Functional Option Pattern ä¸€ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ Functional Option Patternã€‚\nåœ¨è¿™ä¸ªæ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª Option å‡½æ•°ç±»å‹ï¼š\n1 type Option func(*Server) Option ç±»å‹æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼š*Serverã€‚ç„¶åï¼ŒServer çš„æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ª Option ç±»å‹çš„ä¸å®šå‚æ•°ï¼š\n1 2 3 4 5 6 7 func New(options ...Option) *Server { svr := \u0026amp;Server{} for _, f := range options { f(svr) } return svr } é‚£é€‰é¡¹å¦‚ä½•èµ·ä½œç”¨ï¼Ÿéœ€è¦å®šä¹‰ä¸€ç³»åˆ—ç›¸å…³è¿”å› Option çš„å‡½æ•°ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 func WithHost(host string) Option { return func(s *Server) { s.host = host } } func WithPort(port int) Option { return func(s *Server) { s.port = port } } func WithTimeout(timeout time.Duration) Option { return func(s *Server) { s.timeout = timeout } } func WithMaxConn(maxConn int) Option { return func(s *Server) { s.maxConn = maxConn } } é’ˆå¯¹è¿™ç§æ¨¡å¼ï¼Œå®¢æˆ·ç«¯ç±»ä¼¼è¿™ä¹ˆä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 package main import ( \u0026#34;log\u0026#34; \u0026#34;server\u0026#34; ) func main() { svr := New( WithHost(\u0026#34;localhost\u0026#34;), WithPort(8080), WithTimeout(time.Minute), WithMaxConn(120), ) if err := svr.Start(); err != nil { log.Fatal(err) } } å°†æ¥å¢åŠ é€‰é¡¹ï¼Œåªéœ€è¦å¢åŠ å¯¹åº”çš„ WithXXX å‡½æ•°å³å¯ã€‚\nè¿™ç§æ¨¡å¼ï¼Œåœ¨ç¬¬ä¸‰æ–¹åº“ä¸­ä½¿ç”¨æŒºå¤šï¼Œæ¯”å¦‚ github.com/gocolly/collyï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 type Collector { // çœç•¥... } func NewCollector(options ...CollectorOption) *Collector // å®šä¹‰äº†ä¸€ç³»åˆ— CollectorOpiton type CollectorOption{ // çœç•¥... } func AllowURLRevisit() CollectorOption func AllowedDomains(domains ...string) CollectorOption ... ä¸è¿‡ Uber çš„ Go è¯­è¨€ç¼–ç¨‹è§„èŒƒä¸­æåˆ°è¯¥æ¨¡å¼æ—¶ï¼Œå»ºè®®å®šä¹‰ä¸€ä¸ª Option æ¥å£ï¼Œè€Œä¸æ˜¯ Option å‡½æ•°ç±»å‹ã€‚è¯¥ Option æ¥å£æœ‰ä¸€ä¸ªæœªå¯¼å‡ºçš„æ–¹æ³•ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªæœªå¯¼å‡ºçš„ options ç»“æ„æ¥è®°å½•å„é€‰é¡¹ã€‚\nOption Interface 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 // éœ€è¦æ·»åŠ çš„é…ç½®å‚æ•°å­—æ®µæ”¾åˆ°options field ä¸­ type options struct { cache bool logger *zap.Logger } type Option interface { apply(*options) } // æ–°å®šä¹‰ä¸€ä¸ªç±»å‹ï¼Œç”¨æ¥é‡ç½®options é‡Œé¢å¯¹åº”çš„å­—æ®µ type cacheOption bool // apply å°†ç±»å‹c çš„å€¼ï¼Œèµ‹ç»™options å¯¹åº”çš„field func (c cacheOption) apply(opts *options) { opts.cache = bool(c) } // withå¼€å¤´æ–°å»ºä¸€ä¸ª ä¸Šé¢å®šä¹‰çš„ç±»å‹ func WithCache(c bool) Option { return cacheOption(c) } // æ–°å®šä¹‰çš„ç±»å‹ä¸­ï¼ŒåŒ…å«äº†éœ€è¦é‡ä¸­options çš„logger field type loggerOption struct { Log *zap.Logger } // apply å°†æ–°ç±»å‹çš„Log field ç»™options çš„å¯¹åº”field func (l loggerOption) apply(opts *options) { opts.logger = l.Log } // withå¼€å¤´æ–°å»ºä¸€ä¸ª ä¸Šé¢å®šä¹‰çš„ç±»å‹ func WithLogger(log *zap.Logger) Option { return loggerOption{Log: log} } // Open creates a connection. func Open(addr string, opts ...Option) (*Connection, error) { // æ–°å»ºä¸€ä¸ªoptions çš„é…ç½®ç±»å‹ options := options{ cache: defaultCache, logger: zap.NewNop(), } // éå†Option æ¥å£ç±»å‹ï¼Œè°ƒç”¨apply æ–¹æ³•ï¼Œå°†oçš„field èµ‹å€¼ç»™options é…ç½® for _, o := range opts { o.apply(\u0026amp;options) } // ... } ","permalink":"https://reid00.github.io/en/posts/langs_linux/go-function-option-%E5%87%BD%E6%95%B0%E9%80%89%E9%A1%B9%E6%A8%A1%E5%BC%8F/","summary":"ä»‹ç» Go è¯­è¨€æ²¡æœ‰æ„é€ å‡½æ•°ï¼Œä¸€èˆ¬é€šè¿‡å®šä¹‰ New å‡½æ•°æ¥å……å½“æ„é€ å‡½æ•°ã€‚ç„¶è€Œï¼Œå¦‚æœç»“æ„æœ‰è¾ƒå¤šå­—æ®µï¼Œè¦åˆå§‹åŒ–è¿™äº›å­—æ®µï¼Œæœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œä½†æœ‰ä¸€ç§æ–¹å¼è®¤ä¸ºæ˜¯æœ€å¥½çš„ï¼Œè¿™å°±æ˜¯å‡½æ•°å¼é€‰é¡¹æ¨¡å¼ï¼ˆFunctional Options Patternï¼‰ã€‚\nå‡½æ•°å¼é€‰é¡¹æ¨¡å¼æ˜¯ä¸€ç§åœ¨ Go ä¸­æ„é€ ç»“æ„ä½“çš„æ¨¡å¼ï¼Œå®ƒé€šè¿‡è®¾è®¡ä¸€ç»„éå¸¸æœ‰è¡¨ç°åŠ›å’Œçµæ´»çš„ API æ¥å¸®åŠ©é…ç½®å’Œåˆå§‹åŒ–ç»“æ„ä½“ã€‚\nåœ¨ Uber çš„ Go è¯­è¨€è§„èŒƒ ä¸­æåˆ°äº†è¯¥æ¨¡å¼ï¼š\nFunctional options æ˜¯ä¸€ç§æ¨¡å¼ï¼Œåœ¨è¯¥æ¨¡å¼ä¸­ï¼Œä½ å¯ä»¥å£°æ˜ä¸€ä¸ªä¸é€æ˜çš„ Option ç±»å‹ï¼Œè¯¥ç±»å‹åœ¨æŸäº›å†…éƒ¨ç»“æ„ä¸­è®°å½•ä¿¡æ¯ã€‚ä½ æ¥å—è¿™äº›å¯å˜æ•°é‡çš„é€‰é¡¹ï¼Œå¹¶æ ¹æ®å†…éƒ¨ç»“æ„ä¸Šçš„é€‰é¡¹è®°å½•çš„å®Œæ•´ä¿¡æ¯è¿›è¡Œæ“ä½œã€‚ å°†æ­¤æ¨¡å¼ç”¨äºæ„é€ å‡½æ•°å’Œå…¶ä»–å…¬å…± API ä¸­çš„å¯é€‰å‚æ•°ï¼Œä½ é¢„è®¡è¿™äº›å‚æ•°éœ€è¦æ‰©å±•ï¼Œå°¤å…¶æ˜¯åœ¨è¿™äº›å‡½æ•°ä¸Šå·²ç»æœ‰ä¸‰ä¸ªæˆ–æ›´å¤šå‚æ•°çš„æƒ…å†µä¸‹ã€‚\nDemo ä¸ºäº†æ›´å¥½çš„ç†è§£è¯¥æ¨¡å¼ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è®²è§£ã€‚\nå®šä¹‰ä¸€ä¸ª Server ç»“æ„ä½“\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 package main type Server struct { host string port int } func New(host string, port int) *Server { return \u0026amp;Server{host, port} } func (s *Server) Start() error { } ä½¿ç”¨","title":"Go Function Option å‡½æ•°é€‰é¡¹æ¨¡å¼"},{"content":"ä»‹ç» Joinå¤§è‡´åŒ…æ‹¬ä¸‰ä¸ªè¦ç´ ï¼šJoinæ–¹å¼ã€Joinæ¡ä»¶ä»¥åŠè¿‡æ»¤æ¡ä»¶ã€‚å…¶ä¸­è¿‡æ»¤æ¡ä»¶ä¹Ÿå¯ä»¥é€šè¿‡ANDè¯­å¥æ”¾åœ¨Joinæ¡ä»¶ä¸­ã€‚ Sparkæ”¯æŒçš„Join åŒ…æ‹¬:\ninner join left outer join right outer join full outer join left semi join left anti join Join çš„åŸºæœ¬æµç¨‹ æ€»ä½“ä¸Šæ¥è¯´ï¼ŒJoinçš„åŸºæœ¬å®ç°æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒSparkå°†å‚ä¸Joinçš„ä¸¤å¼ è¡¨æŠ½è±¡ä¸ºæµå¼éå†è¡¨(streamIter)å’ŒæŸ¥æ‰¾è¡¨(buildIter)ï¼Œé€šå¸¸streamIterä¸ºå¤§è¡¨ï¼ŒbuildIterä¸ºå°è¡¨ï¼Œæˆ‘ä»¬ä¸ç”¨æ‹…å¿ƒå“ªä¸ªè¡¨ä¸ºstreamIterï¼Œå“ªä¸ªè¡¨ä¸ºbuildIterï¼Œè¿™ä¸ªsparkä¼šæ ¹æ®joinè¯­å¥è‡ªåŠ¨å¸®æˆ‘ä»¬å®Œæˆã€‚ åœ¨å®é™…è®¡ç®—æ—¶ï¼Œsparkä¼šåŸºäºstreamIteræ¥éå†ï¼Œæ¯æ¬¡å–å‡ºstreamIterä¸­çš„ä¸€æ¡è®°å½•rowAï¼Œæ ¹æ®Joinæ¡ä»¶è®¡ç®—keyAï¼Œç„¶åæ ¹æ®è¯¥keyAå»buildIterä¸­æŸ¥æ‰¾æ‰€æœ‰æ»¡è¶³Joinæ¡ä»¶(keyB==keyA)çš„è®°å½•rowBsï¼Œå¹¶å°†rowBsä¸­æ¯æ¡è®°å½•åˆ†åˆ«ä¸rowAjoinå¾—åˆ°joinåçš„è®°å½•ï¼Œæœ€åæ ¹æ®è¿‡æ»¤æ¡ä»¶å¾—åˆ°æœ€ç»ˆjoinçš„è®°å½•ã€‚\nä»ä¸Šè¿°è®¡ç®—è¿‡ç¨‹ä¸­ä¸éš¾å‘ç°ï¼Œå¯¹äºæ¯æ¡æ¥è‡ªstreamIterçš„è®°å½•ï¼Œéƒ½è¦å»buildIterä¸­æŸ¥æ‰¾åŒ¹é…çš„è®°å½•ï¼Œæ‰€ä»¥buildIterä¸€å®šè¦æ˜¯æŸ¥æ‰¾æ€§èƒ½è¾ƒä¼˜çš„æ•°æ®ç»“æ„ å¦‚Hash Tableã€‚sparkæä¾›äº†ä¸‰ç§joinå®ç°ï¼šsort merge joinã€broadcast joinä»¥åŠhash joinã€‚\nHash joinå®ç° sparkæä¾›äº†hash joinå®ç°æ–¹å¼ï¼Œåœ¨shuffle readé˜¶æ®µä¸å¯¹è®°å½•æ’åºï¼Œåæ­£æ¥è‡ªä¸¤æ ¼è¡¨çš„å…·æœ‰ç›¸åŒkeyçš„è®°å½•ä¼šåœ¨åŒä¸€ä¸ªåˆ†åŒºï¼Œåªæ˜¯åœ¨åˆ†åŒºå†…ä¸æ’åºï¼Œå°†æ¥è‡ªbuildIterçš„è®°å½•æ”¾åˆ°hashè¡¨ä¸­ï¼Œä»¥ä¾¿æŸ¥æ‰¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\nç”±äºSparkæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„è®¡ç®—å¼•æ“ï¼Œå¯ä»¥é€šè¿‡åˆ†åŒºçš„å½¢å¼å°†å¤§æ‰¹é‡çš„æ•°æ®åˆ’åˆ†æˆnä»½è¾ƒå°çš„æ•°æ®é›†è¿›è¡Œå¹¶è¡Œè®¡ç®—ã€‚è¿™ç§æ€æƒ³åº”ç”¨åˆ°Joinä¸Šä¾¿æ˜¯Shuffle Hash Joinäº†ã€‚åˆ©ç”¨keyç›¸åŒå¿…ç„¶åˆ†åŒºç›¸åŒçš„è¿™ä¸ªåŸç†ï¼ŒSparkSQLå°†è¾ƒå¤§è¡¨çš„joinåˆ†è€Œæ²»ä¹‹ï¼Œå…ˆå°†è¡¨åˆ’åˆ†æˆnä¸ªåˆ†åŒºï¼Œåœ¨å¯¹buildlteræŸ¥æ‰¾è¡¨å’Œstreamlterè¡¨è¿›è¡ŒHash Joinã€‚ Shuffle Hash Joinåˆ†ä¸ºä¸¤æ­¥ï¼š å¯¹ä¸¤å¼ è¡¨åˆ†åˆ«æŒ‰ç…§join keysè¿›è¡Œé‡åˆ†åŒºï¼Œå³shuffleï¼Œç›®çš„æ˜¯ä¸ºäº†è®©æœ‰ç›¸åŒjoin keyså€¼çš„è®°å½•åˆ†åˆ°å¯¹åº”çš„åˆ†åŒºä¸­ å¯¹ å¯¹åº”åˆ†åŒºä¸­çš„æ•°æ®è¿›è¡Œjoinï¼Œæ­¤å¤„å…ˆå°†å°è¡¨åˆ†åŒºæ„é€ ä¸ºä¸€å¼ hashè¡¨ï¼Œç„¶åæ ¹æ®å¤§è¡¨åˆ†åŒºä¸­è®°å½•çš„join keyså€¼æ‹¿å‡ºæ¥è¿›è¡ŒåŒ¹é… ä¸éš¾å‘ç°ï¼Œè¦å°†æ¥è‡ªbuildIterçš„è®°å½•æ”¾åˆ°hashè¡¨ä¸­ï¼Œé‚£ä¹ˆæ¯ä¸ªåˆ†åŒºæ¥è‡ªbuildIterçš„è®°å½•ä¸èƒ½å¤ªå¤§ï¼Œå¦åˆ™å°±å­˜ä¸ä¸‹ï¼Œé»˜è®¤æƒ…å†µä¸‹hash joinçš„å®ç°æ˜¯å…³é—­çŠ¶æ€ï¼Œå¦‚æœè¦ä½¿ç”¨hash joinï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶ï¼š\nbuildIteræ€»ä½“ä¼°è®¡å¤§å°è¶…è¿‡spark.sql.autoBroadcastJoinThresholdè®¾å®šçš„å€¼ï¼Œå³ä¸æ»¡è¶³broadcast joinæ¡ä»¶ å¼€å¯å°è¯•ä½¿ç”¨hash joinçš„å¼€å…³ï¼Œspark.sql.join.preferSortMergeJoin=false æ¯ä¸ªåˆ†åŒºçš„å¹³å‡å¤§å°ä¸è¶…è¿‡spark.sql.autoBroadcastJoinThresholdè®¾å®šçš„å€¼ï¼Œå³shuffle readé˜¶æ®µæ¯ä¸ªåˆ†åŒºæ¥è‡ªbuildIterçš„è®°å½•è¦èƒ½æ”¾åˆ°å†…å­˜ä¸­ streamIterçš„å¤§å°æ˜¯buildIterä¸‰å€ä»¥ä¸Š Sort Merge Join å®ç° ä¸Šé¢ä»‹ç»çš„å®ç°å¯¹äºä¸€å®šå¤§å°çš„è¡¨æ¯”è¾ƒé€‚ç”¨ï¼Œä½†å½“ä¸¤ä¸ªè¡¨éƒ½éå¸¸å¤§æ—¶ï¼Œæ˜¾ç„¶æ— è®ºé€‚ç”¨å“ªç§éƒ½ä¼šå¯¹è®¡ç®—å†…å­˜é€ æˆå¾ˆå¤§å‹åŠ›ã€‚è¿™æ˜¯å› ä¸ºjoinæ—¶ä¸¤è€…é‡‡å–çš„éƒ½æ˜¯hash joinï¼Œæ˜¯å°†ä¸€ä¾§çš„æ•°æ®å®Œå…¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä½¿ç”¨hash codeå–join keyså€¼ç›¸ç­‰çš„è®°å½•è¿›è¡Œè¿æ¥ã€‚\nè¦è®©ä¸¤æ¡è®°å½•èƒ½joinåˆ°ä¸€èµ·ï¼Œé¦–å…ˆéœ€è¦å°†å…·æœ‰ç›¸åŒkeyçš„è®°å½•åœ¨åŒä¸€ä¸ªåˆ†åŒºï¼Œæ‰€ä»¥é€šå¸¸æ¥è¯´ï¼Œéœ€è¦åšä¸€æ¬¡shuffleï¼Œmapé˜¶æ®µæ ¹æ®joinæ¡ä»¶ç¡®å®šæ¯æ¡è®°å½•çš„keyï¼ŒåŸºäºè¯¥keyåšshuffle writeï¼Œå°†å¯èƒ½joinåˆ°ä¸€èµ·çš„è®°å½•åˆ†åˆ°åŒä¸€ä¸ªåˆ†åŒºä¸­ï¼Œè¿™æ ·åœ¨shuffle readé˜¶æ®µå°±å¯ä»¥å°†ä¸¤ä¸ªè¡¨ä¸­å…·æœ‰ç›¸åŒkeyçš„è®°å½•æ‹‰åˆ°åŒä¸€ä¸ªåˆ†åŒºå¤„ç†ã€‚å‰é¢æˆ‘ä»¬ä¹Ÿæåˆ°ï¼Œå¯¹äºbuildIterä¸€å®šè¦æ˜¯æŸ¥æ‰¾æ€§èƒ½è¾ƒä¼˜çš„æ•°æ®ç»“æ„ï¼Œé€šå¸¸æˆ‘ä»¬èƒ½æƒ³åˆ°hashè¡¨ï¼Œä½†æ˜¯å¯¹äºä¸€å¼ è¾ƒå¤§çš„è¡¨æ¥è¯´ï¼Œä¸å¯èƒ½å°†æ‰€æœ‰è®°å½•å…¨éƒ¨æ”¾åˆ°hashè¡¨ä¸­ï¼ŒSparkSQLé‡‡ç”¨äº†ä¸€ç§å…¨æ–°çš„æ–¹æ¡ˆæ¥å¯¹è¡¨è¿›è¡ŒJoinï¼Œå³Sort Merge Joinã€‚è¿™ç§å®ç°æ–¹å¼ä¸ç”¨å°†ä¸€ä¾§æ•°æ®å…¨éƒ¨åŠ è½½åå†è¿›è¡Œhash joinï¼Œä½†éœ€è¦åœ¨joinå‰å°†æ•°æ®æ’åºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸‰ä¸ªæ­¥éª¤: shuffleé˜¶æ®µï¼šæˆ–è€…è¯´shuffle write é˜¶æ®µï¼Œå°†ä¸¤å¼ å¤§è¡¨æ ¹æ®join keyè¿›è¡Œé‡æ–°åˆ†åŒºï¼Œä¸¤å¼ è¡¨æ•°æ®ä¼šåˆ†å¸ƒåˆ°æ•´ä¸ªé›†ç¾¤ï¼Œä»¥ä¾¿åˆ†å¸ƒå¼å¹¶è¡Œå¤„ç† sorté˜¶æ®µï¼šå¯¹å•ä¸ªåˆ†åŒºèŠ‚ç‚¹çš„ä¸¤è¡¨æ•°æ®ï¼Œåˆ†åˆ«è¿›è¡Œæ’åº mergeé˜¶æ®µï¼šæˆ–è€…è¯´shuffle read é˜¶æ®µï¼Œå¯¹æ’å¥½åºçš„ä¸¤å¼ åˆ†åŒºè¡¨æ•°æ®æ‰§è¡Œjoinæ“ä½œã€‚joinæ“ä½œå¾ˆç®€å•ï¼Œåˆ†åˆ«éå†ä¸¤ä¸ªæœ‰åºåºåˆ—ï¼Œç¢°åˆ°ç›¸åŒjoin keyå°±mergeè¾“å‡ºï¼Œå¦åˆ™å–æ›´å°ä¸€è¾¹\nåœ¨shuffle readé˜¶æ®µï¼Œåˆ†åˆ«å¯¹streamIterå’ŒbuildIterè¿›è¡Œmerge sortï¼Œåœ¨éå†streamIteræ—¶ï¼Œå¯¹äºæ¯æ¡è®°å½•ï¼Œéƒ½é‡‡ç”¨é¡ºåºæŸ¥æ‰¾çš„æ–¹å¼ä»buildIteræŸ¥æ‰¾å¯¹åº”çš„è®°å½•ï¼Œç”±äºä¸¤ä¸ªè¡¨éƒ½æ˜¯æ’åºçš„ï¼Œæ¯æ¬¡å¤„ç†å®ŒstreamIterçš„ä¸€æ¡è®°å½•åï¼Œå¯¹äºstreamIterçš„ä¸‹ä¸€æ¡è®°å½•ï¼Œåªéœ€ä»buildIterä¸­ä¸Šä¸€æ¬¡æŸ¥æ‰¾ç»“æŸçš„ä½ç½®å¼€å§‹æŸ¥æ‰¾ï¼Œæ‰€ä»¥è¯´æ¯æ¬¡åœ¨buildIterä¸­æŸ¥æ‰¾ä¸å¿…é‡å¤´å¼€å§‹ï¼Œæ•´ä½“ä¸Šæ¥è¯´ï¼ŒæŸ¥æ‰¾æ€§èƒ½è¿˜æ˜¯è¾ƒä¼˜çš„ã€‚\nä»”ç»†åˆ†æçš„è¯ä¼šå‘ç°ï¼Œsort-merge joinçš„ä»£ä»·å¹¶ä¸æ¯”shuffle hash joinå°ï¼Œåè€Œæ˜¯å¤šäº†å¾ˆå¤šã€‚é‚£ä¸ºä»€ä¹ˆSparkSQLè¿˜ä¼šåœ¨ä¸¤å¼ å¤§è¡¨çš„åœºæ™¯ä¸‹é€‰æ‹©ä½¿ç”¨sort-merge joinç®—æ³•å‘¢ï¼Ÿè¿™å’ŒSparkçš„shuffleå®ç°æœ‰å…³ï¼Œç›®å‰sparkçš„shuffleå®ç°éƒ½é€‚ç”¨sort-based shuffleç®—æ³•ï¼Œå› æ­¤åœ¨ç»è¿‡shuffleä¹‹åpartitionæ•°æ®éƒ½æ˜¯æŒ‰ç…§keyæ’åºçš„ã€‚å› æ­¤ç†è®ºä¸Šå¯ä»¥è®¤ä¸ºæ•°æ®ç»è¿‡shuffleä¹‹åæ˜¯ä¸éœ€è¦sortçš„ï¼Œå¯ä»¥ç›´æ¥mergeã€‚\nBroadcast Joinå®ç° ä¸ºäº†èƒ½å…·æœ‰ç›¸åŒkeyçš„è®°å½•åˆ†åˆ°åŒä¸€ä¸ªåˆ†åŒºï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯åšshuffleï¼Œè€Œshuffleåœ¨Sparkä¸­æ˜¯æ¯”è¾ƒè€—æ—¶çš„æ“ä½œï¼Œæˆ‘ä»¬åº”è¯¥å°½å¯èƒ½çš„è®¾è®¡Sparkåº”ç”¨ä½¿å…¶é¿å…å¤§é‡çš„shuffleã€‚ã€‚é‚£ä¹ˆå¦‚æœbuildIteræ˜¯ä¸€ä¸ªéå¸¸å°çš„è¡¨ï¼Œé‚£ä¹ˆå…¶å®å°±æ²¡æœ‰å¿…è¦å¤§åŠ¨å¹²æˆˆåšshuffleäº†ï¼Œç›´æ¥å°†buildIterå¹¿æ’­åˆ°æ¯ä¸ªè®¡ç®—èŠ‚ç‚¹ï¼Œç„¶åå°†buildIteræ”¾åˆ°hashè¡¨ä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ åœ¨æ‰§è¡Œä¸Šï¼Œä¸»è¦å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸¤æ­¥ï¼š\nbroadcasté˜¶æ®µï¼šå°†å°è¡¨å¹¿æ’­åˆ†å‘åˆ°å¤§è¡¨æ‰€åœ¨çš„æ‰€æœ‰ä¸»æœºã€‚åˆ†å‘æ–¹å¼å¯ä»¥æœ‰driveråˆ†å‘ï¼Œæˆ–è€…é‡‡ç”¨p2pæ–¹å¼ã€‚ hash joiné˜¶æ®µï¼šåœ¨æ¯ä¸ªexecutorä¸Šæ‰§è¡Œå•æœºç‰ˆhash joinï¼Œå°è¡¨æ˜ å°„ï¼Œå¤§è¡¨è¯•æ¢ï¼› Broadcast Joinçš„æ¡ä»¶æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š\nè¢«å¹¿æ’­çš„è¡¨éœ€è¦å°äºspark.sql.autoBroadcastJoinThresholdæ‰€é…ç½®çš„å€¼ï¼Œé»˜è®¤æ˜¯10M ï¼ˆæˆ–è€…åŠ äº†broadcast joinçš„hintï¼‰ åŸºè¡¨ä¸èƒ½è¢«å¹¿æ’­ï¼Œæ¯”å¦‚left outer joinæ—¶ï¼Œåªèƒ½å¹¿æ’­å³è¡¨ Hive Join Hiveä¸­çš„Joinå¯åˆ†ä¸ºCommon Joinï¼ˆReduceé˜¶æ®µå®Œæˆjoinï¼‰å’ŒMap Joinï¼ˆMapé˜¶æ®µå®Œæˆjoinï¼‰ã€‚\nHive Common Join å¦‚æœä¸æŒ‡å®šMapJoinæˆ–è€…ä¸ç¬¦åˆMapJoinçš„æ¡ä»¶ï¼Œé‚£ä¹ˆHiveè§£æå™¨ä¼šé»˜è®¤æŠŠæ‰§è¡ŒCommon Joinï¼Œå³åœ¨Reduceé˜¶æ®µå®Œæˆjoinã€‚æ•´ä¸ªè¿‡ç¨‹åŒ…å«Mapã€Shuffleã€Reduceé˜¶æ®µã€‚\nMapé˜¶æ®µ è¯»å–æºè¡¨çš„æ•°æ®ï¼ŒMapè¾“å‡ºæ—¶å€™ä»¥Join onæ¡ä»¶ä¸­çš„åˆ—ä¸ºkeyï¼Œå¦‚æœJoinæœ‰å¤šä¸ªå…³è”é”®ï¼Œåˆ™ä»¥è¿™äº›å…³è”é”®çš„ç»„åˆä½œä¸ºkeyï¼›Mapè¾“å‡ºçš„valueä¸ºjoinä¹‹åæ‰€å…³å¿ƒçš„(selectæˆ–è€…whereä¸­éœ€è¦ç”¨åˆ°çš„)åˆ—ï¼ŒåŒæ—¶åœ¨valueä¸­è¿˜ä¼šåŒ…å«è¡¨çš„Tagä¿¡æ¯ï¼Œç”¨äºæ ‡æ˜æ­¤valueå¯¹åº”å“ªä¸ªè¡¨ã€‚\nShuffleé˜¶æ®µ æ ¹æ®keyçš„å€¼è¿›è¡Œhashï¼Œå¹¶å°†key/valueæŒ‰ç…§hashå€¼æ¨é€è‡³ä¸åŒçš„reduceä¸­ï¼Œè¿™æ ·ç¡®ä¿ä¸¤ä¸ªè¡¨ä¸­ç›¸åŒçš„keyä½äºåŒä¸€ä¸ªreduceä¸­ã€‚\nReduceé˜¶æ®µ æ ¹æ®keyçš„å€¼å®Œæˆjoinæ“ä½œï¼ŒæœŸé—´é€šè¿‡Tagæ¥è¯†åˆ«ä¸åŒè¡¨ä¸­çš„æ•°æ®ã€‚\n1 2 3 SELECT a.id,a.dept,b.age FROM a join b ON (a.id = b.id); Hive Map Join MapJoiné€šå¸¸ç”¨äºä¸€ä¸ªå¾ˆå°çš„è¡¨å’Œä¸€ä¸ªå¤§è¡¨è¿›è¡Œjoinçš„åœºæ™¯ï¼Œå…·ä½“å°è¡¨æœ‰å¤šå°ï¼Œç”±å‚æ•°hive.mapjoin.smalltable.filesizeæ¥å†³å®šï¼Œé»˜è®¤å€¼ä¸º25Mã€‚æ»¡è¶³æ¡ä»¶çš„è¯Hiveåœ¨æ‰§è¡Œæ—¶å€™ä¼šè‡ªåŠ¨è½¬åŒ–ä¸ºMapJoinï¼Œæˆ–ä½¿ç”¨hintæç¤º /*+ mapjoin(table) */æ‰§è¡ŒMapJoinã€‚ å¦‚ä¸Šå›¾ä¸­çš„æµç¨‹ï¼Œé¦–å…ˆTask Aåœ¨å®¢æˆ·ç«¯æœ¬åœ°æ‰§è¡Œï¼Œè´Ÿè´£æ‰«æå°è¡¨bçš„æ•°æ®ï¼Œå°†å…¶è½¬æ¢æˆä¸€ä¸ªHashTableçš„æ•°æ®ç»“æ„ï¼Œå¹¶å†™å…¥æœ¬åœ°çš„æ–‡ä»¶ä¸­ï¼Œä¹‹åå°†è¯¥æ–‡ä»¶åŠ è½½åˆ°DistributeCacheä¸­ã€‚ æ¥ä¸‹æ¥çš„Task Bä»»åŠ¡æ˜¯ä¸€ä¸ªæ²¡æœ‰Reduceçš„MapReduceï¼Œå¯åŠ¨MapTasksæ‰«æå¤§è¡¨aï¼Œåœ¨Mapé˜¶æ®µï¼Œæ ¹æ®açš„æ¯ä¸€æ¡è®°å½•å»å’ŒDistributeCacheä¸­bè¡¨å¯¹åº”çš„HashTableå…³è”ï¼Œå¹¶ç›´æ¥è¾“å‡ºç»“æœï¼Œå› ä¸ºæ²¡æœ‰Reduceï¼Œæ‰€ä»¥æœ‰å¤šå°‘ä¸ªMap Taskï¼Œå°±æœ‰å¤šå°‘ä¸ªç»“æœæ–‡ä»¶ã€‚ æ³¨æ„ï¼šMap JOINä¸é€‚åˆFULL/RIGHT OUTER JOINã€‚\n","permalink":"https://reid00.github.io/en/posts/computation/spark-join-%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3/","summary":"ä»‹ç» Joinå¤§è‡´åŒ…æ‹¬ä¸‰ä¸ªè¦ç´ ï¼šJoinæ–¹å¼ã€Joinæ¡ä»¶ä»¥åŠè¿‡æ»¤æ¡ä»¶ã€‚å…¶ä¸­è¿‡æ»¤æ¡ä»¶ä¹Ÿå¯ä»¥é€šè¿‡ANDè¯­å¥æ”¾åœ¨Joinæ¡ä»¶ä¸­ã€‚ Sparkæ”¯æŒçš„Join åŒ…æ‹¬:\ninner join left outer join right outer join full outer join left semi join left anti join Join çš„åŸºæœ¬æµç¨‹ æ€»ä½“ä¸Šæ¥è¯´ï¼ŒJoinçš„åŸºæœ¬å®ç°æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒSparkå°†å‚ä¸Joinçš„ä¸¤å¼ è¡¨æŠ½è±¡ä¸ºæµå¼éå†è¡¨(streamIter)å’ŒæŸ¥æ‰¾è¡¨(buildIter)ï¼Œé€šå¸¸streamIterä¸ºå¤§è¡¨ï¼ŒbuildIterä¸ºå°è¡¨ï¼Œæˆ‘ä»¬ä¸ç”¨æ‹…å¿ƒå“ªä¸ªè¡¨ä¸ºstreamIterï¼Œå“ªä¸ªè¡¨ä¸ºbuildIterï¼Œè¿™ä¸ªsparkä¼šæ ¹æ®joinè¯­å¥è‡ªåŠ¨å¸®æˆ‘ä»¬å®Œæˆã€‚ åœ¨å®é™…è®¡ç®—æ—¶ï¼Œsparkä¼šåŸºäºstreamIteræ¥éå†ï¼Œæ¯æ¬¡å–å‡ºstreamIterä¸­çš„ä¸€æ¡è®°å½•rowAï¼Œæ ¹æ®Joinæ¡ä»¶è®¡ç®—keyAï¼Œç„¶åæ ¹æ®è¯¥keyAå»buildIterä¸­æŸ¥æ‰¾æ‰€æœ‰æ»¡è¶³Joinæ¡ä»¶(keyB==keyA)çš„è®°å½•rowBsï¼Œå¹¶å°†rowBsä¸­æ¯æ¡è®°å½•åˆ†åˆ«ä¸rowAjoinå¾—åˆ°joinåçš„è®°å½•ï¼Œæœ€åæ ¹æ®è¿‡æ»¤æ¡ä»¶å¾—åˆ°æœ€ç»ˆjoinçš„è®°å½•ã€‚\nä»ä¸Šè¿°è®¡ç®—è¿‡ç¨‹ä¸­ä¸éš¾å‘ç°ï¼Œå¯¹äºæ¯æ¡æ¥è‡ªstreamIterçš„è®°å½•ï¼Œéƒ½è¦å»buildIterä¸­æŸ¥æ‰¾åŒ¹é…çš„è®°å½•ï¼Œæ‰€ä»¥buildIterä¸€å®šè¦æ˜¯æŸ¥æ‰¾æ€§èƒ½è¾ƒä¼˜çš„æ•°æ®ç»“æ„ å¦‚Hash Tableã€‚sparkæä¾›äº†ä¸‰ç§joinå®ç°ï¼šsort merge joinã€broadcast joinä»¥åŠhash joinã€‚\nHash joinå®ç° sparkæä¾›äº†hash joinå®ç°æ–¹å¼ï¼Œåœ¨shuffle readé˜¶æ®µä¸å¯¹è®°å½•æ’åºï¼Œåæ­£æ¥è‡ªä¸¤æ ¼è¡¨çš„å…·æœ‰ç›¸åŒkeyçš„è®°å½•ä¼šåœ¨åŒä¸€ä¸ªåˆ†åŒºï¼Œåªæ˜¯åœ¨åˆ†åŒºå†…ä¸æ’åºï¼Œå°†æ¥è‡ªbuildIterçš„è®°å½•æ”¾åˆ°hashè¡¨ä¸­ï¼Œä»¥ä¾¿æŸ¥æ‰¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\nç”±äºSparkæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„è®¡ç®—å¼•æ“ï¼Œå¯ä»¥é€šè¿‡åˆ†åŒºçš„å½¢å¼å°†å¤§æ‰¹é‡çš„æ•°æ®åˆ’åˆ†æˆnä»½è¾ƒå°çš„æ•°æ®é›†è¿›è¡Œå¹¶è¡Œè®¡ç®—ã€‚è¿™ç§æ€æƒ³åº”ç”¨åˆ°Joinä¸Šä¾¿æ˜¯Shuffle Hash Joinäº†ã€‚åˆ©ç”¨keyç›¸åŒå¿…ç„¶åˆ†åŒºç›¸åŒçš„è¿™ä¸ªåŸç†ï¼ŒSparkSQLå°†è¾ƒå¤§è¡¨çš„joinåˆ†è€Œæ²»ä¹‹ï¼Œå…ˆå°†è¡¨åˆ’åˆ†æˆnä¸ªåˆ†åŒºï¼Œåœ¨å¯¹buildlteræŸ¥æ‰¾è¡¨å’Œstreamlterè¡¨è¿›è¡ŒHash Joinã€‚ Shuffle Hash Joinåˆ†ä¸ºä¸¤æ­¥ï¼š å¯¹ä¸¤å¼ è¡¨åˆ†åˆ«æŒ‰ç…§join keysè¿›è¡Œé‡åˆ†åŒºï¼Œå³shuffleï¼Œç›®çš„æ˜¯ä¸ºäº†è®©æœ‰ç›¸åŒjoin keyså€¼çš„è®°å½•åˆ†åˆ°å¯¹åº”çš„åˆ†åŒºä¸­ å¯¹ å¯¹åº”åˆ†åŒºä¸­çš„æ•°æ®è¿›è¡Œjoinï¼Œæ­¤å¤„å…ˆå°†å°è¡¨åˆ†åŒºæ„é€ ä¸ºä¸€å¼ hashè¡¨ï¼Œç„¶åæ ¹æ®å¤§è¡¨åˆ†åŒºä¸­è®°å½•çš„join keyså€¼æ‹¿å‡ºæ¥è¿›è¡ŒåŒ¹é… ä¸éš¾å‘ç°ï¼Œè¦å°†æ¥è‡ªbuildIterçš„è®°å½•æ”¾åˆ°hashè¡¨ä¸­ï¼Œé‚£ä¹ˆæ¯ä¸ªåˆ†åŒºæ¥è‡ªbuildIterçš„è®°å½•ä¸èƒ½å¤ªå¤§ï¼Œå¦åˆ™å°±å­˜ä¸ä¸‹ï¼Œé»˜è®¤æƒ…å†µä¸‹hash joinçš„å®ç°æ˜¯å…³é—­çŠ¶æ€ï¼Œå¦‚æœè¦ä½¿ç”¨hash joinï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶ï¼š\nbuildIteræ€»ä½“ä¼°è®¡å¤§å°è¶…è¿‡spark.sql.autoBroadcastJoinThresholdè®¾å®šçš„å€¼ï¼Œå³ä¸æ»¡è¶³broadcast joinæ¡ä»¶ å¼€å¯å°è¯•ä½¿ç”¨hash joinçš„å¼€å…³ï¼Œspark.sql.join.preferSortMergeJoin=false æ¯ä¸ªåˆ†åŒºçš„å¹³å‡å¤§å°ä¸è¶…è¿‡spark.sql.autoBroadcastJoinThresholdè®¾å®šçš„å€¼ï¼Œå³shuffle readé˜¶æ®µæ¯ä¸ªåˆ†åŒºæ¥è‡ªbuildIterçš„è®°å½•è¦èƒ½æ”¾åˆ°å†…å­˜ä¸­ streamIterçš„å¤§å°æ˜¯buildIterä¸‰å€ä»¥ä¸Š Sort Merge Join å®ç° ä¸Šé¢ä»‹ç»çš„å®ç°å¯¹äºä¸€å®šå¤§å°çš„è¡¨æ¯”è¾ƒé€‚ç”¨ï¼Œä½†å½“ä¸¤ä¸ªè¡¨éƒ½éå¸¸å¤§æ—¶ï¼Œæ˜¾ç„¶æ— è®ºé€‚ç”¨å“ªç§éƒ½ä¼šå¯¹è®¡ç®—å†…å­˜é€ æˆå¾ˆå¤§å‹åŠ›ã€‚è¿™æ˜¯å› ä¸ºjoinæ—¶ä¸¤è€…é‡‡å–çš„éƒ½æ˜¯hash joinï¼Œæ˜¯å°†ä¸€ä¾§çš„æ•°æ®å®Œå…¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä½¿ç”¨hash codeå–join keyså€¼ç›¸ç­‰çš„è®°å½•è¿›è¡Œè¿æ¥ã€‚\nè¦è®©ä¸¤æ¡è®°å½•èƒ½joinåˆ°ä¸€èµ·ï¼Œé¦–å…ˆéœ€è¦å°†å…·æœ‰ç›¸åŒkeyçš„è®°å½•åœ¨åŒä¸€ä¸ªåˆ†åŒºï¼Œæ‰€ä»¥é€šå¸¸æ¥è¯´ï¼Œéœ€è¦åšä¸€æ¬¡shuffleï¼Œmapé˜¶æ®µæ ¹æ®joinæ¡ä»¶ç¡®å®šæ¯æ¡è®°å½•çš„keyï¼ŒåŸºäºè¯¥keyåšshuffle writeï¼Œå°†å¯èƒ½joinåˆ°ä¸€èµ·çš„è®°å½•åˆ†åˆ°åŒä¸€ä¸ªåˆ†åŒºä¸­ï¼Œè¿™æ ·åœ¨shuffle readé˜¶æ®µå°±å¯ä»¥å°†ä¸¤ä¸ªè¡¨ä¸­å…·æœ‰ç›¸åŒkeyçš„è®°å½•æ‹‰åˆ°åŒä¸€ä¸ªåˆ†åŒºå¤„ç†ã€‚å‰é¢æˆ‘ä»¬ä¹Ÿæåˆ°ï¼Œå¯¹äºbuildIterä¸€å®šè¦æ˜¯æŸ¥æ‰¾æ€§èƒ½è¾ƒä¼˜çš„æ•°æ®ç»“æ„ï¼Œé€šå¸¸æˆ‘ä»¬èƒ½æƒ³åˆ°hashè¡¨ï¼Œä½†æ˜¯å¯¹äºä¸€å¼ è¾ƒå¤§çš„è¡¨æ¥è¯´ï¼Œä¸å¯èƒ½å°†æ‰€æœ‰è®°å½•å…¨éƒ¨æ”¾åˆ°hashè¡¨ä¸­ï¼ŒSparkSQLé‡‡ç”¨äº†ä¸€ç§å…¨æ–°çš„æ–¹æ¡ˆæ¥å¯¹è¡¨è¿›è¡ŒJoinï¼Œå³Sort Merge Joinã€‚è¿™ç§å®ç°æ–¹å¼ä¸ç”¨å°†ä¸€ä¾§æ•°æ®å…¨éƒ¨åŠ è½½åå†è¿›è¡Œhash joinï¼Œä½†éœ€è¦åœ¨joinå‰å°†æ•°æ®æ’åºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸‰ä¸ªæ­¥éª¤: shuffleé˜¶æ®µï¼šæˆ–è€…è¯´shuffle write é˜¶æ®µï¼Œå°†ä¸¤å¼ å¤§è¡¨æ ¹æ®join keyè¿›è¡Œé‡æ–°åˆ†åŒºï¼Œä¸¤å¼ è¡¨æ•°æ®ä¼šåˆ†å¸ƒåˆ°æ•´ä¸ªé›†ç¾¤ï¼Œä»¥ä¾¿åˆ†å¸ƒå¼å¹¶è¡Œå¤„ç† sorté˜¶æ®µï¼šå¯¹å•ä¸ªåˆ†åŒºèŠ‚ç‚¹çš„ä¸¤è¡¨æ•°æ®ï¼Œåˆ†åˆ«è¿›è¡Œæ’åº mergeé˜¶æ®µï¼šæˆ–è€…è¯´shuffle read é˜¶æ®µï¼Œå¯¹æ’å¥½åºçš„ä¸¤å¼ åˆ†åŒºè¡¨æ•°æ®æ‰§è¡Œjoinæ“ä½œã€‚joinæ“ä½œå¾ˆç®€å•ï¼Œåˆ†åˆ«éå†ä¸¤ä¸ªæœ‰åºåºåˆ—ï¼Œç¢°åˆ°ç›¸åŒjoin keyå°±mergeè¾“å‡ºï¼Œå¦åˆ™å–æ›´å°ä¸€è¾¹","title":"Spark Join åŸç†è¯¦è§£"},{"content":"å‰è¨€ åˆšå·¥ä½œé‚£ä¼šï¼Œæœ‰ä¸€æ¬¡ï¼Œä¸Šæ¸¸è°ƒç”¨æˆ‘æœåŠ¡çš„è€å“¥è¯´ï¼Œä½ çš„æœåŠ¡æŠ¥\u0026quot;502é”™è¯¯äº†ï¼Œå¿«å»çœ‹çœ‹æ˜¯ä¸ºä»€ä¹ˆå§\u0026quot;ã€‚\nå½“æ—¶é‚£ä¸ªæœåŠ¡é‡Œæ­£å¥½æœ‰ä¸ªè°ƒç”¨æ—¥å¿—ï¼Œå¹³æ—¶ä¼šè®°å½•å„ç§200,4xxçŠ¶æ€ç çš„ä¿¡æ¯ã€‚äºæ˜¯æˆ‘è·‘åˆ°æœåŠ¡æ—¥å¿—é‡Œå»æœç´¢äº†ä¸€ä¸‹502è¿™ä¸ªæ•°å­—ï¼Œæ¯«æ— å‘ç°ã€‚äºæ˜¯è·Ÿè€å“¥è¯´ï¼Œ\u0026quot;æœåŠ¡æ—¥å¿—é‡Œå¹¶æ²¡æœ‰502çš„è®°å½•ï¼Œä½ æ˜¯ä¸æ˜¯æé”™å•¦ï¼Ÿ\u0026quot;\nç°åœ¨æƒ³æ¥ï¼Œå¤šå°‘æœ‰äº›ä¸å¥½æ„æ€ã€‚\nä¸çŸ¥é“æœ‰å¤šå°‘è€å“¥æ˜¯è·Ÿå½“æ—¶çš„æˆ‘æ˜¯ä¸€æ ·çš„ï¼Œè¿™ç¯‡æ–‡ç« ï¼Œå°±æ¥èŠèŠ502é”™è¯¯æ˜¯ä»€ä¹ˆï¼Ÿ\næˆ‘ä»¬ä»çŠ¶æ€ç æ˜¯ä»€ä¹ˆå¼€å§‹èŠèµ·ã€‚\nHTTPçŠ¶æ€ç  æˆ‘ä»¬å¹³æ—¶åœ¨æµè§ˆå™¨é‡Œé€›çš„æŸå®å’ŒæŸåº¦ï¼Œå…¶å®éƒ½æ˜¯ä¸€ä¸ªä¸ªå‰ç«¯ç½‘é¡µã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œå‰ç«¯å¹¶ä¸å­˜å‚¨å¤ªå¤šæ•°æ®ï¼Œå¤§éƒ¨åˆ†æ—¶å€™éƒ½éœ€è¦ä»åç«¯æœåŠ¡å™¨é‚£è·å–æ•°æ®ã€‚ äºæ˜¯å‰åç«¯ä¹‹é—´éœ€è¦é€šè¿‡TCPåè®®å»å»ºç«‹è¿æ¥ï¼Œç„¶ååœ¨TCPçš„åŸºç¡€ä¸Šä¼ è¾“æ•°æ®ã€‚\nè€ŒTCPæ˜¯åŸºäºæ•°æ®æµçš„åè®®ï¼Œä¼ è¾“æ•°æ®æ—¶ï¼Œå¹¶ä¸ä¼šä¸ºæ¯ä¸ªæ¶ˆæ¯åŠ å…¥æ•°æ®è¾¹ç•Œï¼Œç›´æ¥ä½¿ç”¨è£¸çš„TCPè¿›è¡Œæ•°æ®ä¼ è¾“ä¼šæœ‰\u0026quot;ç²˜åŒ…\u0026quot;é—®é¢˜ã€‚\nå› æ­¤éœ€è¦ç”¨ç‰¹åœ°çš„åè®®æ ¼å¼å»å¯¹æ•°æ®è¿›è¡Œè§£æã€‚äºæ˜¯åœ¨æ­¤åŸºç¡€ä¸Šè®¾è®¡äº†HTTPåè®®ã€‚è¯¦ç»†çš„å†…å®¹å¯ä»¥çœ‹æˆ‘ä¹‹å‰å†™çš„ã€Šæ—¢ç„¶æœ‰HTTPåè®®ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰RPCã€‹ã€‚\næ¯”å¦‚ï¼Œæˆ‘æƒ³è¦çœ‹æŸä¸ªå•†å“çš„å…·ä½“ä¿¡æ¯ï¼Œå…¶å®å°±æ˜¯å‰ç«¯å‘çš„HTTPè¯·æ±‚ä¸­ä¼ å…¥å•†å“çš„idï¼Œåç«¯è¿”å›çš„HTTPå“åº”ä¸­è¿”å›å•†å“çš„ä»·æ ¼ï¼Œå•†åº—åï¼Œå‘è´§åœ°å€çš„ä¿¡æ¯ç­‰ã€‚\nè¿™æ ·ï¼Œè¡¨é¢ä¸Šï¼Œæˆ‘ä»¬æ˜¯åœ¨åˆ·ç€å„ç§ç½‘é¡µï¼Œå®é™…ä¸ŠèƒŒåæ­£æœ‰å¤šæ¬¡HTTPæ¶ˆæ¯åœ¨ä¸æ–­è¿›è¡Œæ”¶å‘ã€‚\nä½†é—®é¢˜å°±æ¥äº†ï¼Œä¸Šé¢æåˆ°çš„éƒ½æ˜¯æ­£å¸¸æƒ…å†µï¼Œå¦‚æœæœ‰å¼‚å¸¸æƒ…å†µå‘¢ï¼Œæ¯”å¦‚å‰ç«¯å‘çš„æ•°æ®ï¼Œæ ¹æœ¬å°±ä¸æ˜¯ä¸ªå•†å“idï¼Œè€Œæ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œè¿™å¯¹äºåç«¯æœåŠ¡ç«¯æ¥è¯´æ˜¯ä¸å¯èƒ½ç»™å‡ºæ­£å¸¸å“åº”çš„ï¼Œäºæ˜¯å°±éœ€è¦è®¾è®¡ä¸€å¥—HTTPçŠ¶æ€ç ï¼Œç”¨æ¥æ ‡è¯†è¿™æ¬¡HTTPè¯·æ±‚å“åº”æµç¨‹æ˜¯å¦æ­£å¸¸ã€‚é€šè¿‡è¿™ä¸ªå¯ä»¥å½±å“æµè§ˆå™¨çš„è¡Œä¸ºã€‚\næ¯”æ–¹è¯´ä¸€åˆ‡æ­£å¸¸ï¼Œé‚£æœåŠ¡ç«¯è¿”å›ä¸ª200çŠ¶æ€ç ï¼Œå‰ç«¯æ”¶åˆ°åï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨å“åº”çš„æ•°æ®ã€‚ä½†å¦‚æœæœåŠ¡ç«¯å‘ç°å®¢æˆ·ç«¯å‘çš„ä¸œè¥¿å¼‚å¸¸ï¼Œå°±å“åº”ä¸ª4xxçŠ¶æ€ç ï¼Œæ„æ€æ˜¯è¿™æ˜¯ä¸ªå®¢æˆ·ç«¯çš„é”™è¯¯ï¼Œ4xxé‡Œå¤´çš„xxå¯ä»¥æ ¹æ®é”™è¯¯çš„ç±»å‹ï¼Œå†ç»†åˆ†æˆå„ç§ç ï¼Œæ¯”å¦‚401æ˜¯å®¢æˆ·ç«¯æ²¡æƒé™ï¼Œ404æ˜¯å®¢æˆ·ç«¯è¯·æ±‚äº†ä¸€ä¸ªæ ¹æœ¬ä¸å­˜åœ¨çš„ç½‘é¡µã€‚åè¿‡æ¥ï¼Œå¦‚æœæ˜¯æœåŠ¡å™¨æœ‰é—®é¢˜ï¼Œå°±è¿”å›5xxçŠ¶æ€ç ã€‚\nä½†é—®é¢˜å°±æ¥äº†ã€‚ æœåŠ¡ç«¯éƒ½æœ‰é—®é¢˜äº†ï¼Œæä¸¥é‡ç‚¹ï¼ŒæœåŠ¡å™¨å¯èƒ½ç›´æ¥å°±å´©æºƒäº†ï¼Œé‚£å®ƒè¿˜æ€ä¹ˆç»™ä½ è¿”å›çŠ¶æ€ç ï¼Ÿ æ˜¯çš„ï¼Œè¿™ç§æƒ…å†µï¼ŒæœåŠ¡ç«¯æ˜¯ä¸å¯èƒ½ç»™å®¢æˆ·ç«¯è¿”å›çŠ¶æ€ç çš„ã€‚æ‰€ä»¥è¯´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹5xxçš„çŠ¶æ€ç å…¶å®å¹¶ä¸æ˜¯æœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„ã€‚ å®ƒä»¬æ˜¯ç”±ç½‘å…³è¿”å›çš„ï¼Œå¸¸è§çš„ç½‘å…³ï¼Œæ¯”å¦‚nginxã€‚\nnginxçš„ä½œç”¨ å›åˆ°å‰åç«¯äº¤äº’æ•°æ®çš„è¯é¢˜ä¸Šï¼Œå¦‚æœå‰ç«¯ç”¨æˆ·å°‘ï¼Œé‚£åç«¯å¤„ç†èµ·è¯·æ±‚æ¥ï¼Œæ¸¸åˆƒæœ‰ä½™ã€‚ä½†éšç€ç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼Œåç«¯æœåŠ¡å™¨å—èµ„æºé™åˆ¶ï¼Œcpuæˆ–è€…å†…å­˜éƒ½å¯èƒ½ä¼šä¸¥é‡ä¸è¶³ï¼Œè¿™æ—¶å€™è§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆç®€å•ï¼Œå¤šæå‡ å°ä¸€æ ·çš„æœåŠ¡å™¨ï¼Œè¿™æ ·å°±èƒ½å°†è¿™äº›å‰ç«¯è¯·æ±‚å‡æ‘Šç»™å‡ ä¸ªæœåŠ¡å™¨ï¼Œä»è€Œæå‡å¤„ç†èƒ½åŠ›ã€‚\nä½†è¦å®ç°è¿™æ ·çš„æ•ˆæœï¼Œå‰ç«¯å°±å¾—çŸ¥é“åç«¯å…·ä½“æœ‰å“ªäº›ä¸ªæœåŠ¡å™¨ï¼Œå¹¶ä¸€ä¸€è·Ÿä»–ä»¬å»ºç«‹TCPè¿æ¥ã€‚\nä¹Ÿä¸æ˜¯ä¸è¡Œï¼Œä½†å°±æ˜¯éº»çƒ¦ã€‚\nä½†è¿™æ—¶å€™å¦‚æœèƒ½æœ‰ä¸ªä¸­é—´å±‚æŒ¡åœ¨å®ƒä»¬ä¸­é—´å°±å¥½äº†ï¼Œè¿™æ ·å®¢æˆ·ç«¯åªéœ€è¦è·Ÿä¸­é—´å±‚è¿æ¥ï¼Œä¸­é—´å±‚å†å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚\näºæ˜¯ï¼Œè¿™ä¸ªä¸­é—´å±‚å°±æˆäº†è¿™å¸®æœåŠ¡å™¨çš„ä¸€ä¸ªä»£ç†äººä¸€æ ·ï¼Œå®¢æˆ·ç«¯æœ‰å•¥äº‹éƒ½æ‰¾ä»£ç†äººï¼Œåªç®¡å‘å‡ºè‡ªå·±çš„è¯·æ±‚ï¼Œå†ç”±ä»£ç†äººå»æ‰¾æŸä¸ªæœåŠ¡å™¨å»å®Œæˆå“åº”ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸‹æ¥ï¼Œå®¢æˆ·ç«¯åªçŸ¥é“è‡ªå·±çš„è¯·æ±‚è¢«ä»£ç†äººå¸®å¿™æå®šäº†ï¼Œä½†ä»£ç†äººå…·ä½“æ‰¾äº†é‚£ä¸ªæœåŠ¡å™¨å»å®Œæˆï¼Œå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“ï¼Œä¹Ÿä¸éœ€è¦çŸ¥é“ã€‚\nåƒè¿™ç§ï¼Œå±è”½æ‰å…·ä½“æœ‰å“ªäº›æœåŠ¡å™¨çš„ä»£ç†æ–¹å¼å°±æ˜¯æ‰€è°“çš„åå‘ä»£ç†ã€‚\nåè¿‡æ¥ï¼Œå±è”½æ‰å…·ä½“æœ‰å“ªäº›å®¢æˆ·ç«¯çš„ä»£ç†æ–¹å¼ï¼Œå°±æ˜¯æ‰€è°“çš„æ­£å‘ä»£ç†ã€‚\nè€Œè¿™ä¸ªä¸­é—´å±‚çš„è§’è‰²ï¼Œä¸€èˆ¬ç”±nginxè¿™ç±»ç½‘å…³æ¥å……å½“ã€‚\nå¦å¤–ï¼Œç”±äºèƒŒåçš„æœåŠ¡å™¨å¯èƒ½æ€§èƒ½é…ç½®å„ä¸ç›¸åŒï¼Œæœ‰äº›4æ ¸8Gï¼Œæœ‰äº›2æ ¸4Gï¼Œnginxèƒ½ä¸ºå®ƒä»¬åŠ ä¸Šä¸åŒçš„è®¿é—®æƒé‡ï¼Œæƒé‡é«˜çš„å¤šè½¬å‘ç‚¹è¯·æ±‚ï¼Œé€šè¿‡è¿™ä¸ªæ–¹å¼å®ç°ä¸åŒçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚\nnginxè¿”å›5xxçŠ¶æ€ç  æœ‰äº†nginxè¿™ä¸€ä¸­é—´å±‚åï¼Œå®¢æˆ·ç«¯ä»ç›´è¿æœåŠ¡ç«¯ï¼Œå˜æˆå®¢æˆ·ç«¯ç›´è¿nginxï¼Œå†ç”±nginxç›´è¿æœåŠ¡ç«¯ã€‚ä»ä¸€ä¸ªTCPè¿æ¥å˜æˆä¸¤ä¸ªTCPè¿æ¥ã€‚\näºæ˜¯ï¼Œå½“æœåŠ¡å™¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œnginxå‘é€ç»™æœåŠ¡å™¨çš„é‚£æ¡TCPè¿æ¥å°±ä¸èƒ½æ­£å¸¸å“åº”ï¼Œnginxåœ¨å¾—åˆ°è¿™ä¸€ä¿¡æ¯åï¼Œå°±ä¼šè¿”å›5xxé”™è¯¯ç ç»™å®¢æˆ·ç«¯ï¼Œä¹Ÿå°±æ˜¯è¯´5xxçš„æŠ¥é”™ï¼Œå…¶å®æ˜¯ç”±nginxè¯†åˆ«å‡ºæ¥ï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯çš„ï¼ŒæœåŠ¡ç«¯æœ¬èº«ï¼Œå¹¶ä¸ä¼šæœ‰5xxçš„æ—¥å¿—ä¿¡æ¯ã€‚æ‰€ä»¥æ‰ä¼šå‡ºç°æ–‡ç« å¼€å¤´çš„ä¸€å¹•ï¼Œä¸Šæ¸¸æ”¶åˆ°äº†æˆ‘æœåŠ¡çš„502æŠ¥é”™ï¼Œä½†æˆ‘åœ¨è‡ªå·±çš„æœåŠ¡æ—¥å¿—é‡Œå´æœç´¢ä¸åˆ°è¿™ä¸€ä¿¡æ¯ã€‚\näº§ç”Ÿ502çš„å¸¸è§åŸå›  åœ¨rfc7231ä¸­æœ‰å…³äº502é”™è¯¯ç çš„å®˜æ–¹è§£é‡Šæ˜¯\n1 2 502 Bad Gateway The 502 (Bad Gateway) status code indicates that the server, while acting as a gateway or proxy, received an invalid response from an inbound server it accessed while attempting to fulfill the request. ç¿»è¯‘ä¸€ä¸‹å°±æ˜¯ï¼Œ502 (Bad Gateway) çŠ¶æ€ä»£ç è¡¨ç¤ºæœåŠ¡å™¨åœ¨å……å½“ç½‘å…³æˆ–ä»£ç†æ—¶ï¼Œåœ¨å°è¯•æ»¡è¶³è¯·æ±‚æ—¶ä»å®ƒè®¿é—®çš„å…¥ç«™æœåŠ¡å™¨æ¥æ”¶åˆ°æ— æ•ˆå“åº”ã€‚\næ±å¬ï¼Œäººè¨€å¦ï¼Ÿ\nè¿™å¯¹äºå¤§éƒ¨åˆ†ç¼–ç¨‹å°ç™½æ¥è¯´ï¼Œä¸ä»…æ²¡è§£é‡Šåˆ°é—®é¢˜ï¼Œåè€Œåªä¼šå†’å‡ºæ›´å¤šçš„é—®å·ã€‚æ¯”å¦‚ï¼Œè¿™ä¸Šé¢æåˆ°çš„æ— æ•ˆå“åº”åˆ°åº•æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿï¼Ÿ\næˆ‘æ¥è§£é‡Šä¸‹ï¼Œå®ƒå…¶å®æ˜¯è¯´ï¼Œ502å…¶å®æ˜¯ç”±ç½‘å…³ä»£ç†ï¼ˆnginxï¼‰å‘å‡ºçš„ï¼Œæ˜¯å› ä¸ºç½‘å…³ä»£ç†æŠŠå®¢æˆ·ç«¯çš„è¯·æ±‚è½¬å‘ç»™äº†æœåŠ¡ç«¯ï¼Œä½†æœåŠ¡ç«¯å´å‘å‡ºäº†æ— æ•ˆå“åº”ï¼Œè€Œè¿™é‡Œçš„æ— æ•ˆå“åº”ï¼Œä¸€èˆ¬æ˜¯æŒ‡TCPçš„RSTæŠ¥æ–‡æˆ–å››æ¬¡æŒ¥æ‰‹çš„FINæŠ¥æ–‡ã€‚\nå››æ¬¡æŒ¥æ‰‹ä¼°è®¡å¤§å®¶èƒŒçš„å¾ˆç†Ÿäº†ï¼Œæ‰€ä»¥ç•¥è¿‡ï¼Œæˆ‘ä»¬æ¥é‡ç‚¹è¯´ä¸‹RSTæŠ¥æ–‡æ˜¯ä»€ä¹ˆã€‚\nRSTæ˜¯ä»€ä¹ˆï¼Ÿ æˆ‘ä»¬éƒ½çŸ¥é“TCPæ­£å¸¸æƒ…å†µä¸‹æ–­å¼€è¿æ¥æ˜¯ç”¨å››æ¬¡æŒ¥æ‰‹ï¼Œé‚£æ˜¯æ­£å¸¸æ—¶å€™çš„ä¼˜é›…åšæ³•ã€‚\nä½†å¼‚å¸¸æƒ…å†µä¸‹ï¼Œæ”¶å‘åŒæ–¹éƒ½ä¸ä¸€å®šæ­£å¸¸ï¼Œè¿æŒ¥æ‰‹è¿™ä»¶äº‹æœ¬èº«éƒ½å¯èƒ½åšä¸åˆ°ï¼Œæ‰€ä»¥å°±éœ€è¦ä¸€ä¸ªæœºåˆ¶å»å¼ºè¡Œå…³é—­è¿æ¥ã€‚\nRST å°±æ˜¯ç”¨äºè¿™ç§æƒ…å†µï¼Œä¸€èˆ¬ç”¨æ¥å¼‚å¸¸åœ°å…³é—­ä¸€ä¸ªè¿æ¥ã€‚å®ƒæ˜¯TCPåŒ…å¤´ä¸­çš„ä¸€ä¸ªæ ‡å¿—ä½ï¼Œåœ¨æ”¶åˆ°ç½®è¿™ä¸ªæ ‡å¿—ä½çš„æ•°æ®åŒ…åï¼Œè¿æ¥å°±ä¼šè¢«å…³é—­ï¼Œæ­¤æ—¶æ¥æ”¶åˆ° RSTçš„ä¸€æ–¹ï¼Œåœ¨åº”ç”¨å±‚ä¼šçœ‹åˆ°ä¸€ä¸ª connection reset æˆ– connection refused çš„æŠ¥é”™ã€‚\nè€Œä¹‹æ‰€ä»¥å‘å‡ºRSTæŠ¥æ–‡ï¼Œä¸€èˆ¬æœ‰ä¸¤ä¸ªå¸¸è§åŸå› ã€‚\næœåŠ¡ç«¯è¿‡æ—©æ–­å¼€è¿æ¥ nginxä¸æœåŠ¡ç«¯ä¹‹é—´æœ‰ä¸€æ¡TCPè¿æ¥ï¼Œåœ¨nginxå°†å®¢æˆ·ç«¯è¯·æ±‚è½¬å‘ç»™æœåŠ¡ç«¯æ—¶ï¼Œä»–ä¸¤ä¹‹é—´æŒ‰é“ç†ä¼šä¸€ç›´ä¿æŒè¿™æ¡è¿æ¥ï¼Œç›´åˆ°æœåŠ¡ç«¯å°†ç»“æœæ­£å¸¸è¿”å›åï¼Œå†æ–­å¼€è¿æ¥ã€‚\nä½†å¦‚æœæœåŠ¡ç«¯è¿‡æ—©æ–­å¼€è¿æ¥ï¼Œè€Œnginxå´è¿˜ç»§ç»­å‘æ¶ˆæ¯è¿‡å»ï¼Œnginxå°±ä¼šæ”¶åˆ°æœåŠ¡ç«¯å†…æ ¸è¿”å›çš„RSTæŠ¥æ–‡æˆ–å››æ¬¡æŒ¥æ‰‹çš„FINæŠ¥æ–‡ï¼Œè¿«ä½¿nginxé‚£è¾¹çš„è¿æ¥ç»“æŸã€‚\nè¿‡æ—©æ–­å¼€è¿æ¥çš„åŸå› å¸¸è§çš„æœ‰ä¸¤ä¸ªã€‚\nç¬¬ä¸€ä¸ªæ˜¯ï¼ŒæœåŠ¡ç«¯è®¾ç½®çš„è¶…æ—¶æ—¶é—´è¿‡çŸ­ã€‚ä¸ç®¡æ˜¯ç”¨çš„å“ªç§ç¼–ç¨‹è¯­è¨€ï¼Œä¸€èˆ¬éƒ½æœ‰ç°æˆçš„HTTPåº“ï¼ŒæœåŠ¡ç«¯ä¸€èˆ¬éƒ½ä¼šæœ‰å‡ ä¸ªtimeoutå‚æ•°ï¼Œæ¯”å¦‚golangçš„HTTPæœåŠ¡æ¡†æ¶é‡Œæœ‰ä¸ªå†™è¶…æ—¶ï¼ˆWriteTimeoutï¼‰ï¼Œå‡è®¾è®¾ç½®äº†2sï¼Œé‚£å®ƒçš„å«ä¹‰å°±æ˜¯ï¼ŒæœåŠ¡ç«¯åœ¨æ”¶åˆ°è¯·æ±‚åéœ€è¦åœ¨2så†…å¤„ç†å®Œå¹¶å°†ç»“æœå†™åˆ°å“åº”ä¸­ï¼Œå¦‚æœç­‰ä¸åˆ°ï¼Œå°±ä¼šå°†è¿æ¥ç»™æ–­æ‰ã€‚\næ¯”å¦‚ä½ çš„æ¥å£å¤„ç†æ—¶é—´æ˜¯5sï¼Œè€Œä½ çš„WriteTimeoutå´åªæœ‰2sï¼Œåœ¨æ²¡ç­‰åˆ°å“åº”å†™å®Œä¹‹å‰ï¼ŒHTTPæ¡†æ¶å°±ä¼šä¸»åŠ¨å°†è¿æ¥ç»™æ–­å¼€ã€‚nginxæ­¤æ—¶å°±æœ‰å¯èƒ½æ”¶åˆ°å››æ¬¡æŒ¥æ‰‹çš„FINæŠ¥æ–‡ï¼ˆæœ‰äº›æ¡†æ¶ä¹Ÿå¯èƒ½å‘RSTæŠ¥æ–‡ï¼‰ï¼Œç„¶åæ–­å¼€è¿æ¥ï¼Œäºæ˜¯å®¢æˆ·ç«¯å°±ä¼šæ”¶åˆ°ä¸€ä¸ª502æŠ¥é”™ã€‚\né‡åˆ°è¿™ç§é—®é¢˜ï¼Œå°†WriteTimeoutçš„æ—¶é—´è°ƒå¤§ä¸€äº›å°±å¥½äº†ã€‚\nç¬¬äºŒä¸ªåŸå› ï¼Œä¹Ÿæ˜¯é€ æˆ502çŠ¶æ€ç æœ€å¸¸è§çš„åŸå› ï¼Œå°±æ˜¯æœåŠ¡ç«¯åº”ç”¨è¿›ç¨‹å´©äº†ï¼ˆcrashï¼‰ã€‚\næœåŠ¡ç«¯å´©äº†ï¼Œä¹Ÿå°±æ˜¯å½“å‰æ²¡æœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨ç›‘å¬æœåŠ¡å™¨ç«¯å£ï¼Œè€Œæ­¤æ—¶ä½ å´å°è¯•å‘ä¸€ä¸ªä¸å­˜åœ¨çš„ç«¯å£å‘æ•°æ®ï¼ŒæœåŠ¡å™¨çš„linuxå†…æ ¸åè®®æ ˆå°±ä¼šå“åº”ä¸€ä¸ªRSTæ•°æ®åŒ…ã€‚åŒæ ·ï¼Œè¿™æ—¶å€™nginxä¹Ÿä¼šç»™å®¢æˆ·ç«¯ä¸€ä¸ª502ã€‚\nåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¿™ç§æƒ…å†µæ˜¯æœ€å¸¸è§çš„ã€‚\nç°åœ¨æˆ‘ä»¬å¤§éƒ¨åˆ†çš„æœåŠ¡å™¨éƒ½ä¼šå°†æŒ‚æ‰çš„æœåŠ¡é‡å¯ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸‹æœåŠ¡æ˜¯å¦æ›¾ç»å´©æºƒè¿‡ã€‚\nå¦‚æœä½ æœ‰å¯¹æœåŠ¡ç«¯çš„cpuæˆ–è€…å†…å­˜åšè¿‡ç›‘æ§ï¼Œå¯ä»¥çœ‹ä¸‹CPUæˆ–å†…å­˜çš„ç›‘æ§å›¾æ˜¯å¦å‡ºç°è¿‡æ–­å´–å¼çš„çªç„¶ä¸‹è·Œã€‚å¦‚æœæœ‰ï¼Œåæœ‰å…«ä¹ç™¾ï¼Œå°±æ˜¯ä½ çš„æœåŠ¡ç«¯åº”ç”¨ç¨‹åºæ›¾ç»å´©æºƒè¿‡ã€‚\né™¤æ­¤ä¹‹å¤–ä½ è¿˜é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œçœ‹ä¸‹è¿›ç¨‹ä¸Šæ¬¡çš„å¯åŠ¨æ—¶é—´æ˜¯ä»€ä¹ˆæ—¶å€™ã€‚\n1 ps -o lstart {pid} æ¯”å¦‚æˆ‘è¦çœ‹çš„è¿›ç¨‹idæ˜¯13515ï¼Œå‘½ä»¤å°±éœ€è¦åƒä¸‹é¢è¿™æ ·ã€‚\n1 2 3 # ps -o lstart 13515 STARTED Wed Aug 31 14:28:53 2022 å¯ä»¥çœ‹åˆ°å®ƒä¸Šæ¬¡çš„å¯åŠ¨æ—¶é—´æ˜¯8æœˆ31æ—¥ï¼Œè¿™ä¸ªæ—¶é—´å¦‚æœè·Ÿä½ å°è±¡ä¸­çš„æ“ä½œæ—¶é—´æœ‰å·®è·ï¼Œé‚£è¯´æ˜è¿›ç¨‹å¯èƒ½æ˜¯å´©äº†ä¹‹åè¢«é‡æ–°æ‹‰èµ·äº†ã€‚\né‡åˆ°è¿™ç§é—®é¢˜ï¼Œæœ€é‡è¦çš„æ˜¯æ‰¾å‡ºå´©æºƒçš„åŸå› ï¼Œå´©æºƒçš„åŸå› å°±å¤šç§å¤šæ ·äº†ï¼Œæ¯”å¦‚ï¼Œå¯¹æœªåˆå§‹åŒ–çš„å†…å­˜åœ°å€è¿›è¡Œå†™æ“ä½œï¼Œæˆ–è€…å†…å­˜è®¿é—®è¶Šç•Œï¼ˆæ•°ç»„arré•¿åº¦æ˜æ˜åªæœ‰2ï¼Œä»£ç å´è¯»arr[3]ï¼‰ã€‚\nè¿™ç§æƒ…å†µå‡ ä¹éƒ½æ˜¯ç¨‹åºæœ‰ä»£ç é€»è¾‘é—®é¢˜ï¼Œå´©æºƒä¸€èˆ¬ä¹Ÿä¼šç•™ä¸‹ä»£ç å †æ ˆï¼Œå¯ä»¥æ ¹æ®å †æ ˆæŠ¥é”™å»æ’æŸ¥é—®é¢˜ï¼Œä¿®å¤ä¹‹åå°±å¥½äº†ã€‚æ¯”å¦‚ä¸‹é¢è¿™å¼ å›¾æ˜¯golangçš„æŠ¥é”™å †æ ˆä¿¡æ¯ï¼Œå…¶ä»–è¯­è¨€çš„ä¹Ÿç±»ä¼¼ã€‚\nä¸æ‰“å°å †æ ˆçš„æƒ…å†µ ä½†æœ‰ä¸€äº›æƒ…å†µï¼Œæœ‰æ—¶å€™æ ¹æœ¬ä¸ç•™ä¸‹å †æ ˆã€‚\næ¯”å¦‚å†…å­˜æ³„éœ²å¯¼è‡´è¿›ç¨‹å ç”¨å†…å­˜è¶Šæ¥è¶Šå¤šï¼Œæœ€åå¯¼è‡´è¶…è¿‡æœåŠ¡å™¨çš„æœ€å¤§å†…å­˜é™åˆ¶ï¼Œè§¦å‘OOMï¼ˆout of memoryï¼‰, è¿›ç¨‹ç›´æ¥å°±è¢«æ“ä½œç³»ç»Ÿkillæ‰ã€‚\nè¿˜æœ‰æ›´éšè”½çš„ï¼Œä»£ç é€»è¾‘é‡Œéšè—äº†ä¸»åŠ¨é€€å‡ºè¿›ç¨‹çš„æ“ä½œã€‚æ¯”å¦‚golangçš„æ—¥å¿—æ‰“å°é‡Œæœ‰ä¸ªæ–¹æ³•å«log.Fatalln()ï¼Œæ‰“å°å®Œæ—¥å¿—è¿˜ä¼šé¡ºä¾¿æ‰§è¡Œos.Exit()ç›´æ¥é€€å‡ºè¿›ç¨‹ï¼Œå¯¹æºç ä¸äº†è§£çš„æ–°æ‰‹å¾ˆå®¹æ˜“çŠ¯è¿™ä¸ªé”™ã€‚\nå¦‚æœä½ å¾ˆæ˜ç¡®ï¼Œä½ çš„æœåŠ¡æ²¡æœ‰å´©è¿‡ã€‚é‚£ç»§ç»­å¾€ä¸‹çœ‹ã€‚\nç½‘å…³å°†è¯·æ±‚æ‰“åˆ°äº†ä¸€ä¸ªä¸å­˜åœ¨çš„IPä¸Š nginxæ˜¯é€šè¿‡é…ç½®çš„å½¢å¼æ¥ä»£ç†å¤šä¸ªæœåŠ¡å™¨ã€‚è¿™ä¸ªé…ç½®ä¸€èˆ¬æ˜¯æ”¾åœ¨ /etc/nginx/nginx.conf ä¸­ã€‚\næ‰“å¼€å®ƒï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„ä¿¡æ¯ã€‚\n1 2 3 4 5 6 upstream xiaobaidebug.top { server 10.14.12.19:9235 weight=2; server 10.14.16.13:8145 weight=5; server 10.14.12.133:9702 weight=8; server 10.14.11.15:7035 weight=10; } ä¸Šé¢é…ç½®çš„å«ä¹‰æ˜¯ï¼Œå¦‚æœå®¢æˆ·ç«¯è®¿é—®xiaobaidebug.topåŸŸåï¼Œnginxå°±ä¼šå°†å®¢æˆ·ç«¯çš„è¯·æ±‚è½¬å‘åˆ°ä¸‹é¢çš„4ä¸ªæœåŠ¡å™¨ipä¸Šï¼Œipè¾¹ä¸Šè¿˜æœ‰ä¸ªweightæƒé‡ï¼Œæƒé‡è¶Šé«˜ï¼Œè¢«è½¬å‘åˆ°çš„æ¬¡æ•°å°±è¶Šå¤šã€‚\nå¯ä»¥çœ‹å‡ºï¼Œnginxå…·æœ‰ç›¸å½“ä¸°å¯Œçš„é…ç½®èƒ½åŠ›ã€‚ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›ä¸ªæ–‡ä»¶æ˜¯éœ€è¦è‡ªå·±æ‰‹åŠ¨é…ç½®çš„ã€‚å¯¹äºæœåŠ¡å™¨å°‘ï¼Œä¸”ä¸æ€ä¹ˆå˜åŒ–çš„æƒ…å†µï¼Œè¿™å½“ç„¶æ²¡é—®é¢˜ã€‚\nä½†ç°åœ¨å·²ç»æ˜¯äº‘åŸç”Ÿæ—¶ä»£äº†ï¼Œå¾ˆå¤šå…¬å¸å†…éƒ¨éƒ½æœ‰è‡ªå·±çš„äº‘äº§å“ï¼ŒæœåŠ¡è‡ªç„¶ä¹Ÿä¼šä¸Šäº‘ã€‚ä¸€èˆ¬æ¥è¯´æ¯æ¬¡æ›´æ–°æœåŠ¡ï¼Œéƒ½å¯èƒ½ä¼šå°†æœåŠ¡éƒ¨ç½²åˆ°ä¸€å°æ–°çš„æœºå™¨ä¸Šã€‚è€Œè¿™ä¸ªipä¹Ÿä¼šéšç€æ”¹å˜ï¼Œéš¾é“æ¯å‘å¸ƒä¸€æ¬¡æœåŠ¡ï¼Œéƒ½éœ€è¦æ‰‹åŠ¨å»nginxä¸Šæ”¹é…ç½®å—ï¼Ÿè¿™æ˜¾ç„¶ä¸ç°å®ã€‚\nå¦‚æœèƒ½åœ¨æœåŠ¡å¯åŠ¨æ—¶ï¼Œè®©æœåŠ¡ä¸»åŠ¨å°†è‡ªå·±çš„ipå‘Šè¯‰nginxï¼Œç„¶ånginxè‡ªå·±ç”Ÿæˆè¿™æ ·çš„ä¸€ä¸ªé…ç½®å¹¶é‡æ–°åŠ è½½ï¼Œé‚£äº‹æƒ…å°±ç®€å•å¤šäº†ã€‚\nä¸ºäº†å®ç°è¿™æ ·ä¸€ä¸ªæœåŠ¡æ³¨å†Œçš„åŠŸèƒ½ï¼Œä¸å°‘å…¬å¸éƒ½ä¼šåŸºäºnginxè¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚\nä½†å¦‚æœè¿™ä¸ªæœåŠ¡æ³¨å†ŒåŠŸèƒ½æœ‰é—®é¢˜ï¼Œæ¯”æ–¹è¯´æœåŠ¡å¯åŠ¨åï¼Œæ–°æœåŠ¡æ²¡æ³¨å†Œä¸Šï¼Œä½†è€æœåŠ¡å·²ç»è¢«é”€æ¯äº†ã€‚è¿™æ—¶å€™nginxè¿˜å°†è¯·æ±‚æ‰“åˆ°è€æœåŠ¡çš„IPä¸Šï¼Œç”±äºè€æœåŠ¡æ‰€åœ¨çš„æœºå™¨å·²ç»æ²¡æœ‰è¿™ä¸ªæœåŠ¡äº†ï¼Œæ‰€ä»¥æœåŠ¡å™¨å†…æ ¸å°±ä¼šå“åº”RSTï¼Œnginxæ”¶åˆ°RSTåå›å¤502ç»™å®¢æˆ·ç«¯ã€‚\nè¦æ’æŸ¥è¿™ç§é—®é¢˜ä¹Ÿä¸éš¾ã€‚\nè¿™ä¸ªæ—¶å€™ï¼Œä½ å¯ä»¥çœ‹ä¸‹nginxä¾§æ˜¯å¦æœ‰æ‰“å°ç›¸å…³çš„æ—¥å¿—ï¼Œçœ‹ä¸‹è½¬å‘çš„IPç«¯å£æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚\nå¦‚æœä¸ç¬¦åˆé¢„æœŸï¼Œå¯ä»¥å»æ‰¾æ‰¾åšè¿™ä¸ªåŸºç¡€ç»„ä»¶çš„åŒäº‹ï¼Œè¿›è¡Œä¸€æ³¢å‹å¥½çš„äº¤æµã€‚\næ€»ç»“ HTTPçŠ¶æ€ç ç”¨æ¥è¡¨ç¤ºå“åº”ç»“æœçš„çŠ¶æ€ï¼Œå…¶ä¸­200æ˜¯æ­£å¸¸å“åº”ï¼Œ4xxæ˜¯å®¢æˆ·ç«¯é”™è¯¯ï¼Œ5xxæ˜¯æœåŠ¡ç«¯é”™è¯¯ã€‚ å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´åŠ å…¥nginxï¼Œå¯ä»¥èµ·åˆ°åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡çš„ä½œç”¨ï¼Œå®¢æˆ·ç«¯åªç®¡å‘nginxè¯·æ±‚æ•°æ®ï¼Œå¹¶ä¸å…³å¿ƒè¿™ä¸ªè¯·æ±‚å…·ä½“ç”±å“ªä¸ªæœåŠ¡å™¨æ¥å¤„ç†ã€‚ åç«¯æœåŠ¡ç«¯åº”ç”¨å¦‚æœå‘ç”Ÿå´©æºƒï¼Œnginxåœ¨è®¿é—®æœåŠ¡ç«¯æ—¶ä¼šæ”¶åˆ°æœåŠ¡ç«¯è¿”å›çš„RSTæŠ¥æ–‡ï¼Œç„¶åç»™å®¢æˆ·ç«¯è¿”å›502æŠ¥é”™ã€‚502å¹¶ä¸æ˜¯æœåŠ¡ç«¯åº”ç”¨å‘å‡ºçš„ï¼Œè€Œæ˜¯nginxå‘å‡ºçš„ã€‚å› æ­¤å‘ç”Ÿ502æ—¶ï¼Œåç«¯æœåŠ¡ç«¯å¾ˆå¯èƒ½æ²¡æœ‰æ²¡æœ‰ç›¸å…³çš„502æ—¥å¿—ï¼Œéœ€è¦åœ¨nginxä¾§æ‰èƒ½çœ‹åˆ°è¿™æ¡502æ—¥å¿—ã€‚ å¦‚æœå‘ç°502ï¼Œä¼˜å…ˆé€šè¿‡ç›‘æ§æ’æŸ¥æœåŠ¡ç«¯åº”ç”¨æ˜¯å¦å‘ç”Ÿè¿‡å´©æºƒé‡å¯ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå†çœ‹ä¸‹æ˜¯å¦ç•™ä¸‹è¿‡å´©æºƒå †æ ˆæ—¥å¿—ï¼Œå¦‚æœæ²¡æœ‰æ—¥å¿—ï¼Œçœ‹ä¸‹æ˜¯å¦å¯èƒ½æ˜¯oomæˆ–è€…æ˜¯å…¶ä»–åŸå› å¯¼è‡´è¿›ç¨‹ä¸»åŠ¨é€€å‡ºã€‚å¦‚æœè¿›ç¨‹ä¹Ÿæ²¡å´©æºƒè¿‡ï¼Œå»æ’æŸ¥ä¸‹nginxçš„æ—¥å¿—ï¼Œçœ‹ä¸‹æ˜¯å¦å°†è¯·æ±‚æ‰“åˆ°äº†æŸä¸ªä¸çŸ¥åIPç«¯å£ä¸Šã€‚ å‚è€ƒ åŸæ–‡ ","permalink":"https://reid00.github.io/en/posts/os_network/http-502-%E9%97%AE%E9%A2%98-%E6%8E%92%E6%9F%A5/","summary":"å‰è¨€ åˆšå·¥ä½œé‚£ä¼šï¼Œæœ‰ä¸€æ¬¡ï¼Œä¸Šæ¸¸è°ƒç”¨æˆ‘æœåŠ¡çš„è€å“¥è¯´ï¼Œä½ çš„æœåŠ¡æŠ¥\u0026quot;502é”™è¯¯äº†ï¼Œå¿«å»çœ‹çœ‹æ˜¯ä¸ºä»€ä¹ˆå§\u0026quot;ã€‚\nå½“æ—¶é‚£ä¸ªæœåŠ¡é‡Œæ­£å¥½æœ‰ä¸ªè°ƒç”¨æ—¥å¿—ï¼Œå¹³æ—¶ä¼šè®°å½•å„ç§200,4xxçŠ¶æ€ç çš„ä¿¡æ¯ã€‚äºæ˜¯æˆ‘è·‘åˆ°æœåŠ¡æ—¥å¿—é‡Œå»æœç´¢äº†ä¸€ä¸‹502è¿™ä¸ªæ•°å­—ï¼Œæ¯«æ— å‘ç°ã€‚äºæ˜¯è·Ÿè€å“¥è¯´ï¼Œ\u0026quot;æœåŠ¡æ—¥å¿—é‡Œå¹¶æ²¡æœ‰502çš„è®°å½•ï¼Œä½ æ˜¯ä¸æ˜¯æé”™å•¦ï¼Ÿ\u0026quot;\nç°åœ¨æƒ³æ¥ï¼Œå¤šå°‘æœ‰äº›ä¸å¥½æ„æ€ã€‚\nä¸çŸ¥é“æœ‰å¤šå°‘è€å“¥æ˜¯è·Ÿå½“æ—¶çš„æˆ‘æ˜¯ä¸€æ ·çš„ï¼Œè¿™ç¯‡æ–‡ç« ï¼Œå°±æ¥èŠèŠ502é”™è¯¯æ˜¯ä»€ä¹ˆï¼Ÿ\næˆ‘ä»¬ä»çŠ¶æ€ç æ˜¯ä»€ä¹ˆå¼€å§‹èŠèµ·ã€‚\nHTTPçŠ¶æ€ç  æˆ‘ä»¬å¹³æ—¶åœ¨æµè§ˆå™¨é‡Œé€›çš„æŸå®å’ŒæŸåº¦ï¼Œå…¶å®éƒ½æ˜¯ä¸€ä¸ªä¸ªå‰ç«¯ç½‘é¡µã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œå‰ç«¯å¹¶ä¸å­˜å‚¨å¤ªå¤šæ•°æ®ï¼Œå¤§éƒ¨åˆ†æ—¶å€™éƒ½éœ€è¦ä»åç«¯æœåŠ¡å™¨é‚£è·å–æ•°æ®ã€‚ äºæ˜¯å‰åç«¯ä¹‹é—´éœ€è¦é€šè¿‡TCPåè®®å»å»ºç«‹è¿æ¥ï¼Œç„¶ååœ¨TCPçš„åŸºç¡€ä¸Šä¼ è¾“æ•°æ®ã€‚\nè€ŒTCPæ˜¯åŸºäºæ•°æ®æµçš„åè®®ï¼Œä¼ è¾“æ•°æ®æ—¶ï¼Œå¹¶ä¸ä¼šä¸ºæ¯ä¸ªæ¶ˆæ¯åŠ å…¥æ•°æ®è¾¹ç•Œï¼Œç›´æ¥ä½¿ç”¨è£¸çš„TCPè¿›è¡Œæ•°æ®ä¼ è¾“ä¼šæœ‰\u0026quot;ç²˜åŒ…\u0026quot;é—®é¢˜ã€‚\nå› æ­¤éœ€è¦ç”¨ç‰¹åœ°çš„åè®®æ ¼å¼å»å¯¹æ•°æ®è¿›è¡Œè§£æã€‚äºæ˜¯åœ¨æ­¤åŸºç¡€ä¸Šè®¾è®¡äº†HTTPåè®®ã€‚è¯¦ç»†çš„å†…å®¹å¯ä»¥çœ‹æˆ‘ä¹‹å‰å†™çš„ã€Šæ—¢ç„¶æœ‰HTTPåè®®ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰RPCã€‹ã€‚\næ¯”å¦‚ï¼Œæˆ‘æƒ³è¦çœ‹æŸä¸ªå•†å“çš„å…·ä½“ä¿¡æ¯ï¼Œå…¶å®å°±æ˜¯å‰ç«¯å‘çš„HTTPè¯·æ±‚ä¸­ä¼ å…¥å•†å“çš„idï¼Œåç«¯è¿”å›çš„HTTPå“åº”ä¸­è¿”å›å•†å“çš„ä»·æ ¼ï¼Œå•†åº—åï¼Œå‘è´§åœ°å€çš„ä¿¡æ¯ç­‰ã€‚\nè¿™æ ·ï¼Œè¡¨é¢ä¸Šï¼Œæˆ‘ä»¬æ˜¯åœ¨åˆ·ç€å„ç§ç½‘é¡µï¼Œå®é™…ä¸ŠèƒŒåæ­£æœ‰å¤šæ¬¡HTTPæ¶ˆæ¯åœ¨ä¸æ–­è¿›è¡Œæ”¶å‘ã€‚\nä½†é—®é¢˜å°±æ¥äº†ï¼Œä¸Šé¢æåˆ°çš„éƒ½æ˜¯æ­£å¸¸æƒ…å†µï¼Œå¦‚æœæœ‰å¼‚å¸¸æƒ…å†µå‘¢ï¼Œæ¯”å¦‚å‰ç«¯å‘çš„æ•°æ®ï¼Œæ ¹æœ¬å°±ä¸æ˜¯ä¸ªå•†å“idï¼Œè€Œæ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œè¿™å¯¹äºåç«¯æœåŠ¡ç«¯æ¥è¯´æ˜¯ä¸å¯èƒ½ç»™å‡ºæ­£å¸¸å“åº”çš„ï¼Œäºæ˜¯å°±éœ€è¦è®¾è®¡ä¸€å¥—HTTPçŠ¶æ€ç ï¼Œç”¨æ¥æ ‡è¯†è¿™æ¬¡HTTPè¯·æ±‚å“åº”æµç¨‹æ˜¯å¦æ­£å¸¸ã€‚é€šè¿‡è¿™ä¸ªå¯ä»¥å½±å“æµè§ˆå™¨çš„è¡Œä¸ºã€‚\næ¯”æ–¹è¯´ä¸€åˆ‡æ­£å¸¸ï¼Œé‚£æœåŠ¡ç«¯è¿”å›ä¸ª200çŠ¶æ€ç ï¼Œå‰ç«¯æ”¶åˆ°åï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨å“åº”çš„æ•°æ®ã€‚ä½†å¦‚æœæœåŠ¡ç«¯å‘ç°å®¢æˆ·ç«¯å‘çš„ä¸œè¥¿å¼‚å¸¸ï¼Œå°±å“åº”ä¸ª4xxçŠ¶æ€ç ï¼Œæ„æ€æ˜¯è¿™æ˜¯ä¸ªå®¢æˆ·ç«¯çš„é”™è¯¯ï¼Œ4xxé‡Œå¤´çš„xxå¯ä»¥æ ¹æ®é”™è¯¯çš„ç±»å‹ï¼Œå†ç»†åˆ†æˆå„ç§ç ï¼Œæ¯”å¦‚401æ˜¯å®¢æˆ·ç«¯æ²¡æƒé™ï¼Œ404æ˜¯å®¢æˆ·ç«¯è¯·æ±‚äº†ä¸€ä¸ªæ ¹æœ¬ä¸å­˜åœ¨çš„ç½‘é¡µã€‚åè¿‡æ¥ï¼Œå¦‚æœæ˜¯æœåŠ¡å™¨æœ‰é—®é¢˜ï¼Œå°±è¿”å›5xxçŠ¶æ€ç ã€‚\nä½†é—®é¢˜å°±æ¥äº†ã€‚ æœåŠ¡ç«¯éƒ½æœ‰é—®é¢˜äº†ï¼Œæä¸¥é‡ç‚¹ï¼ŒæœåŠ¡å™¨å¯èƒ½ç›´æ¥å°±å´©æºƒäº†ï¼Œé‚£å®ƒè¿˜æ€ä¹ˆç»™ä½ è¿”å›çŠ¶æ€ç ï¼Ÿ æ˜¯çš„ï¼Œè¿™ç§æƒ…å†µï¼ŒæœåŠ¡ç«¯æ˜¯ä¸å¯èƒ½ç»™å®¢æˆ·ç«¯è¿”å›çŠ¶æ€ç çš„ã€‚æ‰€ä»¥è¯´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹5xxçš„çŠ¶æ€ç å…¶å®å¹¶ä¸æ˜¯æœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„ã€‚ å®ƒä»¬æ˜¯ç”±ç½‘å…³è¿”å›çš„ï¼Œå¸¸è§çš„ç½‘å…³ï¼Œæ¯”å¦‚nginxã€‚\nnginxçš„ä½œç”¨ å›åˆ°å‰åç«¯äº¤äº’æ•°æ®çš„è¯é¢˜ä¸Šï¼Œå¦‚æœå‰ç«¯ç”¨æˆ·å°‘ï¼Œé‚£åç«¯å¤„ç†èµ·è¯·æ±‚æ¥ï¼Œæ¸¸åˆƒæœ‰ä½™ã€‚ä½†éšç€ç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼Œåç«¯æœåŠ¡å™¨å—èµ„æºé™åˆ¶ï¼Œcpuæˆ–è€…å†…å­˜éƒ½å¯èƒ½ä¼šä¸¥é‡ä¸è¶³ï¼Œè¿™æ—¶å€™è§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆç®€å•ï¼Œå¤šæå‡ å°ä¸€æ ·çš„æœåŠ¡å™¨ï¼Œè¿™æ ·å°±èƒ½å°†è¿™äº›å‰ç«¯è¯·æ±‚å‡æ‘Šç»™å‡ ä¸ªæœåŠ¡å™¨ï¼Œä»è€Œæå‡å¤„ç†èƒ½åŠ›ã€‚\nä½†è¦å®ç°è¿™æ ·çš„æ•ˆæœï¼Œå‰ç«¯å°±å¾—çŸ¥é“åç«¯å…·ä½“æœ‰å“ªäº›ä¸ªæœåŠ¡å™¨ï¼Œå¹¶ä¸€ä¸€è·Ÿä»–ä»¬å»ºç«‹TCPè¿æ¥ã€‚\nä¹Ÿä¸æ˜¯ä¸è¡Œï¼Œä½†å°±æ˜¯éº»çƒ¦ã€‚\nä½†è¿™æ—¶å€™å¦‚æœèƒ½æœ‰ä¸ªä¸­é—´å±‚æŒ¡åœ¨å®ƒä»¬ä¸­é—´å°±å¥½äº†ï¼Œè¿™æ ·å®¢æˆ·ç«¯åªéœ€è¦è·Ÿä¸­é—´å±‚è¿æ¥ï¼Œä¸­é—´å±‚å†å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚\näºæ˜¯ï¼Œè¿™ä¸ªä¸­é—´å±‚å°±æˆäº†è¿™å¸®æœåŠ¡å™¨çš„ä¸€ä¸ªä»£ç†äººä¸€æ ·ï¼Œå®¢æˆ·ç«¯æœ‰å•¥äº‹éƒ½æ‰¾ä»£ç†äººï¼Œåªç®¡å‘å‡ºè‡ªå·±çš„è¯·æ±‚ï¼Œå†ç”±ä»£ç†äººå»æ‰¾æŸä¸ªæœåŠ¡å™¨å»å®Œæˆå“åº”ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸‹æ¥ï¼Œå®¢æˆ·ç«¯åªçŸ¥é“è‡ªå·±çš„è¯·æ±‚è¢«ä»£ç†äººå¸®å¿™æå®šäº†ï¼Œä½†ä»£ç†äººå…·ä½“æ‰¾äº†é‚£ä¸ªæœåŠ¡å™¨å»å®Œæˆï¼Œå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“ï¼Œä¹Ÿä¸éœ€è¦çŸ¥é“ã€‚\nåƒè¿™ç§ï¼Œå±è”½æ‰å…·ä½“æœ‰å“ªäº›æœåŠ¡å™¨çš„ä»£ç†æ–¹å¼å°±æ˜¯æ‰€è°“çš„åå‘ä»£ç†ã€‚\nåè¿‡æ¥ï¼Œå±è”½æ‰å…·ä½“æœ‰å“ªäº›å®¢æˆ·ç«¯çš„ä»£ç†æ–¹å¼ï¼Œå°±æ˜¯æ‰€è°“çš„æ­£å‘ä»£ç†ã€‚\nè€Œè¿™ä¸ªä¸­é—´å±‚çš„è§’è‰²ï¼Œä¸€èˆ¬ç”±nginxè¿™ç±»ç½‘å…³æ¥å……å½“ã€‚\nå¦å¤–ï¼Œç”±äºèƒŒåçš„æœåŠ¡å™¨å¯èƒ½æ€§èƒ½é…ç½®å„ä¸ç›¸åŒï¼Œæœ‰äº›4æ ¸8Gï¼Œæœ‰äº›2æ ¸4Gï¼Œnginxèƒ½ä¸ºå®ƒä»¬åŠ ä¸Šä¸åŒçš„è®¿é—®æƒé‡ï¼Œæƒé‡é«˜çš„å¤šè½¬å‘ç‚¹è¯·æ±‚ï¼Œé€šè¿‡è¿™ä¸ªæ–¹å¼å®ç°ä¸åŒçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚\nnginxè¿”å›5xxçŠ¶æ€ç  æœ‰äº†nginxè¿™ä¸€ä¸­é—´å±‚åï¼Œå®¢æˆ·ç«¯ä»ç›´è¿æœåŠ¡ç«¯ï¼Œå˜æˆå®¢æˆ·ç«¯ç›´è¿nginxï¼Œå†ç”±nginxç›´è¿æœåŠ¡ç«¯ã€‚ä»ä¸€ä¸ªTCPè¿æ¥å˜æˆä¸¤ä¸ªTCPè¿æ¥ã€‚\näºæ˜¯ï¼Œå½“æœåŠ¡å™¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œnginxå‘é€ç»™æœåŠ¡å™¨çš„é‚£æ¡TCPè¿æ¥å°±ä¸èƒ½æ­£å¸¸å“åº”ï¼Œnginxåœ¨å¾—åˆ°è¿™ä¸€ä¿¡æ¯åï¼Œå°±ä¼šè¿”å›5xxé”™è¯¯ç ç»™å®¢æˆ·ç«¯ï¼Œä¹Ÿå°±æ˜¯è¯´5xxçš„æŠ¥é”™ï¼Œå…¶å®æ˜¯ç”±nginxè¯†åˆ«å‡ºæ¥ï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯çš„ï¼ŒæœåŠ¡ç«¯æœ¬èº«ï¼Œå¹¶ä¸ä¼šæœ‰5xxçš„æ—¥å¿—ä¿¡æ¯ã€‚æ‰€ä»¥æ‰ä¼šå‡ºç°æ–‡ç« å¼€å¤´çš„ä¸€å¹•ï¼Œä¸Šæ¸¸æ”¶åˆ°äº†æˆ‘æœåŠ¡çš„502æŠ¥é”™ï¼Œä½†æˆ‘åœ¨è‡ªå·±çš„æœåŠ¡æ—¥å¿—é‡Œå´æœç´¢ä¸åˆ°è¿™ä¸€ä¿¡æ¯ã€‚\näº§ç”Ÿ502çš„å¸¸è§åŸå›  åœ¨rfc7231ä¸­æœ‰å…³äº502é”™è¯¯ç çš„å®˜æ–¹è§£é‡Šæ˜¯\n1 2 502 Bad Gateway The 502 (Bad Gateway) status code indicates that the server, while acting as a gateway or proxy, received an invalid response from an inbound server it accessed while attempting to fulfill the request.","title":"Http 502 é—®é¢˜ æ’æŸ¥"},{"content":"ä»‹ç» äº‹å®ä¸Šï¼Œè¿™ä¸¤ä¸ªå®Œå…¨æ˜¯ä¸¤æ ·ä¸åŒä¸œè¥¿ï¼Œå®ç°çš„å±‚é¢ä¹Ÿä¸åŒï¼š\nHTTP çš„ Keep-Aliveï¼Œæ˜¯ç”±åº”ç”¨å±‚ï¼ˆç”¨æˆ·æ€ï¼‰ å®ç°çš„ï¼Œç§°ä¸º HTTP é•¿è¿æ¥ï¼› TCP çš„ Keepaliveï¼Œæ˜¯ç”± TCP å±‚ï¼ˆå†…æ ¸æ€ï¼‰ å®ç°çš„ï¼Œç§°ä¸º TCP ä¿æ´»æœºåˆ¶ï¼› æ¥ä¸‹æ¥ï¼Œåˆ†åˆ«è¯´è¯´å®ƒä»¬ã€‚\nHTTP çš„ Keep-Alive HTTP åè®®é‡‡ç”¨çš„æ˜¯ã€Œè¯·æ±‚-åº”ç­”ã€çš„æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯å‘èµ·äº†è¯·æ±‚ï¼ŒæœåŠ¡ç«¯æ‰ä¼šè¿”å›å“åº”ï¼Œä¸€æ¥ä¸€å›è¿™æ ·å­ã€‚\nç”±äº HTTP æ˜¯åŸºäº TCP ä¼ è¾“åè®®å®ç°çš„ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¦è¿›è¡Œ HTTP é€šä¿¡å‰ï¼Œéœ€è¦å…ˆå»ºç«‹ TCP è¿æ¥ï¼Œç„¶åå®¢æˆ·ç«¯å‘é€ HTTP è¯·æ±‚ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°åå°±è¿”å›å“åº”ï¼Œè‡³æ­¤ã€Œè¯·æ±‚-åº”ç­”ã€çš„æ¨¡å¼å°±å®Œæˆäº†ï¼Œéšåå°±ä¼šé‡Šæ”¾ TCP è¿æ¥ã€‚\nå¦‚æœæ¯æ¬¡è¯·æ±‚éƒ½è¦ç»å†è¿™æ ·çš„è¿‡ç¨‹ï¼šå»ºç«‹ TCP -\u0026gt; è¯·æ±‚èµ„æº -\u0026gt; å“åº”èµ„æº -\u0026gt; é‡Šæ”¾è¿æ¥ï¼Œé‚£ä¹ˆæ­¤æ–¹å¼å°±æ˜¯ HTTP çŸ­è¿æ¥ï¼Œå¦‚ä¸‹å›¾ï¼š\nè¿™æ ·å®åœ¨å¤ªç´¯äººäº†ï¼Œä¸€æ¬¡è¿æ¥åªèƒ½è¯·æ±‚ä¸€æ¬¡èµ„æºã€‚\nèƒ½ä¸èƒ½åœ¨ç¬¬ä¸€ä¸ª HTTP è¯·æ±‚å®Œåï¼Œå…ˆä¸æ–­å¼€ TCP è¿æ¥ï¼Œè®©åç»­çš„ HTTP è¯·æ±‚ç»§ç»­ä½¿ç”¨æ­¤è¿æ¥ï¼Ÿ\nå½“ç„¶å¯ä»¥ï¼ŒHTTP çš„ Keep-Alive å°±æ˜¯å®ç°äº†è¿™ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ª TCP è¿æ¥æ¥å‘é€å’Œæ¥æ”¶å¤šä¸ª HTTP è¯·æ±‚/åº”ç­”ï¼Œé¿å…äº†è¿æ¥å»ºç«‹å’Œé‡Šæ”¾çš„å¼€é”€ï¼Œè¿™ä¸ªæ–¹æ³•ç§°ä¸º HTTP é•¿è¿æ¥ã€‚\nHTTP é•¿è¿æ¥çš„ç‰¹ç‚¹æ˜¯ï¼Œåªè¦ä»»æ„ä¸€ç«¯æ²¡æœ‰æ˜ç¡®æå‡ºæ–­å¼€è¿æ¥ï¼Œåˆ™ä¿æŒ TCP è¿æ¥çŠ¶æ€ã€‚\næ€ä¹ˆæ‰èƒ½ä½¿ç”¨ HTTP çš„ Keep-Alive åŠŸèƒ½ï¼Ÿ\nåœ¨ HTTP 1.0 ä¸­é»˜è®¤æ˜¯å…³é—­çš„ï¼Œå¦‚æœæµè§ˆå™¨è¦å¼€å¯ Keep-Aliveï¼Œå®ƒå¿…é¡»åœ¨è¯·æ±‚çš„åŒ…å¤´ä¸­æ·»åŠ ï¼š\n1 Connection: Keep-Alive ç„¶åå½“æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä½œå‡ºå›åº”çš„æ—¶å€™ï¼Œå®ƒä¹Ÿæ·»åŠ ä¸€ä¸ªå¤´åœ¨å“åº”ä¸­ï¼š\n1 Connection: Keep-Alive è¿™æ ·åšï¼Œè¿æ¥å°±ä¸ä¼šä¸­æ–­ï¼Œè€Œæ˜¯ä¿æŒè¿æ¥ã€‚å½“å®¢æˆ·ç«¯å‘é€å¦ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå®ƒä¼šä½¿ç”¨åŒä¸€ä¸ªè¿æ¥ã€‚è¿™ä¸€ç›´ç»§ç»­åˆ°å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ç«¯æå‡ºæ–­å¼€è¿æ¥ã€‚\nä» HTTP 1.1 å¼€å§‹ï¼Œ å°±é»˜è®¤æ˜¯å¼€å¯äº† Keep-Aliveï¼Œå¦‚æœè¦å…³é—­ Keep-Aliveï¼Œéœ€è¦åœ¨ HTTP è¯·æ±‚çš„åŒ…å¤´é‡Œæ·»åŠ ï¼š\n1 Connection:close ç°åœ¨å¤§å¤šæ•°æµè§ˆå™¨éƒ½é»˜è®¤æ˜¯ä½¿ç”¨ HTTP/1.1ï¼Œæ‰€ä»¥ Keep-Alive éƒ½æ˜¯é»˜è®¤æ‰“å¼€çš„ã€‚ä¸€æ—¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¾¾æˆåè®®ï¼Œé‚£ä¹ˆé•¿è¿æ¥å°±å»ºç«‹å¥½äº†ã€‚\nHTTP é•¿è¿æ¥ä¸ä»…ä»…å‡å°‘äº† TCP è¿æ¥èµ„æºçš„å¼€é”€ï¼Œè€Œä¸”è¿™ç»™ HTTP æµæ°´çº¿æŠ€æœ¯æä¾›äº†å¯å®ç°çš„åŸºç¡€ã€‚\næ‰€è°“çš„ HTTP æµæ°´çº¿ï¼Œæ˜¯å®¢æˆ·ç«¯å¯ä»¥å…ˆä¸€æ¬¡æ€§å‘é€å¤šä¸ªè¯·æ±‚ï¼Œè€Œåœ¨å‘é€è¿‡ç¨‹ä¸­ä¸éœ€å…ˆç­‰å¾…æœåŠ¡å™¨çš„å›åº”ï¼Œå¯ä»¥å‡å°‘æ•´ä½“çš„å“åº”æ—¶é—´ã€‚\nä¸¾ä¾‹æ¥è¯´ï¼Œå®¢æˆ·ç«¯éœ€è¦è¯·æ±‚ä¸¤ä¸ªèµ„æºã€‚ä»¥å‰çš„åšæ³•æ˜¯ï¼Œåœ¨åŒä¸€ä¸ª TCP è¿æ¥é‡Œé¢ï¼Œå…ˆå‘é€ A è¯·æ±‚ï¼Œç„¶åç­‰å¾…æœåŠ¡å™¨åšå‡ºå›åº”ï¼Œæ”¶åˆ°åå†å‘å‡º B è¯·æ±‚ã€‚HTTP æµæ°´çº¿æœºåˆ¶åˆ™å…è®¸å®¢æˆ·ç«¯åŒæ—¶å‘å‡º A è¯·æ±‚å’Œ B è¯·æ±‚ã€‚\nä½†æ˜¯æœåŠ¡å™¨è¿˜æ˜¯æŒ‰ç…§é¡ºåºå“åº”ï¼Œå…ˆå›åº” A è¯·æ±‚ï¼Œå®Œæˆåå†å›åº” B è¯·æ±‚ã€‚\nè€Œä¸”è¦ç­‰æœåŠ¡å™¨å“åº”å®Œå®¢æˆ·ç«¯ç¬¬ä¸€æ‰¹å‘é€çš„è¯·æ±‚åï¼Œå®¢æˆ·ç«¯æ‰èƒ½å‘å‡ºä¸‹ä¸€æ‰¹çš„è¯·æ±‚ï¼Œä¹Ÿå°±è¯´å¦‚æœæœåŠ¡å™¨å“åº”çš„è¿‡ç¨‹å‘ç”Ÿäº†é˜»å¡ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å°±æ— æ³•å‘å‡ºä¸‹ä¸€æ‰¹çš„è¯·æ±‚ï¼Œæ­¤æ—¶å°±é€ æˆäº†ã€Œé˜Ÿå¤´é˜»å¡ã€çš„é—®é¢˜ã€‚\nå¯èƒ½æœ‰çš„åŒå­¦ä¼šé—®ï¼Œå¦‚æœä½¿ç”¨äº† HTTP é•¿è¿æ¥ï¼Œå¦‚æœå®¢æˆ·ç«¯å®Œæˆä¸€ä¸ª HTTP è¯·æ±‚åï¼Œå°±ä¸å†å‘èµ·æ–°çš„è¯·æ±‚ï¼Œæ­¤æ—¶è¿™ä¸ª TCP è¿æ¥ä¸€ç›´å ç”¨ç€ä¸æ˜¯æŒºæµªè´¹èµ„æºçš„å—ï¼Ÿ\nå¯¹æ²¡é”™ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…èµ„æºæµªè´¹çš„æƒ…å†µï¼Œweb æœåŠ¡è½¯ä»¶ä¸€èˆ¬éƒ½ä¼šæä¾› keepalive_timeout å‚æ•°ï¼Œç”¨æ¥æŒ‡å®š HTTP é•¿è¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚\næ¯”å¦‚è®¾ç½®äº† HTTP é•¿è¿æ¥çš„è¶…æ—¶æ—¶é—´æ˜¯ 60 ç§’ï¼Œweb æœåŠ¡è½¯ä»¶å°±ä¼šå¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¦‚æœå®¢æˆ·ç«¯åœ¨å®Œåä¸€ä¸ª HTTP è¯·æ±‚åï¼Œåœ¨ 60 ç§’å†…éƒ½æ²¡æœ‰å†å‘èµ·æ–°çš„è¯·æ±‚ï¼Œå®šæ—¶å™¨çš„æ—¶é—´ä¸€åˆ°ï¼Œå°±ä¼šè§¦å‘å›è°ƒå‡½æ•°æ¥é‡Šæ”¾è¯¥è¿æ¥ã€‚\nTCP çš„ Keepalive TCP çš„ Keepalive è¿™ä¸œè¥¿å…¶å®å°±æ˜¯ TCP çš„ä¿æ´»æœºåˆ¶ï¼Œå®ƒçš„å·¥ä½œåŸç†æˆ‘ä¹‹å‰çš„æ–‡ç« å†™è¿‡ï¼Œè¿™é‡Œå°±ç›´æ¥è´´ä¸‹ä»¥å‰çš„å†…å®¹ã€‚\nå¦‚æœä¸¤ç«¯çš„ TCP è¿æ¥ä¸€ç›´æ²¡æœ‰æ•°æ®äº¤äº’ï¼Œè¾¾åˆ°äº†è§¦å‘ TCP ä¿æ´»æœºåˆ¶çš„æ¡ä»¶ï¼Œé‚£ä¹ˆå†…æ ¸é‡Œçš„ TCP åè®®æ ˆå°±ä¼šå‘é€æ¢æµ‹æŠ¥æ–‡ã€‚\nå¦‚æœå¯¹ç«¯ç¨‹åºæ˜¯æ­£å¸¸å·¥ä½œçš„ã€‚å½“ TCP ä¿æ´»çš„æ¢æµ‹æŠ¥æ–‡å‘é€ç»™å¯¹ç«¯, å¯¹ç«¯ä¼šæ­£å¸¸å“åº”ï¼Œè¿™æ · TCP ä¿æ´»æ—¶é—´ä¼šè¢«é‡ç½®ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ª TCP ä¿æ´»æ—¶é—´çš„åˆ°æ¥ã€‚ å¦‚æœå¯¹ç«¯ä¸»æœºå´©æºƒï¼Œæˆ–å¯¹ç«¯ç”±äºå…¶ä»–åŸå› å¯¼è‡´æŠ¥æ–‡ä¸å¯è¾¾ã€‚å½“ TCP ä¿æ´»çš„æ¢æµ‹æŠ¥æ–‡å‘é€ç»™å¯¹ç«¯åï¼ŒçŸ³æ²‰å¤§æµ·ï¼Œæ²¡æœ‰å“åº”ï¼Œè¿ç»­å‡ æ¬¡ï¼Œè¾¾åˆ°ä¿æ´»æ¢æµ‹æ¬¡æ•°åï¼ŒTCP ä¼šæŠ¥å‘Šè¯¥ TCP è¿æ¥å·²ç»æ­»äº¡ã€‚ æ‰€ä»¥ï¼ŒTCP ä¿æ´»æœºåˆ¶å¯ä»¥åœ¨åŒæ–¹æ²¡æœ‰æ•°æ®äº¤äº’çš„æƒ…å†µï¼Œé€šè¿‡æ¢æµ‹æŠ¥æ–‡ï¼Œæ¥ç¡®å®šå¯¹æ–¹çš„ TCP è¿æ¥æ˜¯å¦å­˜æ´»ï¼Œè¿™ä¸ªå·¥ä½œæ˜¯åœ¨å†…æ ¸å®Œæˆçš„ã€‚\næ³¨æ„ï¼Œåº”ç”¨ç¨‹åºè‹¥æƒ³ä½¿ç”¨ TCP ä¿æ´»æœºåˆ¶éœ€è¦é€šè¿‡ socket æ¥å£è®¾ç½® SO_KEEPALIVE é€‰é¡¹æ‰èƒ½å¤Ÿç”Ÿæ•ˆï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé‚£ä¹ˆå°±æ— æ³•ä½¿ç”¨ TCP ä¿æ´»æœºåˆ¶ã€‚\næ€»ç»“ HTTP çš„ Keep-Alive ä¹Ÿå« HTTP é•¿è¿æ¥ï¼Œè¯¥åŠŸèƒ½æ˜¯ç”±ã€Œåº”ç”¨ç¨‹åºã€å®ç°çš„ï¼Œå¯ä»¥ä½¿å¾—ç”¨åŒä¸€ä¸ª TCP è¿æ¥æ¥å‘é€å’Œæ¥æ”¶å¤šä¸ª HTTP è¯·æ±‚/åº”ç­”ï¼Œå‡å°‘äº† HTTP çŸ­è¿æ¥å¸¦æ¥çš„å¤šæ¬¡ TCP è¿æ¥å»ºç«‹å’Œé‡Šæ”¾çš„å¼€é”€ã€‚\nTCP çš„ Keepalive ä¹Ÿå« TCP ä¿æ´»æœºåˆ¶ï¼Œè¯¥åŠŸèƒ½æ˜¯ç”±ã€Œå†…æ ¸ã€å®ç°çš„ï¼Œå½“å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é•¿è¾¾ä¸€å®šæ—¶é—´æ²¡æœ‰è¿›è¡Œæ•°æ®äº¤äº’æ—¶ï¼Œå†…æ ¸ä¸ºäº†ç¡®ä¿è¯¥è¿æ¥æ˜¯å¦è¿˜æœ‰æ•ˆï¼Œå°±ä¼šå‘é€æ¢æµ‹æŠ¥æ–‡ï¼Œæ¥æ£€æµ‹å¯¹æ–¹æ˜¯å¦è¿˜åœ¨çº¿ï¼Œç„¶åæ¥å†³å®šæ˜¯å¦è¦å…³é—­è¯¥è¿æ¥ã€‚\nåŸæ–‡\n","permalink":"https://reid00.github.io/en/posts/os_network/http%E9%95%BF%E8%BF%9E%E6%8E%A5%E5%92%8Ctcp%E9%95%BF%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%8C%BA%E5%88%AB/","summary":"ä»‹ç» äº‹å®ä¸Šï¼Œè¿™ä¸¤ä¸ªå®Œå…¨æ˜¯ä¸¤æ ·ä¸åŒä¸œè¥¿ï¼Œå®ç°çš„å±‚é¢ä¹Ÿä¸åŒï¼š\nHTTP çš„ Keep-Aliveï¼Œæ˜¯ç”±åº”ç”¨å±‚ï¼ˆç”¨æˆ·æ€ï¼‰ å®ç°çš„ï¼Œç§°ä¸º HTTP é•¿è¿æ¥ï¼› TCP çš„ Keepaliveï¼Œæ˜¯ç”± TCP å±‚ï¼ˆå†…æ ¸æ€ï¼‰ å®ç°çš„ï¼Œç§°ä¸º TCP ä¿æ´»æœºåˆ¶ï¼› æ¥ä¸‹æ¥ï¼Œåˆ†åˆ«è¯´è¯´å®ƒä»¬ã€‚\nHTTP çš„ Keep-Alive HTTP åè®®é‡‡ç”¨çš„æ˜¯ã€Œè¯·æ±‚-åº”ç­”ã€çš„æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯å‘èµ·äº†è¯·æ±‚ï¼ŒæœåŠ¡ç«¯æ‰ä¼šè¿”å›å“åº”ï¼Œä¸€æ¥ä¸€å›è¿™æ ·å­ã€‚\nç”±äº HTTP æ˜¯åŸºäº TCP ä¼ è¾“åè®®å®ç°çš„ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¦è¿›è¡Œ HTTP é€šä¿¡å‰ï¼Œéœ€è¦å…ˆå»ºç«‹ TCP è¿æ¥ï¼Œç„¶åå®¢æˆ·ç«¯å‘é€ HTTP è¯·æ±‚ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°åå°±è¿”å›å“åº”ï¼Œè‡³æ­¤ã€Œè¯·æ±‚-åº”ç­”ã€çš„æ¨¡å¼å°±å®Œæˆäº†ï¼Œéšåå°±ä¼šé‡Šæ”¾ TCP è¿æ¥ã€‚\nå¦‚æœæ¯æ¬¡è¯·æ±‚éƒ½è¦ç»å†è¿™æ ·çš„è¿‡ç¨‹ï¼šå»ºç«‹ TCP -\u0026gt; è¯·æ±‚èµ„æº -\u0026gt; å“åº”èµ„æº -\u0026gt; é‡Šæ”¾è¿æ¥ï¼Œé‚£ä¹ˆæ­¤æ–¹å¼å°±æ˜¯ HTTP çŸ­è¿æ¥ï¼Œå¦‚ä¸‹å›¾ï¼š\nè¿™æ ·å®åœ¨å¤ªç´¯äººäº†ï¼Œä¸€æ¬¡è¿æ¥åªèƒ½è¯·æ±‚ä¸€æ¬¡èµ„æºã€‚\nèƒ½ä¸èƒ½åœ¨ç¬¬ä¸€ä¸ª HTTP è¯·æ±‚å®Œåï¼Œå…ˆä¸æ–­å¼€ TCP è¿æ¥ï¼Œè®©åç»­çš„ HTTP è¯·æ±‚ç»§ç»­ä½¿ç”¨æ­¤è¿æ¥ï¼Ÿ\nå½“ç„¶å¯ä»¥ï¼ŒHTTP çš„ Keep-Alive å°±æ˜¯å®ç°äº†è¿™ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨åŒä¸€ä¸ª TCP è¿æ¥æ¥å‘é€å’Œæ¥æ”¶å¤šä¸ª HTTP è¯·æ±‚/åº”ç­”ï¼Œé¿å…äº†è¿æ¥å»ºç«‹å’Œé‡Šæ”¾çš„å¼€é”€ï¼Œè¿™ä¸ªæ–¹æ³•ç§°ä¸º HTTP é•¿è¿æ¥ã€‚\nHTTP é•¿è¿æ¥çš„ç‰¹ç‚¹æ˜¯ï¼Œåªè¦ä»»æ„ä¸€ç«¯æ²¡æœ‰æ˜ç¡®æå‡ºæ–­å¼€è¿æ¥ï¼Œåˆ™ä¿æŒ TCP è¿æ¥çŠ¶æ€ã€‚\næ€ä¹ˆæ‰èƒ½ä½¿ç”¨ HTTP çš„ Keep-Alive åŠŸèƒ½ï¼Ÿ","title":"Httpé•¿è¿æ¥å’ŒTCPé•¿è¿æ¥çš„åŒºåˆ«"},{"content":"1. Raft ç®—æ³•ç®€ä»‹ 1.1 Raft èƒŒæ™¯ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€è‡´æ€§ç®—æ³•è‡³å…³é‡è¦ã€‚åœ¨æ‰€æœ‰ä¸€è‡´æ€§ç®—æ³•ä¸­ï¼ŒPaxos æœ€è´Ÿç››åï¼Œå®ƒç”±è±æ–¯åˆ©Â·å…°ä¼¯ç‰¹ï¼ˆLeslie Lamportï¼‰äº 1990 å¹´æå‡ºï¼Œæ˜¯ä¸€ç§åŸºäºæ¶ˆæ¯ä¼ é€’çš„ä¸€è‡´æ€§ç®—æ³•ï¼Œè¢«è®¤ä¸ºæ˜¯ç±»ä¼¼ç®—æ³•ä¸­æœ€æœ‰æ•ˆçš„ã€‚\nPaxos ç®—æ³•è™½ç„¶å¾ˆæœ‰æ•ˆï¼Œä½†å¤æ‚çš„åŸç†ä½¿å®ƒå®ç°èµ·æ¥éå¸¸å›°éš¾ï¼Œæˆªæ­¢ç›®å‰ï¼Œå®ç° Paxos ç®—æ³•çš„å¼€æºè½¯ä»¶å¾ˆå°‘ï¼Œæ¯”è¾ƒå‡ºåçš„æœ‰ Chubbyã€LibPaxosã€‚æ­¤å¤–ï¼ŒZookeeper é‡‡ç”¨çš„ ZABï¼ˆZookeeper Atomic Broadcastï¼‰åè®®ä¹Ÿæ˜¯åŸºäº Paxos ç®—æ³•å®ç°çš„ï¼Œä¸è¿‡ ZAB å¯¹ Paxos è¿›è¡Œäº†å¾ˆå¤šæ”¹è¿›ä¸ä¼˜åŒ–ï¼Œä¸¤è€…çš„è®¾è®¡ç›®æ ‡ä¹Ÿå­˜åœ¨å·®å¼‚â€”â€”ZAB åè®®ä¸»è¦ç”¨äºæ„å»ºä¸€ä¸ªé«˜å¯ç”¨çš„åˆ†å¸ƒå¼æ•°æ®ä¸»å¤‡ç³»ç»Ÿï¼Œè€Œ Paxos ç®—æ³•åˆ™æ˜¯ç”¨äºæ„å»ºä¸€ä¸ªåˆ†å¸ƒå¼çš„ä¸€è‡´æ€§çŠ¶æ€æœºç³»ç»Ÿã€‚\nç”±äº Paxos ç®—æ³•è¿‡äºå¤æ‚ã€å®ç°å›°éš¾ï¼Œæå¤§åœ°åˆ¶çº¦äº†å…¶åº”ç”¨ï¼Œè€Œåˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸåˆäºŸéœ€ä¸€ç§é«˜æ•ˆè€Œæ˜“äºå®ç°çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ï¼Œåœ¨æ­¤èƒŒæ™¯ä¸‹ï¼ŒRaft ç®—æ³•åº”è¿è€Œç”Ÿã€‚\nRaft ç®—æ³•åœ¨æ–¯å¦ç¦ Diego Ongaro å’Œ John Ousterhout äº 2013 å¹´å‘è¡¨çš„ã€ŠIn Search of an Understandable Consensus Algorithmã€‹ä¸­æå‡ºã€‚ç›¸è¾ƒäº Paxosï¼ŒRaft é€šè¿‡é€»è¾‘åˆ†ç¦»ä½¿å…¶æ›´å®¹æ˜“ç†è§£å’Œå®ç°ï¼Œç›®å‰ï¼Œå·²ç»æœ‰åå¤šç§è¯­è¨€çš„ Raft ç®—æ³•å®ç°æ¡†æ¶ï¼Œè¾ƒä¸ºå‡ºåçš„æœ‰ etcdã€Consul ã€‚\næœ¬æ–‡åŸºäºè®ºæ–‡In Search of an Understandable Consensus Algorithmå¯¹raftåè®®è¿›è¡Œåˆ†æï¼Œå½“ç„¶ï¼Œè¿˜æ˜¯å»ºè®®è¯»è€…ç›´æ¥çœ‹è®ºæ–‡ã€‚\nç›¸å…³é“¾æ¥:\nè®ºæ–‡ å®˜ç½‘ åŠ¨ç”»å±•ç¤º åˆ†å¸ƒå¼å…±è¯†ç®—æ³•æ ¸å¿ƒç†è®ºåŸºç¡€ åœ¨æ­£å¼è°ˆraftä¹‹å‰ï¼Œè¿˜éœ€è¦ç®€å•ä»‹ç»ä¸‹åˆ†å¸ƒå¼å…±è¯†ç®—æ³•æ‰€åŸºäºçš„ç†è®ºå·¥å…·ã€‚åˆ†å¸ƒå¼å…±è¯†åè®®åœ¨å¤åˆ¶çŠ¶æ€æœºçš„èƒŒæ™¯ä¸‹äº§ç”Ÿçš„ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œä¸€ç»„æœåŠ¡å™¨ä¸Šçš„çŠ¶æ€æœºè®¡ç®—ç›¸åŒçš„å‰¯æœ¬ï¼Œå³ä¾¿æŸå°æœºå™¨å®•æœºä¾ç„¶ä¼šç»§ç»­è¿è¡Œã€‚å¤åˆ¶çŠ¶æ€æœºæ˜¯åŸºäºæ—¥å¿—å®ç°çš„ã€‚åœ¨è¿™é‡Œæœ‰å¿…è¦å” å¨ä¸¤å¥æ—¥å¿—çš„ç‰¹æ€§ã€‚æ—¥å¿—å¯ä»¥çœ‹åšä¸€ä¸ªç®€å•çš„å­˜å‚¨æŠ½è±¡ï¼Œappend onlyï¼ŒæŒ‰ç…§æ—¶é—´å®Œå…¨æœ‰åºï¼Œæ³¨æ„è¿™é‡Œé¢çš„æ—¥å¿—å¹¶ä¸æ˜¯log4jæˆ–æ˜¯syslogæ‰“å‡ºæ¥çš„ä¸šåŠ¡æ—¥å¿—ï¼Œé‚£ä¸ªæˆ‘ä»¬ç§°ä¹‹ä¸ºåº”ç”¨æ—¥å¿—ï¼Œè¿™é‡Œçš„æ—¥å¿—æ˜¯ç”¨äºç¨‹åºè®¿é—®çš„å­˜å‚¨ç»“æ„ã€‚æœ‰äº†ä¸Šé¢çš„é™åˆ¶ï¼Œä½¿ç”¨æ—¥å¿—å°±èƒ½å¤Ÿä¿è¯è¿™æ ·ä¸€ä»¶äº‹ã€‚å¦‚å›¾æ‰€ç¤º æˆ‘æœ‰ä¸€ä¸ªæ—¥å¿—ï¼Œé‡Œé¢å­˜å‚¨çš„æ˜¯ä¸€ç³»åˆ—çš„å¯¹æ•°æ®çš„æ“ä½œï¼Œæ­¤æ—¶ç³»ç»Ÿå¤–éƒ¨æœ‰ä¸€ç³»åˆ—è¾“å…¥æ•°æ®ï¼Œè¾“å…¥åˆ°è¿™ä¸ªæ—¥å¿—ä¸­ï¼Œç»è¿‡æ—¥å¿—ä¸­ä¸€ç³»åˆ—commandæ“ä½œï¼Œç”±äºæ—¥å¿—çš„ç¡®å®šæ€§å’Œæœ‰åºæ€§ï¼Œä¿è¯æœ€åå¾—åˆ°çš„è¾“å‡ºåºåˆ—ä¹Ÿåº”è¯¥æ˜¯ç¡®å®šçš„ã€‚æ‰©å±•åˆ°åˆ†å¸ƒå¼çš„åœºæ™¯ï¼Œæ­¤æ—¶æ¯å°æœºå™¨ä¸Šæ‰€æœ‰äº†è¿™ä¹ˆä¸€ä¸ªæ—¥å¿—ï¼Œæ­¤æ—¶æˆ‘éœ€è¦åšçš„äº‹æƒ…å°±æ˜¯ä¿è¯è¿™å‡ ä»½æ—¥å¿—æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚è¯¦ç»†æ­¥éª¤å°±å¼•å‡ºäº†è®ºæ–‡ä¸­çš„é‚£å¼ ç»å…¸çš„å¤åˆ¶çŠ¶æ€æœºçš„ç¤ºæ„å›¾ å¦‚å›¾æ‰€ç¤ºï¼Œserverä¸­çš„å…±è¯†æ¨¡å—è´Ÿè´£æ¥æ”¶ç”±clientå‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œå°†è¯·æ±‚ä¸­å¯¹åº”çš„æ“ä½œè®°å½•åˆ°è‡ªå·±çš„æ—¥å¿—ä¸­ï¼ŒåŒæ—¶é€šçŸ¥ç»™å…¶ä»–æœºå™¨ï¼Œè®©ä»–ä»¬ä¹Ÿè¿›è¡ŒåŒæ ·çš„æ“ä½œæœ€ç»ˆä¿è¯æ‰€æœ‰çš„æœºå™¨éƒ½åœ¨æ—¥å¿—ä¸­å†™å…¥äº†è¿™æ¡æ“ä½œã€‚ç„¶åè¿”å›ç»™å®¢æˆ·ç«¯å†™å…¥æˆåŠŸã€‚å¤åˆ¶çŠ¶æ€æœºç”¨äºè§£å†³åˆ†å¸ƒå¼ä¸­ç³»ç»Ÿä¸­çš„å„ç§å®¹é”™é—®é¢˜ï¼Œä¾‹å¦‚masterçš„é«˜å¯ç”¨ï¼Œä¾‹å¦‚Chubbyä»¥åŠZKéƒ½æ˜¯å¤åˆ¶çŠ¶æ€æœºï¼Œ\nåˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ï¼Œé€šå¸¸æ»¡è¶³ä»¥ä¸‹æ€§è´¨ï¼š åœ¨éæ‹œå åº­é”™è¯¯ä¸‹ï¼Œä¿è¯å®‰å…¨æ€§(ä¸ä¼šè¿”å›ä¸æ­£ç¡®çš„ç»“æœ) å¤§å¤šæ•°æœºå™¨è¿è¡Œï¼Œç³»ç»Ÿå°±å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œå‘ç”Ÿæ•…éšœçš„æœºå™¨åœ¨æ¢å¤æ­£å¸¸åå¯ä»¥é‡æ–°æ­£å¸¸çš„åŠ å…¥åˆ°é›†ç¾¤ä¸­ ä¸ä¾èµ–æ—¶åºæ¥ä¿è¯æ—¥å¿—çš„ä¸€è‡´æ€§ é€šå¸¸æƒ…å†µä¸‹ï¼Œå¤§å¤šæ•°æœºå™¨å°±å¯ä»¥åšå‡ºå“åº”äº†ï¼Œå°‘æ•°æ…¢èŠ‚ç‚¹å¹¶ä¸ä¼šæ‹‰ä½æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½ 1.2 Raft åŸºæœ¬æ¦‚å¿µ é¦–å…ˆæˆ‘å°†æ•´ä½“ä¸²ä¸€éraftï¼Œç„¶åæŠ½æå‡ºé‡Œé¢çš„ç›¸å…³æ¦‚å¿µè¿›è¡Œè¯´æ˜ã€‚\nä¸€ä¸ªraftåè®®é€šå¸¸åŒ…å«è‹¥å¹²ä¸ªèŠ‚ç‚¹ï¼Œé€šå¸¸5ä¸ª(2n+1),å®ƒæœ€å¤šå…è®¸å…¶ä¸­çš„nä¸ªèŠ‚ç‚¹æŒ‚æ‰ã€‚åœ¨ä»»ä½•æ—¶åˆ»ï¼Œä»»ä½•èŠ‚ç‚¹éƒ½ä¼šå¤„åœ¨ä¸‹åˆ—ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼ŒLeaderï¼ŒFollowerä»¥åŠCandidateã€‚åœ¨ç³»ç»Ÿæ­£å¸¸è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿä¸­ä¼šæœ‰ä¸€ä¸ªLeaderï¼Œå…¶ä»–èŠ‚ç‚¹éƒ½å¤„äºFollowerçŠ¶æ€ï¼ŒLeaderè´Ÿè´£å¤„ç†æ‰€æœ‰æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼ŒFollowerå¦‚æœæ”¶åˆ°è¯·æ±‚ä¼šå°†è¯·æ±‚è·¯ç”±åˆ°Leaderï¼ŒFolloweråªæ˜¯è¢«åŠ¨çš„æ¥æ”¶leaderå’Œcandidateçš„è¯·æ±‚ï¼Œå®ƒè‡ªå·±ä¸ä¼šå¯¹å¤–å‘å‡ºè¯·æ±‚ã€‚è€Œcandidateæ˜¯ç”¨äºåšleaderé€‰ä¸¾çš„çŠ¶æ€ã€‚æ­£å¸¸æƒ…å†µä¸‹leaderä¼šå‘followeræ±‡æŠ¥å¿ƒè·³ï¼Œè¯æ˜è‡ªå·±æ˜¯å½“å‰ç³»ç»Ÿçš„leaderï¼Œè¿™æ ·æ‰€æœ‰followerå°±ä¼šè€è€å®å®è´Ÿè´£åŒæ­¥leaderçš„æ—¥å¿—å†…å®¹å˜æ›´ã€‚å½“ä¸€æ®µæ—¶é—´(éšæœºæ—¶é—´)followeræ”¶ä¸åˆ°leaderçš„å¿ƒè·³ä¿¡æ¯æ—¶ï¼Œä¼šè®¤ä¸ºæ­¤æ—¶ç³»ç»Ÿå¤„äºæ— leaderçŠ¶æ€ï¼Œé‚£ä¹ˆè‡ªå·±ä¼šè½¬æ¢åˆ°candidateçŠ¶æ€å¹¶å‘èµ·leaderé€‰ä¸¾ã€‚\nraftå°†æ•´ä¸ªæ—¶é—´åˆ†ä¸ºè‹¥å¹²ä¸ªé•¿åº¦ä¸ä¸€çš„ç‰‡æ®µï¼Œæ¯ä¸€ä¸ªæ®µå«åšä¸€ä¸ªä»»æœŸ(term)ï¼Œä¸€æ¬¡æ–°çš„é€‰ä¸»æ“ä½œä¼šè§¦å‘ä¸€æ¬¡termçš„æ›´æ–°ï¼Œè¿™é‡Œtermå°±å¯ä»¥ç†è§£ä¸ºé€»è¾‘æ—¶é’Ÿçš„æ¦‚å¿µã€‚raftè§„å®šï¼Œä¸€ä¸ªtermæœ€å¤šåªæœ‰ä¸€ä¸ªleaderï¼Œå¯èƒ½æ²¡æœ‰ï¼Œè¿™æ˜¯å› ä¸ºå¯èƒ½å¤šä¸ªfolloweråŒæ—¶å‘ç°æ²¡æœ‰leaderåŒæ—¶å‘èµ·é€‰ä¸»ï¼Œç“œåˆ†é€‰ç¥¨ã€‚èŠ‚ç‚¹é—´åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ä¼šäº¤æ¢termï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†å”¯ä¸€ç¡®è®¤å½“å‰åº”è¯¥æ˜¯è°åœ¨å½“æ”¿ã€‚å¦‚æœæŸä¸ªcandidateæˆ–leaderå‘ç°è‡ªå·±çš„termå°äºå½“å‰çš„å°±ä¼šè‡ªè§‰åœ°é€€åˆ°followerçŠ¶æ€ã€‚åŒæ ·çš„å¦‚æœæŸä¸ªèŠ‚ç‚¹æ”¶åˆ°åŒ…å«è¿‡æœŸtermçš„è¯·æ±‚ï¼Œåˆ™ä¼šç›´æ¥æ‹’ç»è¯¥è¯·æ±‚ã€‚\nraftèŠ‚ç‚¹é—´ä½¿ç”¨RPCè¿›è¡Œé€šä¿¡ï¼ŒåŸºæœ¬çš„æœ‰å…³ä¸€è‡´æ€§ç®—æ³•çš„æœ‰ä¸¤ç§åŸºæœ¬RPCç±»å‹ï¼Œåˆ†åˆ«ä¸ºè¯·æ±‚æŠ•ç¥¨(RequestVotes)ä»¥åŠè¿½åŠ æ—¥å¿—(AppendEntries),åœ¨æ—¥å¿—å‹ç¼©æ–¹é¢è¿˜æœ‰å¦å¤–ä¸€ç§RPCç±»å‹(InstallSnapshot),åé¢ä¼šè¯¦ç»†è¯´æ˜ã€‚å…¶ä¸­æ—¥å¿—ä¸­ç”±è‹¥å¹²ä¸ªæ¡ç›®ç»„æˆï¼Œæ¯ä¸ªæ¡ç›®éƒ½æœ‰ä¸€ä¸ªIndexæ ‡è¯†ã€‚\nè‡³æ­¤raftçš„æ‰€æœ‰æ¦‚å¿µéƒ½å‡ºæ¥äº†ï¼Œæˆ‘ç®€å•åˆ—ä¸¾ä¸€ä¸‹ï¼š\n1 2 3 4 5 6 7 8 Leader:èŠ‚ç‚¹çŠ¶æ€ä¸€ç§ï¼Œç”¨äºå¤„ç†æ‰€æœ‰æ¥è‡ªclientè¯·æ±‚ï¼Œå¹¶å°†è‡ªå·±çš„æ—¥å¿—è¿½åŠ è¡Œä¸ºå¹¿æ’­åˆ°æ‰€æœ‰çš„followerä¸Š Follower:èŠ‚ç‚¹çŠ¶æ€ä¸€ç§ï¼Œç”¨äºæ¥æ”¶leaderå¿ƒè·³ï¼Œå°†leaderçš„æ—¥å¿—å˜æ›´åŒæ­¥åˆ°è‡ªå·±çš„çŠ¶æ€æœºæ—¥å¿—ä¸­ï¼Œåœ¨é€‰ä¸¾æ—¶ç»™candidateæŠ•ç¥¨ Candidate:èŠ‚ç‚¹çŠ¶æ€ä¸€ç§,å½“followerå‘ç°æ²¡æœ‰leaderæ—¶å‘èµ·é€‰ä¸»è¯·æ±‚ï¼Œææœ‰å¯èƒ½æˆä¸ºä¸‹ä¸€ä»»leader termï¼šç”¨äºæ ‡è®°å½“å‰leader/è¯·æ±‚çš„æœ‰æ•ˆæ€§ï¼Œä¸€ç§é€»è¾‘æ—¶é’Ÿ Indexï¼šç”¨äºè¡¨ç¤ºå¤åˆ¶çŠ¶æ€æœºä¸­æ—¥å¿—çš„æ¡ç›® RequestVotes:candidateè¦æ±‚é€‰ä¸»å‘é€ç»™Followerçš„RPCè¯·æ±‚ AppendEntries:leaderç»™followerå‘é€çš„æ·»åŠ æ—¥å¿—æ¡ç›®(å¿ƒè·³)çš„è¯·æ±‚ InstallSnapshot:ç”Ÿæˆæ—¥å¿—å¿«ç…§çš„RPCè¯·æ±‚ 1.3 Raftåè®®æ ¸å¿ƒç‰¹æ€§ æ–‡ç« ä¸­åˆ—ä¸¾äº†äº”æ¡raftçš„æ ¸å¿ƒç‰¹æ€§ï¼Œä¹Ÿå¯ä»¥è¯´è¿™æ˜¯raftè®¾è®¡çš„åŸåˆ™\né€‰ä¸¾å®‰å…¨(Election Safety):åœ¨ä¸€ä¸ªtermä¸­æœ€å¤šåªèƒ½å­˜åœ¨ä¸€ä¸ªleader leaderæ—¥å¿—è¿½åŠ (Leader Append-Only):leaderä¸èƒ½è¦†ç›–æˆ–åˆ é™¤æ—¥å¿—ä¸­çš„å†…å®¹ï¼Œåªèƒ½æ–°å¢æ—¥å¿— æ—¥å¿—åŒ¹é…(Log Matching):å¦‚æœä¸¤ä¸ªæ—¥å¿—æœ‰ç›¸åŒçš„indexå’Œä»»æœŸï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªä»»æœŸå‰çš„æ‰€æœ‰æ—¥å¿—æ¡ç›®å…¨éƒ¨ç›¸åŒ Leaderå¼ºåˆ¶å®Œæˆ(Leader Completeness):å¦‚æœå†æŸä¸ªä»»æœŸå†…æäº¤äº†æŸæ¡æ—¥å¿—æ¡ç›®ï¼Œé‚£ä¹ˆè¿™ä¸ªä»»æœŸå‰é¢çš„æ—¥å¿—ä¹Ÿæ˜¯ç¡®è®¤è¢«æäº¤çš„ çŠ¶æ€æœºç¡®å®šæ€§(State Machine Safety):å¦‚æœä¸€å°æœåŠ¡å™¨å°†æŸä¸€ä¸ªindexçš„æ—¥å¿—æ¡ç›®åº”ç”¨åˆ°è‡ªå·±çš„çŠ¶æ€æœºä¸Šï¼Œé‚£ä¹ˆå…¶ä»–æœåŠ¡å™¨ä¸å¯èƒ½åœ¨åŒä¸€ä¸ªindexä¸Šåº”ç”¨ä¸åŒçš„æ—¥å¿—æ¡ç›® 1.4 Raft è§’è‰² æ ¹æ®å®˜æ–¹æ–‡æ¡£è§£é‡Šï¼Œä¸€ä¸ª Raft é›†ç¾¤åŒ…å«è‹¥å¹²èŠ‚ç‚¹ï¼ŒRaft æŠŠè¿™äº›èŠ‚ç‚¹åˆ†ä¸ºä¸‰ç§çŠ¶æ€ï¼šLeaderã€ Followerã€Candidateï¼Œæ¯ç§çŠ¶æ€è´Ÿè´£çš„ä»»åŠ¡ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œé›†ç¾¤ä¸­çš„èŠ‚ç‚¹åªå­˜åœ¨ Leader ä¸ Follower ä¸¤ç§çŠ¶æ€ã€‚\nLeaderï¼ˆé¢†å¯¼è€…ï¼‰ï¼šè´Ÿè´£æ—¥å¿—çš„åŒæ­¥ç®¡ç†ï¼Œå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¸Followerä¿æŒheartBeatçš„è”ç³»ï¼› Followerï¼ˆè¿½éšè€…ï¼‰ï¼šå“åº” Leader çš„æ—¥å¿—åŒæ­¥è¯·æ±‚ï¼Œå“åº”Candidateçš„é‚€ç¥¨è¯·æ±‚ï¼Œä»¥åŠæŠŠå®¢æˆ·ç«¯è¯·æ±‚åˆ°Followerçš„äº‹åŠ¡è½¬å‘ï¼ˆé‡å®šå‘ï¼‰ç»™Leaderï¼› Candidateï¼ˆå€™é€‰è€…ï¼‰ï¼šè´Ÿè´£é€‰ä¸¾æŠ•ç¥¨ï¼Œé›†ç¾¤åˆšå¯åŠ¨æˆ–è€…Leaderå®•æœºæ—¶ï¼ŒçŠ¶æ€ä¸ºFollowerçš„èŠ‚ç‚¹å°†è½¬ä¸ºCandidateå¹¶å‘èµ·é€‰ä¸¾ï¼Œé€‰ä¸¾èƒœå‡ºï¼ˆè·å¾—è¶…è¿‡åŠæ•°èŠ‚ç‚¹çš„æŠ•ç¥¨ï¼‰åï¼Œä»Candidateè½¬ä¸ºLeaderçŠ¶æ€ã€‚ 1.5 Raft ä¸‰ä¸ªå­é—®é¢˜ é€šå¸¸ï¼ŒRaft é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ª Leaderï¼Œå…¶å®ƒèŠ‚ç‚¹éƒ½æ˜¯ Followerã€‚Follower éƒ½æ˜¯è¢«åŠ¨çš„ï¼Œä¸ä¼šå‘é€ä»»ä½•è¯·æ±‚ï¼Œåªæ˜¯ç®€å•åœ°å“åº”æ¥è‡ª Leader æˆ–è€… Candidate çš„è¯·æ±‚ã€‚Leader è´Ÿè´£å¤„ç†æ‰€æœ‰çš„å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆå¦‚æœä¸€ä¸ªå®¢æˆ·ç«¯å’Œ Follower è”ç³»ï¼Œé‚£ä¹ˆ Follower ä¼šæŠŠè¯·æ±‚é‡å®šå‘ç»™ Leaderï¼‰ã€‚\nä¸ºç®€åŒ–é€»è¾‘å’Œå®ç°ï¼ŒRaft å°†ä¸€è‡´æ€§é—®é¢˜åˆ†è§£æˆäº†ä¸‰ä¸ªç›¸å¯¹ç‹¬ç«‹çš„å­é—®é¢˜ã€‚\né€‰ä¸¾ï¼ˆLeader Electionï¼‰ï¼šå½“ Leader å®•æœºæˆ–è€…é›†ç¾¤åˆåˆ›æ—¶ï¼Œä¸€ä¸ªæ–°çš„ Leader éœ€è¦è¢«é€‰ä¸¾å‡ºæ¥ï¼› æ—¥å¿—å¤åˆ¶ï¼ˆLog Replicationï¼‰ï¼šLeader æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶å°†å…¶ä»¥æ—¥å¿—æ¡ç›®çš„å½¢å¼å¤åˆ¶åˆ°é›†ç¾¤ä¸­çš„å…¶å®ƒèŠ‚ç‚¹ï¼Œå¹¶ä¸”å¼ºåˆ¶è¦æ±‚å…¶å®ƒèŠ‚ç‚¹çš„æ—¥å¿—å’Œè‡ªå·±ä¿æŒä¸€è‡´ï¼› å®‰å…¨æ€§ï¼ˆSafetyï¼‰ï¼šå¦‚æœæœ‰ä»»ä½•çš„æœåŠ¡å™¨èŠ‚ç‚¹å·²ç»åº”ç”¨äº†ä¸€ä¸ªç¡®å®šçš„æ—¥å¿—æ¡ç›®åˆ°å®ƒçš„çŠ¶æ€æœºä¸­ï¼Œé‚£ä¹ˆå…¶å®ƒæœåŠ¡å™¨èŠ‚ç‚¹ä¸èƒ½åœ¨åŒä¸€ä¸ªæ—¥å¿—ç´¢å¼•ä½ç½®åº”ç”¨ä¸€ä¸ªä¸åŒçš„æŒ‡ä»¤ã€‚ 2. Raft ç®—æ³•ä¹‹ Leader Election åŸç† æ ¹æ® Raft åè®®ï¼Œä¸€ä¸ªåº”ç”¨ Raft åè®®çš„é›†ç¾¤åœ¨åˆšå¯åŠ¨æ—¶ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„çŠ¶æ€éƒ½æ˜¯ Followerã€‚ç”±äºæ²¡æœ‰ Leaderï¼ŒFollowers æ— æ³•ä¸ Leader ä¿æŒå¿ƒè·³ï¼ˆHeart Beatï¼‰ï¼Œå› æ­¤ï¼ŒFollowers ä¼šè®¤ä¸º Leader å·²ç»ä¸‹çº¿ï¼Œè¿›è€Œè½¬ä¸º Candidate çŠ¶æ€ã€‚ç„¶åï¼ŒCandidate å°†å‘é›†ç¾¤ä¸­å…¶å®ƒèŠ‚ç‚¹è¯·æ±‚æŠ•ç¥¨ï¼ŒåŒæ„è‡ªå·±å‡çº§ä¸º Leaderã€‚å¦‚æœ Candidate æ”¶åˆ°è¶…è¿‡åŠæ•°èŠ‚ç‚¹çš„æŠ•ç¥¨ï¼ˆN/2 + 1ï¼‰ï¼Œå®ƒå°†è·èƒœæˆä¸º Leaderã€‚\nç¬¬ä¸€é˜¶æ®µï¼šæ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯ Followerã€‚ ä¸Šé¢æåˆ°ï¼Œä¸€ä¸ªåº”ç”¨ Raft åè®®çš„é›†ç¾¤åœ¨åˆšå¯åŠ¨ï¼ˆæˆ– Leader å®•æœºï¼‰æ—¶ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„çŠ¶æ€éƒ½æ˜¯ Followerï¼Œåˆå§‹ Termï¼ˆä»»æœŸï¼‰ä¸º 0ã€‚åŒæ—¶å¯åŠ¨é€‰ä¸¾å®šæ—¶å™¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„é€‰ä¸¾å®šæ—¶å™¨è¶…æ—¶æ—¶é—´éƒ½åœ¨ 100~500 æ¯«ç§’ä¹‹é—´ä¸”å¹¶ä¸ä¸€è‡´ï¼ˆé¿å…åŒæ—¶å‘èµ·é€‰ä¸¾ï¼‰ã€‚ ç¬¬äºŒé˜¶æ®µï¼šFollower è½¬ä¸º Candidate å¹¶å‘èµ·æŠ•ç¥¨ã€‚ æ²¡æœ‰ Leaderï¼ŒFollowers æ— æ³•ä¸ Leader ä¿æŒå¿ƒè·³ï¼ˆHeart Beatï¼‰ï¼ŒèŠ‚ç‚¹å¯åŠ¨ååœ¨ä¸€ä¸ªé€‰ä¸¾å®šæ—¶å™¨å‘¨æœŸå†…æœªæ”¶åˆ°å¿ƒè·³å’ŒæŠ•ç¥¨è¯·æ±‚ï¼Œåˆ™çŠ¶æ€è½¬ä¸ºå€™é€‰è€… Candidate çŠ¶æ€ï¼Œä¸” Term è‡ªå¢ï¼Œå¹¶å‘é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹å‘é€æŠ•ç¥¨è¯·æ±‚å¹¶ä¸”é‡ç½®é€‰ä¸¾å®šæ—¶å™¨ã€‚\næ³¨æ„ï¼Œç”±äºæ¯ä¸ªèŠ‚ç‚¹çš„é€‰ä¸¾å®šæ—¶å™¨è¶…æ—¶æ—¶é—´éƒ½åœ¨ 100-500 æ¯«ç§’ä¹‹é—´ï¼Œä¸”å½¼æ­¤ä¸ä¸€æ ·ï¼Œä»¥é¿å…æ‰€æœ‰ Follower åŒæ—¶è½¬ä¸º Candidate å¹¶åŒæ—¶å‘èµ·æŠ•ç¥¨è¯·æ±‚ã€‚æ¢è¨€ä¹‹ï¼Œæœ€å…ˆè½¬ä¸º Candidate å¹¶å‘èµ·æŠ•ç¥¨è¯·æ±‚çš„èŠ‚ç‚¹å°†å…·æœ‰æˆä¸º Leader çš„â€œå…ˆå‘ä¼˜åŠ¿â€ã€‚ ç¬¬ä¸‰é˜¶æ®µï¼šæŠ•ç¥¨ç­–ç•¥ã€‚ èŠ‚ç‚¹æ”¶åˆ°æŠ•ç¥¨è¯·æ±‚åä¼šæ ¹æ®ä»¥ä¸‹æƒ…å†µå†³å®šæ˜¯å¦æ¥å—æŠ•ç¥¨è¯·æ±‚ï¼š\nè¯·æ±‚èŠ‚ç‚¹çš„ Term å¤§äºè‡ªå·±çš„ Termï¼Œä¸”è‡ªå·±å°šæœªæŠ•ç¥¨ç»™å…¶å®ƒèŠ‚ç‚¹ï¼Œåˆ™æ¥å—è¯·æ±‚ï¼ŒæŠŠç¥¨æŠ•ç»™å®ƒï¼› è¯·æ±‚èŠ‚ç‚¹çš„ Term å°äºè‡ªå·±çš„ Termï¼Œä¸”è‡ªå·±å°šæœªæŠ•ç¥¨ï¼Œåˆ™æ‹’ç»è¯·æ±‚ï¼Œå°†ç¥¨æŠ•ç»™è‡ªå·±ã€‚ ç¬¬å››é˜¶æ®µï¼šCandidate è½¬ä¸º Leaderã€‚ ä¸€è½®é€‰ä¸¾è¿‡åï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¼šæœ‰ä¸€ä¸ª Candidate æ”¶åˆ°è¶…è¿‡åŠæ•°èŠ‚ç‚¹ï¼ˆN/2 + 1ï¼‰çš„æŠ•ç¥¨ï¼Œå®ƒå°†èƒœå‡ºå¹¶å‡çº§ä¸º Leaderã€‚ç„¶åå®šæ—¶å‘é€å¿ƒè·³ç»™å…¶å®ƒçš„èŠ‚ç‚¹ï¼Œå…¶å®ƒèŠ‚ç‚¹ä¼šè½¬ä¸º Follower å¹¶ä¸ Leader ä¿æŒåŒæ­¥ï¼Œåˆ°æ­¤ï¼Œæœ¬è½®é€‰ä¸¾ç»“æŸã€‚\næ³¨æ„ï¼šæœ‰å¯èƒ½ä¸€è½®é€‰ä¸¾ä¸­ï¼Œæ²¡æœ‰ Candidate æ”¶åˆ°è¶…è¿‡åŠæ•°èŠ‚ç‚¹æŠ•ç¥¨ï¼Œé‚£ä¹ˆå°†è¿›è¡Œä¸‹ä¸€è½®é€‰ä¸¾ã€‚ 3. Raft ç®—æ³•ä¹‹ Log Replication åŸç† åœ¨ä¸€ä¸ª Raft é›†ç¾¤ä¸­ï¼Œåªæœ‰ Leader èŠ‚ç‚¹èƒ½å¤Ÿå¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼ˆå¦‚æœå®¢æˆ·ç«¯çš„è¯·æ±‚å‘åˆ°äº† Followerï¼ŒFollower å°†ä¼šæŠŠè¯·æ±‚é‡å®šå‘åˆ° Leaderï¼‰ï¼Œå®¢æˆ·ç«¯çš„æ¯ä¸€ä¸ªè¯·æ±‚éƒ½åŒ…å«ä¸€æ¡è¢«å¤åˆ¶çŠ¶æ€æœºæ‰§è¡Œçš„æŒ‡ä»¤ã€‚Leader æŠŠè¿™æ¡æŒ‡ä»¤ä½œä¸ºä¸€æ¡æ–°çš„æ—¥å¿—æ¡ç›®ï¼ˆEntryï¼‰é™„åŠ åˆ°æ—¥å¿—ä¸­å»ï¼Œç„¶åå¹¶è¡Œå¾—å°†é™„åŠ æ¡ç›®å‘é€ç»™ Followersï¼Œè®©å®ƒä»¬å¤åˆ¶è¿™æ¡æ—¥å¿—æ¡ç›®ã€‚\nå½“è¿™æ¡æ—¥å¿—æ¡ç›®è¢« Followers å®‰å…¨å¤åˆ¶ï¼ŒLeader ä¼šå°†è¿™æ¡æ—¥å¿—æ¡ç›®åº”ç”¨åˆ°å®ƒçš„çŠ¶æ€æœºä¸­ï¼Œç„¶åæŠŠæ‰§è¡Œçš„ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚å¦‚æœ Follower å´©æºƒæˆ–è€…è¿è¡Œç¼“æ…¢ï¼Œå†æˆ–è€…ç½‘ç»œä¸¢åŒ…ï¼ŒLeader ä¼šä¸æ–­å¾—é‡å¤å°è¯•é™„åŠ æ—¥å¿—æ¡ç›®ï¼ˆå°½ç®¡å·²ç»å›å¤äº†å®¢æˆ·ç«¯ï¼‰ç›´åˆ°æ‰€æœ‰çš„ Follower éƒ½æœ€ç»ˆå­˜å‚¨äº†æ‰€æœ‰çš„æ—¥å¿—æ¡ç›®ï¼Œç¡®ä¿å¼ºä¸€è‡´æ€§ã€‚\nç¬¬ä¸€é˜¶æ®µï¼šå®¢æˆ·ç«¯è¯·æ±‚æäº¤åˆ° Leaderã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒLeader æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæ¯”å¦‚å­˜å‚¨æ•°æ® 5ã€‚Leader åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œä¼šå°†å®ƒä½œä¸ºæ—¥å¿—æ¡ç›®ï¼ˆEntryï¼‰å†™å…¥æœ¬åœ°æ—¥å¿—ä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ—¶è¯¥ Entry çš„çŠ¶æ€æ˜¯æœªæäº¤ï¼ˆUncommittedï¼‰ï¼ŒLeader å¹¶ä¸ä¼šæ›´æ–°æœ¬åœ°æ•°æ®ï¼Œå› æ­¤å®ƒæ˜¯ä¸å¯è¯»çš„ã€‚ ç¬¬äºŒé˜¶æ®µï¼šLeader å°† Entry å‘é€åˆ°å…¶å®ƒ Follower Leader ä¸ Floolwers ä¹‹é—´ä¿æŒç€å¿ƒè·³è”ç³»ï¼Œéšå¿ƒè·³ Leader å°†è¿½åŠ çš„ Entryï¼ˆAppendEntriesï¼‰å¹¶è¡Œåœ°å‘é€ç»™å…¶å®ƒçš„ Followerï¼Œå¹¶è®©å®ƒä»¬å¤åˆ¶è¿™æ¡æ—¥å¿—æ¡ç›®ï¼Œè¿™ä¸€è¿‡ç¨‹ç§°ä¸ºå¤åˆ¶ï¼ˆReplicateï¼‰ã€‚\næœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š\nä¸ºä»€ä¹ˆ Leader å‘ Follower å‘é€çš„ Entry æ˜¯ AppendEntries å‘¢ï¼Ÿ å› ä¸º Leader ä¸ Follower çš„å¿ƒè·³æ˜¯å‘¨æœŸæ€§çš„ï¼Œè€Œä¸€ä¸ªå‘¨æœŸé—´ Leader å¯èƒ½æ¥æ”¶åˆ°å¤šæ¡å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå› æ­¤ï¼Œéšå¿ƒè·³å‘ Followers å‘é€çš„å¤§æ¦‚ç‡æ˜¯å¤šä¸ª Entryï¼Œå³ AppendEntriesã€‚å½“ç„¶ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å‡è®¾åªæœ‰ä¸€æ¡è¯·æ±‚ï¼Œè‡ªç„¶ä¹Ÿå°±æ˜¯ä¸€ä¸ªEntryäº†ã€‚\nLeader å‘ Followers å‘é€çš„ä¸ä»…ä»…æ˜¯è¿½åŠ çš„ Entryï¼ˆAppendEntriesï¼‰ã€‚ åœ¨å‘é€è¿½åŠ æ—¥å¿—æ¡ç›®çš„æ—¶å€™ï¼ŒLeader ä¼šæŠŠæ–°çš„æ—¥å¿—æ¡ç›®ç´§æ¥ç€ä¹‹å‰æ¡ç›®çš„ç´¢å¼•ä½ç½®ï¼ˆprevLogIndexï¼‰ï¼Œ Leader ä»»æœŸå·ï¼ˆTermï¼‰ä¹ŸåŒ…å«åœ¨å…¶ä¸­ã€‚å¦‚æœ Follower åœ¨å®ƒçš„æ—¥å¿—ä¸­æ‰¾ä¸åˆ°åŒ…å«ç›¸åŒç´¢å¼•ä½ç½®å’Œä»»æœŸå·çš„æ¡ç›®ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šæ‹’ç»æ¥æ”¶æ–°çš„æ—¥å¿—æ¡ç›®ï¼Œå› ä¸ºå‡ºç°è¿™ç§æƒ…å†µè¯´æ˜ Follower å’Œ Leader ä¸ä¸€è‡´ã€‚\nå¦‚ä½•è§£å†³ Leader ä¸ Follower ä¸ä¸€è‡´çš„é—®é¢˜ï¼Ÿ åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼ŒLeader å’Œ Follower çš„æ—¥å¿—ä¿æŒä¸€è‡´ï¼Œæ‰€ä»¥è¿½åŠ æ—¥å¿—çš„ä¸€è‡´æ€§æ£€æŸ¥ä»æ¥ä¸ä¼šå¤±è´¥ã€‚ç„¶è€Œï¼ŒLeader å’Œ Follower ä¸€ç³»åˆ—å´©æºƒçš„æƒ…å†µä¼šä½¿å®ƒä»¬çš„æ—¥å¿—å¤„äºä¸ä¸€è‡´çŠ¶æ€ã€‚Followerå¯èƒ½ä¼šä¸¢å¤±ä¸€äº›åœ¨æ–°çš„ Leader ä¸­æœ‰çš„æ—¥å¿—æ¡ç›®ï¼Œå®ƒä¹Ÿå¯èƒ½æ‹¥æœ‰ä¸€äº› Leader æ²¡æœ‰çš„æ—¥å¿—æ¡ç›®ï¼Œæˆ–è€…ä¸¤è€…éƒ½å‘ç”Ÿã€‚ä¸¢å¤±æˆ–è€…å¤šå‡ºæ—¥å¿—æ¡ç›®å¯èƒ½ä¼šæŒç»­å¤šä¸ªä»»æœŸã€‚\nè¦ä½¿ Follower çš„æ—¥å¿—ä¸ Leader æ¢å¤ä¸€è‡´ï¼ŒLeader å¿…é¡»æ‰¾åˆ°æœ€åä¸¤è€…è¾¾æˆä¸€è‡´çš„åœ°æ–¹ï¼ˆè¯´ç™½äº†å°±æ˜¯å›æº¯ï¼Œæ‰¾åˆ°ä¸¤è€…æœ€è¿‘çš„ä¸€è‡´ç‚¹ï¼‰ï¼Œç„¶ååˆ é™¤ä»é‚£ä¸ªç‚¹ä¹‹åçš„æ‰€æœ‰æ—¥å¿—æ¡ç›®ï¼Œå‘é€è‡ªå·±çš„æ—¥å¿—ç»™ Followerã€‚æ‰€æœ‰çš„è¿™äº›æ“ä½œéƒ½åœ¨è¿›è¡Œé™„åŠ æ—¥å¿—çš„ä¸€è‡´æ€§æ£€æŸ¥æ—¶å®Œæˆã€‚\nLeader ä¸ºæ¯ä¸€ä¸ª Follower ç»´æŠ¤ä¸€ä¸ª nextIndexï¼Œå®ƒè¡¨ç¤ºä¸‹ä¸€ä¸ªéœ€è¦å‘é€ç»™ Follower çš„æ—¥å¿—æ¡ç›®çš„ç´¢å¼•åœ°å€ã€‚å½“ä¸€ä¸ª Leader åˆšè·å¾—æƒåŠ›çš„æ—¶å€™ï¼Œå®ƒåˆå§‹åŒ–æ‰€æœ‰çš„ nextIndex å€¼ï¼Œä¸ºè‡ªå·±çš„æœ€åä¸€æ¡æ—¥å¿—çš„ index åŠ  1ã€‚å¦‚æœä¸€ä¸ª Follower çš„æ—¥å¿—å’Œ Leader ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆåœ¨ä¸‹ä¸€æ¬¡é™„åŠ æ—¥å¿—æ—¶ä¸€è‡´æ€§æ£€æŸ¥å°±ä¼šå¤±è´¥ã€‚åœ¨è¢« Follower æ‹’ç»ä¹‹åï¼ŒLeader å°±ä¼šå‡å°è¯¥ Follower å¯¹åº”çš„ nextIndex å€¼å¹¶è¿›è¡Œé‡è¯•ã€‚æœ€ç»ˆ nextIndex ä¼šåœ¨æŸä¸ªä½ç½®ä½¿å¾— Leader å’Œ Follower çš„æ—¥å¿—è¾¾æˆä¸€è‡´ã€‚å½“è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œé™„åŠ æ—¥å¿—å°±ä¼šæˆåŠŸï¼Œè¿™æ—¶å°±ä¼šæŠŠ Follower å†²çªçš„æ—¥å¿—æ¡ç›®å…¨éƒ¨åˆ é™¤å¹¶ä¸”åŠ ä¸Š Leader çš„æ—¥å¿—ã€‚ä¸€æ—¦é™„åŠ æ—¥å¿—æˆåŠŸï¼Œé‚£ä¹ˆ Follower çš„æ—¥å¿—å°±ä¼šå’Œ Leader ä¿æŒä¸€è‡´ï¼Œå¹¶ä¸”åœ¨æ¥ä¸‹æ¥çš„ä»»æœŸç»§ç»­ä¿æŒä¸€è‡´ã€‚ ç¬¬ä¸‰é˜¶æ®µï¼šLeader ç­‰å¾… Followers å›åº”ã€‚ Followers æ¥æ”¶åˆ° Leader å‘æ¥çš„å¤åˆ¶è¯·æ±‚åï¼Œæœ‰ä¸¤ç§å¯èƒ½çš„å›åº”ï¼š\nå†™å…¥æœ¬åœ°æ—¥å¿—ä¸­ï¼Œè¿”å› Successï¼› ä¸€è‡´æ€§æ£€æŸ¥å¤±è´¥ï¼Œæ‹’ç»å†™å…¥ï¼Œè¿”å› Falseï¼ŒåŸå› å’Œè§£å†³åŠæ³•ä¸Šé¢å·²åšäº†è¯¦ç»†è¯´æ˜ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ—¶è¯¥ Entry çš„çŠ¶æ€ä¹Ÿæ˜¯æœªæäº¤ï¼ˆUncommittedï¼‰ã€‚å®Œæˆä¸Šè¿°æ­¥éª¤åï¼ŒFollowers ä¼šå‘ Leader å‘å‡º Success çš„å›åº”ï¼Œå½“ Leader æ”¶åˆ°å¤§å¤šæ•° Followers çš„å›åº”åï¼Œä¼šå°†ç¬¬ä¸€é˜¶æ®µå†™å…¥çš„ Entry æ ‡è®°ä¸ºæäº¤çŠ¶æ€ï¼ˆCommittedï¼‰ï¼Œå¹¶æŠŠè¿™æ¡æ—¥å¿—æ¡ç›®åº”ç”¨åˆ°å®ƒçš„çŠ¶æ€æœºä¸­ã€‚ ç¬¬å››é˜¶æ®µï¼šLeader å›åº”å®¢æˆ·ç«¯ã€‚ å®Œæˆå‰ä¸‰ä¸ªé˜¶æ®µåï¼ŒLeaderä¼šå‘å®¢æˆ·ç«¯å›åº” OKï¼Œè¡¨ç¤ºå†™æ“ä½œæˆåŠŸã€‚ ç¬¬äº”é˜¶æ®µï¼ŒLeader é€šçŸ¥ Followers Entry å·²æäº¤ Leader å›åº”å®¢æˆ·ç«¯åï¼Œå°†éšç€ä¸‹ä¸€ä¸ªå¿ƒè·³é€šçŸ¥ Followersï¼ŒFollowers æ”¶åˆ°é€šçŸ¥åä¹Ÿä¼šå°† Entry æ ‡è®°ä¸ºæäº¤çŠ¶æ€ã€‚è‡³æ­¤ï¼ŒRaft é›†ç¾¤è¶…è¿‡åŠæ•°èŠ‚ç‚¹å·²ç»è¾¾åˆ°ä¸€è‡´çŠ¶æ€ï¼Œå¯ä»¥ç¡®ä¿å¼ºä¸€è‡´æ€§ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºç½‘ç»œã€æ€§èƒ½ã€æ•…éšœç­‰å„ç§åŸå› å¯¼è‡´â€œååº”æ…¢â€ã€â€œä¸ä¸€è‡´â€ç­‰é—®é¢˜çš„èŠ‚ç‚¹ï¼Œæœ€ç»ˆä¹Ÿä¼šä¸ Leader è¾¾æˆä¸€è‡´ã€‚ 4. Raft ç®—æ³•ä¹‹å®‰å…¨æ€§ å‰é¢æè¿°äº† Raft ç®—æ³•æ˜¯å¦‚ä½•é€‰ä¸¾ Leader å’Œå¤åˆ¶æ—¥å¿—çš„ã€‚ç„¶è€Œï¼Œåˆ°ç›®å‰ä¸ºæ­¢æè¿°çš„æœºåˆ¶å¹¶ä¸èƒ½å……åˆ†åœ°ä¿è¯æ¯ä¸€ä¸ªçŠ¶æ€æœºä¼šæŒ‰ç…§ç›¸åŒçš„é¡ºåºæ‰§è¡Œç›¸åŒçš„æŒ‡ä»¤ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª Follower å¯èƒ½å¤„äºä¸å¯ç”¨çŠ¶æ€ï¼ŒåŒæ—¶ Leader å·²ç»æäº¤äº†è‹¥å¹²çš„æ—¥å¿—æ¡ç›®ï¼›ç„¶åè¿™ä¸ª Follower æ¢å¤ï¼ˆå°šæœªä¸ Leader è¾¾æˆä¸€è‡´ï¼‰è€Œ Leader æ•…éšœï¼›å¦‚æœè¯¥ Follower è¢«é€‰ä¸¾ä¸º Leader å¹¶ä¸”è¦†ç›–è¿™äº›æ—¥å¿—æ¡ç›®ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ï¼Œå³ä¸åŒçš„çŠ¶æ€æœºæ‰§è¡Œä¸åŒçš„æŒ‡ä»¤åºåˆ—ã€‚\né‰´äºæ­¤ï¼Œåœ¨ Leader é€‰ä¸¾çš„æ—¶å€™éœ€å¢åŠ ä¸€äº›é™åˆ¶æ¥å®Œå–„ Raft ç®—æ³•ã€‚è¿™äº›é™åˆ¶å¯ä¿è¯ä»»ä½•çš„ Leader å¯¹äºç»™å®šçš„ä»»æœŸå·ï¼ˆTermï¼‰ï¼Œéƒ½æ‹¥æœ‰ä¹‹å‰ä»»æœŸçš„æ‰€æœ‰è¢«æäº¤çš„æ—¥å¿—æ¡ç›®ï¼ˆæ‰€è°“ Leader çš„å®Œæ•´ç‰¹æ€§ï¼‰ã€‚å…³äºè¿™ä¸€é€‰ä¸¾æ—¶çš„é™åˆ¶ï¼Œä¸‹æ–‡å°†è¯¦ç»†è¯´æ˜ã€‚\n4.1 é€‰ä¸¾é™åˆ¶ åœ¨æ‰€æœ‰åŸºäº Leader æœºåˆ¶çš„ä¸€è‡´æ€§ç®—æ³•ä¸­ï¼ŒLeader éƒ½å¿…é¡»å­˜å‚¨æ‰€æœ‰å·²ç»æäº¤çš„æ—¥å¿—æ¡ç›®ã€‚ä¸ºäº†ä¿éšœè¿™ä¸€ç‚¹ï¼ŒRaft ä½¿ç”¨äº†ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹æ³•ï¼Œä»¥ä¿è¯æ‰€æœ‰ä¹‹å‰çš„ä»»æœŸå·ä¸­å·²ç»æäº¤çš„æ—¥å¿—æ¡ç›®åœ¨é€‰ä¸¾çš„æ—¶å€™éƒ½ä¼šå‡ºç°åœ¨æ–°çš„ Leader ä¸­ã€‚æ¢è¨€ä¹‹ï¼Œæ—¥å¿—æ¡ç›®çš„ä¼ é€æ˜¯å•å‘çš„ï¼Œåªä» Leader ä¼ ç»™ Followerï¼Œå¹¶ä¸” Leader ä»ä¸ä¼šè¦†ç›–è‡ªèº«æœ¬åœ°æ—¥å¿—ä¸­å·²ç»å­˜åœ¨çš„æ¡ç›®ã€‚\nRaft ä½¿ç”¨æŠ•ç¥¨çš„æ–¹å¼æ¥é˜»æ­¢ä¸€ä¸ª Candidate èµ¢å¾—é€‰ä¸¾ï¼Œé™¤éè¿™ä¸ª Candidate åŒ…å«äº†æ‰€æœ‰å·²ç»æäº¤çš„æ—¥å¿—æ¡ç›®ã€‚Candidate ä¸ºäº†èµ¢å¾—é€‰ä¸¾å¿…é¡»è”ç³»é›†ç¾¤ä¸­çš„å¤§éƒ¨åˆ†èŠ‚ç‚¹ã€‚è¿™æ„å‘³ç€æ¯ä¸€ä¸ªå·²ç»æäº¤çš„æ—¥å¿—æ¡ç›®è‚¯å®šå­˜åœ¨äºè‡³å°‘ä¸€ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä¸Šã€‚å¦‚æœ Candidate çš„æ—¥å¿—è‡³å°‘å’Œå¤§å¤šæ•°çš„æœåŠ¡å™¨èŠ‚ç‚¹ä¸€æ ·æ–°ï¼ˆè¿™ä¸ªæ–°çš„å®šä¹‰ä¼šåœ¨ä¸‹é¢è®¨è®ºï¼‰ï¼Œé‚£ä¹ˆå®ƒä¸€å®šæŒæœ‰äº†æ‰€æœ‰å·²ç»æäº¤çš„æ—¥å¿—æ¡ç›®ï¼ˆå¤šæ•°æ´¾çš„æ€æƒ³ï¼‰ã€‚æŠ•ç¥¨è¯·æ±‚çš„é™åˆ¶ä¸­è¯·æ±‚ä¸­åŒ…å«äº† Candidate çš„æ—¥å¿—ä¿¡æ¯ï¼Œç„¶åæŠ•ç¥¨äººä¼šæ‹’ç»é‚£äº›æ—¥å¿—æ²¡æœ‰è‡ªå·±æ–°çš„æŠ•ç¥¨è¯·æ±‚ã€‚\nRaft é€šè¿‡æ¯”è¾ƒä¸¤ä»½æ—¥å¿—ä¸­æœ€åä¸€æ¡æ—¥å¿—æ¡ç›®çš„ç´¢å¼•å€¼å’Œä»»æœŸå·ï¼Œç¡®å®šè°çš„æ—¥å¿—æ¯”è¾ƒæ–°ã€‚å¦‚æœä¸¤ä»½æ—¥å¿—æœ€åæ¡ç›®çš„ä»»æœŸå·ä¸åŒï¼Œé‚£ä¹ˆä»»æœŸå·å¤§çš„æ—¥å¿—æ›´åŠ æ–°ã€‚å¦‚æœä¸¤ä»½æ—¥å¿—æœ€åçš„æ¡ç›®ä»»æœŸå·ç›¸åŒï¼Œé‚£ä¹ˆæ—¥å¿—æ¯”è¾ƒé•¿çš„é‚£ä¸ªå°±æ›´åŠ æ–°ã€‚\næ€»ç»“ - é€‰ä¸¾æ—¶: ä¿è¯æ–°çš„ Leader æ‹¥æœ‰æ‰€æœ‰å·²ç»æäº¤çš„æ—¥å¿—\næ¯ä¸ª Follower èŠ‚ç‚¹åœ¨æŠ•ç¥¨æ—¶ä¼šæ£€æŸ¥ Candidate çš„æ—¥å¿—ç´¢å¼•ï¼Œå¹¶æ‹’ç»ä¸ºæ—¥å¿—ä¸å®Œæ•´çš„ Candidate æŠ•èµæˆç¥¨ åŠæ•°ä»¥ä¸Šçš„ Follower èŠ‚ç‚¹éƒ½æŠ•äº†èµæˆç¥¨ï¼Œæ„å‘³ç€ Candidate ä¸­åŒ…å«äº†æ‰€æœ‰å¯èƒ½å·²ç»è¢«æäº¤çš„æ—¥å¿— 4.2 æäº¤ä¹‹å‰ä»»æœŸå†…çš„æ—¥å¿—æ¡ç›® å¦‚åŒ 4.1 èŠ‚ä»‹ç»çš„é‚£æ ·ï¼ŒLeader çŸ¥é“ä¸€æ¡å½“å‰ä»»æœŸå†…çš„æ—¥å¿—è®°å½•æ˜¯å¯ä»¥è¢«æäº¤çš„ï¼Œåªè¦å®ƒè¢«å¤åˆ¶åˆ°äº†å¤§å¤šæ•°çš„ Follower ä¸Šï¼ˆå¤šæ•°æ´¾çš„æ€æƒ³ï¼‰ã€‚å¦‚æœä¸€ä¸ª Leader åœ¨æäº¤æ—¥å¿—æ¡ç›®ä¹‹å‰å´©æºƒäº†ï¼Œç»§ä»»çš„ Leader ä¼šç»§ç»­å°è¯•å¤åˆ¶è¿™æ¡æ—¥å¿—è®°å½•ã€‚ç„¶è€Œï¼Œä¸€ä¸ª Leader å¹¶ä¸èƒ½æ–­å®šè¢«ä¿å­˜åˆ°å¤§å¤šæ•° Follower ä¸Šçš„ä¸€ä¸ªä¹‹å‰ä»»æœŸé‡Œçš„æ—¥å¿—æ¡ç›® å°±ä¸€å®šå·²ç»æäº¤äº†ã€‚è¿™å¾ˆæ˜æ˜¾ï¼Œä»æ—¥å¿—å¤åˆ¶çš„è¿‡ç¨‹å¯ä»¥çœ‹å‡ºã€‚\né‰´äºä¸Šè¿°æƒ…å†µï¼ŒRaft ç®—æ³•ä¸ä¼šé€šè¿‡è®¡ç®—å‰¯æœ¬æ•°ç›®çš„æ–¹å¼å»æäº¤ä¸€ä¸ªä¹‹å‰ä»»æœŸå†…çš„æ—¥å¿—æ¡ç›®ã€‚åªæœ‰ Leader å½“å‰ä»»æœŸé‡Œçš„æ—¥å¿—æ¡ç›®é€šè¿‡è®¡ç®—å‰¯æœ¬æ•°ç›®å¯ä»¥è¢«æäº¤ï¼›ä¸€æ—¦å½“å‰ä»»æœŸçš„æ—¥å¿—æ¡ç›®ä»¥è¿™ç§æ–¹å¼è¢«æäº¤ï¼Œé‚£ä¹ˆç”±äºæ—¥å¿—åŒ¹é…ç‰¹æ€§ï¼Œä¹‹å‰çš„æ—¥å¿—æ¡ç›®ä¹Ÿéƒ½ä¼šè¢«é—´æ¥çš„æäº¤ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒLeader å¯ä»¥å®‰å…¨åœ°çŸ¥é“ä¸€ä¸ªè€çš„æ—¥å¿—æ¡ç›®æ˜¯å¦å·²ç»è¢«æäº¤ï¼ˆåªéœ€åˆ¤æ–­è¯¥æ¡ç›®æ˜¯å¦å­˜å‚¨åˆ°æ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼‰ï¼Œä½†æ˜¯ Raft ä¸ºäº†ç®€åŒ–é—®é¢˜ä½¿ç”¨äº†ä¸€ç§æ›´åŠ ä¿å®ˆçš„æ–¹æ³•ã€‚\nå½“ Leader å¤åˆ¶ä¹‹å‰ä»»æœŸé‡Œçš„æ—¥å¿—æ—¶ï¼ŒRaft ä¼šä¸ºæ‰€æœ‰æ—¥å¿—ä¿ç•™åŸå§‹çš„ä»»æœŸå·ï¼Œè¿™åœ¨æäº¤è§„åˆ™ä¸Šäº§ç”Ÿäº†é¢å¤–çš„å¤æ‚æ€§ã€‚ä½†æ˜¯ï¼Œè¿™ç§ç­–ç•¥æ›´åŠ å®¹æ˜“è¾¨åˆ«å‡ºæ—¥å¿—ï¼Œå³ä½¿éšç€æ—¶é—´å’Œæ—¥å¿—çš„å˜åŒ–ï¼Œæ—¥å¿—ä»ç»´æŠ¤ç€åŒä¸€ä¸ªä»»æœŸç¼–å·ã€‚æ­¤å¤–ï¼Œè¯¥ç­–ç•¥ä½¿å¾—æ–° Leader åªéœ€è¦å‘é€è¾ƒå°‘æ—¥å¿—æ¡ç›®ã€‚\næ€»ç»“ - æäº¤æ—¥å¿—æ—¶: Leader åªä¸»åŠ¨æäº¤è‡ªå·±ä»»æœŸå†…äº§ç”Ÿçš„æ—¥å¿—\nå¦‚æœè®°å½•æ˜¯å½“å‰ Leader æ‰€åˆ›å»ºçš„ï¼Œé‚£ä¹ˆå½“è¿™æ¡è®°å½•è¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šæ—¶ï¼ŒLeader å°±å¯ä»¥æäº¤è¿™æ¡è®°å½•ä»¥åŠä¹‹å‰çš„è®°å½• å¦‚æœè®°å½•æ˜¯ä¹‹å‰ Leader æ‰€åˆ›å»ºçš„ï¼Œåˆ™åªæœ‰å½“å‰ Leader åˆ›å»ºçš„è®°å½•è¢«æäº¤åï¼Œæ‰èƒ½æäº¤è¿™äº›ç”±ä¹‹å‰ Leader åˆ›å»ºçš„æ—¥å¿— 5. é›†ç¾¤æˆå‘˜å˜æ›´ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬éƒ½å‡è®¾é›†ç¾¤çš„é…ç½®ï¼ˆåŠ å…¥åˆ°ä¸€è‡´æ€§ç®—æ³•çš„æœåŠ¡å™¨é›†åˆï¼‰æ˜¯å›ºå®šä¸å˜çš„ã€‚ä½†æ˜¯åœ¨å®è·µä¸­ï¼Œå¶å°”æ˜¯ä¼šæ”¹å˜é›†ç¾¤çš„é…ç½®çš„ï¼Œä¾‹å¦‚æ›¿æ¢é‚£äº›å®•æœºçš„æœºå™¨æˆ–è€…æ”¹å˜å¤åˆ¶çº§åˆ«ã€‚å°½ç®¡å¯ä»¥é€šè¿‡æš‚åœæ•´ä¸ªé›†ç¾¤ï¼Œæ›´æ–°æ‰€æœ‰é…ç½®ï¼Œç„¶åé‡å¯æ•´ä¸ªé›†ç¾¤çš„æ–¹å¼æ¥å®ç°ï¼Œä½†æ˜¯åœ¨æ›´æ”¹çš„æ—¶å€™é›†ç¾¤ä¼šä¸å¯ç”¨ã€‚å¦å¤–ï¼Œå¦‚æœå­˜åœ¨æ‰‹å·¥æ“ä½œæ­¥éª¤ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰æ“ä½œå¤±è¯¯çš„é£é™©ã€‚ä¸ºäº†é¿å…è¿™æ ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬å†³å®šè‡ªåŠ¨åŒ–é…ç½®æ”¹å˜å¹¶ä¸”å°†å…¶çº³å…¥åˆ° Raft ä¸€è‡´æ€§ç®—æ³•ä¸­æ¥ã€‚ ä¸ºäº†è®©é…ç½®ä¿®æ”¹æœºåˆ¶èƒ½å¤Ÿå®‰å…¨ï¼Œé‚£ä¹ˆåœ¨è½¬æ¢çš„è¿‡ç¨‹ä¸­ä¸èƒ½å¤Ÿå­˜åœ¨ä»»ä½•æ—¶é—´ç‚¹ä½¿å¾—ä¸¤ä¸ªé¢†å¯¼äººåŒæ—¶è¢«é€‰ä¸¾æˆåŠŸåœ¨åŒä¸€ä¸ªä»»æœŸé‡Œã€‚ä¸å¹¸çš„æ˜¯ï¼Œä»»ä½•æœåŠ¡å™¨ç›´æ¥ä»æ—§çš„é…ç½®ç›´æ¥è½¬æ¢åˆ°æ–°çš„é…ç½®çš„æ–¹æ¡ˆéƒ½æ˜¯ä¸å®‰å…¨çš„ã€‚ä¸€æ¬¡æ€§åŸå­åœ°è½¬æ¢æ‰€æœ‰æœåŠ¡å™¨æ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥åœ¨è½¬æ¢æœŸé—´æ•´ä¸ªé›†ç¾¤å­˜åœ¨åˆ’åˆ†æˆä¸¤ä¸ªç‹¬ç«‹çš„å¤§å¤šæ•°ç¾¤ä½“çš„å¯èƒ½æ€§ï¼ˆè§å›¾ï¼‰ã€‚ ç›´æ¥ä»ä¸€ç§é…ç½®è½¬åˆ°æ–°çš„é…ç½®æ˜¯ååˆ†ä¸å®‰å…¨çš„ï¼Œå› ä¸ºå„ä¸ªæœºå™¨å¯èƒ½åœ¨ä»»ä½•çš„æ—¶å€™è¿›è¡Œè½¬æ¢ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé›†ç¾¤é…é¢ä» 3 å°æœºå™¨å˜æˆäº† 5 å°ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå­˜åœ¨è¿™æ ·çš„ä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œä¸¤ä¸ªä¸åŒçš„é¢†å¯¼äººåœ¨åŒä¸€ä¸ªä»»æœŸé‡Œéƒ½å¯ä»¥è¢«é€‰ä¸¾æˆåŠŸã€‚ä¸€ä¸ªæ˜¯é€šè¿‡æ—§çš„é…ç½®ï¼Œä¸€ä¸ªé€šè¿‡æ–°çš„é…ç½®ã€‚\nä¸ºäº†ä¿è¯å®‰å…¨æ€§ï¼Œé…ç½®æ›´æ”¹å¿…é¡»ä½¿ç”¨ä¸¤é˜¶æ®µæ–¹æ³•ã€‚ç›®å‰æœ‰å¾ˆå¤šç§ä¸¤é˜¶æ®µçš„å®ç°ã€‚ä¾‹å¦‚ï¼Œæœ‰äº›ç³»ç»Ÿåœ¨ç¬¬ä¸€é˜¶æ®µåœæ‰æ—§çš„é…ç½®æ‰€ä»¥é›†ç¾¤å°±ä¸èƒ½å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼›ç„¶ååœ¨ç¬¬äºŒé˜¶æ®µåœ¨å¯ç”¨æ–°çš„é…ç½®ã€‚åœ¨ Raft ä¸­ï¼Œé›†ç¾¤å…ˆåˆ‡æ¢åˆ°ä¸€ä¸ªè¿‡æ¸¡çš„é…ç½®ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå…±åŒä¸€è‡´ï¼›ä¸€æ—¦å…±åŒä¸€è‡´å·²ç»è¢«æäº¤äº†ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±åˆ‡æ¢åˆ°æ–°çš„é…ç½®ä¸Šã€‚å…±åŒä¸€è‡´æ˜¯è€é…ç½®å’Œæ–°é…ç½®çš„ç»“åˆï¼š\næ—¥å¿—æ¡ç›®è¢«å¤åˆ¶ç»™é›†ç¾¤ä¸­æ–°ã€è€é…ç½®çš„æ‰€æœ‰æœåŠ¡å™¨ã€‚ æ–°ã€æ—§é…ç½®çš„æœåŠ¡å™¨éƒ½å¯ä»¥æˆä¸ºé¢†å¯¼äººã€‚ è¾¾æˆä¸€è‡´ï¼ˆé’ˆå¯¹é€‰ä¸¾å’Œæäº¤ï¼‰éœ€è¦åˆ†åˆ«åœ¨ä¸¤ç§é…ç½®ä¸Šè·å¾—å¤§å¤šæ•°çš„æ”¯æŒã€‚ å…±åŒä¸€è‡´å…è®¸ç‹¬ç«‹çš„æœåŠ¡å™¨åœ¨ä¸å½±å“å®‰å…¨æ€§çš„å‰æä¸‹ï¼Œåœ¨ä¸åŒçš„æ—¶é—´è¿›è¡Œé…ç½®è½¬æ¢è¿‡ç¨‹ã€‚æ­¤å¤–ï¼Œå…±åŒä¸€è‡´å¯ä»¥è®©é›†ç¾¤åœ¨é…ç½®è½¬æ¢çš„è¿‡ç¨‹ä¸­ä¾ç„¶å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚ é›†ç¾¤é…ç½®åœ¨å¤åˆ¶æ—¥å¿—ä¸­ä»¥ç‰¹æ®Šçš„æ—¥å¿—æ¡ç›®æ¥å­˜å‚¨å’Œé€šä¿¡ï¼›å›¾ 11 å±•ç¤ºäº†é…ç½®è½¬æ¢çš„è¿‡ç¨‹ã€‚å½“ä¸€ä¸ªé¢†å¯¼äººæ¥æ”¶åˆ°ä¸€ä¸ªæ”¹å˜é…ç½®ä» C-old åˆ° C-new çš„è¯·æ±‚ï¼Œä»–ä¼šä¸ºäº†å…±åŒä¸€è‡´å­˜å‚¨é…ç½®ï¼ˆå›¾ä¸­çš„ C-old,newï¼‰ï¼Œä»¥å‰é¢æè¿°çš„æ—¥å¿—æ¡ç›®å’Œå‰¯æœ¬çš„å½¢å¼ã€‚ä¸€æ—¦ä¸€ä¸ªæœåŠ¡å™¨å°†æ–°çš„é…ç½®æ—¥å¿—æ¡ç›®å¢åŠ åˆ°å®ƒçš„æ—¥å¿—ä¸­ï¼Œä»–å°±ä¼šç”¨è¿™ä¸ªé…ç½®æ¥åšå‡ºæœªæ¥æ‰€æœ‰çš„å†³å®šï¼ˆæœåŠ¡å™¨æ€»æ˜¯ä½¿ç”¨æœ€æ–°çš„é…ç½®ï¼Œæ— è®ºä»–æ˜¯å¦å·²ç»è¢«æäº¤ï¼‰ã€‚è¿™æ„å‘³ç€é¢†å¯¼äººè¦ä½¿ç”¨ C-old,new çš„è§„åˆ™æ¥å†³å®šæ—¥å¿—æ¡ç›® C-old,new ä»€ä¹ˆæ—¶å€™éœ€è¦è¢«æäº¤ã€‚å¦‚æœé¢†å¯¼äººå´©æºƒäº†ï¼Œè¢«é€‰å‡ºæ¥çš„æ–°é¢†å¯¼äººå¯èƒ½æ˜¯ä½¿ç”¨ C-old é…ç½®ä¹Ÿå¯èƒ½æ˜¯ C-old,new é…ç½®ï¼Œè¿™å–å†³äºèµ¢å¾—é€‰ä¸¾çš„å€™é€‰äººæ˜¯å¦å·²ç»æ¥æ”¶åˆ°äº† C-old,new é…ç½®ã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œ C-new é…ç½®åœ¨è¿™ä¸€æ—¶æœŸéƒ½ä¸ä¼šå•æ–¹é¢çš„åšå‡ºå†³å®šã€‚\nä¸€æ—¦ C-old,new è¢«æäº¤ï¼Œé‚£ä¹ˆæ— è®ºæ˜¯ C-old è¿˜æ˜¯ C-newï¼Œåœ¨æ²¡æœ‰ç»è¿‡ä»–äººæ‰¹å‡†çš„æƒ…å†µä¸‹éƒ½ä¸å¯èƒ½åšå‡ºå†³å®šï¼Œå¹¶ä¸”é¢†å¯¼äººå®Œå…¨ç‰¹æ€§ä¿è¯äº†åªæœ‰æ‹¥æœ‰ C-old,new æ—¥å¿—æ¡ç›®çš„æœåŠ¡å™¨æ‰æœ‰å¯èƒ½è¢«é€‰ä¸¾ä¸ºé¢†å¯¼äººã€‚è¿™ä¸ªæ—¶å€™ï¼Œé¢†å¯¼äººåˆ›å»ºä¸€æ¡å…³äº C-new é…ç½®çš„æ—¥å¿—æ¡ç›®å¹¶å¤åˆ¶ç»™é›†ç¾¤å°±æ˜¯å®‰å…¨çš„äº†ã€‚å†è€…ï¼Œæ¯ä¸ªæœåŠ¡å™¨åœ¨è§åˆ°æ–°çš„é…ç½®çš„æ—¶å€™å°±ä¼šç«‹å³ç”Ÿæ•ˆã€‚å½“æ–°çš„é…ç½®åœ¨ C-new çš„è§„åˆ™ä¸‹è¢«æäº¤ï¼Œæ—§çš„é…ç½®å°±å˜å¾—æ— å…³ç´§è¦ï¼ŒåŒæ—¶ä¸ä½¿ç”¨æ–°çš„é…ç½®çš„æœåŠ¡å™¨å°±å¯ä»¥è¢«å…³é—­äº†ã€‚å¦‚å›¾ 11ï¼ŒC-old å’Œ C-new æ²¡æœ‰ä»»ä½•æœºä¼šåŒæ—¶åšå‡ºå•æ–¹é¢çš„å†³å®šï¼›è¿™ä¿è¯äº†å®‰å…¨æ€§ã€‚ å›¾ 11ï¼šä¸€ä¸ªé…ç½®åˆ‡æ¢çš„æ—¶é—´çº¿ã€‚è™šçº¿è¡¨ç¤ºå·²ç»è¢«åˆ›å»ºä½†æ˜¯è¿˜æ²¡æœ‰è¢«æäº¤çš„é…ç½®æ—¥å¿—æ¡ç›®ï¼Œå®çº¿è¡¨ç¤ºæœ€åè¢«æäº¤çš„é…ç½®æ—¥å¿—æ¡ç›®ã€‚é¢†å¯¼äººé¦–å…ˆåˆ›å»ºäº† C-old,new çš„é…ç½®æ¡ç›®åœ¨è‡ªå·±çš„æ—¥å¿—ä¸­ï¼Œå¹¶æäº¤åˆ° C-old,new ä¸­ï¼ˆC-old çš„å¤§å¤šæ•°å’Œ C-new çš„å¤§å¤šæ•°ï¼‰ã€‚ç„¶åä»–åˆ›å»º C-new æ¡ç›®å¹¶æäº¤åˆ° C-new ä¸­çš„å¤§å¤šæ•°ã€‚è¿™æ ·å°±ä¸å­˜åœ¨ C-new å’Œ C-old å¯ä»¥åŒæ—¶åšå‡ºå†³å®šçš„æ—¶é—´ç‚¹ã€‚\nåœ¨å…³äºé‡æ–°é…ç½®è¿˜æœ‰ä¸‰ä¸ªé—®é¢˜éœ€è¦æå‡ºã€‚ ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæ–°çš„æœåŠ¡å™¨å¯èƒ½åˆå§‹åŒ–æ²¡æœ‰å­˜å‚¨ä»»ä½•çš„æ—¥å¿—æ¡ç›®ã€‚å½“è¿™äº›æœåŠ¡å™¨ä»¥è¿™ç§çŠ¶æ€åŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œé‚£ä¹ˆä»–ä»¬éœ€è¦ä¸€æ®µæ—¶é—´æ¥æ›´æ–°è¿½èµ¶ï¼Œè¿™æ—¶è¿˜ä¸èƒ½æäº¤æ–°çš„æ—¥å¿—æ¡ç›®ã€‚ä¸ºäº†é¿å…è¿™ç§å¯ç”¨æ€§çš„é—´éš”æ—¶é—´ï¼ŒRaft åœ¨é…ç½®æ›´æ–°ä¹‹å‰ä½¿ç”¨äº†ä¸€ç§é¢å¤–çš„é˜¶æ®µï¼Œåœ¨è¿™ä¸ªé˜¶æ®µï¼Œæ–°çš„æœåŠ¡å™¨ä»¥æ²¡æœ‰æŠ•ç¥¨æƒèº«ä»½åŠ å…¥åˆ°é›†ç¾¤ä¸­æ¥ï¼ˆé¢†å¯¼äººå¤åˆ¶æ—¥å¿—ç»™ä»–ä»¬ï¼Œä½†æ˜¯ä¸è€ƒè™‘ä»–ä»¬æ˜¯å¤§å¤šæ•°ï¼‰ã€‚ä¸€æ—¦æ–°çš„æœåŠ¡å™¨è¿½èµ¶ä¸Šäº†é›†ç¾¤ä¸­çš„å…¶ä»–æœºå™¨ï¼Œé‡æ–°é…ç½®å¯ä»¥åƒä¸Šé¢æè¿°çš„ä¸€æ ·å¤„ç†ã€‚\nç¬¬äºŒä¸ªé—®é¢˜æ˜¯ï¼Œé›†ç¾¤çš„é¢†å¯¼äººå¯èƒ½ä¸æ˜¯æ–°é…ç½®çš„ä¸€å‘˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé¢†å¯¼äººå°±ä¼šåœ¨æäº¤äº† C-new æ—¥å¿—ä¹‹åé€€ä½ï¼ˆå›åˆ°è·Ÿéšè€…çŠ¶æ€ï¼‰ã€‚è¿™æ„å‘³ç€æœ‰è¿™æ ·çš„ä¸€æ®µæ—¶é—´ï¼Œé¢†å¯¼äººç®¡ç†ç€é›†ç¾¤ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬ä»–è‡ªå·±ï¼›ä»–å¤åˆ¶æ—¥å¿—ä½†æ˜¯ä¸æŠŠä»–è‡ªå·±ç®—ä½œæ˜¯å¤§å¤šæ•°ä¹‹ä¸€ã€‚å½“ C-new è¢«æäº¤æ—¶ï¼Œä¼šå‘ç”Ÿé¢†å¯¼äººè¿‡æ¸¡ï¼Œå› ä¸ºè¿™æ—¶æ˜¯æœ€æ—©æ–°çš„é…ç½®å¯ä»¥ç‹¬ç«‹å·¥ä½œçš„æ—¶é—´ç‚¹ï¼ˆå°†æ€»æ˜¯èƒ½å¤Ÿåœ¨ C-new é…ç½®ä¸‹é€‰å‡ºæ–°çš„é¢†å¯¼äººï¼‰ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå¯èƒ½åªèƒ½ä» C-old ä¸­é€‰å‡ºé¢†å¯¼äººã€‚\nç¬¬ä¸‰ä¸ªé—®é¢˜æ˜¯ï¼Œç§»é™¤ä¸åœ¨ C-new ä¸­çš„æœåŠ¡å™¨å¯èƒ½ä¼šæ‰°ä¹±é›†ç¾¤ã€‚è¿™äº›æœåŠ¡å™¨å°†ä¸ä¼šå†æ¥æ”¶åˆ°å¿ƒè·³ï¼Œæ‰€ä»¥å½“é€‰ä¸¾è¶…æ—¶ï¼Œä»–ä»¬å°±ä¼šè¿›è¡Œæ–°çš„é€‰ä¸¾è¿‡ç¨‹ã€‚ä»–ä»¬ä¼šå‘é€æ‹¥æœ‰æ–°çš„ä»»æœŸå·çš„è¯·æ±‚æŠ•ç¥¨ RPCsï¼Œè¿™æ ·ä¼šå¯¼è‡´å½“å‰çš„é¢†å¯¼äººå›é€€æˆè·Ÿéšè€…çŠ¶æ€ã€‚æ–°çš„é¢†å¯¼äººæœ€ç»ˆä¼šè¢«é€‰å‡ºæ¥ï¼Œä½†æ˜¯è¢«ç§»é™¤çš„æœåŠ¡å™¨å°†ä¼šå†æ¬¡è¶…æ—¶ï¼Œç„¶åè¿™ä¸ªè¿‡ç¨‹ä¼šå†æ¬¡é‡å¤ï¼Œå¯¼è‡´æ•´ä½“å¯ç”¨æ€§å¤§å¹…é™ä½ã€‚\nä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œå½“æœåŠ¡å™¨ç¡®è®¤å½“å‰é¢†å¯¼äººå­˜åœ¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå¿½ç•¥è¯·æ±‚æŠ•ç¥¨ RPCsã€‚ç‰¹åˆ«çš„ï¼Œå½“æœåŠ¡å™¨åœ¨å½“å‰æœ€å°é€‰ä¸¾è¶…æ—¶æ—¶é—´å†…æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚æŠ•ç¥¨ RPCï¼Œä»–ä¸ä¼šæ›´æ–°å½“å‰çš„ä»»æœŸå·æˆ–è€…æŠ•å‡ºé€‰ç¥¨ã€‚è¿™ä¸ä¼šå½±å“æ­£å¸¸çš„é€‰ä¸¾ï¼Œæ¯ä¸ªæœåŠ¡å™¨åœ¨å¼€å§‹ä¸€æ¬¡é€‰ä¸¾ä¹‹å‰ï¼Œè‡³å°‘ç­‰å¾…ä¸€ä¸ªæœ€å°é€‰ä¸¾è¶…æ—¶æ—¶é—´ã€‚ç„¶è€Œï¼Œè¿™æœ‰åˆ©äºé¿å…è¢«ç§»é™¤çš„æœåŠ¡å™¨æ‰°ä¹±ï¼šå¦‚æœé¢†å¯¼äººèƒ½å¤Ÿå‘é€å¿ƒè·³ç»™é›†ç¾¤ï¼Œé‚£ä¹ˆä»–å°±ä¸ä¼šè¢«æ›´å¤§çš„ä»»æœŸå·åºŸé»œã€‚\n6. æ—¥å¿—å‹ç¼© Raft çš„æ—¥å¿—åœ¨æ­£å¸¸æ“ä½œä¸­ä¸æ–­çš„å¢é•¿ï¼Œä½†æ˜¯åœ¨å®é™…çš„ç³»ç»Ÿä¸­ï¼Œæ—¥å¿—ä¸èƒ½æ— é™åˆ¶çš„å¢é•¿ã€‚éšç€æ—¥å¿—ä¸æ–­å¢é•¿ï¼Œä»–ä¼šå ç”¨è¶Šæ¥è¶Šå¤šçš„ç©ºé—´ï¼ŒèŠ±è´¹è¶Šæ¥è¶Šå¤šçš„æ—¶é—´æ¥é‡ç½®ã€‚å¦‚æœæ²¡æœ‰ä¸€å®šçš„æœºåˆ¶å»æ¸…é™¤æ—¥å¿—é‡Œç§¯ç´¯çš„é™ˆæ—§çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆä¼šå¸¦æ¥å¯ç”¨æ€§é—®é¢˜ã€‚\nå¿«ç…§æ˜¯æœ€ç®€å•çš„å‹ç¼©æ–¹æ³•ã€‚åœ¨å¿«ç…§ç³»ç»Ÿä¸­ï¼Œæ•´ä¸ªç³»ç»Ÿçš„çŠ¶æ€éƒ½ä»¥å¿«ç…§çš„å½¢å¼å†™å…¥åˆ°ç¨³å®šçš„æŒä¹…åŒ–å­˜å‚¨ä¸­ï¼Œç„¶ååˆ°é‚£ä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„æ—¥å¿—å…¨éƒ¨ä¸¢å¼ƒã€‚å¿«ç…§æŠ€æœ¯è¢«ä½¿ç”¨åœ¨ Chubby å’Œ ZooKeeper ä¸­ï¼Œæ¥ä¸‹æ¥çš„ç« èŠ‚ä¼šä»‹ç» Raft ä¸­çš„å¿«ç…§æŠ€æœ¯ã€‚\nå¢é‡å‹ç¼©çš„æ–¹æ³•ï¼Œä¾‹å¦‚æ—¥å¿—æ¸…ç†æˆ–è€…æ—¥å¿—ç»“æ„åˆå¹¶æ ‘ï¼Œéƒ½æ˜¯å¯è¡Œçš„ã€‚è¿™äº›æ–¹æ³•æ¯æ¬¡åªå¯¹ä¸€å°éƒ¨åˆ†æ•°æ®è¿›è¡Œæ“ä½œï¼Œè¿™æ ·å°±åˆ†æ•£äº†å‹ç¼©çš„è´Ÿè½½å‹åŠ›ã€‚é¦–å…ˆï¼Œä»–ä»¬å…ˆé€‰æ‹©ä¸€ä¸ªå·²ç»ç§¯ç´¯çš„å¤§é‡å·²ç»è¢«åˆ é™¤æˆ–è€…è¢«è¦†ç›–å¯¹è±¡çš„åŒºåŸŸï¼Œç„¶åé‡å†™é‚£ä¸ªåŒºåŸŸè¿˜æ´»è·ƒçš„å¯¹è±¡ï¼Œä¹‹åé‡Šæ”¾é‚£ä¸ªåŒºåŸŸã€‚å’Œç®€å•æ“ä½œæ•´ä¸ªæ•°æ®é›†åˆçš„å¿«ç…§ç›¸æ¯”ï¼Œéœ€è¦å¢åŠ å¤æ‚çš„æœºåˆ¶æ¥å®ç°ã€‚çŠ¶æ€æœºå¯ä»¥å®ç° LSM tree ä½¿ç”¨å’Œå¿«ç…§ç›¸åŒçš„æ¥å£ï¼Œä½†æ˜¯æ—¥å¿—æ¸…é™¤æ–¹æ³•å°±éœ€è¦ä¿®æ”¹ Raft äº†ã€‚ å›¾ 12ï¼šä¸€ä¸ªæœåŠ¡å™¨ç”¨æ–°çš„å¿«ç…§æ›¿æ¢äº†ä» 1 åˆ° 5 çš„æ¡ç›®ï¼Œå¿«ç…§å€¼å­˜å‚¨äº†å½“å‰çš„çŠ¶æ€ã€‚å¿«ç…§ä¸­åŒ…å«äº†æœ€åçš„ç´¢å¼•ä½ç½®å’Œä»»æœŸå·ã€‚\nå›¾ 12 å±•ç¤ºäº† Raft ä¸­å¿«ç…§çš„åŸºç¡€æ€æƒ³ã€‚æ¯ä¸ªæœåŠ¡å™¨ç‹¬ç«‹çš„åˆ›å»ºå¿«ç…§ï¼ŒåªåŒ…æ‹¬å·²ç»è¢«æäº¤çš„æ—¥å¿—ã€‚ä¸»è¦çš„å·¥ä½œåŒ…æ‹¬å°†çŠ¶æ€æœºçš„çŠ¶æ€å†™å…¥åˆ°å¿«ç…§ä¸­ã€‚Raft ä¹ŸåŒ…å«ä¸€äº›å°‘é‡çš„å…ƒæ•°æ®åˆ°å¿«ç…§ä¸­ï¼šæœ€åè¢«åŒ…å«ç´¢å¼•æŒ‡çš„æ˜¯è¢«å¿«ç…§å–ä»£çš„æœ€åçš„æ¡ç›®åœ¨æ—¥å¿—ä¸­çš„ç´¢å¼•å€¼ï¼ˆçŠ¶æ€æœºæœ€ååº”ç”¨çš„æ—¥å¿—ï¼‰ï¼Œæœ€åè¢«åŒ…å«çš„ä»»æœŸæŒ‡çš„æ˜¯è¯¥æ¡ç›®çš„ä»»æœŸå·ã€‚ä¿ç•™è¿™äº›æ•°æ®æ˜¯ä¸ºäº†æ”¯æŒå¿«ç…§åç´§æ¥ç€çš„ç¬¬ä¸€ä¸ªæ¡ç›®çš„é™„åŠ æ—¥å¿—è¯·æ±‚æ—¶çš„ä¸€è‡´æ€§æ£€æŸ¥ï¼Œå› ä¸ºè¿™ä¸ªæ¡ç›®éœ€è¦å‰ä¸€æ—¥å¿—æ¡ç›®çš„ç´¢å¼•å€¼å’Œä»»æœŸå·ã€‚ä¸ºäº†æ”¯æŒé›†ç¾¤æˆå‘˜æ›´æ–°ï¼ˆç¬¬ 5 èŠ‚ï¼‰ï¼Œå¿«ç…§ä¸­ä¹Ÿå°†æœ€åçš„ä¸€æ¬¡é…ç½®ä½œä¸ºæœ€åä¸€ä¸ªæ¡ç›®å­˜ä¸‹æ¥ã€‚ä¸€æ—¦æœåŠ¡å™¨å®Œæˆä¸€æ¬¡å¿«ç…§ï¼Œä»–å°±å¯ä»¥åˆ é™¤æœ€åç´¢å¼•ä½ç½®ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—å’Œå¿«ç…§äº†ã€‚\nå°½ç®¡é€šå¸¸æœåŠ¡å™¨éƒ½æ˜¯ç‹¬ç«‹çš„åˆ›å»ºå¿«ç…§ï¼Œä½†æ˜¯é¢†å¯¼äººå¿…é¡»å¶å°”çš„å‘é€å¿«ç…§ç»™ä¸€äº›è½åçš„è·Ÿéšè€…ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨å½“é¢†å¯¼äººå·²ç»ä¸¢å¼ƒäº†ä¸‹ä¸€æ¡éœ€è¦å‘é€ç»™è·Ÿéšè€…çš„æ—¥å¿—æ¡ç›®çš„æ—¶å€™ã€‚å¹¸è¿çš„æ˜¯è¿™ç§æƒ…å†µä¸æ˜¯å¸¸è§„æ“ä½œï¼šä¸€ä¸ªä¸é¢†å¯¼äººä¿æŒåŒæ­¥çš„è·Ÿéšè€…é€šå¸¸éƒ½ä¼šæœ‰è¿™ä¸ªæ¡ç›®ã€‚ç„¶è€Œä¸€ä¸ªè¿è¡Œéå¸¸ç¼“æ…¢çš„è·Ÿéšè€…æˆ–è€…æ–°åŠ å…¥é›†ç¾¤çš„æœåŠ¡å™¨(ç¬¬5èŠ‚)å°†ä¸ä¼šæœ‰è¿™ä¸ªæ¡ç›®ã€‚è¿™æ—¶è®©è¿™ä¸ªè·Ÿéšè€…æ›´æ–°åˆ°æœ€æ–°çš„çŠ¶æ€çš„æ–¹å¼å°±æ˜¯é€šè¿‡ç½‘ç»œæŠŠå¿«ç…§å‘é€ç»™ä»–ä»¬ã€‚\nå®‰è£…å¿«ç…§ RPCï¼š ç”±é¢†å¯¼äººè°ƒç”¨ä»¥å°†å¿«ç…§çš„åˆ†å—å‘é€ç»™è·Ÿéšè€…ã€‚é¢†å¯¼è€…æ€»æ˜¯æŒ‰é¡ºåºå‘é€åˆ†å—ã€‚\nå‚æ•° è§£é‡Š term é¢†å¯¼äººçš„ä»»æœŸå· leaderId é¢†å¯¼äººçš„ Idï¼Œä»¥ä¾¿äºè·Ÿéšè€…é‡å®šå‘è¯·æ±‚ lastIncludedIndex å¿«ç…§ä¸­åŒ…å«çš„æœ€åæ—¥å¿—æ¡ç›®çš„ç´¢å¼•å€¼ lastIncludedTerm å¿«ç…§ä¸­åŒ…å«çš„æœ€åæ—¥å¿—æ¡ç›®çš„ä»»æœŸå· offset åˆ†å—åœ¨å¿«ç…§ä¸­çš„å­—èŠ‚åç§»é‡ data[] ä»åç§»é‡å¼€å§‹çš„å¿«ç…§åˆ†å—çš„åŸå§‹å­—èŠ‚ done å¦‚æœè¿™æ˜¯æœ€åä¸€ä¸ªåˆ†å—åˆ™ä¸º true ç»“æœ è§£é‡Š term å½“å‰ä»»æœŸå·ï¼ˆcurrentTermï¼‰ï¼Œä¾¿äºé¢†å¯¼äººæ›´æ–°è‡ªå·± æ¥æ”¶è€…å®ç°ï¼š\nå¦‚æœterm \u0026lt; currentTermå°±ç«‹å³å›å¤ å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªåˆ†å—ï¼ˆoffset ä¸º 0ï¼‰å°±åˆ›å»ºä¸€ä¸ªæ–°çš„å¿«ç…§ åœ¨æŒ‡å®šåç§»é‡å†™å…¥æ•°æ® å¦‚æœ done æ˜¯ falseï¼Œåˆ™ç»§ç»­ç­‰å¾…æ›´å¤šçš„æ•°æ® ä¿å­˜å¿«ç…§æ–‡ä»¶ï¼Œä¸¢å¼ƒå…·æœ‰è¾ƒå°ç´¢å¼•çš„ä»»ä½•ç°æœ‰æˆ–éƒ¨åˆ†å¿«ç…§ å¦‚æœç°å­˜çš„æ—¥å¿—æ¡ç›®ä¸å¿«ç…§ä¸­æœ€ååŒ…å«çš„æ—¥å¿—æ¡ç›®å…·æœ‰ç›¸åŒçš„ç´¢å¼•å€¼å’Œä»»æœŸå·ï¼Œåˆ™ä¿ç•™å…¶åçš„æ—¥å¿—æ¡ç›®å¹¶è¿›è¡Œå›å¤ ä¸¢å¼ƒæ•´ä¸ªæ—¥å¿— ä½¿ç”¨å¿«ç…§é‡ç½®çŠ¶æ€æœºï¼ˆå¹¶åŠ è½½å¿«ç…§çš„é›†ç¾¤é…ç½®ï¼‰ åœ¨è¿™ç§æƒ…å†µä¸‹é¢†å¯¼äººä½¿ç”¨ä¸€ç§å«åšå®‰è£…å¿«ç…§çš„æ–°çš„ RPC æ¥å‘é€å¿«ç…§ç»™å¤ªè½åçš„è·Ÿéšè€…ï¼›è§å›¾ 13ã€‚å½“è·Ÿéšè€…é€šè¿‡è¿™ç§ RPC æ¥æ”¶åˆ°å¿«ç…§æ—¶ï¼Œä»–å¿…é¡»è‡ªå·±å†³å®šå¯¹äºå·²ç»å­˜åœ¨çš„æ—¥å¿—è¯¥å¦‚ä½•å¤„ç†ã€‚é€šå¸¸å¿«ç…§ä¼šåŒ…å«æ²¡æœ‰åœ¨æ¥æ”¶è€…æ—¥å¿—ä¸­å­˜åœ¨çš„ä¿¡æ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè·Ÿéšè€…ä¸¢å¼ƒå…¶æ•´ä¸ªæ—¥å¿—ï¼›å®ƒå…¨éƒ¨è¢«å¿«ç…§å–ä»£ï¼Œå¹¶ä¸”å¯èƒ½åŒ…å«ä¸å¿«ç…§å†²çªçš„æœªæäº¤æ¡ç›®ã€‚å¦‚æœæ¥æ”¶åˆ°çš„å¿«ç…§æ˜¯è‡ªå·±æ—¥å¿—çš„å‰é¢éƒ¨åˆ†ï¼ˆç”±äºç½‘ç»œé‡ä¼ æˆ–è€…é”™è¯¯ï¼‰ï¼Œé‚£ä¹ˆè¢«å¿«ç…§åŒ…å«çš„æ¡ç›®å°†ä¼šè¢«å…¨éƒ¨åˆ é™¤ï¼Œä½†æ˜¯å¿«ç…§åé¢çš„æ¡ç›®ä»ç„¶æœ‰æ•ˆï¼Œå¿…é¡»ä¿ç•™ã€‚\nè¿™ç§å¿«ç…§çš„æ–¹å¼èƒŒç¦»äº† Raft çš„å¼ºé¢†å¯¼äººåŸåˆ™ï¼Œå› ä¸ºè·Ÿéšè€…å¯ä»¥åœ¨ä¸çŸ¥é“é¢†å¯¼äººæƒ…å†µä¸‹åˆ›å»ºå¿«ç…§ã€‚ä½†æ˜¯æˆ‘ä»¬è®¤ä¸ºè¿™ç§èƒŒç¦»æ˜¯å€¼å¾—çš„ã€‚é¢†å¯¼äººçš„å­˜åœ¨ï¼Œæ˜¯ä¸ºäº†è§£å†³åœ¨è¾¾æˆä¸€è‡´æ€§çš„æ—¶å€™çš„å†²çªï¼Œä½†æ˜¯åœ¨åˆ›å»ºå¿«ç…§çš„æ—¶å€™ï¼Œä¸€è‡´æ€§å·²ç»è¾¾æˆï¼Œè¿™æ—¶ä¸å­˜åœ¨å†²çªäº†ï¼Œæ‰€ä»¥æ²¡æœ‰é¢†å¯¼äººä¹Ÿæ˜¯å¯ä»¥çš„ã€‚æ•°æ®ä¾ç„¶æ˜¯ä»é¢†å¯¼äººä¼ ç»™è·Ÿéšè€…ï¼Œåªæ˜¯è·Ÿéšè€…å¯ä»¥é‡æ–°ç»„ç»‡ä»–ä»¬çš„æ•°æ®äº†ã€‚\næˆ‘ä»¬è€ƒè™‘è¿‡ä¸€ç§æ›¿ä»£çš„åŸºäºé¢†å¯¼äººçš„å¿«ç…§æ–¹æ¡ˆï¼Œå³åªæœ‰é¢†å¯¼äººåˆ›å»ºå¿«ç…§ï¼Œç„¶åå‘é€ç»™æ‰€æœ‰çš„è·Ÿéšè€…ã€‚ä½†æ˜¯è¿™æ ·åšæœ‰ä¸¤ä¸ªç¼ºç‚¹ã€‚ç¬¬ä¸€ï¼Œå‘é€å¿«ç…§ä¼šæµªè´¹ç½‘ç»œå¸¦å®½å¹¶ä¸”å»¶ç¼“äº†å¿«ç…§å¤„ç†çš„æ—¶é—´ã€‚æ¯ä¸ªè·Ÿéšè€…éƒ½å·²ç»æ‹¥æœ‰äº†æ‰€æœ‰äº§ç”Ÿå¿«ç…§éœ€è¦çš„ä¿¡æ¯ï¼Œè€Œä¸”å¾ˆæ˜¾ç„¶ï¼Œè‡ªå·±ä»æœ¬åœ°çš„çŠ¶æ€ä¸­åˆ›å»ºå¿«ç…§æ¯”é€šè¿‡ç½‘ç»œæ¥æ”¶åˆ«äººå‘æ¥çš„è¦ç»æµã€‚ç¬¬äºŒï¼Œé¢†å¯¼äººçš„å®ç°ä¼šæ›´åŠ å¤æ‚ã€‚ä¾‹å¦‚ï¼Œé¢†å¯¼äººéœ€è¦å‘é€å¿«ç…§çš„åŒæ—¶å¹¶è¡Œçš„å°†æ–°çš„æ—¥å¿—æ¡ç›®å‘é€ç»™è·Ÿéšè€…ï¼Œè¿™æ ·æ‰ä¸ä¼šé˜»å¡æ–°çš„å®¢æˆ·ç«¯è¯·æ±‚ã€‚\nè¿˜æœ‰ä¸¤ä¸ªé—®é¢˜å½±å“äº†å¿«ç…§çš„æ€§èƒ½ã€‚é¦–å…ˆï¼ŒæœåŠ¡å™¨å¿…é¡»å†³å®šä»€ä¹ˆæ—¶å€™åº”è¯¥åˆ›å»ºå¿«ç…§ã€‚å¦‚æœå¿«ç…§åˆ›å»ºçš„è¿‡äºé¢‘ç¹ï¼Œé‚£ä¹ˆå°±ä¼šæµªè´¹å¤§é‡çš„ç£ç›˜å¸¦å®½å’Œå…¶ä»–èµ„æºï¼›å¦‚æœåˆ›å»ºå¿«ç…§é¢‘ç‡å¤ªä½ï¼Œä»–å°±è¦æ‰¿å—è€—å°½å­˜å‚¨å®¹é‡çš„é£é™©ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº†ä»æ—¥å¿—é‡å»ºçš„æ—¶é—´ã€‚ä¸€ä¸ªç®€å•çš„ç­–ç•¥å°±æ˜¯å½“æ—¥å¿—å¤§å°è¾¾åˆ°ä¸€ä¸ªå›ºå®šå¤§å°çš„æ—¶å€™å°±åˆ›å»ºä¸€æ¬¡å¿«ç…§ã€‚å¦‚æœè¿™ä¸ªé˜ˆå€¼è®¾ç½®çš„æ˜¾è‘—å¤§äºæœŸæœ›çš„å¿«ç…§çš„å¤§å°ï¼Œé‚£ä¹ˆå¿«ç…§å¯¹ç£ç›˜å‹åŠ›çš„å½±å“å°±ä¼šå¾ˆå°äº†ã€‚\nç¬¬äºŒä¸ªå½±å“æ€§èƒ½çš„é—®é¢˜å°±æ˜¯å†™å…¥å¿«ç…§éœ€è¦èŠ±è´¹æ˜¾è‘—çš„ä¸€æ®µæ—¶é—´ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜ä¸å¸Œæœ›å½±å“åˆ°æ­£å¸¸æ“ä½œã€‚è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡å†™æ—¶å¤åˆ¶çš„æŠ€æœ¯ï¼Œè¿™æ ·æ–°çš„æ›´æ–°å°±å¯ä»¥è¢«æ¥æ”¶è€Œä¸å½±å“åˆ°å¿«ç…§ã€‚ä¾‹å¦‚ï¼Œå…·æœ‰å‡½æ•°å¼æ•°æ®ç»“æ„çš„çŠ¶æ€æœºå¤©ç„¶æ”¯æŒè¿™æ ·çš„åŠŸèƒ½ã€‚å¦å¤–ï¼Œæ“ä½œç³»ç»Ÿçš„å†™æ—¶å¤åˆ¶æŠ€æœ¯çš„æ”¯æŒï¼ˆå¦‚ Linux ä¸Šçš„ forkï¼‰å¯ä»¥è¢«ç”¨æ¥åˆ›å»ºå®Œæ•´çš„çŠ¶æ€æœºçš„å†…å­˜å¿«ç…§ï¼ˆæˆ‘ä»¬çš„å®ç°å°±æ˜¯è¿™æ ·çš„ï¼‰ã€‚\n","permalink":"https://reid00.github.io/en/posts/storage/raft-%E4%BB%8B%E7%BB%8D/","summary":"1. Raft ç®—æ³•ç®€ä»‹ 1.1 Raft èƒŒæ™¯ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€è‡´æ€§ç®—æ³•è‡³å…³é‡è¦ã€‚åœ¨æ‰€æœ‰ä¸€è‡´æ€§ç®—æ³•ä¸­ï¼ŒPaxos æœ€è´Ÿç››åï¼Œå®ƒç”±è±æ–¯åˆ©Â·å…°ä¼¯ç‰¹ï¼ˆLeslie Lamportï¼‰äº 1990 å¹´æå‡ºï¼Œæ˜¯ä¸€ç§åŸºäºæ¶ˆæ¯ä¼ é€’çš„ä¸€è‡´æ€§ç®—æ³•ï¼Œè¢«è®¤ä¸ºæ˜¯ç±»ä¼¼ç®—æ³•ä¸­æœ€æœ‰æ•ˆçš„ã€‚\nPaxos ç®—æ³•è™½ç„¶å¾ˆæœ‰æ•ˆï¼Œä½†å¤æ‚çš„åŸç†ä½¿å®ƒå®ç°èµ·æ¥éå¸¸å›°éš¾ï¼Œæˆªæ­¢ç›®å‰ï¼Œå®ç° Paxos ç®—æ³•çš„å¼€æºè½¯ä»¶å¾ˆå°‘ï¼Œæ¯”è¾ƒå‡ºåçš„æœ‰ Chubbyã€LibPaxosã€‚æ­¤å¤–ï¼ŒZookeeper é‡‡ç”¨çš„ ZABï¼ˆZookeeper Atomic Broadcastï¼‰åè®®ä¹Ÿæ˜¯åŸºäº Paxos ç®—æ³•å®ç°çš„ï¼Œä¸è¿‡ ZAB å¯¹ Paxos è¿›è¡Œäº†å¾ˆå¤šæ”¹è¿›ä¸ä¼˜åŒ–ï¼Œä¸¤è€…çš„è®¾è®¡ç›®æ ‡ä¹Ÿå­˜åœ¨å·®å¼‚â€”â€”ZAB åè®®ä¸»è¦ç”¨äºæ„å»ºä¸€ä¸ªé«˜å¯ç”¨çš„åˆ†å¸ƒå¼æ•°æ®ä¸»å¤‡ç³»ç»Ÿï¼Œè€Œ Paxos ç®—æ³•åˆ™æ˜¯ç”¨äºæ„å»ºä¸€ä¸ªåˆ†å¸ƒå¼çš„ä¸€è‡´æ€§çŠ¶æ€æœºç³»ç»Ÿã€‚\nç”±äº Paxos ç®—æ³•è¿‡äºå¤æ‚ã€å®ç°å›°éš¾ï¼Œæå¤§åœ°åˆ¶çº¦äº†å…¶åº”ç”¨ï¼Œè€Œåˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸåˆäºŸéœ€ä¸€ç§é«˜æ•ˆè€Œæ˜“äºå®ç°çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ï¼Œåœ¨æ­¤èƒŒæ™¯ä¸‹ï¼ŒRaft ç®—æ³•åº”è¿è€Œç”Ÿã€‚\nRaft ç®—æ³•åœ¨æ–¯å¦ç¦ Diego Ongaro å’Œ John Ousterhout äº 2013 å¹´å‘è¡¨çš„ã€ŠIn Search of an Understandable Consensus Algorithmã€‹ä¸­æå‡ºã€‚ç›¸è¾ƒäº Paxosï¼ŒRaft é€šè¿‡é€»è¾‘åˆ†ç¦»ä½¿å…¶æ›´å®¹æ˜“ç†è§£å’Œå®ç°ï¼Œç›®å‰ï¼Œå·²ç»æœ‰åå¤šç§è¯­è¨€çš„ Raft ç®—æ³•å®ç°æ¡†æ¶ï¼Œè¾ƒä¸ºå‡ºåçš„æœ‰ etcdã€Consul ã€‚\næœ¬æ–‡åŸºäºè®ºæ–‡In Search of an Understandable Consensus Algorithmå¯¹raftåè®®è¿›è¡Œåˆ†æï¼Œå½“ç„¶ï¼Œè¿˜æ˜¯å»ºè®®è¯»è€…ç›´æ¥çœ‹è®ºæ–‡ã€‚\nç›¸å…³é“¾æ¥:\nè®ºæ–‡ å®˜ç½‘ åŠ¨ç”»å±•ç¤º åˆ†å¸ƒå¼å…±è¯†ç®—æ³•æ ¸å¿ƒç†è®ºåŸºç¡€ åœ¨æ­£å¼è°ˆraftä¹‹å‰ï¼Œè¿˜éœ€è¦ç®€å•ä»‹ç»ä¸‹åˆ†å¸ƒå¼å…±è¯†ç®—æ³•æ‰€åŸºäºçš„ç†è®ºå·¥å…·ã€‚åˆ†å¸ƒå¼å…±è¯†åè®®åœ¨å¤åˆ¶çŠ¶æ€æœºçš„èƒŒæ™¯ä¸‹äº§ç”Ÿçš„ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œä¸€ç»„æœåŠ¡å™¨ä¸Šçš„çŠ¶æ€æœºè®¡ç®—ç›¸åŒçš„å‰¯æœ¬ï¼Œå³ä¾¿æŸå°æœºå™¨å®•æœºä¾ç„¶ä¼šç»§ç»­è¿è¡Œã€‚å¤åˆ¶çŠ¶æ€æœºæ˜¯åŸºäºæ—¥å¿—å®ç°çš„ã€‚åœ¨è¿™é‡Œæœ‰å¿…è¦å” å¨ä¸¤å¥æ—¥å¿—çš„ç‰¹æ€§ã€‚æ—¥å¿—å¯ä»¥çœ‹åšä¸€ä¸ªç®€å•çš„å­˜å‚¨æŠ½è±¡ï¼Œappend onlyï¼ŒæŒ‰ç…§æ—¶é—´å®Œå…¨æœ‰åºï¼Œæ³¨æ„è¿™é‡Œé¢çš„æ—¥å¿—å¹¶ä¸æ˜¯log4jæˆ–æ˜¯syslogæ‰“å‡ºæ¥çš„ä¸šåŠ¡æ—¥å¿—ï¼Œé‚£ä¸ªæˆ‘ä»¬ç§°ä¹‹ä¸ºåº”ç”¨æ—¥å¿—ï¼Œè¿™é‡Œçš„æ—¥å¿—æ˜¯ç”¨äºç¨‹åºè®¿é—®çš„å­˜å‚¨ç»“æ„ã€‚æœ‰äº†ä¸Šé¢çš„é™åˆ¶ï¼Œä½¿ç”¨æ—¥å¿—å°±èƒ½å¤Ÿä¿è¯è¿™æ ·ä¸€ä»¶äº‹ã€‚å¦‚å›¾æ‰€ç¤º æˆ‘æœ‰ä¸€ä¸ªæ—¥å¿—ï¼Œé‡Œé¢å­˜å‚¨çš„æ˜¯ä¸€ç³»åˆ—çš„å¯¹æ•°æ®çš„æ“ä½œï¼Œæ­¤æ—¶ç³»ç»Ÿå¤–éƒ¨æœ‰ä¸€ç³»åˆ—è¾“å…¥æ•°æ®ï¼Œè¾“å…¥åˆ°è¿™ä¸ªæ—¥å¿—ä¸­ï¼Œç»è¿‡æ—¥å¿—ä¸­ä¸€ç³»åˆ—commandæ“ä½œï¼Œç”±äºæ—¥å¿—çš„ç¡®å®šæ€§å’Œæœ‰åºæ€§ï¼Œä¿è¯æœ€åå¾—åˆ°çš„è¾“å‡ºåºåˆ—ä¹Ÿåº”è¯¥æ˜¯ç¡®å®šçš„ã€‚æ‰©å±•åˆ°åˆ†å¸ƒå¼çš„åœºæ™¯ï¼Œæ­¤æ—¶æ¯å°æœºå™¨ä¸Šæ‰€æœ‰äº†è¿™ä¹ˆä¸€ä¸ªæ—¥å¿—ï¼Œæ­¤æ—¶æˆ‘éœ€è¦åšçš„äº‹æƒ…å°±æ˜¯ä¿è¯è¿™å‡ ä»½æ—¥å¿—æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚è¯¦ç»†æ­¥éª¤å°±å¼•å‡ºäº†è®ºæ–‡ä¸­çš„é‚£å¼ ç»å…¸çš„å¤åˆ¶çŠ¶æ€æœºçš„ç¤ºæ„å›¾ å¦‚å›¾æ‰€ç¤ºï¼Œserverä¸­çš„å…±è¯†æ¨¡å—è´Ÿè´£æ¥æ”¶ç”±clientå‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œå°†è¯·æ±‚ä¸­å¯¹åº”çš„æ“ä½œè®°å½•åˆ°è‡ªå·±çš„æ—¥å¿—ä¸­ï¼ŒåŒæ—¶é€šçŸ¥ç»™å…¶ä»–æœºå™¨ï¼Œè®©ä»–ä»¬ä¹Ÿè¿›è¡ŒåŒæ ·çš„æ“ä½œæœ€ç»ˆä¿è¯æ‰€æœ‰çš„æœºå™¨éƒ½åœ¨æ—¥å¿—ä¸­å†™å…¥äº†è¿™æ¡æ“ä½œã€‚ç„¶åè¿”å›ç»™å®¢æˆ·ç«¯å†™å…¥æˆåŠŸã€‚å¤åˆ¶çŠ¶æ€æœºç”¨äºè§£å†³åˆ†å¸ƒå¼ä¸­ç³»ç»Ÿä¸­çš„å„ç§å®¹é”™é—®é¢˜ï¼Œä¾‹å¦‚masterçš„é«˜å¯ç”¨ï¼Œä¾‹å¦‚Chubbyä»¥åŠZKéƒ½æ˜¯å¤åˆ¶çŠ¶æ€æœºï¼Œ","title":"Raft ä»‹ç»"},{"content":"1. æ¦‚è¿° Sparkåº”ç”¨åœ¨yarnè¿è¡Œæ¨¡å¼ä¸‹ï¼Œå…¶ä»¥Executor Containerçš„å½¢å¼å­˜åœ¨ï¼Œcontainerèƒ½ç”³è¯·åˆ°çš„æœ€å¤§å†…å­˜å—yarn.scheduler.maximum-allocation-mbé™åˆ¶ã€‚ä¸‹é¢è¯´çš„å¤§éƒ¨åˆ†å†…å®¹å…¶å®ä¸yarnç­‰æ²¡æœ‰å¤šå°‘ç›´æ¥å…³ç³»ï¼ŒçŸ¥è¯†å‡ä¸ºé€šç”¨çš„ã€‚\nSparkåº”ç”¨è¿è¡Œè¿‡ç¨‹ä¸­çš„å†…å­˜å¯ä»¥åˆ†ä¸ºå †å†…å†…å­˜ä¸å †å¤–å†…å­˜ï¼Œå…¶ä¸­å †å†…å†…å­˜onheapç”±spark.executor.memoryæŒ‡å®šï¼Œå †å¤–å†…å­˜offheapç”±spark.yarn.executor.memoryOverheadå‚æ•°æŒ‡å®šï¼Œé»˜è®¤ä¸ºexecutorMemory*0.1,æœ€å°384Mã€‚å †å†…å†…å­˜executorMemoryæ˜¯sparkä½¿ç”¨çš„ä¸»è¦éƒ¨åˆ†ï¼Œå…¶å¤§å°é€šè¿‡-Xmxå‚æ•°ä¼ ç»™jvmï¼Œå†…éƒ¨æœ‰300Mçš„ä¿ç•™èµ„æºä¸è¢«executorä½¿ç”¨ã€‚è¿™é‡Œçš„å †å¤–å†…å­˜éƒ¨åˆ†ä¸»è¦ç”¨äºJVMè‡ªèº«ï¼Œå¦‚å­—ç¬¦ä¸²ã€NIO Bufferç­‰å¼€é”€ï¼Œæ­¤éƒ¨åˆ†ç”¨æˆ·ä»£ç åŠsparkéƒ½æ— æ³•ç›´æ¥æ“ä½œã€‚\nexecutoræ‰§è¡Œçš„æ—¶å€™ï¼Œç”¨çš„å†…å­˜å¯èƒ½ä¼šè¶…è¿‡executor-memoryï¼Œæ‰€ä»¥ä¼šä¸ºexecutoré¢å¤–é¢„ç•™ä¸€éƒ¨åˆ†å†…å­˜ï¼Œspark.yarn.executor.memoryOverheadå³ä»£è¡¨è¿™éƒ¨åˆ†å†…å­˜ã€‚\nå¦å¤–è¿˜æœ‰éƒ¨åˆ†å †å¤–å†…å­˜ç”±spark.memory.offHeap.enabledåŠspark.memory.offHeap.sizeæ§åˆ¶çš„å †å¤–å†…å­˜ï¼Œè¿™éƒ¨åˆ†ä¹Ÿå½’offheapï¼Œä½†ä¸»è¦æ˜¯ä¾›ç»Ÿä¸€å†…å­˜ç®¡ç†ä½¿ç”¨çš„ã€‚ 2. å †å†…å†…å­˜ 1 2 3 4 5 6 7 object UnifiedMemoryManager { // Set aside a fixed amount of memory for non-storage, non-execution purposes. // This serves a function similar to `spark.memory.fraction`, but guarantees that we reserve // sufficient memory for the system even for small heaps. E.g. if we have a 1GB JVM, then // the memory used for execution and storage will be (1024 - 300) * 0.6 = 434MB by default. private val RESERVED_SYSTEM_MEMORY_BYTES = 300 * 1024 * 1024 å †å†…å†…å­˜æœ‰300Mçš„ä¿ç•™èµ„æºï¼Œæ­¤å¤–çš„å¯ç”¨å†…å­˜usableMemoryè¢«åˆ†ä¸ºsparkç®¡ç†çš„å†…å­˜å’Œç”¨æˆ·ç®¡ç†çš„å†…å­˜ä¸¤éƒ¨åˆ†ï¼Œsparkç®¡ç†çš„å†…å­˜é€šè¿‡spark.memory.fractionè¿›è¡Œæ§åˆ¶ï¼Œé»˜è®¤0.6ã€‚\nSparkç®¡ç†çš„ç»Ÿä¸€å†…å­˜ï¼š åœ¨è®¾ç½®äº†executor memoryä¸º3Gæ—¶ï¼Œdebugä»£ç  å…¶å„éƒ¨åˆ†å€¼å¦‚ä¸‹ï¼š\nsystemMemory=3087007744 //containerçš„JVMæœ€å¤šå¯ç”¨çš„å†…å­˜ reservedMemory=314572800 //ä¿ç•™çš„300M minSystemMemory=471859200 //300M*1.5 executorMemory=3221225472 // é€šè¿‡spark.executor.memoryæŒ‡å®šçš„å€¼3g usableMemory=2772434944 //ä¸ºsystemMemory-reservedMemory ç”±ä¸Šï¼Œsparkå¯ç®¡ç†çš„å†…å­˜å¤§å°ä¸º 1 2 3 æ³¨æ„ï¼š usableMemory ä¸æ˜¯User Memory(æœ‰äº›ä¹Ÿå«åšother Memory) å®é™…ä¸ºspark-submit æäº¤æ—¶ç”³è¯·çš„exector-memory å¤§å° - reservedMemory usableMemory * memoryFraction=2772434944 *0.6=1,663,460,966 è¿™å—å†…å­˜åœ¨sparkä¸­è¢«ç§°ä¸ºunified region(ä»£å·M)æˆ–ç»Ÿä¸€å†…å­˜æˆ–å¯ç”¨å†…å­˜ï¼Œå…¶è¿›ä¸€æ­¥è¢«åˆ†ä¸ºæ‰§è¡Œå†…å­˜ExecutionMemoryå’ŒStorageMemoryï¼Œè§ä¸Šå›¾ã€‚å…¶ä¸­storage memory(ä»£å·R)æ˜¯Mçš„ä¸€ä¸ªsubregionï¼Œå…¶çš„å¤§å°å æ¯”å—spark.memory.storageFractionæ§åˆ¶ï¼Œé»˜è®¤ä¸º0.5ï¼Œå³é»˜è®¤å usableMemoryçš„ 0.6*0.5=0.3ã€‚æˆ‘ä»¬ç”¨onHeapStorageRegionSizeæ¥è¡¨ç¤ºstorageè¿™éƒ¨åˆ†çš„å¤§å°ã€‚\nExecutionMemoryæ‰§è¡Œå†…å­˜ï¼šä¸»è¦å­˜å‚¨Shuffleã€Joinã€Sortã€Aggregationç­‰è®¡ç®—è¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ•°æ®ï¼› StorageMemoryå­˜å‚¨å†…å­˜ï¼šä¸»è¦å­˜å‚¨sparkçš„cacheæ•°æ®ï¼Œå¦‚RDD.cache RDD.persiståœ¨è°ƒç”¨æ—¶çš„æ•°æ®å­˜å‚¨ï¼Œç”¨æˆ·è‡ªå®šä¹‰å˜é‡åŠç³»ç»Ÿçš„å¹¿æ’­å˜é‡ç­‰ è¿™ä¸¤å—å†…å­˜åœ¨å½“å‰é»˜è®¤çš„UnifiedMemoryManager(Spark1.6å¼•å…¥)ä¸‹æ˜¯å¯ä»¥äº’ç›¸åŠ¨æ€ä¾µå çš„ï¼Œå³Executionå†…å­˜ä¸è¶³æ—¶å¯ä»¥å ç”¨Storageçš„å†…å­˜ï¼Œåä¹‹äº¦ç„¶ï¼Œå…¶è¯¦ç»†è§„åˆ™å¦‚ä¸‹ï¼š\nExecutionå†…å­˜ä¸è¶³ä¸”onHeapStorageRegionSizeæœ‰ç©ºé—²æ—¶ï¼Œå¯ä»¥å‘Storage Memoryå€Ÿç”¨å†…å­˜ï¼Œ- ä½†å€Ÿç”¨åstorageä¸èƒ½å°†executionå ç”¨çš„éƒ¨åˆ†é©±é€evictå‡ºå»ï¼Œåªèƒ½ç­‰ç€Executionè‡ªå·±é‡Šæ”¾ã€‚ Storageå†…å­˜ä¸è¶³æ—¶å¯ä»¥å€Ÿç”¨Executionçš„å†…å­˜ï¼Œä¸”å½“Executionåˆæœ‰å†…å­˜èµ„æºéœ€æ±‚æ—¶å¯ä»¥é©±é€Storageå ç”¨çš„éƒ¨åˆ†ï¼Œä½†åªèƒ½é©±é€StorageMemory-onHeapStorageRegionSizeçš„å¤§å°ï¼ŒåŸæ¥åˆ’å®šçš„onHeapStorageRegionSizeä¸”åœ¨ä½¿ç”¨çš„ä¸å¯è¢«æŠ¢å ã€‚ åœ¨sparkçš„WebUIä¸‹ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°Executorsçš„ä¿¡æ¯å¦‚ä¸‹å›¾æ‰€ç¤º æˆ‘æŒ‡å®šçš„executor-memory=5g,æ­¤å¤„æ˜¾ç¤ºçš„StorageMemoryå…¶å®æ˜¯Sparkçš„å¯ç”¨å†…å­˜ï¼ŒåŒ…æ‹¬Executionå’ŒStorageéƒ¨åˆ†ã€‚(5G - 300M) * 0.6 = 2.7 ç”¨æˆ·ç®¡ç†çš„å†…å­˜(Other)ï¼š ä¸Šé¢è¯´äº†å å¯ç”¨å†…å­˜spark.memory.fraction(0.6)çš„spark ç»Ÿä¸€å†…å­˜ï¼Œå¦å¤–0.4çš„ç”¨æˆ·å†…å­˜ç”¨äºå­˜å‚¨ç”¨æˆ·ä»£ç ç”Ÿæˆçš„å¯¹è±¡åŠRDDä¾èµ–ç­‰,ç”¨æˆ·åœ¨å¤„ç†partitionä¸­çš„è®°å½•æ—¶ï¼Œå…¶éå†åˆ°çš„è®°å½•å¯ä»¥çœ‹åšå­˜å‚¨åœ¨OtheråŒºï¼Œå½“éœ€è¦å°†RDDç¼“å­˜æ—¶ï¼Œå°†ä¼šåºåˆ—åŒ–æˆ–ä¸åºåˆ—åŒ–çš„æ–¹å¼ä»¥Blockçš„å½¢å¼å­˜å‚¨åˆ°Storageå†…å­˜ä¸­ã€‚ 3. å †å¤–å†…å­˜ å‰é¢è¯´äº†ï¼Œå †å¤–å†…å­˜æœ‰çš„æ˜¯å‚æ•°spark.yarn.executor.memoryOverheadæ§åˆ¶ï¼Œæœ‰çš„æ˜¯å‚æ•°spark.memory.offHeap.sizeæ§åˆ¶ï¼Œè¿™ä¸ªéƒ½ç®—offheapå†…å­˜ï¼Œä¸è¿‡å‰è€…ä¸»è¦ç”¨äºJVMè¿è¡Œè‡ªèº«ï¼Œå­—ç¬¦ä¸², NIO Bufferç­‰å¼€é”€ï¼Œè€Œåè€…ä¸»è¦æ˜¯ä¾›ç»Ÿä¸€å†…å­˜ç®¡ç†ç”¨ä½œExecution MemoryåŠStorage Memoryçš„ç”¨é€”ã€‚\nspark.yarn.executor.memoryOverheadè®¾ç½®çš„å†…å­˜é»˜è®¤ä¸ºexecutor.memoryçš„0.1å€ï¼Œæœ€ä½384Mï¼Œè¿™ä¸ªå§‹ç»ˆå­˜åœ¨çš„ï¼Œåœ¨é‡‡ç”¨yarnæ—¶ï¼Œè¿™å—å†…å­˜æ˜¯åŒ…å«åœ¨ç”³è¯·çš„å®¹å™¨å†…çš„ï¼Œå³ç”³è¯·å®¹å™¨å¤§å°å¤§äºspark.executor.memory+spark.yarn.executor.memoryOverheadã€‚\nè€Œé€šè¿‡spark.memory.offHeap.enable/sizeç”³è¯·çš„å†…å­˜ä¸åœ¨JVMå†…ï¼ŒSparkåˆ©ç”¨TungStenæŠ€æœ¯ç›´æ¥æ“ä½œç®¡ç†JVMå¤–çš„åŸç”Ÿå†…å­˜ã€‚ä¸»è¦æ˜¯ä¸ºäº†è§£å†³Javaå¯¹è±¡å¼€é”€å¤§å’ŒGCçš„é—®é¢˜ã€‚ 1 2 3 4 5 6 protected[this] val maxOffHeapMemory = conf.get(MEMORY_OFFHEAP_SIZE) protected[this] val offHeapStorageMemory = (maxOffHeapMemory * conf.getDouble(\u0026#34;spark.memory.storageFraction\u0026#34;, 0.5)).toLong offHeapExecutionMemoryPool.incrementPoolSize(maxOffHeapMemory - offHeapStorageMemory) offHeapStorageMemoryPool.incrementPoolSize(offHeapStorageMemory) å…¶ä¸­MEMORY_OFFHEAP_SIZEä¸ºspark.memory.offHeap.sizeï¼Œè¿™éƒ¨åˆ†offHeapå†…å­˜è¢«spark.memory.storageFractionåˆ†ä¸ºstorageä¸executionç”¨é€”ä¾›ç»Ÿä¸€å†…å­˜ç®¡ç†ä½¿ç”¨ã€‚\nç»Ÿä¸€å†…å­˜ç®¡ç†UnifiedMemoryManagerä¼šç®¡ç†å †å†…å †å¤–çš„executionå’Œstorageå†…å­˜ï¼Œå®šä¹‰äº†å››ä¸ªå†…å­˜æ± åˆ†åˆ«ä¸ºï¼šonHeapStorageMemoryPool, offHeapStorageMemoryPool, onHeapExecutionMemoryPool, offHeapExecutionMemoryPoolï¼Œåœ¨sparkå†…éƒ¨ç”³è¯·å†…å­˜æ—¶ä¼šæŒ‡å®šMemoryModeä¸ºON_HEAPæˆ–OFF_HEAPå†³å®šä»å“ªéƒ¨åˆ†ç”³è¯·å†…å­˜ã€‚\næˆ‘ä»¬åœ¨WebUIçœ‹åˆ°çš„executorsä¿¡æ¯ä¸­Storageæ˜¯åŒ…æ‹¬äº†ç»Ÿä¸€å†…å­˜ç®¡ç†æ§åˆ¶çš„å †å†…å †å¤–åŒºåŸŸçš„ã€‚\nä¸‹é¢çš„5.9Gä¸­åŒ…æ‹¬äº†2.7Gçš„å †å†…å’Œ3.2G(3gæŒ‰1000ç®—ä¸º3.221G,é1024ç®—) å¯¹å¤§çš„å‡ ä¸ªRDDè¿›è¡Œcacheå¹¶actionåï¼Œç«‹é©¬çœ‹ä¼šçœ‹åˆ°å­˜å‚¨å ç”¨äº†å †å†…2.7Gçš„å¤§éƒ¨åˆ†ï¼Œå³æŠŠexecutionçš„æŠ¢å äº†ï¼Œä»ç„¶ä¸å¤Ÿæ—¶å·²ç»æœ‰äº›åºåˆ—åŒ–åˆ°ç£ç›˜ä¸­äº†ã€‚ç¨ç­‰ä¸€ä¼šexecutionä¼šå°†storageæŠ¢å çš„è¿™éƒ¨åˆ†é©±é€å¹¶åºåˆ—åŒ–åˆ°diskä¸­ï¼Œå¦‚ä¸Šå°†ä¼šå˜æˆä¸‹é¢çš„çŠ¶å†µ æŒ‰å‰é¢æ‰€è¯´ï¼Œè¿™ç§å‡æ˜¯åœ¨å †å†…å†…å­˜å­˜å‚¨çš„ï¼Œæˆ‘ä»¬æŸ¥çœ‹è¢«ç¼“å­˜çš„RDDçš„ä¿¡æ¯ä¹Ÿå¯çœ‹åˆ°ã€‚ åºåˆ—åŒ–å­˜å‚¨çº§åˆ«æ€ä¹ˆå­˜åˆ°å †å¤–ï¼Ÿå°¤å…¶æ˜¯é‚£äº›ä¸å¸Œæœ›è¢«GCçš„é•¿æœŸå­˜åœ¨çš„RDDï¼Œä¾‹å¦‚å¸¸é©»å†…å­˜çš„åå•åº“ç­‰ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨persistæ—¶è®¾ç½®levelä¸ºStorageLevel.OFF_HEAPï¼Œæ­¤ç§æƒ…å†µä¸‹åªèƒ½ç”¨å†…å­˜ï¼Œä¸èƒ½åŒæ—¶å­˜å‚¨åˆ°å…¶ä»–åœ°æ–¹ã€‚ æ³¨æ„: é»˜è®¤æƒ…å†µä¸‹Off-heapæ¨¡å¼çš„å†…å­˜å¹¶ä¸å¯ç”¨ï¼Œå¯ä»¥é€šè¿‡â€œspark.memory.offHeap.enabledâ€å‚æ•°å¼€å¯ï¼Œå¹¶ç”±spark.memory.offHeap.sizeæŒ‡å®šå †å¤–å†…å­˜çš„å¤§å°ï¼ˆå ç”¨çš„ç©ºé—´åˆ’å½’JVM OffHeapå†…å­˜ï¼‰ã€‚\n4. ä»»åŠ¡å†…å­˜ç®¡ç†ï¼ˆTask Memory Managerï¼‰ Executorä¸­ä»»åŠ¡ä»¥çº¿ç¨‹çš„æ–¹å¼æ‰§è¡Œï¼Œå„çº¿ç¨‹å…±äº«JVMçš„èµ„æºï¼Œä»»åŠ¡ä¹‹é—´çš„å†…å­˜èµ„æºæ²¡æœ‰å¼ºéš”ç¦»ï¼ˆä»»åŠ¡æ²¡æœ‰ä¸“ç”¨çš„HeapåŒºåŸŸï¼‰ã€‚å› æ­¤ï¼Œå¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼šå…ˆåˆ°è¾¾çš„ä»»åŠ¡å¯èƒ½å ç”¨è¾ƒå¤§çš„å†…å­˜ï¼Œè€Œååˆ°çš„ä»»åŠ¡å› å¾—ä¸åˆ°è¶³å¤Ÿçš„å†…å­˜è€ŒæŒ‚èµ·ã€‚\nåœ¨Sparkä»»åŠ¡å†…å­˜ç®¡ç†ä¸­ï¼Œä½¿ç”¨HashMapå­˜å‚¨ä»»åŠ¡ä¸å…¶æ¶ˆè€—å†…å­˜çš„æ˜ å°„å…³ç³»ã€‚æ¯ä¸ªä»»åŠ¡å¯å ç”¨çš„å†…å­˜å¤§å°ä¸ºæ½œåœ¨å¯ä½¿ç”¨è®¡ç®—å†…å­˜çš„[1/2n, 1/n], å½“å‰©ä½™å†…å­˜ä¸ºå°äº1/2næ—¶ï¼Œä»»åŠ¡å°†è¢«æŒ‚èµ·ï¼Œç›´è‡³æœ‰å…¶ä»–ä»»åŠ¡é‡Šæ”¾æ‰§è¡Œå†…å­˜ï¼Œè€Œæ»¡è¶³å†…å­˜ä¸‹é™1/2nï¼Œä»»åŠ¡è¢«å”¤é†’ï¼Œå…¶ä¸­nä¸ºå½“å‰Executorä¸­æ´»è·ƒçš„ä»»åŠ¡æ•°ã€‚\nä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœéœ€è¦æ›´å¤šçš„å†…å­˜ï¼Œåˆ™ä¼šè¿›è¡Œç”³è¯·ï¼Œå¦‚æœï¼Œå­˜åœ¨ç©ºé—²å†…å­˜ï¼Œåˆ™è‡ªåŠ¨æ‰©å®¹æˆåŠŸï¼Œå¦åˆ™ï¼Œå°†æŠ›å‡ºOutOffMemroyErrorã€‚\n5. ç›¸å…³è°ƒä¼˜ ä»€ä¹ˆæ—¶å€™éœ€è¦è°ƒèŠ‚Executorçš„å †å¤–å†…å­˜å¤§å°ï¼Ÿ å½“å‡ºç°ä¸€ä¸‹å¼‚å¸¸æ—¶ï¼šshuffle file cannot findï¼Œexecutor lostã€task lostï¼Œout of memory\nå‡ºç°è¿™ç§é—®é¢˜çš„ç°è±¡å¤§è‡´æœ‰è¿™ä¹ˆä¸¤ç§æƒ…å†µï¼š\nExecutoræŒ‚æ‰äº†ï¼Œå¯¹åº”çš„Executorä¸Šé¢çš„block managerä¹ŸæŒ‚æ‰äº†ï¼Œæ‰¾ä¸åˆ°å¯¹åº”çš„shuffle map outputæ–‡ä»¶ï¼ŒReducerç«¯ä¸èƒ½å¤Ÿæ‹‰å–æ•°æ® Executorå¹¶æ²¡æœ‰æŒ‚æ‰ï¼Œè€Œæ˜¯åœ¨æ‹‰å–æ•°æ®çš„è¿‡ç¨‹å‡ºç°äº†é—®é¢˜ã€‚ ä¸Šè¿°æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥å»è€ƒè™‘è°ƒèŠ‚ä¸€ä¸‹executorçš„å †å¤–å†…å­˜ã€‚ä¹Ÿè®¸å°±å¯ä»¥é¿å…æŠ¥é”™ï¼›æ­¤å¤–ï¼Œæœ‰æ—¶ï¼Œå †å¤–å†…å­˜è°ƒèŠ‚çš„æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œå¯¹äºæ€§èƒ½æ¥è¯´ï¼Œä¹Ÿä¼šå¸¦æ¥ä¸€å®šçš„æå‡ã€‚è¿™ä¸ªexecutorè·‘ç€è·‘ç€ï¼Œçªç„¶å†…å­˜ä¸è¶³äº†ï¼Œå †å¤–å†…å­˜ä¸è¶³äº†ï¼Œå¯èƒ½ä¼šOOMï¼ŒæŒ‚æ‰ã€‚block managerä¹Ÿæ²¡æœ‰äº†ï¼Œæ•°æ®ä¹Ÿä¸¢å¤±æ‰äº†ã€‚\nå¦‚æœæ­¤æ—¶ï¼Œstage0çš„executoræŒ‚äº†ï¼ŒBlockManagerä¹Ÿæ²¡æœ‰äº†ï¼›æ­¤æ—¶ï¼Œstage1çš„executorçš„taskï¼Œè™½ç„¶é€šè¿‡ Driverçš„MapOutputTrakcerè·å–åˆ°äº†è‡ªå·±æ•°æ®çš„åœ°å€ï¼›ä½†æ˜¯å®é™…ä¸Šå»æ‰¾å¯¹æ–¹çš„BlockManagerè·å–æ•°æ®çš„ æ—¶å€™ï¼Œæ˜¯è·å–ä¸åˆ°çš„ã€‚\næ­¤æ—¶ï¼Œå°±ä¼šåœ¨spark-submitè¿è¡Œä½œä¸šï¼ˆjarï¼‰ï¼Œclientï¼ˆstandalone clientã€yarn clientï¼‰ï¼Œåœ¨æœ¬æœºå°±ä¼šæ‰“å°å‡ºlog:shuffle output file not foundã€‚ã€‚ã€‚DAGSchedulerï¼Œresubmitting taskï¼Œä¸€ç›´ä¼šæŒ‚æ‰ã€‚åå¤æŒ‚æ‰å‡ æ¬¡ï¼Œåå¤æŠ¥é”™å‡ æ¬¡,æ•´ä¸ªsparkä½œä¸šå°±å´©æºƒäº†\n1 2 3 4 5 --conf spark.yarn.executor.memoryOverhead=2048 spark-submitè„šæœ¬é‡Œé¢ï¼Œå»ç”¨--confçš„æ–¹å¼ï¼Œå»æ·»åŠ é…ç½®ï¼›ä¸€å®šè¦æ³¨æ„ï¼ï¼ï¼åˆ‡è®°ï¼Œ ä¸æ˜¯åœ¨ä½ çš„sparkä½œä¸šä»£ç ä¸­ï¼Œç”¨new SparkConf().set()è¿™ç§æ–¹å¼å»è®¾ç½®ï¼Œä¸è¦è¿™æ ·å»è®¾ç½®ï¼Œæ˜¯æ²¡æœ‰ç”¨çš„ï¼ ä¸€å®šè¦åœ¨spark-submitè„šæœ¬ä¸­å»è®¾ç½®ã€‚ è°ƒèŠ‚ç­‰å¾…æ—¶é•¿ executorï¼Œä¼˜å…ˆä»è‡ªå·±æœ¬åœ°å…³è”çš„BlockManagerä¸­è·å–æŸä»½æ•°æ®\nå¦‚æœæœ¬åœ°BlockManageræ²¡æœ‰çš„è¯ï¼Œé‚£ä¹ˆä¼šé€šè¿‡TransferServiceï¼Œå»è¿œç¨‹è¿æ¥å…¶ä»–èŠ‚ç‚¹ä¸Šexecutor çš„BlockManagerå»è·å–,å°è¯•å»ºç«‹è¿œç¨‹çš„ç½‘ç»œè¿æ¥ï¼Œå¹¶ä¸”å»æ‹‰å–æ•°æ®ï¼Œtaskåˆ›å»ºçš„å¯¹è±¡ç‰¹åˆ«å¤§ï¼Œç‰¹åˆ«å¤šé¢‘ç¹çš„è®©JVMå †å†…å­˜æ»¡æº¢ï¼Œè¿›è¡Œåƒåœ¾å›æ”¶ã€‚æ­£å¥½ç¢°åˆ°é‚£ä¸ªexeuctorçš„JVMåœ¨åƒåœ¾å›æ”¶ã€‚\nå¤„äºåƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹å…¨éƒ¨åœæ­¢ï¼›ç›¸å½“äºåªè¦ä¸€æ—¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œspark / executoråœæ­¢å·¥ä½œï¼Œæ— æ³•æä¾›å“åº”ï¼Œæ­¤æ—¶å‘¢ï¼Œå°±ä¼šæ²¡æœ‰å“åº”ï¼Œæ— æ³•å»ºç«‹ç½‘ç»œè¿æ¥ï¼Œä¼šå¡ä½ï¼›okï¼Œsparké»˜è®¤çš„ç½‘ç»œè¿æ¥çš„è¶…æ—¶æ—¶é•¿ï¼Œæ˜¯60sï¼Œå¦‚æœå¡ä½60séƒ½æ— æ³•å»ºç«‹è¿æ¥çš„è¯ï¼Œé‚£ä¹ˆå°±å®£å‘Šå¤±è´¥äº†ã€‚ç¢°åˆ°ä¸€ç§æƒ…å†µï¼Œå¶å°”ï¼Œå¶å°”ï¼Œå¶å°”ï¼ï¼ï¼æ²¡æœ‰è§„å¾‹ï¼ï¼ï¼æŸæŸfileã€‚ä¸€ä¸²file idã€‚uuidï¼ˆdsfsfd-2342vs\u0026ndash;sdf\u0026ndash;sdfsdï¼‰ã€‚not foundã€‚file lostã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯æœ‰é‚£ä»½æ•°æ®çš„executoråœ¨jvm gcã€‚æ‰€ä»¥æ‹‰å–æ•°æ®çš„æ—¶å€™ï¼Œå»ºç«‹ä¸äº†è¿æ¥ã€‚ç„¶åè¶…è¿‡é»˜è®¤60sä»¥åï¼Œç›´æ¥å®£å‘Šå¤±è´¥ã€‚æŠ¥é”™å‡ æ¬¡ï¼Œå‡ æ¬¡éƒ½æ‹‰å–ä¸åˆ°æ•°æ®çš„è¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´sparkä½œä¸šçš„å´©æºƒã€‚ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´DAGSchedulerï¼Œåå¤æäº¤å‡ æ¬¡stageã€‚TaskSchedulerï¼Œåå¤æäº¤å‡ æ¬¡taskã€‚å¤§å¤§å»¶é•¿æˆ‘ä»¬çš„sparkä½œä¸šçš„è¿è¡Œæ—¶é—´ã€‚\nå¯ä»¥è€ƒè™‘è°ƒèŠ‚è¿æ¥çš„è¶…æ—¶æ—¶é•¿ã€‚\n1 2 --conf spark.core.connection.ack.wait.timeout=300 spark-submitè„šæœ¬ï¼Œåˆ‡è®°ï¼Œä¸æ˜¯åœ¨new SparkConf().set()è¿™ç§æ–¹å¼æ¥è®¾ç½®çš„ã€‚spark.core.connection.ack.wait.timeoutï¼ˆspark coreï¼Œconnectionï¼Œè¿æ¥ï¼Œackï¼Œwait timeoutï¼Œå»ºç«‹ä¸ä¸Šè¿æ¥çš„æ—¶å€™ï¼Œè¶…æ—¶ç­‰å¾…æ—¶é•¿ï¼‰è°ƒèŠ‚è¿™ä¸ªå€¼æ¯”è¾ƒå¤§ä»¥åï¼Œé€šå¸¸æ¥è¯´ï¼Œå¯ä»¥é¿å…éƒ¨åˆ†çš„å¶å°”å‡ºç°çš„æŸæŸæ–‡ä»¶æ‹‰å–å¤±è´¥ï¼ŒæŸæŸæ–‡ä»¶lostæ‰äº†ã€‚ã€‚ã€‚ executor-memory è®¾ç½®å»ºè®® å¦‚æœè®¾ç½®å°äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼š\né¢‘ç¹GCï¼ŒGCè¶…é™ï¼ŒCPUå¤§éƒ¨åˆ†æ—¶é—´ç”¨æ¥åšGCè€Œå›é¦–çš„å†…å­˜åˆå¾ˆå°‘ï¼Œä¹Ÿå°±æ˜¯executorå †å†…å­˜ä¸è¶³ã€‚(é€šå¸¸gc æ—¶é—´å»ºè®®ä¸è¶…è¿‡task æ—¶é—´çš„5%) å¦‚æœå‘ç”ŸOOMæˆ–è€…GCè€—æ—¶è¿‡é•¿ï¼Œè€ƒè™‘æé«˜executor-memoryæˆ–é™ä½executor-core\n2. java.lang.OutOfMemoryErrorå†…å­˜æº¢å‡ºï¼Œè¿™å’Œç¨‹åºå®ç°å¼ºç›¸å…³ï¼Œä¾‹å¦‚å†…å­˜æ’åºç­‰ï¼Œé€šå¸¸æ˜¯è¦æ”¾å…¥å†…å­˜çš„æ•°æ®é‡å¤ªå¤§ï¼Œå†…å­˜ç©ºé—´ä¸å¤Ÿå¼•èµ·çš„ã€‚ 3. æ•°æ®é¢‘ç¹spillåˆ°ç£ç›˜ï¼Œå¦‚æœæ˜¯I/Oå¯†é›†å‹çš„åº”ç”¨ï¼Œå“åº”æ—¶é—´å°±ä¼šæ˜¾è‘—å»¶é•¿ã€‚\nå…·ä½“æ€ä¹ˆæ ·ç®—è°ƒæ•´åˆ°ä½å‘¢ï¼Ÿ TimeLineæ˜¾ç¤ºçŠ¶æ€åˆç†ï¼ˆé€šé€šç»¿æ¡ï¼‰ï¼ŒGCæ—¶é•¿åˆç†ï¼ˆå æ¯”å¾ˆå°ï¼‰ï¼Œç³»ç»Ÿèƒ½å¤Ÿç¨³å®šè¿è¡Œã€‚ å½“ç„¶å†…å­˜ç»™å¤ªå¤§äº†ä¹Ÿæ˜¯æµªè´¹èµ„æºï¼Œåˆç†çš„ä¸´ç•Œå€¼æ˜¯åœ¨å†…å­˜ç»™åˆ°ä¸€å®šç¨‹åº¦ï¼Œå¯¹è¿è¡Œæ•ˆç‡å·²ç»æ²¡æœ‰å¸®åŠ©äº†çš„æ—¶å€™ï¼Œå°±å¯ä»¥äº†ã€‚\nå¢åŠ executorå†…å­˜é‡ä»¥åï¼Œæ€§èƒ½çš„æå‡ï¼š å¦‚æœéœ€è¦å¯¹RDDè¿›è¡Œcacheï¼Œé‚£ä¹ˆæ›´å¤šçš„å†…å­˜ï¼Œå°±å¯ä»¥ç¼“å­˜æ›´å¤šçš„æ•°æ®ï¼Œå°†æ›´å°‘çš„æ•°æ®å†™å…¥ç£ç›˜ï¼Œç”šè‡³ä¸å†™å…¥ç£ç›˜ã€‚å‡å°‘äº†ç£ç›˜IOã€‚ å¯¹äºshuffleæ“ä½œï¼Œreduceç«¯ï¼Œä¼šéœ€è¦å†…å­˜æ¥å­˜æ”¾æ‹‰å–çš„æ•°æ®å¹¶è¿›è¡Œèšåˆã€‚å¦‚æœå†…å­˜ä¸å¤Ÿï¼Œä¹Ÿä¼šå†™å…¥ç£ç›˜ã€‚å¦‚æœç»™executoråˆ†é…æ›´å¤šå†…å­˜ä»¥åï¼Œå°±æœ‰æ›´å°‘çš„æ•°æ®ï¼Œéœ€è¦å†™å…¥ç£ç›˜ï¼Œç”šè‡³ä¸éœ€è¦å†™å…¥ç£ç›˜ã€‚å‡å°‘äº†ç£ç›˜IOï¼Œæå‡äº†æ€§èƒ½ã€‚ å¯¹äºtaskçš„æ‰§è¡Œï¼Œå¯èƒ½ä¼šåˆ›å»ºå¾ˆå¤šå¯¹è±¡ã€‚å¦‚æœå†…å­˜æ¯”è¾ƒå°ï¼Œå¯èƒ½ä¼šé¢‘ç¹å¯¼è‡´JVMå †å†…å­˜æ»¡äº†ï¼Œç„¶åé¢‘ç¹GCï¼Œåƒåœ¾å›æ”¶ï¼Œminor GCå’Œfull GCã€‚ï¼ˆé€Ÿåº¦å¾ˆæ…¢ï¼‰ã€‚å†…å­˜åŠ å¤§ä»¥åï¼Œå¸¦æ¥æ›´å°‘çš„GCï¼Œåƒåœ¾å›æ”¶ï¼Œé¿å…äº†é€Ÿåº¦å˜æ…¢ï¼Œæ€§èƒ½æå‡ã€‚ åœ¨ç»™å®šæ‰§è¡Œå†…å­˜ Mã€çº¿ç¨‹æ± å¤§å° N å’Œæ•°æ®æ€»é‡ D çš„æ—¶å€™ï¼Œæƒ³è¦æœ‰æ•ˆåœ°æå‡ CPU åˆ©ç”¨ç‡ï¼Œæˆ‘ä»¬å°±è¦è®¡ç®—å‡ºæœ€ä½³å¹¶è¡Œåº¦ Pï¼Œè®¡ç®—æ–¹æ³•æ˜¯è®©æ•°æ®åˆ†ç‰‡çš„å¹³å‡å¤§å° D/P åè½åœ¨ï¼ˆM/N*2, M/Nï¼‰åŒºé—´ï¼Œè®©æ¯ä¸ªTaskèƒ½å¤Ÿæ‹¿åˆ°å¹¶å¤„ç†é€‚é‡çš„æ•°æ®ã€‚æ€ä¹ˆç†è§£é€‚é‡å‘¢ï¼ŸD/Pæ˜¯åŸå§‹æ•°æ®çš„å°ºå¯¸ï¼ŒçœŸæ­£åˆ°å†…å­˜é‡Œå»ï¼Œæ˜¯ä¼šç¿»å€çš„ï¼Œè‡³äºç¿»å¤šå°‘å€ï¼Œè¿™ä¸ªå’Œæ–‡ä»¶æ ¼å¼æœ‰å…³ç³»ã€‚ä¸è¿‡ï¼Œä¸ç®¡ä»–ç¿»å¤šå°‘å€ï¼Œåªè¦åŸå§‹çš„D/På’ŒM/Nåœ¨ä¸€ä¸ªå½“é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¤§æ¦‚ç‡å°±èƒ½é¿å¼€OOMçš„é—®é¢˜ï¼Œä¸è‡³äºæŸäº›Taskséœ€è¦å¤„ç†çš„æ•°æ®åˆ†ç‰‡è¿‡å¤§è€ŒOOMã€‚Shuffleè¿‡åæ¯ä¸ªReduce Taskä¹Ÿä¼šäº§ç”Ÿæ•°æ®åˆ†ç‰‡ï¼Œspark.sql.shuffle.partitions æ§åˆ¶Joinsä¹‹ä¸­çš„Shuffle Reduceé˜¶æ®µå¹¶è¡Œåº¦ï¼Œspark.sql.shuffle.partitions = ä¼°ç®—ç»“æœæ–‡ä»¶å¤§å° / [128M,256M]ï¼Œç¡®ä¿shuffle åçš„æ•°æ®åˆ†ç‰‡å¤§å°åœ¨[128M,256M]åŒºé—´ã€‚PSï¼š æ ¸å¿ƒæ€è·¯æ˜¯ï¼Œæ ¹æ®â€œå®šä¸‹æ¥çš„â€ï¼Œå»è°ƒæ•´â€œæœªå®šä¸‹æ¥çš„â€ï¼Œå°±å¯ä»¥å»è®¾ç½®æ¯ä¸€ä¸ªå‚æ•°äº†ã€‚\nå‡å®šSparkè¯»å–åˆ†å¸ƒå¼æ–‡ä»¶ï¼Œæ€»å¤§å°512Mï¼ŒHDFSçš„åˆ†ç‰‡æ˜¯128Mï¼Œé‚£ä¹ˆå¹¶è¡Œåº¦ = 512M / 128M = 4 Executor å¹¶å‘åº¦=1ï¼Œé‚£ä¹ˆExecutor å†…å­˜ M åº”åœ¨ 128M åˆ° 256M ä¹‹é—´ã€‚ Executor å¹¶å‘åº¦=2ï¼Œé‚£ä¹ˆExecutor å†…å­˜ M åº”åœ¨ 256M åˆ° 512M ä¹‹é—´ã€‚\n","permalink":"https://reid00.github.io/en/posts/computation/spark%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4%E7%AE%A1%E7%90%86/","summary":"1. æ¦‚è¿° Sparkåº”ç”¨åœ¨yarnè¿è¡Œæ¨¡å¼ä¸‹ï¼Œå…¶ä»¥Executor Containerçš„å½¢å¼å­˜åœ¨ï¼Œcontainerèƒ½ç”³è¯·åˆ°çš„æœ€å¤§å†…å­˜å—yarn.scheduler.maximum-allocation-mbé™åˆ¶ã€‚ä¸‹é¢è¯´çš„å¤§éƒ¨åˆ†å†…å®¹å…¶å®ä¸yarnç­‰æ²¡æœ‰å¤šå°‘ç›´æ¥å…³ç³»ï¼ŒçŸ¥è¯†å‡ä¸ºé€šç”¨çš„ã€‚\nSparkåº”ç”¨è¿è¡Œè¿‡ç¨‹ä¸­çš„å†…å­˜å¯ä»¥åˆ†ä¸ºå †å†…å†…å­˜ä¸å †å¤–å†…å­˜ï¼Œå…¶ä¸­å †å†…å†…å­˜onheapç”±spark.executor.memoryæŒ‡å®šï¼Œå †å¤–å†…å­˜offheapç”±spark.yarn.executor.memoryOverheadå‚æ•°æŒ‡å®šï¼Œé»˜è®¤ä¸ºexecutorMemory*0.1,æœ€å°384Mã€‚å †å†…å†…å­˜executorMemoryæ˜¯sparkä½¿ç”¨çš„ä¸»è¦éƒ¨åˆ†ï¼Œå…¶å¤§å°é€šè¿‡-Xmxå‚æ•°ä¼ ç»™jvmï¼Œå†…éƒ¨æœ‰300Mçš„ä¿ç•™èµ„æºä¸è¢«executorä½¿ç”¨ã€‚è¿™é‡Œçš„å †å¤–å†…å­˜éƒ¨åˆ†ä¸»è¦ç”¨äºJVMè‡ªèº«ï¼Œå¦‚å­—ç¬¦ä¸²ã€NIO Bufferç­‰å¼€é”€ï¼Œæ­¤éƒ¨åˆ†ç”¨æˆ·ä»£ç åŠsparkéƒ½æ— æ³•ç›´æ¥æ“ä½œã€‚\nexecutoræ‰§è¡Œçš„æ—¶å€™ï¼Œç”¨çš„å†…å­˜å¯èƒ½ä¼šè¶…è¿‡executor-memoryï¼Œæ‰€ä»¥ä¼šä¸ºexecutoré¢å¤–é¢„ç•™ä¸€éƒ¨åˆ†å†…å­˜ï¼Œspark.yarn.executor.memoryOverheadå³ä»£è¡¨è¿™éƒ¨åˆ†å†…å­˜ã€‚\nå¦å¤–è¿˜æœ‰éƒ¨åˆ†å †å¤–å†…å­˜ç”±spark.memory.offHeap.enabledåŠspark.memory.offHeap.sizeæ§åˆ¶çš„å †å¤–å†…å­˜ï¼Œè¿™éƒ¨åˆ†ä¹Ÿå½’offheapï¼Œä½†ä¸»è¦æ˜¯ä¾›ç»Ÿä¸€å†…å­˜ç®¡ç†ä½¿ç”¨çš„ã€‚ 2. å †å†…å†…å­˜ 1 2 3 4 5 6 7 object UnifiedMemoryManager { // Set aside a fixed amount of memory for non-storage, non-execution purposes. // This serves a function similar to `spark.memory.fraction`, but guarantees that we reserve // sufficient memory for the system even for small heaps. E.g. if we have a 1GB JVM, then // the memory used for execution and storage will be (1024 - 300) * 0.","title":"Sparkå†…å­˜ç©ºé—´ç®¡ç†"},{"content":"è¯è¯´ï¼ŒUDPæ¯”TCPå¿«å—ï¼Ÿ\nç›¸ä¿¡å°±ç®—ä¸æ˜¯å…«è‚¡æ–‡è€æ‰‹ï¼Œä¹Ÿä¼šä¸‹æ„è¯†çš„è„±å£è€Œå‡ºï¼š\u0026ldquo;æ˜¯\u0026rdquo;ã€‚\nè¿™è¦è¿½é—®ä¸ºä»€ä¹ˆï¼Œä¼°è®¡å¤§å®¶ä¹Ÿèƒ½è¯´å‡ºä¸ªå¤§æ¦‚ã€‚\nä½†è¿™ä¹Ÿè®©äººå¥½å¥‡ï¼Œç”¨UDPå°±ä¸€å®šæ¯”ç”¨TCPå¿«å—ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ç”¨UDPä¼šæ¯”ç”¨TCPæ…¢ï¼Ÿ\næˆ‘ä»¬ä»Šå¤©å°±æ¥èŠä¸‹è¿™ä¸ªè¯é¢˜ã€‚\nä½¿ç”¨socketè¿›è¡Œæ•°æ®ä¼ è¾“ ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦åœ¨Aç”µè„‘çš„è¿›ç¨‹å‘ä¸€æ®µæ•°æ®åˆ°Bç”µè„‘çš„è¿›ç¨‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨ä»£ç é‡Œä½¿ç”¨socketè¿›è¡Œç¼–ç¨‹ã€‚\nsocketå°±åƒæ˜¯ä¸€ä¸ªç”µè¯æˆ–è€…é‚®ç®±ï¼ˆé‚®æ”¿çš„ä¿¡ç®±ï¼‰ã€‚å½“ä½ æƒ³è¦å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œæ‹¨é€šç”µè¯æˆ–è€…å°†ä¿¡æ¯å¡åˆ°é‚®ç®±é‡Œï¼Œsocketå†…æ ¸ä¼šè‡ªåŠ¨å®Œæˆå°†æ•°æ®ä¼ ç»™å¯¹æ–¹çš„è¿™ä¸ªè¿‡ç¨‹ã€‚\nåŸºäºsocketæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨TCPæˆ–UDPåè®®è¿›è¡Œé€šä¿¡ã€‚\nå¯¹äºTCPè¿™æ ·çš„å¯é æ€§åè®®ï¼Œæ¯æ¬¡æ¶ˆæ¯å‘å‡ºåéƒ½èƒ½æ˜ç¡®çŸ¥é“å¯¹æ–¹æ”¶æ²¡æ”¶åˆ°ï¼Œå°±åƒæ‰“ç”µè¯ä¸€æ ·ï¼Œåªè¦\u0026quot;å–‚å–‚\u0026quot;ä¸¤ä¸‹å°±èƒ½çŸ¥é“å¯¹æ–¹æœ‰æ²¡æœ‰åœ¨å¬ã€‚\nè€ŒUDPå°±åƒæ˜¯ç»™é‚®æ”¿çš„ä¿¡ç®±å¯„ä¿¡ä¸€æ ·ï¼Œä½ å¯„å‡ºå»çš„ä¿¡ï¼Œæ ¹æœ¬å°±ä¸çŸ¥é“å¯¹æ–¹æœ‰æ²¡æœ‰æ­£å¸¸æ”¶åˆ°ï¼Œä¸¢äº†ä¹Ÿæ˜¯æœ‰å¯èƒ½çš„ã€‚\nè¿™è®©æˆ‘æƒ³èµ·äº†å¤§æ¦‚17å¹´å‰ï¼Œå½“æ—¶è¿˜æ²¡æœ‰ç°åœ¨è¿™ä¹ˆå‘è¾¾çš„ç½‘è´­ï¼Œæƒ³ä¹°ä¸€æœ¬ã€ŠæŒæœºè¿·ã€‹æ‚å¿—ï¼Œè¿˜å¾—å¾€ä¿¡å°é‡Œå¡é’±ï¼Œç„¶åä¸€ç­‰å°±æ˜¯ä¸€ä¸ªæœˆï¼Œå¥½å‡ æ¬¡éƒ½æ€€ç–‘ä¿¡æ˜¯ä¸æ˜¯ä¸¢äº†ã€‚æˆ‘è‡³ä»Šå°è±¡æ·±åˆ»ï¼Œå› ä¸ºé‚£æ˜¯æˆ‘å’Œæˆ‘å“¥æ”’äº†å¥½ä¹…çš„é’±ã€‚ã€‚ã€‚\nå›åˆ°socketç¼–ç¨‹çš„è¯é¢˜ä¸Šã€‚\nåˆ›å»ºsocketçš„æ–¹å¼å°±åƒä¸‹é¢è¿™æ ·ã€‚\n1 fd = socket(AF_INET, å…·ä½“åè®®,0); æ³¨æ„ä¸Šé¢çš„\u0026quot;å…·ä½“åè®®\u0026quot;ï¼Œå¦‚æœä¼ å…¥çš„æ˜¯SOCK_STREAMï¼Œæ˜¯æŒ‡ä½¿ç”¨å­—èŠ‚æµä¼ è¾“æ•°æ®ï¼Œè¯´ç™½äº†å°±æ˜¯TCPåè®®ã€‚ TCP: é¢å‘è¿æ¥çš„ å¯é çš„ åŸºäºå­—èŠ‚æµ å¦‚æœä¼ å…¥çš„æ˜¯SOCK_DGRAMï¼Œæ˜¯æŒ‡ä½¿ç”¨æ•°æ®æŠ¥ä¼ è¾“æ•°æ®ï¼Œä¹Ÿå°±æ˜¯UDPåè®®ã€‚ UDP: æ— è¿æ¥ ä¸å¯é  åŸºäºæ¶ˆæ¯æŠ¥\nè¿”å›çš„fdæ˜¯æŒ‡socketå¥æŸ„ï¼Œå¯ä»¥ç†è§£ä¸ºsocketçš„èº«ä»½è¯å·ã€‚é€šè¿‡è¿™ä¸ªfdä½ å¯ä»¥åœ¨å†…æ ¸ä¸­æ‰¾åˆ°å”¯ä¸€çš„socketç»“æ„ã€‚\nå¦‚æœæƒ³è¦é€šè¿‡è¿™ä¸ªsocketå‘æ¶ˆæ¯ï¼Œåªéœ€è¦æ“ä½œè¿™ä¸ªfdå°±è¡Œäº†ï¼Œæ¯”å¦‚æ‰§è¡Œ send(fd, msg, \u0026hellip;)ï¼Œå†…æ ¸å°±ä¼šé€šè¿‡è¿™ä¸ªfdå¥æŸ„æ‰¾åˆ°socketç„¶åè¿›è¡Œå‘æ•°æ®çš„æ“ä½œã€‚\nå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæ­¤æ—¶å¯¹æ–¹æ‰§è¡Œæ¥æ”¶æ¶ˆæ¯çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯ recv(fd, msg, \u0026hellip;)ï¼Œå°±èƒ½æ‹¿åˆ°ä½ å‘çš„æ¶ˆæ¯ã€‚ å¯¹äºå¼‚å¸¸æƒ…å†µçš„å¤„ç† ä½†å¦‚æœä¸é¡ºåˆ©å‘¢ï¼Ÿ\næ¯”å¦‚æ¶ˆæ¯å‘åˆ°ä¸€åŠï¼Œä¸¢åŒ…äº†å‘¢?\né‚£UDPå’ŒTCPçš„æ€åº¦å°±ä¸å¤ªä¸€æ ·äº†ã€‚\nUDPè¡¨ç¤ºï¼Œ\u0026ldquo;å“¦ï¼Œæ˜¯å—ï¼Ÿç„¶åå‘¢ï¼Ÿå…³æˆ‘xäº‹\u0026rdquo;\nTCPæ€åº¦å°±æˆªç„¶ç›¸åäº†ï¼Œ\u0026ldquo;å•Šï¼Ÿé‚£å¯ä¸è¡Œï¼Œæ˜¯ä¸æ˜¯æˆ‘å‘å¤ªå¿«äº†å‘¢ï¼Ÿæ˜¯ä¸æ˜¯é“¾è·¯å¤ªå µè¢«åˆ«äººå½±å“åˆ°äº†å‘¢ï¼Ÿä¸è¿‡ä½ æ”¾å¿ƒï¼Œæˆ‘è‚¯å®šç»™ä½ è¡¥å‘\u0026rdquo;\nTCPè€å®äººçŸ³é”¤äº†ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªè€å®äººåœ¨èƒŒåéƒ½é»˜é»˜åšäº†å“ªäº›äº‹æƒ…ã€‚\né‡ä¼ æœºåˆ¶ å¯¹äºTCPï¼Œå®ƒä¼šç»™å‘å‡ºçš„æ¶ˆæ¯æ‰“ä¸Šä¸€ä¸ªç¼–å·ï¼ˆsequenceï¼‰ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°åå›ä¸€ä¸ªç¡®è®¤(ack)ã€‚å‘é€æ–¹å¯ä»¥é€šè¿‡ackçš„æ•°å€¼çŸ¥é“æ¥æ”¶æ–¹æ”¶åˆ°äº†å“ªäº›sequenceçš„åŒ…ã€‚\nå¦‚æœé•¿æ—¶é—´ç­‰ä¸åˆ°å¯¹æ–¹çš„ç¡®è®¤ï¼ŒTCPå°±ä¼šé‡æ–°å‘ä¸€æ¬¡æ¶ˆæ¯ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„é‡ä¼ æœºåˆ¶ã€‚ æµé‡æ§åˆ¶æœºåˆ¶ ä½†é‡ä¼ è¿™ä»¶äº‹æœ¬èº«å¯¹æ€§èƒ½å½±å“æ˜¯æ¯”è¾ƒä¸¥é‡çš„ï¼Œæ‰€ä»¥æ˜¯ä¸‹ä¸‹ç­–ã€‚\näºæ˜¯TCPå°±éœ€è¦æ€è€ƒæœ‰æ²¡æœ‰åŠæ³•å¯ä»¥å°½é‡é¿å…é‡ä¼ ã€‚\nå› ä¸ºæ•°æ®å‘é€æ–¹å’Œæ¥æ”¶æ–¹å¤„ç†æ•°æ®èƒ½åŠ›å¯èƒ½ä¸åŒï¼Œå› æ­¤å¦‚æœå¯ä»¥æ ¹æ®åŒæ–¹çš„èƒ½åŠ›å»è°ƒæ•´å‘é€çš„æ•°æ®é‡å°±å¥½äº†ï¼Œäºæ˜¯å°±æœ‰äº†å‘é€å’Œæ¥æ”¶çª—å£ï¼ŒåŸºæœ¬ä¸Šä»åå­—å°±èƒ½çœ‹å‡ºå®ƒçš„ä½œç”¨ï¼Œæ¯”å¦‚æ¥æ”¶çª—å£çš„å¤§å°å°±æ˜¯æŒ‡ï¼Œæ¥æ”¶æ–¹å½“å‰èƒ½æ¥æ”¶çš„æ•°æ®é‡å¤§å°ï¼Œå‘é€çª—å£çš„å¤§å°å°±æŒ‡å‘é€æ–¹å½“å‰èƒ½å‘çš„æ•°æ®é‡å¤§å°ã€‚TCPæ ¹æ®çª—å£çš„å¤§å°å»æ§åˆ¶è‡ªå·±å‘é€çš„æ•°æ®é‡ï¼Œè¿™æ ·å°±èƒ½å¤§å¤§å‡å°‘ä¸¢åŒ…çš„æ¦‚ç‡ã€‚ æ»‘åŠ¨çª—å£æœºåˆ¶ æ¥æ”¶æ–¹çš„æ¥æ”¶åˆ°æ•°æ®ä¹‹åï¼Œä¼šä¸æ–­å¤„ç†ï¼Œå¤„ç†èƒ½åŠ›ä¹Ÿä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œæœ‰æ—¶å€™å¤„ç†çš„å¿«äº›ï¼Œé‚£å°±å¯ä»¥æ”¶å¤šç‚¹æ•°æ®ï¼Œå¤„ç†çš„æ…¢ç‚¹é‚£å°±å¸Œæœ›å¯¹æ–¹èƒ½å°‘å‘ç‚¹æ•°æ®ã€‚æ¯•ç«Ÿå‘å¤šäº†å°±æœ‰å¯èƒ½å¤„ç†ä¸è¿‡æ¥å¯¼è‡´ä¸¢åŒ…ï¼Œä¸¢åŒ…ä¼šå¯¼è‡´é‡ä¼ ï¼Œè¿™å¯æ˜¯ä¸‹ä¸‹ç­–ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦åŠ¨æ€çš„å»è°ƒèŠ‚è¿™ä¸ªæ¥æ”¶çª—å£çš„å¤§å°ï¼Œäºæ˜¯å°±æœ‰äº†æ»‘åŠ¨çª—å£æœºåˆ¶ã€‚\nçœ‹åˆ°è¿™é‡Œå¤§å®¶å¯èƒ½å°±æœ‰ç‚¹è¿·äº†ï¼Œæµé‡æ§åˆ¶å’Œæ»‘åŠ¨çª—å£æœºåˆ¶è²Œä¼¼å¾ˆåƒï¼Œå®ƒä»¬ä¹‹é—´æ˜¯å•¥å…³ç³»ï¼Ÿæˆ‘æ€»ç»“ä¸€ä¸‹ã€‚å…¶å®ç°åœ¨TCPæ˜¯é€šè¿‡æ»‘åŠ¨çª—å£æœºåˆ¶æ¥å®ç°æµé‡æ§åˆ¶æœºåˆ¶çš„ã€‚ æ‹¥å¡æ§åˆ¶æœºåˆ¶ ä½†è¿™è¿˜ä¸å¤Ÿï¼Œæœ‰æ—¶å€™å‘ç”Ÿä¸¢åŒ…ï¼Œå¹¶ä¸æ˜¯å› ä¸ºå‘é€æ–¹å’Œæ¥æ”¶æ–¹çš„å¤„ç†èƒ½åŠ›é—®é¢˜å¯¼è‡´çš„ã€‚è€Œæ˜¯è·Ÿç½‘ç»œç¯å¢ƒæœ‰å…³ï¼Œå¤§å®¶å¯ä»¥å°†ç½‘ç»œæƒ³è±¡ä¸ºä¸€æ¡å…¬è·¯ã€‚é©¬è·¯ä¸Šå¯èƒ½å µæ»¡äº†åˆ«äººå®¶çš„è½¦ï¼Œåªç•™ä¸‹ä¸€è¾†è½¦çš„ç©ºé—´ã€‚é‚£å°±ç®—ä½ å®¶æœ‰5è¾†è½¦ï¼Œç›®çš„åœ°ä¹Ÿæ­£å¥½æœ‰5ä¸ªåœè½¦ä½ï¼Œä½ ä¹Ÿæ²¡åŠæ³•åŒæ—¶å…¨éƒ¨ä¸€èµ·ä¸Šè·¯ã€‚äºæ˜¯TCPå¸Œæœ›èƒ½æ„ŸçŸ¥åˆ°å¤–éƒ¨çš„ç½‘ç»œç¯å¢ƒï¼Œæ ¹æ®ç½‘ç»œç¯å¢ƒåŠæ—¶è°ƒæ•´è‡ªå·±çš„å‘åŒ…æ•°é‡ï¼Œæ¯”å¦‚é©¬è·¯åªå¤Ÿä¸¤è¾†è½¦è·‘ï¼Œé‚£æˆ‘å°±åªå‘ä¸¤è¾†è½¦ã€‚ä½†å¤–éƒ¨ç¯å¢ƒè¿™ä¹ˆå¤æ‚ï¼ŒTCPæ˜¯æ€ä¹ˆæ„ŸçŸ¥åˆ°çš„å‘¢ï¼Ÿ\nTCPä¼šå…ˆæ…¢æ…¢è¯•æ¢çš„å‘æ•°æ®ï¼Œä¸æ–­åŠ ç æ•°æ®é‡ï¼Œè¶Šå‘è¶Šå¤šï¼Œå…ˆå‘ä¸€ä¸ªï¼Œå†å‘2ä¸ªï¼Œ4ä¸ªâ€¦ã€‚ç›´åˆ°å‡ºç°ä¸¢åŒ…ï¼Œè¿™æ ·TCPå°±çŸ¥é“ç°åœ¨å½“å‰ç½‘ç»œå¤§æ¦‚åƒå¾—æ¶ˆå‡ ä¸ªåŒ…äº†ï¼Œè¿™æ—¢æ˜¯æ‰€è°“çš„æ‹¥å¡æ§åˆ¶æœºåˆ¶ã€‚\nä¸å°‘äººä¼šç–‘æƒ‘æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶çš„å…³ç³»ã€‚æˆ‘è¿™é‡Œå°å°çš„æ€»ç»“ä¸‹ã€‚æµé‡æ§åˆ¶é’ˆå¯¹çš„æ˜¯å•ä¸ªè¿æ¥æ•°æ®å¤„ç†èƒ½åŠ›çš„æ§åˆ¶ï¼Œæ‹¥å¡æ§åˆ¶é’ˆå¯¹çš„æ˜¯æ•´ä¸ªç½‘ç»œç¯å¢ƒæ•°æ®å¤„ç†èƒ½åŠ›çš„æ§åˆ¶ã€‚\nåˆ†æ®µæœºåˆ¶ ä½†ä¸Šé¢æåˆ°çš„éƒ½æ˜¯æ€ä¹ˆé™ä½é‡ä¼ çš„æ¦‚ç‡ï¼Œä¼¼ä¹é‡ä¼ è¿™ä¸ªäº‹æƒ…å°±æ˜¯æ— æ³•é¿å…çš„ï¼Œé‚£å¦‚æœç¡®å®å‘ç”Ÿäº†ï¼Œæœ‰æ²¡æœ‰åŠæ³•é™ä½å®ƒå¸¦æ¥çš„å½±å“å‘¢ï¼Ÿ\næœ‰ã€‚å½“æˆ‘ä»¬éœ€è¦å‘é€ä¸€ä¸ªè¶…å¤§çš„æ•°æ®åŒ…æ—¶ï¼Œå¦‚æœè¿™ä¸ªæ•°æ®åŒ…ä¸¢äº†ï¼Œé‚£å°±å¾—é‡ä¼ åŒæ ·å¤§çš„æ•°æ®åŒ…ã€‚ä½†å¦‚æœæˆ‘èƒ½å°†å…¶åˆ†æˆä¸€å°æ®µä¸€å°æ®µï¼Œé‚£å°±ç®—çœŸä¸¢äº†ï¼Œé‚£æˆ‘ä¹Ÿå°±åªéœ€è¦é‡ä¼ é‚£ä¸€å°æ®µå°±å¥½äº†ï¼Œå¤§å¤§å‡å°äº†é‡ä¼ çš„å‹åŠ›ï¼Œè¿™å°±æ˜¯TCPçš„åˆ†æ®µæœºåˆ¶ã€‚\nè€Œè¿™ä¸ªæ‰€è°“çš„ä¸€å°æ®µçš„é•¿åº¦ï¼Œåœ¨ä¼ è¾“å±‚å«MSSï¼ˆMaximum Segment Sizeï¼‰ï¼Œæ•°æ®åŒ…é•¿åº¦å¤§äºMSSåˆ™ä¼šåˆ†æˆNä¸ªå°äºç­‰äºMSSçš„åŒ…ã€‚ è€Œåœ¨ç½‘ç»œå±‚ï¼Œå¦‚æœæ•°æ®åŒ…è¿˜å¤§äºMTUï¼ˆMaximum Transmit Unitï¼‰ï¼Œé‚£è¿˜ä¼šç»§ç»­åˆ†åŒ…ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒMSS=MTU-40Byteï¼Œæ‰€ä»¥TCPåˆ†æ®µåï¼Œåˆ°äº†IPå±‚å¤§æ¦‚ç‡å°±ä¸ä¼šå†åˆ†ç‰‡äº†ã€‚ ä¹±åºé‡æ’æœºåˆ¶ æ—¢ç„¶æ•°æ®åŒ…ä¼šè¢«åˆ†æ®µï¼Œé“¾è·¯åˆè¿™ä¹ˆå¤æ‚è¿˜ä¼šä¸¢åŒ…ï¼Œé‚£æ•°æ®åŒ…ä¹±åºä¹Ÿå°±æ˜¾å¾—ä¸å¥‡æ€ªäº†ã€‚æ¯”å¦‚å‘æ•°æ®åŒ…1,2,3ã€‚1å·æ•°æ®åŒ…èµ°äº†å…¶ä»–ç½‘ç»œè·¯å¾„ï¼Œ2å’Œ3æ•°æ®åŒ…å…ˆåˆ°ï¼Œ1æ•°æ®åŒ…ååˆ°ï¼Œäºæ˜¯æ•°æ®åŒ…é¡ºåºå°±æˆäº†2,3,1ã€‚è¿™ä¸€ç‚¹TCPä¹Ÿè€ƒè™‘åˆ°äº†ï¼Œä¾é æ•°æ®åŒ…çš„sequenceï¼Œæ¥æ”¶æ–¹å°±èƒ½çŸ¥é“æ•°æ®åŒ…çš„å…ˆåé¡ºåºã€‚\nåå‘çš„æ•°æ®åŒ…å…ˆåˆ°æ˜¯å§ï¼Œé‚£å°±å…ˆæ”¾åˆ°ä¸“é—¨çš„ä¹±åºé˜Ÿåˆ—ä¸­ï¼Œç­‰æ•°æ®éƒ½åˆ°é½åï¼Œé‡æ–°æ•´ç†å¥½ä¹±åºé˜Ÿåˆ—çš„æ•°æ®åŒ…é¡ºåºåå†ç»™åˆ°ç”¨æˆ·ï¼Œè¿™å°±æ˜¯ä¹±åºé‡æ’æœºåˆ¶ã€‚ è¿æ¥æœºåˆ¶ å‰é¢æåˆ°ï¼ŒUDPæ˜¯æ— è¿æ¥çš„ï¼Œè€ŒTCPæ˜¯é¢å‘è¿æ¥çš„ã€‚\nè¿™é‡Œæåˆ°çš„è¿æ¥åˆ°åº•æ˜¯å•¥ï¼Ÿ\nTCPé€šè¿‡ä¸Šé¢æåˆ°çš„å„ç§æœºåˆ¶å®ç°äº†æ•°æ®çš„å¯é æ€§ã€‚è¿™äº›æœºåˆ¶èƒŒåæ˜¯é€šè¿‡ä¸€ä¸ªä¸ªæ•°æ®ç»“æ„æ¥å®ç°çš„é€»è¾‘ã€‚è€Œä¸ºäº†å®ç°è¿™å¥—é€»è¾‘ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸éœ€è¦åœ¨ä¸¤ç«¯ä»£ç é‡Œç»´æŠ¤ä¸€å¥—å¤æ‚çš„çŠ¶æ€æœºï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹ï¼ŒRSTï¼Œclosingç­‰å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼‰ï¼Œè¿™å¥—çŠ¶æ€æœºå…¶å®å°±æ˜¯æ‰€è°“çš„\u0026quot;è¿æ¥\u0026quot;ã€‚è¿™å…¶å®å°±æ˜¯TCPçš„è¿æ¥æœºåˆ¶ï¼Œè€ŒUDPç”¨ä¸ä¸Šè¿™å¥—çŠ¶æ€æœºï¼Œå› æ­¤å®ƒæ˜¯\u0026quot;æ— è¿æ¥\u0026quot;çš„ã€‚\nç½‘ç»œç¯å¢ƒé“¾è·¯å¾ˆé•¿ï¼Œè¿˜å¤æ‚ï¼Œæ•°æ®ä¸¢åŒ…æ˜¯å¾ˆå¸¸è§çš„ã€‚\næˆ‘ä»¬å¹³å¸¸ç”¨TCPåšå„ç§æ•°æ®ä¼ è¾“ï¼Œå®Œå…¨å¯¹è¿™äº›äº‹æƒ…æ— æ„ŸçŸ¥ã€‚\nå“ªæœ‰ä»€ä¹ˆå²æœˆé™å¥½ï¼Œæ˜¯TCPæ›¿ä½ è´Ÿé‡å‰è¡Œã€‚\nè¿™å°±æ˜¯TCPä¸‰å¤§ç‰¹æ€§\u0026quot;é¢å‘è¿æ¥ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµ\u0026quot;ä¸­\u0026quot;å¯é \u0026quot;çš„å«ä¹‰ã€‚\nä¸ä¿¡ä½ æ”¹ç”¨UDPè¯•è¯•ï¼Œä¸¢åŒ…é‚£å°±æ˜¯çœŸä¸¢äº†ï¼Œä¸¢åˆ°ä½ æ€€ç–‘äººç”Ÿã€‚\nç”¨UDPå°±ä¸€å®šæ¯”ç”¨TCPå¿«å—ï¼Ÿ è¿™æ—¶å€™UDPå°±ä¸æœäº†ï¼š\u0026ldquo;æ­£å› ä¸ºæ²¡æœ‰è¿™äº›å¤æ‚çš„TCPå¯é æ€§æœºåˆ¶ï¼Œæ‰€ä»¥æˆ‘å¾ˆå¿«å•Š\u0026rdquo;\nå—¯ï¼Œè¿™ä¹Ÿæ˜¯å¤§éƒ¨åˆ†äººè®¤ä¸ºUDPæ¯”TCPå¿«çš„åŸå› ã€‚ å®é™…ä¸Šå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¹Ÿç¡®å®æ˜¯è¿™æ ·çš„ã€‚è¿™è¯æ²¡æ¯›ç—…ã€‚\né‚£é—®é¢˜å°±æ¥äº†ã€‚æœ‰æ²¡æœ‰ç”¨äº†UDPä½†å´æ¯”TCPæ…¢çš„æƒ…å†µå‘¢ï¼Ÿ\nå…¶å®ä¹Ÿæœ‰ã€‚ åœ¨å›ç­”è¿™ä¸ªé—®é¢˜å‰ï¼Œæˆ‘éœ€è¦å…ˆè¯´ä¸‹UDPçš„ç”¨é€”ã€‚\nå®é™…ä¸Šï¼Œå¤§éƒ¨åˆ†äººä¹Ÿä¸ä¼šå°è¯•ç›´æ¥æ‹¿è£¸udpæ”¾åˆ°ç”Ÿäº§ç¯å¢ƒä¸­å»åšé¡¹ç›®ã€‚\né‚£UDPçš„ä»·å€¼åœ¨å“ªï¼Ÿ\nåœ¨æˆ‘çœ‹æ¥ï¼ŒUDPçš„å­˜åœ¨ï¼Œæœ¬è´¨æ˜¯å†…æ ¸æä¾›çš„ä¸€ä¸ªæœ€å°ç½‘ç»œä¼ è¾“åŠŸèƒ½ã€‚\nå¾ˆå¤šæ—¶å€™ï¼Œå¤§å®¶è™½ç„¶å·ç§°è‡ªå·±ç”¨äº†UDPï¼Œä½†å®é™…ä¸Šéƒ½å¾ˆå¿Œæƒ®å®ƒçš„ä¸¢åŒ…é—®é¢˜ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½ä¼šåœ¨UDPçš„åŸºç¡€ä¸Šåšå„ç§ä¸åŒç¨‹åº¦çš„åº”ç”¨å±‚å¯é æ€§ä¿è¯ã€‚æ¯”å¦‚ç‹è€…å†œè¯ç”¨çš„KCPï¼Œä»¥åŠæœ€è¿‘å¾ˆç«çš„QUICï¼ˆHTTP3.0ï¼‰ï¼Œå…¶å®éƒ½åœ¨UDPçš„åŸºç¡€ä¸Šåšäº†é‡ä¼ é€»è¾‘ï¼Œå®ç°äº†ä¸€å¥—ç±»ä¼¼TCPé‚£æ ·çš„å¯é æ€§æœºåˆ¶ã€‚\næ•™ç§‘ä¹¦ä¸Šæœ€çˆ±æUDPé€‚åˆç”¨äºéŸ³è§†é¢‘ä¼ è¾“ï¼Œå› ä¸ºè¿™äº›åœºæ™¯å…è®¸ä¸¢åŒ…ã€‚ä½†å…¶å®ä¹Ÿä¸æ˜¯ä»€ä¹ˆåŒ…éƒ½èƒ½ä¸¢çš„ï¼Œæ¯”å¦‚é‡è¦çš„å…³é”®å¸§å•¥çš„ï¼Œè¯¥é‡ä¼ è¿˜å¾—é‡ä¼ ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›ä¹±åºå¤„ç†æœºåˆ¶ã€‚ä¸¾ä¸ªä¾‹å­å§ã€‚\næ‰“éŸ³è§†é¢‘ç”µè¯çš„æ—¶å€™ï¼Œä½ å¯èƒ½é‡åˆ°è¿‡ä¸¢å¤±ä¸­é—´æŸéƒ¨åˆ†ä¿¡æ¯çš„æƒ…å†µï¼Œä½†åº”è¯¥ä»æ¥æ²¡é‡åˆ°è¿‡ä¹±åºçš„æƒ…å†µå§ã€‚\næ¯”å¦‚å¯¹æ–¹æ‰“ç½‘ç»œç”µè¯ç»™ä½ ï¼Œè¯´äº†ï¼š\u0026ldquo;æˆ‘å¥½æƒ³ç»™å°ç™½æ¥ä¸ªç‚¹èµåœ¨çœ‹ï¼\u0026rdquo;\nè¿™æ—¶å€™ç½‘ç»œä¿¡å·ä¸å¥½ï¼Œä½ å¯èƒ½ä¼šå¬åˆ°\u0026quot;æˆ‘â€¦.ç‚¹èµåœ¨çœ‹\u0026quot;ã€‚\nä½†å´ä»æ¥æ²¡é‡åˆ°è¿‡\u0026quot;åœ¨çœ‹å°ç™½å¥½æƒ³èµ\u0026quot;è¿™æ ·çš„ä¹±åºåœºæ™¯å§ï¼Ÿ\næ‰€ä»¥è¯´ï¼Œè™½ç„¶é€‰æ‹©äº†ä½¿ç”¨UDPï¼Œä½†ä¸€èˆ¬è¿˜æ˜¯ä¼šåœ¨åº”ç”¨å±‚ä¸Šåšä¸€äº›é‡ä¼ æœºåˆ¶çš„ã€‚\näºæ˜¯é—®é¢˜å°±æ¥äº†ï¼Œå¦‚æœç°åœ¨æˆ‘éœ€è¦ä¼ ä¸€ä¸ªç‰¹åˆ«å¤§çš„æ•°æ®åŒ…ã€‚\nåœ¨TCPé‡Œï¼Œå®ƒå†…éƒ¨ä¼šæ ¹æ®MSSçš„å¤§å°åˆ†æ®µï¼Œè¿™æ—¶å€™è¿›å…¥åˆ°IPå±‚ä¹‹åï¼Œæ¯ä¸ªåŒ…å¤§å°éƒ½ä¸ä¼šè¶…è¿‡MTUï¼Œå› æ­¤IPå±‚ä¸€èˆ¬ä¸ä¼šå†è¿›è¡Œåˆ†ç‰‡ã€‚è¿™æ—¶å€™å‘ç”Ÿä¸¢åŒ…äº†ï¼Œåªéœ€è¦é‡ä¼ æ¯ä¸ªMSSåˆ†æ®µå°±å¤Ÿäº†ã€‚\nä½†å¯¹äºUDPï¼Œå…¶æœ¬èº«å¹¶ä¸ä¼šåˆ†æ®µï¼Œå¦‚æœæ•°æ®è¿‡å¤§ï¼Œåˆ°äº†IPå±‚ï¼Œå°±ä¼šè¿›è¡Œåˆ†ç‰‡ã€‚æ­¤æ—¶å‘ç”Ÿä¸¢åŒ…çš„è¯ï¼Œå†æ¬¡é‡ä¼ ï¼Œå°±ä¼šé‡ä¼ æ•´ä¸ªå¤§æ•°æ®åŒ…ã€‚\nå¯¹äºä¸Šé¢è¿™ç§æƒ…å†µï¼Œä½¿ç”¨UDPå°±æ¯”TCPè¦æ…¢ã€‚\nå½“ç„¶ï¼Œè§£å†³èµ·æ¥ä¹Ÿä¸å¤æ‚ã€‚è¿™é‡Œçš„å…³é”®ç‚¹åœ¨äºæ˜¯å¦å®ç°äº†æ•°æ®åˆ†æ®µæœºåˆ¶ï¼Œä½¿ç”¨UDPçš„åº”ç”¨å±‚å¦‚æœä¹Ÿå®ç°äº†åˆ†æ®µæœºåˆ¶çš„è¯ï¼Œé‚£å°±ä¸ä¼šå‡ºç°ä¸Šè¿°çš„é—®é¢˜äº†ã€‚\næ€»ç»“ TCPä¸ºäº†å®ç°å¯é æ€§ï¼Œå¼•å…¥äº†é‡ä¼ æœºåˆ¶ã€æµé‡æ§åˆ¶ã€æ»‘åŠ¨çª—å£ã€æ‹¥å¡æ§åˆ¶ã€åˆ†æ®µä»¥åŠä¹±åºé‡æ’æœºåˆ¶ã€‚è€ŒUDPåˆ™æ²¡æœ‰å®ç°ï¼Œå› æ­¤ä¸€èˆ¬æ¥è¯´TCPæ¯”UDPæ…¢ã€‚\nTCPæ˜¯é¢å‘è¿æ¥çš„åè®®ï¼Œè€ŒUDPæ˜¯æ— è¿æ¥çš„åè®®ã€‚è¿™é‡Œçš„\u0026quot;è¿æ¥\u0026quot;å…¶å®æ˜¯ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸åœ¨ä¸¤ç«¯ä»£ç é‡Œç»´æŠ¤çš„ä¸€å¥—å¤æ‚çŠ¶æ€æœºã€‚\nå¤§éƒ¨åˆ†é¡¹ç›®ï¼Œä¼šåœ¨åŸºäºUDPçš„åŸºç¡€ä¸Šï¼Œæ¨¡ä»¿TCPï¼Œå®ç°ä¸åŒç¨‹åº¦çš„å¯é æ€§æœºåˆ¶ã€‚æ¯”å¦‚ç‹è€…å†œè¯ç”¨çš„KCPå…¶å®å°±åœ¨åŸºäºUDPåœ¨åº”ç”¨å±‚é‡Œå®ç°äº†ä¸€å¥—é‡ä¼ æœºåˆ¶ã€‚\nå¯¹äºUDP+é‡ä¼ çš„åœºæ™¯ï¼Œå¦‚æœè¦ä¼ è¶…å¤§æ•°æ®åŒ…ï¼Œå¹¶ä¸”æ²¡æœ‰å®ç°åˆ†æ®µæœºåˆ¶çš„è¯ï¼Œé‚£æ•°æ®å°±ä¼šåœ¨IPå±‚åˆ†ç‰‡ï¼Œä¸€æ—¦ä¸¢åŒ…ï¼Œé‚£å°±éœ€è¦é‡ä¼ æ•´ä¸ªè¶…å¤§æ•°æ®åŒ…ã€‚è€ŒTCPåˆ™ä¸éœ€è¦è€ƒè™‘è¿™ä¸ªï¼Œå†…éƒ¨ä¼šè‡ªåŠ¨åˆ†æ®µï¼Œä¸¢åŒ…é‡ä¼ åˆ†æ®µå°±è¡Œäº†ã€‚è¿™ç§åœºæ™¯ä¸‹ï¼Œå…¶å®TCPæ›´å¿«ã€‚\n","permalink":"https://reid00.github.io/en/posts/os_network/udp%E5%B0%B1%E4%B8%80%E5%AE%9A%E6%AF%94tcp%E5%BF%AB%E5%90%97/","summary":"è¯è¯´ï¼ŒUDPæ¯”TCPå¿«å—ï¼Ÿ\nç›¸ä¿¡å°±ç®—ä¸æ˜¯å…«è‚¡æ–‡è€æ‰‹ï¼Œä¹Ÿä¼šä¸‹æ„è¯†çš„è„±å£è€Œå‡ºï¼š\u0026ldquo;æ˜¯\u0026rdquo;ã€‚\nè¿™è¦è¿½é—®ä¸ºä»€ä¹ˆï¼Œä¼°è®¡å¤§å®¶ä¹Ÿèƒ½è¯´å‡ºä¸ªå¤§æ¦‚ã€‚\nä½†è¿™ä¹Ÿè®©äººå¥½å¥‡ï¼Œç”¨UDPå°±ä¸€å®šæ¯”ç”¨TCPå¿«å—ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ç”¨UDPä¼šæ¯”ç”¨TCPæ…¢ï¼Ÿ\næˆ‘ä»¬ä»Šå¤©å°±æ¥èŠä¸‹è¿™ä¸ªè¯é¢˜ã€‚\nä½¿ç”¨socketè¿›è¡Œæ•°æ®ä¼ è¾“ ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦åœ¨Aç”µè„‘çš„è¿›ç¨‹å‘ä¸€æ®µæ•°æ®åˆ°Bç”µè„‘çš„è¿›ç¨‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨ä»£ç é‡Œä½¿ç”¨socketè¿›è¡Œç¼–ç¨‹ã€‚\nsocketå°±åƒæ˜¯ä¸€ä¸ªç”µè¯æˆ–è€…é‚®ç®±ï¼ˆé‚®æ”¿çš„ä¿¡ç®±ï¼‰ã€‚å½“ä½ æƒ³è¦å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œæ‹¨é€šç”µè¯æˆ–è€…å°†ä¿¡æ¯å¡åˆ°é‚®ç®±é‡Œï¼Œsocketå†…æ ¸ä¼šè‡ªåŠ¨å®Œæˆå°†æ•°æ®ä¼ ç»™å¯¹æ–¹çš„è¿™ä¸ªè¿‡ç¨‹ã€‚\nåŸºäºsocketæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨TCPæˆ–UDPåè®®è¿›è¡Œé€šä¿¡ã€‚\nå¯¹äºTCPè¿™æ ·çš„å¯é æ€§åè®®ï¼Œæ¯æ¬¡æ¶ˆæ¯å‘å‡ºåéƒ½èƒ½æ˜ç¡®çŸ¥é“å¯¹æ–¹æ”¶æ²¡æ”¶åˆ°ï¼Œå°±åƒæ‰“ç”µè¯ä¸€æ ·ï¼Œåªè¦\u0026quot;å–‚å–‚\u0026quot;ä¸¤ä¸‹å°±èƒ½çŸ¥é“å¯¹æ–¹æœ‰æ²¡æœ‰åœ¨å¬ã€‚\nè€ŒUDPå°±åƒæ˜¯ç»™é‚®æ”¿çš„ä¿¡ç®±å¯„ä¿¡ä¸€æ ·ï¼Œä½ å¯„å‡ºå»çš„ä¿¡ï¼Œæ ¹æœ¬å°±ä¸çŸ¥é“å¯¹æ–¹æœ‰æ²¡æœ‰æ­£å¸¸æ”¶åˆ°ï¼Œä¸¢äº†ä¹Ÿæ˜¯æœ‰å¯èƒ½çš„ã€‚\nè¿™è®©æˆ‘æƒ³èµ·äº†å¤§æ¦‚17å¹´å‰ï¼Œå½“æ—¶è¿˜æ²¡æœ‰ç°åœ¨è¿™ä¹ˆå‘è¾¾çš„ç½‘è´­ï¼Œæƒ³ä¹°ä¸€æœ¬ã€ŠæŒæœºè¿·ã€‹æ‚å¿—ï¼Œè¿˜å¾—å¾€ä¿¡å°é‡Œå¡é’±ï¼Œç„¶åä¸€ç­‰å°±æ˜¯ä¸€ä¸ªæœˆï¼Œå¥½å‡ æ¬¡éƒ½æ€€ç–‘ä¿¡æ˜¯ä¸æ˜¯ä¸¢äº†ã€‚æˆ‘è‡³ä»Šå°è±¡æ·±åˆ»ï¼Œå› ä¸ºé‚£æ˜¯æˆ‘å’Œæˆ‘å“¥æ”’äº†å¥½ä¹…çš„é’±ã€‚ã€‚ã€‚\nå›åˆ°socketç¼–ç¨‹çš„è¯é¢˜ä¸Šã€‚\nåˆ›å»ºsocketçš„æ–¹å¼å°±åƒä¸‹é¢è¿™æ ·ã€‚\n1 fd = socket(AF_INET, å…·ä½“åè®®,0); æ³¨æ„ä¸Šé¢çš„\u0026quot;å…·ä½“åè®®\u0026quot;ï¼Œå¦‚æœä¼ å…¥çš„æ˜¯SOCK_STREAMï¼Œæ˜¯æŒ‡ä½¿ç”¨å­—èŠ‚æµä¼ è¾“æ•°æ®ï¼Œè¯´ç™½äº†å°±æ˜¯TCPåè®®ã€‚ TCP: é¢å‘è¿æ¥çš„ å¯é çš„ åŸºäºå­—èŠ‚æµ å¦‚æœä¼ å…¥çš„æ˜¯SOCK_DGRAMï¼Œæ˜¯æŒ‡ä½¿ç”¨æ•°æ®æŠ¥ä¼ è¾“æ•°æ®ï¼Œä¹Ÿå°±æ˜¯UDPåè®®ã€‚ UDP: æ— è¿æ¥ ä¸å¯é  åŸºäºæ¶ˆæ¯æŠ¥\nè¿”å›çš„fdæ˜¯æŒ‡socketå¥æŸ„ï¼Œå¯ä»¥ç†è§£ä¸ºsocketçš„èº«ä»½è¯å·ã€‚é€šè¿‡è¿™ä¸ªfdä½ å¯ä»¥åœ¨å†…æ ¸ä¸­æ‰¾åˆ°å”¯ä¸€çš„socketç»“æ„ã€‚\nå¦‚æœæƒ³è¦é€šè¿‡è¿™ä¸ªsocketå‘æ¶ˆæ¯ï¼Œåªéœ€è¦æ“ä½œè¿™ä¸ªfdå°±è¡Œäº†ï¼Œæ¯”å¦‚æ‰§è¡Œ send(fd, msg, \u0026hellip;)ï¼Œå†…æ ¸å°±ä¼šé€šè¿‡è¿™ä¸ªfdå¥æŸ„æ‰¾åˆ°socketç„¶åè¿›è¡Œå‘æ•°æ®çš„æ“ä½œã€‚\nå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæ­¤æ—¶å¯¹æ–¹æ‰§è¡Œæ¥æ”¶æ¶ˆæ¯çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯ recv(fd, msg, \u0026hellip;)ï¼Œå°±èƒ½æ‹¿åˆ°ä½ å‘çš„æ¶ˆæ¯ã€‚ å¯¹äºå¼‚å¸¸æƒ…å†µçš„å¤„ç† ä½†å¦‚æœä¸é¡ºåˆ©å‘¢ï¼Ÿ\næ¯”å¦‚æ¶ˆæ¯å‘åˆ°ä¸€åŠï¼Œä¸¢åŒ…äº†å‘¢?\né‚£UDPå’ŒTCPçš„æ€åº¦å°±ä¸å¤ªä¸€æ ·äº†ã€‚\nUDPè¡¨ç¤ºï¼Œ\u0026ldquo;å“¦ï¼Œæ˜¯å—ï¼Ÿç„¶åå‘¢ï¼Ÿå…³æˆ‘xäº‹\u0026rdquo;\nTCPæ€åº¦å°±æˆªç„¶ç›¸åäº†ï¼Œ\u0026ldquo;å•Šï¼Ÿé‚£å¯ä¸è¡Œï¼Œæ˜¯ä¸æ˜¯æˆ‘å‘å¤ªå¿«äº†å‘¢ï¼Ÿæ˜¯ä¸æ˜¯é“¾è·¯å¤ªå µè¢«åˆ«äººå½±å“åˆ°äº†å‘¢ï¼Ÿä¸è¿‡ä½ æ”¾å¿ƒï¼Œæˆ‘è‚¯å®šç»™ä½ è¡¥å‘\u0026rdquo;\nTCPè€å®äººçŸ³é”¤äº†ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªè€å®äººåœ¨èƒŒåéƒ½é»˜é»˜åšäº†å“ªäº›äº‹æƒ…ã€‚\né‡ä¼ æœºåˆ¶ å¯¹äºTCPï¼Œå®ƒä¼šç»™å‘å‡ºçš„æ¶ˆæ¯æ‰“ä¸Šä¸€ä¸ªç¼–å·ï¼ˆsequenceï¼‰ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°åå›ä¸€ä¸ªç¡®è®¤(ack)ã€‚å‘é€æ–¹å¯ä»¥é€šè¿‡ackçš„æ•°å€¼çŸ¥é“æ¥æ”¶æ–¹æ”¶åˆ°äº†å“ªäº›sequenceçš„åŒ…ã€‚\nå¦‚æœé•¿æ—¶é—´ç­‰ä¸åˆ°å¯¹æ–¹çš„ç¡®è®¤ï¼ŒTCPå°±ä¼šé‡æ–°å‘ä¸€æ¬¡æ¶ˆæ¯ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„é‡ä¼ æœºåˆ¶ã€‚ æµé‡æ§åˆ¶æœºåˆ¶ ä½†é‡ä¼ è¿™ä»¶äº‹æœ¬èº«å¯¹æ€§èƒ½å½±å“æ˜¯æ¯”è¾ƒä¸¥é‡çš„ï¼Œæ‰€ä»¥æ˜¯ä¸‹ä¸‹ç­–ã€‚\näºæ˜¯TCPå°±éœ€è¦æ€è€ƒæœ‰æ²¡æœ‰åŠæ³•å¯ä»¥å°½é‡é¿å…é‡ä¼ ã€‚\nå› ä¸ºæ•°æ®å‘é€æ–¹å’Œæ¥æ”¶æ–¹å¤„ç†æ•°æ®èƒ½åŠ›å¯èƒ½ä¸åŒï¼Œå› æ­¤å¦‚æœå¯ä»¥æ ¹æ®åŒæ–¹çš„èƒ½åŠ›å»è°ƒæ•´å‘é€çš„æ•°æ®é‡å°±å¥½äº†ï¼Œäºæ˜¯å°±æœ‰äº†å‘é€å’Œæ¥æ”¶çª—å£ï¼ŒåŸºæœ¬ä¸Šä»åå­—å°±èƒ½çœ‹å‡ºå®ƒçš„ä½œç”¨ï¼Œæ¯”å¦‚æ¥æ”¶çª—å£çš„å¤§å°å°±æ˜¯æŒ‡ï¼Œæ¥æ”¶æ–¹å½“å‰èƒ½æ¥æ”¶çš„æ•°æ®é‡å¤§å°ï¼Œå‘é€çª—å£çš„å¤§å°å°±æŒ‡å‘é€æ–¹å½“å‰èƒ½å‘çš„æ•°æ®é‡å¤§å°ã€‚TCPæ ¹æ®çª—å£çš„å¤§å°å»æ§åˆ¶è‡ªå·±å‘é€çš„æ•°æ®é‡ï¼Œè¿™æ ·å°±èƒ½å¤§å¤§å‡å°‘ä¸¢åŒ…çš„æ¦‚ç‡ã€‚ æ»‘åŠ¨çª—å£æœºåˆ¶ æ¥æ”¶æ–¹çš„æ¥æ”¶åˆ°æ•°æ®ä¹‹åï¼Œä¼šä¸æ–­å¤„ç†ï¼Œå¤„ç†èƒ½åŠ›ä¹Ÿä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œæœ‰æ—¶å€™å¤„ç†çš„å¿«äº›ï¼Œé‚£å°±å¯ä»¥æ”¶å¤šç‚¹æ•°æ®ï¼Œå¤„ç†çš„æ…¢ç‚¹é‚£å°±å¸Œæœ›å¯¹æ–¹èƒ½å°‘å‘ç‚¹æ•°æ®ã€‚æ¯•ç«Ÿå‘å¤šäº†å°±æœ‰å¯èƒ½å¤„ç†ä¸è¿‡æ¥å¯¼è‡´ä¸¢åŒ…ï¼Œä¸¢åŒ…ä¼šå¯¼è‡´é‡ä¼ ï¼Œè¿™å¯æ˜¯ä¸‹ä¸‹ç­–ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦åŠ¨æ€çš„å»è°ƒèŠ‚è¿™ä¸ªæ¥æ”¶çª—å£çš„å¤§å°ï¼Œäºæ˜¯å°±æœ‰äº†æ»‘åŠ¨çª—å£æœºåˆ¶ã€‚\nçœ‹åˆ°è¿™é‡Œå¤§å®¶å¯èƒ½å°±æœ‰ç‚¹è¿·äº†ï¼Œæµé‡æ§åˆ¶å’Œæ»‘åŠ¨çª—å£æœºåˆ¶è²Œä¼¼å¾ˆåƒï¼Œå®ƒä»¬ä¹‹é—´æ˜¯å•¥å…³ç³»ï¼Ÿæˆ‘æ€»ç»“ä¸€ä¸‹ã€‚å…¶å®ç°åœ¨TCPæ˜¯é€šè¿‡æ»‘åŠ¨çª—å£æœºåˆ¶æ¥å®ç°æµé‡æ§åˆ¶æœºåˆ¶çš„ã€‚ æ‹¥å¡æ§åˆ¶æœºåˆ¶ ä½†è¿™è¿˜ä¸å¤Ÿï¼Œæœ‰æ—¶å€™å‘ç”Ÿä¸¢åŒ…ï¼Œå¹¶ä¸æ˜¯å› ä¸ºå‘é€æ–¹å’Œæ¥æ”¶æ–¹çš„å¤„ç†èƒ½åŠ›é—®é¢˜å¯¼è‡´çš„ã€‚è€Œæ˜¯è·Ÿç½‘ç»œç¯å¢ƒæœ‰å…³ï¼Œå¤§å®¶å¯ä»¥å°†ç½‘ç»œæƒ³è±¡ä¸ºä¸€æ¡å…¬è·¯ã€‚é©¬è·¯ä¸Šå¯èƒ½å µæ»¡äº†åˆ«äººå®¶çš„è½¦ï¼Œåªç•™ä¸‹ä¸€è¾†è½¦çš„ç©ºé—´ã€‚é‚£å°±ç®—ä½ å®¶æœ‰5è¾†è½¦ï¼Œç›®çš„åœ°ä¹Ÿæ­£å¥½æœ‰5ä¸ªåœè½¦ä½ï¼Œä½ ä¹Ÿæ²¡åŠæ³•åŒæ—¶å…¨éƒ¨ä¸€èµ·ä¸Šè·¯ã€‚äºæ˜¯TCPå¸Œæœ›èƒ½æ„ŸçŸ¥åˆ°å¤–éƒ¨çš„ç½‘ç»œç¯å¢ƒï¼Œæ ¹æ®ç½‘ç»œç¯å¢ƒåŠæ—¶è°ƒæ•´è‡ªå·±çš„å‘åŒ…æ•°é‡ï¼Œæ¯”å¦‚é©¬è·¯åªå¤Ÿä¸¤è¾†è½¦è·‘ï¼Œé‚£æˆ‘å°±åªå‘ä¸¤è¾†è½¦ã€‚ä½†å¤–éƒ¨ç¯å¢ƒè¿™ä¹ˆå¤æ‚ï¼ŒTCPæ˜¯æ€ä¹ˆæ„ŸçŸ¥åˆ°çš„å‘¢ï¼Ÿ\nTCPä¼šå…ˆæ…¢æ…¢è¯•æ¢çš„å‘æ•°æ®ï¼Œä¸æ–­åŠ ç æ•°æ®é‡ï¼Œè¶Šå‘è¶Šå¤šï¼Œå…ˆå‘ä¸€ä¸ªï¼Œå†å‘2ä¸ªï¼Œ4ä¸ªâ€¦ã€‚ç›´åˆ°å‡ºç°ä¸¢åŒ…ï¼Œè¿™æ ·TCPå°±çŸ¥é“ç°åœ¨å½“å‰ç½‘ç»œå¤§æ¦‚åƒå¾—æ¶ˆå‡ ä¸ªåŒ…äº†ï¼Œè¿™æ—¢æ˜¯æ‰€è°“çš„æ‹¥å¡æ§åˆ¶æœºåˆ¶ã€‚\nä¸å°‘äººä¼šç–‘æƒ‘æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶çš„å…³ç³»ã€‚æˆ‘è¿™é‡Œå°å°çš„æ€»ç»“ä¸‹ã€‚æµé‡æ§åˆ¶é’ˆå¯¹çš„æ˜¯å•ä¸ªè¿æ¥æ•°æ®å¤„ç†èƒ½åŠ›çš„æ§åˆ¶ï¼Œæ‹¥å¡æ§åˆ¶é’ˆå¯¹çš„æ˜¯æ•´ä¸ªç½‘ç»œç¯å¢ƒæ•°æ®å¤„ç†èƒ½åŠ›çš„æ§åˆ¶ã€‚\nåˆ†æ®µæœºåˆ¶ ä½†ä¸Šé¢æåˆ°çš„éƒ½æ˜¯æ€ä¹ˆé™ä½é‡ä¼ çš„æ¦‚ç‡ï¼Œä¼¼ä¹é‡ä¼ è¿™ä¸ªäº‹æƒ…å°±æ˜¯æ— æ³•é¿å…çš„ï¼Œé‚£å¦‚æœç¡®å®å‘ç”Ÿäº†ï¼Œæœ‰æ²¡æœ‰åŠæ³•é™ä½å®ƒå¸¦æ¥çš„å½±å“å‘¢ï¼Ÿ\næœ‰ã€‚å½“æˆ‘ä»¬éœ€è¦å‘é€ä¸€ä¸ªè¶…å¤§çš„æ•°æ®åŒ…æ—¶ï¼Œå¦‚æœè¿™ä¸ªæ•°æ®åŒ…ä¸¢äº†ï¼Œé‚£å°±å¾—é‡ä¼ åŒæ ·å¤§çš„æ•°æ®åŒ…ã€‚ä½†å¦‚æœæˆ‘èƒ½å°†å…¶åˆ†æˆä¸€å°æ®µä¸€å°æ®µï¼Œé‚£å°±ç®—çœŸä¸¢äº†ï¼Œé‚£æˆ‘ä¹Ÿå°±åªéœ€è¦é‡ä¼ é‚£ä¸€å°æ®µå°±å¥½äº†ï¼Œå¤§å¤§å‡å°äº†é‡ä¼ çš„å‹åŠ›ï¼Œè¿™å°±æ˜¯TCPçš„åˆ†æ®µæœºåˆ¶ã€‚\nè€Œè¿™ä¸ªæ‰€è°“çš„ä¸€å°æ®µçš„é•¿åº¦ï¼Œåœ¨ä¼ è¾“å±‚å«MSSï¼ˆMaximum Segment Sizeï¼‰ï¼Œæ•°æ®åŒ…é•¿åº¦å¤§äºMSSåˆ™ä¼šåˆ†æˆNä¸ªå°äºç­‰äºMSSçš„åŒ…ã€‚ è€Œåœ¨ç½‘ç»œå±‚ï¼Œå¦‚æœæ•°æ®åŒ…è¿˜å¤§äºMTUï¼ˆMaximum Transmit Unitï¼‰ï¼Œé‚£è¿˜ä¼šç»§ç»­åˆ†åŒ…ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒMSS=MTU-40Byteï¼Œæ‰€ä»¥TCPåˆ†æ®µåï¼Œåˆ°äº†IPå±‚å¤§æ¦‚ç‡å°±ä¸ä¼šå†åˆ†ç‰‡äº†ã€‚ ä¹±åºé‡æ’æœºåˆ¶ æ—¢ç„¶æ•°æ®åŒ…ä¼šè¢«åˆ†æ®µï¼Œé“¾è·¯åˆè¿™ä¹ˆå¤æ‚è¿˜ä¼šä¸¢åŒ…ï¼Œé‚£æ•°æ®åŒ…ä¹±åºä¹Ÿå°±æ˜¾å¾—ä¸å¥‡æ€ªäº†ã€‚æ¯”å¦‚å‘æ•°æ®åŒ…1,2,3ã€‚1å·æ•°æ®åŒ…èµ°äº†å…¶ä»–ç½‘ç»œè·¯å¾„ï¼Œ2å’Œ3æ•°æ®åŒ…å…ˆåˆ°ï¼Œ1æ•°æ®åŒ…ååˆ°ï¼Œäºæ˜¯æ•°æ®åŒ…é¡ºåºå°±æˆäº†2,3,1ã€‚è¿™ä¸€ç‚¹TCPä¹Ÿè€ƒè™‘åˆ°äº†ï¼Œä¾é æ•°æ®åŒ…çš„sequenceï¼Œæ¥æ”¶æ–¹å°±èƒ½çŸ¥é“æ•°æ®åŒ…çš„å…ˆåé¡ºåºã€‚","title":"UDPå°±ä¸€å®šæ¯”TCPå¿«å—"},{"content":"ç®€ä»‹ æœ€è¿‘ä½¿ç”¨Gin æ¡†æ¶å†™æ¥å£ï¼Œæ€»æ˜¯ä¼šå‡ºç°ä¸€äº›write: connection reset by peer æˆ–è€… write: broken pipe çš„é”™è¯¯, åœ¨æŸ¥è¯¢èµ„æ–™çš„æ—¶å€™ï¼Œå‘ç°TCPçš„ä¸‹é¢çš„æƒ…å†µå¯ä»¥è§¦å‘ä¸€ä¸‹ä¸¤ç§é”™è¯¯ã€‚ å¦å¤–Gin çš„å‡ºç°è¿™ä¸ªé”™è¯¯çš„åŸå› è¿™è¾¹æœ‰ä¸ªåˆ†æGin-RST å¤§æ¦‚åŸå› å°±æ˜¯DB è¿æ¥æ± å¤ªå°ï¼Œæœ‰å¤§é‡è¯·æ±‚æ’é˜Ÿç­‰å¾…ç©ºé—²é“¾æ¥ï¼Œæ’é˜Ÿæ—¶é—´è¶Šé•¿ç§¯å‹çš„è¯·æ±‚è¶Šå¤šï¼Œè¯·æ±‚å¤„ç†è€—æ—¶è¶Šå¤§ï¼Œç›´åˆ°ç§¯å‹è¯·æ±‚å¤ªå¤šæŠŠå¥æŸ„æ‰“æ»¡ï¼Œå‡ºç°äº†æ­»é”ã€‚\nwrite: broken pipe è§¦å‘åŸå› :\næœåŠ¡å™¨æ¥æ”¶ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å­—èŠ‚å¹¶å…³é—­è¿æ¥ã€‚å·²å…³é—­çš„æœåŠ¡ç«¯ åœ¨æ”¶åˆ° å®¢æˆ·ç«¯çš„ä¸‹ä¸€ä¸ªå­—èŠ‚å†™å…¥ å°†å¯¼è‡´æœåŠ¡å™¨ç”¨ RST æ•°æ®åŒ…è¿›è¡Œåº”ç­”ã€‚å½“å‘æ¥æ”¶ RST çš„ socket å‘é€æ›´å¤šå­—èŠ‚æ—¶ï¼Œè¯¥socketå°†è¿”å›broken pipeã€‚è¿™å°±æ˜¯å®¢æˆ·æœºå‘æœåŠ¡å™¨å‘é€æœ€åä¸€ä¸ªå­—èŠ‚æ—¶å‘ç”Ÿçš„æƒ…å†µã€‚\nç»è¿‡æµ‹è¯•: å‘ä¸€ä¸ªå·²ç»å…³é—­çš„socket å†™å…¥æ•°æ®ï¼Œ(æ— è®ºbuffer æ˜¯å¦å†™æ»¡) éƒ½ä¼šå‡ºç°ç¬¬ä¸€æ¬¡è¿”å›RSTï¼Œ ç¬¬äºŒæ¬¡å†™å…¥å‡ºç°broken pipe error, è¯»çš„è¯æ˜¯EOF\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 package main import ( \u0026#34;errors\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net\u0026#34; \u0026#34;os\u0026#34; \u0026#34;syscall\u0026#34; \u0026#34;time\u0026#34; ) func server() { listener, err := net.Listen(\u0026#34;tcp\u0026#34;, \u0026#34;:8080\u0026#34;) if err != nil { log.Fatal(err) } defer listener.Close() conn, err := listener.Accept() if err != nil { log.Fatal(\u0026#34;server\u0026#34;, err) os.Exit(1) } data := make([]byte, 1) if _, err := conn.Read(data); err != nil { log.Fatal(\u0026#34;server\u0026#34;, err) } conn.Close() } func client() { conn, err := net.Dial(\u0026#34;tcp\u0026#34;, \u0026#34;localhost:8080\u0026#34;) if err != nil { log.Fatal(\u0026#34;client\u0026#34;, err) } // write to make the connection closed on the server side if _, err := conn.Write([]byte(\u0026#34;a\u0026#34;)); err != nil { log.Printf(\u0026#34;client: %v\u0026#34;, err) } time.Sleep(1 * time.Second) // write to generate an RST packet if _, err := conn.Write([]byte(\u0026#34;b\u0026#34;)); err != nil { log.Printf(\u0026#34;client: %v\u0026#34;, err) } time.Sleep(1 * time.Second) // write to generate the broken pipe error if _, err := conn.Write([]byte(\u0026#34;c\u0026#34;)); err != nil { log.Printf(\u0026#34;client: %v\u0026#34;, err) if errors.Is(err, syscall.EPIPE) { log.Print(\u0026#34;This is broken pipe error\u0026#34;) } } } func main() { go server() time.Sleep(3 * time.Second) // wait for server to run client() } connection reset by peer è§¦å‘åŸå› : å¦‚æœæœåŠ¡å™¨ç”¨socketæ¥æ”¶ç¼“å†²åŒºä¸­å‰©ä½™çš„å­—èŠ‚å…³é—­è¿æ¥ï¼Œé‚£ä¹ˆå°†å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª RST æ•°æ®åŒ…ã€‚å½“å®¢æˆ·ç«¯å°è¯•ä»è¿™æ ·ä¸€ä¸ªå…³é—­çš„è¿æ¥ä¸­è¯»å–æ—¶ï¼Œå®ƒå°†é€šè¿‡å¯¹ç­‰é”™è¯¯è·å¾—è¿æ¥é‡ç½®ã€‚\nç»è¿‡æµ‹è¯•: å½“å‘ä¸€ä¸ªå†™æ»¡äº†ç¼“å†²åŒºï¼Œå¹¶å…³é—­çš„socket è¿›è¡Œread æˆ–è€…write æ“ä½œéƒ½ä¼šå¯¼è‡´connection reset by peer\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 package main import ( \u0026#34;errors\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net\u0026#34; \u0026#34;os\u0026#34; \u0026#34;syscall\u0026#34; \u0026#34;time\u0026#34; ) func server() { listener, err := net.Listen(\u0026#34;tcp\u0026#34;, \u0026#34;:8080\u0026#34;) if err != nil { log.Fatal(err) } defer listener.Close() conn, err := listener.Accept() if err != nil { log.Fatal(\u0026#34;server\u0026#34;, err) os.Exit(1) } data := make([]byte, 2) if _, err := conn.Read(data); err != nil { log.Fatal(\u0026#34;server\u0026#34;, err) } conn.Close() } func client() { conn, err := net.Dial(\u0026#34;tcp\u0026#34;, \u0026#34;localhost:8080\u0026#34;) if err != nil { log.Fatal(\u0026#34;client\u0026#34;, err) } if _, err := conn.Write([]byte(\u0026#34;abc\u0026#34;)); err != nil { log.Printf(\u0026#34;client: %v\u0026#34;, err) } time.Sleep(1 * time.Second) // wait for close on the server side // ä¸‹é¢çš„æ“ä½œç¬¬ä¸€æ¬¡read /write éƒ½ä¼š å‡ºç°ECONNRESET reset by peer // ç¬¬äºŒæ¬¡çš„è¯»åˆ™æ˜¯EOFï¼Œ å¦‚æœæ˜¯å†™åˆ™æ˜¯`write: broken pipe` // if _, err := conn.Write([]byte(\u0026#34;ab\u0026#34;)); err != nil { // log.Printf(\u0026#34;client: %v\u0026#34;, err) // } data := make([]byte, 1) if _, err := conn.Read(data); err != nil { log.Printf(\u0026#34;client: %v\u0026#34;, err) if errors.Is(err, syscall.ECONNRESET) { log.Print(\u0026#34;This is connection reset by peer error\u0026#34;) } } } func main() { go server() time.Sleep(3 * time.Second) // wait for server to run client() } ","permalink":"https://reid00.github.io/en/posts/langs_linux/gin-error-connection-write-broken-pipe/","summary":"ç®€ä»‹ æœ€è¿‘ä½¿ç”¨Gin æ¡†æ¶å†™æ¥å£ï¼Œæ€»æ˜¯ä¼šå‡ºç°ä¸€äº›write: connection reset by peer æˆ–è€… write: broken pipe çš„é”™è¯¯, åœ¨æŸ¥è¯¢èµ„æ–™çš„æ—¶å€™ï¼Œå‘ç°TCPçš„ä¸‹é¢çš„æƒ…å†µå¯ä»¥è§¦å‘ä¸€ä¸‹ä¸¤ç§é”™è¯¯ã€‚ å¦å¤–Gin çš„å‡ºç°è¿™ä¸ªé”™è¯¯çš„åŸå› è¿™è¾¹æœ‰ä¸ªåˆ†æGin-RST å¤§æ¦‚åŸå› å°±æ˜¯DB è¿æ¥æ± å¤ªå°ï¼Œæœ‰å¤§é‡è¯·æ±‚æ’é˜Ÿç­‰å¾…ç©ºé—²é“¾æ¥ï¼Œæ’é˜Ÿæ—¶é—´è¶Šé•¿ç§¯å‹çš„è¯·æ±‚è¶Šå¤šï¼Œè¯·æ±‚å¤„ç†è€—æ—¶è¶Šå¤§ï¼Œç›´åˆ°ç§¯å‹è¯·æ±‚å¤ªå¤šæŠŠå¥æŸ„æ‰“æ»¡ï¼Œå‡ºç°äº†æ­»é”ã€‚\nwrite: broken pipe è§¦å‘åŸå› :\næœåŠ¡å™¨æ¥æ”¶ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å­—èŠ‚å¹¶å…³é—­è¿æ¥ã€‚å·²å…³é—­çš„æœåŠ¡ç«¯ åœ¨æ”¶åˆ° å®¢æˆ·ç«¯çš„ä¸‹ä¸€ä¸ªå­—èŠ‚å†™å…¥ å°†å¯¼è‡´æœåŠ¡å™¨ç”¨ RST æ•°æ®åŒ…è¿›è¡Œåº”ç­”ã€‚å½“å‘æ¥æ”¶ RST çš„ socket å‘é€æ›´å¤šå­—èŠ‚æ—¶ï¼Œè¯¥socketå°†è¿”å›broken pipeã€‚è¿™å°±æ˜¯å®¢æˆ·æœºå‘æœåŠ¡å™¨å‘é€æœ€åä¸€ä¸ªå­—èŠ‚æ—¶å‘ç”Ÿçš„æƒ…å†µã€‚\nç»è¿‡æµ‹è¯•: å‘ä¸€ä¸ªå·²ç»å…³é—­çš„socket å†™å…¥æ•°æ®ï¼Œ(æ— è®ºbuffer æ˜¯å¦å†™æ»¡) éƒ½ä¼šå‡ºç°ç¬¬ä¸€æ¬¡è¿”å›RSTï¼Œ ç¬¬äºŒæ¬¡å†™å…¥å‡ºç°broken pipe error, è¯»çš„è¯æ˜¯EOF\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 package main import ( \u0026#34;errors\u0026#34; \u0026#34;log\u0026#34; \u0026#34;net\u0026#34; \u0026#34;os\u0026#34; \u0026#34;syscall\u0026#34; \u0026#34;time\u0026#34; ) func server() { listener, err := net.","title":"Gin Error Connection Write Broken Pipe"},{"content":"ç®€ä»‹ æ€»ä½“ä¸Šæ¥è¯´ï¼ŒSparkçš„æµç¨‹å’ŒMapReduceçš„æ€æƒ³å¾ˆç±»ä¼¼ï¼Œåªæ˜¯å®ç°çš„ç»†èŠ‚æ–¹é¢ä¼šæœ‰å¾ˆå¤šå·®å¼‚ã€‚ é¦–å…ˆæ¾„æ¸…2ä¸ªå®¹æ˜“è¢«æ··æ·†çš„æ¦‚å¿µï¼š\nSparkæ˜¯åŸºäºå†…å­˜è®¡ç®—çš„æ¡†æ¶ Sparkæ¯”Hadoopå¿«100å€ ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ä¸ªä¼ªå‘½é¢˜ã€‚ ä»»ä½•ç¨‹åºéƒ½éœ€è¦é€šè¿‡å†…å­˜æ¥æ‰§è¡Œï¼Œä¸è®ºæ˜¯å•æœºç¨‹åºè¿˜æ˜¯åˆ†å¸ƒå¼ç¨‹åºã€‚ Sparkä¼šè¢«ç§°ä¸º åŸºäºå†…å­˜è®¡ç®—çš„æ¡†æ¶ ï¼Œä¸»è¦åŸå› åœ¨äºå…¶å’Œä¹‹å‰çš„åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶å¾ˆå¤§ä¸åŒçš„ä¸€ç‚¹æ˜¯ï¼ŒShuffleçš„æ•°æ®é›†ä¸éœ€è¦é€šè¿‡è¯»å†™ç£ç›˜æ¥è¿›è¡Œäº¤æ¢ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡å†…å­˜äº¤æ¢æ•°æ®å¾—åˆ°ã€‚æ•ˆç‡æ¯”è¯»å†™ç£ç›˜çš„MapReduceé«˜ä¸Šå¥½å¤šå€ï¼Œæ‰€ä»¥å¾ˆå¤šäººç§°ä¹‹ä¸º åŸºäºå†…å­˜çš„è®¡ç®—æ¡†æ¶ï¼Œå…¶å®æ›´åº”è¯¥ç§°ä¸º åŸºäºå†…å­˜è¿›è¡Œæ•°æ®äº¤æ¢çš„è®¡ç®—æ¡†æ¶ã€‚\nè‡³äºç¬¬äºŒä¸ªé—®é¢˜ï¼Œæœ‰åŒå­¦è¯´ï¼ŒSparkå®˜ç½‘ å°±æ˜¯è¿™ä¹ˆä»‹ç»çš„å‘€ï¼ŒSpark run workloads 100x faster than Hadoopã€‚\nè¿™ç‚¹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯è¯·æ³¨æ„å®˜ç½‘ç”¨æ¥æ¯”è¾ƒçš„ workload æ˜¯ Logistic regresstionã€‚ æ³¨æ„åˆ°äº†å—ï¼Œè¿™æ˜¯ä¸€ä¸ªéœ€è¦åå¤è¿­ä»£è®¡ç®—çš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼ŒSparkæ˜¯éå¸¸æ“…é•¿åœ¨è¿™ç§éœ€è¦åå¤è¿­ä»£è®¡ç®—çš„åœºæ™¯ä¸­ï¼ˆè§é—®é¢˜1ï¼‰ï¼Œè€ŒHadoop MapReduceæ¯æ¬¡è¿­ä»£éƒ½éœ€è¦è¯»å†™ä¸€æ¬¡HDFSã€‚ä»¥å·±ä¹‹é•¿ï¼Œå‡»äººä¹‹çŸ­ å·®è·å¯å‘è€ŒçŸ¥ã€‚\nå¦‚æœéƒ½åªæ˜¯è·‘ä¸€ä¸ªç®€å•çš„è¿‡æ»¤åœºæ™¯çš„ workloadï¼Œé‚£ä¹ˆæ€§èƒ½å·®è·ä¸ä¼šæœ‰è¿™ä¹ˆå¤šï¼Œæ€»ä½“ä¸Šæ˜¯ä¸€ä¸ªçº§åˆ«çš„è€—æ—¶ã€‚\næ‰€ä»¥åƒä¸‡ä¸è¦åœ¨ä»»ä½•åœºæ™¯ä¸­éƒ½è¯´ Sparkæ˜¯åŸºäºå†…å­˜çš„è®¡ç®—ã€Sparkæ¯”Hadoopå¿«100å€ï¼Œè¿™éƒ½æ˜¯ä¸ä¸¥è°¨çš„è¯´æ³•ã€‚\né€»è¾‘æ‰§è¡Œå›¾ 1. å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›† RDDæ˜¯Sparkä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼Œç›´è¯‘è¿‡æ¥å«åš å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ã€‚\næ‰€æœ‰çš„RDDè¦ä¹ˆæ˜¯ä»å¤–éƒ¨æ•°æ®æºåˆ›å»ºçš„ï¼Œè¦ä¹ˆæ˜¯ä»å…¶ä»–RDDè½¬æ¢è¿‡æ¥çš„ã€‚RDDæœ‰ä¸¤ç§äº§ç”Ÿæ–¹å¼ï¼š\nä»å¤–éƒ¨æ•°æ®æºä¸­åˆ›å»º ä»ä¸€ä¸ªRDDä¸­è½¬æ¢è€Œæ¥ ä½ å¯ä»¥æŠŠå®ƒå½“åšä¸€ä¸ªListï¼Œä½†æ˜¯è¿™ä¸ªListé‡Œé¢çš„å…ƒç´ æ˜¯åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ä¸Šçš„ï¼Œå¯¹Listçš„æ‰€æœ‰æ“ä½œéƒ½å°†è¢«åˆ†å‘åˆ°ä¸åŒçš„æœºå™¨ä¸Šæ‰§è¡Œã€‚ RDDå°±æ˜¯æˆ‘ä»¬éœ€è¦æ“ä½œçš„æ•°æ®é›†ï¼Œå¹¶è§£å†³äº† æ•°æ®åœ¨å“ªå„¿ è¿™ä¸ªé—®é¢˜ã€‚ æœ‰äº†æ•°æ®ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰åœ¨æ•°æ®é›†ä¸Šçš„æ“ä½œï¼ˆå³ä¸šåŠ¡é€»è¾‘ï¼‰ã€‚ å›æƒ³ä¸€ä¸‹æˆ‘ä»¬ä¹‹å‰ç»å†çš„æµç¨‹ï¼š\nä¸€å¼€å§‹æˆ‘ä»¬ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œåªæœ‰åˆ†æ•£åœ¨å„ä¸ªæœåŠ¡å™¨ä¸Šçš„æ—¥å¿—æ•°æ®ï¼Œå¹¶ä¸”é€šè¿‡ä¸€ä¸ªç®€å•çš„è„šæœ¬éå†è¿æ¥æœåŠ¡å™¨ï¼Œæ‰§è¡Œç›¸å…³çš„ç»Ÿè®¡é€»è¾‘ æˆ‘ä»¬æ¥è§¦äº†MapReduceè®¡ç®—æ¡†æ¶ï¼Œå¹¶å®šä¹‰äº†Mapå’ŒReduceçš„å‡½æ•°æ¥å£æ¥å®ç°è®¡ç®—é€»è¾‘ï¼Œä»è€Œç”¨æˆ·ä¸æ¯”å…³å¿ƒè®¡ç®—é€»è¾‘æ‹†åˆ†ä¸åˆ†å‘ç­‰åº•å±‚é—®é¢˜ è™½ç„¶MapReduceå·²ç»è§£å†³äº†æˆ‘ä»¬åˆ†å¸ƒå¼è®¡ç®—çš„éœ€æ±‚ï¼Œä½†æ˜¯å…¶ç¼–ç¨‹èŒƒå¼åªæœ‰mapå’Œreduceä¸¤ä¸ªæ¥å£ï¼Œä½¿ç”¨ä¸çµæ´»ã€‚\nåœ¨Sparkä¸­ï¼ŒRDDæä¾›äº†æ¯”MapReduceç¼–ç¨‹æ¨¡å‹ä¸°å¯Œå¾—å¤šçš„ç¼–ç¨‹æ¥å£ï¼Œå¦‚ï¼šfilterã€mapã€groupByç­‰éƒ½å¯ä»¥ç›´æ¥è°ƒç”¨å®ç°ï¼ˆè¿™äº›æ“ä½œæœ¬è´¨ä¸Šä¹Ÿåˆ’åˆ†ä¸ºMapå’ŒReduceä¸¤ç§ç±»å‹ï¼‰ã€‚\nç°åœ¨ï¼Œç»Ÿè®¡PVçš„ä¾‹å­ä¸­å®ç°è®¡ç®—é€»è¾‘çš„ä¼ªä»£ç å¯ä»¥è¿™ä¹ˆå†™ï¼š\n1 2 3 4 5 6 7 8 9 10 // ä»å¤–éƒ¨æ•°æ®æºä¸­åˆ›å»ºRDDï¼Œå³è¯»å–æ—¥å¿—æ•°æ® val rdd = sc.textFile(\u0026#34;...\u0026#34;) // è§£ææ—¥å¿—ä¸­çš„ip rdd.map(...) // æ ¹æ®ipåˆ†ç»„ .groupBy(\u0026#34;ip\u0026#34;) // æ ¹æ®åˆ†ç»„ç»“æœç»Ÿè®¡æ•°é‡ .map(x=\u0026gt; (x._1, x._2.size)) // ä¿å­˜åˆ°å¤–éƒ¨æ•°æ®æº .saveAsTextFile(\u0026#34;...\u0026#34;) åœ¨RDDè¿›è¡Œæ“ä½œè¡Œä¸ºå¯ä»¥åˆ’åˆ†ä¸ºä¸¤ç§ï¼š\nTransformationï¼šå¦‚filterã€mapã€groupByç­‰ï¼Œå°†ä¼šäº§ç”Ÿå¦å¤–ä¸€ä¸ªRDD Actionï¼šå¦‚countã€saveAsTextFileç­‰ï¼Œè§¦å‘æ•´ä¸ªé€»è¾‘å›¾çš„è®¡ç®—æµç¨‹ ä¸€ä¸ªSparkç¨‹åºå¯ä»¥çœ‹åšæ˜¯ ä¸€ä¸ªæˆ–è€…å¤šä¸ªRDDçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼Œä»è¯ç”Ÿåˆ°å‘å±•ï¼Œåˆ°å˜æ¢ï¼Œå†åˆ°è¾“å‡ºä¹‹åé”€æ¯ã€‚ 2. ä¾èµ–å…³ç³» ç°åœ¨ä½ å¯èƒ½ä¼šé—®ï¼Œä½¿ç”¨MapReduceï¼Œé€šè¿‡æŒ‡å®šæ•°æ®æºå®šä¹‰äº†æ“ä½œæ•°æ®é›†ï¼Œé€šè¿‡Mapå’ŒReduceä¸¤ä¸ªå‡½æ•°æ¥å£åˆ’åˆ†äº† èƒ½å¤Ÿåˆ†å‘åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šå¹¶è¡Œæ‰§è¡Œçš„ å’Œ éœ€è¦ç»è¿‡ä¸€å®šé‡çš„ç»“æœåˆå¹¶ä¹‹åæ‰èƒ½å¤Ÿç»§ç»­æ‰§è¡Œçš„ ä¸¤ç§ä»»åŠ¡ï¼Œå¹¶åŸºäºè¿™ä¸¤ç§æ¥å£ç±»å‹çš„ä»»åŠ¡å»æ‹†åˆ†å’Œåˆ†å‘è®¡ç®—é€»è¾‘ã€‚\né‚£ä¹ˆSparkä¸­æ˜¯å¦‚ä½•åšçš„å‘¢ï¼Ÿ\nSparkä¸­é€šè¿‡RDDå®šä¹‰äº† åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œé€šè¿‡RDDçš„ç¼–ç¨‹æ¥å£å®šä¹‰äº†è®¡ç®—é€»è¾‘ï¼Œä½†æ˜¯Sparkæ˜¯å¦‚ä½•æ ¹æ®RDDä¸­å®šä¹‰çš„é€»è¾‘æ¥åˆ’åˆ† èƒ½å¤Ÿåˆ†å‘åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šå¹¶è¡Œæ‰§è¡Œçš„ å’Œ éœ€è¦ç»è¿‡ä¸€å®šé‡çš„ç»“æœåˆå¹¶ä¹‹åæ‰èƒ½å¤Ÿç»§ç»­æ‰§è¡Œçš„ ä»»åŠ¡ï¼Œä»è€Œå®ç°è®¡ç®—é€»è¾‘çš„æ‹†åˆ†å’Œåˆ†å‘å‘¢ï¼Ÿ\nå…¶å®å’ŒMapReduceä¸€æ ·ï¼ŒSparkä¸­è™½ç„¶æä¾›äº†ä¸°å¯Œçš„ç®—å­ç»™ç”¨æˆ·å®ç°è®¡ç®—é€»è¾‘ï¼Œä½†æ˜¯è¿™äº›ç®—å­æœ€ç»ˆä»ç„¶ä¼šè¢«å½’ä¸ºä¸¤ç±»ï¼šMapå’ŒReduceã€‚\nå‰é¢æˆ‘ä»¬è¯´è¿‡ï¼Œåœ¨RDDä¸Šæ‰§è¡ŒTransformationæ“ä½œä¼šäº§ç”Ÿå¦å¤–ä¸€ä¸ªRDDï¼Œéšå³ï¼ŒRDDä¹‹é—´å°†ä¼šäº§ç”Ÿä¾èµ–å…³ç³»å’Œçˆ¶å­RDDå…³ç³»ã€‚\nè€ŒRDDä¸­çš„ä¾èµ–å…³ç³»åˆ†ä¸ºä¸¤ç§ï¼š\n1ã€å®Œå…¨ä¾èµ–ï¼šåˆç§°ä¸ºçª„ä¾èµ–ï¼Œçˆ¶RDDä¸­ä¸€ä¸ªåˆ†åŒºçš„æ•°æ®åªè¢«å­RDDä¸­å¯¹åº”çš„ä¸€ä¸ªåˆ†åŒºä½¿ç”¨ï¼ˆ1å¯¹1ï¼‰ 2ã€éƒ¨åˆ†ä¾èµ–ï¼šåˆç§°ä¸ºå®½ä¾èµ–ï¼Œçˆ¶RDDä¸­ä¸€ä¸ªåˆ†åŒºçš„æ•°æ®ä¼šè¢«å­RDDä¸­å¯¹åº”çš„å¤šä¸ªåˆ†åŒºä½¿ç”¨ï¼ˆ1å¯¹å¤š or å¤šå¯¹å¤šï¼‰\nçœ‹åˆ°äº†å—ï¼Œæœ€åRDDé€šè¿‡ä¾èµ–å…³ç³»åˆå›åˆ°äº†æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„è¯é¢˜ï¼šèƒ½å¤Ÿåˆ†å‘åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šå¹¶è¡Œæ‰§è¡Œçš„ å’Œ éœ€è¦ç»è¿‡ä¸€å®šé‡çš„ç»“æœåˆå¹¶ä¹‹åæ‰èƒ½å¤Ÿç»§ç»­æ‰§è¡Œçš„ ä¸¤ç§ä»»åŠ¡ã€‚\nå¯¹äºå®Œå…¨ä¾èµ–æ¥è¯´ï¼Œå„ä¸ªåˆ†åŒºä¹‹é—´çš„ä»»åŠ¡æ˜¯äº’ä¸å½±å“çš„ï¼Œæ‰€ä»¥å…¶èƒ½å¤Ÿå‘åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šå¹¶è¡Œæ‰§è¡Œã€‚\nå¯¹äºéƒ¨åˆ†ä¾èµ–æ¥è¯´ï¼Œå­RDDçš„æŸä¸ªåˆ†åŒºå¯èƒ½ä¾èµ–äºçˆ¶RDDçš„å¤šä¸ªåˆ†åŒºï¼Œæ‰€ä»¥å…¶éœ€è¦ç»è¿‡ä¸€å®šé‡çš„ç»“æœåˆå¹¶ï¼ˆä¾èµ–çš„æ‰€æœ‰çˆ¶RDDåˆ†åŒºï¼‰ä¹‹åæ‰èƒ½å¤Ÿç»§ç»­æ‰§è¡Œã€‚\nå®šä¹‰äº†è¿™ä¸¤ç§ç±»å‹çš„ä»»åŠ¡ä¹‹åï¼ŒSparkå°±å¯ä»¥æ ¹æ®ä¾èµ–å…³ç³»è¿›è¡Œ è®¡ç®—é€»è¾‘çš„æ‹†åˆ†ä¸åˆ†å‘ ã€‚\né‚£ä¹ˆRDDä¸Šçš„å“ªäº›æ“ä½œæ˜¯å®½ä¾èµ–ï¼Œå“ªäº›æ“ä½œæ˜¯çª„ä¾èµ–å‘¢ï¼Ÿ\nå…¶å®ä»”ç»†æƒ³æƒ³å¾ˆå¥½åŒºåˆ†ï¼Œå¯¹äºmapã€filterè¿™ç§ä¸éœ€è¦Shuffleçš„æ“ä½œéƒ½æ˜¯çª„ä¾èµ–ï¼Œè€ŒgroupByã€reduceByç­‰éœ€è¦Shuffleèšåˆçš„æ“ä½œéƒ½æ˜¯å®½ä¾èµ–ã€‚\né€šè¿‡Transformationæ“ä½œï¼ŒRDDä¹‹é—´å°†ä¼šäº§ç”Ÿä¾èµ–å…³ç³»ï¼ŒåŸºäºRDDä¸Šçš„æ“ä½œä¸ä¾èµ–å…³ç³» å°†ä¼šå½¢æˆä¸€å¼ é€»è¾‘æ‰§è¡Œå›¾ æ¥æè¿°æœ¬æ¬¡ä»»åŠ¡çš„è®¡ç®—è¿‡ç¨‹ã€‚\nä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ\nåœ¨RDDä¸Šè¿›è¡Œçš„Transformationæ“ä½œéƒ½æ˜¯æƒ°æ€§æ‰§è¡Œçš„ï¼Œæ„æ€å°±æ˜¯åªæœ‰æ•°æ®çœŸæ­£ç”¨åˆ°çš„æ—¶å€™ï¼ˆActionæ“ä½œï¼‰æ‰ä¼šè¿›è¡ŒTransformationæ“ä½œã€‚\nä¾‹å¦‚ä»¥ä¸‹RDDçš„æ“ä½œï¼š\n1 2 3 4 //rdd1åªä¿ç•™äº†ä»rddä¸­è®¡ç®—è€Œæ¥çš„è·¯å¾„ï¼Œæ²¡æœ‰çœŸæ­£æ‰§è¡Œè®¡ç®— val rdd1 = rdd.map.map.filter.map //ç›´åˆ°æœ‰actionæ“ä½œæ‰ä¼šè§¦å‘è®¡ç®—ä»»åŠ¡ rdd1.count ä¹Ÿå°±æ˜¯è¯´ï¼Œcountä¹‹å‰ï¼Œæˆ‘ä»¬å†™çš„è®¡ç®—é€»è¾‘å…¶å®åªæ˜¯åœ¨ ç”»ä¸€ä¸ªé€»è¾‘å›¾ï¼Œåªæœ‰çœŸæ­£ä½¿ç”¨åˆ°äº†countçš„æ—¶å€™ï¼Œæ•´ä¸ªé€»è¾‘å›¾æ‰ä¼šè¢«è§¦å‘å¹¶æ‰§è¡Œè®¡ç®—é€»è¾‘ã€‚\nè¿™ä¹ˆåšçš„åŸå› è¦å½’å’åˆ°RDDçš„è®¡ç®—æ¨¡å‹ï¼Œå½“rddä¸­å‡ºç°actionæ“ä½œçš„æ—¶å€™ï¼Œsparkå°†ä¼šç”Ÿæˆä¸€ä¸ªjobï¼Œå¹¶æ ¹æ®rddçš„ä¾èµ–å…³ç³»ç”»å‡ºä¸€å¼ é€»è¾‘æ‰§è¡Œå›¾ã€‚\nè´¹åŠ²å¿ƒæœºç”»å‡ºäº†é€»è¾‘å›¾ä¹‹åå†åˆ’åˆ†ç‰©ç†å›¾æ—¶å°†ä¼šæœ‰æœ€å…³é”®çš„ä½œç”¨ã€‚\n3.ç‰©ç†æ‰§è¡Œå›¾ ä»RDDä¸Šå¾—åˆ°é€»è¾‘æ‰§è¡Œå›¾ä¹‹åï¼Œæ‰§è¡Œè®¡ç®—ä»»åŠ¡å‰æœŸçš„å‡†å¤‡å·¥ä½œå°±éƒ½å®Œæˆäº†ï¼Œç°åœ¨æˆ‘ä»¬æ¥è¯¦ç»†è®¨è®ºä¸€ä¸‹Sparkæ˜¯å¦‚ä½• æ‹†åˆ†ã€åˆ†å‘è®¡ç®—é€»è¾‘çš„ã€‚\nSparkå°†ä¼šåˆ’åˆ†é€»è¾‘å›¾ä»è€Œç”Ÿæˆç‰©ç†æ‰§è¡Œå›¾ï¼Œè¡¨ç°å½¢å¼ä¸º DAGæœ‰å‘æ— ç¯å›¾ï¼ŒRDDçš„æ‰§è¡Œæ¨¡å‹å°†æ ¹æ®ç‰©ç†å›¾çš„åˆ’åˆ†è€Œå±•å¼€ã€‚\nç°åœ¨æˆ‘ä»¬çŸ¥é“ï¼ŒåŸºäºé€»è¾‘æ‰§è¡Œå›¾ï¼Œç”±äºRDDä¹‹é—´çš„ä¾èµ–å…³ç³»è¢«æ˜æ˜¾çš„åˆ’åˆ†ä¸ºäº†ä¸¤ç§ï¼š\nå¯¹äºå®Œå…¨ä¾èµ–çª„ä¾èµ–ï¼Œå¯ä»¥å®Œå…¨ä¸ç®¡å…¶ä»–RDDæˆ–è€…å…¶ä»–åˆ†åŒºçš„æ‰§è¡Œè¿›åº¦ï¼Œç›´æ¥ä¸€æ¡èµ°åˆ°åº•çš„ å¯¹äºéƒ¨åˆ†ä¾èµ–å®½ä¾èµ–ï¼Œéœ€è¦çˆ¶RDDä¸åŒåˆ†åŒºä¸­çš„æ•°æ®ï¼Œæ‰€ä»¥ä»– ä¸€å®šæ˜¯ç­‰åˆ°æ‰€æœ‰çˆ¶RDDè®¡ç®—å®Œæ¯•ä¹‹åæ‰ä¼šæ‰§è¡Œçš„ åŸºäºé€»è¾‘æ‰§è¡Œå›¾å’Œå¯¹åº”çš„ä¾èµ–å…³ç³»ï¼ŒSparkå¯ä»¥æ˜æ˜¾çš„ åˆ’åˆ†å‡ºStageï¼š\nä»é€»è¾‘å›¾çš„æœ€åæ–¹å¼€å§‹åˆ›å»ºStage é‡åˆ°å®Œå…¨ä¾èµ–åˆ™åŠ å…¥å½“å‰Stage é‡åˆ°éƒ¨åˆ†ä¾èµ–åˆ™æ–°å»ºä¸€ä¸ªStage ç”±æ­¤å¯¹æ•´ä¸ªé€»è¾‘å›¾è¿›è¡ŒStageçš„åˆ’åˆ†ã€‚è¿™å°±æ˜¯Sparkå¯¹äºè®¡ç®—é€»è¾‘çš„ç»„ç»‡å’Œæ‹†åˆ†æ–¹å¼ã€‚\né‚£ä¹ˆè¿™ä¹ˆåšæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ\nåŸºäºStageçš„ç‹¬ç«‹æ€§ï¼ŒSparkå®ç°äº† Pipelineçš„è®¡ç®—æ–¹å¼ã€‚ä¸”ç”±äº Stageå†…éƒ¨çš„æ“ä½œåªæœ‰å®Œå…¨ä¾èµ–ï¼Œå®ƒå¯ä»¥æ¯«æ— é¡¾å¿Œçš„å»ºç«‹ å›æº¯æœºåˆ¶ï¼šå½“ä¸€ä¸ªåˆ†åŒºæ•°æ®è®¡ç®—å¤±è´¥æˆ–è€…ä¸¢å¤±ï¼Œå¯ä»¥ç›´æ¥ä»çˆ¶RDDå¯¹åº”çš„åˆ†åŒºä¸­æ¢å¤ï¼Œè€Œä¸æ˜¯é‡æ–°è®¡ç®—æ•´ä¸ªçˆ¶RDDã€‚\nå¦‚æœæ‰€æœ‰æ“ä½œéƒ½æ˜¯ç«‹å³æ‰§è¡Œçš„è¯ï¼Œé‚£ä¹ˆå¤„ç†æµç¨‹åº”è¯¥æ˜¯è¿™æ ·å­çš„ï¼š\n1 2 3 4 5 6 7 8 //è¯»å–æ•°æ® list1 = readAllFromHDFS //å°†æ‰€æœ‰æ•°æ®è¿›è¡Œå¯¹åº”çš„mapè½¬æ¢æ“ä½œ list2 = list1.map //å°†æ‰€æœ‰æ•°æ®è¿›è¡Œå¯¹åº”çš„mapè½¬æ¢æ“ä½œ list3 = list2.map //å°†æ‰€æœ‰æ•°æ®è¿›è¡Œå¯¹åº”çš„filterè¿‡æ»¤æ“ä½œ list4 = list3.filter æ³¨æ„ï¼Œè¿™ç§æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªæ­¥éª¤éƒ½éœ€è¦å°† å…¨é‡çš„æ•°æ®é›†åŠ è½½åˆ°å†…å­˜ä¸­æ“ä½œ è¿™æ˜¯æ¯‹åº¸ç½®ç–‘çš„ï¼Œæ¯ä¸ªæ“ä½œéƒ½è¦ç­‰å¾…å‰ä¸€ä¸ªæ“ä½œå…¨éƒ¨å¤„ç†å®Œæ¯•ã€‚\nä½œä¸ºå¯¹æ¯”ï¼Œæˆ‘ä»¬å†æ¥çœ‹Pipelineçš„è®¡ç®—æ¨¡å¼ï¼š\n1 2 3 4 //è¯»å–æ•°æ® data = readOneLineFromHDFS //è¯»å–ä¸€æ¡å¤„ç†ä¸€æ¡ï¼Œæ¯æ¡æ•°æ®ç»è¿‡ç®¡é“æ‰§è¡Œåˆ°æœ«ç«¯ data.map.map.filter æ•°æ®æ˜¯ä½œä¸ºæµä¸€æ¡æ¡ä»ç®¡é“çš„å¼€å§‹ä¸€è·¯èµ°åˆ°ç»“æŸï¼Œæ¯ä¸ªStageéƒ½æ˜¯ä¸€æ¡ç‹¬ç«‹çš„ç®¡é“ã€‚æœ€ä¸ºç›´è§‚çš„å¥½å¤„å°±æ˜¯ï¼šä¸éœ€è¦åŠ è½½å…¨é‡æ•°æ®é›†ï¼Œä¸Šä¸€æ¬¡çš„è®¡ç®—ç»“æœå¯ä»¥é©¬ä¸Šä¸¢å¼ƒã€‚\nå…¨é‡æ•°æ®é›†å…¶å®æ˜¯ä¸€ä¸ªå¾ˆææ€–çš„ä¸œè¥¿ï¼Œå…¨ä¸–ç•Œéƒ½åœ¨é¿å…å®ƒã€‚æ‰€ä»¥æŸç§æ„ä¹‰ä¸Šæ¥çœ‹ï¼Œå¦‚æœæ²¡æœ‰Shuffleè¿‡ç¨‹ï¼ŒSparkæ‰€éœ€è¦å†…å­˜å…¶å®éå¸¸å°ï¼Œä¸€æ¡æ•°æ®åˆèƒ½å å¤šå¤§ç©ºé—´ã€‚\nç¬¬äºŒï¼Œå¦‚æœä¸æ˜¯Pipelineçš„æ–¹å¼ï¼Œè€Œæ˜¯é©¬ä¸Šè§¦å‘å…¨é‡æ“ä½œï¼ŒåŠ¿å¿…éœ€è¦ä¸€ä¸ªä¸­é—´å®¹å™¨æ¥ä¿å­˜ç»“æœï¼Œå…¶å®è¿™é‡Œå°±åˆå›åˆ°MapReduceçš„è€è·¯ï¼Œæ•ˆç‡å¾ˆä½ã€‚\nç°åœ¨æˆ‘ä»¬æ¥è€ƒè™‘ ä¸æ ¹æ®RDDçš„ä¾èµ–å…³ç³»æ¥åˆ’åˆ†Stageçš„å‰æä¸‹ï¼Œä¸¤ç§æ¯”è¾ƒæç«¯çš„æƒ…å†µï¼š 1ã€æ•´ä¸ªé€»è¾‘å›¾ä½œä¸ºä¸€ä¸ªStage\nä¸€ä¸ªJobåªåŒ…å«ä¸€ä¸ªStageï¼Œæ•°æ®ä¸€è·¯ä»å¤´èµ°åˆ°å°¾ï¼Œä»€ä¹ˆä¸­é—´ç»“æœéƒ½ä¸éœ€è¦ä¿å­˜ å¦‚æœRDDä¹‹é—´éƒ½æ˜¯ å®Œå…¨ä¾èµ– çš„è¯è¿™æ˜¯æœ€å®Œç¾çš„åœºæ™¯ ç¼ºé™·ï¼š åœ¨Shuffleæ“ä½œç¬¦å¤„ï¼ˆå³éƒ¨åˆ†ä¾èµ–çš„äº§ç”Ÿå¤„ï¼‰ï¼Œåªèƒ½é€šè¿‡ä¸€ä¸ªTaskæ¥å¤„ç†æ‰€æœ‰åˆ†åŒºçš„æ•°æ® å¤šä¸ªTaskæƒ…å†µä¸‹æ²¡æœ‰åŠæ³•å„è‡ªæ„ŸçŸ¥Shuffleè¿‡ç¨‹ä¸­æ‰€éœ€è¦çš„æ•°æ®çŠ¶æ€ ä¸¥é‡å½±å“è®¡ç®—æ•ˆç‡ 2ã€æ¯ä¸ªRDDçš„æ“ä½œéƒ½ä½œä¸ºä¸€ä¸ªStage\nå„ä¸ªæ“ä½œéƒ½éœ€è¦è¿›è¡Œå…¨é‡è®¡ç®—ï¼Œå…¶å®å°±ç›¸å½“äºMapReduce ç¼ºé™·ï¼šä¸¥é‡å½±å“è®¡ç®—æ•ˆç‡ å¯ä»¥çœ‹åˆ°ï¼ŒSparké€šè¿‡RDDä¹‹é—´çš„ä¾èµ–å…³ç³»æ¥åˆ’åˆ†é€»è¾‘æ‰§è¡Œå›¾å½¢æˆä¸€ä¸ªä¸ªç‹¬ç«‹çš„Stageï¼Œå¹¶é€šè¿‡Stageæ¥å®ç°Pipelineçš„è®¡ç®—æ¨¡å¼ã€‚\nè®¡ç®—é€»è¾‘æ‹†åˆ†åï¼Œé€šè¿‡Pipelineçš„æ‰§è¡Œå°†è®¡ç®—é€»è¾‘åˆ†å‘åˆ°å„ä¸ªèŠ‚ç‚¹ï¼Œå¹¶æœ€å¤§ç¨‹åº¦ä¿è¯è®¡ç®—çš„æ•ˆç‡ã€‚\nç»¼ä¸Šï¼ŒåŸºäºé€»è¾‘æ‰§è¡Œå›¾èƒ½åšçš„äº‹æƒ…æœ‰ï¼š 1ã€åˆ’åˆ†Stage 2ã€æ‰§è¡ŒPipeline 3ã€å»ºç«‹å›æº¯æœºåˆ¶\næ ¹æ®RDDä¹‹é—´çš„ä¾èµ–å…³ç³»æ¥åˆ’åˆ†Stageè§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š 1ã€å®ç°Pipelineï¼Œä¸éœ€è¦ä¿ç•™ä¸­é—´è®¡ç®—ç»“æœ 2ã€è®¡ç®—ä¿æŒé«˜æ•ˆï¼ŒTaskåˆ†å¸ƒå‡è¡¡\nè‡³æ­¤ï¼ŒSparkä¸»è¦çš„ è®¡ç®—é€»è¾‘æ‹†åˆ†ä¸åˆ†å‘ æ­¥éª¤å¤§æ¦‚ä»‹ç»å®Œæ¯•ã€‚\nä¸ä¹‹ç›¸å¯¹çš„ï¼Œä¸€æ®µSparkä»£ç ï¼Œæˆ–è€…ä¸€ä¸ªSparkç¨‹åºï¼Œè¿è¡Œèµ·æ¥ä¹‹åæ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œä»£ç æ˜¯å¦‚ä½•è¢«è°ƒåº¦æ‰§è¡Œçš„ï¼Œåº”è¯¥åœ¨å¼€å‘çš„é˜¶æ®µå°±èƒ½åœ¨è„‘å­é‡Œå½¢æˆä¸€ä¸ªæ‰§è¡Œå›¾ã€‚\nå……åˆ†äº†è§£ç¨‹åºè¿è¡Œçš„èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆæ˜¯ä¿è¯ç³»ç»Ÿç¨³å®šé«˜æ•ˆè¿è¡Œçš„å…³é”®ï¼Œè¿™ç‚¹æ”¾åœ¨å“ªé‡Œéƒ½æ˜¯çœŸç†ã€‚\nShuffleè¿‡ç¨‹ä¸ç®¡ç† 1. Shuffleæ€»è§ˆ å’Œä¹‹å‰çœ‹åˆ°çš„MapReduce Shuffleè¿‡ç¨‹ç›¸å¯¹æ¯”ã€‚äºŒè€…åœ¨é«˜çº§åˆ«ä¸Šæ¥çœ‹åˆ«æ²¡æœ‰å¤šå¤§åŒºåˆ«ï¼Œéƒ½æ˜¯å°†mapperä¸­çš„æ•°æ®è¿›è¡Œpartitionä¹‹åé€åˆ°ä¸åŒçš„reducerä¸­ï¼Œreducerä»¥å†…å­˜ä¸ºç¼“å­˜è¾¹æ‹‰å–æ•°æ®è¾¹è®¡ç®—ã€‚\nä½†æ˜¯åœ¨å…·ä½“å®ç°çš„ä½çº§åˆ«è§’åº¦ä¸Šä¸¤è€…åŒºåˆ«è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼ŒMapReduceé˜¶æ®µåˆ’åˆ†æ˜æ˜¾ï¼ŒSparkä¸­æ²¡æœ‰æ˜æ˜¾çš„åˆ’åˆ†ã€‚\nMapReduceä¸­çš„Mapperå³ä¸ºSparkä¸­çš„ ShuffleMapTaskï¼Œè€ŒReduceå¯¹åº”çš„å¯èƒ½æ˜¯ShuffleMapTaskæˆ–è€…ResultTaskã€‚\nSparkå„ä¸ªé˜¶æ®µé€šè¿‡RDDçš„ç®—å­ä½“ç°å‡ºæ¥ï¼Œå…·ä½“Shuffleè¿‡ç¨‹å¯ä»¥åˆ†ä¸ºï¼š\nShuffle Write Shuffle Read Writeè¿‡ç¨‹å…¶å®å¾ˆç®€å•ï¼Œæ ¹æ®ä¹‹å‰åˆ’åˆ†çš„Stageï¼Œæ¯ä¸ªStageçš„final taskçš„ç»“æœå°†ä¼šå†™ç£ç›˜ï¼Œå’ŒMapReduceä¸€æ ·ï¼Œæœ‰å¤šå°‘ä¸ªåˆ†åŒºæ•°å°±ä¼šå†™å¤šå°‘ä¸ªæ–‡ä»¶ã€‚\nåç»­çš„Stageå°†ä¼šé€šè¿‡ç½‘ç»œæ¥fatchå„è‡ªå¯¹åº”çš„æ•°æ®æ–‡ä»¶ã€‚\nReadè¿‡ç¨‹éœ€è¦è§£å†³å‡ ä¸ªé—®é¢˜ï¼š\nä»€ä¹ˆæ—¶å€™fetchæ•°æ®ï¼šä¾èµ–çš„stageä¸­æ‰€æœ‰ShuffleMapTaskéƒ½æ‰§è¡Œå®Œä¹‹åæ‰è¿›è¡Œfetchï¼Œè¿åˆpipelineçš„æ€æƒ³ ä½•è·å¾—æ•°æ®ä½ç½®ï¼šShuffleMapTaskç»“æŸä¹‹åéƒ½ä¼šæƒ³Driverç«¯æ±‡æŠ¥æ•°æ®å­˜æ”¾ä½ç½®ï¼ŒResultTaskfetchæ•°æ®æ—¶éƒ½ä¼šå‘DriveræŸ¥è¯¢éœ€è¦fetchçš„æ•°æ®åœ¨å“ªé‡Œï¼ŒDriverç«¯æœ‰æ¯”è¾ƒå¤æ‚çš„å®ç°æœºåˆ¶ fetchçš„æ•°æ®æ€ä¹ˆå­˜ï¼šåˆšfetchè¿‡æ¥çš„æ•°æ®å­˜æ”¾åœ¨softBufferä¸­ï¼Œè®¡ç®—ä¹‹åçš„æ•°æ®å¯ä»¥æ ¹æ®ç­–ç•¥é€‰æ‹©å­˜æ”¾åœ¨å†…å­˜æˆ–è€…å†…å­˜+ç£ç›˜ä¸­ å’Œfetchè¿‡ç¨‹çš„è®¡ç®—å’ŒMapReduceä¹Ÿä¸ä¸€æ ·ï¼š\nSparkï¼šè¾¹fetchè¾¹è®¡ç®—ï¼Œå› ä¸ºæ˜¯æ— åºçš„ï¼Œæ‰€æœ‰æ²¡æœ‰å¿…è¦è¦æ±‚æ‰€æœ‰æ•°æ®éƒ½è·å–ä¹‹åæ‰è¿›è¡Œè®¡ç®— MapReduceï¼šMapReduceä¸­å¼ºåˆ¶è¦æ±‚æ•°æ®æœ‰åºä¹‹åæ‰è¿›è¡Œreduceæ“ä½œï¼Œæ‰€ä»¥MapReduceæ˜¯ ä¸€æ¬¡æ€§fetchæ‰€æœ‰æ•°æ®ä¹‹åæ‰è®¡ç®— æ€»ç»“ä¸€ä¸‹ï¼Œä¸MapReduceç›¸æ¯”ï¼š\nHeight Levelï¼šæ— å¤ªå¤§åŒºåˆ«ï¼Œå°†mapperä¸­çš„æ•°æ®è¿›è¡Œpartitionä¹‹åé€åˆ°ä¸åŒçš„reducerä¸­ Low Levelï¼šå®ç°å·®åˆ«è¾ƒå¤§ï¼ŒMapReduceé˜¶æ®µåˆ’åˆ†æ˜æ˜¾ï¼ŒSparkä¸­æ²¡æœ‰æ˜æ˜¾çš„åˆ’åˆ† 2. Shuffle Manage Spark ä¸­è´Ÿè´£ Shuffle è¿‡ç¨‹ç®¡ç†çš„æ˜¯ ShuffleManagerï¼Œå®ƒæ¥ç®¡äº† Shuffle Readã€Shuffle Write è¿‡ç¨‹ä¸­çš„ æ‰§è¡Œã€è®¡ç®—å’Œå¤„ç† ç›¸å…³çš„å®ç°ç»†èŠ‚ã€‚\næ¯”å¦‚ Write è¿‡ç¨‹ä¸­æ€ä¹ˆç»„ç»‡æ•°æ®å†™å…¥ç£ç›˜ï¼ŒRead è¿‡ç¨‹ä¸­æ€ä¹ˆæ‹‰å–æ•°æ®å’Œä¿å­˜æ•°æ®ã€‚\nShuffleManager æ˜¯ä¸€ä¸ªæ¥å£ï¼Œä¸»è¦æœ‰ä¸¤ç§å®ç°ï¼š\nHashShuffleManagerï¼šSpark 1.2ä¹‹å‰é»˜è®¤ä½¿ç”¨ï¼Œä¼šäº§ç”Ÿå¤§é‡çš„ä¸­é—´ç£ç›˜æ–‡ä»¶ï¼Œè¿›è€Œç”±å¤§é‡çš„ç£ç›˜IOæ“ä½œå½±å“äº†æ€§èƒ½ã€‚ SortShuffleManagerï¼šæ¯ä¸ªTaskåœ¨è¿›è¡ŒShuffleæ“ä½œæ—¶ï¼Œè™½ç„¶ä¹Ÿä¼šäº§ç”Ÿè¾ƒå¤šçš„ä¸´æ—¶ç£ç›˜æ–‡ä»¶ï¼Œä½†æ˜¯æœ€åä¼šå°†æ‰€æœ‰çš„ä¸´æ—¶æ–‡ä»¶åˆå¹¶ï¼ˆmergeï¼‰æˆä¸€ä¸ªç£ç›˜æ–‡ä»¶ï¼Œå› æ­¤æ¯ä¸ªTaskå°±åªæœ‰ä¸€ä¸ªç£ç›˜æ–‡ä»¶ã€‚åœ¨ä¸‹ä¸€ä¸ªstageçš„Shuffle read taskæ‹‰å–è‡ªå·±çš„æ•°æ®æ—¶ï¼Œåªè¦æ ¹æ®ç´¢å¼•è¯»å–æ¯ä¸ªç£ç›˜æ–‡ä»¶ä¸­çš„éƒ¨åˆ†æ•°æ®å³å¯ã€‚ HashShuffleManager ä¸ºäº†ç®€å•çš„è¯´æ˜ï¼Œè¿™é‡Œå‡è®¾æˆ‘ä»¬çš„ Executor å¯ç”¨çš„CPUæ ¸å¿ƒæ•°åªæœ‰ä¸€ä¸ªï¼Œæ— è®º Executor ä¸Šæœ‰åˆ†é…äº†å¤šå°‘ä¸ªTaskï¼ŒåŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªTaskã€‚\nåœ¨ Shuffle Write é˜¶æ®µï¼ŒExecutor çš„åœ¨ä¾æ¬¡æ‰§è¡Œæ¯ä¸ªTaskæ—¶ï¼ŒHashShuffleManager éƒ½ä¼šå¯¹Task ä¸­çš„æ‰€æœ‰æ•°æ®çš„keyæ‰§è¡Œç›¸åº”çš„hashè¿ç®—ï¼Œhashçš„å‚æ•°æ˜¯ä¸‹æ¸¸Stageçš„ Taskæ•°é‡ã€‚é€šè¿‡è¿™hashæ˜ å°„ä¹‹åï¼Œæ¯ä¸ªkeyéƒ½ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„ç»“æœå€¼ï¼Œæ ¹æ®hashçš„ç»“æœå€¼æ¥å†™æ–‡ä»¶ï¼ˆè¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šç»è¿‡ä¸€æ®µå†…å­˜çš„ç¼“å†²åŒºï¼Œç¼“å†²åŒºæ»¡äº†ä¹‹åå†™å…¥ç£ç›˜ï¼‰ï¼Œç›¸åŒç»“æœçš„æ•°æ®å†™åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚\nè¿™æ ·ä¸€æ¥ï¼Œä¸Šæ¸¸æ¯ä¸ªTaskä¸­ï¼Œéƒ½ä¼šæ ¹æ®ä¸‹æ¸¸Stageçš„Taskæ•°é‡ äº§ç”Ÿå¯¹åº”æ•°é‡çš„æ–‡ä»¶ï¼Œç›¸åŒkeyçš„æ•°æ®è‚¯å®šåœ¨åŒä¸€ä»½æ–‡ä»¶ä¸­ï¼Œä¸€ä»½æ–‡ä»¶ä¸­å¯èƒ½ä¼šæœ‰å¤šä¸ªkeyçš„æ•°æ®ã€‚ä¸‹æ¸¸stageè®¡ç®—æ•°æ®æ—¶ï¼Œåªéœ€è¦æ‹‰å–è¿™ä¸ªæ–‡ä»¶çš„æ‰€æœ‰æ•°æ®å³å¯è¿›è¡Œè®¡ç®—ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼šè¾¹æ‹‰å–è¾¹è®¡ç®—ï¼Œæ¯ä¸ªTaskä¹Ÿä¼šæœ‰è‡ªå·±çš„ç¼“å†²åŒºï¼Œæ¯æ¬¡åªå–bufferå¤§å°çš„æ•°æ®é€šè¿‡å†…å­˜ä¸­çš„Mapè¿›è¡Œèšåˆï¼Œåå¤æ“ä½œç›´è‡³æ•°æ®è·å–å®Œæ¯•ã€‚\nä¹ˆæè¿°å¤§å®¶å¯èƒ½è¿˜ä¼šè§‰å¾—åˆæƒ…åˆç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»äº§ç”Ÿçš„æ€»æ–‡ä»¶æ•°çš„è§’åº¦æ¥çœ‹å‘¢ï¼Ÿ\nå‡è®¾å½“å‰Stageæœ‰200ä¸ªTaskéœ€è¦æ‰§è¡Œï¼Œä¸‹æ¸¸Stageæœ‰100ä¸ªTaskï¼ŒæŒ‰ç…§æˆ‘ä»¬åˆšåˆšæè¿°çš„è¿‡ç¨‹æ¥çœ‹ï¼Œäº§ç”Ÿçš„æ€»æ–‡ä»¶æ•°ä¸ºï¼š200 * 100 = 20000 ä¸ªã€‚\nè¿™æ˜¯ä¸€ä¸ªéå¸¸æƒŠäººçš„æ•°å­—ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ ç£ç›˜çš„IO ä¸€ç›´æ˜¯ç¨‹åºæ‰§è¡Œçš„ç“¶é¢ˆä¹‹ä¸€ï¼Œæˆ‘ä»¬åœ¨æ‰§è¡Œç¨‹åºçš„æ—¶å€™éƒ½ä¼šå°½å¯èƒ½çš„é¿å…å†™ç£ç›˜æ“ä½œã€‚è€Œç°åœ¨ï¼Œä¸€ä¸ª Shuffle Write è¿‡ç¨‹å°±ä¼šäº§ç”Ÿæˆåƒä¸Šä¸‡ä¸ªæ–‡ä»¶ï¼Œæ³¨å®šäº†è¿™ä¸ªç¨‹åºä¸ä¼šå¿«åˆ°å“ªé‡Œå»ã€‚\nå·¥ä½œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š é‚£ä¹ˆæœ‰æ²¡æœ‰ä¼˜åŒ–æ–¹å¼å‘¢ï¼Ÿè‚¯å®šæ˜¯æœ‰çš„ã€‚\nåœ¨ä½¿ç”¨ HashShuffleManager çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªå‚æ•° spark.Shuffle.consolidateFiles è¯¥å‚æ•°é»˜è®¤å€¼ä¸ºfalseï¼Œå°†å…¶è®¾ç½®ä¸ºtrueå³å¯å¼€å¯ä¼˜åŒ–æœºåˆ¶ã€‚å¼ºçƒˆå»ºè®®è®¾ç½®ä¸ºtrueï¼Œä¸ºå•¥å‘¢ï¼Ÿæˆ‘ä»¬æ¥è§£é‡Šè§£é‡Šã€‚\nconsolidateæœºåˆ¶æœ€é‡è¦çš„åŠŸèƒ½å°±æ˜¯ åŒä¸€ä¸ªCPU å…è®¸ä¸åŒçš„taskå¤ç”¨åŒä¸€æ‰¹ç£ç›˜æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆå°†å¤šä¸ªtaskçš„ç£ç›˜æ–‡ä»¶è¿›è¡Œä¸€å®šç¨‹åº¦ä¸Šçš„åˆå¹¶ï¼Œä»è€Œå¤§å¹…åº¦å‡å°‘ç£ç›˜æ–‡ä»¶çš„æ•°é‡ï¼Œè¿›è€Œæå‡Shuffle writeçš„æ€§èƒ½ã€‚\nä¹‹å‰çš„æµç¨‹ä¸­ï¼Œæ¯ä¸ªTaskéƒ½ä¼šåˆ›å»ºnä¸ªæ–‡ä»¶ï¼ŒTaskä¹‹é—´æ˜¯äº’ç›¸éš”ç¦»çš„ã€‚è€Œåœ¨ consolidateæœºåˆ¶ ä¸­Taskä¹‹é—´æ˜¯å¯ä»¥å¤ç”¨æ–‡ä»¶çš„ï¼Œå› ä¸ºåŒä¸€ä¸ªkeyçš„æ•°æ®å¯èƒ½æ˜¯åˆ†å¸ƒåœ¨ä¸åŒçš„Taskä¸Šå¤„ç†çš„ã€‚\nç®€å•æ¥è¯´ï¼Œå› ä¸ºTaskä¹‹é—´çš„æ•°æ®æ–‡ä»¶å¯ä»¥å¤ç”¨ï¼Œä¸€ä¸ªcpuæ ¸å¿ƒåªä¼šåˆ›å»ºå’Œä¸‹æ¸¸Stageçš„Taskæ•°é‡ä¸€æ ·å¤šçš„æ–‡ä»¶æ•°ï¼ŒåŒä¸€ä¸ªcpuæ ¸å¿ƒä¸­å¤„ç†çš„æ‰€æœ‰taskéƒ½ä¼šé‡å¤ä½¿ç”¨åŒä¸€æ‰¹æ–‡ä»¶ã€‚ æ€»ç»“ä¸º:\nconsolidate=falseï¼šæ–‡ä»¶æ•°é‡ç”± ä¸Šæ¸¸Stageä»»åŠ¡æ•°ï¼ˆä¸åŒçš„ä»»åŠ¡å¯èƒ½ä¼šè¢«åŒä¸€ä¸ªcpuå¤„ç†ï¼‰ * ä¸‹æ¸¸Stageä»»åŠ¡æ•° å†³å®š consolidate=trueï¼šæ–‡ä»¶æ•°é‡ç”± ä¸Šæ¸¸å¤„ç†ä»»åŠ¡çš„CPUæ ¸å¿ƒæ•°ï¼ˆä¸€ä¸ªcpuå¯èƒ½ä¼šå¤„ç†å¤šä¸ªä»»åŠ¡ï¼‰ * ä¸‹æ¸¸Stageä»»åŠ¡æ•° å†³å®š è¿˜æ˜¯æˆ‘ä»¬ä¹‹å‰ä¸¾çš„ä¾‹å­ï¼Œå‡è®¾å½“å‰Stageæœ‰200ä¸ªTaskéœ€è¦æ‰§è¡Œï¼Œä¸‹æ¸¸Stageæœ‰100ä¸ªTaskï¼Œå¦‚æœæ­¤æ—¶æˆ‘ä»¬æœ‰10ä¸ªExecutorï¼ˆæ¯ä¸ª1coreï¼‰ï¼Œé‚£ä¹ˆæ€»æ–‡ä»¶æ•°ä¸ºï¼š 10ï¼ˆcpuæ ¸å¿ƒæ•°ï¼‰* 100ï¼ˆä¸‹æ¸¸Taskæ•°é‡ï¼‰ = 200 ä¸ªã€‚\nç”±æ­¤å¯è§ï¼Œå½“å¼€å¯äº† consolidate æœºåˆ¶åï¼ŒExecutor çš„cpuæ ¸å¿ƒæ•°è¶Šå¤šï¼Œåœ¨æä¾›å¤„ç†å¹¶è¡Œåº¦çš„åŒæ—¶ï¼ŒShuffle Write äº§ç”Ÿçš„æ–‡ä»¶æ•°å°±è¶Šå¤šï¼Œè¿™ç‚¹éœ€è¦æ³¨æ„ã€‚\nShuffle Read é˜¶æ®µå¹¶æ²¡æœ‰å˜åŒ–ï¼Œéƒ½æ˜¯ç›´æ¥æ‹‰å–è‡ªå·±æ‰€éœ€è¦çš„é‚£ä»½æ•°æ®è¿›è¡Œè®¡ç®—ã€‚\nconsolidateæœºåˆ¶ä¸‹ï¼Œå·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š SortShuffleManager ç»è¿‡å‰é¢çš„ä»‹ç»ä¹‹åï¼Œæˆ‘ä»¬çŸ¥é“ä½¿ç”¨ HashShuffleManager æ—¶å¼€å¯consolidateæœºåˆ¶å¯ä»¥å‡å°‘å¾ˆå¤šæ–‡ä»¶çš„äº§ç”Ÿï¼Œæé«˜ Shuffle Write æ•ˆç‡ã€‚\næ— è®º consolidateæœºåˆ¶ æ˜¯å¦å¼€å¯ï¼ŒHashShuffleManager æ‰€äº§ç”Ÿçš„æ–‡ä»¶æ•°éƒ½ä¸ä¸‹æ¸¸Stageçš„Taskæ•°é‡æœ‰å…³ç³»ã€‚\nç°åœ¨æˆ‘ä»¬å†æ¥çœ‹å¦å¤–ä¸€ç§ Shuffleç®¡ç†æœºåˆ¶ï¼ŒSortShuffleManagerã€‚\né€šè¿‡ SortShuffleManager è¿™ä¸ªåå­—å¤§å®¶å¯ä»¥çŸ¥é“ï¼Œè¿™æ˜¯ä¸€ä¸ªæ’åºçš„Shuffleç®¡ç†å™¨ï¼ˆHashShuffleManagerä¸ºæ— åºï¼‰ã€‚\nShuffle Write çš„å…·ä½“æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š\næ¯ä¸ªTaskå°†Shuffleçš„æ•°æ®å†™å…¥è‡ªå·±çš„bufferå†…å­˜ç¼“å†²åŒºä¸­ï¼Œæ¯æ¡æ•°æ®å†™å…¥æ—¶éƒ½ä¼šåˆ¤æ–­æ˜¯å¦è¶…å‡ºé˜ˆå€¼ è¶…å‡ºä½¿ç”¨é˜ˆå€¼åˆ™è§¦å‘åˆ·å†™ï¼Œå°†æ•°æ®ä¸€æ‰¹æ‰¹çš„å†™å…¥ç£ç›˜ä¸­ å†™å…¥ç£ç›˜å‰ä¼šæ ¹æ®keyå¯¹å†…å­˜ä¸­çš„æ•°æ®è¿›è¡Œæ’åº æ’å®Œåºåçš„æ•°æ®æ ¹æ®æ‰¹æ¬¡å¤§å°ï¼ˆé»˜è®¤10000ï¼‰ä¾æ¬¡å†™å…¥ç£ç›˜ä¸­ Taskæ•°æ®å¤„ç†ç»“æŸåï¼Œå°†ä¹‹å‰åˆ·å†™çš„æ‰€æœ‰æ–‡ä»¶è¯»å–ï¼Œåˆå¹¶ä¹‹åé‡æ–°å†™å…¥ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­ å› ä¸ºä¸€ä¸ªTaskå¤„ç†çš„æ•°æ®å¯èƒ½å¯¹åº”ä¸‹æ¸¸å¤šä¸ªTaskéœ€è¦å¤„ç†çš„æ•°æ® æ‰€ä»¥æ­¤è¿‡ç¨‹ä¼šåˆ›å»ºç´¢å¼•æ–‡ä»¶æ ‡è®°ä¸‹æ¸¸å„ä¸ªTaskå¯¹åº”çš„æ•°æ®åœ¨æ–‡ä»¶ä¸­çš„start offsetä¸end offset ç”±äºéœ€è¦æ ‡è®°ä¸‹æ¸¸å„ä¸ªTaskæ‰€éœ€è¦çš„æ•°æ®åç§»é‡ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œsortæ’åºä¹‹åæ‰å¯å†™å…¥ ä»ä»¥ä¸Šè¿‡ç¨‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œå’Œ HashShuffleManager ä¸€æ · SortShuffleManager çš„æ¯ä¸ªTaskä¹Ÿä¼šåˆ›å»ºå¾ˆå¤šæ–‡ä»¶ï¼Œä¸åŒçš„æ˜¯ HashShuffleManager ä¸­æ¯ä¸ªTaskåˆ›å»ºçš„æ–‡ä»¶æ•°å’Œä¸‹æ¸¸çš„Stageä»»åŠ¡æ•°ä¸€è‡´ï¼Œè€Œ SortShuffleManager åˆ™æ˜¯ æŒ‰ç…§è‡ªå·±çš„bufferå†…å­˜ç©ºé—´å¤§å°åˆ·å†™çš„æ–‡ä»¶å—ï¼Œå¹¶ä¸”æœ€åè¿˜ä¼šåšä¸€æ¬¡å¤§åˆå¹¶ï¼Œä¸€ä¸ªTaskåªå¯¹åº”ä¸€ä¸ªæ–‡ä»¶ã€‚\næ–‡ä»¶æ•°é‡ç”± ä¸Šæ¸¸Stageçš„Taskæ•°é‡ å†³å®šã€‚ æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š é™¤æ­¤ä¹‹å¤–ï¼ŒSortShuffleManager è¿˜æœ‰å¦å¤–ä¸€ç§ bypass çš„æ‰§è¡Œæ¨¡å¼ã€‚\nå½“ Shuffle map taskæ•°é‡å°äº spark.Shuffle.sort.bypassMergeThreshold çš„å€¼ï¼Œä¸”ä¸æ˜¯èšåˆç±»çš„Shuffleç®—å­ï¼ˆæ¯”å¦‚reduceByKeyï¼‰ï¼Œæ¯”å¦‚ join ç­‰æ“ä½œæ—¶å°†ä¼šè§¦å‘ã€‚\næ­¤æ—¶taskä¼šä¸ºæ¯ä¸ªä¸‹æ¸¸taskéƒ½åˆ›å»ºä¸€ä¸ªä¸´æ—¶ç£ç›˜æ–‡ä»¶ï¼Œå¹¶å°†æ•°æ®æŒ‰keyè¿›è¡Œhashç„¶åæ ¹æ®keyçš„hashå€¼ï¼Œå°†keyå†™å…¥å¯¹åº”çš„ç£ç›˜æ–‡ä»¶ä¹‹ä¸­ã€‚å½“ç„¶ï¼Œå†™å…¥ç£ç›˜æ–‡ä»¶æ—¶ä¹Ÿæ˜¯å…ˆå†™å…¥å†…å­˜ç¼“å†²ï¼Œç¼“å†²å†™æ»¡ä¹‹åå†æº¢å†™åˆ°ç£ç›˜æ–‡ä»¶çš„ã€‚\næœ€åï¼ŒåŒæ ·ä¼šå°†æ‰€æœ‰ä¸´æ—¶ç£ç›˜æ–‡ä»¶éƒ½åˆå¹¶æˆä¸€ä¸ªç£ç›˜æ–‡ä»¶ï¼Œå¹¶ åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ç´¢å¼•æ–‡ä»¶ã€‚\nè¯¥è¿‡ç¨‹çš„ç£ç›˜å†™æœºåˆ¶å…¶å®è·Ÿæœªç»ä¼˜åŒ–çš„HashShuffleManageræ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œå› ä¸ºéƒ½è¦åˆ›å»ºæ•°é‡æƒŠäººçš„ç£ç›˜æ–‡ä»¶ï¼Œåªæ˜¯åœ¨æœ€åä¼šåšä¸€ä¸ªç£ç›˜æ–‡ä»¶çš„åˆå¹¶è€Œå·²ã€‚å› æ­¤å°‘é‡çš„æœ€ç»ˆç£ç›˜æ–‡ä»¶ï¼Œä¹Ÿè®©è¯¥æœºåˆ¶ç›¸å¯¹æœªç»ä¼˜åŒ–çš„HashShuffleManageræ¥è¯´ï¼ŒShuffle readçš„æ€§èƒ½ä¼šæ›´å¥½ã€‚\nè€Œè¯¥æœºåˆ¶ä¸æ™®é€šSortShuffleManagerè¿è¡Œæœºåˆ¶çš„ä¸åŒåœ¨äºï¼š\nç¬¬ä¸€ï¼Œç£ç›˜å†™æœºåˆ¶ä¸åŒï¼› ç¬¬äºŒï¼Œä¸ä¼šè¿›è¡Œæ’åºã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ç”¨è¯¥æœºåˆ¶çš„æœ€å¤§å¥½å¤„åœ¨äºï¼ŒShuffle writeè¿‡ç¨‹ä¸­ï¼Œä¸éœ€è¦è¿›è¡Œæ•°æ®çš„æ’åºæ“ä½œï¼Œä¹Ÿå°±èŠ‚çœæ‰äº†è¿™éƒ¨åˆ†çš„æ€§èƒ½å¼€é”€ã€‚\nå†…å­˜æ¨¡å— Sparkæ˜¯ç”¨Scalaå¼€å‘å®Œæˆçš„ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨JVMä½“ç³»ä¸Šçš„ç³»ç»Ÿæ€§æ¡†æ¶ï¼Œæ‰€ä»¥ Sparkçš„å†…å­˜æ¨¡å‹ä¹Ÿæ˜¯åŸºäºJavaè™šæ‹Ÿæœºæ¥çš„ã€‚\nåŸºæœ¬æ¨¡å‹å°±æ˜¯ï¼šå †ã€æ ˆã€é™æ€ä»£ç å—å’Œå…¨å±€ç©ºé—´ï¼Œåœ¨è™šæ‹Ÿæœºçš„å†…å­˜æ¨¡å‹ä¸ŠSparkå°†å†…å­˜åšäº†äºŒæ¬¡åˆ’åˆ†ã€‚\nä½œä¸ºä¸€ä¸ªä¸¥é‡ä¾èµ–å†…å­˜è¿›è¡Œæ•°æ®è®¡ç®—çš„ç³»ç»Ÿæ¥è¯´ï¼Œå†…å­˜ç®¡ç†æ¨¡å— æ˜¯Sparkä¸­æå…¶é‡è¦çš„ä¸€éƒ¨åˆ†ã€‚\n1. å†…å­˜åˆ’åˆ† ä»æ€§è´¨ä¸Šçœ‹ï¼ŒExecutor å¯ä½¿ç”¨çš„å†…å­˜ç©ºé—´åˆ†ä¸ºä¸¤ç§ï¼šå †å†…ã€å †å¤–ã€‚\nå †å†…å†…å­˜å³ç›´æ¥é€šè¿‡ spark.executor.memory æˆ–è€… -â€“executor-memory è®¾ç½®åˆ†é…å¾—åˆ°ï¼Œå±äºä¸€å®šä¼šæœ‰å€¼çš„å¼ºåˆ¶æ€§é…ç½®ã€‚\nè€Œå †å¤–å†…å­˜åˆ™æ˜¯ä¸€ç§å¯é€‰æ€§é…ç½®ï¼Œé»˜è®¤ä¸ä½¿ç”¨ï¼Œé€šè¿‡é…ç½® spark.memory.offHeap.enabled å‚æ•°å¯ç”¨ï¼Œç”± spark.memory.offHeap.size å‚æ•°è®¾å®šå †å¤–ç©ºé—´çš„å¤§å°ã€‚\nå †å¤–å†…å­˜å°†ä¼š å­˜å‚¨ç»è¿‡åºåˆ—åŒ–çš„äºŒè¿›åˆ¶æ•°æ®ã€‚ä¸€å®šç¨‹åº¦ä¸Šä¼šå‡å°‘ä¸å¿…è¦çš„å†…å­˜å¼€é”€ï¼Œä»¥åŠé¢‘ç¹çš„ GC æ‰«æå’Œå›æ”¶ï¼Œæå‡äº†å¤„ç†æ€§èƒ½ã€‚\nä»å†…å­˜åŒºåŸŸä¸Šçœ‹ï¼Œå†…å­˜å¤§è‡´å¯ä»¥åˆ’åˆ†ä¸ºä¸‰ä¸ªæ¨¡å—ï¼ˆå †å¤–å†…å­˜æ²¡æœ‰ Execution çš„ç©ºé—´ï¼‰ï¼š\nStorageï¼šRDDç¼“å­˜ã€Broadcastç­‰æ•°æ®ç©ºé—´ã€‚ Executionï¼šShuffleè¿‡ç¨‹ä½¿ç”¨çš„å†…å­˜ã€‚ Otherï¼šç”¨æˆ·å®šä¹‰çš„æ•°æ®ç»“æ„ã€Sparkå†…éƒ¨å…ƒæ•°æ®ç­‰å…¶ä»–å†…å­˜ç©ºé—´ã€‚ 2. å†…å­˜ç®¡ç† é™æ€å†…å­˜ç®¡ç† é™æ€å†…å­˜ç®¡ç†ä¸º Spark 1.6 ä¹‹å‰é»˜è®¤ä½¿ç”¨çš„ç®¡ç†æ–¹å¼ã€‚ å¿½ç•¥\nç»Ÿä¸€å†…å­˜ç®¡ç† åœ¨å†…å­˜ç»“æ„æ€»ä½“ä¸å˜çš„æƒ…å†µä¸‹ï¼ŒSpark 1.6 ä¹‹åå¼•å…¥äº†æ–°çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œç»Ÿä¸€å†…å­˜ç®¡ç†ã€‚ å’Œé™æ€å†…å­˜ç®¡ç†ç›¸æ¯”ï¼Œç»Ÿä¸€å†…å­˜ç®¡ç†ä¸»è¦çš„å˜åŒ–ç‚¹åœ¨äºï¼š\nå¢åŠ ç³»ç»Ÿé¢„ç•™çš„å†…å­˜ç©ºé—´ å„ä¸ªåŒºåŸŸåˆå§‹åˆ†é…çš„é»˜è®¤å€¼é‡æ–°è°ƒæ•´ Storageå’ŒExecutionä¸¤ä¸ªåŒºåŸŸä¹‹é—´ä¸å†æ˜¯å›ºå®šå¤§å°ï¼Œè€Œæ˜¯ åŠ¨æ€è°ƒèŠ‚ æ€»å †å†…å†…å­˜çš„åŸºç¡€ä¸Šï¼Œå…ˆæ‰£é™¤ ç»™ç³»ç»Ÿçš„é¢„ç•™ç©ºé—´ï¼ˆé»˜è®¤300Mï¼‰ï¼Œå‰©ä¸‹çš„ä¸ºå¯ç”¨å†…å­˜æ€»å¤§å°ã€‚\næ³¨æ„ï¼š spark.memory.storageFraction ç»Ÿä¸€å†…å­˜ç®¡ç†çš„å‚æ•° spark.storage.memoryFraction é™æ€å†…å­˜ç®¡ç†çš„å‚æ•° (deprecated) This is read only if spark.memory.useLegacyMode is enabled. Fraction of Java heap to use for Spark\u0026rsquo;s memory cache. This should not be larger than the \u0026ldquo;old\u0026rdquo; generation of objects in the JVM, which by default is given 0.6 of the heap, but you can increase it if you configure your own old generation size.\nåœ¨å¯ç”¨å†…å­˜æ€»å¤§å°çš„åŸºç¡€ä¸Šï¼Œåˆ’åˆ†ä¸¤å¤§å—ï¼š\nç»Ÿä¸€å†…å­˜ï¼ˆUnified Memoryï¼‰ï¼šStorageã€Executionå…±åŒä½¿ç”¨çš„å†…å­˜ï¼Œé»˜è®¤å€¼ 0.75ï¼ˆ2.0ä»¥åä¸º0.6ï¼‰ï¼Œç”± spark.memory.fraction æ§åˆ¶ Storageï¼šé»˜è®¤ä¸º0.5ï¼Œå ç»Ÿä¸€å†…å­˜çš„50%ï¼Œç”± spark.memory.storageFraction æ§åˆ¶ã€‚ä¸»è¦ç”¨äºå­˜å‚¨ spark çš„ cache æ•°æ®ï¼Œä¾‹å¦‚RDDçš„ç¼“å­˜ã€unrollæ•°æ®ï¼› Executionï¼šé»˜è®¤ä¸º0.5ï¼Œå ç»Ÿä¸€å†…å­˜çš„50%ï¼Œç­‰äº 1 - spark.memory.storageFractionã€‚ä¸»è¦ç”¨äºå­˜æ”¾ Shuffleã€Joinã€Sortã€Aggregation ç­‰è®¡ç®—è¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ•°æ®ï¼› ç”¨æˆ·å†…å­˜ï¼ˆUser Memoryï¼‰ï¼šé»˜è®¤ä¸º0.4ï¼Œå å¯ç”¨æ€»å†…å­˜çš„40%ï¼Œ ç­‰äº 1 - spark.memory.fractionã€‚ä¸»è¦ç”¨äºå­˜å‚¨ RDD è½¬æ¢æ“ä½œæ‰€éœ€è¦çš„æ•°æ®ï¼Œä¾‹å¦‚ RDD ä¾èµ–ç­‰ä¿¡æ¯ï¼› é¢„ç•™å†…å­˜ï¼ˆReserved Memoryï¼‰: ç³»ç»Ÿé¢„ç•™å†…å­˜ï¼Œä¼šç”¨æ¥å­˜å‚¨Sparkå†…éƒ¨å¯¹è±¡ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç»Ÿä¸€å†…å­˜ç®¡ç†ä¸­ï¼ŒStorageå’ŒExecutionè¢«åˆ’å…¥ä¸€å—å¤§å†…å­˜æ± ä¸­è¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚ è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼ŒStorageå’ŒExecution çš„å†…å­˜ç©ºé—´ç”¨æˆ·å¯ä»¥ä¸ç”¨è‡ªå·±é‚£ä¹ˆæ“å¿ƒå»ä¼˜åŒ–ã€è°ƒæ•´ã€‚ å½“æœ‰ä¸€æ–¹çš„å†…å­˜ä¸å¤Ÿç”¨æ—¶ï¼Œå°†ä¼šåˆ°å¦å¤–ä¸€æ–¹å»ã€Œå€Ÿã€ä¸€äº›å†…å­˜å›æ¥ç”¨ï¼Œè¾¾åˆ° åŠ¨æ€å†…å­˜åˆ†é…ä¸è°ƒæ•´ çš„æ•ˆæœã€‚\nåœ¨ Spark 1.6 ä¹‹åçš„ç‰ˆæœ¬ä¸­é»˜è®¤ä¸å†ä½¿ç”¨ é™æ€å†…å­˜ç®¡ç† çš„æ–¹å¼ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è®¾ç½® spark.memory.userLegacyMode çš„å€¼ï¼ˆtrue/falseï¼Œé»˜è®¤falseï¼‰æ¥é€‰æ‹©å†…å­˜ç®¡ç†æ–¹å¼ã€‚\nå…¶ä¸­æœ€é‡è¦çš„ä¼˜åŒ–åœ¨äºåŠ¨æ€å ç”¨æœºåˆ¶ï¼Œå…¶è§„åˆ™å¦‚ä¸‹ï¼š\nè®¾å®šåŸºæœ¬çš„å­˜å‚¨å†…å­˜å’Œæ‰§è¡Œå†…å­˜åŒºåŸŸï¼ˆspark.storage.storageFractionå‚æ•°ï¼‰ï¼Œè¯¥è®¾å®šç¡®å®šäº†åŒæ–¹å„è‡ªæ‹¥æœ‰çš„ç©ºé—´çš„èŒƒå›´ã€‚ åŒæ–¹çš„ç©ºé—´éƒ½ä¸è¶³æ—¶ï¼Œåˆ™å­˜å‚¨åˆ°ç¡¬ç›˜ï¼›è‹¥å·±æ–¹ç©ºé—´ä¸è¶³è€Œå¯¹æ–¹ç©ºä½™æ—¶ï¼Œå¯å€Ÿç”¨å¯¹æ–¹çš„ç©ºé—´;ï¼ˆå­˜å‚¨ç©ºé—´ä¸è¶³æ˜¯æŒ‡ä¸è¶³ä»¥æ”¾ä¸‹ä¸€ä¸ªå®Œæ•´çš„Blockï¼‰ã€‚ æ‰§è¡Œå†…å­˜çš„ç©ºé—´è¢«å¯¹æ–¹å ç”¨åï¼Œå¯è®©å¯¹æ–¹å°†å ç”¨çš„éƒ¨åˆ†è½¬å­˜åˆ°ç¡¬ç›˜ï¼Œç„¶åâ€œå½’è¿˜â€å€Ÿç”¨çš„ç©ºé—´ã€‚ å­˜å‚¨å†…å­˜çš„ç©ºé—´è¢«å¯¹æ–¹å ç”¨åï¼Œæ— æ³•è®©å¯¹æ–¹â€œå½’è¿˜â€ï¼Œå› ä¸ºéœ€è¦è€ƒè™‘Shuffleè¿‡ç¨‹ä¸­çš„å¾ˆå¤šå› ç´ ï¼Œå®ç°èµ·æ¥è¾ƒä¸ºå¤æ‚ã€‚ å‡­å€Ÿç»Ÿä¸€å†…å­˜ç®¡ç†æœºåˆ¶ï¼ŒSparkåœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜äº†å †å†…å’Œå †å¤–å†…å­˜èµ„æºçš„åˆ©ç”¨ç‡ï¼Œé™ä½äº†å¼€å‘è€…ç»´æŠ¤Sparkå†…å­˜çš„éš¾åº¦ï¼Œä½†å¹¶ä¸æ„å‘³ç€å¼€å‘è€…å¯ä»¥é«˜æ•æ— å¿§ã€‚ è­¬å¦‚ï¼Œæ‰€ä»¥å¦‚æœå­˜å‚¨å†…å­˜çš„ç©ºé—´å¤ªå¤§æˆ–è€…è¯´ç¼“å­˜çš„æ•°æ®è¿‡å¤šï¼Œåè€Œä¼šå¯¼è‡´é¢‘ç¹çš„å…¨é‡åƒåœ¾å›æ”¶ï¼Œé™ä½ä»»åŠ¡æ‰§è¡Œæ—¶çš„æ€§èƒ½ï¼Œå› ä¸ºç¼“å­˜çš„RDDæ•°æ®é€šå¸¸éƒ½æ˜¯é•¿æœŸé©»ç•™å†…å­˜çš„ã€‚æ‰€ä»¥è¦æƒ³å……åˆ†å‘æŒ¥Sparkçš„æ€§èƒ½ï¼Œéœ€è¦å¼€å‘è€…è¿›ä¸€æ­¥äº†è§£å­˜å‚¨å†…å­˜å’Œæ‰§è¡Œå†…å­˜å„è‡ªçš„ç®¡ç†æ–¹å¼å’Œå®ç°åŸç†ã€‚\nSparkæ€§èƒ½ä¼˜åŒ– 1. å¼€å‘è°ƒä¼˜ ä»£ç å¼€å‘ï¼Œæ˜¯æ‰§è¡ŒSparkä»»åŠ¡çš„ç¬¬ä¸€æ­¥ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¼˜åŒ–Sparkä»»åŠ¡çš„ç¬¬ä¸€ä¸ªå…¥æ‰‹ç‚¹ï¼Œè‰¯å¥½çš„ RDD lineageã€é«˜æ€§èƒ½çš„ç®—å­æ“ä½œã€ä¸åŒé«˜çº§ç‰¹æ€§çš„ç»„åˆä½¿ç”¨ï¼Œéƒ½èƒ½å¤Ÿç»™Sparkä»»åŠ¡å¸¦æ¥å·¨å¤§çš„æå‡ç©ºé—´ã€‚\nå¼€å‘å‡ºä¼˜ç§€çš„Sparkç¨‹åºï¼Œéœ€è¦ä½ ç†Ÿæ‚‰Sparkçš„å„ç§APIå’Œç‰¹æ€§ã€‚å…¶ä¸­æœ€é‡è¦çš„ä¸€ç‚¹æˆ‘ä»¬åœ¨é€»è¾‘æ‰§è¡Œå›¾å°èŠ‚ä¸­æåˆ°è¿‡ï¼šå¼€å‘Sparkç¨‹åºå…¶å®å°±æ˜¯åœ¨ç”»å›¾ã€‚\nå¦‚ä½•èƒ½å¤ŸæŠŠè¿™ä¸ªå›¾å¿«é€Ÿç”»å‡ºæ¥çš„åŒæ—¶è¿˜èƒ½ç”»å¥½çœ‹ï¼Œå°±æ˜¯ä½ éœ€è¦è€ƒè™‘çš„ï¼Œè¿™å°±æ˜¯è€ƒéªŒSparkå¼€å‘çš„åŸºæœ¬åŠŸã€‚\nRDDå¤ç”¨ å’Œå…¶ä»–ä»»ä½•ç¨‹åºä¸­ å˜é‡å¤ç”¨ ä¸€æ ·ï¼Œåœ¨Sparkç¨‹åºä¸­åˆ›å»ºå¹¶ä½¿ç”¨RDDä¹Ÿè¦è´¯å½»è¿™ä¸ªæ€æƒ³ã€‚\nåœ¨ç¼–ç çš„æ—¶å€™ï¼ŒRDDå’Œä»»ä½•å•æœºç¨‹åºä¸€æ ·ï¼Œæœ¬èº«åªæ˜¯ä½œä¸ºä¸€ä¸ªæ™®é€šçš„å˜é‡å¯¹è±¡å­˜åœ¨ï¼Œä¸åŒçš„æ˜¯å•æœºå˜é‡çš„åˆ›å»ºä¼šæ¶ˆè€—å†…å­˜ï¼Œè€ŒRDDçš„åˆ›å»ºä¼š æ¶ˆè€—ç£ç›˜ã€å†…å­˜ä¸ç®—åŠ›ç­‰æ›´å¤šæ–¹é¢çš„èµ„æºï¼ˆæƒ³æƒ³RDDåˆ›å»ºä¹‹åçš„ä½¿ç”¨è¿‡ç¨‹ï¼Œæ˜¯ä¸æ˜¯è¿™æ ·å‘¢ï¼‰ã€‚\næ‰€ä»¥è¦æŠŠRDDçš„åˆ›å»ºå’Œä½¿ç”¨å½“åšä¸€ä¸ª éœ€è¦æ¶ˆè€—é«˜æ˜‚è´¹ç”¨çš„åŠ¨ä½œ æ¥è°¨æ…ä½¿ç”¨ï¼Œä»ä»£ç çš„æºå¤´èŠ‚çº¦ä¸ä¼˜åŒ–ç¨‹åºç©ºé—´ä¸æ•ˆç‡ã€‚\næœ‰çš„åŒå­¦åœ¨å¼€å‘Sparkç¨‹åºçš„æ—¶å€™ï¼Œå¯èƒ½åœ¨ä¸šåŠ¡é€»è¾‘1åˆ›å»ºäº†ä¸€ä¸ªRDD1ï¼Œç»è¿‡å„ç§Transformationä»¥åŠæœ€åçš„Actionæ“ä½œä¹‹åï¼Œå¼€å§‹å¤„ç†ä¸šåŠ¡é€»è¾‘2ï¼Œåˆåœ¨ç›¸åŒçš„æ•°æ®æºä¸Šåˆ›å»ºäº†RDD2ï¼Œç„¶åç»§ç»­å†™ä¸šåŠ¡é€»è¾‘ä»£ç ã€‚\nä¸€èˆ¬æ¥è®²ï¼Œç›¸åŒçš„æ•°æ®æºçš„RDD åªå…è®¸åˆ›å»ºä¸€æ¬¡ï¼Œä¸è¦åˆ›å»ºç›¸åŒçš„RDDï¼Œä¿è¯ä»£ç çš„æ•´æ´æ€§ã€‚\nåœ¨RDDçš„lineageè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰å¤šä¸ªä¸šåŠ¡é‡å¤ä½¿ç”¨æŸä¸ªlineageçš„è®¡ç®—è¿‡ç¨‹ï¼Œåˆ™ åº”è¯¥å°†å…¶æŠ½å‡ºä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„ä¸­é—´RDDä½¿ç”¨ï¼Œå°½å¯èƒ½å¤ç”¨ç›¸åŒçš„RDDã€‚\næ— è®ºæ˜¯æ•°æ®æºRDDè¿˜æ˜¯ä¸­é—´RDDï¼Œå¦‚æœè¢«åå¤å¤šæ¬¡ä½¿ç”¨ï¼Œåˆ™åº”è¯¥è€ƒè™‘å°†å…¶åš ç¼“å­˜æŒä¹…åŒ–æ“ä½œã€‚\nå¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæ²¡æœ‰å¯¹ä¸šåŠ¡é€»è¾‘æœ‰æ¯”è¾ƒæ¸…æ™°çš„äº†è§£ï¼Œå¼€å‘äººå‘˜å¾ˆéš¾ä»ç¹æ‚çš„è®¡ç®—è¿‡ç¨‹ä¸­æå–å‡ºå¯ä»¥å¤ç”¨ç”šè‡³è¿›è¡Œç¼“å­˜æ“ä½œçš„ä»£ç å—ï¼Œæ— æ³•ä¼˜åŒ–åˆ°ç‚¹ã€‚\nå¦å¤–ï¼Œåœ¨è€ƒè™‘å¯¹RDDæŒä¹…åŒ–æ“ä½œæ—¶ï¼Œåº”è¯¥é’ˆå¯¹ å¯ç”¨ç¡¬ä»¶èµ„æºã€RDDæ•°æ®é‡ã€ç¨‹åºæ—¶æ•ˆæ€§ç­‰è¦æ±‚ é€‰æ‹©ä¸åŒçš„ç¼“å­˜ç­–ç•¥ï¼ˆè¯¦è§ã€Œå†…å­˜æ¨¡å—ã€å°èŠ‚ï¼‰ã€‚\næ€»ç»“ï¼š\nç›¸åŒçš„æ•°æ®æºçš„RDD åªå…è®¸åˆ›å»ºä¸€æ¬¡ å¤šä¸ªä¸šåŠ¡é€»è¾‘åå¤ä½¿ç”¨åŒä¸€ä¸ªlineage åº”è¯¥å°†å…¶æŠ½å‡ºä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„ä¸­é—´RDDä½¿ç”¨ ä»»ä½•è¢«å¤šæ¬¡é‡å¤ä½¿ç”¨çš„RDDåº”è¯¥è€ƒè™‘å°†å…¶åš ç¼“å­˜æŒä¹…åŒ–æ“ä½œ ä¾‹å­:\né¿å…åˆ›å»ºé‡å¤çš„RDD 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // éœ€è¦å¯¹åä¸ºâ€œhello.txtâ€çš„HDFSæ–‡ä»¶è¿›è¡Œä¸€æ¬¡mapæ“ä½œï¼Œå†è¿›è¡Œä¸€æ¬¡reduceæ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œéœ€è¦å¯¹ä¸€ä»½æ•°æ®æ‰§è¡Œä¸¤æ¬¡ç®—å­æ“ä½œã€‚ // é”™è¯¯çš„åšæ³•ï¼šå¯¹äºåŒä¸€ä»½æ•°æ®æ‰§è¡Œå¤šæ¬¡ç®—å­æ“ä½œæ—¶ï¼Œåˆ›å»ºå¤šä¸ªRDDã€‚ // è¿™é‡Œæ‰§è¡Œäº†ä¸¤æ¬¡textFileæ–¹æ³•ï¼Œé’ˆå¯¹åŒä¸€ä¸ªHDFSæ–‡ä»¶ï¼Œåˆ›å»ºäº†ä¸¤ä¸ªRDDå‡ºæ¥ï¼Œç„¶ååˆ†åˆ«å¯¹æ¯ä¸ªRDDéƒ½æ‰§è¡Œäº†ä¸€ä¸ªç®—å­æ“ä½œã€‚ // è¿™ç§æƒ…å†µä¸‹ï¼ŒSparkéœ€è¦ä»HDFSä¸Šä¸¤æ¬¡åŠ è½½hello.txtæ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶åˆ›å»ºä¸¤ä¸ªå•ç‹¬çš„RDDï¼›ç¬¬äºŒæ¬¡åŠ è½½HDFSæ–‡ä»¶ä»¥åŠåˆ›å»ºRDDçš„æ€§èƒ½å¼€é”€ï¼Œå¾ˆæ˜æ˜¾æ˜¯ç™½ç™½æµªè´¹æ‰çš„ã€‚ val rdd1 = sc.textFile(\u0026#34;hdfs://192.168.0.1:9000/hello.txt\u0026#34;) rdd1.map(...) val rdd2 = sc.textFile(\u0026#34;hdfs://192.168.0.1:9000/hello.txt\u0026#34;) rdd2.reduce(...) // æ­£ç¡®çš„ç”¨æ³•ï¼šå¯¹äºä¸€ä»½æ•°æ®æ‰§è¡Œå¤šæ¬¡ç®—å­æ“ä½œæ—¶ï¼Œåªä½¿ç”¨ä¸€ä¸ªRDDã€‚ // è¿™ç§å†™æ³•å¾ˆæ˜æ˜¾æ¯”ä¸Šä¸€ç§å†™æ³•è¦å¥½å¤šäº†ï¼Œå› ä¸ºæˆ‘ä»¬å¯¹äºåŒä¸€ä»½æ•°æ®åªåˆ›å»ºäº†ä¸€ä¸ªRDDï¼Œç„¶åå¯¹è¿™ä¸€ä¸ªRDDæ‰§è¡Œäº†å¤šæ¬¡ç®—å­æ“ä½œã€‚ // ä½†æ˜¯è¦æ³¨æ„åˆ°è¿™é‡Œä¸ºæ­¢ä¼˜åŒ–è¿˜æ²¡æœ‰ç»“æŸï¼Œç”±äºrdd1è¢«æ‰§è¡Œäº†ä¸¤æ¬¡ç®—å­æ“ä½œï¼Œç¬¬äºŒæ¬¡æ‰§è¡Œreduceæ“ä½œçš„æ—¶å€™ï¼Œè¿˜ä¼šå†æ¬¡ä»æºå¤´å¤„é‡æ–°è®¡ç®—ä¸€æ¬¡rdd1çš„æ•°æ®ï¼Œå› æ­¤è¿˜æ˜¯ä¼šæœ‰é‡å¤è®¡ç®—çš„æ€§èƒ½å¼€é”€ã€‚ // è¦å½»åº•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¿…é¡»ç»“åˆâ€œåŸåˆ™ä¸‰ï¼šå¯¹å¤šæ¬¡ä½¿ç”¨çš„RDDè¿›è¡ŒæŒä¹…åŒ–â€ï¼Œæ‰èƒ½ä¿è¯ä¸€ä¸ªRDDè¢«å¤šæ¬¡ä½¿ç”¨æ—¶åªè¢«è®¡ç®—ä¸€æ¬¡ã€‚ val rdd1 = sc.textFile(\u0026#34;hdfs://192.168.0.1:9000/hello.txt\u0026#34;) rdd1.map(...) rdd1.reduce(...) å°½å¯èƒ½å¤ç”¨åŒä¸€ä¸ªRDD 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // é”™è¯¯çš„åšæ³•ã€‚ // æœ‰ä¸€ä¸ª\u0026lt;Long, String\u0026gt;æ ¼å¼çš„RDDï¼Œå³rdd1ã€‚ // æ¥ç€ç”±äºä¸šåŠ¡éœ€è¦ï¼Œå¯¹rdd1æ‰§è¡Œäº†ä¸€ä¸ªmapæ“ä½œï¼Œåˆ›å»ºäº†ä¸€ä¸ªrdd2ï¼Œè€Œrdd2ä¸­çš„æ•°æ®ä»…ä»…æ˜¯rdd1ä¸­çš„valueå€¼è€Œå·²ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œrdd2æ˜¯rdd1çš„å­é›†ã€‚ JavaPairRDD\u0026lt;Long, String\u0026gt; rdd1 = ... JavaRDD\u0026lt;String\u0026gt; rdd2 = rdd1.map(...) // åˆ†åˆ«å¯¹rdd1å’Œrdd2æ‰§è¡Œäº†ä¸åŒçš„ç®—å­æ“ä½œã€‚ rdd1.reduceByKey(...) rdd2.map(...) // æ­£ç¡®çš„åšæ³•ã€‚ // ä¸Šé¢è¿™ä¸ªcaseä¸­ï¼Œå…¶å®rdd1å’Œrdd2çš„åŒºåˆ«æ— éå°±æ˜¯æ•°æ®æ ¼å¼ä¸åŒè€Œå·²ï¼Œrdd2çš„æ•°æ®å®Œå…¨å°±æ˜¯rdd1çš„å­é›†è€Œå·²ï¼Œå´åˆ›å»ºäº†ä¸¤ä¸ªrddï¼Œå¹¶å¯¹ä¸¤ä¸ªrddéƒ½æ‰§è¡Œäº†ä¸€æ¬¡ç®—å­æ“ä½œã€‚ // æ­¤æ—¶ä¼šå› ä¸ºå¯¹rdd1æ‰§è¡Œmapç®—å­æ¥åˆ›å»ºrdd2ï¼Œè€Œå¤šæ‰§è¡Œä¸€æ¬¡ç®—å­æ“ä½œï¼Œè¿›è€Œå¢åŠ æ€§èƒ½å¼€é”€ã€‚ // å…¶å®åœ¨è¿™ç§æƒ…å†µä¸‹å®Œå…¨å¯ä»¥å¤ç”¨åŒä¸€ä¸ªRDDã€‚ // æˆ‘ä»¬å¯ä»¥ä½¿ç”¨rdd1ï¼Œæ—¢åšreduceByKeyæ“ä½œï¼Œä¹Ÿåšmapæ“ä½œã€‚ // åœ¨è¿›è¡Œç¬¬äºŒä¸ªmapæ“ä½œæ—¶ï¼Œåªä½¿ç”¨æ¯ä¸ªæ•°æ®çš„tuple._2ï¼Œä¹Ÿå°±æ˜¯rdd1ä¸­çš„valueå€¼ï¼Œå³å¯ã€‚ JavaPairRDD\u0026lt;Long, String\u0026gt; rdd1 = ... rdd1.reduceByKey(...) rdd1.map(tuple._2...) // ç¬¬äºŒç§æ–¹å¼ç›¸è¾ƒäºç¬¬ä¸€ç§æ–¹å¼è€Œè¨€ï¼Œå¾ˆæ˜æ˜¾å‡å°‘äº†ä¸€æ¬¡rdd2çš„è®¡ç®—å¼€é”€ã€‚ // ä½†æ˜¯åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œä¼˜åŒ–è¿˜æ²¡æœ‰ç»“æŸï¼Œå¯¹rdd1æˆ‘ä»¬è¿˜æ˜¯æ‰§è¡Œäº†ä¸¤æ¬¡ç®—å­æ“ä½œï¼Œrdd1å®é™…ä¸Šè¿˜æ˜¯ä¼šè¢«è®¡ç®—ä¸¤æ¬¡ã€‚ // å› æ­¤è¿˜éœ€è¦é…åˆâ€œåŸåˆ™ä¸‰ï¼šå¯¹å¤šæ¬¡ä½¿ç”¨çš„RDDè¿›è¡ŒæŒä¹…åŒ–â€è¿›è¡Œä½¿ç”¨ï¼Œæ‰èƒ½ä¿è¯ä¸€ä¸ªRDDè¢«å¤šæ¬¡ä½¿ç”¨æ—¶åªè¢«è®¡ç®—ä¸€æ¬¡ã€‚ å¯¹å¤šæ¬¡ä½¿ç”¨çš„RDDè¿›è¡ŒæŒä¹…åŒ– 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // å¦‚æœè¦å¯¹ä¸€ä¸ªRDDè¿›è¡ŒæŒä¹…åŒ–ï¼Œåªè¦å¯¹è¿™ä¸ªRDDè°ƒç”¨cache()å’Œpersist()å³å¯ã€‚ // æ­£ç¡®çš„åšæ³•ã€‚ // cache()æ–¹æ³•è¡¨ç¤ºï¼šä½¿ç”¨éåºåˆ—åŒ–çš„æ–¹å¼å°†RDDä¸­çš„æ•°æ®å…¨éƒ¨å°è¯•æŒä¹…åŒ–åˆ°å†…å­˜ä¸­ã€‚ // æ­¤æ—¶å†å¯¹rdd1æ‰§è¡Œä¸¤æ¬¡ç®—å­æ“ä½œæ—¶ï¼Œåªæœ‰åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œmapç®—å­æ—¶ï¼Œæ‰ä¼šå°†è¿™ä¸ªrdd1ä»æºå¤´å¤„è®¡ç®—ä¸€æ¬¡ã€‚ // ç¬¬äºŒæ¬¡æ‰§è¡Œreduceç®—å­æ—¶ï¼Œå°±ä¼šç›´æ¥ä»å†…å­˜ä¸­æå–æ•°æ®è¿›è¡Œè®¡ç®—ï¼Œä¸ä¼šé‡å¤è®¡ç®—ä¸€ä¸ªrddã€‚ val rdd1 = sc.textFile(\u0026#34;hdfs://192.168.0.1:9000/hello.txt\u0026#34;).cache() rdd1.map(...) rdd1.reduce(...) // persist()æ–¹æ³•è¡¨ç¤ºï¼šæ‰‹åŠ¨é€‰æ‹©æŒä¹…åŒ–çº§åˆ«ï¼Œå¹¶ä½¿ç”¨æŒ‡å®šçš„æ–¹å¼è¿›è¡ŒæŒä¹…åŒ–ã€‚ // æ¯”å¦‚è¯´ï¼ŒStorageLevel.MEMORY_AND_DISK_SERè¡¨ç¤ºï¼Œå†…å­˜å……è¶³æ—¶ä¼˜å…ˆæŒä¹…åŒ–åˆ°å†…å­˜ä¸­ï¼Œå†…å­˜ä¸å……è¶³æ—¶æŒä¹…åŒ–åˆ°ç£ç›˜æ–‡ä»¶ä¸­ã€‚ // è€Œä¸”å…¶ä¸­çš„_SERåç¼€è¡¨ç¤ºï¼Œä½¿ç”¨åºåˆ—åŒ–çš„æ–¹å¼æ¥ä¿å­˜RDDæ•°æ®ï¼Œæ­¤æ—¶RDDä¸­çš„æ¯ä¸ªpartitionéƒ½ä¼šåºåˆ—åŒ–æˆä¸€ä¸ªå¤§çš„å­—èŠ‚æ•°ç»„ï¼Œç„¶åå†æŒä¹…åŒ–åˆ°å†…å­˜æˆ–ç£ç›˜ä¸­ã€‚ // åºåˆ—åŒ–çš„æ–¹å¼å¯ä»¥å‡å°‘æŒä¹…åŒ–çš„æ•°æ®å¯¹å†…å­˜/ç£ç›˜çš„å ç”¨é‡ï¼Œè¿›è€Œé¿å…å†…å­˜è¢«æŒä¹…åŒ–æ•°æ®å ç”¨è¿‡å¤šï¼Œä»è€Œå‘ç”Ÿé¢‘ç¹GCã€‚ val rdd1 = sc.textFile(\u0026#34;hdfs://192.168.0.1:9000/hello.txt\u0026#34;).persist(StorageLevel.MEMORY_AND_DISK_SER) rdd1.map(...) rdd1.reduce(...) å°½é‡é¿å…ä½¿ç”¨shuffleç±»ç®—å­ å¦‚æœæœ‰å¯èƒ½çš„è¯ï¼Œè¦å°½é‡é¿å…ä½¿ç”¨shuffleç±»ç®—å­ã€‚å› ä¸ºSparkä½œä¸šè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ€æ¶ˆè€—æ€§èƒ½çš„åœ°æ–¹å°±æ˜¯shuffleè¿‡ç¨‹ã€‚shuffleè¿‡ç¨‹ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å°†åˆ†å¸ƒåœ¨é›†ç¾¤ä¸­å¤šä¸ªèŠ‚ç‚¹ä¸Šçš„åŒä¸€ä¸ªkeyï¼Œæ‹‰å–åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè¿›è¡Œèšåˆæˆ–joinç­‰æ“ä½œã€‚æ¯”å¦‚reduceByKeyã€joinç­‰ç®—å­ï¼Œéƒ½ä¼šè§¦å‘shuffleæ“ä½œã€‚\nshuffleè¿‡ç¨‹ä¸­ï¼Œå„ä¸ªèŠ‚ç‚¹ä¸Šçš„ç›¸åŒkeyéƒ½ä¼šå…ˆå†™å…¥æœ¬åœ°ç£ç›˜æ–‡ä»¶ä¸­ï¼Œç„¶åå…¶ä»–èŠ‚ç‚¹éœ€è¦é€šè¿‡ç½‘ç»œä¼ è¾“æ‹‰å–å„ä¸ªèŠ‚ç‚¹ä¸Šçš„ç£ç›˜æ–‡ä»¶ä¸­çš„ç›¸åŒkeyã€‚è€Œä¸”ç›¸åŒkeyéƒ½æ‹‰å–åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œèšåˆæ“ä½œæ—¶ï¼Œè¿˜æœ‰å¯èƒ½ä¼šå› ä¸ºä¸€ä¸ªèŠ‚ç‚¹ä¸Šå¤„ç†çš„keyè¿‡å¤šï¼Œå¯¼è‡´å†…å­˜ä¸å¤Ÿå­˜æ”¾ï¼Œè¿›è€Œæº¢å†™åˆ°ç£ç›˜æ–‡ä»¶ä¸­ã€‚å› æ­¤åœ¨shuffleè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå¤§é‡çš„ç£ç›˜æ–‡ä»¶è¯»å†™çš„IOæ“ä½œï¼Œä»¥åŠæ•°æ®çš„ç½‘ç»œä¼ è¾“æ“ä½œã€‚ç£ç›˜IOå’Œç½‘ç»œæ•°æ®ä¼ è¾“ä¹Ÿæ˜¯shuffleæ€§èƒ½è¾ƒå·®çš„ä¸»è¦åŸå› ã€‚\nå› æ­¤åœ¨æˆ‘ä»¬çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œèƒ½é¿å…åˆ™å°½å¯èƒ½é¿å…ä½¿ç”¨reduceByKeyã€joinã€distinctã€repartitionç­‰ä¼šè¿›è¡Œshuffleçš„ç®—å­ï¼Œå°½é‡ä½¿ç”¨mapç±»çš„éshuffleç®—å­ã€‚è¿™æ ·çš„è¯ï¼Œæ²¡æœ‰shuffleæ“ä½œæˆ–è€…ä»…æœ‰è¾ƒå°‘shuffleæ“ä½œçš„Sparkä½œä¸šï¼Œå¯ä»¥å¤§å¤§å‡å°‘æ€§èƒ½å¼€é”€ã€‚ Broadcastä¸mapè¿›è¡Œjoinä»£ç ç¤ºä¾‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // ä¼ ç»Ÿçš„joinæ“ä½œä¼šå¯¼è‡´shuffleæ“ä½œã€‚ // å› ä¸ºä¸¤ä¸ªRDDä¸­ï¼Œç›¸åŒçš„keyéƒ½éœ€è¦é€šè¿‡ç½‘ç»œæ‹‰å–åˆ°ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œç”±ä¸€ä¸ªtaskè¿›è¡Œjoinæ“ä½œã€‚ val rdd3 = rdd1.join(rdd2) // Broadcast+mapçš„joinæ“ä½œï¼Œä¸ä¼šå¯¼è‡´shuffleæ“ä½œã€‚ // ä½¿ç”¨Broadcastå°†ä¸€ä¸ªæ•°æ®é‡è¾ƒå°çš„RDDä½œä¸ºå¹¿æ’­å˜é‡ã€‚ val rdd2Data = rdd2.collect() val rdd2DataBroadcast = sc.broadcast(rdd2Data) // åœ¨rdd1.mapç®—å­ä¸­ï¼Œå¯ä»¥ä»rdd2DataBroadcastä¸­ï¼Œè·å–rdd2çš„æ‰€æœ‰æ•°æ®ã€‚ // ç„¶åè¿›è¡Œéå†ï¼Œå¦‚æœå‘ç°rdd2ä¸­æŸæ¡æ•°æ®çš„keyä¸rdd1çš„å½“å‰æ•°æ®çš„keyæ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆå°±åˆ¤å®šå¯ä»¥è¿›è¡Œjoinã€‚ // æ­¤æ—¶å°±å¯ä»¥æ ¹æ®è‡ªå·±éœ€è¦çš„æ–¹å¼ï¼Œå°†rdd1å½“å‰æ•°æ®ä¸rdd2ä¸­å¯ä»¥è¿æ¥çš„æ•°æ®ï¼Œæ‹¼æ¥åœ¨ä¸€èµ·ï¼ˆStringæˆ–Tupleï¼‰ã€‚ val rdd3 = rdd1.map(rdd2DataBroadcast...) // æ³¨æ„ï¼Œä»¥ä¸Šæ“ä½œï¼Œå»ºè®®ä»…ä»…åœ¨rdd2çš„æ•°æ®é‡æ¯”è¾ƒå°‘ï¼ˆæ¯”å¦‚å‡ ç™¾Mï¼Œæˆ–è€…ä¸€ä¸¤Gï¼‰çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚ // å› ä¸ºæ¯ä¸ªExecutorçš„å†…å­˜ä¸­ï¼Œéƒ½ä¼šé©»ç•™ä¸€ä»½rdd2çš„å…¨é‡æ•°æ®ã€‚ ä½¿ç”¨map-sideé¢„èšåˆçš„shuffleæ“ä½œ å¦‚æœå› ä¸ºä¸šåŠ¡éœ€è¦ï¼Œä¸€å®šè¦ä½¿ç”¨shuffleæ“ä½œï¼Œæ— æ³•ç”¨mapç±»çš„ç®—å­æ¥æ›¿ä»£ï¼Œé‚£ä¹ˆå°½é‡ä½¿ç”¨å¯ä»¥map-sideé¢„èšåˆçš„ç®—å­ã€‚ æ‰€è°“çš„map-sideé¢„èšåˆï¼Œè¯´çš„æ˜¯åœ¨æ¯ä¸ªèŠ‚ç‚¹æœ¬åœ°å¯¹ç›¸åŒçš„keyè¿›è¡Œä¸€æ¬¡èšåˆæ“ä½œï¼Œç±»ä¼¼äºMapReduceä¸­çš„æœ¬åœ°combinerã€‚map-sideé¢„èšåˆä¹‹åï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ¬åœ°å°±åªä¼šæœ‰ä¸€æ¡ç›¸åŒçš„keyï¼Œå› ä¸ºå¤šæ¡ç›¸åŒçš„keyéƒ½è¢«èšåˆèµ·æ¥äº†ã€‚å…¶ä»–èŠ‚ç‚¹åœ¨æ‹‰å–æ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„ç›¸åŒkeyæ—¶ï¼Œå°±ä¼šå¤§å¤§å‡å°‘éœ€è¦æ‹‰å–çš„æ•°æ®æ•°é‡ï¼Œä»è€Œä¹Ÿå°±å‡å°‘äº†ç£ç›˜IOä»¥åŠç½‘ç»œä¼ è¾“å¼€é”€ã€‚é€šå¸¸æ¥è¯´ï¼Œåœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œå»ºè®®ä½¿ç”¨reduceByKeyæˆ–è€…aggregateByKeyç®—å­æ¥æ›¿ä»£æ‰groupByKeyç®—å­ã€‚å› ä¸ºreduceByKeyå’ŒaggregateByKeyç®—å­éƒ½ä¼šä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°å¯¹æ¯ä¸ªèŠ‚ç‚¹æœ¬åœ°çš„ç›¸åŒkeyè¿›è¡Œé¢„èšåˆã€‚è€ŒgroupByKeyç®—å­æ˜¯ä¸ä¼šè¿›è¡Œé¢„èšåˆçš„ï¼Œå…¨é‡çš„æ•°æ®ä¼šåœ¨é›†ç¾¤çš„å„ä¸ªèŠ‚ç‚¹ä¹‹é—´åˆ†å‘å’Œä¼ è¾“ï¼Œæ€§èƒ½ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå·®ã€‚ æ¯”å¦‚å¦‚ä¸‹ä¸¤å¹…å›¾ï¼Œå°±æ˜¯å…¸å‹çš„ä¾‹å­ï¼Œåˆ†åˆ«åŸºäºreduceByKeyå’ŒgroupByKeyè¿›è¡Œå•è¯è®¡æ•°ã€‚å…¶ä¸­ç¬¬ä¸€å¼ å›¾æ˜¯groupByKeyçš„åŸç†å›¾ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•æœ¬åœ°èšåˆæ—¶ï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¼šåœ¨é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´ä¼ è¾“ï¼›ç¬¬äºŒå¼ å›¾æ˜¯reduceByKeyçš„åŸç†å›¾ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ¬åœ°çš„ç›¸åŒkeyæ•°æ®ï¼Œéƒ½è¿›è¡Œäº†é¢„èšåˆï¼Œç„¶åæ‰ä¼ è¾“åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šè¿›è¡Œå…¨å±€èšåˆã€‚\nä½¿ç”¨é«˜æ€§èƒ½çš„ç®—å­\nä½¿ç”¨reduceByKey/aggregateByKeyæ›¿ä»£groupByKey è¯¦æƒ…è§â€œåŸåˆ™äº”ï¼šä½¿ç”¨map-sideé¢„èšåˆçš„shuffleæ“ä½œâ€ã€‚\nä½¿ç”¨mapPartitionsæ›¿ä»£æ™®é€šmap mapPartitionsç±»çš„ç®—å­ï¼Œä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¼šå¤„ç†ä¸€ä¸ªpartitionæ‰€æœ‰çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨å¤„ç†ä¸€æ¡ï¼Œæ€§èƒ½ç›¸å¯¹æ¥è¯´ä¼šé«˜ä¸€äº›ã€‚ä½†æ˜¯æœ‰çš„æ—¶å€™ï¼Œä½¿ç”¨mapPartitionsä¼šå‡ºç°OOMï¼ˆå†…å­˜æº¢å‡ºï¼‰çš„é—®é¢˜ã€‚å› ä¸ºå•æ¬¡å‡½æ•°è°ƒç”¨å°±è¦å¤„ç†æ‰ä¸€ä¸ªpartitionæ‰€æœ‰çš„æ•°æ®ï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿï¼Œåƒåœ¾å›æ”¶æ—¶æ˜¯æ— æ³•å›æ”¶æ‰å¤ªå¤šå¯¹è±¡çš„ï¼Œå¾ˆå¯èƒ½å‡ºç°OOMå¼‚å¸¸ã€‚æ‰€ä»¥ä½¿ç”¨è¿™ç±»æ“ä½œæ—¶è¦æ…é‡ï¼\nä½¿ç”¨foreachPartitionsæ›¿ä»£foreach åŸç†ç±»ä¼¼äºâ€œä½¿ç”¨mapPartitionsæ›¿ä»£mapâ€ï¼Œä¹Ÿæ˜¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨å¤„ç†ä¸€ä¸ªpartitionçš„æ‰€æœ‰æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨å¤„ç†ä¸€æ¡æ•°æ®ã€‚åœ¨å®è·µä¸­å‘ç°ï¼ŒforeachPartitionsç±»çš„ç®—å­ï¼Œå¯¹æ€§èƒ½çš„æå‡è¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚æ¯”å¦‚åœ¨foreachå‡½æ•°ä¸­ï¼Œå°†RDDä¸­æ‰€æœ‰æ•°æ®å†™MySQLï¼Œé‚£ä¹ˆå¦‚æœæ˜¯æ™®é€šçš„foreachç®—å­ï¼Œå°±ä¼šä¸€æ¡æ•°æ®ä¸€æ¡æ•°æ®åœ°å†™ï¼Œæ¯æ¬¡å‡½æ•°è°ƒç”¨å¯èƒ½å°±ä¼šåˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œæ­¤æ—¶å°±åŠ¿å¿…ä¼šé¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯æ•°æ®åº“è¿æ¥ï¼Œæ€§èƒ½æ˜¯éå¸¸ä½ä¸‹ï¼›ä½†æ˜¯å¦‚æœç”¨foreachPartitionsç®—å­ä¸€æ¬¡æ€§å¤„ç†ä¸€ä¸ªpartitionçš„æ•°æ®ï¼Œé‚£ä¹ˆå¯¹äºæ¯ä¸ªpartitionï¼Œåªè¦åˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¿æ¥å³å¯ï¼Œç„¶åæ‰§è¡Œæ‰¹é‡æ’å…¥æ“ä½œï¼Œæ­¤æ—¶æ€§èƒ½æ˜¯æ¯”è¾ƒé«˜çš„ã€‚å®è·µä¸­å‘ç°ï¼Œå¯¹äº1ä¸‡æ¡å·¦å³çš„æ•°æ®é‡å†™MySQLï¼Œæ€§èƒ½å¯ä»¥æå‡30%ä»¥ä¸Šã€‚\nä½¿ç”¨filterä¹‹åè¿›è¡Œcoalesceæ“ä½œ é€šå¸¸å¯¹ä¸€ä¸ªRDDæ‰§è¡Œfilterç®—å­è¿‡æ»¤æ‰RDDä¸­è¾ƒå¤šæ•°æ®åï¼ˆæ¯”å¦‚30%ä»¥ä¸Šçš„æ•°æ®ï¼‰ï¼Œå»ºè®®ä½¿ç”¨coalesceç®—å­ï¼Œæ‰‹åŠ¨å‡å°‘RDDçš„partitionæ•°é‡ï¼Œå°†RDDä¸­çš„æ•°æ®å‹ç¼©åˆ°æ›´å°‘çš„partitionä¸­å»ã€‚å› ä¸ºfilterä¹‹åï¼ŒRDDçš„æ¯ä¸ªpartitionä¸­éƒ½ä¼šæœ‰å¾ˆå¤šæ•°æ®è¢«è¿‡æ»¤æ‰ï¼Œæ­¤æ—¶å¦‚æœç…§å¸¸è¿›è¡Œåç»­çš„è®¡ç®—ï¼Œå…¶å®æ¯ä¸ªtaskå¤„ç†çš„partitionä¸­çš„æ•°æ®é‡å¹¶ä¸æ˜¯å¾ˆå¤šï¼Œæœ‰ä¸€ç‚¹èµ„æºæµªè´¹ï¼Œè€Œä¸”æ­¤æ—¶å¤„ç†çš„taskè¶Šå¤šï¼Œå¯èƒ½é€Ÿåº¦åè€Œè¶Šæ…¢ã€‚å› æ­¤ç”¨coalesceå‡å°‘partitionæ•°é‡ï¼Œå°†RDDä¸­çš„æ•°æ®å‹ç¼©åˆ°æ›´å°‘çš„partitionä¹‹åï¼Œåªè¦ä½¿ç”¨æ›´å°‘çš„taskå³å¯å¤„ç†å®Œæ‰€æœ‰çš„partitionã€‚åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå¯¹äºæ€§èƒ½çš„æå‡ä¼šæœ‰ä¸€å®šçš„å¸®åŠ©ã€‚\nä½¿ç”¨repartitionAndSortWithinPartitionsæ›¿ä»£repartitionä¸sortç±»æ“ä½œ repartitionAndSortWithinPartitionsæ˜¯Sparkå®˜ç½‘æ¨èçš„ä¸€ä¸ªç®—å­ï¼Œå®˜æ–¹å»ºè®®ï¼Œå¦‚æœéœ€è¦åœ¨repartitioné‡åˆ†åŒºä¹‹åï¼Œè¿˜è¦è¿›è¡Œæ’åºï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨repartitionAndSortWithinPartitionsç®—å­ã€‚å› ä¸ºè¯¥ç®—å­å¯ä»¥ä¸€è¾¹è¿›è¡Œé‡åˆ†åŒºçš„shuffleæ“ä½œï¼Œä¸€è¾¹è¿›è¡Œæ’åºã€‚shuffleä¸sortä¸¤ä¸ªæ“ä½œåŒæ—¶è¿›è¡Œï¼Œæ¯”å…ˆshuffleå†sortæ¥è¯´ï¼Œæ€§èƒ½å¯èƒ½æ˜¯è¦é«˜çš„ã€‚\nå¹¿æ’­å¤§å˜é‡\nä½¿ç”¨Kryoä¼˜åŒ–åºåˆ—åŒ–æ€§èƒ½\nä¼˜åŒ–æ•°æ®ç»“æ„\n2. èµ„æºè°ƒä¼˜ äº†è§£å®Œäº†Sparkä½œä¸šè¿è¡Œçš„åŸºæœ¬åŸç†ä¹‹åï¼Œå¯¹èµ„æºç›¸å…³çš„å‚æ•°å°±å®¹æ˜“ç†è§£äº†ã€‚æ‰€è°“çš„Sparkèµ„æºå‚æ•°è°ƒä¼˜ï¼Œå…¶å®ä¸»è¦å°±æ˜¯å¯¹Sparkè¿è¡Œè¿‡ç¨‹ä¸­å„ä¸ªä½¿ç”¨èµ„æºçš„åœ°æ–¹ï¼Œé€šè¿‡è°ƒèŠ‚å„ç§å‚æ•°ï¼Œæ¥ä¼˜åŒ–èµ„æºä½¿ç”¨çš„æ•ˆç‡ï¼Œä»è€Œæå‡Sparkä½œä¸šçš„æ‰§è¡Œæ€§èƒ½ã€‚ä»¥ä¸‹å‚æ•°å°±æ˜¯Sparkä¸­ä¸»è¦çš„èµ„æºå‚æ•°ï¼Œæ¯ä¸ªå‚æ•°éƒ½å¯¹åº”ç€ä½œä¸šè¿è¡ŒåŸç†ä¸­çš„æŸä¸ªéƒ¨åˆ†ï¼Œæˆ‘ä»¬åŒæ—¶ä¹Ÿç»™å‡ºäº†ä¸€ä¸ªè°ƒä¼˜çš„å‚è€ƒå€¼ã€‚\nnum-executors å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®Sparkä½œä¸šæ€»å…±è¦ç”¨å¤šå°‘ä¸ªExecutorè¿›ç¨‹æ¥æ‰§è¡Œã€‚Driveråœ¨å‘YARNé›†ç¾¤ç®¡ç†å™¨ç”³è¯·èµ„æºæ—¶ï¼ŒYARNé›†ç¾¤ç®¡ç†å™¨ä¼šå°½å¯èƒ½æŒ‰ç…§ä½ çš„è®¾ç½®æ¥åœ¨é›†ç¾¤çš„å„ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šï¼Œå¯åŠ¨ç›¸åº”æ•°é‡çš„Executorè¿›ç¨‹ã€‚è¿™ä¸ªå‚æ•°éå¸¸ä¹‹é‡è¦ï¼Œå¦‚æœä¸è®¾ç½®çš„è¯ï¼Œé»˜è®¤åªä¼šç»™ä½ å¯åŠ¨å°‘é‡çš„Executorè¿›ç¨‹ï¼Œæ­¤æ—¶ä½ çš„Sparkä½œä¸šçš„è¿è¡Œé€Ÿåº¦æ˜¯éå¸¸æ…¢çš„ã€‚ å‚æ•°è°ƒä¼˜å»ºè®®ï¼šæ¯ä¸ªSparkä½œä¸šçš„è¿è¡Œä¸€èˆ¬è®¾ç½®50~100ä¸ªå·¦å³çš„Executorè¿›ç¨‹æ¯”è¾ƒåˆé€‚ï¼Œè®¾ç½®å¤ªå°‘æˆ–å¤ªå¤šçš„Executorè¿›ç¨‹éƒ½ä¸å¥½ã€‚è®¾ç½®çš„å¤ªå°‘ï¼Œæ— æ³•å……åˆ†åˆ©ç”¨é›†ç¾¤èµ„æºï¼›è®¾ç½®çš„å¤ªå¤šçš„è¯ï¼Œå¤§éƒ¨åˆ†é˜Ÿåˆ—å¯èƒ½æ— æ³•ç»™äºˆå……åˆ†çš„èµ„æºã€‚ executor-memory å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®æ¯ä¸ªExecutorè¿›ç¨‹çš„å†…å­˜ã€‚Executorå†…å­˜çš„å¤§å°ï¼Œå¾ˆå¤šæ—¶å€™ç›´æ¥å†³å®šäº†Sparkä½œä¸šçš„æ€§èƒ½ï¼Œè€Œä¸”è·Ÿå¸¸è§çš„JVM OOMå¼‚å¸¸ï¼Œä¹Ÿæœ‰ç›´æ¥çš„å…³è”ã€‚ å‚æ•°è°ƒä¼˜å»ºè®®ï¼šæ¯ä¸ªExecutorè¿›ç¨‹çš„å†…å­˜è®¾ç½®4G~8Gè¾ƒä¸ºåˆé€‚ã€‚ä½†æ˜¯è¿™åªæ˜¯ä¸€ä¸ªå‚è€ƒå€¼ï¼Œå…·ä½“çš„è®¾ç½®è¿˜æ˜¯å¾—æ ¹æ®ä¸åŒéƒ¨é—¨çš„èµ„æºé˜Ÿåˆ—æ¥å®šã€‚å¯ä»¥çœ‹çœ‹è‡ªå·±å›¢é˜Ÿçš„èµ„æºé˜Ÿåˆ—çš„æœ€å¤§å†…å­˜é™åˆ¶æ˜¯å¤šå°‘ï¼Œnum-executorsä¹˜ä»¥executor-memoryï¼Œæ˜¯ä¸èƒ½è¶…è¿‡é˜Ÿåˆ—çš„æœ€å¤§å†…å­˜é‡çš„ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ æ˜¯è·Ÿå›¢é˜Ÿé‡Œå…¶ä»–äººå…±äº«è¿™ä¸ªèµ„æºé˜Ÿåˆ—ï¼Œé‚£ä¹ˆç”³è¯·çš„å†…å­˜é‡æœ€å¥½ä¸è¦è¶…è¿‡èµ„æºé˜Ÿåˆ—æœ€å¤§æ€»å†…å­˜çš„1/3~1/2ï¼Œé¿å…ä½ è‡ªå·±çš„Sparkä½œä¸šå ç”¨äº†é˜Ÿåˆ—æ‰€æœ‰çš„èµ„æºï¼Œå¯¼è‡´åˆ«çš„åŒå­¦çš„ä½œä¸šæ— æ³•è¿è¡Œã€‚ executor-cores å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®æ¯ä¸ªExecutorè¿›ç¨‹çš„CPU coreæ•°é‡ã€‚è¿™ä¸ªå‚æ•°å†³å®šäº†æ¯ä¸ªExecutorè¿›ç¨‹å¹¶è¡Œæ‰§è¡Œtaskçº¿ç¨‹çš„èƒ½åŠ›ã€‚å› ä¸ºæ¯ä¸ªCPU coreåŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªtaskçº¿ç¨‹ï¼Œå› æ­¤æ¯ä¸ªExecutorè¿›ç¨‹çš„CPU coreæ•°é‡è¶Šå¤šï¼Œè¶Šèƒ½å¤Ÿå¿«é€Ÿåœ°æ‰§è¡Œå®Œåˆ†é…ç»™è‡ªå·±çš„æ‰€æœ‰taskçº¿ç¨‹ã€‚ å‚æ•°è°ƒä¼˜å»ºè®®ï¼šExecutorçš„CPU coreæ•°é‡è®¾ç½®ä¸º2~4ä¸ªè¾ƒä¸ºåˆé€‚ã€‚åŒæ ·å¾—æ ¹æ®ä¸åŒéƒ¨é—¨çš„èµ„æºé˜Ÿåˆ—æ¥å®šï¼Œå¯ä»¥çœ‹çœ‹è‡ªå·±çš„èµ„æºé˜Ÿåˆ—çš„æœ€å¤§CPU coreé™åˆ¶æ˜¯å¤šå°‘ï¼Œå†ä¾æ®è®¾ç½®çš„Executoræ•°é‡ï¼Œæ¥å†³å®šæ¯ä¸ªExecutorè¿›ç¨‹å¯ä»¥åˆ†é…åˆ°å‡ ä¸ªCPU coreã€‚åŒæ ·å»ºè®®ï¼Œå¦‚æœæ˜¯è·Ÿä»–äººå…±äº«è¿™ä¸ªé˜Ÿåˆ—ï¼Œé‚£ä¹ˆnum-executors * executor-coresä¸è¦è¶…è¿‡é˜Ÿåˆ—æ€»CPU coreçš„1/3~1/2å·¦å³æ¯”è¾ƒåˆé€‚ï¼Œä¹Ÿæ˜¯é¿å…å½±å“å…¶ä»–åŒå­¦çš„ä½œä¸šè¿è¡Œã€‚ driver-memory å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®Driverè¿›ç¨‹çš„å†…å­˜ã€‚ å‚æ•°è°ƒä¼˜å»ºè®®ï¼šDriverçš„å†…å­˜é€šå¸¸æ¥è¯´ä¸è®¾ç½®ï¼Œæˆ–è€…è®¾ç½®1Gå·¦å³åº”è¯¥å°±å¤Ÿäº†ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨collectç®—å­å°†RDDçš„æ•°æ®å…¨éƒ¨æ‹‰å–åˆ°Driverä¸Šè¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆå¿…é¡»ç¡®ä¿Driverçš„å†…å­˜è¶³å¤Ÿå¤§ï¼Œå¦åˆ™ä¼šå‡ºç°OOMå†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚ spark.default.parallelism å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®æ¯ä¸ªstageçš„é»˜è®¤taskæ•°é‡ã€‚è¿™ä¸ªå‚æ•°æä¸ºé‡è¦ï¼Œå¦‚æœä¸è®¾ç½®å¯èƒ½ä¼šç›´æ¥å½±å“ä½ çš„Sparkä½œä¸šæ€§èƒ½ã€‚ å‚æ•°è°ƒä¼˜å»ºè®®ï¼šSparkä½œä¸šçš„é»˜è®¤taskæ•°é‡ä¸º500~1000ä¸ªè¾ƒä¸ºåˆé€‚ã€‚å¾ˆå¤šåŒå­¦å¸¸çŠ¯çš„ä¸€ä¸ªé”™è¯¯å°±æ˜¯ä¸å»è®¾ç½®è¿™ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šå¯¼è‡´Sparkè‡ªå·±æ ¹æ®åº•å±‚HDFSçš„blockæ•°é‡æ¥è®¾ç½®taskçš„æ•°é‡ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªHDFS blockå¯¹åº”ä¸€ä¸ªtaskã€‚é€šå¸¸æ¥è¯´ï¼ŒSparké»˜è®¤è®¾ç½®çš„æ•°é‡æ˜¯åå°‘çš„ï¼ˆæ¯”å¦‚å°±å‡ åä¸ªtaskï¼‰ï¼Œå¦‚æœtaskæ•°é‡åå°‘çš„è¯ï¼Œå°±ä¼šå¯¼è‡´ä½ å‰é¢è®¾ç½®å¥½çš„Executorçš„å‚æ•°éƒ½å‰åŠŸå°½å¼ƒã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œæ— è®ºä½ çš„Executorè¿›ç¨‹æœ‰å¤šå°‘ä¸ªï¼Œå†…å­˜å’ŒCPUæœ‰å¤šå¤§ï¼Œä½†æ˜¯taskåªæœ‰1ä¸ªæˆ–è€…10ä¸ªï¼Œé‚£ä¹ˆ90%çš„Executorè¿›ç¨‹å¯èƒ½æ ¹æœ¬å°±æ²¡æœ‰taskæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ç™½ç™½æµªè´¹äº†èµ„æºï¼å› æ­¤Sparkå®˜ç½‘å»ºè®®çš„è®¾ç½®åŸåˆ™æ˜¯ï¼Œè®¾ç½®è¯¥å‚æ•°ä¸ºnum-executors * executor-coresçš„2~3å€è¾ƒä¸ºåˆé€‚ï¼Œæ¯”å¦‚Executorçš„æ€»CPU coreæ•°é‡ä¸º300ä¸ªï¼Œé‚£ä¹ˆè®¾ç½®1000ä¸ªtaskæ˜¯å¯ä»¥çš„ï¼Œæ­¤æ—¶å¯ä»¥å……åˆ†åœ°åˆ©ç”¨Sparké›†ç¾¤çš„èµ„æºã€‚ spark.memory.memoryFraction æ³¨æ„ï¼š ä¸€ä¸‹ä¸¤ä¸ªå‚æ•°æ˜¯åœ¨spark1.6 é™æ€å†…å­˜ç®¡ç†çš„æ—¶å€™æœ‰æ•ˆï¼Œç°åœ¨spark2 ä»¥ä¸Šçš„ç‰ˆæœ¬ä½¿ç”¨çš„æ˜¯åŒæ„å†…å­˜ç®¡ç†ï¼Œå‚æ•°å·²ç»å¤±æ•ˆï¼Œspark ä¼šè‡ªå·±åŠ¨æ€å…³ç³»ï¼Œstorage execution å†…å­˜ã€‚\nå‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®RDDæŒä¹…åŒ–æ•°æ®åœ¨Executorå†…å­˜ä¸­èƒ½å çš„æ¯”ä¾‹ï¼Œé»˜è®¤æ˜¯0.6ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤Executor 60%çš„å†…å­˜ï¼Œå¯ä»¥ç”¨æ¥ä¿å­˜æŒä¹…åŒ–çš„RDDæ•°æ®ã€‚æ ¹æ®ä½ é€‰æ‹©çš„ä¸åŒçš„æŒä¹…åŒ–ç­–ç•¥ï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿæ—¶ï¼Œå¯èƒ½æ•°æ®å°±ä¸ä¼šæŒä¹…åŒ–ï¼Œæˆ–è€…æ•°æ®ä¼šå†™å…¥ç£ç›˜ã€‚ å‚æ•°è°ƒä¼˜å»ºè®®ï¼šå¦‚æœSparkä½œä¸šä¸­ï¼Œæœ‰è¾ƒå¤šçš„RDDæŒä¹…åŒ–æ“ä½œï¼Œè¯¥å‚æ•°çš„å€¼å¯ä»¥é€‚å½“æé«˜ä¸€äº›ï¼Œä¿è¯æŒä¹…åŒ–çš„æ•°æ®èƒ½å¤Ÿå®¹çº³åœ¨å†…å­˜ä¸­ã€‚é¿å…å†…å­˜ä¸å¤Ÿç¼“å­˜æ‰€æœ‰çš„æ•°æ®ï¼Œå¯¼è‡´æ•°æ®åªèƒ½å†™å…¥ç£ç›˜ä¸­ï¼Œé™ä½äº†æ€§èƒ½ã€‚ä½†æ˜¯å¦‚æœSparkä½œä¸šä¸­çš„shuffleç±»æ“ä½œæ¯”è¾ƒå¤šï¼Œè€ŒæŒä¹…åŒ–æ“ä½œæ¯”è¾ƒå°‘ï¼Œé‚£ä¹ˆè¿™ä¸ªå‚æ•°çš„å€¼é€‚å½“é™ä½ä¸€äº›æ¯”è¾ƒåˆé€‚ã€‚æ­¤å¤–ï¼Œå¦‚æœå‘ç°ä½œä¸šç”±äºé¢‘ç¹çš„gcå¯¼è‡´è¿è¡Œç¼“æ…¢ï¼ˆé€šè¿‡spark web uiå¯ä»¥è§‚å¯Ÿåˆ°ä½œä¸šçš„gcè€—æ—¶ï¼‰ï¼Œæ„å‘³ç€taskæ‰§è¡Œç”¨æˆ·ä»£ç çš„å†…å­˜ä¸å¤Ÿç”¨ï¼Œé‚£ä¹ˆåŒæ ·å»ºè®®è°ƒä½è¿™ä¸ªå‚æ•°çš„å€¼ã€‚ spark.shuffle.memoryFraction [deprecated after spark1.6] å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®shuffleè¿‡ç¨‹ä¸­ä¸€ä¸ªtaskæ‹‰å–åˆ°ä¸Šä¸ªstageçš„taskçš„è¾“å‡ºåï¼Œè¿›è¡Œèšåˆæ“ä½œæ—¶èƒ½å¤Ÿä½¿ç”¨çš„Executorå†…å­˜çš„æ¯”ä¾‹ï¼Œé»˜è®¤æ˜¯0.2ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒExecutoré»˜è®¤åªæœ‰20%çš„å†…å­˜ç”¨æ¥è¿›è¡Œè¯¥æ“ä½œã€‚shuffleæ“ä½œåœ¨è¿›è¡Œèšåˆæ—¶ï¼Œå¦‚æœå‘ç°ä½¿ç”¨çš„å†…å­˜è¶…å‡ºäº†è¿™ä¸ª20%çš„é™åˆ¶ï¼Œé‚£ä¹ˆå¤šä½™çš„æ•°æ®å°±ä¼šæº¢å†™åˆ°ç£ç›˜æ–‡ä»¶ä¸­å»ï¼Œæ­¤æ—¶å°±ä¼šæå¤§åœ°é™ä½æ€§èƒ½ã€‚ å‚æ•°è°ƒä¼˜å»ºè®®ï¼šå¦‚æœSparkä½œä¸šä¸­çš„RDDæŒä¹…åŒ–æ“ä½œè¾ƒå°‘ï¼Œshuffleæ“ä½œè¾ƒå¤šæ—¶ï¼Œå»ºè®®é™ä½æŒä¹…åŒ–æ“ä½œçš„å†…å­˜å æ¯”ï¼Œæé«˜shuffleæ“ä½œçš„å†…å­˜å æ¯”æ¯”ä¾‹ï¼Œé¿å…shuffleè¿‡ç¨‹ä¸­æ•°æ®è¿‡å¤šæ—¶å†…å­˜ä¸å¤Ÿç”¨ï¼Œå¿…é¡»æº¢å†™åˆ°ç£ç›˜ä¸Šï¼Œé™ä½äº†æ€§èƒ½ã€‚æ­¤å¤–ï¼Œå¦‚æœå‘ç°ä½œä¸šç”±äºé¢‘ç¹çš„gcå¯¼è‡´è¿è¡Œç¼“æ…¢ï¼Œæ„å‘³ç€taskæ‰§è¡Œç”¨æˆ·ä»£ç çš„å†…å­˜ä¸å¤Ÿç”¨ï¼Œé‚£ä¹ˆåŒæ ·å»ºè®®è°ƒä½è¿™ä¸ªå‚æ•°çš„å€¼ã€‚ èµ„æºå‚æ•°çš„è°ƒä¼˜ï¼Œæ²¡æœ‰ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œéœ€è¦åŒå­¦ä»¬æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µï¼ˆåŒ…æ‹¬Sparkä½œä¸šä¸­çš„shuffleæ“ä½œæ•°é‡ã€RDDæŒä¹…åŒ–æ“ä½œæ•°é‡ä»¥åŠspark web uiä¸­æ˜¾ç¤ºçš„ä½œä¸šgcæƒ…å†µï¼‰ï¼ŒåŒæ—¶å‚è€ƒæœ¬ç¯‡æ–‡ç« ä¸­ç»™å‡ºçš„åŸç†ä»¥åŠè°ƒä¼˜å»ºè®®ï¼Œåˆç†åœ°è®¾ç½®ä¸Šè¿°å‚æ•°ã€‚ demo 1 2 3 4 5 6 7 8 9 ./bin/spark-submit \\ --master yarn-cluster \\ --num-executors 100 \\ --executor-memory 6G \\ --executor-cores 4 \\ --driver-memory 1G \\ --conf spark.default.parallelism=1000 \\ --conf spark.storage.memoryFraction=0.5 \\ --conf spark.shuffle.memoryFraction=0.3 \\ 3. æ•°æ®å€¾æ–œè°ƒä¼˜ ä»£ç å†™å¥½äº†ï¼Œç¨‹åºè·‘çš„èµ„æºä¹Ÿç»è¿‡ç²¾å¿ƒè°ƒé…ä¹‹åè®¾ç½®å¥½äº†ï¼Œæ²¡æœ‰å…¶ä»–æ„å¤–æƒ…å†µçš„è¯ï¼Œä½ çš„Sparkç¨‹åºå·²ç»èƒ½å¤Ÿæ­£å¸¸çš„è·‘åœ¨é›†ç¾¤ä¸Šã€‚\nä½†æ˜¯åˆ«ä»¥ä¸ºè¿™æ ·å°±ç»“æŸäº†ï¼Œè¿™ä»…ä»…æ˜¯Sparkç¨‹åºç”Ÿå‘½å‘¨æœŸçš„å¼€å§‹ã€‚\nä¸ºäº†ç»™ä½ çš„ç¨‹åºä¿é©¾æŠ¤èˆªï¼Œä½ è¿˜éœ€è¦æ—¶åˆ»å…³æ³¨ æ–°ä¸Šçº¿çš„åº”ç”¨ç¨‹åºçš„æ‰§è¡Œæƒ…å†µæ˜¯å¦å¥åº·ã€æ˜¯å¦å¦‚ä½ æ‰€æ„¿å¦‚ä½ æ‰€æƒ³ã€‚\nåº”ç”¨ç¨‹åºçš„æ‰§è¡Œæƒ…å†µä½ éƒ½å¯ä»¥åœ¨ Sparkæˆ–è€…Yarnçš„WebUI ä¸ŠæŸ¥çœ‹åˆ°ï¼Œæœ‰éå¸¸è¯¦ç»†çš„æ‰§è¡Œä¿¡æ¯ã€‚\næˆ‘ä»¬ç°åœ¨æ¥è®¨è®ºä¸€ä¸ª å¯èƒ½æ˜¯å¯¼è‡´ç¨‹åºæ‰§è¡Œç¼“æ…¢ç”šè‡³å¼‚å¸¸ çš„æœ€å¤§ç½ªé­ç¥¸é¦–ï¼š æ•°æ®å€¾æ–œã€‚\nä»€ä¹ˆæ˜¯æ•°æ®å€¾æ–œå‘¢ï¼Ÿ å°±æ˜¯ ç»å¤§å¤šæ•°æ•°æ®ï¼ˆæ¯”å¦‚80%ä»¥ä¸Šç”šè‡³æ›´å¤šï¼‰éƒ½è¢«åˆ†é…åˆ° ç»å°‘æ•°çš„èŠ‚ç‚¹ ä¸Šæ‰§è¡Œï¼ˆæ¯”å¦‚20%ç”šè‡³æ›´å°‘ï¼‰ã€‚\nè¿™ä¹ˆä¸€æ¥ï¼Œæ„å‘³ç€å‰©ä¸‹ç»å¤§å¤šæ•°çš„èŠ‚ç‚¹éƒ½æ²¡å¤„ç†æˆ–è€…æ²¡æ€ä¹ˆå¤„ç†æ•°æ®ï¼Œå¤„äºç©ºé—²çŠ¶æ€ã€‚è€Œ å°‘æ•°èŠ‚ç‚¹åˆ™ä¸€ç›´å¤„ç†éå¸¸å¿™ç¢Œçš„çŠ¶æ€ï¼Œä»»åŠ¡å¤„ç†éœ€è¦æ’é˜Ÿï¼ŒèŠ‚ç‚¹å®Œæˆè®¡ç®—ä»»åŠ¡è€—æ—¶éå¸¸é•¿ï¼Œå…¶ä»–å®Œæˆä»»åŠ¡çš„èŠ‚ç‚¹å°±åœ¨æ—è¾¹çœ‹çƒ­é—¹ï¼Œä½†æ˜¯ åªæœ‰ç­‰æ‰€æœ‰èŠ‚ç‚¹éƒ½å®Œæˆäº†è®¡ç®—ä»»åŠ¡æ•´ä¸ªç¨‹åºæ‰èƒ½ç®—å®Œæˆã€‚\nä¾‹å¦‚ï¼Œæ€»å…±æœ‰1000ä¸ªtaskï¼Œ990ä¸ªtaskéƒ½åœ¨10åˆ†é’Ÿä¹‹å†…æ‰§è¡Œå®Œäº†ï¼Œä½†æ˜¯å‰©ä½™10ä¸ªtaskå´è¦ä¸‰ã€å››ä¸ªå°æ—¶ï¼Œæ•´ä¸ªç¨‹åºçš„æ‰§è¡Œæ—¶é—´ç”±æœ€é•¿çš„é‚£ä¸ªtaskå†³å®šï¼ˆåè¿‡æ¥çš„æœ¨æ¡¶æ•ˆåº”ï¼‰ã€‚\nåŒæ—¶ï¼Œå› ä¸ºæŸäº›èŠ‚ç‚¹ä¸Šå¤„ç†çš„æ•°æ®é‡å¤ªå¤šï¼Œæ ¹æ®ä¸åŒçš„ä¸šåŠ¡ä»£ç æ“ä½œï¼Œå¯èƒ½è¿˜ä¼šå‡ºç°æŸäº›èŠ‚ç‚¹åœ¨Shuffleè¿‡ç¨‹æˆ–è€…æ•°æ®å¤„ç†è¿‡ç¨‹å‡ºç°OOMå¼‚å¸¸å¯¼è‡´ç¨‹åºå¤±è´¥ã€‚\nç®€å•æ¥è®²ï¼Œå°±æ˜¯ å‡ é¢—è€é¼ å±åäº†ä¸€é”…ç²¥ã€‚\nå¯¼è‡´æ•°æ®å€¾æ–œçš„åŸå› æœ‰å¾ˆå¤šï¼Œä½†æ˜¯å…¶æœ¬è´¨éƒ½æ˜¯ä¸€æ ·çš„ï¼šåœ¨Shuffleç­‰éœ€è¦é€šè¿‡ç½‘ç»œè¯»å†™æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºæ•°æ®keyåˆ†å¸ƒä¸å‡åŒ€ï¼Œå¯¼è‡´å¤§éƒ¨åˆ†æ•°æ®è¢«é›†ä¸­è·å–åˆ°å°‘éƒ¨åˆ†èŠ‚ç‚¹ä¸Šã€‚\næ•°æ®å€¾æ–œçš„æƒ…å†µå¯ä»¥åœ¨WebUIä¸Šçš„Stagesã€Executorsé¡µé¢ä¸­è§‚å¯Ÿåˆ°ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æ±‚å¯¹äºåˆæ¬¡ä¸Šçº¿çš„åº”ç”¨ï¼Œéœ€è¦æ—¶åˆ»å…³æ³¨æ–°ä¸Šçº¿çš„åº”ç”¨ç¨‹åºçš„æ‰§è¡Œæƒ…å†µæ˜¯å¦å¥åº·ã€æ˜¯å¦å¦‚ä½ æ‰€æ„¿å¦‚ä½ æ‰€æƒ³ã€‚\nåœ¨Webç•Œé¢ä¸­ï¼Œæœ‰å“ªäº›Stageï¼ŒStageä¸­æœ‰å“ªäº›Taskï¼Œå„ä¸ªTaskå¤„ç†çš„æ•°æ®é‡å’Œæ‰§è¡Œè®¡ç®—çš„æ—¶é—´ç­‰ç­‰ï¼Œè¿™äº›ä½ éƒ½å¯ä»¥å¾ˆæ¸…æ™°çš„çœ‹åˆ°ã€‚\nå¦‚æœå‘ç°ä½ çš„åº”ç”¨ä¸­æœ‰å­˜åœ¨æœ‰ å‡ ä¸ªTaskå¤„ç†çš„æ•°æ®é‡æ˜æ˜¾æ¯”å…¶ä»–Taskè¦å¤§å¾ˆå¤šï¼Œè€Œä¸”è¿˜åœ¨ä¸åœçš„å¤„ç†æ•°æ®ï¼Œè€Œå…¶ä»–Taskå·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œé‚£ä¹ˆä½ å°±æ˜¯é‡åˆ°äº†æ•°æ®å€¾æ–œçš„é—®é¢˜ã€‚\né‚£ä¹ˆå¦‚æœæˆ‘ä»¬ç¡®å®šäº†ç¨‹åºä¸­å­˜åœ¨æ•°æ®å€¾æ–œçš„æƒ…å†µï¼Œè¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ\næ ¹æ®æ•°æ®å€¾æ–œäº§ç”Ÿçš„åŸå› ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ ä¸åŒçš„åˆ‡å…¥ç‚¹ä½¿ç”¨ä¸åŒçš„å¤„ç†ç­–ç•¥ã€‚\nå®šä½ä»£ç ä¸æ•°æ®é—®é¢˜ åœ¨Webç•Œé¢ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç›´è§‚çš„è·å¾— å‘ç”Ÿæ•°æ®å€¾æ–œçš„Stageå¯¹åº”çš„ä»£ç è¡Œæ•°ï¼Œä½†è¿™ä¸ªè¡Œæ•°å¹¶ä¸èƒ½ç²¾å‡†ç›´æ¥å®šä½åˆ°å‘ç”Ÿæ•°æ®å€¾æ–œçš„ä»£ç ï¼Œå› ä¸ºå®ƒæ˜¾ç¤ºçš„æ˜¯å½“å‰Stageå¼€å§‹æ‰§è¡Œçš„ä»£ç è¡Œæ•°ã€‚\nç”±äºæ•°æ®å€¾æ–œåªæœ‰å¯èƒ½åœ¨Shuffleè¿‡ç¨‹ä¸­å‘ç”Ÿï¼Œæ‰€ä»¥ å¯¼è‡´æ•°æ®å€¾æ–œçš„ä¸€å®šæ˜¯ä¼šäº§ç”ŸShuffleè¿‡ç¨‹çš„ç®—å­ï¼Œæ¯”å¦‚groupByKeyã€reduceByKeyã€aggregateByKeyã€joinã€distinctã€repartitionç­‰ç­‰ã€‚\næ‰€ä»¥ï¼Œä½ åªéœ€è¦åœ¨Stageæ‰€åœ¨çš„è¡Œæ•°å‘ä¸ŠæŸ¥æ‰¾Shuffleæ“ä½œç¬¦ï¼Œé‚£ä¹ˆå…¶å°±æ˜¯å¯¼è‡´æ•°æ®å€¾æ–œçš„ç½ªé­ç¥¸é¦–ã€‚\næ‰¾åˆ°é—®é¢˜ä»£ç ä¹‹åï¼Œéœ€è¦åšçš„äº‹æƒ…å¾ˆæ˜æ˜¾äº†å§ï¼Ÿä¼˜åŒ–ä¹‹ã€‚\næ­¤æ—¶æˆ‘ä»¬éœ€è¦ç»Ÿè®¡ä¸€ä¸‹è¯¥Shuffleæ“ä½œç¬¦æ‰€ä½¿ç”¨çš„æ•°æ®æºï¼Œè§‚å¯Ÿå„ä¸ªæ•°æ®æºçš„ keyåˆ†å¸ƒæƒ…å†µï¼ˆå¦‚æ¯ä¸ªkeyæœ‰å¤šå°‘æ•°æ®é‡ï¼‰ï¼Œä»¥åŠå¯¼è‡´æ•°æ®å€¾æ–œçš„keyåœ¨å“ªé‡Œã€éƒ½æœ‰å“ªäº›ã€‚\næ ¹æ®æ•°æ®æƒ…å†µä¸ä½ å¯¹ä¸šåŠ¡çš„ç†è§£ï¼Œä½¿ç”¨ã€Œå¼€å‘è°ƒä¼˜ã€ä¸­ç®—å­ä¼˜åŒ–æåˆ°çš„æŠ€å·§ï¼Œå°½é‡è¿™ä¸ªShuffleæ“ä½œçš„å½±å“é™åˆ°æœ€ä½ã€‚\nå¤„ç†æºå¤´æ•°æ® å¦‚æœè¯¥Shuffleæ“ä½œç¬¦æ— æ³•é¿å…ï¼Œä»£ç å±‚é¢ä¸Šæ— æ³•åšå¤ªå¤šä¼˜åŒ–ï¼Œé‚£ä¹ˆæ­¤æ—¶å¯ä»¥è€ƒè™‘ é¢„å…ˆå¤„ç†æ•°æ®æºã€‚\nå…ˆæ ¹æ®æ•°æ®æºkeyçš„åˆ†å¸ƒæƒ…å†µæˆ–è€…åˆ†åŒºåˆ†å¸ƒæƒ…å†µï¼Œé’ˆå¯¹æ€§çš„åšä¸€æ¬¡repartitionæ“ä½œï¼Œé‡æ–°å­˜å‚¨ï¼Œåç»­æ‰€æœ‰ç”¨åˆ°è¯¥æ•°æ®æºçš„ç¨‹åºéƒ½ä¸ä¼šæœ‰æ•°æ®å€¾æ–œçš„é—®é¢˜ã€‚\nä½†æ˜¯é‡åˆ†åŒºé¢„å¤„ç†è¿‡ç¨‹ä¸­ä»ç„¶ä¼šå­˜åœ¨æ•°æ®å€¾æ–œé—®é¢˜è€Œå¯¼è‡´é¢„å¤„ç†è¿‡ç¨‹ç¼“æ…¢ã€‚\nå¦‚æœè¯¥æ•°æ®æºåªæœ‰å½“å‰ç¨‹åºä½¿ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªé‡åˆ†åŒºé¢„å¤„ç†çš„æ“ä½œå°±ç›¸å½“äºåœ¨è¯»å–æ•°æ®æºçš„æ—¶å€™è°ƒç”¨äº†repartitioné‡åˆ†åŒºã€æˆ–è€…ä½¿ç”¨ç±»ä¼¼reduceByKey(500)è°ƒæ•´å¹¶è¡Œåº¦ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰èµ·åˆ°å¤šå°‘ä½œç”¨ã€‚\næ‰€ä»¥ï¼Œé‡åˆ†åŒºé¢„å¤„ç†çš„æ–¹å¼åªæœ‰åœ¨ ä¸€ä¸ªæ•°æ®æºè¢«nå¤šä¸ªç¨‹åºä½¿ç”¨çš„æ—¶å€™æ¯”è¾ƒæœ‰ä»·å€¼ï¼Œä½¿ç”¨çš„ç¨‹åºè¶Šå¤šæ€§ä»·æ¯”è¶Šé«˜ï¼Œå¦åˆ™å°±æ˜¯æ²»æ ‡ä¸æ²»æœ¬ï¼Œæ•ˆæœæœ‰é™ã€‚\né¢„èšåˆ å¦‚æœå‰é¢ä¸¤ç§æ–¹å¼éƒ½æ— æ³•è§£å†³ä½ çš„é—®é¢˜ï¼Œè€Œä¸” äº§ç”Ÿæ•°æ®å€¾æ–œçš„Shuffleæ“ä½œç¬¦æ˜¯èšåˆç±»çš„ï¼ˆgroupã€reduceã€distinctï¼‰ç­‰ï¼Œé‚£ä¹ˆä½ å¯ä»¥å°è¯•ä½¿ç”¨ é¢„èšåˆ çš„æ–¹å¼ã€‚\nè¿˜è®°å¾—Mapreduceçš„Combinerå—ï¼Œè¿˜è®°å¾—reduceByKeyå’ŒgroupByKeyçš„åŒºåˆ«å—ï¼Œä¸è®°å¾—çš„è¯å»ºè®®æµè§ˆä¸€ä¸‹ã€Œå¼€å‘è°ƒä¼˜ã€ä¸­ç®—å­ä¼˜åŒ–æŠ€å·§ã€‚\nMapreduceçš„Combinerå’ŒSparkä¸­çš„reduceByKeyéƒ½ä¼šåœ¨å„ä¸ªèŠ‚ç‚¹çš„æœ¬åœ°åšä¸€æ¬¡é¢„èšåˆã€‚\nç±»ä¼¼çš„ï¼Œå¦‚æœå­˜åœ¨æŸä¸ªkeyå æ®äº†ç»å¤§éƒ¨åˆ†çš„æ•°æ®é‡çš„è¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ æ‰‹åŠ¨é‡‡ç”¨é¢„èšåˆçš„æ–¹å¼æ¥åˆ†æ•£çƒ­ç‚¹æ•°æ®å¹¶æ‰§è¡Œæœ¬åœ°é¢„èšåˆã€‚\nå‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰1000wçš„æ•°æ®ï¼Œå…¶ä¸­800wçš„æ•°æ®éƒ½æ˜¯ç›¸åŒçš„keyï¼Œæ­¤æ—¶æˆ‘ä»¬è¦åšèšåˆæ“ä½œï¼Œé»˜è®¤æƒ…å†µä¸‹800wæ•°æ®ä¼šåˆ°åŒä¸€ä¸ªTaskä¸­å¤„ç†ï¼Œè¿™è‚¯å®šæ˜¯æ— æ³•æ¥å—çš„ã€‚\næ€ä¹ˆæ‰‹åŠ¨åšé¢„èšåˆå‘¢ï¼Ÿ é¦–å…ˆæˆ‘ä»¬å¯ä»¥åœ¨è¿™800wçš„keyä¹‹å‰ æ ¹æ®ä»»æ„hashç®—æ³•æ·»åŠ å›ºå®šé•¿åº¦çš„éšæœºå‰ç¼€ã€‚\nåœ¨ç¬¬ä¸€è½®èšåˆæ—¶ï¼Œè¿™ä¸ªçƒ­ç‚¹keyå°†ä¼šè¢«æ‰“æ•£åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šå»è®¡ç®—ã€‚\nä¹‹åå°†keyä¸Šçš„å›ºå®šé•¿åº¦å‰ç¼€å»é™¤ï¼Œæ‰§è¡Œç¬¬äºŒè½®èšåˆæ“ä½œã€‚\nå› ä¸ºç»è¿‡ç¬¬ä¸€è½®èšåˆä¹‹å çƒ­ç‚¹keyçš„æ•°æ®å·²ç»è¢«å¤„ç†å¾ˆå¤šäº†ï¼Œæ‰€ä»¥åœ¨ç¬¬äºŒè½®èšåˆçš„æ—¶å€™å¯ä»¥æ¯”è¾ƒè½»æ¾çš„å¤„ç†ã€‚\nå½“ç„¶å¦‚æœåœ¨ç¬¬äºŒè½®èšåˆçš„æ—¶å€™ä»ç„¶æœ‰å¾ˆå¤§çš„çƒ­ç‚¹é—®é¢˜ï¼Œé‚£ä¹ˆç†è®ºä¸Šå¯ä»¥ ç»§ç»­æ— é™åšé¢„èšåˆå¤„ç†ã€‚\nä½†æ˜¯é¢„èšåˆçš„ç¼ºé™·ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œåªèƒ½ä¼˜åŒ–èšåˆç±»çš„æ“ä½œï¼Œå¦‚æœæ˜¯joinç­‰å…³è”ç±»çš„Shuffleæ“ä½œåˆ™æ— æ³•ä¼˜åŒ–ã€‚\nä½¿ç”¨å¹¿æ’­å˜é‡ä»£æ›¿join é‚£ä¹ˆç¢°åˆ°joinç±»çš„ç®—å­ä¸”å‘ç”Ÿäº†æ•°æ®å€¾æ–œè¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ\nå…¶å®æˆ‘ä»¬åœ¨ã€Œå¼€å‘è°ƒä¼˜ã€ä¸­å·²ç»æåˆ°è¿‡è§£å†³æ–¹å¼äº†ï¼Œå°±æ˜¯ ä½¿ç”¨å¹¿æ’­å˜é‡æ¥ä»£æ›¿joinæ“ä½œã€‚\nä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¹Ÿæœ‰å¾ˆå¤šé™åˆ¶ï¼Œå°±æ˜¯ åªèƒ½åº”ç”¨äºå¤§è¡¨ join å°è¡¨çš„æƒ…å†µã€‚\nå¤šç§æ–¹æ¡ˆç»„åˆä½¿ç”¨ å¦‚æœä»¥ä¸Šçš„æ–¹æ¡ˆéƒ½æ²¡æœ‰èƒ½å¤Ÿè§£å†³ä½ çš„é—®é¢˜ï¼Œé‚£ä¹ˆä½ å¯ä»¥å°è¯•ç€å°†å¤šç§æ–¹æ¡ˆæ•´åˆèµ·æ¥ä¸€èµ·ä½¿ç”¨ï¼Œå› ä¸ºåœ¨å¤æ‚çš„ä¸šåŠ¡ä¸­ï¼ŒShuffleæ“ä½œç¬¦å¯èƒ½æœ‰å¾ˆå¤šï¼Œé‚£ä¹ˆå¯¹åº”çš„å¯èƒ½äº§ç”Ÿæ•°æ®å€¾æ–œçš„åœ°æ–¹ä¹Ÿæœ‰å¾ˆå¤šã€‚\næ‰€ä»¥éœ€è¦å¼€å‘äººå‘˜èƒ½å¤Ÿæ ¹æ® ä¸šåŠ¡é€»è¾‘ã€æ•°æ®çŠ¶æ€ã€ä»£ç ç¼–å†™ ç­‰æ–¹é¢èƒ½å¤Ÿæ ¹æ®ä¸åŒçš„æƒ…å†µç»„åˆä¸åŒçš„æ–¹æ¡ˆæ¥å®æ–½ä¼˜åŒ–ã€‚\n4. shuffleè°ƒä¼˜ åœ¨ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬ç€é‡ä»‹ç»äº†å¦‚ä½•é’ˆå¯¹ã€Œæ•°æ®å€¾æ–œã€è¿™ä¸€æƒ…å†µè¿›è¡Œä¼˜åŒ–ã€‚\né™¤äº†æ•°æ®å€¾æ–œå¯ä»¥ä¼˜åŒ–ä¹‹å¤–ï¼ŒShuffleè¿‡ç¨‹ä¸­ä»ç„¶æœ‰è®¸å¤šåœ°æ–¹å¯ä»¥ä¼˜åŒ–ã€‚ä½†æ˜¯è¦è®°ä½ï¼Œå½±å“Sparkç¨‹åºæ€§èƒ½çš„ä¸»è¦å› ç´ è¿˜æ˜¯åœ¨äº ä»£ç å¼€å‘ã€èµ„æºå‚æ•°ä¸æ•°æ®å€¾æ–œç­‰ï¼Œå¯¹Shuffleçš„è°ƒæ•´ä¼˜åŒ–å¯èƒ½ä»…ä»…æ˜¯ é”¦ä¸Šæ·»èŠ± è€Œä¸æ˜¯é›ªä¸­é€ç‚­ã€‚\næ‰€ä»¥å¼€å‘äººå‘˜çš„é‡ç‚¹åº”è¯¥æ”¾åœ¨å‰é¢å‡ ä¸ªéƒ¨åˆ†ï¼Œéƒ½ä¼˜åŒ–å®Œäº†ä¹‹åå¯ä»¥è€ƒè™‘å¯¹Shuffleè¿‡ç¨‹è¿›è¡Œä¼˜åŒ–ã€‚\nå¯¹Shuffleçš„ä¼˜åŒ–ä¸»è¦æ˜¯é€šè¿‡è°ƒæ•´ä¸€äº›Shuffleç›¸å…³çš„å‚æ•°æ¥å®ç°ï¼Œä½ å¯ä»¥æ ¹æ®ä½ çš„ä½¿ç”¨æƒ…å†µå’Œç»éªŒå¯¹ä»¥ä¸‹å‚æ•°è¿›è¡Œè°ƒæ•´ï¼š\nspark.Shuffle.file.buffer é»˜è®¤å€¼ï¼š32k å‚æ•°è¯´æ˜ï¼šç”¨äºè®¾ç½®Shuffle write taskçš„BufferedOutputStreamçš„bufferç¼“å†²å¤§å°ã€‚å°†æ•°æ®å†™åˆ°ç£ç›˜æ–‡ä»¶ä¹‹å‰ï¼Œä¼šå…ˆå†™å…¥bufferç¼“å†²ä¸­ï¼Œå¾…ç¼“å†²å†™æ»¡ä¹‹åï¼Œæ‰ä¼šæº¢å†™åˆ°ç£ç›˜ã€‚ è°ƒä¼˜å»ºè®®ï¼šå¦‚æœä½œä¸šå¯ç”¨çš„ å†…å­˜èµ„æºè¾ƒä¸ºå……è¶³ çš„è¯ï¼Œå¯ä»¥ é€‚å½“å¢åŠ è¿™ä¸ªå‚æ•°çš„å¤§å°ï¼Œä»è€Œå‡å°‘Shuffle writeè¿‡ç¨‹ä¸­æº¢å†™ç£ç›˜æ–‡ä»¶çš„æ¬¡æ•°ï¼Œä¹Ÿå°±å¯ä»¥å‡å°‘ç£ç›˜IOæ¬¡æ•°ï¼Œè¿›è€Œæå‡æ€§èƒ½ã€‚ spark.reducer.maxSizeInFlight é»˜è®¤å€¼ï¼š48m å‚æ•°è¯´æ˜ï¼šç”¨äºè®¾ç½®Shuffle read taskçš„bufferç¼“å†²å¤§å°ï¼Œè€Œè¿™ä¸ªbufferç¼“å†²å†³å®šäº†æ¯æ¬¡èƒ½å¤Ÿæ‹‰å–å¤šå°‘æ•°æ®ã€‚ è°ƒä¼˜å»ºè®®ï¼šå¦‚æœä½œä¸šå¯ç”¨çš„ å†…å­˜èµ„æºè¾ƒä¸ºå……è¶³ çš„è¯ï¼Œå¯ä»¥ é€‚å½“å¢åŠ è¿™ä¸ªå‚æ•°çš„å¤§å°ï¼Œä»è€Œå‡å°‘æ‹‰å–æ•°æ®çš„æ¬¡æ•°ï¼Œä¹Ÿå°±å¯ä»¥å‡å°‘ç½‘ç»œä¼ è¾“çš„æ¬¡æ•°ï¼Œè¿›è€Œæå‡æ€§èƒ½ã€‚ spark.Shuffle.io.maxRetries é»˜è®¤å€¼ï¼š3 å‚æ•°è¯´æ˜ï¼šShuffle read taskä»Shuffle write taskæ‰€åœ¨èŠ‚ç‚¹æ‹‰å–å±äºè‡ªå·±çš„æ•°æ®æ—¶ï¼Œå¦‚æœå› ä¸ºç½‘ç»œå¼‚å¸¸å¯¼è‡´æ‹‰å–å¤±è´¥ï¼Œæ˜¯ä¼šè‡ªåŠ¨è¿›è¡Œé‡è¯•çš„ã€‚è¯¥å‚æ•°å°±ä»£è¡¨äº†å¯ä»¥é‡è¯•çš„æœ€å¤§æ¬¡æ•°ã€‚å¦‚æœåœ¨æŒ‡å®šæ¬¡æ•°ä¹‹å†…æ‹‰å–è¿˜æ˜¯æ²¡æœ‰æˆåŠŸï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´ä½œä¸šæ‰§è¡Œå¤±è´¥ã€‚ è°ƒä¼˜å»ºè®®ï¼šå¯¹äºé‚£äº›åŒ…å«äº† ç‰¹åˆ«è€—æ—¶çš„Shuffleæ“ä½œçš„ä½œä¸šï¼Œå»ºè®® å¢åŠ é‡è¯•æœ€å¤§æ¬¡æ•°ï¼ˆæ¯”å¦‚60æ¬¡ï¼‰ï¼Œä»¥é¿å… ç”±äºJVMçš„full gcæˆ–è€…ç½‘ç»œä¸ç¨³å®šç­‰å› ç´ å¯¼è‡´çš„æ•°æ®æ‹‰å–å¤±è´¥ï¼Œä¸»è¦æå‡å¤§å‹ä»»åŠ¡çš„æ‰§è¡Œç¨³å®šæ€§ã€‚ spark.Shuffle.io.retryWait é»˜è®¤å€¼ï¼š5s å‚æ•°è¯´æ˜ï¼šå…·ä½“è§£é‡ŠåŒä¸Šï¼Œè¯¥å‚æ•°ä»£è¡¨äº†æ¯æ¬¡é‡è¯•æ‹‰å–æ•°æ®çš„ç­‰å¾…é—´éš”ï¼Œé»˜è®¤æ˜¯5sã€‚ è°ƒä¼˜å»ºè®®ï¼šå»ºè®® åŠ å¤§é—´éš”æ—¶é•¿ï¼ˆæ¯”å¦‚60sï¼‰ï¼Œä»¥å¢åŠ Shuffleæ“ä½œçš„ç¨³å®šæ€§ã€‚ spark.Shuffle.manager é»˜è®¤å€¼ï¼šsort å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®ShuffleManagerçš„ç±»å‹ã€‚ è°ƒä¼˜å»ºè®®ï¼šç”±ã€ŒShuffleè¿‡ç¨‹ä¸ç®¡ç†ã€ä¸­å¯ä»¥çŸ¥é“ï¼ŒSortShuffleManageré»˜è®¤ä¼šå¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œå¦‚æœç¨‹åºä¸­éœ€è¦æ’åºï¼Œé‚£ä¹ˆä½¿ç”¨é»˜è®¤å³å¯ï¼›å¦‚æœç¨‹åºä¸­ä¸éœ€è¦æ’åºï¼Œé‚£ä¹ˆå»ºè®® å¢å¤§bypassçš„é˜ˆå€¼ä»¥è§¦å‘bypassæœºåˆ¶æˆ–è€…å°†managerè°ƒæ•´ä¸ºhashï¼Œé¿å…æ’åºå¸¦æ¥çš„å¼€é”€ï¼ŒåŒæ—¶æä¾›è¾ƒå¥½çš„ç£ç›˜è¯»å†™æ€§èƒ½ã€‚ spark.shuffle.sort.bypassMergeThreshold é»˜è®¤å€¼ï¼š200 å‚æ•°è¯´æ˜ï¼šå½“managerä¸ºsortï¼Œä¸”Shuffle read taskçš„æ•°é‡å°äºè¿™ä¸ªé˜ˆå€¼æ—¶ï¼Œå°†ä¼šä½¿ç”¨bypassæœºåˆ¶ã€‚ è°ƒä¼˜å»ºè®®ï¼šä½¿ç”¨sort manageræ—¶ï¼Œå¦‚æœä¸éœ€è¦æ’åºï¼Œé‚£ä¹ˆå°±é€‚å½“å¢åŠ è¿™ä¸ªå€¼ï¼Œå¤§äºShuffle read taskçš„æ•°é‡ã€‚ spark.shuffle.consolidateFiles é»˜è®¤å€¼ï¼šfalse å‚æ•°è¯´æ˜ï¼šå¦‚æœä½¿ç”¨hash managerï¼Œè¯¥å‚æ•°æœ‰æ•ˆã€‚å¦‚æœè®¾ç½®ä¸ºtrueï¼Œé‚£ä¹ˆå°±ä¼šå¼€å¯ consolidateæœºåˆ¶ï¼Œå¯ä»¥æå¤§åœ°å‡å°‘ç£ç›˜IOå¼€é”€ï¼Œæå‡æ€§èƒ½ã€‚ è°ƒä¼˜å»ºè®®ï¼šåœ¨ä¸éœ€è¦æ’åºçš„æƒ…å†µä¸‹ï¼Œé™¤äº†ä½¿ç”¨sort managerè§¦å‘bypassæœºåˆ¶å¤–ï¼Œä½¿ç”¨ hash manager + consolidateæœºåˆ¶ä¹Ÿæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„é€‰æ‹©ï¼Œå»ºè®®ä½¿ç”¨æ­¤ç»„åˆã€‚ æ›´å¤šå‚è€ƒï¼š ç¾å›¢sparkè°ƒä¼˜ ","permalink":"https://reid00.github.io/en/posts/computation/spark-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E6%8C%87%E5%8D%97/","summary":"ç®€ä»‹ æ€»ä½“ä¸Šæ¥è¯´ï¼ŒSparkçš„æµç¨‹å’ŒMapReduceçš„æ€æƒ³å¾ˆç±»ä¼¼ï¼Œåªæ˜¯å®ç°çš„ç»†èŠ‚æ–¹é¢ä¼šæœ‰å¾ˆå¤šå·®å¼‚ã€‚ é¦–å…ˆæ¾„æ¸…2ä¸ªå®¹æ˜“è¢«æ··æ·†çš„æ¦‚å¿µï¼š\nSparkæ˜¯åŸºäºå†…å­˜è®¡ç®—çš„æ¡†æ¶ Sparkæ¯”Hadoopå¿«100å€ ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ä¸ªä¼ªå‘½é¢˜ã€‚ ä»»ä½•ç¨‹åºéƒ½éœ€è¦é€šè¿‡å†…å­˜æ¥æ‰§è¡Œï¼Œä¸è®ºæ˜¯å•æœºç¨‹åºè¿˜æ˜¯åˆ†å¸ƒå¼ç¨‹åºã€‚ Sparkä¼šè¢«ç§°ä¸º åŸºäºå†…å­˜è®¡ç®—çš„æ¡†æ¶ ï¼Œä¸»è¦åŸå› åœ¨äºå…¶å’Œä¹‹å‰çš„åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶å¾ˆå¤§ä¸åŒçš„ä¸€ç‚¹æ˜¯ï¼ŒShuffleçš„æ•°æ®é›†ä¸éœ€è¦é€šè¿‡è¯»å†™ç£ç›˜æ¥è¿›è¡Œäº¤æ¢ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡å†…å­˜äº¤æ¢æ•°æ®å¾—åˆ°ã€‚æ•ˆç‡æ¯”è¯»å†™ç£ç›˜çš„MapReduceé«˜ä¸Šå¥½å¤šå€ï¼Œæ‰€ä»¥å¾ˆå¤šäººç§°ä¹‹ä¸º åŸºäºå†…å­˜çš„è®¡ç®—æ¡†æ¶ï¼Œå…¶å®æ›´åº”è¯¥ç§°ä¸º åŸºäºå†…å­˜è¿›è¡Œæ•°æ®äº¤æ¢çš„è®¡ç®—æ¡†æ¶ã€‚\nè‡³äºç¬¬äºŒä¸ªé—®é¢˜ï¼Œæœ‰åŒå­¦è¯´ï¼ŒSparkå®˜ç½‘ å°±æ˜¯è¿™ä¹ˆä»‹ç»çš„å‘€ï¼ŒSpark run workloads 100x faster than Hadoopã€‚\nè¿™ç‚¹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯è¯·æ³¨æ„å®˜ç½‘ç”¨æ¥æ¯”è¾ƒçš„ workload æ˜¯ Logistic regresstionã€‚ æ³¨æ„åˆ°äº†å—ï¼Œè¿™æ˜¯ä¸€ä¸ªéœ€è¦åå¤è¿­ä»£è®¡ç®—çš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼ŒSparkæ˜¯éå¸¸æ“…é•¿åœ¨è¿™ç§éœ€è¦åå¤è¿­ä»£è®¡ç®—çš„åœºæ™¯ä¸­ï¼ˆè§é—®é¢˜1ï¼‰ï¼Œè€ŒHadoop MapReduceæ¯æ¬¡è¿­ä»£éƒ½éœ€è¦è¯»å†™ä¸€æ¬¡HDFSã€‚ä»¥å·±ä¹‹é•¿ï¼Œå‡»äººä¹‹çŸ­ å·®è·å¯å‘è€ŒçŸ¥ã€‚\nå¦‚æœéƒ½åªæ˜¯è·‘ä¸€ä¸ªç®€å•çš„è¿‡æ»¤åœºæ™¯çš„ workloadï¼Œé‚£ä¹ˆæ€§èƒ½å·®è·ä¸ä¼šæœ‰è¿™ä¹ˆå¤šï¼Œæ€»ä½“ä¸Šæ˜¯ä¸€ä¸ªçº§åˆ«çš„è€—æ—¶ã€‚\næ‰€ä»¥åƒä¸‡ä¸è¦åœ¨ä»»ä½•åœºæ™¯ä¸­éƒ½è¯´ Sparkæ˜¯åŸºäºå†…å­˜çš„è®¡ç®—ã€Sparkæ¯”Hadoopå¿«100å€ï¼Œè¿™éƒ½æ˜¯ä¸ä¸¥è°¨çš„è¯´æ³•ã€‚\né€»è¾‘æ‰§è¡Œå›¾ 1. å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›† RDDæ˜¯Sparkä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼Œç›´è¯‘è¿‡æ¥å«åš å¼¹æ€§åˆ†å¸ƒå¼æ•°æ®é›†ã€‚\næ‰€æœ‰çš„RDDè¦ä¹ˆæ˜¯ä»å¤–éƒ¨æ•°æ®æºåˆ›å»ºçš„ï¼Œè¦ä¹ˆæ˜¯ä»å…¶ä»–RDDè½¬æ¢è¿‡æ¥çš„ã€‚RDDæœ‰ä¸¤ç§äº§ç”Ÿæ–¹å¼ï¼š\nä»å¤–éƒ¨æ•°æ®æºä¸­åˆ›å»º ä»ä¸€ä¸ªRDDä¸­è½¬æ¢è€Œæ¥ ä½ å¯ä»¥æŠŠå®ƒå½“åšä¸€ä¸ªListï¼Œä½†æ˜¯è¿™ä¸ªListé‡Œé¢çš„å…ƒç´ æ˜¯åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ä¸Šçš„ï¼Œå¯¹Listçš„æ‰€æœ‰æ“ä½œéƒ½å°†è¢«åˆ†å‘åˆ°ä¸åŒçš„æœºå™¨ä¸Šæ‰§è¡Œã€‚ RDDå°±æ˜¯æˆ‘ä»¬éœ€è¦æ“ä½œçš„æ•°æ®é›†ï¼Œå¹¶è§£å†³äº† æ•°æ®åœ¨å“ªå„¿ è¿™ä¸ªé—®é¢˜ã€‚ æœ‰äº†æ•°æ®ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰åœ¨æ•°æ®é›†ä¸Šçš„æ“ä½œï¼ˆå³ä¸šåŠ¡é€»è¾‘ï¼‰ã€‚ å›æƒ³ä¸€ä¸‹æˆ‘ä»¬ä¹‹å‰ç»å†çš„æµç¨‹ï¼š\nä¸€å¼€å§‹æˆ‘ä»¬ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œåªæœ‰åˆ†æ•£åœ¨å„ä¸ªæœåŠ¡å™¨ä¸Šçš„æ—¥å¿—æ•°æ®ï¼Œå¹¶ä¸”é€šè¿‡ä¸€ä¸ªç®€å•çš„è„šæœ¬éå†è¿æ¥æœåŠ¡å™¨ï¼Œæ‰§è¡Œç›¸å…³çš„ç»Ÿè®¡é€»è¾‘ æˆ‘ä»¬æ¥è§¦äº†MapReduceè®¡ç®—æ¡†æ¶ï¼Œå¹¶å®šä¹‰äº†Mapå’ŒReduceçš„å‡½æ•°æ¥å£æ¥å®ç°è®¡ç®—é€»è¾‘ï¼Œä»è€Œç”¨æˆ·ä¸æ¯”å…³å¿ƒè®¡ç®—é€»è¾‘æ‹†åˆ†ä¸åˆ†å‘ç­‰åº•å±‚é—®é¢˜ è™½ç„¶MapReduceå·²ç»è§£å†³äº†æˆ‘ä»¬åˆ†å¸ƒå¼è®¡ç®—çš„éœ€æ±‚ï¼Œä½†æ˜¯å…¶ç¼–ç¨‹èŒƒå¼åªæœ‰mapå’Œreduceä¸¤ä¸ªæ¥å£ï¼Œä½¿ç”¨ä¸çµæ´»ã€‚\nåœ¨Sparkä¸­ï¼ŒRDDæä¾›äº†æ¯”MapReduceç¼–ç¨‹æ¨¡å‹ä¸°å¯Œå¾—å¤šçš„ç¼–ç¨‹æ¥å£ï¼Œå¦‚ï¼šfilterã€mapã€groupByç­‰éƒ½å¯ä»¥ç›´æ¥è°ƒç”¨å®ç°ï¼ˆè¿™äº›æ“ä½œæœ¬è´¨ä¸Šä¹Ÿåˆ’åˆ†ä¸ºMapå’ŒReduceä¸¤ç§ç±»å‹ï¼‰ã€‚\nç°åœ¨ï¼Œç»Ÿè®¡PVçš„ä¾‹å­ä¸­å®ç°è®¡ç®—é€»è¾‘çš„ä¼ªä»£ç å¯ä»¥è¿™ä¹ˆå†™ï¼š\n1 2 3 4 5 6 7 8 9 10 // ä»å¤–éƒ¨æ•°æ®æºä¸­åˆ›å»ºRDDï¼Œå³è¯»å–æ—¥å¿—æ•°æ® val rdd = sc.textFile(\u0026#34;...\u0026#34;) // è§£ææ—¥å¿—ä¸­çš„ip rdd.map(...) // æ ¹æ®ipåˆ†ç»„ .","title":"Spark æœ€ä½³å®è·µæŒ‡å—"},{"content":"åŸºç¡€ç¯‡ sparksql å¦‚ä½•åŠ è½½metadata ä»»ä½•çš„SQLå¼•æ“éƒ½æ˜¯éœ€è¦åŠ è½½å…ƒæ•°æ®çš„ï¼Œä¸ç„¶ï¼Œè¿æ‰§è¡Œè®¡åˆ’éƒ½ç”Ÿæˆä¸äº†ã€‚ åŠ è½½å…ƒæ•°æ®æ€»çš„æ¥è¯´åˆ†ä¸ºä¸¤æ­¥:\nåŠ è½½å…ƒæ•°æ® åˆ›å»ºä¼šè¯è¿æ¥Hive MetaStore é¦–å…ˆï¼ŒSparkæ£€æµ‹åˆ°æˆ‘ä»¬æ²¡æœ‰è®¾ç½®spark.sql.warehouse.dirï¼Œç„¶åå°±å¼€å§‹æ‰¾æˆ‘ä»¬åœ¨hite-site.xmlä¸­é…ç½®çš„hive.metastore.warehouse.dirã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hive.metastore.uris\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;thrift://test-3:9083,thrift://test-4:9083\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hive.metastore.client.socket.timeout\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;300\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hive.metastore.warehouse.dir\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;/data/hive/warehouse\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hive.warehouse.subdir.inherit.perms\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;true\u0026lt;/value\u0026gt; ç„¶åï¼ŒSparkSessionåœ¨HDFSä¸´æ—¶ä½ç½®åˆ›å»ºäº†ä¸‹é¢ç›®å½•ã€‚\n1 2 Moved: \u0026#39;hdfs://nn1/data/hive/warehouse/pyspark_test.db/tb_name/part-00000-c46bc573-0d1d-4ac4-8a69-2359dff82485-c000\u0026#39; to trash at: hdfs://nn1/user/hive/.Trash/Current Moved: \u0026#39;hdfs://nn1/data/hive/warehouse/pyspark_test.db/tb_name/part-00001-c46bc573-0d1d-4ac4-8a69-2359dff82485-c000\u0026#39; to trash at: hdfs://nn1/user/hive/.Trash/Current æœ€åï¼ŒSparkå¼€å§‹é€šè¿‡thrift RPCå»è¿æ¥Hiveçš„MetaStore Serverã€‚\nè¿›é˜¶ç¯‡ Sparkä¸ºä»€ä¹ˆè¿™ä¹ˆå¿« Sparkæ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„ï¼Œç”¨äºå¤§è§„æ¨¡æ•°æ®å¤„ç†çš„ç»Ÿä¸€åˆ†æå¼•æ“ï¼Œå…¶è¿ç®—é€Ÿåº¦å¯ä»¥è¾¾åˆ°Mapreduceçš„10-100å€ã€‚å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š\nå†…å­˜è®¡ç®—ã€‚Sparkä¼˜å…ˆå°†æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ•°æ®å¯ä»¥è¢«å¿«é€Ÿå¤„ç†ï¼Œå¹¶å¯å¯ç”¨ç¼“å­˜ã€‚ shuffleè¿‡ç¨‹ä¼˜åŒ–ã€‚å’ŒMapreduceçš„shuffleè¿‡ç¨‹ä¸­é—´æ–‡ä»¶é¢‘ç¹è½ç›˜ä¸åŒï¼ŒSparkå¯¹Shuffleæœºåˆ¶è¿›è¡Œäº†ä¼˜åŒ–ï¼Œé™ä½ä¸­é—´æ–‡ä»¶çš„æ•°é‡å¹¶ä¿è¯å†…å­˜ä¼˜å…ˆã€‚ RDDè®¡ç®—æ¨¡å‹ã€‚Sparkå…·æœ‰é«˜æ•ˆçš„DAGè°ƒåº¦ç®—æ³•ï¼ŒåŒæ—¶å°†RDDè®¡ç®—ç»“æœå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚ å¦‚ä½•ç†è§£DAGSchedulerçš„Stageåˆ’åˆ†ç®—æ³• å®˜ç½‘çš„RDDæ‰§è¡Œæµç¨‹å›¾: 1 rdd1.join(rdd2).groupBy().filter() é’ˆå¯¹ä¸€æ®µåº”ç”¨ä»£ç (å¦‚ä¸Š)ï¼ŒDriverä¼šä»¥Actionç®—å­ä¸ºè¾¹ç•Œç”ŸæˆDAGè°ƒåº¦å›¾ã€‚DAGSchedulerä»DAGæœ«ç«¯å¼€å§‹éå†åˆ’åˆ†Stageï¼Œå°è£…æˆä¸€ç³»åˆ—çš„tasksetsç§»äº¤TaskSchedulerï¼Œåè€…æ ¹æ®è°ƒåº¦ç®—æ³•, å°†tasksetåˆ†å‘åˆ°ç›¸åº”workerä¸Šçš„Executorä¸­æ‰§è¡Œã€‚\nDAGSchdulerçš„å·¥ä½œåŸç† DAGScheduleræ˜¯ä¸€ä¸ªé¢å‘stageè°ƒåº¦æœºåˆ¶çš„é«˜çº§è°ƒåº¦å™¨ï¼Œä¸ºæ¯ä¸ªjobè®¡ç®—stageçš„DAG(æœ‰å‘æ— ç¯å›¾)ï¼Œåˆ’åˆ†stageå¹¶æäº¤tasksetç»™TaskSchedulerã€‚ è¿½è¸ªæ¯ä¸ªRDDå’Œstageçš„ç‰©åŒ–æƒ…å†µï¼Œå¤„ç†å› shuffleè¿‡ç¨‹ä¸¢å¤±çš„RDDï¼Œé‡æ–°è®¡ç®—å’Œæäº¤ã€‚ æŸ¥æ‰¾rdd partition æ˜¯å¦cache/checkpointã€‚æä¾›ä¼˜å…ˆä½ç½®ç»™TaskSchedulerï¼Œç­‰å¾…åç»­TaskSchedulerçš„æœ€ä½³ä½ç½®åˆ’åˆ† Stageåˆ’åˆ†ç®—æ³• ä»è§¦å‘actionæ“ä½œçš„ç®—å­å¼€å§‹ï¼Œä»åå¾€å‰éå†DAGã€‚ ä¸ºæœ€åä¸€ä¸ªrddåˆ›å»ºfinalStageã€‚ éå†è¿‡ç¨‹ä¸­å¦‚æœå‘ç°è¯¥rddæ˜¯å®½ä¾èµ–ï¼Œåˆ™ä¸ºå…¶ç”Ÿæˆä¸€ä¸ªæ–°çš„stageï¼Œä¸æ—§stageåˆ†éš”è€Œå¼€ï¼Œæ­¤æ—¶è¯¥rddæ˜¯æ–°stageçš„æœ€åä¸€ä¸ªrddã€‚ å¦‚æœè¯¥rddæ˜¯çª„ä¾èµ–ï¼Œå°†è¯¥rddåˆ’åˆ†ä¸ºæ—§stageå†…ï¼Œç»§ç»­éå†ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç»§ç»­éå†ç›´è‡³DAGå®Œæˆã€‚ å¦‚ä½•ç†è§£TaskSchedulerçš„Taskåˆ†é…ç®—æ³• TaskSchedulerè´Ÿè´£Sparkä¸­çš„taskä»»åŠ¡è°ƒåº¦å·¥ä½œã€‚TaskSchedulerå†…éƒ¨ä½¿ç”¨TasksetPoolè°ƒåº¦æ± æœºåˆ¶å­˜æ”¾taskä»»åŠ¡ã€‚TasksetPoolåˆ†ä¸ºFIFO(å…ˆè¿›å…ˆå‡ºè°ƒåº¦)å’ŒFAIR(å…¬å¹³è°ƒåº¦)ã€‚ FIFOè°ƒåº¦: åŸºäºé˜Ÿåˆ—æ€æƒ³ï¼Œä½¿ç”¨å…ˆè¿›å…ˆå‡ºåŸåˆ™é¡ºåºè°ƒåº¦taskset FAIRè°ƒåº¦: æ ¹æ®æƒé‡å€¼è°ƒåº¦ï¼Œä¸€èˆ¬é€‰å–èµ„æºå ç”¨ç‡ä½œä¸ºæ ‡å‡†ï¼Œå¯äººä¸ºè®¾å®š TaskSchedulerçš„å·¥ä½œåŸç† è´Ÿè´£Applicationåœ¨Cluster Managerä¸Šçš„æ³¨å†Œ æ ¹æ®ä¸åŒç­–ç•¥åˆ›å»ºTasksetPoolèµ„æºè°ƒåº¦æ± ï¼Œåˆå§‹åŒ–poolå¤§å° æ ¹æ®taskåˆ†é…ç®—æ³•å‘é€Taskåˆ°Executorä¸Šæ‰§è¡Œ Taskåˆ†é…ç®—æ³• é¦–å…ˆè·å–æ‰€æœ‰çš„executorsï¼ŒåŒ…å«executorsçš„ipå’Œportç­‰ä¿¡æ¯ å°†æ‰€æœ‰çš„executorsæ ¹æ®shuffleç®—æ³•è¿›è¡Œæ‰“æ•£ éå†executorsã€‚åœ¨ç¨‹åºä¸­ä¾æ¬¡å°è¯•æœ¬åœ°åŒ–çº§åˆ«ï¼Œæœ€ç»ˆé€‰æ‹©æ¯ä¸ªtaskçš„æœ€ä¼˜ä½ç½®(ç»“åˆDAGSchedulerä¼˜åŒ–ä½ç½®ç­–ç•¥) åºåˆ—åŒ–taskåˆ†é…ç»“æœï¼Œå¹¶å‘é€RPCæ¶ˆæ¯ç­‰å¾…Executorå“åº” Sparkçš„æœ¬åœ°åŒ–çº§åˆ«æœ‰å“ªå‡ ç§ï¼Ÿæ€ä¹ˆè°ƒä¼˜ ç§»åŠ¨è®¡ç®— or ç§»åŠ¨æ•°æ®ï¼Ÿè¿™æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚åœ¨åˆ†å¸ƒå¼è®¡ç®—çš„æ ¸å¿ƒæ€æƒ³ä¸­ï¼Œç§»åŠ¨è®¡ç®—æ°¸è¿œæ¯”ç§»åŠ¨æ•°æ®è¦åˆç®—å¾—å¤šï¼Œå¦‚ä½•åˆç†åˆ©ç”¨æœ¬åœ°åŒ–æ•°æ®è®¡ç®—æ˜¯å€¼å¾—æ€è€ƒçš„ä¸€ä¸ªé—®é¢˜ã€‚\nTaskScheduleråœ¨è¿›è¡Œtaskä»»åŠ¡åˆ†é…æ—¶ï¼Œéœ€è¦æ ¹æ®æœ¬åœ°åŒ–çº§åˆ«è®¡ç®—æœ€ä¼˜ä½ç½®ï¼Œä¸€èˆ¬æ˜¯éµå¾ªå°±è¿‘åŸåˆ™ï¼Œé€‰æ‹©æœ€è¿‘ä½ç½®å’Œç¼“å­˜ã€‚Sparkä¸­çš„æœ¬åœ°åŒ–çº§åˆ«åœ¨TaskManagerä¸­å®šä¹‰ï¼Œåˆ†ä¸ºäº”ä¸ªçº§åˆ«ã€‚\nSparkæœ¬åœ°åŒ–çº§åˆ« PROCESS_LOCAL(è¿›ç¨‹æœ¬åœ°åŒ–) partitionå’Œtaskåœ¨åŒä¸€ä¸ªexecutorä¸­ï¼Œtaskåˆ†é…åˆ°æœ¬åœ°Executorè¿›ç¨‹ã€‚ NODE_LOCAL(èŠ‚ç‚¹æœ¬åœ°åŒ–) partitionå’Œtaskåœ¨åŒä¸€ä¸ªèŠ‚ç‚¹çš„ä¸åŒExecutorè¿›ç¨‹ä¸­ï¼Œå¯èƒ½å‘ç”Ÿè·¨è¿›ç¨‹æ•°æ®ä¼ è¾“ NO_PREF(æ— ä½ç½®) æ²¡æœ‰æœ€ä½³ä½ç½®çš„è¦æ±‚ï¼Œæ¯”å¦‚Sparkè¯»å–JDBCçš„æ•°æ®\nRACK_LOCAL(æœºæ¶æœ¬åœ°åŒ–) partitionå’Œtaskåœ¨åŒä¸€ä¸ªæœºæ¶çš„ä¸åŒworkerèŠ‚ç‚¹ä¸Šï¼Œå¯èƒ½éœ€è¦è·¨æœºå™¨æ•°æ®ä¼ è¾“ ANY(è·¨æœºæ¶): æ•°æ®åœ¨ä¸åŒæœºæ¶ä¸Šï¼Œé€Ÿåº¦æœ€æ…¢\nSparkæœ¬åœ°åŒ–è°ƒä¼˜ åœ¨taskæœ€ä½³ä½ç½®çš„é€‰æ‹©ä¸Šï¼ŒDAGSchedulerå…ˆåˆ¤æ–­RDDæ˜¯å¦æœ‰cache/checkpointï¼Œå³ç¼“å­˜ä¼˜å…ˆï¼›å¦åˆ™TaskSchedulerè¿›è¡Œæœ¬åœ°çº§åˆ«é€‰æ‹©ç­‰å¾…å‘é€taskã€‚ TaskScheduleré¦–å…ˆä¼šæ ¹æ®æœ€é«˜æœ¬åœ°åŒ–çº§åˆ«å‘é€taskï¼Œå¦‚æœåœ¨å°è¯•5æ¬¡å¹¶ç­‰å¾…3så†…è¿˜æ˜¯æ— æ³•æ‰§è¡Œï¼Œåˆ™è®¤ä¸ºå½“å‰èµ„æºä¸è¶³ï¼Œå³é™ä½æœ¬åœ°åŒ–çº§åˆ«ï¼ŒæŒ‰ç…§PROCESS-\u0026gt;NODE-\u0026gt;RACKç­‰é¡ºåºã€‚\nè°ƒä¼˜1ï¼šåŠ å¤§spark.locality.wait å…¨å±€ç­‰å¾…æ—¶é•¿ è°ƒä¼˜2ï¼šåŠ å¤§spark.locality.wait.xxç­‰å¾…æ—¶é•¿(è¿›ç¨‹ã€èŠ‚ç‚¹ã€æœºæ¶) è°ƒä¼˜3ï¼šåŠ å¤§é‡è¯•æ¬¡æ•°(æ ¹æ®å®é™…æƒ…å†µå¾®è°ƒ) è¯´è¯´Sparkå’ŒMapreduceä¸­Shuffleçš„åŒºåˆ« Sparkä¸­çš„shuffleå¾ˆå¤šè¿‡ç¨‹ä¸MapReduceçš„shuffleç±»ä¼¼ï¼Œéƒ½æœ‰Mapè¾“å‡ºç«¯ã€Reduceç«¯ï¼Œshuffleè¿‡ç¨‹é€šè¿‡å°†Mapç«¯è®¡ç®—ç»“æœåˆ†åŒºã€æ’åºå¹¶å‘é€åˆ°Reducerç«¯ã€‚\n1. Hadoop Mapreduce Shuffle MapReduceçš„shuffleéœ€è¦ä¾èµ–å¤§é‡ç£ç›˜æ“ä½œï¼Œæ•°æ®ä¼šé¢‘ç¹è½ç›˜äº§ç”Ÿå¤§é‡IOï¼ŒåŒæ—¶äº§ç”Ÿå¤§é‡å°æ–‡ä»¶å†—ä½™ã€‚è™½ç„¶ç¼“å­˜bufferåŒºä¸­å¯ç”¨äº†ç¼“å­˜æœºåˆ¶ï¼Œä½†æ˜¯é˜ˆå€¼è¾ƒä½ä¸”å†…å­˜ç©ºé—´å°ã€‚\nè¯»å–è¾“å…¥æ•°æ®ï¼Œå¹¶æ ¹æ®splitå¤§å°åˆ‡åˆ†ä¸ºmapä»»åŠ¡ mapä»»åŠ¡åœ¨åˆ†å¸ƒå¼èŠ‚ç‚¹ä¸­æ‰§è¡Œmap()è®¡ç®— æ¯ä¸ªmap taskç»´æŠ¤ä¸€ä¸ªç¯å½¢çš„bufferç¼“å­˜åŒºï¼Œå­˜å‚¨mapè¾“å‡ºç»“æœï¼Œåˆ†åŒºä¸”æ’åº å½“bufferåŒºåŸŸè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå¼€å§‹æº¢å†™åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­ã€‚map taskä»»åŠ¡ç»“æŸæ—¶è¿›è¡Œä¸´æ—¶æ–‡ä»¶åˆå¹¶ã€‚æ­¤æ—¶ï¼Œæ•´åˆshuffle mapç«¯æ‰§è¡Œå®Œæˆ mapreduceæ ¹æ®partitionæ•°å¯åŠ¨reduceä»»åŠ¡ï¼Œcopyæ‹‰å–æ•°æ® mergeåˆå¹¶æ‹‰å–çš„æ–‡ä»¶ reduce()å‡½æ•°èšåˆè®¡ç®—ï¼Œæ•´ä¸ªè¿‡ç¨‹å®Œæˆ 2. Sparkçš„Shuffleæœºåˆ¶ é»˜è®¤çš„shuffleè®¡ç®—å¼•æ“æ˜¯HashShuffleManagerï¼Œæ­¤ç§Shuffleäº§ç”Ÿå¤§é‡çš„ä¸­é—´ç£ç›˜æ–‡ä»¶ï¼Œæ¶ˆè€—ç£ç›˜IOæ€§èƒ½ã€‚åœ¨Spark1.2åç»­ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤çš„ShuffleManageræ”¹æˆäº†SortShuffleManagerï¼Œé€šè¿‡ç´¢å¼•æœºåˆ¶å’Œåˆå¹¶ä¸´æ—¶æ–‡ä»¶çš„ä¼˜åŒ–æ“ä½œï¼Œå¤§å¹…æé«˜shuffleæ€§èƒ½ã€‚ HashShuffleManager HashShuffleManagerçš„è¿è¡Œæœºåˆ¶ä¸»è¦åˆ†æˆä¸¤ç§ï¼Œä¸€ç§æ˜¯æ™®é€šè¿è¡Œæœºåˆ¶ï¼Œå¦ä¸€ç§æ˜¯åˆå¹¶çš„è¿è¡Œæœºåˆ¶ã€‚åˆå¹¶æœºåˆ¶ä¸»è¦æ˜¯é€šè¿‡å¤ç”¨bufferæ¥ä¼˜åŒ–Shuffleè¿‡ç¨‹ä¸­äº§ç”Ÿçš„å°æ–‡ä»¶çš„æ•°é‡ï¼ŒHash shuffleæœ¬èº«ä¸æ’åºã€‚å¼€å¯åˆå¹¶æœºåˆ¶åï¼ŒåŒä¸€ä¸ªExecutorå…±ç”¨ä¸€ç»„coreï¼Œæ–‡ä»¶ä¸ªæ•°ä¸ºcores * reducesã€‚ SortShuffleManager SortShuffleManagerçš„è¿è¡Œæœºåˆ¶åˆ†æˆä¸¤ç§ï¼Œæ™®é€šè¿è¡Œæœºåˆ¶å’Œbypassè¿è¡Œæœºåˆ¶ã€‚å½“shuffletaskçš„æ•°é‡å°äºç­‰äºspark.shuffle.sort.bypassMergeThresholdå‚æ•°çš„å€¼æ—¶(é»˜è®¤200)ï¼Œä¼šå¯ç”¨bypassæœºåˆ¶ã€‚\næ™®é€šè¿è¡Œæœºåˆ¶ åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œæ•°æ®ä¼šå…ˆå†™å…¥ä¸€ä¸ªå†…å­˜æ•°æ®ç»“æ„ä¸­ï¼Œæ­¤æ—¶æ ¹æ®ä¸åŒçš„ shuffle ç®—å­ï¼Œå¯èƒ½é€‰ç”¨ä¸åŒçš„æ•°æ®ç»“æ„ã€‚å¦‚æœæ˜¯ reduceByKey è¿™ç§èšåˆç±»çš„ shuffle ç®—å­ï¼Œé‚£ä¹ˆä¼šé€‰ç”¨ Map æ•°æ®ç»“æ„ï¼Œä¸€è¾¹é€šè¿‡ Map è¿›è¡Œèšåˆï¼Œä¸€è¾¹å†™å…¥å†…å­˜ï¼›å¦‚æœæ˜¯ join è¿™ç§æ™®é€šçš„ shuffle ç®—å­ï¼Œé‚£ä¹ˆä¼šé€‰ç”¨ Array æ•°æ®ç»“æ„ï¼Œç›´æ¥å†™å…¥å†…å­˜ã€‚æ¥ç€ï¼Œæ¯å†™ä¸€æ¡æ•°æ®è¿›å…¥å†…å­˜æ•°æ®ç»“æ„ä¹‹åï¼Œå°±ä¼šåˆ¤æ–­ä¸€ä¸‹ï¼Œæ˜¯å¦è¾¾åˆ°äº†æŸä¸ªä¸´ç•Œé˜ˆå€¼ã€‚å¦‚æœè¾¾åˆ°ä¸´ç•Œé˜ˆå€¼çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šå°è¯•å°†å†…å­˜æ•°æ®ç»“æ„ä¸­çš„æ•°æ®æº¢å†™åˆ°ç£ç›˜ï¼Œç„¶åæ¸…ç©ºå†…å­˜æ•°æ®ç»“æ„ã€‚\nåœ¨æº¢å†™åˆ°ç£ç›˜æ–‡ä»¶ä¹‹å‰ï¼Œä¼šå…ˆæ ¹æ® key å¯¹å†…å­˜æ•°æ®ç»“æ„ä¸­å·²æœ‰çš„æ•°æ®è¿›è¡Œæ’åºã€‚æ’åºè¿‡åï¼Œä¼šåˆ†æ‰¹å°†æ•°æ®å†™å…¥ç£ç›˜æ–‡ä»¶ã€‚é»˜è®¤çš„ batch æ•°é‡æ˜¯ 10000 æ¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ’åºå¥½çš„æ•°æ®ï¼Œä¼šä»¥æ¯æ‰¹ 1 ä¸‡æ¡æ•°æ®çš„å½¢å¼åˆ†æ‰¹å†™å…¥ç£ç›˜æ–‡ä»¶ã€‚å†™å…¥ç£ç›˜æ–‡ä»¶æ˜¯é€šè¿‡ Java çš„ BufferedOutputStream å®ç°çš„ã€‚BufferedOutputStream æ˜¯ Java çš„ç¼“å†²è¾“å‡ºæµï¼Œé¦–å…ˆä¼šå°†æ•°æ®ç¼“å†²åœ¨å†…å­˜ä¸­ï¼Œå½“å†…å­˜ç¼“å†²æ»¡æº¢ä¹‹åå†ä¸€æ¬¡å†™å…¥ç£ç›˜æ–‡ä»¶ä¸­ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ç£ç›˜ IO æ¬¡æ•°ï¼Œæå‡æ€§èƒ½ã€‚\nä¸€ä¸ª task å°†æ‰€æœ‰æ•°æ®å†™å…¥å†…å­˜æ•°æ®ç»“æ„çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå‘ç”Ÿå¤šæ¬¡ç£ç›˜æº¢å†™æ“ä½œï¼Œä¹Ÿå°±ä¼šäº§ç”Ÿå¤šä¸ªä¸´æ—¶æ–‡ä»¶ã€‚æœ€åä¼šå°†ä¹‹å‰æ‰€æœ‰çš„ä¸´æ—¶ç£ç›˜æ–‡ä»¶éƒ½è¿›è¡Œåˆå¹¶ï¼Œè¿™å°±æ˜¯merge è¿‡ç¨‹ï¼Œæ­¤æ—¶ä¼šå°†ä¹‹å‰æ‰€æœ‰ä¸´æ—¶ç£ç›˜æ–‡ä»¶ä¸­çš„æ•°æ®è¯»å–å‡ºæ¥ï¼Œç„¶åä¾æ¬¡å†™å…¥æœ€ç»ˆçš„ç£ç›˜æ–‡ä»¶ä¹‹ä¸­ã€‚æ­¤å¤–ï¼Œç”±äºä¸€ä¸ª task å°±åªå¯¹åº”ä¸€ä¸ªç£ç›˜æ–‡ä»¶ï¼Œä¹Ÿå°±æ„å‘³ç€è¯¥ task ä¸ºä¸‹æ¸¸ stage çš„ task å‡†å¤‡çš„æ•°æ®éƒ½åœ¨è¿™ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå› æ­¤è¿˜ä¼šå•ç‹¬å†™ä¸€ä»½ç´¢å¼•æ–‡ä»¶ï¼Œå…¶ä¸­æ ‡è¯†äº†ä¸‹æ¸¸å„ä¸ª task çš„æ•°æ®åœ¨æ–‡ä»¶ä¸­çš„ start offset ä¸ end offsetã€‚\nSortShuffleManager ç”±äºæœ‰ä¸€ä¸ªç£ç›˜æ–‡ä»¶ merge çš„è¿‡ç¨‹ï¼Œå› æ­¤å¤§å¤§å‡å°‘äº†æ–‡ä»¶æ•°é‡ã€‚æ¯”å¦‚ç¬¬ä¸€ä¸ª stage æœ‰ 50 ä¸ª taskï¼Œæ€»å…±æœ‰ 10 ä¸ª Executorï¼Œæ¯ä¸ª Executor æ‰§è¡Œ 5 ä¸ª taskï¼Œè€Œç¬¬äºŒä¸ª stage æœ‰ 100 ä¸ª taskã€‚ç”±äºæ¯ä¸ª task æœ€ç»ˆåªæœ‰ä¸€ä¸ªç£ç›˜æ–‡ä»¶ï¼Œå› æ­¤æ­¤æ—¶æ¯ä¸ª Executor ä¸Šåªæœ‰ 5 ä¸ªç£ç›˜æ–‡ä»¶ï¼Œæ‰€æœ‰ Executor åªæœ‰ 50 ä¸ªç£ç›˜æ–‡ä»¶ã€‚ æ™®é€šè¿è¡Œæœºåˆ¶çš„ SortShuffleManager å·¥ä½œåŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š bypassè¿è¡Œæœºåˆ¶ Reducer ç«¯ä»»åŠ¡æ•°æ¯”è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼ŒåŸºäº Hash Shuffle å®ç°æœºåˆ¶æ˜æ˜¾æ¯”åŸºäº Sort Shuffle å®ç°æœºåˆ¶è¦å¿«ï¼Œå› æ­¤åŸºäº Sort Shuffle å®ç°æœºåˆ¶æä¾›äº†ä¸€ä¸ªå¸¦ Hash é£æ ¼çš„å›é€€æ–¹æ¡ˆï¼Œå°±æ˜¯ bypass è¿è¡Œæœºåˆ¶ã€‚å¯¹äº Reducer ç«¯ä»»åŠ¡æ•°å°‘äºé…ç½®å±æ€§spark.shuffle.sort.bypassMergeThresholdè®¾ç½®çš„ä¸ªæ•°æ—¶ï¼Œä½¿ç”¨å¸¦ Hash é£æ ¼çš„å›é€€è®¡åˆ’ã€‚\npass è¿è¡Œæœºåˆ¶çš„è§¦å‘æ¡ä»¶å¦‚ä¸‹ï¼š shuffle map task æ•°é‡å°äºspark.shuffle.sort.bypassMergeThresholdï¼200å‚æ•°çš„å€¼ã€‚ä¸æ˜¯èšåˆç±»çš„ shuffle ç®—å­ã€‚\næ­¤æ—¶ï¼Œæ¯ä¸ª task ä¼šä¸ºæ¯ä¸ªä¸‹æ¸¸ task éƒ½åˆ›å»ºä¸€ä¸ªä¸´æ—¶ç£ç›˜æ–‡ä»¶ï¼Œå¹¶å°†æ•°æ®æŒ‰ key è¿›è¡Œ hash ç„¶åæ ¹æ® key çš„ hash å€¼ï¼Œå°† key å†™å…¥å¯¹åº”çš„ç£ç›˜æ–‡ä»¶ä¹‹ä¸­ã€‚å½“ç„¶ï¼Œå†™å…¥ç£ç›˜æ–‡ä»¶æ—¶ä¹Ÿæ˜¯å…ˆå†™å…¥å†…å­˜ç¼“å†²ï¼Œç¼“å†²å†™æ»¡ä¹‹åå†æº¢å†™åˆ°ç£ç›˜æ–‡ä»¶çš„ã€‚æœ€åï¼ŒåŒæ ·ä¼šå°†æ‰€æœ‰ä¸´æ—¶ç£ç›˜æ–‡ä»¶éƒ½åˆå¹¶æˆä¸€ä¸ªç£ç›˜æ–‡ä»¶ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ç´¢å¼•æ–‡ä»¶ã€‚\nè¯¥è¿‡ç¨‹çš„ç£ç›˜å†™æœºåˆ¶å…¶å®è·Ÿæœªç»ä¼˜åŒ–çš„ HashShuffleManager æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œå› ä¸ºéƒ½è¦åˆ›å»ºæ•°é‡æƒŠäººçš„ç£ç›˜æ–‡ä»¶ï¼Œåªæ˜¯åœ¨æœ€åä¼šåšä¸€ä¸ªç£ç›˜æ–‡ä»¶çš„åˆå¹¶è€Œå·²ã€‚å› æ­¤å°‘é‡çš„æœ€ç»ˆç£ç›˜æ–‡ä»¶ï¼Œä¹Ÿè®©è¯¥æœºåˆ¶ç›¸å¯¹æœªç»ä¼˜åŒ–çš„ HashShuffleManager æ¥è¯´ï¼Œshuffle read çš„æ€§èƒ½ä¼šæ›´å¥½ã€‚\nè€Œè¯¥æœºåˆ¶ä¸æ™®é€š SortShuffleManager è¿è¡Œæœºåˆ¶çš„ä¸åŒåœ¨äºï¼š\nç¬¬ä¸€ï¼Œç£ç›˜å†™æœºåˆ¶ä¸åŒï¼› ç¬¬äºŒï¼Œä¸ä¼šè¿›è¡Œæ’åºã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ç”¨è¯¥æœºåˆ¶çš„æœ€å¤§å¥½å¤„åœ¨äºï¼Œshuffle write è¿‡ç¨‹ä¸­ï¼Œä¸éœ€è¦è¿›è¡Œæ•°æ®çš„æ’åºæ“ä½œï¼Œä¹Ÿå°±èŠ‚çœæ‰äº†è¿™éƒ¨åˆ†çš„æ€§èƒ½å¼€é”€ã€‚ Tungsten Sort Shuffle è¿è¡Œæœºåˆ¶ Tungsten Sort æ˜¯å¯¹æ™®é€š Sort çš„ä¸€ç§ä¼˜åŒ–ï¼ŒTungsten Sort ä¼šè¿›è¡Œæ’åºï¼Œä½†æ’åºçš„ä¸æ˜¯å†…å®¹æœ¬èº«ï¼Œè€Œæ˜¯å†…å®¹åºåˆ—åŒ–åå­—èŠ‚æ•°ç»„çš„æŒ‡é’ˆï¼ˆå…ƒæ•°æ®ï¼‰ï¼ŒæŠŠæ•°æ®çš„æ’åºè½¬å˜ä¸ºäº†æŒ‡é’ˆæ•°ç»„çš„æ’åºï¼Œå®ç°äº†ç›´æ¥å¯¹åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ’åºã€‚ç”±äºç›´æ¥åŸºäºäºŒè¿›åˆ¶æ•°æ®è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥åœ¨è¿™é‡Œé¢æ²¡æœ‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚å†…å­˜çš„æ¶ˆè€—å¤§å¤§é™ä½ï¼Œç›¸åº”çš„ï¼Œä¼šæå¤§çš„å‡å°‘çš„ GC çš„å¼€é”€ã€‚\nSpark æä¾›äº†é…ç½®å±æ€§ï¼Œç”¨äºé€‰æ‹©å…·ä½“çš„ Shuffle å®ç°æœºåˆ¶ï¼Œä½†éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè™½ç„¶é»˜è®¤æƒ…å†µä¸‹ Spark é»˜è®¤å¼€å¯çš„æ˜¯åŸºäº SortShuffle å®ç°æœºåˆ¶ï¼Œä½†å®é™…ä¸Šï¼Œå‚è€ƒ Shuffle çš„æ¡†æ¶å†…æ ¸éƒ¨åˆ†å¯çŸ¥åŸºäº SortShuffle çš„å®ç°æœºåˆ¶ä¸åŸºäº Tungsten Sort Shuffle å®ç°æœºåˆ¶éƒ½æ˜¯ä½¿ç”¨\nSortShuffleManagerï¼Œè€Œå†…éƒ¨ä½¿ç”¨çš„å…·ä½“çš„å®ç°æœºåˆ¶ï¼Œæ˜¯é€šè¿‡æä¾›çš„ä¸¤ä¸ªæ–¹æ³•è¿›è¡Œåˆ¤æ–­çš„ï¼š å¯¹åº”éåŸºäº Tungsten Sort æ—¶ï¼Œé€šè¿‡ SortShuffleWriter.shouldBypassMergeSort æ–¹æ³•åˆ¤æ–­æ˜¯å¦éœ€è¦å›é€€åˆ° Hash é£æ ¼çš„ Shuffle å®ç°æœºåˆ¶ï¼Œå½“è¯¥æ–¹æ³•è¿”å›çš„æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œåˆ™é€šè¿‡ SortShuffleManager.canUseSerializedShuffleæ–¹æ³•åˆ¤æ–­æ˜¯å¦éœ€è¦é‡‡ç”¨åŸºäº Tungsten Sort Shuffle å®ç°æœºåˆ¶ï¼Œè€Œå½“è¿™ä¸¤ä¸ªæ–¹æ³•è¿”å›éƒ½ä¸º falseï¼Œå³éƒ½ä¸æ»¡è¶³å¯¹åº”çš„æ¡ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨é‡‡ç”¨æ™®é€šè¿è¡Œæœºåˆ¶ã€‚\nå› æ­¤ï¼Œå½“è®¾ç½®äº†spark.shuffle.managerï¼tungstenï¼sortæ—¶ï¼Œä¹Ÿä¸èƒ½ä¿è¯å°±ä¸€å®šé‡‡ç”¨åŸºäº Tungsten Sort çš„ Shuffle å®ç°æœºåˆ¶ã€‚\nè¦å®ç° Tungsten Sort Shuffle æœºåˆ¶éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š\nShuffle ä¾èµ–ä¸­ä¸å¸¦èšåˆæ“ä½œæˆ–æ²¡æœ‰å¯¹è¾“å‡ºè¿›è¡Œæ’åºçš„è¦æ±‚ã€‚ Shuffle çš„åºåˆ—åŒ–å™¨æ”¯æŒåºåˆ—åŒ–å€¼çš„é‡å®šä½ï¼ˆå½“å‰ä»…æ”¯æŒ KryoSerializer Spark SQL æ¡†æ¶è‡ªå®šä¹‰çš„åºåˆ—åŒ–å™¨ï¼‰ã€‚ Shuffle è¿‡ç¨‹ä¸­çš„è¾“å‡ºåˆ†åŒºä¸ªæ•°å°‘äº 16777216 ä¸ªã€‚ å®é™…ä¸Šï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­è¿˜æœ‰å…¶ä»–ä¸€äº›é™åˆ¶ï¼Œå¦‚å¼•å…¥ Page å½¢å¼çš„å†…å­˜ç®¡ç†æ¨¡å‹åï¼Œå†…éƒ¨å•æ¡è®°å½•çš„é•¿åº¦ä¸èƒ½è¶…è¿‡ 128 MB ï¼ˆå…·ä½“å†…å­˜æ¨¡å‹å¯ä»¥å‚è€ƒ PackedRecordPointer ç±»ï¼‰ã€‚å¦å¤–ï¼Œåˆ†åŒºä¸ªæ•°çš„é™åˆ¶ä¹Ÿæ˜¯è¯¥å†…å­˜æ¨¡å‹å¯¼è‡´çš„ã€‚\næ‰€ä»¥ï¼Œç›®å‰ä½¿ç”¨åŸºäº Tungsten Sort Shuffle å®ç°æœºåˆ¶æ¡ä»¶è¿˜æ˜¯æ¯”è¾ƒè‹›åˆ»çš„ã€‚\n3. Spark Shuffle å†å²: ä¸ºä»€ä¹ˆ Spark æœ€ç»ˆè¿˜æ˜¯æ”¾å¼ƒäº† HashShuffle ï¼Œä½¿ç”¨äº† Sortedï¼Based Shuffleï¼Ÿ æˆ‘ä»¬å¯ä»¥ä» Spark æœ€æ ¹æœ¬è¦ä¼˜åŒ–å’Œè¿«åˆ‡è¦è§£å†³çš„é—®é¢˜ä¸­æ‰¾åˆ°ç­”æ¡ˆï¼Œä½¿ç”¨ HashShuffle çš„ Spark åœ¨ Shuffle æ—¶äº§ç”Ÿå¤§é‡çš„æ–‡ä»¶ã€‚å½“æ•°æ®é‡è¶Šæ¥è¶Šå¤šæ—¶ï¼Œäº§ç”Ÿçš„æ–‡ä»¶é‡æ˜¯ä¸å¯æ§çš„ï¼Œè¿™ä¸¥é‡åˆ¶çº¦äº† Spark çš„æ€§èƒ½åŠæ‰©å±•èƒ½åŠ›ï¼Œæ‰€ä»¥ Spark å¿…é¡»è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå‡å°‘ Mapper ç«¯ ShuffleWriter äº§ç”Ÿçš„æ–‡ä»¶æ•°é‡ï¼Œè¿™æ ·ä¾¿å¯ä»¥è®© Spark ä»å‡ ç™¾å°é›†ç¾¤çš„è§„æ¨¡ç¬é—´å˜æˆå¯ä»¥æ”¯æŒå‡ åƒå°ï¼Œç”šè‡³å‡ ä¸‡å°é›†ç¾¤çš„è§„æ¨¡ã€‚\nä½†ä½¿ç”¨ Sortedï¼Based Shuffle å°±å®Œç¾äº†å—ï¼Œç­”æ¡ˆæ˜¯å¦å®šçš„ï¼ŒSortedï¼Based Shuffle ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œå…¶ç¼ºç‚¹åè€Œæ˜¯å®ƒæ’åºçš„ç‰¹æ€§ï¼Œå®ƒå¼ºåˆ¶è¦æ±‚æ•°æ®åœ¨ Mapper ç«¯å¿…é¡»å…ˆè¿›è¡Œæ’åºï¼Œæ‰€ä»¥å¯¼è‡´å®ƒæ’åºçš„é€Ÿåº¦æœ‰ç‚¹æ…¢ã€‚å¥½åœ¨å‡ºç°äº† Tungstenï¼Sort Shuffle ï¼Œå®ƒå¯¹æ’åºç®—æ³•è¿›è¡Œäº†æ”¹è¿›ï¼Œä¼˜åŒ–äº†æ’åºçš„é€Ÿåº¦ã€‚Tungstenï¼SortShuffle å·²ç»å¹¶å…¥äº† Sortedï¼Based Shuffleï¼ŒSpark çš„å¼•æ“ä¼šè‡ªåŠ¨è¯†åˆ«ç¨‹åºéœ€è¦çš„æ˜¯ Sortedï¼BasedShuffleï¼Œè¿˜æ˜¯ Tungstenï¼Sort Shuffleã€‚\nSpark SQLå’ŒHive SQLçš„åŒºåˆ« Hive SQLæ˜¯Hiveæä¾›çš„SQLæŸ¥è¯¢å¼•æ“ï¼Œåº•å±‚ç”±MapReduceå®ç°ã€‚Hiveæ ¹æ®è¾“å…¥çš„SQLè¯­å¥æ‰§è¡Œè¯æ³•åˆ†æã€è¯­æ³•æ ‘æ„å»ºã€ç¼–è¯‘ã€é€»è¾‘è®¡åˆ’ã€ä¼˜åŒ–é€»è¾‘è®¡åˆ’ä»¥åŠç‰©ç†è®¡åˆ’ç­‰è¿‡ç¨‹ï¼Œè½¬åŒ–ä¸ºMap Taskå’ŒReduce Taskæœ€ç»ˆäº¤ç”±Mapreduceå¼•æ“æ‰§è¡Œã€‚\næ‰§è¡Œå¼•æ“ã€‚å…·æœ‰mapreduceçš„ä¸€åˆ‡ç‰¹æ€§ï¼Œé€‚åˆå¤§æ‰¹é‡æ•°æ®ç¦»çº¿å¤„ç†ï¼Œç›¸è¾ƒäºSparkè€Œè¨€ï¼Œé€Ÿåº¦è¾ƒæ…¢ä¸”IOæ“ä½œé¢‘ç¹ æœ‰å®Œæ•´çš„hqlè¯­æ³•ï¼Œæ”¯æŒåŸºæœ¬sqlè¯­æ³•ã€å‡½æ•°å’Œudf å¯¹è¡¨æ•°æ®å­˜å‚¨æ ¼å¼æœ‰è¦æ±‚ï¼Œä¸åŒå­˜å‚¨ã€å‹ç¼©æ ¼å¼æ€§èƒ½ä¸åŒ Checkpoint æ£€æŸ¥ç‚¹æœºåˆ¶ åº”ç”¨åœºæ™¯ï¼šå½“sparkåº”ç”¨ç¨‹åºç‰¹åˆ«å¤æ‚ï¼Œä»åˆå§‹çš„RDDå¼€å§‹åˆ°æœ€åæ•´ä¸ªåº”ç”¨ç¨‹åºå®Œæˆæœ‰å¾ˆå¤šçš„æ­¥éª¤ï¼Œè€Œä¸”æ•´ä¸ªåº”ç”¨è¿è¡Œæ—¶é—´ç‰¹åˆ«é•¿ï¼Œè¿™ç§æƒ…å†µä¸‹å°±æ¯”è¾ƒé€‚åˆä½¿ç”¨checkpointåŠŸèƒ½ã€‚\nåŸå› ï¼šå¯¹äºç‰¹åˆ«å¤æ‚çš„Sparkåº”ç”¨ï¼Œä¼šå‡ºç°æŸä¸ªåå¤ä½¿ç”¨çš„RDDï¼Œå³ä½¿ä¹‹å‰æŒä¹…åŒ–è¿‡ä½†ç”±äºèŠ‚ç‚¹çš„æ•…éšœå¯¼è‡´æ•°æ®ä¸¢å¤±äº†ï¼Œæ²¡æœ‰å®¹é”™æœºåˆ¶ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°è®¡ç®—ä¸€æ¬¡æ•°æ®ã€‚\nCheckpointé¦–å…ˆä¼šè°ƒç”¨SparkContextçš„setCheckPointDIR()æ–¹æ³•ï¼Œè®¾ç½®ä¸€ä¸ªå®¹é”™çš„æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ï¼Œæ¯”å¦‚è¯´HDFSï¼›ç„¶åå¯¹RDDè°ƒç”¨checkpoint()æ–¹æ³•ã€‚ä¹‹ååœ¨RDDæ‰€å¤„çš„jobè¿è¡Œç»“æŸä¹‹åï¼Œä¼šå¯åŠ¨ä¸€ä¸ªå•ç‹¬çš„jobï¼Œæ¥å°†checkpointè¿‡çš„RDDæ•°æ®å†™å…¥ä¹‹å‰è®¾ç½®çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè¿›è¡Œé«˜å¯ç”¨ã€å®¹é”™çš„ç±»æŒä¹…åŒ–æ“ä½œã€‚\næ£€æŸ¥ç‚¹æœºåˆ¶æ˜¯æˆ‘ä»¬åœ¨spark streamingä¸­ç”¨æ¥ä¿éšœå®¹é”™æ€§çš„ä¸»è¦æœºåˆ¶ï¼Œå®ƒå¯ä»¥ä½¿spark streamingé˜¶æ®µæ€§çš„æŠŠåº”ç”¨æ•°æ®å­˜å‚¨åˆ°è¯¸å¦‚HDFSç­‰å¯é å­˜å‚¨ç³»ç»Ÿä¸­ï¼Œä»¥ä¾›æ¢å¤æ—¶ä½¿ç”¨ã€‚å…·ä½“æ¥è¯´åŸºäºä»¥ä¸‹ä¸¤ä¸ªç›®çš„æœåŠ¡ï¼š\næ§åˆ¶å‘ç”Ÿå¤±è´¥æ—¶éœ€è¦é‡ç®—çš„çŠ¶æ€æ•°ã€‚Spark streamingå¯ä»¥é€šè¿‡è½¬åŒ–å›¾çš„è°±ç³»å›¾æ¥é‡ç®—çŠ¶æ€ï¼Œæ£€æŸ¥ç‚¹æœºåˆ¶åˆ™å¯ä»¥æ§åˆ¶éœ€è¦åœ¨è½¬åŒ–å›¾ä¸­å›æº¯å¤šè¿œã€‚ æä¾›é©±åŠ¨å™¨ç¨‹åºå®¹é”™ã€‚å¦‚æœæµè®¡ç®—åº”ç”¨ä¸­çš„é©±åŠ¨å™¨ç¨‹åºå´©æºƒäº†ï¼Œä½ å¯ä»¥é‡å¯é©±åŠ¨å™¨ç¨‹åºå¹¶è®©é©±åŠ¨å™¨ç¨‹åºä»æ£€æŸ¥ç‚¹æ¢å¤ï¼Œè¿™æ ·spark streamingå°±å¯ä»¥è¯»å–ä¹‹å‰è¿è¡Œçš„ç¨‹åºå¤„ç†æ•°æ®çš„è¿›åº¦ï¼Œå¹¶ä»é‚£é‡Œç»§ç»­\ncheckpointå’ŒæŒä¹…åŒ–æœºåˆ¶çš„åŒºåˆ« æœ€ä¸»è¦çš„åŒºåˆ«åœ¨äºæŒä¹…åŒ–åªæ˜¯å°†æ•°æ®ä¿å­˜åœ¨BlockManagerä¸­ï¼Œä½†æ˜¯RDDçš„lineage(è¡€ç¼˜å…³ç³»ï¼Œä¾èµ–å…³ç³»)æ˜¯ä¸å˜çš„ã€‚ä½†æ˜¯checkpointæ‰§è¡Œå®Œä¹‹åï¼Œrddå·²ç»æ²¡æœ‰ä¹‹å‰æ‰€è°“çš„ä¾èµ–rddäº†ï¼Œè€Œåªæœ‰ä¸€ä¸ªå¼ºè¡Œä¸ºå…¶è®¾ç½®çš„checkpointRDDï¼Œcheckpointä¹‹årddçš„lineageå°±æ”¹å˜äº†ã€‚ æŒä¹…åŒ–çš„æ•°æ®ä¸¢å¤±çš„å¯èƒ½æ€§æ›´å¤§ï¼Œå› ä¸ºèŠ‚ç‚¹çš„æ•…éšœä¼šå¯¼è‡´ç£ç›˜ã€å†…å­˜çš„æ•°æ®ä¸¢å¤±ã€‚ä½†æ˜¯checkpointçš„æ•°æ®é€šå¸¸æ˜¯ä¿å­˜åœ¨é«˜å¯ç”¨çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ¯”å¦‚HDFSä¸­ï¼Œæ‰€ä»¥æ•°æ®ä¸¢å¤±å¯èƒ½æ€§æ¯”è¾ƒä½ã€‚\nSpark shuffle å‚æ•°ä¼˜åŒ– spark.shuffle.file.bufferï¼šä¸»è¦æ˜¯è®¾ç½®çš„Shuffleè¿‡ç¨‹ä¸­å†™æ–‡ä»¶çš„ç¼“å†²ï¼Œé»˜è®¤32kï¼Œå¦‚æœå†…å­˜è¶³å¤Ÿï¼Œå¯ä»¥é€‚å½“è°ƒå¤§ï¼Œæ¥å‡å°‘å†™å…¥ç£ç›˜çš„æ•°é‡ã€‚ spark.reducer.maxSizeInFightï¼šä¸»è¦æ˜¯è®¾ç½®Shuffleè¿‡ç¨‹ä¸­è¯»æ–‡ä»¶çš„ç¼“å†²åŒºï¼Œä¸€æ¬¡èƒ½å¤Ÿè¯»å–å¤šå°‘æ•°æ®ï¼Œé»˜è®¤48m, å¦‚æœå†…å­˜è¶³å¤Ÿï¼Œå¯ä»¥é€‚å½“æ‰©å¤§ï¼Œå‡å°‘æ•´ä¸ªç½‘ç»œä¼ è¾“æ¬¡æ•°ã€‚ spark.shuffle.io.maxRetriesï¼šä¸»è¦æ˜¯è®¾ç½®ç½‘ç»œè¿æ¥å¤±è´¥æ—¶ï¼Œé‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤3æ¬¡ï¼Œ é€‚å½“è°ƒå¤§èƒ½å¤Ÿå¢åŠ ç¨³å®šæ€§ã€‚ spark.shuffle.io.retryWaitï¼šä¸»è¦è®¾ç½®æ¯æ¬¡é‡è¯•ä¹‹é—´çš„é—´éš”æ—¶é—´ï¼Œå¯ä»¥é€‚å½“è°ƒå¤§ï¼Œé»˜è®¤5s, å¢åŠ ç¨‹åºç¨³å®šæ€§ã€‚ spark.shuffle.memoryFractionï¼šè¯¥å‚æ•°ä»£è¡¨äº†Executorå†…å­˜ä¸­ï¼Œåˆ†é…ç»™shuffle read taskè¿›è¡Œèšåˆæ“ä½œçš„å†…å­˜æ¯”ä¾‹ï¼Œé»˜è®¤æ˜¯20%ã€‚Shuffleè¿‡ç¨‹ä¸­çš„å†…å­˜å ç”¨ï¼Œå¦‚æœç¨‹åºä¸­è¾ƒå¤šä½¿ç”¨äº†Shuffleæ“ä½œï¼Œé‚£ä¹ˆå¯ä»¥é€‚å½“è°ƒå¤§è¯¥åŒºåŸŸã€‚ [deprecated], æ—§ç‰ˆæœ¬çš„é™æ€å†…å­˜ç®¡ç†ç­–ç•¥ç”Ÿæ•ˆï¼Œæ–°ç‰ˆæœ¬ç»Ÿä¸€å†…å­˜ç®¡ç†æ­¤å‚æ•°æ— æ•ˆã€‚ç”¨çš„æ˜¯ spark.storage.memoryFraction ä¸­çš„å†…å­˜ spark.shuffle.managerï¼šHashå’ŒSortæ–¹å¼ï¼ŒSortæ˜¯é»˜è®¤ï¼ŒHashåœ¨reduceæ•°é‡ æ¯”è¾ƒå°‘çš„æ—¶å€™ï¼Œæ•ˆç‡ä¼šå¾ˆé«˜ã€‚ spark.shuffle.sort.bypassMergeThresholdï¼šè®¾ç½®çš„æ˜¯Sortæ–¹å¼ä¸­ï¼Œé»˜è®¤200ï¼Œå¯ç”¨Hashè¾“å‡ºæ–¹å¼çš„ä¸´ç•Œå€¼ï¼Œå¦‚æœä½ çš„ç¨‹åºæ•°æ®ä¸éœ€è¦æ’åºï¼Œè€Œä¸”reduceæ•°é‡æ¯”è¾ƒå°‘ï¼Œé‚£æ¨èå¯ä»¥é€‚å½“å¢å¤§ä¸´ç•Œå€¼ã€‚ spark.shuffle.cosolidateFilesï¼šå¦‚æœä½ ä½¿ç”¨Hash shuffleæ–¹å¼ï¼Œæ¨èæ‰“å¼€è¯¥é…ç½®ï¼Œå®ç°æ›´å°‘çš„æ–‡ä»¶è¾“å‡ºã€‚å¦‚æœè®¾ç½®ä¸ºtrueï¼Œé‚£ä¹ˆå°±ä¼šå¼€å¯consolidateæœºåˆ¶ï¼Œä¼šå¤§å¹…åº¦åˆå¹¶shuffle writeçš„è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºshuffle read taskæ•°é‡ç‰¹åˆ«å¤šçš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥æå¤§åœ°å‡å°‘ç£ç›˜IOå¼€é”€ï¼Œæå‡æ€§èƒ½ã€‚è°ƒä¼˜å»ºè®®ï¼šå¦‚æœçš„ç¡®ä¸éœ€è¦SortShuffleManagerçš„æ’åºæœºåˆ¶ï¼Œé‚£ä¹ˆé™¤äº†ä½¿ç”¨bypassæœºåˆ¶ï¼Œè¿˜å¯ä»¥å°è¯•å°†spark.shuffle.managerå‚æ•°æ‰‹åŠ¨æŒ‡å®šä¸ºhashï¼Œä½¿ç”¨HashShuffleManagerï¼ŒåŒæ—¶å¼€å¯consolidateæœºåˆ¶ã€‚åœ¨å®è·µä¸­å°è¯•è¿‡ï¼Œå‘ç°å…¶æ€§èƒ½æ¯”å¼€å¯äº†bypassæœºåˆ¶çš„SortShuffleManagerè¦é«˜å‡º10%~30%ã€‚ spark.sql.adaptive.shuffle.targetPostShuffleInputSize: default 67108864(64M) åŠ¨æ€è°ƒæ•´reduceä¸ªæ•°çš„partitionå¤§å°ä¾æ®ï¼ŒåŠ¨æ€åˆå¹¶reducerçš„partitionã€‚mapç«¯å¤šä¸ªpartition åˆå¹¶åæ•°æ®é˜ˆå€¼ï¼Œå°äºé˜ˆå€¼ä¼šåˆå¹¶ã€‚å¦‚è®¾ç½®64MBåˆ™reduceé˜¶æ®µæ¯ä¸ªtaskæœ€å°‘å¤„ç†64MBçš„æ•°æ® Spark Locality å‚æ•° å‚æ•°æƒ³ é»˜è®¤å€¼ å‚æ•°è§£é‡Š spark.locality.wait 3000ï¼ˆæ¯«ç§’) æ•°æ®æœ¬åœ°æ€§é™çº§çš„ç­‰å¾…æ—¶é—´ spark.locality.wait.process spark.locality.wait å¤šé•¿æ—¶é—´ç­‰ä¸åˆ°PROCESS_LOCALå°±é™ spark.locality.wait.node spark.locality.wait å¤šé•¿æ—¶é—´ç­‰ä¸åˆ°NODE_LOCALå°±é™ spark.locality.wait.rack spark.locality.wait å¤šé•¿æ—¶é—´ç­‰ä¸åˆ°RACK_LOCALå°±é™çº§ 1 2 3 4 new SparkConf().set(\u0026#34;spark.locality.wait\u0026#34;, \u0026#34;10\u0026#34;) spark.locality.wait.process//å»ºè®®60s spark.locality.wait.node//å»ºè®®30s spark.locality.wait.rack//å»ºè®®20s ","permalink":"https://reid00.github.io/en/posts/computation/spark-%E9%9D%A2%E8%AF%95%E6%B3%A8%E6%84%8F%E7%82%B9/","summary":"åŸºç¡€ç¯‡ sparksql å¦‚ä½•åŠ è½½metadata ä»»ä½•çš„SQLå¼•æ“éƒ½æ˜¯éœ€è¦åŠ è½½å…ƒæ•°æ®çš„ï¼Œä¸ç„¶ï¼Œè¿æ‰§è¡Œè®¡åˆ’éƒ½ç”Ÿæˆä¸äº†ã€‚ åŠ è½½å…ƒæ•°æ®æ€»çš„æ¥è¯´åˆ†ä¸ºä¸¤æ­¥:\nåŠ è½½å…ƒæ•°æ® åˆ›å»ºä¼šè¯è¿æ¥Hive MetaStore é¦–å…ˆï¼ŒSparkæ£€æµ‹åˆ°æˆ‘ä»¬æ²¡æœ‰è®¾ç½®spark.sql.warehouse.dirï¼Œç„¶åå°±å¼€å§‹æ‰¾æˆ‘ä»¬åœ¨hite-site.xmlä¸­é…ç½®çš„hive.metastore.warehouse.dirã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hive.metastore.uris\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;thrift://test-3:9083,thrift://test-4:9083\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hive.metastore.client.socket.timeout\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;300\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hive.metastore.warehouse.dir\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;/data/hive/warehouse\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hive.warehouse.subdir.inherit.perms\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;true\u0026lt;/value\u0026gt; ç„¶åï¼ŒSparkSessionåœ¨HDFSä¸´æ—¶ä½ç½®åˆ›å»ºäº†ä¸‹é¢ç›®å½•ã€‚\n1 2 Moved: \u0026#39;hdfs://nn1/data/hive/warehouse/pyspark_test.db/tb_name/part-00000-c46bc573-0d1d-4ac4-8a69-2359dff82485-c000\u0026#39; to trash at: hdfs://nn1/user/hive/.Trash/Current Moved: \u0026#39;hdfs://nn1/data/hive/warehouse/pyspark_test.db/tb_name/part-00001-c46bc573-0d1d-4ac4-8a69-2359dff82485-c000\u0026#39; to trash at: hdfs://nn1/user/hive/.Trash/Current æœ€åï¼ŒSparkå¼€å§‹é€šè¿‡thrift RPCå»è¿æ¥Hiveçš„MetaStore Serverã€‚\nè¿›é˜¶ç¯‡ Sparkä¸ºä»€ä¹ˆè¿™ä¹ˆå¿« Sparkæ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„ï¼Œç”¨äºå¤§è§„æ¨¡æ•°æ®å¤„ç†çš„ç»Ÿä¸€åˆ†æå¼•æ“ï¼Œå…¶è¿ç®—é€Ÿåº¦å¯ä»¥è¾¾åˆ°Mapreduceçš„10-100å€ã€‚å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š\nå†…å­˜è®¡ç®—ã€‚Sparkä¼˜å…ˆå°†æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ•°æ®å¯ä»¥è¢«å¿«é€Ÿå¤„ç†ï¼Œå¹¶å¯å¯ç”¨ç¼“å­˜ã€‚ shuffleè¿‡ç¨‹ä¼˜åŒ–ã€‚å’ŒMapreduceçš„shuffleè¿‡ç¨‹ä¸­é—´æ–‡ä»¶é¢‘ç¹è½ç›˜ä¸åŒï¼ŒSparkå¯¹Shuffleæœºåˆ¶è¿›è¡Œäº†ä¼˜åŒ–ï¼Œé™ä½ä¸­é—´æ–‡ä»¶çš„æ•°é‡å¹¶ä¿è¯å†…å­˜ä¼˜å…ˆã€‚ RDDè®¡ç®—æ¨¡å‹ã€‚Sparkå…·æœ‰é«˜æ•ˆçš„DAGè°ƒåº¦ç®—æ³•ï¼ŒåŒæ—¶å°†RDDè®¡ç®—ç»“æœå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚ å¦‚ä½•ç†è§£DAGSchedulerçš„Stageåˆ’åˆ†ç®—æ³• å®˜ç½‘çš„RDDæ‰§è¡Œæµç¨‹å›¾: 1 rdd1.join(rdd2).groupBy().filter() é’ˆå¯¹ä¸€æ®µåº”ç”¨ä»£ç (å¦‚ä¸Š)ï¼ŒDriverä¼šä»¥Actionç®—å­ä¸ºè¾¹ç•Œç”ŸæˆDAGè°ƒåº¦å›¾ã€‚DAGSchedulerä»DAGæœ«ç«¯å¼€å§‹éå†åˆ’åˆ†Stageï¼Œå°è£…æˆä¸€ç³»åˆ—çš„tasksetsç§»äº¤TaskSchedulerï¼Œåè€…æ ¹æ®è°ƒåº¦ç®—æ³•, å°†tasksetåˆ†å‘åˆ°ç›¸åº”workerä¸Šçš„Executorä¸­æ‰§è¡Œã€‚\nDAGSchdulerçš„å·¥ä½œåŸç† DAGScheduleræ˜¯ä¸€ä¸ªé¢å‘stageè°ƒåº¦æœºåˆ¶çš„é«˜çº§è°ƒåº¦å™¨ï¼Œä¸ºæ¯ä¸ªjobè®¡ç®—stageçš„DAG(æœ‰å‘æ— ç¯å›¾)ï¼Œåˆ’åˆ†stageå¹¶æäº¤tasksetç»™TaskSchedulerã€‚ è¿½è¸ªæ¯ä¸ªRDDå’Œstageçš„ç‰©åŒ–æƒ…å†µï¼Œå¤„ç†å› shuffleè¿‡ç¨‹ä¸¢å¤±çš„RDDï¼Œé‡æ–°è®¡ç®—å’Œæäº¤ã€‚ æŸ¥æ‰¾rdd partition æ˜¯å¦cache/checkpointã€‚æä¾›ä¼˜å…ˆä½ç½®ç»™TaskSchedulerï¼Œç­‰å¾…åç»­TaskSchedulerçš„æœ€ä½³ä½ç½®åˆ’åˆ† Stageåˆ’åˆ†ç®—æ³• ä»è§¦å‘actionæ“ä½œçš„ç®—å­å¼€å§‹ï¼Œä»åå¾€å‰éå†DAGã€‚ ä¸ºæœ€åä¸€ä¸ªrddåˆ›å»ºfinalStageã€‚ éå†è¿‡ç¨‹ä¸­å¦‚æœå‘ç°è¯¥rddæ˜¯å®½ä¾èµ–ï¼Œåˆ™ä¸ºå…¶ç”Ÿæˆä¸€ä¸ªæ–°çš„stageï¼Œä¸æ—§stageåˆ†éš”è€Œå¼€ï¼Œæ­¤æ—¶è¯¥rddæ˜¯æ–°stageçš„æœ€åä¸€ä¸ªrddã€‚ å¦‚æœè¯¥rddæ˜¯çª„ä¾èµ–ï¼Œå°†è¯¥rddåˆ’åˆ†ä¸ºæ—§stageå†…ï¼Œç»§ç»­éå†ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç»§ç»­éå†ç›´è‡³DAGå®Œæˆã€‚ å¦‚ä½•ç†è§£TaskSchedulerçš„Taskåˆ†é…ç®—æ³• TaskSchedulerè´Ÿè´£Sparkä¸­çš„taskä»»åŠ¡è°ƒåº¦å·¥ä½œã€‚TaskSchedulerå†…éƒ¨ä½¿ç”¨TasksetPoolè°ƒåº¦æ± æœºåˆ¶å­˜æ”¾taskä»»åŠ¡ã€‚TasksetPoolåˆ†ä¸ºFIFO(å…ˆè¿›å…ˆå‡ºè°ƒåº¦)å’ŒFAIR(å…¬å¹³è°ƒåº¦)ã€‚ FIFOè°ƒåº¦: åŸºäºé˜Ÿåˆ—æ€æƒ³ï¼Œä½¿ç”¨å…ˆè¿›å…ˆå‡ºåŸåˆ™é¡ºåºè°ƒåº¦taskset FAIRè°ƒåº¦: æ ¹æ®æƒé‡å€¼è°ƒåº¦ï¼Œä¸€èˆ¬é€‰å–èµ„æºå ç”¨ç‡ä½œä¸ºæ ‡å‡†ï¼Œå¯äººä¸ºè®¾å®š TaskSchedulerçš„å·¥ä½œåŸç† è´Ÿè´£Applicationåœ¨Cluster Managerä¸Šçš„æ³¨å†Œ æ ¹æ®ä¸åŒç­–ç•¥åˆ›å»ºTasksetPoolèµ„æºè°ƒåº¦æ± ï¼Œåˆå§‹åŒ–poolå¤§å° æ ¹æ®taskåˆ†é…ç®—æ³•å‘é€Taskåˆ°Executorä¸Šæ‰§è¡Œ Taskåˆ†é…ç®—æ³• é¦–å…ˆè·å–æ‰€æœ‰çš„executorsï¼ŒåŒ…å«executorsçš„ipå’Œportç­‰ä¿¡æ¯ å°†æ‰€æœ‰çš„executorsæ ¹æ®shuffleç®—æ³•è¿›è¡Œæ‰“æ•£ éå†executorsã€‚åœ¨ç¨‹åºä¸­ä¾æ¬¡å°è¯•æœ¬åœ°åŒ–çº§åˆ«ï¼Œæœ€ç»ˆé€‰æ‹©æ¯ä¸ªtaskçš„æœ€ä¼˜ä½ç½®(ç»“åˆDAGSchedulerä¼˜åŒ–ä½ç½®ç­–ç•¥) åºåˆ—åŒ–taskåˆ†é…ç»“æœï¼Œå¹¶å‘é€RPCæ¶ˆæ¯ç­‰å¾…Executorå“åº” Sparkçš„æœ¬åœ°åŒ–çº§åˆ«æœ‰å“ªå‡ ç§ï¼Ÿæ€ä¹ˆè°ƒä¼˜ ç§»åŠ¨è®¡ç®— or ç§»åŠ¨æ•°æ®ï¼Ÿè¿™æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚åœ¨åˆ†å¸ƒå¼è®¡ç®—çš„æ ¸å¿ƒæ€æƒ³ä¸­ï¼Œç§»åŠ¨è®¡ç®—æ°¸è¿œæ¯”ç§»åŠ¨æ•°æ®è¦åˆç®—å¾—å¤šï¼Œå¦‚ä½•åˆç†åˆ©ç”¨æœ¬åœ°åŒ–æ•°æ®è®¡ç®—æ˜¯å€¼å¾—æ€è€ƒçš„ä¸€ä¸ªé—®é¢˜ã€‚","title":"Spark é¢è¯•æ³¨æ„ç‚¹"},{"content":"ç®€ä»‹ å½“ä¸€ä¸ªSparkåº”ç”¨æäº¤åˆ°é›†ç¾¤ä¸Šè¿è¡Œæ—¶,åº”ç”¨æ¶æ„åŒ…å«äº†ä¸¤ä¸ªéƒ¨åˆ†:\nDriver Programï¼ˆèµ„æºç”³è¯·å’Œè°ƒåº¦Jobæ‰§è¡Œï¼‰ Executorsï¼ˆè¿è¡ŒJobä¸­Taskä»»åŠ¡å’Œç¼“å­˜æ•°æ®ï¼‰ï¼Œä¸¤ä¸ªéƒ½æ˜¯JVM Processè¿›ç¨‹ Driverç¨‹åºè¿è¡Œçš„ä½ç½®å¯ä»¥é€šè¿‡â€“deploy-mode æ¥æŒ‡å®š:\nDriveræŒ‡çš„æ˜¯The process running the main() function of the application and creating the SparkContext è¿è¡Œåº”ç”¨ç¨‹åºçš„main()å‡½æ•°å¹¶åˆ›å»ºSparkContextçš„è¿›ç¨‹\nclient: è¡¨ç¤ºDriverè¿è¡Œåœ¨æäº¤åº”ç”¨çš„Clientä¸Š(é»˜è®¤) cluster: è¡¨ç¤ºDriverè¿è¡Œåœ¨é›†ç¾¤ä¸­(Standaloneï¼šWorkerï¼ŒYARNï¼šNodeManager) clusterå’Œclientæ¨¡å¼æœ€æœ€æœ¬è´¨çš„åŒºåˆ«æ˜¯ï¼šDriverç¨‹åºè¿è¡Œåœ¨å“ªé‡Œã€‚ ä¼ä¸šå®é™…ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨cluster ä¸ºä¸»è¦æ¨¡å¼ã€‚ 1. Client(å®¢æˆ·ç«¯)æ¨¡å¼ DeployModeä¸ºClientï¼Œè¡¨ç¤ºåº”ç”¨Driver Programè¿è¡Œåœ¨æäº¤åº”ç”¨Clientä¸»æœºä¸Šã€‚ ç¤ºæ„å›¾: 1 2 3 4 5 6 7 8 9 10 11 SPARK_HOME=/export/server/spark ${SPARK_HOME}/bin/spark-submit \\ --master yarn \\ --deploy-mode client \\ --driver-memory 512m \\ --executor-memory 512m \\ --num-executors 1 \\ --total-executor-cores 2 \\ --class org.apache.spark.examples.SparkPi \\ ${SPARK_HOME}/examples/jars/spark-examples_2.11-2.4.5.jar \\ 10 2.Cluster(é›†ç¾¤)æ¨¡å¼,ç”Ÿäº§ç¯å¢ƒç”¨ DeployModeä¸ºClusterï¼Œè¡¨ç¤ºåº”ç”¨Driver Programè¿è¡Œåœ¨é›†ç¾¤ä»èŠ‚ç‚¹æŸå°æœºå™¨ä¸Š. 1 2 3 4 5 6 7 8 9 10 11 SPARK_HOME=/export/server/spark ${SPARK_HOME}/bin/spark-submit \\ --master yarn \\ --deploy-mode cluster \\ --driver-memory 512m \\ --executor-memory 512m \\ --num-executors 1 \\ --total-executor-cores 2 \\ --class org.apache.spark.examples.SparkPi \\ ${SPARK_HOME}/examples/jars/spark-examples_2.11-2.4.5.jar \\ 10 æ€»ç»“: Clientæ¨¡å¼å’ŒClusteræ¨¡å¼æœ€æœ€æœ¬è´¨çš„åŒºåˆ«æ˜¯ï¼šDriverç¨‹åºè¿è¡Œåœ¨å“ªé‡Œã€‚\nClientæ¨¡å¼ï¼šæµ‹è¯•æ—¶ä½¿ç”¨ï¼Œå¼€å‘ä¸ç”¨ï¼Œäº†è§£å³å¯ Driverè¿è¡Œåœ¨Clientä¸Š,å’Œé›†ç¾¤çš„é€šä¿¡æˆæœ¬é«˜ Driverè¾“å‡ºç»“æœä¼šåœ¨å®¢æˆ·ç«¯æ˜¾ç¤º Clusteræ¨¡å¼ï¼šç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨è¯¥æ¨¡å¼ Driverç¨‹åºåœ¨YARNé›†ç¾¤ä¸­ï¼Œå’Œé›†ç¾¤çš„é€šä¿¡æˆæœ¬ä½ Driverè¾“å‡ºç»“æœä¸èƒ½åœ¨å®¢æˆ·ç«¯æ˜¾ç¤º è¯¥æ¨¡å¼ä¸‹Driverè¿è¡ŒApplicattionMasterè¿™ä¸ªèŠ‚ç‚¹ä¸Š,ç”±Yarnç®¡ç†ï¼Œå¦‚æœå‡ºç°é—®é¢˜ï¼Œyarnä¼šé‡å¯ApplicattionMaster(Driver) 3. ä¸¤ç§æ¨¡å¼çš„è¯¦ç»†æµç¨‹å›¾ Clientæ¨¡å¼å›¾ç¤º: åœ¨YARN Clientæ¨¡å¼ä¸‹ï¼ŒDriveråœ¨ä»»åŠ¡æäº¤çš„æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œã€‚ Driveråœ¨ä»»åŠ¡æäº¤çš„æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œï¼ŒDriverå¯åŠ¨åä¼šå’ŒResourceManageré€šè®¯ç”³è¯·å¯åŠ¨ApplicationMaster 1 2 3 --master yarn \\ --deploy-mode client \\ --driver-memory 512m \\ éšåResourceManageråˆ†é…Containerï¼Œåœ¨åˆé€‚çš„NodeManagerä¸Šå¯åŠ¨ApplicationMasterï¼Œæ­¤æ—¶çš„ApplicationMasterçš„åŠŸèƒ½ç›¸å½“äºä¸€ä¸ªExecutorLaucherï¼Œåªè´Ÿè´£å‘ResourceManagerç”³è¯·Executorå†…å­˜ 1 2 3 --executor-memory 512m \\ --executor-cores 2 \\ --num-executors 1 \\ ResourceManageræ¥åˆ°ApplicationMasterçš„èµ„æºç”³è¯·åä¼šåˆ†é…Containerï¼Œç„¶åApplicationMasteråœ¨èµ„æºåˆ†é…æŒ‡å®šçš„NodeManagerä¸Šå¯åŠ¨Executorè¿›ç¨‹ï¼› Executorè¿›ç¨‹å¯åŠ¨åä¼šå‘Driveråå‘æ³¨å†Œï¼ŒExecutorå…¨éƒ¨æ³¨å†Œå®ŒæˆåDriverå¼€å§‹æ‰§è¡Œmainå‡½æ•°ï¼› ä¹‹åæ‰§è¡Œåˆ°Actionç®—å­æ—¶ï¼Œè§¦å‘ä¸€ä¸ªJobï¼Œå¹¶æ ¹æ®å®½ä¾èµ–å¼€å§‹åˆ’åˆ†Stageï¼Œæ¯ä¸ªStageç”Ÿæˆå¯¹åº”çš„TaskSetï¼Œä¹‹åå°†Taskåˆ†å‘åˆ°å„ä¸ªExecutorä¸Šæ‰§è¡Œã€‚ Cluster æ¨¡å¼ç¤ºæ„å›¾ åœ¨YARN Clusteræ¨¡å¼ä¸‹ï¼ŒDriverè¿è¡Œåœ¨NodeManager Contanierä¸­ï¼Œæ­¤æ—¶Driverä¸AppMasteråˆä¸ºä¸€ä½“ã€‚ Driveråœ¨ä»»åŠ¡æäº¤çš„æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œï¼ŒDriverå¯åŠ¨åä¼šå’ŒResourceManageré€šè®¯ç”³è¯·å¯åŠ¨ApplicationMaster 1 2 3 --master yarn \\ --deploy-mode cluster \\ --driver-memory 512m \\ éšåResourceManageråˆ†é…Containerï¼Œåœ¨åˆé€‚çš„NodeManagerä¸Šå¯åŠ¨ApplicationMasterï¼Œæ­¤æ—¶çš„ApplicationMasterçš„åŠŸèƒ½ç›¸å½“äºä¸€ä¸ªExecutorLaucherï¼Œåªè´Ÿè´£å‘ResourceManagerç”³è¯·Executorå†…å­˜ 1 2 3 --executor-memory 512m \\ --executor-cores 2 \\ --num-executors 1 \\ ResourceManageræ¥åˆ°ApplicationMasterçš„èµ„æºç”³è¯·åä¼šåˆ†é…Containerï¼Œç„¶åApplicationMasteråœ¨èµ„æºåˆ†é…æŒ‡å®šçš„NodeManagerä¸Šå¯åŠ¨Executorè¿›ç¨‹ï¼› Executorè¿›ç¨‹å¯åŠ¨åä¼šå‘Driveråå‘æ³¨å†Œï¼ŒExecutorå…¨éƒ¨æ³¨å†Œå®ŒæˆåDriverå¼€å§‹æ‰§è¡Œmainå‡½æ•°ï¼› ä¹‹åæ‰§è¡Œåˆ°Actionç®—å­æ—¶ï¼Œè§¦å‘ä¸€ä¸ªJobï¼Œå¹¶æ ¹æ®å®½ä¾èµ–å¼€å§‹åˆ’åˆ†Stageï¼Œæ¯ä¸ªStageç”Ÿæˆå¯¹åº”çš„TaskSetï¼Œä¹‹åå°†Taskåˆ†å‘åˆ°å„ä¸ªExecutorä¸Šæ‰§è¡Œã€‚ 4. è¿è¡Œä¸­æ¶‰åŠåˆ°çš„åè¯ Application: Applictionéƒ½æ˜¯æŒ‡ç”¨æˆ·ç¼–å†™çš„Sparkåº”ç”¨ç¨‹åºï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ä¸ªDriveråŠŸèƒ½çš„ä»£ç å’Œåˆ†å¸ƒåœ¨é›†ç¾¤ä¸­å¤šä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„Executorä»£ç  Driver: Sparkä¸­çš„Driverå³è¿è¡Œä¸Šè¿°Applicationçš„mainå‡½æ•°å¹¶åˆ›å»ºSparkContextï¼Œåˆ›å»º- SparkContextçš„ç›®çš„æ˜¯ä¸ºäº†å‡†å¤‡Sparkåº”ç”¨ç¨‹åºçš„è¿è¡Œç¯å¢ƒï¼Œå½“Executoréƒ¨åˆ†è¿è¡Œå®Œæ¯•åï¼ŒDriveråŒæ—¶è´Ÿè´£å°†SparkContextå…³é—­ï¼Œé€šå¸¸ç”¨SparkContextä»£è¡¨Driver AppMaster: æ§åˆ¶yarn appè¿è¡Œå’Œä»»åŠ¡èµ„æº Executor: æŸä¸ªApplicationè¿è¡Œåœ¨workerèŠ‚ç‚¹ä¸Šçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œ è¯¥è¿›ç¨‹è´Ÿè´£è¿è¡ŒæŸäº›Taskï¼Œ å¹¶ä¸”è´Ÿè´£å°†æ•°æ®å­˜åˆ°å†…å­˜æˆ–ç£ç›˜ä¸Šï¼Œæ¯ä¸ªApplicationéƒ½æœ‰å„è‡ªç‹¬ç«‹çš„ä¸€æ‰¹Executor Worker: é›†ç¾¤ä¸­ä»»ä½•å¯ä»¥è¿è¡ŒApplicationä»£ç çš„èŠ‚ç‚¹ï¼Œåœ¨Standaloneæ¨¡å¼ä¸­æŒ‡çš„æ˜¯é€šè¿‡slaveæ–‡ä»¶é…ç½®çš„WorkerèŠ‚ç‚¹ï¼Œåœ¨Spark on Yarnæ¨¡å¼ä¸‹å°±æ˜¯NodeManagerèŠ‚ç‚¹ Task: è¢«é€åˆ°æŸä¸ªExecutorä¸Šçš„å·¥ä½œå•å…ƒï¼Œä½†hadoopMRä¸­çš„MapTaskå’ŒReduceTaskæ¦‚å¿µä¸€æ ·ï¼Œæ˜¯è¿è¡ŒApplicationçš„åŸºæœ¬å•ä½ï¼Œå¤šä¸ªTaskç»„æˆä¸€ä¸ªStageï¼Œè€ŒTaskçš„è°ƒåº¦å’Œç®¡ç†ç­‰æ˜¯ç”±TaskSchedulerè´Ÿè´£ Job: åŒ…å«å¤šä¸ªTaskç»„æˆçš„å¹¶è¡Œè®¡ç®—ï¼Œå¾€å¾€ç”±Spark Actionè§¦å‘ç”Ÿæˆï¼Œ ä¸€ä¸ªApplicationä¸­å¾€å¾€ä¼šäº§ç”Ÿå¤šä¸ªJob Stage: æ¯ä¸ªJobä¼šè¢«æ‹†åˆ†æˆå¤šç»„Taskï¼Œ ä½œä¸ºä¸€ä¸ªTaskSetï¼Œ å…¶åç§°ä¸ºStageï¼ŒStageçš„åˆ’åˆ†å’Œè°ƒåº¦æ˜¯æœ‰DAGScheduleræ¥è´Ÿè´£çš„ï¼ŒStageæœ‰éæœ€ç»ˆçš„Stageï¼ˆShuffle Map Stageï¼‰å’Œæœ€ç»ˆçš„Stageï¼ˆResult Stageï¼‰ä¸¤ç§ï¼ŒStageçš„è¾¹ç•Œå°±æ˜¯å‘ç”Ÿshuffleçš„åœ°æ–¹ DAGScheduler: æ ¹æ®Jobæ„å»ºåŸºäºStageçš„DAGï¼ˆDirected Acyclic Graphæœ‰å‘æ— ç¯å›¾)ï¼Œå¹¶æäº¤Stageç»™TASkSchedulerã€‚ å…¶åˆ’åˆ†Stageçš„ä¾æ®æ˜¯RDDä¹‹é—´çš„ä¾èµ–çš„å…³ç³»æ‰¾å‡ºå¼€é”€æœ€å°çš„è°ƒåº¦æ–¹æ³• TASKSedulter: å°†TaskSetæäº¤ç»™workerè¿è¡Œï¼Œæ¯ä¸ªExecutorè¿è¡Œä»€ä¹ˆTaskå°±æ˜¯åœ¨æ­¤å¤„åˆ†é…çš„. TaskSchedulerç»´æŠ¤æ‰€æœ‰TaskSetï¼Œå½“Executorå‘Driverå‘ç”Ÿå¿ƒè·³æ—¶ï¼ŒTaskSchedulerä¼šæ ¹æ®èµ„æºå‰©ä½™æƒ…å†µåˆ†é…ç›¸åº”çš„Taskã€‚å¦å¤–TaskSchedulerè¿˜ç»´æŠ¤ç€æ‰€æœ‰Taskçš„è¿è¡Œæ ‡ç­¾ï¼Œé‡è¯•å¤±è´¥çš„Task Sparké›†ç¾¤ä¸­çš„è§’è‰² Driver: æ˜¯ä¸€ä¸ªJVM Process è¿›ç¨‹ï¼Œç¼–å†™çš„Sparkåº”ç”¨ç¨‹åºå°±è¿è¡Œåœ¨Driverä¸Šï¼Œç”±Driverè¿›ç¨‹æ‰§è¡Œï¼› Master(ResourceManager): æ˜¯ä¸€ä¸ªJVM Process è¿›ç¨‹ï¼Œä¸»è¦è´Ÿè´£èµ„æºçš„è°ƒåº¦å’Œåˆ†é…ï¼Œå¹¶è¿›è¡Œé›†ç¾¤çš„ç›‘æ§ç­‰èŒè´£ï¼› Worker(NodeManager)ï¼š æ˜¯ä¸€ä¸ªJVM Process è¿›ç¨‹ï¼Œä¸€ä¸ªWorkerè¿è¡Œåœ¨é›†ç¾¤ä¸­çš„ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œä¸»è¦è´Ÿè´£ä¸¤ä¸ªèŒè´£ï¼Œä¸€ä¸ªæ˜¯ç”¨è‡ªå·±çš„å†…å­˜å­˜å‚¨RDDçš„æŸä¸ªæˆ–æŸäº›partitionï¼›å¦ä¸€ä¸ªæ˜¯å¯åŠ¨å…¶ä»–è¿›ç¨‹å’Œçº¿ç¨‹ï¼ˆExecutorï¼‰ï¼Œå¯¹RDDä¸Šçš„partitionè¿›è¡Œå¹¶è¡Œçš„å¤„ç†å’Œè®¡ç®—ã€‚ Executorï¼š æ˜¯ä¸€ä¸ªJVM Process è¿›ç¨‹ï¼Œä¸€ä¸ªWorker(NodeManager)ä¸Šå¯ä»¥è¿è¡Œå¤šä¸ªExecutorï¼ŒExecutoré€šè¿‡å¯åŠ¨å¤šä¸ªçº¿ç¨‹ï¼ˆtaskï¼‰æ¥æ‰§è¡Œå¯¹RDDçš„partitionè¿›è¡Œå¹¶è¡Œè®¡ç®—ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œæˆ‘ä»¬å¯¹RDDå®šä¹‰çš„ä¾‹å¦‚mapã€flatMapã€reduceç­‰ç®—å­æ“ä½œã€‚\n","permalink":"https://reid00.github.io/en/posts/computation/spark-on-yarn-%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90/","summary":"ç®€ä»‹ å½“ä¸€ä¸ªSparkåº”ç”¨æäº¤åˆ°é›†ç¾¤ä¸Šè¿è¡Œæ—¶,åº”ç”¨æ¶æ„åŒ…å«äº†ä¸¤ä¸ªéƒ¨åˆ†:\nDriver Programï¼ˆèµ„æºç”³è¯·å’Œè°ƒåº¦Jobæ‰§è¡Œï¼‰ Executorsï¼ˆè¿è¡ŒJobä¸­Taskä»»åŠ¡å’Œç¼“å­˜æ•°æ®ï¼‰ï¼Œä¸¤ä¸ªéƒ½æ˜¯JVM Processè¿›ç¨‹ Driverç¨‹åºè¿è¡Œçš„ä½ç½®å¯ä»¥é€šè¿‡â€“deploy-mode æ¥æŒ‡å®š:\nDriveræŒ‡çš„æ˜¯The process running the main() function of the application and creating the SparkContext è¿è¡Œåº”ç”¨ç¨‹åºçš„main()å‡½æ•°å¹¶åˆ›å»ºSparkContextçš„è¿›ç¨‹\nclient: è¡¨ç¤ºDriverè¿è¡Œåœ¨æäº¤åº”ç”¨çš„Clientä¸Š(é»˜è®¤) cluster: è¡¨ç¤ºDriverè¿è¡Œåœ¨é›†ç¾¤ä¸­(Standaloneï¼šWorkerï¼ŒYARNï¼šNodeManager) clusterå’Œclientæ¨¡å¼æœ€æœ€æœ¬è´¨çš„åŒºåˆ«æ˜¯ï¼šDriverç¨‹åºè¿è¡Œåœ¨å“ªé‡Œã€‚ ä¼ä¸šå®é™…ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨cluster ä¸ºä¸»è¦æ¨¡å¼ã€‚ 1. Client(å®¢æˆ·ç«¯)æ¨¡å¼ DeployModeä¸ºClientï¼Œè¡¨ç¤ºåº”ç”¨Driver Programè¿è¡Œåœ¨æäº¤åº”ç”¨Clientä¸»æœºä¸Šã€‚ ç¤ºæ„å›¾: 1 2 3 4 5 6 7 8 9 10 11 SPARK_HOME=/export/server/spark ${SPARK_HOME}/bin/spark-submit \\ --master yarn \\ --deploy-mode client \\ --driver-memory 512m \\ --executor-memory 512m \\ --num-executors 1 \\ --total-executor-cores 2 \\ --class org.apache.spark.examples.SparkPi \\ ${SPARK_HOME}/examples/jars/spark-examples_2.11-2.4.5.jar \\ 10 2.","title":"Spark on Yarn æ‰§è¡Œæµç¨‹è§£æ"},{"content":"æ¦‚è¿° åœ¨sparkç¨‹åºä¸­ï¼Œå½“ä¸€ä¸ªä¼ é€’ç»™Sparkæ“ä½œ(ä¾‹å¦‚mapå’Œreduce)çš„å‡½æ•°åœ¨è¿œç¨‹èŠ‚ç‚¹ä¸Šé¢è¿è¡Œæ—¶ï¼ŒSparkæ“ä½œå®é™…ä¸Šæ“ä½œçš„æ˜¯è¿™ä¸ªå‡½æ•°æ‰€ç”¨å˜é‡çš„ä¸€ä¸ªç‹¬ç«‹å‰¯æœ¬ã€‚è¿™äº›å˜é‡ä¼šè¢«å¤åˆ¶åˆ°æ¯å°æœºå™¨ä¸Šï¼Œå¹¶ä¸”è¿™äº›å˜é‡åœ¨è¿œç¨‹æœºå™¨ä¸Šçš„æ‰€æœ‰æ›´æ–°éƒ½ä¸ä¼šä¼ é€’å›é©±åŠ¨ç¨‹åºã€‚é€šå¸¸è·¨ä»»åŠ¡çš„è¯»å†™å˜é‡æ˜¯ä½æ•ˆçš„ï¼Œä½†æ˜¯ï¼ŒSparkè¿˜æ˜¯ä¸ºä¸¤ç§å¸¸è§çš„ä½¿ç”¨æ¨¡å¼æä¾›äº†ä¸¤ç§æœ‰é™çš„å…±äº«å˜é‡ï¼šå¹¿æ’­å˜ï¼ˆbroadcast variableï¼‰å’Œç´¯åŠ å™¨ï¼ˆaccumulatorï¼‰\nä¸ºä»€ä¹ˆéœ€è¦å¹¿æ’­å˜é‡ å¦‚æœæˆ‘ä»¬è¦åœ¨åˆ†å¸ƒå¼è®¡ç®—é‡Œé¢åˆ†å‘å¤§å¯¹è±¡ï¼Œä¾‹å¦‚ï¼šå­—å…¸ï¼Œé›†åˆï¼Œé»‘ç™½åå•ç­‰ï¼Œè¿™ä¸ªéƒ½ä¼šç”±Driverç«¯è¿›è¡Œåˆ†å‘ï¼Œä¸€èˆ¬æ¥è®²ï¼Œå¦‚æœè¿™ä¸ªå˜é‡ä¸æ˜¯å¹¿æ’­å˜é‡ï¼Œé‚£ä¹ˆæ¯ä¸ªtaskå°±ä¼šåˆ†å‘ä¸€ä»½ï¼Œè¿™åœ¨taskæ•°ç›®ååˆ†å¤šçš„æƒ…å†µä¸‹Driverçš„å¸¦å®½ä¼šæˆä¸ºç³»ç»Ÿçš„ç“¶é¢ˆï¼Œè€Œä¸”ä¼šå¤§é‡æ¶ˆè€—taskæœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œå¦‚æœå°†è¿™ä¸ªå˜é‡å£°æ˜ä¸ºå¹¿æ’­å˜é‡ï¼Œé‚£ä¹ˆçŸ¥è¯†æ¯ä¸ªexecutoræ‹¥æœ‰ä¸€ä»½ï¼Œè¿™ä¸ªexecutorå¯åŠ¨çš„taskä¼šå…±äº«è¿™ä¸ªå˜é‡ï¼ŒèŠ‚çœäº†é€šä¿¡çš„æˆæœ¬å’ŒæœåŠ¡å™¨çš„èµ„æºã€‚\nå›¾è§£å¹¿æ’­å˜é‡ ä¸ä½¿ç”¨å¹¿æ’­å˜é‡ ä½¿ç”¨å¹¿æ’­å˜é‡ å¯çŸ¥: å¦‚æœä½¿ç”¨å¹¿æ’­å˜é‡ï¼Œä¸€ä¸ªexecutor åªæœ‰ä¸€ä¸ªdriver å˜é‡çš„å‰¯æœ¬ï¼ŒèŠ‚çœèµ„æºï¼Œè€Œä¸æ˜¯ç”¨çš„è¯ï¼ŒåŒä¸€ä¸ªexecutor çš„ä¸åŒtask éƒ½ä¼šæœ‰è¿™ä¸ªå˜é‡çš„å‰¯æœ¬ï¼Œç½‘ç»œIOå°±ä¼šæˆä¸ºç“¶é¢ˆã€‚\nå¦‚ä½•å®šä¹‰å¹¿æ’­å˜é‡ 1 2 3 4 5 6 7 8 val data = List(1, 2, 3, 4, 5, 6) val bdata = sc.broadcast(data) val rdd = sc.parallelize(1 to 6, 2) val observedSizes = rdd.map(_ =\u0026gt; bdata.value.size) å– value val c = broadcast.value æ³¨æ„ç‚¹ å˜é‡ä¸€æ—¦è¢«å®šä¹‰ä¸ºä¸€ä¸ªå¹¿æ’­å˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡åªèƒ½è¯»ï¼Œä¸èƒ½ä¿®æ”¹\n1ã€èƒ½ä¸èƒ½å°†ä¸€ä¸ªRDDä½¿ç”¨å¹¿æ’­å˜é‡å¹¿æ’­å‡ºå»ï¼Ÿ\nä¸èƒ½ï¼Œå› ä¸ºRDDæ˜¯ä¸å­˜å‚¨æ•°æ®çš„ã€‚å¯ä»¥å°†RDDçš„ç»“æœå¹¿æ’­å‡ºå»ã€‚ 2ã€ å¹¿æ’­å˜é‡åªèƒ½åœ¨Driverç«¯å®šä¹‰ï¼Œä¸èƒ½åœ¨Executorç«¯å®šä¹‰ã€‚\n3ã€ åœ¨Driverç«¯å¯ä»¥ä¿®æ”¹å¹¿æ’­å˜é‡çš„å€¼ï¼Œåœ¨Executorç«¯æ— æ³•ä¿®æ”¹å¹¿æ’­å˜é‡çš„å€¼ã€‚\n4ã€å¦‚æœexecutorç«¯ç”¨åˆ°äº†Driverçš„å˜é‡ï¼Œå¦‚æœä¸ä½¿ç”¨å¹¿æ’­å˜é‡åœ¨Executoræœ‰å¤šå°‘taskå°±æœ‰å¤šå°‘Driverç«¯çš„å˜é‡å‰¯æœ¬ã€‚\n5ã€å¦‚æœExecutorç«¯ç”¨åˆ°äº†Driverçš„å˜é‡ï¼Œå¦‚æœä½¿ç”¨å¹¿æ’­å˜é‡åœ¨æ¯ä¸ªExecutorä¸­åªæœ‰ä¸€ä»½Driverç«¯çš„å˜é‡å‰¯æœ¬ã€‚\nä¸ºä»€ä¹ˆéœ€è¦ç´¯åŠ å™¨ åœ¨sparkåº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œå¦‚å¼‚å¸¸ç›‘æ§ï¼Œè°ƒè¯•ï¼Œè®°å½•ç¬¦åˆæŸç‰¹æ€§çš„æ•°æ®çš„æ•°ç›®ï¼Œè¿™ç§éœ€æ±‚éƒ½éœ€è¦ç”¨åˆ°è®¡æ•°å™¨ï¼Œå¦‚æœä¸€ä¸ªå˜é‡ä¸è¢«å£°æ˜ä¸ºä¸€ä¸ªç´¯åŠ å™¨ï¼Œé‚£ä¹ˆå®ƒå°†åœ¨è¢«æ”¹å˜æ—¶ä¸ä¼šå†driverç«¯è¿›è¡Œå…¨å±€æ±‡æ€»ï¼Œå³åœ¨åˆ†å¸ƒå¼è¿è¡Œæ—¶æ¯ä¸ªtaskè¿è¡Œçš„åªæ˜¯åŸå§‹å˜é‡çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œå¹¶ä¸èƒ½æ”¹å˜åŸå§‹å˜é‡çš„å€¼ï¼Œä½†æ˜¯å½“è¿™ä¸ªå˜é‡è¢«å£°æ˜ä¸ºç´¯åŠ å™¨åï¼Œè¯¥å˜é‡å°±ä¼šæœ‰åˆ†å¸ƒå¼è®¡æ•°çš„åŠŸèƒ½ã€‚\nå›¾è§£ç´¯åŠ å™¨ ä¸ä½¿ç”¨ç´¯åŠ å™¨ ä½¿ç”¨ç´¯åŠ å™¨ å¦‚ä½•å®šä¹‰ä¸€ä¸ªç´¯åŠ å™¨ï¼Ÿ 1 2 3 4 val a = sc.accumulator(0) å–å€¼ val b = a.value æ³¨æ„ç‚¹ 1ã€ ç´¯åŠ å™¨åœ¨Driverç«¯å®šä¹‰èµ‹åˆå§‹å€¼ï¼Œç´¯åŠ å™¨åªèƒ½åœ¨Driverç«¯è¯»å–æœ€åçš„å€¼ï¼Œåœ¨Excutorç«¯æ›´æ–°ã€‚\n2ã€ç´¯åŠ å™¨ä¸æ˜¯ä¸€ä¸ªè°ƒä¼˜çš„æ“ä½œï¼Œå› ä¸ºå¦‚æœä¸è¿™æ ·åšï¼Œç»“æœæ˜¯é”™çš„\nå“ªäº›å˜é‡åœ¨Drive ç«¯ï¼Œå“ªäº›åœ¨Executor ç«¯ driver \u0026amp; executor driveræ˜¯è¿è¡Œç”¨æˆ·ç¼–å†™Application çš„main()å‡½æ•°çš„åœ°æ–¹ï¼Œå…·ä½“è´Ÿè´£DAGçš„æ„å»ºã€ä»»åŠ¡çš„åˆ’åˆ†ã€taskçš„ç”Ÿæˆä¸è°ƒåº¦ç­‰ã€‚jobï¼Œstageï¼Œtaskç”Ÿæˆéƒ½ç¦»ä¸å¼€rddè‡ªèº«ï¼Œrddçš„ç›¸å…³çš„æ“ä½œä¸èƒ½ç¼ºå°‘driverç«¯çš„sparksession/sparkcontextã€‚\nexecutoræ˜¯çœŸæ­£æ‰§è¡Œtaskåœ°æ–¹ï¼Œè€Œtaskæ‰§è¡Œç¦»ä¸å¼€å…·ä½“çš„æ•°æ®ï¼Œè¿™äº›taskè¿è¡Œçš„ç»“æœå¯ä»¥æ˜¯shuffleä¸­é—´ç»“æœï¼Œä¹Ÿå¯ä»¥æŒä¹…åŒ–åˆ°å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿã€‚ä¸€èˆ¬éƒ½æ˜¯å°†ç»“æœã€çŠ¶æ€ç­‰æ±‡é›†åˆ°driverã€‚ä½†æ˜¯ï¼Œç›®å‰executorä¹‹é—´ä¸èƒ½äº’ç›¸é€šä¿¡ï¼Œåªèƒ½å€ŸåŠ©ç¬¬ä¸‰æ–¹æ¥å®ç°æ•°æ®çš„å…±äº«æˆ–è€…é€šä¿¡ã€‚\né‚£ä¹ˆï¼Œç¼–å†™çš„Sparkç¨‹åºä»£ç ï¼Œè¿è¡Œåœ¨driverç«¯è¿˜æ˜¯executorç«¯å‘¢ï¼Ÿ é€šå¸¸æˆ‘ä»¬åœ¨æœ¬åœ°æµ‹è¯•ç¨‹åºçš„æ—¶å€™ï¼Œè¦æ‰“å°RDDä¸­çš„æ•°æ®ã€‚\nåœ¨æœ¬åœ°æ¨¡å¼ä¸‹ï¼Œç›´æ¥ä½¿ç”¨rdd.foreach(println)æˆ–rdd.map(println)åœ¨å•å°æœºå™¨ä¸Šï¼Œèƒ½å¤ŸæŒ‰ç…§é¢„æœŸæ‰“å°å¹¶è¾“å‡ºæ‰€æœ‰RDDçš„å…ƒç´ ã€‚\nä½†æ˜¯ï¼Œåœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œç”±executoræ‰§è¡Œè¾“å‡ºå†™å…¥çš„æ˜¯executorçš„stdoutï¼Œè€Œä¸æ˜¯driverä¸Šçš„stdoutï¼Œæ‰€ä»¥driverçš„stdoutä¸ä¼šæ˜¾ç¤ºè¿™äº›ï¼\nè¦æƒ³åœ¨driverç«¯æ‰“å°æ‰€æœ‰å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨collect()æ–¹æ³•å…ˆå°†RDDæ•°æ®å¸¦åˆ°driverèŠ‚ç‚¹ï¼Œç„¶ååœ¨è°ƒç”¨foreach(println)ï¼ˆä½†éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œç”±äºä¼šæŠŠRDDä¸­æ‰€æœ‰å…ƒç´ éƒ½åŠ è½½åˆ°driverç«¯ï¼Œå¯èƒ½å¼•èµ·driverç«¯å†…å­˜ä¸è¶³å¯¼è‡´OOMã€‚å¦‚æœä½ åªæ˜¯æƒ³è·å–RDDä¸­çš„éƒ¨åˆ†å…ƒç´ ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨takeæˆ–è€…topæ–¹æ³•ï¼‰\næ€»ä¹‹ï¼Œåœ¨è¿™é‡ŒRDDä¸­çš„å…ƒç´ å³ä¸ºå…·ä½“çš„æ•°æ®ï¼Œå¯¹è¿™äº›æ•°æ®çš„æ“ä½œéƒ½æ˜¯ç”±è´Ÿè´£taskæ‰§è¡Œçš„executorå¤„ç†çš„ï¼Œæ‰€ä»¥æƒ³åœ¨driverç«¯è¾“å‡ºè¿™äº›æ•°æ®å°±å¿…é¡»å…ˆå°†æ•°æ®åŠ è½½åˆ°driverç«¯è¿›è¡Œå¤„ç†ã€‚\næœ€ååšä¸ªæ€»ç»“ï¼šæ‰€æœ‰å¯¹RDDå…·ä½“æ•°æ®çš„æ“ä½œéƒ½æ˜¯åœ¨executorä¸Šæ‰§è¡Œçš„ï¼Œæ‰€æœ‰å¯¹rddè‡ªèº«çš„æ“ä½œéƒ½æ˜¯åœ¨driverä¸Šæ‰§è¡Œçš„ã€‚æ¯”å¦‚foreachã€foreachPartitionéƒ½æ˜¯é’ˆå¯¹rddå†…éƒ¨æ•°æ®è¿›è¡Œå¤„ç†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ é€’ç»™è¿™äº›ç®—å­çš„å‡½æ•°éƒ½æ˜¯æ‰§è¡Œäºexecutorç«¯çš„ã€‚ä½†æ˜¯åƒforeachRDDã€transformåˆ™æ˜¯å¯¹RDDæœ¬èº«è¿›è¡Œä¸€åˆ—æ“ä½œï¼Œæ‰€ä»¥å®ƒçš„å‚æ•°å‡½æ•°æ˜¯æ‰§è¡Œåœ¨driverç«¯çš„ï¼Œé‚£ä¹ˆå®ƒå†…éƒ¨æ˜¯å¯ä»¥ä½¿ç”¨å¤–éƒ¨å˜é‡ï¼Œæ¯”å¦‚åœ¨Spark Streamingç¨‹åºä¸­æ“ä½œoffsetã€åŠ¨æ€æ›´æ–°å¹¿æ’­å˜é‡ç­‰ã€‚\n","permalink":"https://reid00.github.io/en/posts/computation/spark-%E5%B9%BF%E6%92%AD%E5%8F%98%E9%87%8F/","summary":"æ¦‚è¿° åœ¨sparkç¨‹åºä¸­ï¼Œå½“ä¸€ä¸ªä¼ é€’ç»™Sparkæ“ä½œ(ä¾‹å¦‚mapå’Œreduce)çš„å‡½æ•°åœ¨è¿œç¨‹èŠ‚ç‚¹ä¸Šé¢è¿è¡Œæ—¶ï¼ŒSparkæ“ä½œå®é™…ä¸Šæ“ä½œçš„æ˜¯è¿™ä¸ªå‡½æ•°æ‰€ç”¨å˜é‡çš„ä¸€ä¸ªç‹¬ç«‹å‰¯æœ¬ã€‚è¿™äº›å˜é‡ä¼šè¢«å¤åˆ¶åˆ°æ¯å°æœºå™¨ä¸Šï¼Œå¹¶ä¸”è¿™äº›å˜é‡åœ¨è¿œç¨‹æœºå™¨ä¸Šçš„æ‰€æœ‰æ›´æ–°éƒ½ä¸ä¼šä¼ é€’å›é©±åŠ¨ç¨‹åºã€‚é€šå¸¸è·¨ä»»åŠ¡çš„è¯»å†™å˜é‡æ˜¯ä½æ•ˆçš„ï¼Œä½†æ˜¯ï¼ŒSparkè¿˜æ˜¯ä¸ºä¸¤ç§å¸¸è§çš„ä½¿ç”¨æ¨¡å¼æä¾›äº†ä¸¤ç§æœ‰é™çš„å…±äº«å˜é‡ï¼šå¹¿æ’­å˜ï¼ˆbroadcast variableï¼‰å’Œç´¯åŠ å™¨ï¼ˆaccumulatorï¼‰\nä¸ºä»€ä¹ˆéœ€è¦å¹¿æ’­å˜é‡ å¦‚æœæˆ‘ä»¬è¦åœ¨åˆ†å¸ƒå¼è®¡ç®—é‡Œé¢åˆ†å‘å¤§å¯¹è±¡ï¼Œä¾‹å¦‚ï¼šå­—å…¸ï¼Œé›†åˆï¼Œé»‘ç™½åå•ç­‰ï¼Œè¿™ä¸ªéƒ½ä¼šç”±Driverç«¯è¿›è¡Œåˆ†å‘ï¼Œä¸€èˆ¬æ¥è®²ï¼Œå¦‚æœè¿™ä¸ªå˜é‡ä¸æ˜¯å¹¿æ’­å˜é‡ï¼Œé‚£ä¹ˆæ¯ä¸ªtaskå°±ä¼šåˆ†å‘ä¸€ä»½ï¼Œè¿™åœ¨taskæ•°ç›®ååˆ†å¤šçš„æƒ…å†µä¸‹Driverçš„å¸¦å®½ä¼šæˆä¸ºç³»ç»Ÿçš„ç“¶é¢ˆï¼Œè€Œä¸”ä¼šå¤§é‡æ¶ˆè€—taskæœåŠ¡å™¨ä¸Šçš„èµ„æºï¼Œå¦‚æœå°†è¿™ä¸ªå˜é‡å£°æ˜ä¸ºå¹¿æ’­å˜é‡ï¼Œé‚£ä¹ˆçŸ¥è¯†æ¯ä¸ªexecutoræ‹¥æœ‰ä¸€ä»½ï¼Œè¿™ä¸ªexecutorå¯åŠ¨çš„taskä¼šå…±äº«è¿™ä¸ªå˜é‡ï¼ŒèŠ‚çœäº†é€šä¿¡çš„æˆæœ¬å’ŒæœåŠ¡å™¨çš„èµ„æºã€‚\nå›¾è§£å¹¿æ’­å˜é‡ ä¸ä½¿ç”¨å¹¿æ’­å˜é‡ ä½¿ç”¨å¹¿æ’­å˜é‡ å¯çŸ¥: å¦‚æœä½¿ç”¨å¹¿æ’­å˜é‡ï¼Œä¸€ä¸ªexecutor åªæœ‰ä¸€ä¸ªdriver å˜é‡çš„å‰¯æœ¬ï¼ŒèŠ‚çœèµ„æºï¼Œè€Œä¸æ˜¯ç”¨çš„è¯ï¼ŒåŒä¸€ä¸ªexecutor çš„ä¸åŒtask éƒ½ä¼šæœ‰è¿™ä¸ªå˜é‡çš„å‰¯æœ¬ï¼Œç½‘ç»œIOå°±ä¼šæˆä¸ºç“¶é¢ˆã€‚\nå¦‚ä½•å®šä¹‰å¹¿æ’­å˜é‡ 1 2 3 4 5 6 7 8 val data = List(1, 2, 3, 4, 5, 6) val bdata = sc.broadcast(data) val rdd = sc.parallelize(1 to 6, 2) val observedSizes = rdd.map(_ =\u0026gt; bdata.value.size) å– value val c = broadcast.value æ³¨æ„ç‚¹ å˜é‡ä¸€æ—¦è¢«å®šä¹‰ä¸ºä¸€ä¸ªå¹¿æ’­å˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡åªèƒ½è¯»ï¼Œä¸èƒ½ä¿®æ”¹\n1ã€èƒ½ä¸èƒ½å°†ä¸€ä¸ªRDDä½¿ç”¨å¹¿æ’­å˜é‡å¹¿æ’­å‡ºå»ï¼Ÿ\nä¸èƒ½ï¼Œå› ä¸ºRDDæ˜¯ä¸å­˜å‚¨æ•°æ®çš„ã€‚å¯ä»¥å°†RDDçš„ç»“æœå¹¿æ’­å‡ºå»ã€‚ 2ã€ å¹¿æ’­å˜é‡åªèƒ½åœ¨Driverç«¯å®šä¹‰ï¼Œä¸èƒ½åœ¨Executorç«¯å®šä¹‰ã€‚\n3ã€ åœ¨Driverç«¯å¯ä»¥ä¿®æ”¹å¹¿æ’­å˜é‡çš„å€¼ï¼Œåœ¨Executorç«¯æ— æ³•ä¿®æ”¹å¹¿æ’­å˜é‡çš„å€¼ã€‚\n4ã€å¦‚æœexecutorç«¯ç”¨åˆ°äº†Driverçš„å˜é‡ï¼Œå¦‚æœä¸ä½¿ç”¨å¹¿æ’­å˜é‡åœ¨Executoræœ‰å¤šå°‘taskå°±æœ‰å¤šå°‘Driverç«¯çš„å˜é‡å‰¯æœ¬ã€‚\n5ã€å¦‚æœExecutorç«¯ç”¨åˆ°äº†Driverçš„å˜é‡ï¼Œå¦‚æœä½¿ç”¨å¹¿æ’­å˜é‡åœ¨æ¯ä¸ªExecutorä¸­åªæœ‰ä¸€ä»½Driverç«¯çš„å˜é‡å‰¯æœ¬ã€‚\nä¸ºä»€ä¹ˆéœ€è¦ç´¯åŠ å™¨ åœ¨sparkåº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œå¦‚å¼‚å¸¸ç›‘æ§ï¼Œè°ƒè¯•ï¼Œè®°å½•ç¬¦åˆæŸç‰¹æ€§çš„æ•°æ®çš„æ•°ç›®ï¼Œè¿™ç§éœ€æ±‚éƒ½éœ€è¦ç”¨åˆ°è®¡æ•°å™¨ï¼Œå¦‚æœä¸€ä¸ªå˜é‡ä¸è¢«å£°æ˜ä¸ºä¸€ä¸ªç´¯åŠ å™¨ï¼Œé‚£ä¹ˆå®ƒå°†åœ¨è¢«æ”¹å˜æ—¶ä¸ä¼šå†driverç«¯è¿›è¡Œå…¨å±€æ±‡æ€»ï¼Œå³åœ¨åˆ†å¸ƒå¼è¿è¡Œæ—¶æ¯ä¸ªtaskè¿è¡Œçš„åªæ˜¯åŸå§‹å˜é‡çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œå¹¶ä¸èƒ½æ”¹å˜åŸå§‹å˜é‡çš„å€¼ï¼Œä½†æ˜¯å½“è¿™ä¸ªå˜é‡è¢«å£°æ˜ä¸ºç´¯åŠ å™¨åï¼Œè¯¥å˜é‡å°±ä¼šæœ‰åˆ†å¸ƒå¼è®¡æ•°çš„åŠŸèƒ½ã€‚\nå›¾è§£ç´¯åŠ å™¨ ä¸ä½¿ç”¨ç´¯åŠ å™¨ ä½¿ç”¨ç´¯åŠ å™¨ å¦‚ä½•å®šä¹‰ä¸€ä¸ªç´¯åŠ å™¨ï¼Ÿ 1 2 3 4 val a = sc.","title":"Spark å¹¿æ’­å˜é‡"},{"content":"ä»‹ç» Slidev ä½¿ç”¨ä¸€ç§æ‰©å±•çš„ Markdown æ ¼å¼ï¼Œåœ¨ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡ä»¶ä¸­å­˜å‚¨å’Œç»„ç»‡ä½ çš„å¹»ç¯ç‰‡ã€‚è¿™è®©ä½ ä¸“æ³¨äºåˆ¶ä½œå†…å®¹ã€‚è€Œä¸”ç”±äºå†…å®¹å’Œæ ·å¼æ˜¯åˆ†å¼€çš„ï¼Œè¿™ä¹Ÿä½¿å¾—åœ¨ä¸åŒçš„ä¸»é¢˜ä¹‹é—´åˆ‡æ¢å˜å¾—æ›´åŠ å®¹æ˜“ã€‚\nå®˜ç½‘ GitHub\nå¦‚ä½•ä½¿ç”¨ Node.js çš„å®‰è£… å‚è€ƒNode å®‰è£…åˆé€‚çš„ç‰ˆæœ¬\nSlidev å®‰è£…ç®€ä»‹ æœ¬åœ°åˆ›å»º å¿«é€Ÿå¼€å§‹æœ€å¥½çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨å®˜æ–¹çš„åˆå§‹æ¨¡æ¿ã€‚\nä½¿ç”¨ NPMï¼š å¯ä»¥æœ¬åœ°åˆ›å»ºä¸€ä¸ªslidev çš„æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨æ­¤æ–‡ä»¶å¤¹ä¸‹ç›®å½•çš„å‘½ä»¤è¡Œä¸­è¾“å…¥ä¸‹é¢çš„å‘½ä»¤: 1 npm install slidev å®‰è£…å®Œæˆä¹‹åä¼šç”Ÿæˆä¸€ä¸ª slidev çš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªdemo çš„md æ–‡ä»¶ã€‚\nä½¿ç”¨ Yarnï¼š 1 yarn create slid å‘½ä»¤è¡Œç•Œé¢ åˆ›å»ºä¹‹åï¼ŒæŒ‰ ctrl + c ç»“æŸdemoï¼Œ å¦‚æœæƒ³è¦å†æ¬¡æ‰“å¼€ï¼Œå¯ä»¥ä½¿ç”¨ npx slidev\nå…¨å±€å®‰è£… ä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åœ¨å…¨å±€å®‰è£… Slidevï¼š\n1 npm i -g @slidev/cli ç„¶åå³å¯åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ slidevï¼Œè€Œæ— éœ€æ¯æ¬¡éƒ½åˆ›å»ºä¸€ä¸ªé¡¹ç›®ã€‚\n1 slidev xx.md æŸ¥çœ‹ç›¸å…³å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 $ slidev --help slidev [args] å‘½ä»¤ï¼š slidev [entry] Start a local server for Slidev [é»˜è®¤å€¼] slidev build [entry] Build hostable SPA slidev format [entry] Format the markdown file slidev theme [subcommand] Theme related operations slidev export [entry] Export slides to PDF slidev export-notes [entry] Export slide notes to PDF ä½ç½®ï¼š entry path to the slides markdown entry [å­—ç¬¦ä¸²] [é»˜è®¤å€¼: \u0026#34;slides.md\u0026#34;] é€‰é¡¹ï¼š -t, --theme override theme [å­—ç¬¦ä¸²] -p, --port port [æ•°å­—] -o, --open open in browser [å¸ƒå°”] [é»˜è®¤å€¼: false] --remote listen public host and enable remote control [å­—ç¬¦ä¸²] --tunnel open localtunnel to make Slidev available on the internet [å¸ƒå°”] [é»˜è®¤å€¼: false] --log log level [å­—ç¬¦ä¸²] [å¯é€‰å€¼: \u0026#34;error\u0026#34;, \u0026#34;warn\u0026#34;, \u0026#34;info\u0026#34;, \u0026#34;silent\u0026#34;] [é»˜è®¤å€¼: \u0026#34;warn\u0026#34;] --inspect enable the inspect plugin for debugging [å¸ƒå°”] [é»˜è®¤å€¼: false] -f, --force force the optimizer to ignore the cache and re-bundle [å¸ƒå°”] [é»˜è®¤å€¼: false] -h, --help æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ [å¸ƒå°”] -v, --version æ˜¾ç¤ºç‰ˆæœ¬å· [å¸ƒå°”] Demo è¾“å…¥slidev xx.md å¦‚æœç¬¬ä¸€æ¬¡åˆ›å»ºä¼šæç¤ºä¸å­˜åœ¨ï¼Œä¼šä½ æ˜¯å¦åˆ›å»ºï¼Œè¾“å…¥Y\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 zhangbl@DESKTOP-8NHU8UF MINGW64 /c/slidev $ slidev kg.md âˆš Entry file \u0026#34;kg.md\u0026#34; does not exist, do you want to create it? ... yes â—â– â–² Slidev v0.40.3 (global) theme @slidev/theme-seriph entry C:\\slidev\\kg.md public slide show \u0026gt; http://localhost:3030/ presenter mode \u0026gt; http://localhost:3030/presenter/ remote control \u0026gt; pass --remote to enable shortcuts \u0026gt; restart | open | edit åœ¨ä¸‹é¢ shortcuts å‡ºå‘Šè¯‰ä½ ï¼Œä½ å¯ä»¥è¾“å…¥restartï¼Œopenï¼Œedit ä¸¤ä¸ªå•è¯çš„é¦–å­—æ¯r,o,e åˆ†åˆ«å¯¹åº”é‡æ–°åŠ è½½è¿™ä¸ªmarkdown, åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¿™ä¸ªmarkdown(ä»¥PPT æ’­æ”¾çš„æ¨¡å¼), æˆ–è€…åœ¨ç¼–è¾‘å™¨ä¸­ç¼–è¾‘è¿™ä¸ªmarkdownã€‚\næ›´æ”¹ä¸»é¢˜ æ‰“å¼€markdown æ–‡ä»¶ï¼Œåœ¨å¤´éƒ¨æ”¹ä¸º: 1 2 # try also \u0026#39;default\u0026#39; to start simple theme: default å°±ä¼šé‡æ–°åŠ è½½ï¼Œå¦‚æœä¸å­˜åœ¨å°±ä¼šè¯¢é—®æ˜¯å¦ä¸‹è½½ã€‚ æ›´å¤šä¸»é¢˜è®¿é—®è¿™é‡Œ\nç®€å•è¯­æ³•\nç”¨ --- æ¥åˆ†å‰²ï¼Œè¡¨ç¤ºä¸‹ä¸€é¡µ å¦‚æœéœ€è¦è¿œç¨‹è®¿ï¼Œ å¯ä»¥ç”¨slidev xx.md --remote åœ¨remote control ä¸­å¯ä»¥çœ‹åˆ°è®¿é—®çš„url 1 2 3 4 5 6 7 8 9 10 11 12 13 14 zhangbl@DESKTOP-8NHU8UF MINGW64 /c/slidev $ slidev kg.md --remote â—â– â–² Slidev v0.40.3 (global) theme @slidev/theme-default entry C:\\slidev\\kg.md public slide show \u0026gt; http://localhost:3030/ presenter mode \u0026gt; http://localhost:3030/presenter/ remote control \u0026gt; http://10.10.63.148:3030/presenter/ shortcuts \u0026gt; restart | open | edit | qrcode ç›´æ¥ä½¿ç”¨ä¸»é¢˜åˆ›å»º\n1 slidev -t vuetiful kg.md é—®é¢˜ [vite] Internal server error 1 2 3 4 5 6 7 8 9 10 11 12 13 14 Element is missing end tag. 16:55:28 [vite] Internal server error: Element is missing end tag. Plugin: vite:vue File: /@slidev/slides/1.md:10:4 8 | \u0026lt;/span\u0026gt; 9 | \u0026lt;/div\u0026gt; 10 | \u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;https://github.com/slidevjs/slidev\u0026#34; target=\u0026#34;_blank\u0026#34; alt=\u0026#34;GitHub\u0026#34; | ^ 11 | class=\u0026#34;abs-br m-6 text-xl slidev-icon-btn opacity-50 !border-none !hover:text-white\u0026#34;\u0026gt;\u0026lt;/p\u0026gt; 12 | \u0026lt;carbon-logo-github /\u0026gt;\u0026lt;/a\u0026gt; at createCompilerError (C:\\Users\\ld\\AppData\\Roaming\\npm\\node_modules\\@slidev\\cli\\node_modules\\@vue\\compiler-core\\dist\\compiler-core.cjs.js:19:19) at emitError (C:\\Users\\ld\\AppData\\Roaming\\npm\\node_modules\\@slidev\\cli\\node_modules\\@vue\\compiler-core\\dist\\compiler-core.cjs.js:1613:29) at parseElement ... github ä¸Šæœ‰è¿™ä¸ªissue è§£å†³æ–¹å¼:\n1 A temporary solution is to delete the enter after alt=\u0026#34;Github\u0026#34;. åˆ é™¤xx.md æ–‡ä»¶ä¸­alt=\u0026ldquo;Github\u0026rdquo; åé¢çš„æ¢è¡Œ\n","permalink":"https://reid00.github.io/en/posts/other/slidev-markdown-%E8%BD%ACppt/","summary":"ä»‹ç» Slidev ä½¿ç”¨ä¸€ç§æ‰©å±•çš„ Markdown æ ¼å¼ï¼Œåœ¨ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡ä»¶ä¸­å­˜å‚¨å’Œç»„ç»‡ä½ çš„å¹»ç¯ç‰‡ã€‚è¿™è®©ä½ ä¸“æ³¨äºåˆ¶ä½œå†…å®¹ã€‚è€Œä¸”ç”±äºå†…å®¹å’Œæ ·å¼æ˜¯åˆ†å¼€çš„ï¼Œè¿™ä¹Ÿä½¿å¾—åœ¨ä¸åŒçš„ä¸»é¢˜ä¹‹é—´åˆ‡æ¢å˜å¾—æ›´åŠ å®¹æ˜“ã€‚\nå®˜ç½‘ GitHub\nå¦‚ä½•ä½¿ç”¨ Node.js çš„å®‰è£… å‚è€ƒNode å®‰è£…åˆé€‚çš„ç‰ˆæœ¬\nSlidev å®‰è£…ç®€ä»‹ æœ¬åœ°åˆ›å»º å¿«é€Ÿå¼€å§‹æœ€å¥½çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨å®˜æ–¹çš„åˆå§‹æ¨¡æ¿ã€‚\nä½¿ç”¨ NPMï¼š å¯ä»¥æœ¬åœ°åˆ›å»ºä¸€ä¸ªslidev çš„æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨æ­¤æ–‡ä»¶å¤¹ä¸‹ç›®å½•çš„å‘½ä»¤è¡Œä¸­è¾“å…¥ä¸‹é¢çš„å‘½ä»¤: 1 npm install slidev å®‰è£…å®Œæˆä¹‹åä¼šç”Ÿæˆä¸€ä¸ª slidev çš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªdemo çš„md æ–‡ä»¶ã€‚\nä½¿ç”¨ Yarnï¼š 1 yarn create slid å‘½ä»¤è¡Œç•Œé¢ åˆ›å»ºä¹‹åï¼ŒæŒ‰ ctrl + c ç»“æŸdemoï¼Œ å¦‚æœæƒ³è¦å†æ¬¡æ‰“å¼€ï¼Œå¯ä»¥ä½¿ç”¨ npx slidev\nå…¨å±€å®‰è£… ä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åœ¨å…¨å±€å®‰è£… Slidevï¼š\n1 npm i -g @slidev/cli ç„¶åå³å¯åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ slidevï¼Œè€Œæ— éœ€æ¯æ¬¡éƒ½åˆ›å»ºä¸€ä¸ªé¡¹ç›®ã€‚\n1 slidev xx.md æŸ¥çœ‹ç›¸å…³å‘½ä»¤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 $ slidev --help slidev [args] å‘½ä»¤ï¼š slidev [entry] Start a local server for Slidev [é»˜è®¤å€¼] slidev build [entry] Build hostable SPA slidev format [entry] Format the markdown file slidev theme [subcommand] Theme related operations slidev export [entry] Export slides to PDF slidev export-notes [entry] Export slide notes to PDF ä½ç½®ï¼š entry path to the slides markdown entry [å­—ç¬¦ä¸²] [é»˜è®¤å€¼: \u0026#34;slides.","title":"Slidev Markdown è½¬PPT"}]